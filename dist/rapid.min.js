(()=>{var vG=Object.create;var ab=Object.defineProperty;var bG=Object.getOwnPropertyDescriptor;var wG=Object.getOwnPropertyNames;var EG=Object.getPrototypeOf,TG=Object.prototype.hasOwnProperty;var Ui=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),p9=(t,e)=>{for(var i in e)ab(t,i,{get:e[i],enumerable:!0})},SG=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of wG(e))!TG.call(t,s)&&s!==i&&ab(t,s,{get:()=>e[s],enumerable:!(r=bG(e,s))||r.enumerable});return t};var Xi=(t,e,i)=>(i=t!=null?vG(EG(t)):{},SG(e||!t||!t.__esModule?ab(i,"default",{value:t,enumerable:!0}):i,t));var EI=Ui((lb,wI)=>{(function(t){"use strict";function e(ee){return parseInt(ee)===ee}function i(ee){if(!e(ee.length))return!1;for(var oe=0;oe<ee.length;oe++)if(!e(ee[oe])||ee[oe]<0||ee[oe]>255)return!1;return!0}function r(ee,oe){if(ee.buffer&&ee.name==="Uint8Array")return oe&&(ee.slice?ee=ee.slice():ee=Array.prototype.slice.call(ee)),ee;if(Array.isArray(ee)){if(!i(ee))throw new Error("Array contains invalid value: "+ee);return new Uint8Array(ee)}if(e(ee.length)&&i(ee))return new Uint8Array(ee);throw new Error("unsupported array-like object")}function s(ee){return new Uint8Array(ee)}function n(ee,oe,ie,ne,me){(ne!=null||me!=null)&&(ee.slice?ee=ee.slice(ne,me):ee=Array.prototype.slice.call(ee,ne,me)),oe.set(ee,ie)}var o=function(){function ee(ie){var ne=[],me=0;for(ie=encodeURI(ie);me<ie.length;){var De=ie.charCodeAt(me++);De===37?(ne.push(parseInt(ie.substr(me,2),16)),me+=2):ne.push(De)}return r(ne)}function oe(ie){for(var ne=[],me=0;me<ie.length;){var De=ie[me];De<128?(ne.push(String.fromCharCode(De)),me++):De>191&&De<224?(ne.push(String.fromCharCode((De&31)<<6|ie[me+1]&63)),me+=2):(ne.push(String.fromCharCode((De&15)<<12|(ie[me+1]&63)<<6|ie[me+2]&63)),me+=3)}return ne.join("")}return{toBytes:ee,fromBytes:oe}}(),a=function(){function ee(ne){for(var me=[],De=0;De<ne.length;De+=2)me.push(parseInt(ne.substr(De,2),16));return me}var oe="0123456789abcdef";function ie(ne){for(var me=[],De=0;De<ne.length;De++){var He=ne[De];me.push(oe[(He&240)>>4]+oe[He&15])}return me.join("")}return{toBytes:ee,fromBytes:ie}}(),l={16:10,24:12,32:14},u=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],d=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],m=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],g=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],_=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],v=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],E=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],b=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],T=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],A=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239e3,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],M=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998e3,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],k=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],F=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],O=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],B=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];function U(ee){for(var oe=[],ie=0;ie<ee.length;ie+=4)oe.push(ee[ie]<<24|ee[ie+1]<<16|ee[ie+2]<<8|ee[ie+3]);return oe}var $=function(ee){if(!(this instanceof $))throw Error("AES must be instanitated with `new`");Object.defineProperty(this,"key",{value:r(ee,!0)}),this._prepare()};$.prototype._prepare=function(){var ee=l[this.key.length];if(ee==null)throw new Error("invalid key size (must be 16, 24 or 32 bytes)");this._Ke=[],this._Kd=[];for(var oe=0;oe<=ee;oe++)this._Ke.push([0,0,0,0]),this._Kd.push([0,0,0,0]);for(var ie=(ee+1)*4,ne=this.key.length/4,me=U(this.key),De,oe=0;oe<ne;oe++)De=oe>>2,this._Ke[De][oe%4]=me[oe],this._Kd[ee-De][oe%4]=me[oe];for(var He=0,Je=ne,ot;Je<ie;){if(ot=me[ne-1],me[0]^=d[ot>>16&255]<<24^d[ot>>8&255]<<16^d[ot&255]<<8^d[ot>>24&255]^u[He]<<24,He+=1,ne!=8)for(var oe=1;oe<ne;oe++)me[oe]^=me[oe-1];else{for(var oe=1;oe<ne/2;oe++)me[oe]^=me[oe-1];ot=me[ne/2-1],me[ne/2]^=d[ot&255]^d[ot>>8&255]<<8^d[ot>>16&255]<<16^d[ot>>24&255]<<24;for(var oe=ne/2+1;oe<ne;oe++)me[oe]^=me[oe-1]}for(var oe=0,gt,vt;oe<ne&&Je<ie;)gt=Je>>2,vt=Je%4,this._Ke[gt][vt]=me[oe],this._Kd[ee-gt][vt]=me[oe++],Je++}for(var gt=1;gt<ee;gt++)for(var vt=0;vt<4;vt++)ot=this._Kd[gt][vt],this._Kd[gt][vt]=k[ot>>24&255]^F[ot>>16&255]^O[ot>>8&255]^B[ot&255]},$.prototype.encrypt=function(ee){if(ee.length!=16)throw new Error("invalid plaintext size (must be 16 bytes)");for(var oe=this._Ke.length-1,ie=[0,0,0,0],ne=U(ee),me=0;me<4;me++)ne[me]^=this._Ke[0][me];for(var De=1;De<oe;De++){for(var me=0;me<4;me++)ie[me]=g[ne[me]>>24&255]^_[ne[(me+1)%4]>>16&255]^v[ne[(me+2)%4]>>8&255]^E[ne[(me+3)%4]&255]^this._Ke[De][me];ne=ie.slice()}for(var He=s(16),Je,me=0;me<4;me++)Je=this._Ke[oe][me],He[4*me]=(d[ne[me]>>24&255]^Je>>24)&255,He[4*me+1]=(d[ne[(me+1)%4]>>16&255]^Je>>16)&255,He[4*me+2]=(d[ne[(me+2)%4]>>8&255]^Je>>8)&255,He[4*me+3]=(d[ne[(me+3)%4]&255]^Je)&255;return He},$.prototype.decrypt=function(ee){if(ee.length!=16)throw new Error("invalid ciphertext size (must be 16 bytes)");for(var oe=this._Kd.length-1,ie=[0,0,0,0],ne=U(ee),me=0;me<4;me++)ne[me]^=this._Kd[0][me];for(var De=1;De<oe;De++){for(var me=0;me<4;me++)ie[me]=b[ne[me]>>24&255]^T[ne[(me+3)%4]>>16&255]^A[ne[(me+2)%4]>>8&255]^M[ne[(me+1)%4]&255]^this._Kd[De][me];ne=ie.slice()}for(var He=s(16),Je,me=0;me<4;me++)Je=this._Kd[oe][me],He[4*me]=(m[ne[me]>>24&255]^Je>>24)&255,He[4*me+1]=(m[ne[(me+3)%4]>>16&255]^Je>>16)&255,He[4*me+2]=(m[ne[(me+2)%4]>>8&255]^Je>>8)&255,He[4*me+3]=(m[ne[(me+1)%4]&255]^Je)&255;return He};var q=function(ee){if(!(this instanceof q))throw Error("AES must be instanitated with `new`");this.description="Electronic Code Block",this.name="ecb",this._aes=new $(ee)};q.prototype.encrypt=function(ee){if(ee=r(ee),ee.length%16!==0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var oe=s(ee.length),ie=s(16),ne=0;ne<ee.length;ne+=16)n(ee,ie,0,ne,ne+16),ie=this._aes.encrypt(ie),n(ie,oe,ne);return oe},q.prototype.decrypt=function(ee){if(ee=r(ee),ee.length%16!==0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var oe=s(ee.length),ie=s(16),ne=0;ne<ee.length;ne+=16)n(ee,ie,0,ne,ne+16),ie=this._aes.decrypt(ie),n(ie,oe,ne);return oe};var W=function(ee,oe){if(!(this instanceof W))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Block Chaining",this.name="cbc",!oe)oe=s(16);else if(oe.length!=16)throw new Error("invalid initialation vector size (must be 16 bytes)");this._lastCipherblock=r(oe,!0),this._aes=new $(ee)};W.prototype.encrypt=function(ee){if(ee=r(ee),ee.length%16!==0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var oe=s(ee.length),ie=s(16),ne=0;ne<ee.length;ne+=16){n(ee,ie,0,ne,ne+16);for(var me=0;me<16;me++)ie[me]^=this._lastCipherblock[me];this._lastCipherblock=this._aes.encrypt(ie),n(this._lastCipherblock,oe,ne)}return oe},W.prototype.decrypt=function(ee){if(ee=r(ee),ee.length%16!==0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var oe=s(ee.length),ie=s(16),ne=0;ne<ee.length;ne+=16){n(ee,ie,0,ne,ne+16),ie=this._aes.decrypt(ie);for(var me=0;me<16;me++)oe[ne+me]=ie[me]^this._lastCipherblock[me];n(ee,this._lastCipherblock,0,ne,ne+16)}return oe};var Z=function(ee,oe,ie){if(!(this instanceof Z))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Feedback",this.name="cfb",!oe)oe=s(16);else if(oe.length!=16)throw new Error("invalid initialation vector size (must be 16 size)");ie||(ie=1),this.segmentSize=ie,this._shiftRegister=r(oe,!0),this._aes=new $(ee)};Z.prototype.encrypt=function(ee){if(ee.length%this.segmentSize!=0)throw new Error("invalid plaintext size (must be segmentSize bytes)");for(var oe=r(ee,!0),ie,ne=0;ne<oe.length;ne+=this.segmentSize){ie=this._aes.encrypt(this._shiftRegister);for(var me=0;me<this.segmentSize;me++)oe[ne+me]^=ie[me];n(this._shiftRegister,this._shiftRegister,0,this.segmentSize),n(oe,this._shiftRegister,16-this.segmentSize,ne,ne+this.segmentSize)}return oe},Z.prototype.decrypt=function(ee){if(ee.length%this.segmentSize!=0)throw new Error("invalid ciphertext size (must be segmentSize bytes)");for(var oe=r(ee,!0),ie,ne=0;ne<oe.length;ne+=this.segmentSize){ie=this._aes.encrypt(this._shiftRegister);for(var me=0;me<this.segmentSize;me++)oe[ne+me]^=ie[me];n(this._shiftRegister,this._shiftRegister,0,this.segmentSize),n(ee,this._shiftRegister,16-this.segmentSize,ne,ne+this.segmentSize)}return oe};var Q=function(ee,oe){if(!(this instanceof Q))throw Error("AES must be instanitated with `new`");if(this.description="Output Feedback",this.name="ofb",!oe)oe=s(16);else if(oe.length!=16)throw new Error("invalid initialation vector size (must be 16 bytes)");this._lastPrecipher=r(oe,!0),this._lastPrecipherIndex=16,this._aes=new $(ee)};Q.prototype.encrypt=function(ee){for(var oe=r(ee,!0),ie=0;ie<oe.length;ie++)this._lastPrecipherIndex===16&&(this._lastPrecipher=this._aes.encrypt(this._lastPrecipher),this._lastPrecipherIndex=0),oe[ie]^=this._lastPrecipher[this._lastPrecipherIndex++];return oe},Q.prototype.decrypt=Q.prototype.encrypt;var X=function(ee){if(!(this instanceof X))throw Error("Counter must be instanitated with `new`");ee!==0&&!ee&&(ee=1),typeof ee=="number"?(this._counter=s(16),this.setValue(ee)):this.setBytes(ee)};X.prototype.setValue=function(ee){if(typeof ee!="number"||parseInt(ee)!=ee)throw new Error("invalid counter value (must be an integer)");if(ee>Number.MAX_SAFE_INTEGER)throw new Error("integer value out of safe range");for(var oe=15;oe>=0;--oe)this._counter[oe]=ee%256,ee=parseInt(ee/256)},X.prototype.setBytes=function(ee){if(ee=r(ee,!0),ee.length!=16)throw new Error("invalid counter bytes size (must be 16 bytes)");this._counter=ee},X.prototype.increment=function(){for(var ee=15;ee>=0;ee--)if(this._counter[ee]===255)this._counter[ee]=0;else{this._counter[ee]++;break}};var ce=function(ee,oe){if(!(this instanceof ce))throw Error("AES must be instanitated with `new`");this.description="Counter",this.name="ctr",oe instanceof X||(oe=new X(oe)),this._counter=oe,this._remainingCounter=null,this._remainingCounterIndex=16,this._aes=new $(ee)};ce.prototype.encrypt=function(ee){for(var oe=r(ee,!0),ie=0;ie<oe.length;ie++)this._remainingCounterIndex===16&&(this._remainingCounter=this._aes.encrypt(this._counter._counter),this._remainingCounterIndex=0,this._counter.increment()),oe[ie]^=this._remainingCounter[this._remainingCounterIndex++];return oe},ce.prototype.decrypt=ce.prototype.encrypt;function de(ee){ee=r(ee,!0);var oe=16-ee.length%16,ie=s(ee.length+oe);n(ee,ie);for(var ne=ee.length;ne<ie.length;ne++)ie[ne]=oe;return ie}function le(ee){if(ee=r(ee,!0),ee.length<16)throw new Error("PKCS#7 invalid length");var oe=ee[ee.length-1];if(oe>16)throw new Error("PKCS#7 padding byte out of range");for(var ie=ee.length-oe,ne=0;ne<oe;ne++)if(ee[ie+ne]!==oe)throw new Error("PKCS#7 invalid padding byte");var me=s(ie);return n(ee,me,0,0,ie),me}var te={AES:$,Counter:X,ModeOfOperation:{ecb:q,cbc:W,cfb:Z,ofb:Q,ctr:ce},utils:{hex:a,utf8:o},padding:{pkcs7:{pad:de,strip:le}},_arrayTest:{coerceArray:r,createArray:s,copyArray:n}};typeof lb<"u"?wI.exports=te:typeof define=="function"&&define.amd?define([],function(){return te}):(t.aesjs&&(te._aesjs=t.aesjs),t.aesjs=te)})(lb)});var _9=Ui(y9=>{y9.remove=AG;var g9=[{base:" ",chars:"\xA0"},{base:"0",chars:"\u07C0"},{base:"A",chars:"\u24B6\uFF21\xC0\xC1\xC2\u1EA6\u1EA4\u1EAA\u1EA8\xC3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\xC4\u01DE\u1EA2\xC5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F"},{base:"AA",chars:"\uA732"},{base:"AE",chars:"\xC6\u01FC\u01E2"},{base:"AO",chars:"\uA734"},{base:"AU",chars:"\uA736"},{base:"AV",chars:"\uA738\uA73A"},{base:"AY",chars:"\uA73C"},{base:"B",chars:"\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0181"},{base:"C",chars:"\u24B8\uFF23\uA73E\u1E08\u0106C\u0108\u010A\u010C\xC7\u0187\u023B"},{base:"D",chars:"\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018A\u0189\u1D05\uA779"},{base:"Dh",chars:"\xD0"},{base:"DZ",chars:"\u01F1\u01C4"},{base:"Dz",chars:"\u01F2\u01C5"},{base:"E",chars:"\u025B\u24BA\uFF25\xC8\xC9\xCA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\xCB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E\u1D07"},{base:"F",chars:"\uA77C\u24BB\uFF26\u1E1E\u0191\uA77B"},{base:"G",chars:"\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E\u0262"},{base:"H",chars:"\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D"},{base:"I",chars:"\u24BE\uFF29\xCC\xCD\xCE\u0128\u012A\u012C\u0130\xCF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197"},{base:"J",chars:"\u24BF\uFF2A\u0134\u0248\u0237"},{base:"K",chars:"\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2"},{base:"L",chars:"\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780"},{base:"LJ",chars:"\u01C7"},{base:"Lj",chars:"\u01C8"},{base:"M",chars:"\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C\u03FB"},{base:"N",chars:"\uA7A4\u0220\u24C3\uFF2E\u01F8\u0143\xD1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u019D\uA790\u1D0E"},{base:"NJ",chars:"\u01CA"},{base:"Nj",chars:"\u01CB"},{base:"O",chars:"\u24C4\uFF2F\xD2\xD3\xD4\u1ED2\u1ED0\u1ED6\u1ED4\xD5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\xD6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\xD8\u01FE\u0186\u019F\uA74A\uA74C"},{base:"OE",chars:"\u0152"},{base:"OI",chars:"\u01A2"},{base:"OO",chars:"\uA74E"},{base:"OU",chars:"\u0222"},{base:"P",chars:"\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754"},{base:"Q",chars:"\u24C6\uFF31\uA756\uA758\u024A"},{base:"R",chars:"\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782"},{base:"S",chars:"\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784"},{base:"T",chars:"\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786"},{base:"Th",chars:"\xDE"},{base:"TZ",chars:"\uA728"},{base:"U",chars:"\u24CA\uFF35\xD9\xDA\xDB\u0168\u1E78\u016A\u1E7A\u016C\xDC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244"},{base:"V",chars:"\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245"},{base:"VY",chars:"\uA760"},{base:"W",chars:"\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72"},{base:"X",chars:"\u24CD\uFF38\u1E8A\u1E8C"},{base:"Y",chars:"\u24CE\uFF39\u1EF2\xDD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE"},{base:"Z",chars:"\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762"},{base:"a",chars:"\u24D0\uFF41\u1E9A\xE0\xE1\xE2\u1EA7\u1EA5\u1EAB\u1EA9\xE3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\xE4\u01DF\u1EA3\xE5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250\u0251"},{base:"aa",chars:"\uA733"},{base:"ae",chars:"\xE6\u01FD\u01E3"},{base:"ao",chars:"\uA735"},{base:"au",chars:"\uA737"},{base:"av",chars:"\uA739\uA73B"},{base:"ay",chars:"\uA73D"},{base:"b",chars:"\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253\u0182"},{base:"c",chars:"\uFF43\u24D2\u0107\u0109\u010B\u010D\xE7\u1E09\u0188\u023C\uA73F\u2184"},{base:"d",chars:"\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\u018B\u13E7\u0501\uA7AA"},{base:"dh",chars:"\xF0"},{base:"dz",chars:"\u01F3\u01C6"},{base:"e",chars:"\u24D4\uFF45\xE8\xE9\xEA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\xEB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u01DD"},{base:"f",chars:"\u24D5\uFF46\u1E1F\u0192"},{base:"ff",chars:"\uFB00"},{base:"fi",chars:"\uFB01"},{base:"fl",chars:"\uFB02"},{base:"ffi",chars:"\uFB03"},{base:"ffl",chars:"\uFB04"},{base:"g",chars:"\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\uA77F\u1D79"},{base:"h",chars:"\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265"},{base:"hv",chars:"\u0195"},{base:"i",chars:"\u24D8\uFF49\xEC\xED\xEE\u0129\u012B\u012D\xEF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131"},{base:"j",chars:"\u24D9\uFF4A\u0135\u01F0\u0249"},{base:"k",chars:"\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3"},{base:"l",chars:"\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747\u026D"},{base:"lj",chars:"\u01C9"},{base:"m",chars:"\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F"},{base:"n",chars:"\u24DD\uFF4E\u01F9\u0144\xF1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5\u043B\u0509"},{base:"nj",chars:"\u01CC"},{base:"o",chars:"\u24DE\uFF4F\xF2\xF3\xF4\u1ED3\u1ED1\u1ED7\u1ED5\xF5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\xF6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\xF8\u01FF\uA74B\uA74D\u0275\u0254\u1D11"},{base:"oe",chars:"\u0153"},{base:"oi",chars:"\u01A3"},{base:"oo",chars:"\uA74F"},{base:"ou",chars:"\u0223"},{base:"p",chars:"\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755\u03C1"},{base:"q",chars:"\u24E0\uFF51\u024B\uA757\uA759"},{base:"r",chars:"\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783"},{base:"s",chars:"\u24E2\uFF53\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B\u0282"},{base:"ss",chars:"\xDF"},{base:"t",chars:"\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787"},{base:"th",chars:"\xFE"},{base:"tz",chars:"\uA729"},{base:"u",chars:"\u24E4\uFF55\xF9\xFA\xFB\u0169\u1E79\u016B\u1E7B\u016D\xFC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289"},{base:"v",chars:"\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C"},{base:"vy",chars:"\uA761"},{base:"w",chars:"\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73"},{base:"x",chars:"\u24E7\uFF58\u1E8B\u1E8D"},{base:"y",chars:"\u24E8\uFF59\u1EF3\xFD\u0177\u1EF9\u0233\u1E8F\xFF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF"},{base:"z",chars:"\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763"}],ub={};for(u3=0;u3<g9.length;u3+=1)for(cb=g9[u3].chars,m9=0;m9<cb.length;m9+=1)ub[cb[m9]]=g9[u3].base;var cb,m9,u3;function AG(t){return t.replace(/[^\u0000-\u007e]/g,function(e){return ub[e]||e})}y9.replacementList=g9;y9.diacriticsMap=ub});var lw=Ui((Zle,aw)=>{"use strict";var gV=Object.prototype.hasOwnProperty,Vo="~";function Z3(){}Object.create&&(Z3.prototype=Object.create(null),new Z3().__proto__||(Vo=!1));function yV(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function dP(t,e,i,r,s){if(typeof i!="function")throw new TypeError("The listener must be a function");var n=new yV(i,r||t,s),o=Vo?Vo+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],n]:t._events[o].push(n):(t._events[o]=n,t._eventsCount++),t}function C8(t,e){--t._eventsCount===0?t._events=new Z3:delete t._events[e]}function mo(){this._events=new Z3,this._eventsCount=0}mo.prototype.eventNames=function(){var e=[],i,r;if(this._eventsCount===0)return e;for(r in i=this._events)gV.call(i,r)&&e.push(Vo?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(i)):e};mo.prototype.listeners=function(e){var i=Vo?Vo+e:e,r=this._events[i];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,n=r.length,o=new Array(n);s<n;s++)o[s]=r[s].fn;return o};mo.prototype.listenerCount=function(e){var i=Vo?Vo+e:e,r=this._events[i];return r?r.fn?1:r.length:0};mo.prototype.emit=function(e,i,r,s,n,o){var a=Vo?Vo+e:e;if(!this._events[a])return!1;var l=this._events[a],u=arguments.length,d,m;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,i),!0;case 3:return l.fn.call(l.context,i,r),!0;case 4:return l.fn.call(l.context,i,r,s),!0;case 5:return l.fn.call(l.context,i,r,s,n),!0;case 6:return l.fn.call(l.context,i,r,s,n,o),!0}for(m=1,d=new Array(u-1);m<u;m++)d[m-1]=arguments[m];l.fn.apply(l.context,d)}else{var g=l.length,_;for(m=0;m<g;m++)switch(l[m].once&&this.removeListener(e,l[m].fn,void 0,!0),u){case 1:l[m].fn.call(l[m].context);break;case 2:l[m].fn.call(l[m].context,i);break;case 3:l[m].fn.call(l[m].context,i,r);break;case 4:l[m].fn.call(l[m].context,i,r,s);break;default:if(!d)for(_=1,d=new Array(u-1);_<u;_++)d[_-1]=arguments[_];l[m].fn.apply(l[m].context,d)}}return!0};mo.prototype.on=function(e,i,r){return dP(this,e,i,r,!1)};mo.prototype.once=function(e,i,r){return dP(this,e,i,r,!0)};mo.prototype.removeListener=function(e,i,r,s){var n=Vo?Vo+e:e;if(!this._events[n])return this;if(!i)return C8(this,n),this;var o=this._events[n];if(o.fn)o.fn===i&&(!s||o.once)&&(!r||o.context===r)&&C8(this,n);else{for(var a=0,l=[],u=o.length;a<u;a++)(o[a].fn!==i||s&&!o[a].once||r&&o[a].context!==r)&&l.push(o[a]);l.length?this._events[n]=l.length===1?l[0]:l:C8(this,n)}return this};mo.prototype.removeAllListeners=function(e){var i;return e?(i=Vo?Vo+e:e,this._events[i]&&C8(this,i)):(this._events=new Z3,this._eventsCount=0),this};mo.prototype.off=mo.prototype.removeListener;mo.prototype.addListener=mo.prototype.on;mo.prefixed=Vo;mo.EventEmitter=mo;typeof aw<"u"&&(aw.exports=mo)});var fw=Ui((Qle,dw)=>{"use strict";dw.exports=M8;dw.exports.default=M8;function M8(t,e,i){i=i||2;var r=e&&e.length,s=r?e[0]*i:t.length,n=pP(t,0,s,i,!0),o=[];if(!n||n.next===n.prev)return o;var a,l,u,d,m,g,_;if(r&&(n=wV(t,e,n,i)),t.length>80*i){a=u=t[0],l=d=t[1];for(var v=i;v<s;v+=i)m=t[v],g=t[v+1],m<a&&(a=m),g<l&&(l=g),m>u&&(u=m),g>d&&(d=g);_=Math.max(u-a,d-l),_=_!==0?32767/_:0}return Q3(n,o,i,a,l,_,0),o}function pP(t,e,i,r,s){var n,o;if(s===hw(t,e,i,r)>0)for(n=e;n<i;n+=r)o=fP(n,t[n],t[n+1],o);else for(n=i-r;n>=e;n-=r)o=fP(n,t[n],t[n+1],o);return o&&P8(o,o.next)&&(J3(o),o=o.next),o}function dd(t,e){if(!t)return t;e||(e=t);var i=t,r;do if(r=!1,!i.steiner&&(P8(i,i.next)||Bs(i.prev,i,i.next)===0)){if(J3(i),i=e=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==e);return e}function Q3(t,e,i,r,s,n,o){if(t){!o&&n&&CV(t,r,s,n);for(var a=t,l,u;t.prev!==t.next;){if(l=t.prev,u=t.next,n?xV(t,r,s,n):_V(t)){e.push(l.i/i|0),e.push(t.i/i|0),e.push(u.i/i|0),J3(t),t=u.next,a=u.next;continue}if(t=u,t===a){o?o===1?(t=vV(dd(t),e,i),Q3(t,e,i,r,s,n,2)):o===2&&bV(t,e,i,r,s,n):Q3(dd(t),e,i,r,s,n,1);break}}}}function _V(t){var e=t.prev,i=t,r=t.next;if(Bs(e,i,r)>=0)return!1;for(var s=e.x,n=i.x,o=r.x,a=e.y,l=i.y,u=r.y,d=s<n?s<o?s:o:n<o?n:o,m=a<l?a<u?a:u:l<u?l:u,g=s>n?s>o?s:o:n>o?n:o,_=a>l?a>u?a:u:l>u?l:u,v=r.next;v!==e;){if(v.x>=d&&v.x<=g&&v.y>=m&&v.y<=_&&zf(s,a,n,l,o,u,v.x,v.y)&&Bs(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function xV(t,e,i,r){var s=t.prev,n=t,o=t.next;if(Bs(s,n,o)>=0)return!1;for(var a=s.x,l=n.x,u=o.x,d=s.y,m=n.y,g=o.y,_=a<l?a<u?a:u:l<u?l:u,v=d<m?d<g?d:g:m<g?m:g,E=a>l?a>u?a:u:l>u?l:u,b=d>m?d>g?d:g:m>g?m:g,T=cw(_,v,e,i,r),A=cw(E,b,e,i,r),M=t.prevZ,k=t.nextZ;M&&M.z>=T&&k&&k.z<=A;){if(M.x>=_&&M.x<=E&&M.y>=v&&M.y<=b&&M!==s&&M!==o&&zf(a,d,l,m,u,g,M.x,M.y)&&Bs(M.prev,M,M.next)>=0||(M=M.prevZ,k.x>=_&&k.x<=E&&k.y>=v&&k.y<=b&&k!==s&&k!==o&&zf(a,d,l,m,u,g,k.x,k.y)&&Bs(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;M&&M.z>=T;){if(M.x>=_&&M.x<=E&&M.y>=v&&M.y<=b&&M!==s&&M!==o&&zf(a,d,l,m,u,g,M.x,M.y)&&Bs(M.prev,M,M.next)>=0)return!1;M=M.prevZ}for(;k&&k.z<=A;){if(k.x>=_&&k.x<=E&&k.y>=v&&k.y<=b&&k!==s&&k!==o&&zf(a,d,l,m,u,g,k.x,k.y)&&Bs(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function vV(t,e,i){var r=t;do{var s=r.prev,n=r.next.next;!P8(s,n)&&mP(s,r,r.next,n)&&K3(s,n)&&K3(n,s)&&(e.push(s.i/i|0),e.push(r.i/i|0),e.push(n.i/i|0),J3(r),J3(r.next),r=t=n),r=r.next}while(r!==t);return dd(r)}function bV(t,e,i,r,s,n){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&MV(o,a)){var l=gP(o,a);o=dd(o,o.next),l=dd(l,l.next),Q3(o,e,i,r,s,n,0),Q3(l,e,i,r,s,n,0);return}a=a.next}o=o.next}while(o!==t)}function wV(t,e,i,r){var s=[],n,o,a,l,u;for(n=0,o=e.length;n<o;n++)a=e[n]*r,l=n<o-1?e[n+1]*r:t.length,u=pP(t,a,l,r,!1),u===u.next&&(u.steiner=!0),s.push(kV(u));for(s.sort(EV),n=0;n<s.length;n++)i=TV(s[n],i);return i}function EV(t,e){return t.x-e.x}function TV(t,e){var i=SV(t,e);if(!i)return e;var r=gP(i,t);return dd(r,r.next),dd(i,i.next)}function SV(t,e){var i=e,r=t.x,s=t.y,n=-1/0,o;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var a=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>n&&(n=a,o=i.x<i.next.x?i:i.next,a===r))return o}i=i.next}while(i!==e);if(!o)return null;var l=o,u=o.x,d=o.y,m=1/0,g;i=o;do r>=i.x&&i.x>=u&&r!==i.x&&zf(s<d?r:n,s,u,d,s<d?n:r,s,i.x,i.y)&&(g=Math.abs(s-i.y)/(r-i.x),K3(i,t)&&(g<m||g===m&&(i.x>o.x||i.x===o.x&&AV(o,i)))&&(o=i,m=g)),i=i.next;while(i!==l);return o}function AV(t,e){return Bs(t.prev,t,e.prev)<0&&Bs(e.next,t,t.next)<0}function CV(t,e,i,r){var s=t;do s.z===0&&(s.z=cw(s.x,s.y,e,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,IV(s)}function IV(t){var e,i,r,s,n,o,a,l,u=1;do{for(i=t,t=null,n=null,o=0;i;){for(o++,r=i,a=0,e=0;e<u&&(a++,r=r.nextZ,!!r);e++);for(l=u;a>0||l>0&&r;)a!==0&&(l===0||!r||i.z<=r.z)?(s=i,i=i.nextZ,a--):(s=r,r=r.nextZ,l--),n?n.nextZ=s:t=s,s.prevZ=n,n=s;i=r}n.nextZ=null,u*=2}while(o>1);return t}function cw(t,e,i,r,s){return t=(t-i)*s|0,e=(e-r)*s|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function kV(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function zf(t,e,i,r,s,n,o,a){return(s-o)*(e-a)>=(t-o)*(n-a)&&(t-o)*(r-a)>=(i-o)*(e-a)&&(i-o)*(n-a)>=(s-o)*(r-a)}function MV(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!PV(t,e)&&(K3(t,e)&&K3(e,t)&&RV(t,e)&&(Bs(t.prev,t,e.prev)||Bs(t,e.prev,e))||P8(t,e)&&Bs(t.prev,t,t.next)>0&&Bs(e.prev,e,e.next)>0)}function Bs(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function P8(t,e){return t.x===e.x&&t.y===e.y}function mP(t,e,i,r){var s=k8(Bs(t,e,i)),n=k8(Bs(t,e,r)),o=k8(Bs(i,r,t)),a=k8(Bs(i,r,e));return!!(s!==n&&o!==a||s===0&&I8(t,i,e)||n===0&&I8(t,r,e)||o===0&&I8(i,t,r)||a===0&&I8(i,e,r))}function I8(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function k8(t){return t>0?1:t<0?-1:0}function PV(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&mP(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function K3(t,e){return Bs(t.prev,t,t.next)<0?Bs(t,e,t.next)>=0&&Bs(t,t.prev,e)>=0:Bs(t,e,t.prev)<0||Bs(t,t.next,e)<0}function RV(t,e){var i=t,r=!1,s=(t.x+e.x)/2,n=(t.y+e.y)/2;do i.y>n!=i.next.y>n&&i.next.y!==i.y&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function gP(t,e){var i=new uw(t.i,t.x,t.y),r=new uw(e.i,e.x,e.y),s=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function fP(t,e,i,r){var s=new uw(t,e,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function J3(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function uw(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}M8.deviation=function(t,e,i,r){var s=e&&e.length,n=s?e[0]*i:t.length,o=Math.abs(hw(t,0,n,i));if(s)for(var a=0,l=e.length;a<l;a++){var u=e[a]*i,d=a<l-1?e[a+1]*i:t.length;o-=Math.abs(hw(t,u,d,i))}var m=0;for(a=0;a<r.length;a+=3){var g=r[a]*i,_=r[a+1]*i,v=r[a+2]*i;m+=Math.abs((t[g]-t[v])*(t[_+1]-t[g+1])-(t[g]-t[_])*(t[v+1]-t[g+1]))}return o===0&&m===0?0:Math.abs((m-o)/o)};function hw(t,e,i,r){for(var s=0,n=e,o=i-r;n<i;n+=r)s+=(t[o]-t[n])*(t[n+1]+t[o+1]),o=n;return s}M8.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,s=0;s<t.length;s++){for(var n=0;n<t[s].length;n++)for(var o=0;o<e;o++)i.vertices.push(t[s][n][o]);s>0&&(r+=t[s-1].length,i.holes.push(r))}return i}});var yP=Ui((Gf,$f)=>{(function(t){var e=typeof Gf=="object"&&Gf&&!Gf.nodeType&&Gf,i=typeof $f=="object"&&$f&&!$f.nodeType&&$f,r=typeof global=="object"&&global;(r.global===r||r.window===r||r.self===r)&&(t=r);var s,n=2147483647,o=36,a=1,l=26,u=38,d=700,m=72,g=128,_="-",v=/^xn--/,E=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,T={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},A=o-a,M=Math.floor,k=String.fromCharCode,F;function O(te){throw RangeError(T[te])}function B(te,ee){for(var oe=te.length,ie=[];oe--;)ie[oe]=ee(te[oe]);return ie}function U(te,ee){var oe=te.split("@"),ie="";oe.length>1&&(ie=oe[0]+"@",te=oe[1]),te=te.replace(b,".");var ne=te.split("."),me=B(ne,ee).join(".");return ie+me}function $(te){for(var ee=[],oe=0,ie=te.length,ne,me;oe<ie;)ne=te.charCodeAt(oe++),ne>=55296&&ne<=56319&&oe<ie?(me=te.charCodeAt(oe++),(me&64512)==56320?ee.push(((ne&1023)<<10)+(me&1023)+65536):(ee.push(ne),oe--)):ee.push(ne);return ee}function q(te){return B(te,function(ee){var oe="";return ee>65535&&(ee-=65536,oe+=k(ee>>>10&1023|55296),ee=56320|ee&1023),oe+=k(ee),oe}).join("")}function W(te){return te-48<10?te-22:te-65<26?te-65:te-97<26?te-97:o}function Z(te,ee){return te+22+75*(te<26)-((ee!=0)<<5)}function Q(te,ee,oe){var ie=0;for(te=oe?M(te/d):te>>1,te+=M(te/ee);te>A*l>>1;ie+=o)te=M(te/A);return M(ie+(A+1)*te/(te+u))}function X(te){var ee=[],oe=te.length,ie,ne=0,me=g,De=m,He,Je,ot,gt,vt,ct,Se,Qe,xt;for(He=te.lastIndexOf(_),He<0&&(He=0),Je=0;Je<He;++Je)te.charCodeAt(Je)>=128&&O("not-basic"),ee.push(te.charCodeAt(Je));for(ot=He>0?He+1:0;ot<oe;){for(gt=ne,vt=1,ct=o;ot>=oe&&O("invalid-input"),Se=W(te.charCodeAt(ot++)),(Se>=o||Se>M((n-ne)/vt))&&O("overflow"),ne+=Se*vt,Qe=ct<=De?a:ct>=De+l?l:ct-De,!(Se<Qe);ct+=o)xt=o-Qe,vt>M(n/xt)&&O("overflow"),vt*=xt;ie=ee.length+1,De=Q(ne-gt,ie,gt==0),M(ne/ie)>n-me&&O("overflow"),me+=M(ne/ie),ne%=ie,ee.splice(ne++,0,me)}return q(ee)}function ce(te){var ee,oe,ie,ne,me,De,He,Je,ot,gt,vt,ct=[],Se,Qe,xt,It;for(te=$(te),Se=te.length,ee=g,oe=0,me=m,De=0;De<Se;++De)vt=te[De],vt<128&&ct.push(k(vt));for(ie=ne=ct.length,ne&&ct.push(_);ie<Se;){for(He=n,De=0;De<Se;++De)vt=te[De],vt>=ee&&vt<He&&(He=vt);for(Qe=ie+1,He-ee>M((n-oe)/Qe)&&O("overflow"),oe+=(He-ee)*Qe,ee=He,De=0;De<Se;++De)if(vt=te[De],vt<ee&&++oe>n&&O("overflow"),vt==ee){for(Je=oe,ot=o;gt=ot<=me?a:ot>=me+l?l:ot-me,!(Je<gt);ot+=o)It=Je-gt,xt=o-gt,ct.push(k(Z(gt+It%xt,0))),Je=M(It/xt);ct.push(k(Z(Je,0))),me=Q(oe,Qe,ie==ne),oe=0,++ie}++oe,++ee}return ct.join("")}function de(te){return U(te,function(ee){return v.test(ee)?X(ee.slice(4).toLowerCase()):ee})}function le(te){return U(te,function(ee){return E.test(ee)?"xn--"+ce(ee):ee})}if(s={version:"1.3.2",ucs2:{decode:$,encode:q},decode:X,encode:ce,toASCII:le,toUnicode:de},typeof define=="function"&&typeof define.amd=="object"&&define.amd)define("punycode",function(){return s});else if(e&&i)if($f.exports==e)i.exports=s;else for(F in s)s.hasOwnProperty(F)&&(e[F]=s[F]);else t.punycode=s})(Gf)});var xP=Ui((Kle,_P)=>{"use strict";_P.exports={isString:function(t){return typeof t=="string"},isObject:function(t){return typeof t=="object"&&t!==null},isNull:function(t){return t===null},isNullOrUndefined:function(t){return t==null}}});var bP=Ui((Jle,vP)=>{"use strict";function DV(t,e){return Object.prototype.hasOwnProperty.call(t,e)}vP.exports=function(t,e,i,r){e=e||"&",i=i||"=";var s={};if(typeof t!="string"||t.length===0)return s;var n=/\+/g;t=t.split(e);var o=1e3;r&&typeof r.maxKeys=="number"&&(o=r.maxKeys);var a=t.length;o>0&&a>o&&(a=o);for(var l=0;l<a;++l){var u=t[l].replace(n,"%20"),d=u.indexOf(i),m,g,_,v;d>=0?(m=u.substr(0,d),g=u.substr(d+1)):(m=u,g=""),_=decodeURIComponent(m),v=decodeURIComponent(g),DV(s,_)?Array.isArray(s[_])?s[_].push(v):s[_]=[s[_],v]:s[_]=v}return s}});var EP=Ui((ece,wP)=>{"use strict";var e5=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};wP.exports=function(t,e,i,r){return e=e||"&",i=i||"=",t===null&&(t=void 0),typeof t=="object"?Object.keys(t).map(function(s){var n=encodeURIComponent(e5(s))+i;return Array.isArray(t[s])?t[s].map(function(o){return n+encodeURIComponent(e5(o))}).join(e):n+encodeURIComponent(e5(t[s]))}).join(e):r?encodeURIComponent(e5(r))+i+encodeURIComponent(e5(t)):""}});var TP=Ui(t5=>{"use strict";t5.decode=t5.parse=bP();t5.encode=t5.stringify=EP()});var yw=Ui(Vf=>{"use strict";var FV=yP(),Mc=xP();Vf.parse=i5;Vf.resolve=VV;Vf.resolveObject=jV;Vf.format=HV;Vf.Url=vl;function vl(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var LV=/^([a-z0-9.+-]+:)/i,NV=/:[0-9]*$/,OV=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,BV=["<",">",'"',"`"," ","\r",`
`,"	"],UV=["{","}","|","\\","^","`"].concat(BV),pw=["'"].concat(UV),SP=["%","/","?",";","#"].concat(pw),AP=["/","?","#"],zV=255,CP=/^[+a-z0-9A-Z_-]{0,63}$/,GV=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,$V={javascript:!0,"javascript:":!0},mw={javascript:!0,"javascript:":!0},Hf={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},gw=TP();function i5(t,e,i){if(t&&Mc.isObject(t)&&t instanceof vl)return t;var r=new vl;return r.parse(t,e,i),r}vl.prototype.parse=function(t,e,i){if(!Mc.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t.indexOf("?"),s=r!==-1&&r<t.indexOf("#")?"?":"#",n=t.split(s),o=/\\/g;n[0]=n[0].replace(o,"/"),t=n.join(s);var a=t;if(a=a.trim(),!i&&t.split("#").length===1){var l=OV.exec(a);if(l)return this.path=a,this.href=a,this.pathname=l[1],l[2]?(this.search=l[2],e?this.query=gw.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var u=LV.exec(a);if(u){u=u[0];var d=u.toLowerCase();this.protocol=d,a=a.substr(u.length)}if(i||u||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var m=a.substr(0,2)==="//";m&&!(u&&mw[u])&&(a=a.substr(2),this.slashes=!0)}if(!mw[u]&&(m||u&&!Hf[u])){for(var g=-1,_=0;_<AP.length;_++){var v=a.indexOf(AP[_]);v!==-1&&(g===-1||v<g)&&(g=v)}var E,b;g===-1?b=a.lastIndexOf("@"):b=a.lastIndexOf("@",g),b!==-1&&(E=a.slice(0,b),a=a.slice(b+1),this.auth=decodeURIComponent(E)),g=-1;for(var _=0;_<SP.length;_++){var v=a.indexOf(SP[_]);v!==-1&&(g===-1||v<g)&&(g=v)}g===-1&&(g=a.length),this.host=a.slice(0,g),a=a.slice(g),this.parseHost(),this.hostname=this.hostname||"";var T=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!T)for(var A=this.hostname.split(/\./),_=0,M=A.length;_<M;_++){var k=A[_];if(k&&!k.match(CP)){for(var F="",O=0,B=k.length;O<B;O++)k.charCodeAt(O)>127?F+="x":F+=k[O];if(!F.match(CP)){var U=A.slice(0,_),$=A.slice(_+1),q=k.match(GV);q&&(U.push(q[1]),$.unshift(q[2])),$.length&&(a="/"+$.join(".")+a),this.hostname=U.join(".");break}}}this.hostname.length>zV?this.hostname="":this.hostname=this.hostname.toLowerCase(),T||(this.hostname=FV.toASCII(this.hostname));var W=this.port?":"+this.port:"",Z=this.hostname||"";this.host=Z+W,this.href+=this.host,T&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!$V[d])for(var _=0,M=pw.length;_<M;_++){var Q=pw[_];if(a.indexOf(Q)!==-1){var X=encodeURIComponent(Q);X===Q&&(X=escape(Q)),a=a.split(Q).join(X)}}var ce=a.indexOf("#");ce!==-1&&(this.hash=a.substr(ce),a=a.slice(0,ce));var de=a.indexOf("?");if(de!==-1?(this.search=a.substr(de),this.query=a.substr(de+1),e&&(this.query=gw.parse(this.query)),a=a.slice(0,de)):e&&(this.search="",this.query={}),a&&(this.pathname=a),Hf[d]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var W=this.pathname||"",le=this.search||"";this.path=W+le}return this.href=this.format(),this};function HV(t){return Mc.isString(t)&&(t=i5(t)),t instanceof vl?t.format():vl.prototype.format.call(t)}vl.prototype.format=function(){var t=this.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",r=this.hash||"",s=!1,n="";this.host?s=t+this.host:this.hostname&&(s=t+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&Mc.isObject(this.query)&&Object.keys(this.query).length&&(n=gw.stringify(this.query));var o=this.search||n&&"?"+n||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||Hf[e])&&s!==!1?(s="//"+(s||""),i&&i.charAt(0)!=="/"&&(i="/"+i)):s||(s=""),r&&r.charAt(0)!=="#"&&(r="#"+r),o&&o.charAt(0)!=="?"&&(o="?"+o),i=i.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),e+s+i+o+r};function VV(t,e){return i5(t,!1,!0).resolve(e)}vl.prototype.resolve=function(t){return this.resolveObject(i5(t,!1,!0)).format()};function jV(t,e){return t?i5(t,!1,!0).resolveObject(e):e}vl.prototype.resolveObject=function(t){if(Mc.isString(t)){var e=new vl;e.parse(t,!1,!0),t=e}for(var i=new vl,r=Object.keys(this),s=0;s<r.length;s++){var n=r[s];i[n]=this[n]}if(i.hash=t.hash,t.href==="")return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var o=Object.keys(t),a=0;a<o.length;a++){var l=o[a];l!=="protocol"&&(i[l]=t[l])}return Hf[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!Hf[t.protocol]){for(var u=Object.keys(t),d=0;d<u.length;d++){var m=u[d];i[m]=t[m]}return i.href=i.format(),i}if(i.protocol=t.protocol,!t.host&&!mw[t.protocol]){for(var M=(t.pathname||"").split("/");M.length&&!(t.host=M.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),M[0]!==""&&M.unshift(""),M.length<2&&M.unshift(""),i.pathname=M.join("/")}else i.pathname=t.pathname;if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var g=i.pathname||"",_=i.search||"";i.path=g+_}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var v=i.pathname&&i.pathname.charAt(0)==="/",E=t.host||t.pathname&&t.pathname.charAt(0)==="/",b=E||v||i.host&&t.pathname,T=b,A=i.pathname&&i.pathname.split("/")||[],M=t.pathname&&t.pathname.split("/")||[],k=i.protocol&&!Hf[i.protocol];if(k&&(i.hostname="",i.port=null,i.host&&(A[0]===""?A[0]=i.host:A.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(M[0]===""?M[0]=t.host:M.unshift(t.host)),t.host=null),b=b&&(M[0]===""||A[0]==="")),E)i.host=t.host||t.host===""?t.host:i.host,i.hostname=t.hostname||t.hostname===""?t.hostname:i.hostname,i.search=t.search,i.query=t.query,A=M;else if(M.length)A||(A=[]),A.pop(),A=A.concat(M),i.search=t.search,i.query=t.query;else if(!Mc.isNullOrUndefined(t.search)){if(k){i.hostname=i.host=A.shift();var F=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;F&&(i.auth=F.shift(),i.host=i.hostname=F.shift())}return i.search=t.search,i.query=t.query,(!Mc.isNull(i.pathname)||!Mc.isNull(i.search))&&(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!A.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var O=A.slice(-1)[0],B=(i.host||t.host||A.length>1)&&(O==="."||O==="..")||O==="",U=0,$=A.length;$>=0;$--)O=A[$],O==="."?A.splice($,1):O===".."?(A.splice($,1),U++):U&&(A.splice($,1),U--);if(!b&&!T)for(;U--;U)A.unshift("..");b&&A[0]!==""&&(!A[0]||A[0].charAt(0)!=="/")&&A.unshift(""),B&&A.join("/").substr(-1)!=="/"&&A.push("");var q=A[0]===""||A[0]&&A[0].charAt(0)==="/";if(k){i.hostname=i.host=q?"":A.length?A.shift():"";var F=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;F&&(i.auth=F.shift(),i.host=i.hostname=F.shift())}return b=b||i.host&&A.length,b&&!q&&A.unshift(""),A.length?i.pathname=A.join("/"):(i.pathname=null,i.path=null),(!Mc.isNull(i.pathname)||!Mc.isNull(i.search))&&(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i};vl.prototype.parseHost=function(){var t=this.host,e=NV.exec(t);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}});var $2=Ui((LSe,RD)=>{"use strict";RD.exports=function t(e,i){if(e===i)return!0;if(e&&i&&typeof e=="object"&&typeof i=="object"){if(e.constructor!==i.constructor)return!1;var r,s,n;if(Array.isArray(e)){if(r=e.length,r!=i.length)return!1;for(s=r;s--!==0;)if(!t(e[s],i[s]))return!1;return!0}if(e.constructor===RegExp)return e.source===i.source&&e.flags===i.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===i.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===i.toString();if(n=Object.keys(e),r=n.length,r!==Object.keys(i).length)return!1;for(s=r;s--!==0;)if(!Object.prototype.hasOwnProperty.call(i,n[s]))return!1;for(s=r;s--!==0;){var o=n[s];if(!t(e[o],i[o]))return!1}return!0}return e!==e&&i!==i}});var kl=Ui((OE,BE)=>{(function(t,e){typeof OE=="object"&&typeof BE<"u"?BE.exports=e():typeof define=="function"&&define.amd?define(e):(t=t||self).RBush=e()})(OE,function(){"use strict";function t(b,T,A,M,k){(function F(O,B,U,$,q){for(;$>U;){if($-U>600){var W=$-U+1,Z=B-U+1,Q=Math.log(W),X=.5*Math.exp(2*Q/3),ce=.5*Math.sqrt(Q*X*(W-X)/W)*(Z-W/2<0?-1:1),de=Math.max(U,Math.floor(B-Z*X/W+ce)),le=Math.min($,Math.floor(B+(W-Z)*X/W+ce));F(O,B,de,le,q)}var te=O[B],ee=U,oe=$;for(e(O,U,B),q(O[$],te)>0&&e(O,U,$);ee<oe;){for(e(O,ee,oe),ee++,oe--;q(O[ee],te)<0;)ee++;for(;q(O[oe],te)>0;)oe--}q(O[U],te)===0?e(O,U,oe):e(O,++oe,$),oe<=B&&(U=oe+1),B<=oe&&($=oe-1)}})(b,T,A||0,M||b.length-1,k||i)}function e(b,T,A){var M=b[T];b[T]=b[A],b[A]=M}function i(b,T){return b<T?-1:b>T?1:0}var r=function(b){b===void 0&&(b=9),this._maxEntries=Math.max(4,b),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(b,T,A){if(!A)return T.indexOf(b);for(var M=0;M<T.length;M++)if(A(b,T[M]))return M;return-1}function n(b,T){o(b,0,b.children.length,T,b)}function o(b,T,A,M,k){k||(k=v(null)),k.minX=1/0,k.minY=1/0,k.maxX=-1/0,k.maxY=-1/0;for(var F=T;F<A;F++){var O=b.children[F];a(k,b.leaf?M(O):O)}return k}function a(b,T){return b.minX=Math.min(b.minX,T.minX),b.minY=Math.min(b.minY,T.minY),b.maxX=Math.max(b.maxX,T.maxX),b.maxY=Math.max(b.maxY,T.maxY),b}function l(b,T){return b.minX-T.minX}function u(b,T){return b.minY-T.minY}function d(b){return(b.maxX-b.minX)*(b.maxY-b.minY)}function m(b){return b.maxX-b.minX+(b.maxY-b.minY)}function g(b,T){return b.minX<=T.minX&&b.minY<=T.minY&&T.maxX<=b.maxX&&T.maxY<=b.maxY}function _(b,T){return T.minX<=b.maxX&&T.minY<=b.maxY&&T.maxX>=b.minX&&T.maxY>=b.minY}function v(b){return{children:b,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function E(b,T,A,M,k){for(var F=[T,A];F.length;)if(!((A=F.pop())-(T=F.pop())<=M)){var O=T+Math.ceil((A-T)/M/2)*M;t(b,O,T,A,k),F.push(T,O,O,A)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(b){var T=this.data,A=[];if(!_(b,T))return A;for(var M=this.toBBox,k=[];T;){for(var F=0;F<T.children.length;F++){var O=T.children[F],B=T.leaf?M(O):O;_(b,B)&&(T.leaf?A.push(O):g(b,B)?this._all(O,A):k.push(O))}T=k.pop()}return A},r.prototype.collides=function(b){var T=this.data;if(!_(b,T))return!1;for(var A=[];T;){for(var M=0;M<T.children.length;M++){var k=T.children[M],F=T.leaf?this.toBBox(k):k;if(_(b,F)){if(T.leaf||g(b,F))return!0;A.push(k)}}T=A.pop()}return!1},r.prototype.load=function(b){if(!b||!b.length)return this;if(b.length<this._minEntries){for(var T=0;T<b.length;T++)this.insert(b[T]);return this}var A=this._build(b.slice(),0,b.length-1,0);if(this.data.children.length)if(this.data.height===A.height)this._splitRoot(this.data,A);else{if(this.data.height<A.height){var M=this.data;this.data=A,A=M}this._insert(A,this.data.height-A.height-1,!0)}else this.data=A;return this},r.prototype.insert=function(b){return b&&this._insert(b,this.data.height-1),this},r.prototype.clear=function(){return this.data=v([]),this},r.prototype.remove=function(b,T){if(!b)return this;for(var A,M,k,F=this.data,O=this.toBBox(b),B=[],U=[];F||B.length;){if(F||(F=B.pop(),M=B[B.length-1],A=U.pop(),k=!0),F.leaf){var $=s(b,F.children,T);if($!==-1)return F.children.splice($,1),B.push(F),this._condense(B),this}k||F.leaf||!g(F,O)?M?(A++,F=M.children[A],k=!1):F=null:(B.push(F),U.push(A),A=0,M=F,F=F.children[0])}return this},r.prototype.toBBox=function(b){return b},r.prototype.compareMinX=function(b,T){return b.minX-T.minX},r.prototype.compareMinY=function(b,T){return b.minY-T.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(b){return this.data=b,this},r.prototype._all=function(b,T){for(var A=[];b;)b.leaf?T.push.apply(T,b.children):A.push.apply(A,b.children),b=A.pop();return T},r.prototype._build=function(b,T,A,M){var k,F=A-T+1,O=this._maxEntries;if(F<=O)return n(k=v(b.slice(T,A+1)),this.toBBox),k;M||(M=Math.ceil(Math.log(F)/Math.log(O)),O=Math.ceil(F/Math.pow(O,M-1))),(k=v([])).leaf=!1,k.height=M;var B=Math.ceil(F/O),U=B*Math.ceil(Math.sqrt(O));E(b,T,A,U,this.compareMinX);for(var $=T;$<=A;$+=U){var q=Math.min($+U-1,A);E(b,$,q,B,this.compareMinY);for(var W=$;W<=q;W+=B){var Z=Math.min(W+B-1,q);k.children.push(this._build(b,W,Z,M-1))}}return n(k,this.toBBox),k},r.prototype._chooseSubtree=function(b,T,A,M){for(;M.push(T),!T.leaf&&M.length-1!==A;){for(var k=1/0,F=1/0,O=void 0,B=0;B<T.children.length;B++){var U=T.children[B],$=d(U),q=(W=b,Z=U,(Math.max(Z.maxX,W.maxX)-Math.min(Z.minX,W.minX))*(Math.max(Z.maxY,W.maxY)-Math.min(Z.minY,W.minY))-$);q<F?(F=q,k=$<k?$:k,O=U):q===F&&$<k&&(k=$,O=U)}T=O||T.children[0]}var W,Z;return T},r.prototype._insert=function(b,T,A){var M=A?b:this.toBBox(b),k=[],F=this._chooseSubtree(M,this.data,T,k);for(F.children.push(b),a(F,M);T>=0&&k[T].children.length>this._maxEntries;)this._split(k,T),T--;this._adjustParentBBoxes(M,k,T)},r.prototype._split=function(b,T){var A=b[T],M=A.children.length,k=this._minEntries;this._chooseSplitAxis(A,k,M);var F=this._chooseSplitIndex(A,k,M),O=v(A.children.splice(F,A.children.length-F));O.height=A.height,O.leaf=A.leaf,n(A,this.toBBox),n(O,this.toBBox),T?b[T-1].children.push(O):this._splitRoot(A,O)},r.prototype._splitRoot=function(b,T){this.data=v([b,T]),this.data.height=b.height+1,this.data.leaf=!1,n(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(b,T,A){for(var M,k,F,O,B,U,$,q=1/0,W=1/0,Z=T;Z<=A-T;Z++){var Q=o(b,0,Z,this.toBBox),X=o(b,Z,A,this.toBBox),ce=(k=Q,F=X,O=void 0,B=void 0,U=void 0,$=void 0,O=Math.max(k.minX,F.minX),B=Math.max(k.minY,F.minY),U=Math.min(k.maxX,F.maxX),$=Math.min(k.maxY,F.maxY),Math.max(0,U-O)*Math.max(0,$-B)),de=d(Q)+d(X);ce<q?(q=ce,M=Z,W=de<W?de:W):ce===q&&de<W&&(W=de,M=Z)}return M||A-T},r.prototype._chooseSplitAxis=function(b,T,A){var M=b.leaf?this.compareMinX:l,k=b.leaf?this.compareMinY:u;this._allDistMargin(b,T,A,M)<this._allDistMargin(b,T,A,k)&&b.children.sort(M)},r.prototype._allDistMargin=function(b,T,A,M){b.children.sort(M);for(var k=this.toBBox,F=o(b,0,T,k),O=o(b,A-T,A,k),B=m(F)+m(O),U=T;U<A-T;U++){var $=b.children[U];a(F,b.leaf?k($):$),B+=m(F)}for(var q=A-T-1;q>=T;q--){var W=b.children[q];a(O,b.leaf?k(W):W),B+=m(O)}return B},r.prototype._adjustParentBBoxes=function(b,T,A){for(var M=A;M>=0;M--)a(T[M],b)},r.prototype._condense=function(b){for(var T=b.length-1,A=void 0;T>=0;T--)b[T].children.length===0?T>0?(A=b[T-1].children).splice(A.indexOf(b[T]),1):this.clear():n(b[T],this.toBBox)},r})});var QD=Ui(($E,HE)=>{(function(t,e){typeof $E=="object"&&typeof HE<"u"?HE.exports=e():typeof define=="function"&&define.amd?define(e):t.quickselect=e()})($E,function(){"use strict";function t(s,n,o,a,l){e(s,n,o||0,a||s.length-1,l||r)}function e(s,n,o,a,l){for(;a>o;){if(a-o>600){var u=a-o+1,d=n-o+1,m=Math.log(u),g=.5*Math.exp(2*m/3),_=.5*Math.sqrt(m*g*(u-g)/u)*(d-u/2<0?-1:1),v=Math.max(o,Math.floor(n-d*g/u+_)),E=Math.min(a,Math.floor(n+(u-d)*g/u+_));e(s,n,v,E,l)}var b=s[n],T=o,A=a;for(i(s,o,n),l(s[a],b)>0&&i(s,o,a);T<A;){for(i(s,T,A),T++,A--;l(s[T],b)<0;)T++;for(;l(s[A],b)>0;)A--}l(s[o],b)===0?i(s,o,A):(A++,i(s,A,a)),A<=n&&(o=A+1),n<=A&&(a=A-1)}}function i(s,n,o){var a=s[n];s[n]=s[o],s[o]=a}function r(s,n){return s<n?-1:s>n?1:0}return t})});var tF=Ui((Yke,XE)=>{"use strict";XE.exports=Sm;XE.exports.default=Sm;var sW=QD();function Sm(t,e){if(!(this instanceof Sm))return new Sm(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),e&&this._initFormat(e),this.clear()}Sm.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],r=this.toBBox;if(!$g(t,e))return i;for(var s=[],n,o,a,l;e;){for(n=0,o=e.children.length;n<o;n++)a=e.children[n],l=e.leaf?r(a):a,$g(t,l)&&(e.leaf?i.push(a):jE(t,l)?this._all(a,i):s.push(a));e=s.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!$g(t,e))return!1;for(var r=[],s,n,o,a;e;){for(s=0,n=e.children.length;s<n;s++)if(o=e.children[s],a=e.leaf?i(o):o,$g(t,a)){if(e.leaf||jE(t,a))return!0;r.push(o)}e=r.pop()}return!1},load:function(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=r;else if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var s=this.data;this.data=r,r=s}this._insert(r,this.data.height-r.height-1,!0)}return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=K2([]),this},remove:function(t,e){if(!t)return this;for(var i=this.data,r=this.toBBox(t),s=[],n=[],o,a,l,u;i||s.length;){if(i||(i=s.pop(),a=s[s.length-1],o=n.pop(),u=!0),i.leaf&&(l=nW(t,i.children,e),l!==-1))return i.children.splice(l,1),s.push(i),this._condense(s),this;!u&&!i.leaf&&jE(i,r)?(s.push(i),n.push(o),o=0,a=i,i=i.children[0]):a?(o++,i=a.children[o],u=!1):i=null}return this},toBBox:function(t){return t},compareMinX:KD,compareMinY:JD,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,r){var s=i-e+1,n=this._maxEntries,o;if(s<=n)return o=K2(t.slice(e,i+1)),Q2(o,this.toBBox),o;r||(r=Math.ceil(Math.log(s)/Math.log(n)),n=Math.ceil(s/Math.pow(n,r-1))),o=K2([]),o.leaf=!1,o.height=r;var a=Math.ceil(s/n),l=a*Math.ceil(Math.sqrt(n)),u,d,m,g;for(eF(t,e,i,l,this.compareMinX),u=e;u<=i;u+=l)for(m=Math.min(u+l-1,i),eF(t,u,m,a,this.compareMinY),d=u;d<=m;d+=a)g=Math.min(d+a-1,m),o.children.push(this._build(t,d,g,r-1));return Q2(o,this.toBBox),o},_chooseSubtree:function(t,e,i,r){for(var s,n,o,a,l,u,d,m;r.push(e),!(e.leaf||r.length-1===i);){for(d=m=1/0,s=0,n=e.children.length;s<n;s++)o=e.children[s],l=VE(o),u=oW(t,o)-l,u<m?(m=u,d=l<d?l:d,a=o):u===m&&l<d&&(d=l,a=o);e=a||e.children[0]}return e},_insert:function(t,e,i){var r=this.toBBox,s=i?t:r(t),n=[],o=this._chooseSubtree(s,this.data,e,n);for(o.children.push(t),Tm(o,s);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(s,n,e)},_split:function(t,e){var i=t[e],r=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,r);var n=this._chooseSplitIndex(i,s,r),o=K2(i.children.splice(n,i.children.length-n));o.height=i.height,o.leaf=i.leaf,Q2(i,this.toBBox),Q2(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)},_splitRoot:function(t,e){this.data=K2([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Q2(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var r,s,n,o,a,l,u,d;for(l=u=1/0,r=e;r<=i-e;r++)s=Em(t,0,r,this.toBBox),n=Em(t,r,i,this.toBBox),o=aW(s,n),a=VE(s)+VE(n),o<l?(l=o,d=r,u=a<u?a:u):o===l&&a<u&&(u=a,d=r);return d},_chooseSplitAxis:function(t,e,i){var r=t.leaf?this.compareMinX:KD,s=t.leaf?this.compareMinY:JD,n=this._allDistMargin(t,e,i,r),o=this._allDistMargin(t,e,i,s);n<o&&t.children.sort(r)},_allDistMargin:function(t,e,i,r){t.children.sort(r);var s=this.toBBox,n=Em(t,0,e,s),o=Em(t,i-e,i,s),a=Gg(n)+Gg(o),l,u;for(l=e;l<i-e;l++)u=t.children[l],Tm(n,t.leaf?s(u):u),a+=Gg(n);for(l=i-e-1;l>=e;l--)u=t.children[l],Tm(o,t.leaf?s(u):u),a+=Gg(o);return a},_adjustParentBBoxes:function(t,e,i){for(var r=i;r>=0;r--)Tm(e[r],t)},_condense:function(t){for(var e=t.length-1,i;e>=0;e--)t[e].children.length===0?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():Q2(t[e],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};function nW(t,e,i){if(!i)return e.indexOf(t);for(var r=0;r<e.length;r++)if(i(t,e[r]))return r;return-1}function Q2(t,e){Em(t,0,t.children.length,e,t)}function Em(t,e,i,r,s){s||(s=K2(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var n=e,o;n<i;n++)o=t.children[n],Tm(s,t.leaf?r(o):o);return s}function Tm(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function KD(t,e){return t.minX-e.minX}function JD(t,e){return t.minY-e.minY}function VE(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Gg(t){return t.maxX-t.minX+(t.maxY-t.minY)}function oW(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function aW(t,e){var i=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),s=Math.min(t.maxX,e.maxX),n=Math.min(t.maxY,e.maxY);return Math.max(0,s-i)*Math.max(0,n-r)}function jE(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function $g(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function K2(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function eF(t,e,i,r,s){for(var n=[e,i],o;n.length;)i=n.pop(),e=n.pop(),!(i-e<=r)&&(o=e+Math.ceil((i-e)/r/2)*r,sW(t,o,e,i,s),n.push(e,o,o,i))}});var rF=Ui((Zke,iF)=>{"use strict";iF.exports=Hg;Hg.polyline=Hg;Hg.polygon=lW;function Hg(t,e,i){var r=t.length,s=J2(t[0],e),n=[],o,a,l,u,d;for(i||(i=[]),o=1;o<r;o++){for(a=t[o-1],l=t[o],u=d=J2(l,e);;)if(s|u){if(s&u)break;s?(a=WE(a,l,s,e),s=J2(a,e)):(l=WE(a,l,u,e),u=J2(l,e))}else{n.push(a),u!==d?(n.push(l),o<r-1&&(i.push(n),n=[])):o===r-1&&n.push(l);break}s=d}return n.length&&i.push(n),i}function lW(t,e){var i,r,s,n,o,a,l;for(r=1;r<=8;r*=2){for(i=[],s=t[t.length-1],n=!(J2(s,e)&r),o=0;o<t.length;o++)a=t[o],l=!(J2(a,e)&r),l!==n&&i.push(WE(s,a,r,e)),l&&i.push(a),s=a,n=l;if(t=i,!t.length)break}return i}function WE(t,e,i,r){return i&8?[t[0]+(e[0]-t[0])*(r[3]-t[1])/(e[1]-t[1]),r[3]]:i&4?[t[0]+(e[0]-t[0])*(r[1]-t[1])/(e[1]-t[1]),r[1]]:i&2?[r[2],t[1]+(e[1]-t[1])*(r[2]-t[0])/(e[0]-t[0])]:i&1?[r[0],t[1]+(e[1]-t[1])*(r[0]-t[0])/(e[0]-t[0])]:null}function J2(t,e){var i=0;return t[0]<e[0]?i|=1:t[0]>e[2]&&(i|=2),t[1]<e[1]?i|=4:t[1]>e[3]&&(i|=8),i}});var Am=Ui((Qke,oF)=>{"use strict";var cW=tF(),uW=rF();oF.exports=hW;function hW(t){for(var e=[],i=0;i<t.features.length;i++){var r=t.features[i];if(r.geometry){var s=r.geometry.coordinates;if(r.geometry.type==="Polygon")e.push(sF(s,r.properties));else if(r.geometry.type==="MultiPolygon")for(var n=0;n<s.length;n++)e.push(sF(s[n],r.properties))}}var o=cW().load(e);function a(l,u){for(var d=[],m=o.search({minX:l[0],minY:l[1],maxX:l[0],maxY:l[1]}),g=0;g<m.length;g++)if(nF(m[g].coords,l))if(u)d.push(m[g].props);else return m[g].props;return u&&d.length?d:null}return a.tree=o,a.bbox=function(u){for(var d=[],m=o.search({minX:u[0],minY:u[1],maxX:u[2],maxY:u[3]}),g=0;g<m.length;g++)dW(m[g].coords,u)&&d.push(m[g].props);return d},a}function dW(t,e){var i=[(e[0]+e[2])/2,(e[1]+e[3])/2];if(nF(t,i))return!0;for(var r=0;r<t.length;r++)if(uW(t[r],e).length>0)return!0;return!1}function nF(t,e){for(var i=!1,r=0,s=t.length;r<s;r++)for(var n=t[r],o=0,a=n.length,l=a-1;o<a;l=o++)fW(e,n[o],n[l])&&(i=!i);return i}function fW(t,e,i){return e[1]>t[1]!=i[1]>t[1]&&t[0]<(i[0]-e[0])*(t[1]-e[1])/(i[1]-e[1])+e[0]}function sF(t,e){for(var i={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0,coords:t,props:e},r=0;r<t[0].length;r++){var s=t[0][r];i.minX=Math.min(i.minX,s[0]),i.minY=Math.min(i.minY,s[1]),i.maxX=Math.max(i.maxX,s[0]),i.maxY=Math.max(i.maxY,s[1])}return i}});var yF=Ui((nMe,Vg)=>{Vg.exports.RADIUS=6378137;Vg.exports.FLATTENING=1/298.257223563;Vg.exports.POLAR_RADIUS=63567523142e-4});var JE=Ui((oMe,KE)=>{var _F=yF();KE.exports.geometry=vF;KE.exports.ring=QE;function vF(t){var e=0,i;switch(t.type){case"Polygon":return xF(t.coordinates);case"MultiPolygon":for(i=0;i<t.coordinates.length;i++)e+=xF(t.coordinates[i]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(i=0;i<t.geometries.length;i++)e+=vF(t.geometries[i]);return e}}function xF(t){var e=0;if(t&&t.length>0){e+=Math.abs(QE(t[0]));for(var i=1;i<t.length;i++)e-=Math.abs(QE(t[i]))}return e}function QE(t){var e,i,r,s,n,o,a,l=0,u=t.length;if(u>2){for(a=0;a<u;a++)a===u-2?(s=u-2,n=u-1,o=0):a===u-1?(s=u-1,n=0,o=1):(s=a,n=a+1,o=a+2),e=t[s],i=t[n],r=t[o],l+=(ZE(r[0])-ZE(e[0]))*Math.sin(ZE(i[1]));l=l*_F.RADIUS*_F.RADIUS/2}return l}function ZE(t){return t*Math.PI/180}});var wF=Ui(bF=>{bF.validateCenter=function(e){var i=[2,3];if(!Array.isArray(e)||!i.includes(e.length))throw new Error("ERROR! Center has to be an array of length two or three");var[r,s]=e;if(typeof r!="number"||typeof s!="number")throw new Error(`ERROR! Longitude and Latitude has to be numbers but where ${typeof r} and ${typeof s}`);if(r>180||r<-180)throw new Error(`ERROR! Longitude has to be between -180 and 180 but was ${r}`);if(s>90||s<-90)throw new Error(`ERROR! Latitude has to be between -90 and 90 but was ${s}`)}});var TF=Ui(EF=>{EF.validateRadius=function(e){if(typeof e!="number")throw new Error(`ERROR! Radius has to be a positive number but was: ${typeof e}`);if(e<=0)throw new Error(`ERROR! Radius has to be a positive number but was: ${e}`)}});var AF=Ui(SF=>{SF.validateNumberOfEdges=function(e){if(typeof e!="number"){let i=Array.isArray(e)?"array":typeof e;throw new Error(`ERROR! Number of edges has to be a number but was: ${i}`)}if(e<3)throw new Error(`ERROR! Number of edges has to be at least 3 but was: ${e}`)}});var IF=Ui(CF=>{CF.validateEarthRadius=function(e){if(typeof e!="number"){let i=Array.isArray(e)?"array":typeof e;throw new Error(`ERROR! Earth radius has to be a number but was: ${i}`)}if(e<=0)throw new Error(`ERROR! Earth radius has to be a positive number but was: ${e}`)}});var MF=Ui(kF=>{kF.validateBearing=function(e){if(typeof e!="number"){let i=Array.isArray(e)?"array":typeof e;throw new Error(`ERROR! Bearing has to be a number but was: ${i}`)}}});var NF=Ui($d=>{var PF=wF().validateCenter,RF=TF().validateRadius,DF=AF().validateNumberOfEdges,FF=IF().validateEarthRadius,LF=MF().validateBearing;function SW({center:t,radius:e,numberOfEdges:i,earthRadius:r,bearing:s}){PF(t),RF(e),DF(i),FF(r),LF(s)}$d.validateCenter=PF;$d.validateRadius=RF;$d.validateNumberOfEdges=DF;$d.validateEarthRadius=FF;$d.validateBearing=LF;$d.validateInput=SW});var UF=Ui((fMe,BF)=>{"use strict";var{validateInput:AW}=NF(),eT=6378137;function tT(t){return t*Math.PI/180}function OF(t){return t*180/Math.PI}function CW(t,e,i,r){var s=tT(t[1]),n=tT(t[0]),o=e/i,a=Math.asin(Math.sin(s)*Math.cos(o)+Math.cos(s)*Math.sin(o)*Math.cos(r)),l=n+Math.atan2(Math.sin(r)*Math.sin(o)*Math.cos(s),Math.cos(o)-Math.sin(s)*Math.sin(a));return[OF(l),OF(a)]}BF.exports=function(e,i,r){var s=IW(r),n=kW(r),o=PW(r),a=MW(r);AW({center:e,radius:i,numberOfEdges:s,earthRadius:n,bearing:o});for(var l=tT(o),u=[],d=0;d<s;++d)u.push(CW(e,i,n,l+a*2*Math.PI*-d/s));return u.push(u[0]),{type:"Polygon",coordinates:[u]}};function IW(t){if(iT(t))return 32;if(jg(t)){var e=t.numberOfEdges;return e===void 0?32:e}return t}function kW(t){if(iT(t))return eT;if(jg(t)){var e=t.earthRadius;return e===void 0?eT:e}return eT}function MW(t){return jg(t)&&t.rightHandRule?-1:1}function PW(t){if(iT(t))return 0;if(jg(t)){var e=t.bearing;return e===void 0?0:e}return 0}function jg(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function iT(t){return t==null}});var nT=Ui((rT,sT)=>{(function(t,e){typeof rT=="object"&&typeof sT<"u"?sT.exports=e():typeof define=="function"&&define.amd?define(e):(t=typeof globalThis<"u"?globalThis:t||self,t.polygonClipping=e())})(rT,function(){"use strict";function t(je,be){if(!(je instanceof be))throw new TypeError("Cannot call a class as a function")}function e(je,be){for(var ge=0;ge<be.length;ge++){var xe=be[ge];xe.enumerable=xe.enumerable||!1,xe.configurable=!0,"value"in xe&&(xe.writable=!0),Object.defineProperty(je,xe.key,xe)}}function i(je,be,ge){return be&&e(je.prototype,be),ge&&e(je,ge),je}var r=function(){function je(be,ge){this.next=null,this.key=be,this.data=ge,this.left=null,this.right=null}return je}();function s(je,be){return je>be?1:je<be?-1:0}function n(je,be,ge){for(var xe=new r(null,null),Pe=xe,Oe=xe;;){var Ie=ge(je,be.key);if(Ie<0){if(be.left===null)break;if(ge(je,be.left.key)<0){var nt=be.left;if(be.left=nt.right,nt.right=be,be=nt,be.left===null)break}Oe.left=be,Oe=be,be=be.left}else if(Ie>0){if(be.right===null)break;if(ge(je,be.right.key)>0){var nt=be.right;if(be.right=nt.left,nt.left=be,be=nt,be.right===null)break}Pe.right=be,Pe=be,be=be.right}else break}return Pe.right=be.left,Oe.left=be.right,be.left=xe.right,be.right=xe.left,be}function o(je,be,ge,xe){var Pe=new r(je,be);if(ge===null)return Pe.left=Pe.right=null,Pe;ge=n(je,ge,xe);var Oe=xe(je,ge.key);return Oe<0?(Pe.left=ge.left,Pe.right=ge,ge.left=null):Oe>=0&&(Pe.right=ge.right,Pe.left=ge,ge.right=null),Pe}function a(je,be,ge){var xe=null,Pe=null;if(be){be=n(je,be,ge);var Oe=ge(be.key,je);Oe===0?(xe=be.left,Pe=be.right):Oe<0?(Pe=be.right,be.right=null,xe=be):(xe=be.left,be.left=null,Pe=be)}return{left:xe,right:Pe}}function l(je,be,ge){return be===null?je:(je===null||(be=n(je.key,be,ge),be.left=je),be)}function u(je,be,ge,xe,Pe){if(je){xe(""+be+(ge?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Pe(je)+`
`);var Oe=be+(ge?"    ":"\u2502   ");je.left&&u(je.left,Oe,!1,xe,Pe),je.right&&u(je.right,Oe,!0,xe,Pe)}}var d=function(){function je(be){be===void 0&&(be=s),this._root=null,this._size=0,this._comparator=be}return je.prototype.insert=function(be,ge){return this._size++,this._root=o(be,ge,this._root,this._comparator)},je.prototype.add=function(be,ge){var xe=new r(be,ge);this._root===null&&(xe.left=xe.right=null,this._size++,this._root=xe);var Pe=this._comparator,Oe=n(be,this._root,Pe),Ie=Pe(be,Oe.key);return Ie===0?this._root=Oe:(Ie<0?(xe.left=Oe.left,xe.right=Oe,Oe.left=null):Ie>0&&(xe.right=Oe.right,xe.left=Oe,Oe.right=null),this._size++,this._root=xe),this._root},je.prototype.remove=function(be){this._root=this._remove(be,this._root,this._comparator)},je.prototype._remove=function(be,ge,xe){var Pe;if(ge===null)return null;ge=n(be,ge,xe);var Oe=xe(be,ge.key);return Oe===0?(ge.left===null?Pe=ge.right:(Pe=n(be,ge.left,xe),Pe.right=ge.right),this._size--,Pe):ge},je.prototype.pop=function(){var be=this._root;if(be){for(;be.left;)be=be.left;return this._root=n(be.key,this._root,this._comparator),this._root=this._remove(be.key,this._root,this._comparator),{key:be.key,data:be.data}}return null},je.prototype.findStatic=function(be){for(var ge=this._root,xe=this._comparator;ge;){var Pe=xe(be,ge.key);if(Pe===0)return ge;Pe<0?ge=ge.left:ge=ge.right}return null},je.prototype.find=function(be){return this._root&&(this._root=n(be,this._root,this._comparator),this._comparator(be,this._root.key)!==0)?null:this._root},je.prototype.contains=function(be){for(var ge=this._root,xe=this._comparator;ge;){var Pe=xe(be,ge.key);if(Pe===0)return!0;Pe<0?ge=ge.left:ge=ge.right}return!1},je.prototype.forEach=function(be,ge){for(var xe=this._root,Pe=[],Oe=!1;!Oe;)xe!==null?(Pe.push(xe),xe=xe.left):Pe.length!==0?(xe=Pe.pop(),be.call(ge,xe),xe=xe.right):Oe=!0;return this},je.prototype.range=function(be,ge,xe,Pe){for(var Oe=[],Ie=this._comparator,nt=this._root,ht;Oe.length!==0||nt;)if(nt)Oe.push(nt),nt=nt.left;else{if(nt=Oe.pop(),ht=Ie(nt.key,ge),ht>0)break;if(Ie(nt.key,be)>=0&&xe.call(Pe,nt))return this;nt=nt.right}return this},je.prototype.keys=function(){var be=[];return this.forEach(function(ge){var xe=ge.key;return be.push(xe)}),be},je.prototype.values=function(){var be=[];return this.forEach(function(ge){var xe=ge.data;return be.push(xe)}),be},je.prototype.min=function(){return this._root?this.minNode(this._root).key:null},je.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},je.prototype.minNode=function(be){if(be===void 0&&(be=this._root),be)for(;be.left;)be=be.left;return be},je.prototype.maxNode=function(be){if(be===void 0&&(be=this._root),be)for(;be.right;)be=be.right;return be},je.prototype.at=function(be){for(var ge=this._root,xe=!1,Pe=0,Oe=[];!xe;)if(ge)Oe.push(ge),ge=ge.left;else if(Oe.length>0){if(ge=Oe.pop(),Pe===be)return ge;Pe++,ge=ge.right}else xe=!0;return null},je.prototype.next=function(be){var ge=this._root,xe=null;if(be.right){for(xe=be.right;xe.left;)xe=xe.left;return xe}for(var Pe=this._comparator;ge;){var Oe=Pe(be.key,ge.key);if(Oe===0)break;Oe<0?(xe=ge,ge=ge.left):ge=ge.right}return xe},je.prototype.prev=function(be){var ge=this._root,xe=null;if(be.left!==null){for(xe=be.left;xe.right;)xe=xe.right;return xe}for(var Pe=this._comparator;ge;){var Oe=Pe(be.key,ge.key);if(Oe===0)break;Oe<0?ge=ge.left:(xe=ge,ge=ge.right)}return xe},je.prototype.clear=function(){return this._root=null,this._size=0,this},je.prototype.toList=function(){return _(this._root)},je.prototype.load=function(be,ge,xe){ge===void 0&&(ge=[]),xe===void 0&&(xe=!1);var Pe=be.length,Oe=this._comparator;if(xe&&b(be,ge,0,Pe-1,Oe),this._root===null)this._root=m(be,ge,0,Pe),this._size=Pe;else{var Ie=E(this.toList(),g(be,ge),Oe);Pe=this._size+Pe,this._root=v({head:Ie},0,Pe)}return this},je.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(je.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(je.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),je.prototype.toString=function(be){be===void 0&&(be=function(Pe){return String(Pe.key)});var ge=[];return u(this._root,"",!0,function(xe){return ge.push(xe)},be),ge.join("")},je.prototype.update=function(be,ge,xe){var Pe=this._comparator,Oe=a(be,this._root,Pe),Ie=Oe.left,nt=Oe.right;Pe(be,ge)<0?nt=o(ge,xe,nt,Pe):Ie=o(ge,xe,Ie,Pe),this._root=l(Ie,nt,Pe)},je.prototype.split=function(be){return a(be,this._root,this._comparator)},je}();function m(je,be,ge,xe){var Pe=xe-ge;if(Pe>0){var Oe=ge+Math.floor(Pe/2),Ie=je[Oe],nt=be[Oe],ht=new r(Ie,nt);return ht.left=m(je,be,ge,Oe),ht.right=m(je,be,Oe+1,xe),ht}return null}function g(je,be){for(var ge=new r(null,null),xe=ge,Pe=0;Pe<je.length;Pe++)xe=xe.next=new r(je[Pe],be[Pe]);return xe.next=null,ge.next}function _(je){for(var be=je,ge=[],xe=!1,Pe=new r(null,null),Oe=Pe;!xe;)be?(ge.push(be),be=be.left):ge.length>0?(be=Oe=Oe.next=ge.pop(),be=be.right):xe=!0;return Oe.next=null,Pe.next}function v(je,be,ge){var xe=ge-be;if(xe>0){var Pe=be+Math.floor(xe/2),Oe=v(je,be,Pe),Ie=je.head;return Ie.left=Oe,je.head=je.head.next,Ie.right=v(je,Pe+1,ge),Ie}return null}function E(je,be,ge){for(var xe=new r(null,null),Pe=xe,Oe=je,Ie=be;Oe!==null&&Ie!==null;)ge(Oe.key,Ie.key)<0?(Pe.next=Oe,Oe=Oe.next):(Pe.next=Ie,Ie=Ie.next),Pe=Pe.next;return Oe!==null?Pe.next=Oe:Ie!==null&&(Pe.next=Ie),xe.next}function b(je,be,ge,xe,Pe){if(!(ge>=xe)){for(var Oe=je[ge+xe>>1],Ie=ge-1,nt=xe+1;;){do Ie++;while(Pe(je[Ie],Oe)<0);do nt--;while(Pe(je[nt],Oe)>0);if(Ie>=nt)break;var ht=je[Ie];je[Ie]=je[nt],je[nt]=ht,ht=be[Ie],be[Ie]=be[nt],be[nt]=ht}b(je,be,ge,nt,Pe),b(je,be,nt+1,xe,Pe)}}var T=function(be,ge){return be.ll.x<=ge.x&&ge.x<=be.ur.x&&be.ll.y<=ge.y&&ge.y<=be.ur.y},A=function(be,ge){if(ge.ur.x<be.ll.x||be.ur.x<ge.ll.x||ge.ur.y<be.ll.y||be.ur.y<ge.ll.y)return null;var xe=be.ll.x<ge.ll.x?ge.ll.x:be.ll.x,Pe=be.ur.x<ge.ur.x?be.ur.x:ge.ur.x,Oe=be.ll.y<ge.ll.y?ge.ll.y:be.ll.y,Ie=be.ur.y<ge.ur.y?be.ur.y:ge.ur.y;return{ll:{x:xe,y:Oe},ur:{x:Pe,y:Ie}}},M=Number.EPSILON;M===void 0&&(M=Math.pow(2,-52));var k=M*M,F=function(be,ge){if(-M<be&&be<M&&-M<ge&&ge<M)return 0;var xe=be-ge;return xe*xe<k*be*ge?0:be<ge?-1:1},O=function(){function je(){t(this,je),this.reset()}return i(je,[{key:"reset",value:function(){this.xRounder=new B,this.yRounder=new B}},{key:"round",value:function(ge,xe){return{x:this.xRounder.round(ge),y:this.yRounder.round(xe)}}}]),je}(),B=function(){function je(){t(this,je),this.tree=new d,this.round(0)}return i(je,[{key:"round",value:function(ge){var xe=this.tree.add(ge),Pe=this.tree.prev(xe);if(Pe!==null&&F(xe.key,Pe.key)===0)return this.tree.remove(ge),Pe.key;var Oe=this.tree.next(xe);return Oe!==null&&F(xe.key,Oe.key)===0?(this.tree.remove(ge),Oe.key):ge}}]),je}(),U=new O,$=function(be,ge){return be.x*ge.y-be.y*ge.x},q=function(be,ge){return be.x*ge.x+be.y*ge.y},W=function(be,ge,xe){var Pe={x:ge.x-be.x,y:ge.y-be.y},Oe={x:xe.x-be.x,y:xe.y-be.y},Ie=$(Pe,Oe);return F(Ie,0)},Z=function(be){return Math.sqrt(q(be,be))},Q=function(be,ge,xe){var Pe={x:ge.x-be.x,y:ge.y-be.y},Oe={x:xe.x-be.x,y:xe.y-be.y};return $(Oe,Pe)/Z(Oe)/Z(Pe)},X=function(be,ge,xe){var Pe={x:ge.x-be.x,y:ge.y-be.y},Oe={x:xe.x-be.x,y:xe.y-be.y};return q(Oe,Pe)/Z(Oe)/Z(Pe)},ce=function(be,ge,xe){return ge.y===0?null:{x:be.x+ge.x/ge.y*(xe-be.y),y:xe}},de=function(be,ge,xe){return ge.x===0?null:{x:xe,y:be.y+ge.y/ge.x*(xe-be.x)}},le=function(be,ge,xe,Pe){if(ge.x===0)return de(xe,Pe,be.x);if(Pe.x===0)return de(be,ge,xe.x);if(ge.y===0)return ce(xe,Pe,be.y);if(Pe.y===0)return ce(be,ge,xe.y);var Oe=$(ge,Pe);if(Oe==0)return null;var Ie={x:xe.x-be.x,y:xe.y-be.y},nt=$(Ie,ge)/Oe,ht=$(Ie,Pe)/Oe,Ht=be.x+ht*ge.x,hi=xe.x+nt*Pe.x,at=be.y+ht*ge.y,Ot=xe.y+nt*Pe.y,Pt=(Ht+hi)/2,Zi=(at+Ot)/2;return{x:Pt,y:Zi}},te=function(){i(je,null,[{key:"compare",value:function(ge,xe){var Pe=je.comparePoints(ge.point,xe.point);return Pe!==0?Pe:(ge.point!==xe.point&&ge.link(xe),ge.isLeft!==xe.isLeft?ge.isLeft?1:-1:oe.compare(ge.segment,xe.segment))}},{key:"comparePoints",value:function(ge,xe){return ge.x<xe.x?-1:ge.x>xe.x?1:ge.y<xe.y?-1:ge.y>xe.y?1:0}}]);function je(be,ge){t(this,je),be.events===void 0?be.events=[this]:be.events.push(this),this.point=be,this.isLeft=ge}return i(je,[{key:"link",value:function(ge){if(ge.point===this.point)throw new Error("Tried to link already linked events");for(var xe=ge.point.events,Pe=0,Oe=xe.length;Pe<Oe;Pe++){var Ie=xe[Pe];this.point.events.push(Ie),Ie.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var ge=this.point.events.length,xe=0;xe<ge;xe++){var Pe=this.point.events[xe];if(Pe.segment.consumedBy===void 0)for(var Oe=xe+1;Oe<ge;Oe++){var Ie=this.point.events[Oe];Ie.consumedBy===void 0&&Pe.otherSE.point.events===Ie.otherSE.point.events&&Pe.segment.consume(Ie.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var ge=[],xe=0,Pe=this.point.events.length;xe<Pe;xe++){var Oe=this.point.events[xe];Oe!==this&&!Oe.segment.ringOut&&Oe.segment.isInResult()&&ge.push(Oe)}return ge}},{key:"getLeftmostComparator",value:function(ge){var xe=this,Pe=new Map,Oe=function(nt){var ht=nt.otherSE;Pe.set(nt,{sine:Q(xe.point,ge.point,ht.point),cosine:X(xe.point,ge.point,ht.point)})};return function(Ie,nt){Pe.has(Ie)||Oe(Ie),Pe.has(nt)||Oe(nt);var ht=Pe.get(Ie),Ht=ht.sine,hi=ht.cosine,at=Pe.get(nt),Ot=at.sine,Pt=at.cosine;return Ht>=0&&Ot>=0?hi<Pt?1:hi>Pt?-1:0:Ht<0&&Ot<0?hi<Pt?-1:hi>Pt?1:0:Ot<Ht?-1:Ot>Ht?1:0}}}]),je}(),ee=0,oe=function(){i(je,null,[{key:"compare",value:function(ge,xe){var Pe=ge.leftSE.point.x,Oe=xe.leftSE.point.x,Ie=ge.rightSE.point.x,nt=xe.rightSE.point.x;if(nt<Pe)return 1;if(Ie<Oe)return-1;var ht=ge.leftSE.point.y,Ht=xe.leftSE.point.y,hi=ge.rightSE.point.y,at=xe.rightSE.point.y;if(Pe<Oe){if(Ht<ht&&Ht<hi)return 1;if(Ht>ht&&Ht>hi)return-1;var Ot=ge.comparePoint(xe.leftSE.point);if(Ot<0)return 1;if(Ot>0)return-1;var Pt=xe.comparePoint(ge.rightSE.point);return Pt!==0?Pt:-1}if(Pe>Oe){if(ht<Ht&&ht<at)return-1;if(ht>Ht&&ht>at)return 1;var Zi=xe.comparePoint(ge.leftSE.point);if(Zi!==0)return Zi;var ji=ge.comparePoint(xe.rightSE.point);return ji<0?1:ji>0?-1:1}if(ht<Ht)return-1;if(ht>Ht)return 1;if(Ie<nt){var Ke=xe.comparePoint(ge.rightSE.point);if(Ke!==0)return Ke}if(Ie>nt){var dt=ge.comparePoint(xe.rightSE.point);if(dt<0)return 1;if(dt>0)return-1}if(Ie!==nt){var Lt=hi-ht,Yt=Ie-Pe,Kt=at-Ht,Fi=nt-Oe;if(Lt>Yt&&Kt<Fi)return 1;if(Lt<Yt&&Kt>Fi)return-1}return Ie>nt?1:Ie<nt||hi<at?-1:hi>at?1:ge.id<xe.id?-1:ge.id>xe.id?1:0}}]);function je(be,ge,xe,Pe){t(this,je),this.id=++ee,this.leftSE=be,be.segment=this,be.otherSE=ge,this.rightSE=ge,ge.segment=this,ge.otherSE=be,this.rings=xe,this.windings=Pe}return i(je,[{key:"replaceRightSE",value:function(ge){this.rightSE=ge,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var ge=this.leftSE.point.y,xe=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:ge<xe?ge:xe},ur:{x:this.rightSE.point.x,y:ge>xe?ge:xe}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(ge){return ge.x===this.leftSE.point.x&&ge.y===this.leftSE.point.y||ge.x===this.rightSE.point.x&&ge.y===this.rightSE.point.y}},{key:"comparePoint",value:function(ge){if(this.isAnEndpoint(ge))return 0;var xe=this.leftSE.point,Pe=this.rightSE.point,Oe=this.vector();if(xe.x===Pe.x)return ge.x===xe.x?0:ge.x<xe.x?1:-1;var Ie=(ge.y-xe.y)/Oe.y,nt=xe.x+Ie*Oe.x;if(ge.x===nt)return 0;var ht=(ge.x-xe.x)/Oe.x,Ht=xe.y+ht*Oe.y;return ge.y===Ht?0:ge.y<Ht?-1:1}},{key:"getIntersection",value:function(ge){var xe=this.bbox(),Pe=ge.bbox(),Oe=A(xe,Pe);if(Oe===null)return null;var Ie=this.leftSE.point,nt=this.rightSE.point,ht=ge.leftSE.point,Ht=ge.rightSE.point,hi=T(xe,ht)&&this.comparePoint(ht)===0,at=T(Pe,Ie)&&ge.comparePoint(Ie)===0,Ot=T(xe,Ht)&&this.comparePoint(Ht)===0,Pt=T(Pe,nt)&&ge.comparePoint(nt)===0;if(at&&hi)return Pt&&!Ot?nt:!Pt&&Ot?Ht:null;if(at)return Ot&&Ie.x===Ht.x&&Ie.y===Ht.y?null:Ie;if(hi)return Pt&&nt.x===ht.x&&nt.y===ht.y?null:ht;if(Pt&&Ot)return null;if(Pt)return nt;if(Ot)return Ht;var Zi=le(Ie,this.vector(),ht,ge.vector());return Zi===null||!T(Oe,Zi)?null:U.round(Zi.x,Zi.y)}},{key:"split",value:function(ge){var xe=[],Pe=ge.events!==void 0,Oe=new te(ge,!0),Ie=new te(ge,!1),nt=this.rightSE;this.replaceRightSE(Ie),xe.push(Ie),xe.push(Oe);var ht=new je(Oe,nt,this.rings.slice(),this.windings.slice());return te.comparePoints(ht.leftSE.point,ht.rightSE.point)>0&&ht.swapEvents(),te.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Pe&&(Oe.checkForConsuming(),Ie.checkForConsuming()),xe}},{key:"swapEvents",value:function(){var ge=this.rightSE;this.rightSE=this.leftSE,this.leftSE=ge,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var xe=0,Pe=this.windings.length;xe<Pe;xe++)this.windings[xe]*=-1}},{key:"consume",value:function(ge){for(var xe=this,Pe=ge;xe.consumedBy;)xe=xe.consumedBy;for(;Pe.consumedBy;)Pe=Pe.consumedBy;var Oe=je.compare(xe,Pe);if(Oe!==0){if(Oe>0){var Ie=xe;xe=Pe,Pe=Ie}if(xe.prev===Pe){var nt=xe;xe=Pe,Pe=nt}for(var ht=0,Ht=Pe.rings.length;ht<Ht;ht++){var hi=Pe.rings[ht],at=Pe.windings[ht],Ot=xe.rings.indexOf(hi);Ot===-1?(xe.rings.push(hi),xe.windings.push(at)):xe.windings[Ot]+=at}Pe.rings=null,Pe.windings=null,Pe.consumedBy=xe,Pe.leftSE.consumedBy=xe.leftSE,Pe.rightSE.consumedBy=xe.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var ge=this.prev.consumedBy||this.prev;this._beforeState=ge.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var ge=this.beforeState();this._afterState={rings:ge.rings.slice(0),windings:ge.windings.slice(0),multiPolys:[]};for(var xe=this._afterState.rings,Pe=this._afterState.windings,Oe=this._afterState.multiPolys,Ie=0,nt=this.rings.length;Ie<nt;Ie++){var ht=this.rings[Ie],Ht=this.windings[Ie],hi=xe.indexOf(ht);hi===-1?(xe.push(ht),Pe.push(Ht)):Pe[hi]+=Ht}for(var at=[],Ot=[],Pt=0,Zi=xe.length;Pt<Zi;Pt++)if(Pe[Pt]!==0){var ji=xe[Pt],Ke=ji.poly;if(Ot.indexOf(Ke)===-1)if(ji.isExterior)at.push(Ke);else{Ot.indexOf(Ke)===-1&&Ot.push(Ke);var dt=at.indexOf(ji.poly);dt!==-1&&at.splice(dt,1)}}for(var Lt=0,Yt=at.length;Lt<Yt;Lt++){var Kt=at[Lt].multiPoly;Oe.indexOf(Kt)===-1&&Oe.push(Kt)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var ge=this.beforeState().multiPolys,xe=this.afterState().multiPolys;switch(Se.type){case"union":{var Pe=ge.length===0,Oe=xe.length===0;this._isInResult=Pe!==Oe;break}case"intersection":{var Ie,nt;ge.length<xe.length?(Ie=ge.length,nt=xe.length):(Ie=xe.length,nt=ge.length),this._isInResult=nt===Se.numMultiPolys&&Ie<nt;break}case"xor":{var ht=Math.abs(ge.length-xe.length);this._isInResult=ht%2===1;break}case"difference":{var Ht=function(at){return at.length===1&&at[0].isSubject};this._isInResult=Ht(ge)!==Ht(xe);break}default:throw new Error("Unrecognized operation type found ".concat(Se.type))}return this._isInResult}}],[{key:"fromRing",value:function(ge,xe,Pe){var Oe,Ie,nt,ht=te.comparePoints(ge,xe);if(ht<0)Oe=ge,Ie=xe,nt=1;else if(ht>0)Oe=xe,Ie=ge,nt=-1;else throw new Error("Tried to create degenerate segment at [".concat(ge.x,", ").concat(ge.y,"]"));var Ht=new te(Oe,!0),hi=new te(Ie,!1);return new je(Ht,hi,[Pe],[nt])}}]),je}(),ie=function(){function je(be,ge,xe){if(t(this,je),!Array.isArray(be)||be.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=ge,this.isExterior=xe,this.segments=[],typeof be[0][0]!="number"||typeof be[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Pe=U.round(be[0][0],be[0][1]);this.bbox={ll:{x:Pe.x,y:Pe.y},ur:{x:Pe.x,y:Pe.y}};for(var Oe=Pe,Ie=1,nt=be.length;Ie<nt;Ie++){if(typeof be[Ie][0]!="number"||typeof be[Ie][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var ht=U.round(be[Ie][0],be[Ie][1]);ht.x===Oe.x&&ht.y===Oe.y||(this.segments.push(oe.fromRing(Oe,ht,this)),ht.x<this.bbox.ll.x&&(this.bbox.ll.x=ht.x),ht.y<this.bbox.ll.y&&(this.bbox.ll.y=ht.y),ht.x>this.bbox.ur.x&&(this.bbox.ur.x=ht.x),ht.y>this.bbox.ur.y&&(this.bbox.ur.y=ht.y),Oe=ht)}(Pe.x!==Oe.x||Pe.y!==Oe.y)&&this.segments.push(oe.fromRing(Oe,Pe,this))}return i(je,[{key:"getSweepEvents",value:function(){for(var ge=[],xe=0,Pe=this.segments.length;xe<Pe;xe++){var Oe=this.segments[xe];ge.push(Oe.leftSE),ge.push(Oe.rightSE)}return ge}}]),je}(),ne=function(){function je(be,ge){if(t(this,je),!Array.isArray(be))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ie(be[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var xe=1,Pe=be.length;xe<Pe;xe++){var Oe=new ie(be[xe],this,!1);Oe.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Oe.bbox.ll.x),Oe.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Oe.bbox.ll.y),Oe.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Oe.bbox.ur.x),Oe.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Oe.bbox.ur.y),this.interiorRings.push(Oe)}this.multiPoly=ge}return i(je,[{key:"getSweepEvents",value:function(){for(var ge=this.exteriorRing.getSweepEvents(),xe=0,Pe=this.interiorRings.length;xe<Pe;xe++)for(var Oe=this.interiorRings[xe].getSweepEvents(),Ie=0,nt=Oe.length;Ie<nt;Ie++)ge.push(Oe[Ie]);return ge}}]),je}(),me=function(){function je(be,ge){if(t(this,je),!Array.isArray(be))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof be[0][0][0]=="number"&&(be=[be])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var xe=0,Pe=be.length;xe<Pe;xe++){var Oe=new ne(be[xe],this);Oe.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Oe.bbox.ll.x),Oe.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Oe.bbox.ll.y),Oe.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Oe.bbox.ur.x),Oe.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Oe.bbox.ur.y),this.polys.push(Oe)}this.isSubject=ge}return i(je,[{key:"getSweepEvents",value:function(){for(var ge=[],xe=0,Pe=this.polys.length;xe<Pe;xe++)for(var Oe=this.polys[xe].getSweepEvents(),Ie=0,nt=Oe.length;Ie<nt;Ie++)ge.push(Oe[Ie]);return ge}}]),je}(),De=function(){i(je,null,[{key:"factory",value:function(ge){for(var xe=[],Pe=0,Oe=ge.length;Pe<Oe;Pe++){var Ie=ge[Pe];if(!(!Ie.isInResult()||Ie.ringOut)){for(var nt=null,ht=Ie.leftSE,Ht=Ie.rightSE,hi=[ht],at=ht.point,Ot=[];nt=ht,ht=Ht,hi.push(ht),ht.point!==at;)for(;;){var Pt=ht.getAvailableLinkedEvents();if(Pt.length===0){var Zi=hi[0].point,ji=hi[hi.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(Zi.x,",")+" ".concat(Zi.y,"]. Last matching segment found ends at")+" [".concat(ji.x,", ").concat(ji.y,"]."))}if(Pt.length===1){Ht=Pt[0].otherSE;break}for(var Ke=null,dt=0,Lt=Ot.length;dt<Lt;dt++)if(Ot[dt].point===ht.point){Ke=dt;break}if(Ke!==null){var Yt=Ot.splice(Ke)[0],Kt=hi.splice(Yt.index);Kt.unshift(Kt[0].otherSE),xe.push(new je(Kt.reverse()));continue}Ot.push({index:hi.length,point:ht.point});var Fi=ht.getLeftmostComparator(nt);Ht=Pt.sort(Fi)[0].otherSE;break}xe.push(new je(hi))}}return xe}}]);function je(be){t(this,je),this.events=be;for(var ge=0,xe=be.length;ge<xe;ge++)be[ge].segment.ringOut=this;this.poly=null}return i(je,[{key:"getGeom",value:function(){for(var ge=this.events[0].point,xe=[ge],Pe=1,Oe=this.events.length-1;Pe<Oe;Pe++){var Ie=this.events[Pe].point,nt=this.events[Pe+1].point;W(Ie,ge,nt)!==0&&(xe.push(Ie),ge=Ie)}if(xe.length===1)return null;var ht=xe[0],Ht=xe[1];W(ht,ge,Ht)===0&&xe.shift(),xe.push(xe[0]);for(var hi=this.isExteriorRing()?1:-1,at=this.isExteriorRing()?0:xe.length-1,Ot=this.isExteriorRing()?xe.length:-1,Pt=[],Zi=at;Zi!=Ot;Zi+=hi)Pt.push([xe[Zi].x,xe[Zi].y]);return Pt}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var ge=this.enclosingRing();this._isExteriorRing=ge?!ge.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var ge=this.events[0],xe=1,Pe=this.events.length;xe<Pe;xe++){var Oe=this.events[xe];te.compare(ge,Oe)>0&&(ge=Oe)}for(var Ie=ge.segment.prevInResult(),nt=Ie?Ie.prevInResult():null;;){if(!Ie)return null;if(!nt)return Ie.ringOut;if(nt.ringOut!==Ie.ringOut)return nt.ringOut.enclosingRing()!==Ie.ringOut?Ie.ringOut:Ie.ringOut.enclosingRing();Ie=nt.prevInResult(),nt=Ie?Ie.prevInResult():null}}}]),je}(),He=function(){function je(be){t(this,je),this.exteriorRing=be,be.poly=this,this.interiorRings=[]}return i(je,[{key:"addInterior",value:function(ge){this.interiorRings.push(ge),ge.poly=this}},{key:"getGeom",value:function(){var ge=[this.exteriorRing.getGeom()];if(ge[0]===null)return null;for(var xe=0,Pe=this.interiorRings.length;xe<Pe;xe++){var Oe=this.interiorRings[xe].getGeom();Oe!==null&&ge.push(Oe)}return ge}}]),je}(),Je=function(){function je(be){t(this,je),this.rings=be,this.polys=this._composePolys(be)}return i(je,[{key:"getGeom",value:function(){for(var ge=[],xe=0,Pe=this.polys.length;xe<Pe;xe++){var Oe=this.polys[xe].getGeom();Oe!==null&&ge.push(Oe)}return ge}},{key:"_composePolys",value:function(ge){for(var xe=[],Pe=0,Oe=ge.length;Pe<Oe;Pe++){var Ie=ge[Pe];if(!Ie.poly)if(Ie.isExteriorRing())xe.push(new He(Ie));else{var nt=Ie.enclosingRing();nt.poly||xe.push(new He(nt)),nt.poly.addInterior(Ie)}}return xe}}]),je}(),ot=function(){function je(be){var ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:oe.compare;t(this,je),this.queue=be,this.tree=new d(ge),this.segments=[]}return i(je,[{key:"process",value:function(ge){var xe=ge.segment,Pe=[];if(ge.consumedBy)return ge.isLeft?this.queue.remove(ge.otherSE):this.tree.remove(xe),Pe;var Oe=ge.isLeft?this.tree.insert(xe):this.tree.find(xe);if(!Oe)throw new Error("Unable to find segment #".concat(xe.id," ")+"[".concat(xe.leftSE.point.x,", ").concat(xe.leftSE.point.y,"] -> ")+"[".concat(xe.rightSE.point.x,", ").concat(xe.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Ie=Oe,nt=Oe,ht=void 0,Ht=void 0;ht===void 0;)Ie=this.tree.prev(Ie),Ie===null?ht=null:Ie.key.consumedBy===void 0&&(ht=Ie.key);for(;Ht===void 0;)nt=this.tree.next(nt),nt===null?Ht=null:nt.key.consumedBy===void 0&&(Ht=nt.key);if(ge.isLeft){var hi=null;if(ht){var at=ht.getIntersection(xe);if(at!==null&&(xe.isAnEndpoint(at)||(hi=at),!ht.isAnEndpoint(at)))for(var Ot=this._splitSafely(ht,at),Pt=0,Zi=Ot.length;Pt<Zi;Pt++)Pe.push(Ot[Pt])}var ji=null;if(Ht){var Ke=Ht.getIntersection(xe);if(Ke!==null&&(xe.isAnEndpoint(Ke)||(ji=Ke),!Ht.isAnEndpoint(Ke)))for(var dt=this._splitSafely(Ht,Ke),Lt=0,Yt=dt.length;Lt<Yt;Lt++)Pe.push(dt[Lt])}if(hi!==null||ji!==null){var Kt=null;if(hi===null)Kt=ji;else if(ji===null)Kt=hi;else{var Fi=te.comparePoints(hi,ji);Kt=Fi<=0?hi:ji}this.queue.remove(xe.rightSE),Pe.push(xe.rightSE);for(var Ir=xe.split(Kt),Qi=0,ys=Ir.length;Qi<ys;Qi++)Pe.push(Ir[Qi])}Pe.length>0?(this.tree.remove(xe),Pe.push(ge)):(this.segments.push(xe),xe.prev=ht)}else{if(ht&&Ht){var ls=ht.getIntersection(Ht);if(ls!==null){if(!ht.isAnEndpoint(ls))for(var Me=this._splitSafely(ht,ls),he=0,pe=Me.length;he<pe;he++)Pe.push(Me[he]);if(!Ht.isAnEndpoint(ls))for(var Ee=this._splitSafely(Ht,ls),Fe=0,Ue=Ee.length;Fe<Ue;Fe++)Pe.push(Ee[Fe])}}this.tree.remove(xe)}return Pe}},{key:"_splitSafely",value:function(ge,xe){this.tree.remove(ge);var Pe=ge.rightSE;this.queue.remove(Pe);var Oe=ge.split(xe);return Oe.push(Pe),ge.consumedBy===void 0&&this.tree.insert(ge),Oe}}]),je}(),gt=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,vt=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ct=function(){function je(){t(this,je)}return i(je,[{key:"run",value:function(ge,xe,Pe){Se.type=ge,U.reset();for(var Oe=[new me(xe,!0)],Ie=0,nt=Pe.length;Ie<nt;Ie++)Oe.push(new me(Pe[Ie],!1));if(Se.numMultiPolys=Oe.length,Se.type==="difference")for(var ht=Oe[0],Ht=1;Ht<Oe.length;)A(Oe[Ht].bbox,ht.bbox)!==null?Ht++:Oe.splice(Ht,1);if(Se.type==="intersection"){for(var hi=0,at=Oe.length;hi<at;hi++)for(var Ot=Oe[hi],Pt=hi+1,Zi=Oe.length;Pt<Zi;Pt++)if(A(Ot.bbox,Oe[Pt].bbox)===null)return[]}for(var ji=new d(te.compare),Ke=0,dt=Oe.length;Ke<dt;Ke++)for(var Lt=Oe[Ke].getSweepEvents(),Yt=0,Kt=Lt.length;Yt<Kt;Yt++)if(ji.insert(Lt[Yt]),ji.size>gt)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Fi=new ot(ji),Ir=ji.size,Qi=ji.pop();Qi;){var ys=Qi.key;if(ji.size===Ir){var ls=ys.segment;throw new Error("Unable to pop() ".concat(ys.isLeft?"left":"right"," SweepEvent ")+"[".concat(ys.point.x,", ").concat(ys.point.y,"] from segment #").concat(ls.id," ")+"[".concat(ls.leftSE.point.x,", ").concat(ls.leftSE.point.y,"] -> ")+"[".concat(ls.rightSE.point.x,", ").concat(ls.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(ji.size>gt)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Fi.segments.length>vt)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var Me=Fi.process(ys),he=0,pe=Me.length;he<pe;he++){var Ee=Me[he];Ee.consumedBy===void 0&&ji.insert(Ee)}Ir=ji.size,Qi=ji.pop()}U.reset();var Fe=De.factory(Fi.segments),Ue=new Je(Fe);return Ue.getGeom()}}]),je}(),Se=new ct,Qe=function(be){for(var ge=arguments.length,xe=new Array(ge>1?ge-1:0),Pe=1;Pe<ge;Pe++)xe[Pe-1]=arguments[Pe];return Se.run("union",be,xe)},xt=function(be){for(var ge=arguments.length,xe=new Array(ge>1?ge-1:0),Pe=1;Pe<ge;Pe++)xe[Pe-1]=arguments[Pe];return Se.run("intersection",be,xe)},It=function(be){for(var ge=arguments.length,xe=new Array(ge>1?ge-1:0),Pe=1;Pe<ge;Pe++)xe[Pe-1]=arguments[Pe];return Se.run("xor",be,xe)},Gt=function(be){for(var ge=arguments.length,xe=new Array(ge>1?ge-1:0),Pe=1;Pe<ge;Pe++)xe[Pe-1]=arguments[Pe];return Se.run("difference",be,xe)},Ni={union:Qe,intersection:xt,xor:It,difference:Gt};return Ni})});var zF=Ui((pMe,oT)=>{(function(){function t(e,i,r){function s(g){return g.map(function(_,v){return v<2?1*_.toFixed(i):1*_.toFixed(r)})}function n(g){return g.map(s)}function o(g){return g.map(n)}function a(g){return g.map(o)}function l(g){if(!g)return{};switch(g.type){case"Point":return g.coordinates=s(g.coordinates),g;case"LineString":case"MultiPoint":return g.coordinates=n(g.coordinates),g;case"Polygon":case"MultiLineString":return g.coordinates=o(g.coordinates),g;case"MultiPolygon":return g.coordinates=a(g.coordinates),g;case"GeometryCollection":return g.geometries=g.geometries.map(l),g;default:return{}}}function u(g){return g.geometry=l(g.geometry),g}function d(g){return g.features=g.features.map(u),g}function m(g){return g.geometries=g.geometries.map(l),g}if(!e)return e;switch(e.type){case"Feature":return u(e);case"GeometryCollection":return m(e);case"FeatureCollection":return d(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiPolygon":case"MultiLineString":return l(e);default:return e}}oT.exports=t,oT.exports.parse=t})()});var HF=Ui((mMe,$F)=>{function Xg(t){return typeof t=="object"&&t!==null}function RW(t,e){Array.isArray(t)?t.forEach(e):Xg(t)&&Object.keys(t).forEach(function(i){var r=t[i];e(r,i)})}function GF(t){var e=0;return Array.isArray(t)||Xg(t)?(RW(t,function(i){if(Array.isArray(i)||Xg(i)){var r=GF(i);r>e&&(e=r)}}),e+1):e}function DW(t,e){e=e||{};var i=JSON.stringify([1],null,e4(e,"indent",2)).slice(2,-3),r=e4(e,"margins",!1),s=e4(e,"arrayMargins",!1),n=e4(e,"objectMargins",!1),o=i===""?1/0:e4(e,"maxLength",80),a=e4(e,"maxNesting",1/0);return function l(u,d,m){u&&typeof u.toJSON=="function"&&(u=u.toJSON());var g=JSON.stringify(u);if(g===void 0)return g;var _=o-d.length-m,v=GF(u);if(v<=a&&g.length<=_){var E=LW(g,{addMargin:r,addArrayMargin:s,addObjectMargin:n});if(E.length<=_)return E}if(Xg(u)){var b=d+i,T=[],A,M=function(F,O){return O===F.length-1?0:1};if(Array.isArray(u)){for(var k=0;k<u.length;k++)T.push(l(u[k],b,M(u,k))||"null");A="[]"}else Object.keys(u).forEach(function(F,O,B){var U=JSON.stringify(F)+": ",$=l(u[F],b,U.length+M(B,O));$!==void 0&&T.push(U+$)}),A="{}";if(T.length>0)return[A[0],i+T.join(`,
`+b),A[1]].join(`
`+d)}return g}(t,"",0)}var FW=/("(?:[^\\"]|\\.)*")|[:,\][}{]/g;function LW(t,e){e=e||{};var i={"{":"{","}":"}","[":"[","]":"]",",":", ",":":": "};return(e.addMargin||e.addObjectMargin)&&(i["{"]="{ ",i["}"]=" }"),(e.addMargin||e.addArrayMargin)&&(i["["]="[ ",i["]"]=" ]"),t.replace(FW,function(r,s){return s?r:i[r]})}function e4(t,e,i){return e in t?t[e]:i}$F.exports=DW});var eN=Ui((Rje,WT)=>{"use strict";WT.exports=n6;WT.exports.default=n6;function n6(t,e){if(!(this instanceof n6))return new n6(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||HY,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function HY(t,e){return t<e?-1:t>e?1:0}n6.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,i=this.compare,r=e[t];t>0;){var s=t-1>>1,n=e[s];if(i(r,n)>=0)break;e[t]=n,t=s}e[t]=r},_down:function(t){for(var e=this.data,i=this.compare,r=this.length>>1,s=e[t];t<r;){var n=(t<<1)+1,o=n+1,a=e[n];if(o<this.length&&i(e[o],a)<0&&(n=o,a=e[o]),i(a,s)>=0)break;e[t]=a,t=n}e[t]=s}}});var iN=Ui((Dje,qT)=>{"use strict";var VY=eN();qT.exports=tN;qT.exports.default=tN;function tN(t,e,i){e=e||1;for(var r,s,n,o,a=0;a<t[0].length;a++){var l=t[0][a];(!a||l[0]<r)&&(r=l[0]),(!a||l[1]<s)&&(s=l[1]),(!a||l[0]>n)&&(n=l[0]),(!a||l[1]>o)&&(o=l[1])}var u=n-r,d=o-s,m=Math.min(u,d),g=m/2,_=new VY(null,jY);if(m===0)return[r,s];for(var v=r;v<n;v+=m)for(var E=s;E<o;E+=m)_.push(new ph(v+g,E+g,g,t));var b=WY(t),T=new ph(r+u/2,s+d/2,0,t);T.d>b.d&&(b=T);for(var A=_.length;_.length;){var M=_.pop();M.d>b.d&&(b=M,i&&console.log("found best %d after %d probes",Math.round(1e4*M.d)/1e4,A)),!(M.max-b.d<=e)&&(g=M.h/2,_.push(new ph(M.x-g,M.y-g,g,t)),_.push(new ph(M.x+g,M.y-g,g,t)),_.push(new ph(M.x-g,M.y+g,g,t)),_.push(new ph(M.x+g,M.y+g,g,t)),A+=4)}return i&&(console.log("num probes: "+A),console.log("best distance: "+b.d)),[b.x,b.y]}function jY(t,e){return e.max-t.max}function ph(t,e,i,r){this.x=t,this.y=e,this.h=i,this.d=XY(t,e,r),this.max=this.d+this.h*Math.SQRT2}function XY(t,e,i){for(var r=!1,s=1/0,n=0;n<i.length;n++)for(var o=i[n],a=0,l=o.length,u=l-1;a<l;u=a++){var d=o[a],m=o[u];d[1]>e!=m[1]>e&&t<(m[0]-d[0])*(e-d[1])/(m[1]-d[1])+d[0]&&(r=!r),s=Math.min(s,qY(t,e,d,m))}return(r?1:-1)*Math.sqrt(s)}function WY(t){for(var e=0,i=0,r=0,s=t[0],n=0,o=s.length,a=o-1;n<o;a=n++){var l=s[n],u=s[a],d=l[0]*u[1]-u[0]*l[1];i+=(l[0]+u[0])*d,r+=(l[1]+u[1])*d,e+=d*3}return e===0?new ph(s[0][0],s[0][1],0,t):new ph(i/e,r/e,0,t)}function qY(t,e,i,r){var s=i[0],n=i[1],o=r[0]-s,a=r[1]-n;if(o!==0||a!==0){var l=((t-s)*o+(e-n)*a)/(o*o+a*a);l>1?(s=r[0],n=r[1]):l>0&&(s+=o*l,n+=a*l)}return o=t-s,a=e-n,o*o+a*a}});var a6=Ui((PXe,lN)=>{lN.exports=$y;function $y(t,e){var i=t&&t.type,r;if(i==="FeatureCollection")for(r=0;r<t.features.length;r++)$y(t.features[r],e);else if(i==="GeometryCollection")for(r=0;r<t.geometries.length;r++)$y(t.geometries[r],e);else if(i==="Feature")$y(t.geometry,e);else if(i==="Polygon")oN(t.coordinates,e);else if(i==="MultiPolygon")for(r=0;r<t.coordinates.length;r++)oN(t.coordinates[r],e);return t}function oN(t,e){if(t.length!==0){aN(t[0],e);for(var i=1;i<t.length;i++)aN(t[i],!e)}}function aN(t,e){for(var i=0,r=0,s=0,n=t.length,o=n-1;s<n;o=s++){var a=(t[s][0]-t[o][0])*(t[o][1]+t[s][1]),l=i+a;r+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+r>=0!=!!e&&t.reverse()}});var DN=Ui((cS,uS)=>{(function(t,e){typeof cS=="object"&&typeof uS<"u"?uS.exports=e():typeof define=="function"&&define.amd?define(e):(t=typeof globalThis<"u"?globalThis:t||self,t.maplibregl=e())})(cS,function(){"use strict";var t,e,i;function r(n,o){if(!t)t=o;else if(!e)e=o;else{var a="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",l={};t(l),i=o(l),typeof window<"u"&&(i.workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}}r(["exports"],function(n){"use strict";function o(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var a=l;function l(p,c){this.x=p,this.y=c}l.prototype={clone:function(){return new l(this.x,this.y)},add:function(p){return this.clone()._add(p)},sub:function(p){return this.clone()._sub(p)},multByPoint:function(p){return this.clone()._multByPoint(p)},divByPoint:function(p){return this.clone()._divByPoint(p)},mult:function(p){return this.clone()._mult(p)},div:function(p){return this.clone()._div(p)},rotate:function(p){return this.clone()._rotate(p)},rotateAround:function(p,c){return this.clone()._rotateAround(p,c)},matMult:function(p){return this.clone()._matMult(p)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(p){return this.x===p.x&&this.y===p.y},dist:function(p){return Math.sqrt(this.distSqr(p))},distSqr:function(p){var c=p.x-this.x,y=p.y-this.y;return c*c+y*y},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(p){return Math.atan2(this.y-p.y,this.x-p.x)},angleWith:function(p){return this.angleWithSep(p.x,p.y)},angleWithSep:function(p,c){return Math.atan2(this.x*c-this.y*p,this.x*p+this.y*c)},_matMult:function(p){var c=p[2]*this.x+p[3]*this.y;return this.x=p[0]*this.x+p[1]*this.y,this.y=c,this},_add:function(p){return this.x+=p.x,this.y+=p.y,this},_sub:function(p){return this.x-=p.x,this.y-=p.y,this},_mult:function(p){return this.x*=p,this.y*=p,this},_div:function(p){return this.x/=p,this.y/=p,this},_multByPoint:function(p){return this.x*=p.x,this.y*=p.y,this},_divByPoint:function(p){return this.x/=p.x,this.y/=p.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var p=this.y;return this.y=this.x,this.x=-p,this},_rotate:function(p){var c=Math.cos(p),y=Math.sin(p),w=y*this.x+c*this.y;return this.x=c*this.x-y*this.y,this.y=w,this},_rotateAround:function(p,c){var y=Math.cos(p),w=Math.sin(p),C=c.y+w*(this.x-c.x)+y*(this.y-c.y);return this.x=c.x+y*(this.x-c.x)-w*(this.y-c.y),this.y=C,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},l.convert=function(p){return p instanceof l?p:Array.isArray(p)?new l(p[0],p[1]):p};var u=o(a),d=m;function m(p,c,y,w){this.cx=3*p,this.bx=3*(y-p)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(w-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=p,this.p1y=c,this.p2x=y,this.p2y=w}m.prototype={sampleCurveX:function(p){return((this.ax*p+this.bx)*p+this.cx)*p},sampleCurveY:function(p){return((this.ay*p+this.by)*p+this.cy)*p},sampleCurveDerivativeX:function(p){return(3*this.ax*p+2*this.bx)*p+this.cx},solveCurveX:function(p,c){if(c===void 0&&(c=1e-6),p<0)return 0;if(p>1)return 1;for(var y=p,w=0;w<8;w++){var C=this.sampleCurveX(y)-p;if(Math.abs(C)<c)return y;var R=this.sampleCurveDerivativeX(y);if(Math.abs(R)<1e-6)break;y-=C/R}var N=0,z=1;for(y=p,w=0;w<20&&(C=this.sampleCurveX(y),!(Math.abs(C-p)<c));w++)p>C?N=y:z=y,y=.5*(z-N)+N;return y},solve:function(p,c){return this.sampleCurveY(this.solveCurveX(p,c))}};var g=o(d);function _(p,c,y,w){let C=new g(p,c,y,w);return function(R){return C.solve(R)}}let v=_(.25,.1,.25,1);function E(p,c,y){return Math.min(y,Math.max(c,p))}function b(p,c,y){let w=y-c,C=((p-c)%w+w)%w+c;return C===c?y:C}function T(p,...c){for(let y of c)for(let w in y)p[w]=y[w];return p}let A=1;function M(p,c,y){let w={};for(let C in p)w[C]=c.call(y||this,p[C],C,p);return w}function k(p,c,y){let w={};for(let C in p)c.call(y||this,p[C],C,p)&&(w[C]=p[C]);return w}function F(p){return Array.isArray(p)?p.map(F):typeof p=="object"&&p?M(p,F):p}let O={};function B(p){O[p]||(typeof console<"u"&&console.warn(p),O[p]=!0)}function U(p,c,y){return(y.y-p.y)*(c.x-p.x)>(c.y-p.y)*(y.x-p.x)}function $(p){let c=0;for(let y,w,C=0,R=p.length,N=R-1;C<R;N=C++)y=p[C],w=p[N],c+=(w.x-y.x)*(y.y+w.y);return c}function q(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let W=null;function Z(p){if(W==null){let c=p.navigator?p.navigator.userAgent:null;W=!!p.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return W}function Q(p){return typeof ImageBitmap<"u"&&p instanceof ImageBitmap}let X="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",ce,de,le={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(p){let c=requestAnimationFrame(p);return{cancel:()=>cancelAnimationFrame(c)}},getImageData(p,c=0){return this.getImageCanvasContext(p).getImageData(-c,-c,p.width+2*c,p.height+2*c)},getImageCanvasContext(p){let c=window.document.createElement("canvas"),y=c.getContext("2d",{willReadFrequently:!0});if(!y)throw new Error("failed to create canvas 2d context");return c.width=p.width,c.height=p.height,y.drawImage(p,0,0,p.width,p.height),y},resolveURL:p=>(ce||(ce=document.createElement("a")),ce.href=p,ce.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(de==null&&(de=matchMedia("(prefers-reduced-motion: reduce)")),de.matches)}},te={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class ee extends Error{constructor(c,y,w,C){super(`AJAXError: ${y} (${c}): ${w}`),this.status=c,this.statusText=y,this.url=w,this.body=C}}let oe=q()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,ie=p=>te.REGISTERED_PROTOCOLS[p.substring(0,p.indexOf("://"))];function ne(p,c){let y=new AbortController,w=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:oe(),signal:y.signal}),C=!1,R=!1;return p.type==="json"&&w.headers.set("Accept","application/json"),R||fetch(w).then(N=>N.ok?(z=>{(p.type==="arrayBuffer"||p.type==="image"?z.arrayBuffer():p.type==="json"?z.json():z.text()).then(V=>{R||(C=!0,c(null,V,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(V=>{R||c(new Error(V.message))})})(N):N.blob().then(z=>c(new ee(N.status,N.statusText,p.url,z)))).catch(N=>{N.code!==20&&c(new Error(N.message))}),{cancel:()=>{R=!0,C||y.abort()}}}let me=function(p,c){if(/:\/\//.test(p.url)&&!/^https?:|^file:/.test(p.url)){if(q()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",p,c);if(!q())return(ie(p.url)||ne)(p,c)}if(!(/^file:/.test(y=p.url)||/^file:/.test(oe())&&!/^\w+:/.test(y))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ne(p,c);if(q()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",p,c,void 0,!0)}var y;return function(w,C){let R=new XMLHttpRequest;R.open(w.method||"GET",w.url,!0),w.type!=="arrayBuffer"&&w.type!=="image"||(R.responseType="arraybuffer");for(let N in w.headers)R.setRequestHeader(N,w.headers[N]);return w.type==="json"&&(R.responseType="text",R.setRequestHeader("Accept","application/json")),R.withCredentials=w.credentials==="include",R.onerror=()=>{C(new Error(R.statusText))},R.onload=()=>{if((R.status>=200&&R.status<300||R.status===0)&&R.response!==null){let N=R.response;if(w.type==="json")try{N=JSON.parse(R.response)}catch(z){return C(z)}C(null,N,R.getResponseHeader("Cache-Control"),R.getResponseHeader("Expires"))}else{let N=new Blob([R.response],{type:R.getResponseHeader("Content-Type")});C(new ee(R.status,R.statusText,w.url,N))}},R.send(w.body),{cancel:()=>R.abort()}}(p,c)},De=function(p,c){return me(T(p,{type:"arrayBuffer"}),c)};function He(p){if(!p||p.indexOf("://")<=0||p.indexOf("data:image/")===0||p.indexOf("blob:")===0)return!0;let c=new URL(p),y=window.location;return c.protocol===y.protocol&&c.host===y.host}function Je(p,c,y){y[p]&&y[p].indexOf(c)!==-1||(y[p]=y[p]||[],y[p].push(c))}function ot(p,c,y){if(y&&y[p]){let w=y[p].indexOf(c);w!==-1&&y[p].splice(w,1)}}class gt{constructor(c,y={}){T(this,y),this.type=c}}class vt extends gt{constructor(c,y={}){super("error",T({error:c},y))}}class ct{on(c,y){return this._listeners=this._listeners||{},Je(c,y,this._listeners),this}off(c,y){return ot(c,y,this._listeners),ot(c,y,this._oneTimeListeners),this}once(c,y){return y?(this._oneTimeListeners=this._oneTimeListeners||{},Je(c,y,this._oneTimeListeners),this):new Promise(w=>this.once(c,w))}fire(c,y){typeof c=="string"&&(c=new gt(c,y||{}));let w=c.type;if(this.listens(w)){c.target=this;let C=this._listeners&&this._listeners[w]?this._listeners[w].slice():[];for(let z of C)z.call(this,c);let R=this._oneTimeListeners&&this._oneTimeListeners[w]?this._oneTimeListeners[w].slice():[];for(let z of R)ot(w,z,this._oneTimeListeners),z.call(this,c);let N=this._eventedParent;N&&(T(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),N.fire(c))}else c instanceof vt&&console.error(c.error);return this}listens(c){return this._listeners&&this._listeners[c]&&this._listeners[c].length>0||this._oneTimeListeners&&this._oneTimeListeners[c]&&this._oneTimeListeners[c].length>0||this._eventedParent&&this._eventedParent.listens(c)}setEventedParent(c,y){return this._eventedParent=c,this._eventedParentData=y,this}}var Se={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let Qe=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function xt(p,c){let y={};for(let w in p)w!=="ref"&&(y[w]=p[w]);return Qe.forEach(w=>{w in c&&(y[w]=c[w])}),y}function It(p,c){if(Array.isArray(p)){if(!Array.isArray(c)||p.length!==c.length)return!1;for(let y=0;y<p.length;y++)if(!It(p[y],c[y]))return!1;return!0}if(typeof p=="object"&&p!==null&&c!==null){if(typeof c!="object"||Object.keys(p).length!==Object.keys(c).length)return!1;for(let y in p)if(!It(p[y],c[y]))return!1;return!0}return p===c}let Gt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ni(p,c,y){y.push({command:Gt.addSource,args:[p,c[p]]})}function je(p,c,y){c.push({command:Gt.removeSource,args:[p]}),y[p]=!0}function be(p,c,y,w){je(p,y,w),Ni(p,c,y)}function ge(p,c,y){let w;for(w in p[y])if(Object.prototype.hasOwnProperty.call(p[y],w)&&w!=="data"&&!It(p[y][w],c[y][w]))return!1;for(w in c[y])if(Object.prototype.hasOwnProperty.call(c[y],w)&&w!=="data"&&!It(p[y][w],c[y][w]))return!1;return!0}function xe(p,c,y,w,C,R){let N;for(N in c=c||{},p=p||{})Object.prototype.hasOwnProperty.call(p,N)&&(It(p[N],c[N])||y.push({command:R,args:[w,N,c[N],C]}));for(N in c)Object.prototype.hasOwnProperty.call(c,N)&&!Object.prototype.hasOwnProperty.call(p,N)&&(It(p[N],c[N])||y.push({command:R,args:[w,N,c[N],C]}))}function Pe(p){return p.id}function Oe(p,c){return p[c.id]=c,p}class Ie{constructor(c,y,w,C){this.message=(c?`${c}: `:"")+w,C&&(this.identifier=C),y!=null&&y.__line__&&(this.line=y.__line__)}}function nt(p,...c){for(let y of c)for(let w in y)p[w]=y[w];return p}class ht extends Error{constructor(c,y){super(y),this.message=y,this.key=c}}class Ht{constructor(c,y=[]){this.parent=c,this.bindings={};for(let[w,C]of y)this.bindings[w]=C}concat(c){return new Ht(this,c)}get(c){if(this.bindings[c])return this.bindings[c];if(this.parent)return this.parent.get(c);throw new Error(`${c} not found in scope.`)}has(c){return!!this.bindings[c]||!!this.parent&&this.parent.has(c)}}let hi={kind:"null"},at={kind:"number"},Ot={kind:"string"},Pt={kind:"boolean"},Zi={kind:"color"},ji={kind:"object"},Ke={kind:"value"},dt={kind:"collator"},Lt={kind:"formatted"},Yt={kind:"padding"},Kt={kind:"resolvedImage"},Fi={kind:"variableAnchorOffsetCollection"};function Ir(p,c){return{kind:"array",itemType:p,N:c}}function Qi(p){if(p.kind==="array"){let c=Qi(p.itemType);return typeof p.N=="number"?`array<${c}, ${p.N}>`:p.itemType.kind==="value"?"array":`array<${c}>`}return p.kind}let ys=[hi,at,Ot,Pt,Zi,Lt,ji,Ir(Ke),Yt,Kt,Fi];function ls(p,c){if(c.kind==="error")return null;if(p.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!ls(p.itemType,c.itemType))&&(typeof p.N!="number"||p.N===c.N))return null}else{if(p.kind===c.kind)return null;if(p.kind==="value"){for(let y of ys)if(!ls(y,c))return null}}return`Expected ${Qi(p)} but found ${Qi(c)} instead.`}function Me(p,c){return c.some(y=>y.kind===p.kind)}function he(p,c){return c.some(y=>y==="null"?p===null:y==="array"?Array.isArray(p):y==="object"?p&&!Array.isArray(p)&&typeof p=="object":y===typeof p)}function pe(p,c){return p.kind==="array"&&c.kind==="array"?p.itemType.kind===c.itemType.kind&&typeof p.N=="number":p.kind===c.kind}let Ee=.96422,Fe=.82521,Ue=4/29,We=6/29,Ge=3*We*We,ze=We*We*We,Ze=Math.PI/180,_t=180/Math.PI;function bt(p){return(p%=360)<0&&(p+=360),p}function wt([p,c,y,w]){let C,R,N=$i((.2225045*(p=wi(p))+.7168786*(c=wi(c))+.0606169*(y=wi(y)))/1);p===c&&c===y?C=R=N:(C=$i((.4360747*p+.3850649*c+.1430804*y)/Ee),R=$i((.0139322*p+.0971045*c+.7141733*y)/Fe));let z=116*N-16;return[z<0?0:z,500*(C-N),200*(N-R),w]}function wi(p){return p<=.04045?p/12.92:Math.pow((p+.055)/1.055,2.4)}function $i(p){return p>ze?Math.pow(p,1/3):p/Ge+Ue}function ni([p,c,y,w]){let C=(p+16)/116,R=isNaN(c)?C:C+c/500,N=isNaN(y)?C:C-y/200;return C=1*Bi(C),R=Ee*Bi(R),N=Fe*Bi(N),[gi(3.1338561*R-1.6168667*C-.4906146*N),gi(-.9787684*R+1.9161415*C+.033454*N),gi(.0719453*R-.2289914*C+1.4052427*N),w]}function gi(p){return(p=p<=.00304?12.92*p:1.055*Math.pow(p,1/2.4)-.055)<0?0:p>1?1:p}function Bi(p){return p>We?p*p*p:Ge*(p-Ue)}function xr(p){return parseInt(p.padEnd(2,p),16)/255}function Lr(p,c){return cr(c?p/100:p,0,1)}function cr(p,c,y){return Math.min(Math.max(c,p),y)}function yr(p){return!p.some(Number.isNaN)}let so={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Pi{constructor(c,y,w,C=1,R=!0){this.r=c,this.g=y,this.b=w,this.a=C,R||(this.r*=C,this.g*=C,this.b*=C,C||this.overwriteGetter("rgb",[c,y,w,C]))}static parse(c){if(c instanceof Pi)return c;if(typeof c!="string")return;let y=function(w){if((w=w.toLowerCase().trim())==="transparent")return[0,0,0,0];let C=so[w];if(C){let[N,z,V]=C;return[N/255,z/255,V/255,1]}if(w.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(w)){let N=w.length<6?1:2,z=1;return[xr(w.slice(z,z+=N)),xr(w.slice(z,z+=N)),xr(w.slice(z,z+=N)),xr(w.slice(z,z+N)||"ff")]}if(w.startsWith("rgb")){let N=w.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(N){let[z,V,K,se,ue,fe,ve,we,ke,Le,Be,qe]=N,$e=[se||" ",ve||" ",Le].join("");if($e==="  "||$e==="  /"||$e===",,"||$e===",,,"){let et=[K,fe,ke].join(""),it=et==="%%%"?100:et===""?255:0;if(it){let pt=[cr(+V/it,0,1),cr(+ue/it,0,1),cr(+we/it,0,1),Be?Lr(+Be,qe):1];if(yr(pt))return pt}}return}}let R=w.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(R){let[N,z,V,K,se,ue,fe,ve,we]=R,ke=[V||" ",se||" ",fe].join("");if(ke==="  "||ke==="  /"||ke===",,"||ke===",,,"){let Le=[+z,cr(+K,0,100),cr(+ue,0,100),ve?Lr(+ve,we):1];if(yr(Le))return function([Be,qe,$e,et]){function it(pt){let Xt=(pt+Be/30)%12,ai=qe*Math.min($e,1-$e);return $e-ai*Math.max(-1,Math.min(Xt-3,9-Xt,1))}return Be=bt(Be),qe/=100,$e/=100,[it(0),it(8),it(4),et]}(Le)}}}(c);return y?new Pi(...y,!1):void 0}get rgb(){let{r:c,g:y,b:w,a:C}=this,R=C||1/0;return this.overwriteGetter("rgb",[c/R,y/R,w/R,C])}get hcl(){return this.overwriteGetter("hcl",function(c){let[y,w,C,R]=wt(c),N=Math.sqrt(w*w+C*C);return[Math.round(1e4*N)?bt(Math.atan2(C,w)*_t):NaN,N,y,R]}(this.rgb))}get lab(){return this.overwriteGetter("lab",wt(this.rgb))}overwriteGetter(c,y){return Object.defineProperty(this,c,{value:y}),y}toString(){let[c,y,w,C]=this.rgb;return`rgba(${[c,y,w].map(R=>Math.round(255*R)).join(",")},${C})`}}Pi.black=new Pi(0,0,0,1),Pi.white=new Pi(1,1,1,1),Pi.transparent=new Pi(0,0,0,0),Pi.red=new Pi(1,0,0,1);class Hs{constructor(c,y,w){this.sensitivity=c?y?"variant":"case":y?"accent":"base",this.locale=w,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(c,y){return this.collator.compare(c,y)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Tn{constructor(c,y,w,C,R){this.text=c,this.image=y,this.scale=w,this.fontStack=C,this.textColor=R}}class Is{constructor(c){this.sections=c}static fromString(c){return new Is([new Tn(c,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(c=>c.text.length!==0||c.image&&c.image.name.length!==0)}static factory(c){return c instanceof Is?c:Is.fromString(c)}toString(){return this.sections.length===0?"":this.sections.map(c=>c.text).join("")}}class wo{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof wo)return c;if(typeof c=="number")return new wo([c,c,c,c]);if(Array.isArray(c)&&!(c.length<1||c.length>4)){for(let y of c)if(typeof y!="number")return;switch(c.length){case 1:c=[c[0],c[0],c[0],c[0]];break;case 2:c=[c[0],c[1],c[0],c[1]];break;case 3:c=[c[0],c[1],c[2],c[1]]}return new wo(c)}}toString(){return JSON.stringify(this.values)}}let Yx=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Dn{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Dn)return c;if(Array.isArray(c)&&!(c.length<1)&&c.length%2==0){for(let y=0;y<c.length;y+=2){let w=c[y],C=c[y+1];if(typeof w!="string"||!Yx.has(w)||!Array.isArray(C)||C.length!==2||typeof C[0]!="number"||typeof C[1]!="number")return}return new Dn(c)}}toString(){return JSON.stringify(this.values)}}class na{constructor(c){this.name=c.name,this.available=c.available}toString(){return this.name}static fromString(c){return c?new na({name:c,available:!1}):null}}function _7(p,c,y,w){return typeof p=="number"&&p>=0&&p<=255&&typeof c=="number"&&c>=0&&c<=255&&typeof y=="number"&&y>=0&&y<=255?w===void 0||typeof w=="number"&&w>=0&&w<=1?null:`Invalid rgba value [${[p,c,y,w].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof w=="number"?[p,c,y,w]:[p,c,y]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function v0(p){if(p===null||typeof p=="string"||typeof p=="boolean"||typeof p=="number"||p instanceof Pi||p instanceof Hs||p instanceof Is||p instanceof wo||p instanceof Dn||p instanceof na)return!0;if(Array.isArray(p)){for(let c of p)if(!v0(c))return!1;return!0}if(typeof p=="object"){for(let c in p)if(!v0(p[c]))return!1;return!0}return!1}function ks(p){if(p===null)return hi;if(typeof p=="string")return Ot;if(typeof p=="boolean")return Pt;if(typeof p=="number")return at;if(p instanceof Pi)return Zi;if(p instanceof Hs)return dt;if(p instanceof Is)return Lt;if(p instanceof wo)return Yt;if(p instanceof Dn)return Fi;if(p instanceof na)return Kt;if(Array.isArray(p)){let c=p.length,y;for(let w of p){let C=ks(w);if(y){if(y===C)continue;y=Ke;break}y=C}return Ir(y||Ke,c)}return ji}function gc(p){let c=typeof p;return p===null?"":c==="string"||c==="number"||c==="boolean"?String(p):p instanceof Pi||p instanceof Is||p instanceof wo||p instanceof Dn||p instanceof na?p.toString():JSON.stringify(p)}class eu{constructor(c,y){this.type=c,this.value=y}static parse(c,y){if(c.length!==2)return y.error(`'literal' expression requires exactly one argument, but found ${c.length-1} instead.`);if(!v0(c[1]))return y.error("invalid value");let w=c[1],C=ks(w),R=y.expectedType;return C.kind!=="array"||C.N!==0||!R||R.kind!=="array"||typeof R.N=="number"&&R.N!==0||(C=R),new eu(C,w)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ms{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}}let b0={string:Ot,number:at,boolean:Pt,object:ji};class Fn{constructor(c,y){this.type=c,this.args=y}static parse(c,y){if(c.length<2)return y.error("Expected at least one argument.");let w,C=1,R=c[0];if(R==="array"){let z,V;if(c.length>2){let K=c[1];if(typeof K!="string"||!(K in b0)||K==="object")return y.error('The item type argument of "array" must be one of string, number, boolean',1);z=b0[K],C++}else z=Ke;if(c.length>3){if(c[2]!==null&&(typeof c[2]!="number"||c[2]<0||c[2]!==Math.floor(c[2])))return y.error('The length argument to "array" must be a positive integer literal',2);V=c[2],C++}w=Ir(z,V)}else{if(!b0[R])throw new Error(`Types doesn't contain name = ${R}`);w=b0[R]}let N=[];for(;C<c.length;C++){let z=y.parse(c[C],C,Ke);if(!z)return null;N.push(z)}return new Fn(w,N)}evaluate(c){for(let y=0;y<this.args.length;y++){let w=this.args[y].evaluate(c);if(!ls(this.type,ks(w)))return w;if(y===this.args.length-1)throw new Ms(`Expected value to be of type ${Qi(this.type)}, but found ${Qi(ks(w))} instead.`)}throw new Error}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}let w0={"to-boolean":Pt,"to-color":Zi,"to-number":at,"to-string":Ot};class ol{constructor(c,y){this.type=c,this.args=y}static parse(c,y){if(c.length<2)return y.error("Expected at least one argument.");let w=c[0];if(!w0[w])throw new Error(`Can't parse ${w} as it is not part of the known types`);if((w==="to-boolean"||w==="to-string")&&c.length!==2)return y.error("Expected one argument.");let C=w0[w],R=[];for(let N=1;N<c.length;N++){let z=y.parse(c[N],N,Ke);if(!z)return null;R.push(z)}return new ol(C,R)}evaluate(c){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(c);case"color":{let y,w;for(let C of this.args){if(y=C.evaluate(c),w=null,y instanceof Pi)return y;if(typeof y=="string"){let R=c.parseColor(y);if(R)return R}else if(Array.isArray(y)&&(w=y.length<3||y.length>4?`Invalid rbga value ${JSON.stringify(y)}: expected an array containing either three or four numeric values.`:_7(y[0],y[1],y[2],y[3]),!w))return new Pi(y[0]/255,y[1]/255,y[2]/255,y[3])}throw new Ms(w||`Could not parse color from value '${typeof y=="string"?y:JSON.stringify(y)}'`)}case"padding":{let y;for(let w of this.args){y=w.evaluate(c);let C=wo.parse(y);if(C)return C}throw new Ms(`Could not parse padding from value '${typeof y=="string"?y:JSON.stringify(y)}'`)}case"variableAnchorOffsetCollection":{let y;for(let w of this.args){y=w.evaluate(c);let C=Dn.parse(y);if(C)return C}throw new Ms(`Could not parse variableAnchorOffsetCollection from value '${typeof y=="string"?y:JSON.stringify(y)}'`)}case"number":{let y=null;for(let w of this.args){if(y=w.evaluate(c),y===null)return 0;let C=Number(y);if(!isNaN(C))return C}throw new Ms(`Could not convert ${JSON.stringify(y)} to number.`)}case"formatted":return Is.fromString(gc(this.args[0].evaluate(c)));case"resolvedImage":return na.fromString(gc(this.args[0].evaluate(c)));default:return gc(this.args[0].evaluate(c))}}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}let bh=["Unknown","Point","LineString","Polygon"];class Rr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?bh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(c){let y=this._parseColorCache[c];return y||(y=this._parseColorCache[c]=Pi.parse(c)),y}}class E0{constructor(c,y,w=[],C,R=new Ht,N=[]){this.registry=c,this.path=w,this.key=w.map(z=>`[${z}]`).join(""),this.scope=R,this.errors=N,this.expectedType=C,this._isConstant=y}parse(c,y,w,C,R={}){return y?this.concat(y,w,C)._parse(c,R):this._parse(c,R)}_parse(c,y){function w(C,R,N){return N==="assert"?new Fn(R,[C]):N==="coerce"?new ol(R,[C]):C}if(c!==null&&typeof c!="string"&&typeof c!="boolean"&&typeof c!="number"||(c=["literal",c]),Array.isArray(c)){if(c.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let C=c[0];if(typeof C!="string")return this.error(`Expression name must be a string, but found ${typeof C} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let R=this.registry[C];if(R){let N=R.parse(c,this);if(!N)return null;if(this.expectedType){let z=this.expectedType,V=N.type;if(z.kind!=="string"&&z.kind!=="number"&&z.kind!=="boolean"&&z.kind!=="object"&&z.kind!=="array"||V.kind!=="value")if(z.kind!=="color"&&z.kind!=="formatted"&&z.kind!=="resolvedImage"||V.kind!=="value"&&V.kind!=="string")if(z.kind!=="padding"||V.kind!=="value"&&V.kind!=="number"&&V.kind!=="array")if(z.kind!=="variableAnchorOffsetCollection"||V.kind!=="value"&&V.kind!=="array"){if(this.checkSubtype(z,V))return null}else N=w(N,z,y.typeAnnotation||"coerce");else N=w(N,z,y.typeAnnotation||"coerce");else N=w(N,z,y.typeAnnotation||"coerce");else N=w(N,z,y.typeAnnotation||"assert")}if(!(N instanceof eu)&&N.type.kind!=="resolvedImage"&&this._isConstant(N)){let z=new Rr;try{N=new eu(N.type,N.evaluate(z))}catch(V){return this.error(V.message),null}}return N}return this.error(`Unknown expression "${C}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(c===void 0?"'undefined' value invalid. Use null instead.":typeof c=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof c} instead.`)}concat(c,y,w){let C=typeof c=="number"?this.path.concat(c):this.path,R=w?this.scope.concat(w):this.scope;return new E0(this.registry,this._isConstant,C,y||null,R,this.errors)}error(c,...y){let w=`${this.key}${y.map(C=>`[${C}]`).join("")}`;this.errors.push(new ht(w,c))}checkSubtype(c,y){let w=ls(c,y);return w&&this.error(w),w}}class o1{constructor(c,y,w){this.type=dt,this.locale=w,this.caseSensitive=c,this.diacriticSensitive=y}static parse(c,y){if(c.length!==2)return y.error("Expected one argument.");let w=c[1];if(typeof w!="object"||Array.isArray(w))return y.error("Collator options argument must be an object.");let C=y.parse(w["case-sensitive"]!==void 0&&w["case-sensitive"],1,Pt);if(!C)return null;let R=y.parse(w["diacritic-sensitive"]!==void 0&&w["diacritic-sensitive"],1,Pt);if(!R)return null;let N=null;return w.locale&&(N=y.parse(w.locale,1,Ot),!N)?null:new o1(C,R,N)}evaluate(c){return new Hs(this.caseSensitive.evaluate(c),this.diacriticSensitive.evaluate(c),this.locale?this.locale.evaluate(c):null)}eachChild(c){c(this.caseSensitive),c(this.diacriticSensitive),this.locale&&c(this.locale)}outputDefined(){return!1}}let yc=8192;function T0(p,c){p[0]=Math.min(p[0],c[0]),p[1]=Math.min(p[1],c[1]),p[2]=Math.max(p[2],c[0]),p[3]=Math.max(p[3],c[1])}function wh(p,c){return!(p[0]<=c[0]||p[2]>=c[2]||p[1]<=c[1]||p[3]>=c[3])}function Zx(p,c){let y=(180+p[0])/360,w=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+p[1]*Math.PI/360)))/360,C=Math.pow(2,c.z);return[Math.round(y*C*yc),Math.round(w*C*yc)]}function x7(p,c,y){let w=p[0]-c[0],C=p[1]-c[1],R=p[0]-y[0],N=p[1]-y[1];return w*N-R*C==0&&w*R<=0&&C*N<=0}function S0(p,c){let y=!1;for(let N=0,z=c.length;N<z;N++){let V=c[N];for(let K=0,se=V.length;K<se-1;K++){if(x7(p,V[K],V[K+1]))return!1;(C=V[K])[1]>(w=p)[1]!=(R=V[K+1])[1]>w[1]&&w[0]<(R[0]-C[0])*(w[1]-C[1])/(R[1]-C[1])+C[0]&&(y=!y)}}var w,C,R;return y}function Qx(p,c){for(let y=0;y<c.length;y++)if(S0(p,c[y]))return!0;return!1}function v7(p,c,y,w){let C=w[0]-y[0],R=w[1]-y[1],N=(p[0]-y[0])*R-C*(p[1]-y[1]),z=(c[0]-y[0])*R-C*(c[1]-y[1]);return N>0&&z<0||N<0&&z>0}function Kx(p,c,y){for(let K of y)for(let se=0;se<K.length-1;++se)if((z=[(N=K[se+1])[0]-(R=K[se])[0],N[1]-R[1]])[0]*(V=[(C=c)[0]-(w=p)[0],C[1]-w[1]])[1]-z[1]*V[0]!=0&&v7(w,C,R,N)&&v7(R,N,w,C))return!0;var w,C,R,N,z,V;return!1}function b7(p,c){for(let y=0;y<p.length;++y)if(!S0(p[y],c))return!1;for(let y=0;y<p.length-1;++y)if(Kx(p[y],p[y+1],c))return!1;return!0}function w7(p,c){for(let y=0;y<c.length;y++)if(b7(p,c[y]))return!0;return!1}function A0(p,c,y){let w=[];for(let C=0;C<p.length;C++){let R=[];for(let N=0;N<p[C].length;N++){let z=Zx(p[C][N],y);T0(c,z),R.push(z)}w.push(R)}return w}function E7(p,c,y){let w=[];for(let C=0;C<p.length;C++){let R=A0(p[C],c,y);w.push(R)}return w}function T7(p,c,y,w){if(p[0]<y[0]||p[0]>y[2]){let C=.5*w,R=p[0]-y[0]>C?-w:y[0]-p[0]>C?w:0;R===0&&(R=p[0]-y[2]>C?-w:y[2]-p[0]>C?w:0),p[0]+=R}T0(c,p)}function C0(p,c,y,w){let C=Math.pow(2,w.z)*yc,R=[w.x*yc,w.y*yc],N=[];for(let z of p)for(let V of z){let K=[V.x+R[0],V.y+R[1]];T7(K,c,y,C),N.push(K)}return N}function S7(p,c,y,w){let C=Math.pow(2,w.z)*yc,R=[w.x*yc,w.y*yc],N=[];for(let V of p){let K=[];for(let se of V){let ue=[se.x+R[0],se.y+R[1]];T0(c,ue),K.push(ue)}N.push(K)}if(c[2]-c[0]<=C/2){(z=c)[0]=z[1]=1/0,z[2]=z[3]=-1/0;for(let V of N)for(let K of V)T7(K,c,y,C)}var z;return N}class tu{constructor(c,y){this.type=Pt,this.geojson=c,this.geometries=y}static parse(c,y){if(c.length!==2)return y.error(`'within' expression requires exactly one argument, but found ${c.length-1} instead.`);if(v0(c[1])){let w=c[1];if(w.type==="FeatureCollection")for(let C=0;C<w.features.length;++C){let R=w.features[C].geometry.type;if(R==="Polygon"||R==="MultiPolygon")return new tu(w,w.features[C].geometry)}else if(w.type==="Feature"){let C=w.geometry.type;if(C==="Polygon"||C==="MultiPolygon")return new tu(w,w.geometry)}else if(w.type==="Polygon"||w.type==="MultiPolygon")return new tu(w,w)}return y.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return function(y,w){let C=[1/0,1/0,-1/0,-1/0],R=[1/0,1/0,-1/0,-1/0],N=y.canonicalID();if(w.type==="Polygon"){let z=A0(w.coordinates,R,N),V=C0(y.geometry(),C,R,N);if(!wh(C,R))return!1;for(let K of V)if(!S0(K,z))return!1}if(w.type==="MultiPolygon"){let z=E7(w.coordinates,R,N),V=C0(y.geometry(),C,R,N);if(!wh(C,R))return!1;for(let K of V)if(!Qx(K,z))return!1}return!0}(c,this.geometries);if(c.geometryType()==="LineString")return function(y,w){let C=[1/0,1/0,-1/0,-1/0],R=[1/0,1/0,-1/0,-1/0],N=y.canonicalID();if(w.type==="Polygon"){let z=A0(w.coordinates,R,N),V=S7(y.geometry(),C,R,N);if(!wh(C,R))return!1;for(let K of V)if(!b7(K,z))return!1}if(w.type==="MultiPolygon"){let z=E7(w.coordinates,R,N),V=S7(y.geometry(),C,R,N);if(!wh(C,R))return!1;for(let K of V)if(!w7(K,z))return!1}return!0}(c,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class I0{constructor(c,y){this.type=y.type,this.name=c,this.boundExpression=y}static parse(c,y){if(c.length!==2||typeof c[1]!="string")return y.error("'var' expression requires exactly one string literal argument.");let w=c[1];return y.scope.has(w)?new I0(w,y.scope.get(w)):y.error(`Unknown variable "${w}". Make sure "${w}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(c){return this.boundExpression.evaluate(c)}eachChild(){}outputDefined(){return!1}}class Eo{constructor(c,y,w,C){this.name=c,this.type=y,this._evaluate=w,this.args=C}evaluate(c){return this._evaluate(c,this.args)}eachChild(c){this.args.forEach(c)}outputDefined(){return!1}static parse(c,y){let w=c[0],C=Eo.definitions[w];if(!C)return y.error(`Unknown expression "${w}". If you wanted a literal array, use ["literal", [...]].`,0);let R=Array.isArray(C)?C[0]:C.type,N=Array.isArray(C)?[[C[1],C[2]]]:C.overloads,z=N.filter(([K])=>!Array.isArray(K)||K.length===c.length-1),V=null;for(let[K,se]of z){V=new E0(y.registry,Eh,y.path,null,y.scope);let ue=[],fe=!1;for(let ve=1;ve<c.length;ve++){let we=c[ve],ke=Array.isArray(K)?K[ve-1]:K.type,Le=V.parse(we,1+ue.length,ke);if(!Le){fe=!0;break}ue.push(Le)}if(!fe)if(Array.isArray(K)&&K.length!==ue.length)V.error(`Expected ${K.length} arguments, but found ${ue.length} instead.`);else{for(let ve=0;ve<ue.length;ve++){let we=Array.isArray(K)?K[ve]:K.type,ke=ue[ve];V.concat(ve+1).checkSubtype(we,ke.type)}if(V.errors.length===0)return new Eo(w,R,se,ue)}}if(z.length===1)y.errors.push(...V.errors);else{let K=(z.length?z:N).map(([ue])=>{return fe=ue,Array.isArray(fe)?`(${fe.map(Qi).join(", ")})`:`(${Qi(fe.type)}...)`;var fe}).join(" | "),se=[];for(let ue=1;ue<c.length;ue++){let fe=y.parse(c[ue],1+se.length);if(!fe)return null;se.push(Qi(fe.type))}y.error(`Expected arguments of type ${K}, but found (${se.join(", ")}) instead.`)}return null}static register(c,y){Eo.definitions=y;for(let w in y)c[w]=Eo}}function Eh(p){if(p instanceof I0)return Eh(p.boundExpression);if(p instanceof Eo&&p.name==="error"||p instanceof o1||p instanceof tu)return!1;let c=p instanceof ol||p instanceof Fn,y=!0;return p.eachChild(w=>{y=c?y&&Eh(w):y&&w instanceof eu}),!!y&&k0(p)&&Sh(p,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function k0(p){if(p instanceof Eo&&(p.name==="get"&&p.args.length===1||p.name==="feature-state"||p.name==="has"&&p.args.length===1||p.name==="properties"||p.name==="geometry-type"||p.name==="id"||/^filter-/.test(p.name))||p instanceof tu)return!1;let c=!0;return p.eachChild(y=>{c&&!k0(y)&&(c=!1)}),c}function Th(p){if(p instanceof Eo&&p.name==="feature-state")return!1;let c=!0;return p.eachChild(y=>{c&&!Th(y)&&(c=!1)}),c}function Sh(p,c){if(p instanceof Eo&&c.indexOf(p.name)>=0)return!1;let y=!0;return p.eachChild(w=>{y&&!Sh(w,c)&&(y=!1)}),y}function Ah(p,c){let y=p.length-1,w,C,R=0,N=y,z=0;for(;R<=N;)if(z=Math.floor((R+N)/2),w=p[z],C=p[z+1],w<=c){if(z===y||c<C)return z;R=z+1}else{if(!(w>c))throw new Ms("Input is not a number.");N=z-1}return 0}class Ch{constructor(c,y,w){this.type=c,this.input=y,this.labels=[],this.outputs=[];for(let[C,R]of w)this.labels.push(C),this.outputs.push(R)}static parse(c,y){if(c.length-1<4)return y.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return y.error("Expected an even number of arguments.");let w=y.parse(c[1],1,at);if(!w)return null;let C=[],R=null;y.expectedType&&y.expectedType.kind!=="value"&&(R=y.expectedType);for(let N=1;N<c.length;N+=2){let z=N===1?-1/0:c[N],V=c[N+1],K=N,se=N+1;if(typeof z!="number")return y.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',K);if(C.length&&C[C.length-1][0]>=z)return y.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',K);let ue=y.parse(V,se,R);if(!ue)return null;R=R||ue.type,C.push([z,ue])}return new Ch(R,w,C)}evaluate(c){let y=this.labels,w=this.outputs;if(y.length===1)return w[0].evaluate(c);let C=this.input.evaluate(c);if(C<=y[0])return w[0].evaluate(c);let R=y.length;return C>=y[R-1]?w[R-1].evaluate(c):w[Ah(y,C)].evaluate(c)}eachChild(c){c(this.input);for(let y of this.outputs)c(y)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function iu(p,c,y){return p+y*(c-p)}function M0(p,c,y){return p.map((w,C)=>iu(w,c[C],y))}let To={number:iu,color:function(p,c,y,w="rgb"){switch(w){case"rgb":{let[C,R,N,z]=M0(p.rgb,c.rgb,y);return new Pi(C,R,N,z,!1)}case"hcl":{let[C,R,N,z]=p.hcl,[V,K,se,ue]=c.hcl,fe,ve;if(isNaN(C)||isNaN(V))isNaN(C)?isNaN(V)?fe=NaN:(fe=V,N!==1&&N!==0||(ve=K)):(fe=C,se!==1&&se!==0||(ve=R));else{let qe=V-C;V>C&&qe>180?qe-=360:V<C&&C-V>180&&(qe+=360),fe=C+y*qe}let[we,ke,Le,Be]=function([qe,$e,et,it]){return qe=isNaN(qe)?0:qe*Ze,ni([et,Math.cos(qe)*$e,Math.sin(qe)*$e,it])}([fe,ve??iu(R,K,y),iu(N,se,y),iu(z,ue,y)]);return new Pi(we,ke,Le,Be,!1)}case"lab":{let[C,R,N,z]=ni(M0(p.lab,c.lab,y));return new Pi(C,R,N,z,!1)}}},array:M0,padding:function(p,c,y){return new wo(M0(p.values,c.values,y))},variableAnchorOffsetCollection:function(p,c,y){let w=p.values,C=c.values;if(w.length!==C.length)throw new Ms(`Cannot interpolate values of different length. from: ${p.toString()}, to: ${c.toString()}`);let R=[];for(let N=0;N<w.length;N+=2){if(w[N]!==C[N])throw new Ms(`Cannot interpolate values containing mismatched anchors. from[${N}]: ${w[N]}, to[${N}]: ${C[N]}`);R.push(w[N]);let[z,V]=w[N+1],[K,se]=C[N+1];R.push([iu(z,K,y),iu(V,se,y)])}return new Dn(R)}};class So{constructor(c,y,w,C,R){this.type=c,this.operator=y,this.interpolation=w,this.input=C,this.labels=[],this.outputs=[];for(let[N,z]of R)this.labels.push(N),this.outputs.push(z)}static interpolationFactor(c,y,w,C){let R=0;if(c.name==="exponential")R=gp(y,c.base,w,C);else if(c.name==="linear")R=gp(y,1,w,C);else if(c.name==="cubic-bezier"){let N=c.controlPoints;R=new g(N[0],N[1],N[2],N[3]).solve(gp(y,1,w,C))}return R}static parse(c,y){let[w,C,R,...N]=c;if(!Array.isArray(C)||C.length===0)return y.error("Expected an interpolation type expression.",1);if(C[0]==="linear")C={name:"linear"};else if(C[0]==="exponential"){let K=C[1];if(typeof K!="number")return y.error("Exponential interpolation requires a numeric base.",1,1);C={name:"exponential",base:K}}else{if(C[0]!=="cubic-bezier")return y.error(`Unknown interpolation type ${String(C[0])}`,1,0);{let K=C.slice(1);if(K.length!==4||K.some(se=>typeof se!="number"||se<0||se>1))return y.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);C={name:"cubic-bezier",controlPoints:K}}}if(c.length-1<4)return y.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return y.error("Expected an even number of arguments.");if(R=y.parse(R,2,at),!R)return null;let z=[],V=null;w==="interpolate-hcl"||w==="interpolate-lab"?V=Zi:y.expectedType&&y.expectedType.kind!=="value"&&(V=y.expectedType);for(let K=0;K<N.length;K+=2){let se=N[K],ue=N[K+1],fe=K+3,ve=K+4;if(typeof se!="number")return y.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',fe);if(z.length&&z[z.length-1][0]>=se)return y.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',fe);let we=y.parse(ue,ve,V);if(!we)return null;V=V||we.type,z.push([se,we])}return pe(V,at)||pe(V,Zi)||pe(V,Yt)||pe(V,Fi)||pe(V,Ir(at))?new So(V,w,C,R,z):y.error(`Type ${Qi(V)} is not interpolatable.`)}evaluate(c){let y=this.labels,w=this.outputs;if(y.length===1)return w[0].evaluate(c);let C=this.input.evaluate(c);if(C<=y[0])return w[0].evaluate(c);let R=y.length;if(C>=y[R-1])return w[R-1].evaluate(c);let N=Ah(y,C),z=So.interpolationFactor(this.interpolation,C,y[N],y[N+1]),V=w[N].evaluate(c),K=w[N+1].evaluate(c);switch(this.operator){case"interpolate":return To[this.type.kind](V,K,z);case"interpolate-hcl":return To.color(V,K,z,"hcl");case"interpolate-lab":return To.color(V,K,z,"lab")}}eachChild(c){c(this.input);for(let y of this.outputs)c(y)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function gp(p,c,y,w){let C=w-y,R=p-y;return C===0?0:c===1?R/C:(Math.pow(c,R)-1)/(Math.pow(c,C)-1)}class P0{constructor(c,y){this.type=c,this.args=y}static parse(c,y){if(c.length<2)return y.error("Expectected at least one argument.");let w=null,C=y.expectedType;C&&C.kind!=="value"&&(w=C);let R=[];for(let z of c.slice(1)){let V=y.parse(z,1+R.length,w,void 0,{typeAnnotation:"omit"});if(!V)return null;w=w||V.type,R.push(V)}if(!w)throw new Error("No output type");let N=C&&R.some(z=>ls(C,z.type));return new P0(N?Ke:w,R)}evaluate(c){let y,w=null,C=0;for(let R of this.args)if(C++,w=R.evaluate(c),w&&w instanceof na&&!w.available&&(y||(y=w.name),w=null,C===this.args.length&&(w=y)),w!==null)break;return w}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}class a1{constructor(c,y){this.type=y.type,this.bindings=[].concat(c),this.result=y}evaluate(c){return this.result.evaluate(c)}eachChild(c){for(let y of this.bindings)c(y[1]);c(this.result)}static parse(c,y){if(c.length<4)return y.error(`Expected at least 3 arguments, but found ${c.length-1} instead.`);let w=[];for(let R=1;R<c.length-1;R+=2){let N=c[R];if(typeof N!="string")return y.error(`Expected string, but found ${typeof N} instead.`,R);if(/[^a-zA-Z0-9_]/.test(N))return y.error("Variable names must contain only alphanumeric characters or '_'.",R);let z=y.parse(c[R+1],R+1);if(!z)return null;w.push([N,z])}let C=y.parse(c[c.length-1],c.length-1,y.expectedType,w);return C?new a1(w,C):null}outputDefined(){return this.result.outputDefined()}}class l1{constructor(c,y,w){this.type=c,this.index=y,this.input=w}static parse(c,y){if(c.length!==3)return y.error(`Expected 2 arguments, but found ${c.length-1} instead.`);let w=y.parse(c[1],1,at),C=y.parse(c[2],2,Ir(y.expectedType||Ke));return w&&C?new l1(C.type.itemType,w,C):null}evaluate(c){let y=this.index.evaluate(c),w=this.input.evaluate(c);if(y<0)throw new Ms(`Array index out of bounds: ${y} < 0.`);if(y>=w.length)throw new Ms(`Array index out of bounds: ${y} > ${w.length-1}.`);if(y!==Math.floor(y))throw new Ms(`Array index must be an integer, but found ${y} instead.`);return w[y]}eachChild(c){c(this.index),c(this.input)}outputDefined(){return!1}}class wr{constructor(c,y){this.type=Pt,this.needle=c,this.haystack=y}static parse(c,y){if(c.length!==3)return y.error(`Expected 2 arguments, but found ${c.length-1} instead.`);let w=y.parse(c[1],1,Ke),C=y.parse(c[2],2,Ke);return w&&C?Me(w.type,[Pt,Ot,at,hi,Ke])?new wr(w,C):y.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(w.type)} instead`):null}evaluate(c){let y=this.needle.evaluate(c),w=this.haystack.evaluate(c);if(!w)return!1;if(!he(y,["boolean","string","number","null"]))throw new Ms(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(ks(y))} instead.`);if(!he(w,["string","array"]))throw new Ms(`Expected second argument to be of type array or string, but found ${Qi(ks(w))} instead.`);return w.indexOf(y)>=0}eachChild(c){c(this.needle),c(this.haystack)}outputDefined(){return!0}}class R0{constructor(c,y,w){this.type=at,this.needle=c,this.haystack=y,this.fromIndex=w}static parse(c,y){if(c.length<=2||c.length>=5)return y.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);let w=y.parse(c[1],1,Ke),C=y.parse(c[2],2,Ke);if(!w||!C)return null;if(!Me(w.type,[Pt,Ot,at,hi,Ke]))return y.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(w.type)} instead`);if(c.length===4){let R=y.parse(c[3],3,at);return R?new R0(w,C,R):null}return new R0(w,C)}evaluate(c){let y=this.needle.evaluate(c),w=this.haystack.evaluate(c);if(!he(y,["boolean","string","number","null"]))throw new Ms(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(ks(y))} instead.`);if(!he(w,["string","array"]))throw new Ms(`Expected second argument to be of type array or string, but found ${Qi(ks(w))} instead.`);if(this.fromIndex){let C=this.fromIndex.evaluate(c);return w.indexOf(y,C)}return w.indexOf(y)}eachChild(c){c(this.needle),c(this.haystack),this.fromIndex&&c(this.fromIndex)}outputDefined(){return!1}}class yp{constructor(c,y,w,C,R,N){this.inputType=c,this.type=y,this.input=w,this.cases=C,this.outputs=R,this.otherwise=N}static parse(c,y){if(c.length<5)return y.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if(c.length%2!=1)return y.error("Expected an even number of arguments.");let w,C;y.expectedType&&y.expectedType.kind!=="value"&&(C=y.expectedType);let R={},N=[];for(let K=2;K<c.length-1;K+=2){let se=c[K],ue=c[K+1];Array.isArray(se)||(se=[se]);let fe=y.concat(K);if(se.length===0)return fe.error("Expected at least one branch label.");for(let we of se){if(typeof we!="number"&&typeof we!="string")return fe.error("Branch labels must be numbers or strings.");if(typeof we=="number"&&Math.abs(we)>Number.MAX_SAFE_INTEGER)return fe.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof we=="number"&&Math.floor(we)!==we)return fe.error("Numeric branch labels must be integer values.");if(w){if(fe.checkSubtype(w,ks(we)))return null}else w=ks(we);if(R[String(we)]!==void 0)return fe.error("Branch labels must be unique.");R[String(we)]=N.length}let ve=y.parse(ue,K,C);if(!ve)return null;C=C||ve.type,N.push(ve)}let z=y.parse(c[1],1,Ke);if(!z)return null;let V=y.parse(c[c.length-1],c.length-1,C);return V?z.type.kind!=="value"&&y.concat(1).checkSubtype(w,z.type)?null:new yp(w,C,z,R,N,V):null}evaluate(c){let y=this.input.evaluate(c);return(ks(y)===this.inputType&&this.outputs[this.cases[y]]||this.otherwise).evaluate(c)}eachChild(c){c(this.input),this.outputs.forEach(c),c(this.otherwise)}outputDefined(){return this.outputs.every(c=>c.outputDefined())&&this.otherwise.outputDefined()}}class _p{constructor(c,y,w){this.type=c,this.branches=y,this.otherwise=w}static parse(c,y){if(c.length<4)return y.error(`Expected at least 3 arguments, but found only ${c.length-1}.`);if(c.length%2!=0)return y.error("Expected an odd number of arguments.");let w;y.expectedType&&y.expectedType.kind!=="value"&&(w=y.expectedType);let C=[];for(let N=1;N<c.length-1;N+=2){let z=y.parse(c[N],N,Pt);if(!z)return null;let V=y.parse(c[N+1],N+1,w);if(!V)return null;C.push([z,V]),w=w||V.type}let R=y.parse(c[c.length-1],c.length-1,w);if(!R)return null;if(!w)throw new Error("Can't infer output type");return new _p(w,C,R)}evaluate(c){for(let[y,w]of this.branches)if(y.evaluate(c))return w.evaluate(c);return this.otherwise.evaluate(c)}eachChild(c){for(let[y,w]of this.branches)c(y),c(w);c(this.otherwise)}outputDefined(){return this.branches.every(([c,y])=>y.outputDefined())&&this.otherwise.outputDefined()}}class D0{constructor(c,y,w,C){this.type=c,this.input=y,this.beginIndex=w,this.endIndex=C}static parse(c,y){if(c.length<=2||c.length>=5)return y.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);let w=y.parse(c[1],1,Ke),C=y.parse(c[2],2,at);if(!w||!C)return null;if(!Me(w.type,[Ir(Ke),Ot,Ke]))return y.error(`Expected first argument to be of type array or string, but found ${Qi(w.type)} instead`);if(c.length===4){let R=y.parse(c[3],3,at);return R?new D0(w.type,w,C,R):null}return new D0(w.type,w,C)}evaluate(c){let y=this.input.evaluate(c),w=this.beginIndex.evaluate(c);if(!he(y,["string","array"]))throw new Ms(`Expected first argument to be of type array or string, but found ${Qi(ks(y))} instead.`);if(this.endIndex){let C=this.endIndex.evaluate(c);return y.slice(w,C)}return y.slice(w)}eachChild(c){c(this.input),c(this.beginIndex),this.endIndex&&c(this.endIndex)}outputDefined(){return!1}}function A7(p,c){return p==="=="||p==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function C7(p,c,y,w){return w.compare(c,y)===0}function c1(p,c,y){let w=p!=="=="&&p!=="!=";return class RN{constructor(R,N,z){this.type=Pt,this.lhs=R,this.rhs=N,this.collator=z,this.hasUntypedArgument=R.type.kind==="value"||N.type.kind==="value"}static parse(R,N){if(R.length!==3&&R.length!==4)return N.error("Expected two or three arguments.");let z=R[0],V=N.parse(R[1],1,Ke);if(!V)return null;if(!A7(z,V.type))return N.concat(1).error(`"${z}" comparisons are not supported for type '${Qi(V.type)}'.`);let K=N.parse(R[2],2,Ke);if(!K)return null;if(!A7(z,K.type))return N.concat(2).error(`"${z}" comparisons are not supported for type '${Qi(K.type)}'.`);if(V.type.kind!==K.type.kind&&V.type.kind!=="value"&&K.type.kind!=="value")return N.error(`Cannot compare types '${Qi(V.type)}' and '${Qi(K.type)}'.`);w&&(V.type.kind==="value"&&K.type.kind!=="value"?V=new Fn(K.type,[V]):V.type.kind!=="value"&&K.type.kind==="value"&&(K=new Fn(V.type,[K])));let se=null;if(R.length===4){if(V.type.kind!=="string"&&K.type.kind!=="string"&&V.type.kind!=="value"&&K.type.kind!=="value")return N.error("Cannot use collator to compare non-string types.");if(se=N.parse(R[3],3,dt),!se)return null}return new RN(V,K,se)}evaluate(R){let N=this.lhs.evaluate(R),z=this.rhs.evaluate(R);if(w&&this.hasUntypedArgument){let V=ks(N),K=ks(z);if(V.kind!==K.kind||V.kind!=="string"&&V.kind!=="number")throw new Ms(`Expected arguments for "${p}" to be (string, string) or (number, number), but found (${V.kind}, ${K.kind}) instead.`)}if(this.collator&&!w&&this.hasUntypedArgument){let V=ks(N),K=ks(z);if(V.kind!=="string"||K.kind!=="string")return c(R,N,z)}return this.collator?y(R,N,z,this.collator.evaluate(R)):c(R,N,z)}eachChild(R){R(this.lhs),R(this.rhs),this.collator&&R(this.collator)}outputDefined(){return!0}}}let Jx=c1("==",function(p,c,y){return c===y},C7),ev=c1("!=",function(p,c,y){return c!==y},function(p,c,y,w){return!C7(0,c,y,w)}),tv=c1("<",function(p,c,y){return c<y},function(p,c,y,w){return w.compare(c,y)<0}),iv=c1(">",function(p,c,y){return c>y},function(p,c,y,w){return w.compare(c,y)>0}),rv=c1("<=",function(p,c,y){return c<=y},function(p,c,y,w){return w.compare(c,y)<=0}),sv=c1(">=",function(p,c,y){return c>=y},function(p,c,y,w){return w.compare(c,y)>=0});class xp{constructor(c,y,w,C,R){this.type=Ot,this.number=c,this.locale=y,this.currency=w,this.minFractionDigits=C,this.maxFractionDigits=R}static parse(c,y){if(c.length!==3)return y.error("Expected two arguments.");let w=y.parse(c[1],1,at);if(!w)return null;let C=c[2];if(typeof C!="object"||Array.isArray(C))return y.error("NumberFormat options argument must be an object.");let R=null;if(C.locale&&(R=y.parse(C.locale,1,Ot),!R))return null;let N=null;if(C.currency&&(N=y.parse(C.currency,1,Ot),!N))return null;let z=null;if(C["min-fraction-digits"]&&(z=y.parse(C["min-fraction-digits"],1,at),!z))return null;let V=null;return C["max-fraction-digits"]&&(V=y.parse(C["max-fraction-digits"],1,at),!V)?null:new xp(w,R,N,z,V)}evaluate(c){return new Intl.NumberFormat(this.locale?this.locale.evaluate(c):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(c):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(c):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(c):void 0}).format(this.number.evaluate(c))}eachChild(c){c(this.number),this.locale&&c(this.locale),this.currency&&c(this.currency),this.minFractionDigits&&c(this.minFractionDigits),this.maxFractionDigits&&c(this.maxFractionDigits)}outputDefined(){return!1}}class F0{constructor(c){this.type=Lt,this.sections=c}static parse(c,y){if(c.length<2)return y.error("Expected at least one argument.");let w=c[1];if(!Array.isArray(w)&&typeof w=="object")return y.error("First argument must be an image or text section.");let C=[],R=!1;for(let N=1;N<=c.length-1;++N){let z=c[N];if(R&&typeof z=="object"&&!Array.isArray(z)){R=!1;let V=null;if(z["font-scale"]&&(V=y.parse(z["font-scale"],1,at),!V))return null;let K=null;if(z["text-font"]&&(K=y.parse(z["text-font"],1,Ir(Ot)),!K))return null;let se=null;if(z["text-color"]&&(se=y.parse(z["text-color"],1,Zi),!se))return null;let ue=C[C.length-1];ue.scale=V,ue.font=K,ue.textColor=se}else{let V=y.parse(c[N],1,Ke);if(!V)return null;let K=V.type.kind;if(K!=="string"&&K!=="value"&&K!=="null"&&K!=="resolvedImage")return y.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");R=!0,C.push({content:V,scale:null,font:null,textColor:null})}}return new F0(C)}evaluate(c){return new Is(this.sections.map(y=>{let w=y.content.evaluate(c);return ks(w)===Kt?new Tn("",w,null,null,null):new Tn(gc(w),null,y.scale?y.scale.evaluate(c):null,y.font?y.font.evaluate(c).join(","):null,y.textColor?y.textColor.evaluate(c):null)}))}eachChild(c){for(let y of this.sections)c(y.content),y.scale&&c(y.scale),y.font&&c(y.font),y.textColor&&c(y.textColor)}outputDefined(){return!1}}class vp{constructor(c){this.type=Kt,this.input=c}static parse(c,y){if(c.length!==2)return y.error("Expected two arguments.");let w=y.parse(c[1],1,Ot);return w?new vp(w):y.error("No image name provided.")}evaluate(c){let y=this.input.evaluate(c),w=na.fromString(y);return w&&c.availableImages&&(w.available=c.availableImages.indexOf(y)>-1),w}eachChild(c){c(this.input)}outputDefined(){return!1}}class bp{constructor(c){this.type=at,this.input=c}static parse(c,y){if(c.length!==2)return y.error(`Expected 1 argument, but found ${c.length-1} instead.`);let w=y.parse(c[1],1);return w?w.type.kind!=="array"&&w.type.kind!=="string"&&w.type.kind!=="value"?y.error(`Expected argument of type string or array, but found ${Qi(w.type)} instead.`):new bp(w):null}evaluate(c){let y=this.input.evaluate(c);if(typeof y=="string"||Array.isArray(y))return y.length;throw new Ms(`Expected value to be of type string or array, but found ${Qi(ks(y))} instead.`)}eachChild(c){c(this.input)}outputDefined(){return!1}}let u1={"==":Jx,"!=":ev,">":iv,"<":tv,">=":sv,"<=":rv,array:Fn,at:l1,boolean:Fn,case:_p,coalesce:P0,collator:o1,format:F0,image:vp,in:wr,"index-of":R0,interpolate:So,"interpolate-hcl":So,"interpolate-lab":So,length:bp,let:a1,literal:eu,match:yp,number:Fn,"number-format":xp,object:Fn,slice:D0,step:Ch,string:Fn,"to-boolean":ol,"to-color":ol,"to-number":ol,"to-string":ol,var:I0,within:tu};function I7(p,[c,y,w,C]){c=c.evaluate(p),y=y.evaluate(p),w=w.evaluate(p);let R=C?C.evaluate(p):1,N=_7(c,y,w,R);if(N)throw new Ms(N);return new Pi(c/255,y/255,w/255,R,!1)}function k7(p,c){return p in c}function wp(p,c){let y=c[p];return y===void 0?null:y}function ru(p){return{type:p}}function M7(p){return{result:"success",value:p}}function h1(p){return{result:"error",value:p}}function d1(p){return p["property-type"]==="data-driven"||p["property-type"]==="cross-faded-data-driven"}function P7(p){return!!p.expression&&p.expression.parameters.indexOf("zoom")>-1}function Ep(p){return!!p.expression&&p.expression.interpolated}function kr(p){return p instanceof Number?"number":p instanceof String?"string":p instanceof Boolean?"boolean":Array.isArray(p)?"array":p===null?"null":typeof p}function L0(p){return typeof p=="object"&&p!==null&&!Array.isArray(p)}function nv(p){return p}function R7(p,c){let y=c.type==="color",w=p.stops&&typeof p.stops[0][0]=="object",C=w||!(w||p.property!==void 0),R=p.type||(Ep(c)?"exponential":"interval");if(y||c.type==="padding"){let se=y?Pi.parse:wo.parse;(p=nt({},p)).stops&&(p.stops=p.stops.map(ue=>[ue[0],se(ue[1])])),p.default=se(p.default?p.default:c.default)}if(p.colorSpace&&(N=p.colorSpace)!=="rgb"&&N!=="hcl"&&N!=="lab")throw new Error(`Unknown color space: "${p.colorSpace}"`);var N;let z,V,K;if(R==="exponential")z=D7;else if(R==="interval")z=av;else if(R==="categorical"){z=ov,V=Object.create(null);for(let se of p.stops)V[se[0]]=se[1];K=typeof p.stops[0][0]}else{if(R!=="identity")throw new Error(`Unknown function type "${R}"`);z=lv}if(w){let se={},ue=[];for(let we=0;we<p.stops.length;we++){let ke=p.stops[we],Le=ke[0].zoom;se[Le]===void 0&&(se[Le]={zoom:Le,type:p.type,property:p.property,default:p.default,stops:[]},ue.push(Le)),se[Le].stops.push([ke[0].value,ke[1]])}let fe=[];for(let we of ue)fe.push([se[we].zoom,R7(se[we],c)]);let ve={name:"linear"};return{kind:"composite",interpolationType:ve,interpolationFactor:So.interpolationFactor.bind(void 0,ve),zoomStops:fe.map(we=>we[0]),evaluate:({zoom:we},ke)=>D7({stops:fe,base:p.base},c,we).evaluate(we,ke)}}if(C){let se=R==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:se,interpolationFactor:So.interpolationFactor.bind(void 0,se),zoomStops:p.stops.map(ue=>ue[0]),evaluate:({zoom:ue})=>z(p,c,ue,V,K)}}return{kind:"source",evaluate(se,ue){let fe=ue&&ue.properties?ue.properties[p.property]:void 0;return fe===void 0?su(p.default,c.default):z(p,c,fe,V,K)}}}function su(p,c,y){return p!==void 0?p:c!==void 0?c:y!==void 0?y:void 0}function ov(p,c,y,w,C){return su(typeof y===C?w[y]:void 0,p.default,c.default)}function av(p,c,y){if(kr(y)!=="number")return su(p.default,c.default);let w=p.stops.length;if(w===1||y<=p.stops[0][0])return p.stops[0][1];if(y>=p.stops[w-1][0])return p.stops[w-1][1];let C=Ah(p.stops.map(R=>R[0]),y);return p.stops[C][1]}function D7(p,c,y){let w=p.base!==void 0?p.base:1;if(kr(y)!=="number")return su(p.default,c.default);let C=p.stops.length;if(C===1||y<=p.stops[0][0])return p.stops[0][1];if(y>=p.stops[C-1][0])return p.stops[C-1][1];let R=Ah(p.stops.map(se=>se[0]),y),N=function(se,ue,fe,ve){let we=ve-fe,ke=se-fe;return we===0?0:ue===1?ke/we:(Math.pow(ue,ke)-1)/(Math.pow(ue,we)-1)}(y,w,p.stops[R][0],p.stops[R+1][0]),z=p.stops[R][1],V=p.stops[R+1][1],K=To[c.type]||nv;return typeof z.evaluate=="function"?{evaluate(...se){let ue=z.evaluate.apply(void 0,se),fe=V.evaluate.apply(void 0,se);if(ue!==void 0&&fe!==void 0)return K(ue,fe,N,p.colorSpace)}}:K(z,V,N,p.colorSpace)}function lv(p,c,y){switch(c.type){case"color":y=Pi.parse(y);break;case"formatted":y=Is.fromString(y.toString());break;case"resolvedImage":y=na.fromString(y.toString());break;case"padding":y=wo.parse(y);break;default:kr(y)===c.type||c.type==="enum"&&c.values[y]||(y=void 0)}return su(y,p.default,c.default)}Eo.register(u1,{error:[{kind:"error"},[Ot],(p,[c])=>{throw new Ms(c.evaluate(p))}],typeof:[Ot,[Ke],(p,[c])=>Qi(ks(c.evaluate(p)))],"to-rgba":[Ir(at,4),[Zi],(p,[c])=>{let[y,w,C,R]=c.evaluate(p).rgb;return[255*y,255*w,255*C,R]}],rgb:[Zi,[at,at,at],I7],rgba:[Zi,[at,at,at,at],I7],has:{type:Pt,overloads:[[[Ot],(p,[c])=>k7(c.evaluate(p),p.properties())],[[Ot,ji],(p,[c,y])=>k7(c.evaluate(p),y.evaluate(p))]]},get:{type:Ke,overloads:[[[Ot],(p,[c])=>wp(c.evaluate(p),p.properties())],[[Ot,ji],(p,[c,y])=>wp(c.evaluate(p),y.evaluate(p))]]},"feature-state":[Ke,[Ot],(p,[c])=>wp(c.evaluate(p),p.featureState||{})],properties:[ji,[],p=>p.properties()],"geometry-type":[Ot,[],p=>p.geometryType()],id:[Ke,[],p=>p.id()],zoom:[at,[],p=>p.globals.zoom],"heatmap-density":[at,[],p=>p.globals.heatmapDensity||0],"line-progress":[at,[],p=>p.globals.lineProgress||0],accumulated:[Ke,[],p=>p.globals.accumulated===void 0?null:p.globals.accumulated],"+":[at,ru(at),(p,c)=>{let y=0;for(let w of c)y+=w.evaluate(p);return y}],"*":[at,ru(at),(p,c)=>{let y=1;for(let w of c)y*=w.evaluate(p);return y}],"-":{type:at,overloads:[[[at,at],(p,[c,y])=>c.evaluate(p)-y.evaluate(p)],[[at],(p,[c])=>-c.evaluate(p)]]},"/":[at,[at,at],(p,[c,y])=>c.evaluate(p)/y.evaluate(p)],"%":[at,[at,at],(p,[c,y])=>c.evaluate(p)%y.evaluate(p)],ln2:[at,[],()=>Math.LN2],pi:[at,[],()=>Math.PI],e:[at,[],()=>Math.E],"^":[at,[at,at],(p,[c,y])=>Math.pow(c.evaluate(p),y.evaluate(p))],sqrt:[at,[at],(p,[c])=>Math.sqrt(c.evaluate(p))],log10:[at,[at],(p,[c])=>Math.log(c.evaluate(p))/Math.LN10],ln:[at,[at],(p,[c])=>Math.log(c.evaluate(p))],log2:[at,[at],(p,[c])=>Math.log(c.evaluate(p))/Math.LN2],sin:[at,[at],(p,[c])=>Math.sin(c.evaluate(p))],cos:[at,[at],(p,[c])=>Math.cos(c.evaluate(p))],tan:[at,[at],(p,[c])=>Math.tan(c.evaluate(p))],asin:[at,[at],(p,[c])=>Math.asin(c.evaluate(p))],acos:[at,[at],(p,[c])=>Math.acos(c.evaluate(p))],atan:[at,[at],(p,[c])=>Math.atan(c.evaluate(p))],min:[at,ru(at),(p,c)=>Math.min(...c.map(y=>y.evaluate(p)))],max:[at,ru(at),(p,c)=>Math.max(...c.map(y=>y.evaluate(p)))],abs:[at,[at],(p,[c])=>Math.abs(c.evaluate(p))],round:[at,[at],(p,[c])=>{let y=c.evaluate(p);return y<0?-Math.round(-y):Math.round(y)}],floor:[at,[at],(p,[c])=>Math.floor(c.evaluate(p))],ceil:[at,[at],(p,[c])=>Math.ceil(c.evaluate(p))],"filter-==":[Pt,[Ot,Ke],(p,[c,y])=>p.properties()[c.value]===y.value],"filter-id-==":[Pt,[Ke],(p,[c])=>p.id()===c.value],"filter-type-==":[Pt,[Ot],(p,[c])=>p.geometryType()===c.value],"filter-<":[Pt,[Ot,Ke],(p,[c,y])=>{let w=p.properties()[c.value],C=y.value;return typeof w==typeof C&&w<C}],"filter-id-<":[Pt,[Ke],(p,[c])=>{let y=p.id(),w=c.value;return typeof y==typeof w&&y<w}],"filter->":[Pt,[Ot,Ke],(p,[c,y])=>{let w=p.properties()[c.value],C=y.value;return typeof w==typeof C&&w>C}],"filter-id->":[Pt,[Ke],(p,[c])=>{let y=p.id(),w=c.value;return typeof y==typeof w&&y>w}],"filter-<=":[Pt,[Ot,Ke],(p,[c,y])=>{let w=p.properties()[c.value],C=y.value;return typeof w==typeof C&&w<=C}],"filter-id-<=":[Pt,[Ke],(p,[c])=>{let y=p.id(),w=c.value;return typeof y==typeof w&&y<=w}],"filter->=":[Pt,[Ot,Ke],(p,[c,y])=>{let w=p.properties()[c.value],C=y.value;return typeof w==typeof C&&w>=C}],"filter-id->=":[Pt,[Ke],(p,[c])=>{let y=p.id(),w=c.value;return typeof y==typeof w&&y>=w}],"filter-has":[Pt,[Ke],(p,[c])=>c.value in p.properties()],"filter-has-id":[Pt,[],p=>p.id()!==null&&p.id()!==void 0],"filter-type-in":[Pt,[Ir(Ot)],(p,[c])=>c.value.indexOf(p.geometryType())>=0],"filter-id-in":[Pt,[Ir(Ke)],(p,[c])=>c.value.indexOf(p.id())>=0],"filter-in-small":[Pt,[Ot,Ir(Ke)],(p,[c,y])=>y.value.indexOf(p.properties()[c.value])>=0],"filter-in-large":[Pt,[Ot,Ir(Ke)],(p,[c,y])=>function(w,C,R,N){for(;R<=N;){let z=R+N>>1;if(C[z]===w)return!0;C[z]>w?N=z-1:R=z+1}return!1}(p.properties()[c.value],y.value,0,y.value.length-1)],all:{type:Pt,overloads:[[[Pt,Pt],(p,[c,y])=>c.evaluate(p)&&y.evaluate(p)],[ru(Pt),(p,c)=>{for(let y of c)if(!y.evaluate(p))return!1;return!0}]]},any:{type:Pt,overloads:[[[Pt,Pt],(p,[c,y])=>c.evaluate(p)||y.evaluate(p)],[ru(Pt),(p,c)=>{for(let y of c)if(y.evaluate(p))return!0;return!1}]]},"!":[Pt,[Pt],(p,[c])=>!c.evaluate(p)],"is-supported-script":[Pt,[Ot],(p,[c])=>{let y=p.globals&&p.globals.isSupportedScript;return!y||y(c.evaluate(p))}],upcase:[Ot,[Ot],(p,[c])=>c.evaluate(p).toUpperCase()],downcase:[Ot,[Ot],(p,[c])=>c.evaluate(p).toLowerCase()],concat:[Ot,ru(Ke),(p,c)=>c.map(y=>gc(y.evaluate(p))).join("")],"resolved-locale":[Ot,[dt],(p,[c])=>c.evaluate(p).resolvedLocale()]});class _s{constructor(c,y){var w;this.expression=c,this._warningHistory={},this._evaluator=new Rr,this._defaultValue=y?(w=y).type==="color"&&L0(w.default)?new Pi(0,0,0,0):w.type==="color"?Pi.parse(w.default)||null:w.type==="padding"?wo.parse(w.default)||null:w.type==="variableAnchorOffsetCollection"?Dn.parse(w.default)||null:w.default===void 0?null:w.default:null,this._enumValues=y&&y.type==="enum"?y.values:null}evaluateWithoutErrorHandling(c,y,w,C,R,N){return this._evaluator.globals=c,this._evaluator.feature=y,this._evaluator.featureState=w,this._evaluator.canonical=C,this._evaluator.availableImages=R||null,this._evaluator.formattedSection=N,this.expression.evaluate(this._evaluator)}evaluate(c,y,w,C,R,N){this._evaluator.globals=c,this._evaluator.feature=y||null,this._evaluator.featureState=w||null,this._evaluator.canonical=C,this._evaluator.availableImages=R||null,this._evaluator.formattedSection=N||null;try{let z=this.expression.evaluate(this._evaluator);if(z==null||typeof z=="number"&&z!=z)return this._defaultValue;if(this._enumValues&&!(z in this._enumValues))throw new Ms(`Expected value to be one of ${Object.keys(this._enumValues).map(V=>JSON.stringify(V)).join(", ")}, but found ${JSON.stringify(z)} instead.`);return z}catch(z){return this._warningHistory[z.message]||(this._warningHistory[z.message]=!0,typeof console<"u"&&console.warn(z.message)),this._defaultValue}}}function N0(p){return Array.isArray(p)&&p.length>0&&typeof p[0]=="string"&&p[0]in u1}function ur(p,c){let y=new E0(u1,Eh,[],c?function(C){let R={color:Zi,string:Ot,number:at,enum:Ot,boolean:Pt,formatted:Lt,padding:Yt,resolvedImage:Kt,variableAnchorOffsetCollection:Fi};return C.type==="array"?Ir(R[C.value]||Ke,C.length):R[C.type]}(c):void 0),w=y.parse(p,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return w?M7(new _s(w,c)):h1(y.errors)}class Ih{constructor(c,y){this.kind=c,this._styleExpression=y,this.isStateDependent=c!=="constant"&&!Th(y.expression)}evaluateWithoutErrorHandling(c,y,w,C,R,N){return this._styleExpression.evaluateWithoutErrorHandling(c,y,w,C,R,N)}evaluate(c,y,w,C,R,N){return this._styleExpression.evaluate(c,y,w,C,R,N)}}class Yr{constructor(c,y,w,C){this.kind=c,this.zoomStops=w,this._styleExpression=y,this.isStateDependent=c!=="camera"&&!Th(y.expression),this.interpolationType=C}evaluateWithoutErrorHandling(c,y,w,C,R,N){return this._styleExpression.evaluateWithoutErrorHandling(c,y,w,C,R,N)}evaluate(c,y,w,C,R,N){return this._styleExpression.evaluate(c,y,w,C,R,N)}interpolationFactor(c,y,w){return this.interpolationType?So.interpolationFactor(this.interpolationType,c,y,w):0}}function Zr(p,c){let y=ur(p,c);if(y.result==="error")return y;let w=y.value.expression,C=k0(w);if(!C&&!d1(c))return h1([new ht("","data expressions not supported")]);let R=Sh(w,["zoom"]);if(!R&&!P7(c))return h1([new ht("","zoom expressions not supported")]);let N=kh(w);return N||R?N instanceof ht?h1([N]):N instanceof So&&!Ep(c)?h1([new ht("",'"interpolate" expressions cannot be used with this property')]):M7(N?new Yr(C?"camera":"composite",y.value,N.labels,N instanceof So?N.interpolation:void 0):new Ih(C?"constant":"source",y.value)):h1([new ht("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class nu{constructor(c,y){this._parameters=c,this._specification=y,nt(this,R7(this._parameters,this._specification))}static deserialize(c){return new nu(c._parameters,c._specification)}static serialize(c){return{_parameters:c._parameters,_specification:c._specification}}}function kh(p){let c=null;if(p instanceof a1)c=kh(p.result);else if(p instanceof P0){for(let y of p.args)if(c=kh(y),c)break}else(p instanceof Ch||p instanceof So)&&p.input instanceof Eo&&p.input.name==="zoom"&&(c=p);return c instanceof ht||p.eachChild(y=>{let w=kh(y);w instanceof ht?c=w:!c&&w?c=new ht("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):c&&w&&c!==w&&(c=new ht("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),c}function Tp(p){if(p===!0||p===!1)return!0;if(!Array.isArray(p)||p.length===0)return!1;switch(p[0]){case"has":return p.length>=2&&p[1]!=="$id"&&p[1]!=="$type";case"in":return p.length>=3&&(typeof p[1]!="string"||Array.isArray(p[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return p.length!==3||Array.isArray(p[1])||Array.isArray(p[2]);case"any":case"all":for(let c of p.slice(1))if(!Tp(c)&&typeof c!="boolean")return!1;return!0;default:return!0}}let cv={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Sp(p){if(p==null)return{filter:()=>!0,needGeometry:!1};Tp(p)||(p=Mh(p));let c=ur(p,cv);if(c.result==="error")throw new Error(c.value.map(y=>`${y.key}: ${y.message}`).join(", "));return{filter:(y,w,C)=>c.value.evaluate(y,w,{},C),needGeometry:Ap(p)}}function uv(p,c){return p<c?-1:p>c?1:0}function Ap(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(let c=1;c<p.length;c++)if(Ap(p[c]))return!0;return!1}function Mh(p){if(!p)return!0;let c=p[0];return p.length<=1?c!=="any":c==="=="?O0(p[1],p[2],"=="):c==="!="?U0(O0(p[1],p[2],"==")):c==="<"||c===">"||c==="<="||c===">="?O0(p[1],p[2],c):c==="any"?(y=p.slice(1),["any"].concat(y.map(Mh))):c==="all"?["all"].concat(p.slice(1).map(Mh)):c==="none"?["all"].concat(p.slice(1).map(Mh).map(U0)):c==="in"?Cp(p[1],p.slice(2)):c==="!in"?U0(Cp(p[1],p.slice(2))):c==="has"?B0(p[1]):c==="!has"?U0(B0(p[1])):c!=="within"||p;var y}function O0(p,c,y){switch(p){case"$type":return[`filter-type-${y}`,c];case"$id":return[`filter-id-${y}`,c];default:return[`filter-${y}`,p,c]}}function Cp(p,c){if(c.length===0)return!1;switch(p){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return c.length>200&&!c.some(y=>typeof y!=typeof c[0])?["filter-in-large",p,["literal",c.sort(uv)]]:["filter-in-small",p,["literal",c]]}}function B0(p){switch(p){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",p]}}function U0(p){return["!",p]}function Ip(p){let c=typeof p;if(c==="number"||c==="boolean"||c==="string"||p==null)return JSON.stringify(p);if(Array.isArray(p)){let C="[";for(let R of p)C+=`${Ip(R)},`;return`${C}]`}let y=Object.keys(p).sort(),w="{";for(let C=0;C<y.length;C++)w+=`${JSON.stringify(y[C])}:${Ip(p[y[C]])},`;return`${w}}`}function hv(p){let c="";for(let y of Qe)c+=`/${Ip(p[y])}`;return c}function F7(p){let c=p.value;return c?[new Ie(p.key,c,"constants have been deprecated as of v8")]:[]}function Ps(p){return p instanceof Number||p instanceof String||p instanceof Boolean?p.valueOf():p}function ou(p){if(Array.isArray(p))return p.map(ou);if(p instanceof Object&&!(p instanceof Number||p instanceof String||p instanceof Boolean)){let c={};for(let y in p)c[y]=ou(p[y]);return c}return Ps(p)}function oa(p){let c=p.key,y=p.value,w=p.valueSpec||{},C=p.objectElementValidators||{},R=p.style,N=p.styleSpec,z=p.validateSpec,V=[],K=kr(y);if(K!=="object")return[new Ie(c,y,`object expected, ${K} found`)];for(let se in y){let ue=se.split(".")[0],fe=w[ue]||w["*"],ve;if(C[ue])ve=C[ue];else if(w[ue])ve=z;else if(C["*"])ve=C["*"];else{if(!w["*"]){V.push(new Ie(c,y[se],`unknown property "${se}"`));continue}ve=z}V=V.concat(ve({key:(c&&`${c}.`)+se,value:y[se],valueSpec:fe,style:R,styleSpec:N,object:y,objectKey:se,validateSpec:z},y))}for(let se in w)C[se]||w[se].required&&w[se].default===void 0&&y[se]===void 0&&V.push(new Ie(c,y,`missing required property "${se}"`));return V}function kp(p){let c=p.value,y=p.valueSpec,w=p.style,C=p.styleSpec,R=p.key,N=p.arrayElementValidator||p.validateSpec;if(kr(c)!=="array")return[new Ie(R,c,`array expected, ${kr(c)} found`)];if(y.length&&c.length!==y.length)return[new Ie(R,c,`array length ${y.length} expected, length ${c.length} found`)];if(y["min-length"]&&c.length<y["min-length"])return[new Ie(R,c,`array length at least ${y["min-length"]} expected, length ${c.length} found`)];let z={type:y.value,values:y.values};C.$version<7&&(z.function=y.function),kr(y.value)==="object"&&(z=y.value);let V=[];for(let K=0;K<c.length;K++)V=V.concat(N({array:c,arrayIndex:K,value:c[K],valueSpec:z,validateSpec:p.validateSpec,style:w,styleSpec:C,key:`${R}[${K}]`}));return V}function z0(p){let c=p.key,y=p.value,w=p.valueSpec,C=kr(y);return C==="number"&&y!=y&&(C="NaN"),C!=="number"?[new Ie(c,y,`number expected, ${C} found`)]:"minimum"in w&&y<w.minimum?[new Ie(c,y,`${y} is less than the minimum value ${w.minimum}`)]:"maximum"in w&&y>w.maximum?[new Ie(c,y,`${y} is greater than the maximum value ${w.maximum}`)]:[]}function Mp(p){let c=p.valueSpec,y=Ps(p.value.type),w,C,R,N={},z=y!=="categorical"&&p.value.property===void 0,V=!z,K=kr(p.value.stops)==="array"&&kr(p.value.stops[0])==="array"&&kr(p.value.stops[0][0])==="object",se=oa({key:p.key,value:p.value,valueSpec:p.styleSpec.function,validateSpec:p.validateSpec,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(ve){if(y==="identity")return[new Ie(ve.key,ve.value,'identity function may not have a "stops" property')];let we=[],ke=ve.value;return we=we.concat(kp({key:ve.key,value:ke,valueSpec:ve.valueSpec,validateSpec:ve.validateSpec,style:ve.style,styleSpec:ve.styleSpec,arrayElementValidator:ue})),kr(ke)==="array"&&ke.length===0&&we.push(new Ie(ve.key,ke,"array must have at least one stop")),we},default:function(ve){return ve.validateSpec({key:ve.key,value:ve.value,valueSpec:c,validateSpec:ve.validateSpec,style:ve.style,styleSpec:ve.styleSpec})}}});return y==="identity"&&z&&se.push(new Ie(p.key,p.value,'missing required property "property"')),y==="identity"||p.value.stops||se.push(new Ie(p.key,p.value,'missing required property "stops"')),y==="exponential"&&p.valueSpec.expression&&!Ep(p.valueSpec)&&se.push(new Ie(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(V&&!d1(p.valueSpec)?se.push(new Ie(p.key,p.value,"property functions not supported")):z&&!P7(p.valueSpec)&&se.push(new Ie(p.key,p.value,"zoom functions not supported"))),y!=="categorical"&&!K||p.value.property!==void 0||se.push(new Ie(p.key,p.value,'"property" property is required')),se;function ue(ve){let we=[],ke=ve.value,Le=ve.key;if(kr(ke)!=="array")return[new Ie(Le,ke,`array expected, ${kr(ke)} found`)];if(ke.length!==2)return[new Ie(Le,ke,`array length 2 expected, length ${ke.length} found`)];if(K){if(kr(ke[0])!=="object")return[new Ie(Le,ke,`object expected, ${kr(ke[0])} found`)];if(ke[0].zoom===void 0)return[new Ie(Le,ke,"object stop key must have zoom")];if(ke[0].value===void 0)return[new Ie(Le,ke,"object stop key must have value")];if(R&&R>Ps(ke[0].zoom))return[new Ie(Le,ke[0].zoom,"stop zoom values must appear in ascending order")];Ps(ke[0].zoom)!==R&&(R=Ps(ke[0].zoom),C=void 0,N={}),we=we.concat(oa({key:`${Le}[0]`,value:ke[0],valueSpec:{zoom:{}},validateSpec:ve.validateSpec,style:ve.style,styleSpec:ve.styleSpec,objectElementValidators:{zoom:z0,value:fe}}))}else we=we.concat(fe({key:`${Le}[0]`,value:ke[0],valueSpec:{},validateSpec:ve.validateSpec,style:ve.style,styleSpec:ve.styleSpec},ke));return N0(ou(ke[1]))?we.concat([new Ie(`${Le}[1]`,ke[1],"expressions are not allowed in function stops.")]):we.concat(ve.validateSpec({key:`${Le}[1]`,value:ke[1],valueSpec:c,validateSpec:ve.validateSpec,style:ve.style,styleSpec:ve.styleSpec}))}function fe(ve,we){let ke=kr(ve.value),Le=Ps(ve.value),Be=ve.value!==null?ve.value:we;if(w){if(ke!==w)return[new Ie(ve.key,Be,`${ke} stop domain type must match previous stop domain type ${w}`)]}else w=ke;if(ke!=="number"&&ke!=="string"&&ke!=="boolean")return[new Ie(ve.key,Be,"stop domain value must be a number, string, or boolean")];if(ke!=="number"&&y!=="categorical"){let qe=`number expected, ${ke} found`;return d1(c)&&y===void 0&&(qe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ie(ve.key,Be,qe)]}return y!=="categorical"||ke!=="number"||isFinite(Le)&&Math.floor(Le)===Le?y!=="categorical"&&ke==="number"&&C!==void 0&&Le<C?[new Ie(ve.key,Be,"stop domain values must appear in ascending order")]:(C=Le,y==="categorical"&&Le in N?[new Ie(ve.key,Be,"stop domain values must be unique")]:(N[Le]=!0,[])):[new Ie(ve.key,Be,`integer expected, found ${Le}`)]}}function Nl(p){let c=(p.expressionContext==="property"?Zr:ur)(ou(p.value),p.valueSpec);if(c.result==="error")return c.value.map(w=>new Ie(`${p.key}${w.key}`,p.value,w.message));let y=c.value.expression||c.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!y.outputDefined())return[new Ie(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!Th(y))return[new Ie(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter"&&!Th(y))return[new Ie(p.key,p.value,'"feature-state" data expressions are not supported with filters.')];if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!Sh(y,["zoom","feature-state"]))return[new Ie(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!k0(y))return[new Ie(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ph(p){let c=p.key,y=p.value,w=p.valueSpec,C=[];return Array.isArray(w.values)?w.values.indexOf(Ps(y))===-1&&C.push(new Ie(c,y,`expected one of [${w.values.join(", ")}], ${JSON.stringify(y)} found`)):Object.keys(w.values).indexOf(Ps(y))===-1&&C.push(new Ie(c,y,`expected one of [${Object.keys(w.values).join(", ")}], ${JSON.stringify(y)} found`)),C}function G0(p){return Tp(ou(p.value))?Nl(nt({},p,{expressionContext:"filter",valueSpec:{value:"boolean"}})):L7(p)}function L7(p){let c=p.value,y=p.key;if(kr(c)!=="array")return[new Ie(y,c,`array expected, ${kr(c)} found`)];let w=p.styleSpec,C,R=[];if(c.length<1)return[new Ie(y,c,"filter array must have at least 1 element")];switch(R=R.concat(Ph({key:`${y}[0]`,value:c[0],valueSpec:w.filter_operator,style:p.style,styleSpec:p.styleSpec})),Ps(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&Ps(c[1])==="$type"&&R.push(new Ie(y,c,`"$type" cannot be use with operator "${c[0]}"`));case"==":case"!=":c.length!==3&&R.push(new Ie(y,c,`filter array for operator "${c[0]}" must have 3 elements`));case"in":case"!in":c.length>=2&&(C=kr(c[1]),C!=="string"&&R.push(new Ie(`${y}[1]`,c[1],`string expected, ${C} found`)));for(let N=2;N<c.length;N++)C=kr(c[N]),Ps(c[1])==="$type"?R=R.concat(Ph({key:`${y}[${N}]`,value:c[N],valueSpec:w.geometry_type,style:p.style,styleSpec:p.styleSpec})):C!=="string"&&C!=="number"&&C!=="boolean"&&R.push(new Ie(`${y}[${N}]`,c[N],`string, number, or boolean expected, ${C} found`));break;case"any":case"all":case"none":for(let N=1;N<c.length;N++)R=R.concat(L7({key:`${y}[${N}]`,value:c[N],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":C=kr(c[1]),c.length!==2?R.push(new Ie(y,c,`filter array for "${c[0]}" operator must have 2 elements`)):C!=="string"&&R.push(new Ie(`${y}[1]`,c[1],`string expected, ${C} found`));break;case"within":C=kr(c[1]),c.length!==2?R.push(new Ie(y,c,`filter array for "${c[0]}" operator must have 2 elements`)):C!=="object"&&R.push(new Ie(`${y}[1]`,c[1],`object expected, ${C} found`))}return R}function $0(p,c){let y=p.key,w=p.validateSpec,C=p.style,R=p.styleSpec,N=p.value,z=p.objectKey,V=R[`${c}_${p.layerType}`];if(!V)return[];let K=z.match(/^(.*)-transition$/);if(c==="paint"&&K&&V[K[1]]&&V[K[1]].transition)return w({key:y,value:N,valueSpec:R.transition,style:C,styleSpec:R});let se=p.valueSpec||V[z];if(!se)return[new Ie(y,N,`unknown property "${z}"`)];let ue;if(kr(N)==="string"&&d1(se)&&!se.tokens&&(ue=/^{([^}]+)}$/.exec(N)))return[new Ie(y,N,`"${z}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(ue[1])} }\`.`)];let fe=[];return p.layerType==="symbol"&&(z==="text-field"&&C&&!C.glyphs&&fe.push(new Ie(y,N,'use of "text-field" requires a style "glyphs" property')),z==="text-font"&&L0(ou(N))&&Ps(N.type)==="identity"&&fe.push(new Ie(y,N,'"text-font" does not support identity functions'))),fe.concat(w({key:p.key,value:N,valueSpec:se,style:C,styleSpec:R,expressionContext:"property",propertyType:c,propertyKey:z}))}function Rh(p){return $0(p,"paint")}function H0(p){return $0(p,"layout")}function V0(p){let c=[],y=p.value,w=p.key,C=p.style,R=p.styleSpec;y.type||y.ref||c.push(new Ie(w,y,'either "type" or "ref" is required'));let N=Ps(y.type),z=Ps(y.ref);if(y.id){let V=Ps(y.id);for(let K=0;K<p.arrayIndex;K++){let se=C.layers[K];Ps(se.id)===V&&c.push(new Ie(w,y.id,`duplicate layer id "${y.id}", previously used at line ${se.id.__line__}`))}}if("ref"in y){let V;["type","source","source-layer","filter","layout"].forEach(K=>{K in y&&c.push(new Ie(w,y[K],`"${K}" is prohibited for ref layers`))}),C.layers.forEach(K=>{Ps(K.id)===z&&(V=K)}),V?V.ref?c.push(new Ie(w,y.ref,"ref cannot reference another ref layer")):N=Ps(V.type):c.push(new Ie(w,y.ref,`ref layer "${z}" not found`))}else if(N!=="background")if(y.source){let V=C.sources&&C.sources[y.source],K=V&&Ps(V.type);V?K==="vector"&&N==="raster"?c.push(new Ie(w,y.source,`layer "${y.id}" requires a raster source`)):K==="raster"&&N!=="raster"?c.push(new Ie(w,y.source,`layer "${y.id}" requires a vector source`)):K!=="vector"||y["source-layer"]?K==="raster-dem"&&N!=="hillshade"?c.push(new Ie(w,y.source,"raster-dem source can only be used with layer type 'hillshade'.")):N!=="line"||!y.paint||!y.paint["line-gradient"]||K==="geojson"&&V.lineMetrics||c.push(new Ie(w,y,`layer "${y.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new Ie(w,y,`layer "${y.id}" must specify a "source-layer"`)):c.push(new Ie(w,y.source,`source "${y.source}" not found`))}else c.push(new Ie(w,y,'missing required property "source"'));return c=c.concat(oa({key:w,value:y,valueSpec:R.layer,style:p.style,styleSpec:p.styleSpec,validateSpec:p.validateSpec,objectElementValidators:{"*":()=>[],type:()=>p.validateSpec({key:`${w}.type`,value:y.type,valueSpec:R.layer.type,style:p.style,styleSpec:p.styleSpec,validateSpec:p.validateSpec,object:y,objectKey:"type"}),filter:G0,layout:V=>oa({layer:y,key:V.key,value:V.value,style:V.style,styleSpec:V.styleSpec,validateSpec:V.validateSpec,objectElementValidators:{"*":K=>H0(nt({layerType:N},K))}}),paint:V=>oa({layer:y,key:V.key,value:V.value,style:V.style,styleSpec:V.styleSpec,validateSpec:V.validateSpec,objectElementValidators:{"*":K=>Rh(nt({layerType:N},K))}})}})),c}function _c(p){let c=p.value,y=p.key,w=kr(c);return w!=="string"?[new Ie(y,c,`string expected, ${w} found`)]:[]}let N7={promoteId:function({key:p,value:c}){if(kr(c)==="string")return _c({key:p,value:c});{let y=[];for(let w in c)y.push(..._c({key:`${p}.${w}`,value:c[w]}));return y}}};function Dh(p){let c=p.value,y=p.key,w=p.styleSpec,C=p.style,R=p.validateSpec;if(!c.type)return[new Ie(y,c,'"type" is required')];let N=Ps(c.type),z;switch(N){case"vector":case"raster":case"raster-dem":return z=oa({key:y,value:c,valueSpec:w[`source_${N.replace("-","_")}`],style:p.style,styleSpec:w,objectElementValidators:N7,validateSpec:R}),z;case"geojson":if(z=oa({key:y,value:c,valueSpec:w.source_geojson,style:C,styleSpec:w,validateSpec:R,objectElementValidators:N7}),c.cluster)for(let V in c.clusterProperties){let[K,se]=c.clusterProperties[V],ue=typeof K=="string"?[K,["accumulated"],["get",V]]:K;z.push(...Nl({key:`${y}.${V}.map`,value:se,validateSpec:R,expressionContext:"cluster-map"})),z.push(...Nl({key:`${y}.${V}.reduce`,value:ue,validateSpec:R,expressionContext:"cluster-reduce"}))}return z;case"video":return oa({key:y,value:c,valueSpec:w.source_video,style:C,validateSpec:R,styleSpec:w});case"image":return oa({key:y,value:c,valueSpec:w.source_image,style:C,validateSpec:R,styleSpec:w});case"canvas":return[new Ie(y,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ph({key:`${y}.type`,value:c.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:C,validateSpec:R,styleSpec:w})}}function O7(p){let c=p.value,y=p.styleSpec,w=y.light,C=p.style,R=[],N=kr(c);if(c===void 0)return R;if(N!=="object")return R=R.concat([new Ie("light",c,`object expected, ${N} found`)]),R;for(let z in c){let V=z.match(/^(.*)-transition$/);R=R.concat(V&&w[V[1]]&&w[V[1]].transition?p.validateSpec({key:z,value:c[z],valueSpec:y.transition,validateSpec:p.validateSpec,style:C,styleSpec:y}):w[z]?p.validateSpec({key:z,value:c[z],valueSpec:w[z],validateSpec:p.validateSpec,style:C,styleSpec:y}):[new Ie(z,c[z],`unknown property "${z}"`)])}return R}function B7(p){let c=p.value,y=p.styleSpec,w=y.terrain,C=p.style,R=[],N=kr(c);if(c===void 0)return R;if(N!=="object")return R=R.concat([new Ie("terrain",c,`object expected, ${N} found`)]),R;for(let z in c)R=R.concat(w[z]?p.validateSpec({key:z,value:c[z],valueSpec:w[z],validateSpec:p.validateSpec,style:C,styleSpec:y}):[new Ie(z,c[z],`unknown property "${z}"`)]);return R}function U7(p){let c=[],y=p.value,w=p.key;if(Array.isArray(y)){let C=[],R=[];for(let N in y)y[N].id&&C.includes(y[N].id)&&c.push(new Ie(w,y,`all the sprites' ids must be unique, but ${y[N].id} is duplicated`)),C.push(y[N].id),y[N].url&&R.includes(y[N].url)&&c.push(new Ie(w,y,`all the sprites' URLs must be unique, but ${y[N].url} is duplicated`)),R.push(y[N].url),c=c.concat(oa({key:`${w}[${N}]`,value:y[N],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:p.validateSpec}));return c}return _c({key:w,value:y})}let z7={"*":()=>[],array:kp,boolean:function(p){let c=p.value,y=p.key,w=kr(c);return w!=="boolean"?[new Ie(y,c,`boolean expected, ${w} found`)]:[]},number:z0,color:function(p){let c=p.key,y=p.value,w=kr(y);return w!=="string"?[new Ie(c,y,`color expected, ${w} found`)]:Pi.parse(String(y))?[]:[new Ie(c,y,`color expected, "${y}" found`)]},constants:F7,enum:Ph,filter:G0,function:Mp,layer:V0,object:oa,source:Dh,light:O7,terrain:B7,string:_c,formatted:function(p){return _c(p).length===0?[]:Nl(p)},resolvedImage:function(p){return _c(p).length===0?[]:Nl(p)},padding:function(p){let c=p.key,y=p.value;if(kr(y)==="array"){if(y.length<1||y.length>4)return[new Ie(c,y,`padding requires 1 to 4 values; ${y.length} values found`)];let w={type:"number"},C=[];for(let R=0;R<y.length;R++)C=C.concat(p.validateSpec({key:`${c}[${R}]`,value:y[R],validateSpec:p.validateSpec,valueSpec:w}));return C}return z0({key:c,value:y,valueSpec:{}})},variableAnchorOffsetCollection:function(p){let c=p.key,y=p.value,w=kr(y),C=p.styleSpec;if(w!=="array"||y.length<1||y.length%2!=0)return[new Ie(c,y,"variableAnchorOffsetCollection requires a non-empty array of even length")];let R=[];for(let N=0;N<y.length;N+=2)R=R.concat(Ph({key:`${c}[${N}]`,value:y[N],valueSpec:C.layout_symbol["text-anchor"]})),R=R.concat(kp({key:`${c}[${N+1}]`,value:y[N+1],valueSpec:{length:2,value:"number"},validateSpec:p.validateSpec,style:p.style,styleSpec:C}));return R},sprite:U7};function Fh(p){let c=p.value,y=p.valueSpec,w=p.styleSpec;return p.validateSpec=Fh,y.expression&&L0(Ps(c))?Mp(p):y.expression&&N0(ou(c))?Nl(p):y.type&&z7[y.type]?z7[y.type](p):oa(nt({},p,{valueSpec:y.type?w[y.type]:y}))}function Lh(p){let c=p.value,y=p.key,w=_c(p);return w.length||(c.indexOf("{fontstack}")===-1&&w.push(new Ie(y,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&w.push(new Ie(y,c,'"glyphs" url must include a "{range}" token'))),w}function Ao(p,c=Se){let y=[];return y=y.concat(Fh({key:"",value:p,valueSpec:c.$root,styleSpec:c,style:p,validateSpec:Fh,objectElementValidators:{glyphs:Lh,"*":()=>[]}})),p.constants&&(y=y.concat(F7({key:"constants",value:p.constants,style:p,styleSpec:c,validateSpec:Fh}))),Nh(y)}function Vs(p){return function(c){return p({...c,validateSpec:Fh})}}function Nh(p){return[].concat(p).sort((c,y)=>c.line-y.line)}function Ol(p){return function(...c){return Nh(p.apply(this,c))}}Ao.source=Ol(Vs(Dh)),Ao.sprite=Ol(Vs(U7)),Ao.glyphs=Ol(Vs(Lh)),Ao.light=Ol(Vs(O7)),Ao.terrain=Ol(Vs(B7)),Ao.layer=Ol(Vs(V0)),Ao.filter=Ol(Vs(G0)),Ao.paintProperty=Ol(Vs(Rh)),Ao.layoutProperty=Ol(Vs(H0));let Oh=Ao,dv=Oh.light,Bh=Oh.paintProperty,fv=Oh.layoutProperty;function j0(p,c){let y=!1;if(c&&c.length)for(let w of c)p.fire(new vt(new Error(w.message))),y=!0;return y}class Uh{constructor(c,y,w){let C=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;let N=new Int32Array(this.arrayBuffer);c=N[0],this.d=(y=N[1])+2*(w=N[2]);for(let V=0;V<this.d*this.d;V++){let K=N[3+V],se=N[3+V+1];C.push(K===se?null:N.subarray(K,se))}let z=N[3+C.length+1];this.keys=N.subarray(N[3+C.length],z),this.bboxes=N.subarray(z),this.insert=this._insertReadonly}else{this.d=y+2*w;for(let N=0;N<this.d*this.d;N++)C.push([]);this.keys=[],this.bboxes=[]}this.n=y,this.extent=c,this.padding=w,this.scale=y/c,this.uid=0;let R=w/y*c;this.min=-R,this.max=c+R}insert(c,y,w,C,R){this._forEachCell(y,w,C,R,this._insertCell,this.uid++,void 0,void 0),this.keys.push(c),this.bboxes.push(y),this.bboxes.push(w),this.bboxes.push(C),this.bboxes.push(R)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(c,y,w,C,R,N){this.cells[R].push(N)}query(c,y,w,C,R){let N=this.min,z=this.max;if(c<=N&&y<=N&&z<=w&&z<=C&&!R)return Array.prototype.slice.call(this.keys);{let V=[];return this._forEachCell(c,y,w,C,this._queryCell,V,{},R),V}}_queryCell(c,y,w,C,R,N,z,V){let K=this.cells[R];if(K!==null){let se=this.keys,ue=this.bboxes;for(let fe=0;fe<K.length;fe++){let ve=K[fe];if(z[ve]===void 0){let we=4*ve;(V?V(ue[we+0],ue[we+1],ue[we+2],ue[we+3]):c<=ue[we+2]&&y<=ue[we+3]&&w>=ue[we+0]&&C>=ue[we+1])?(z[ve]=!0,N.push(se[ve])):z[ve]=!1}}}}_forEachCell(c,y,w,C,R,N,z,V){let K=this._convertToCellCoord(c),se=this._convertToCellCoord(y),ue=this._convertToCellCoord(w),fe=this._convertToCellCoord(C);for(let ve=K;ve<=ue;ve++)for(let we=se;we<=fe;we++){let ke=this.d*we+ve;if((!V||V(this._convertFromCellCoord(ve),this._convertFromCellCoord(we),this._convertFromCellCoord(ve+1),this._convertFromCellCoord(we+1)))&&R.call(this,c,y,w,C,ke,N,z,V))return}}_convertFromCellCoord(c){return(c-this.padding)/this.scale}_convertToCellCoord(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let c=this.cells,y=3+this.cells.length+1+1,w=0;for(let N=0;N<this.cells.length;N++)w+=this.cells[N].length;let C=new Int32Array(y+w+this.keys.length+this.bboxes.length);C[0]=this.extent,C[1]=this.n,C[2]=this.padding;let R=y;for(let N=0;N<c.length;N++){let z=c[N];C[3+N]=R,C.set(z,R),R+=z.length}return C[3+c.length]=R,C.set(this.keys,R),R+=this.keys.length,C[3+c.length+1]=R,C.set(this.bboxes,R),R+=this.bboxes.length,C.buffer}static serialize(c,y){let w=c.toArrayBuffer();return y&&y.push(w),{buffer:w}}static deserialize(c){return new Uh(c.buffer)}}let al={};function Zt(p,c,y={}){if(al[p])throw new Error(`${p} is already registered.`);Object.defineProperty(c,"_classRegistryKey",{value:p,writeable:!1}),al[p]={klass:c,omit:y.omit||[],shallow:y.shallow||[]}}Zt("Object",Object),Zt("TransferableGridIndex",Uh),Zt("Color",Pi),Zt("Error",Error),Zt("AJAXError",ee),Zt("ResolvedImage",na),Zt("StylePropertyFunction",nu),Zt("StyleExpression",_s,{omit:["_evaluator"]}),Zt("ZoomDependentExpression",Yr),Zt("ZoomConstantExpression",Ih),Zt("CompoundExpression",Eo,{omit:["_evaluate"]});for(let p in u1)u1[p]._classRegistryKey||Zt(`Expression_${p}`,u1[p]);function f1(p){return p&&typeof ArrayBuffer<"u"&&(p instanceof ArrayBuffer||p.constructor&&p.constructor.name==="ArrayBuffer")}function zh(p,c){if(p==null||typeof p=="boolean"||typeof p=="number"||typeof p=="string"||p instanceof Boolean||p instanceof Number||p instanceof String||p instanceof Date||p instanceof RegExp||p instanceof Blob)return p;if(f1(p)||Q(p))return c&&c.push(p),p;if(ArrayBuffer.isView(p)){let y=p;return c&&c.push(y.buffer),y}if(p instanceof ImageData)return c&&c.push(p.data.buffer),p;if(Array.isArray(p)){let y=[];for(let w of p)y.push(zh(w,c));return y}if(typeof p=="object"){let y=p.constructor,w=y._classRegistryKey;if(!w)throw new Error("can't serialize object of unregistered class");if(!al[w])throw new Error(`${w} is not registered.`);let C=y.serialize?y.serialize(p,c):{};if(y.serialize){if(c&&C===c[c.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let R in p){if(!p.hasOwnProperty(R)||al[w].omit.indexOf(R)>=0)continue;let N=p[R];C[R]=al[w].shallow.indexOf(R)>=0?N:zh(N,c)}p instanceof Error&&(C.message=p.message)}if(C.$name)throw new Error("$name property is reserved for worker serialization logic.");return w!=="Object"&&(C.$name=w),C}throw new Error("can't serialize object of type "+typeof p)}function au(p){if(p==null||typeof p=="boolean"||typeof p=="number"||typeof p=="string"||p instanceof Boolean||p instanceof Number||p instanceof String||p instanceof Date||p instanceof RegExp||p instanceof Blob||f1(p)||Q(p)||ArrayBuffer.isView(p)||p instanceof ImageData)return p;if(Array.isArray(p))return p.map(au);if(typeof p=="object"){let c=p.$name||"Object";if(!al[c])throw new Error(`can't deserialize unregistered class ${c}`);let{klass:y}=al[c];if(!y)throw new Error(`can't deserialize unregistered class ${c}`);if(y.deserialize)return y.deserialize(p);let w=Object.create(y.prototype);for(let C of Object.keys(p)){if(C==="$name")continue;let R=p[C];w[C]=al[c].shallow.indexOf(C)>=0?R:au(R)}return w}throw new Error("can't deserialize object of type "+typeof p)}class Pp{constructor(){this.first=!0}update(c,y){let w=Math.floor(c);return this.first?(this.first=!1,this.lastIntegerZoom=w,this.lastIntegerZoomTime=0,this.lastZoom=c,this.lastFloorZoom=w,!0):(this.lastFloorZoom>w?(this.lastIntegerZoom=w+1,this.lastIntegerZoomTime=y):this.lastFloorZoom<w&&(this.lastIntegerZoom=w,this.lastIntegerZoomTime=y),c!==this.lastZoom&&(this.lastZoom=c,this.lastFloorZoom=w,!0))}}let Vt={"Latin-1 Supplement":p=>p>=128&&p<=255,Arabic:p=>p>=1536&&p<=1791,"Arabic Supplement":p=>p>=1872&&p<=1919,"Arabic Extended-A":p=>p>=2208&&p<=2303,"Hangul Jamo":p=>p>=4352&&p<=4607,"Unified Canadian Aboriginal Syllabics":p=>p>=5120&&p<=5759,Khmer:p=>p>=6016&&p<=6143,"Unified Canadian Aboriginal Syllabics Extended":p=>p>=6320&&p<=6399,"General Punctuation":p=>p>=8192&&p<=8303,"Letterlike Symbols":p=>p>=8448&&p<=8527,"Number Forms":p=>p>=8528&&p<=8591,"Miscellaneous Technical":p=>p>=8960&&p<=9215,"Control Pictures":p=>p>=9216&&p<=9279,"Optical Character Recognition":p=>p>=9280&&p<=9311,"Enclosed Alphanumerics":p=>p>=9312&&p<=9471,"Geometric Shapes":p=>p>=9632&&p<=9727,"Miscellaneous Symbols":p=>p>=9728&&p<=9983,"Miscellaneous Symbols and Arrows":p=>p>=11008&&p<=11263,"CJK Radicals Supplement":p=>p>=11904&&p<=12031,"Kangxi Radicals":p=>p>=12032&&p<=12255,"Ideographic Description Characters":p=>p>=12272&&p<=12287,"CJK Symbols and Punctuation":p=>p>=12288&&p<=12351,Hiragana:p=>p>=12352&&p<=12447,Katakana:p=>p>=12448&&p<=12543,Bopomofo:p=>p>=12544&&p<=12591,"Hangul Compatibility Jamo":p=>p>=12592&&p<=12687,Kanbun:p=>p>=12688&&p<=12703,"Bopomofo Extended":p=>p>=12704&&p<=12735,"CJK Strokes":p=>p>=12736&&p<=12783,"Katakana Phonetic Extensions":p=>p>=12784&&p<=12799,"Enclosed CJK Letters and Months":p=>p>=12800&&p<=13055,"CJK Compatibility":p=>p>=13056&&p<=13311,"CJK Unified Ideographs Extension A":p=>p>=13312&&p<=19903,"Yijing Hexagram Symbols":p=>p>=19904&&p<=19967,"CJK Unified Ideographs":p=>p>=19968&&p<=40959,"Yi Syllables":p=>p>=40960&&p<=42127,"Yi Radicals":p=>p>=42128&&p<=42191,"Hangul Jamo Extended-A":p=>p>=43360&&p<=43391,"Hangul Syllables":p=>p>=44032&&p<=55215,"Hangul Jamo Extended-B":p=>p>=55216&&p<=55295,"Private Use Area":p=>p>=57344&&p<=63743,"CJK Compatibility Ideographs":p=>p>=63744&&p<=64255,"Arabic Presentation Forms-A":p=>p>=64336&&p<=65023,"Vertical Forms":p=>p>=65040&&p<=65055,"CJK Compatibility Forms":p=>p>=65072&&p<=65103,"Small Form Variants":p=>p>=65104&&p<=65135,"Arabic Presentation Forms-B":p=>p>=65136&&p<=65279,"Halfwidth and Fullwidth Forms":p=>p>=65280&&p<=65519};function X0(p){for(let c of p)if(Gh(c.charCodeAt(0)))return!0;return!1}function G7(p){for(let c of p)if(!pv(c.charCodeAt(0)))return!1;return!0}function pv(p){return!(Vt.Arabic(p)||Vt["Arabic Supplement"](p)||Vt["Arabic Extended-A"](p)||Vt["Arabic Presentation Forms-A"](p)||Vt["Arabic Presentation Forms-B"](p))}function Gh(p){return!(p!==746&&p!==747&&(p<4352||!(Vt["Bopomofo Extended"](p)||Vt.Bopomofo(p)||Vt["CJK Compatibility Forms"](p)&&!(p>=65097&&p<=65103)||Vt["CJK Compatibility Ideographs"](p)||Vt["CJK Compatibility"](p)||Vt["CJK Radicals Supplement"](p)||Vt["CJK Strokes"](p)||!(!Vt["CJK Symbols and Punctuation"](p)||p>=12296&&p<=12305||p>=12308&&p<=12319||p===12336)||Vt["CJK Unified Ideographs Extension A"](p)||Vt["CJK Unified Ideographs"](p)||Vt["Enclosed CJK Letters and Months"](p)||Vt["Hangul Compatibility Jamo"](p)||Vt["Hangul Jamo Extended-A"](p)||Vt["Hangul Jamo Extended-B"](p)||Vt["Hangul Jamo"](p)||Vt["Hangul Syllables"](p)||Vt.Hiragana(p)||Vt["Ideographic Description Characters"](p)||Vt.Kanbun(p)||Vt["Kangxi Radicals"](p)||Vt["Katakana Phonetic Extensions"](p)||Vt.Katakana(p)&&p!==12540||!(!Vt["Halfwidth and Fullwidth Forms"](p)||p===65288||p===65289||p===65293||p>=65306&&p<=65310||p===65339||p===65341||p===65343||p>=65371&&p<=65503||p===65507||p>=65512&&p<=65519)||!(!Vt["Small Form Variants"](p)||p>=65112&&p<=65118||p>=65123&&p<=65126)||Vt["Unified Canadian Aboriginal Syllabics"](p)||Vt["Unified Canadian Aboriginal Syllabics Extended"](p)||Vt["Vertical Forms"](p)||Vt["Yijing Hexagram Symbols"](p)||Vt["Yi Syllables"](p)||Vt["Yi Radicals"](p))))}function $h(p){return!(Gh(p)||function(c){return!!(Vt["Latin-1 Supplement"](c)&&(c===167||c===169||c===174||c===177||c===188||c===189||c===190||c===215||c===247)||Vt["General Punctuation"](c)&&(c===8214||c===8224||c===8225||c===8240||c===8241||c===8251||c===8252||c===8258||c===8263||c===8264||c===8265||c===8273)||Vt["Letterlike Symbols"](c)||Vt["Number Forms"](c)||Vt["Miscellaneous Technical"](c)&&(c>=8960&&c<=8967||c>=8972&&c<=8991||c>=8996&&c<=9e3||c===9003||c>=9085&&c<=9114||c>=9150&&c<=9165||c===9167||c>=9169&&c<=9179||c>=9186&&c<=9215)||Vt["Control Pictures"](c)&&c!==9251||Vt["Optical Character Recognition"](c)||Vt["Enclosed Alphanumerics"](c)||Vt["Geometric Shapes"](c)||Vt["Miscellaneous Symbols"](c)&&!(c>=9754&&c<=9759)||Vt["Miscellaneous Symbols and Arrows"](c)&&(c>=11026&&c<=11055||c>=11088&&c<=11097||c>=11192&&c<=11243)||Vt["CJK Symbols and Punctuation"](c)||Vt.Katakana(c)||Vt["Private Use Area"](c)||Vt["CJK Compatibility Forms"](c)||Vt["Small Form Variants"](c)||Vt["Halfwidth and Fullwidth Forms"](c)||c===8734||c===8756||c===8757||c>=9984&&c<=10087||c>=10102&&c<=10131||c===65532||c===65533)}(p))}function Rp(p){return p>=1424&&p<=2303||Vt["Arabic Presentation Forms-A"](p)||Vt["Arabic Presentation Forms-B"](p)}function mv(p,c){return!(!c&&Rp(p)||p>=2304&&p<=3583||p>=3840&&p<=4255||Vt.Khmer(p))}function $7(p){for(let c of p)if(Rp(c.charCodeAt(0)))return!0;return!1}let Dp="deferred",Hh="loading",Fp="loaded",Lp=null,no="unavailable",xc=null,Np=function(p){p&&typeof p=="string"&&p.indexOf("NetworkError")>-1&&(no="error"),Lp&&Lp(p)};function Op(){Bp.fire(new gt("pluginStateChange",{pluginStatus:no,pluginURL:xc}))}let Bp=new ct,Up=function(){return no},H7=function(){if(no!==Dp||!xc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");no=Hh,Op(),xc&&De({url:xc},p=>{p?Np(p):(no=Fp,Op())})},aa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>no===Fp||aa.applyArabicShaping!=null,isLoading:()=>no===Hh,setState(p){if(!q())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");no=p.pluginStatus,xc=p.pluginURL},isParsed(){if(!q())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return aa.applyArabicShaping!=null&&aa.processBidirectionalText!=null&&aa.processStyledBidirectionalText!=null},getPluginURL(){if(!q())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return xc}};class ts{constructor(c,y){this.zoom=c,y?(this.now=y.now,this.fadeDuration=y.fadeDuration,this.zoomHistory=y.zoomHistory,this.transition=y.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Pp,this.transition={})}isSupportedScript(c){return function(y,w){for(let C of y)if(!mv(C.charCodeAt(0),w))return!1;return!0}(c,aa.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let c=this.zoom,y=c-Math.floor(c),w=this.crossFadingFactor();return c>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:y+(1-y)*w}:{fromScale:.5,toScale:1,t:1-(1-w)*y}}}class W0{constructor(c,y){this.property=c,this.value=y,this.expression=function(w,C){if(L0(w))return new nu(w,C);if(N0(w)){let R=Zr(w,C);if(R.result==="error")throw new Error(R.value.map(N=>`${N.key}: ${N.message}`).join(", "));return R.value}{let R=w;return C.type==="color"&&typeof w=="string"?R=Pi.parse(w):C.type!=="padding"||typeof w!="number"&&!Array.isArray(w)?C.type==="variableAnchorOffsetCollection"&&Array.isArray(w)&&(R=Dn.parse(w)):R=wo.parse(w),{kind:"constant",evaluate:()=>R}}}(y===void 0?c.specification.default:y,c.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(c,y,w){return this.property.possiblyEvaluate(this,c,y,w)}}class p1{constructor(c){this.property=c,this.value=new W0(c,void 0)}transitioned(c,y){return new q0(this.property,this.value,y,T({},c.transition,this.transition),c.now)}untransitioned(){return new q0(this.property,this.value,null,{},0)}}class V7{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitionablePropertyValues)}getValue(c){return F(this._values[c].value.value)}setValue(c,y){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new p1(this._values[c].property)),this._values[c].value=new W0(this._values[c].property,y===null?void 0:F(y))}getTransition(c){return F(this._values[c].transition)}setTransition(c,y){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new p1(this._values[c].property)),this._values[c].transition=F(y)||void 0}serialize(){let c={};for(let y of Object.keys(this._values)){let w=this.getValue(y);w!==void 0&&(c[y]=w);let C=this.getTransition(y);C!==void 0&&(c[`${y}-transition`]=C)}return c}transitioned(c,y){let w=new j7(this._properties);for(let C of Object.keys(this._values))w._values[C]=this._values[C].transitioned(c,y._values[C]);return w}untransitioned(){let c=new j7(this._properties);for(let y of Object.keys(this._values))c._values[y]=this._values[y].untransitioned();return c}}class q0{constructor(c,y,w,C,R){this.property=c,this.value=y,this.begin=R+C.delay||0,this.end=this.begin+C.duration||0,c.specification.transition&&(C.delay||C.duration)&&(this.prior=w)}possiblyEvaluate(c,y,w){let C=c.now||0,R=this.value.possiblyEvaluate(c,y,w),N=this.prior;if(N){if(C>this.end)return this.prior=null,R;if(this.value.isDataDriven())return this.prior=null,R;if(C<this.begin)return N.possiblyEvaluate(c,y,w);{let z=(C-this.begin)/(this.end-this.begin);return this.property.interpolate(N.possiblyEvaluate(c,y,w),R,function(V){if(V<=0)return 0;if(V>=1)return 1;let K=V*V,se=K*V;return 4*(V<.5?se:3*(V-K)+se-.75)}(z))}}return R}}class j7{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitioningPropertyValues)}possiblyEvaluate(c,y,w){let C=new Vh(this._properties);for(let R of Object.keys(this._values))C._values[R]=this._values[R].possiblyEvaluate(c,y,w);return C}hasTransition(){for(let c of Object.keys(this._values))if(this._values[c].prior)return!0;return!1}}class gv{constructor(c){this._properties=c,this._values=Object.create(c.defaultPropertyValues)}hasValue(c){return this._values[c].value!==void 0}getValue(c){return F(this._values[c].value)}setValue(c,y){this._values[c]=new W0(this._values[c].property,y===null?void 0:F(y))}serialize(){let c={};for(let y of Object.keys(this._values)){let w=this.getValue(y);w!==void 0&&(c[y]=w)}return c}possiblyEvaluate(c,y,w){let C=new Vh(this._properties);for(let R of Object.keys(this._values))C._values[R]=this._values[R].possiblyEvaluate(c,y,w);return C}}class ka{constructor(c,y,w){this.property=c,this.value=y,this.parameters=w}isConstant(){return this.value.kind==="constant"}constantOr(c){return this.value.kind==="constant"?this.value.value:c}evaluate(c,y,w,C){return this.property.evaluate(this.value,this.parameters,c,y,w,C)}}class Vh{constructor(c){this._properties=c,this._values=Object.create(c.defaultPossiblyEvaluatedValues)}get(c){return this._values[c]}}class di{constructor(c){this.specification=c}possiblyEvaluate(c,y){if(c.isDataDriven())throw new Error("Value should not be data driven");return c.expression.evaluate(y)}interpolate(c,y,w){let C=To[this.specification.type];return C?C(c,y,w):c}}class Ci{constructor(c,y){this.specification=c,this.overrides=y}possiblyEvaluate(c,y,w,C){return new ka(this,c.expression.kind==="constant"||c.expression.kind==="camera"?{kind:"constant",value:c.expression.evaluate(y,null,{},w,C)}:c.expression,y)}interpolate(c,y,w){if(c.value.kind!=="constant"||y.value.kind!=="constant")return c;if(c.value.value===void 0||y.value.value===void 0)return new ka(this,{kind:"constant",value:void 0},c.parameters);let C=To[this.specification.type];if(C){let R=C(c.value.value,y.value.value,w);return new ka(this,{kind:"constant",value:R},c.parameters)}return c}evaluate(c,y,w,C,R,N){return c.kind==="constant"?c.value:c.evaluate(y,w,C,R,N)}}class Y0 extends Ci{possiblyEvaluate(c,y,w,C){if(c.value===void 0)return new ka(this,{kind:"constant",value:void 0},y);if(c.expression.kind==="constant"){let R=c.expression.evaluate(y,null,{},w,C),N=c.property.specification.type==="resolvedImage"&&typeof R!="string"?R.name:R,z=this._calculate(N,N,N,y);return new ka(this,{kind:"constant",value:z},y)}if(c.expression.kind==="camera"){let R=this._calculate(c.expression.evaluate({zoom:y.zoom-1}),c.expression.evaluate({zoom:y.zoom}),c.expression.evaluate({zoom:y.zoom+1}),y);return new ka(this,{kind:"constant",value:R},y)}return new ka(this,c.expression,y)}evaluate(c,y,w,C,R,N){if(c.kind==="source"){let z=c.evaluate(y,w,C,R,N);return this._calculate(z,z,z,y)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(y.zoom)-1},w,C),c.evaluate({zoom:Math.floor(y.zoom)},w,C),c.evaluate({zoom:Math.floor(y.zoom)+1},w,C),y):c.value}_calculate(c,y,w,C){return C.zoom>C.zoomHistory.lastIntegerZoom?{from:c,to:y}:{from:w,to:y}}interpolate(c){return c}}class zp{constructor(c){this.specification=c}possiblyEvaluate(c,y,w,C){if(c.value!==void 0){if(c.expression.kind==="constant"){let R=c.expression.evaluate(y,null,{},w,C);return this._calculate(R,R,R,y)}return this._calculate(c.expression.evaluate(new ts(Math.floor(y.zoom-1),y)),c.expression.evaluate(new ts(Math.floor(y.zoom),y)),c.expression.evaluate(new ts(Math.floor(y.zoom+1),y)),y)}}_calculate(c,y,w,C){return C.zoom>C.zoomHistory.lastIntegerZoom?{from:c,to:y}:{from:w,to:y}}interpolate(c){return c}}class Gp{constructor(c){this.specification=c}possiblyEvaluate(c,y,w,C){return!!c.expression.evaluate(y,null,{},w,C)}interpolate(){return!1}}class oo{constructor(c){this.properties=c,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let y in c){let w=c[y];w.specification.overridable&&this.overridableProperties.push(y);let C=this.defaultPropertyValues[y]=new W0(w,void 0),R=this.defaultTransitionablePropertyValues[y]=new p1(w);this.defaultTransitioningPropertyValues[y]=R.untransitioned(),this.defaultPossiblyEvaluatedValues[y]=C.possiblyEvaluate({})}}}Zt("DataDrivenProperty",Ci),Zt("DataConstantProperty",di),Zt("CrossFadedDataDrivenProperty",Y0),Zt("CrossFadedProperty",zp),Zt("ColorRampProperty",Gp);let lu="-transition";class ll extends ct{constructor(c,y){if(super(),this.id=c.id,this.type=c.type,this._featureFilter={filter:()=>!0,needGeometry:!1},c.type!=="custom"&&(this.metadata=c.metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),y.layout&&(this._unevaluatedLayout=new gv(y.layout)),y.paint)){this._transitionablePaint=new V7(y.paint);for(let w in c.paint)this.setPaintProperty(w,c.paint[w],{validate:!1});for(let w in c.layout)this.setLayoutProperty(w,c.layout[w],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Vh(y.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)}setLayoutProperty(c,y,w={}){y!=null&&this._validate(fv,`layers.${this.id}.layout.${c}`,c,y,w)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,y):this.visibility=y)}getPaintProperty(c){return c.endsWith(lu)?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)}setPaintProperty(c,y,w={}){if(y!=null&&this._validate(Bh,`layers.${this.id}.paint.${c}`,c,y,w))return!1;if(c.endsWith(lu))return this._transitionablePaint.setTransition(c.slice(0,-11),y||void 0),!1;{let C=this._transitionablePaint._values[c],R=C.property.specification["property-type"]==="cross-faded-data-driven",N=C.value.isDataDriven(),z=C.value;this._transitionablePaint.setValue(c,y),this._handleSpecialPaintPropertyUpdate(c);let V=this._transitionablePaint._values[c].value;return V.isDataDriven()||N||R||this._handleOverridablePaintPropertyUpdate(c,z,V)}}_handleSpecialPaintPropertyUpdate(c){}_handleOverridablePaintPropertyUpdate(c,y,w){return!1}isHidden(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"}updateTransitions(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(c,y){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,y)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,y)}serialize(){let c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),k(c,(y,w)=>!(y===void 0||w==="layout"&&!Object.keys(y).length||w==="paint"&&!Object.keys(y).length))}_validate(c,y,w,C,R={}){return(!R||R.validate!==!1)&&j0(this,c.call(Oh,{key:y,layerType:this.type,objectKey:w,value:C,styleSpec:Se,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let c in this.paint._values){let y=this.paint.get(c);if(y instanceof ka&&d1(y.property.specification)&&(y.value.kind==="source"||y.value.kind==="composite")&&y.value.isStateDependent)return!0}return!1}}let yv={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class jh{constructor(c,y){this._structArray=c,this._pos1=y*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class cs{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(c,y){return c._trim(),y&&(c.isTransferred=!0,y.push(c.arrayBuffer)),{length:c.length,arrayBuffer:c.arrayBuffer}}static deserialize(c){let y=Object.create(this.prototype);return y.arrayBuffer=c.arrayBuffer,y.length=c.length,y.capacity=c.arrayBuffer.byteLength/y.bytesPerElement,y._refreshViews(),y}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(c){this.reserve(c),this.length=c}reserve(c){if(c>this.capacity){this.capacity=Math.max(c,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let y=this.uint8;this._refreshViews(),y&&this.uint8.set(y)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Rs(p,c=1){let y=0,w=0;return{members:p.map(C=>{let R=yv[C.type].BYTES_PER_ELEMENT,N=y=X7(y,Math.max(c,R)),z=C.components||1;return w=Math.max(w,R),y+=R*z,{name:C.name,type:C.type,components:z,offset:N}}),size:X7(y,Math.max(w,c)),alignment:c}}function X7(p,c){return Math.ceil(p/c)*c}class la extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,y){let w=this.length;return this.resize(w+1),this.emplace(w,c,y)}emplace(c,y,w){let C=2*c;return this.int16[C+0]=y,this.int16[C+1]=w,c}}la.prototype.bytesPerElement=4,Zt("StructArrayLayout2i4",la);class Xh extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,y,w){let C=this.length;return this.resize(C+1),this.emplace(C,c,y,w)}emplace(c,y,w,C){let R=3*c;return this.int16[R+0]=y,this.int16[R+1]=w,this.int16[R+2]=C,c}}Xh.prototype.bytesPerElement=6,Zt("StructArrayLayout3i6",Xh);class Wh extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,y,w,C){let R=this.length;return this.resize(R+1),this.emplace(R,c,y,w,C)}emplace(c,y,w,C,R){let N=4*c;return this.int16[N+0]=y,this.int16[N+1]=w,this.int16[N+2]=C,this.int16[N+3]=R,c}}Wh.prototype.bytesPerElement=8,Zt("StructArrayLayout4i8",Wh);class Z0 extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,y,w,C,R,N){let z=this.length;return this.resize(z+1),this.emplace(z,c,y,w,C,R,N)}emplace(c,y,w,C,R,N,z){let V=6*c;return this.int16[V+0]=y,this.int16[V+1]=w,this.int16[V+2]=C,this.int16[V+3]=R,this.int16[V+4]=N,this.int16[V+5]=z,c}}Z0.prototype.bytesPerElement=12,Zt("StructArrayLayout2i4i12",Z0);class qh extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,y,w,C,R,N){let z=this.length;return this.resize(z+1),this.emplace(z,c,y,w,C,R,N)}emplace(c,y,w,C,R,N,z){let V=4*c,K=8*c;return this.int16[V+0]=y,this.int16[V+1]=w,this.uint8[K+4]=C,this.uint8[K+5]=R,this.uint8[K+6]=N,this.uint8[K+7]=z,c}}qh.prototype.bytesPerElement=8,Zt("StructArrayLayout2i4ub8",qh);class Yh extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,y){let w=this.length;return this.resize(w+1),this.emplace(w,c,y)}emplace(c,y,w){let C=2*c;return this.float32[C+0]=y,this.float32[C+1]=w,c}}Yh.prototype.bytesPerElement=8,Zt("StructArrayLayout2f8",Yh);class m1 extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,y,w,C,R,N,z,V,K,se){let ue=this.length;return this.resize(ue+1),this.emplace(ue,c,y,w,C,R,N,z,V,K,se)}emplace(c,y,w,C,R,N,z,V,K,se,ue){let fe=10*c;return this.uint16[fe+0]=y,this.uint16[fe+1]=w,this.uint16[fe+2]=C,this.uint16[fe+3]=R,this.uint16[fe+4]=N,this.uint16[fe+5]=z,this.uint16[fe+6]=V,this.uint16[fe+7]=K,this.uint16[fe+8]=se,this.uint16[fe+9]=ue,c}}m1.prototype.bytesPerElement=20,Zt("StructArrayLayout10ui20",m1);class cu extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,y,w,C,R,N,z,V,K,se,ue,fe){let ve=this.length;return this.resize(ve+1),this.emplace(ve,c,y,w,C,R,N,z,V,K,se,ue,fe)}emplace(c,y,w,C,R,N,z,V,K,se,ue,fe,ve){let we=12*c;return this.int16[we+0]=y,this.int16[we+1]=w,this.int16[we+2]=C,this.int16[we+3]=R,this.uint16[we+4]=N,this.uint16[we+5]=z,this.uint16[we+6]=V,this.uint16[we+7]=K,this.int16[we+8]=se,this.int16[we+9]=ue,this.int16[we+10]=fe,this.int16[we+11]=ve,c}}cu.prototype.bytesPerElement=24,Zt("StructArrayLayout4i4ui4i24",cu);class $p extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,y,w){let C=this.length;return this.resize(C+1),this.emplace(C,c,y,w)}emplace(c,y,w,C){let R=3*c;return this.float32[R+0]=y,this.float32[R+1]=w,this.float32[R+2]=C,c}}$p.prototype.bytesPerElement=12,Zt("StructArrayLayout3f12",$p);class Q0 extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c){let y=this.length;return this.resize(y+1),this.emplace(y,c)}emplace(c,y){return this.uint32[1*c+0]=y,c}}Q0.prototype.bytesPerElement=4,Zt("StructArrayLayout1ul4",Q0);class uu extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,y,w,C,R,N,z,V,K){let se=this.length;return this.resize(se+1),this.emplace(se,c,y,w,C,R,N,z,V,K)}emplace(c,y,w,C,R,N,z,V,K,se){let ue=10*c,fe=5*c;return this.int16[ue+0]=y,this.int16[ue+1]=w,this.int16[ue+2]=C,this.int16[ue+3]=R,this.int16[ue+4]=N,this.int16[ue+5]=z,this.uint32[fe+3]=V,this.uint16[ue+8]=K,this.uint16[ue+9]=se,c}}uu.prototype.bytesPerElement=20,Zt("StructArrayLayout6i1ul2ui20",uu);class Hp extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,y,w,C,R,N){let z=this.length;return this.resize(z+1),this.emplace(z,c,y,w,C,R,N)}emplace(c,y,w,C,R,N,z){let V=6*c;return this.int16[V+0]=y,this.int16[V+1]=w,this.int16[V+2]=C,this.int16[V+3]=R,this.int16[V+4]=N,this.int16[V+5]=z,c}}Hp.prototype.bytesPerElement=12,Zt("StructArrayLayout2i2i2i12",Hp);class Vp extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,y,w,C,R){let N=this.length;return this.resize(N+1),this.emplace(N,c,y,w,C,R)}emplace(c,y,w,C,R,N){let z=4*c,V=8*c;return this.float32[z+0]=y,this.float32[z+1]=w,this.float32[z+2]=C,this.int16[V+6]=R,this.int16[V+7]=N,c}}Vp.prototype.bytesPerElement=16,Zt("StructArrayLayout2f1f2i16",Vp);class K0 extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,y,w,C){let R=this.length;return this.resize(R+1),this.emplace(R,c,y,w,C)}emplace(c,y,w,C,R){let N=12*c,z=3*c;return this.uint8[N+0]=y,this.uint8[N+1]=w,this.float32[z+1]=C,this.float32[z+2]=R,c}}K0.prototype.bytesPerElement=12,Zt("StructArrayLayout2ub2f12",K0);class J0 extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,y,w){let C=this.length;return this.resize(C+1),this.emplace(C,c,y,w)}emplace(c,y,w,C){let R=3*c;return this.uint16[R+0]=y,this.uint16[R+1]=w,this.uint16[R+2]=C,c}}J0.prototype.bytesPerElement=6,Zt("StructArrayLayout3ui6",J0);class jp extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,y,w,C,R,N,z,V,K,se,ue,fe,ve,we,ke,Le,Be){let qe=this.length;return this.resize(qe+1),this.emplace(qe,c,y,w,C,R,N,z,V,K,se,ue,fe,ve,we,ke,Le,Be)}emplace(c,y,w,C,R,N,z,V,K,se,ue,fe,ve,we,ke,Le,Be,qe){let $e=24*c,et=12*c,it=48*c;return this.int16[$e+0]=y,this.int16[$e+1]=w,this.uint16[$e+2]=C,this.uint16[$e+3]=R,this.uint32[et+2]=N,this.uint32[et+3]=z,this.uint32[et+4]=V,this.uint16[$e+10]=K,this.uint16[$e+11]=se,this.uint16[$e+12]=ue,this.float32[et+7]=fe,this.float32[et+8]=ve,this.uint8[it+36]=we,this.uint8[it+37]=ke,this.uint8[it+38]=Le,this.uint32[et+10]=Be,this.int16[$e+22]=qe,c}}jp.prototype.bytesPerElement=48,Zt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",jp);class Tr extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,y,w,C,R,N,z,V,K,se,ue,fe,ve,we,ke,Le,Be,qe,$e,et,it,pt,Xt,ai,jt,zt,Rt,Qt){let Nt=this.length;return this.resize(Nt+1),this.emplace(Nt,c,y,w,C,R,N,z,V,K,se,ue,fe,ve,we,ke,Le,Be,qe,$e,et,it,pt,Xt,ai,jt,zt,Rt,Qt)}emplace(c,y,w,C,R,N,z,V,K,se,ue,fe,ve,we,ke,Le,Be,qe,$e,et,it,pt,Xt,ai,jt,zt,Rt,Qt,Nt){let Ct=32*c,xi=16*c;return this.int16[Ct+0]=y,this.int16[Ct+1]=w,this.int16[Ct+2]=C,this.int16[Ct+3]=R,this.int16[Ct+4]=N,this.int16[Ct+5]=z,this.int16[Ct+6]=V,this.int16[Ct+7]=K,this.uint16[Ct+8]=se,this.uint16[Ct+9]=ue,this.uint16[Ct+10]=fe,this.uint16[Ct+11]=ve,this.uint16[Ct+12]=we,this.uint16[Ct+13]=ke,this.uint16[Ct+14]=Le,this.uint16[Ct+15]=Be,this.uint16[Ct+16]=qe,this.uint16[Ct+17]=$e,this.uint16[Ct+18]=et,this.uint16[Ct+19]=it,this.uint16[Ct+20]=pt,this.uint16[Ct+21]=Xt,this.uint16[Ct+22]=ai,this.uint32[xi+12]=jt,this.float32[xi+13]=zt,this.float32[xi+14]=Rt,this.uint16[Ct+30]=Qt,this.uint16[Ct+31]=Nt,c}}Tr.prototype.bytesPerElement=64,Zt("StructArrayLayout8i15ui1ul2f2ui64",Tr);class P extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c){let y=this.length;return this.resize(y+1),this.emplace(y,c)}emplace(c,y){return this.float32[1*c+0]=y,c}}P.prototype.bytesPerElement=4,Zt("StructArrayLayout1f4",P);class h extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,y,w){let C=this.length;return this.resize(C+1),this.emplace(C,c,y,w)}emplace(c,y,w,C){let R=3*c;return this.uint16[6*c+0]=y,this.float32[R+1]=w,this.float32[R+2]=C,c}}h.prototype.bytesPerElement=12,Zt("StructArrayLayout1ui2f12",h);class x extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,y,w){let C=this.length;return this.resize(C+1),this.emplace(C,c,y,w)}emplace(c,y,w,C){let R=4*c;return this.uint32[2*c+0]=y,this.uint16[R+2]=w,this.uint16[R+3]=C,c}}x.prototype.bytesPerElement=8,Zt("StructArrayLayout1ul2ui8",x);class S extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,y){let w=this.length;return this.resize(w+1),this.emplace(w,c,y)}emplace(c,y,w){let C=2*c;return this.uint16[C+0]=y,this.uint16[C+1]=w,c}}S.prototype.bytesPerElement=4,Zt("StructArrayLayout2ui4",S);class I extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c){let y=this.length;return this.resize(y+1),this.emplace(y,c)}emplace(c,y){return this.uint16[1*c+0]=y,c}}I.prototype.bytesPerElement=2,Zt("StructArrayLayout1ui2",I);class D extends cs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,y,w,C){let R=this.length;return this.resize(R+1),this.emplace(R,c,y,w,C)}emplace(c,y,w,C,R){let N=4*c;return this.float32[N+0]=y,this.float32[N+1]=w,this.float32[N+2]=C,this.float32[N+3]=R,c}}D.prototype.bytesPerElement=16,Zt("StructArrayLayout4f16",D);class G extends jh{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new u(this.anchorPointX,this.anchorPointY)}}G.prototype.size=20;class H extends uu{get(c){return new G(this,c)}}Zt("CollisionBoxArray",H);class Y extends jh{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(c){this._structArray.uint8[this._pos1+37]=c}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(c){this._structArray.uint8[this._pos1+38]=c}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(c){this._structArray.uint32[this._pos4+10]=c}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Y.prototype.size=48;class J extends jp{get(c){return new Y(this,c)}}Zt("PlacedSymbolArray",J);class re extends jh{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(c){this._structArray.uint32[this._pos4+12]=c}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}re.prototype.size=64;class ae extends Tr{get(c){return new re(this,c)}}Zt("SymbolInstanceArray",ae);class _e extends P{getoffsetX(c){return this.float32[1*c+0]}}Zt("GlyphOffsetArray",_e);class Ce extends Xh{getx(c){return this.int16[3*c+0]}gety(c){return this.int16[3*c+1]}gettileUnitDistanceFromAnchor(c){return this.int16[3*c+2]}}Zt("SymbolLineVertexArray",Ce);class Ae extends jh{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ae.prototype.size=12;class Re extends h{get(c){return new Ae(this,c)}}Zt("TextAnchorOffsetArray",Re);class Te extends jh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Te.prototype.size=8;class Ve extends x{get(c){return new Te(this,c)}}Zt("FeatureIndexArray",Ve);class tt extends la{}class Ne extends la{}class Xe extends la{}class rt extends Z0{}class st extends qh{}class ft extends Yh{}class Tt extends m1{}class Et extends cu{}class kt extends $p{}class oi extends Q0{}class or extends Hp{}class Ut extends K0{}class yi extends J0{}class ii extends S{}let is=Rs([{name:"a_pos",components:2,type:"Int16"}],4),{members:ar}=is;class _i{constructor(c=[]){this.segments=c}prepareSegment(c,y,w,C){let R=this.segments[this.segments.length-1];return c>_i.MAX_VERTEX_ARRAY_LENGTH&&B(`Max vertices per segment is ${_i.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${c}`),(!R||R.vertexLength+c>_i.MAX_VERTEX_ARRAY_LENGTH||R.sortKey!==C)&&(R={vertexOffset:y.length,primitiveOffset:w.length,vertexLength:0,primitiveLength:0},C!==void 0&&(R.sortKey=C),this.segments.push(R)),R}get(){return this.segments}destroy(){for(let c of this.segments)for(let y in c.vaos)c.vaos[y].destroy()}static simpleSegment(c,y,w,C){return new _i([{vertexOffset:c,primitiveOffset:y,vertexLength:w,primitiveLength:C,vaos:{},sortKey:0}])}}function lr(p,c){return 256*(p=E(Math.floor(p),0,255))+E(Math.floor(c),0,255)}_i.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt("SegmentVector",_i);let us=Rs([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Dr={exports:{}},Co={exports:{}};Co.exports=function(p,c){var y,w,C,R,N,z,V,K;for(w=p.length-(y=3&p.length),C=c,N=3432918353,z=461845907,K=0;K<w;)V=255&p.charCodeAt(K)|(255&p.charCodeAt(++K))<<8|(255&p.charCodeAt(++K))<<16|(255&p.charCodeAt(++K))<<24,++K,C=27492+(65535&(R=5*(65535&(C=(C^=V=(65535&(V=(V=(65535&V)*N+(((V>>>16)*N&65535)<<16)&4294967295)<<15|V>>>17))*z+(((V>>>16)*z&65535)<<16)&4294967295)<<13|C>>>19))+((5*(C>>>16)&65535)<<16)&4294967295))+((58964+(R>>>16)&65535)<<16);switch(V=0,y){case 3:V^=(255&p.charCodeAt(K+2))<<16;case 2:V^=(255&p.charCodeAt(K+1))<<8;case 1:C^=V=(65535&(V=(V=(65535&(V^=255&p.charCodeAt(K)))*N+(((V>>>16)*N&65535)<<16)&4294967295)<<15|V>>>17))*z+(((V>>>16)*z&65535)<<16)&4294967295}return C^=p.length,C=2246822507*(65535&(C^=C>>>16))+((2246822507*(C>>>16)&65535)<<16)&4294967295,C=3266489909*(65535&(C^=C>>>13))+((3266489909*(C>>>16)&65535)<<16)&4294967295,(C^=C>>>16)>>>0};var Sn=Co.exports,Ts={exports:{}};Ts.exports=function(p,c){for(var y,w=p.length,C=c^w,R=0;w>=4;)y=1540483477*(65535&(y=255&p.charCodeAt(R)|(255&p.charCodeAt(++R))<<8|(255&p.charCodeAt(++R))<<16|(255&p.charCodeAt(++R))<<24))+((1540483477*(y>>>16)&65535)<<16),C=1540483477*(65535&C)+((1540483477*(C>>>16)&65535)<<16)^(y=1540483477*(65535&(y^=y>>>24))+((1540483477*(y>>>16)&65535)<<16)),w-=4,++R;switch(w){case 3:C^=(255&p.charCodeAt(R+2))<<16;case 2:C^=(255&p.charCodeAt(R+1))<<8;case 1:C=1540483477*(65535&(C^=255&p.charCodeAt(R)))+((1540483477*(C>>>16)&65535)<<16)}return C=1540483477*(65535&(C^=C>>>13))+((1540483477*(C>>>16)&65535)<<16),(C^=C>>>15)>>>0};var ao=Sn,cl=Ts.exports;Dr.exports=ao,Dr.exports.murmur3=ao,Dr.exports.murmur2=cl;var Ma=o(Dr.exports);class ul{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(c,y,w,C){this.ids.push(g1(c)),this.positions.push(y,w,C)}getPositions(c){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let y=g1(c),w=0,C=this.ids.length-1;for(;w<C;){let N=w+C>>1;this.ids[N]>=y?C=N:w=N+1}let R=[];for(;this.ids[w]===y;)R.push({index:this.positions[3*w],start:this.positions[3*w+1],end:this.positions[3*w+2]}),w++;return R}static serialize(c,y){let w=new Float64Array(c.ids),C=new Uint32Array(c.positions);return vc(w,C,0,w.length-1),y&&y.push(w.buffer,C.buffer),{ids:w,positions:C}}static deserialize(c){let y=new ul;return y.ids=c.ids,y.positions=c.positions,y.indexed=!0,y}}function g1(p){let c=+p;return!isNaN(c)&&c<=Number.MAX_SAFE_INTEGER?c:Ma(String(p))}function vc(p,c,y,w){for(;y<w;){let C=p[y+w>>1],R=y-1,N=w+1;for(;;){do R++;while(p[R]<C);do N--;while(p[N]>C);if(R>=N)break;Bl(p,R,N),Bl(c,3*R,3*N),Bl(c,3*R+1,3*N+1),Bl(c,3*R+2,3*N+2)}N-y<w-N?(vc(p,c,y,N),y=N+1):(vc(p,c,N+1,w),w=N)}}function Bl(p,c,y){let w=p[c];p[c]=p[y],p[y]=w}Zt("FeaturePositionMap",ul);class Ds{constructor(c,y){this.gl=c.gl,this.location=y}}class nn extends Ds{constructor(c,y){super(c,y),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Ln extends Ds{constructor(c,y){super(c,y),this.current=[0,0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))}}class y1 extends Ds{constructor(c,y){super(c,y),this.current=Pi.transparent}set(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))}}let on=new Float32Array(16);function js(p){return[lr(255*p.r,255*p.g),lr(255*p.b,255*p.a)]}class Nn{constructor(c,y,w){this.value=c,this.uniformNames=y.map(C=>`u_${C}`),this.type=w}setUniform(c,y,w){c.set(w.constantOr(this.value))}getBinding(c,y,w){return this.type==="color"?new y1(c,y):new nn(c,y)}}class hs{constructor(c,y){this.uniformNames=y.map(w=>`u_${w}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(c,y){this.pixelRatioFrom=y.pixelRatio,this.pixelRatioTo=c.pixelRatio,this.patternFrom=y.tlbr,this.patternTo=c.tlbr}setUniform(c,y,w,C){let R=C==="u_pattern_to"?this.patternTo:C==="u_pattern_from"?this.patternFrom:C==="u_pixel_ratio_to"?this.pixelRatioTo:C==="u_pixel_ratio_from"?this.pixelRatioFrom:null;R&&c.set(R)}getBinding(c,y,w){return w.substr(0,9)==="u_pattern"?new Ln(c,y):new nn(c,y)}}class Ul{constructor(c,y,w,C){this.expression=c,this.type=w,this.maxValue=0,this.paintVertexAttributes=y.map(R=>({name:`a_${R}`,type:"Float32",components:w==="color"?2:1,offset:0})),this.paintVertexArray=new C}populatePaintArray(c,y,w,C,R){let N=this.paintVertexArray.length,z=this.expression.evaluate(new ts(0),y,{},C,[],R);this.paintVertexArray.resize(c),this._setPaintValue(N,c,z)}updatePaintArray(c,y,w,C){let R=this.expression.evaluate({zoom:0},w,C);this._setPaintValue(c,y,R)}_setPaintValue(c,y,w){if(this.type==="color"){let C=js(w);for(let R=c;R<y;R++)this.paintVertexArray.emplace(R,C[0],C[1])}else{for(let C=c;C<y;C++)this.paintVertexArray.emplace(C,w);this.maxValue=Math.max(this.maxValue,Math.abs(w))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Pa{constructor(c,y,w,C,R,N){this.expression=c,this.uniformNames=y.map(z=>`u_${z}_t`),this.type=w,this.useIntegerZoom=C,this.zoom=R,this.maxValue=0,this.paintVertexAttributes=y.map(z=>({name:`a_${z}`,type:"Float32",components:w==="color"?4:2,offset:0})),this.paintVertexArray=new N}populatePaintArray(c,y,w,C,R){let N=this.expression.evaluate(new ts(this.zoom),y,{},C,[],R),z=this.expression.evaluate(new ts(this.zoom+1),y,{},C,[],R),V=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValue(V,c,N,z)}updatePaintArray(c,y,w,C){let R=this.expression.evaluate({zoom:this.zoom},w,C),N=this.expression.evaluate({zoom:this.zoom+1},w,C);this._setPaintValue(c,y,R,N)}_setPaintValue(c,y,w,C){if(this.type==="color"){let R=js(w),N=js(C);for(let z=c;z<y;z++)this.paintVertexArray.emplace(z,R[0],R[1],N[0],N[1])}else{for(let R=c;R<y;R++)this.paintVertexArray.emplace(R,w,C);this.maxValue=Math.max(this.maxValue,Math.abs(w),Math.abs(C))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(c,y){let w=this.useIntegerZoom?Math.floor(y.zoom):y.zoom,C=E(this.expression.interpolationFactor(w,this.zoom,this.zoom+1),0,1);c.set(C)}getBinding(c,y,w){return new nn(c,y)}}class bc{constructor(c,y,w,C,R,N){this.expression=c,this.type=y,this.useIntegerZoom=w,this.zoom=C,this.layerId=N,this.zoomInPaintVertexArray=new R,this.zoomOutPaintVertexArray=new R}populatePaintArray(c,y,w){let C=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(c),this.zoomOutPaintVertexArray.resize(c),this._setPaintValues(C,c,y.patterns&&y.patterns[this.layerId],w)}updatePaintArray(c,y,w,C,R){this._setPaintValues(c,y,w.patterns&&w.patterns[this.layerId],R)}_setPaintValues(c,y,w,C){if(!C||!w)return;let{min:R,mid:N,max:z}=w,V=C[R],K=C[N],se=C[z];if(V&&K&&se)for(let ue=c;ue<y;ue++)this.zoomInPaintVertexArray.emplace(ue,K.tl[0],K.tl[1],K.br[0],K.br[1],V.tl[0],V.tl[1],V.br[0],V.br[1],K.pixelRatio,V.pixelRatio),this.zoomOutPaintVertexArray.emplace(ue,K.tl[0],K.tl[1],K.br[0],K.br[1],se.tl[0],se.tl[1],se.br[0],se.br[1],K.pixelRatio,se.pixelRatio)}upload(c){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=c.createVertexBuffer(this.zoomInPaintVertexArray,us.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=c.createVertexBuffer(this.zoomOutPaintVertexArray,us.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class W7{constructor(c,y,w){this.binders={},this._buffers=[];let C=[];for(let R in c.paint._values){if(!w(R))continue;let N=c.paint.get(R);if(!(N instanceof ka&&d1(N.property.specification)))continue;let z=_v(R,c.type),V=N.value,K=N.property.specification.type,se=N.property.useIntegerZoom,ue=N.property.specification["property-type"],fe=ue==="cross-faded"||ue==="cross-faded-data-driven";if(V.kind==="constant")this.binders[R]=fe?new hs(V.value,z):new Nn(V.value,z,K),C.push(`/u_${R}`);else if(V.kind==="source"||fe){let ve=du(R,K,"source");this.binders[R]=fe?new bc(V,K,se,y,ve,c.id):new Ul(V,z,K,ve),C.push(`/a_${R}`)}else{let ve=du(R,K,"composite");this.binders[R]=new Pa(V,z,K,se,y,ve),C.push(`/z_${R}`)}}this.cacheKey=C.sort().join("")}getMaxValue(c){let y=this.binders[c];return y instanceof Ul||y instanceof Pa?y.maxValue:0}populatePaintArrays(c,y,w,C,R){for(let N in this.binders){let z=this.binders[N];(z instanceof Ul||z instanceof Pa||z instanceof bc)&&z.populatePaintArray(c,y,w,C,R)}}setConstantPatternPositions(c,y){for(let w in this.binders){let C=this.binders[w];C instanceof hs&&C.setConstantPatternPositions(c,y)}}updatePaintArrays(c,y,w,C,R){let N=!1;for(let z in c){let V=y.getPositions(z);for(let K of V){let se=w.feature(K.index);for(let ue in this.binders){let fe=this.binders[ue];if((fe instanceof Ul||fe instanceof Pa||fe instanceof bc)&&fe.expression.isStateDependent===!0){let ve=C.paint.get(ue);fe.expression=ve.value,fe.updatePaintArray(K.start,K.end,se,c[z],R),N=!0}}}}return N}defines(){let c=[];for(let y in this.binders){let w=this.binders[y];(w instanceof Nn||w instanceof hs)&&c.push(...w.uniformNames.map(C=>`#define HAS_UNIFORM_${C}`))}return c}getBinderAttributes(){let c=[];for(let y in this.binders){let w=this.binders[y];if(w instanceof Ul||w instanceof Pa)for(let C=0;C<w.paintVertexAttributes.length;C++)c.push(w.paintVertexAttributes[C].name);else if(w instanceof bc)for(let C=0;C<us.members.length;C++)c.push(us.members[C].name)}return c}getBinderUniforms(){let c=[];for(let y in this.binders){let w=this.binders[y];if(w instanceof Nn||w instanceof hs||w instanceof Pa)for(let C of w.uniformNames)c.push(C)}return c}getPaintVertexBuffers(){return this._buffers}getUniforms(c,y){let w=[];for(let C in this.binders){let R=this.binders[C];if(R instanceof Nn||R instanceof hs||R instanceof Pa){for(let N of R.uniformNames)if(y[N]){let z=R.getBinding(c,y[N],N);w.push({name:N,property:C,binding:z})}}}return w}setUniforms(c,y,w,C){for(let{name:R,property:N,binding:z}of y)this.binders[N].setUniform(z,C,w.get(N),R)}updatePaintBuffers(c){this._buffers=[];for(let y in this.binders){let w=this.binders[y];if(c&&w instanceof bc){let C=c.fromScale===2?w.zoomInPaintVertexBuffer:w.zoomOutPaintVertexBuffer;C&&this._buffers.push(C)}else(w instanceof Ul||w instanceof Pa)&&w.paintVertexBuffer&&this._buffers.push(w.paintVertexBuffer)}}upload(c){for(let y in this.binders){let w=this.binders[y];(w instanceof Ul||w instanceof Pa||w instanceof bc)&&w.upload(c)}this.updatePaintBuffers()}destroy(){for(let c in this.binders){let y=this.binders[c];(y instanceof Ul||y instanceof Pa||y instanceof bc)&&y.destroy()}}}class hu{constructor(c,y,w=()=>!0){this.programConfigurations={};for(let C of c)this.programConfigurations[C.id]=new W7(C,y,w);this.needsUpload=!1,this._featureMap=new ul,this._bufferOffset=0}populatePaintArrays(c,y,w,C,R,N){for(let z in this.programConfigurations)this.programConfigurations[z].populatePaintArrays(c,y,C,R,N);y.id!==void 0&&this._featureMap.add(y.id,w,this._bufferOffset,c),this._bufferOffset=c,this.needsUpload=!0}updatePaintArrays(c,y,w,C){for(let R of w)this.needsUpload=this.programConfigurations[R.id].updatePaintArrays(c,this._featureMap,y,R,C)||this.needsUpload}get(c){return this.programConfigurations[c]}upload(c){if(this.needsUpload){for(let y in this.programConfigurations)this.programConfigurations[y].upload(c);this.needsUpload=!1}}destroy(){for(let c in this.programConfigurations)this.programConfigurations[c].destroy()}}function _v(p,c){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[p]||[p.replace(`${c}-`,"").replace(/-/g,"_")]}function du(p,c,y){let w={color:{source:Yh,composite:D},number:{source:P,composite:Yh}},C=function(R){return{"line-pattern":{source:Tt,composite:Tt},"fill-pattern":{source:Tt,composite:Tt},"fill-extrusion-pattern":{source:Tt,composite:Tt}}[R]}(p);return C&&C[y]||w[c][y]}Zt("ConstantBinder",Nn),Zt("CrossFadedConstantBinder",hs),Zt("SourceExpressionBinder",Ul),Zt("CrossFadedCompositeBinder",bc),Zt("CompositeExpressionBinder",Pa),Zt("ProgramConfiguration",W7,{omit:["_buffers"]}),Zt("ProgramConfigurationSet",hu);let xs=8192,ef=Math.pow(2,14)-1,Xp=-ef-1;function zl(p){let c=xs/p.extent,y=p.loadGeometry();for(let w=0;w<y.length;w++){let C=y[w];for(let R=0;R<C.length;R++){let N=C[R],z=Math.round(N.x*c),V=Math.round(N.y*c);N.x=E(z,Xp,ef),N.y=E(V,Xp,ef),(z<N.x||z>N.x+1||V<N.y||V>N.y+1)&&B("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return y}function wc(p,c){return{type:p.type,id:p.id,properties:p.properties,geometry:c?zl(p):[]}}function _1(p,c,y,w,C){p.emplaceBack(2*c+(w+1)/2,2*y+(C+1)/2)}class xv{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(y=>y.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new Ne,this.indexArray=new yi,this.segments=new _i,this.programConfigurations=new hu(c.layers,c.zoom),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id)}populate(c,y,w){let C=this.layers[0],R=[],N=null,z=!1;C.type==="circle"&&(N=C.layout.get("circle-sort-key"),z=!N.isConstant());for(let{feature:V,id:K,index:se,sourceLayerIndex:ue}of c){let fe=this.layers[0]._featureFilter.needGeometry,ve=wc(V,fe);if(!this.layers[0]._featureFilter.filter(new ts(this.zoom),ve,w))continue;let we=z?N.evaluate(ve,{},w):void 0,ke={id:K,properties:V.properties,type:V.type,sourceLayerIndex:ue,index:se,geometry:fe?ve.geometry:zl(V),patterns:{},sortKey:we};R.push(ke)}z&&R.sort((V,K)=>V.sortKey-K.sortKey);for(let V of R){let{geometry:K,index:se,sourceLayerIndex:ue}=V,fe=c[se].feature;this.addFeature(V,K,se,w),y.featureIndex.insert(fe,K,se,ue,this.index)}}update(c,y,w){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,y,this.stateDependentLayers,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,ar),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(c,y,w,C){for(let R of y)for(let N of R){let z=N.x,V=N.y;if(z<0||z>=xs||V<0||V>=xs)continue;let K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,c.sortKey),se=K.vertexLength;_1(this.layoutVertexArray,z,V,-1,-1),_1(this.layoutVertexArray,z,V,1,-1),_1(this.layoutVertexArray,z,V,1,1),_1(this.layoutVertexArray,z,V,-1,1),this.indexArray.emplaceBack(se,se+1,se+2),this.indexArray.emplaceBack(se,se+3,se+2),K.vertexLength+=4,K.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,w,{},C)}}function jA(p,c){for(let y=0;y<p.length;y++)if(tf(c,p[y]))return!0;for(let y=0;y<c.length;y++)if(tf(p,c[y]))return!0;return!!vv(p,c)}function CU(p,c,y){return!!tf(p,c)||!!bv(c,p,y)}function XA(p,c){if(p.length===1)return qA(c,p[0]);for(let y=0;y<c.length;y++){let w=c[y];for(let C=0;C<w.length;C++)if(tf(p,w[C]))return!0}for(let y=0;y<p.length;y++)if(qA(c,p[y]))return!0;for(let y=0;y<c.length;y++)if(vv(p,c[y]))return!0;return!1}function IU(p,c,y){if(p.length>1){if(vv(p,c))return!0;for(let w=0;w<c.length;w++)if(bv(c[w],p,y))return!0}for(let w=0;w<p.length;w++)if(bv(p[w],c,y))return!0;return!1}function vv(p,c){if(p.length===0||c.length===0)return!1;for(let y=0;y<p.length-1;y++){let w=p[y],C=p[y+1];for(let R=0;R<c.length-1;R++)if(kU(w,C,c[R],c[R+1]))return!0}return!1}function kU(p,c,y,w){return U(p,y,w)!==U(c,y,w)&&U(p,c,y)!==U(p,c,w)}function bv(p,c,y){let w=y*y;if(c.length===1)return p.distSqr(c[0])<w;for(let C=1;C<c.length;C++)if(WA(p,c[C-1],c[C])<w)return!0;return!1}function WA(p,c,y){let w=c.distSqr(y);if(w===0)return p.distSqr(c);let C=((p.x-c.x)*(y.x-c.x)+(p.y-c.y)*(y.y-c.y))/w;return p.distSqr(C<0?c:C>1?y:y.sub(c)._mult(C)._add(c))}function qA(p,c){let y,w,C,R=!1;for(let N=0;N<p.length;N++){y=p[N];for(let z=0,V=y.length-1;z<y.length;V=z++)w=y[z],C=y[V],w.y>c.y!=C.y>c.y&&c.x<(C.x-w.x)*(c.y-w.y)/(C.y-w.y)+w.x&&(R=!R)}return R}function tf(p,c){let y=!1;for(let w=0,C=p.length-1;w<p.length;C=w++){let R=p[w],N=p[C];R.y>c.y!=N.y>c.y&&c.x<(N.x-R.x)*(c.y-R.y)/(N.y-R.y)+R.x&&(y=!y)}return y}function MU(p,c,y){let w=y[0],C=y[2];if(p.x<w.x&&c.x<w.x||p.x>C.x&&c.x>C.x||p.y<w.y&&c.y<w.y||p.y>C.y&&c.y>C.y)return!1;let R=U(p,c,y[0]);return R!==U(p,c,y[1])||R!==U(p,c,y[2])||R!==U(p,c,y[3])}function Wp(p,c,y){let w=c.paint.get(p).value;return w.kind==="constant"?w.value:y.programConfigurations.get(c.id).getMaxValue(p)}function q7(p){return Math.sqrt(p[0]*p[0]+p[1]*p[1])}function Y7(p,c,y,w,C){if(!c[0]&&!c[1])return p;let R=u.convert(c)._mult(C);y==="viewport"&&R._rotate(-w);let N=[];for(let z=0;z<p.length;z++)N.push(p[z].sub(R));return N}let YA,ZA;Zt("CircleBucket",xv,{omit:["layers"]});var PU={get paint(){return ZA=ZA||new oo({"circle-radius":new Ci(Se.paint_circle["circle-radius"]),"circle-color":new Ci(Se.paint_circle["circle-color"]),"circle-blur":new Ci(Se.paint_circle["circle-blur"]),"circle-opacity":new Ci(Se.paint_circle["circle-opacity"]),"circle-translate":new di(Se.paint_circle["circle-translate"]),"circle-translate-anchor":new di(Se.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new di(Se.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new di(Se.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ci(Se.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ci(Se.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ci(Se.paint_circle["circle-stroke-opacity"])})},get layout(){return YA=YA||new oo({"circle-sort-key":new Ci(Se.layout_circle["circle-sort-key"])})}},lo=1e-6,rf=typeof Float32Array<"u"?Float32Array:Array;function wv(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function QA(p,c,y){var w=c[0],C=c[1],R=c[2],N=c[3],z=c[4],V=c[5],K=c[6],se=c[7],ue=c[8],fe=c[9],ve=c[10],we=c[11],ke=c[12],Le=c[13],Be=c[14],qe=c[15],$e=y[0],et=y[1],it=y[2],pt=y[3];return p[0]=$e*w+et*z+it*ue+pt*ke,p[1]=$e*C+et*V+it*fe+pt*Le,p[2]=$e*R+et*K+it*ve+pt*Be,p[3]=$e*N+et*se+it*we+pt*qe,p[4]=($e=y[4])*w+(et=y[5])*z+(it=y[6])*ue+(pt=y[7])*ke,p[5]=$e*C+et*V+it*fe+pt*Le,p[6]=$e*R+et*K+it*ve+pt*Be,p[7]=$e*N+et*se+it*we+pt*qe,p[8]=($e=y[8])*w+(et=y[9])*z+(it=y[10])*ue+(pt=y[11])*ke,p[9]=$e*C+et*V+it*fe+pt*Le,p[10]=$e*R+et*K+it*ve+pt*Be,p[11]=$e*N+et*se+it*we+pt*qe,p[12]=($e=y[12])*w+(et=y[13])*z+(it=y[14])*ue+(pt=y[15])*ke,p[13]=$e*C+et*V+it*fe+pt*Le,p[14]=$e*R+et*K+it*ve+pt*Be,p[15]=$e*N+et*se+it*we+pt*qe,p}Math.hypot||(Math.hypot=function(){for(var p=0,c=arguments.length;c--;)p+=arguments[c]*arguments[c];return Math.sqrt(p)});var qp,RU=QA;function Z7(p,c,y){var w=c[0],C=c[1],R=c[2],N=c[3];return p[0]=y[0]*w+y[4]*C+y[8]*R+y[12]*N,p[1]=y[1]*w+y[5]*C+y[9]*R+y[13]*N,p[2]=y[2]*w+y[6]*C+y[10]*R+y[14]*N,p[3]=y[3]*w+y[7]*C+y[11]*R+y[15]*N,p}qp=new rf(4),rf!=Float32Array&&(qp[0]=0,qp[1]=0,qp[2]=0,qp[3]=0);class DU extends ll{constructor(c){super(c,PU)}createBucket(c){return new xv(c)}queryRadius(c){let y=c;return Wp("circle-radius",this,y)+Wp("circle-stroke-width",this,y)+q7(this.paint.get("circle-translate"))}queryIntersectsFeature(c,y,w,C,R,N,z,V){let K=Y7(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),N.angle,z),se=this.paint.get("circle-radius").evaluate(y,w)+this.paint.get("circle-stroke-width").evaluate(y,w),ue=this.paint.get("circle-pitch-alignment")==="map",fe=ue?K:function(we,ke){return we.map(Le=>KA(Le,ke))}(K,V),ve=ue?se*z:se;for(let we of C)for(let ke of we){let Le=ue?ke:KA(ke,V),Be=ve,qe=Z7([],[ke.x,ke.y,0,1],V);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Be*=qe[3]/N.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Be*=N.cameraToCenterDistance/qe[3]),CU(fe,Le,Be))return!0}return!1}}function KA(p,c){let y=Z7([],[p.x,p.y,0,1],c);return new u(y[0]/y[3],y[1]/y[3])}class JA extends xv{}let eC;Zt("HeatmapBucket",JA,{omit:["layers"]});var FU={get paint(){return eC=eC||new oo({"heatmap-radius":new Ci(Se.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ci(Se.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new di(Se.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gp(Se.paint_heatmap["heatmap-color"]),"heatmap-opacity":new di(Se.paint_heatmap["heatmap-opacity"])})}};function Ev(p,{width:c,height:y},w,C){if(C){if(C instanceof Uint8ClampedArray)C=new Uint8Array(C.buffer);else if(C.length!==c*y*w)throw new RangeError(`mismatched image size. expected: ${C.length} but got: ${c*y*w}`)}else C=new Uint8Array(c*y*w);return p.width=c,p.height=y,p.data=C,p}function tC(p,{width:c,height:y},w){if(c===p.width&&y===p.height)return;let C=Ev({},{width:c,height:y},w);Tv(p,C,{x:0,y:0},{x:0,y:0},{width:Math.min(p.width,c),height:Math.min(p.height,y)},w),p.width=c,p.height=y,p.data=C.data}function Tv(p,c,y,w,C,R){if(C.width===0||C.height===0)return c;if(C.width>p.width||C.height>p.height||y.x>p.width-C.width||y.y>p.height-C.height)throw new RangeError("out of range source coordinates for image copy");if(C.width>c.width||C.height>c.height||w.x>c.width-C.width||w.y>c.height-C.height)throw new RangeError("out of range destination coordinates for image copy");let N=p.data,z=c.data;if(N===z)throw new Error("srcData equals dstData, so image is already copied");for(let V=0;V<C.height;V++){let K=((y.y+V)*p.width+y.x)*R,se=((w.y+V)*c.width+w.x)*R;for(let ue=0;ue<C.width*R;ue++)z[se+ue]=N[K+ue]}return c}class Yp{constructor(c,y){Ev(this,c,1,y)}resize(c){tC(this,c,1)}clone(){return new Yp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,y,w,C,R){Tv(c,y,w,C,R,1)}}class Ra{constructor(c,y){Ev(this,c,4,y)}resize(c){tC(this,c,4)}replace(c,y){y?this.data.set(c):this.data=c instanceof Uint8ClampedArray?new Uint8Array(c.buffer):c}clone(){return new Ra({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,y,w,C,R){Tv(c,y,w,C,R,4)}}function iC(p){let c={},y=p.resolution||256,w=p.clips?p.clips.length:1,C=p.image||new Ra({width:y,height:w});if(Math.log(y)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${y}`);let R=(N,z,V)=>{c[p.evaluationKey]=V;let K=p.expression.evaluate(c);C.data[N+z+0]=Math.floor(255*K.r/K.a),C.data[N+z+1]=Math.floor(255*K.g/K.a),C.data[N+z+2]=Math.floor(255*K.b/K.a),C.data[N+z+3]=Math.floor(255*K.a)};if(p.clips)for(let N=0,z=0;N<w;++N,z+=4*y)for(let V=0,K=0;V<y;V++,K+=4){let se=V/(y-1),{start:ue,end:fe}=p.clips[N];R(z,K,ue*(1-se)+fe*se)}else for(let N=0,z=0;N<y;N++,z+=4)R(0,z,N/(y-1));return C}Zt("AlphaImage",Yp),Zt("RGBAImage",Ra);class LU extends ll{createBucket(c){return new JA(c)}constructor(c){super(c,FU),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=iC({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let rC;var NU={get paint(){return rC=rC||new oo({"hillshade-illumination-direction":new di(Se.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new di(Se.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new di(Se.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new di(Se.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new di(Se.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new di(Se.paint_hillshade["hillshade-accent-color"])})}};class OU extends ll{constructor(c){super(c,NU)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let BU=Rs([{name:"a_pos",components:2,type:"Int16"}],4),{members:UU}=BU;var Sv={exports:{}};function Q7(p,c,y){y=y||2;var w,C,R,N,z,V,K,se=c&&c.length,ue=se?c[0]*y:p.length,fe=sC(p,0,ue,y,!0),ve=[];if(!fe||fe.next===fe.prev)return ve;if(se&&(fe=function(ke,Le,Be,qe){var $e,et,it,pt=[];for($e=0,et=Le.length;$e<et;$e++)(it=sC(ke,Le[$e]*qe,$e<et-1?Le[$e+1]*qe:ke.length,qe,!1))===it.next&&(it.steiner=!0),pt.push(WU(it));for(pt.sort(VU),$e=0;$e<pt.length;$e++)Be=jU(pt[$e],Be);return Be}(p,c,fe,y)),p.length>80*y){w=R=p[0],C=N=p[1];for(var we=y;we<ue;we+=y)(z=p[we])<w&&(w=z),(V=p[we+1])<C&&(C=V),z>R&&(R=z),V>N&&(N=V);K=(K=Math.max(R-w,N-C))!==0?32767/K:0}return Zp(fe,ve,y,w,C,K,0),ve}function sC(p,c,y,w,C){var R,N;if(C===Iv(p,c,y,w)>0)for(R=c;R<y;R+=w)N=aC(R,p[R],p[R+1],N);else for(R=y-w;R>=c;R-=w)N=aC(R,p[R],p[R+1],N);return N&&K7(N,N.next)&&(Kp(N),N=N.next),N}function Zh(p,c){if(!p)return p;c||(c=p);var y,w=p;do if(y=!1,w.steiner||!K7(w,w.next)&&Fs(w.prev,w,w.next)!==0)w=w.next;else{if(Kp(w),(w=c=w.prev)===w.next)break;y=!0}while(y||w!==c);return c}function Zp(p,c,y,w,C,R,N){if(p){!N&&R&&function(se,ue,fe,ve){var we=se;do we.z===0&&(we.z=Av(we.x,we.y,ue,fe,ve)),we.prevZ=we.prev,we.nextZ=we.next,we=we.next;while(we!==se);we.prevZ.nextZ=null,we.prevZ=null,function(ke){var Le,Be,qe,$e,et,it,pt,Xt,ai=1;do{for(Be=ke,ke=null,et=null,it=0;Be;){for(it++,qe=Be,pt=0,Le=0;Le<ai&&(pt++,qe=qe.nextZ);Le++);for(Xt=ai;pt>0||Xt>0&&qe;)pt!==0&&(Xt===0||!qe||Be.z<=qe.z)?($e=Be,Be=Be.nextZ,pt--):($e=qe,qe=qe.nextZ,Xt--),et?et.nextZ=$e:ke=$e,$e.prevZ=et,et=$e;Be=qe}et.nextZ=null,ai*=2}while(it>1)}(we)}(p,w,C,R);for(var z,V,K=p;p.prev!==p.next;)if(z=p.prev,V=p.next,R?GU(p,w,C,R):zU(p))c.push(z.i/y|0),c.push(p.i/y|0),c.push(V.i/y|0),Kp(p),p=V.next,K=V.next;else if((p=V)===K){N?N===1?Zp(p=$U(Zh(p),c,y),c,y,w,C,R,2):N===2&&HU(p,c,y,w,C,R):Zp(Zh(p),c,y,w,C,R,1);break}}}function zU(p){var c=p.prev,y=p,w=p.next;if(Fs(c,y,w)>=0)return!1;for(var C=c.x,R=y.x,N=w.x,z=c.y,V=y.y,K=w.y,se=C<R?C<N?C:N:R<N?R:N,ue=z<V?z<K?z:K:V<K?V:K,fe=C>R?C>N?C:N:R>N?R:N,ve=z>V?z>K?z:K:V>K?V:K,we=w.next;we!==c;){if(we.x>=se&&we.x<=fe&&we.y>=ue&&we.y<=ve&&sf(C,z,R,V,N,K,we.x,we.y)&&Fs(we.prev,we,we.next)>=0)return!1;we=we.next}return!0}function GU(p,c,y,w){var C=p.prev,R=p,N=p.next;if(Fs(C,R,N)>=0)return!1;for(var z=C.x,V=R.x,K=N.x,se=C.y,ue=R.y,fe=N.y,ve=z<V?z<K?z:K:V<K?V:K,we=se<ue?se<fe?se:fe:ue<fe?ue:fe,ke=z>V?z>K?z:K:V>K?V:K,Le=se>ue?se>fe?se:fe:ue>fe?ue:fe,Be=Av(ve,we,c,y,w),qe=Av(ke,Le,c,y,w),$e=p.prevZ,et=p.nextZ;$e&&$e.z>=Be&&et&&et.z<=qe;){if($e.x>=ve&&$e.x<=ke&&$e.y>=we&&$e.y<=Le&&$e!==C&&$e!==N&&sf(z,se,V,ue,K,fe,$e.x,$e.y)&&Fs($e.prev,$e,$e.next)>=0||($e=$e.prevZ,et.x>=ve&&et.x<=ke&&et.y>=we&&et.y<=Le&&et!==C&&et!==N&&sf(z,se,V,ue,K,fe,et.x,et.y)&&Fs(et.prev,et,et.next)>=0))return!1;et=et.nextZ}for(;$e&&$e.z>=Be;){if($e.x>=ve&&$e.x<=ke&&$e.y>=we&&$e.y<=Le&&$e!==C&&$e!==N&&sf(z,se,V,ue,K,fe,$e.x,$e.y)&&Fs($e.prev,$e,$e.next)>=0)return!1;$e=$e.prevZ}for(;et&&et.z<=qe;){if(et.x>=ve&&et.x<=ke&&et.y>=we&&et.y<=Le&&et!==C&&et!==N&&sf(z,se,V,ue,K,fe,et.x,et.y)&&Fs(et.prev,et,et.next)>=0)return!1;et=et.nextZ}return!0}function $U(p,c,y){var w=p;do{var C=w.prev,R=w.next.next;!K7(C,R)&&nC(C,w,w.next,R)&&Qp(C,R)&&Qp(R,C)&&(c.push(C.i/y|0),c.push(w.i/y|0),c.push(R.i/y|0),Kp(w),Kp(w.next),w=p=R),w=w.next}while(w!==p);return Zh(w)}function HU(p,c,y,w,C,R){var N=p;do{for(var z=N.next.next;z!==N.prev;){if(N.i!==z.i&&qU(N,z)){var V=oC(N,z);return N=Zh(N,N.next),V=Zh(V,V.next),Zp(N,c,y,w,C,R,0),void Zp(V,c,y,w,C,R,0)}z=z.next}N=N.next}while(N!==p)}function VU(p,c){return p.x-c.x}function jU(p,c){var y=function(C,R){var N,z=R,V=C.x,K=C.y,se=-1/0;do{if(K<=z.y&&K>=z.next.y&&z.next.y!==z.y){var ue=z.x+(K-z.y)*(z.next.x-z.x)/(z.next.y-z.y);if(ue<=V&&ue>se&&(se=ue,N=z.x<z.next.x?z:z.next,ue===V))return N}z=z.next}while(z!==R);if(!N)return null;var fe,ve=N,we=N.x,ke=N.y,Le=1/0;z=N;do V>=z.x&&z.x>=we&&V!==z.x&&sf(K<ke?V:se,K,we,ke,K<ke?se:V,K,z.x,z.y)&&(fe=Math.abs(K-z.y)/(V-z.x),Qp(z,C)&&(fe<Le||fe===Le&&(z.x>N.x||z.x===N.x&&XU(N,z)))&&(N=z,Le=fe)),z=z.next;while(z!==ve);return N}(p,c);if(!y)return c;var w=oC(y,p);return Zh(w,w.next),Zh(y,y.next)}function XU(p,c){return Fs(p.prev,p,c.prev)<0&&Fs(c.next,p,p.next)<0}function Av(p,c,y,w,C){return(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p=(p-y)*C|0)|p<<8))|p<<4))|p<<2))|p<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-w)*C|0)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function WU(p){var c=p,y=p;do(c.x<y.x||c.x===y.x&&c.y<y.y)&&(y=c),c=c.next;while(c!==p);return y}function sf(p,c,y,w,C,R,N,z){return(C-N)*(c-z)>=(p-N)*(R-z)&&(p-N)*(w-z)>=(y-N)*(c-z)&&(y-N)*(R-z)>=(C-N)*(w-z)}function qU(p,c){return p.next.i!==c.i&&p.prev.i!==c.i&&!function(y,w){var C=y;do{if(C.i!==y.i&&C.next.i!==y.i&&C.i!==w.i&&C.next.i!==w.i&&nC(C,C.next,y,w))return!0;C=C.next}while(C!==y);return!1}(p,c)&&(Qp(p,c)&&Qp(c,p)&&function(y,w){var C=y,R=!1,N=(y.x+w.x)/2,z=(y.y+w.y)/2;do C.y>z!=C.next.y>z&&C.next.y!==C.y&&N<(C.next.x-C.x)*(z-C.y)/(C.next.y-C.y)+C.x&&(R=!R),C=C.next;while(C!==y);return R}(p,c)&&(Fs(p.prev,p,c.prev)||Fs(p,c.prev,c))||K7(p,c)&&Fs(p.prev,p,p.next)>0&&Fs(c.prev,c,c.next)>0)}function Fs(p,c,y){return(c.y-p.y)*(y.x-c.x)-(c.x-p.x)*(y.y-c.y)}function K7(p,c){return p.x===c.x&&p.y===c.y}function nC(p,c,y,w){var C=e9(Fs(p,c,y)),R=e9(Fs(p,c,w)),N=e9(Fs(y,w,p)),z=e9(Fs(y,w,c));return C!==R&&N!==z||!(C!==0||!J7(p,y,c))||!(R!==0||!J7(p,w,c))||!(N!==0||!J7(y,p,w))||!(z!==0||!J7(y,c,w))}function J7(p,c,y){return c.x<=Math.max(p.x,y.x)&&c.x>=Math.min(p.x,y.x)&&c.y<=Math.max(p.y,y.y)&&c.y>=Math.min(p.y,y.y)}function e9(p){return p>0?1:p<0?-1:0}function Qp(p,c){return Fs(p.prev,p,p.next)<0?Fs(p,c,p.next)>=0&&Fs(p,p.prev,c)>=0:Fs(p,c,p.prev)<0||Fs(p,p.next,c)<0}function oC(p,c){var y=new Cv(p.i,p.x,p.y),w=new Cv(c.i,c.x,c.y),C=p.next,R=c.prev;return p.next=c,c.prev=p,y.next=C,C.prev=y,w.next=y,y.prev=w,R.next=w,w.prev=R,w}function aC(p,c,y,w){var C=new Cv(p,c,y);return w?(C.next=w.next,C.prev=w,w.next.prev=C,w.next=C):(C.prev=C,C.next=C),C}function Kp(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Cv(p,c,y){this.i=p,this.x=c,this.y=y,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Iv(p,c,y,w){for(var C=0,R=c,N=y-w;R<y;R+=w)C+=(p[N]-p[R])*(p[R+1]+p[N+1]),N=R;return C}Sv.exports=Q7,Sv.exports.default=Q7,Q7.deviation=function(p,c,y,w){var C=c&&c.length,R=Math.abs(Iv(p,0,C?c[0]*y:p.length,y));if(C)for(var N=0,z=c.length;N<z;N++)R-=Math.abs(Iv(p,c[N]*y,N<z-1?c[N+1]*y:p.length,y));var V=0;for(N=0;N<w.length;N+=3){var K=w[N]*y,se=w[N+1]*y,ue=w[N+2]*y;V+=Math.abs((p[K]-p[ue])*(p[se+1]-p[K+1])-(p[K]-p[se])*(p[ue+1]-p[K+1]))}return R===0&&V===0?0:Math.abs((V-R)/R)},Q7.flatten=function(p){for(var c=p[0][0].length,y={vertices:[],holes:[],dimensions:c},w=0,C=0;C<p.length;C++){for(var R=0;R<p[C].length;R++)for(var N=0;N<c;N++)y.vertices.push(p[C][R][N]);C>0&&y.holes.push(w+=p[C-1].length)}return y};var lC=o(Sv.exports);function YU(p,c,y,w,C){cC(p,c,y||0,w||p.length-1,C||ZU)}function cC(p,c,y,w,C){for(;w>y;){if(w-y>600){var R=w-y+1,N=c-y+1,z=Math.log(R),V=.5*Math.exp(2*z/3),K=.5*Math.sqrt(z*V*(R-V)/R)*(N-R/2<0?-1:1);cC(p,c,Math.max(y,Math.floor(c-N*V/R+K)),Math.min(w,Math.floor(c+(R-N)*V/R+K)),C)}var se=p[c],ue=y,fe=w;for(Jp(p,y,c),C(p[w],se)>0&&Jp(p,y,w);ue<fe;){for(Jp(p,ue,fe),ue++,fe--;C(p[ue],se)<0;)ue++;for(;C(p[fe],se)>0;)fe--}C(p[y],se)===0?Jp(p,y,fe):Jp(p,++fe,w),fe<=c&&(y=fe+1),c<=fe&&(w=fe-1)}}function Jp(p,c,y){var w=p[c];p[c]=p[y],p[y]=w}function ZU(p,c){return p<c?-1:p>c?1:0}function kv(p,c){let y=p.length;if(y<=1)return[p];let w=[],C,R;for(let N=0;N<y;N++){let z=$(p[N]);z!==0&&(p[N].area=Math.abs(z),R===void 0&&(R=z<0),R===z<0?(C&&w.push(C),C=[p[N]]):C.push(p[N]))}if(C&&w.push(C),c>1)for(let N=0;N<w.length;N++)w[N].length<=c||(YU(w[N],c,1,w[N].length-1,QU),w[N]=w[N].slice(0,c));return w}function QU(p,c){return c.area-p.area}function Mv(p,c,y){let w=y.patternDependencies,C=!1;for(let R of c){let N=R.paint.get(`${p}-pattern`);N.isConstant()||(C=!0);let z=N.constantOr(null);z&&(C=!0,w[z.to]=!0,w[z.from]=!0)}return C}function Pv(p,c,y,w,C){let R=C.patternDependencies;for(let N of c){let z=N.paint.get(`${p}-pattern`).value;if(z.kind!=="constant"){let V=z.evaluate({zoom:w-1},y,{},C.availableImages),K=z.evaluate({zoom:w},y,{},C.availableImages),se=z.evaluate({zoom:w+1},y,{},C.availableImages);V=V&&V.name?V.name:V,K=K&&K.name?K.name:K,se=se&&se.name?se.name:se,R[V]=!0,R[K]=!0,R[se]=!0,y.patterns[N.id]={min:V,mid:K,max:se}}}return y}class Rv{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(y=>y.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Xe,this.indexArray=new yi,this.indexArray2=new ii,this.programConfigurations=new hu(c.layers,c.zoom),this.segments=new _i,this.segments2=new _i,this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id)}populate(c,y,w){this.hasPattern=Mv("fill",this.layers,y);let C=this.layers[0].layout.get("fill-sort-key"),R=!C.isConstant(),N=[];for(let{feature:z,id:V,index:K,sourceLayerIndex:se}of c){let ue=this.layers[0]._featureFilter.needGeometry,fe=wc(z,ue);if(!this.layers[0]._featureFilter.filter(new ts(this.zoom),fe,w))continue;let ve=R?C.evaluate(fe,{},w,y.availableImages):void 0,we={id:V,properties:z.properties,type:z.type,sourceLayerIndex:se,index:K,geometry:ue?fe.geometry:zl(z),patterns:{},sortKey:ve};N.push(we)}R&&N.sort((z,V)=>z.sortKey-V.sortKey);for(let z of N){let{geometry:V,index:K,sourceLayerIndex:se}=z;if(this.hasPattern){let ue=Pv("fill",this.layers,z,this.zoom,y);this.patternFeatures.push(ue)}else this.addFeature(z,V,K,w,{});y.featureIndex.insert(c[K].feature,V,K,se,this.index)}}update(c,y,w){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,y,this.stateDependentLayers,w)}addFeatures(c,y,w){for(let C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,y,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,UU),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.indexBuffer2=c.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(c,y,w,C,R){for(let N of kv(y,500)){let z=0;for(let ve of N)z+=ve.length;let V=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray),K=V.vertexLength,se=[],ue=[];for(let ve of N){if(ve.length===0)continue;ve!==N[0]&&ue.push(se.length/2);let we=this.segments2.prepareSegment(ve.length,this.layoutVertexArray,this.indexArray2),ke=we.vertexLength;this.layoutVertexArray.emplaceBack(ve[0].x,ve[0].y),this.indexArray2.emplaceBack(ke+ve.length-1,ke),se.push(ve[0].x),se.push(ve[0].y);for(let Le=1;Le<ve.length;Le++)this.layoutVertexArray.emplaceBack(ve[Le].x,ve[Le].y),this.indexArray2.emplaceBack(ke+Le-1,ke+Le),se.push(ve[Le].x),se.push(ve[Le].y);we.vertexLength+=ve.length,we.primitiveLength+=ve.length}let fe=lC(se,ue);for(let ve=0;ve<fe.length;ve+=3)this.indexArray.emplaceBack(K+fe[ve],K+fe[ve+1],K+fe[ve+2]);V.vertexLength+=z,V.primitiveLength+=fe.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,w,R,C)}}let uC,hC;Zt("FillBucket",Rv,{omit:["layers","patternFeatures"]});var KU={get paint(){return hC=hC||new oo({"fill-antialias":new di(Se.paint_fill["fill-antialias"]),"fill-opacity":new Ci(Se.paint_fill["fill-opacity"]),"fill-color":new Ci(Se.paint_fill["fill-color"]),"fill-outline-color":new Ci(Se.paint_fill["fill-outline-color"]),"fill-translate":new di(Se.paint_fill["fill-translate"]),"fill-translate-anchor":new di(Se.paint_fill["fill-translate-anchor"]),"fill-pattern":new Y0(Se.paint_fill["fill-pattern"])})},get layout(){return uC=uC||new oo({"fill-sort-key":new Ci(Se.layout_fill["fill-sort-key"])})}};class JU extends ll{constructor(c){super(c,KU)}recalculate(c,y){super.recalculate(c,y);let w=this.paint._values["fill-outline-color"];w.value.kind==="constant"&&w.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new Rv(c)}queryRadius(){return q7(this.paint.get("fill-translate"))}queryIntersectsFeature(c,y,w,C,R,N,z){return XA(Y7(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),N.angle,z),C)}isTileClipped(){return!0}}let ez=Rs([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),tz=Rs([{name:"a_centroid",components:2,type:"Int16"}],4),{members:iz}=ez;var x1={},rz=a,dC=nf;function nf(p,c,y,w,C){this.properties={},this.extent=y,this.type=0,this._pbf=p,this._geometry=-1,this._keys=w,this._values=C,p.readFields(sz,this,c)}function sz(p,c,y){p==1?c.id=y.readVarint():p==2?function(w,C){for(var R=w.readVarint()+w.pos;w.pos<R;){var N=C._keys[w.readVarint()],z=C._values[w.readVarint()];C.properties[N]=z}}(y,c):p==3?c.type=y.readVarint():p==4&&(c._geometry=y.pos)}function nz(p){for(var c,y,w=0,C=0,R=p.length,N=R-1;C<R;N=C++)w+=((y=p[N]).x-(c=p[C]).x)*(c.y+y.y);return w}nf.types=["Unknown","Point","LineString","Polygon"],nf.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var c,y=p.readVarint()+p.pos,w=1,C=0,R=0,N=0,z=[];p.pos<y;){if(C<=0){var V=p.readVarint();w=7&V,C=V>>3}if(C--,w===1||w===2)R+=p.readSVarint(),N+=p.readSVarint(),w===1&&(c&&z.push(c),c=[]),c.push(new rz(R,N));else{if(w!==7)throw new Error("unknown command "+w);c&&c.push(c[0].clone())}}return c&&z.push(c),z},nf.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var c=p.readVarint()+p.pos,y=1,w=0,C=0,R=0,N=1/0,z=-1/0,V=1/0,K=-1/0;p.pos<c;){if(w<=0){var se=p.readVarint();y=7&se,w=se>>3}if(w--,y===1||y===2)(C+=p.readSVarint())<N&&(N=C),C>z&&(z=C),(R+=p.readSVarint())<V&&(V=R),R>K&&(K=R);else if(y!==7)throw new Error("unknown command "+y)}return[N,V,z,K]},nf.prototype.toGeoJSON=function(p,c,y){var w,C,R=this.extent*Math.pow(2,y),N=this.extent*p,z=this.extent*c,V=this.loadGeometry(),K=nf.types[this.type];function se(ve){for(var we=0;we<ve.length;we++){var ke=ve[we];ve[we]=[360*(ke.x+N)/R-180,360/Math.PI*Math.atan(Math.exp((180-360*(ke.y+z)/R)*Math.PI/180))-90]}}switch(this.type){case 1:var ue=[];for(w=0;w<V.length;w++)ue[w]=V[w][0];se(V=ue);break;case 2:for(w=0;w<V.length;w++)se(V[w]);break;case 3:for(V=function(ve){var we=ve.length;if(we<=1)return[ve];for(var ke,Le,Be=[],qe=0;qe<we;qe++){var $e=nz(ve[qe]);$e!==0&&(Le===void 0&&(Le=$e<0),Le===$e<0?(ke&&Be.push(ke),ke=[ve[qe]]):ke.push(ve[qe]))}return ke&&Be.push(ke),Be}(V),w=0;w<V.length;w++)for(C=0;C<V[w].length;C++)se(V[w][C])}V.length===1?V=V[0]:K="Multi"+K;var fe={type:"Feature",geometry:{type:K,coordinates:V},properties:this.properties};return"id"in this&&(fe.id=this.id),fe};var oz=dC,fC=pC;function pC(p,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=p,this._keys=[],this._values=[],this._features=[],p.readFields(az,this,c),this.length=this._features.length}function az(p,c,y){p===15?c.version=y.readVarint():p===1?c.name=y.readString():p===5?c.extent=y.readVarint():p===2?c._features.push(y.pos):p===3?c._keys.push(y.readString()):p===4&&c._values.push(function(w){for(var C=null,R=w.readVarint()+w.pos;w.pos<R;){var N=w.readVarint()>>3;C=N===1?w.readString():N===2?w.readFloat():N===3?w.readDouble():N===4?w.readVarint64():N===5?w.readVarint():N===6?w.readSVarint():N===7?w.readBoolean():null}return C}(y))}pC.prototype.feature=function(p){if(p<0||p>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[p];var c=this._pbf.readVarint()+this._pbf.pos;return new oz(this._pbf,c,this.extent,this._keys,this._values)};var lz=fC;function cz(p,c,y){if(p===3){var w=new lz(y,y.readVarint()+y.pos);w.length&&(c[w.name]=w)}}x1.VectorTile=function(p,c){this.layers=p.readFields(cz,{},c)},x1.VectorTileFeature=dC,x1.VectorTileLayer=fC;let uz=x1.VectorTileFeature.types,Dv=Math.pow(2,13);function e3(p,c,y,w,C,R,N,z){p.emplaceBack(c,y,2*Math.floor(w*Dv)+N,C*Dv*2,R*Dv*2,Math.round(z))}class Fv{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(y=>y.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new rt,this.centroidVertexArray=new tt,this.indexArray=new yi,this.programConfigurations=new hu(c.layers,c.zoom),this.segments=new _i,this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id)}populate(c,y,w){this.features=[],this.hasPattern=Mv("fill-extrusion",this.layers,y);for(let{feature:C,id:R,index:N,sourceLayerIndex:z}of c){let V=this.layers[0]._featureFilter.needGeometry,K=wc(C,V);if(!this.layers[0]._featureFilter.filter(new ts(this.zoom),K,w))continue;let se={id:R,sourceLayerIndex:z,index:N,geometry:V?K.geometry:zl(C),properties:C.properties,type:C.type,patterns:{}};this.hasPattern?this.features.push(Pv("fill-extrusion",this.layers,se,this.zoom,y)):this.addFeature(se,se.geometry,N,w,{}),y.featureIndex.insert(C,se.geometry,N,z,this.index,!0)}}addFeatures(c,y,w){for(let C of this.features){let{geometry:R}=C;this.addFeature(C,R,C.index,y,w)}}update(c,y,w){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,y,this.stateDependentLayers,w)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,iz),this.centroidVertexBuffer=c.createVertexBuffer(this.centroidVertexArray,tz.members,!0),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(c,y,w,C,R){let N={x:0,y:0,vertexCount:0};for(let z of kv(y,500)){let V=0;for(let we of z)V+=we.length;let K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let we of z){if(we.length===0||dz(we))continue;let ke=0;for(let Le=0;Le<we.length;Le++){let Be=we[Le];if(Le>=1){let qe=we[Le-1];if(!hz(Be,qe)){K.vertexLength+4>_i.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let $e=Be.sub(qe)._perp()._unit(),et=qe.dist(Be);ke+et>32768&&(ke=0),e3(this.layoutVertexArray,Be.x,Be.y,$e.x,$e.y,0,0,ke),e3(this.layoutVertexArray,Be.x,Be.y,$e.x,$e.y,0,1,ke),N.x+=2*Be.x,N.y+=2*Be.y,N.vertexCount+=2,ke+=et,e3(this.layoutVertexArray,qe.x,qe.y,$e.x,$e.y,0,0,ke),e3(this.layoutVertexArray,qe.x,qe.y,$e.x,$e.y,0,1,ke),N.x+=2*qe.x,N.y+=2*qe.y,N.vertexCount+=2;let it=K.vertexLength;this.indexArray.emplaceBack(it,it+2,it+1),this.indexArray.emplaceBack(it+1,it+2,it+3),K.vertexLength+=4,K.primitiveLength+=2}}}}if(K.vertexLength+V>_i.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(V,this.layoutVertexArray,this.indexArray)),uz[c.type]!=="Polygon")continue;let se=[],ue=[],fe=K.vertexLength;for(let we of z)if(we.length!==0){we!==z[0]&&ue.push(se.length/2);for(let ke=0;ke<we.length;ke++){let Le=we[ke];e3(this.layoutVertexArray,Le.x,Le.y,0,0,1,1,0),N.x+=Le.x,N.y+=Le.y,N.vertexCount+=1,se.push(Le.x),se.push(Le.y)}}let ve=lC(se,ue);for(let we=0;we<ve.length;we+=3)this.indexArray.emplaceBack(fe+ve[we],fe+ve[we+2],fe+ve[we+1]);K.primitiveLength+=ve.length/3,K.vertexLength+=V}for(let z=0;z<N.vertexCount;z++)this.centroidVertexArray.emplaceBack(Math.floor(N.x/N.vertexCount),Math.floor(N.y/N.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,w,R,C)}}function hz(p,c){return p.x===c.x&&(p.x<0||p.x>xs)||p.y===c.y&&(p.y<0||p.y>xs)}function dz(p){return p.every(c=>c.x<0)||p.every(c=>c.x>xs)||p.every(c=>c.y<0)||p.every(c=>c.y>xs)}let mC;Zt("FillExtrusionBucket",Fv,{omit:["layers","features"]});var fz={get paint(){return mC=mC||new oo({"fill-extrusion-opacity":new di(Se["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ci(Se["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new di(Se["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new di(Se["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Y0(Se["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ci(Se["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ci(Se["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new di(Se["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class pz extends ll{constructor(c){super(c,fz)}createBucket(c){return new Fv(c)}queryRadius(){return q7(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(c,y,w,C,R,N,z,V){let K=Y7(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),N.angle,z),se=this.paint.get("fill-extrusion-height").evaluate(y,w),ue=this.paint.get("fill-extrusion-base").evaluate(y,w),fe=function(we,ke,Le,Be){let qe=[];for(let $e of we){let et=[$e.x,$e.y,0,1];Z7(et,et,ke),qe.push(new u(et[0]/et[3],et[1]/et[3]))}return qe}(K,V),ve=function(we,ke,Le,Be){let qe=[],$e=[],et=Be[8]*ke,it=Be[9]*ke,pt=Be[10]*ke,Xt=Be[11]*ke,ai=Be[8]*Le,jt=Be[9]*Le,zt=Be[10]*Le,Rt=Be[11]*Le;for(let Qt of we){let Nt=[],Ct=[];for(let xi of Qt){let ci=xi.x,sr=xi.y,Qr=Be[0]*ci+Be[4]*sr+Be[12],rs=Be[1]*ci+Be[5]*sr+Be[13],ln=Be[2]*ci+Be[6]*sr+Be[14],ca=Be[3]*ci+Be[7]*sr+Be[15],co=ln+pt,Xs=ca+Xt,yn=Qr+ai,Bn=rs+jt,ko=ln+zt,uo=ca+Rt,Ws=new u((Qr+et)/Xs,(rs+it)/Xs);Ws.z=co/Xs,Nt.push(Ws);let cn=new u(yn/uo,Bn/uo);cn.z=ko/uo,Ct.push(cn)}qe.push(Nt),$e.push(Ct)}return[qe,$e]}(C,ue,se,V);return function(we,ke,Le){let Be=1/0;XA(Le,ke)&&(Be=gC(Le,ke[0]));for(let qe=0;qe<ke.length;qe++){let $e=ke[qe],et=we[qe];for(let it=0;it<$e.length-1;it++){let pt=$e[it],Xt=[pt,$e[it+1],et[it+1],et[it],pt];jA(Le,Xt)&&(Be=Math.min(Be,gC(Le,Xt)))}}return Be!==1/0&&Be}(ve[0],ve[1],fe)}}function t3(p,c){return p.x*c.x+p.y*c.y}function gC(p,c){if(p.length===1){let y=0,w=c[y++],C;for(;!C||w.equals(C);)if(C=c[y++],!C)return 1/0;for(;y<c.length;y++){let R=c[y],N=p[0],z=C.sub(w),V=R.sub(w),K=N.sub(w),se=t3(z,z),ue=t3(z,V),fe=t3(V,V),ve=t3(K,z),we=t3(K,V),ke=se*fe-ue*ue,Le=(fe*ve-ue*we)/ke,Be=(se*we-ue*ve)/ke,qe=w.z*(1-Le-Be)+C.z*Le+R.z*Be;if(isFinite(qe))return qe}return 1/0}{let y=1/0;for(let w of c)y=Math.min(y,w.z);return y}}let mz=Rs([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:gz}=mz,yz=Rs([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:_z}=yz,xz=x1.VectorTileFeature.types,vz=Math.cos(Math.PI/180*37.5),yC=Math.pow(2,14)/.5;class Lv{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(y=>y.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(y=>{this.gradients[y.id]={}}),this.layoutVertexArray=new st,this.layoutVertexArray2=new ft,this.indexArray=new yi,this.programConfigurations=new hu(c.layers,c.zoom),this.segments=new _i,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id)}populate(c,y,w){this.hasPattern=Mv("line",this.layers,y);let C=this.layers[0].layout.get("line-sort-key"),R=!C.isConstant(),N=[];for(let{feature:z,id:V,index:K,sourceLayerIndex:se}of c){let ue=this.layers[0]._featureFilter.needGeometry,fe=wc(z,ue);if(!this.layers[0]._featureFilter.filter(new ts(this.zoom),fe,w))continue;let ve=R?C.evaluate(fe,{},w):void 0,we={id:V,properties:z.properties,type:z.type,sourceLayerIndex:se,index:K,geometry:ue?fe.geometry:zl(z),patterns:{},sortKey:ve};N.push(we)}R&&N.sort((z,V)=>z.sortKey-V.sortKey);for(let z of N){let{geometry:V,index:K,sourceLayerIndex:se}=z;if(this.hasPattern){let ue=Pv("line",this.layers,z,this.zoom,y);this.patternFeatures.push(ue)}else this.addFeature(z,V,K,w,{});y.featureIndex.insert(c[K].feature,V,K,se,this.index)}}update(c,y,w){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,y,this.stateDependentLayers,w)}addFeatures(c,y,w){for(let C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,y,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=c.createVertexBuffer(this.layoutVertexArray2,_z)),this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,gz),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(c){if(c.properties&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_end"))return{start:+c.properties.mapbox_clip_start,end:+c.properties.mapbox_clip_end}}addFeature(c,y,w,C,R){let N=this.layers[0].layout,z=N.get("line-join").evaluate(c,{}),V=N.get("line-cap"),K=N.get("line-miter-limit"),se=N.get("line-round-limit");this.lineClips=this.lineFeatureClips(c);for(let ue of y)this.addLine(ue,c,z,V,K,se);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,w,R,C)}addLine(c,y,w,C,R,N){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Be=0;Be<c.length-1;Be++)this.totalDistance+=c[Be].dist(c[Be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let z=xz[y.type]==="Polygon",V=c.length;for(;V>=2&&c[V-1].equals(c[V-2]);)V--;let K=0;for(;K<V-1&&c[K].equals(c[K+1]);)K++;if(V<(z?3:2))return;w==="bevel"&&(R=1.05);let se=this.overscaling<=16?15*xs/(512*this.overscaling):0,ue=this.segments.prepareSegment(10*V,this.layoutVertexArray,this.indexArray),fe,ve,we,ke,Le;this.e1=this.e2=-1,z&&(fe=c[V-2],Le=c[K].sub(fe)._unit()._perp());for(let Be=K;Be<V;Be++){if(we=Be===V-1?z?c[K+1]:void 0:c[Be+1],we&&c[Be].equals(we))continue;Le&&(ke=Le),fe&&(ve=fe),fe=c[Be],Le=we?we.sub(fe)._unit()._perp():ke,ke=ke||Le;let qe=ke.add(Le);qe.x===0&&qe.y===0||qe._unit();let $e=ke.x*Le.x+ke.y*Le.y,et=qe.x*Le.x+qe.y*Le.y,it=et!==0?1/et:1/0,pt=2*Math.sqrt(2-2*et),Xt=et<vz&&ve&&we,ai=ke.x*Le.y-ke.y*Le.x>0;if(Xt&&Be>K){let Rt=fe.dist(ve);if(Rt>2*se){let Qt=fe.sub(fe.sub(ve)._mult(se/Rt)._round());this.updateDistance(ve,Qt),this.addCurrentVertex(Qt,ke,0,0,ue),ve=Qt}}let jt=ve&&we,zt=jt?w:z?"butt":C;if(jt&&zt==="round"&&(it<N?zt="miter":it<=2&&(zt="fakeround")),zt==="miter"&&it>R&&(zt="bevel"),zt==="bevel"&&(it>2&&(zt="flipbevel"),it<R&&(zt="miter")),ve&&this.updateDistance(ve,fe),zt==="miter")qe._mult(it),this.addCurrentVertex(fe,qe,0,0,ue);else if(zt==="flipbevel"){if(it>100)qe=Le.mult(-1);else{let Rt=it*ke.add(Le).mag()/ke.sub(Le).mag();qe._perp()._mult(Rt*(ai?-1:1))}this.addCurrentVertex(fe,qe,0,0,ue),this.addCurrentVertex(fe,qe.mult(-1),0,0,ue)}else if(zt==="bevel"||zt==="fakeround"){let Rt=-Math.sqrt(it*it-1),Qt=ai?Rt:0,Nt=ai?0:Rt;if(ve&&this.addCurrentVertex(fe,ke,Qt,Nt,ue),zt==="fakeround"){let Ct=Math.round(180*pt/Math.PI/20);for(let xi=1;xi<Ct;xi++){let ci=xi/Ct;if(ci!==.5){let Qr=ci-.5;ci+=ci*Qr*(ci-1)*((1.0904+$e*($e*(3.55645-1.43519*$e)-3.2452))*Qr*Qr+(.848013+$e*(.215638*$e-1.06021)))}let sr=Le.sub(ke)._mult(ci)._add(ke)._unit()._mult(ai?-1:1);this.addHalfVertex(fe,sr.x,sr.y,!1,ai,0,ue)}}we&&this.addCurrentVertex(fe,Le,-Qt,-Nt,ue)}else if(zt==="butt")this.addCurrentVertex(fe,qe,0,0,ue);else if(zt==="square"){let Rt=ve?1:-1;this.addCurrentVertex(fe,qe,Rt,Rt,ue)}else zt==="round"&&(ve&&(this.addCurrentVertex(fe,ke,0,0,ue),this.addCurrentVertex(fe,ke,1,1,ue,!0)),we&&(this.addCurrentVertex(fe,Le,-1,-1,ue,!0),this.addCurrentVertex(fe,Le,0,0,ue)));if(Xt&&Be<V-1){let Rt=fe.dist(we);if(Rt>2*se){let Qt=fe.add(we.sub(fe)._mult(se/Rt)._round());this.updateDistance(fe,Qt),this.addCurrentVertex(Qt,Le,0,0,ue),fe=Qt}}}}addCurrentVertex(c,y,w,C,R,N=!1){let z=y.y*C-y.x,V=-y.y-y.x*C;this.addHalfVertex(c,y.x+y.y*w,y.y-y.x*w,N,!1,w,R),this.addHalfVertex(c,z,V,N,!0,-C,R),this.distance>yC/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(c,y,w,C,R,N))}addHalfVertex({x:c,y},w,C,R,N,z,V){let K=.5*(this.lineClips?this.scaledDistance*(yC-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((c<<1)+(R?1:0),(y<<1)+(N?1:0),Math.round(63*w)+128,Math.round(63*C)+128,1+(z===0?0:z<0?-1:1)|(63&K)<<2,K>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let se=V.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,se),V.primitiveLength++),N?this.e2=se:this.e1=se}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(c,y){this.distance+=c.dist(y),this.updateScaledDistance()}}let _C,xC;Zt("LineBucket",Lv,{omit:["layers","patternFeatures"]});var vC={get paint(){return xC=xC||new oo({"line-opacity":new Ci(Se.paint_line["line-opacity"]),"line-color":new Ci(Se.paint_line["line-color"]),"line-translate":new di(Se.paint_line["line-translate"]),"line-translate-anchor":new di(Se.paint_line["line-translate-anchor"]),"line-width":new Ci(Se.paint_line["line-width"]),"line-gap-width":new Ci(Se.paint_line["line-gap-width"]),"line-offset":new Ci(Se.paint_line["line-offset"]),"line-blur":new Ci(Se.paint_line["line-blur"]),"line-dasharray":new zp(Se.paint_line["line-dasharray"]),"line-pattern":new Y0(Se.paint_line["line-pattern"]),"line-gradient":new Gp(Se.paint_line["line-gradient"])})},get layout(){return _C=_C||new oo({"line-cap":new di(Se.layout_line["line-cap"]),"line-join":new Ci(Se.layout_line["line-join"]),"line-miter-limit":new di(Se.layout_line["line-miter-limit"]),"line-round-limit":new di(Se.layout_line["line-round-limit"]),"line-sort-key":new Ci(Se.layout_line["line-sort-key"])})}};class bz extends Ci{possiblyEvaluate(c,y){return y=new ts(Math.floor(y.zoom),{now:y.now,fadeDuration:y.fadeDuration,zoomHistory:y.zoomHistory,transition:y.transition}),super.possiblyEvaluate(c,y)}evaluate(c,y,w,C){return y=T({},y,{zoom:Math.floor(y.zoom)}),super.evaluate(c,y,w,C)}}let t9;class wz extends ll{constructor(c){super(c,vC),this.gradientVersion=0,t9||(t9=new bz(vC.paint.properties["line-width"].specification),t9.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(c){c==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ch,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,y){super.recalculate(c,y),this.paint._values["line-floorwidth"]=t9.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new Lv(c)}queryRadius(c){let y=c,w=bC(Wp("line-width",this,y),Wp("line-gap-width",this,y)),C=Wp("line-offset",this,y);return w/2+Math.abs(C)+q7(this.paint.get("line-translate"))}queryIntersectsFeature(c,y,w,C,R,N,z){let V=Y7(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),N.angle,z),K=z/2*bC(this.paint.get("line-width").evaluate(y,w),this.paint.get("line-gap-width").evaluate(y,w)),se=this.paint.get("line-offset").evaluate(y,w);return se&&(C=function(ue,fe){let ve=[];for(let we=0;we<ue.length;we++){let ke=ue[we],Le=[];for(let Be=0;Be<ke.length;Be++){let qe=ke[Be-1],$e=ke[Be],et=ke[Be+1],it=Be===0?new u(0,0):$e.sub(qe)._unit()._perp(),pt=Be===ke.length-1?new u(0,0):et.sub($e)._unit()._perp(),Xt=it._add(pt)._unit(),ai=Xt.x*pt.x+Xt.y*pt.y;ai!==0&&Xt._mult(1/ai),Le.push(Xt._mult(fe)._add($e))}ve.push(Le)}return ve}(C,se*z)),function(ue,fe,ve){for(let we=0;we<fe.length;we++){let ke=fe[we];if(ue.length>=3){for(let Le=0;Le<ke.length;Le++)if(tf(ue,ke[Le]))return!0}if(IU(ue,ke,ve))return!0}return!1}(V,C,K)}isTileClipped(){return!0}}function bC(p,c){return c>0?c+2*p:p}let Ez=Rs([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Tz=Rs([{name:"a_projected_pos",components:3,type:"Float32"}],4);Rs([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let Sz=Rs([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Rs([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let wC=Rs([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Az=Rs([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Cz(p,c,y){return p.sections.forEach(w=>{w.text=function(C,R,N){let z=R.layout.get("text-transform").evaluate(N,{});return z==="uppercase"?C=C.toLocaleUpperCase():z==="lowercase"&&(C=C.toLocaleLowerCase()),aa.applyArabicShaping&&(C=aa.applyArabicShaping(C)),C}(w.text,c,y)}),p}Rs([{name:"triangle",components:3,type:"Uint16"}]),Rs([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Rs([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Rs([{type:"Float32",name:"offsetX"}]),Rs([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Rs([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let i3={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var an=24,EC=Nr,TC=function(p,c,y,w,C){var R,N,z=8*C-w-1,V=(1<<z)-1,K=V>>1,se=-7,ue=y?C-1:0,fe=y?-1:1,ve=p[c+ue];for(ue+=fe,R=ve&(1<<-se)-1,ve>>=-se,se+=z;se>0;R=256*R+p[c+ue],ue+=fe,se-=8);for(N=R&(1<<-se)-1,R>>=-se,se+=w;se>0;N=256*N+p[c+ue],ue+=fe,se-=8);if(R===0)R=1-K;else{if(R===V)return N?NaN:1/0*(ve?-1:1);N+=Math.pow(2,w),R-=K}return(ve?-1:1)*N*Math.pow(2,R-w)},SC=function(p,c,y,w,C,R){var N,z,V,K=8*R-C-1,se=(1<<K)-1,ue=se>>1,fe=C===23?Math.pow(2,-24)-Math.pow(2,-77):0,ve=w?0:R-1,we=w?1:-1,ke=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(z=isNaN(c)?1:0,N=se):(N=Math.floor(Math.log(c)/Math.LN2),c*(V=Math.pow(2,-N))<1&&(N--,V*=2),(c+=N+ue>=1?fe/V:fe*Math.pow(2,1-ue))*V>=2&&(N++,V/=2),N+ue>=se?(z=0,N=se):N+ue>=1?(z=(c*V-1)*Math.pow(2,C),N+=ue):(z=c*Math.pow(2,ue-1)*Math.pow(2,C),N=0));C>=8;p[y+ve]=255&z,ve+=we,z/=256,C-=8);for(N=N<<C|z,K+=C;K>0;p[y+ve]=255&N,ve+=we,N/=256,K-=8);p[y+ve-we]|=128*ke};function Nr(p){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(p)?p:new Uint8Array(p||0),this.pos=0,this.type=0,this.length=this.buf.length}Nr.Varint=0,Nr.Fixed64=1,Nr.Bytes=2,Nr.Fixed32=5;var Nv=4294967296,AC=1/Nv,CC=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function fu(p){return p.type===Nr.Bytes?p.readVarint()+p.pos:p.pos+1}function of(p,c,y){return y?4294967296*c+(p>>>0):4294967296*(c>>>0)+(p>>>0)}function IC(p,c,y){var w=c<=16383?1:c<=2097151?2:c<=268435455?3:Math.floor(Math.log(c)/(7*Math.LN2));y.realloc(w);for(var C=y.pos-1;C>=p;C--)y.buf[C+w]=y.buf[C]}function Iz(p,c){for(var y=0;y<p.length;y++)c.writeVarint(p[y])}function kz(p,c){for(var y=0;y<p.length;y++)c.writeSVarint(p[y])}function Mz(p,c){for(var y=0;y<p.length;y++)c.writeFloat(p[y])}function Pz(p,c){for(var y=0;y<p.length;y++)c.writeDouble(p[y])}function Rz(p,c){for(var y=0;y<p.length;y++)c.writeBoolean(p[y])}function Dz(p,c){for(var y=0;y<p.length;y++)c.writeFixed32(p[y])}function Fz(p,c){for(var y=0;y<p.length;y++)c.writeSFixed32(p[y])}function Lz(p,c){for(var y=0;y<p.length;y++)c.writeFixed64(p[y])}function Nz(p,c){for(var y=0;y<p.length;y++)c.writeSFixed64(p[y])}function i9(p,c){return(p[c]|p[c+1]<<8|p[c+2]<<16)+16777216*p[c+3]}function af(p,c,y){p[y]=c,p[y+1]=c>>>8,p[y+2]=c>>>16,p[y+3]=c>>>24}function kC(p,c){return(p[c]|p[c+1]<<8|p[c+2]<<16)+(p[c+3]<<24)}Nr.prototype={destroy:function(){this.buf=null},readFields:function(p,c,y){for(y=y||this.length;this.pos<y;){var w=this.readVarint(),C=w>>3,R=this.pos;this.type=7&w,p(C,c,this),this.pos===R&&this.skip(w)}return c},readMessage:function(p,c){return this.readFields(p,c,this.readVarint()+this.pos)},readFixed32:function(){var p=i9(this.buf,this.pos);return this.pos+=4,p},readSFixed32:function(){var p=kC(this.buf,this.pos);return this.pos+=4,p},readFixed64:function(){var p=i9(this.buf,this.pos)+i9(this.buf,this.pos+4)*Nv;return this.pos+=8,p},readSFixed64:function(){var p=i9(this.buf,this.pos)+kC(this.buf,this.pos+4)*Nv;return this.pos+=8,p},readFloat:function(){var p=TC(this.buf,this.pos,!0,23,4);return this.pos+=4,p},readDouble:function(){var p=TC(this.buf,this.pos,!0,52,8);return this.pos+=8,p},readVarint:function(p){var c,y,w=this.buf;return c=127&(y=w[this.pos++]),y<128?c:(c|=(127&(y=w[this.pos++]))<<7,y<128?c:(c|=(127&(y=w[this.pos++]))<<14,y<128?c:(c|=(127&(y=w[this.pos++]))<<21,y<128?c:function(C,R,N){var z,V,K=N.buf;if(z=(112&(V=K[N.pos++]))>>4,V<128||(z|=(127&(V=K[N.pos++]))<<3,V<128)||(z|=(127&(V=K[N.pos++]))<<10,V<128)||(z|=(127&(V=K[N.pos++]))<<17,V<128)||(z|=(127&(V=K[N.pos++]))<<24,V<128)||(z|=(1&(V=K[N.pos++]))<<31,V<128))return of(C,z,R);throw new Error("Expected varint not more than 10 bytes")}(c|=(15&(y=w[this.pos]))<<28,p,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var p=this.readVarint();return p%2==1?(p+1)/-2:p/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var p=this.readVarint()+this.pos,c=this.pos;return this.pos=p,p-c>=12&&CC?function(y,w,C){return CC.decode(y.subarray(w,C))}(this.buf,c,p):function(y,w,C){for(var R="",N=w;N<C;){var z,V,K,se=y[N],ue=null,fe=se>239?4:se>223?3:se>191?2:1;if(N+fe>C)break;fe===1?se<128&&(ue=se):fe===2?(192&(z=y[N+1]))==128&&(ue=(31&se)<<6|63&z)<=127&&(ue=null):fe===3?(V=y[N+2],(192&(z=y[N+1]))==128&&(192&V)==128&&((ue=(15&se)<<12|(63&z)<<6|63&V)<=2047||ue>=55296&&ue<=57343)&&(ue=null)):fe===4&&(V=y[N+2],K=y[N+3],(192&(z=y[N+1]))==128&&(192&V)==128&&(192&K)==128&&((ue=(15&se)<<18|(63&z)<<12|(63&V)<<6|63&K)<=65535||ue>=1114112)&&(ue=null)),ue===null?(ue=65533,fe=1):ue>65535&&(ue-=65536,R+=String.fromCharCode(ue>>>10&1023|55296),ue=56320|1023&ue),R+=String.fromCharCode(ue),N+=fe}return R}(this.buf,c,p)},readBytes:function(){var p=this.readVarint()+this.pos,c=this.buf.subarray(this.pos,p);return this.pos=p,c},readPackedVarint:function(p,c){if(this.type!==Nr.Bytes)return p.push(this.readVarint(c));var y=fu(this);for(p=p||[];this.pos<y;)p.push(this.readVarint(c));return p},readPackedSVarint:function(p){if(this.type!==Nr.Bytes)return p.push(this.readSVarint());var c=fu(this);for(p=p||[];this.pos<c;)p.push(this.readSVarint());return p},readPackedBoolean:function(p){if(this.type!==Nr.Bytes)return p.push(this.readBoolean());var c=fu(this);for(p=p||[];this.pos<c;)p.push(this.readBoolean());return p},readPackedFloat:function(p){if(this.type!==Nr.Bytes)return p.push(this.readFloat());var c=fu(this);for(p=p||[];this.pos<c;)p.push(this.readFloat());return p},readPackedDouble:function(p){if(this.type!==Nr.Bytes)return p.push(this.readDouble());var c=fu(this);for(p=p||[];this.pos<c;)p.push(this.readDouble());return p},readPackedFixed32:function(p){if(this.type!==Nr.Bytes)return p.push(this.readFixed32());var c=fu(this);for(p=p||[];this.pos<c;)p.push(this.readFixed32());return p},readPackedSFixed32:function(p){if(this.type!==Nr.Bytes)return p.push(this.readSFixed32());var c=fu(this);for(p=p||[];this.pos<c;)p.push(this.readSFixed32());return p},readPackedFixed64:function(p){if(this.type!==Nr.Bytes)return p.push(this.readFixed64());var c=fu(this);for(p=p||[];this.pos<c;)p.push(this.readFixed64());return p},readPackedSFixed64:function(p){if(this.type!==Nr.Bytes)return p.push(this.readSFixed64());var c=fu(this);for(p=p||[];this.pos<c;)p.push(this.readSFixed64());return p},skip:function(p){var c=7&p;if(c===Nr.Varint)for(;this.buf[this.pos++]>127;);else if(c===Nr.Bytes)this.pos=this.readVarint()+this.pos;else if(c===Nr.Fixed32)this.pos+=4;else{if(c!==Nr.Fixed64)throw new Error("Unimplemented type: "+c);this.pos+=8}},writeTag:function(p,c){this.writeVarint(p<<3|c)},realloc:function(p){for(var c=this.length||16;c<this.pos+p;)c*=2;if(c!==this.length){var y=new Uint8Array(c);y.set(this.buf),this.buf=y,this.length=c}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(p){this.realloc(4),af(this.buf,p,this.pos),this.pos+=4},writeSFixed32:function(p){this.realloc(4),af(this.buf,p,this.pos),this.pos+=4},writeFixed64:function(p){this.realloc(8),af(this.buf,-1&p,this.pos),af(this.buf,Math.floor(p*AC),this.pos+4),this.pos+=8},writeSFixed64:function(p){this.realloc(8),af(this.buf,-1&p,this.pos),af(this.buf,Math.floor(p*AC),this.pos+4),this.pos+=8},writeVarint:function(p){(p=+p||0)>268435455||p<0?function(c,y){var w,C;if(c>=0?(w=c%4294967296|0,C=c/4294967296|0):(C=~(-c/4294967296),4294967295^(w=~(-c%4294967296))?w=w+1|0:(w=0,C=C+1|0)),c>=18446744073709552e3||c<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");y.realloc(10),function(R,N,z){z.buf[z.pos++]=127&R|128,R>>>=7,z.buf[z.pos++]=127&R|128,R>>>=7,z.buf[z.pos++]=127&R|128,R>>>=7,z.buf[z.pos++]=127&R|128,z.buf[z.pos]=127&(R>>>=7)}(w,0,y),function(R,N){var z=(7&R)<<4;N.buf[N.pos++]|=z|((R>>>=3)?128:0),R&&(N.buf[N.pos++]=127&R|((R>>>=7)?128:0),R&&(N.buf[N.pos++]=127&R|((R>>>=7)?128:0),R&&(N.buf[N.pos++]=127&R|((R>>>=7)?128:0),R&&(N.buf[N.pos++]=127&R|((R>>>=7)?128:0),R&&(N.buf[N.pos++]=127&R)))))}(C,y)}(p,this):(this.realloc(4),this.buf[this.pos++]=127&p|(p>127?128:0),p<=127||(this.buf[this.pos++]=127&(p>>>=7)|(p>127?128:0),p<=127||(this.buf[this.pos++]=127&(p>>>=7)|(p>127?128:0),p<=127||(this.buf[this.pos++]=p>>>7&127))))},writeSVarint:function(p){this.writeVarint(p<0?2*-p-1:2*p)},writeBoolean:function(p){this.writeVarint(!!p)},writeString:function(p){p=String(p),this.realloc(4*p.length),this.pos++;var c=this.pos;this.pos=function(w,C,R){for(var N,z,V=0;V<C.length;V++){if((N=C.charCodeAt(V))>55295&&N<57344){if(!z){N>56319||V+1===C.length?(w[R++]=239,w[R++]=191,w[R++]=189):z=N;continue}if(N<56320){w[R++]=239,w[R++]=191,w[R++]=189,z=N;continue}N=z-55296<<10|N-56320|65536,z=null}else z&&(w[R++]=239,w[R++]=191,w[R++]=189,z=null);N<128?w[R++]=N:(N<2048?w[R++]=N>>6|192:(N<65536?w[R++]=N>>12|224:(w[R++]=N>>18|240,w[R++]=N>>12&63|128),w[R++]=N>>6&63|128),w[R++]=63&N|128)}return R}(this.buf,p,this.pos);var y=this.pos-c;y>=128&&IC(c,y,this),this.pos=c-1,this.writeVarint(y),this.pos+=y},writeFloat:function(p){this.realloc(4),SC(this.buf,p,this.pos,!0,23,4),this.pos+=4},writeDouble:function(p){this.realloc(8),SC(this.buf,p,this.pos,!0,52,8),this.pos+=8},writeBytes:function(p){var c=p.length;this.writeVarint(c),this.realloc(c);for(var y=0;y<c;y++)this.buf[this.pos++]=p[y]},writeRawMessage:function(p,c){this.pos++;var y=this.pos;p(c,this);var w=this.pos-y;w>=128&&IC(y,w,this),this.pos=y-1,this.writeVarint(w),this.pos+=w},writeMessage:function(p,c,y){this.writeTag(p,Nr.Bytes),this.writeRawMessage(c,y)},writePackedVarint:function(p,c){c.length&&this.writeMessage(p,Iz,c)},writePackedSVarint:function(p,c){c.length&&this.writeMessage(p,kz,c)},writePackedBoolean:function(p,c){c.length&&this.writeMessage(p,Rz,c)},writePackedFloat:function(p,c){c.length&&this.writeMessage(p,Mz,c)},writePackedDouble:function(p,c){c.length&&this.writeMessage(p,Pz,c)},writePackedFixed32:function(p,c){c.length&&this.writeMessage(p,Dz,c)},writePackedSFixed32:function(p,c){c.length&&this.writeMessage(p,Fz,c)},writePackedFixed64:function(p,c){c.length&&this.writeMessage(p,Lz,c)},writePackedSFixed64:function(p,c){c.length&&this.writeMessage(p,Nz,c)},writeBytesField:function(p,c){this.writeTag(p,Nr.Bytes),this.writeBytes(c)},writeFixed32Field:function(p,c){this.writeTag(p,Nr.Fixed32),this.writeFixed32(c)},writeSFixed32Field:function(p,c){this.writeTag(p,Nr.Fixed32),this.writeSFixed32(c)},writeFixed64Field:function(p,c){this.writeTag(p,Nr.Fixed64),this.writeFixed64(c)},writeSFixed64Field:function(p,c){this.writeTag(p,Nr.Fixed64),this.writeSFixed64(c)},writeVarintField:function(p,c){this.writeTag(p,Nr.Varint),this.writeVarint(c)},writeSVarintField:function(p,c){this.writeTag(p,Nr.Varint),this.writeSVarint(c)},writeStringField:function(p,c){this.writeTag(p,Nr.Bytes),this.writeString(c)},writeFloatField:function(p,c){this.writeTag(p,Nr.Fixed32),this.writeFloat(c)},writeDoubleField:function(p,c){this.writeTag(p,Nr.Fixed64),this.writeDouble(c)},writeBooleanField:function(p,c){this.writeVarintField(p,!!c)}};var Ov=o(EC);let Bv=3;function Oz(p,c,y){p===1&&y.readMessage(Bz,c)}function Bz(p,c,y){if(p===3){let{id:w,bitmap:C,width:R,height:N,left:z,top:V,advance:K}=y.readMessage(Uz,{});c.push({id:w,bitmap:new Yp({width:R+2*Bv,height:N+2*Bv},C),metrics:{width:R,height:N,left:z,top:V,advance:K}})}}function Uz(p,c,y){p===1?c.id=y.readVarint():p===2?c.bitmap=y.readBytes():p===3?c.width=y.readVarint():p===4?c.height=y.readVarint():p===5?c.left=y.readSVarint():p===6?c.top=y.readSVarint():p===7&&(c.advance=y.readVarint())}let MC=Bv;function PC(p){let c=0,y=0;for(let N of p)c+=N.w*N.h,y=Math.max(y,N.w);p.sort((N,z)=>z.h-N.h);let w=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),y),h:1/0}],C=0,R=0;for(let N of p)for(let z=w.length-1;z>=0;z--){let V=w[z];if(!(N.w>V.w||N.h>V.h)){if(N.x=V.x,N.y=V.y,R=Math.max(R,N.y+N.h),C=Math.max(C,N.x+N.w),N.w===V.w&&N.h===V.h){let K=w.pop();z<w.length&&(w[z]=K)}else N.h===V.h?(V.x+=N.w,V.w-=N.w):N.w===V.w?(V.y+=N.h,V.h-=N.h):(w.push({x:V.x+N.w,y:V.y,w:V.w-N.w,h:N.h}),V.y+=N.h,V.h-=N.h);break}}return{w:C,h:R,fill:c/(C*R)||0}}let Io=1;class Uv{constructor(c,{pixelRatio:y,version:w,stretchX:C,stretchY:R,content:N}){this.paddedRect=c,this.pixelRatio=y,this.stretchX=C,this.stretchY=R,this.content=N,this.version=w}get tl(){return[this.paddedRect.x+Io,this.paddedRect.y+Io]}get br(){return[this.paddedRect.x+this.paddedRect.w-Io,this.paddedRect.y+this.paddedRect.h-Io]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Io)/this.pixelRatio,(this.paddedRect.h-2*Io)/this.pixelRatio]}}class RC{constructor(c,y){let w={},C={};this.haveRenderCallbacks=[];let R=[];this.addImages(c,w,R),this.addImages(y,C,R);let{w:N,h:z}=PC(R),V=new Ra({width:N||1,height:z||1});for(let K in c){let se=c[K],ue=w[K].paddedRect;Ra.copy(se.data,V,{x:0,y:0},{x:ue.x+Io,y:ue.y+Io},se.data)}for(let K in y){let se=y[K],ue=C[K].paddedRect,fe=ue.x+Io,ve=ue.y+Io,we=se.data.width,ke=se.data.height;Ra.copy(se.data,V,{x:0,y:0},{x:fe,y:ve},se.data),Ra.copy(se.data,V,{x:0,y:ke-1},{x:fe,y:ve-1},{width:we,height:1}),Ra.copy(se.data,V,{x:0,y:0},{x:fe,y:ve+ke},{width:we,height:1}),Ra.copy(se.data,V,{x:we-1,y:0},{x:fe-1,y:ve},{width:1,height:ke}),Ra.copy(se.data,V,{x:0,y:0},{x:fe+we,y:ve},{width:1,height:ke})}this.image=V,this.iconPositions=w,this.patternPositions=C}addImages(c,y,w){for(let C in c){let R=c[C],N={x:0,y:0,w:R.data.width+2*Io,h:R.data.height+2*Io};w.push(N),y[C]=new Uv(N,R),R.hasRenderCallback&&this.haveRenderCallbacks.push(C)}}patchUpdatedImages(c,y){c.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let w in c.updatedImages)this.patchUpdatedImage(this.iconPositions[w],c.getImage(w),y),this.patchUpdatedImage(this.patternPositions[w],c.getImage(w),y)}patchUpdatedImage(c,y,w){if(!c||!y||c.version===y.version)return;c.version=y.version;let[C,R]=c.tl;w.update(y.data,void 0,{x:C,y:R})}}var v1;Zt("ImagePosition",Uv),Zt("ImageAtlas",RC),n.WritingMode=void 0,(v1=n.WritingMode||(n.WritingMode={}))[v1.none=0]="none",v1[v1.horizontal=1]="horizontal",v1[v1.vertical=2]="vertical",v1[v1.horizontalOnly=3]="horizontalOnly";let r3=-17;class s3{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(c,y){let w=new s3;return w.scale=c||1,w.fontStack=y,w}static forImage(c){let y=new s3;return y.imageName=c,y}}class lf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(c,y){let w=new lf;for(let C=0;C<c.sections.length;C++){let R=c.sections[C];R.image?w.addImageSection(R):w.addTextSection(R,y)}return w}length(){return this.text.length}getSection(c){return this.sections[this.sectionIndex[c]]}getSectionIndex(c){return this.sectionIndex[c]}getCharCode(c){return this.text.charCodeAt(c)}verticalizePunctuation(){this.text=function(c){let y="";for(let w=0;w<c.length;w++){let C=c.charCodeAt(w+1)||null,R=c.charCodeAt(w-1)||null;y+=C&&$h(C)&&!i3[c[w+1]]||R&&$h(R)&&!i3[c[w-1]]||!i3[c[w]]?c[w]:i3[c[w]]}return y}(this.text)}trim(){let c=0;for(let w=0;w<this.text.length&&s9[this.text.charCodeAt(w)];w++)c++;let y=this.text.length;for(let w=this.text.length-1;w>=0&&w>=c&&s9[this.text.charCodeAt(w)];w--)y--;this.text=this.text.substring(c,y),this.sectionIndex=this.sectionIndex.slice(c,y)}substring(c,y){let w=new lf;return w.text=this.text.substring(c,y),w.sectionIndex=this.sectionIndex.slice(c,y),w.sections=this.sections,w}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((c,y)=>Math.max(c,this.sections[y].scale),0)}addTextSection(c,y){this.text+=c.text,this.sections.push(s3.forText(c.scale,c.fontStack||y));let w=this.sections.length-1;for(let C=0;C<c.text.length;++C)this.sectionIndex.push(w)}addImageSection(c){let y=c.image?c.image.name:"";if(y.length===0)return void B("Can't add FormattedSection with an empty image.");let w=this.getNextImageSectionCharCode();w?(this.text+=String.fromCharCode(w),this.sections.push(s3.forImage(y)),this.sectionIndex.push(this.sections.length-1)):B("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function r9(p,c,y,w,C,R,N,z,V,K,se,ue,fe,ve,we,ke){let Le=lf.fromFeature(p,C),Be;ue===n.WritingMode.vertical&&Le.verticalizePunctuation();let{processBidirectionalText:qe,processStyledBidirectionalText:$e}=aa;if(qe&&Le.sections.length===1){Be=[];let pt=qe(Le.toString(),zv(Le,K,R,c,w,ve,we));for(let Xt of pt){let ai=new lf;ai.text=Xt,ai.sections=Le.sections;for(let jt=0;jt<Xt.length;jt++)ai.sectionIndex.push(0);Be.push(ai)}}else if($e){Be=[];let pt=$e(Le.text,Le.sectionIndex,zv(Le,K,R,c,w,ve,we));for(let Xt of pt){let ai=new lf;ai.text=Xt[0],ai.sectionIndex=Xt[1],ai.sections=Le.sections,Be.push(ai)}}else Be=function(pt,Xt){let ai=[],jt=pt.text,zt=0;for(let Rt of Xt)ai.push(pt.substring(zt,Rt)),zt=Rt;return zt<jt.length&&ai.push(pt.substring(zt,jt.length)),ai}(Le,zv(Le,K,R,c,w,ve,we));let et=[],it={positionedLines:et,text:Le.toString(),top:se[1],bottom:se[1],left:se[0],right:se[0],writingMode:ue,iconsInText:!1,verticalizable:!1};return function(pt,Xt,ai,jt,zt,Rt,Qt,Nt,Ct,xi,ci,sr){let Qr=0,rs=r3,ln=0,ca=0,co=Nt==="right"?1:Nt==="left"?0:.5,Xs=0;for(let Ws of zt){Ws.trim();let cn=Ws.getMaxScale(),Wn=(cn-1)*an,ho={positionedGlyphs:[],lineOffset:0};pt.positionedLines[Xs]=ho;let Mo=ho.positionedGlyphs,Po=0;if(!Ws.length()){rs+=Rt,++Xs;continue}for(let Un=0;Un<Ws.length();Un++){let dr=Ws.getSection(Un),ua=Ws.getSectionIndex(Un),zn=Ws.getCharCode(Un),fo=0,hl=null,Gl=null,$l=null,pu=an,dl=!(Ct===n.WritingMode.horizontal||!ci&&!Gh(zn)||ci&&(s9[zn]||(yn=zn,Vt.Arabic(yn)||Vt["Arabic Supplement"](yn)||Vt["Arabic Extended-A"](yn)||Vt["Arabic Presentation Forms-A"](yn)||Vt["Arabic Presentation Forms-B"](yn))));if(dr.imageName){let Fa=jt[dr.imageName];if(!Fa)continue;$l=dr.imageName,pt.iconsInText=pt.iconsInText||!0,Gl=Fa.paddedRect;let Ro=Fa.displaySize;dr.scale=dr.scale*an/sr,hl={width:Ro[0],height:Ro[1],left:Io,top:-MC,advance:dl?Ro[1]:Ro[0]},fo=Wn+(an-Ro[1]*dr.scale),pu=hl.advance;let mu=dl?Ro[0]*dr.scale-an*cn:Ro[1]*dr.scale-an*cn;mu>0&&mu>Po&&(Po=mu)}else{let Fa=ai[dr.fontStack],Ro=Fa&&Fa[zn];if(Ro&&Ro.rect)Gl=Ro.rect,hl=Ro.metrics;else{let mu=Xt[dr.fontStack],c3=mu&&mu[zn];if(!c3)continue;hl=c3.metrics}fo=(cn-dr.scale)*an}dl?(pt.verticalizable=!0,Mo.push({glyph:zn,imageName:$l,x:Qr,y:rs+fo,vertical:dl,scale:dr.scale,fontStack:dr.fontStack,sectionIndex:ua,metrics:hl,rect:Gl}),Qr+=pu*dr.scale+xi):(Mo.push({glyph:zn,imageName:$l,x:Qr,y:rs+fo,vertical:dl,scale:dr.scale,fontStack:dr.fontStack,sectionIndex:ua,metrics:hl,rect:Gl}),Qr+=hl.advance*dr.scale+xi)}Mo.length!==0&&(ln=Math.max(Qr-xi,ln),$z(Mo,0,Mo.length-1,co,Po)),Qr=0;let Ss=Rt*cn+Po;ho.lineOffset=Math.max(Po,Wn),rs+=Ss,ca=Math.max(Ss,ca),++Xs}var yn;let Bn=rs-r3,{horizontalAlign:ko,verticalAlign:uo}=Gv(Qt);(function(Ws,cn,Wn,ho,Mo,Po,Ss,Un,dr){let ua=(cn-Wn)*Mo,zn=0;zn=Po!==Ss?-Un*ho-r3:(-ho*dr+.5)*Ss;for(let fo of Ws)for(let hl of fo.positionedGlyphs)hl.x+=ua,hl.y+=zn})(pt.positionedLines,co,ko,uo,ln,ca,Rt,Bn,zt.length),pt.top+=-uo*Bn,pt.bottom=pt.top+Bn,pt.left+=-ko*ln,pt.right=pt.left+ln}(it,c,y,w,Be,N,z,V,ue,K,fe,ke),!function(pt){for(let Xt of pt)if(Xt.positionedGlyphs.length!==0)return!1;return!0}(et)&&it}let s9={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},zz={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function DC(p,c,y,w,C,R){if(c.imageName){let N=w[c.imageName];return N?N.displaySize[0]*c.scale*an/R+C:0}{let N=y[c.fontStack],z=N&&N[p];return z?z.metrics.advance*c.scale+C:0}}function FC(p,c,y,w){let C=Math.pow(p-c,2);return w?p<c?C/2:2*C:C+Math.abs(y)*y}function Gz(p,c,y){let w=0;return p===10&&(w-=1e4),y&&(w+=150),p!==40&&p!==65288||(w+=50),c!==41&&c!==65289||(w+=50),w}function LC(p,c,y,w,C,R){let N=null,z=FC(c,y,C,R);for(let V of w){let K=FC(c-V.x,y,C,R)+V.badness;K<=z&&(N=V,z=K)}return{index:p,x:c,priorBreak:N,badness:z}}function NC(p){return p?NC(p.priorBreak).concat(p.index):[]}function zv(p,c,y,w,C,R,N){if(R!=="point")return[];if(!p)return[];let z=[],V=function(fe,ve,we,ke,Le,Be){let qe=0;for(let $e=0;$e<fe.length();$e++){let et=fe.getSection($e);qe+=DC(fe.getCharCode($e),et,ke,Le,ve,Be)}return qe/Math.max(1,Math.ceil(qe/we))}(p,c,y,w,C,N),K=p.text.indexOf("\u200B")>=0,se=0;for(let fe=0;fe<p.length();fe++){let ve=p.getSection(fe),we=p.getCharCode(fe);if(s9[we]||(se+=DC(we,ve,w,C,c,N)),fe<p.length()-1){let ke=!((ue=we)<11904||!(Vt["Bopomofo Extended"](ue)||Vt.Bopomofo(ue)||Vt["CJK Compatibility Forms"](ue)||Vt["CJK Compatibility Ideographs"](ue)||Vt["CJK Compatibility"](ue)||Vt["CJK Radicals Supplement"](ue)||Vt["CJK Strokes"](ue)||Vt["CJK Symbols and Punctuation"](ue)||Vt["CJK Unified Ideographs Extension A"](ue)||Vt["CJK Unified Ideographs"](ue)||Vt["Enclosed CJK Letters and Months"](ue)||Vt["Halfwidth and Fullwidth Forms"](ue)||Vt.Hiragana(ue)||Vt["Ideographic Description Characters"](ue)||Vt["Kangxi Radicals"](ue)||Vt["Katakana Phonetic Extensions"](ue)||Vt.Katakana(ue)||Vt["Vertical Forms"](ue)||Vt["Yi Radicals"](ue)||Vt["Yi Syllables"](ue)));(zz[we]||ke||ve.imageName)&&z.push(LC(fe+1,se,V,z,Gz(we,p.getCharCode(fe+1),ke&&K),!1))}}var ue;return NC(LC(p.length(),se,V,z,0,!0))}function Gv(p){let c=.5,y=.5;switch(p){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(p){case"bottom":case"bottom-right":case"bottom-left":y=1;break;case"top":case"top-right":case"top-left":y=0}return{horizontalAlign:c,verticalAlign:y}}function $z(p,c,y,w,C){if(!w&&!C)return;let R=p[y],N=(p[y].x+R.metrics.advance*R.scale)*w;for(let z=c;z<=y;z++)p[z].x-=N,p[z].y+=C}function Hz(p,c,y){let{horizontalAlign:w,verticalAlign:C}=Gv(y),R=c[0]-p.displaySize[0]*w,N=c[1]-p.displaySize[1]*C;return{image:p,top:N,bottom:N+p.displaySize[1],left:R,right:R+p.displaySize[0]}}function OC(p,c,y,w,C,R){let N=p.image,z;if(N.content){let Le=N.content,Be=N.pixelRatio||1;z=[Le[0]/Be,Le[1]/Be,N.displaySize[0]-Le[2]/Be,N.displaySize[1]-Le[3]/Be]}let V=c.left*R,K=c.right*R,se,ue,fe,ve;y==="width"||y==="both"?(ve=C[0]+V-w[3],ue=C[0]+K+w[1]):(ve=C[0]+(V+K-N.displaySize[0])/2,ue=ve+N.displaySize[0]);let we=c.top*R,ke=c.bottom*R;return y==="height"||y==="both"?(se=C[1]+we-w[0],fe=C[1]+ke+w[2]):(se=C[1]+(we+ke-N.displaySize[1])/2,fe=se+N.displaySize[1]),{image:N,top:se,right:ue,bottom:fe,left:ve,collisionPadding:z}}let n3=255,Ec=128,b1=n3*Ec;function BC(p,c){let{expression:y}=c;if(y.kind==="constant")return{kind:"constant",layoutSize:y.evaluate(new ts(p+1))};if(y.kind==="source")return{kind:"source"};{let{zoomStops:w,interpolationType:C}=y,R=0;for(;R<w.length&&w[R]<=p;)R++;R=Math.max(0,R-1);let N=R;for(;N<w.length&&w[N]<p+1;)N++;N=Math.min(w.length-1,N);let z=w[R],V=w[N];return y.kind==="composite"?{kind:"composite",minZoom:z,maxZoom:V,interpolationType:C}:{kind:"camera",minZoom:z,maxZoom:V,minSize:y.evaluate(new ts(z)),maxSize:y.evaluate(new ts(V)),interpolationType:C}}}function $v(p,c,y){let w="never",C=p.get(c);return C?w=C:p.get(y)&&(w="always"),w}let Vz=x1.VectorTileFeature.types,jz=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function n9(p,c,y,w,C,R,N,z,V,K,se,ue,fe){let ve=z?Math.min(b1,Math.round(z[0])):0,we=z?Math.min(b1,Math.round(z[1])):0;p.emplaceBack(c,y,Math.round(32*w),Math.round(32*C),R,N,(ve<<1)+(V?1:0),we,16*K,16*se,256*ue,256*fe)}function Hv(p,c,y){p.emplaceBack(c.x,c.y,y),p.emplaceBack(c.x,c.y,y),p.emplaceBack(c.x,c.y,y),p.emplaceBack(c.x,c.y,y)}function Xz(p){for(let c of p.sections)if($7(c.text))return!0;return!1}class Vv{constructor(c){this.layoutVertexArray=new Et,this.indexArray=new yi,this.programConfigurations=c,this.segments=new _i,this.dynamicLayoutVertexArray=new kt,this.opacityVertexArray=new oi,this.hasVisibleVertices=!1,this.placedSymbolArray=new J}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(c,y,w,C){this.isEmpty()||(w&&(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Ez.members),this.indexBuffer=c.createIndexBuffer(this.indexArray,y),this.dynamicLayoutVertexBuffer=c.createVertexBuffer(this.dynamicLayoutVertexArray,Tz.members,!0),this.opacityVertexBuffer=c.createVertexBuffer(this.opacityVertexArray,jz,!0),this.opacityVertexBuffer.itemSize=1),(w||C)&&this.programConfigurations.upload(c))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Zt("SymbolBuffers",Vv);class jv{constructor(c,y,w){this.layoutVertexArray=new c,this.layoutAttributes=y,this.indexArray=new w,this.segments=new _i,this.collisionVertexArray=new Ut}upload(c){this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=c.createVertexBuffer(this.collisionVertexArray,Sz.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Zt("CollisionBuffers",jv);class cf{constructor(c){this.collisionBoxArray=c.collisionBoxArray,this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(N=>N.id),this.index=c.index,this.pixelRatio=c.pixelRatio,this.sourceLayerIndex=c.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=wv([]),this.placementViewportMatrix=wv([]);let y=this.layers[0]._unevaluatedLayout._values;this.textSizeData=BC(this.zoom,y["text-size"]),this.iconSizeData=BC(this.zoom,y["icon-size"]);let w=this.layers[0].layout,C=w.get("symbol-sort-key"),R=w.get("symbol-z-order");this.canOverlap=$v(w,"text-overlap","text-allow-overlap")!=="never"||$v(w,"icon-overlap","icon-allow-overlap")!=="never"||w.get("text-ignore-placement")||w.get("icon-ignore-placement"),this.sortFeaturesByKey=R!=="viewport-y"&&!C.isConstant(),this.sortFeaturesByY=(R==="viewport-y"||R==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,w.get("symbol-placement")==="point"&&(this.writingModes=w.get("text-writing-mode").map(N=>n.WritingMode[N])),this.stateDependentLayerIds=this.layers.filter(N=>N.isStateDependent()).map(N=>N.id),this.sourceID=c.sourceID}createArrays(){this.text=new Vv(new hu(this.layers,this.zoom,c=>/^text/.test(c))),this.icon=new Vv(new hu(this.layers,this.zoom,c=>/^icon/.test(c))),this.glyphOffsetArray=new _e,this.lineVertexArray=new Ce,this.symbolInstances=new ae,this.textAnchorOffsets=new Re}calculateGlyphDependencies(c,y,w,C,R){for(let N=0;N<c.length;N++)if(y[c.charCodeAt(N)]=!0,(w||C)&&R){let z=i3[c.charAt(N)];z&&(y[z.charCodeAt(0)]=!0)}}populate(c,y,w){let C=this.layers[0],R=C.layout,N=R.get("text-font"),z=R.get("text-field"),V=R.get("icon-image"),K=(z.value.kind!=="constant"||z.value.value instanceof Is&&!z.value.value.isEmpty()||z.value.value.toString().length>0)&&(N.value.kind!=="constant"||N.value.value.length>0),se=V.value.kind!=="constant"||!!V.value.value||Object.keys(V.parameters).length>0,ue=R.get("symbol-sort-key");if(this.features=[],!K&&!se)return;let fe=y.iconDependencies,ve=y.glyphDependencies,we=y.availableImages,ke=new ts(this.zoom);for(let{feature:Le,id:Be,index:qe,sourceLayerIndex:$e}of c){let et=C._featureFilter.needGeometry,it=wc(Le,et);if(!C._featureFilter.filter(ke,it,w))continue;let pt,Xt;if(et||(it.geometry=zl(Le)),K){let jt=C.getValueAndResolveTokens("text-field",it,w,we),zt=Is.factory(jt);Xz(zt)&&(this.hasRTLText=!0),(!this.hasRTLText||Up()==="unavailable"||this.hasRTLText&&aa.isParsed())&&(pt=Cz(zt,C,it))}if(se){let jt=C.getValueAndResolveTokens("icon-image",it,w,we);Xt=jt instanceof na?jt:na.fromString(jt)}if(!pt&&!Xt)continue;let ai=this.sortFeaturesByKey?ue.evaluate(it,{},w):void 0;if(this.features.push({id:Be,text:pt,icon:Xt,index:qe,sourceLayerIndex:$e,geometry:it.geometry,properties:Le.properties,type:Vz[Le.type],sortKey:ai}),Xt&&(fe[Xt.name]=!0),pt){let jt=N.evaluate(it,{},w).join(","),zt=R.get("text-rotation-alignment")!=="viewport"&&R.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(n.WritingMode.vertical)>=0;for(let Rt of pt.sections)if(Rt.image)fe[Rt.image.name]=!0;else{let Qt=X0(pt.toString()),Nt=Rt.fontStack||jt,Ct=ve[Nt]=ve[Nt]||{};this.calculateGlyphDependencies(Rt.text,Ct,zt,this.allowVerticalPlacement,Qt)}}}R.get("symbol-placement")==="line"&&(this.features=function(Le){let Be={},qe={},$e=[],et=0;function it(jt){$e.push(Le[jt]),et++}function pt(jt,zt,Rt){let Qt=qe[jt];return delete qe[jt],qe[zt]=Qt,$e[Qt].geometry[0].pop(),$e[Qt].geometry[0]=$e[Qt].geometry[0].concat(Rt[0]),Qt}function Xt(jt,zt,Rt){let Qt=Be[zt];return delete Be[zt],Be[jt]=Qt,$e[Qt].geometry[0].shift(),$e[Qt].geometry[0]=Rt[0].concat($e[Qt].geometry[0]),Qt}function ai(jt,zt,Rt){let Qt=Rt?zt[0][zt[0].length-1]:zt[0][0];return`${jt}:${Qt.x}:${Qt.y}`}for(let jt=0;jt<Le.length;jt++){let zt=Le[jt],Rt=zt.geometry,Qt=zt.text?zt.text.toString():null;if(!Qt){it(jt);continue}let Nt=ai(Qt,Rt),Ct=ai(Qt,Rt,!0);if(Nt in qe&&Ct in Be&&qe[Nt]!==Be[Ct]){let xi=Xt(Nt,Ct,Rt),ci=pt(Nt,Ct,$e[xi].geometry);delete Be[Nt],delete qe[Ct],qe[ai(Qt,$e[ci].geometry,!0)]=ci,$e[xi].geometry=null}else Nt in qe?pt(Nt,Ct,Rt):Ct in Be?Xt(Nt,Ct,Rt):(it(jt),Be[Nt]=et-1,qe[Ct]=et-1)}return $e.filter(jt=>jt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Le,Be)=>Le.sortKey-Be.sortKey)}update(c,y,w){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(c,y,this.layers,w),this.icon.programConfigurations.updatePaintArrays(c,y,this.layers,w))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(c){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(c),this.iconCollisionBox.upload(c)),this.text.upload(c,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(c,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(c,y){let w=this.lineVertexArray.length;if(c.segment!==void 0){let C=c.dist(y[c.segment+1]),R=c.dist(y[c.segment]),N={};for(let z=c.segment+1;z<y.length;z++)N[z]={x:y[z].x,y:y[z].y,tileUnitDistanceFromAnchor:C},z<y.length-1&&(C+=y[z+1].dist(y[z]));for(let z=c.segment||0;z>=0;z--)N[z]={x:y[z].x,y:y[z].y,tileUnitDistanceFromAnchor:R},z>0&&(R+=y[z-1].dist(y[z]));for(let z=0;z<y.length;z++){let V=N[z];this.lineVertexArray.emplaceBack(V.x,V.y,V.tileUnitDistanceFromAnchor)}}return{lineStartIndex:w,lineLength:this.lineVertexArray.length-w}}addSymbols(c,y,w,C,R,N,z,V,K,se,ue,fe){let ve=c.indexArray,we=c.layoutVertexArray,ke=c.segments.prepareSegment(4*y.length,we,ve,this.canOverlap?N.sortKey:void 0),Le=this.glyphOffsetArray.length,Be=ke.vertexLength,qe=this.allowVerticalPlacement&&z===n.WritingMode.vertical?Math.PI/2:0,$e=N.text&&N.text.sections;for(let et=0;et<y.length;et++){let{tl:it,tr:pt,bl:Xt,br:ai,tex:jt,pixelOffsetTL:zt,pixelOffsetBR:Rt,minFontScaleX:Qt,minFontScaleY:Nt,glyphOffset:Ct,isSDF:xi,sectionIndex:ci}=y[et],sr=ke.vertexLength,Qr=Ct[1];n9(we,V.x,V.y,it.x,Qr+it.y,jt.x,jt.y,w,xi,zt.x,zt.y,Qt,Nt),n9(we,V.x,V.y,pt.x,Qr+pt.y,jt.x+jt.w,jt.y,w,xi,Rt.x,zt.y,Qt,Nt),n9(we,V.x,V.y,Xt.x,Qr+Xt.y,jt.x,jt.y+jt.h,w,xi,zt.x,Rt.y,Qt,Nt),n9(we,V.x,V.y,ai.x,Qr+ai.y,jt.x+jt.w,jt.y+jt.h,w,xi,Rt.x,Rt.y,Qt,Nt),Hv(c.dynamicLayoutVertexArray,V,qe),ve.emplaceBack(sr,sr+1,sr+2),ve.emplaceBack(sr+1,sr+2,sr+3),ke.vertexLength+=4,ke.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ct[0]),et!==y.length-1&&ci===y[et+1].sectionIndex||c.programConfigurations.populatePaintArrays(we.length,N,N.index,{},fe,$e&&$e[ci])}c.placedSymbolArray.emplaceBack(V.x,V.y,Le,this.glyphOffsetArray.length-Le,Be,K,se,V.segment,w?w[0]:0,w?w[1]:0,C[0],C[1],z,0,!1,0,ue)}_addCollisionDebugVertex(c,y,w,C,R,N){return y.emplaceBack(0,0),c.emplaceBack(w.x,w.y,C,R,Math.round(N.x),Math.round(N.y))}addCollisionDebugVertices(c,y,w,C,R,N,z){let V=R.segments.prepareSegment(4,R.layoutVertexArray,R.indexArray),K=V.vertexLength,se=R.layoutVertexArray,ue=R.collisionVertexArray,fe=z.anchorX,ve=z.anchorY;this._addCollisionDebugVertex(se,ue,N,fe,ve,new u(c,y)),this._addCollisionDebugVertex(se,ue,N,fe,ve,new u(w,y)),this._addCollisionDebugVertex(se,ue,N,fe,ve,new u(w,C)),this._addCollisionDebugVertex(se,ue,N,fe,ve,new u(c,C)),V.vertexLength+=4;let we=R.indexArray;we.emplaceBack(K,K+1),we.emplaceBack(K+1,K+2),we.emplaceBack(K+2,K+3),we.emplaceBack(K+3,K),V.primitiveLength+=4}addDebugCollisionBoxes(c,y,w,C){for(let R=c;R<y;R++){let N=this.collisionBoxArray.get(R);this.addCollisionDebugVertices(N.x1,N.y1,N.x2,N.y2,C?this.textCollisionBox:this.iconCollisionBox,N.anchorPoint,w)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new jv(or,wC.members,ii),this.iconCollisionBox=new jv(or,wC.members,ii);for(let c=0;c<this.symbolInstances.length;c++){let y=this.symbolInstances.get(c);this.addDebugCollisionBoxes(y.textBoxStartIndex,y.textBoxEndIndex,y,!0),this.addDebugCollisionBoxes(y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y,!0),this.addDebugCollisionBoxes(y.iconBoxStartIndex,y.iconBoxEndIndex,y,!1),this.addDebugCollisionBoxes(y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y,!1)}}_deserializeCollisionBoxesForSymbol(c,y,w,C,R,N,z,V,K){let se={};for(let ue=y;ue<w;ue++){let fe=c.get(ue);se.textBox={x1:fe.x1,y1:fe.y1,x2:fe.x2,y2:fe.y2,anchorPointX:fe.anchorPointX,anchorPointY:fe.anchorPointY},se.textFeatureIndex=fe.featureIndex;break}for(let ue=C;ue<R;ue++){let fe=c.get(ue);se.verticalTextBox={x1:fe.x1,y1:fe.y1,x2:fe.x2,y2:fe.y2,anchorPointX:fe.anchorPointX,anchorPointY:fe.anchorPointY},se.verticalTextFeatureIndex=fe.featureIndex;break}for(let ue=N;ue<z;ue++){let fe=c.get(ue);se.iconBox={x1:fe.x1,y1:fe.y1,x2:fe.x2,y2:fe.y2,anchorPointX:fe.anchorPointX,anchorPointY:fe.anchorPointY},se.iconFeatureIndex=fe.featureIndex;break}for(let ue=V;ue<K;ue++){let fe=c.get(ue);se.verticalIconBox={x1:fe.x1,y1:fe.y1,x2:fe.x2,y2:fe.y2,anchorPointX:fe.anchorPointX,anchorPointY:fe.anchorPointY},se.verticalIconFeatureIndex=fe.featureIndex;break}return se}deserializeCollisionBoxes(c){this.collisionArrays=[];for(let y=0;y<this.symbolInstances.length;y++){let w=this.symbolInstances.get(y);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(c,w.textBoxStartIndex,w.textBoxEndIndex,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w.iconBoxStartIndex,w.iconBoxEndIndex,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(c,y){let w=c.placedSymbolArray.get(y),C=w.vertexStartIndex+4*w.numGlyphs;for(let R=w.vertexStartIndex;R<C;R+=4)c.indexArray.emplaceBack(R,R+1,R+2),c.indexArray.emplaceBack(R+1,R+2,R+3)}getSortedSymbolIndexes(c){if(this.sortedAngle===c&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let y=Math.sin(c),w=Math.cos(c),C=[],R=[],N=[];for(let z=0;z<this.symbolInstances.length;++z){N.push(z);let V=this.symbolInstances.get(z);C.push(0|Math.round(y*V.anchorX+w*V.anchorY)),R.push(V.featureIndex)}return N.sort((z,V)=>C[z]-C[V]||R[V]-R[z]),N}addToSortKeyRanges(c,y){let w=this.sortKeyRanges[this.sortKeyRanges.length-1];w&&w.sortKey===y?w.symbolInstanceEnd=c+1:this.sortKeyRanges.push({sortKey:y,symbolInstanceStart:c,symbolInstanceEnd:c+1})}sortFeatures(c){if(this.sortFeaturesByY&&this.sortedAngle!==c&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(c),this.sortedAngle=c,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let y of this.symbolInstanceIndexes){let w=this.symbolInstances.get(y);this.featureSortOrder.push(w.featureIndex),[w.rightJustifiedTextSymbolIndex,w.centerJustifiedTextSymbolIndex,w.leftJustifiedTextSymbolIndex].forEach((C,R,N)=>{C>=0&&N.indexOf(C)===R&&this.addIndicesForPlacedSymbol(this.text,C)}),w.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,w.verticalPlacedTextSymbolIndex),w.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,w.placedIconSymbolIndex),w.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,w.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let UC,zC;Zt("SymbolBucket",cf,{omit:["layers","collisionBoxArray","features","compareText"]}),cf.MAX_GLYPHS=65535,cf.addDynamicAttributes=Hv;var Xv={get paint(){return zC=zC||new oo({"icon-opacity":new Ci(Se.paint_symbol["icon-opacity"]),"icon-color":new Ci(Se.paint_symbol["icon-color"]),"icon-halo-color":new Ci(Se.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ci(Se.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ci(Se.paint_symbol["icon-halo-blur"]),"icon-translate":new di(Se.paint_symbol["icon-translate"]),"icon-translate-anchor":new di(Se.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ci(Se.paint_symbol["text-opacity"]),"text-color":new Ci(Se.paint_symbol["text-color"],{runtimeType:Zi,getOverride:p=>p.textColor,hasOverride:p=>!!p.textColor}),"text-halo-color":new Ci(Se.paint_symbol["text-halo-color"]),"text-halo-width":new Ci(Se.paint_symbol["text-halo-width"]),"text-halo-blur":new Ci(Se.paint_symbol["text-halo-blur"]),"text-translate":new di(Se.paint_symbol["text-translate"]),"text-translate-anchor":new di(Se.paint_symbol["text-translate-anchor"])})},get layout(){return UC=UC||new oo({"symbol-placement":new di(Se.layout_symbol["symbol-placement"]),"symbol-spacing":new di(Se.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new di(Se.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ci(Se.layout_symbol["symbol-sort-key"]),"symbol-z-order":new di(Se.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new di(Se.layout_symbol["icon-allow-overlap"]),"icon-overlap":new di(Se.layout_symbol["icon-overlap"]),"icon-ignore-placement":new di(Se.layout_symbol["icon-ignore-placement"]),"icon-optional":new di(Se.layout_symbol["icon-optional"]),"icon-rotation-alignment":new di(Se.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ci(Se.layout_symbol["icon-size"]),"icon-text-fit":new di(Se.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new di(Se.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ci(Se.layout_symbol["icon-image"]),"icon-rotate":new Ci(Se.layout_symbol["icon-rotate"]),"icon-padding":new Ci(Se.layout_symbol["icon-padding"]),"icon-keep-upright":new di(Se.layout_symbol["icon-keep-upright"]),"icon-offset":new Ci(Se.layout_symbol["icon-offset"]),"icon-anchor":new Ci(Se.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new di(Se.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new di(Se.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new di(Se.layout_symbol["text-rotation-alignment"]),"text-field":new Ci(Se.layout_symbol["text-field"]),"text-font":new Ci(Se.layout_symbol["text-font"]),"text-size":new Ci(Se.layout_symbol["text-size"]),"text-max-width":new Ci(Se.layout_symbol["text-max-width"]),"text-line-height":new di(Se.layout_symbol["text-line-height"]),"text-letter-spacing":new Ci(Se.layout_symbol["text-letter-spacing"]),"text-justify":new Ci(Se.layout_symbol["text-justify"]),"text-radial-offset":new Ci(Se.layout_symbol["text-radial-offset"]),"text-variable-anchor":new di(Se.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ci(Se.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ci(Se.layout_symbol["text-anchor"]),"text-max-angle":new di(Se.layout_symbol["text-max-angle"]),"text-writing-mode":new di(Se.layout_symbol["text-writing-mode"]),"text-rotate":new Ci(Se.layout_symbol["text-rotate"]),"text-padding":new di(Se.layout_symbol["text-padding"]),"text-keep-upright":new di(Se.layout_symbol["text-keep-upright"]),"text-transform":new Ci(Se.layout_symbol["text-transform"]),"text-offset":new Ci(Se.layout_symbol["text-offset"]),"text-allow-overlap":new di(Se.layout_symbol["text-allow-overlap"]),"text-overlap":new di(Se.layout_symbol["text-overlap"]),"text-ignore-placement":new di(Se.layout_symbol["text-ignore-placement"]),"text-optional":new di(Se.layout_symbol["text-optional"])})}};class GC{constructor(c){if(c.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=c.property.overrides?c.property.overrides.runtimeType:hi,this.defaultValue=c}evaluate(c){if(c.formattedSection){let y=this.defaultValue.property.overrides;if(y&&y.hasOverride(c.formattedSection))return y.getOverride(c.formattedSection)}return c.feature&&c.featureState?this.defaultValue.evaluate(c.feature,c.featureState):this.defaultValue.property.specification.default}eachChild(c){this.defaultValue.isConstant()||c(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt("FormatSectionOverride",GC,{omit:["defaultValue"]});class o9 extends ll{constructor(c){super(c,Xv)}recalculate(c,y){if(super.recalculate(c,y),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let w=this.layout.get("text-writing-mode");if(w){let C=[];for(let R of w)C.indexOf(R)<0&&C.push(R);this.layout._values["text-writing-mode"]=C}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(c,y,w,C){let R=this.layout.get(c).evaluate(y,{},w,C),N=this._unevaluatedLayout._values[c];return N.isDataDriven()||N0(N.value)||!R?R:function(z,V){return V.replace(/{([^{}]+)}/g,(K,se)=>se in z?String(z[se]):"")}(y.properties,R)}createBucket(c){return new cf(c)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let c of Xv.paint.overridableProperties){if(!o9.hasPaintOverride(this.layout,c))continue;let y=this.paint.get(c),w=new GC(y),C=new _s(w,y.property.specification),R=null;R=y.value.kind==="constant"||y.value.kind==="source"?new Ih("source",C):new Yr("composite",C,y.value.zoomStops),this.paint._values[c]=new ka(y.property,R,y.parameters)}}_handleOverridablePaintPropertyUpdate(c,y,w){return!(!this.layout||y.isDataDriven()||w.isDataDriven())&&o9.hasPaintOverride(this.layout,c)}static hasPaintOverride(c,y){let w=c.get("text-field"),C=Xv.paint.properties[y],R=!1,N=z=>{for(let V of z)if(C.overrides&&C.overrides.hasOverride(V))return void(R=!0)};if(w.value.kind==="constant"&&w.value.value instanceof Is)N(w.value.value.sections);else if(w.value.kind==="source"){let z=K=>{R||(K instanceof eu&&ks(K.value)===Lt?N(K.value.sections):K instanceof F0?N(K.sections):K.eachChild(z))},V=w.value;V._styleExpression&&z(V._styleExpression.expression)}return R}}let $C;var Wz={get paint(){return $C=$C||new oo({"background-color":new di(Se.paint_background["background-color"]),"background-pattern":new zp(Se.paint_background["background-pattern"]),"background-opacity":new di(Se.paint_background["background-opacity"])})}};class qz extends ll{constructor(c){super(c,Wz)}}let HC;var Yz={get paint(){return HC=HC||new oo({"raster-opacity":new di(Se.paint_raster["raster-opacity"]),"raster-hue-rotate":new di(Se.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new di(Se.paint_raster["raster-brightness-min"]),"raster-brightness-max":new di(Se.paint_raster["raster-brightness-max"]),"raster-saturation":new di(Se.paint_raster["raster-saturation"]),"raster-contrast":new di(Se.paint_raster["raster-contrast"]),"raster-resampling":new di(Se.paint_raster["raster-resampling"]),"raster-fade-duration":new di(Se.paint_raster["raster-fade-duration"])})}};class Zz extends ll{constructor(c){super(c,Yz)}}class Qz extends ll{constructor(c){super(c,{}),this.onAdd=y=>{this.implementation.onAdd&&this.implementation.onAdd(y,y.painter.context.gl)},this.onRemove=y=>{this.implementation.onRemove&&this.implementation.onRemove(y,y.painter.context.gl)},this.implementation=c}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Kz{constructor(c){this._callback=c,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}let Wv=63710088e-1;class w1{constructor(c,y){if(isNaN(c)||isNaN(y))throw new Error(`Invalid LngLat object: (${c}, ${y})`);if(this.lng=+c,this.lat=+y,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new w1(b(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(c){let y=Math.PI/180,w=this.lat*y,C=c.lat*y,R=Math.sin(w)*Math.sin(C)+Math.cos(w)*Math.cos(C)*Math.cos((c.lng-this.lng)*y);return Wv*Math.acos(Math.min(R,1))}static convert(c){if(c instanceof w1)return c;if(Array.isArray(c)&&(c.length===2||c.length===3))return new w1(Number(c[0]),Number(c[1]));if(!Array.isArray(c)&&typeof c=="object"&&c!==null)return new w1(Number("lng"in c?c.lng:c.lon),Number(c.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let VC=2*Math.PI*Wv;function jC(p){return VC*Math.cos(p*Math.PI/180)}function XC(p){return(180+p)/360}function WC(p){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+p*Math.PI/360)))/360}function qC(p,c){return p/jC(c)}function qv(p){return 360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90}class a9{constructor(c,y,w=0){this.x=+c,this.y=+y,this.z=+w}static fromLngLat(c,y=0){let w=w1.convert(c);return new a9(XC(w.lng),WC(w.lat),qC(y,w.lat))}toLngLat(){return new w1(360*this.x-180,qv(this.y))}toAltitude(){return this.z*jC(qv(this.y))}meterInMercatorCoordinateUnits(){return 1/VC*(c=qv(this.y),1/Math.cos(c*Math.PI/180));var c}}function YC(p,c,y){var w=2*Math.PI*6378137/256/Math.pow(2,y);return[p*w-2*Math.PI*6378137/2,c*w-2*Math.PI*6378137/2]}class Yv{constructor(c,y,w){if(c<0||c>25||w<0||w>=Math.pow(2,c)||y<0||y>=Math.pow(2,c))throw new Error(`x=${y}, y=${w}, z=${c} outside of bounds. 0<=x<${Math.pow(2,c)}, 0<=y<${Math.pow(2,c)} 0<=z<=25 `);this.z=c,this.x=y,this.y=w,this.key=o3(0,c,c,y,w)}equals(c){return this.z===c.z&&this.x===c.x&&this.y===c.y}url(c,y,w){let C=(N=this.y,z=this.z,V=YC(256*(R=this.x),256*(N=Math.pow(2,z)-N-1),z),K=YC(256*(R+1),256*(N+1),z),V[0]+","+V[1]+","+K[0]+","+K[1]);var R,N,z,V,K;let se=function(ue,fe,ve){let we,ke="";for(let Le=ue;Le>0;Le--)we=1<<Le-1,ke+=(fe&we?1:0)+(ve&we?2:0);return ke}(this.z,this.x,this.y);return c[(this.x+this.y)%c.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(w==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,y>1?"@2x":"").replace(/{quadkey}/g,se).replace(/{bbox-epsg-3857}/g,C)}isChildOf(c){let y=this.z-c.z;return y>0&&c.x===this.x>>y&&c.y===this.y>>y}getTilePoint(c){let y=Math.pow(2,this.z);return new u((c.x*y-this.x)*xs,(c.y*y-this.y)*xs)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ZC{constructor(c,y){this.wrap=c,this.canonical=y,this.key=o3(c,y.z,y.z,y.x,y.y)}}class Da{constructor(c,y,w,C,R){if(c<w)throw new Error(`overscaledZ should be >= z; overscaledZ = ${c}; z = ${w}`);this.overscaledZ=c,this.wrap=y,this.canonical=new Yv(w,+C,+R),this.key=o3(y,c,w,C,R)}clone(){return new Da(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(c){return this.overscaledZ===c.overscaledZ&&this.wrap===c.wrap&&this.canonical.equals(c.canonical)}scaledTo(c){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);let y=this.canonical.z-c;return c>this.canonical.z?new Da(c,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Da(c,this.wrap,c,this.canonical.x>>y,this.canonical.y>>y)}calculateScaledKey(c,y){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);let w=this.canonical.z-c;return c>this.canonical.z?o3(this.wrap*+y,c,this.canonical.z,this.canonical.x,this.canonical.y):o3(this.wrap*+y,c,c,this.canonical.x>>w,this.canonical.y>>w)}isChildOf(c){if(c.wrap!==this.wrap)return!1;let y=this.canonical.z-c.canonical.z;return c.overscaledZ===0||c.overscaledZ<this.overscaledZ&&c.canonical.x===this.canonical.x>>y&&c.canonical.y===this.canonical.y>>y}children(c){if(this.overscaledZ>=c)return[new Da(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let y=this.canonical.z+1,w=2*this.canonical.x,C=2*this.canonical.y;return[new Da(y,this.wrap,y,w,C),new Da(y,this.wrap,y,w+1,C),new Da(y,this.wrap,y,w,C+1),new Da(y,this.wrap,y,w+1,C+1)]}isLessThan(c){return this.wrap<c.wrap||!(this.wrap>c.wrap)&&(this.overscaledZ<c.overscaledZ||!(this.overscaledZ>c.overscaledZ)&&(this.canonical.x<c.canonical.x||!(this.canonical.x>c.canonical.x)&&this.canonical.y<c.canonical.y))}wrapped(){return new Da(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(c){return new Da(this.overscaledZ,c,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ZC(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(c){return this.canonical.getTilePoint(new a9(c.x-this.wrap,c.y))}}function o3(p,c,y,w,C){(p*=2)<0&&(p=-1*p-1);let R=1<<y;return(R*R*p+R*C+w).toString(36)+y.toString(36)+c.toString(36)}Zt("CanonicalTileID",Yv),Zt("OverscaledTileID",Da,{omit:["posMatrix"]});class QC{constructor(c,y,w){if(this.uid=c,y.height!==y.width)throw new RangeError("DEM tiles must be square");if(w&&w!=="mapbox"&&w!=="terrarium")return void B(`"${w}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=y.height;let C=this.dim=y.height-2;this.data=new Uint32Array(y.data.buffer),this.encoding=w||"mapbox";for(let R=0;R<C;R++)this.data[this._idx(-1,R)]=this.data[this._idx(0,R)],this.data[this._idx(C,R)]=this.data[this._idx(C-1,R)],this.data[this._idx(R,-1)]=this.data[this._idx(R,0)],this.data[this._idx(R,C)]=this.data[this._idx(R,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let R=0;R<C;R++)for(let N=0;N<C;N++){let z=this.get(R,N);z>this.max&&(this.max=z),z<this.min&&(this.min=z)}}get(c,y){let w=new Uint8Array(this.data.buffer),C=4*this._idx(c,y);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(w[C],w[C+1],w[C+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(c,y){if(c<-1||c>=this.dim+1||y<-1||y>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(y+1)*this.stride+(c+1)}_unpackMapbox(c,y,w){return(256*c*256+256*y+w)/10-1e4}_unpackTerrarium(c,y,w){return 256*c+y+w/256-32768}getPixels(){return new Ra({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(c,y,w){if(this.dim!==c.dim)throw new Error("dem dimension mismatch");let C=y*this.dim,R=y*this.dim+this.dim,N=w*this.dim,z=w*this.dim+this.dim;switch(y){case-1:C=R-1;break;case 1:R=C+1}switch(w){case-1:N=z-1;break;case 1:z=N+1}let V=-y*this.dim,K=-w*this.dim;for(let se=N;se<z;se++)for(let ue=C;ue<R;ue++)this.data[this._idx(ue,se)]=c.data[this._idx(ue+V,se+K)]}}Zt("DEMData",QC);class KC{constructor(c){this._stringToNumber={},this._numberToString=[];for(let y=0;y<c.length;y++){let w=c[y];this._stringToNumber[w]=y,this._numberToString[y]=w}}encode(c){return this._stringToNumber[c]}decode(c){if(c>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${c} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[c]}}class JC{constructor(c,y,w,C,R){this.type="Feature",this._vectorTileFeature=c,c._z=y,c._x=w,c._y=C,this.properties=c.properties,this.id=R}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(c){this._geometry=c}toJSON(){let c={geometry:this.geometry};for(let y in this)y!=="_geometry"&&y!=="_vectorTileFeature"&&(c[y]=this[y]);return c}}class eI{constructor(c,y){this.tileID=c,this.x=c.canonical.x,this.y=c.canonical.y,this.z=c.canonical.z,this.grid=new Uh(xs,16,0),this.grid3D=new Uh(xs,16,0),this.featureIndexArray=new Ve,this.promoteId=y}insert(c,y,w,C,R,N){let z=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(w,C,R);let V=N?this.grid3D:this.grid;for(let K=0;K<y.length;K++){let se=y[K],ue=[1/0,1/0,-1/0,-1/0];for(let fe=0;fe<se.length;fe++){let ve=se[fe];ue[0]=Math.min(ue[0],ve.x),ue[1]=Math.min(ue[1],ve.y),ue[2]=Math.max(ue[2],ve.x),ue[3]=Math.max(ue[3],ve.y)}ue[0]<xs&&ue[1]<xs&&ue[2]>=0&&ue[3]>=0&&V.insert(z,ue[0],ue[1],ue[2],ue[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new x1.VectorTile(new Ov(this.rawTileData)).layers,this.sourceLayerCoder=new KC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(c,y,w,C){this.loadVTLayers();let R=c.params||{},N=xs/c.tileSize/c.scale,z=Sp(R.filter),V=c.queryGeometry,K=c.queryPadding*N,se=iI(V),ue=this.grid.query(se.minX-K,se.minY-K,se.maxX+K,se.maxY+K),fe=iI(c.cameraQueryGeometry),ve=this.grid3D.query(fe.minX-K,fe.minY-K,fe.maxX+K,fe.maxY+K,(Le,Be,qe,$e)=>function(et,it,pt,Xt,ai){for(let zt of et)if(it<=zt.x&&pt<=zt.y&&Xt>=zt.x&&ai>=zt.y)return!0;let jt=[new u(it,pt),new u(it,ai),new u(Xt,ai),new u(Xt,pt)];if(et.length>2){for(let zt of jt)if(tf(et,zt))return!0}for(let zt=0;zt<et.length-1;zt++)if(MU(et[zt],et[zt+1],jt))return!0;return!1}(c.cameraQueryGeometry,Le-K,Be-K,qe+K,$e+K));for(let Le of ve)ue.push(Le);ue.sort(Jz);let we={},ke;for(let Le=0;Le<ue.length;Le++){let Be=ue[Le];if(Be===ke)continue;ke=Be;let qe=this.featureIndexArray.get(Be),$e=null;this.loadMatchingFeature(we,qe.bucketIndex,qe.sourceLayerIndex,qe.featureIndex,z,R.layers,R.availableImages,y,w,C,(et,it,pt)=>($e||($e=zl(et)),it.queryIntersectsFeature(V,et,pt,$e,this.z,c.transform,N,c.pixelPosMatrix)))}return we}loadMatchingFeature(c,y,w,C,R,N,z,V,K,se,ue){let fe=this.bucketLayerIDs[y];if(N&&!function(Le,Be){for(let qe=0;qe<Le.length;qe++)if(Be.indexOf(Le[qe])>=0)return!0;return!1}(N,fe))return;let ve=this.sourceLayerCoder.decode(w),we=this.vtLayers[ve].feature(C);if(R.needGeometry){let Le=wc(we,!0);if(!R.filter(new ts(this.tileID.overscaledZ),Le,this.tileID.canonical))return}else if(!R.filter(new ts(this.tileID.overscaledZ),we))return;let ke=this.getId(we,ve);for(let Le=0;Le<fe.length;Le++){let Be=fe[Le];if(N&&N.indexOf(Be)<0)continue;let qe=V[Be];if(!qe)continue;let $e={};ke&&se&&($e=se.getState(qe.sourceLayer||"_geojsonTileLayer",ke));let et=T({},K[Be]);et.paint=tI(et.paint,qe.paint,we,$e,z),et.layout=tI(et.layout,qe.layout,we,$e,z);let it=!ue||ue(we,qe,$e);if(!it)continue;let pt=new JC(we,this.z,this.x,this.y,ke);pt.layer=et;let Xt=c[Be];Xt===void 0&&(Xt=c[Be]=[]),Xt.push({featureIndex:C,feature:pt,intersectionZ:it})}}lookupSymbolFeatures(c,y,w,C,R,N,z,V){let K={};this.loadVTLayers();let se=Sp(R);for(let ue of c)this.loadMatchingFeature(K,w,C,ue,se,N,z,V,y);return K}hasLayer(c){for(let y of this.bucketLayerIDs)for(let w of y)if(c===w)return!0;return!1}getId(c,y){let w=c.id;return this.promoteId&&(w=c.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[y]],typeof w=="boolean"&&(w=Number(w))),w}}function tI(p,c,y,w,C){return M(p,(R,N)=>{let z=c instanceof Vh?c.get(N):null;return z&&z.evaluate?z.evaluate(y,w,C):z})}function iI(p){let c=1/0,y=1/0,w=-1/0,C=-1/0;for(let R of p)c=Math.min(c,R.x),y=Math.min(y,R.y),w=Math.max(w,R.x),C=Math.max(C,R.y);return{minX:c,minY:y,maxX:w,maxY:C}}function Jz(p,c){return c-p}function rI(p,c,y,w,C){let R=[];for(let N=0;N<p.length;N++){let z=p[N],V;for(let K=0;K<z.length-1;K++){let se=z[K],ue=z[K+1];se.x<c&&ue.x<c||(se.x<c?se=new u(c,se.y+(c-se.x)/(ue.x-se.x)*(ue.y-se.y))._round():ue.x<c&&(ue=new u(c,se.y+(c-se.x)/(ue.x-se.x)*(ue.y-se.y))._round()),se.y<y&&ue.y<y||(se.y<y?se=new u(se.x+(y-se.y)/(ue.y-se.y)*(ue.x-se.x),y)._round():ue.y<y&&(ue=new u(se.x+(y-se.y)/(ue.y-se.y)*(ue.x-se.x),y)._round()),se.x>=w&&ue.x>=w||(se.x>=w?se=new u(w,se.y+(w-se.x)/(ue.x-se.x)*(ue.y-se.y))._round():ue.x>=w&&(ue=new u(w,se.y+(w-se.x)/(ue.x-se.x)*(ue.y-se.y))._round()),se.y>=C&&ue.y>=C||(se.y>=C?se=new u(se.x+(C-se.y)/(ue.y-se.y)*(ue.x-se.x),C)._round():ue.y>=C&&(ue=new u(se.x+(C-se.y)/(ue.y-se.y)*(ue.x-se.x),C)._round()),V&&se.equals(V[V.length-1])||(V=[se],R.push(V)),V.push(ue)))))}}return R}Zt("FeatureIndex",eI,{omit:["rawTileData","sourceLayerCoder"]});class E1 extends u{constructor(c,y,w,C){super(c,y),this.angle=w,C!==void 0&&(this.segment=C)}clone(){return new E1(this.x,this.y,this.angle,this.segment)}}function sI(p,c,y,w,C){if(c.segment===void 0||y===0)return!0;let R=c,N=c.segment+1,z=0;for(;z>-y/2;){if(N--,N<0)return!1;z-=p[N].dist(R),R=p[N]}z+=p[N].dist(p[N+1]),N++;let V=[],K=0;for(;z<y/2;){let se=p[N],ue=p[N+1];if(!ue)return!1;let fe=p[N-1].angleTo(se)-se.angleTo(ue);for(fe=Math.abs((fe+3*Math.PI)%(2*Math.PI)-Math.PI),V.push({distance:z,angleDelta:fe}),K+=fe;z-V[0].distance>w;)K-=V.shift().angleDelta;if(K>C)return!1;N++,z+=se.dist(ue)}return!0}function nI(p){let c=0;for(let y=0;y<p.length-1;y++)c+=p[y].dist(p[y+1]);return c}function oI(p,c,y){return p?.6*c*y:0}function aI(p,c){return Math.max(p?p.right-p.left:0,c?c.right-c.left:0)}function eG(p,c,y,w,C,R){let N=oI(y,C,R),z=aI(y,w)*R,V=0,K=nI(p)/2;for(let se=0;se<p.length-1;se++){let ue=p[se],fe=p[se+1],ve=ue.dist(fe);if(V+ve>K){let we=(K-V)/ve,ke=To.number(ue.x,fe.x,we),Le=To.number(ue.y,fe.y,we),Be=new E1(ke,Le,fe.angleTo(ue),se);return Be._round(),!N||sI(p,Be,z,N,c)?Be:void 0}V+=ve}}function tG(p,c,y,w,C,R,N,z,V){let K=oI(w,R,N),se=aI(w,C),ue=se*N,fe=p[0].x===0||p[0].x===V||p[0].y===0||p[0].y===V;return c-ue<c/4&&(c=ue+c/4),lI(p,fe?c/2*z%c:(se/2+2*R)*N*z%c,c,K,y,ue,fe,!1,V)}function lI(p,c,y,w,C,R,N,z,V){let K=R/2,se=nI(p),ue=0,fe=c-y,ve=[];for(let we=0;we<p.length-1;we++){let ke=p[we],Le=p[we+1],Be=ke.dist(Le),qe=Le.angleTo(ke);for(;fe+y<ue+Be;){fe+=y;let $e=(fe-ue)/Be,et=To.number(ke.x,Le.x,$e),it=To.number(ke.y,Le.y,$e);if(et>=0&&et<V&&it>=0&&it<V&&fe-K>=0&&fe+K<=se){let pt=new E1(et,it,qe,we);pt._round(),w&&!sI(p,pt,R,w,C)||ve.push(pt)}}ue+=Be}return z||ve.length||N||(ve=lI(p,ue/2,y,w,C,R,N,!0,V)),ve}Zt("Anchor",E1);let uf=Io;function cI(p,c,y,w){let C=[],R=p.image,N=R.pixelRatio,z=R.paddedRect.w-2*uf,V=R.paddedRect.h-2*uf,K=p.right-p.left,se=p.bottom-p.top,ue=R.stretchX||[[0,z]],fe=R.stretchY||[[0,V]],ve=(Rt,Qt)=>Rt+Qt[1]-Qt[0],we=ue.reduce(ve,0),ke=fe.reduce(ve,0),Le=z-we,Be=V-ke,qe=0,$e=we,et=0,it=ke,pt=0,Xt=Le,ai=0,jt=Be;if(R.content&&w){let Rt=R.content;qe=l9(ue,0,Rt[0]),et=l9(fe,0,Rt[1]),$e=l9(ue,Rt[0],Rt[2]),it=l9(fe,Rt[1],Rt[3]),pt=Rt[0]-qe,ai=Rt[1]-et,Xt=Rt[2]-Rt[0]-$e,jt=Rt[3]-Rt[1]-it}let zt=(Rt,Qt,Nt,Ct)=>{let xi=c9(Rt.stretch-qe,$e,K,p.left),ci=u9(Rt.fixed-pt,Xt,Rt.stretch,we),sr=c9(Qt.stretch-et,it,se,p.top),Qr=u9(Qt.fixed-ai,jt,Qt.stretch,ke),rs=c9(Nt.stretch-qe,$e,K,p.left),ln=u9(Nt.fixed-pt,Xt,Nt.stretch,we),ca=c9(Ct.stretch-et,it,se,p.top),co=u9(Ct.fixed-ai,jt,Ct.stretch,ke),Xs=new u(xi,sr),yn=new u(rs,sr),Bn=new u(rs,ca),ko=new u(xi,ca),uo=new u(ci/N,Qr/N),Ws=new u(ln/N,co/N),cn=c*Math.PI/180;if(cn){let Mo=Math.sin(cn),Po=Math.cos(cn),Ss=[Po,-Mo,Mo,Po];Xs._matMult(Ss),yn._matMult(Ss),ko._matMult(Ss),Bn._matMult(Ss)}let Wn=Rt.stretch+Rt.fixed,ho=Qt.stretch+Qt.fixed;return{tl:Xs,tr:yn,bl:ko,br:Bn,tex:{x:R.paddedRect.x+uf+Wn,y:R.paddedRect.y+uf+ho,w:Nt.stretch+Nt.fixed-Wn,h:Ct.stretch+Ct.fixed-ho},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:uo,pixelOffsetBR:Ws,minFontScaleX:Xt/N/K,minFontScaleY:jt/N/se,isSDF:y}};if(w&&(R.stretchX||R.stretchY)){let Rt=uI(ue,Le,we),Qt=uI(fe,Be,ke);for(let Nt=0;Nt<Rt.length-1;Nt++){let Ct=Rt[Nt],xi=Rt[Nt+1];for(let ci=0;ci<Qt.length-1;ci++)C.push(zt(Ct,Qt[ci],xi,Qt[ci+1]))}}else C.push(zt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:z+1},{fixed:0,stretch:V+1}));return C}function l9(p,c,y){let w=0;for(let C of p)w+=Math.max(c,Math.min(y,C[1]))-Math.max(c,Math.min(y,C[0]));return w}function uI(p,c,y){let w=[{fixed:-uf,stretch:0}];for(let[C,R]of p){let N=w[w.length-1];w.push({fixed:C-N.stretch,stretch:N.stretch}),w.push({fixed:C-N.stretch,stretch:N.stretch+(R-C)})}return w.push({fixed:c+uf,stretch:y}),w}function c9(p,c,y,w){return p/c*y+w}function u9(p,c,y,w){return p-c*y/w}class h9{constructor(c,y,w,C,R,N,z,V,K,se){if(this.boxStartIndex=c.length,K){let ue=N.top,fe=N.bottom,ve=N.collisionPadding;ve&&(ue-=ve[1],fe+=ve[3]);let we=fe-ue;we>0&&(we=Math.max(10,we),this.circleDiameter=we)}else{let ue=N.top*z-V[0],fe=N.bottom*z+V[2],ve=N.left*z-V[3],we=N.right*z+V[1],ke=N.collisionPadding;if(ke&&(ve-=ke[0]*z,ue-=ke[1]*z,we+=ke[2]*z,fe+=ke[3]*z),se){let Le=new u(ve,ue),Be=new u(we,ue),qe=new u(ve,fe),$e=new u(we,fe),et=se*Math.PI/180;Le._rotate(et),Be._rotate(et),qe._rotate(et),$e._rotate(et),ve=Math.min(Le.x,Be.x,qe.x,$e.x),we=Math.max(Le.x,Be.x,qe.x,$e.x),ue=Math.min(Le.y,Be.y,qe.y,$e.y),fe=Math.max(Le.y,Be.y,qe.y,$e.y)}c.emplaceBack(y.x,y.y,ve,ue,we,fe,w,C,R)}this.boxEndIndex=c.length}}class iG{constructor(c=[],y=rG){if(this.data=c,this.length=this.data.length,this.compare=y,this.length>0)for(let w=(this.length>>1)-1;w>=0;w--)this._down(w)}push(c){this.data.push(c),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;let c=this.data[0],y=this.data.pop();return this.length--,this.length>0&&(this.data[0]=y,this._down(0)),c}peek(){return this.data[0]}_up(c){let{data:y,compare:w}=this,C=y[c];for(;c>0;){let R=c-1>>1,N=y[R];if(w(C,N)>=0)break;y[c]=N,c=R}y[c]=C}_down(c){let{data:y,compare:w}=this,C=this.length>>1,R=y[c];for(;c<C;){let N=1+(c<<1),z=y[N],V=N+1;if(V<this.length&&w(y[V],z)<0&&(N=V,z=y[V]),w(z,R)>=0)break;y[c]=z,c=N}y[c]=R}}function rG(p,c){return p<c?-1:p>c?1:0}function sG(p,c=1,y=!1){let w=1/0,C=1/0,R=-1/0,N=-1/0,z=p[0];for(let ve=0;ve<z.length;ve++){let we=z[ve];(!ve||we.x<w)&&(w=we.x),(!ve||we.y<C)&&(C=we.y),(!ve||we.x>R)&&(R=we.x),(!ve||we.y>N)&&(N=we.y)}let V=Math.min(R-w,N-C),K=V/2,se=new iG([],nG);if(V===0)return new u(w,C);for(let ve=w;ve<R;ve+=V)for(let we=C;we<N;we+=V)se.push(new hf(ve+K,we+K,K,p));let ue=function(ve){let we=0,ke=0,Le=0,Be=ve[0];for(let qe=0,$e=Be.length,et=$e-1;qe<$e;et=qe++){let it=Be[qe],pt=Be[et],Xt=it.x*pt.y-pt.x*it.y;ke+=(it.x+pt.x)*Xt,Le+=(it.y+pt.y)*Xt,we+=3*Xt}return new hf(ke/we,Le/we,0,ve)}(p),fe=se.length;for(;se.length;){let ve=se.pop();(ve.d>ue.d||!ue.d)&&(ue=ve,y&&console.log("found best %d after %d probes",Math.round(1e4*ve.d)/1e4,fe)),ve.max-ue.d<=c||(K=ve.h/2,se.push(new hf(ve.p.x-K,ve.p.y-K,K,p)),se.push(new hf(ve.p.x+K,ve.p.y-K,K,p)),se.push(new hf(ve.p.x-K,ve.p.y+K,K,p)),se.push(new hf(ve.p.x+K,ve.p.y+K,K,p)),fe+=4)}return y&&(console.log(`num probes: ${fe}`),console.log(`best distance: ${ue.d}`)),ue.p}function nG(p,c){return c.max-p.max}function hf(p,c,y,w){this.p=new u(p,c),this.h=y,this.d=function(C,R){let N=!1,z=1/0;for(let V=0;V<R.length;V++){let K=R[V];for(let se=0,ue=K.length,fe=ue-1;se<ue;fe=se++){let ve=K[se],we=K[fe];ve.y>C.y!=we.y>C.y&&C.x<(we.x-ve.x)*(C.y-ve.y)/(we.y-ve.y)+ve.x&&(N=!N),z=Math.min(z,WA(C,ve,we))}}return(N?1:-1)*Math.sqrt(z)}(this.p,w),this.max=this.d+this.h*Math.SQRT2}var On;n.TextAnchorEnum=void 0,(On=n.TextAnchorEnum||(n.TextAnchorEnum={}))[On.center=1]="center",On[On.left=2]="left",On[On.right=3]="right",On[On.top=4]="top",On[On.bottom=5]="bottom",On[On["top-left"]=6]="top-left",On[On["top-right"]=7]="top-right",On[On["bottom-left"]=8]="bottom-left",On[On["bottom-right"]=9]="bottom-right";let T1=7,Zv=Number.POSITIVE_INFINITY;function hI(p,c){return c[1]!==Zv?function(y,w,C){let R=0,N=0;switch(w=Math.abs(w),C=Math.abs(C),y){case"top-right":case"top-left":case"top":N=C-T1;break;case"bottom-right":case"bottom-left":case"bottom":N=-C+T1}switch(y){case"top-right":case"bottom-right":case"right":R=-w;break;case"top-left":case"bottom-left":case"left":R=w}return[R,N]}(p,c[0],c[1]):function(y,w){let C=0,R=0;w<0&&(w=0);let N=w/Math.SQRT2;switch(y){case"top-right":case"top-left":R=N-T1;break;case"bottom-right":case"bottom-left":R=-N+T1;break;case"bottom":R=-w+T1;break;case"top":R=w-T1}switch(y){case"top-right":case"bottom-right":C=-N;break;case"top-left":case"bottom-left":C=N;break;case"left":C=w;break;case"right":C=-w}return[C,R]}(p,c[0])}function dI(p,c,y){var w;let C=p.layout,R=(w=C.get("text-variable-anchor-offset"))===null||w===void 0?void 0:w.evaluate(c,{},y);if(R){let z=R.values,V=[];for(let K=0;K<z.length;K+=2){let se=V[K]=z[K],ue=z[K+1].map(fe=>fe*an);se.startsWith("top")?ue[1]-=T1:se.startsWith("bottom")&&(ue[1]+=T1),V[K+1]=ue}return new Dn(V)}let N=C.get("text-variable-anchor");if(N){let z;z=p._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[C.get("text-radial-offset").evaluate(c,{},y)*an,Zv]:C.get("text-offset").evaluate(c,{},y).map(K=>K*an);let V=[];for(let K of N)V.push(K,hI(K,z));return new Dn(V)}return null}function Qv(p){switch(p){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function oG(p,c,y,w,C,R,N,z,V,K,se){let ue=R.textMaxSize.evaluate(c,{});ue===void 0&&(ue=N);let fe=p.layers[0].layout,ve=fe.get("icon-offset").evaluate(c,{},se),we=pI(y.horizontal),ke=N/24,Le=p.tilePixelRatio*ke,Be=p.tilePixelRatio*ue/24,qe=p.tilePixelRatio*z,$e=p.tilePixelRatio*fe.get("symbol-spacing"),et=fe.get("text-padding")*p.tilePixelRatio,it=function(Ct,xi,ci,sr=1){let Qr=Ct.get("icon-padding").evaluate(xi,{},ci),rs=Qr&&Qr.values;return[rs[0]*sr,rs[1]*sr,rs[2]*sr,rs[3]*sr]}(fe,c,se,p.tilePixelRatio),pt=fe.get("text-max-angle")/180*Math.PI,Xt=fe.get("text-rotation-alignment")!=="viewport"&&fe.get("symbol-placement")!=="point",ai=fe.get("icon-rotation-alignment")==="map"&&fe.get("symbol-placement")!=="point",jt=fe.get("symbol-placement"),zt=$e/2,Rt=fe.get("icon-text-fit"),Qt;w&&Rt!=="none"&&(p.allowVerticalPlacement&&y.vertical&&(Qt=OC(w,y.vertical,Rt,fe.get("icon-text-fit-padding"),ve,ke)),we&&(w=OC(w,we,Rt,fe.get("icon-text-fit-padding"),ve,ke)));let Nt=(Ct,xi)=>{xi.x<0||xi.x>=xs||xi.y<0||xi.y>=xs||function(ci,sr,Qr,rs,ln,ca,co,Xs,yn,Bn,ko,uo,Ws,cn,Wn,ho,Mo,Po,Ss,Un,dr,ua,zn,fo,hl){let Gl=ci.addToLineVertexArray(sr,Qr),$l,pu,dl,Fa,Ro=0,mu=0,c3=0,_I=0,nb=-1,ob=-1,gu={},xI=Ma("");if(ci.allowVerticalPlacement&&rs.vertical){let qn=Xs.layout.get("text-rotate").evaluate(dr,{},fo)+90;dl=new h9(yn,sr,Bn,ko,uo,rs.vertical,Ws,cn,Wn,qn),co&&(Fa=new h9(yn,sr,Bn,ko,uo,co,Mo,Po,Wn,qn))}if(ln){let qn=Xs.layout.get("icon-rotate").evaluate(dr,{}),La=Xs.layout.get("icon-text-fit")!=="none",Qh=cI(ln,qn,zn,La),Vl=co?cI(co,qn,zn,La):void 0;pu=new h9(yn,sr,Bn,ko,uo,ln,Mo,Po,!1,qn),Ro=4*Qh.length;let Kh=ci.iconSizeData,Tc=null;Kh.kind==="source"?(Tc=[Ec*Xs.layout.get("icon-size").evaluate(dr,{})],Tc[0]>b1&&B(`${ci.layerIds[0]}: Value for "icon-size" is >= ${n3}. Reduce your "icon-size".`)):Kh.kind==="composite"&&(Tc=[Ec*ua.compositeIconSizes[0].evaluate(dr,{},fo),Ec*ua.compositeIconSizes[1].evaluate(dr,{},fo)],(Tc[0]>b1||Tc[1]>b1)&&B(`${ci.layerIds[0]}: Value for "icon-size" is >= ${n3}. Reduce your "icon-size".`)),ci.addSymbols(ci.icon,Qh,Tc,Un,Ss,dr,n.WritingMode.none,sr,Gl.lineStartIndex,Gl.lineLength,-1,fo),nb=ci.icon.placedSymbolArray.length-1,Vl&&(mu=4*Vl.length,ci.addSymbols(ci.icon,Vl,Tc,Un,Ss,dr,n.WritingMode.vertical,sr,Gl.lineStartIndex,Gl.lineLength,-1,fo),ob=ci.icon.placedSymbolArray.length-1)}let vI=Object.keys(rs.horizontal);for(let qn of vI){let La=rs.horizontal[qn];if(!$l){xI=Ma(La.text);let Vl=Xs.layout.get("text-rotate").evaluate(dr,{},fo);$l=new h9(yn,sr,Bn,ko,uo,La,Ws,cn,Wn,Vl)}let Qh=La.positionedLines.length===1;if(c3+=fI(ci,sr,La,ca,Xs,Wn,dr,ho,Gl,rs.vertical?n.WritingMode.horizontal:n.WritingMode.horizontalOnly,Qh?vI:[qn],gu,nb,ua,fo),Qh)break}rs.vertical&&(_I+=fI(ci,sr,rs.vertical,ca,Xs,Wn,dr,ho,Gl,n.WritingMode.vertical,["vertical"],gu,ob,ua,fo));let cG=$l?$l.boxStartIndex:ci.collisionBoxArray.length,uG=$l?$l.boxEndIndex:ci.collisionBoxArray.length,hG=dl?dl.boxStartIndex:ci.collisionBoxArray.length,dG=dl?dl.boxEndIndex:ci.collisionBoxArray.length,fG=pu?pu.boxStartIndex:ci.collisionBoxArray.length,pG=pu?pu.boxEndIndex:ci.collisionBoxArray.length,mG=Fa?Fa.boxStartIndex:ci.collisionBoxArray.length,gG=Fa?Fa.boxEndIndex:ci.collisionBoxArray.length,Hl=-1,f9=(qn,La)=>qn&&qn.circleDiameter?Math.max(qn.circleDiameter,La):La;Hl=f9($l,Hl),Hl=f9(dl,Hl),Hl=f9(pu,Hl),Hl=f9(Fa,Hl);let bI=Hl>-1?1:0;bI&&(Hl*=hl/an),ci.glyphOffsetArray.length>=cf.MAX_GLYPHS&&B("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),dr.sortKey!==void 0&&ci.addToSortKeyRanges(ci.symbolInstances.length,dr.sortKey);let yG=dI(Xs,dr,fo),[_G,xG]=function(qn,La){let Qh=qn.length,Vl=La?.values;if(Vl?.length>0)for(let Kh=0;Kh<Vl.length;Kh+=2){let Tc=Vl[Kh+1];qn.emplaceBack(n.TextAnchorEnum[Vl[Kh]],Tc[0],Tc[1])}return[Qh,qn.length]}(ci.textAnchorOffsets,yG);ci.symbolInstances.emplaceBack(sr.x,sr.y,gu.right>=0?gu.right:-1,gu.center>=0?gu.center:-1,gu.left>=0?gu.left:-1,gu.vertical||-1,nb,ob,xI,cG,uG,hG,dG,fG,pG,mG,gG,Bn,c3,_I,Ro,mu,bI,0,Ws,Hl,_G,xG)}(p,xi,Ct,y,w,C,Qt,p.layers[0],p.collisionBoxArray,c.index,c.sourceLayerIndex,p.index,Le,[et,et,et,et],Xt,V,qe,it,ai,ve,c,R,K,se,N)};if(jt==="line")for(let Ct of rI(c.geometry,0,0,xs,xs)){let xi=tG(Ct,$e,pt,y.vertical||we,w,24,Be,p.overscaling,xs);for(let ci of xi)we&&aG(p,we.text,zt,ci)||Nt(Ct,ci)}else if(jt==="line-center"){for(let Ct of c.geometry)if(Ct.length>1){let xi=eG(Ct,pt,y.vertical||we,w,24,Be);xi&&Nt(Ct,xi)}}else if(c.type==="Polygon")for(let Ct of kv(c.geometry,0)){let xi=sG(Ct,16);Nt(Ct[0],new E1(xi.x,xi.y,0))}else if(c.type==="LineString")for(let Ct of c.geometry)Nt(Ct,new E1(Ct[0].x,Ct[0].y,0));else if(c.type==="Point")for(let Ct of c.geometry)for(let xi of Ct)Nt([xi],new E1(xi.x,xi.y,0))}function fI(p,c,y,w,C,R,N,z,V,K,se,ue,fe,ve,we){let ke=function(qe,$e,et,it,pt,Xt,ai,jt){let zt=it.layout.get("text-rotate").evaluate(Xt,{})*Math.PI/180,Rt=[];for(let Qt of $e.positionedLines)for(let Nt of Qt.positionedGlyphs){if(!Nt.rect)continue;let Ct=Nt.rect||{},xi=MC+1,ci=!0,sr=1,Qr=0,rs=(pt||jt)&&Nt.vertical,ln=Nt.metrics.advance*Nt.scale/2;if(jt&&$e.verticalizable&&(Qr=Qt.lineOffset/2-(Nt.imageName?-(an-Nt.metrics.width*Nt.scale)/2:(Nt.scale-1)*an)),Nt.imageName){let Ss=ai[Nt.imageName];ci=Ss.sdf,sr=Ss.pixelRatio,xi=Io/sr}let ca=pt?[Nt.x+ln,Nt.y]:[0,0],co=pt?[0,0]:[Nt.x+ln+et[0],Nt.y+et[1]-Qr],Xs=[0,0];rs&&(Xs=co,co=[0,0]);let yn=(Nt.metrics.left-xi)*Nt.scale-ln+co[0],Bn=(-Nt.metrics.top-xi)*Nt.scale+co[1],ko=yn+Ct.w*Nt.scale/sr,uo=Bn+Ct.h*Nt.scale/sr,Ws=new u(yn,Bn),cn=new u(ko,Bn),Wn=new u(yn,uo),ho=new u(ko,uo);if(rs){let Ss=new u(-ln,ln-r3),Un=-Math.PI/2,dr=an/2-ln,ua=new u(5-r3-dr,-(Nt.imageName?dr:0)),zn=new u(...Xs);Ws._rotateAround(Un,Ss)._add(ua)._add(zn),cn._rotateAround(Un,Ss)._add(ua)._add(zn),Wn._rotateAround(Un,Ss)._add(ua)._add(zn),ho._rotateAround(Un,Ss)._add(ua)._add(zn)}if(zt){let Ss=Math.sin(zt),Un=Math.cos(zt),dr=[Un,-Ss,Ss,Un];Ws._matMult(dr),cn._matMult(dr),Wn._matMult(dr),ho._matMult(dr)}let Mo=new u(0,0),Po=new u(0,0);Rt.push({tl:Ws,tr:cn,bl:Wn,br:ho,tex:Ct,writingMode:$e.writingMode,glyphOffset:ca,sectionIndex:Nt.sectionIndex,isSDF:ci,pixelOffsetTL:Mo,pixelOffsetBR:Po,minFontScaleX:0,minFontScaleY:0})}return Rt}(0,y,z,C,R,N,w,p.allowVerticalPlacement),Le=p.textSizeData,Be=null;Le.kind==="source"?(Be=[Ec*C.layout.get("text-size").evaluate(N,{})],Be[0]>b1&&B(`${p.layerIds[0]}: Value for "text-size" is >= ${n3}. Reduce your "text-size".`)):Le.kind==="composite"&&(Be=[Ec*ve.compositeTextSizes[0].evaluate(N,{},we),Ec*ve.compositeTextSizes[1].evaluate(N,{},we)],(Be[0]>b1||Be[1]>b1)&&B(`${p.layerIds[0]}: Value for "text-size" is >= ${n3}. Reduce your "text-size".`)),p.addSymbols(p.text,ke,Be,z,R,N,K,c,V.lineStartIndex,V.lineLength,fe,we);for(let qe of se)ue[qe]=p.text.placedSymbolArray.length-1;return 4*ke.length}function pI(p){for(let c in p)return p[c];return null}function aG(p,c,y,w){let C=p.compareText;if(c in C){let R=C[c];for(let N=R.length-1;N>=0;N--)if(w.dist(R[N])<y)return!0}else C[c]=[];return C[c].push(w),!1}let mI=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Kv{static from(c){if(!(c instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[y,w]=new Uint8Array(c,0,2);if(y!==219)throw new Error("Data does not appear to be in a KDBush format.");let C=w>>4;if(C!==1)throw new Error(`Got v${C} data when expected v1.`);let R=mI[15&w];if(!R)throw new Error("Unrecognized array type.");let[N]=new Uint16Array(c,2,1),[z]=new Uint32Array(c,4,1);return new Kv(z,N,R,c)}constructor(c,y=64,w=Float64Array,C){if(isNaN(c)||c<0)throw new Error(`Unpexpected numItems value: ${c}.`);this.numItems=+c,this.nodeSize=Math.min(Math.max(+y,2),65535),this.ArrayType=w,this.IndexArrayType=c<65536?Uint16Array:Uint32Array;let R=mI.indexOf(this.ArrayType),N=2*c*this.ArrayType.BYTES_PER_ELEMENT,z=c*this.IndexArrayType.BYTES_PER_ELEMENT,V=(8-z%8)%8;if(R<0)throw new Error(`Unexpected typed array class: ${w}.`);C&&C instanceof ArrayBuffer?(this.data=C,this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+z+V,2*c),this._pos=2*c,this._finished=!0):(this.data=new ArrayBuffer(8+N+z+V),this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+z+V,2*c),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+R]),new Uint16Array(this.data,2,1)[0]=y,new Uint32Array(this.data,4,1)[0]=c)}add(c,y){let w=this._pos>>1;return this.ids[w]=w,this.coords[this._pos++]=c,this.coords[this._pos++]=y,w}finish(){let c=this._pos>>1;if(c!==this.numItems)throw new Error(`Added ${c} items when expected ${this.numItems}.`);return Jv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(c,y,w,C){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:R,coords:N,nodeSize:z}=this,V=[0,R.length-1,0],K=[];for(;V.length;){let se=V.pop()||0,ue=V.pop()||0,fe=V.pop()||0;if(ue-fe<=z){for(let Le=fe;Le<=ue;Le++){let Be=N[2*Le],qe=N[2*Le+1];Be>=c&&Be<=w&&qe>=y&&qe<=C&&K.push(R[Le])}continue}let ve=fe+ue>>1,we=N[2*ve],ke=N[2*ve+1];we>=c&&we<=w&&ke>=y&&ke<=C&&K.push(R[ve]),(se===0?c<=we:y<=ke)&&(V.push(fe),V.push(ve-1),V.push(1-se)),(se===0?w>=we:C>=ke)&&(V.push(ve+1),V.push(ue),V.push(1-se))}return K}within(c,y,w){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:C,coords:R,nodeSize:N}=this,z=[0,C.length-1,0],V=[],K=w*w;for(;z.length;){let se=z.pop()||0,ue=z.pop()||0,fe=z.pop()||0;if(ue-fe<=N){for(let Le=fe;Le<=ue;Le++)yI(R[2*Le],R[2*Le+1],c,y)<=K&&V.push(C[Le]);continue}let ve=fe+ue>>1,we=R[2*ve],ke=R[2*ve+1];yI(we,ke,c,y)<=K&&V.push(C[ve]),(se===0?c-w<=we:y-w<=ke)&&(z.push(fe),z.push(ve-1),z.push(1-se)),(se===0?c+w>=we:y+w>=ke)&&(z.push(ve+1),z.push(ue),z.push(1-se))}return V}}function Jv(p,c,y,w,C,R){if(C-w<=y)return;let N=w+C>>1;gI(p,c,N,w,C,R),Jv(p,c,y,w,N-1,1-R),Jv(p,c,y,N+1,C,1-R)}function gI(p,c,y,w,C,R){for(;C>w;){if(C-w>600){let K=C-w+1,se=y-w+1,ue=Math.log(K),fe=.5*Math.exp(2*ue/3),ve=.5*Math.sqrt(ue*fe*(K-fe)/K)*(se-K/2<0?-1:1);gI(p,c,y,Math.max(w,Math.floor(y-se*fe/K+ve)),Math.min(C,Math.floor(y+(K-se)*fe/K+ve)),R)}let N=c[2*y+R],z=w,V=C;for(a3(p,c,w,y),c[2*C+R]>N&&a3(p,c,w,C);z<V;){for(a3(p,c,z,V),z++,V--;c[2*z+R]<N;)z++;for(;c[2*V+R]>N;)V--}c[2*w+R]===N?a3(p,c,w,V):(V++,a3(p,c,V,C)),V<=y&&(w=V+1),y<=V&&(C=V-1)}}function a3(p,c,y,w){eb(p,y,w),eb(c,2*y,2*w),eb(c,2*y+1,2*w+1)}function eb(p,c,y){let w=p[c];p[c]=p[y],p[y]=w}function yI(p,c,y,w){let C=p-y,R=c-w;return C*C+R*R}var tb;n.PerformanceMarkers=void 0,(tb=n.PerformanceMarkers||(n.PerformanceMarkers={})).create="create",tb.load="load",tb.fullLoad="fullLoad";let d9=null,l3=[],ib=1e3/60,rb="loadTime",sb="fullLoadTime",lG={mark(p){performance.mark(p)},frame(p){let c=p;d9!=null&&l3.push(c-d9),d9=c},clearMetrics(){d9=null,l3=[],performance.clearMeasures(rb),performance.clearMeasures(sb);for(let p in n.PerformanceMarkers)performance.clearMarks(n.PerformanceMarkers[p])},getPerformanceMetrics(){performance.measure(rb,n.PerformanceMarkers.create,n.PerformanceMarkers.load),performance.measure(sb,n.PerformanceMarkers.create,n.PerformanceMarkers.fullLoad);let p=performance.getEntriesByName(rb)[0].duration,c=performance.getEntriesByName(sb)[0].duration,y=l3.length,w=1/(l3.reduce((R,N)=>R+N,0)/y/1e3),C=l3.filter(R=>R>ib).reduce((R,N)=>R+(N-ib)/ib,0);return{loadTime:p,fullLoadTime:c,fps:w,percentDroppedFrames:C/(y+C)*100,totalFrames:y}}};n.AJAXError=ee,n.ARRAY_TYPE=rf,n.Actor=class{constructor(p,c,y){this.receive=w=>{let C=w.data,R=C.id;if(R&&(!C.targetMapId||this.mapId===C.targetMapId))if(C.type==="<cancel>"){delete this.tasks[R];let N=this.cancelCallbacks[R];delete this.cancelCallbacks[R],N&&N()}else q()||C.mustQueue?(this.tasks[R]=C,this.taskQueue.push(R),this.invoker.trigger()):this.processTask(R,C)},this.process=()=>{if(!this.taskQueue.length)return;let w=this.taskQueue.shift(),C=this.tasks[w];delete this.tasks[w],this.taskQueue.length&&this.invoker.trigger(),C&&this.processTask(w,C)},this.target=p,this.parent=c,this.mapId=y,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Kz(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=q()?p:window}send(p,c,y,w,C=!1){let R=Math.round(1e18*Math.random()).toString(36).substring(0,10);y&&(this.callbacks[R]=y);let N=Z(this.globalScope)?void 0:[];return this.target.postMessage({id:R,type:p,hasCallback:!!y,targetMapId:w,mustQueue:C,sourceMapId:this.mapId,data:zh(c,N)},N),{cancel:()=>{y&&delete this.callbacks[R],this.target.postMessage({id:R,type:"<cancel>",targetMapId:w,sourceMapId:this.mapId})}}}processTask(p,c){if(c.type==="<response>"){let y=this.callbacks[p];delete this.callbacks[p],y&&(c.error?y(au(c.error)):y(null,au(c.data)))}else{let y=!1,w=Z(this.globalScope)?void 0:[],C=c.hasCallback?(z,V)=>{y=!0,delete this.cancelCallbacks[p],this.target.postMessage({id:p,type:"<response>",sourceMapId:this.mapId,error:z?zh(z):null,data:zh(V,w)},w)}:z=>{y=!0},R=null,N=au(c.data);if(this.parent[c.type])R=this.parent[c.type](c.sourceMapId,N,C);else if(this.parent.getWorkerSource){let z=c.type.split(".");R=this.parent.getWorkerSource(c.sourceMapId,z[0],N.source)[z[1]](N,C)}else C(new Error(`Could not find function ${c.type}`));!y&&R&&R.cancel&&(this.cancelCallbacks[p]=R.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},n.AlphaImage=Yp,n.CanonicalTileID=Yv,n.CollisionBoxArray=H,n.CollisionCircleLayoutArray=class extends Vp{},n.Color=Pi,n.DEMData=QC,n.DataConstantProperty=di,n.DictionaryCoder=KC,n.EXTENT=xs,n.ErrorEvent=vt,n.EvaluationParameters=ts,n.Event=gt,n.Evented=ct,n.FeatureIndex=eI,n.FillBucket=Rv,n.FillExtrusionBucket=Fv,n.GeoJSONFeature=JC,n.ImageAtlas=RC,n.ImagePosition=Uv,n.KDBush=Kv,n.LineBucket=Lv,n.LineStripIndexArray=class extends I{},n.LngLat=w1,n.MercatorCoordinate=a9,n.ONE_EM=an,n.OverscaledTileID=Da,n.PerformanceUtils=lG,n.Point=u,n.Pos3dArray=class extends Xh{},n.PosArray=tt,n.Properties=oo,n.Protobuf=Ov,n.QuadTriangleArray=class extends J0{},n.RGBAImage=Ra,n.RasterBoundsArray=class extends Wh{},n.RequestPerformance=class{constructor(p){this._marks={start:[p.url,"start"].join("#"),end:[p.url,"end"].join("#"),measure:p.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let p=performance.getEntriesByName(this._marks.measure);return p.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),p=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),p}},n.SegmentVector=_i,n.SymbolBucket=cf,n.Transitionable=V7,n.TriangleIndexArray=yi,n.Uniform1f=nn,n.Uniform1i=class extends Ds{constructor(p,c){super(p,c),this.current=0}set(p){this.current!==p&&(this.current=p,this.gl.uniform1i(this.location,p))}},n.Uniform2f=class extends Ds{constructor(p,c){super(p,c),this.current=[0,0]}set(p){p[0]===this.current[0]&&p[1]===this.current[1]||(this.current=p,this.gl.uniform2f(this.location,p[0],p[1]))}},n.Uniform3f=class extends Ds{constructor(p,c){super(p,c),this.current=[0,0,0]}set(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]||(this.current=p,this.gl.uniform3f(this.location,p[0],p[1],p[2]))}},n.Uniform4f=Ln,n.UniformColor=y1,n.UniformMatrix4f=class extends Ds{constructor(p,c){super(p,c),this.current=on}set(p){if(p[12]!==this.current[12]||p[0]!==this.current[0])return this.current=p,void this.gl.uniformMatrix4fv(this.location,!1,p);for(let c=1;c<16;c++)if(p[c]!==this.current[c]){this.current=p,this.gl.uniformMatrix4fv(this.location,!1,p);break}}},n.UnwrappedTileID=ZC,n.ValidationError=Ie,n.ZoomHistory=Pp,n.addDynamicAttributes=Hv,n.arrayBufferToImage=function(p,c){let y=new Image;y.onload=()=>{c(null,y),URL.revokeObjectURL(y.src),y.onload=null,window.requestAnimationFrame(()=>{y.src=X})},y.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let w=new Blob([new Uint8Array(p)],{type:"image/png"});y.src=p.byteLength?URL.createObjectURL(w):X},n.arrayBufferToImageBitmap=function(p,c){let y=new Blob([new Uint8Array(p)],{type:"image/png"});createImageBitmap(y).then(w=>{c(null,w)}).catch(w=>{c(new Error(`Could not load image because of ${w.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},n.asyncAll=function(p,c,y){if(!p.length)return y(null,[]);let w=p.length,C=new Array(p.length),R=null;p.forEach((N,z)=>{c(N,(V,K)=>{V&&(R=V),C[z]=K,--w==0&&y(R,C)})})},n.bezier=_,n.browser=le,n.clamp=E,n.clipLine=rI,n.clone=function(p){var c=new rf(16);return c[0]=p[0],c[1]=p[1],c[2]=p[2],c[3]=p[3],c[4]=p[4],c[5]=p[5],c[6]=p[6],c[7]=p[7],c[8]=p[8],c[9]=p[9],c[10]=p[10],c[11]=p[11],c[12]=p[12],c[13]=p[13],c[14]=p[14],c[15]=p[15],c},n.clone$1=F,n.collisionCircleLayout=Az,n.config=te,n.copy=function(p,c){return p[0]=c[0],p[1]=c[1],p[2]=c[2],p[3]=c[3],p[4]=c[4],p[5]=c[5],p[6]=c[6],p[7]=c[7],p[8]=c[8],p[9]=c[9],p[10]=c[10],p[11]=c[11],p[12]=c[12],p[13]=c[13],p[14]=c[14],p[15]=c[15],p},n.create=function(){var p=new rf(16);return rf!=Float32Array&&(p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=0,p[12]=0,p[13]=0,p[14]=0),p[0]=1,p[5]=1,p[10]=1,p[15]=1,p},n.createExpression=ur,n.createFilter=Sp,n.createLayout=Rs,n.createStyleLayer=function(p){if(p.type==="custom")return new Qz(p);switch(p.type){case"background":return new qz(p);case"circle":return new DU(p);case"fill":return new JU(p);case"fill-extrusion":return new pz(p);case"heatmap":return new LU(p);case"hillshade":return new OU(p);case"line":return new wz(p);case"raster":return new Zz(p);case"symbol":return new o9(p)}},n.deepEqual=function p(c,y){if(Array.isArray(c)){if(!Array.isArray(y)||c.length!==y.length)return!1;for(let w=0;w<c.length;w++)if(!p(c[w],y[w]))return!1;return!0}if(typeof c=="object"&&c!==null&&y!==null){if(typeof y!="object"||Object.keys(c).length!==Object.keys(y).length)return!1;for(let w in c)if(!p(c[w],y[w]))return!1;return!0}return c===y},n.defaultEasing=v,n.derefLayers=function(p){p=p.slice();let c=Object.create(null);for(let y=0;y<p.length;y++)c[p[y].id]=p[y];for(let y=0;y<p.length;y++)"ref"in p[y]&&(p[y]=xt(p[y],c[p[y].ref]));return p},n.diffStyles=function(p,c){if(!p)return[{command:Gt.setStyle,args:[c]}];let y=[];try{if(!It(p.version,c.version))return[{command:Gt.setStyle,args:[c]}];It(p.center,c.center)||y.push({command:Gt.setCenter,args:[c.center]}),It(p.zoom,c.zoom)||y.push({command:Gt.setZoom,args:[c.zoom]}),It(p.bearing,c.bearing)||y.push({command:Gt.setBearing,args:[c.bearing]}),It(p.pitch,c.pitch)||y.push({command:Gt.setPitch,args:[c.pitch]}),It(p.sprite,c.sprite)||y.push({command:Gt.setSprite,args:[c.sprite]}),It(p.glyphs,c.glyphs)||y.push({command:Gt.setGlyphs,args:[c.glyphs]}),It(p.transition,c.transition)||y.push({command:Gt.setTransition,args:[c.transition]}),It(p.light,c.light)||y.push({command:Gt.setLight,args:[c.light]});let w={},C=[];(function(N,z,V,K){let se;for(se in z=z||{},N=N||{})Object.prototype.hasOwnProperty.call(N,se)&&(Object.prototype.hasOwnProperty.call(z,se)||je(se,V,K));for(se in z)Object.prototype.hasOwnProperty.call(z,se)&&(Object.prototype.hasOwnProperty.call(N,se)?It(N[se],z[se])||(N[se].type==="geojson"&&z[se].type==="geojson"&&ge(N,z,se)?V.push({command:Gt.setGeoJSONSourceData,args:[se,z[se].data]}):be(se,z,V,K)):Ni(se,z,V))})(p.sources,c.sources,C,w);let R=[];p.layers&&p.layers.forEach(N=>{w[N.source]?y.push({command:Gt.removeLayer,args:[N.id]}):R.push(N)}),y=y.concat(C),function(N,z,V){z=z||[];let K=(N=N||[]).map(Pe),se=z.map(Pe),ue=N.reduce(Oe,{}),fe=z.reduce(Oe,{}),ve=K.slice(),we=Object.create(null),ke,Le,Be,qe,$e,et,it;for(ke=0,Le=0;ke<K.length;ke++)Be=K[ke],Object.prototype.hasOwnProperty.call(fe,Be)?Le++:(V.push({command:Gt.removeLayer,args:[Be]}),ve.splice(ve.indexOf(Be,Le),1));for(ke=0,Le=0;ke<se.length;ke++)Be=se[se.length-1-ke],ve[ve.length-1-ke]!==Be&&(Object.prototype.hasOwnProperty.call(ue,Be)?(V.push({command:Gt.removeLayer,args:[Be]}),ve.splice(ve.lastIndexOf(Be,ve.length-Le),1)):Le++,et=ve[ve.length-ke],V.push({command:Gt.addLayer,args:[fe[Be],et]}),ve.splice(ve.length-ke,0,Be),we[Be]=!0);for(ke=0;ke<se.length;ke++)if(Be=se[ke],qe=ue[Be],$e=fe[Be],!we[Be]&&!It(qe,$e))if(It(qe.source,$e.source)&&It(qe["source-layer"],$e["source-layer"])&&It(qe.type,$e.type)){for(it in xe(qe.layout,$e.layout,V,Be,null,Gt.setLayoutProperty),xe(qe.paint,$e.paint,V,Be,null,Gt.setPaintProperty),It(qe.filter,$e.filter)||V.push({command:Gt.setFilter,args:[Be,$e.filter]}),It(qe.minzoom,$e.minzoom)&&It(qe.maxzoom,$e.maxzoom)||V.push({command:Gt.setLayerZoomRange,args:[Be,$e.minzoom,$e.maxzoom]}),qe)Object.prototype.hasOwnProperty.call(qe,it)&&it!=="layout"&&it!=="paint"&&it!=="filter"&&it!=="metadata"&&it!=="minzoom"&&it!=="maxzoom"&&(it.indexOf("paint.")===0?xe(qe[it],$e[it],V,Be,it.slice(6),Gt.setPaintProperty):It(qe[it],$e[it])||V.push({command:Gt.setLayerProperty,args:[Be,it,$e[it]]}));for(it in $e)Object.prototype.hasOwnProperty.call($e,it)&&!Object.prototype.hasOwnProperty.call(qe,it)&&it!=="layout"&&it!=="paint"&&it!=="filter"&&it!=="metadata"&&it!=="minzoom"&&it!=="maxzoom"&&(it.indexOf("paint.")===0?xe(qe[it],$e[it],V,Be,it.slice(6),Gt.setPaintProperty):It(qe[it],$e[it])||V.push({command:Gt.setLayerProperty,args:[Be,it,$e[it]]}))}else V.push({command:Gt.removeLayer,args:[Be]}),et=ve[ve.lastIndexOf(Be)+1],V.push({command:Gt.addLayer,args:[$e,et]})}(R,c.layers,y)}catch(w){console.warn("Unable to compute style diff:",w),y=[{command:Gt.setStyle,args:[c]}]}return y},n.dot=function(p,c){return p[0]*c[0]+p[1]*c[1]+p[2]*c[2]+p[3]*c[3]},n.earthRadius=Wv,n.emitValidationErrors=j0,n.emptyStyle=function(){let p={},c=Se.$version;for(let y in Se.$root){let w=Se.$root[y];if(w.required){let C=null;C=y==="version"?c:w.type==="array"?[]:{},C!=null&&(p[y]=C)}}return p},n.equals=function(p,c){var y=p[0],w=p[1],C=p[2],R=p[3],N=p[4],z=p[5],V=p[6],K=p[7],se=p[8],ue=p[9],fe=p[10],ve=p[11],we=p[12],ke=p[13],Le=p[14],Be=p[15],qe=c[0],$e=c[1],et=c[2],it=c[3],pt=c[4],Xt=c[5],ai=c[6],jt=c[7],zt=c[8],Rt=c[9],Qt=c[10],Nt=c[11],Ct=c[12],xi=c[13],ci=c[14],sr=c[15];return Math.abs(y-qe)<=lo*Math.max(1,Math.abs(y),Math.abs(qe))&&Math.abs(w-$e)<=lo*Math.max(1,Math.abs(w),Math.abs($e))&&Math.abs(C-et)<=lo*Math.max(1,Math.abs(C),Math.abs(et))&&Math.abs(R-it)<=lo*Math.max(1,Math.abs(R),Math.abs(it))&&Math.abs(N-pt)<=lo*Math.max(1,Math.abs(N),Math.abs(pt))&&Math.abs(z-Xt)<=lo*Math.max(1,Math.abs(z),Math.abs(Xt))&&Math.abs(V-ai)<=lo*Math.max(1,Math.abs(V),Math.abs(ai))&&Math.abs(K-jt)<=lo*Math.max(1,Math.abs(K),Math.abs(jt))&&Math.abs(se-zt)<=lo*Math.max(1,Math.abs(se),Math.abs(zt))&&Math.abs(ue-Rt)<=lo*Math.max(1,Math.abs(ue),Math.abs(Rt))&&Math.abs(fe-Qt)<=lo*Math.max(1,Math.abs(fe),Math.abs(Qt))&&Math.abs(ve-Nt)<=lo*Math.max(1,Math.abs(ve),Math.abs(Nt))&&Math.abs(we-Ct)<=lo*Math.max(1,Math.abs(we),Math.abs(Ct))&&Math.abs(ke-xi)<=lo*Math.max(1,Math.abs(ke),Math.abs(xi))&&Math.abs(Le-ci)<=lo*Math.max(1,Math.abs(Le),Math.abs(ci))&&Math.abs(Be-sr)<=lo*Math.max(1,Math.abs(Be),Math.abs(sr))},n.evaluateSizeForFeature=function(p,{uSize:c,uSizeT:y},{lowerSize:w,upperSize:C}){return p.kind==="source"?w/Ec:p.kind==="composite"?To.number(w/Ec,C/Ec,y):c},n.evaluateSizeForZoom=function(p,c){let y=0,w=0;if(p.kind==="constant")w=p.layoutSize;else if(p.kind!=="source"){let{interpolationType:C,minZoom:R,maxZoom:N}=p,z=C?E(So.interpolationFactor(C,c,R,N),0,1):0;p.kind==="camera"?w=To.number(p.minSize,p.maxSize,z):y=z}return{uSizeT:y,uSize:w}},n.evented=Bp,n.extend=T,n.filterObject=k,n.findLineIntersection=function(p,c,y,w){let C=c.y-p.y,R=c.x-p.x,N=w.y-y.y,z=w.x-y.x,V=N*R-z*C;if(V===0)return null;let K=(z*(p.y-y.y)-N*(p.x-y.x))/V;return new u(p.x+K*R,p.y+K*C)},n.fromScaling=function(p,c){return p[0]=c[0],p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=c[1],p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=c[2],p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},n.getAnchorAlignment=Gv,n.getAnchorJustification=Qv,n.getArrayBuffer=De,n.getDefaultExportFromCjs=o,n.getJSON=function(p,c){return me(T(p,{type:"json"}),c)},n.getOverlapMode=$v,n.getProtocolAction=ie,n.getRTLTextPluginStatus=Up,n.getReferrer=oe,n.getVideo=function(p,c){let y=window.document.createElement("video");y.muted=!0,y.onloadstart=function(){c(null,y)};for(let w=0;w<p.length;w++){let C=window.document.createElement("source");He(p[w])||(y.crossOrigin="Anonymous"),C.src=p[w],y.appendChild(C)}return{cancel:()=>{}}},n.groupByLayout=function(p,c){let y={};for(let C=0;C<p.length;C++){let R=c&&c[p[C].id]||hv(p[C]);c&&(c[p[C].id]=R);let N=y[R];N||(N=y[R]=[]),N.push(p[C])}let w=[];for(let C in y)w.push(y[C]);return w},n.identity=wv,n.interpolate=To,n.invert=function(p,c){var y=c[0],w=c[1],C=c[2],R=c[3],N=c[4],z=c[5],V=c[6],K=c[7],se=c[8],ue=c[9],fe=c[10],ve=c[11],we=c[12],ke=c[13],Le=c[14],Be=c[15],qe=y*z-w*N,$e=y*V-C*N,et=y*K-R*N,it=w*V-C*z,pt=w*K-R*z,Xt=C*K-R*V,ai=se*ke-ue*we,jt=se*Le-fe*we,zt=se*Be-ve*we,Rt=ue*Le-fe*ke,Qt=ue*Be-ve*ke,Nt=fe*Be-ve*Le,Ct=qe*Nt-$e*Qt+et*Rt+it*zt-pt*jt+Xt*ai;return Ct?(p[0]=(z*Nt-V*Qt+K*Rt)*(Ct=1/Ct),p[1]=(C*Qt-w*Nt-R*Rt)*Ct,p[2]=(ke*Xt-Le*pt+Be*it)*Ct,p[3]=(fe*pt-ue*Xt-ve*it)*Ct,p[4]=(V*zt-N*Nt-K*jt)*Ct,p[5]=(y*Nt-C*zt+R*jt)*Ct,p[6]=(Le*et-we*Xt-Be*$e)*Ct,p[7]=(se*Xt-fe*et+ve*$e)*Ct,p[8]=(N*Qt-z*zt+K*ai)*Ct,p[9]=(w*zt-y*Qt-R*ai)*Ct,p[10]=(we*pt-ke*et+Be*qe)*Ct,p[11]=(ue*et-se*pt-ve*qe)*Ct,p[12]=(z*jt-N*Rt-V*ai)*Ct,p[13]=(y*Rt-w*jt+C*ai)*Ct,p[14]=(ke*$e-we*it-Le*qe)*Ct,p[15]=(se*it-ue*$e+fe*qe)*Ct,p):null},n.isImageBitmap=Q,n.isSafari=Z,n.isWorker=q,n.keysDifference=function(p,c){let y=[];for(let w in p)w in c||y.push(w);return y},n.lazyLoadRTLTextPlugin=function(){aa.isLoading()||aa.isLoaded()||Up()!=="deferred"||H7()},n.makeRequest=me,n.mapObject=M,n.mercatorXfromLng=XC,n.mercatorYfromLat=WC,n.mercatorZfromAltitude=qC,n.mul=RU,n.mul$1=function(p,c,y){return p[0]=c[0]*y[0],p[1]=c[1]*y[1],p[2]=c[2]*y[2],p[3]=c[3]*y[3],p},n.multiply=QA,n.nextPowerOfTwo=function(p){return p<=1?1:Math.pow(2,Math.ceil(Math.log(p)/Math.LN2))},n.operations=Gt,n.ortho=function(p,c,y,w,C,R,N){var z=1/(c-y),V=1/(w-C),K=1/(R-N);return p[0]=-2*z,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=-2*V,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=2*K,p[11]=0,p[12]=(c+y)*z,p[13]=(C+w)*V,p[14]=(N+R)*K,p[15]=1,p},n.parseCacheControl=function(p){let c={};if(p.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(y,w,C,R)=>{let N=C||R;return c[w]=!N||N.toLowerCase(),""}),c["max-age"]){let y=parseInt(c["max-age"],10);isNaN(y)?delete c["max-age"]:c["max-age"]=y}return c},n.parseGlyphPbf=function(p){return new Ov(p).readFields(Oz,[])},n.pbf=EC,n.performSymbolLayout=function(p){p.bucket.createArrays(),p.bucket.tilePixelRatio=xs/(512*p.bucket.overscaling),p.bucket.compareText={},p.bucket.iconsNeedLinear=!1;let c=p.bucket.layers[0],y=c.layout,w=c._unevaluatedLayout._values,C={layoutIconSize:w["icon-size"].possiblyEvaluate(new ts(p.bucket.zoom+1),p.canonical),layoutTextSize:w["text-size"].possiblyEvaluate(new ts(p.bucket.zoom+1),p.canonical),textMaxSize:w["text-size"].possiblyEvaluate(new ts(18))};if(p.bucket.textSizeData.kind==="composite"){let{minZoom:K,maxZoom:se}=p.bucket.textSizeData;C.compositeTextSizes=[w["text-size"].possiblyEvaluate(new ts(K),p.canonical),w["text-size"].possiblyEvaluate(new ts(se),p.canonical)]}if(p.bucket.iconSizeData.kind==="composite"){let{minZoom:K,maxZoom:se}=p.bucket.iconSizeData;C.compositeIconSizes=[w["icon-size"].possiblyEvaluate(new ts(K),p.canonical),w["icon-size"].possiblyEvaluate(new ts(se),p.canonical)]}let R=y.get("text-line-height")*an,N=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point",z=y.get("text-keep-upright"),V=y.get("text-size");for(let K of p.bucket.features){let se=y.get("text-font").evaluate(K,{},p.canonical).join(","),ue=V.evaluate(K,{},p.canonical),fe=C.layoutTextSize.evaluate(K,{},p.canonical),ve=C.layoutIconSize.evaluate(K,{},p.canonical),we={horizontal:{},vertical:void 0},ke=K.text,Le,Be=[0,0];if(ke){let et=ke.toString(),it=y.get("text-letter-spacing").evaluate(K,{},p.canonical)*an,pt=G7(et)?it:0,Xt=y.get("text-anchor").evaluate(K,{},p.canonical),ai=dI(c,K,p.canonical);if(!ai){let Nt=y.get("text-radial-offset").evaluate(K,{},p.canonical);Be=Nt?hI(Xt,[Nt*an,Zv]):y.get("text-offset").evaluate(K,{},p.canonical).map(Ct=>Ct*an)}let jt=N?"center":y.get("text-justify").evaluate(K,{},p.canonical),zt=y.get("symbol-placement"),Rt=zt==="point"?y.get("text-max-width").evaluate(K,{},p.canonical)*an:0,Qt=()=>{p.bucket.allowVerticalPlacement&&X0(et)&&(we.vertical=r9(ke,p.glyphMap,p.glyphPositions,p.imagePositions,se,Rt,R,Xt,"left",pt,Be,n.WritingMode.vertical,!0,zt,fe,ue))};if(!N&&ai){let Nt=new Set;if(jt==="auto")for(let xi=0;xi<ai.values.length;xi+=2)Nt.add(Qv(ai.values[xi]));else Nt.add(jt);let Ct=!1;for(let xi of Nt)if(!we.horizontal[xi])if(Ct)we.horizontal[xi]=we.horizontal[0];else{let ci=r9(ke,p.glyphMap,p.glyphPositions,p.imagePositions,se,Rt,R,"center",xi,pt,Be,n.WritingMode.horizontal,!1,zt,fe,ue);ci&&(we.horizontal[xi]=ci,Ct=ci.positionedLines.length===1)}Qt()}else{jt==="auto"&&(jt=Qv(Xt));let Nt=r9(ke,p.glyphMap,p.glyphPositions,p.imagePositions,se,Rt,R,Xt,jt,pt,Be,n.WritingMode.horizontal,!1,zt,fe,ue);Nt&&(we.horizontal[jt]=Nt),Qt(),X0(et)&&N&&z&&(we.vertical=r9(ke,p.glyphMap,p.glyphPositions,p.imagePositions,se,Rt,R,Xt,jt,pt,Be,n.WritingMode.vertical,!1,zt,fe,ue))}}let qe=!1;if(K.icon&&K.icon.name){let et=p.imageMap[K.icon.name];et&&(Le=Hz(p.imagePositions[K.icon.name],y.get("icon-offset").evaluate(K,{},p.canonical),y.get("icon-anchor").evaluate(K,{},p.canonical)),qe=!!et.sdf,p.bucket.sdfIcons===void 0?p.bucket.sdfIcons=qe:p.bucket.sdfIcons!==qe&&B("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(et.pixelRatio!==p.bucket.pixelRatio||y.get("icon-rotate").constantOr(1)!==0)&&(p.bucket.iconsNeedLinear=!0))}let $e=pI(we.horizontal)||we.vertical;p.bucket.iconsInText=!!$e&&$e.iconsInText,($e||Le)&&oG(p.bucket,K,we,Le,p.imageMap,C,fe,ve,Be,qe,p.canonical)}p.showCollisionBoxes&&p.bucket.generateCollisionDebugBuffers()},n.perspective=function(p,c,y,w,C){var R,N=1/Math.tan(c/2);return p[0]=N/y,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=N,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,C!=null&&C!==1/0?(p[10]=(C+w)*(R=1/(w-C)),p[14]=2*C*w*R):(p[10]=-1,p[14]=-2*w),p},n.pick=function(p,c){let y={};for(let w=0;w<c.length;w++){let C=c[w];C in p&&(y[C]=p[C])}return y},n.plugin=aa,n.pointGeometry=a,n.polygonIntersectsPolygon=jA,n.potpack=PC,n.register=Zt,n.registerForPluginStateChange=function(p){return p({pluginStatus:no,pluginURL:xc}),Bp.on("pluginStateChange",p),p},n.renderColorRamp=iC,n.rotateX=function(p,c,y){var w=Math.sin(y),C=Math.cos(y),R=c[4],N=c[5],z=c[6],V=c[7],K=c[8],se=c[9],ue=c[10],fe=c[11];return c!==p&&(p[0]=c[0],p[1]=c[1],p[2]=c[2],p[3]=c[3],p[12]=c[12],p[13]=c[13],p[14]=c[14],p[15]=c[15]),p[4]=R*C+K*w,p[5]=N*C+se*w,p[6]=z*C+ue*w,p[7]=V*C+fe*w,p[8]=K*C-R*w,p[9]=se*C-N*w,p[10]=ue*C-z*w,p[11]=fe*C-V*w,p},n.rotateZ=function(p,c,y){var w=Math.sin(y),C=Math.cos(y),R=c[0],N=c[1],z=c[2],V=c[3],K=c[4],se=c[5],ue=c[6],fe=c[7];return c!==p&&(p[8]=c[8],p[9]=c[9],p[10]=c[10],p[11]=c[11],p[12]=c[12],p[13]=c[13],p[14]=c[14],p[15]=c[15]),p[0]=R*C+K*w,p[1]=N*C+se*w,p[2]=z*C+ue*w,p[3]=V*C+fe*w,p[4]=K*C-R*w,p[5]=se*C-N*w,p[6]=ue*C-z*w,p[7]=fe*C-V*w,p},n.sameOrigin=He,n.scale=function(p,c,y){var w=y[0],C=y[1],R=y[2];return p[0]=c[0]*w,p[1]=c[1]*w,p[2]=c[2]*w,p[3]=c[3]*w,p[4]=c[4]*C,p[5]=c[5]*C,p[6]=c[6]*C,p[7]=c[7]*C,p[8]=c[8]*R,p[9]=c[9]*R,p[10]=c[10]*R,p[11]=c[11]*R,p[12]=c[12],p[13]=c[13],p[14]=c[14],p[15]=c[15],p},n.setRTLTextPlugin=function(p,c,y=!1){if(no===Dp||no===Hh||no===Fp)throw new Error("setRTLTextPlugin cannot be called multiple times.");xc=le.resolveURL(p),no=Dp,Lp=c,Op(),y||H7()},n.sphericalToCartesian=function([p,c,y]){return c+=90,c*=Math.PI/180,y*=Math.PI/180,{x:p*Math.cos(c)*Math.sin(y),y:p*Math.sin(c)*Math.sin(y),z:p*Math.cos(y)}},n.toEvaluationFeature=wc,n.transformMat4=Z7,n.translate=function(p,c,y){var w,C,R,N,z,V,K,se,ue,fe,ve,we,ke=y[0],Le=y[1],Be=y[2];return c===p?(p[12]=c[0]*ke+c[4]*Le+c[8]*Be+c[12],p[13]=c[1]*ke+c[5]*Le+c[9]*Be+c[13],p[14]=c[2]*ke+c[6]*Le+c[10]*Be+c[14],p[15]=c[3]*ke+c[7]*Le+c[11]*Be+c[15]):(C=c[1],R=c[2],N=c[3],z=c[4],V=c[5],K=c[6],se=c[7],ue=c[8],fe=c[9],ve=c[10],we=c[11],p[0]=w=c[0],p[1]=C,p[2]=R,p[3]=N,p[4]=z,p[5]=V,p[6]=K,p[7]=se,p[8]=ue,p[9]=fe,p[10]=ve,p[11]=we,p[12]=w*ke+z*Le+ue*Be+c[12],p[13]=C*ke+V*Le+fe*Be+c[13],p[14]=R*ke+K*Le+ve*Be+c[14],p[15]=N*ke+se*Le+we*Be+c[15]),p},n.triggerPluginCompletionEvent=Np,n.unicodeBlockLookup=Vt,n.uniqueId=function(){return A++},n.v8Spec=Se,n.validateCustomStyleLayer=function(p){let c=[],y=p.id;return y===void 0&&c.push({message:`layers.${y}: missing required property "id"`}),p.render===void 0&&c.push({message:`layers.${y}: missing required method "render"`}),p.renderingMode&&p.renderingMode!=="2d"&&p.renderingMode!=="3d"&&c.push({message:`layers.${y}: property "renderingMode" must be either "2d" or "3d"`}),c},n.validateLight=dv,n.validateStyle=Oh,n.vectorTile=x1,n.warnOnce=B,n.wrap=b}),r(["./shared"],function(n){"use strict";class o{constructor(he){this.keyCache={},he&&this.replace(he)}replace(he){this._layerConfigs={},this._layers={},this.update(he,[])}update(he,pe){for(let Fe of he){this._layerConfigs[Fe.id]=Fe;let Ue=this._layers[Fe.id]=n.createStyleLayer(Fe);Ue._featureFilter=n.createFilter(Ue.filter),this.keyCache[Fe.id]&&delete this.keyCache[Fe.id]}for(let Fe of pe)delete this.keyCache[Fe],delete this._layerConfigs[Fe],delete this._layers[Fe];this.familiesBySource={};let Ee=n.groupByLayout(Object.values(this._layerConfigs),this.keyCache);for(let Fe of Ee){let Ue=Fe.map(bt=>this._layers[bt.id]),We=Ue[0];if(We.visibility==="none")continue;let Ge=We.source||"",ze=this.familiesBySource[Ge];ze||(ze=this.familiesBySource[Ge]={});let Ze=We.sourceLayer||"_geojsonTileLayer",_t=ze[Ze];_t||(_t=ze[Ze]=[]),_t.push(Ue)}}}class a{constructor(he){let pe={},Ee=[];for(let Ge in he){let ze=he[Ge],Ze=pe[Ge]={};for(let _t in ze){let bt=ze[+_t];if(!bt||bt.bitmap.width===0||bt.bitmap.height===0)continue;let wt={x:0,y:0,w:bt.bitmap.width+2,h:bt.bitmap.height+2};Ee.push(wt),Ze[_t]={rect:wt,metrics:bt.metrics}}}let{w:Fe,h:Ue}=n.potpack(Ee),We=new n.AlphaImage({width:Fe||1,height:Ue||1});for(let Ge in he){let ze=he[Ge];for(let Ze in ze){let _t=ze[+Ze];if(!_t||_t.bitmap.width===0||_t.bitmap.height===0)continue;let bt=pe[Ge][Ze].rect;n.AlphaImage.copy(_t.bitmap,We,{x:0,y:0},{x:bt.x+1,y:bt.y+1},_t.bitmap)}}this.image=We,this.positions=pe}}n.register("GlyphAtlas",a);class l{constructor(he){this.tileID=new n.OverscaledTileID(he.tileID.overscaledZ,he.tileID.wrap,he.tileID.canonical.z,he.tileID.canonical.x,he.tileID.canonical.y),this.uid=he.uid,this.zoom=he.zoom,this.pixelRatio=he.pixelRatio,this.tileSize=he.tileSize,this.source=he.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=he.showCollisionBoxes,this.collectResourceTiming=!!he.collectResourceTiming,this.returnDependencies=!!he.returnDependencies,this.promoteId=he.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(he,pe,Ee,Fe,Ue){this.status="parsing",this.data=he,this.collisionBoxArray=new n.CollisionBoxArray;let We=new n.DictionaryCoder(Object.keys(he.layers).sort()),Ge=new n.FeatureIndex(this.tileID,this.promoteId);Ge.bucketLayerIDs=[];let ze={},Ze={featureIndex:Ge,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Ee},_t=pe.familiesBySource[this.source];for(let cr in _t){let yr=he.layers[cr];if(!yr)continue;yr.version===1&&n.warnOnce(`Vector tile source "${this.source}" layer "${cr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let so=We.encode(cr),Pi=[];for(let Hs=0;Hs<yr.length;Hs++){let Tn=yr.feature(Hs),Is=Ge.getId(Tn,cr);Pi.push({feature:Tn,id:Is,index:Hs,sourceLayerIndex:so})}for(let Hs of _t[cr]){let Tn=Hs[0];Tn.source!==this.source&&n.warnOnce(`layer.source = ${Tn.source} does not equal this.source = ${this.source}`),Tn.minzoom&&this.zoom<Math.floor(Tn.minzoom)||Tn.maxzoom&&this.zoom>=Tn.maxzoom||Tn.visibility!=="none"&&(u(Hs,this.zoom,Ee),(ze[Tn.id]=Tn.createBucket({index:Ge.bucketLayerIDs.length,layers:Hs,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:so,sourceID:this.source})).populate(Pi,Ze,this.tileID.canonical),Ge.bucketLayerIDs.push(Hs.map(Is=>Is.id)))}}let bt,wt,wi,$i,ni=n.mapObject(Ze.glyphDependencies,cr=>Object.keys(cr).map(Number));this.inFlightDependencies.forEach(cr=>cr?.cancel()),this.inFlightDependencies=[];let gi=++this.dependencySentinel;Object.keys(ni).length?this.inFlightDependencies.push(Fe.send("getGlyphs",{uid:this.uid,stacks:ni,source:this.source,tileID:this.tileID,type:"glyphs"},(cr,yr)=>{gi===this.dependencySentinel&&(bt||(bt=cr,wt=yr,Lr.call(this)))})):wt={};let Bi=Object.keys(Ze.iconDependencies);Bi.length?this.inFlightDependencies.push(Fe.send("getImages",{icons:Bi,source:this.source,tileID:this.tileID,type:"icons"},(cr,yr)=>{gi===this.dependencySentinel&&(bt||(bt=cr,wi=yr,Lr.call(this)))})):wi={};let xr=Object.keys(Ze.patternDependencies);function Lr(){if(bt)return Ue(bt);if(wt&&wi&&$i){let cr=new a(wt),yr=new n.ImageAtlas(wi,$i);for(let so in ze){let Pi=ze[so];Pi instanceof n.SymbolBucket?(u(Pi.layers,this.zoom,Ee),n.performSymbolLayout({bucket:Pi,glyphMap:wt,glyphPositions:cr.positions,imageMap:wi,imagePositions:yr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Pi.hasPattern&&(Pi instanceof n.LineBucket||Pi instanceof n.FillBucket||Pi instanceof n.FillExtrusionBucket)&&(u(Pi.layers,this.zoom,Ee),Pi.addFeatures(Ze,this.tileID.canonical,yr.patternPositions))}this.status="done",Ue(null,{buckets:Object.values(ze).filter(so=>!so.isEmpty()),featureIndex:Ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:cr.image,imageAtlas:yr,glyphMap:this.returnDependencies?wt:null,iconMap:this.returnDependencies?wi:null,glyphPositions:this.returnDependencies?cr.positions:null})}}xr.length?this.inFlightDependencies.push(Fe.send("getImages",{icons:xr,source:this.source,tileID:this.tileID,type:"patterns"},(cr,yr)=>{gi===this.dependencySentinel&&(bt||(bt=cr,$i=yr,Lr.call(this)))})):$i={},Lr.call(this)}}function u(Me,he,pe){let Ee=new n.EvaluationParameters(he);for(let Fe of Me)Fe.recalculate(Ee,pe)}function d(Me,he){let pe=n.getArrayBuffer(Me.request,(Ee,Fe,Ue,We)=>{Ee?he(Ee):Fe&&he(null,{vectorTile:new n.vectorTile.VectorTile(new n.Protobuf(Fe)),rawData:Fe,cacheControl:Ue,expires:We})});return()=>{pe.cancel(),he()}}class m{constructor(he,pe,Ee,Fe){this.actor=he,this.layerIndex=pe,this.availableImages=Ee,this.loadVectorData=Fe||d,this.fetching={},this.loading={},this.loaded={}}loadTile(he,pe){let Ee=he.uid;this.loading||(this.loading={});let Fe=!!(he&&he.request&&he.request.collectResourceTiming)&&new n.RequestPerformance(he.request),Ue=this.loading[Ee]=new l(he);Ue.abort=this.loadVectorData(he,(We,Ge)=>{if(delete this.loading[Ee],We||!Ge)return Ue.status="done",this.loaded[Ee]=Ue,pe(We);let ze=Ge.rawData,Ze={};Ge.expires&&(Ze.expires=Ge.expires),Ge.cacheControl&&(Ze.cacheControl=Ge.cacheControl);let _t={};if(Fe){let bt=Fe.finish();bt&&(_t.resourceTiming=JSON.parse(JSON.stringify(bt)))}Ue.vectorTile=Ge.vectorTile,Ue.parse(Ge.vectorTile,this.layerIndex,this.availableImages,this.actor,(bt,wt)=>{if(delete this.fetching[Ee],bt||!wt)return pe(bt);pe(null,n.extend({rawTileData:ze.slice(0)},wt,Ze,_t))}),this.loaded=this.loaded||{},this.loaded[Ee]=Ue,this.fetching[Ee]={rawTileData:ze,cacheControl:Ze,resourceTiming:_t}})}reloadTile(he,pe){let Ee=this.loaded,Fe=he.uid;if(Ee&&Ee[Fe]){let Ue=Ee[Fe];Ue.showCollisionBoxes=he.showCollisionBoxes,Ue.status==="parsing"?Ue.parse(Ue.vectorTile,this.layerIndex,this.availableImages,this.actor,(We,Ge)=>{if(We||!Ge)return pe(We,Ge);let ze;if(this.fetching[Fe]){let{rawTileData:Ze,cacheControl:_t,resourceTiming:bt}=this.fetching[Fe];delete this.fetching[Fe],ze=n.extend({rawTileData:Ze.slice(0)},Ge,_t,bt)}else ze=Ge;pe(null,ze)}):Ue.status==="done"&&(Ue.vectorTile?Ue.parse(Ue.vectorTile,this.layerIndex,this.availableImages,this.actor,pe):pe())}}abortTile(he,pe){let Ee=this.loading,Fe=he.uid;Ee&&Ee[Fe]&&Ee[Fe].abort&&(Ee[Fe].abort(),delete Ee[Fe]),pe()}removeTile(he,pe){let Ee=this.loaded,Fe=he.uid;Ee&&Ee[Fe]&&delete Ee[Fe],pe()}}class g{constructor(){this.loaded={}}loadTile(he,pe){let{uid:Ee,encoding:Fe,rawImageData:Ue}=he,We=n.isImageBitmap(Ue)?this.getImageData(Ue):Ue,Ge=new n.DEMData(Ee,We,Fe);this.loaded=this.loaded||{},this.loaded[Ee]=Ge,pe(null,Ge)}getImageData(he){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(he.width,he.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=he.width,this.offscreenCanvas.height=he.height,this.offscreenCanvasContext.drawImage(he,0,0,he.width,he.height);let pe=this.offscreenCanvasContext.getImageData(-1,-1,he.width+2,he.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new n.RGBAImage({width:pe.width,height:pe.height},pe.data)}removeTile(he){let pe=this.loaded,Ee=he.uid;pe&&pe[Ee]&&delete pe[Ee]}}function _(Me,he){if(Me.length!==0){v(Me[0],he);for(var pe=1;pe<Me.length;pe++)v(Me[pe],!he)}}function v(Me,he){for(var pe=0,Ee=0,Fe=0,Ue=Me.length,We=Ue-1;Fe<Ue;We=Fe++){var Ge=(Me[Fe][0]-Me[We][0])*(Me[We][1]+Me[Fe][1]),ze=pe+Ge;Ee+=Math.abs(pe)>=Math.abs(Ge)?pe-ze+Ge:Ge-ze+pe,pe=ze}pe+Ee>=0!=!!he&&Me.reverse()}var E=n.getDefaultExportFromCjs(function Me(he,pe){var Ee,Fe=he&&he.type;if(Fe==="FeatureCollection")for(Ee=0;Ee<he.features.length;Ee++)Me(he.features[Ee],pe);else if(Fe==="GeometryCollection")for(Ee=0;Ee<he.geometries.length;Ee++)Me(he.geometries[Ee],pe);else if(Fe==="Feature")Me(he.geometry,pe);else if(Fe==="Polygon")_(he.coordinates,pe);else if(Fe==="MultiPolygon")for(Ee=0;Ee<he.coordinates.length;Ee++)_(he.coordinates[Ee],pe);return he});let b=n.vectorTile.VectorTileFeature.prototype.toGeoJSON;var T={exports:{}},A=n.pointGeometry,M=n.vectorTile.VectorTileFeature,k=F;function F(Me,he){this.options=he||{},this.features=Me,this.length=Me.length}function O(Me,he){this.id=typeof Me.id=="number"?Me.id:void 0,this.type=Me.type,this.rawGeometry=Me.type===1?[Me.geometry]:Me.geometry,this.properties=Me.tags,this.extent=he||4096}F.prototype.feature=function(Me){return new O(this.features[Me],this.options.extent)},O.prototype.loadGeometry=function(){var Me=this.rawGeometry;this.geometry=[];for(var he=0;he<Me.length;he++){for(var pe=Me[he],Ee=[],Fe=0;Fe<pe.length;Fe++)Ee.push(new A(pe[Fe][0],pe[Fe][1]));this.geometry.push(Ee)}return this.geometry},O.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Me=this.geometry,he=1/0,pe=-1/0,Ee=1/0,Fe=-1/0,Ue=0;Ue<Me.length;Ue++)for(var We=Me[Ue],Ge=0;Ge<We.length;Ge++){var ze=We[Ge];he=Math.min(he,ze.x),pe=Math.max(pe,ze.x),Ee=Math.min(Ee,ze.y),Fe=Math.max(Fe,ze.y)}return[he,Ee,pe,Fe]},O.prototype.toGeoJSON=M.prototype.toGeoJSON;var B=n.pbf,U=k;function $(Me){var he=new B;return function(pe,Ee){for(var Fe in pe.layers)Ee.writeMessage(3,q,pe.layers[Fe])}(Me,he),he.finish()}function q(Me,he){var pe;he.writeVarintField(15,Me.version||1),he.writeStringField(1,Me.name||""),he.writeVarintField(5,Me.extent||4096);var Ee={keys:[],values:[],keycache:{},valuecache:{}};for(pe=0;pe<Me.length;pe++)Ee.feature=Me.feature(pe),he.writeMessage(2,W,Ee);var Fe=Ee.keys;for(pe=0;pe<Fe.length;pe++)he.writeStringField(3,Fe[pe]);var Ue=Ee.values;for(pe=0;pe<Ue.length;pe++)he.writeMessage(4,de,Ue[pe])}function W(Me,he){var pe=Me.feature;pe.id!==void 0&&he.writeVarintField(1,pe.id),he.writeMessage(2,Z,Me),he.writeVarintField(3,pe.type),he.writeMessage(4,ce,pe)}function Z(Me,he){var pe=Me.feature,Ee=Me.keys,Fe=Me.values,Ue=Me.keycache,We=Me.valuecache;for(var Ge in pe.properties){var ze=pe.properties[Ge],Ze=Ue[Ge];if(ze!==null){Ze===void 0&&(Ee.push(Ge),Ue[Ge]=Ze=Ee.length-1),he.writeVarint(Ze);var _t=typeof ze;_t!=="string"&&_t!=="boolean"&&_t!=="number"&&(ze=JSON.stringify(ze));var bt=_t+":"+ze,wt=We[bt];wt===void 0&&(Fe.push(ze),We[bt]=wt=Fe.length-1),he.writeVarint(wt)}}}function Q(Me,he){return(he<<3)+(7&Me)}function X(Me){return Me<<1^Me>>31}function ce(Me,he){for(var pe=Me.loadGeometry(),Ee=Me.type,Fe=0,Ue=0,We=pe.length,Ge=0;Ge<We;Ge++){var ze=pe[Ge],Ze=1;Ee===1&&(Ze=ze.length),he.writeVarint(Q(1,Ze));for(var _t=Ee===3?ze.length-1:ze.length,bt=0;bt<_t;bt++){bt===1&&Ee!==1&&he.writeVarint(Q(2,_t-1));var wt=ze[bt].x-Fe,wi=ze[bt].y-Ue;he.writeVarint(X(wt)),he.writeVarint(X(wi)),Fe+=wt,Ue+=wi}Ee===3&&he.writeVarint(Q(7,1))}}function de(Me,he){var pe=typeof Me;pe==="string"?he.writeStringField(1,Me):pe==="boolean"?he.writeBooleanField(7,Me):pe==="number"&&(Me%1!=0?he.writeDoubleField(3,Me):Me<0?he.writeSVarintField(6,Me):he.writeVarintField(5,Me))}T.exports=$,T.exports.fromVectorTileJs=$,T.exports.fromGeojsonVt=function(Me,he){he=he||{};var pe={};for(var Ee in Me)pe[Ee]=new U(Me[Ee].features,he),pe[Ee].name=Ee,pe[Ee].version=he.version,pe[Ee].extent=he.extent;return $({layers:pe})},T.exports.GeoJSONWrapper=U;var le=n.getDefaultExportFromCjs(T.exports);let te={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Me=>Me},ee=Math.fround||(oe=new Float32Array(1),Me=>(oe[0]=+Me,oe[0]));var oe;let ie=3,ne=5,me=6;class De{constructor(he){this.options=Object.assign(Object.create(te),he),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(he){let{log:pe,minZoom:Ee,maxZoom:Fe}=this.options;pe&&console.time("total time");let Ue=`prepare ${he.length} points`;pe&&console.time(Ue),this.points=he;let We=[];for(let ze=0;ze<he.length;ze++){let Ze=he[ze];if(!Ze.geometry)continue;let[_t,bt]=Ze.geometry.coordinates,wt=ee(ot(_t)),wi=ee(gt(bt));We.push(wt,wi,1/0,ze,-1,1),this.options.reduce&&We.push(0)}let Ge=this.trees[Fe+1]=this._createTree(We);pe&&console.timeEnd(Ue);for(let ze=Fe;ze>=Ee;ze--){let Ze=+Date.now();Ge=this.trees[ze]=this._createTree(this._cluster(Ge,ze)),pe&&console.log("z%d: %d clusters in %dms",ze,Ge.numItems,+Date.now()-Ze)}return pe&&console.timeEnd("total time"),this}getClusters(he,pe){let Ee=((he[0]+180)%360+360)%360-180,Fe=Math.max(-90,Math.min(90,he[1])),Ue=he[2]===180?180:((he[2]+180)%360+360)%360-180,We=Math.max(-90,Math.min(90,he[3]));if(he[2]-he[0]>=360)Ee=-180,Ue=180;else if(Ee>Ue){let bt=this.getClusters([Ee,Fe,180,We],pe),wt=this.getClusters([-180,Fe,Ue,We],pe);return bt.concat(wt)}let Ge=this.trees[this._limitZoom(pe)],ze=Ge.range(ot(Ee),gt(We),ot(Ue),gt(Fe)),Ze=Ge.data,_t=[];for(let bt of ze){let wt=this.stride*bt;_t.push(Ze[wt+ne]>1?He(Ze,wt,this.clusterProps):this.points[Ze[wt+ie]])}return _t}getChildren(he){let pe=this._getOriginId(he),Ee=this._getOriginZoom(he),Fe="No cluster with the specified id.",Ue=this.trees[Ee];if(!Ue)throw new Error(Fe);let We=Ue.data;if(pe*this.stride>=We.length)throw new Error(Fe);let Ge=this.options.radius/(this.options.extent*Math.pow(2,Ee-1)),ze=Ue.within(We[pe*this.stride],We[pe*this.stride+1],Ge),Ze=[];for(let _t of ze){let bt=_t*this.stride;We[bt+4]===he&&Ze.push(We[bt+ne]>1?He(We,bt,this.clusterProps):this.points[We[bt+ie]])}if(Ze.length===0)throw new Error(Fe);return Ze}getLeaves(he,pe,Ee){let Fe=[];return this._appendLeaves(Fe,he,pe=pe||10,Ee=Ee||0,0),Fe}getTile(he,pe,Ee){let Fe=this.trees[this._limitZoom(he)],Ue=Math.pow(2,he),{extent:We,radius:Ge}=this.options,ze=Ge/We,Ze=(Ee-ze)/Ue,_t=(Ee+1+ze)/Ue,bt={features:[]};return this._addTileFeatures(Fe.range((pe-ze)/Ue,Ze,(pe+1+ze)/Ue,_t),Fe.data,pe,Ee,Ue,bt),pe===0&&this._addTileFeatures(Fe.range(1-ze/Ue,Ze,1,_t),Fe.data,Ue,Ee,Ue,bt),pe===Ue-1&&this._addTileFeatures(Fe.range(0,Ze,ze/Ue,_t),Fe.data,-1,Ee,Ue,bt),bt.features.length?bt:null}getClusterExpansionZoom(he){let pe=this._getOriginZoom(he)-1;for(;pe<=this.options.maxZoom;){let Ee=this.getChildren(he);if(pe++,Ee.length!==1)break;he=Ee[0].properties.cluster_id}return pe}_appendLeaves(he,pe,Ee,Fe,Ue){let We=this.getChildren(pe);for(let Ge of We){let ze=Ge.properties;if(ze&&ze.cluster?Ue+ze.point_count<=Fe?Ue+=ze.point_count:Ue=this._appendLeaves(he,ze.cluster_id,Ee,Fe,Ue):Ue<Fe?Ue++:he.push(Ge),he.length===Ee)break}return Ue}_createTree(he){let pe=new n.KDBush(he.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ee=0;Ee<he.length;Ee+=this.stride)pe.add(he[Ee],he[Ee+1]);return pe.finish(),pe.data=he,pe}_addTileFeatures(he,pe,Ee,Fe,Ue,We){for(let Ge of he){let ze=Ge*this.stride,Ze=pe[ze+ne]>1,_t,bt,wt;if(Ze)_t=Je(pe,ze,this.clusterProps),bt=pe[ze],wt=pe[ze+1];else{let ni=this.points[pe[ze+ie]];_t=ni.properties;let[gi,Bi]=ni.geometry.coordinates;bt=ot(gi),wt=gt(Bi)}let wi={type:1,geometry:[[Math.round(this.options.extent*(bt*Ue-Ee)),Math.round(this.options.extent*(wt*Ue-Fe))]],tags:_t},$i;$i=Ze||this.options.generateId?pe[ze+ie]:this.points[pe[ze+ie]].id,$i!==void 0&&(wi.id=$i),We.features.push(wi)}}_limitZoom(he){return Math.max(this.options.minZoom,Math.min(Math.floor(+he),this.options.maxZoom+1))}_cluster(he,pe){let{radius:Ee,extent:Fe,reduce:Ue,minPoints:We}=this.options,Ge=Ee/(Fe*Math.pow(2,pe)),ze=he.data,Ze=[],_t=this.stride;for(let bt=0;bt<ze.length;bt+=_t){if(ze[bt+2]<=pe)continue;ze[bt+2]=pe;let wt=ze[bt],wi=ze[bt+1],$i=he.within(ze[bt],ze[bt+1],Ge),ni=ze[bt+ne],gi=ni;for(let Bi of $i){let xr=Bi*_t;ze[xr+2]>pe&&(gi+=ze[xr+ne])}if(gi>ni&&gi>=We){let Bi,xr=wt*ni,Lr=wi*ni,cr=-1,yr=((bt/_t|0)<<5)+(pe+1)+this.points.length;for(let so of $i){let Pi=so*_t;if(ze[Pi+2]<=pe)continue;ze[Pi+2]=pe;let Hs=ze[Pi+ne];xr+=ze[Pi]*Hs,Lr+=ze[Pi+1]*Hs,ze[Pi+4]=yr,Ue&&(Bi||(Bi=this._map(ze,bt,!0),cr=this.clusterProps.length,this.clusterProps.push(Bi)),Ue(Bi,this._map(ze,Pi)))}ze[bt+4]=yr,Ze.push(xr/gi,Lr/gi,1/0,yr,-1,gi),Ue&&Ze.push(cr)}else{for(let Bi=0;Bi<_t;Bi++)Ze.push(ze[bt+Bi]);if(gi>1)for(let Bi of $i){let xr=Bi*_t;if(!(ze[xr+2]<=pe)){ze[xr+2]=pe;for(let Lr=0;Lr<_t;Lr++)Ze.push(ze[xr+Lr])}}}}return Ze}_getOriginId(he){return he-this.points.length>>5}_getOriginZoom(he){return(he-this.points.length)%32}_map(he,pe,Ee){if(he[pe+ne]>1){let We=this.clusterProps[he[pe+me]];return Ee?Object.assign({},We):We}let Fe=this.points[he[pe+ie]].properties,Ue=this.options.map(Fe);return Ee&&Ue===Fe?Object.assign({},Ue):Ue}}function He(Me,he,pe){return{type:"Feature",id:Me[he+ie],properties:Je(Me,he,pe),geometry:{type:"Point",coordinates:[(Ee=Me[he],360*(Ee-.5)),vt(Me[he+1])]}};var Ee}function Je(Me,he,pe){let Ee=Me[he+ne],Fe=Ee>=1e4?`${Math.round(Ee/1e3)}k`:Ee>=1e3?Math.round(Ee/100)/10+"k":Ee,Ue=Me[he+me],We=Ue===-1?{}:Object.assign({},pe[Ue]);return Object.assign(We,{cluster:!0,cluster_id:Me[he+ie],point_count:Ee,point_count_abbreviated:Fe})}function ot(Me){return Me/360+.5}function gt(Me){let he=Math.sin(Me*Math.PI/180),pe=.5-.25*Math.log((1+he)/(1-he))/Math.PI;return pe<0?0:pe>1?1:pe}function vt(Me){let he=(180-360*Me)*Math.PI/180;return 360*Math.atan(Math.exp(he))/Math.PI-90}function ct(Me,he,pe,Ee){for(var Fe,Ue=Ee,We=pe-he>>1,Ge=pe-he,ze=Me[he],Ze=Me[he+1],_t=Me[pe],bt=Me[pe+1],wt=he+3;wt<pe;wt+=3){var wi=Se(Me[wt],Me[wt+1],ze,Ze,_t,bt);if(wi>Ue)Fe=wt,Ue=wi;else if(wi===Ue){var $i=Math.abs(wt-We);$i<Ge&&(Fe=wt,Ge=$i)}}Ue>Ee&&(Fe-he>3&&ct(Me,he,Fe,Ee),Me[Fe+2]=Ue,pe-Fe>3&&ct(Me,Fe,pe,Ee))}function Se(Me,he,pe,Ee,Fe,Ue){var We=Fe-pe,Ge=Ue-Ee;if(We!==0||Ge!==0){var ze=((Me-pe)*We+(he-Ee)*Ge)/(We*We+Ge*Ge);ze>1?(pe=Fe,Ee=Ue):ze>0&&(pe+=We*ze,Ee+=Ge*ze)}return(We=Me-pe)*We+(Ge=he-Ee)*Ge}function Qe(Me,he,pe,Ee){var Fe={id:Me===void 0?null:Me,type:he,geometry:pe,tags:Ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ue){var We=Ue.geometry,Ge=Ue.type;if(Ge==="Point"||Ge==="MultiPoint"||Ge==="LineString")xt(Ue,We);else if(Ge==="Polygon"||Ge==="MultiLineString")for(var ze=0;ze<We.length;ze++)xt(Ue,We[ze]);else if(Ge==="MultiPolygon")for(ze=0;ze<We.length;ze++)for(var Ze=0;Ze<We[ze].length;Ze++)xt(Ue,We[ze][Ze])}(Fe),Fe}function xt(Me,he){for(var pe=0;pe<he.length;pe+=3)Me.minX=Math.min(Me.minX,he[pe]),Me.minY=Math.min(Me.minY,he[pe+1]),Me.maxX=Math.max(Me.maxX,he[pe]),Me.maxY=Math.max(Me.maxY,he[pe+1])}function It(Me,he,pe,Ee){if(he.geometry){var Fe=he.geometry.coordinates,Ue=he.geometry.type,We=Math.pow(pe.tolerance/((1<<pe.maxZoom)*pe.extent),2),Ge=[],ze=he.id;if(pe.promoteId?ze=he.properties[pe.promoteId]:pe.generateId&&(ze=Ee||0),Ue==="Point")Gt(Fe,Ge);else if(Ue==="MultiPoint")for(var Ze=0;Ze<Fe.length;Ze++)Gt(Fe[Ze],Ge);else if(Ue==="LineString")Ni(Fe,Ge,We,!1);else if(Ue==="MultiLineString"){if(pe.lineMetrics){for(Ze=0;Ze<Fe.length;Ze++)Ni(Fe[Ze],Ge=[],We,!1),Me.push(Qe(ze,"LineString",Ge,he.properties));return}je(Fe,Ge,We,!1)}else if(Ue==="Polygon")je(Fe,Ge,We,!0);else{if(Ue!=="MultiPolygon"){if(Ue==="GeometryCollection"){for(Ze=0;Ze<he.geometry.geometries.length;Ze++)It(Me,{id:ze,geometry:he.geometry.geometries[Ze],properties:he.properties},pe,Ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ze=0;Ze<Fe.length;Ze++){var _t=[];je(Fe[Ze],_t,We,!0),Ge.push(_t)}}Me.push(Qe(ze,Ue,Ge,he.properties))}}function Gt(Me,he){he.push(be(Me[0])),he.push(ge(Me[1])),he.push(0)}function Ni(Me,he,pe,Ee){for(var Fe,Ue,We=0,Ge=0;Ge<Me.length;Ge++){var ze=be(Me[Ge][0]),Ze=ge(Me[Ge][1]);he.push(ze),he.push(Ze),he.push(0),Ge>0&&(We+=Ee?(Fe*Ze-ze*Ue)/2:Math.sqrt(Math.pow(ze-Fe,2)+Math.pow(Ze-Ue,2))),Fe=ze,Ue=Ze}var _t=he.length-3;he[2]=1,ct(he,0,_t,pe),he[_t+2]=1,he.size=Math.abs(We),he.start=0,he.end=he.size}function je(Me,he,pe,Ee){for(var Fe=0;Fe<Me.length;Fe++){var Ue=[];Ni(Me[Fe],Ue,pe,Ee),he.push(Ue)}}function be(Me){return Me/360+.5}function ge(Me){var he=Math.sin(Me*Math.PI/180),pe=.5-.25*Math.log((1+he)/(1-he))/Math.PI;return pe<0?0:pe>1?1:pe}function xe(Me,he,pe,Ee,Fe,Ue,We,Ge){if(Ee/=he,Ue>=(pe/=he)&&We<Ee)return Me;if(We<pe||Ue>=Ee)return null;for(var ze=[],Ze=0;Ze<Me.length;Ze++){var _t=Me[Ze],bt=_t.geometry,wt=_t.type,wi=Fe===0?_t.minX:_t.minY,$i=Fe===0?_t.maxX:_t.maxY;if(wi>=pe&&$i<Ee)ze.push(_t);else if(!($i<pe||wi>=Ee)){var ni=[];if(wt==="Point"||wt==="MultiPoint")Pe(bt,ni,pe,Ee,Fe);else if(wt==="LineString")Oe(bt,ni,pe,Ee,Fe,!1,Ge.lineMetrics);else if(wt==="MultiLineString")nt(bt,ni,pe,Ee,Fe,!1);else if(wt==="Polygon")nt(bt,ni,pe,Ee,Fe,!0);else if(wt==="MultiPolygon")for(var gi=0;gi<bt.length;gi++){var Bi=[];nt(bt[gi],Bi,pe,Ee,Fe,!0),Bi.length&&ni.push(Bi)}if(ni.length){if(Ge.lineMetrics&&wt==="LineString"){for(gi=0;gi<ni.length;gi++)ze.push(Qe(_t.id,wt,ni[gi],_t.tags));continue}wt!=="LineString"&&wt!=="MultiLineString"||(ni.length===1?(wt="LineString",ni=ni[0]):wt="MultiLineString"),wt!=="Point"&&wt!=="MultiPoint"||(wt=ni.length===3?"Point":"MultiPoint"),ze.push(Qe(_t.id,wt,ni,_t.tags))}}}return ze.length?ze:null}function Pe(Me,he,pe,Ee,Fe){for(var Ue=0;Ue<Me.length;Ue+=3){var We=Me[Ue+Fe];We>=pe&&We<=Ee&&(he.push(Me[Ue]),he.push(Me[Ue+1]),he.push(Me[Ue+2]))}}function Oe(Me,he,pe,Ee,Fe,Ue,We){for(var Ge,ze,Ze=Ie(Me),_t=Fe===0?Ht:hi,bt=Me.start,wt=0;wt<Me.length-3;wt+=3){var wi=Me[wt],$i=Me[wt+1],ni=Me[wt+2],gi=Me[wt+3],Bi=Me[wt+4],xr=Fe===0?wi:$i,Lr=Fe===0?gi:Bi,cr=!1;We&&(Ge=Math.sqrt(Math.pow(wi-gi,2)+Math.pow($i-Bi,2))),xr<pe?Lr>pe&&(ze=_t(Ze,wi,$i,gi,Bi,pe),We&&(Ze.start=bt+Ge*ze)):xr>Ee?Lr<Ee&&(ze=_t(Ze,wi,$i,gi,Bi,Ee),We&&(Ze.start=bt+Ge*ze)):ht(Ze,wi,$i,ni),Lr<pe&&xr>=pe&&(ze=_t(Ze,wi,$i,gi,Bi,pe),cr=!0),Lr>Ee&&xr<=Ee&&(ze=_t(Ze,wi,$i,gi,Bi,Ee),cr=!0),!Ue&&cr&&(We&&(Ze.end=bt+Ge*ze),he.push(Ze),Ze=Ie(Me)),We&&(bt+=Ge)}var yr=Me.length-3;wi=Me[yr],$i=Me[yr+1],ni=Me[yr+2],(xr=Fe===0?wi:$i)>=pe&&xr<=Ee&&ht(Ze,wi,$i,ni),yr=Ze.length-3,Ue&&yr>=3&&(Ze[yr]!==Ze[0]||Ze[yr+1]!==Ze[1])&&ht(Ze,Ze[0],Ze[1],Ze[2]),Ze.length&&he.push(Ze)}function Ie(Me){var he=[];return he.size=Me.size,he.start=Me.start,he.end=Me.end,he}function nt(Me,he,pe,Ee,Fe,Ue){for(var We=0;We<Me.length;We++)Oe(Me[We],he,pe,Ee,Fe,Ue,!1)}function ht(Me,he,pe,Ee){Me.push(he),Me.push(pe),Me.push(Ee)}function Ht(Me,he,pe,Ee,Fe,Ue){var We=(Ue-he)/(Ee-he);return Me.push(Ue),Me.push(pe+(Fe-pe)*We),Me.push(1),We}function hi(Me,he,pe,Ee,Fe,Ue){var We=(Ue-pe)/(Fe-pe);return Me.push(he+(Ee-he)*We),Me.push(Ue),Me.push(1),We}function at(Me,he){for(var pe=[],Ee=0;Ee<Me.length;Ee++){var Fe,Ue=Me[Ee],We=Ue.type;if(We==="Point"||We==="MultiPoint"||We==="LineString")Fe=Ot(Ue.geometry,he);else if(We==="MultiLineString"||We==="Polygon"){Fe=[];for(var Ge=0;Ge<Ue.geometry.length;Ge++)Fe.push(Ot(Ue.geometry[Ge],he))}else if(We==="MultiPolygon")for(Fe=[],Ge=0;Ge<Ue.geometry.length;Ge++){for(var ze=[],Ze=0;Ze<Ue.geometry[Ge].length;Ze++)ze.push(Ot(Ue.geometry[Ge][Ze],he));Fe.push(ze)}pe.push(Qe(Ue.id,We,Fe,Ue.tags))}return pe}function Ot(Me,he){var pe=[];pe.size=Me.size,Me.start!==void 0&&(pe.start=Me.start,pe.end=Me.end);for(var Ee=0;Ee<Me.length;Ee+=3)pe.push(Me[Ee]+he,Me[Ee+1],Me[Ee+2]);return pe}function Pt(Me,he){if(Me.transformed)return Me;var pe,Ee,Fe,Ue=1<<Me.z,We=Me.x,Ge=Me.y;for(pe=0;pe<Me.features.length;pe++){var ze=Me.features[pe],Ze=ze.geometry,_t=ze.type;if(ze.geometry=[],_t===1)for(Ee=0;Ee<Ze.length;Ee+=2)ze.geometry.push(Zi(Ze[Ee],Ze[Ee+1],he,Ue,We,Ge));else for(Ee=0;Ee<Ze.length;Ee++){var bt=[];for(Fe=0;Fe<Ze[Ee].length;Fe+=2)bt.push(Zi(Ze[Ee][Fe],Ze[Ee][Fe+1],he,Ue,We,Ge));ze.geometry.push(bt)}}return Me.transformed=!0,Me}function Zi(Me,he,pe,Ee,Fe,Ue){return[Math.round(pe*(Me*Ee-Fe)),Math.round(pe*(he*Ee-Ue))]}function ji(Me,he,pe,Ee,Fe){for(var Ue=he===Fe.maxZoom?0:Fe.tolerance/((1<<he)*Fe.extent),We={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:pe,y:Ee,z:he,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ge=0;Ge<Me.length;Ge++){We.numFeatures++,Ke(We,Me[Ge],Ue,Fe);var ze=Me[Ge].minX,Ze=Me[Ge].minY,_t=Me[Ge].maxX,bt=Me[Ge].maxY;ze<We.minX&&(We.minX=ze),Ze<We.minY&&(We.minY=Ze),_t>We.maxX&&(We.maxX=_t),bt>We.maxY&&(We.maxY=bt)}return We}function Ke(Me,he,pe,Ee){var Fe=he.geometry,Ue=he.type,We=[];if(Ue==="Point"||Ue==="MultiPoint")for(var Ge=0;Ge<Fe.length;Ge+=3)We.push(Fe[Ge]),We.push(Fe[Ge+1]),Me.numPoints++,Me.numSimplified++;else if(Ue==="LineString")dt(We,Fe,Me,pe,!1,!1);else if(Ue==="MultiLineString"||Ue==="Polygon")for(Ge=0;Ge<Fe.length;Ge++)dt(We,Fe[Ge],Me,pe,Ue==="Polygon",Ge===0);else if(Ue==="MultiPolygon")for(var ze=0;ze<Fe.length;ze++){var Ze=Fe[ze];for(Ge=0;Ge<Ze.length;Ge++)dt(We,Ze[Ge],Me,pe,!0,Ge===0)}if(We.length){var _t=he.tags||null;if(Ue==="LineString"&&Ee.lineMetrics){for(var bt in _t={},he.tags)_t[bt]=he.tags[bt];_t.mapbox_clip_start=Fe.start/Fe.size,_t.mapbox_clip_end=Fe.end/Fe.size}var wt={geometry:We,type:Ue==="Polygon"||Ue==="MultiPolygon"?3:Ue==="LineString"||Ue==="MultiLineString"?2:1,tags:_t};he.id!==null&&(wt.id=he.id),Me.features.push(wt)}}function dt(Me,he,pe,Ee,Fe,Ue){var We=Ee*Ee;if(Ee>0&&he.size<(Fe?We:Ee))pe.numPoints+=he.length/3;else{for(var Ge=[],ze=0;ze<he.length;ze+=3)(Ee===0||he[ze+2]>We)&&(pe.numSimplified++,Ge.push(he[ze]),Ge.push(he[ze+1])),pe.numPoints++;Fe&&function(Ze,_t){for(var bt=0,wt=0,wi=Ze.length,$i=wi-2;wt<wi;$i=wt,wt+=2)bt+=(Ze[wt]-Ze[$i])*(Ze[wt+1]+Ze[$i+1]);if(bt>0===_t)for(wt=0,wi=Ze.length;wt<wi/2;wt+=2){var ni=Ze[wt],gi=Ze[wt+1];Ze[wt]=Ze[wi-2-wt],Ze[wt+1]=Ze[wi-1-wt],Ze[wi-2-wt]=ni,Ze[wi-1-wt]=gi}}(Ge,Ue),Me.push(Ge)}}function Lt(Me,he){var pe=(he=this.options=function(Fe,Ue){for(var We in Ue)Fe[We]=Ue[We];return Fe}(Object.create(this.options),he)).debug;if(pe&&console.time("preprocess data"),he.maxZoom<0||he.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(he.promoteId&&he.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ee=function(Fe,Ue){var We=[];if(Fe.type==="FeatureCollection")for(var Ge=0;Ge<Fe.features.length;Ge++)It(We,Fe.features[Ge],Ue,Ge);else It(We,Fe.type==="Feature"?Fe:{geometry:Fe},Ue);return We}(Me,he);this.tiles={},this.tileCoords=[],pe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",he.indexMaxZoom,he.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ee=function(Fe,Ue){var We=Ue.buffer/Ue.extent,Ge=Fe,ze=xe(Fe,1,-1-We,We,0,-1,2,Ue),Ze=xe(Fe,1,1-We,2+We,0,-1,2,Ue);return(ze||Ze)&&(Ge=xe(Fe,1,-We,1+We,0,-1,2,Ue)||[],ze&&(Ge=at(ze,1).concat(Ge)),Ze&&(Ge=Ge.concat(at(Ze,-1)))),Ge}(Ee,he),Ee.length&&this.splitTile(Ee,0,0,0),pe&&(Ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Yt(Me,he,pe){return 32*((1<<Me)*pe+he)+Me}function Kt(Me,he){return he?Me.properties[he]:Me.id}function Fi(Me,he){if(Me==null)return!0;if(Me.type==="Feature")return Kt(Me,he)!=null;if(Me.type==="FeatureCollection"){let pe=new Set;for(let Ee of Me.features){let Fe=Kt(Ee,he);if(Fe==null||pe.has(Fe))return!1;pe.add(Fe)}return!0}return!1}function Ir(Me,he){let pe=new Map;if(Me!=null)if(Me.type==="Feature")pe.set(Kt(Me,he),Me);else for(let Ee of Me.features)pe.set(Kt(Ee,he),Ee);return pe}function Qi(Me,he){let pe=Me.tileID.canonical;if(!this._geoJSONIndex)return he(null,null);let Ee=this._geoJSONIndex.getTile(pe.z,pe.x,pe.y);if(!Ee)return he(null,null);let Fe=new class{constructor(We){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.EXTENT,this.length=We.length,this._features=We}feature(We){return new class{constructor(Ge){this._feature=Ge,this.extent=n.EXTENT,this.type=Ge.type,this.properties=Ge.tags,"id"in Ge&&!isNaN(Ge.id)&&(this.id=parseInt(Ge.id,10))}loadGeometry(){if(this._feature.type===1){let Ge=[];for(let ze of this._feature.geometry)Ge.push([new n.Point(ze[0],ze[1])]);return Ge}{let Ge=[];for(let ze of this._feature.geometry){let Ze=[];for(let _t of ze)Ze.push(new n.Point(_t[0],_t[1]));Ge.push(Ze)}return Ge}}toGeoJSON(Ge,ze,Ze){return b.call(this,Ge,ze,Ze)}}(this._features[We])}}(Ee.features),Ue=le(Fe);Ue.byteOffset===0&&Ue.byteLength===Ue.buffer.byteLength||(Ue=new Uint8Array(Ue)),he(null,{vectorTile:Fe,rawData:Ue.buffer})}Lt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Lt.prototype.splitTile=function(Me,he,pe,Ee,Fe,Ue,We){for(var Ge=[Me,he,pe,Ee],ze=this.options,Ze=ze.debug;Ge.length;){Ee=Ge.pop(),pe=Ge.pop(),he=Ge.pop(),Me=Ge.pop();var _t=1<<he,bt=Yt(he,pe,Ee),wt=this.tiles[bt];if(!wt&&(Ze>1&&console.time("creation"),wt=this.tiles[bt]=ji(Me,he,pe,Ee,ze),this.tileCoords.push({z:he,x:pe,y:Ee}),Ze)){Ze>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",he,pe,Ee,wt.numFeatures,wt.numPoints,wt.numSimplified),console.timeEnd("creation"));var wi="z"+he;this.stats[wi]=(this.stats[wi]||0)+1,this.total++}if(wt.source=Me,Fe){if(he===ze.maxZoom||he===Fe)continue;var $i=1<<Fe-he;if(pe!==Math.floor(Ue/$i)||Ee!==Math.floor(We/$i))continue}else if(he===ze.indexMaxZoom||wt.numPoints<=ze.indexMaxPoints)continue;if(wt.source=null,Me.length!==0){Ze>1&&console.time("clipping");var ni,gi,Bi,xr,Lr,cr,yr=.5*ze.buffer/ze.extent,so=.5-yr,Pi=.5+yr,Hs=1+yr;ni=gi=Bi=xr=null,Lr=xe(Me,_t,pe-yr,pe+Pi,0,wt.minX,wt.maxX,ze),cr=xe(Me,_t,pe+so,pe+Hs,0,wt.minX,wt.maxX,ze),Me=null,Lr&&(ni=xe(Lr,_t,Ee-yr,Ee+Pi,1,wt.minY,wt.maxY,ze),gi=xe(Lr,_t,Ee+so,Ee+Hs,1,wt.minY,wt.maxY,ze),Lr=null),cr&&(Bi=xe(cr,_t,Ee-yr,Ee+Pi,1,wt.minY,wt.maxY,ze),xr=xe(cr,_t,Ee+so,Ee+Hs,1,wt.minY,wt.maxY,ze),cr=null),Ze>1&&console.timeEnd("clipping"),Ge.push(ni||[],he+1,2*pe,2*Ee),Ge.push(gi||[],he+1,2*pe,2*Ee+1),Ge.push(Bi||[],he+1,2*pe+1,2*Ee),Ge.push(xr||[],he+1,2*pe+1,2*Ee+1)}}},Lt.prototype.getTile=function(Me,he,pe){var Ee=this.options,Fe=Ee.extent,Ue=Ee.debug;if(Me<0||Me>24)return null;var We=1<<Me,Ge=Yt(Me,he=(he%We+We)%We,pe);if(this.tiles[Ge])return Pt(this.tiles[Ge],Fe);Ue>1&&console.log("drilling down to z%d-%d-%d",Me,he,pe);for(var ze,Ze=Me,_t=he,bt=pe;!ze&&Ze>0;)Ze--,_t=Math.floor(_t/2),bt=Math.floor(bt/2),ze=this.tiles[Yt(Ze,_t,bt)];return ze&&ze.source?(Ue>1&&console.log("found parent tile z%d-%d-%d",Ze,_t,bt),Ue>1&&console.time("drilling down"),this.splitTile(ze.source,Ze,_t,bt,Me,he,pe),Ue>1&&console.timeEnd("drilling down"),this.tiles[Ge]?Pt(this.tiles[Ge],Fe):null):null};class ys extends m{constructor(he,pe,Ee,Fe){super(he,pe,Ee,Qi),this._dataUpdateable=new Map,this.loadGeoJSON=(Ue,We)=>{let{promoteId:Ge}=Ue;if(Ue.request)return n.getJSON(Ue.request,(ze,Ze,_t,bt)=>{this._dataUpdateable=Fi(Ze,Ge)?Ir(Ze,Ge):void 0,We(ze,Ze,_t,bt)});if(typeof Ue.data=="string")try{let ze=JSON.parse(Ue.data);this._dataUpdateable=Fi(ze,Ge)?Ir(ze,Ge):void 0,We(null,ze)}catch{We(new Error(`Input data given to '${Ue.source}' is not a valid GeoJSON object.`))}else Ue.dataDiff?this._dataUpdateable?(function(ze,Ze,_t){var bt,wt,wi,$i;if(Ze.removeAll&&ze.clear(),Ze.remove)for(let ni of Ze.remove)ze.delete(ni);if(Ze.add)for(let ni of Ze.add){let gi=Kt(ni,_t);gi!=null&&ze.set(gi,ni)}if(Ze.update)for(let ni of Ze.update){let gi=ze.get(ni.id);if(gi==null)continue;let Bi=!ni.removeAllProperties&&(((bt=ni.removeProperties)===null||bt===void 0?void 0:bt.length)>0||((wt=ni.addOrUpdateProperties)===null||wt===void 0?void 0:wt.length)>0);if((ni.newGeometry||ni.removeAllProperties||Bi)&&(gi={...gi},ze.set(ni.id,gi),Bi&&(gi.properties={...gi.properties})),ni.newGeometry&&(gi.geometry=ni.newGeometry),ni.removeAllProperties)gi.properties={};else if(((wi=ni.removeProperties)===null||wi===void 0?void 0:wi.length)>0)for(let xr of ni.removeProperties)Object.prototype.hasOwnProperty.call(gi.properties,xr)&&delete gi.properties[xr];if((($i=ni.addOrUpdateProperties)===null||$i===void 0?void 0:$i.length)>0)for(let{key:xr,value:Lr}of ni.addOrUpdateProperties)gi.properties[xr]=Lr}}(this._dataUpdateable,Ue.dataDiff,Ge),We(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):We(new Error(`Cannot update existing geojson data in ${Ue.source}`)):We(new Error(`Input data given to '${Ue.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},Fe&&(this.loadGeoJSON=Fe)}loadData(he,pe){var Ee;(Ee=this._pendingRequest)===null||Ee===void 0||Ee.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});let Fe=!!(he&&he.request&&he.request.collectResourceTiming)&&new n.RequestPerformance(he.request);this._pendingCallback=pe,this._pendingRequest=this.loadGeoJSON(he,(Ue,We)=>{if(delete this._pendingCallback,delete this._pendingRequest,Ue||!We)return pe(Ue);if(typeof We!="object")return pe(new Error(`Input data given to '${he.source}' is not a valid GeoJSON object.`));{E(We,!0);try{if(he.filter){let ze=n.createExpression(he.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ze.result==="error")throw new Error(ze.value.map(_t=>`${_t.key}: ${_t.message}`).join(", "));We={type:"FeatureCollection",features:We.features.filter(_t=>ze.value.evaluate({zoom:0},_t))}}this._geoJSONIndex=he.cluster?new De(function({superclusterOptions:ze,clusterProperties:Ze}){if(!Ze||!ze)return ze;let _t={},bt={},wt={accumulated:null,zoom:0},wi={properties:null},$i=Object.keys(Ze);for(let ni of $i){let[gi,Bi]=Ze[ni],xr=n.createExpression(Bi),Lr=n.createExpression(typeof gi=="string"?[gi,["accumulated"],["get",ni]]:gi);_t[ni]=xr.value,bt[ni]=Lr.value}return ze.map=ni=>{wi.properties=ni;let gi={};for(let Bi of $i)gi[Bi]=_t[Bi].evaluate(wt,wi);return gi},ze.reduce=(ni,gi)=>{wi.properties=gi;for(let Bi of $i)wt.accumulated=ni[Bi],ni[Bi]=bt[Bi].evaluate(wt,wi)},ze}(he)).load(We.features):function(ze,Ze){return new Lt(ze,Ze)}(We,he.geojsonVtOptions)}catch(ze){return pe(ze)}this.loaded={};let Ge={};if(Fe){let ze=Fe.finish();ze&&(Ge.resourceTiming={},Ge.resourceTiming[he.source]=JSON.parse(JSON.stringify(ze)))}pe(null,Ge)}})}reloadTile(he,pe){let Ee=this.loaded;return Ee&&Ee[he.uid]?super.reloadTile(he,pe):this.loadTile(he,pe)}removeSource(he,pe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),pe()}getClusterExpansionZoom(he,pe){try{pe(null,this._geoJSONIndex.getClusterExpansionZoom(he.clusterId))}catch(Ee){pe(Ee)}}getClusterChildren(he,pe){try{pe(null,this._geoJSONIndex.getChildren(he.clusterId))}catch(Ee){pe(Ee)}}getClusterLeaves(he,pe){try{pe(null,this._geoJSONIndex.getLeaves(he.clusterId,he.limit,he.offset))}catch(Ee){pe(Ee)}}}class ls{constructor(he){this.self=he,this.actor=new n.Actor(he,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:m,geojson:ys},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(pe,Ee)=>{if(this.workerSourceTypes[pe])throw new Error(`Worker source with name "${pe}" already registered.`);this.workerSourceTypes[pe]=Ee},this.self.registerRTLTextPlugin=pe=>{if(n.plugin.isParsed())throw new Error("RTL text plugin already registered.");n.plugin.applyArabicShaping=pe.applyArabicShaping,n.plugin.processBidirectionalText=pe.processBidirectionalText,n.plugin.processStyledBidirectionalText=pe.processStyledBidirectionalText}}setReferrer(he,pe){this.referrer=pe}setImages(he,pe,Ee){this.availableImages[he]=pe;for(let Fe in this.workerSources[he]){let Ue=this.workerSources[he][Fe];for(let We in Ue)Ue[We].availableImages=pe}Ee()}setLayers(he,pe,Ee){this.getLayerIndex(he).replace(pe),Ee()}updateLayers(he,pe,Ee){this.getLayerIndex(he).update(pe.layers,pe.removedIds),Ee()}loadTile(he,pe,Ee){this.getWorkerSource(he,pe.type,pe.source).loadTile(pe,Ee)}loadDEMTile(he,pe,Ee){this.getDEMWorkerSource(he,pe.source).loadTile(pe,Ee)}reloadTile(he,pe,Ee){this.getWorkerSource(he,pe.type,pe.source).reloadTile(pe,Ee)}abortTile(he,pe,Ee){this.getWorkerSource(he,pe.type,pe.source).abortTile(pe,Ee)}removeTile(he,pe,Ee){this.getWorkerSource(he,pe.type,pe.source).removeTile(pe,Ee)}removeDEMTile(he,pe){this.getDEMWorkerSource(he,pe.source).removeTile(pe)}removeSource(he,pe,Ee){if(!this.workerSources[he]||!this.workerSources[he][pe.type]||!this.workerSources[he][pe.type][pe.source])return;let Fe=this.workerSources[he][pe.type][pe.source];delete this.workerSources[he][pe.type][pe.source],Fe.removeSource!==void 0?Fe.removeSource(pe,Ee):Ee()}loadWorkerSource(he,pe,Ee){try{this.self.importScripts(pe.url),Ee()}catch(Fe){Ee(Fe.toString())}}syncRTLPluginState(he,pe,Ee){try{n.plugin.setState(pe);let Fe=n.plugin.getPluginURL();if(n.plugin.isLoaded()&&!n.plugin.isParsed()&&Fe!=null){this.self.importScripts(Fe);let Ue=n.plugin.isParsed();Ee(Ue?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Fe}`),Ue)}}catch(Fe){Ee(Fe.toString())}}getAvailableImages(he){let pe=this.availableImages[he];return pe||(pe=[]),pe}getLayerIndex(he){let pe=this.layerIndexes[he];return pe||(pe=this.layerIndexes[he]=new o),pe}getWorkerSource(he,pe,Ee){if(this.workerSources[he]||(this.workerSources[he]={}),this.workerSources[he][pe]||(this.workerSources[he][pe]={}),!this.workerSources[he][pe][Ee]){let Fe={send:(Ue,We,Ge)=>{this.actor.send(Ue,We,Ge,he)}};this.workerSources[he][pe][Ee]=new this.workerSourceTypes[pe](Fe,this.getLayerIndex(he),this.getAvailableImages(he))}return this.workerSources[he][pe][Ee]}getDEMWorkerSource(he,pe){return this.demWorkerSources[he]||(this.demWorkerSources[he]={}),this.demWorkerSources[he][pe]||(this.demWorkerSources[he][pe]=new g),this.demWorkerSources[he][pe]}}return n.isWorker()&&(self.worker=new ls(self)),ls}),r(["./shared"],function(n){"use strict";var o="3.3.1";class a{static testProp(h){if(!a.docStyle)return h[0];for(let x=0;x<h.length;x++)if(h[x]in a.docStyle)return h[x];return h[0]}static create(h,x,S){let I=window.document.createElement(h);return x!==void 0&&(I.className=x),S&&S.appendChild(I),I}static createNS(h,x){return window.document.createElementNS(h,x)}static disableDrag(){a.docStyle&&a.selectProp&&(a.userSelect=a.docStyle[a.selectProp],a.docStyle[a.selectProp]="none")}static enableDrag(){a.docStyle&&a.selectProp&&(a.docStyle[a.selectProp]=a.userSelect)}static setTransform(h,x){h.style[a.transformProp]=x}static addEventListener(h,x,S,I={}){h.addEventListener(x,S,"passive"in I?I:I.capture)}static removeEventListener(h,x,S,I={}){h.removeEventListener(x,S,"passive"in I?I:I.capture)}static suppressClickInternal(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",a.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",a.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",a.suppressClickInternal,!0)},0)}static mousePos(h,x){let S=h.getBoundingClientRect();return new n.Point(x.clientX-S.left-h.clientLeft,x.clientY-S.top-h.clientTop)}static touchPos(h,x){let S=h.getBoundingClientRect(),I=[];for(let D=0;D<x.length;D++)I.push(new n.Point(x[D].clientX-S.left-h.clientLeft,x[D].clientY-S.top-h.clientTop));return I}static mouseButton(h){return h.button}static remove(h){h.parentNode&&h.parentNode.removeChild(h)}}a.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,a.selectProp=a.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),a.transformProp=a.testProp(["transform","WebkitTransform"]);let l={supported:!1,testSupport:function(P){!m&&d&&(g?_(P):u=P)}},u,d,m=!1,g=!1;function _(P){let h=P.createTexture();P.bindTexture(P.TEXTURE_2D,h);try{if(P.texImage2D(P.TEXTURE_2D,0,P.RGBA,P.RGBA,P.UNSIGNED_BYTE,d),P.isContextLost())return;l.supported=!0}catch{}P.deleteTexture(h),m=!0}var v,E;typeof document<"u"&&(d=document.createElement("img"),d.onload=function(){u&&_(u),u=null,g=!0},d.onerror=function(){m=!0,u=null},d.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(P){let h,x,S,I;P.resetRequestQueue=()=>{h=[],x=0,S=0,I={}},P.addThrottleControl=J=>{let re=S++;return I[re]=J,re},P.removeThrottleControl=J=>{delete I[J],H()},P.getImage=(J,re,ae=!0)=>{l.supported&&(J.headers||(J.headers={}),J.headers.accept="image/webp,*/*");let _e={requestParameters:J,supportImageRefresh:ae,callback:re,cancelled:!1,completed:!1,cancel:()=>{_e.completed||_e.cancelled||(_e.cancelled=!0,_e.innerRequest&&(_e.innerRequest.cancel(),x--),H())}};return h.push(_e),H(),_e};let D=J=>{let{requestParameters:re,supportImageRefresh:ae,callback:_e}=J;return n.extend(re,{type:"image"}),(ae!==!1||n.isWorker()||n.getProtocolAction(re.url)||re.headers&&!Object.keys(re.headers).reduce((Ce,Ae)=>Ce&&Ae==="accept",!0)?n.makeRequest:Y)(re,(Ce,Ae,Re,Te)=>{G(J,_e,Ce,Ae,Re,Te)})},G=(J,re,ae,_e,Ce,Ae)=>{ae?re(ae):_e instanceof HTMLImageElement||n.isImageBitmap(_e)?re(null,_e):_e&&((Re,Te)=>{typeof createImageBitmap=="function"?n.arrayBufferToImageBitmap(Re,Te):n.arrayBufferToImage(Re,Te)})(_e,(Re,Te)=>{Re!=null?re(Re):Te!=null&&re(null,Te,{cacheControl:Ce,expires:Ae})}),J.cancelled||(J.completed=!0,x--,H())},H=()=>{let J=(()=>{let re=Object.keys(I),ae=!1;if(re.length>0){for(let _e of re)if(ae=I[_e](),ae)break}return ae})()?n.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:n.config.MAX_PARALLEL_IMAGE_REQUESTS;for(let re=x;re<J&&h.length>0;re++){let ae=h.shift();if(ae.cancelled){re--;continue}let _e=D(ae);x++,ae.innerRequest=_e}},Y=(J,re)=>{let ae=new Image,_e=J.url,Ce=!1,Ae=J.credentials;return Ae&&Ae==="include"?ae.crossOrigin="use-credentials":(Ae&&Ae==="same-origin"||!n.sameOrigin(_e))&&(ae.crossOrigin="anonymous"),ae.fetchPriority="high",ae.onload=()=>{re(null,ae),ae.onerror=ae.onload=null},ae.onerror=()=>{Ce||re(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),ae.onerror=ae.onload=null},ae.src=_e,{cancel:()=>{Ce=!0,ae.src=""}}}}(v||(v={})),v.resetRequestQueue(),function(P){P.Glyphs="Glyphs",P.Image="Image",P.Source="Source",P.SpriteImage="SpriteImage",P.SpriteJSON="SpriteJSON",P.Style="Style",P.Tile="Tile",P.Unknown="Unknown"}(E||(E={}));class b{constructor(h){this._transformRequestFn=h}transformRequest(h,x){return this._transformRequestFn&&this._transformRequestFn(h,x)||{url:h}}normalizeSpriteURL(h,x,S){let I=function(D){let G=D.match(T);if(!G)throw new Error(`Unable to parse URL "${D}"`);return{protocol:G[1],authority:G[2],path:G[3]||"/",params:G[4]?G[4].split("&"):[]}}(h);return I.path+=`${x}${S}`,function(D){let G=D.params.length?`?${D.params.join("&")}`:"";return`${D.protocol}://${D.authority}${D.path}${G}`}(I)}setTransformRequest(h){this._transformRequestFn=h}}let T=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function A(P){var h=new n.ARRAY_TYPE(3);return h[0]=P[0],h[1]=P[1],h[2]=P[2],h}var M,k=function(P,h,x){return P[0]=h[0]-x[0],P[1]=h[1]-x[1],P[2]=h[2]-x[2],P};M=new n.ARRAY_TYPE(3),n.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0);var F=function(P){var h=P[0],x=P[1];return h*h+x*x};function O(P){let h=[];if(typeof P=="string")h.push({id:"default",url:P});else if(P&&P.length>0){let x=[];for(let{id:S,url:I}of P){let D=`${S}${I}`;x.indexOf(D)===-1&&(x.push(D),h.push({id:S,url:I}))}}return h}function B(P,h,x,S,I){if(S)return void P(S);if(I!==Object.values(h).length||I!==Object.values(x).length)return;let D={};for(let G in h){D[G]={};let H=n.browser.getImageCanvasContext(x[G]),Y=h[G];for(let J in Y){let{width:re,height:ae,x:_e,y:Ce,sdf:Ae,pixelRatio:Re,stretchX:Te,stretchY:Ve,content:tt}=Y[J];D[G][J]={data:null,pixelRatio:Re,sdf:Ae,stretchX:Te,stretchY:Ve,content:tt,spriteData:{width:re,height:ae,x:_e,y:Ce,context:H}}}}P(null,D)}(function(){var P=new n.ARRAY_TYPE(2);n.ARRAY_TYPE!=Float32Array&&(P[0]=0,P[1]=0)})();class U{constructor(h,x,S,I){this.context=h,this.format=S,this.texture=h.gl.createTexture(),this.update(x,I)}update(h,x,S){let{width:I,height:D}=h,G=!(this.size&&this.size[0]===I&&this.size[1]===D||S),{context:H}=this,{gl:Y}=H;if(this.useMipmap=!!(x&&x.useMipmap),Y.bindTexture(Y.TEXTURE_2D,this.texture),H.pixelStoreUnpackFlipY.set(!1),H.pixelStoreUnpack.set(1),H.pixelStoreUnpackPremultiplyAlpha.set(this.format===Y.RGBA&&(!x||x.premultiply!==!1)),G)this.size=[I,D],h instanceof HTMLImageElement||h instanceof HTMLCanvasElement||h instanceof HTMLVideoElement||h instanceof ImageData||n.isImageBitmap(h)?Y.texImage2D(Y.TEXTURE_2D,0,this.format,this.format,Y.UNSIGNED_BYTE,h):Y.texImage2D(Y.TEXTURE_2D,0,this.format,I,D,0,this.format,Y.UNSIGNED_BYTE,h.data);else{let{x:J,y:re}=S||{x:0,y:0};h instanceof HTMLImageElement||h instanceof HTMLCanvasElement||h instanceof HTMLVideoElement||h instanceof ImageData||n.isImageBitmap(h)?Y.texSubImage2D(Y.TEXTURE_2D,0,J,re,Y.RGBA,Y.UNSIGNED_BYTE,h):Y.texSubImage2D(Y.TEXTURE_2D,0,J,re,I,D,Y.RGBA,Y.UNSIGNED_BYTE,h.data)}this.useMipmap&&this.isSizePowerOfTwo()&&Y.generateMipmap(Y.TEXTURE_2D)}bind(h,x,S){let{context:I}=this,{gl:D}=I;D.bindTexture(D.TEXTURE_2D,this.texture),S!==D.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(S=D.LINEAR),h!==this.filter&&(D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,h),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,S||h),this.filter=h),x!==this.wrap&&(D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,x),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,x),this.wrap=x)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:h}=this.context;h.deleteTexture(this.texture),this.texture=null}}function $(P){let{userImage:h}=P;return!!(h&&h.render&&h.render())&&(P.data.replace(new Uint8Array(h.data.buffer)),!0)}class q extends n.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new n.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(h){if(this.loaded!==h&&(this.loaded=h,h)){for(let{ids:x,callback:S}of this.requestors)this._notify(x,S);this.requestors=[]}}getImage(h){let x=this.images[h];if(x&&!x.data&&x.spriteData){let S=x.spriteData;x.data=new n.RGBAImage({width:S.width,height:S.height},S.context.getImageData(S.x,S.y,S.width,S.height).data),x.spriteData=null}return x}addImage(h,x){if(this.images[h])throw new Error(`Image id ${h} already exist, use updateImage instead`);this._validate(h,x)&&(this.images[h]=x)}_validate(h,x){let S=!0,I=x.data||x.spriteData;return this._validateStretch(x.stretchX,I&&I.width)||(this.fire(new n.ErrorEvent(new Error(`Image "${h}" has invalid "stretchX" value`))),S=!1),this._validateStretch(x.stretchY,I&&I.height)||(this.fire(new n.ErrorEvent(new Error(`Image "${h}" has invalid "stretchY" value`))),S=!1),this._validateContent(x.content,x)||(this.fire(new n.ErrorEvent(new Error(`Image "${h}" has invalid "content" value`))),S=!1),S}_validateStretch(h,x){if(!h)return!0;let S=0;for(let I of h){if(I[0]<S||I[1]<I[0]||x<I[1])return!1;S=I[1]}return!0}_validateContent(h,x){if(!h)return!0;if(h.length!==4)return!1;let S=x.spriteData,I=S&&S.width||x.data.width,D=S&&S.height||x.data.height;return!(h[0]<0||I<h[0]||h[1]<0||D<h[1]||h[2]<0||I<h[2]||h[3]<0||D<h[3]||h[2]<h[0]||h[3]<h[1])}updateImage(h,x,S=!0){let I=this.getImage(h);if(S&&(I.data.width!==x.data.width||I.data.height!==x.data.height))throw new Error(`size mismatch between old image (${I.data.width}x${I.data.height}) and new image (${x.data.width}x${x.data.height}).`);x.version=I.version+1,this.images[h]=x,this.updatedImages[h]=!0}removeImage(h){let x=this.images[h];delete this.images[h],delete this.patterns[h],x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(h,x){let S=!0;if(!this.isLoaded())for(let I of h)this.images[I]||(S=!1);this.isLoaded()||S?this._notify(h,x):this.requestors.push({ids:h,callback:x})}_notify(h,x){let S={};for(let I of h){let D=this.getImage(I);D||(this.fire(new n.Event("styleimagemissing",{id:I})),D=this.getImage(I)),D?S[I]={data:D.data.clone(),pixelRatio:D.pixelRatio,sdf:D.sdf,version:D.version,stretchX:D.stretchX,stretchY:D.stretchY,content:D.content,hasRenderCallback:!!(D.userImage&&D.userImage.render)}:n.warnOnce(`Image "${I}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}x(null,S)}getPixelSize(){let{width:h,height:x}=this.atlasImage;return{width:h,height:x}}getPattern(h){let x=this.patterns[h],S=this.getImage(h);if(!S)return null;if(x&&x.position.version===S.version)return x.position;if(x)x.position.version=S.version;else{let I={w:S.data.width+2,h:S.data.height+2,x:0,y:0},D=new n.ImagePosition(I,S);this.patterns[h]={bin:I,position:D}}return this._updatePatternAtlas(),this.patterns[h].position}bind(h){let x=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new U(h,this.atlasImage,x.RGBA),this.atlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE)}_updatePatternAtlas(){let h=[];for(let D in this.patterns)h.push(this.patterns[D].bin);let{w:x,h:S}=n.potpack(h),I=this.atlasImage;I.resize({width:x||1,height:S||1});for(let D in this.patterns){let{bin:G}=this.patterns[D],H=G.x+1,Y=G.y+1,J=this.getImage(D).data,re=J.width,ae=J.height;n.RGBAImage.copy(J,I,{x:0,y:0},{x:H,y:Y},{width:re,height:ae}),n.RGBAImage.copy(J,I,{x:0,y:ae-1},{x:H,y:Y-1},{width:re,height:1}),n.RGBAImage.copy(J,I,{x:0,y:0},{x:H,y:Y+ae},{width:re,height:1}),n.RGBAImage.copy(J,I,{x:re-1,y:0},{x:H-1,y:Y},{width:1,height:ae}),n.RGBAImage.copy(J,I,{x:0,y:0},{x:H+re,y:Y},{width:1,height:ae})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(h){for(let x of h){if(this.callbackDispatchedThisFrame[x])continue;this.callbackDispatchedThisFrame[x]=!0;let S=this.getImage(x);S||n.warnOnce(`Image with ID: "${x}" was not found`),$(S)&&this.updateImage(x,S)}}}let W=1e20;function Z(P,h,x,S,I,D,G,H,Y){for(let J=h;J<h+S;J++)Q(P,x*D+J,D,I,G,H,Y);for(let J=x;J<x+I;J++)Q(P,J*D+h,1,S,G,H,Y)}function Q(P,h,x,S,I,D,G){D[0]=0,G[0]=-W,G[1]=W,I[0]=P[h];for(let H=1,Y=0,J=0;H<S;H++){I[H]=P[h+H*x];let re=H*H;do{let ae=D[Y];J=(I[H]-I[ae]+re-ae*ae)/(H-ae)/2}while(J<=G[Y]&&--Y>-1);Y++,D[Y]=H,G[Y]=J,G[Y+1]=W}for(let H=0,Y=0;H<S;H++){for(;G[Y+1]<H;)Y++;let J=D[Y],re=H-J;P[h+H*x]=I[J]+re*re}}class X{constructor(h,x){this.requestManager=h,this.localIdeographFontFamily=x,this.entries={}}setURL(h){this.url=h}getGlyphs(h,x){let S=[];for(let I in h)for(let D of h[I])S.push({stack:I,id:D});n.asyncAll(S,({stack:I,id:D},G)=>{let H=this.entries[I];H||(H=this.entries[I]={glyphs:{},requests:{},ranges:{}});let Y=H.glyphs[D];if(Y!==void 0)return void G(null,{stack:I,id:D,glyph:Y});if(Y=this._tinySDF(H,I,D),Y)return H.glyphs[D]=Y,void G(null,{stack:I,id:D,glyph:Y});let J=Math.floor(D/256);if(256*J>65535)return void G(new Error("glyphs > 65535 not supported"));if(H.ranges[J])return void G(null,{stack:I,id:D,glyph:Y});if(!this.url)return void G(new Error("glyphsUrl is not set"));let re=H.requests[J];re||(re=H.requests[J]=[],X.loadGlyphRange(I,J,this.url,this.requestManager,(ae,_e)=>{if(_e){for(let Ce in _e)this._doesCharSupportLocalGlyph(+Ce)||(H.glyphs[+Ce]=_e[+Ce]);H.ranges[J]=!0}for(let Ce of re)Ce(ae,_e);delete H.requests[J]})),re.push((ae,_e)=>{ae?G(ae):_e&&G(null,{stack:I,id:D,glyph:_e[D]||null})})},(I,D)=>{if(I)x(I);else if(D){let G={};for(let{stack:H,id:Y,glyph:J}of D)(G[H]||(G[H]={}))[Y]=J&&{id:J.id,bitmap:J.bitmap.clone(),metrics:J.metrics};x(null,G)}})}_doesCharSupportLocalGlyph(h){return!!this.localIdeographFontFamily&&(n.unicodeBlockLookup["CJK Unified Ideographs"](h)||n.unicodeBlockLookup["Hangul Syllables"](h)||n.unicodeBlockLookup.Hiragana(h)||n.unicodeBlockLookup.Katakana(h))}_tinySDF(h,x,S){let I=this.localIdeographFontFamily;if(!I||!this._doesCharSupportLocalGlyph(S))return;let D=h.tinySDF;if(!D){let H="400";/bold/i.test(x)?H="900":/medium/i.test(x)?H="500":/light/i.test(x)&&(H="200"),D=h.tinySDF=new X.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:I,fontWeight:H})}let G=D.draw(String.fromCharCode(S));return{id:S,bitmap:new n.AlphaImage({width:G.width||30,height:G.height||30},G.data),metrics:{width:G.glyphWidth||24,height:G.glyphHeight||24,left:G.glyphLeft||0,top:G.glyphTop-27||-8,advance:G.glyphAdvance||24}}}}X.loadGlyphRange=function(P,h,x,S,I){let D=256*h,G=D+255,H=S.transformRequest(x.replace("{fontstack}",P).replace("{range}",`${D}-${G}`),E.Glyphs);n.getArrayBuffer(H,(Y,J)=>{if(Y)I(Y);else if(J){let re={};for(let ae of n.parseGlyphPbf(J))re[ae.id]=ae;I(null,re)}})},X.TinySDF=class{constructor({fontSize:P=24,buffer:h=3,radius:x=8,cutoff:S=.25,fontFamily:I="sans-serif",fontWeight:D="normal",fontStyle:G="normal"}={}){this.buffer=h,this.cutoff=S,this.radius=x;let H=this.size=P+4*h,Y=this._createCanvas(H),J=this.ctx=Y.getContext("2d",{willReadFrequently:!0});J.font=`${G} ${D} ${P}px ${I}`,J.textBaseline="alphabetic",J.textAlign="left",J.fillStyle="black",this.gridOuter=new Float64Array(H*H),this.gridInner=new Float64Array(H*H),this.f=new Float64Array(H),this.z=new Float64Array(H+1),this.v=new Uint16Array(H)}_createCanvas(P){let h=document.createElement("canvas");return h.width=h.height=P,h}draw(P){let{width:h,actualBoundingBoxAscent:x,actualBoundingBoxDescent:S,actualBoundingBoxLeft:I,actualBoundingBoxRight:D}=this.ctx.measureText(P),G=Math.ceil(x),H=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(D-I))),Y=Math.min(this.size-this.buffer,G+Math.ceil(S)),J=H+2*this.buffer,re=Y+2*this.buffer,ae=Math.max(J*re,0),_e=new Uint8ClampedArray(ae),Ce={data:_e,width:J,height:re,glyphWidth:H,glyphHeight:Y,glyphTop:G,glyphLeft:0,glyphAdvance:h};if(H===0||Y===0)return Ce;let{ctx:Ae,buffer:Re,gridInner:Te,gridOuter:Ve}=this;Ae.clearRect(Re,Re,H,Y),Ae.fillText(P,Re,Re+G);let tt=Ae.getImageData(Re,Re,H,Y);Ve.fill(W,0,ae),Te.fill(0,0,ae);for(let Ne=0;Ne<Y;Ne++)for(let Xe=0;Xe<H;Xe++){let rt=tt.data[4*(Ne*H+Xe)+3]/255;if(rt===0)continue;let st=(Ne+Re)*J+Xe+Re;if(rt===1)Ve[st]=0,Te[st]=W;else{let ft=.5-rt;Ve[st]=ft>0?ft*ft:0,Te[st]=ft<0?ft*ft:0}}Z(Ve,0,0,J,re,J,this.f,this.v,this.z),Z(Te,Re,Re,H,Y,J,this.f,this.v,this.z);for(let Ne=0;Ne<ae;Ne++){let Xe=Math.sqrt(Ve[Ne])-Math.sqrt(Te[Ne]);_e[Ne]=Math.round(255-255*(Xe/this.radius+this.cutoff))}return Ce}};class ce{constructor(){this.specification=n.v8Spec.light.position}possiblyEvaluate(h,x){return n.sphericalToCartesian(h.expression.evaluate(x))}interpolate(h,x,S){return{x:n.interpolate.number(h.x,x.x,S),y:n.interpolate.number(h.y,x.y,S),z:n.interpolate.number(h.z,x.z,S)}}}let de,le;class te extends n.Evented{constructor(h){super(),de=de||new n.Properties({anchor:new n.DataConstantProperty(n.v8Spec.light.anchor),position:new ce,color:new n.DataConstantProperty(n.v8Spec.light.color),intensity:new n.DataConstantProperty(n.v8Spec.light.intensity)}),this._transitionable=new n.Transitionable(de),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(h,x={}){if(!this._validate(n.validateLight,h,x))for(let S in h){let I=h[S];S.endsWith("-transition")?this._transitionable.setTransition(S.slice(0,-11),I):this._transitionable.setValue(S,I)}}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,x,S){return(!S||S.validate!==!1)&&n.emitValidationErrors(this,h.call(n.validateStyle,n.extend({value:x,style:{glyphs:!0,sprite:!0},styleSpec:n.v8Spec})))}}class ee{constructor(h,x){this.width=h,this.height=x,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(h,x){let S=h.join(",")+String(x);return this.dashEntry[S]||(this.dashEntry[S]=this.addDash(h,x)),this.dashEntry[S]}getDashRanges(h,x,S){let I=[],D=h.length%2==1?-h[h.length-1]*S:0,G=h[0]*S,H=!0;I.push({left:D,right:G,isDash:H,zeroLength:h[0]===0});let Y=h[0];for(let J=1;J<h.length;J++){H=!H;let re=h[J];D=Y*S,Y+=re,G=Y*S,I.push({left:D,right:G,isDash:H,zeroLength:re===0})}return I}addRoundDash(h,x,S){let I=x/2;for(let D=-S;D<=S;D++){let G=this.width*(this.nextRow+S+D),H=0,Y=h[H];for(let J=0;J<this.width;J++){J/Y.right>1&&(Y=h[++H]);let re=Math.abs(J-Y.left),ae=Math.abs(J-Y.right),_e=Math.min(re,ae),Ce,Ae=D/S*(I+1);if(Y.isDash){let Re=I-Math.abs(Ae);Ce=Math.sqrt(_e*_e+Re*Re)}else Ce=I-Math.sqrt(_e*_e+Ae*Ae);this.data[G+J]=Math.max(0,Math.min(255,Ce+128))}}}addRegularDash(h){for(let H=h.length-1;H>=0;--H){let Y=h[H],J=h[H+1];Y.zeroLength?h.splice(H,1):J&&J.isDash===Y.isDash&&(J.left=Y.left,h.splice(H,1))}let x=h[0],S=h[h.length-1];x.isDash===S.isDash&&(x.left=S.left-this.width,S.right=x.right+this.width);let I=this.width*this.nextRow,D=0,G=h[D];for(let H=0;H<this.width;H++){H/G.right>1&&(G=h[++D]);let Y=Math.abs(H-G.left),J=Math.abs(H-G.right),re=Math.min(Y,J);this.data[I+H]=Math.max(0,Math.min(255,(G.isDash?re:-re)+128))}}addDash(h,x){let S=x?7:0,I=2*S+1;if(this.nextRow+I>this.height)return n.warnOnce("LineAtlas out of space"),null;let D=0;for(let H=0;H<h.length;H++)D+=h[H];if(D!==0){let H=this.width/D,Y=this.getDashRanges(h,this.width,H);x?this.addRoundDash(Y,H,S):this.addRegularDash(Y)}let G={y:(this.nextRow+S+.5)/this.height,height:2*S/this.height,width:D};return this.nextRow+=I,this.dirty=!0,G}bind(h){let x=h.gl;this.texture?(x.bindTexture(x.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,x.texSubImage2D(x.TEXTURE_2D,0,0,0,this.width,this.height,x.ALPHA,x.UNSIGNED_BYTE,this.data))):(this.texture=x.createTexture(),x.bindTexture(x.TEXTURE_2D,this.texture),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.REPEAT),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.REPEAT),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.LINEAR),x.texImage2D(x.TEXTURE_2D,0,x.ALPHA,this.width,this.height,0,x.ALPHA,x.UNSIGNED_BYTE,this.data))}}class oe{constructor(h,x,S){this.workerPool=h,this.actors=[],this.currentActor=0,this.id=S;let I=this.workerPool.acquire(S);for(let D=0;D<I.length;D++){let G=new oe.Actor(I[D],x,S);G.name=`Worker ${D}`,this.actors.push(G)}if(!this.actors.length)throw new Error("No actors found")}broadcast(h,x,S){n.asyncAll(this.actors,(I,D)=>{I.send(h,x,D)},S=S||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(h=!0){this.actors.forEach(x=>{x.remove()}),this.actors=[],h&&this.workerPool.release(this.id)}}function ie(P,h,x){let S=function(I,D){if(I)return x(I);if(D){let G=n.pick(n.extend(D,P),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);D.vector_layers&&(G.vectorLayers=D.vector_layers,G.vectorLayerIds=G.vectorLayers.map(H=>H.id)),x(null,G)}};return P.url?n.getJSON(h.transformRequest(P.url,E.Source),S):n.browser.frame(()=>S(null,P))}oe.Actor=n.Actor;class ne{constructor(h,x){h&&(x?this.setSouthWest(h).setNorthEast(x):Array.isArray(h)&&(h.length===4?this.setSouthWest([h[0],h[1]]).setNorthEast([h[2],h[3]]):this.setSouthWest(h[0]).setNorthEast(h[1])))}setNorthEast(h){return this._ne=h instanceof n.LngLat?new n.LngLat(h.lng,h.lat):n.LngLat.convert(h),this}setSouthWest(h){return this._sw=h instanceof n.LngLat?new n.LngLat(h.lng,h.lat):n.LngLat.convert(h),this}extend(h){let x=this._sw,S=this._ne,I,D;if(h instanceof n.LngLat)I=h,D=h;else{if(!(h instanceof ne))return Array.isArray(h)?h.length===4||h.every(Array.isArray)?this.extend(ne.convert(h)):this.extend(n.LngLat.convert(h)):h&&("lng"in h||"lon"in h)&&"lat"in h?this.extend(n.LngLat.convert(h)):this;if(I=h._sw,D=h._ne,!I||!D)return this}return x||S?(x.lng=Math.min(I.lng,x.lng),x.lat=Math.min(I.lat,x.lat),S.lng=Math.max(D.lng,S.lng),S.lat=Math.max(D.lat,S.lat)):(this._sw=new n.LngLat(I.lng,I.lat),this._ne=new n.LngLat(D.lng,D.lat)),this}getCenter(){return new n.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new n.LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new n.LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(h){let{lng:x,lat:S}=n.LngLat.convert(h),I=this._sw.lng<=x&&x<=this._ne.lng;return this._sw.lng>this._ne.lng&&(I=this._sw.lng>=x&&x>=this._ne.lng),this._sw.lat<=S&&S<=this._ne.lat&&I}static convert(h){return h instanceof ne?h:h&&new ne(h)}static fromLngLat(h,x=0){let S=360*x/40075017,I=S/Math.cos(Math.PI/180*h.lat);return new ne(new n.LngLat(h.lng-I,h.lat-S),new n.LngLat(h.lng+I,h.lat+S))}}class me{constructor(h,x,S){this.bounds=ne.convert(this.validateBounds(h)),this.minzoom=x||0,this.maxzoom=S||24}validateBounds(h){return Array.isArray(h)&&h.length===4?[Math.max(-180,h[0]),Math.max(-90,h[1]),Math.min(180,h[2]),Math.min(90,h[3])]:[-180,-90,180,90]}contains(h){let x=Math.pow(2,h.z),S=Math.floor(n.mercatorXfromLng(this.bounds.getWest())*x),I=Math.floor(n.mercatorYfromLat(this.bounds.getNorth())*x),D=Math.ceil(n.mercatorXfromLng(this.bounds.getEast())*x),G=Math.ceil(n.mercatorYfromLat(this.bounds.getSouth())*x);return h.x>=S&&h.x<D&&h.y>=I&&h.y<G}}class De extends n.Evented{constructor(h,x,S,I){if(super(),this.load=()=>{this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ie(this._options,this.map._requestManager,(D,G)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),D?this.fire(new n.ErrorEvent(D)):G&&(n.extend(this,G),G.bounds&&(this.tileBounds=new me(G.bounds,this.minzoom,this.maxzoom)),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>n.extend({},this._options),this.id=h,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.extend(this,n.pick(x,["url","scheme","tileSize","promoteId"])),this._options=n.extend({type:"vector"},x),this._collectResourceTiming=x.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(I)}loaded(){return this._loaded}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}onAdd(h){this.map=h,this.load()}setSourceProperty(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.load()}setTiles(h){return this.setSourceProperty(()=>{this._options.tiles=h}),this}setUrl(h){return this.setSourceProperty(()=>{this.url=h,this._options.url=h}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(h,x){let S=h.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),I={request:this.map._requestManager.transformRequest(S,E.Tile),uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function D(G,H){return delete h.request,h.aborted?x(null):G&&G.status!==404?x(G):(H&&H.resourceTiming&&(h.resourceTiming=H.resourceTiming),this.map._refreshExpiredTiles&&H&&h.setExpiryData(H),h.loadVectorData(H,this.map.painter),x(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}I.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired"?h.state==="loading"?h.reloadCallback=x:h.request=h.actor.send("reloadTile",I,D.bind(this)):(h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",I,D.bind(this)))}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id},void 0)}unloadTile(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class He extends n.Evented{constructor(h,x,S,I){super(),this.id=h,this.dispatcher=S,this.setEventedParent(I),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.extend({type:"raster"},x),n.extend(this,n.pick(x,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ie(this._options,this.map._requestManager,(h,x)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new n.ErrorEvent(h)):x&&(n.extend(this,x),x.bounds&&(this.tileBounds=new me(x.bounds,this.minzoom,this.maxzoom)),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(h){this.map=h,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return n.extend({},this._options)}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,x){let S=h.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);h.request=v.getImage(this.map._requestManager.transformRequest(S,E.Tile),(I,D,G)=>{if(delete h.request,h.aborted)h.state="unloaded",x(null);else if(I)h.state="errored",x(I);else if(D){this.map._refreshExpiredTiles&&G&&h.setExpiryData(G);let H=this.map.painter.context,Y=H.gl;h.texture=this.map.painter.getTileTexture(D.width),h.texture?h.texture.update(D,{useMipmap:!0}):(h.texture=new U(H,D,Y.RGBA,{useMipmap:!0}),h.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST),H.extTextureFilterAnisotropic&&Y.texParameterf(Y.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax)),h.state="loaded",x(null)}},this.map._refreshExpiredTiles)}abortTile(h,x){h.request&&(h.request.cancel(),delete h.request),x()}unloadTile(h,x){h.texture&&this.map.painter.saveTileTexture(h.texture),x()}hasTransition(){return!1}}class Je extends He{constructor(h,x,S,I){super(h,x,S,I),this.type="raster-dem",this.maxzoom=22,this._options=n.extend({type:"raster-dem"},x),this.encoding=x.encoding||"mapbox"}loadTile(h,x){let S=h.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function I(D,G){D&&(h.state="errored",x(D)),G&&(h.dem=G,h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0,h.state="loaded",x(null))}h.request=v.getImage(this.map._requestManager.transformRequest(S,E.Tile),function(D,G){if(delete h.request,h.aborted)h.state="unloaded",x(null);else if(D)h.state="errored",x(D);else if(G){this.map._refreshExpiredTiles&&h.setExpiryData(G),delete G.cacheControl,delete G.expires;let H=n.isImageBitmap(G)&&(le==null&&(le=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),le)?G:n.browser.getImageData(G,1),Y={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:H,encoding:this.encoding};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",Y,I.bind(this)))}}.bind(this),this.map._refreshExpiredTiles),h.neighboringTiles=this._getNeighboringTiles(h.tileID)}_getNeighboringTiles(h){let x=h.canonical,S=Math.pow(2,x.z),I=(x.x-1+S)%S,D=x.x===0?h.wrap-1:h.wrap,G=(x.x+1+S)%S,H=x.x+1===S?h.wrap+1:h.wrap,Y={};return Y[new n.OverscaledTileID(h.overscaledZ,D,x.z,I,x.y).key]={backfilled:!1},Y[new n.OverscaledTileID(h.overscaledZ,H,x.z,G,x.y).key]={backfilled:!1},x.y>0&&(Y[new n.OverscaledTileID(h.overscaledZ,D,x.z,I,x.y-1).key]={backfilled:!1},Y[new n.OverscaledTileID(h.overscaledZ,h.wrap,x.z,x.x,x.y-1).key]={backfilled:!1},Y[new n.OverscaledTileID(h.overscaledZ,H,x.z,G,x.y-1).key]={backfilled:!1}),x.y+1<S&&(Y[new n.OverscaledTileID(h.overscaledZ,D,x.z,I,x.y+1).key]={backfilled:!1},Y[new n.OverscaledTileID(h.overscaledZ,h.wrap,x.z,x.x,x.y+1).key]={backfilled:!1},Y[new n.OverscaledTileID(h.overscaledZ,H,x.z,G,x.y+1).key]={backfilled:!1}),Y}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded",h.actor&&h.actor.send("removeDEMTile",{uid:h.uid,source:this.id})}}class ot extends n.Evented{constructor(h,x,S,I){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>n.extend({},this._options,{type:this.type,data:this._data}),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=S.getActor(),this.setEventedParent(I),this._data=x.data,this._options=n.extend({},x),this._collectResourceTiming=x.collectResourceTiming,x.maxzoom!==void 0&&(this.maxzoom=x.maxzoom),x.type&&(this.type=x.type),x.attribution&&(this.attribution=x.attribution),this.promoteId=x.promoteId;let D=n.EXTENT/this.tileSize;this.workerOptions=n.extend({source:this.id,cluster:x.cluster||!1,geojsonVtOptions:{buffer:(x.buffer!==void 0?x.buffer:128)*D,tolerance:(x.tolerance!==void 0?x.tolerance:.375)*D,extent:n.EXTENT,maxZoom:this.maxzoom,lineMetrics:x.lineMetrics||!1,generateId:x.generateId||!1},superclusterOptions:{maxZoom:x.clusterMaxZoom!==void 0?x.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,x.clusterMinPoints||2),extent:n.EXTENT,radius:(x.clusterRadius||50)*D,log:!1,generateId:x.generateId||!1},clusterProperties:x.clusterProperties,filter:x.filter},x.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(h){this.map=h,this.load()}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){return this._updateWorkerData(h),this}setClusterOptions(h){return this.workerOptions.cluster=h.cluster,h&&(h.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=h.clusterRadius),h.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=h.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(h,x){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},x),this}getClusterChildren(h,x){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},x),this}getClusterLeaves(h,x,S,I){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:x,offset:S},I),this}_updateWorkerData(h){let x=n.extend({},this.workerOptions);h?x.dataDiff=h:typeof this._data=="string"?(x.request=this.map._requestManager.transformRequest(n.browser.resolveURL(this._data),E.Source),x.request.collectResourceTiming=this._collectResourceTiming):x.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new n.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,x,(S,I)=>{if(this._pendingLoads--,this._removed||I&&I.abandoned)return void this.fire(new n.Event("dataabort",{dataType:"source"}));let D=null;if(I&&I.resourceTiming&&I.resourceTiming[this.id]&&(D=I.resourceTiming[this.id].slice(0)),S)return void this.fire(new n.ErrorEvent(S));let G={dataType:"source"};this._collectResourceTiming&&D&&D.length>0&&n.extend(G,{resourceTiming:D}),this.fire(new n.Event("data",{...G,sourceDataType:"metadata"})),this.fire(new n.Event("data",{...G,sourceDataType:"content"}))})}loaded(){return this._pendingLoads===0}loadTile(h,x){let S=h.actor?"reloadTile":"loadTile";h.actor=this.actor;let I={type:this.type,uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};h.request=this.actor.send(S,I,(D,G)=>(delete h.request,h.unloadVectorData(),h.aborted?x(null):D?x(D):(h.loadVectorData(G,this.map.painter,S==="reloadTile"),x(null))))}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var gt=n.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class vt extends n.Evented{constructor(h,x,S,I){super(),this.load=(D,G)=>{this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=v.getImage(this.map._requestManager.transformRequest(this.url,E.Image),(H,Y)=>{this._request=null,this._loaded=!0,H?this.fire(new n.ErrorEvent(H)):Y&&(this.image=Y,D&&(this.coordinates=D),G&&G(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;let D=this.map.painter.context,G=D.gl;this.boundsBuffer||(this.boundsBuffer=D.createVertexBuffer(this._boundsArray,gt.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new U(D,this.image,G.RGBA),this.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE));let H=!1;for(let Y in this.tiles){let J=this.tiles[Y];J.state!=="loaded"&&(J.state="loaded",J.texture=this.texture,H=!0)}H&&this.fire(new n.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=h,this.dispatcher=S,this.coordinates=x.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(I),this.options=x}loaded(){return this._loaded}updateImage(h){return h.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=h.url,this.load(h.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(h){this.map=h,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(h){this.coordinates=h;let x=h.map(n.MercatorCoordinate.fromLngLat);this.tileID=function(I){let D=1/0,G=1/0,H=-1/0,Y=-1/0;for(let _e of I)D=Math.min(D,_e.x),G=Math.min(G,_e.y),H=Math.max(H,_e.x),Y=Math.max(Y,_e.y);let J=Math.max(H-D,Y-G),re=Math.max(0,Math.floor(-Math.log(J)/Math.LN2)),ae=Math.pow(2,re);return new n.CanonicalTileID(re,Math.floor((D+H)/2*ae),Math.floor((G+Y)/2*ae))}(x),this.minzoom=this.maxzoom=this.tileID.z;let S=x.map(I=>this.tileID.getTilePoint(I)._round());return this._boundsArray=new n.RasterBoundsArray,this._boundsArray.emplaceBack(S[0].x,S[0].y,0,0),this._boundsArray.emplaceBack(S[1].x,S[1].y,n.EXTENT,0),this._boundsArray.emplaceBack(S[3].x,S[3].y,0,n.EXTENT),this._boundsArray.emplaceBack(S[2].x,S[2].y,n.EXTENT,n.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(h,x){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},x(null)):(h.state="errored",x(null))}hasTransition(){return!1}}class ct extends vt{constructor(h,x,S,I){super(h,x,S,I),this.load=()=>{this._loaded=!1;let D=this.options;this.urls=[];for(let G of D.urls)this.urls.push(this.map._requestManager.transformRequest(G,E.Source).url);n.getVideo(this.urls,(G,H)=>{this._loaded=!0,G?this.fire(new n.ErrorEvent(G)):H&&(this.video=H,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let D=this.map.painter.context,G=D.gl;this.boundsBuffer||(this.boundsBuffer=D.createVertexBuffer(this._boundsArray,gt.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE),G.texSubImage2D(G.TEXTURE_2D,0,0,0,G.RGBA,G.UNSIGNED_BYTE,this.video)):(this.texture=new U(D,this.video,G.RGBA),this.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE));let H=!1;for(let Y in this.tiles){let J=this.tiles[Y];J.state!=="loaded"&&(J.state="loaded",J.texture=this.texture,H=!0)}H&&this.fire(new n.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=x}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){let x=this.video.seekable;h<x.start(0)||h>x.end(0)?this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${x.start(0)} and ${x.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Se extends vt{constructor(h,x,S,I){super(h,x,S,I),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let D=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,D=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,D=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let G=this.map.painter.context,H=G.gl;this.boundsBuffer||(this.boundsBuffer=G.createVertexBuffer(this._boundsArray,gt.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(D||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new U(G,this.canvas,H.RGBA,{premultiply:!0});let Y=!1;for(let J in this.tiles){let re=this.tiles[J];re.state!=="loaded"&&(re.state="loaded",re.texture=this.texture,Y=!0)}Y&&this.fire(new n.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),x.coordinates?Array.isArray(x.coordinates)&&x.coordinates.length===4&&!x.coordinates.some(D=>!Array.isArray(D)||D.length!==2||D.some(G=>typeof G!="number"))||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),x.animate&&typeof x.animate!="boolean"&&this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),x.canvas?typeof x.canvas=="string"||x.canvas instanceof HTMLCanvasElement||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=x,this.animate=x.animate===void 0||x.animate}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}}let Qe={},xt=P=>{switch(P){case"geojson":return ot;case"image":return vt;case"raster":return He;case"raster-dem":return Je;case"vector":return De;case"video":return ct;case"canvas":return Se}return Qe[P]};function It(P,h){let x=n.create();return n.translate(x,x,[1,1,0]),n.scale(x,x,[.5*P.width,.5*P.height,1]),n.multiply(x,x,P.calculatePosMatrix(h.toUnwrapped()))}function Gt(P,h,x,S,I,D){let G=function(ae,_e,Ce){if(ae)for(let Ae of ae){let Re=_e[Ae];if(Re&&Re.source===Ce&&Re.type==="fill-extrusion")return!0}else for(let Ae in _e){let Re=_e[Ae];if(Re.source===Ce&&Re.type==="fill-extrusion")return!0}return!1}(I&&I.layers,h,P.id),H=D.maxPitchScaleFactor(),Y=P.tilesIn(S,H,G);Y.sort(Ni);let J=[];for(let ae of Y)J.push({wrappedTileID:ae.tileID.wrapped().key,queryResults:ae.tile.queryRenderedFeatures(h,x,P._state,ae.queryGeometry,ae.cameraQueryGeometry,ae.scale,I,D,H,It(P.transform,ae.tileID))});let re=function(ae){let _e={},Ce={};for(let Ae of ae){let Re=Ae.queryResults,Te=Ae.wrappedTileID,Ve=Ce[Te]=Ce[Te]||{};for(let tt in Re){let Ne=Re[tt],Xe=Ve[tt]=Ve[tt]||{},rt=_e[tt]=_e[tt]||[];for(let st of Ne)Xe[st.featureIndex]||(Xe[st.featureIndex]=!0,rt.push(st))}}return _e}(J);for(let ae in re)re[ae].forEach(_e=>{let Ce=_e.feature,Ae=P.getFeatureState(Ce.layer["source-layer"],Ce.id);Ce.source=Ce.layer.source,Ce.layer["source-layer"]&&(Ce.sourceLayer=Ce.layer["source-layer"]),Ce.state=Ae});return re}function Ni(P,h){let x=P.tileID,S=h.tileID;return x.overscaledZ-S.overscaledZ||x.canonical.y-S.canonical.y||x.wrap-S.wrap||x.canonical.x-S.canonical.x}class je{constructor(h,x){this.timeAdded=0,this.fadeEndTime=0,this.tileID=h,this.uid=n.uniqueId(),this.uses=0,this.tileSize=x,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(h){let x=h+this.timeAdded;x<this.fadeEndTime||(this.fadeEndTime=x)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(h){this.demTexture&&h.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(h,x,S){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",h){h.featureIndex&&(this.latestFeatureIndex=h.featureIndex,h.rawTileData?(this.latestRawTileData=h.rawTileData,this.latestFeatureIndex.rawTileData=h.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=h.collisionBoxArray,this.buckets=function(I,D){let G={};if(!D)return G;for(let H of I){let Y=H.layerIds.map(J=>D.getLayer(J)).filter(Boolean);if(Y.length!==0){H.layers=Y,H.stateDependentLayerIds&&(H.stateDependentLayers=H.stateDependentLayerIds.map(J=>Y.filter(re=>re.id===J)[0]));for(let J of Y)G[J.id]=H}}return G}(h.buckets,x.style),this.hasSymbolBuckets=!1;for(let I in this.buckets){let D=this.buckets[I];if(D instanceof n.SymbolBucket){if(this.hasSymbolBuckets=!0,!S)break;D.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let I in this.buckets){let D=this.buckets[I];if(D instanceof n.SymbolBucket&&D.hasRTLText){this.hasRTLText=!0,n.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(let I in this.buckets){let D=this.buckets[I];this.queryPadding=Math.max(this.queryPadding,x.style.getLayer(I).queryRadius(D))}h.imageAtlas&&(this.imageAtlas=h.imageAtlas),h.glyphAtlasImage&&(this.glyphAtlasImage=h.glyphAtlasImage)}else this.collisionBoxArray=new n.CollisionBoxArray}unloadVectorData(){for(let h in this.buckets)this.buckets[h].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(h){return this.buckets[h.id]}upload(h){for(let S in this.buckets){let I=this.buckets[S];I.uploadPending()&&I.upload(h)}let x=h.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new U(h,this.imageAtlas.image,x.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new U(h,this.glyphAtlasImage,x.ALPHA),this.glyphAtlasImage=null)}prepare(h){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(h,this.imageAtlasTexture)}queryRenderedFeatures(h,x,S,I,D,G,H,Y,J,re){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:I,cameraQueryGeometry:D,scale:G,tileSize:this.tileSize,pixelPosMatrix:re,transform:Y,params:H,queryPadding:this.queryPadding*J},h,x,S):{}}querySourceFeatures(h,x){let S=this.latestFeatureIndex;if(!S||!S.rawTileData)return;let I=S.loadVTLayers(),D=x&&x.sourceLayer?x.sourceLayer:"",G=I._geojsonTileLayer||I[D];if(!G)return;let H=n.createFilter(x&&x.filter),{z:Y,x:J,y:re}=this.tileID.canonical,ae={z:Y,x:J,y:re};for(let _e=0;_e<G.length;_e++){let Ce=G.feature(_e);if(H.needGeometry){let Te=n.toEvaluationFeature(Ce,!0);if(!H.filter(new n.EvaluationParameters(this.tileID.overscaledZ),Te,this.tileID.canonical))continue}else if(!H.filter(new n.EvaluationParameters(this.tileID.overscaledZ),Ce))continue;let Ae=S.getId(Ce,D),Re=new n.GeoJSONFeature(Ce,Y,J,re,Ae);Re.tile=ae,h.push(Re)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(h){let x=this.expirationTime;if(h.cacheControl){let S=n.parseCacheControl(h.cacheControl);S["max-age"]&&(this.expirationTime=Date.now()+1e3*S["max-age"])}else h.expires&&(this.expirationTime=new Date(h.expires).getTime());if(this.expirationTime){let S=Date.now(),I=!1;if(this.expirationTime>S)I=!1;else if(x)if(this.expirationTime<x)I=!0;else{let D=this.expirationTime-x;D?this.expirationTime=S+Math.max(D,3e4):I=!0}else I=!0;I?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(h,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(h).length===0)return;let S=this.latestFeatureIndex.loadVTLayers();for(let I in this.buckets){if(!x.style.hasLayer(I))continue;let D=this.buckets[I],G=D.layers[0].sourceLayer||"_geojsonTileLayer",H=S[G],Y=h[G];if(!H||!Y||Object.keys(Y).length===0)continue;D.update(Y,H,this.imageAtlas&&this.imageAtlas.patternPositions||{});let J=x&&x.style&&x.style.getLayer(I);J&&(this.queryPadding=Math.max(this.queryPadding,J.queryRadius(D)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.browser.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(h){this.symbolFadeHoldUntil=n.browser.now()+h}setDependencies(h,x){let S={};for(let I of x)S[I]=!0;this.dependencies[h]=S}hasDependency(h,x){for(let S of h){let I=this.dependencies[S];if(I){for(let D of x)if(I[D])return!0}}return!1}}class be{constructor(h,x){this.max=h,this.onRemove=x,this.reset()}reset(){for(let h in this.data)for(let x of this.data[h])x.timeout&&clearTimeout(x.timeout),this.onRemove(x.value);return this.data={},this.order=[],this}add(h,x,S){let I=h.wrapped().key;this.data[I]===void 0&&(this.data[I]=[]);let D={value:x,timeout:void 0};if(S!==void 0&&(D.timeout=setTimeout(()=>{this.remove(h,D)},S)),this.data[I].push(D),this.order.push(I),this.order.length>this.max){let G=this._getAndRemoveByKey(this.order[0]);G&&this.onRemove(G)}return this}has(h){return h.wrapped().key in this.data}getAndRemove(h){return this.has(h)?this._getAndRemoveByKey(h.wrapped().key):null}_getAndRemoveByKey(h){let x=this.data[h].shift();return x.timeout&&clearTimeout(x.timeout),this.data[h].length===0&&delete this.data[h],this.order.splice(this.order.indexOf(h),1),x.value}getByKey(h){let x=this.data[h];return x?x[0].value:null}get(h){return this.has(h)?this.data[h.wrapped().key][0].value:null}remove(h,x){if(!this.has(h))return this;let S=h.wrapped().key,I=x===void 0?0:this.data[S].indexOf(x),D=this.data[S][I];return this.data[S].splice(I,1),D.timeout&&clearTimeout(D.timeout),this.data[S].length===0&&delete this.data[S],this.onRemove(D.value),this.order.splice(this.order.indexOf(S),1),this}setMaxSize(h){for(this.max=h;this.order.length>this.max;){let x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}filter(h){let x=[];for(let S in this.data)for(let I of this.data[S])h(I.value)||x.push(I);for(let S of x)this.remove(S.value.tileID,S)}}class ge{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(h,x,S){let I=String(x);if(this.stateChanges[h]=this.stateChanges[h]||{},this.stateChanges[h][I]=this.stateChanges[h][I]||{},n.extend(this.stateChanges[h][I],S),this.deletedStates[h]===null){this.deletedStates[h]={};for(let D in this.state[h])D!==I&&(this.deletedStates[h][D]=null)}else if(this.deletedStates[h]&&this.deletedStates[h][I]===null){this.deletedStates[h][I]={};for(let D in this.state[h][I])S[D]||(this.deletedStates[h][I][D]=null)}else for(let D in S)this.deletedStates[h]&&this.deletedStates[h][I]&&this.deletedStates[h][I][D]===null&&delete this.deletedStates[h][I][D]}removeFeatureState(h,x,S){if(this.deletedStates[h]===null)return;let I=String(x);if(this.deletedStates[h]=this.deletedStates[h]||{},S&&x!==void 0)this.deletedStates[h][I]!==null&&(this.deletedStates[h][I]=this.deletedStates[h][I]||{},this.deletedStates[h][I][S]=null);else if(x!==void 0)if(this.stateChanges[h]&&this.stateChanges[h][I])for(S in this.deletedStates[h][I]={},this.stateChanges[h][I])this.deletedStates[h][I][S]=null;else this.deletedStates[h][I]=null;else this.deletedStates[h]=null}getState(h,x){let S=String(x),I=n.extend({},(this.state[h]||{})[S],(this.stateChanges[h]||{})[S]);if(this.deletedStates[h]===null)return{};if(this.deletedStates[h]){let D=this.deletedStates[h][x];if(D===null)return{};for(let G in D)delete I[G]}return I}initializeTileState(h,x){h.setFeatureState(this.state,x)}coalesceChanges(h,x){let S={};for(let I in this.stateChanges){this.state[I]=this.state[I]||{};let D={};for(let G in this.stateChanges[I])this.state[I][G]||(this.state[I][G]={}),n.extend(this.state[I][G],this.stateChanges[I][G]),D[G]=this.state[I][G];S[I]=D}for(let I in this.deletedStates){this.state[I]=this.state[I]||{};let D={};if(this.deletedStates[I]===null)for(let G in this.state[I])D[G]={},this.state[I][G]={};else for(let G in this.deletedStates[I]){if(this.deletedStates[I][G]===null)this.state[I][G]={};else for(let H of Object.keys(this.deletedStates[I][G]))delete this.state[I][G][H];D[G]=this.state[I][G]}S[I]=S[I]||{},n.extend(S[I],D)}if(this.stateChanges={},this.deletedStates={},Object.keys(S).length!==0)for(let I in h)h[I].setFeatureState(S,x)}}class xe extends n.Evented{constructor(h,x,S){super(),this.id=h,this.dispatcher=S,this.on("data",I=>{I.dataType==="source"&&I.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&I.dataType==="source"&&I.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((I,D,G,H)=>{let Y=new(xt(D.type))(I,D,G,H);if(Y.id!==I)throw new Error(`Expected Source id to be ${I} instead of ${Y.id}`);return Y})(h,x,S,this),this._tiles={},this._cache=new be(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ge,this._didEmitContent=!1,this._updated=!1}onAdd(h){this.map=h,this._maxTileCacheSize=h?h._maxTileCacheSize:null,this._maxTileCacheZoomLevels=h?h._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(h)}onRemove(h){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(h)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let h in this._tiles){let x=this._tiles[h];if(x.state!=="loaded"&&x.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let h=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,h&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(h,x){return this._source.loadTile(h,x)}_unloadTile(h){if(this._source.unloadTile)return this._source.unloadTile(h,()=>{})}_abortTile(h){this._source.abortTile&&this._source.abortTile(h,()=>{}),this._source.fire(new n.Event("dataabort",{tile:h,coord:h.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(h){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let x in this._tiles){let S=this._tiles[x];S.upload(h),S.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(h=>h.tileID).sort(Pe).map(h=>h.key)}getRenderableIds(h){let x=[];for(let S in this._tiles)this._isIdRenderable(S,h)&&x.push(this._tiles[S]);return h?x.sort((S,I)=>{let D=S.tileID,G=I.tileID,H=new n.Point(D.canonical.x,D.canonical.y)._rotate(this.transform.angle),Y=new n.Point(G.canonical.x,G.canonical.y)._rotate(this.transform.angle);return D.overscaledZ-G.overscaledZ||Y.y-H.y||Y.x-H.x}).map(S=>S.tileID.key):x.map(S=>S.tileID).sort(Pe).map(S=>S.key)}hasRenderableParent(h){let x=this.findLoadedParent(h,0);return!!x&&this._isIdRenderable(x.tileID.key)}_isIdRenderable(h,x){return this._tiles[h]&&this._tiles[h].hasData()&&!this._coveredTiles[h]&&(x||!this._tiles[h].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let h in this._tiles)this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")}}_reloadTile(h,x){let S=this._tiles[h];S&&(S.state!=="loading"&&(S.state=x),this._loadTile(S,this._tileLoaded.bind(this,S,h,x)))}_tileLoaded(h,x,S,I){if(I)return h.state="errored",void(I.status!==404?this._source.fire(new n.ErrorEvent(I,{tile:h})):this.update(this.transform,this.terrain));h.timeAdded=n.browser.now(),S==="expired"&&(h.refreshedUponExpiration=!0),this._setTileReloadTimer(x,h),this.getSource().type==="raster-dem"&&h.dem&&this._backfillDEM(h),this._state.initializeTileState(h,this.map?this.map.painter:null),h.aborted||this._source.fire(new n.Event("data",{dataType:"source",tile:h,coord:h.tileID}))}_backfillDEM(h){let x=this.getRenderableIds();for(let I=0;I<x.length;I++){let D=x[I];if(h.neighboringTiles&&h.neighboringTiles[D]){let G=this.getTileByID(D);S(h,G),S(G,h)}}function S(I,D){I.needsHillshadePrepare=!0,I.needsTerrainPrepare=!0;let G=D.tileID.canonical.x-I.tileID.canonical.x,H=D.tileID.canonical.y-I.tileID.canonical.y,Y=Math.pow(2,I.tileID.canonical.z),J=D.tileID.key;G===0&&H===0||Math.abs(H)>1||(Math.abs(G)>1&&(Math.abs(G+Y)===1?G+=Y:Math.abs(G-Y)===1&&(G-=Y)),D.dem&&I.dem&&(I.dem.backfillBorder(D.dem,G,H),I.neighboringTiles&&I.neighboringTiles[J]&&(I.neighboringTiles[J].backfilled=!0)))}}getTile(h){return this.getTileByID(h.key)}getTileByID(h){return this._tiles[h]}_retainLoadedChildren(h,x,S,I){for(let D in this._tiles){let G=this._tiles[D];if(I[D]||!G.hasData()||G.tileID.overscaledZ<=x||G.tileID.overscaledZ>S)continue;let H=G.tileID;for(;G&&G.tileID.overscaledZ>x+1;){let J=G.tileID.scaledTo(G.tileID.overscaledZ-1);G=this._tiles[J.key],G&&G.hasData()&&(H=J)}let Y=H;for(;Y.overscaledZ>x;)if(Y=Y.scaledTo(Y.overscaledZ-1),h[Y.key]){I[H.key]=H;break}}}findLoadedParent(h,x){if(h.key in this._loadedParentTiles){let S=this._loadedParentTiles[h.key];return S&&S.tileID.overscaledZ>=x?S:null}for(let S=h.overscaledZ-1;S>=x;S--){let I=h.scaledTo(S),D=this._getLoadedTile(I);if(D)return D}}_getLoadedTile(h){let x=this._tiles[h.key];return x&&x.hasData()?x:this._cache.getByKey(h.wrapped().key)}updateCacheSize(h){let x=Math.ceil(h.width/this._source.tileSize)+1,S=Math.ceil(h.height/this._source.tileSize)+1,I=Math.floor(x*S*(this._maxTileCacheZoomLevels===null?n.config.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),D=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,I):I;this._cache.setMaxSize(D)}handleWrapJump(h){let x=Math.round((h-(this._prevLng===void 0?h:this._prevLng))/360);if(this._prevLng=h,x){let S={};for(let I in this._tiles){let D=this._tiles[I];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+x),S[D.tileID.key]=D}this._tiles=S;for(let I in this._timers)clearTimeout(this._timers[I]),delete this._timers[I];for(let I in this._tiles)this._setTileReloadTimer(I,this._tiles[I])}}update(h,x){if(this.transform=h,this.terrain=x,!this._sourceLoaded||this._paused)return;let S;this.updateCacheSize(h),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?S=h.getVisibleUnwrappedCoordinates(this._source.tileID).map(re=>new n.OverscaledTileID(re.canonical.z,re.wrap,re.canonical.z,re.canonical.x,re.canonical.y)):(S=h.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:x}),this._source.hasTile&&(S=S.filter(re=>this._source.hasTile(re)))):S=[];let I=h.coveringZoomLevel(this._source),D=Math.max(I-xe.maxOverzooming,this._source.minzoom),G=Math.max(I+xe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let re={};for(let ae of S)if(ae.canonical.z>this._source.minzoom){let _e=ae.scaledTo(ae.canonical.z-1);re[_e.key]=_e;let Ce=ae.scaledTo(Math.max(this._source.minzoom,Math.min(ae.canonical.z,5)));re[Ce.key]=Ce}S=S.concat(Object.values(re))}let H=S.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,H&&this.fire(new n.Event("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let Y=this._updateRetainedTiles(S,I);if(Oe(this._source.type)){let re={},ae={},_e=Object.keys(Y),Ce=n.browser.now();for(let Ae of _e){let Re=Y[Ae],Te=this._tiles[Ae];if(!Te||Te.fadeEndTime!==0&&Te.fadeEndTime<=Ce)continue;let Ve=this.findLoadedParent(Re,D);Ve&&(this._addTile(Ve.tileID),re[Ve.tileID.key]=Ve.tileID),ae[Ae]=Re}this._retainLoadedChildren(ae,I,G,Y);for(let Ae in re)Y[Ae]||(this._coveredTiles[Ae]=!0,Y[Ae]=re[Ae]);if(x){let Ae={},Re={};for(let Te of S)this._tiles[Te.key].hasData()?Ae[Te.key]=Te:Re[Te.key]=Te;for(let Te in Re){let Ve=Re[Te].children(this._source.maxzoom);this._tiles[Ve[0].key]&&this._tiles[Ve[1].key]&&this._tiles[Ve[2].key]&&this._tiles[Ve[3].key]&&(Ae[Ve[0].key]=Y[Ve[0].key]=Ve[0],Ae[Ve[1].key]=Y[Ve[1].key]=Ve[1],Ae[Ve[2].key]=Y[Ve[2].key]=Ve[2],Ae[Ve[3].key]=Y[Ve[3].key]=Ve[3],delete Re[Te])}for(let Te in Re){let Ve=this.findLoadedParent(Re[Te],this._source.minzoom);if(Ve){Ae[Ve.tileID.key]=Y[Ve.tileID.key]=Ve.tileID;for(let tt in Ae)Ae[tt].isChildOf(Ve.tileID)&&delete Ae[tt]}}for(let Te in this._tiles)Ae[Te]||(this._coveredTiles[Te]=!0)}}for(let re in Y)this._tiles[re].clearFadeHold();let J=n.keysDifference(this._tiles,Y);for(let re of J){let ae=this._tiles[re];ae.hasSymbolBuckets&&!ae.holdingForFade()?ae.setHoldDuration(this.map._fadeDuration):ae.hasSymbolBuckets&&!ae.symbolFadeFinished()||this._removeTile(re)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(let h in this._tiles)this._tiles[h].holdingForFade()&&this._removeTile(h)}_updateRetainedTiles(h,x){let S={},I={},D=Math.max(x-xe.maxOverzooming,this._source.minzoom),G=Math.max(x+xe.maxUnderzooming,this._source.minzoom),H={};for(let Y of h){let J=this._addTile(Y);S[Y.key]=Y,J.hasData()||x<this._source.maxzoom&&(H[Y.key]=Y)}this._retainLoadedChildren(H,x,G,S);for(let Y of h){let J=this._tiles[Y.key];if(J.hasData())continue;if(x+1>this._source.maxzoom){let ae=Y.children(this._source.maxzoom)[0],_e=this.getTile(ae);if(_e&&_e.hasData()){S[ae.key]=ae;continue}}else{let ae=Y.children(this._source.maxzoom);if(S[ae[0].key]&&S[ae[1].key]&&S[ae[2].key]&&S[ae[3].key])continue}let re=J.wasRequested();for(let ae=Y.overscaledZ-1;ae>=D;--ae){let _e=Y.scaledTo(ae);if(I[_e.key])break;if(I[_e.key]=!0,J=this.getTile(_e),!J&&re&&(J=this._addTile(_e)),J){let Ce=J.hasData();if((re||Ce)&&(S[_e.key]=_e),re=J.wasRequested(),Ce)break}}}return S}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let h in this._tiles){let x=[],S,I=this._tiles[h].tileID;for(;I.overscaledZ>0;){if(I.key in this._loadedParentTiles){S=this._loadedParentTiles[I.key];break}x.push(I.key);let D=I.scaledTo(I.overscaledZ-1);if(S=this._getLoadedTile(D),S)break;I=D}for(let D of x)this._loadedParentTiles[D]=S}}_addTile(h){let x=this._tiles[h.key];if(x)return x;x=this._cache.getAndRemove(h),x&&(this._setTileReloadTimer(h.key,x),x.tileID=h,this._state.initializeTileState(x,this.map?this.map.painter:null),this._cacheTimers[h.key]&&(clearTimeout(this._cacheTimers[h.key]),delete this._cacheTimers[h.key],this._setTileReloadTimer(h.key,x)));let S=x;return x||(x=new je(h,this._source.tileSize*h.overscaleFactor()),this._loadTile(x,this._tileLoaded.bind(this,x,h.key,x.state))),x.uses++,this._tiles[h.key]=x,S||this._source.fire(new n.Event("dataloading",{tile:x,coord:x.tileID,dataType:"source"})),x}_setTileReloadTimer(h,x){h in this._timers&&(clearTimeout(this._timers[h]),delete this._timers[h]);let S=x.getExpiryTimeout();S&&(this._timers[h]=setTimeout(()=>{this._reloadTile(h,"expired"),delete this._timers[h]},S))}_removeTile(h){let x=this._tiles[h];x&&(x.uses--,delete this._tiles[h],this._timers[h]&&(clearTimeout(this._timers[h]),delete this._timers[h]),x.uses>0||(x.hasData()&&x.state!=="reloading"?this._cache.add(x.tileID,x,x.getExpiryTimeout()):(x.aborted=!0,this._abortTile(x),this._unloadTile(x))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let h in this._tiles)this._removeTile(h);this._cache.reset()}tilesIn(h,x,S){let I=[],D=this.transform;if(!D)return I;let G=S?D.getCameraQueryGeometry(h):h,H=h.map(Ae=>D.pointCoordinate(Ae,this.terrain)),Y=G.map(Ae=>D.pointCoordinate(Ae,this.terrain)),J=this.getIds(),re=1/0,ae=1/0,_e=-1/0,Ce=-1/0;for(let Ae of Y)re=Math.min(re,Ae.x),ae=Math.min(ae,Ae.y),_e=Math.max(_e,Ae.x),Ce=Math.max(Ce,Ae.y);for(let Ae=0;Ae<J.length;Ae++){let Re=this._tiles[J[Ae]];if(Re.holdingForFade())continue;let Te=Re.tileID,Ve=Math.pow(2,D.zoom-Re.tileID.overscaledZ),tt=x*Re.queryPadding*n.EXTENT/Re.tileSize/Ve,Ne=[Te.getTilePoint(new n.MercatorCoordinate(re,ae)),Te.getTilePoint(new n.MercatorCoordinate(_e,Ce))];if(Ne[0].x-tt<n.EXTENT&&Ne[0].y-tt<n.EXTENT&&Ne[1].x+tt>=0&&Ne[1].y+tt>=0){let Xe=H.map(st=>Te.getTilePoint(st)),rt=Y.map(st=>Te.getTilePoint(st));I.push({tile:Re,tileID:Te,queryGeometry:Xe,cameraQueryGeometry:rt,scale:Ve})}}return I}getVisibleCoordinates(h){let x=this.getRenderableIds(h).map(S=>this._tiles[S].tileID);for(let S of x)S.posMatrix=this.transform.calculatePosMatrix(S.toUnwrapped());return x}hasTransition(){if(this._source.hasTransition())return!0;if(Oe(this._source.type)){let h=n.browser.now();for(let x in this._tiles)if(this._tiles[x].fadeEndTime>=h)return!0}return!1}setFeatureState(h,x,S){this._state.updateState(h=h||"_geojsonTileLayer",x,S)}removeFeatureState(h,x,S){this._state.removeFeatureState(h=h||"_geojsonTileLayer",x,S)}getFeatureState(h,x){return this._state.getState(h=h||"_geojsonTileLayer",x)}setDependencies(h,x,S){let I=this._tiles[h];I&&I.setDependencies(x,S)}reloadTilesForDependencies(h,x){for(let S in this._tiles)this._tiles[S].hasDependency(h,x)&&this._reloadTile(S,"reloading");this._cache.filter(S=>!S.hasDependency(h,x))}}function Pe(P,h){let x=Math.abs(2*P.wrap)-+(P.wrap<0),S=Math.abs(2*h.wrap)-+(h.wrap<0);return P.overscaledZ-h.overscaledZ||S-x||h.canonical.y-P.canonical.y||h.canonical.x-P.canonical.x}function Oe(P){return P==="raster"||P==="image"||P==="video"}xe.maxOverzooming=10,xe.maxUnderzooming=3;let Ie="mapboxgl_preloaded_worker_pool";class nt{constructor(){this.active={}}acquire(h){if(!this.workers)for(this.workers=[];this.workers.length<nt.workerCount;)this.workers.push(new Worker(n.config.WORKER_URL));return this.active[h]=!0,this.workers.slice()}release(h){delete this.active[h],this.numActive()===0&&(this.workers.forEach(x=>{x.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ie]}numActive(){return Object.keys(this.active).length}}let ht=Math.floor(n.browser.hardwareConcurrency/2),Ht;function hi(){return Ht||(Ht=new nt),Ht}nt.workerCount=n.isSafari(globalThis)?Math.max(Math.min(ht,3),1):1;class at{constructor(h,x){this.reset(h,x)}reset(h,x){this.points=h||[],this._distances=[0];for(let S=1;S<this.points.length;S++)this._distances[S]=this._distances[S-1]+this.points[S].dist(this.points[S-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(x||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(h){if(this.points.length===1)return this.points[0];h=n.clamp(h,0,1);let x=1,S=this._distances[x],I=h*this.paddedLength+this.padding;for(;S<I&&x<this._distances.length;)S=this._distances[++x];let D=x-1,G=this._distances[D],H=S-G,Y=H>0?(I-G)/H:0;return this.points[D].mult(1-Y).add(this.points[x].mult(Y))}}function Ot(P,h){let x=!0;return P==="always"||P!=="never"&&h!=="never"||(x=!1),x}class Pt{constructor(h,x,S){let I=this.boxCells=[],D=this.circleCells=[];this.xCellCount=Math.ceil(h/S),this.yCellCount=Math.ceil(x/S);for(let G=0;G<this.xCellCount*this.yCellCount;G++)I.push([]),D.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=h,this.height=x,this.xScale=this.xCellCount/h,this.yScale=this.yCellCount/x,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(h,x,S,I,D){this._forEachCell(x,S,I,D,this._insertBoxCell,this.boxUid++),this.boxKeys.push(h),this.bboxes.push(x),this.bboxes.push(S),this.bboxes.push(I),this.bboxes.push(D)}insertCircle(h,x,S,I){this._forEachCell(x-I,S-I,x+I,S+I,this._insertCircleCell,this.circleUid++),this.circleKeys.push(h),this.circles.push(x),this.circles.push(S),this.circles.push(I)}_insertBoxCell(h,x,S,I,D,G){this.boxCells[D].push(G)}_insertCircleCell(h,x,S,I,D,G){this.circleCells[D].push(G)}_query(h,x,S,I,D,G,H){if(S<0||h>this.width||I<0||x>this.height)return[];let Y=[];if(h<=0&&x<=0&&this.width<=S&&this.height<=I){if(D)return[{key:null,x1:h,y1:x,x2:S,y2:I}];for(let J=0;J<this.boxKeys.length;J++)Y.push({key:this.boxKeys[J],x1:this.bboxes[4*J],y1:this.bboxes[4*J+1],x2:this.bboxes[4*J+2],y2:this.bboxes[4*J+3]});for(let J=0;J<this.circleKeys.length;J++){let re=this.circles[3*J],ae=this.circles[3*J+1],_e=this.circles[3*J+2];Y.push({key:this.circleKeys[J],x1:re-_e,y1:ae-_e,x2:re+_e,y2:ae+_e})}}else this._forEachCell(h,x,S,I,this._queryCell,Y,{hitTest:D,overlapMode:G,seenUids:{box:{},circle:{}}},H);return Y}query(h,x,S,I){return this._query(h,x,S,I,!1,null)}hitTest(h,x,S,I,D,G){return this._query(h,x,S,I,!0,D,G).length>0}hitTestCircle(h,x,S,I,D){let G=h-S,H=h+S,Y=x-S,J=x+S;if(H<0||G>this.width||J<0||Y>this.height)return!1;let re=[];return this._forEachCell(G,Y,H,J,this._queryCellCircle,re,{hitTest:!0,overlapMode:I,circle:{x:h,y:x,radius:S},seenUids:{box:{},circle:{}}},D),re.length>0}_queryCell(h,x,S,I,D,G,H,Y){let{seenUids:J,hitTest:re,overlapMode:ae}=H,_e=this.boxCells[D];if(_e!==null){let Ae=this.bboxes;for(let Re of _e)if(!J.box[Re]){J.box[Re]=!0;let Te=4*Re,Ve=this.boxKeys[Re];if(h<=Ae[Te+2]&&x<=Ae[Te+3]&&S>=Ae[Te+0]&&I>=Ae[Te+1]&&(!Y||Y(Ve))&&(!re||!Ot(ae,Ve.overlapMode))&&(G.push({key:Ve,x1:Ae[Te],y1:Ae[Te+1],x2:Ae[Te+2],y2:Ae[Te+3]}),re))return!0}}let Ce=this.circleCells[D];if(Ce!==null){let Ae=this.circles;for(let Re of Ce)if(!J.circle[Re]){J.circle[Re]=!0;let Te=3*Re,Ve=this.circleKeys[Re];if(this._circleAndRectCollide(Ae[Te],Ae[Te+1],Ae[Te+2],h,x,S,I)&&(!Y||Y(Ve))&&(!re||!Ot(ae,Ve.overlapMode))){let tt=Ae[Te],Ne=Ae[Te+1],Xe=Ae[Te+2];if(G.push({key:Ve,x1:tt-Xe,y1:Ne-Xe,x2:tt+Xe,y2:Ne+Xe}),re)return!0}}}return!1}_queryCellCircle(h,x,S,I,D,G,H,Y){let{circle:J,seenUids:re,overlapMode:ae}=H,_e=this.boxCells[D];if(_e!==null){let Ae=this.bboxes;for(let Re of _e)if(!re.box[Re]){re.box[Re]=!0;let Te=4*Re,Ve=this.boxKeys[Re];if(this._circleAndRectCollide(J.x,J.y,J.radius,Ae[Te+0],Ae[Te+1],Ae[Te+2],Ae[Te+3])&&(!Y||Y(Ve))&&!Ot(ae,Ve.overlapMode))return G.push(!0),!0}}let Ce=this.circleCells[D];if(Ce!==null){let Ae=this.circles;for(let Re of Ce)if(!re.circle[Re]){re.circle[Re]=!0;let Te=3*Re,Ve=this.circleKeys[Re];if(this._circlesCollide(Ae[Te],Ae[Te+1],Ae[Te+2],J.x,J.y,J.radius)&&(!Y||Y(Ve))&&!Ot(ae,Ve.overlapMode))return G.push(!0),!0}}}_forEachCell(h,x,S,I,D,G,H,Y){let J=this._convertToXCellCoord(h),re=this._convertToYCellCoord(x),ae=this._convertToXCellCoord(S),_e=this._convertToYCellCoord(I);for(let Ce=J;Ce<=ae;Ce++)for(let Ae=re;Ae<=_e;Ae++)if(D.call(this,h,x,S,I,this.xCellCount*Ae+Ce,G,H,Y))return}_convertToXCellCoord(h){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(h*this.xScale)))}_convertToYCellCoord(h){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(h*this.yScale)))}_circlesCollide(h,x,S,I,D,G){let H=I-h,Y=D-x,J=S+G;return J*J>H*H+Y*Y}_circleAndRectCollide(h,x,S,I,D,G,H){let Y=(G-I)/2,J=Math.abs(h-(I+Y));if(J>Y+S)return!1;let re=(H-D)/2,ae=Math.abs(x-(D+re));if(ae>re+S)return!1;if(J<=Y||ae<=re)return!0;let _e=J-Y,Ce=ae-re;return _e*_e+Ce*Ce<=S*S}}function Zi(P,h,x,S,I){let D=n.create();return h?(n.scale(D,D,[1/I,1/I,1]),x||n.rotateZ(D,D,S.angle)):n.multiply(D,S.labelPlaneMatrix,P),D}function ji(P,h,x,S,I){if(h){let D=n.clone(P);return n.scale(D,D,[I,I,1]),x||n.rotateZ(D,D,-S.angle),D}return S.glCoordMatrix}function Ke(P,h,x){let S;x?(S=[P.x,P.y,x(P.x,P.y),1],n.transformMat4(S,S,h)):(S=[P.x,P.y,0,1],Fe(S,S,h));let I=S[3];return{point:new n.Point(S[0]/I,S[1]/I),signedDistanceFromCamera:I}}function dt(P,h){return .5+P/h*.5}function Lt(P,h){let x=P[0]/P[3],S=P[1]/P[3];return x>=-h[0]&&x<=h[0]&&S>=-h[1]&&S<=h[1]}function Yt(P,h,x,S,I,D,G,H,Y,J){let re=S?P.textSizeData:P.iconSizeData,ae=n.evaluateSizeForZoom(re,x.transform.zoom),_e=[256/x.width*2+1,256/x.height*2+1],Ce=S?P.text.dynamicLayoutVertexArray:P.icon.dynamicLayoutVertexArray;Ce.clear();let Ae=P.lineVertexArray,Re=S?P.text.placedSymbolArray:P.icon.placedSymbolArray,Te=x.transform.width/x.transform.height,Ve=!1;for(let tt=0;tt<Re.length;tt++){let Ne=Re.get(tt);if(Ne.hidden||Ne.writingMode===n.WritingMode.vertical&&!Ve){Ee(Ne.numGlyphs,Ce);continue}let Xe;if(Ve=!1,J?(Xe=[Ne.anchorX,Ne.anchorY,J(Ne.anchorX,Ne.anchorY),1],n.transformMat4(Xe,Xe,h)):(Xe=[Ne.anchorX,Ne.anchorY,0,1],Fe(Xe,Xe,h)),!Lt(Xe,_e)){Ee(Ne.numGlyphs,Ce);continue}let rt=dt(x.transform.cameraToCenterDistance,Xe[3]),st=n.evaluateSizeForFeature(re,ae,Ne),ft=G?st/rt:st*rt,Tt=new n.Point(Ne.anchorX,Ne.anchorY),Et=Ke(Tt,I,J).point,kt={projections:{},offsets:{}},oi=Ir(Ne,ft,!1,H,h,I,D,P.glyphOffsetArray,Ae,Ce,Et,Tt,kt,Te,Y,J);Ve=oi.useVertical,(oi.notEnoughRoom||Ve||oi.needsFlipping&&Ir(Ne,ft,!0,H,h,I,D,P.glyphOffsetArray,Ae,Ce,Et,Tt,kt,Te,Y,J).notEnoughRoom)&&Ee(Ne.numGlyphs,Ce)}S?P.text.dynamicLayoutVertexBuffer.updateData(Ce):P.icon.dynamicLayoutVertexBuffer.updateData(Ce)}function Kt(P,h,x,S,I,D,G,H,Y,J,re,ae,_e){let Ce=H.glyphStartIndex+H.numGlyphs,Ae=H.lineStartIndex,Re=H.lineStartIndex+H.lineLength,Te=h.getoffsetX(H.glyphStartIndex),Ve=h.getoffsetX(Ce-1),tt=he(P*Te,x,S,I,D,G,H.segment,Ae,Re,Y,J,re,ae,_e);if(!tt)return null;let Ne=he(P*Ve,x,S,I,D,G,H.segment,Ae,Re,Y,J,re,ae,_e);return Ne?{first:tt,last:Ne}:null}function Fi(P,h,x,S){return P===n.WritingMode.horizontal&&Math.abs(x.y-h.y)>Math.abs(x.x-h.x)*S?{useVertical:!0}:(P===n.WritingMode.vertical?h.y<x.y:h.x>x.x)?{needsFlipping:!0}:null}function Ir(P,h,x,S,I,D,G,H,Y,J,re,ae,_e,Ce,Ae,Re){let Te=h/24,Ve=P.lineOffsetX*Te,tt=P.lineOffsetY*Te,Ne;if(P.numGlyphs>1){let Xe=P.glyphStartIndex+P.numGlyphs,rt=P.lineStartIndex,st=P.lineStartIndex+P.lineLength,ft=Kt(Te,H,Ve,tt,x,re,ae,P,Y,D,_e,Ae,Re);if(!ft)return{notEnoughRoom:!0};let Tt=Ke(ft.first.point,G,Re).point,Et=Ke(ft.last.point,G,Re).point;if(S&&!x){let kt=Fi(P.writingMode,Tt,Et,Ce);if(kt)return kt}Ne=[ft.first];for(let kt=P.glyphStartIndex+1;kt<Xe-1;kt++)Ne.push(he(Te*H.getoffsetX(kt),Ve,tt,x,re,ae,P.segment,rt,st,Y,D,_e,Ae,Re));Ne.push(ft.last)}else{if(S&&!x){let rt=Ke(ae,I,Re).point,st=P.lineStartIndex+P.segment+1,ft=new n.Point(Y.getx(st),Y.gety(st)),Tt=Ke(ft,I,Re),Et=Tt.signedDistanceFromCamera>0?Tt.point:Qi(ae,ft,rt,1,I,Re),kt=Fi(P.writingMode,rt,Et,Ce);if(kt)return kt}let Xe=he(Te*H.getoffsetX(P.glyphStartIndex),Ve,tt,x,re,ae,P.segment,P.lineStartIndex,P.lineStartIndex+P.lineLength,Y,D,_e,Ae,Re);if(!Xe)return{notEnoughRoom:!0};Ne=[Xe]}for(let Xe of Ne)n.addDynamicAttributes(J,Xe.point,Xe.angle);return{}}function Qi(P,h,x,S,I,D){let G=Ke(P.add(P.sub(h)._unit()),I,D).point,H=x.sub(G);return x.add(H._mult(S/H.mag()))}function ys(P,h){let{projectionCache:x,lineVertexArray:S,labelPlaneMatrix:I,tileAnchorPoint:D,distanceFromAnchor:G,getElevation:H,previousVertex:Y,direction:J,absOffsetX:re}=h;if(x.projections[P])return x.projections[P];let ae=new n.Point(S.getx(P),S.gety(P)),_e=Ke(ae,I,H);if(_e.signedDistanceFromCamera>0)return x.projections[P]=_e.point,_e.point;let Ce=P-J;return Qi(G===0?D:new n.Point(S.getx(Ce),S.gety(Ce)),ae,Y,re-G+1,I,H)}function ls(P,h,x){return P._unit()._perp()._mult(h*x)}function Me(P,h,x,S,I,D,G,H){let{projectionCache:Y,direction:J}=H;if(Y.offsets[P])return Y.offsets[P];let re=x.add(h);if(P+J<S||P+J>=I)return Y.offsets[P]=re,re;let ae=ys(P+J,H),_e=ls(ae.sub(x),G,J),Ce=x.add(_e),Ae=ae.add(_e);return Y.offsets[P]=n.findLineIntersection(D,re,Ce,Ae)||re,Y.offsets[P]}function he(P,h,x,S,I,D,G,H,Y,J,re,ae,_e,Ce){let Ae=S?P-h:P+h,Re=Ae>0?1:-1,Te=0;S&&(Re*=-1,Te=Math.PI),Re<0&&(Te+=Math.PI);let Ve,tt,Ne=Re>0?H+G:H+G+1,Xe=I,rt=I,st=0,ft=0,Tt=Math.abs(Ae),Et=[],kt;for(;st+ft<=Tt;){if(Ne+=Re,Ne<H||Ne>=Y)return null;st+=ft,rt=Xe,tt=Ve;let Ut={projectionCache:ae,lineVertexArray:J,labelPlaneMatrix:re,tileAnchorPoint:D,distanceFromAnchor:st,getElevation:Ce,previousVertex:rt,direction:Re,absOffsetX:Tt};if(Xe=ys(Ne,Ut),x===0)Et.push(rt),kt=Xe.sub(rt);else{let yi,ii=Xe.sub(rt);yi=ii.mag()===0?ls(ys(Ne+Re,Ut).sub(Xe),x,Re):ls(ii,x,Re),tt||(tt=rt.add(yi)),Ve=Me(Ne,yi,Xe,H,Y,tt,x,Ut),Et.push(tt),kt=Ve.sub(tt)}ft=kt.mag()}let oi=kt._mult((Tt-st)/ft)._add(tt||rt),or=Te+Math.atan2(Xe.y-rt.y,Xe.x-rt.x);return Et.push(oi),{point:oi,angle:_e?or:0,path:Et}}let pe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ee(P,h){for(let x=0;x<P;x++){let S=h.length;h.resize(S+4),h.float32.set(pe,3*S)}}function Fe(P,h,x){let S=h[0],I=h[1];return P[0]=x[0]*S+x[4]*I+x[12],P[1]=x[1]*S+x[5]*I+x[13],P[3]=x[3]*S+x[7]*I+x[15],P}let Ue=100;class We{constructor(h,x=new Pt(h.width+200,h.height+200,25),S=new Pt(h.width+200,h.height+200,25)){this.transform=h,this.grid=x,this.ignoredGrid=S,this.pitchfactor=Math.cos(h._pitch)*h.cameraToCenterDistance,this.screenRightBoundary=h.width+Ue,this.screenBottomBoundary=h.height+Ue,this.gridRightBoundary=h.width+200,this.gridBottomBoundary=h.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(h,x,S,I,D,G){let H=this.projectAndGetPerspectiveRatio(I,h.anchorPointX,h.anchorPointY,G),Y=S*H.perspectiveRatio,J=h.x1*Y+H.point.x,re=h.y1*Y+H.point.y,ae=h.x2*Y+H.point.x,_e=h.y2*Y+H.point.y;return!this.isInsideGrid(J,re,ae,_e)||x!=="always"&&this.grid.hitTest(J,re,ae,_e,x,D)||H.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[J,re,ae,_e],offscreen:this.isOffscreen(J,re,ae,_e)}}placeCollisionCircles(h,x,S,I,D,G,H,Y,J,re,ae,_e,Ce,Ae){let Re=[],Te=new n.Point(x.anchorX,x.anchorY),Ve=Ke(Te,G,Ae),tt=dt(this.transform.cameraToCenterDistance,Ve.signedDistanceFromCamera),Ne=(re?D/tt:D*tt)/n.ONE_EM,Xe=Ke(Te,H,Ae).point,rt=Kt(Ne,I,x.lineOffsetX*Ne,x.lineOffsetY*Ne,!1,Xe,Te,x,S,H,{projections:{},offsets:{}},!1,Ae),st=!1,ft=!1,Tt=!0;if(rt){let Et=.5*_e*tt+Ce,kt=new n.Point(-100,-100),oi=new n.Point(this.screenRightBoundary,this.screenBottomBoundary),or=new at,Ut=rt.first,yi=rt.last,ii=[];for(let _i=Ut.path.length-1;_i>=1;_i--)ii.push(Ut.path[_i]);for(let _i=1;_i<yi.path.length;_i++)ii.push(yi.path[_i]);let is=2.5*Et;if(Y){let _i=ii.map(lr=>Ke(lr,Y,Ae));ii=_i.some(lr=>lr.signedDistanceFromCamera<=0)?[]:_i.map(lr=>lr.point)}let ar=[];if(ii.length>0){let _i=ii[0].clone(),lr=ii[0].clone();for(let us=1;us<ii.length;us++)_i.x=Math.min(_i.x,ii[us].x),_i.y=Math.min(_i.y,ii[us].y),lr.x=Math.max(lr.x,ii[us].x),lr.y=Math.max(lr.y,ii[us].y);ar=_i.x>=kt.x&&lr.x<=oi.x&&_i.y>=kt.y&&lr.y<=oi.y?[ii]:lr.x<kt.x||_i.x>oi.x||lr.y<kt.y||_i.y>oi.y?[]:n.clipLine([ii],kt.x,kt.y,oi.x,oi.y)}for(let _i of ar){or.reset(_i,.25*Et);let lr=0;lr=or.length<=.5*Et?1:Math.ceil(or.paddedLength/is)+1;for(let us=0;us<lr;us++){let Dr=us/Math.max(lr-1,1),Co=or.lerp(Dr),Sn=Co.x+Ue,Ts=Co.y+Ue;Re.push(Sn,Ts,Et,0);let ao=Sn-Et,cl=Ts-Et,Ma=Sn+Et,ul=Ts+Et;if(Tt=Tt&&this.isOffscreen(ao,cl,Ma,ul),ft=ft||this.isInsideGrid(ao,cl,Ma,ul),h!=="always"&&this.grid.hitTestCircle(Sn,Ts,Et,h,ae)&&(st=!0,!J))return{circles:[],offscreen:!1,collisionDetected:st}}}}return{circles:!J&&st||!ft||tt<this.perspectiveRatioCutoff?[]:Re,offscreen:Tt,collisionDetected:st}}queryRenderedSymbols(h){if(h.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let x=[],S=1/0,I=1/0,D=-1/0,G=-1/0;for(let re of h){let ae=new n.Point(re.x+Ue,re.y+Ue);S=Math.min(S,ae.x),I=Math.min(I,ae.y),D=Math.max(D,ae.x),G=Math.max(G,ae.y),x.push(ae)}let H=this.grid.query(S,I,D,G).concat(this.ignoredGrid.query(S,I,D,G)),Y={},J={};for(let re of H){let ae=re.key;if(Y[ae.bucketInstanceId]===void 0&&(Y[ae.bucketInstanceId]={}),Y[ae.bucketInstanceId][ae.featureIndex])continue;let _e=[new n.Point(re.x1,re.y1),new n.Point(re.x2,re.y1),new n.Point(re.x2,re.y2),new n.Point(re.x1,re.y2)];n.polygonIntersectsPolygon(x,_e)&&(Y[ae.bucketInstanceId][ae.featureIndex]=!0,J[ae.bucketInstanceId]===void 0&&(J[ae.bucketInstanceId]=[]),J[ae.bucketInstanceId].push(ae.featureIndex))}return J}insertCollisionBox(h,x,S,I,D,G){(S?this.ignoredGrid:this.grid).insert({bucketInstanceId:I,featureIndex:D,collisionGroupID:G,overlapMode:x},h[0],h[1],h[2],h[3])}insertCollisionCircles(h,x,S,I,D,G){let H=S?this.ignoredGrid:this.grid,Y={bucketInstanceId:I,featureIndex:D,collisionGroupID:G,overlapMode:x};for(let J=0;J<h.length;J+=4)H.insertCircle(Y,h[J],h[J+1],h[J+2])}projectAndGetPerspectiveRatio(h,x,S,I){let D;return I?(D=[x,S,I(x,S),1],n.transformMat4(D,D,h)):(D=[x,S,0,1],Fe(D,D,h)),{point:new n.Point((D[0]/D[3]+1)/2*this.transform.width+Ue,(-D[1]/D[3]+1)/2*this.transform.height+Ue),perspectiveRatio:.5+this.transform.cameraToCenterDistance/D[3]*.5}}isOffscreen(h,x,S,I){return S<Ue||h>=this.screenRightBoundary||I<Ue||x>this.screenBottomBoundary}isInsideGrid(h,x,S,I){return S>=0&&h<this.gridRightBoundary&&I>=0&&x<this.gridBottomBoundary}getViewportMatrix(){let h=n.identity([]);return n.translate(h,h,[-100,-100,0]),h}}function Ge(P,h,x){return h*(n.EXTENT/(P.tileSize*Math.pow(2,x-P.tileID.overscaledZ)))}class ze{constructor(h,x,S,I){this.opacity=h?Math.max(0,Math.min(1,h.opacity+(h.placed?x:-x))):I&&S?1:0,this.placed=S}isHidden(){return this.opacity===0&&!this.placed}}class Ze{constructor(h,x,S,I,D){this.text=new ze(h?h.text:null,x,S,D),this.icon=new ze(h?h.icon:null,x,I,D)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _t{constructor(h,x,S){this.text=h,this.icon=x,this.skipFade=S}}class bt{constructor(){this.invProjMatrix=n.create(),this.viewportMatrix=n.create(),this.circles=[]}}class wt{constructor(h,x,S,I,D){this.bucketInstanceId=h,this.featureIndex=x,this.sourceLayerIndex=S,this.bucketIndex=I,this.tileID=D}}class wi{constructor(h){this.crossSourceCollisions=h,this.maxGroupID=0,this.collisionGroups={}}get(h){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[h]){let x=++this.maxGroupID;this.collisionGroups[h]={ID:x,predicate:S=>S.collisionGroupID===x}}return this.collisionGroups[h]}}function $i(P,h,x,S,I){let{horizontalAlign:D,verticalAlign:G}=n.getAnchorAlignment(P);return new n.Point(-(D-.5)*h+S[0]*I,-(G-.5)*x+S[1]*I)}function ni(P,h,x,S,I,D){let{x1:G,x2:H,y1:Y,y2:J,anchorPointX:re,anchorPointY:ae}=P,_e=new n.Point(h,x);return S&&_e._rotate(I?D:-D),{x1:G+_e.x,y1:Y+_e.y,x2:H+_e.x,y2:J+_e.y,anchorPointX:re,anchorPointY:ae}}class gi{constructor(h,x,S,I,D){this.transform=h.clone(),this.terrain=x,this.collisionIndex=new We(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=S,this.retainedQueryData={},this.collisionGroups=new wi(I),this.collisionCircleArrays={},this.prevPlacement=D,D&&(D.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(h,x,S,I){let D=S.getBucket(x),G=S.latestFeatureIndex;if(!D||!G||x.id!==D.layerIds[0])return;let H=S.collisionBoxArray,Y=D.layers[0].layout,J=Math.pow(2,this.transform.zoom-S.tileID.overscaledZ),re=S.tileSize/n.EXTENT,ae=this.transform.calculatePosMatrix(S.tileID.toUnwrapped()),_e=Y.get("text-pitch-alignment")==="map",Ce=Y.get("text-rotation-alignment")==="map",Ae=Ge(S,1,this.transform.zoom),Re=Zi(ae,_e,Ce,this.transform,Ae),Te=null;if(_e){let tt=ji(ae,_e,Ce,this.transform,Ae);Te=n.multiply([],this.transform.labelPlaneMatrix,tt)}this.retainedQueryData[D.bucketInstanceId]=new wt(D.bucketInstanceId,G,D.sourceLayerIndex,D.index,S.tileID);let Ve={bucket:D,layout:Y,posMatrix:ae,textLabelPlaneMatrix:Re,labelToScreenMatrix:Te,scale:J,textPixelRatio:re,holdingForFade:S.holdingForFade(),collisionBoxArray:H,partiallyEvaluatedTextSize:n.evaluateSizeForZoom(D.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(D.sourceID)};if(I)for(let tt of D.sortKeyRanges){let{sortKey:Ne,symbolInstanceStart:Xe,symbolInstanceEnd:rt}=tt;h.push({sortKey:Ne,symbolInstanceStart:Xe,symbolInstanceEnd:rt,parameters:Ve})}else h.push({symbolInstanceStart:0,symbolInstanceEnd:D.symbolInstances.length,parameters:Ve})}attemptAnchorPlacement(h,x,S,I,D,G,H,Y,J,re,ae,_e,Ce,Ae,Re,Te){let Ve=n.TextAnchorEnum[h.textAnchor],tt=[h.textOffset0,h.textOffset1],Ne=$i(Ve,S,I,tt,D),Xe=this.collisionIndex.placeCollisionBox(ni(x,Ne.x,Ne.y,G,H,this.transform.angle),ae,Y,J,re.predicate,Te);if((!Re||this.collisionIndex.placeCollisionBox(ni(Re,Ne.x,Ne.y,G,H,this.transform.angle),ae,Y,J,re.predicate,Te).box.length!==0)&&Xe.box.length>0){let rt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID].text&&(rt=this.prevPlacement.variableOffsets[_e.crossTileID].anchor),_e.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[_e.crossTileID]={textOffset:tt,width:S,height:I,anchor:Ve,textBoxScale:D,prevAnchor:rt},this.markUsedJustification(Ce,Ve,_e,Ae),Ce.allowVerticalPlacement&&(this.markUsedOrientation(Ce,Ae,_e),this.placedOrientations[_e.crossTileID]=Ae),{shift:Ne,placedGlyphBoxes:Xe}}}placeLayerBucketPart(h,x,S){let{bucket:I,layout:D,posMatrix:G,textLabelPlaneMatrix:H,labelToScreenMatrix:Y,textPixelRatio:J,holdingForFade:re,collisionBoxArray:ae,partiallyEvaluatedTextSize:_e,collisionGroup:Ce}=h.parameters,Ae=D.get("text-optional"),Re=D.get("icon-optional"),Te=n.getOverlapMode(D,"text-overlap","text-allow-overlap"),Ve=Te==="always",tt=n.getOverlapMode(D,"icon-overlap","icon-allow-overlap"),Ne=tt==="always",Xe=D.get("text-rotation-alignment")==="map",rt=D.get("text-pitch-alignment")==="map",st=D.get("icon-text-fit")!=="none",ft=D.get("symbol-z-order")==="viewport-y",Tt=Ve&&(Ne||!I.hasIconData()||Re),Et=Ne&&(Ve||!I.hasTextData()||Ae);!I.collisionArrays&&ae&&I.deserializeCollisionBoxes(ae);let kt=this.retainedQueryData[I.bucketInstanceId].tileID,oi=this.terrain?(Ut,yi)=>this.terrain.getElevation(kt,Ut,yi):null,or=(Ut,yi)=>{var ii,is;if(x[Ut.crossTileID])return;if(re)return void(this.placements[Ut.crossTileID]=new _t(!1,!1,!1));let ar=!1,_i=!1,lr=!0,us=null,Dr={box:null,offscreen:null},Co={box:null,offscreen:null},Sn=null,Ts=null,ao=null,cl=0,Ma=0,ul=0;yi.textFeatureIndex?cl=yi.textFeatureIndex:Ut.useRuntimeCollisionCircles&&(cl=Ut.featureIndex),yi.verticalTextFeatureIndex&&(Ma=yi.verticalTextFeatureIndex);let g1=yi.textBox;if(g1){let Ds=on=>{let js=n.WritingMode.horizontal;if(I.allowVerticalPlacement&&!on&&this.prevPlacement){let Nn=this.prevPlacement.placedOrientations[Ut.crossTileID];Nn&&(this.placedOrientations[Ut.crossTileID]=Nn,js=Nn,this.markUsedOrientation(I,js,Ut))}return js},nn=(on,js)=>{if(I.allowVerticalPlacement&&Ut.numVerticalGlyphVertices>0&&yi.verticalTextBox){for(let Nn of I.writingModes)if(Nn===n.WritingMode.vertical?(Dr=js(),Co=Dr):Dr=on(),Dr&&Dr.box&&Dr.box.length)break}else Dr=on()},Ln=Ut.textAnchorOffsetStartIndex,y1=Ut.textAnchorOffsetEndIndex;if(y1===Ln){let on=(js,Nn)=>{let hs=this.collisionIndex.placeCollisionBox(js,Te,J,G,Ce.predicate,oi);return hs&&hs.box&&hs.box.length&&(this.markUsedOrientation(I,Nn,Ut),this.placedOrientations[Ut.crossTileID]=Nn),hs};nn(()=>on(g1,n.WritingMode.horizontal),()=>{let js=yi.verticalTextBox;return I.allowVerticalPlacement&&Ut.numVerticalGlyphVertices>0&&js?on(js,n.WritingMode.vertical):{box:null,offscreen:null}}),Ds(Dr&&Dr.box&&Dr.box.length)}else{let on=n.TextAnchorEnum[(is=(ii=this.prevPlacement)===null||ii===void 0?void 0:ii.variableOffsets[Ut.crossTileID])===null||is===void 0?void 0:is.anchor],js=(hs,Ul,Pa)=>{let bc=hs.x2-hs.x1,W7=hs.y2-hs.y1,hu=Ut.textBoxScale,_v=st&&tt==="never"?Ul:null,du={box:[],offscreen:!1},xs=Te==="never"?1:2,ef="never";on&&xs++;for(let Xp=0;Xp<xs;Xp++){for(let zl=Ln;zl<y1;zl++){let wc=I.textAnchorOffsets.get(zl);if(on&&wc.textAnchor!==on)continue;let _1=this.attemptAnchorPlacement(wc,hs,bc,W7,hu,Xe,rt,J,G,Ce,ef,Ut,I,Pa,_v,oi);if(_1&&(du=_1.placedGlyphBoxes,du&&du.box&&du.box.length))return ar=!0,us=_1.shift,du}on?on=null:ef=Te}return du};nn(()=>js(g1,yi.iconBox,n.WritingMode.horizontal),()=>{let hs=yi.verticalTextBox;return I.allowVerticalPlacement&&!(Dr&&Dr.box&&Dr.box.length)&&Ut.numVerticalGlyphVertices>0&&hs?js(hs,yi.verticalIconBox,n.WritingMode.vertical):{box:null,offscreen:null}}),Dr&&(ar=Dr.box,lr=Dr.offscreen);let Nn=Ds(Dr&&Dr.box);if(!ar&&this.prevPlacement){let hs=this.prevPlacement.variableOffsets[Ut.crossTileID];hs&&(this.variableOffsets[Ut.crossTileID]=hs,this.markUsedJustification(I,hs.anchor,Ut,Nn))}}}if(Sn=Dr,ar=Sn&&Sn.box&&Sn.box.length>0,lr=Sn&&Sn.offscreen,Ut.useRuntimeCollisionCircles){let Ds=I.text.placedSymbolArray.get(Ut.centerJustifiedTextSymbolIndex),nn=n.evaluateSizeForFeature(I.textSizeData,_e,Ds),Ln=D.get("text-padding");Ts=this.collisionIndex.placeCollisionCircles(Te,Ds,I.lineVertexArray,I.glyphOffsetArray,nn,G,H,Y,S,rt,Ce.predicate,Ut.collisionCircleDiameter,Ln,oi),Ts.circles.length&&Ts.collisionDetected&&!S&&n.warnOnce("Collisions detected, but collision boxes are not shown"),ar=Ve||Ts.circles.length>0&&!Ts.collisionDetected,lr=lr&&Ts.offscreen}if(yi.iconFeatureIndex&&(ul=yi.iconFeatureIndex),yi.iconBox){let Ds=nn=>{let Ln=st&&us?ni(nn,us.x,us.y,Xe,rt,this.transform.angle):nn;return this.collisionIndex.placeCollisionBox(Ln,tt,J,G,Ce.predicate,oi)};Co&&Co.box&&Co.box.length&&yi.verticalIconBox?(ao=Ds(yi.verticalIconBox),_i=ao.box.length>0):(ao=Ds(yi.iconBox),_i=ao.box.length>0),lr=lr&&ao.offscreen}let vc=Ae||Ut.numHorizontalGlyphVertices===0&&Ut.numVerticalGlyphVertices===0,Bl=Re||Ut.numIconVertices===0;if(vc||Bl?Bl?vc||(_i=_i&&ar):ar=_i&&ar:_i=ar=_i&&ar,ar&&Sn&&Sn.box&&this.collisionIndex.insertCollisionBox(Sn.box,Te,D.get("text-ignore-placement"),I.bucketInstanceId,Co&&Co.box&&Ma?Ma:cl,Ce.ID),_i&&ao&&this.collisionIndex.insertCollisionBox(ao.box,tt,D.get("icon-ignore-placement"),I.bucketInstanceId,ul,Ce.ID),Ts&&(ar&&this.collisionIndex.insertCollisionCircles(Ts.circles,Te,D.get("text-ignore-placement"),I.bucketInstanceId,cl,Ce.ID),S)){let Ds=I.bucketInstanceId,nn=this.collisionCircleArrays[Ds];nn===void 0&&(nn=this.collisionCircleArrays[Ds]=new bt);for(let Ln=0;Ln<Ts.circles.length;Ln+=4)nn.circles.push(Ts.circles[Ln+0]),nn.circles.push(Ts.circles[Ln+1]),nn.circles.push(Ts.circles[Ln+2]),nn.circles.push(Ts.collisionDetected?1:0)}if(Ut.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(I.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ut.crossTileID]=new _t(ar||Tt,_i||Et,lr||I.justReloaded),x[Ut.crossTileID]=!0};if(ft){if(h.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let Ut=I.getSortedSymbolIndexes(this.transform.angle);for(let yi=Ut.length-1;yi>=0;--yi){let ii=Ut[yi];or(I.symbolInstances.get(ii),I.collisionArrays[ii])}}else for(let Ut=h.symbolInstanceStart;Ut<h.symbolInstanceEnd;Ut++)or(I.symbolInstances.get(Ut),I.collisionArrays[Ut]);if(S&&I.bucketInstanceId in this.collisionCircleArrays){let Ut=this.collisionCircleArrays[I.bucketInstanceId];n.invert(Ut.invProjMatrix,G),Ut.viewportMatrix=this.collisionIndex.getViewportMatrix()}I.justReloaded=!1}markUsedJustification(h,x,S,I){let D;D=I===n.WritingMode.vertical?S.verticalPlacedTextSymbolIndex:{left:S.leftJustifiedTextSymbolIndex,center:S.centerJustifiedTextSymbolIndex,right:S.rightJustifiedTextSymbolIndex}[n.getAnchorJustification(x)];let G=[S.leftJustifiedTextSymbolIndex,S.centerJustifiedTextSymbolIndex,S.rightJustifiedTextSymbolIndex,S.verticalPlacedTextSymbolIndex];for(let H of G)H>=0&&(h.text.placedSymbolArray.get(H).crossTileID=D>=0&&H!==D?0:S.crossTileID)}markUsedOrientation(h,x,S){let I=x===n.WritingMode.horizontal||x===n.WritingMode.horizontalOnly?x:0,D=x===n.WritingMode.vertical?x:0,G=[S.leftJustifiedTextSymbolIndex,S.centerJustifiedTextSymbolIndex,S.rightJustifiedTextSymbolIndex];for(let H of G)h.text.placedSymbolArray.get(H).placedOrientation=I;S.verticalPlacedTextSymbolIndex&&(h.text.placedSymbolArray.get(S.verticalPlacedTextSymbolIndex).placedOrientation=D)}commit(h){this.commitTime=h,this.zoomAtLastRecencyCheck=this.transform.zoom;let x=this.prevPlacement,S=!1;this.prevZoomAdjustment=x?x.zoomAdjustment(this.transform.zoom):0;let I=x?x.symbolFadeChange(h):1,D=x?x.opacities:{},G=x?x.variableOffsets:{},H=x?x.placedOrientations:{};for(let Y in this.placements){let J=this.placements[Y],re=D[Y];re?(this.opacities[Y]=new Ze(re,I,J.text,J.icon),S=S||J.text!==re.text.placed||J.icon!==re.icon.placed):(this.opacities[Y]=new Ze(null,I,J.text,J.icon,J.skipFade),S=S||J.text||J.icon)}for(let Y in D){let J=D[Y];if(!this.opacities[Y]){let re=new Ze(J,I,!1,!1);re.isHidden()||(this.opacities[Y]=re,S=S||J.text.placed||J.icon.placed)}}for(let Y in G)this.variableOffsets[Y]||!this.opacities[Y]||this.opacities[Y].isHidden()||(this.variableOffsets[Y]=G[Y]);for(let Y in H)this.placedOrientations[Y]||!this.opacities[Y]||this.opacities[Y].isHidden()||(this.placedOrientations[Y]=H[Y]);if(x&&x.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");S?this.lastPlacementChangeTime=h:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=x?x.lastPlacementChangeTime:h)}updateLayerOpacities(h,x){let S={};for(let I of x){let D=I.getBucket(h);D&&I.latestFeatureIndex&&h.id===D.layerIds[0]&&this.updateBucketOpacities(D,S,I.collisionBoxArray)}}updateBucketOpacities(h,x,S){h.hasTextData()&&(h.text.opacityVertexArray.clear(),h.text.hasVisibleVertices=!1),h.hasIconData()&&(h.icon.opacityVertexArray.clear(),h.icon.hasVisibleVertices=!1),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexArray.clear(),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexArray.clear();let I=h.layers[0],D=I.layout,G=new Ze(null,0,!1,!1,!0),H=D.get("text-allow-overlap"),Y=D.get("icon-allow-overlap"),J=I._unevaluatedLayout.hasValue("text-variable-anchor")||I._unevaluatedLayout.hasValue("text-variable-anchor-offset"),re=D.get("text-rotation-alignment")==="map",ae=D.get("text-pitch-alignment")==="map",_e=D.get("icon-text-fit")!=="none",Ce=new Ze(null,0,H&&(Y||!h.hasIconData()||D.get("icon-optional")),Y&&(H||!h.hasTextData()||D.get("text-optional")),!0);!h.collisionArrays&&S&&(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData())&&h.deserializeCollisionBoxes(S);let Ae=(Re,Te,Ve)=>{for(let tt=0;tt<Te/4;tt++)Re.opacityVertexArray.emplaceBack(Ve);Re.hasVisibleVertices=Re.hasVisibleVertices||Ve!==Is};for(let Re=0;Re<h.symbolInstances.length;Re++){let Te=h.symbolInstances.get(Re),{numHorizontalGlyphVertices:Ve,numVerticalGlyphVertices:tt,crossTileID:Ne}=Te,Xe=this.opacities[Ne];x[Ne]?Xe=G:Xe||(Xe=Ce,this.opacities[Ne]=Xe),x[Ne]=!0;let rt=Te.numIconVertices>0,st=this.placedOrientations[Te.crossTileID],ft=st===n.WritingMode.vertical,Tt=st===n.WritingMode.horizontal||st===n.WritingMode.horizontalOnly;if(Ve>0||tt>0){let Et=Tn(Xe.text);Ae(h.text,Ve,ft?Is:Et),Ae(h.text,tt,Tt?Is:Et);let kt=Xe.text.isHidden();[Te.rightJustifiedTextSymbolIndex,Te.centerJustifiedTextSymbolIndex,Te.leftJustifiedTextSymbolIndex].forEach(Ut=>{Ut>=0&&(h.text.placedSymbolArray.get(Ut).hidden=kt||ft?1:0)}),Te.verticalPlacedTextSymbolIndex>=0&&(h.text.placedSymbolArray.get(Te.verticalPlacedTextSymbolIndex).hidden=kt||Tt?1:0);let oi=this.variableOffsets[Te.crossTileID];oi&&this.markUsedJustification(h,oi.anchor,Te,st);let or=this.placedOrientations[Te.crossTileID];or&&(this.markUsedJustification(h,"left",Te,or),this.markUsedOrientation(h,or,Te))}if(rt){let Et=Tn(Xe.icon),kt=!(_e&&Te.verticalPlacedIconSymbolIndex&&ft);Te.placedIconSymbolIndex>=0&&(Ae(h.icon,Te.numIconVertices,kt?Et:Is),h.icon.placedSymbolArray.get(Te.placedIconSymbolIndex).hidden=Xe.icon.isHidden()),Te.verticalPlacedIconSymbolIndex>=0&&(Ae(h.icon,Te.numVerticalIconVertices,kt?Is:Et),h.icon.placedSymbolArray.get(Te.verticalPlacedIconSymbolIndex).hidden=Xe.icon.isHidden())}if(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData()){let Et=h.collisionArrays[Re];if(Et){let kt=new n.Point(0,0);if(Et.textBox||Et.verticalTextBox){let or=!0;if(J){let Ut=this.variableOffsets[Ne];Ut?(kt=$i(Ut.anchor,Ut.width,Ut.height,Ut.textOffset,Ut.textBoxScale),re&&kt._rotate(ae?this.transform.angle:-this.transform.angle)):or=!1}Et.textBox&&Bi(h.textCollisionBox.collisionVertexArray,Xe.text.placed,!or||ft,kt.x,kt.y),Et.verticalTextBox&&Bi(h.textCollisionBox.collisionVertexArray,Xe.text.placed,!or||Tt,kt.x,kt.y)}let oi=!!(!Tt&&Et.verticalIconBox);Et.iconBox&&Bi(h.iconCollisionBox.collisionVertexArray,Xe.icon.placed,oi,_e?kt.x:0,_e?kt.y:0),Et.verticalIconBox&&Bi(h.iconCollisionBox.collisionVertexArray,Xe.icon.placed,!oi,_e?kt.x:0,_e?kt.y:0)}}}if(h.sortFeatures(this.transform.angle),this.retainedQueryData[h.bucketInstanceId]&&(this.retainedQueryData[h.bucketInstanceId].featureSortOrder=h.featureSortOrder),h.hasTextData()&&h.text.opacityVertexBuffer&&h.text.opacityVertexBuffer.updateData(h.text.opacityVertexArray),h.hasIconData()&&h.icon.opacityVertexBuffer&&h.icon.opacityVertexBuffer.updateData(h.icon.opacityVertexArray),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexBuffer&&h.iconCollisionBox.collisionVertexBuffer.updateData(h.iconCollisionBox.collisionVertexArray),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexBuffer&&h.textCollisionBox.collisionVertexBuffer.updateData(h.textCollisionBox.collisionVertexArray),h.text.opacityVertexArray.length!==h.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${h.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${h.text.layoutVertexArray.length}) / 4`);if(h.icon.opacityVertexArray.length!==h.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${h.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${h.icon.layoutVertexArray.length}) / 4`);if(h.bucketInstanceId in this.collisionCircleArrays){let Re=this.collisionCircleArrays[h.bucketInstanceId];h.placementInvProjMatrix=Re.invProjMatrix,h.placementViewportMatrix=Re.viewportMatrix,h.collisionCircleArray=Re.circles,delete this.collisionCircleArrays[h.bucketInstanceId]}}symbolFadeChange(h){return this.fadeDuration===0?1:(h-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(h){return Math.max(0,(this.transform.zoom-h)/1.5)}hasTransitions(h){return this.stale||h-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(h,x){let S=this.zoomAtLastRecencyCheck===x?1-this.zoomAdjustment(x):1;return this.zoomAtLastRecencyCheck=x,this.commitTime+this.fadeDuration*S>h}setStale(){this.stale=!0}}function Bi(P,h,x,S,I){P.emplaceBack(h?1:0,x?1:0,S||0,I||0),P.emplaceBack(h?1:0,x?1:0,S||0,I||0),P.emplaceBack(h?1:0,x?1:0,S||0,I||0),P.emplaceBack(h?1:0,x?1:0,S||0,I||0)}let xr=Math.pow(2,25),Lr=Math.pow(2,24),cr=Math.pow(2,17),yr=Math.pow(2,16),so=Math.pow(2,9),Pi=Math.pow(2,8),Hs=Math.pow(2,1);function Tn(P){if(P.opacity===0&&!P.placed)return 0;if(P.opacity===1&&P.placed)return 4294967295;let h=P.placed?1:0,x=Math.floor(127*P.opacity);return x*xr+h*Lr+x*cr+h*yr+x*so+h*Pi+x*Hs+h}let Is=0;class wo{constructor(h){this._sortAcrossTiles=h.layout.get("symbol-z-order")!=="viewport-y"&&!h.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(h,x,S,I,D){let G=this._bucketParts;for(;this._currentTileIndex<h.length;)if(x.getBucketParts(G,I,h[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,D())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,G.sort((H,Y)=>H.sortKey-Y.sortKey));this._currentPartIndex<G.length;)if(x.placeLayerBucketPart(G[this._currentPartIndex],this._seenCrossTileIDs,S),this._currentPartIndex++,D())return!0;return!1}}class Yx{constructor(h,x,S,I,D,G,H,Y){this.placement=new gi(h,x,G,H,Y),this._currentPlacementIndex=S.length-1,this._forceFullPlacement=I,this._showCollisionBoxes=D,this._done=!1}isDone(){return this._done}continuePlacement(h,x,S){let I=n.browser.now(),D=()=>!this._forceFullPlacement&&n.browser.now()-I>2;for(;this._currentPlacementIndex>=0;){let G=x[h[this._currentPlacementIndex]],H=this.placement.collisionIndex.transform.zoom;if(G.type==="symbol"&&(!G.minzoom||G.minzoom<=H)&&(!G.maxzoom||G.maxzoom>H)){if(this._inProgressLayer||(this._inProgressLayer=new wo(G)),this._inProgressLayer.continuePlacement(S[G.source],this.placement,this._showCollisionBoxes,G,D))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(h){return this.placement.commit(h),this.placement}}let Dn=512/n.EXTENT/2;class na{constructor(h,x,S){this.tileID=h,this.bucketInstanceId=S,this._symbolsByKey={};let I=new Map;for(let D=0;D<x.length;D++){let G=x.get(D),H=G.key,Y=I.get(H);Y?Y.push(G):I.set(H,[G])}for(let[D,G]of I){let H={positions:G.map(Y=>({x:Math.floor(Y.anchorX*Dn),y:Math.floor(Y.anchorY*Dn)})),crossTileIDs:G.map(Y=>Y.crossTileID)};if(H.positions.length>128){let Y=new n.KDBush(H.positions.length,16,Uint16Array);for(let{x:J,y:re}of H.positions)Y.add(J,re);Y.finish(),delete H.positions,H.index=Y}this._symbolsByKey[D]=H}}getScaledCoordinates(h,x){let{x:S,y:I,z:D}=this.tileID.canonical,{x:G,y:H,z:Y}=x.canonical,J=Dn/Math.pow(2,Y-D),re=(H*n.EXTENT+h.anchorY)*J,ae=I*n.EXTENT*Dn;return{x:Math.floor((G*n.EXTENT+h.anchorX)*J-S*n.EXTENT*Dn),y:Math.floor(re-ae)}}findMatches(h,x,S){let I=this.tileID.canonical.z<x.canonical.z?1:Math.pow(2,this.tileID.canonical.z-x.canonical.z);for(let D=0;D<h.length;D++){let G=h.get(D);if(G.crossTileID)continue;let H=this._symbolsByKey[G.key];if(!H)continue;let Y=this.getScaledCoordinates(G,x);if(H.index){let J=H.index.range(Y.x-I,Y.y-I,Y.x+I,Y.y+I).sort();for(let re of J){let ae=H.crossTileIDs[re];if(!S[ae]){S[ae]=!0,G.crossTileID=ae;break}}}else if(H.positions)for(let J=0;J<H.positions.length;J++){let re=H.positions[J],ae=H.crossTileIDs[J];if(Math.abs(re.x-Y.x)<=I&&Math.abs(re.y-Y.y)<=I&&!S[ae]){S[ae]=!0,G.crossTileID=ae;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:h})=>h)}}class _7{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class v0{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(h){let x=Math.round((h-this.lng)/360);if(x!==0)for(let S in this.indexes){let I=this.indexes[S],D={};for(let G in I){let H=I[G];H.tileID=H.tileID.unwrapTo(H.tileID.wrap+x),D[H.tileID.key]=H}this.indexes[S]=D}this.lng=h}addBucket(h,x,S){if(this.indexes[h.overscaledZ]&&this.indexes[h.overscaledZ][h.key]){if(this.indexes[h.overscaledZ][h.key].bucketInstanceId===x.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(h.overscaledZ,this.indexes[h.overscaledZ][h.key])}for(let D=0;D<x.symbolInstances.length;D++)x.symbolInstances.get(D).crossTileID=0;this.usedCrossTileIDs[h.overscaledZ]||(this.usedCrossTileIDs[h.overscaledZ]={});let I=this.usedCrossTileIDs[h.overscaledZ];for(let D in this.indexes){let G=this.indexes[D];if(Number(D)>h.overscaledZ)for(let H in G){let Y=G[H];Y.tileID.isChildOf(h)&&Y.findMatches(x.symbolInstances,h,I)}else{let H=G[h.scaledTo(Number(D)).key];H&&H.findMatches(x.symbolInstances,h,I)}}for(let D=0;D<x.symbolInstances.length;D++){let G=x.symbolInstances.get(D);G.crossTileID||(G.crossTileID=S.generate(),I[G.crossTileID]=!0)}return this.indexes[h.overscaledZ]===void 0&&(this.indexes[h.overscaledZ]={}),this.indexes[h.overscaledZ][h.key]=new na(h,x.symbolInstances,x.bucketInstanceId),!0}removeBucketCrossTileIDs(h,x){for(let S of x.getCrossTileIDsLists())for(let I of S)delete this.usedCrossTileIDs[h][I]}removeStaleBuckets(h){let x=!1;for(let S in this.indexes){let I=this.indexes[S];for(let D in I)h[I[D].bucketInstanceId]||(this.removeBucketCrossTileIDs(S,I[D]),delete I[D],x=!0)}return x}}class ks{constructor(){this.layerIndexes={},this.crossTileIDs=new _7,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(h,x,S){let I=this.layerIndexes[h.id];I===void 0&&(I=this.layerIndexes[h.id]=new v0);let D=!1,G={};I.handleWrapJump(S);for(let H of x){let Y=H.getBucket(h);Y&&h.id===Y.layerIds[0]&&(Y.bucketInstanceId||(Y.bucketInstanceId=++this.maxBucketInstanceId),I.addBucket(H.tileID,Y,this.crossTileIDs)&&(D=!0),G[Y.bucketInstanceId]=!0)}return I.removeStaleBuckets(G)&&(D=!0),D}pruneUnusedLayers(h){let x={};h.forEach(S=>{x[S]=!0});for(let S in this.layerIndexes)x[S]||delete this.layerIndexes[S]}}let gc=(P,h)=>n.emitValidationErrors(P,h&&h.filter(x=>x.identifier!=="source.canvas")),eu=n.pick(n.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Ms=n.pick(n.operations,["setCenter","setZoom","setBearing","setPitch"]),b0=n.emptyStyle();class Fn extends n.Evented{constructor(h,x={}){super(),this.map=h,this.dispatcher=new oe(hi(),this,h._getMapId()),this.imageManager=new q,this.imageManager.setEventedParent(this),this.glyphManager=new X(h._requestManager,x.localIdeographFontFamily),this.lineAtlas=new ee(256,512),this.crossTileSymbolIndex=new ks,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new n.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",n.getReferrer());let S=this;this._rtlTextPluginCallback=Fn.registerForPluginStateChange(I=>{S.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:I.pluginStatus,pluginURL:I.pluginURL},(D,G)=>{if(n.triggerPluginCompletionEvent(D),G&&G.every(H=>H))for(let H in S.sourceCaches){let Y=S.sourceCaches[H].getSource().type;Y!=="vector"&&Y!=="geojson"||S.sourceCaches[H].reload()}})}),this.on("data",I=>{if(I.dataType!=="source"||I.sourceDataType!=="metadata")return;let D=this.sourceCaches[I.sourceId];if(!D)return;let G=D.getSource();if(G&&G.vectorLayerIds)for(let H in this._layers){let Y=this._layers[H];Y.source===G.id&&this._validateLayer(Y)}})}loadURL(h,x={},S){this.fire(new n.Event("dataloading",{dataType:"style"})),x.validate=typeof x.validate!="boolean"||x.validate;let I=this.map._requestManager.transformRequest(h,E.Style);this._request=n.getJSON(I,(D,G)=>{this._request=null,D?this.fire(new n.ErrorEvent(D)):G&&this._load(G,x,S)})}loadJSON(h,x={},S){this.fire(new n.Event("dataloading",{dataType:"style"})),this._request=n.browser.frame(()=>{this._request=null,x.validate=x.validate!==!1,this._load(h,x,S)})}loadEmpty(){this.fire(new n.Event("dataloading",{dataType:"style"})),this._load(b0,{validate:!1})}_load(h,x,S){var I;let D=x.transformStyle?x.transformStyle(S,h):h;if(!x.validate||!gc(this,n.validateStyle(D))){this._loaded=!0,this.stylesheet=D;for(let G in D.sources)this.addSource(G,D.sources[G],{validate:!1});D.sprite?this._loadSprite(D.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(D.glyphs),this._createLayers(),this.light=new te(this.stylesheet.light),this.map.setTerrain((I=this.stylesheet.terrain)!==null&&I!==void 0?I:null),this.fire(new n.Event("data",{dataType:"style"})),this.fire(new n.Event("style.load"))}}_createLayers(){let h=n.derefLayers(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",h),this._order=h.map(x=>x.id),this._layers={},this._serializedLayers=null;for(let x of h){let S=n.createStyleLayer(x);S.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=S}}_loadSprite(h,x=!1,S=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(I,D,G,H){let Y=O(I),J=Y.length,re=G>1?"@2x":"",ae={},_e={},Ce={};for(let{id:Ae,url:Re}of Y){let Te=D.transformRequest(D.normalizeSpriteURL(Re,re,".json"),E.SpriteJSON),Ve=`${Ae}_${Te.url}`;ae[Ve]=n.getJSON(Te,(Xe,rt)=>{delete ae[Ve],_e[Ae]=rt,B(H,_e,Ce,Xe,J)});let tt=D.transformRequest(D.normalizeSpriteURL(Re,re,".png"),E.SpriteImage),Ne=`${Ae}_${tt.url}`;ae[Ne]=v.getImage(tt,(Xe,rt)=>{delete ae[Ne],Ce[Ae]=rt,B(H,_e,Ce,Xe,J)})}return{cancel(){for(let Ae of Object.values(ae))Ae.cancel()}}}(h,this.map._requestManager,this.map.getPixelRatio(),(I,D)=>{if(this._spriteRequest=null,I)this.fire(new n.ErrorEvent(I));else if(D)for(let G in D){this._spritesImagesIds[G]=[];let H=this._spritesImagesIds[G]?this._spritesImagesIds[G].filter(Y=>!(Y in D)):[];for(let Y of H)this.imageManager.removeImage(Y),this._changedImages[Y]=!0;for(let Y in D[G]){let J=G==="default"?Y:`${G}:${Y}`;this._spritesImagesIds[G].push(J),J in this.imageManager.images?this.imageManager.updateImage(J,D[G][Y],!1):this.imageManager.addImage(J,D[G][Y]),x&&(this._changedImages[J]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),x&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"})),S&&S(I)})}_unloadSprite(){for(let h of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(h),this._changedImages[h]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}_validateLayer(h){let x=this.sourceCaches[h.source];if(!x)return;let S=h.sourceLayer;if(!S)return;let I=x.getSource();(I.type==="geojson"||I.vectorLayerIds&&I.vectorLayerIds.indexOf(S)===-1)&&this.fire(new n.ErrorEvent(new Error(`Source layer "${S}" does not exist on source "${I.id}" as specified by style layer "${h.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let h in this.sourceCaches)if(!this.sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(h){let x=this._serializedAllLayers();if(!h||h.length===0)return Object.values(x);let S=[];for(let I of h)x[I]&&S.push(x[I]);return S}_serializedAllLayers(){let h=this._serializedLayers;if(h)return h;h=this._serializedLayers={};let x=Object.keys(this._layers);for(let S of x){let I=this._layers[S];I.type!=="custom"&&(h[S]=I.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(let h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(let h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(h){if(!this._loaded)return;let x=this._changed;if(this._changed){let I=Object.keys(this._updatedLayers),D=Object.keys(this._removedLayers);(I.length||D.length)&&this._updateWorkerLayers(I,D);for(let G in this._updatedSources){let H=this._updatedSources[G];if(H==="reload")this._reloadSource(G);else{if(H!=="clear")throw new Error(`Invalid action ${H}`);this._clearSource(G)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let G in this._updatedPaintProps)this._layers[G].updateTransitions(h);this.light.updateTransitions(h),this._resetUpdates()}let S={};for(let I in this.sourceCaches){let D=this.sourceCaches[I];S[I]=D.used,D.used=!1}for(let I of this._order){let D=this._layers[I];D.recalculate(h,this._availableImages),!D.isHidden(h.zoom)&&D.source&&(this.sourceCaches[D.source].used=!0)}for(let I in S){let D=this.sourceCaches[I];S[I]!==D.used&&D.fire(new n.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:I}))}this.light.recalculate(h),this.z=h.zoom,x&&this.fire(new n.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){let h=Object.keys(this._changedImages);if(h.length){for(let x in this.sourceCaches)this.sourceCaches[x].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(h,x){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(h),removedIds:x})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(h,x={}){this._checkLoaded();let S=this.serialize();if(h=x.transformStyle?x.transformStyle(S,h):h,gc(this,n.validateStyle(h)))return!1;(h=n.clone$1(h)).layers=n.derefLayers(h.layers);let I=n.diffStyles(S,h).filter(G=>!(G.command in Ms));if(I.length===0)return!1;let D=I.filter(G=>!(G.command in eu));if(D.length>0)throw new Error(`Unimplemented: ${D.map(G=>G.command).join(", ")}.`);for(let G of I)G.command!=="setTransition"&&this[G.command].apply(this,G.args);return this.stylesheet=h,!0}addImage(h,x){if(this.getImage(h))return this.fire(new n.ErrorEvent(new Error(`An image named "${h}" already exists.`)));this.imageManager.addImage(h,x),this._afterImageUpdated(h)}updateImage(h,x){this.imageManager.updateImage(h,x)}getImage(h){return this.imageManager.getImage(h)}removeImage(h){if(!this.getImage(h))return this.fire(new n.ErrorEvent(new Error(`An image named "${h}" does not exist.`)));this.imageManager.removeImage(h),this._afterImageUpdated(h)}_afterImageUpdated(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(h,x,S={}){if(this._checkLoaded(),this.sourceCaches[h]!==void 0)throw new Error(`Source "${h}" already exists.`);if(!x.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(x).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(x.type)>=0&&this._validate(n.validateStyle.source,`sources.${h}`,x,null,S))return;this.map&&this.map._collectResourceTiming&&(x.collectResourceTiming=!0);let I=this.sourceCaches[h]=new xe(h,x,this.dispatcher);I.style=this,I.setEventedParent(this,()=>({isSourceLoaded:I.loaded(),source:I.serialize(),sourceId:h})),I.onAdd(this.map),this._changed=!0}removeSource(h){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error("There is no source with this ID");for(let S in this._layers)if(this._layers[S].source===h)return this.fire(new n.ErrorEvent(new Error(`Source "${h}" cannot be removed while layer "${S}" is using it.`)));let x=this.sourceCaches[h];delete this.sourceCaches[h],delete this._updatedSources[h],x.fire(new n.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:h})),x.setEventedParent(null),x.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(h,x){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error(`There is no source with this ID=${h}`);let S=this.sourceCaches[h].getSource();if(S.type!=="geojson")throw new Error(`geojsonSource.type is ${S.type}, which is !== 'geojson`);S.setData(x),this._changed=!0}getSource(h){return this.sourceCaches[h]&&this.sourceCaches[h].getSource()}addLayer(h,x,S={}){this._checkLoaded();let I=h.id;if(this.getLayer(I))return void this.fire(new n.ErrorEvent(new Error(`Layer "${I}" already exists on this map.`)));let D;if(h.type==="custom"){if(gc(this,n.validateCustomStyleLayer(h)))return;D=n.createStyleLayer(h)}else{if("source"in h&&typeof h.source=="object"&&(this.addSource(I,h.source),h=n.clone$1(h),h=n.extend(h,{source:I})),this._validate(n.validateStyle.layer,`layers.${I}`,h,{arrayIndex:-1},S))return;D=n.createStyleLayer(h),this._validateLayer(D),D.setEventedParent(this,{layer:{id:I}})}let G=x?this._order.indexOf(x):this._order.length;if(x&&G===-1)this.fire(new n.ErrorEvent(new Error(`Cannot add layer "${I}" before non-existing layer "${x}".`)));else{if(this._order.splice(G,0,I),this._layerOrderChanged=!0,this._layers[I]=D,this._removedLayers[I]&&D.source&&D.type!=="custom"){let H=this._removedLayers[I];delete this._removedLayers[I],H.type!==D.type?this._updatedSources[D.source]="clear":(this._updatedSources[D.source]="reload",this.sourceCaches[D.source].pause())}this._updateLayer(D),D.onAdd&&D.onAdd(this.map)}}moveLayer(h,x){if(this._checkLoaded(),this._changed=!0,!this._layers[h])return void this.fire(new n.ErrorEvent(new Error(`The layer '${h}' does not exist in the map's style and cannot be moved.`)));if(h===x)return;let S=this._order.indexOf(h);this._order.splice(S,1);let I=x?this._order.indexOf(x):this._order.length;x&&I===-1?this.fire(new n.ErrorEvent(new Error(`Cannot move layer "${h}" before non-existing layer "${x}".`))):(this._order.splice(I,0,h),this._layerOrderChanged=!0)}removeLayer(h){this._checkLoaded();let x=this._layers[h];if(!x)return void this.fire(new n.ErrorEvent(new Error(`Cannot remove non-existing layer "${h}".`)));x.setEventedParent(null);let S=this._order.indexOf(h);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=x,delete this._layers[h],this._serializedLayers&&delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],x.onRemove&&x.onRemove(this.map)}getLayer(h){return this._layers[h]}hasLayer(h){return h in this._layers}setLayerZoomRange(h,x,S){this._checkLoaded();let I=this.getLayer(h);I?I.minzoom===x&&I.maxzoom===S||(x!=null&&(I.minzoom=x),S!=null&&(I.maxzoom=S),this._updateLayer(I)):this.fire(new n.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${h}".`)))}setFilter(h,x,S={}){this._checkLoaded();let I=this.getLayer(h);if(I){if(!n.deepEqual(I.filter,x))return x==null?(I.filter=void 0,void this._updateLayer(I)):void(this._validate(n.validateStyle.filter,`layers.${I.id}.filter`,x,null,S)||(I.filter=n.clone$1(x),this._updateLayer(I)))}else this.fire(new n.ErrorEvent(new Error(`Cannot filter non-existing layer "${h}".`)))}getFilter(h){return n.clone$1(this.getLayer(h).filter)}setLayoutProperty(h,x,S,I={}){this._checkLoaded();let D=this.getLayer(h);D?n.deepEqual(D.getLayoutProperty(x),S)||(D.setLayoutProperty(x,S,I),this._updateLayer(D)):this.fire(new n.ErrorEvent(new Error(`Cannot style non-existing layer "${h}".`)))}getLayoutProperty(h,x){let S=this.getLayer(h);if(S)return S.getLayoutProperty(x);this.fire(new n.ErrorEvent(new Error(`Cannot get style of non-existing layer "${h}".`)))}setPaintProperty(h,x,S,I={}){this._checkLoaded();let D=this.getLayer(h);D?n.deepEqual(D.getPaintProperty(x),S)||(D.setPaintProperty(x,S,I)&&this._updateLayer(D),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new n.ErrorEvent(new Error(`Cannot style non-existing layer "${h}".`)))}getPaintProperty(h,x){return this.getLayer(h).getPaintProperty(x)}setFeatureState(h,x){this._checkLoaded();let S=h.source,I=h.sourceLayer,D=this.sourceCaches[S];if(D===void 0)return void this.fire(new n.ErrorEvent(new Error(`The source '${S}' does not exist in the map's style.`)));let G=D.getSource().type;G==="geojson"&&I?this.fire(new n.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):G!=="vector"||I?(h.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided."))),D.setFeatureState(I,h.id,x)):this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(h,x){this._checkLoaded();let S=h.source,I=this.sourceCaches[S];if(I===void 0)return void this.fire(new n.ErrorEvent(new Error(`The source '${S}' does not exist in the map's style.`)));let D=I.getSource().type,G=D==="vector"?h.sourceLayer:void 0;D!=="vector"||G?x&&typeof h.id!="string"&&typeof h.id!="number"?this.fire(new n.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):I.removeFeatureState(G,h.id,x):this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(h){this._checkLoaded();let x=h.source,S=h.sourceLayer,I=this.sourceCaches[x];if(I!==void 0)return I.getSource().type!=="vector"||S?(h.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided."))),I.getFeatureState(S,h.id)):void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new n.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)))}getTransition(){return n.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let h=n.mapObject(this.sourceCaches,I=>I.serialize()),x=this._serializeByIds(this._order),S=this.stylesheet;return n.filterObject({version:S.version,name:S.name,metadata:S.metadata,light:S.light,center:S.center,zoom:S.zoom,bearing:S.bearing,pitch:S.pitch,sprite:S.sprite,glyphs:S.glyphs,transition:S.transition,sources:h,layers:x},I=>I!==void 0)}_updateLayer(h){this._updatedLayers[h.id]=!0,h.source&&!this._updatedSources[h.source]&&this.sourceCaches[h.source].getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(h){let x=G=>this._layers[G].type==="fill-extrusion",S={},I=[];for(let G=this._order.length-1;G>=0;G--){let H=this._order[G];if(x(H)){S[H]=G;for(let Y of h){let J=Y[H];if(J)for(let re of J)I.push(re)}}}I.sort((G,H)=>H.intersectionZ-G.intersectionZ);let D=[];for(let G=this._order.length-1;G>=0;G--){let H=this._order[G];if(x(H))for(let Y=I.length-1;Y>=0;Y--){let J=I[Y].feature;if(S[J.layer.id]<G)break;D.push(J),I.pop()}else for(let Y of h){let J=Y[H];if(J)for(let re of J)D.push(re.feature)}}return D}queryRenderedFeatures(h,x,S){x&&x.filter&&this._validate(n.validateStyle.filter,"queryRenderedFeatures.filter",x.filter,null,x);let I={};if(x&&x.layers){if(!Array.isArray(x.layers))return this.fire(new n.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(let H of x.layers){let Y=this._layers[H];if(!Y)return this.fire(new n.ErrorEvent(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];I[Y.source]=!0}}let D=[];x.availableImages=this._availableImages;let G=this._serializedAllLayers();for(let H in this.sourceCaches)x.layers&&!I[H]||D.push(Gt(this.sourceCaches[H],this._layers,G,h,x,S));return this.placement&&D.push(function(H,Y,J,re,ae,_e,Ce){let Ae={},Re=_e.queryRenderedSymbols(re),Te=[];for(let Ve of Object.keys(Re).map(Number))Te.push(Ce[Ve]);Te.sort(Ni);for(let Ve of Te){let tt=Ve.featureIndex.lookupSymbolFeatures(Re[Ve.bucketInstanceId],Y,Ve.bucketIndex,Ve.sourceLayerIndex,ae.filter,ae.layers,ae.availableImages,H);for(let Ne in tt){let Xe=Ae[Ne]=Ae[Ne]||[],rt=tt[Ne];rt.sort((st,ft)=>{let Tt=Ve.featureSortOrder;if(Tt){let Et=Tt.indexOf(st.featureIndex);return Tt.indexOf(ft.featureIndex)-Et}return ft.featureIndex-st.featureIndex});for(let st of rt)Xe.push(st)}}for(let Ve in Ae)Ae[Ve].forEach(tt=>{let Ne=tt.feature,Xe=J[H[Ve].source].getFeatureState(Ne.layer["source-layer"],Ne.id);Ne.source=Ne.layer.source,Ne.layer["source-layer"]&&(Ne.sourceLayer=Ne.layer["source-layer"]),Ne.state=Xe});return Ae}(this._layers,G,this.sourceCaches,h,x,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(D)}querySourceFeatures(h,x){x&&x.filter&&this._validate(n.validateStyle.filter,"querySourceFeatures.filter",x.filter,null,x);let S=this.sourceCaches[h];return S?function(I,D){let G=I.getRenderableIds().map(J=>I.getTileByID(J)),H=[],Y={};for(let J=0;J<G.length;J++){let re=G[J],ae=re.tileID.canonical.key;Y[ae]||(Y[ae]=!0,re.querySourceFeatures(H,D))}return H}(S,x):[]}addSourceType(h,x,S){return xt(h)?S(new Error(`A source type called "${h}" already exists.`)):(((I,D)=>{Qe[I]=D})(h,x),x.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:x.workerSourceURL},S):S(null,null))}getLight(){return this.light.getLight()}setLight(h,x={}){this._checkLoaded();let S=this.light.getLight(),I=!1;for(let G in h)if(!n.deepEqual(h[G],S[G])){I=!0;break}if(!I)return;let D={now:n.browser.now(),transition:n.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(h,x),this.light.updateTransitions(D)}_validate(h,x,S,I,D={}){return(!D||D.validate!==!1)&&gc(this,h.call(n.validateStyle,n.extend({key:x,style:this.serialize(),value:S,styleSpec:n.v8Spec},I)))}_remove(h=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(let x in this._layers)this._layers[x].setEventedParent(null);for(let x in this.sourceCaches){let S=this.sourceCaches[x];S.setEventedParent(null),S.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(h)}_clearSource(h){this.sourceCaches[h].clearTiles()}_reloadSource(h){this.sourceCaches[h].resume(),this.sourceCaches[h].reload()}_updateSources(h){for(let x in this.sourceCaches)this.sourceCaches[x].update(h,this.map.terrain)}_generateCollisionBoxes(){for(let h in this.sourceCaches)this._reloadSource(h)}_updatePlacement(h,x,S,I,D=!1){let G=!1,H=!1,Y={};for(let J of this._order){let re=this._layers[J];if(re.type!=="symbol")continue;if(!Y[re.source]){let _e=this.sourceCaches[re.source];Y[re.source]=_e.getRenderableIds(!0).map(Ce=>_e.getTileByID(Ce)).sort((Ce,Ae)=>Ae.tileID.overscaledZ-Ce.tileID.overscaledZ||(Ce.tileID.isLessThan(Ae.tileID)?-1:1))}let ae=this.crossTileSymbolIndex.addLayer(re,Y[re.source],h.center.lng);G=G||ae}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((D=D||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.browser.now(),h.zoom))&&(this.pauseablePlacement=new Yx(h,this.map.terrain,this._order,D,x,S,I,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.browser.now()),H=!0),G&&this.pauseablePlacement.placement.setStale()),H||G)for(let J of this._order){let re=this._layers[J];re.type==="symbol"&&this.placement.updateLayerOpacities(re,Y[re.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.browser.now())}_releaseSymbolFadeTiles(){for(let h in this.sourceCaches)this.sourceCaches[h].releaseSymbolFadeTiles()}getImages(h,x,S){this.imageManager.getImages(x.icons,S),this._updateTilesForChangedImages();let I=this.sourceCaches[x.source];I&&I.setDependencies(x.tileID.key,x.type,x.icons)}getGlyphs(h,x,S){this.glyphManager.getGlyphs(x.stacks,S);let I=this.sourceCaches[x.source];I&&I.setDependencies(x.tileID.key,x.type,[""])}getResource(h,x,S){return n.makeRequest(x,S)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(h,x={}){this._checkLoaded(),h&&this._validate(n.validateStyle.glyphs,"glyphs",h,null,x)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=h,this.glyphManager.entries={},this.glyphManager.setURL(h))}addSprite(h,x,S={},I){this._checkLoaded();let D=[{id:h,url:x}],G=[...O(this.stylesheet.sprite),...D];this._validate(n.validateStyle.sprite,"sprite",G,null,S)||(this.stylesheet.sprite=G,this._loadSprite(D,!0,I))}removeSprite(h){this._checkLoaded();let x=O(this.stylesheet.sprite);if(x.find(S=>S.id===h)){if(this._spritesImagesIds[h])for(let S of this._spritesImagesIds[h])this.imageManager.removeImage(S),this._changedImages[S]=!0;x.splice(x.findIndex(S=>S.id===h),1),this.stylesheet.sprite=x.length>0?x:void 0,delete this._spritesImagesIds[h],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}else this.fire(new n.ErrorEvent(new Error(`Sprite "${h}" doesn't exists on this map.`)))}getSprite(){return O(this.stylesheet.sprite)}setSprite(h,x={},S){this._checkLoaded(),h&&this._validate(n.validateStyle.sprite,"sprite",h,null,x)||(this.stylesheet.sprite=h,h?this._loadSprite(h,!0,S):(this._unloadSprite(),S&&S(null)))}}Fn.registerForPluginStateChange=n.registerForPluginStateChange;var w0=n.createLayout([{name:"a_pos",type:"Int16",components:2}]),ol="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";let bh={prelude:Rr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Rr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Rr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Rr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Rr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Rr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Rr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Rr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Rr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Rr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Rr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Rr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Rr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Rr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Rr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Rr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Rr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Rr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Rr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Rr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Rr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Rr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Rr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Rr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Rr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Rr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Rr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ol),terrainDepth:Rr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ol),terrainCoords:Rr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ol)};function Rr(P,h){let x=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,S=h.match(/attribute ([\w]+) ([\w]+)/g),I=P.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),D=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),G=D?D.concat(I):I,H={};return{fragmentSource:P=P.replace(x,(Y,J,re,ae,_e)=>(H[_e]=!0,J==="define"?`
#ifndef HAS_UNIFORM_u_${_e}
varying ${re} ${ae} ${_e};
#else
uniform ${re} ${ae} u_${_e};
#endif
`:`
#ifdef HAS_UNIFORM_u_${_e}
    ${re} ${ae} ${_e} = u_${_e};
#endif
`)),vertexSource:h=h.replace(x,(Y,J,re,ae,_e)=>{let Ce=ae==="float"?"vec2":"vec4",Ae=_e.match(/color/)?"color":Ce;return H[_e]?J==="define"?`
#ifndef HAS_UNIFORM_u_${_e}
uniform lowp float u_${_e}_t;
attribute ${re} ${Ce} a_${_e};
varying ${re} ${ae} ${_e};
#else
uniform ${re} ${ae} u_${_e};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${_e}
    ${_e} = a_${_e};
#else
    ${re} ${ae} ${_e} = u_${_e};
#endif
`:`
#ifndef HAS_UNIFORM_u_${_e}
    ${_e} = unpack_mix_${Ae}(a_${_e}, u_${_e}_t);
#else
    ${re} ${ae} ${_e} = u_${_e};
#endif
`:J==="define"?`
#ifndef HAS_UNIFORM_u_${_e}
uniform lowp float u_${_e}_t;
attribute ${re} ${Ce} a_${_e};
#else
uniform ${re} ${ae} u_${_e};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${_e}
    ${re} ${ae} ${_e} = a_${_e};
#else
    ${re} ${ae} ${_e} = u_${_e};
#endif
`:`
#ifndef HAS_UNIFORM_u_${_e}
    ${re} ${ae} ${_e} = unpack_mix_${Ae}(a_${_e}, u_${_e}_t);
#else
    ${re} ${ae} ${_e} = u_${_e};
#endif
`}),staticAttributes:S,staticUniforms:G}}class E0{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(h,x,S,I,D,G,H,Y,J){this.context=h;let re=this.boundPaintVertexBuffers.length!==I.length;for(let ae=0;!re&&ae<I.length;ae++)this.boundPaintVertexBuffers[ae]!==I[ae]&&(re=!0);!this.vao||this.boundProgram!==x||this.boundLayoutVertexBuffer!==S||re||this.boundIndexBuffer!==D||this.boundVertexOffset!==G||this.boundDynamicVertexBuffer!==H||this.boundDynamicVertexBuffer2!==Y||this.boundDynamicVertexBuffer3!==J?this.freshBind(x,S,I,D,G,H,Y,J):(h.bindVertexArray.set(this.vao),H&&H.bind(),D&&D.dynamicDraw&&D.bind(),Y&&Y.bind(),J&&J.bind())}freshBind(h,x,S,I,D,G,H,Y){let J=h.numAttributes,re=this.context,ae=re.gl;this.vao&&this.destroy(),this.vao=re.createVertexArray(),re.bindVertexArray.set(this.vao),this.boundProgram=h,this.boundLayoutVertexBuffer=x,this.boundPaintVertexBuffers=S,this.boundIndexBuffer=I,this.boundVertexOffset=D,this.boundDynamicVertexBuffer=G,this.boundDynamicVertexBuffer2=H,this.boundDynamicVertexBuffer3=Y,x.enableAttributes(ae,h);for(let _e of S)_e.enableAttributes(ae,h);G&&G.enableAttributes(ae,h),H&&H.enableAttributes(ae,h),Y&&Y.enableAttributes(ae,h),x.bind(),x.setVertexAttribPointers(ae,h,D);for(let _e of S)_e.bind(),_e.setVertexAttribPointers(ae,h,D);G&&(G.bind(),G.setVertexAttribPointers(ae,h,D)),I&&I.bind(),H&&(H.bind(),H.setVertexAttribPointers(ae,h,D)),Y&&(Y.bind(),Y.setVertexAttribPointers(ae,h,D)),re.currentNumAttributes=J}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function o1(P){let h=[];for(let x=0;x<P.length;x++){if(P[x]===null)continue;let S=P[x].split(" ");h.push(S.pop())}return h}class yc{constructor(h,x,S,I,D,G){let H=h.gl;this.program=H.createProgram();let Y=o1(x.staticAttributes),J=S?S.getBinderAttributes():[],re=Y.concat(J),ae=bh.prelude.staticUniforms?o1(bh.prelude.staticUniforms):[],_e=x.staticUniforms?o1(x.staticUniforms):[],Ce=S?S.getBinderUniforms():[],Ae=ae.concat(_e).concat(Ce),Re=[];for(let st of Ae)Re.indexOf(st)<0&&Re.push(st);let Te=S?S.defines():[];D&&Te.push("#define OVERDRAW_INSPECTOR;"),G&&Te.push("#define TERRAIN3D;");let Ve=Te.concat(bh.prelude.fragmentSource,x.fragmentSource).join(`
`),tt=Te.concat(bh.prelude.vertexSource,x.vertexSource).join(`
`),Ne=H.createShader(H.FRAGMENT_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);if(H.shaderSource(Ne,Ve),H.compileShader(Ne),!H.getShaderParameter(Ne,H.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${H.getShaderInfoLog(Ne)}`);H.attachShader(this.program,Ne);let Xe=H.createShader(H.VERTEX_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);if(H.shaderSource(Xe,tt),H.compileShader(Xe),!H.getShaderParameter(Xe,H.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${H.getShaderInfoLog(Xe)}`);H.attachShader(this.program,Xe),this.attributes={};let rt={};this.numAttributes=re.length;for(let st=0;st<this.numAttributes;st++)re[st]&&(H.bindAttribLocation(this.program,st,re[st]),this.attributes[re[st]]=st);if(H.linkProgram(this.program),!H.getProgramParameter(this.program,H.LINK_STATUS))throw new Error(`Program failed to link: ${H.getProgramInfoLog(this.program)}`);H.deleteShader(Xe),H.deleteShader(Ne);for(let st=0;st<Re.length;st++){let ft=Re[st];if(ft&&!rt[ft]){let Tt=H.getUniformLocation(this.program,ft);Tt&&(rt[ft]=Tt)}}this.fixedUniforms=I(h,rt),this.terrainUniforms=((st,ft)=>({u_depth:new n.Uniform1i(st,ft.u_depth),u_terrain:new n.Uniform1i(st,ft.u_terrain),u_terrain_dim:new n.Uniform1f(st,ft.u_terrain_dim),u_terrain_matrix:new n.UniformMatrix4f(st,ft.u_terrain_matrix),u_terrain_unpack:new n.Uniform4f(st,ft.u_terrain_unpack),u_terrain_exaggeration:new n.Uniform1f(st,ft.u_terrain_exaggeration)}))(h,rt),this.binderUniforms=S?S.getUniforms(h,rt):[]}draw(h,x,S,I,D,G,H,Y,J,re,ae,_e,Ce,Ae,Re,Te,Ve,tt){let Ne=h.gl;if(this.failedToCreate)return;if(h.program.set(this.program),h.setDepthMode(S),h.setStencilMode(I),h.setColorMode(D),h.setCullFace(G),Y){h.activeTexture.set(Ne.TEXTURE2),Ne.bindTexture(Ne.TEXTURE_2D,Y.depthTexture),h.activeTexture.set(Ne.TEXTURE3),Ne.bindTexture(Ne.TEXTURE_2D,Y.texture);for(let rt in this.terrainUniforms)this.terrainUniforms[rt].set(Y[rt])}for(let rt in this.fixedUniforms)this.fixedUniforms[rt].set(H[rt]);Re&&Re.setUniforms(h,this.binderUniforms,Ce,{zoom:Ae});let Xe=0;switch(x){case Ne.LINES:Xe=2;break;case Ne.TRIANGLES:Xe=3;break;case Ne.LINE_STRIP:Xe=1}for(let rt of _e.get()){let st=rt.vaos||(rt.vaos={});(st[J]||(st[J]=new E0)).bind(h,this,re,Re?Re.getPaintVertexBuffers():[],ae,rt.vertexOffset,Te,Ve,tt),Ne.drawElements(x,rt.primitiveLength*Xe,Ne.UNSIGNED_SHORT,rt.primitiveOffset*Xe*2)}}}function T0(P,h,x){let S=1/Ge(x,1,h.transform.tileZoom),I=Math.pow(2,x.tileID.overscaledZ),D=x.tileSize*Math.pow(2,h.transform.tileZoom)/I,G=D*(x.tileID.canonical.x+x.tileID.wrap*I),H=D*x.tileID.canonical.y;return{u_image:0,u_texsize:x.imageAtlasTexture.size,u_scale:[S,P.fromScale,P.toScale],u_fade:P.t,u_pixel_coord_upper:[G>>16,H>>16],u_pixel_coord_lower:[65535&G,65535&H]}}let wh=(P,h,x,S)=>{let I=h.style.light,D=I.properties.get("position"),G=[D.x,D.y,D.z],H=function(){var J=new n.ARRAY_TYPE(9);return n.ARRAY_TYPE!=Float32Array&&(J[1]=0,J[2]=0,J[3]=0,J[5]=0,J[6]=0,J[7]=0),J[0]=1,J[4]=1,J[8]=1,J}();I.properties.get("anchor")==="viewport"&&function(J,re){var ae=Math.sin(re),_e=Math.cos(re);J[0]=_e,J[1]=ae,J[2]=0,J[3]=-ae,J[4]=_e,J[5]=0,J[6]=0,J[7]=0,J[8]=1}(H,-h.transform.angle),function(J,re,ae){var _e=re[0],Ce=re[1],Ae=re[2];J[0]=_e*ae[0]+Ce*ae[3]+Ae*ae[6],J[1]=_e*ae[1]+Ce*ae[4]+Ae*ae[7],J[2]=_e*ae[2]+Ce*ae[5]+Ae*ae[8]}(G,G,H);let Y=I.properties.get("color");return{u_matrix:P,u_lightpos:G,u_lightintensity:I.properties.get("intensity"),u_lightcolor:[Y.r,Y.g,Y.b],u_vertical_gradient:+x,u_opacity:S}},Zx=(P,h,x,S,I,D,G)=>n.extend(wh(P,h,x,S),T0(D,h,G),{u_height_factor:-Math.pow(2,I.overscaledZ)/G.tileSize/8}),x7=P=>({u_matrix:P}),S0=(P,h,x,S)=>n.extend(x7(P),T0(x,h,S)),Qx=(P,h)=>({u_matrix:P,u_world:h}),v7=(P,h,x,S,I)=>n.extend(S0(P,h,x,S),{u_world:I}),Kx=(P,h,x,S)=>{let I=P.transform,D,G;if(S.paint.get("circle-pitch-alignment")==="map"){let H=Ge(x,1,I.zoom);D=!0,G=[H,H]}else D=!1,G=I.pixelsToGLUnits;return{u_camera_to_center_distance:I.cameraToCenterDistance,u_scale_with_map:+(S.paint.get("circle-pitch-scale")==="map"),u_matrix:P.translatePosMatrix(h.posMatrix,x,S.paint.get("circle-translate"),S.paint.get("circle-translate-anchor")),u_pitch_with_map:+D,u_device_pixel_ratio:P.pixelRatio,u_extrude_scale:G}},b7=(P,h,x)=>{let S=Ge(x,1,h.zoom),I=Math.pow(2,h.zoom-x.tileID.overscaledZ),D=x.tileID.overscaleFactor();return{u_matrix:P,u_camera_to_center_distance:h.cameraToCenterDistance,u_pixels_to_tile_units:S,u_extrude_scale:[h.pixelsToGLUnits[0]/(S*I),h.pixelsToGLUnits[1]/(S*I)],u_overscale_factor:D}},w7=(P,h,x=1)=>({u_matrix:P,u_color:h,u_overlay:0,u_overlay_scale:x}),A0=P=>({u_matrix:P}),E7=(P,h,x,S)=>({u_matrix:P,u_extrude_scale:Ge(h,1,x),u_intensity:S});function T7(P,h){let x=Math.pow(2,h.canonical.z),S=h.canonical.y;return[new n.MercatorCoordinate(0,S/x).toLngLat().lat,new n.MercatorCoordinate(0,(S+1)/x).toLngLat().lat]}let C0=(P,h,x,S)=>{let I=P.transform;return{u_matrix:Eh(P,h,x,S),u_ratio:1/Ge(h,1,I.zoom),u_device_pixel_ratio:P.pixelRatio,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]]}},S7=(P,h,x,S,I)=>n.extend(C0(P,h,x,I),{u_image:0,u_image_height:S}),tu=(P,h,x,S,I)=>{let D=P.transform,G=Eo(h,D);return{u_matrix:Eh(P,h,x,I),u_texsize:h.imageAtlasTexture.size,u_ratio:1/Ge(h,1,D.zoom),u_device_pixel_ratio:P.pixelRatio,u_image:0,u_scale:[G,S.fromScale,S.toScale],u_fade:S.t,u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]]}},I0=(P,h,x,S,I,D)=>{let G=P.lineAtlas,H=Eo(h,P.transform),Y=x.layout.get("line-cap")==="round",J=G.getDash(S.from,Y),re=G.getDash(S.to,Y),ae=J.width*I.fromScale,_e=re.width*I.toScale;return n.extend(C0(P,h,x,D),{u_patternscale_a:[H/ae,-J.height/2],u_patternscale_b:[H/_e,-re.height/2],u_sdfgamma:G.width/(256*Math.min(ae,_e)*P.pixelRatio)/2,u_image:0,u_tex_y_a:J.y,u_tex_y_b:re.y,u_mix:I.t})};function Eo(P,h){return 1/Ge(P,1,h.tileZoom)}function Eh(P,h,x,S){return P.translatePosMatrix(S?S.posMatrix:h.tileID.posMatrix,h,x.paint.get("line-translate"),x.paint.get("line-translate-anchor"))}let k0=(P,h,x,S,I)=>{return{u_matrix:P,u_tl_parent:h,u_scale_parent:x,u_buffer_scale:1,u_fade_t:S.mix,u_opacity:S.opacity*I.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:I.paint.get("raster-brightness-min"),u_brightness_high:I.paint.get("raster-brightness-max"),u_saturation_factor:(G=I.paint.get("raster-saturation"),G>0?1-1/(1.001-G):-G),u_contrast_factor:(D=I.paint.get("raster-contrast"),D>0?1/(1-D):1+D),u_spin_weights:Th(I.paint.get("raster-hue-rotate"))};var D,G};function Th(P){P*=Math.PI/180;let h=Math.sin(P),x=Math.cos(P);return[(2*x+1)/3,(-Math.sqrt(3)*h-x+1)/3,(Math.sqrt(3)*h-x+1)/3]}let Sh=(P,h,x,S,I,D,G,H,Y,J)=>{let re=I.transform;return{u_is_size_zoom_constant:+(P==="constant"||P==="source"),u_is_size_feature_constant:+(P==="constant"||P==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:re.cameraToCenterDistance,u_pitch:re.pitch/360*2*Math.PI,u_rotate_symbol:+x,u_aspect_ratio:re.width/re.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_matrix:D,u_label_plane_matrix:G,u_coord_matrix:H,u_is_text:+Y,u_pitch_with_map:+S,u_texsize:J,u_texture:0}},Ah=(P,h,x,S,I,D,G,H,Y,J,re)=>{let ae=I.transform;return n.extend(Sh(P,h,x,S,I,D,G,H,Y,J),{u_gamma_scale:S?Math.cos(ae._pitch)*ae.cameraToCenterDistance:1,u_device_pixel_ratio:I.pixelRatio,u_is_halo:+re})},Ch=(P,h,x,S,I,D,G,H,Y,J)=>n.extend(Ah(P,h,x,S,I,D,G,H,!0,Y,!0),{u_texsize_icon:J,u_texture_icon:1}),iu=(P,h,x)=>({u_matrix:P,u_opacity:h,u_color:x}),M0=(P,h,x,S,I,D)=>n.extend(function(G,H,Y,J){let re=Y.imageManager.getPattern(G.from.toString()),ae=Y.imageManager.getPattern(G.to.toString()),{width:_e,height:Ce}=Y.imageManager.getPixelSize(),Ae=Math.pow(2,J.tileID.overscaledZ),Re=J.tileSize*Math.pow(2,Y.transform.tileZoom)/Ae,Te=Re*(J.tileID.canonical.x+J.tileID.wrap*Ae),Ve=Re*J.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:re.tl,u_pattern_br_a:re.br,u_pattern_tl_b:ae.tl,u_pattern_br_b:ae.br,u_texsize:[_e,Ce],u_mix:H.t,u_pattern_size_a:re.displaySize,u_pattern_size_b:ae.displaySize,u_scale_a:H.fromScale,u_scale_b:H.toScale,u_tile_units_to_pixels:1/Ge(J,1,Y.transform.tileZoom),u_pixel_coord_upper:[Te>>16,Ve>>16],u_pixel_coord_lower:[65535&Te,65535&Ve]}}(S,D,x,I),{u_matrix:P,u_opacity:h}),To={fillExtrusion:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_lightpos:new n.Uniform3f(P,h.u_lightpos),u_lightintensity:new n.Uniform1f(P,h.u_lightintensity),u_lightcolor:new n.Uniform3f(P,h.u_lightcolor),u_vertical_gradient:new n.Uniform1f(P,h.u_vertical_gradient),u_opacity:new n.Uniform1f(P,h.u_opacity)}),fillExtrusionPattern:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_lightpos:new n.Uniform3f(P,h.u_lightpos),u_lightintensity:new n.Uniform1f(P,h.u_lightintensity),u_lightcolor:new n.Uniform3f(P,h.u_lightcolor),u_vertical_gradient:new n.Uniform1f(P,h.u_vertical_gradient),u_height_factor:new n.Uniform1f(P,h.u_height_factor),u_image:new n.Uniform1i(P,h.u_image),u_texsize:new n.Uniform2f(P,h.u_texsize),u_pixel_coord_upper:new n.Uniform2f(P,h.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(P,h.u_pixel_coord_lower),u_scale:new n.Uniform3f(P,h.u_scale),u_fade:new n.Uniform1f(P,h.u_fade),u_opacity:new n.Uniform1f(P,h.u_opacity)}),fill:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix)}),fillPattern:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_image:new n.Uniform1i(P,h.u_image),u_texsize:new n.Uniform2f(P,h.u_texsize),u_pixel_coord_upper:new n.Uniform2f(P,h.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(P,h.u_pixel_coord_lower),u_scale:new n.Uniform3f(P,h.u_scale),u_fade:new n.Uniform1f(P,h.u_fade)}),fillOutline:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_world:new n.Uniform2f(P,h.u_world)}),fillOutlinePattern:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_world:new n.Uniform2f(P,h.u_world),u_image:new n.Uniform1i(P,h.u_image),u_texsize:new n.Uniform2f(P,h.u_texsize),u_pixel_coord_upper:new n.Uniform2f(P,h.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(P,h.u_pixel_coord_lower),u_scale:new n.Uniform3f(P,h.u_scale),u_fade:new n.Uniform1f(P,h.u_fade)}),circle:(P,h)=>({u_camera_to_center_distance:new n.Uniform1f(P,h.u_camera_to_center_distance),u_scale_with_map:new n.Uniform1i(P,h.u_scale_with_map),u_pitch_with_map:new n.Uniform1i(P,h.u_pitch_with_map),u_extrude_scale:new n.Uniform2f(P,h.u_extrude_scale),u_device_pixel_ratio:new n.Uniform1f(P,h.u_device_pixel_ratio),u_matrix:new n.UniformMatrix4f(P,h.u_matrix)}),collisionBox:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_camera_to_center_distance:new n.Uniform1f(P,h.u_camera_to_center_distance),u_pixels_to_tile_units:new n.Uniform1f(P,h.u_pixels_to_tile_units),u_extrude_scale:new n.Uniform2f(P,h.u_extrude_scale),u_overscale_factor:new n.Uniform1f(P,h.u_overscale_factor)}),collisionCircle:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_inv_matrix:new n.UniformMatrix4f(P,h.u_inv_matrix),u_camera_to_center_distance:new n.Uniform1f(P,h.u_camera_to_center_distance),u_viewport_size:new n.Uniform2f(P,h.u_viewport_size)}),debug:(P,h)=>({u_color:new n.UniformColor(P,h.u_color),u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_overlay:new n.Uniform1i(P,h.u_overlay),u_overlay_scale:new n.Uniform1f(P,h.u_overlay_scale)}),clippingMask:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix)}),heatmap:(P,h)=>({u_extrude_scale:new n.Uniform1f(P,h.u_extrude_scale),u_intensity:new n.Uniform1f(P,h.u_intensity),u_matrix:new n.UniformMatrix4f(P,h.u_matrix)}),heatmapTexture:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_world:new n.Uniform2f(P,h.u_world),u_image:new n.Uniform1i(P,h.u_image),u_color_ramp:new n.Uniform1i(P,h.u_color_ramp),u_opacity:new n.Uniform1f(P,h.u_opacity)}),hillshade:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_image:new n.Uniform1i(P,h.u_image),u_latrange:new n.Uniform2f(P,h.u_latrange),u_light:new n.Uniform2f(P,h.u_light),u_shadow:new n.UniformColor(P,h.u_shadow),u_highlight:new n.UniformColor(P,h.u_highlight),u_accent:new n.UniformColor(P,h.u_accent)}),hillshadePrepare:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_image:new n.Uniform1i(P,h.u_image),u_dimension:new n.Uniform2f(P,h.u_dimension),u_zoom:new n.Uniform1f(P,h.u_zoom),u_unpack:new n.Uniform4f(P,h.u_unpack)}),line:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_ratio:new n.Uniform1f(P,h.u_ratio),u_device_pixel_ratio:new n.Uniform1f(P,h.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(P,h.u_units_to_pixels)}),lineGradient:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_ratio:new n.Uniform1f(P,h.u_ratio),u_device_pixel_ratio:new n.Uniform1f(P,h.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(P,h.u_units_to_pixels),u_image:new n.Uniform1i(P,h.u_image),u_image_height:new n.Uniform1f(P,h.u_image_height)}),linePattern:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_texsize:new n.Uniform2f(P,h.u_texsize),u_ratio:new n.Uniform1f(P,h.u_ratio),u_device_pixel_ratio:new n.Uniform1f(P,h.u_device_pixel_ratio),u_image:new n.Uniform1i(P,h.u_image),u_units_to_pixels:new n.Uniform2f(P,h.u_units_to_pixels),u_scale:new n.Uniform3f(P,h.u_scale),u_fade:new n.Uniform1f(P,h.u_fade)}),lineSDF:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_ratio:new n.Uniform1f(P,h.u_ratio),u_device_pixel_ratio:new n.Uniform1f(P,h.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(P,h.u_units_to_pixels),u_patternscale_a:new n.Uniform2f(P,h.u_patternscale_a),u_patternscale_b:new n.Uniform2f(P,h.u_patternscale_b),u_sdfgamma:new n.Uniform1f(P,h.u_sdfgamma),u_image:new n.Uniform1i(P,h.u_image),u_tex_y_a:new n.Uniform1f(P,h.u_tex_y_a),u_tex_y_b:new n.Uniform1f(P,h.u_tex_y_b),u_mix:new n.Uniform1f(P,h.u_mix)}),raster:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_tl_parent:new n.Uniform2f(P,h.u_tl_parent),u_scale_parent:new n.Uniform1f(P,h.u_scale_parent),u_buffer_scale:new n.Uniform1f(P,h.u_buffer_scale),u_fade_t:new n.Uniform1f(P,h.u_fade_t),u_opacity:new n.Uniform1f(P,h.u_opacity),u_image0:new n.Uniform1i(P,h.u_image0),u_image1:new n.Uniform1i(P,h.u_image1),u_brightness_low:new n.Uniform1f(P,h.u_brightness_low),u_brightness_high:new n.Uniform1f(P,h.u_brightness_high),u_saturation_factor:new n.Uniform1f(P,h.u_saturation_factor),u_contrast_factor:new n.Uniform1f(P,h.u_contrast_factor),u_spin_weights:new n.Uniform3f(P,h.u_spin_weights)}),symbolIcon:(P,h)=>({u_is_size_zoom_constant:new n.Uniform1i(P,h.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(P,h.u_is_size_feature_constant),u_size_t:new n.Uniform1f(P,h.u_size_t),u_size:new n.Uniform1f(P,h.u_size),u_camera_to_center_distance:new n.Uniform1f(P,h.u_camera_to_center_distance),u_pitch:new n.Uniform1f(P,h.u_pitch),u_rotate_symbol:new n.Uniform1i(P,h.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(P,h.u_aspect_ratio),u_fade_change:new n.Uniform1f(P,h.u_fade_change),u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(P,h.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(P,h.u_coord_matrix),u_is_text:new n.Uniform1i(P,h.u_is_text),u_pitch_with_map:new n.Uniform1i(P,h.u_pitch_with_map),u_texsize:new n.Uniform2f(P,h.u_texsize),u_texture:new n.Uniform1i(P,h.u_texture)}),symbolSDF:(P,h)=>({u_is_size_zoom_constant:new n.Uniform1i(P,h.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(P,h.u_is_size_feature_constant),u_size_t:new n.Uniform1f(P,h.u_size_t),u_size:new n.Uniform1f(P,h.u_size),u_camera_to_center_distance:new n.Uniform1f(P,h.u_camera_to_center_distance),u_pitch:new n.Uniform1f(P,h.u_pitch),u_rotate_symbol:new n.Uniform1i(P,h.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(P,h.u_aspect_ratio),u_fade_change:new n.Uniform1f(P,h.u_fade_change),u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(P,h.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(P,h.u_coord_matrix),u_is_text:new n.Uniform1i(P,h.u_is_text),u_pitch_with_map:new n.Uniform1i(P,h.u_pitch_with_map),u_texsize:new n.Uniform2f(P,h.u_texsize),u_texture:new n.Uniform1i(P,h.u_texture),u_gamma_scale:new n.Uniform1f(P,h.u_gamma_scale),u_device_pixel_ratio:new n.Uniform1f(P,h.u_device_pixel_ratio),u_is_halo:new n.Uniform1i(P,h.u_is_halo)}),symbolTextAndIcon:(P,h)=>({u_is_size_zoom_constant:new n.Uniform1i(P,h.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(P,h.u_is_size_feature_constant),u_size_t:new n.Uniform1f(P,h.u_size_t),u_size:new n.Uniform1f(P,h.u_size),u_camera_to_center_distance:new n.Uniform1f(P,h.u_camera_to_center_distance),u_pitch:new n.Uniform1f(P,h.u_pitch),u_rotate_symbol:new n.Uniform1i(P,h.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(P,h.u_aspect_ratio),u_fade_change:new n.Uniform1f(P,h.u_fade_change),u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(P,h.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(P,h.u_coord_matrix),u_is_text:new n.Uniform1i(P,h.u_is_text),u_pitch_with_map:new n.Uniform1i(P,h.u_pitch_with_map),u_texsize:new n.Uniform2f(P,h.u_texsize),u_texsize_icon:new n.Uniform2f(P,h.u_texsize_icon),u_texture:new n.Uniform1i(P,h.u_texture),u_texture_icon:new n.Uniform1i(P,h.u_texture_icon),u_gamma_scale:new n.Uniform1f(P,h.u_gamma_scale),u_device_pixel_ratio:new n.Uniform1f(P,h.u_device_pixel_ratio),u_is_halo:new n.Uniform1i(P,h.u_is_halo)}),background:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_opacity:new n.Uniform1f(P,h.u_opacity),u_color:new n.UniformColor(P,h.u_color)}),backgroundPattern:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_opacity:new n.Uniform1f(P,h.u_opacity),u_image:new n.Uniform1i(P,h.u_image),u_pattern_tl_a:new n.Uniform2f(P,h.u_pattern_tl_a),u_pattern_br_a:new n.Uniform2f(P,h.u_pattern_br_a),u_pattern_tl_b:new n.Uniform2f(P,h.u_pattern_tl_b),u_pattern_br_b:new n.Uniform2f(P,h.u_pattern_br_b),u_texsize:new n.Uniform2f(P,h.u_texsize),u_mix:new n.Uniform1f(P,h.u_mix),u_pattern_size_a:new n.Uniform2f(P,h.u_pattern_size_a),u_pattern_size_b:new n.Uniform2f(P,h.u_pattern_size_b),u_scale_a:new n.Uniform1f(P,h.u_scale_a),u_scale_b:new n.Uniform1f(P,h.u_scale_b),u_pixel_coord_upper:new n.Uniform2f(P,h.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(P,h.u_pixel_coord_lower),u_tile_units_to_pixels:new n.Uniform1f(P,h.u_tile_units_to_pixels)}),terrain:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_texture:new n.Uniform1i(P,h.u_texture),u_ele_delta:new n.Uniform1f(P,h.u_ele_delta)}),terrainDepth:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_ele_delta:new n.Uniform1f(P,h.u_ele_delta)}),terrainCoords:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_texture:new n.Uniform1i(P,h.u_texture),u_terrain_coords_id:new n.Uniform1f(P,h.u_terrain_coords_id),u_ele_delta:new n.Uniform1f(P,h.u_ele_delta)})};class So{constructor(h,x,S){this.context=h;let I=h.gl;this.buffer=I.createBuffer(),this.dynamicDraw=!!S,this.context.unbindVAO(),h.bindElementBuffer.set(this.buffer),I.bufferData(I.ELEMENT_ARRAY_BUFFER,x.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||delete x.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(h){let x=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),x.bufferSubData(x.ELEMENT_ARRAY_BUFFER,0,h.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let gp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class P0{constructor(h,x,S,I){this.length=x.length,this.attributes=S,this.itemSize=x.bytesPerElement,this.dynamicDraw=I,this.context=h;let D=h.gl;this.buffer=D.createBuffer(),h.bindVertexBuffer.set(this.buffer),D.bufferData(D.ARRAY_BUFFER,x.arrayBuffer,this.dynamicDraw?D.DYNAMIC_DRAW:D.STATIC_DRAW),this.dynamicDraw||delete x.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(h){if(h.length!==this.length)throw new Error(`Length of new data is ${h.length}, which doesn't match current length of ${this.length}`);let x=this.context.gl;this.bind(),x.bufferSubData(x.ARRAY_BUFFER,0,h.arrayBuffer)}enableAttributes(h,x){for(let S=0;S<this.attributes.length;S++){let I=x.attributes[this.attributes[S].name];I!==void 0&&h.enableVertexAttribArray(I)}}setVertexAttribPointers(h,x,S){for(let I=0;I<this.attributes.length;I++){let D=this.attributes[I],G=x.attributes[D.name];G!==void 0&&h.vertexAttribPointer(G,D.components,h[gp[D.type]],!1,this.itemSize,D.offset+this.itemSize*(S||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let a1=new WeakMap;function l1(P){if(a1.has(P))return a1.get(P);{let h=P.getParameter(P.VERSION).startsWith("WebGL 2.0");return a1.set(P,h),h}}class wr{constructor(h){this.gl=h.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(h){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class R0 extends wr{getDefault(){return n.Color.transparent}set(h){let x=this.current;(h.r!==x.r||h.g!==x.g||h.b!==x.b||h.a!==x.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)}}class yp extends wr{getDefault(){return 1}set(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)}}class _p extends wr{getDefault(){return 0}set(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)}}class D0 extends wr{getDefault(){return[!0,!0,!0,!0]}set(h){let x=this.current;(h[0]!==x[0]||h[1]!==x[1]||h[2]!==x[2]||h[3]!==x[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)}}class A7 extends wr{getDefault(){return!0}set(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)}}class C7 extends wr{getDefault(){return 255}set(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)}}class c1 extends wr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(h){let x=this.current;(h.func!==x.func||h.ref!==x.ref||h.mask!==x.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)}}class Jx extends wr{getDefault(){let h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]}set(h){let x=this.current;(h[0]!==x[0]||h[1]!==x[1]||h[2]!==x[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)}}class ev extends wr{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;h?x.enable(x.STENCIL_TEST):x.disable(x.STENCIL_TEST),this.current=h,this.dirty=!1}}class tv extends wr{getDefault(){return[0,1]}set(h){let x=this.current;(h[0]!==x[0]||h[1]!==x[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)}}class iv extends wr{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;h?x.enable(x.DEPTH_TEST):x.disable(x.DEPTH_TEST),this.current=h,this.dirty=!1}}class rv extends wr{getDefault(){return this.gl.LESS}set(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)}}class sv extends wr{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;h?x.enable(x.BLEND):x.disable(x.BLEND),this.current=h,this.dirty=!1}}class xp extends wr{getDefault(){let h=this.gl;return[h.ONE,h.ZERO]}set(h){let x=this.current;(h[0]!==x[0]||h[1]!==x[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)}}class F0 extends wr{getDefault(){return n.Color.transparent}set(h){let x=this.current;(h.r!==x.r||h.g!==x.g||h.b!==x.b||h.a!==x.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)}}class vp extends wr{getDefault(){return this.gl.FUNC_ADD}set(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)}}class bp extends wr{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;h?x.enable(x.CULL_FACE):x.disable(x.CULL_FACE),this.current=h,this.dirty=!1}}class u1 extends wr{getDefault(){return this.gl.BACK}set(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)}}class I7 extends wr{getDefault(){return this.gl.CCW}set(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)}}class k7 extends wr{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}}class wp extends wr{getDefault(){return this.gl.TEXTURE0}set(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)}}class ru extends wr{getDefault(){let h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]}set(h){let x=this.current;(h[0]!==x[0]||h[1]!==x[1]||h[2]!==x[2]||h[3]!==x[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)}}class M7 extends wr{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;x.bindFramebuffer(x.FRAMEBUFFER,h),this.current=h,this.dirty=!1}}class h1 extends wr{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;x.bindRenderbuffer(x.RENDERBUFFER,h),this.current=h,this.dirty=!1}}class d1 extends wr{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;x.bindTexture(x.TEXTURE_2D,h),this.current=h,this.dirty=!1}}class P7 extends wr{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;x.bindBuffer(x.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}}class Ep extends wr{getDefault(){return null}set(h){let x=this.gl;x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1}}class kr extends wr{getDefault(){return null}set(h){var x;if(h===this.current&&!this.dirty)return;let S=this.gl;l1(S)?S.bindVertexArray(h):(x=S.getExtension("OES_vertex_array_object"))===null||x===void 0||x.bindVertexArrayOES(h),this.current=h,this.dirty=!1}}class L0 extends wr{getDefault(){return 4}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;x.pixelStorei(x.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}}class nv extends wr{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}}class R7 extends wr{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}}class su extends wr{constructor(h,x){super(h),this.context=h,this.parent=x}getDefault(){return null}}class ov extends su{setDirty(){this.dirty=!0}set(h){if(h===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let x=this.gl;x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}}class av extends su{set(h){if(h===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let x=this.gl;x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_ATTACHMENT,x.RENDERBUFFER,h),this.current=h,this.dirty=!1}}class D7 extends su{set(h){if(h===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let x=this.gl;x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_STENCIL_ATTACHMENT,x.RENDERBUFFER,h),this.current=h,this.dirty=!1}}class lv{constructor(h,x,S,I,D){this.context=h,this.width=x,this.height=S;let G=h.gl,H=this.framebuffer=G.createFramebuffer();if(this.colorAttachment=new ov(h,H),I)this.depthAttachment=D?new D7(h,H):new av(h,H);else if(D)throw new Error("Stencil cannot be setted without depth");if(G.checkFramebufferStatus(G.FRAMEBUFFER)!==G.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){let h=this.context.gl,x=this.colorAttachment.get();if(x&&h.deleteTexture(x),this.depthAttachment){let S=this.depthAttachment.get();S&&h.deleteRenderbuffer(S)}h.deleteFramebuffer(this.framebuffer)}}class _s{constructor(h,x,S){this.blendFunction=h,this.blendColor=x,this.mask=S}}_s.Replace=[1,0],_s.disabled=new _s(_s.Replace,n.Color.transparent,[!1,!1,!1,!1]),_s.unblended=new _s(_s.Replace,n.Color.transparent,[!0,!0,!0,!0]),_s.alphaBlended=new _s([1,771],n.Color.transparent,[!0,!0,!0,!0]);class N0{constructor(h){var x,S;if(this.gl=h,this.clearColor=new R0(this),this.clearDepth=new yp(this),this.clearStencil=new _p(this),this.colorMask=new D0(this),this.depthMask=new A7(this),this.stencilMask=new C7(this),this.stencilFunc=new c1(this),this.stencilOp=new Jx(this),this.stencilTest=new ev(this),this.depthRange=new tv(this),this.depthTest=new iv(this),this.depthFunc=new rv(this),this.blend=new sv(this),this.blendFunc=new xp(this),this.blendColor=new F0(this),this.blendEquation=new vp(this),this.cullFace=new bp(this),this.cullFaceSide=new u1(this),this.frontFace=new I7(this),this.program=new k7(this),this.activeTexture=new wp(this),this.viewport=new ru(this),this.bindFramebuffer=new M7(this),this.bindRenderbuffer=new h1(this),this.bindTexture=new d1(this),this.bindVertexBuffer=new P7(this),this.bindElementBuffer=new Ep(this),this.bindVertexArray=new kr(this),this.pixelStoreUnpack=new L0(this),this.pixelStoreUnpackPremultiplyAlpha=new nv(this),this.pixelStoreUnpackFlipY=new R7(this),this.extTextureFilterAnisotropic=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=h.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE),l1(h)){this.HALF_FLOAT=h.HALF_FLOAT;let I=h.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(x=h.RGBA16F)!==null&&x!==void 0?x:I?.RGBA16F_EXT,this.RGB16F=(S=h.RGB16F)!==null&&S!==void 0?S:I?.RGB16F_EXT,h.getExtension("EXT_color_buffer_float")}else{h.getExtension("EXT_color_buffer_half_float"),h.getExtension("OES_texture_half_float_linear");let I=h.getExtension("OES_texture_half_float");this.HALF_FLOAT=I?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(h,x){return new So(this,h,x)}createVertexBuffer(h,x,S){return new P0(this,h,x,S)}createRenderbuffer(h,x,S){let I=this.gl,D=I.createRenderbuffer();return this.bindRenderbuffer.set(D),I.renderbufferStorage(I.RENDERBUFFER,h,x,S),this.bindRenderbuffer.set(null),D}createFramebuffer(h,x,S,I){return new lv(this,h,x,S,I)}clear({color:h,depth:x,stencil:S}){let I=this.gl,D=0;h&&(D|=I.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),x!==void 0&&(D|=I.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(x),this.depthMask.set(!0)),S!==void 0&&(D|=I.STENCIL_BUFFER_BIT,this.clearStencil.set(S),this.stencilMask.set(255)),I.clear(D)}setCullFace(h){h.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(h.mode),this.frontFace.set(h.frontFace))}setDepthMode(h){h.func!==this.gl.ALWAYS||h.mask?(this.depthTest.set(!0),this.depthFunc.set(h.func),this.depthMask.set(h.mask),this.depthRange.set(h.range)):this.depthTest.set(!1)}setStencilMode(h){h.test.func!==this.gl.ALWAYS||h.mask?(this.stencilTest.set(!0),this.stencilMask.set(h.mask),this.stencilOp.set([h.fail,h.depthFail,h.pass]),this.stencilFunc.set({func:h.test.func,ref:h.ref,mask:h.test.mask})):this.stencilTest.set(!1)}setColorMode(h){n.deepEqual(h.blendFunction,_s.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(h.blendFunction),this.blendColor.set(h.blendColor)),this.colorMask.set(h.mask)}createVertexArray(){var h;return l1(this.gl)?this.gl.createVertexArray():(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.createVertexArrayOES()}deleteVertexArray(h){var x;return l1(this.gl)?this.gl.deleteVertexArray(h):(x=this.gl.getExtension("OES_vertex_array_object"))===null||x===void 0?void 0:x.deleteVertexArrayOES(h)}unbindVAO(){this.bindVertexArray.set(null)}}class ur{constructor(h,x,S){this.func=h,this.mask=x,this.range=S}}ur.ReadOnly=!1,ur.ReadWrite=!0,ur.disabled=new ur(519,ur.ReadOnly,[0,1]);let Ih=7680;class Yr{constructor(h,x,S,I,D,G){this.test=h,this.ref=x,this.mask=S,this.fail=I,this.depthFail=D,this.pass=G}}Yr.disabled=new Yr({func:519,mask:0},0,0,Ih,Ih,Ih);class Zr{constructor(h,x,S){this.enable=h,this.mode=x,this.frontFace=S}}let nu;function kh(P,h,x,S,I,D,G){let H=P.context,Y=H.gl,J=P.useProgram("collisionBox"),re=[],ae=0,_e=0;for(let Ne=0;Ne<S.length;Ne++){let Xe=S[Ne],rt=h.getTile(Xe),st=rt.getBucket(x);if(!st)continue;let ft=Xe.posMatrix;I[0]===0&&I[1]===0||(ft=P.translatePosMatrix(Xe.posMatrix,rt,I,D));let Tt=G?st.textCollisionBox:st.iconCollisionBox,Et=st.collisionCircleArray;if(Et.length>0){let kt=n.create(),oi=ft;n.mul(kt,st.placementInvProjMatrix,P.transform.glCoordMatrix),n.mul(kt,kt,st.placementViewportMatrix),re.push({circleArray:Et,circleOffset:_e,transform:oi,invTransform:kt,coord:Xe}),ae+=Et.length/4,_e=ae}Tt&&J.draw(H,Y.LINES,ur.disabled,Yr.disabled,P.colorModeForRenderPass(),Zr.disabled,b7(ft,P.transform,rt),P.style.map.terrain&&P.style.map.terrain.getTerrainData(Xe),x.id,Tt.layoutVertexBuffer,Tt.indexBuffer,Tt.segments,null,P.transform.zoom,null,null,Tt.collisionVertexBuffer)}if(!G||!re.length)return;let Ce=P.useProgram("collisionCircle"),Ae=new n.CollisionCircleLayoutArray;Ae.resize(4*ae),Ae._trim();let Re=0;for(let Ne of re)for(let Xe=0;Xe<Ne.circleArray.length/4;Xe++){let rt=4*Xe,st=Ne.circleArray[rt+0],ft=Ne.circleArray[rt+1],Tt=Ne.circleArray[rt+2],Et=Ne.circleArray[rt+3];Ae.emplace(Re++,st,ft,Tt,Et,0),Ae.emplace(Re++,st,ft,Tt,Et,1),Ae.emplace(Re++,st,ft,Tt,Et,2),Ae.emplace(Re++,st,ft,Tt,Et,3)}(!nu||nu.length<2*ae)&&(nu=function(Ne){let Xe=2*Ne,rt=new n.QuadTriangleArray;rt.resize(Xe),rt._trim();for(let st=0;st<Xe;st++){let ft=6*st;rt.uint16[ft+0]=4*st+0,rt.uint16[ft+1]=4*st+1,rt.uint16[ft+2]=4*st+2,rt.uint16[ft+3]=4*st+2,rt.uint16[ft+4]=4*st+3,rt.uint16[ft+5]=4*st+0}return rt}(ae));let Te=H.createIndexBuffer(nu,!0),Ve=H.createVertexBuffer(Ae,n.collisionCircleLayout.members,!0);for(let Ne of re){let Xe={u_matrix:Ne.transform,u_inv_matrix:Ne.invTransform,u_camera_to_center_distance:(tt=P.transform).cameraToCenterDistance,u_viewport_size:[tt.width,tt.height]};Ce.draw(H,Y.TRIANGLES,ur.disabled,Yr.disabled,P.colorModeForRenderPass(),Zr.disabled,Xe,P.style.map.terrain&&P.style.map.terrain.getTerrainData(Ne.coord),x.id,Ve,Te,n.SegmentVector.simpleSegment(0,2*Ne.circleOffset,Ne.circleArray.length,Ne.circleArray.length/2),null,P.transform.zoom,null,null,null)}var tt;Ve.destroy(),Te.destroy()}Zr.disabled=new Zr(!1,1029,2305),Zr.backCCW=new Zr(!0,1029,2305);let Tp=n.identity(new Float32Array(16));function cv(P,h,x,S,I,D){let{horizontalAlign:G,verticalAlign:H}=n.getAnchorAlignment(P);return new n.Point((-(G-.5)*h/I+S[0])*D,(-(H-.5)*x/I+S[1])*D)}function Sp(P,h,x,S,I,D,G,H,Y,J,re){let ae=P.text.placedSymbolArray,_e=P.text.dynamicLayoutVertexArray,Ce=P.icon.dynamicLayoutVertexArray,Ae={};_e.clear();for(let Re=0;Re<ae.length;Re++){let Te=ae.get(Re),Ve=Te.hidden||!Te.crossTileID||P.allowVerticalPlacement&&!Te.placedOrientation?null:S[Te.crossTileID];if(Ve){let tt=new n.Point(Te.anchorX,Te.anchorY),Ne=Ke(tt,x?G:D,re),Xe=dt(I.cameraToCenterDistance,Ne.signedDistanceFromCamera),rt=n.evaluateSizeForFeature(P.textSizeData,Y,Te)*Xe/n.ONE_EM;x&&(rt*=P.tilePixelRatio/H);let{width:st,height:ft,anchor:Tt,textOffset:Et,textBoxScale:kt}=Ve,oi=cv(Tt,st,ft,Et,kt,rt),or=x?Ke(tt.add(oi),D,re).point:Ne.point.add(h?oi.rotate(-I.angle):oi),Ut=P.allowVerticalPlacement&&Te.placedOrientation===n.WritingMode.vertical?Math.PI/2:0;for(let yi=0;yi<Te.numGlyphs;yi++)n.addDynamicAttributes(_e,or,Ut);J&&Te.associatedIconIndex>=0&&(Ae[Te.associatedIconIndex]={shiftedAnchor:or,angle:Ut})}else Ee(Te.numGlyphs,_e)}if(J){Ce.clear();let Re=P.icon.placedSymbolArray;for(let Te=0;Te<Re.length;Te++){let Ve=Re.get(Te);if(Ve.hidden)Ee(Ve.numGlyphs,Ce);else{let tt=Ae[Te];if(tt)for(let Ne=0;Ne<Ve.numGlyphs;Ne++)n.addDynamicAttributes(Ce,tt.shiftedAnchor,tt.angle);else Ee(Ve.numGlyphs,Ce)}}P.icon.dynamicLayoutVertexBuffer.updateData(Ce)}P.text.dynamicLayoutVertexBuffer.updateData(_e)}function uv(P,h,x){return x.iconsInText&&h?"symbolTextAndIcon":P?"symbolSDF":"symbolIcon"}function Ap(P,h,x,S,I,D,G,H,Y,J,re,ae){let _e=P.context,Ce=_e.gl,Ae=P.transform,Re=H==="map",Te=Y==="map",Ve=H!=="viewport"&&x.layout.get("symbol-placement")!=="point",tt=Re&&!Te&&!Ve,Ne=!x.layout.get("symbol-sort-key").isConstant(),Xe=!1,rt=P.depthModeForSublayer(0,ur.ReadOnly),st=x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ft=[];for(let Tt of S){let Et=h.getTile(Tt),kt=Et.getBucket(x);if(!kt)continue;let oi=I?kt.text:kt.icon;if(!oi||!oi.segments.get().length||!oi.hasVisibleVertices)continue;let or=oi.programConfigurations.get(x.id),Ut=I||kt.sdfIcons,yi=I?kt.textSizeData:kt.iconSizeData,ii=Te||Ae.pitch!==0,is=P.useProgram(uv(Ut,I,kt),or),ar=n.evaluateSizeForZoom(yi,Ae.zoom),_i=P.style.map.terrain&&P.style.map.terrain.getTerrainData(Tt),lr,us,Dr,Co,Sn=[0,0],Ts=null;if(I)us=Et.glyphAtlasTexture,Dr=Ce.LINEAR,lr=Et.glyphAtlasTexture.size,kt.iconsInText&&(Sn=Et.imageAtlasTexture.size,Ts=Et.imageAtlasTexture,Co=ii||P.options.rotating||P.options.zooming||yi.kind==="composite"||yi.kind==="camera"?Ce.LINEAR:Ce.NEAREST);else{let on=x.layout.get("icon-size").constantOr(0)!==1||kt.iconsNeedLinear;us=Et.imageAtlasTexture,Dr=Ut||P.options.rotating||P.options.zooming||on||ii?Ce.LINEAR:Ce.NEAREST,lr=Et.imageAtlasTexture.size}let ao=Ge(Et,1,P.transform.zoom),cl=Zi(Tt.posMatrix,Te,Re,P.transform,ao),Ma=ji(Tt.posMatrix,Te,Re,P.transform,ao),ul=st&&kt.hasTextData(),g1=x.layout.get("icon-text-fit")!=="none"&&ul&&kt.hasIconData();if(Ve){let on=P.style.map.terrain?(Nn,hs)=>P.style.map.terrain.getElevation(Tt,Nn,hs):null,js=x.layout.get("text-rotation-alignment")==="map";Yt(kt,Tt.posMatrix,P,I,cl,Ma,Te,J,js,on)}let vc=P.translatePosMatrix(Tt.posMatrix,Et,D,G),Bl=Ve||I&&st||g1?Tp:cl,Ds=P.translatePosMatrix(Ma,Et,D,G,!0),nn=Ut&&x.paint.get(I?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Ln;Ln=Ut?kt.iconsInText?Ch(yi.kind,ar,tt,Te,P,vc,Bl,Ds,lr,Sn):Ah(yi.kind,ar,tt,Te,P,vc,Bl,Ds,I,lr,!0):Sh(yi.kind,ar,tt,Te,P,vc,Bl,Ds,I,lr);let y1={program:is,buffers:oi,uniformValues:Ln,atlasTexture:us,atlasTextureIcon:Ts,atlasInterpolation:Dr,atlasInterpolationIcon:Co,isSDF:Ut,hasHalo:nn};if(Ne&&kt.canOverlap){Xe=!0;let on=oi.segments.get();for(let js of on)ft.push({segments:new n.SegmentVector([js]),sortKey:js.sortKey,state:y1,terrainData:_i})}else ft.push({segments:oi.segments,sortKey:0,state:y1,terrainData:_i})}Xe&&ft.sort((Tt,Et)=>Tt.sortKey-Et.sortKey);for(let Tt of ft){let Et=Tt.state;if(_e.activeTexture.set(Ce.TEXTURE0),Et.atlasTexture.bind(Et.atlasInterpolation,Ce.CLAMP_TO_EDGE),Et.atlasTextureIcon&&(_e.activeTexture.set(Ce.TEXTURE1),Et.atlasTextureIcon&&Et.atlasTextureIcon.bind(Et.atlasInterpolationIcon,Ce.CLAMP_TO_EDGE)),Et.isSDF){let kt=Et.uniformValues;Et.hasHalo&&(kt.u_is_halo=1,Mh(Et.buffers,Tt.segments,x,P,Et.program,rt,re,ae,kt,Tt.terrainData)),kt.u_is_halo=0}Mh(Et.buffers,Tt.segments,x,P,Et.program,rt,re,ae,Et.uniformValues,Tt.terrainData)}}function Mh(P,h,x,S,I,D,G,H,Y,J){let re=S.context;I.draw(re,re.gl.TRIANGLES,D,G,H,Zr.disabled,Y,J,x.id,P.layoutVertexBuffer,P.indexBuffer,h,x.paint,S.transform.zoom,P.programConfigurations.get(x.id),P.dynamicLayoutVertexBuffer,P.opacityVertexBuffer)}function O0(P,h,x,S,I){if(!x||!S||!S.imageAtlas)return;let D=S.imageAtlas.patternPositions,G=D[x.to.toString()],H=D[x.from.toString()];if(!G||!H){let Y=I.getPaintProperty(h);G=D[Y],H=D[Y]}G&&H&&P.setConstantPatternPositions(G,H)}function Cp(P,h,x,S,I,D,G){let H=P.context.gl,Y="fill-pattern",J=x.paint.get(Y),re=J&&J.constantOr(1),ae=x.getCrossfadeParameters(),_e,Ce,Ae,Re,Te;G?(Ce=re&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",_e=H.LINES):(Ce=re?"fillPattern":"fill",_e=H.TRIANGLES);let Ve=J.constantOr(null);for(let tt of S){let Ne=h.getTile(tt);if(re&&!Ne.patternsLoaded())continue;let Xe=Ne.getBucket(x);if(!Xe)continue;let rt=Xe.programConfigurations.get(x.id),st=P.useProgram(Ce,rt),ft=P.style.map.terrain&&P.style.map.terrain.getTerrainData(tt);re&&(P.context.activeTexture.set(H.TEXTURE0),Ne.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),rt.updatePaintBuffers(ae)),O0(rt,Y,Ve,Ne,x);let Tt=ft?tt:null,Et=P.translatePosMatrix(Tt?Tt.posMatrix:tt.posMatrix,Ne,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));if(G){Re=Xe.indexBuffer2,Te=Xe.segments2;let kt=[H.drawingBufferWidth,H.drawingBufferHeight];Ae=Ce==="fillOutlinePattern"&&re?v7(Et,P,ae,Ne,kt):Qx(Et,kt)}else Re=Xe.indexBuffer,Te=Xe.segments,Ae=re?S0(Et,P,ae,Ne):x7(Et);st.draw(P.context,_e,I,P.stencilModeForClipping(tt),D,Zr.disabled,Ae,ft,x.id,Xe.layoutVertexBuffer,Re,Te,x.paint,P.transform.zoom,rt)}}function B0(P,h,x,S,I,D,G){let H=P.context,Y=H.gl,J="fill-extrusion-pattern",re=x.paint.get(J),ae=re.constantOr(1),_e=x.getCrossfadeParameters(),Ce=x.paint.get("fill-extrusion-opacity"),Ae=re.constantOr(null);for(let Re of S){let Te=h.getTile(Re),Ve=Te.getBucket(x);if(!Ve)continue;let tt=P.style.map.terrain&&P.style.map.terrain.getTerrainData(Re),Ne=Ve.programConfigurations.get(x.id),Xe=P.useProgram(ae?"fillExtrusionPattern":"fillExtrusion",Ne);ae&&(P.context.activeTexture.set(Y.TEXTURE0),Te.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),Ne.updatePaintBuffers(_e)),O0(Ne,J,Ae,Te,x);let rt=P.translatePosMatrix(Re.posMatrix,Te,x.paint.get("fill-extrusion-translate"),x.paint.get("fill-extrusion-translate-anchor")),st=x.paint.get("fill-extrusion-vertical-gradient"),ft=ae?Zx(rt,P,st,Ce,Re,_e,Te):wh(rt,P,st,Ce);Xe.draw(H,H.gl.TRIANGLES,I,D,G,Zr.backCCW,ft,tt,x.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,x.paint,P.transform.zoom,Ne,P.style.map.terrain&&Ve.centroidVertexBuffer)}}function U0(P,h,x,S,I,D,G){let H=P.context,Y=H.gl,J=x.fbo;if(!J)return;let re=P.useProgram("hillshade"),ae=P.style.map.terrain&&P.style.map.terrain.getTerrainData(h);H.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,J.colorAttachment.get()),re.draw(H,Y.TRIANGLES,I,D,G,Zr.disabled,((_e,Ce,Ae,Re)=>{let Te=Ae.paint.get("hillshade-shadow-color"),Ve=Ae.paint.get("hillshade-highlight-color"),tt=Ae.paint.get("hillshade-accent-color"),Ne=Ae.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ae.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ne-=_e.transform.angle);let Xe=!_e.options.moving;return{u_matrix:Re?Re.posMatrix:_e.transform.calculatePosMatrix(Ce.tileID.toUnwrapped(),Xe),u_image:0,u_latrange:T7(0,Ce.tileID),u_light:[Ae.paint.get("hillshade-exaggeration"),Ne],u_shadow:Te,u_highlight:Ve,u_accent:tt}})(P,x,S,ae?h:null),ae,S.id,P.rasterBoundsBuffer,P.quadTriangleIndexBuffer,P.rasterBoundsSegments)}function Ip(P,h,x,S,I,D){let G=P.context,H=G.gl,Y=h.dem;if(Y&&Y.data){let J=Y.dim,re=Y.stride,ae=Y.getPixels();if(G.activeTexture.set(H.TEXTURE1),G.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||P.getTileTexture(re),h.demTexture){let Ce=h.demTexture;Ce.update(ae,{premultiply:!1}),Ce.bind(H.NEAREST,H.CLAMP_TO_EDGE)}else h.demTexture=new U(G,ae,H.RGBA,{premultiply:!1}),h.demTexture.bind(H.NEAREST,H.CLAMP_TO_EDGE);G.activeTexture.set(H.TEXTURE0);let _e=h.fbo;if(!_e){let Ce=new U(G,{width:J,height:J,data:null},H.RGBA);Ce.bind(H.LINEAR,H.CLAMP_TO_EDGE),_e=h.fbo=G.createFramebuffer(J,J,!0,!1),_e.colorAttachment.set(Ce.texture)}G.bindFramebuffer.set(_e.framebuffer),G.viewport.set([0,0,J,J]),P.useProgram("hillshadePrepare").draw(G,H.TRIANGLES,S,I,D,Zr.disabled,((Ce,Ae)=>{let Re=Ae.stride,Te=n.create();return n.ortho(Te,0,n.EXTENT,-n.EXTENT,0,0,1),n.translate(Te,Te,[0,-n.EXTENT,0]),{u_matrix:Te,u_image:1,u_dimension:[Re,Re],u_zoom:Ce.overscaledZ,u_unpack:Ae.getUnpackVector()}})(h.tileID,Y),null,x.id,P.rasterBoundsBuffer,P.quadTriangleIndexBuffer,P.rasterBoundsSegments),h.needsHillshadePrepare=!1}}function hv(P,h,x,S,I,D){let G=S.paint.get("raster-fade-duration");if(!D&&G>0){let H=n.browser.now(),Y=(H-P.timeAdded)/G,J=h?(H-h.timeAdded)/G:-1,re=x.getSource(),ae=I.coveringZoomLevel({tileSize:re.tileSize,roundZoom:re.roundZoom}),_e=!h||Math.abs(h.tileID.overscaledZ-ae)>Math.abs(P.tileID.overscaledZ-ae),Ce=_e&&P.refreshedUponExpiration?1:n.clamp(_e?Y:1-J,0,1);return P.refreshedUponExpiration&&Y>=1&&(P.refreshedUponExpiration=!1),h?{opacity:1,mix:1-Ce}:{opacity:Ce,mix:0}}return{opacity:1,mix:0}}let F7=new n.Color(1,0,0,1),Ps=new n.Color(0,1,0,1),ou=new n.Color(0,0,1,1),oa=new n.Color(1,0,1,1),kp=new n.Color(0,1,1,1);function z0(P,h,x,S){Nl(P,0,h+x/2,P.transform.width,x,S)}function Mp(P,h,x,S){Nl(P,h-x/2,0,x,P.transform.height,S)}function Nl(P,h,x,S,I,D){let G=P.context,H=G.gl;H.enable(H.SCISSOR_TEST),H.scissor(h*P.pixelRatio,x*P.pixelRatio,S*P.pixelRatio,I*P.pixelRatio),G.clear({color:D}),H.disable(H.SCISSOR_TEST)}function Ph(P,h,x){let S=P.context,I=S.gl,D=x.posMatrix,G=P.useProgram("debug"),H=ur.disabled,Y=Yr.disabled,J=P.colorModeForRenderPass(),re="$debug",ae=P.style.map.terrain&&P.style.map.terrain.getTerrainData(x);S.activeTexture.set(I.TEXTURE0);let _e=h.getTileByID(x.key).latestRawTileData,Ce=Math.floor((_e&&_e.byteLength||0)/1024),Ae=h.getTile(x).tileSize,Re=512/Math.min(Ae,512)*(x.overscaledZ/P.transform.zoom)*.5,Te=x.canonical.toString();x.overscaledZ!==x.canonical.z&&(Te+=` => ${x.overscaledZ}`),function(Ve,tt){Ve.initDebugOverlayCanvas();let Ne=Ve.debugOverlayCanvas,Xe=Ve.context.gl,rt=Ve.debugOverlayCanvas.getContext("2d");rt.clearRect(0,0,Ne.width,Ne.height),rt.shadowColor="white",rt.shadowBlur=2,rt.lineWidth=1.5,rt.strokeStyle="white",rt.textBaseline="top",rt.font="bold 36px Open Sans, sans-serif",rt.fillText(tt,5,5),rt.strokeText(tt,5,5),Ve.debugOverlayTexture.update(Ne),Ve.debugOverlayTexture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE)}(P,`${Te} ${Ce}kB`),G.draw(S,I.TRIANGLES,H,Y,_s.alphaBlended,Zr.disabled,w7(D,n.Color.transparent,Re),null,re,P.debugBuffer,P.quadTriangleIndexBuffer,P.debugSegments),G.draw(S,I.LINE_STRIP,H,Y,J,Zr.disabled,w7(D,n.Color.red),ae,re,P.debugBuffer,P.tileBorderIndexBuffer,P.debugSegments)}function G0(P,h,x){let S=P.context,I=S.gl,D=P.colorModeForRenderPass(),G=new ur(I.LEQUAL,ur.ReadWrite,P.depthRangeFor3D),H=P.useProgram("terrain"),Y=h.getTerrainMesh();S.bindFramebuffer.set(null),S.viewport.set([0,0,P.width,P.height]);for(let J of x){let re=P.renderToTexture.getTexture(J),ae=h.getTerrainData(J.tileID);S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,re.texture);let _e={u_matrix:P.transform.calculatePosMatrix(J.tileID.toUnwrapped()),u_texture:0,u_ele_delta:h.getMeshFrameDelta(P.transform.zoom)};H.draw(S,I.TRIANGLES,G,Yr.disabled,D,Zr.backCCW,_e,ae,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments)}}class L7{constructor(h,x){this.context=new N0(h),this.transform=x,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:n.create(),renderTime:0},this.setup(),this.numSublayers=xe.maxUnderzooming+xe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ks}resize(h,x,S){if(this.width=Math.floor(h*S),this.height=Math.floor(x*S),this.pixelRatio=S,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let I of this.style._order)this.style._layers[I].resize()}setup(){let h=this.context,x=new n.PosArray;x.emplaceBack(0,0),x.emplaceBack(n.EXTENT,0),x.emplaceBack(0,n.EXTENT),x.emplaceBack(n.EXTENT,n.EXTENT),this.tileExtentBuffer=h.createVertexBuffer(x,w0.members),this.tileExtentSegments=n.SegmentVector.simpleSegment(0,0,4,2);let S=new n.PosArray;S.emplaceBack(0,0),S.emplaceBack(n.EXTENT,0),S.emplaceBack(0,n.EXTENT),S.emplaceBack(n.EXTENT,n.EXTENT),this.debugBuffer=h.createVertexBuffer(S,w0.members),this.debugSegments=n.SegmentVector.simpleSegment(0,0,4,5);let I=new n.RasterBoundsArray;I.emplaceBack(0,0,0,0),I.emplaceBack(n.EXTENT,0,n.EXTENT,0),I.emplaceBack(0,n.EXTENT,0,n.EXTENT),I.emplaceBack(n.EXTENT,n.EXTENT,n.EXTENT,n.EXTENT),this.rasterBoundsBuffer=h.createVertexBuffer(I,gt.members),this.rasterBoundsSegments=n.SegmentVector.simpleSegment(0,0,4,2);let D=new n.PosArray;D.emplaceBack(0,0),D.emplaceBack(1,0),D.emplaceBack(0,1),D.emplaceBack(1,1),this.viewportBuffer=h.createVertexBuffer(D,w0.members),this.viewportSegments=n.SegmentVector.simpleSegment(0,0,4,2);let G=new n.LineStripIndexArray;G.emplaceBack(0),G.emplaceBack(1),G.emplaceBack(3),G.emplaceBack(2),G.emplaceBack(0),this.tileBorderIndexBuffer=h.createIndexBuffer(G);let H=new n.TriangleIndexArray;H.emplaceBack(0,1,2),H.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=h.createIndexBuffer(H);let Y=this.context.gl;this.stencilClearMode=new Yr({func:Y.ALWAYS,mask:0},0,255,Y.ZERO,Y.ZERO,Y.ZERO)}clearStencil(){let h=this.context,x=h.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let S=n.create();n.ortho(S,0,this.width,this.height,0,0,1),n.scale(S,S,[x.drawingBufferWidth,x.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(h,x.TRIANGLES,ur.disabled,this.stencilClearMode,_s.disabled,Zr.disabled,A0(S),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(h,x){if(this.currentStencilSource===h.source||!h.isTileClipped()||!x||!x.length)return;this.currentStencilSource=h.source;let S=this.context,I=S.gl;this.nextStencilID+x.length>256&&this.clearStencil(),S.setColorMode(_s.disabled),S.setDepthMode(ur.disabled);let D=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(let G of x){let H=this._tileClippingMaskIDs[G.key]=this.nextStencilID++,Y=this.style.map.terrain&&this.style.map.terrain.getTerrainData(G);D.draw(S,I.TRIANGLES,ur.disabled,new Yr({func:I.ALWAYS,mask:0},H,255,I.KEEP,I.KEEP,I.REPLACE),_s.disabled,Zr.disabled,A0(G.posMatrix),Y,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let h=this.nextStencilID++,x=this.context.gl;return new Yr({func:x.NOTEQUAL,mask:255},h,255,x.KEEP,x.KEEP,x.REPLACE)}stencilModeForClipping(h){let x=this.context.gl;return new Yr({func:x.EQUAL,mask:255},this._tileClippingMaskIDs[h.key],0,x.KEEP,x.KEEP,x.REPLACE)}stencilConfigForOverlap(h){let x=this.context.gl,S=h.sort((G,H)=>H.overscaledZ-G.overscaledZ),I=S[S.length-1].overscaledZ,D=S[0].overscaledZ-I+1;if(D>1){this.currentStencilSource=void 0,this.nextStencilID+D>256&&this.clearStencil();let G={};for(let H=0;H<D;H++)G[H+I]=new Yr({func:x.GEQUAL,mask:255},H+this.nextStencilID,255,x.KEEP,x.KEEP,x.REPLACE);return this.nextStencilID+=D,[G,S]}return[{[I]:Yr.disabled},S]}colorModeForRenderPass(){let h=this.context.gl;return this._showOverdrawInspector?new _s([h.CONSTANT_COLOR,h.ONE],new n.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?_s.unblended:_s.alphaBlended}depthModeForSublayer(h,x,S){if(!this.opaquePassEnabledForLayer())return ur.disabled;let I=1-((1+this.currentLayer)*this.numSublayers+h)*this.depthEpsilon;return new ur(S||this.context.gl.LEQUAL,x,[I,I])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(h,x){this.style=h,this.options=x,this.lineAtlas=h.lineAtlas,this.imageManager=h.imageManager,this.glyphManager=h.glyphManager,this.symbolFadeChange=h.placement.symbolFadeChange(n.browser.now()),this.imageManager.beginFrame();let S=this.style._order,I=this.style.sourceCaches,D={},G={},H={};for(let Y in I){let J=I[Y];J.used&&J.prepare(this.context),D[Y]=J.getVisibleCoordinates(),G[Y]=D[Y].slice().reverse(),H[Y]=J.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Y=0;Y<S.length;Y++)if(this.style._layers[S[Y]].is3D()){this.opaquePassCutoff=Y;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;let Y=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!n.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||Y.length)&&(n.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(J,re){let ae=J.context,_e=ae.gl,Ce=_s.unblended,Ae=new ur(_e.LEQUAL,ur.ReadWrite,[0,1]),Re=re.getTerrainMesh(),Te=re.sourceCache.getRenderableTiles(),Ve=J.useProgram("terrainDepth");ae.bindFramebuffer.set(re.getFramebuffer("depth").framebuffer),ae.viewport.set([0,0,J.width/devicePixelRatio,J.height/devicePixelRatio]),ae.clear({color:n.Color.transparent,depth:1});for(let tt of Te){let Ne=re.getTerrainData(tt.tileID),Xe={u_matrix:J.transform.calculatePosMatrix(tt.tileID.toUnwrapped()),u_ele_delta:re.getMeshFrameDelta(J.transform.zoom)};Ve.draw(ae,_e.TRIANGLES,Ae,Yr.disabled,Ce,Zr.backCCW,Xe,Ne,"terrain",Re.vertexBuffer,Re.indexBuffer,Re.segments)}ae.bindFramebuffer.set(null),ae.viewport.set([0,0,J.width,J.height])}(this,this.style.map.terrain),function(J,re){let ae=J.context,_e=ae.gl,Ce=_s.unblended,Ae=new ur(_e.LEQUAL,ur.ReadWrite,[0,1]),Re=re.getTerrainMesh(),Te=re.getCoordsTexture(),Ve=re.sourceCache.getRenderableTiles(),tt=J.useProgram("terrainCoords");ae.bindFramebuffer.set(re.getFramebuffer("coords").framebuffer),ae.viewport.set([0,0,J.width/devicePixelRatio,J.height/devicePixelRatio]),ae.clear({color:n.Color.transparent,depth:1}),re.coordsIndex=[];for(let Ne of Ve){let Xe=re.getTerrainData(Ne.tileID);ae.activeTexture.set(_e.TEXTURE0),_e.bindTexture(_e.TEXTURE_2D,Te.texture);let rt={u_matrix:J.transform.calculatePosMatrix(Ne.tileID.toUnwrapped()),u_terrain_coords_id:(255-re.coordsIndex.length)/255,u_texture:0,u_ele_delta:re.getMeshFrameDelta(J.transform.zoom)};tt.draw(ae,_e.TRIANGLES,Ae,Yr.disabled,Ce,Zr.backCCW,rt,Xe,"terrain",Re.vertexBuffer,Re.indexBuffer,Re.segments),re.coordsIndex.push(Ne.tileID.key)}ae.bindFramebuffer.set(null),ae.viewport.set([0,0,J.width,J.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(let Y of S){let J=this.style._layers[Y];if(!J.hasOffscreenPass()||J.isHidden(this.transform.zoom))continue;let re=G[J.source];(J.type==="custom"||re.length)&&this.renderLayer(this,I[J.source],J,re)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:x.showOverdrawInspector?n.Color.black:n.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=x.showOverdrawInspector,this.depthRangeFor3D=[0,1-(h._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){let Y=this.style._layers[S[this.currentLayer]],J=I[Y.source],re=D[Y.source];this._renderTileClippingMasks(Y,re),this.renderLayer(this,J,Y,re)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){let Y=this.style._layers[S[this.currentLayer]],J=I[Y.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(Y))continue;let re=(Y.type==="symbol"?H:G)[Y.source];this._renderTileClippingMasks(Y,D[Y.source]),this.renderLayer(this,J,Y,re)}if(this.options.showTileBoundaries){let Y=function(J,re){let ae=null,_e=Object.values(J._layers).flatMap(Te=>Te.source&&!Te.isHidden(re)?[J.sourceCaches[Te.source]]:[]),Ce=_e.filter(Te=>Te.getSource().type==="vector"),Ae=_e.filter(Te=>Te.getSource().type!=="vector"),Re=Te=>{(!ae||ae.getSource().maxzoom<Te.getSource().maxzoom)&&(ae=Te)};return Ce.forEach(Te=>Re(Te)),ae||Ae.forEach(Te=>Re(Te)),ae}(this.style,this.transform.zoom);Y&&function(J,re,ae){for(let _e=0;_e<ae.length;_e++)Ph(J,re,ae[_e])}(this,Y,Y.getVisibleCoordinates())}this.options.showPadding&&function(Y){let J=Y.transform.padding;z0(Y,Y.transform.height-(J.top||0),3,F7),z0(Y,J.bottom||0,3,Ps),Mp(Y,J.left||0,3,ou),Mp(Y,Y.transform.width-(J.right||0),3,oa);let re=Y.transform.centerPoint;(function(ae,_e,Ce,Ae){Nl(ae,_e-1,Ce-10,2,20,Ae),Nl(ae,_e-10,Ce-1,20,2,Ae)})(Y,re.x,Y.transform.height-re.y,kp)}(this),this.context.setDefault()}renderLayer(h,x,S,I){if(!S.isHidden(this.transform.zoom)&&(S.type==="background"||S.type==="custom"||(I||[]).length))switch(this.id=S.id,S.type){case"symbol":(function(D,G,H,Y,J){if(D.renderPass!=="translucent")return;let re=Yr.disabled,ae=D.colorModeForRenderPass();(H._unevaluatedLayout.hasValue("text-variable-anchor")||H._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(_e,Ce,Ae,Re,Te,Ve,tt){let Ne=Ce.transform,Xe=Te==="map",rt=Ve==="map";for(let st of _e){let ft=Re.getTile(st),Tt=ft.getBucket(Ae);if(!Tt||!Tt.text||!Tt.text.segments.get().length)continue;let Et=n.evaluateSizeForZoom(Tt.textSizeData,Ne.zoom),kt=Ge(ft,1,Ce.transform.zoom),oi=Zi(st.posMatrix,rt,Xe,Ce.transform,kt),or=Ae.layout.get("icon-text-fit")!=="none"&&Tt.hasIconData();if(Et){let Ut=Math.pow(2,Ne.zoom-ft.tileID.overscaledZ);Sp(Tt,Xe,rt,tt,Ne,oi,st.posMatrix,Ut,Et,or,Ce.style.map.terrain?(yi,ii)=>Ce.style.map.terrain.getElevation(st,yi,ii):null)}}}(Y,D,H,G,H.layout.get("text-rotation-alignment"),H.layout.get("text-pitch-alignment"),J),H.paint.get("icon-opacity").constantOr(1)!==0&&Ap(D,G,H,Y,!1,H.paint.get("icon-translate"),H.paint.get("icon-translate-anchor"),H.layout.get("icon-rotation-alignment"),H.layout.get("icon-pitch-alignment"),H.layout.get("icon-keep-upright"),re,ae),H.paint.get("text-opacity").constantOr(1)!==0&&Ap(D,G,H,Y,!0,H.paint.get("text-translate"),H.paint.get("text-translate-anchor"),H.layout.get("text-rotation-alignment"),H.layout.get("text-pitch-alignment"),H.layout.get("text-keep-upright"),re,ae),G.map.showCollisionBoxes&&(kh(D,G,H,Y,H.paint.get("text-translate"),H.paint.get("text-translate-anchor"),!0),kh(D,G,H,Y,H.paint.get("icon-translate"),H.paint.get("icon-translate-anchor"),!1))})(h,x,S,I,this.style.placement.variableOffsets);break;case"circle":(function(D,G,H,Y){if(D.renderPass!=="translucent")return;let J=H.paint.get("circle-opacity"),re=H.paint.get("circle-stroke-width"),ae=H.paint.get("circle-stroke-opacity"),_e=!H.layout.get("circle-sort-key").isConstant();if(J.constantOr(1)===0&&(re.constantOr(1)===0||ae.constantOr(1)===0))return;let Ce=D.context,Ae=Ce.gl,Re=D.depthModeForSublayer(0,ur.ReadOnly),Te=Yr.disabled,Ve=D.colorModeForRenderPass(),tt=[];for(let Ne=0;Ne<Y.length;Ne++){let Xe=Y[Ne],rt=G.getTile(Xe),st=rt.getBucket(H);if(!st)continue;let ft=st.programConfigurations.get(H.id),Tt=D.useProgram("circle",ft),Et=st.layoutVertexBuffer,kt=st.indexBuffer,oi=D.style.map.terrain&&D.style.map.terrain.getTerrainData(Xe),or={programConfiguration:ft,program:Tt,layoutVertexBuffer:Et,indexBuffer:kt,uniformValues:Kx(D,Xe,rt,H),terrainData:oi};if(_e){let Ut=st.segments.get();for(let yi of Ut)tt.push({segments:new n.SegmentVector([yi]),sortKey:yi.sortKey,state:or})}else tt.push({segments:st.segments,sortKey:0,state:or})}_e&&tt.sort((Ne,Xe)=>Ne.sortKey-Xe.sortKey);for(let Ne of tt){let{programConfiguration:Xe,program:rt,layoutVertexBuffer:st,indexBuffer:ft,uniformValues:Tt,terrainData:Et}=Ne.state;rt.draw(Ce,Ae.TRIANGLES,Re,Te,Ve,Zr.disabled,Tt,Et,H.id,st,ft,Ne.segments,H.paint,D.transform.zoom,Xe)}})(h,x,S,I);break;case"heatmap":(function(D,G,H,Y){if(H.paint.get("heatmap-opacity")!==0)if(D.renderPass==="offscreen"){let J=D.context,re=J.gl,ae=Yr.disabled,_e=new _s([re.ONE,re.ONE],n.Color.transparent,[!0,!0,!0,!0]);(function(Ce,Ae,Re){let Te=Ce.gl;Ce.activeTexture.set(Te.TEXTURE1),Ce.viewport.set([0,0,Ae.width/4,Ae.height/4]);let Ve=Re.heatmapFbo;if(Ve)Te.bindTexture(Te.TEXTURE_2D,Ve.colorAttachment.get()),Ce.bindFramebuffer.set(Ve.framebuffer);else{let tt=Te.createTexture();Te.bindTexture(Te.TEXTURE_2D,tt),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_WRAP_S,Te.CLAMP_TO_EDGE),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_WRAP_T,Te.CLAMP_TO_EDGE),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_MIN_FILTER,Te.LINEAR),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_MAG_FILTER,Te.LINEAR),Ve=Re.heatmapFbo=Ce.createFramebuffer(Ae.width/4,Ae.height/4,!1,!1),function(Ne,Xe,rt,st){var ft,Tt;let Et=Ne.gl,kt=(ft=Ne.HALF_FLOAT)!==null&&ft!==void 0?ft:Et.UNSIGNED_BYTE,oi=(Tt=Ne.RGBA16F)!==null&&Tt!==void 0?Tt:Et.RGBA;Et.texImage2D(Et.TEXTURE_2D,0,oi,Xe.width/4,Xe.height/4,0,Et.RGBA,kt,null),st.colorAttachment.set(rt)}(Ce,Ae,tt,Ve)}})(J,D,H),J.clear({color:n.Color.transparent});for(let Ce=0;Ce<Y.length;Ce++){let Ae=Y[Ce];if(G.hasRenderableParent(Ae))continue;let Re=G.getTile(Ae),Te=Re.getBucket(H);if(!Te)continue;let Ve=Te.programConfigurations.get(H.id),tt=D.useProgram("heatmap",Ve),{zoom:Ne}=D.transform;tt.draw(J,re.TRIANGLES,ur.disabled,ae,_e,Zr.disabled,E7(Ae.posMatrix,Re,Ne,H.paint.get("heatmap-intensity")),null,H.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,H.paint,D.transform.zoom,Ve)}J.viewport.set([0,0,D.width,D.height])}else D.renderPass==="translucent"&&(D.context.setColorMode(D.colorModeForRenderPass()),function(J,re){let ae=J.context,_e=ae.gl,Ce=re.heatmapFbo;if(!Ce)return;ae.activeTexture.set(_e.TEXTURE0),_e.bindTexture(_e.TEXTURE_2D,Ce.colorAttachment.get()),ae.activeTexture.set(_e.TEXTURE1);let Ae=re.colorRampTexture;Ae||(Ae=re.colorRampTexture=new U(ae,re.colorRamp,_e.RGBA)),Ae.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),J.useProgram("heatmapTexture").draw(ae,_e.TRIANGLES,ur.disabled,Yr.disabled,J.colorModeForRenderPass(),Zr.disabled,((Re,Te,Ve,tt)=>{let Ne=n.create();n.ortho(Ne,0,Re.width,Re.height,0,0,1);let Xe=Re.context.gl;return{u_matrix:Ne,u_world:[Xe.drawingBufferWidth,Xe.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Te.paint.get("heatmap-opacity")}})(J,re),null,re.id,J.viewportBuffer,J.quadTriangleIndexBuffer,J.viewportSegments,re.paint,J.transform.zoom)}(D,H))})(h,x,S,I);break;case"line":(function(D,G,H,Y){if(D.renderPass!=="translucent")return;let J=H.paint.get("line-opacity"),re=H.paint.get("line-width");if(J.constantOr(1)===0||re.constantOr(1)===0)return;let ae=D.depthModeForSublayer(0,ur.ReadOnly),_e=D.colorModeForRenderPass(),Ce=H.paint.get("line-dasharray"),Ae=H.paint.get("line-pattern"),Re=Ae.constantOr(1),Te=H.paint.get("line-gradient"),Ve=H.getCrossfadeParameters(),tt=Re?"linePattern":Ce?"lineSDF":Te?"lineGradient":"line",Ne=D.context,Xe=Ne.gl,rt=!0;for(let st of Y){let ft=G.getTile(st);if(Re&&!ft.patternsLoaded())continue;let Tt=ft.getBucket(H);if(!Tt)continue;let Et=Tt.programConfigurations.get(H.id),kt=D.context.program.get(),oi=D.useProgram(tt,Et),or=rt||oi.program!==kt,Ut=D.style.map.terrain&&D.style.map.terrain.getTerrainData(st),yi=Ae.constantOr(null);if(yi&&ft.imageAtlas){let ar=ft.imageAtlas,_i=ar.patternPositions[yi.to.toString()],lr=ar.patternPositions[yi.from.toString()];_i&&lr&&Et.setConstantPatternPositions(_i,lr)}let ii=Ut?st:null,is=Re?tu(D,ft,H,Ve,ii):Ce?I0(D,ft,H,Ce,Ve,ii):Te?S7(D,ft,H,Tt.lineClipsArray.length,ii):C0(D,ft,H,ii);if(Re)Ne.activeTexture.set(Xe.TEXTURE0),ft.imageAtlasTexture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE),Et.updatePaintBuffers(Ve);else if(Ce&&(or||D.lineAtlas.dirty))Ne.activeTexture.set(Xe.TEXTURE0),D.lineAtlas.bind(Ne);else if(Te){let ar=Tt.gradients[H.id],_i=ar.texture;if(H.gradientVersion!==ar.version){let lr=256;if(H.stepInterpolant){let us=G.getSource().maxzoom,Dr=st.canonical.z===us?Math.ceil(1<<D.transform.maxZoom-st.canonical.z):1;lr=n.clamp(n.nextPowerOfTwo(Tt.maxLineLength/n.EXTENT*1024*Dr),256,Ne.maxTextureSize)}ar.gradient=n.renderColorRamp({expression:H.gradientExpression(),evaluationKey:"lineProgress",resolution:lr,image:ar.gradient||void 0,clips:Tt.lineClipsArray}),ar.texture?ar.texture.update(ar.gradient):ar.texture=new U(Ne,ar.gradient,Xe.RGBA),ar.version=H.gradientVersion,_i=ar.texture}Ne.activeTexture.set(Xe.TEXTURE0),_i.bind(H.stepInterpolant?Xe.NEAREST:Xe.LINEAR,Xe.CLAMP_TO_EDGE)}oi.draw(Ne,Xe.TRIANGLES,ae,D.stencilModeForClipping(st),_e,Zr.disabled,is,Ut,H.id,Tt.layoutVertexBuffer,Tt.indexBuffer,Tt.segments,H.paint,D.transform.zoom,Et,Tt.layoutVertexBuffer2),rt=!1}})(h,x,S,I);break;case"fill":(function(D,G,H,Y){let J=H.paint.get("fill-color"),re=H.paint.get("fill-opacity");if(re.constantOr(1)===0)return;let ae=D.colorModeForRenderPass(),_e=H.paint.get("fill-pattern"),Ce=D.opaquePassEnabledForLayer()&&!_e.constantOr(1)&&J.constantOr(n.Color.transparent).a===1&&re.constantOr(0)===1?"opaque":"translucent";if(D.renderPass===Ce){let Ae=D.depthModeForSublayer(1,D.renderPass==="opaque"?ur.ReadWrite:ur.ReadOnly);Cp(D,G,H,Y,Ae,ae,!1)}if(D.renderPass==="translucent"&&H.paint.get("fill-antialias")){let Ae=D.depthModeForSublayer(H.getPaintProperty("fill-outline-color")?2:0,ur.ReadOnly);Cp(D,G,H,Y,Ae,ae,!0)}})(h,x,S,I);break;case"fill-extrusion":(function(D,G,H,Y){let J=H.paint.get("fill-extrusion-opacity");if(J!==0&&D.renderPass==="translucent"){let re=new ur(D.context.gl.LEQUAL,ur.ReadWrite,D.depthRangeFor3D);if(J!==1||H.paint.get("fill-extrusion-pattern").constantOr(1))B0(D,G,H,Y,re,Yr.disabled,_s.disabled),B0(D,G,H,Y,re,D.stencilModeFor3D(),D.colorModeForRenderPass());else{let ae=D.colorModeForRenderPass();B0(D,G,H,Y,re,Yr.disabled,ae)}}})(h,x,S,I);break;case"hillshade":(function(D,G,H,Y){if(D.renderPass!=="offscreen"&&D.renderPass!=="translucent")return;let J=D.context,re=D.depthModeForSublayer(0,ur.ReadOnly),ae=D.colorModeForRenderPass(),[_e,Ce]=D.renderPass==="translucent"?D.stencilConfigForOverlap(Y):[{},Y];for(let Ae of Ce){let Re=G.getTile(Ae);Re.needsHillshadePrepare!==void 0&&Re.needsHillshadePrepare&&D.renderPass==="offscreen"?Ip(D,Re,H,re,Yr.disabled,ae):D.renderPass==="translucent"&&U0(D,Ae,Re,H,re,_e[Ae.overscaledZ],ae)}J.viewport.set([0,0,D.width,D.height])})(h,x,S,I);break;case"raster":(function(D,G,H,Y){if(D.renderPass!=="translucent"||H.paint.get("raster-opacity")===0||!Y.length)return;let J=D.context,re=J.gl,ae=G.getSource(),_e=D.useProgram("raster"),Ce=D.colorModeForRenderPass(),[Ae,Re]=ae instanceof vt?[{},Y]:D.stencilConfigForOverlap(Y),Te=Re[Re.length-1].overscaledZ,Ve=!D.options.moving;for(let tt of Re){let Ne=D.depthModeForSublayer(tt.overscaledZ-Te,H.paint.get("raster-opacity")===1?ur.ReadWrite:ur.ReadOnly,re.LESS),Xe=G.getTile(tt);Xe.registerFadeDuration(H.paint.get("raster-fade-duration"));let rt=G.findLoadedParent(tt,0),st=hv(Xe,rt,G,H,D.transform,D.style.map.terrain),ft,Tt,Et=H.paint.get("raster-resampling")==="nearest"?re.NEAREST:re.LINEAR;J.activeTexture.set(re.TEXTURE0),Xe.texture.bind(Et,re.CLAMP_TO_EDGE,re.LINEAR_MIPMAP_NEAREST),J.activeTexture.set(re.TEXTURE1),rt?(rt.texture.bind(Et,re.CLAMP_TO_EDGE,re.LINEAR_MIPMAP_NEAREST),ft=Math.pow(2,rt.tileID.overscaledZ-Xe.tileID.overscaledZ),Tt=[Xe.tileID.canonical.x*ft%1,Xe.tileID.canonical.y*ft%1]):Xe.texture.bind(Et,re.CLAMP_TO_EDGE,re.LINEAR_MIPMAP_NEAREST);let kt=D.style.map.terrain&&D.style.map.terrain.getTerrainData(tt),oi=kt?tt:null,or=oi?oi.posMatrix:D.transform.calculatePosMatrix(tt.toUnwrapped(),Ve),Ut=k0(or,Tt||[0,0],ft||1,st,H);ae instanceof vt?_e.draw(J,re.TRIANGLES,Ne,Yr.disabled,Ce,Zr.disabled,Ut,kt,H.id,ae.boundsBuffer,D.quadTriangleIndexBuffer,ae.boundsSegments):_e.draw(J,re.TRIANGLES,Ne,Ae[tt.overscaledZ],Ce,Zr.disabled,Ut,kt,H.id,D.rasterBoundsBuffer,D.quadTriangleIndexBuffer,D.rasterBoundsSegments)}})(h,x,S,I);break;case"background":(function(D,G,H,Y){let J=H.paint.get("background-color"),re=H.paint.get("background-opacity");if(re===0)return;let ae=D.context,_e=ae.gl,Ce=D.transform,Ae=Ce.tileSize,Re=H.paint.get("background-pattern");if(D.isPatternMissing(Re))return;let Te=!Re&&J.a===1&&re===1&&D.opaquePassEnabledForLayer()?"opaque":"translucent";if(D.renderPass!==Te)return;let Ve=Yr.disabled,tt=D.depthModeForSublayer(0,Te==="opaque"?ur.ReadWrite:ur.ReadOnly),Ne=D.colorModeForRenderPass(),Xe=D.useProgram(Re?"backgroundPattern":"background"),rt=Y||Ce.coveringTiles({tileSize:Ae,terrain:D.style.map.terrain});Re&&(ae.activeTexture.set(_e.TEXTURE0),D.imageManager.bind(D.context));let st=H.getCrossfadeParameters();for(let ft of rt){let Tt=Y?ft.posMatrix:D.transform.calculatePosMatrix(ft.toUnwrapped()),Et=Re?M0(Tt,re,D,Re,{tileID:ft,tileSize:Ae},st):iu(Tt,re,J),kt=D.style.map.terrain&&D.style.map.terrain.getTerrainData(ft);Xe.draw(ae,_e.TRIANGLES,tt,Ve,Ne,Zr.disabled,Et,kt,H.id,D.tileExtentBuffer,D.quadTriangleIndexBuffer,D.tileExtentSegments)}})(h,0,S,I);break;case"custom":(function(D,G,H){let Y=D.context,J=H.implementation;if(D.renderPass==="offscreen"){let re=J.prerender;re&&(D.setCustomLayerDefaults(),Y.setColorMode(D.colorModeForRenderPass()),re.call(J,Y.gl,D.transform.customLayerMatrix()),Y.setDirty(),D.setBaseState())}else if(D.renderPass==="translucent"){D.setCustomLayerDefaults(),Y.setColorMode(D.colorModeForRenderPass()),Y.setStencilMode(Yr.disabled);let re=J.renderingMode==="3d"?new ur(D.context.gl.LEQUAL,ur.ReadWrite,D.depthRangeFor3D):D.depthModeForSublayer(0,ur.ReadOnly);Y.setDepthMode(re),J.render(Y.gl,D.transform.customLayerMatrix()),Y.setDirty(),D.setBaseState(),Y.bindFramebuffer.set(null)}})(h,0,S)}}translatePosMatrix(h,x,S,I,D){if(!S[0]&&!S[1])return h;let G=D?I==="map"?this.transform.angle:0:I==="viewport"?-this.transform.angle:0;if(G){let J=Math.sin(G),re=Math.cos(G);S=[S[0]*re-S[1]*J,S[0]*J+S[1]*re]}let H=[D?S[0]:Ge(x,S[0],this.transform.zoom),D?S[1]:Ge(x,S[1],this.transform.zoom),0],Y=new Float32Array(16);return n.translate(Y,h,H),Y}saveTileTexture(h){let x=this._tileTextures[h.size[0]];x?x.push(h):this._tileTextures[h.size[0]]=[h]}getTileTexture(h){let x=this._tileTextures[h];return x&&x.length>0?x.pop():null}isPatternMissing(h){if(!h)return!1;if(!h.from||!h.to)return!0;let x=this.imageManager.getPattern(h.from.toString()),S=this.imageManager.getPattern(h.to.toString());return!x||!S}useProgram(h,x){this.cache=this.cache||{};let S=h+(x?x.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[S]||(this.cache[S]=new yc(this.context,bh[h],x,To[h],this._showOverdrawInspector,this.style.map.terrain)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let h=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(h.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new U(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:h,drawingBufferHeight:x}=this.context.gl;return this.width!==h||this.height!==x}}class $0{constructor(h,x){this.points=h,this.planes=x}static fromInvProjectionMatrix(h,x,S){let I=Math.pow(2,S),D=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(H=>{let Y=1/(H=n.transformMat4([],H,h))[3]/x*I;return n.mul$1(H,H,[Y,Y,1/H[3],Y])}),G=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(H=>{let Y=function(_e,Ce){var Ae=Ce[0],Re=Ce[1],Te=Ce[2],Ve=Ae*Ae+Re*Re+Te*Te;return Ve>0&&(Ve=1/Math.sqrt(Ve)),_e[0]=Ce[0]*Ve,_e[1]=Ce[1]*Ve,_e[2]=Ce[2]*Ve,_e}([],function(_e,Ce,Ae){var Re=Ce[0],Te=Ce[1],Ve=Ce[2],tt=Ae[0],Ne=Ae[1],Xe=Ae[2];return _e[0]=Te*Xe-Ve*Ne,_e[1]=Ve*tt-Re*Xe,_e[2]=Re*Ne-Te*tt,_e}([],k([],D[H[0]],D[H[1]]),k([],D[H[2]],D[H[1]]))),J=-((re=Y)[0]*(ae=D[H[1]])[0]+re[1]*ae[1]+re[2]*ae[2]);var re,ae;return Y.concat(J)});return new $0(D,G)}}class Rh{constructor(h,x){this.min=h,this.max=x,this.center=function(S,I,D){return S[0]=.5*I[0],S[1]=.5*I[1],S[2]=.5*I[2],S}([],function(S,I,D){return S[0]=I[0]+D[0],S[1]=I[1]+D[1],S[2]=I[2]+D[2],S}([],this.min,this.max))}quadrant(h){let x=[h%2==0,h<2],S=A(this.min),I=A(this.max);for(let D=0;D<x.length;D++)S[D]=x[D]?this.min[D]:this.center[D],I[D]=x[D]?this.center[D]:this.max[D];return I[2]=this.max[2],new Rh(S,I)}distanceX(h){return Math.max(Math.min(this.max[0],h[0]),this.min[0])-h[0]}distanceY(h){return Math.max(Math.min(this.max[1],h[1]),this.min[1])-h[1]}intersects(h){let x=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]],S=!0;for(let I=0;I<h.planes.length;I++){let D=h.planes[I],G=0;for(let H=0;H<x.length;H++)n.dot(D,x[H])>=0&&G++;if(G===0)return 0;G!==x.length&&(S=!1)}if(S)return 2;for(let I=0;I<3;I++){let D=Number.MAX_VALUE,G=-Number.MAX_VALUE;for(let H=0;H<h.points.length;H++){let Y=h.points[H][I]-this.min[I];D=Math.min(D,Y),G=Math.max(G,Y)}if(G<0||D>this.max[I]-this.min[I])return 0}return 1}}class H0{constructor(h=0,x=0,S=0,I=0){if(isNaN(h)||h<0||isNaN(x)||x<0||isNaN(S)||S<0||isNaN(I)||I<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=h,this.bottom=x,this.left=S,this.right=I}interpolate(h,x,S){return x.top!=null&&h.top!=null&&(this.top=n.interpolate.number(h.top,x.top,S)),x.bottom!=null&&h.bottom!=null&&(this.bottom=n.interpolate.number(h.bottom,x.bottom,S)),x.left!=null&&h.left!=null&&(this.left=n.interpolate.number(h.left,x.left,S)),x.right!=null&&h.right!=null&&(this.right=n.interpolate.number(h.right,x.right,S)),this}getCenter(h,x){let S=n.clamp((this.left+h-this.right)/2,0,h),I=n.clamp((this.top+x-this.bottom)/2,0,x);return new n.Point(S,I)}equals(h){return this.top===h.top&&this.bottom===h.bottom&&this.left===h.left&&this.right===h.right}clone(){return new H0(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class V0{constructor(h,x,S,I,D){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=D===void 0||!!D,this._minZoom=h||0,this._maxZoom=x||22,this._minPitch=S??0,this._maxPitch=I??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new n.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new H0,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){let h=new V0(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return h.apply(this),h}apply(h){this.tileSize=h.tileSize,this.latRange=h.latRange,this.width=h.width,this.height=h.height,this._center=h._center,this._elevation=h._elevation,this._minEleveationForCurrentTile=h._minEleveationForCurrentTile,this.zoom=h.zoom,this.angle=h.angle,this._fov=h._fov,this._pitch=h._pitch,this._unmodified=h._unmodified,this._edgeInsets=h._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(h){this._minZoom!==h&&(this._minZoom=h,this.zoom=Math.max(this.zoom,h))}get maxZoom(){return this._maxZoom}set maxZoom(h){this._maxZoom!==h&&(this._maxZoom=h,this.zoom=Math.min(this.zoom,h))}get minPitch(){return this._minPitch}set minPitch(h){this._minPitch!==h&&(this._minPitch=h,this.pitch=Math.max(this.pitch,h))}get maxPitch(){return this._maxPitch}set maxPitch(h){this._maxPitch!==h&&(this._maxPitch=h,this.pitch=Math.min(this.pitch,h))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(h){h===void 0?h=!0:h===null&&(h=!1),this._renderWorldCopies=h}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(h){let x=-n.wrap(h,-180,180)*Math.PI/180;this.angle!==x&&(this._unmodified=!1,this.angle=x,this._calcMatrices(),this.rotationMatrix=function(){var S=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(S[1]=0,S[2]=0),S[0]=1,S[3]=1,S}(),function(S,I,D){var G=I[0],H=I[1],Y=I[2],J=I[3],re=Math.sin(D),ae=Math.cos(D);S[0]=G*ae+Y*re,S[1]=H*ae+J*re,S[2]=G*-re+Y*ae,S[3]=H*-re+J*ae}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(h){let x=n.clamp(h,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==x&&(this._unmodified=!1,this._pitch=x,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(h){h=Math.max(.01,Math.min(60,h)),this._fov!==h&&(this._unmodified=!1,this._fov=h/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(h){let x=Math.min(Math.max(h,this.minZoom),this.maxZoom);this._zoom!==x&&(this._unmodified=!1,this._zoom=x,this.tileZoom=Math.max(0,Math.floor(x)),this.scale=this.zoomScale(x),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(h){h.lat===this._center.lat&&h.lng===this._center.lng||(this._unmodified=!1,this._center=h,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(h){h!==this._elevation&&(this._elevation=h,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(h){this._edgeInsets.equals(h)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,h,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(h){return this._edgeInsets.equals(h)}interpolatePadding(h,x,S){this._unmodified=!1,this._edgeInsets.interpolate(h,x,S),this._constrain(),this._calcMatrices()}coveringZoomLevel(h){let x=(h.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/h.tileSize));return Math.max(0,x)}getVisibleUnwrappedCoordinates(h){let x=[new n.UnwrappedTileID(0,h)];if(this._renderWorldCopies){let S=this.pointCoordinate(new n.Point(0,0)),I=this.pointCoordinate(new n.Point(this.width,0)),D=this.pointCoordinate(new n.Point(this.width,this.height)),G=this.pointCoordinate(new n.Point(0,this.height)),H=Math.floor(Math.min(S.x,I.x,D.x,G.x)),Y=Math.floor(Math.max(S.x,I.x,D.x,G.x)),J=1;for(let re=H-J;re<=Y+J;re++)re!==0&&x.push(new n.UnwrappedTileID(re,h))}return x}coveringTiles(h){var x,S;let I=this.coveringZoomLevel(h),D=I;if(h.minzoom!==void 0&&I<h.minzoom)return[];h.maxzoom!==void 0&&I>h.maxzoom&&(I=h.maxzoom);let G=this.pointCoordinate(this.getCameraPoint()),H=n.MercatorCoordinate.fromLngLat(this.center),Y=Math.pow(2,I),J=[Y*G.x,Y*G.y,0],re=[Y*H.x,Y*H.y,0],ae=$0.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,I),_e=h.minzoom||0;!h.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(_e=I);let Ce=h.terrain?2/Math.min(this.tileSize,h.tileSize)*this.tileSize:3,Ae=Ne=>({aabb:new Rh([Ne*Y,0,0],[(Ne+1)*Y,Y,0]),zoom:0,x:0,y:0,wrap:Ne,fullyVisible:!1}),Re=[],Te=[],Ve=I,tt=h.reparseOverscaled?D:I;if(this._renderWorldCopies)for(let Ne=1;Ne<=3;Ne++)Re.push(Ae(-Ne)),Re.push(Ae(Ne));for(Re.push(Ae(0));Re.length>0;){let Ne=Re.pop(),Xe=Ne.x,rt=Ne.y,st=Ne.fullyVisible;if(!st){let oi=Ne.aabb.intersects(ae);if(oi===0)continue;st=oi===2}let ft=h.terrain?J:re,Tt=Ne.aabb.distanceX(ft),Et=Ne.aabb.distanceY(ft),kt=Math.max(Math.abs(Tt),Math.abs(Et));if(Ne.zoom===Ve||kt>Ce+(1<<Ve-Ne.zoom)-2&&Ne.zoom>=_e){let oi=Ve-Ne.zoom,or=J[0]-.5-(Xe<<oi),Ut=J[1]-.5-(rt<<oi);Te.push({tileID:new n.OverscaledTileID(Ne.zoom===Ve?tt:Ne.zoom,Ne.wrap,Ne.zoom,Xe,rt),distanceSq:F([re[0]-.5-Xe,re[1]-.5-rt]),tileDistanceToCamera:Math.sqrt(or*or+Ut*Ut)})}else for(let oi=0;oi<4;oi++){let or=(Xe<<1)+oi%2,Ut=(rt<<1)+(oi>>1),yi=Ne.zoom+1,ii=Ne.aabb.quadrant(oi);if(h.terrain){let is=new n.OverscaledTileID(yi,Ne.wrap,yi,or,Ut),ar=h.terrain.getMinMaxElevation(is),_i=(x=ar.minElevation)!==null&&x!==void 0?x:this.elevation,lr=(S=ar.maxElevation)!==null&&S!==void 0?S:this.elevation;ii=new Rh([ii.min[0],ii.min[1],_i],[ii.max[0],ii.max[1],lr])}Re.push({aabb:ii,zoom:yi,x:or,y:Ut,wrap:Ne.wrap,fullyVisible:st})}}return Te.sort((Ne,Xe)=>Ne.distanceSq-Xe.distanceSq).map(Ne=>Ne.tileID)}resize(h,x){this.width=h,this.height=x,this.pixelsToGLUnits=[2/h,-2/x],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(h){return Math.pow(2,h)}scaleZoom(h){return Math.log(h)/Math.LN2}project(h){let x=n.clamp(h.lat,-this.maxValidLatitude,this.maxValidLatitude);return new n.Point(n.mercatorXfromLng(h.lng)*this.worldSize,n.mercatorYfromLat(x)*this.worldSize)}unproject(h){return new n.MercatorCoordinate(h.x/this.worldSize,h.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(h){let x=this.pointLocation(this.centerPoint,h),S=h.getElevationForLngLatZoom(x,this.tileZoom);if(!(this.elevation-S))return;let I=this.getCameraPosition(),D=n.MercatorCoordinate.fromLngLat(I.lngLat,I.altitude),G=n.MercatorCoordinate.fromLngLat(x,S),H=D.x-G.x,Y=D.y-G.y,J=D.z-G.z,re=Math.sqrt(H*H+Y*Y+J*J),ae=this.scaleZoom(this.cameraToCenterDistance/re/this.tileSize);this._elevation=S,this._center=x,this.zoom=ae}setLocationAtPoint(h,x){let S=this.pointCoordinate(x),I=this.pointCoordinate(this.centerPoint),D=this.locationCoordinate(h),G=new n.MercatorCoordinate(D.x-(S.x-I.x),D.y-(S.y-I.y));this.center=this.coordinateLocation(G),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(h,x){return x?this.coordinatePoint(this.locationCoordinate(h),x.getElevationForLngLatZoom(h,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(h))}pointLocation(h,x){return this.coordinateLocation(this.pointCoordinate(h,x))}locationCoordinate(h){return n.MercatorCoordinate.fromLngLat(h)}coordinateLocation(h){return h&&h.toLngLat()}pointCoordinate(h,x){if(x){let _e=x.pointCoordinate(h);if(_e!=null)return _e}let S=[h.x,h.y,0,1],I=[h.x,h.y,1,1];n.transformMat4(S,S,this.pixelMatrixInverse),n.transformMat4(I,I,this.pixelMatrixInverse);let D=S[3],G=I[3],H=S[1]/D,Y=I[1]/G,J=S[2]/D,re=I[2]/G,ae=J===re?0:(0-J)/(re-J);return new n.MercatorCoordinate(n.interpolate.number(S[0]/D,I[0]/G,ae)/this.worldSize,n.interpolate.number(H,Y,ae)/this.worldSize)}coordinatePoint(h,x=0,S=this.pixelMatrix){let I=[h.x*this.worldSize,h.y*this.worldSize,x,1];return n.transformMat4(I,I,S),new n.Point(I[0]/I[3],I[1]/I[3])}getBounds(){let h=Math.max(0,this.height/2-this.getHorizon());return new ne().extend(this.pointLocation(new n.Point(0,h))).extend(this.pointLocation(new n.Point(this.width,h))).extend(this.pointLocation(new n.Point(this.width,this.height))).extend(this.pointLocation(new n.Point(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ne([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(h){h?(this.lngRange=[h.getWest(),h.getEast()],this.latRange=[h.getSouth(),h.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(h,x=!1){let S=h.key,I=x?this._alignedPosMatrixCache:this._posMatrixCache;if(I[S])return I[S];let D=h.canonical,G=this.worldSize/this.zoomScale(D.z),H=D.x+Math.pow(2,D.z)*h.wrap,Y=n.identity(new Float64Array(16));return n.translate(Y,Y,[H*G,D.y*G,0]),n.scale(Y,Y,[G/n.EXTENT,G/n.EXTENT,1]),n.multiply(Y,x?this.alignedProjMatrix:this.projMatrix,Y),I[S]=new Float32Array(Y),I[S]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let h,x,S,I,D=-90,G=90,H=-180,Y=180,J=this.size,re=this._unmodified;if(this.latRange){let Ce=this.latRange;D=n.mercatorYfromLat(Ce[1])*this.worldSize,G=n.mercatorYfromLat(Ce[0])*this.worldSize,h=G-D<J.y?J.y/(G-D):0}if(this.lngRange){let Ce=this.lngRange;H=n.wrap(n.mercatorXfromLng(Ce[0])*this.worldSize,0,this.worldSize),Y=n.wrap(n.mercatorXfromLng(Ce[1])*this.worldSize,0,this.worldSize),Y<H&&(Y+=this.worldSize),x=Y-H<J.x?J.x/(Y-H):0}let ae=this.point,_e=Math.max(x||0,h||0);if(_e)return this.center=this.unproject(new n.Point(x?(Y+H)/2:ae.x,h?(G+D)/2:ae.y)),this.zoom+=this.scaleZoom(_e),this._unmodified=re,void(this._constraining=!1);if(this.latRange){let Ce=ae.y,Ae=J.y/2;Ce-Ae<D&&(I=D+Ae),Ce+Ae>G&&(I=G-Ae)}if(this.lngRange){let Ce=(H+Y)/2,Ae=n.wrap(ae.x,Ce-this.worldSize/2,Ce+this.worldSize/2),Re=J.x/2;Ae-Re<H&&(S=H+Re),Ae+Re>Y&&(S=Y-Re)}S===void 0&&I===void 0||(this.center=this.unproject(new n.Point(S!==void 0?S:ae.x,I!==void 0?I:ae.y)).wrap()),this._unmodified=re,this._constraining=!1}_calcMatrices(){if(!this.height)return;let h=this.centerOffset,x=this.point.x,S=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=n.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let I=n.identity(new Float64Array(16));n.scale(I,I,[this.width/2,-this.height/2,1]),n.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=n.identity(new Float64Array(16)),n.scale(I,I,[1,-1,1]),n.translate(I,I,[-1,-1,0]),n.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I;let D=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),G=Math.min(this.elevation,this._minEleveationForCurrentTile),H=D-G*this._pixelPerMeter/Math.cos(this._pitch),Y=G<0?H:D,J=Math.PI/2+this._pitch,re=this._fov*(.5+h.y/this.height),ae=Math.sin(re)*Y/Math.sin(n.clamp(Math.PI-J-re,.01,Math.PI-.01)),_e=this.getHorizon(),Ce=2*Math.atan(_e/this.cameraToCenterDistance)*(.5+h.y/(2*_e)),Ae=Math.sin(Ce)*Y/Math.sin(n.clamp(Math.PI-J-Ce,.01,Math.PI-.01)),Re=Math.min(ae,Ae),Te=1.01*(Math.cos(Math.PI/2-this._pitch)*Re+Y),Ve=this.height/50;I=new Float64Array(16),n.perspective(I,this._fov,this.width/this.height,Ve,Te),I[8]=2*-h.x/this.width,I[9]=2*h.y/this.height,n.scale(I,I,[1,-1,1]),n.translate(I,I,[0,0,-this.cameraToCenterDistance]),n.rotateX(I,I,this._pitch),n.rotateZ(I,I,this.angle),n.translate(I,I,[-x,-S,0]),this.mercatorMatrix=n.scale([],I,[this.worldSize,this.worldSize,this.worldSize]),n.scale(I,I,[1,1,this._pixelPerMeter]),this.pixelMatrix=n.multiply(new Float64Array(16),this.labelPlaneMatrix,I),n.translate(I,I,[0,0,-this.elevation]),this.projMatrix=I,this.invProjMatrix=n.invert([],I),this.pixelMatrix3D=n.multiply(new Float64Array(16),this.labelPlaneMatrix,I);let tt=this.width%2/2,Ne=this.height%2/2,Xe=Math.cos(this.angle),rt=Math.sin(this.angle),st=x-Math.round(x)+Xe*tt+rt*Ne,ft=S-Math.round(S)+Xe*Ne+rt*tt,Tt=new Float64Array(I);if(n.translate(Tt,Tt,[st>.5?st-1:st,ft>.5?ft-1:ft,0]),this.alignedProjMatrix=Tt,I=n.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");this.pixelMatrixInverse=I,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;let h=this.pointCoordinate(new n.Point(0,0)),x=[h.x*this.worldSize,h.y*this.worldSize,0,1];return n.transformMat4(x,x,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){let h=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.Point(0,h))}getCameraQueryGeometry(h){let x=this.getCameraPoint();if(h.length===1)return[h[0],x];{let S=x.x,I=x.y,D=x.x,G=x.y;for(let H of h)S=Math.min(S,H.x),I=Math.min(I,H.y),D=Math.max(D,H.x),G=Math.max(G,H.y);return[new n.Point(S,I),new n.Point(D,I),new n.Point(D,G),new n.Point(S,G),new n.Point(S,I)]}}}function _c(P,h){let x,S=!1,I=null,D=null,G=()=>{I=null,S&&(P.apply(D,x),I=setTimeout(G,h),S=!1)};return(...H)=>(S=!0,D=this,x=H,I||G(),I)}class N7{constructor(h){this._getCurrentHash=()=>{let x=window.location.hash.replace("#","");if(this._hashName){let S;return x.split("&").map(I=>I.split("=")).forEach(I=>{I[0]===this._hashName&&(S=I)}),(S&&S[1]||"").split("/")}return x.split("/")},this._onHashChange=()=>{let x=this._getCurrentHash();if(x.length>=3&&!x.some(S=>isNaN(S))){let S=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(x[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+x[2],+x[1]],zoom:+x[0],bearing:S,pitch:+(x[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{let x=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,x)}catch{}},this._updateHash=_c(this._updateHashUnthrottled,300),this._hashName=h&&encodeURIComponent(h)}addTo(h){return this._map=h,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(h){let x=this._map.getCenter(),S=Math.round(100*this._map.getZoom())/100,I=Math.ceil((S*Math.LN2+Math.log(512/360/.5))/Math.LN10),D=Math.pow(10,I),G=Math.round(x.lng*D)/D,H=Math.round(x.lat*D)/D,Y=this._map.getBearing(),J=this._map.getPitch(),re="";if(re+=h?`/${G}/${H}/${S}`:`${S}/${H}/${G}`,(Y||J)&&(re+="/"+Math.round(10*Y)/10),J&&(re+=`/${Math.round(J)}`),this._hashName){let ae=this._hashName,_e=!1,Ce=window.location.hash.slice(1).split("&").map(Ae=>{let Re=Ae.split("=")[0];return Re===ae?(_e=!0,`${Re}=${re}`):Ae}).filter(Ae=>Ae);return _e||Ce.push(`${ae}=${re}`),`#${Ce.join("&")}`}return`#${re}`}}let Dh={linearity:.3,easing:n.bezier(0,0,.3,1)},O7=n.extend({deceleration:2500,maxSpeed:1400},Dh),B7=n.extend({deceleration:20,maxSpeed:1400},Dh),U7=n.extend({deceleration:1e3,maxSpeed:360},Dh),z7=n.extend({deceleration:1e3,maxSpeed:90},Dh);class Fh{constructor(h){this._map=h,this.clear()}clear(){this._inertiaBuffer=[]}record(h){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.browser.now(),settings:h})}_drainInertiaBuffer(){let h=this._inertiaBuffer,x=n.browser.now();for(;h.length>0&&x-h[0].time>160;)h.shift()}_onMoveEnd(h){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let x={zoom:0,bearing:0,pitch:0,pan:new n.Point(0,0),pinchAround:void 0,around:void 0};for(let{settings:D}of this._inertiaBuffer)x.zoom+=D.zoomDelta||0,x.bearing+=D.bearingDelta||0,x.pitch+=D.pitchDelta||0,D.panDelta&&x.pan._add(D.panDelta),D.around&&(x.around=D.around),D.pinchAround&&(x.pinchAround=D.pinchAround);let S=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,I={};if(x.pan.mag()){let D=Ao(x.pan.mag(),S,n.extend({},O7,h||{}));I.offset=x.pan.mult(D.amount/x.pan.mag()),I.center=this._map.transform.center,Lh(I,D)}if(x.zoom){let D=Ao(x.zoom,S,B7);I.zoom=this._map.transform.zoom+D.amount,Lh(I,D)}if(x.bearing){let D=Ao(x.bearing,S,U7);I.bearing=this._map.transform.bearing+n.clamp(D.amount,-179,179),Lh(I,D)}if(x.pitch){let D=Ao(x.pitch,S,z7);I.pitch=this._map.transform.pitch+D.amount,Lh(I,D)}if(I.zoom||I.bearing){let D=x.pinchAround===void 0?x.around:x.pinchAround;I.around=D?this._map.unproject(D):this._map.getCenter()}return this.clear(),n.extend(I,{noMoveStart:!0})}}function Lh(P,h){(!P.duration||P.duration<h.duration)&&(P.duration=h.duration,P.easing=h.easing)}function Ao(P,h,x){let{maxSpeed:S,linearity:I,deceleration:D}=x,G=n.clamp(P*I/(h/1e3),-S,S),H=Math.abs(G)/(D*I);return{easing:x.easing,duration:1e3*H,amount:G*(H/2)}}class Vs extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,x,S,I={}){let D=a.mousePos(x.getCanvasContainer(),S),G=x.unproject(D);super(h,n.extend({point:D,lngLat:G,originalEvent:S},I)),this._defaultPrevented=!1,this.target=x}}class Nh extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,x,S){let I=h==="touchend"?S.changedTouches:S.touches,D=a.touchPos(x.getCanvasContainer(),I),G=D.map(Y=>x.unproject(Y)),H=D.reduce((Y,J,re,ae)=>Y.add(J.div(ae.length)),new n.Point(0,0));super(h,{points:D,point:H,lngLats:G,lngLat:x.unproject(H),originalEvent:S}),this._defaultPrevented=!1}}class Ol extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,x,S){super(h,{originalEvent:S}),this._defaultPrevented=!1}}class Oh{constructor(h,x){this._map=h,this._clickTolerance=x.clickTolerance}reset(){delete this._mousedownPos}wheel(h){return this._firePreventable(new Ol(h.type,this._map,h))}mousedown(h,x){return this._mousedownPos=x,this._firePreventable(new Vs(h.type,this._map,h))}mouseup(h){this._map.fire(new Vs(h.type,this._map,h))}click(h,x){this._mousedownPos&&this._mousedownPos.dist(x)>=this._clickTolerance||this._map.fire(new Vs(h.type,this._map,h))}dblclick(h){return this._firePreventable(new Vs(h.type,this._map,h))}mouseover(h){this._map.fire(new Vs(h.type,this._map,h))}mouseout(h){this._map.fire(new Vs(h.type,this._map,h))}touchstart(h){return this._firePreventable(new Nh(h.type,this._map,h))}touchmove(h){this._map.fire(new Nh(h.type,this._map,h))}touchend(h){this._map.fire(new Nh(h.type,this._map,h))}touchcancel(h){this._map.fire(new Nh(h.type,this._map,h))}_firePreventable(h){if(this._map.fire(h),h.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dv{constructor(h){this._map=h}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(h){this._map.fire(new Vs(h.type,this._map,h))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Vs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(h){this._delayContextMenu?this._contextMenuEvent=h:this._ignoreContextMenu||this._map.fire(new Vs(h.type,this._map,h)),this._map.listens("contextmenu")&&h.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bh{constructor(h){this._map=h}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(h){return this.transform.pointLocation(n.Point.convert(h),this._map.terrain)}}class fv{constructor(h,x){this._map=h,this._tr=new Bh(h),this._el=h.getCanvasContainer(),this._container=h.getContainer(),this._clickTolerance=x.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(h,x){this.isEnabled()&&h.shiftKey&&h.button===0&&(a.disableDrag(),this._startPos=this._lastPos=x,this._active=!0)}mousemoveWindow(h,x){if(!this._active)return;let S=x;if(this._lastPos.equals(S)||!this._box&&S.dist(this._startPos)<this._clickTolerance)return;let I=this._startPos;this._lastPos=S,this._box||(this._box=a.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",h));let D=Math.min(I.x,S.x),G=Math.max(I.x,S.x),H=Math.min(I.y,S.y),Y=Math.max(I.y,S.y);a.setTransform(this._box,`translate(${D}px,${H}px)`),this._box.style.width=G-D+"px",this._box.style.height=Y-H+"px"}mouseupWindow(h,x){if(!this._active||h.button!==0)return;let S=this._startPos,I=x;if(this.reset(),a.suppressClick(),S.x!==I.x||S.y!==I.y)return this._map.fire(new n.Event("boxzoomend",{originalEvent:h})),{cameraAnimation:D=>D.fitScreenCoordinates(S,I,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",h)}keydown(h){this._active&&h.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",h))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(a.remove(this._box),this._box=null),a.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(h,x){return this._map.fire(new n.Event(h,{originalEvent:x}))}}function j0(P,h){if(P.length!==h.length)throw new Error(`The number of touches and points are not equal - touches ${P.length}, points ${h.length}`);let x={};for(let S=0;S<P.length;S++)x[P[S].identifier]=h[S];return x}class Uh{constructor(h){this.reset(),this.numTouches=h.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(h,x,S){(this.centroid||S.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=h.timeStamp),S.length===this.numTouches&&(this.centroid=function(I){let D=new n.Point(0,0);for(let G of I)D._add(G);return D.div(I.length)}(x),this.touches=j0(S,x)))}touchmove(h,x,S){if(this.aborted||!this.centroid)return;let I=j0(S,x);for(let D in this.touches){let G=I[D];(!G||G.dist(this.touches[D])>30)&&(this.aborted=!0)}}touchend(h,x,S){if((!this.centroid||h.timeStamp-this.startTime>500)&&(this.aborted=!0),S.length===0){let I=!this.aborted&&this.centroid;if(this.reset(),I)return I}}}class al{constructor(h){this.singleTap=new Uh(h),this.numTaps=h.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(h,x,S){this.singleTap.touchstart(h,x,S)}touchmove(h,x,S){this.singleTap.touchmove(h,x,S)}touchend(h,x,S){let I=this.singleTap.touchend(h,x,S);if(I){let D=h.timeStamp-this.lastTime<500,G=!this.lastTap||this.lastTap.dist(I)<30;if(D&&G||this.reset(),this.count++,this.lastTime=h.timeStamp,this.lastTap=I,this.count===this.numTaps)return this.reset(),I}}}class Zt{constructor(h){this._tr=new Bh(h),this._zoomIn=new al({numTouches:1,numTaps:2}),this._zoomOut=new al({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(h,x,S){this._zoomIn.touchstart(h,x,S),this._zoomOut.touchstart(h,x,S)}touchmove(h,x,S){this._zoomIn.touchmove(h,x,S),this._zoomOut.touchmove(h,x,S)}touchend(h,x,S){let I=this._zoomIn.touchend(h,x,S),D=this._zoomOut.touchend(h,x,S),G=this._tr;return I?(this._active=!0,h.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:H=>H.easeTo({duration:300,zoom:G.zoom+1,around:G.unproject(I)},{originalEvent:h})}):D?(this._active=!0,h.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:H=>H.easeTo({duration:300,zoom:G.zoom-1,around:G.unproject(D)},{originalEvent:h})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class f1{constructor(h){this._enabled=!!h.enable,this._moveStateManager=h.moveStateManager,this._clickTolerance=h.clickTolerance||1,this._moveFunction=h.move,this._activateOnStart=!!h.activateOnStart,h.assignEvents(this),this.reset()}reset(h){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(h)}_move(...h){let x=this._moveFunction(...h);if(x.bearingDelta||x.pitchDelta||x.around||x.panDelta)return this._active=!0,x}dragStart(h,x){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(h)&&(this._moveStateManager.startMove(h),this._lastPoint=x.length?x[0]:x,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(h,x){if(!this.isEnabled())return;let S=this._lastPoint;if(!S)return;if(h.preventDefault(),!this._moveStateManager.isValidMoveEvent(h))return void this.reset(h);let I=x.length?x[0]:x;return!this._moved&&I.dist(S)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=I,this._move(S,I))}dragEnd(h){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(h)&&(this._moved&&a.suppressClick(),this.reset(h))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let zh={0:1,2:2};class au{constructor(h){this._correctEvent=h.checkCorrectEvent}startMove(h){let x=a.mouseButton(h);this._eventButton=x}endMove(h){delete this._eventButton}isValidStartEvent(h){return this._correctEvent(h)}isValidMoveEvent(h){return!function(x,S){let I=zh[S];return x.buttons===void 0||(x.buttons&I)!==I}(h,this._eventButton)}isValidEndEvent(h){return a.mouseButton(h)===this._eventButton}}class Pp{constructor(){this._firstTouch=void 0}_isOneFingerTouch(h){return h.targetTouches.length===1}_isSameTouchEvent(h){return h.targetTouches[0].identifier===this._firstTouch}startMove(h){this._firstTouch=h.targetTouches[0].identifier}endMove(h){delete this._firstTouch}isValidStartEvent(h){return this._isOneFingerTouch(h)}isValidMoveEvent(h){return this._isOneFingerTouch(h)&&this._isSameTouchEvent(h)}isValidEndEvent(h){return this._isOneFingerTouch(h)&&this._isSameTouchEvent(h)}}let Vt=P=>{P.mousedown=P.dragStart,P.mousemoveWindow=P.dragMove,P.mouseup=P.dragEnd,P.contextmenu=function(h){h.preventDefault()}},X0=({enable:P,clickTolerance:h,bearingDegreesPerPixelMoved:x=.8})=>{let S=new au({checkCorrectEvent:I=>a.mouseButton(I)===0&&I.ctrlKey||a.mouseButton(I)===2});return new f1({clickTolerance:h,move:(I,D)=>({bearingDelta:(D.x-I.x)*x}),moveStateManager:S,enable:P,assignEvents:Vt})},G7=({enable:P,clickTolerance:h,pitchDegreesPerPixelMoved:x=-.5})=>{let S=new au({checkCorrectEvent:I=>a.mouseButton(I)===0&&I.ctrlKey||a.mouseButton(I)===2});return new f1({clickTolerance:h,move:(I,D)=>({pitchDelta:(D.y-I.y)*x}),moveStateManager:S,enable:P,assignEvents:Vt})};class pv{constructor(h,x){this._minTouches=h.cooperativeGestures?2:1,this._clickTolerance=h.clickTolerance||1,this._map=x,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new n.Point(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(h,x,S){return this._calculateTransform(h,x,S)}touchmove(h,x,S){if(this._map._cooperativeGestures&&(this._minTouches===2&&S.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(h,!1,S.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(S.length<this._minTouches))return h.preventDefault(),this._calculateTransform(h,x,S)}touchend(h,x,S){this._calculateTransform(h,x,S),this._active&&S.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(h,x,S){S.length>0&&(this._active=!0);let I=j0(S,x),D=new n.Point(0,0),G=new n.Point(0,0),H=0;for(let J in I){let re=I[J],ae=this._touches[J];ae&&(D._add(re),G._add(re.sub(ae)),H++,I[J]=re)}if(this._touches=I,H<this._minTouches||!G.mag())return;let Y=G.div(H);return this._sum._add(Y),this._sum.mag()<this._clickTolerance?void 0:{around:D.div(H),panDelta:Y}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(h,x,S){this._firstTwoTouches||S.length<2||(this._firstTwoTouches=[S[0].identifier,S[1].identifier],this._start([x[0],x[1]]))}touchmove(h,x,S){if(!this._firstTwoTouches)return;h.preventDefault();let[I,D]=this._firstTwoTouches,G=$h(S,x,I),H=$h(S,x,D);if(!G||!H)return;let Y=this._aroundCenter?null:G.add(H).div(2);return this._move([G,H],Y,h)}touchend(h,x,S){if(!this._firstTwoTouches)return;let[I,D]=this._firstTwoTouches,G=$h(S,x,I),H=$h(S,x,D);G&&H||(this._active&&a.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(h){this._enabled=!0,this._aroundCenter=!!h&&h.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function $h(P,h,x){for(let S=0;S<P.length;S++)if(P[S].identifier===x)return h[S]}function Rp(P,h){return Math.log(P/h)/Math.LN2}class mv extends Gh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(h){this._startDistance=this._distance=h[0].dist(h[1])}_move(h,x){let S=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(Rp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Rp(this._distance,S),pinchAround:x}}}function $7(P,h){return 180*P.angleWith(h)/Math.PI}class Dp extends Gh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])}_move(h,x){let S=this._vector;if(this._vector=h[0].sub(h[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:$7(this._vector,S),pinchAround:x}}_isBelowThreshold(h){this._minDiameter=Math.min(this._minDiameter,h.mag());let x=25/(Math.PI*this._minDiameter)*360,S=$7(h,this._startVector);return Math.abs(S)<x}}function Hh(P){return Math.abs(P.y)>Math.abs(P.x)}class Fp extends Gh{constructor(h){super(),this._map=h}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(h,x,S){super.touchstart(h,x,S),this._currentTouchCount=S.length}_start(h){this._lastPoints=h,Hh(h[0].sub(h[1]))&&(this._valid=!1)}_move(h,x,S){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;let I=h[0].sub(this._lastPoints[0]),D=h[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(I,D,S.timeStamp),this._valid?(this._lastPoints=h,this._active=!0,{pitchDelta:(I.y+D.y)/2*-.5}):void 0}gestureBeginsVertically(h,x,S){if(this._valid!==void 0)return this._valid;let I=h.mag()>=2,D=x.mag()>=2;if(!I&&!D)return;if(!I||!D)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;let G=h.y>0==x.y>0;return Hh(h)&&Hh(x)&&G}}let Lp={panStep:100,bearingStep:15,pitchStep:10};class no{constructor(h){this._tr=new Bh(h);let x=Lp;this._panStep=x.panStep,this._bearingStep=x.bearingStep,this._pitchStep=x.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(h){if(h.altKey||h.ctrlKey||h.metaKey)return;let x=0,S=0,I=0,D=0,G=0;switch(h.keyCode){case 61:case 107:case 171:case 187:x=1;break;case 189:case 109:case 173:x=-1;break;case 37:h.shiftKey?S=-1:(h.preventDefault(),D=-1);break;case 39:h.shiftKey?S=1:(h.preventDefault(),D=1);break;case 38:h.shiftKey?I=1:(h.preventDefault(),G=-1);break;case 40:h.shiftKey?I=-1:(h.preventDefault(),G=1);break;default:return}return this._rotationDisabled&&(S=0,I=0),{cameraAnimation:H=>{let Y=this._tr;H.easeTo({duration:300,easeId:"keyboardHandler",easing:xc,zoom:x?Math.round(Y.zoom)+x*(h.shiftKey?2:1):Y.zoom,bearing:Y.bearing+S*this._bearingStep,pitch:Y.pitch+I*this._pitchStep,offset:[-D*this._panStep,-G*this._panStep],center:Y.center},{originalEvent:h})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function xc(P){return P*(2-P)}let Np=4.000244140625;class Op{constructor(h,x){this._onTimeout=S=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(S)},this._map=h,this._tr=new Bh(h),this._el=h.getCanvasContainer(),this._triggerRenderFrame=x,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(h){this._defaultZoomRate=h}setWheelZoomRate(h){this._wheelZoomRate=h}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(h){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!h&&h.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(h){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!h[this._map._metaKey])return;h.preventDefault()}let x=h.deltaMode===WheelEvent.DOM_DELTA_LINE?40*h.deltaY:h.deltaY,S=n.browser.now(),I=S-(this._lastWheelEventTime||0);this._lastWheelEventTime=S,x!==0&&x%Np==0?this._type="wheel":x!==0&&Math.abs(x)<4?this._type="trackpad":I>400?(this._type=null,this._lastValue=x,this._timeout=setTimeout(this._onTimeout,40,h)):this._type||(this._type=Math.abs(I*x)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,x+=this._lastValue)),h.shiftKey&&x&&(x/=4),this._type&&(this._lastWheelEvent=h,this._delta-=x,this._active||this._start(h)),h.preventDefault()}_start(h){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let x=a.mousePos(this._el,h),S=this._tr;this._around=n.LngLat.convert(this._aroundCenter?S.center:S.unproject(x)),this._aroundPoint=S.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let h=this._tr.transform;if(this._delta!==0){let H=this._type==="wheel"&&Math.abs(this._delta)>Np?this._wheelZoomRate:this._defaultZoomRate,Y=2/(1+Math.exp(-Math.abs(this._delta*H)));this._delta<0&&Y!==0&&(Y=1/Y);let J=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):h.scale;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(J*Y))),this._type==="wheel"&&(this._startZoom=h.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let x=typeof this._targetZoom=="number"?this._targetZoom:h.zoom,S=this._startZoom,I=this._easing,D,G=!1;if(this._type==="wheel"&&S&&I){let H=Math.min((n.browser.now()-this._lastWheelEventTime)/200,1),Y=I(H);D=n.interpolate.number(S,x,Y),H<1?this._frameId||(this._frameId=!0):G=!0}else D=x,G=!0;return this._active=!0,G&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!G,zoomDelta:D-h.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(h){let x=n.defaultEasing;if(this._prevEase){let S=this._prevEase,I=(n.browser.now()-S.start)/S.duration,D=S.easing(I+.01)-S.easing(I),G=.27/Math.sqrt(D*D+1e-4)*.01,H=Math.sqrt(.0729-G*G);x=n.bezier(G,H,.25,1)}return this._prevEase={start:n.browser.now(),duration:h,easing:x},x}reset(){this._active=!1}}class Bp{constructor(h,x){this._clickZoom=h,this._tapZoom=x}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Up{constructor(h){this._tr=new Bh(h),this.reset()}reset(){this._active=!1}dblclick(h,x){return h.preventDefault(),{cameraAnimation:S=>{S.easeTo({duration:300,zoom:this._tr.zoom+(h.shiftKey?-1:1),around:this._tr.unproject(x)},{originalEvent:h})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class H7{constructor(){this._tap=new al({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(h,x,S){if(!this._swipePoint)if(this._tapTime){let I=x[0],D=h.timeStamp-this._tapTime<500,G=this._tapPoint.dist(I)<30;D&&G?S.length>0&&(this._swipePoint=I,this._swipeTouch=S[0].identifier):this.reset()}else this._tap.touchstart(h,x,S)}touchmove(h,x,S){if(this._tapTime){if(this._swipePoint){if(S[0].identifier!==this._swipeTouch)return;let I=x[0],D=I.y-this._swipePoint.y;return this._swipePoint=I,h.preventDefault(),this._active=!0,{zoomDelta:D/128}}}else this._tap.touchmove(h,x,S)}touchend(h,x,S){if(this._tapTime)this._swipePoint&&S.length===0&&this.reset();else{let I=this._tap.touchend(h,x,S);I&&(this._tapTime=h.timeStamp,this._tapPoint=I)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class aa{constructor(h,x,S){this._el=h,this._mousePan=x,this._touchPan=S}enable(h){this._inertiaOptions=h||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ts{constructor(h,x,S){this._pitchWithRotate=h.pitchWithRotate,this._mouseRotate=x,this._mousePitch=S}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class W0{constructor(h,x,S,I){this._el=h,this._touchZoom=x,this._touchRotate=S,this._tapDragZoom=I,this._rotationDisabled=!1,this._enabled=!0}enable(h){this._touchZoom.enable(h),this._rotationDisabled||this._touchRotate.enable(h),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let p1=P=>P.zoom||P.drag||P.pitch||P.rotate;class V7 extends n.Event{}function q0(P){return P.panDelta&&P.panDelta.mag()||P.zoomDelta||P.bearingDelta||P.pitchDelta}class j7{constructor(h,x){this.handleWindowEvent=I=>{this.handleEvent(I,`${I.type}Window`)},this.handleEvent=(I,D)=>{if(I.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let G=I.type==="renderFrame"?void 0:I,H={needsRenderFrame:!1},Y={},J={},re=I.touches,ae=re?this._getMapTouches(re):void 0,_e=ae?a.touchPos(this._el,ae):a.mousePos(this._el,I);for(let{handlerName:Re,handler:Te,allowed:Ve}of this._handlers){if(!Te.isEnabled())continue;let tt;this._blockedByActive(J,Ve,Re)?Te.reset():Te[D||I.type]&&(tt=Te[D||I.type](I,_e,ae),this.mergeHandlerResult(H,Y,tt,Re,G),tt&&tt.needsRenderFrame&&this._triggerRenderFrame()),(tt||Te.isActive())&&(J[Re]=Te)}let Ce={};for(let Re in this._previousActiveHandlers)J[Re]||(Ce[Re]=G);this._previousActiveHandlers=J,(Object.keys(Ce).length||q0(H))&&(this._changes.push([H,Y,Ce]),this._triggerRenderFrame()),(Object.keys(J).length||q0(H))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:Ae}=H;Ae&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ae(this._map))},this._map=h,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fh(h),this._bearingSnap=x.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(x);let S=this._el;this._listeners=[[S,"touchstart",{passive:!0}],[S,"touchmove",{passive:!1}],[S,"touchend",void 0],[S,"touchcancel",void 0],[S,"mousedown",void 0],[S,"mousemove",void 0],[S,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[S,"mouseover",void 0],[S,"mouseout",void 0],[S,"dblclick",void 0],[S,"click",void 0],[S,"keydown",{capture:!1}],[S,"keyup",void 0],[S,"wheel",{passive:!1}],[S,"contextmenu",void 0],[window,"blur",void 0]];for(let[I,D,G]of this._listeners)a.addEventListener(I,D,I===document?this.handleWindowEvent:this.handleEvent,G)}destroy(){for(let[h,x,S]of this._listeners)a.removeEventListener(h,x,h===document?this.handleWindowEvent:this.handleEvent,S)}_addDefaultHandlers(h){let x=this._map,S=x.getCanvasContainer();this._add("mapEvent",new Oh(x,h));let I=x.boxZoom=new fv(x,h);this._add("boxZoom",I),h.interactive&&h.boxZoom&&I.enable();let D=new Zt(x),G=new Up(x);x.doubleClickZoom=new Bp(G,D),this._add("tapZoom",D),this._add("clickZoom",G),h.interactive&&h.doubleClickZoom&&x.doubleClickZoom.enable();let H=new H7;this._add("tapDragZoom",H);let Y=x.touchPitch=new Fp(x);this._add("touchPitch",Y),h.interactive&&h.touchPitch&&x.touchPitch.enable(h.touchPitch);let J=X0(h),re=G7(h);x.dragRotate=new ts(h,J,re),this._add("mouseRotate",J,["mousePitch"]),this._add("mousePitch",re,["mouseRotate"]),h.interactive&&h.dragRotate&&x.dragRotate.enable();let ae=(({enable:Ve,clickTolerance:tt})=>{let Ne=new au({checkCorrectEvent:Xe=>a.mouseButton(Xe)===0&&!Xe.ctrlKey});return new f1({clickTolerance:tt,move:(Xe,rt)=>({around:rt,panDelta:rt.sub(Xe)}),activateOnStart:!0,moveStateManager:Ne,enable:Ve,assignEvents:Vt})})(h),_e=new pv(h,x);x.dragPan=new aa(S,ae,_e),this._add("mousePan",ae),this._add("touchPan",_e,["touchZoom","touchRotate"]),h.interactive&&h.dragPan&&x.dragPan.enable(h.dragPan);let Ce=new Dp,Ae=new mv;x.touchZoomRotate=new W0(S,Ae,Ce,H),this._add("touchRotate",Ce,["touchPan","touchZoom"]),this._add("touchZoom",Ae,["touchPan","touchRotate"]),h.interactive&&h.touchZoomRotate&&x.touchZoomRotate.enable(h.touchZoomRotate);let Re=x.scrollZoom=new Op(x,()=>this._triggerRenderFrame());this._add("scrollZoom",Re,["mousePan"]),h.interactive&&h.scrollZoom&&x.scrollZoom.enable(h.scrollZoom);let Te=x.keyboard=new no(x);this._add("keyboard",Te),h.interactive&&h.keyboard&&x.keyboard.enable(),this._add("blockableMapEvent",new dv(x))}_add(h,x,S){this._handlers.push({handlerName:h,handler:x,allowed:S}),this._handlersById[h]=x}stop(h){if(!this._updatingCamera){for(let{handler:x}of this._handlers)x.reset();this._inertia.clear(),this._fireEvents({},{},h),this._changes=[]}}isActive(){for(let{handler:h}of this._handlers)if(h.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!p1(this._eventsInProgress)||this.isZooming()}_blockedByActive(h,x,S){for(let I in h)if(I!==S&&(!x||x.indexOf(I)<0))return!0;return!1}_getMapTouches(h){let x=[];for(let S of h)this._el.contains(S.target)&&x.push(S);return x}mergeHandlerResult(h,x,S,I,D){if(!S)return;n.extend(h,S);let G={handlerName:I,originalEvent:S.originalEvent||D};S.zoomDelta!==void 0&&(x.zoom=G),S.panDelta!==void 0&&(x.drag=G),S.pitchDelta!==void 0&&(x.pitch=G),S.bearingDelta!==void 0&&(x.rotate=G)}_applyChanges(){let h={},x={},S={};for(let[I,D,G]of this._changes)I.panDelta&&(h.panDelta=(h.panDelta||new n.Point(0,0))._add(I.panDelta)),I.zoomDelta&&(h.zoomDelta=(h.zoomDelta||0)+I.zoomDelta),I.bearingDelta&&(h.bearingDelta=(h.bearingDelta||0)+I.bearingDelta),I.pitchDelta&&(h.pitchDelta=(h.pitchDelta||0)+I.pitchDelta),I.around!==void 0&&(h.around=I.around),I.pinchAround!==void 0&&(h.pinchAround=I.pinchAround),I.noInertia&&(h.noInertia=I.noInertia),n.extend(x,D),n.extend(S,G);this._updateMapTransform(h,x,S),this._changes=[]}_updateMapTransform(h,x,S){let I=this._map,D=I._getTransformForUpdate(),G=I.terrain;if(!(q0(h)||G&&this._terrainMovement))return this._fireEvents(x,S,!0);let{panDelta:H,zoomDelta:Y,bearingDelta:J,pitchDelta:re,around:ae,pinchAround:_e}=h;_e!==void 0&&(ae=_e),I._stop(!0),ae=ae||I.transform.centerPoint;let Ce=D.pointLocation(H?ae.sub(H):ae);J&&(D.bearing+=J),re&&(D.pitch+=re),Y&&(D.zoom+=Y),G?this._terrainMovement||!x.drag&&!x.zoom?x.drag&&this._terrainMovement?D.center=D.pointLocation(D.centerPoint.sub(H)):D.setLocationAtPoint(Ce,ae):(this._terrainMovement=!0,this._map._elevationFreeze=!0,D.setLocationAtPoint(Ce,ae),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,D.recalculateZoom(I.terrain)})):D.setLocationAtPoint(Ce,ae),I._applyUpdatedTransform(D),this._map._update(),h.noInertia||this._inertia.record(h),this._fireEvents(x,S,!0)}_fireEvents(h,x,S){let I=p1(this._eventsInProgress),D=p1(h),G={};for(let re in h){let{originalEvent:ae}=h[re];this._eventsInProgress[re]||(G[`${re}start`]=ae),this._eventsInProgress[re]=h[re]}!I&&D&&this._fireEvent("movestart",D.originalEvent);for(let re in G)this._fireEvent(re,G[re]);D&&this._fireEvent("move",D.originalEvent);for(let re in h){let{originalEvent:ae}=h[re];this._fireEvent(re,ae)}let H={},Y;for(let re in this._eventsInProgress){let{handlerName:ae,originalEvent:_e}=this._eventsInProgress[re];this._handlersById[ae].isActive()||(delete this._eventsInProgress[re],Y=x[ae]||_e,H[`${re}end`]=Y)}for(let re in H)this._fireEvent(re,H[re]);let J=p1(this._eventsInProgress);if(S&&(I||D)&&!J){this._updatingCamera=!0;let re=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ae=_e=>_e!==0&&-this._bearingSnap<_e&&_e<this._bearingSnap;re?(ae(re.bearing||this._map.getBearing())&&(re.bearing=0),re.freezeElevation=!0,this._map.easeTo(re,{originalEvent:Y})):(this._map.fire(new n.Event("moveend",{originalEvent:Y})),ae(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(h,x){this._map.fire(new n.Event(h,x?{originalEvent:x}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(h=>{delete this._frameId,this.handleEvent(new V7("renderFrame",{timeStamp:h})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class gv extends n.Evented{constructor(h,x){super(),this._renderFrameCallback=()=>{let S=Math.min((n.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(S)),S<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=x.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new n.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(h,x){return this.jumpTo({center:h},x)}panBy(h,x,S){return h=n.Point.convert(h).mult(-1),this.panTo(this.transform.center,n.extend({offset:h},x),S)}panTo(h,x,S){return this.easeTo(n.extend({center:h},x),S)}getZoom(){return this.transform.zoom}setZoom(h,x){return this.jumpTo({zoom:h},x),this}zoomTo(h,x,S){return this.easeTo(n.extend({zoom:h},x),S)}zoomIn(h,x){return this.zoomTo(this.getZoom()+1,h,x),this}zoomOut(h,x){return this.zoomTo(this.getZoom()-1,h,x),this}getBearing(){return this.transform.bearing}setBearing(h,x){return this.jumpTo({bearing:h},x),this}getPadding(){return this.transform.padding}setPadding(h,x){return this.jumpTo({padding:h},x),this}rotateTo(h,x,S){return this.easeTo(n.extend({bearing:h},x),S)}resetNorth(h,x){return this.rotateTo(0,n.extend({duration:1e3},h),x),this}resetNorthPitch(h,x){return this.easeTo(n.extend({bearing:0,pitch:0,duration:1e3},h),x),this}snapToNorth(h,x){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,x):this}getPitch(){return this.transform.pitch}setPitch(h,x){return this.jumpTo({pitch:h},x),this}cameraForBounds(h,x){h=ne.convert(h);let S=x&&x.bearing||0;return this._cameraForBoxAndBearing(h.getNorthWest(),h.getSouthEast(),S,x)}_cameraForBoxAndBearing(h,x,S,I){let D={top:0,bottom:0,right:0,left:0};if(typeof(I=n.extend({padding:D,offset:[0,0],maxZoom:this.transform.maxZoom},I)).padding=="number"){let rt=I.padding;I.padding={top:rt,bottom:rt,right:rt,left:rt}}I.padding=n.extend(D,I.padding);let G=this.transform,H=G.padding,Y=G.project(n.LngLat.convert(h)),J=G.project(n.LngLat.convert(x)),re=Y.rotate(-S*Math.PI/180),ae=J.rotate(-S*Math.PI/180),_e=new n.Point(Math.max(re.x,ae.x),Math.max(re.y,ae.y)),Ce=new n.Point(Math.min(re.x,ae.x),Math.min(re.y,ae.y)),Ae=_e.sub(Ce),Re=(G.width-(H.left+H.right+I.padding.left+I.padding.right))/Ae.x,Te=(G.height-(H.top+H.bottom+I.padding.top+I.padding.bottom))/Ae.y;if(Te<0||Re<0)return void n.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let Ve=Math.min(G.scaleZoom(G.scale*Math.min(Re,Te)),I.maxZoom),tt=n.Point.convert(I.offset),Ne=new n.Point((I.padding.left-I.padding.right)/2,(I.padding.top-I.padding.bottom)/2).rotate(S*Math.PI/180),Xe=tt.add(Ne).mult(G.scale/G.zoomScale(Ve));return{center:G.unproject(Y.add(J).div(2).sub(Xe)),zoom:Ve,bearing:S}}fitBounds(h,x,S){return this._fitInternal(this.cameraForBounds(h,x),x,S)}fitScreenCoordinates(h,x,S,I,D){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(n.Point.convert(h)),this.transform.pointLocation(n.Point.convert(x)),S,I),I,D)}_fitInternal(h,x,S){return h?(delete(x=n.extend(h,x)).padding,x.linear?this.easeTo(x,S):this.flyTo(x,S)):this}jumpTo(h,x){this.stop();let S=this._getTransformForUpdate(),I=!1,D=!1,G=!1;return"zoom"in h&&S.zoom!==+h.zoom&&(I=!0,S.zoom=+h.zoom),h.center!==void 0&&(S.center=n.LngLat.convert(h.center)),"bearing"in h&&S.bearing!==+h.bearing&&(D=!0,S.bearing=+h.bearing),"pitch"in h&&S.pitch!==+h.pitch&&(G=!0,S.pitch=+h.pitch),h.padding==null||S.isPaddingEqual(h.padding)||(S.padding=h.padding),this._applyUpdatedTransform(S),this.fire(new n.Event("movestart",x)).fire(new n.Event("move",x)),I&&this.fire(new n.Event("zoomstart",x)).fire(new n.Event("zoom",x)).fire(new n.Event("zoomend",x)),D&&this.fire(new n.Event("rotatestart",x)).fire(new n.Event("rotate",x)).fire(new n.Event("rotateend",x)),G&&this.fire(new n.Event("pitchstart",x)).fire(new n.Event("pitch",x)).fire(new n.Event("pitchend",x)),this.fire(new n.Event("moveend",x))}calculateCameraOptionsFromTo(h,x,S,I=0){let D=n.MercatorCoordinate.fromLngLat(h,x),G=n.MercatorCoordinate.fromLngLat(S,I),H=G.x-D.x,Y=G.y-D.y,J=G.z-D.z,re=Math.hypot(H,Y,J);if(re===0)throw new Error("Can't calculate camera options with same From and To");let ae=Math.hypot(H,Y),_e=this.transform.scaleZoom(this.transform.cameraToCenterDistance/re/this.transform.tileSize),Ce=180*Math.atan2(H,-Y)/Math.PI,Ae=180*Math.acos(ae/re)/Math.PI;return Ae=J<0?90-Ae:90+Ae,{center:G.toLngLat(),zoom:_e,pitch:Ae,bearing:Ce}}easeTo(h,x){this._stop(!1,h.easeId),((h=n.extend({offset:[0,0],duration:500,easing:n.defaultEasing},h)).animate===!1||!h.essential&&n.browser.prefersReducedMotion)&&(h.duration=0);let S=this._getTransformForUpdate(),I=this.getZoom(),D=this.getBearing(),G=this.getPitch(),H=this.getPadding(),Y="zoom"in h?+h.zoom:I,J="bearing"in h?this._normalizeBearing(h.bearing,D):D,re="pitch"in h?+h.pitch:G,ae="padding"in h?h.padding:S.padding,_e=n.Point.convert(h.offset),Ce=S.centerPoint.add(_e),Ae=S.pointLocation(Ce),Re=n.LngLat.convert(h.center||Ae);this._normalizeCenter(Re);let Te=S.project(Ae),Ve=S.project(Re).sub(Te),tt=S.zoomScale(Y-I),Ne,Xe;h.around&&(Ne=n.LngLat.convert(h.around),Xe=S.locationPoint(Ne));let rt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Y!==I,this._rotating=this._rotating||D!==J,this._pitching=this._pitching||re!==G,this._padding=!S.isPaddingEqual(ae),this._easeId=h.easeId,this._prepareEase(x,h.noMoveStart,rt),this.terrain&&this._prepareElevation(Re),this._ease(st=>{if(this._zooming&&(S.zoom=n.interpolate.number(I,Y,st)),this._rotating&&(S.bearing=n.interpolate.number(D,J,st)),this._pitching&&(S.pitch=n.interpolate.number(G,re,st)),this._padding&&(S.interpolatePadding(H,ae,st),Ce=S.centerPoint.add(_e)),this.terrain&&!h.freezeElevation&&this._updateElevation(st),Ne)S.setLocationAtPoint(Ne,Xe);else{let ft=S.zoomScale(S.zoom-I),Tt=Y>I?Math.min(2,tt):Math.max(.5,tt),Et=Math.pow(Tt,1-st),kt=S.unproject(Te.add(Ve.mult(st*Et)).mult(ft));S.setLocationAtPoint(S.renderWorldCopies?kt.wrap():kt,Ce)}this._applyUpdatedTransform(S),this._fireMoveEvents(x)},st=>{this.terrain&&this._finalizeElevation(),this._afterEase(x,st)},h),this}_prepareEase(h,x,S={}){this._moving=!0,x||S.moving||this.fire(new n.Event("movestart",h)),this._zooming&&!S.zooming&&this.fire(new n.Event("zoomstart",h)),this._rotating&&!S.rotating&&this.fire(new n.Event("rotatestart",h)),this._pitching&&!S.pitching&&this.fire(new n.Event("pitchstart",h))}_prepareElevation(h){this._elevationCenter=h,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(h){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);let x=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(h<1&&x!==this._elevationTarget){let S=this._elevationTarget-this._elevationStart;this._elevationStart+=h*(S-(x-(S*h+this._elevationStart))/(1-h)),this._elevationTarget=x}this.transform.elevation=n.interpolate.number(this._elevationStart,this._elevationTarget,h)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(h){if(!this.transformCameraUpdate)return;let x=h.clone(),{center:S,zoom:I,pitch:D,bearing:G,elevation:H}=this.transformCameraUpdate(x);S&&(x.center=S),I!==void 0&&(x.zoom=I),D!==void 0&&(x.pitch=D),G!==void 0&&(x.bearing=G),H!==void 0&&(x.elevation=H),this.transform.apply(x)}_fireMoveEvents(h){this.fire(new n.Event("move",h)),this._zooming&&this.fire(new n.Event("zoom",h)),this._rotating&&this.fire(new n.Event("rotate",h)),this._pitching&&this.fire(new n.Event("pitch",h))}_afterEase(h,x){if(this._easeId&&x&&this._easeId===x)return;delete this._easeId;let S=this._zooming,I=this._rotating,D=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new n.Event("zoomend",h)),I&&this.fire(new n.Event("rotateend",h)),D&&this.fire(new n.Event("pitchend",h)),this.fire(new n.Event("moveend",h))}flyTo(h,x){if(!h.essential&&n.browser.prefersReducedMotion){let ii=n.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ii,x)}this.stop(),h=n.extend({offset:[0,0],speed:1.2,curve:1.42,easing:n.defaultEasing},h);let S=this._getTransformForUpdate(),I=this.getZoom(),D=this.getBearing(),G=this.getPitch(),H=this.getPadding(),Y="zoom"in h?n.clamp(+h.zoom,S.minZoom,S.maxZoom):I,J="bearing"in h?this._normalizeBearing(h.bearing,D):D,re="pitch"in h?+h.pitch:G,ae="padding"in h?h.padding:S.padding,_e=S.zoomScale(Y-I),Ce=n.Point.convert(h.offset),Ae=S.centerPoint.add(Ce),Re=S.pointLocation(Ae),Te=n.LngLat.convert(h.center||Re);this._normalizeCenter(Te);let Ve=S.project(Re),tt=S.project(Te).sub(Ve),Ne=h.curve,Xe=Math.max(S.width,S.height),rt=Xe/_e,st=tt.mag();if("minZoom"in h){let ii=n.clamp(Math.min(h.minZoom,I,Y),S.minZoom,S.maxZoom),is=Xe/S.zoomScale(ii-I);Ne=Math.sqrt(is/st*2)}let ft=Ne*Ne;function Tt(ii){let is=(rt*rt-Xe*Xe+(ii?-1:1)*ft*ft*st*st)/(2*(ii?rt:Xe)*ft*st);return Math.log(Math.sqrt(is*is+1)-is)}function Et(ii){return(Math.exp(ii)-Math.exp(-ii))/2}function kt(ii){return(Math.exp(ii)+Math.exp(-ii))/2}let oi=Tt(!1),or=function(ii){return kt(oi)/kt(oi+Ne*ii)},Ut=function(ii){return Xe*((kt(oi)*(Et(is=oi+Ne*ii)/kt(is))-Et(oi))/ft)/st;var is},yi=(Tt(!0)-oi)/Ne;if(Math.abs(st)<1e-6||!isFinite(yi)){if(Math.abs(Xe-rt)<1e-6)return this.easeTo(h,x);let ii=rt<Xe?-1:1;yi=Math.abs(Math.log(rt/Xe))/Ne,Ut=function(){return 0},or=function(is){return Math.exp(ii*Ne*is)}}return h.duration="duration"in h?+h.duration:1e3*yi/("screenSpeed"in h?+h.screenSpeed/Ne:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0),this._zooming=!0,this._rotating=D!==J,this._pitching=re!==G,this._padding=!S.isPaddingEqual(ae),this._prepareEase(x,!1),this.terrain&&this._prepareElevation(Te),this._ease(ii=>{let is=ii*yi,ar=1/or(is);S.zoom=ii===1?Y:I+S.scaleZoom(ar),this._rotating&&(S.bearing=n.interpolate.number(D,J,ii)),this._pitching&&(S.pitch=n.interpolate.number(G,re,ii)),this._padding&&(S.interpolatePadding(H,ae,ii),Ae=S.centerPoint.add(Ce)),this.terrain&&!h.freezeElevation&&this._updateElevation(ii);let _i=ii===1?Te:S.unproject(Ve.add(tt.mult(Ut(is))).mult(ar));S.setLocationAtPoint(S.renderWorldCopies?_i.wrap():_i,Ae),this._applyUpdatedTransform(S),this._fireMoveEvents(x)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(x)},h),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(h,x){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,x)}if(!h){let S=this.handlers;S&&S.stop(!1)}return this}_ease(h,x,S){S.animate===!1||S.duration===0?(h(1),x()):(this._easeStart=n.browser.now(),this._easeOptions=S,this._onEaseFrame=h,this._onEaseEnd=x,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(h,x){h=n.wrap(h,-180,180);let S=Math.abs(h-x);return Math.abs(h-360-x)<S&&(h-=360),Math.abs(h+360-x)<S&&(h+=360),h}_normalizeCenter(h){let x=this.transform;if(!x.renderWorldCopies||x.lngRange)return;let S=h.lng-x.center.lng;h.lng+=S>180?-360:S<-180?360:0}queryTerrainElevation(h){return this.terrain?this.terrain.getElevationForLngLatZoom(n.LngLat.convert(h),this.transform.tileZoom)-this.transform.elevation:null}}class ka{constructor(h={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=x=>{!x||x.sourceDataType!=="metadata"&&x.sourceDataType!=="visibility"&&x.dataType!=="style"&&x.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=h}getDefaultPosition(){return"bottom-right"}onAdd(h){return this._map=h,this._compact=this.options&&this.options.compact,this._container=a.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=a.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=a.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){a.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(h,x){let S=this._map._getUIString(`AttributionControl.${x}`);h.title=S,h.setAttribute("aria-label",S)}_updateAttributions(){if(!this._map.style)return;let h=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?h=h.concat(this.options.customAttribution.map(I=>typeof I!="string"?"":I)):typeof this.options.customAttribution=="string"&&h.push(this.options.customAttribution)),this._map.style.stylesheet){let I=this._map.style.stylesheet;this.styleOwner=I.owner,this.styleId=I.id}let x=this._map.style.sourceCaches;for(let I in x){let D=x[I];if(D.used||D.usedForTerrain){let G=D.getSource();G.attribution&&h.indexOf(G.attribution)<0&&h.push(G.attribution)}}h=h.filter(I=>String(I).trim()),h.sort((I,D)=>I.length-D.length),h=h.filter((I,D)=>{for(let G=D+1;G<h.length;G++)if(h[G].indexOf(I)>=0)return!1;return!0});let S=h.join(" | ");S!==this._attribHTML&&(this._attribHTML=S,h.length?(this._innerContainer.innerHTML=S,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Vh{constructor(h={}){this._updateCompact=()=>{let x=this._container.children;if(x.length){let S=x[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&S.classList.add("maplibregl-compact"):S.classList.remove("maplibregl-compact")}},this.options=h}getDefaultPosition(){return"bottom-left"}onAdd(h){this._map=h,this._compact=this.options&&this.options.compact,this._container=a.create("div","maplibregl-ctrl");let x=a.create("a","maplibregl-ctrl-logo");return x.target="_blank",x.rel="noopener nofollow",x.href="https://maplibre.org/",x.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),x.setAttribute("rel","noopener nofollow"),this._container.appendChild(x),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){a.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class di{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(h){let x=++this._id;return this._queue.push({callback:h,id:x,cancelled:!1}),x}remove(h){let x=this._currentlyRunning,S=x?this._queue.concat(x):this._queue;for(let I of S)if(I.id===h)return void(I.cancelled=!0)}run(h=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let x=this._currentlyRunning=this._queue;this._queue=[];for(let S of x)if(!S.cancelled&&(S.callback(h),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}let Ci={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Y0=n.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class zp extends n.Evented{constructor(h){super(),this.sourceCache=h,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,h.usedForTerrain=!0,h.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(h,x){this.sourceCache.update(h,x),this._renderableTilesKeys=[];let S={};for(let I of h.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:x}))S[I.key]=!0,this._renderableTilesKeys.push(I.key),this._tiles[I.key]||(I.posMatrix=new Float64Array(16),n.ortho(I.posMatrix,0,n.EXTENT,0,n.EXTENT,0,1),this._tiles[I.key]=new je(I,this.tileSize));for(let I in this._tiles)S[I]||delete this._tiles[I]}freeRtt(h){for(let x in this._tiles){let S=this._tiles[x];(!h||S.tileID.equals(h)||S.tileID.isChildOf(h)||h.isChildOf(S.tileID))&&(S.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(h=>this.getTileByID(h))}getTileByID(h){return this._tiles[h]}getTerrainCoords(h){let x={};for(let S of this._renderableTilesKeys){let I=this._tiles[S].tileID;if(I.canonical.equals(h.canonical)){let D=h.clone();D.posMatrix=new Float64Array(16),n.ortho(D.posMatrix,0,n.EXTENT,0,n.EXTENT,0,1),x[S]=D}else if(I.canonical.isChildOf(h.canonical)){let D=h.clone();D.posMatrix=new Float64Array(16);let G=I.canonical.z-h.canonical.z,H=I.canonical.x-(I.canonical.x>>G<<G),Y=I.canonical.y-(I.canonical.y>>G<<G),J=n.EXTENT>>G;n.ortho(D.posMatrix,0,J,0,J,0,1),n.translate(D.posMatrix,D.posMatrix,[-H*J,-Y*J,0]),x[S]=D}else if(h.canonical.isChildOf(I.canonical)){let D=h.clone();D.posMatrix=new Float64Array(16);let G=h.canonical.z-I.canonical.z,H=h.canonical.x-(h.canonical.x>>G<<G),Y=h.canonical.y-(h.canonical.y>>G<<G),J=n.EXTENT>>G;n.ortho(D.posMatrix,0,n.EXTENT,0,n.EXTENT,0,1),n.translate(D.posMatrix,D.posMatrix,[H*J,Y*J,0]),n.scale(D.posMatrix,D.posMatrix,[1/2**G,1/2**G,0]),x[S]=D}}return x}getSourceTile(h,x){let S=this.sourceCache._source,I=h.overscaledZ-this.deltaZoom;if(I>S.maxzoom&&(I=S.maxzoom),I<S.minzoom)return null;this._sourceTileCache[h.key]||(this._sourceTileCache[h.key]=h.scaledTo(I).key);let D=this.sourceCache.getTileByID(this._sourceTileCache[h.key]);if((!D||!D.dem)&&x)for(;I>=S.minzoom&&(!D||!D.dem);)D=this.sourceCache.getTileByID(h.scaledTo(I--).key);return D}tilesAfterTime(h=Date.now()){return Object.values(this._tiles).filter(x=>x.timeAdded>=h)}}class Gp{constructor(h,x,S){this.painter=h,this.sourceCache=new zp(x),this.options=S,this.exaggeration=typeof S.exaggeration=="number"?S.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(h,x,S,I=n.EXTENT){var D;if(!(x>=0&&x<I&&S>=0&&S<I))return 0;let G=this.getTerrainData(h),H=(D=G.tile)===null||D===void 0?void 0:D.dem;if(!H)return 0;let Y=function(Ae,Re,Te){var Ve=Re[0],tt=Re[1];return Ae[0]=Te[0]*Ve+Te[4]*tt+Te[12],Ae[1]=Te[1]*Ve+Te[5]*tt+Te[13],Ae}([],[x/I*n.EXTENT,S/I*n.EXTENT],G.u_terrain_matrix),J=[Y[0]*H.dim,Y[1]*H.dim],re=Math.floor(J[0]),ae=Math.floor(J[1]),_e=J[0]-re,Ce=J[1]-ae;return H.get(re,ae)*(1-_e)*(1-Ce)+H.get(re+1,ae)*_e*(1-Ce)+H.get(re,ae+1)*(1-_e)*Ce+H.get(re+1,ae+1)*_e*Ce}getElevationForLngLatZoom(h,x){let{tileID:S,mercatorX:I,mercatorY:D}=this._getOverscaledTileIDFromLngLatZoom(h,x);return this.getElevation(S,I%n.EXTENT,D%n.EXTENT,n.EXTENT)}getElevation(h,x,S,I=n.EXTENT){return this.getDEMElevation(h,x,S,I)*this.exaggeration}getTerrainData(h){if(!this._emptyDemTexture){let I=this.painter.context,D=new n.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new U(I,D,I.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new U(I,new n.RGBAImage({width:1,height:1}),I.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(I.gl.NEAREST,I.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=n.identity([])}let x=this.sourceCache.getSourceTile(h,!0);if(x&&x.dem&&(!x.demTexture||x.needsTerrainPrepare)){let I=this.painter.context;x.demTexture=this.painter.getTileTexture(x.dem.stride),x.demTexture?x.demTexture.update(x.dem.getPixels(),{premultiply:!1}):x.demTexture=new U(I,x.dem.getPixels(),I.gl.RGBA,{premultiply:!1}),x.demTexture.bind(I.gl.NEAREST,I.gl.CLAMP_TO_EDGE),x.needsTerrainPrepare=!1}let S=x&&x+x.tileID.key+h.key;if(S&&!this._demMatrixCache[S]){let I=this.sourceCache.sourceCache._source.maxzoom,D=h.canonical.z-x.tileID.canonical.z;h.overscaledZ>h.canonical.z&&(h.canonical.z>=I?D=h.canonical.z-I:n.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let G=h.canonical.x-(h.canonical.x>>D<<D),H=h.canonical.y-(h.canonical.y>>D<<D),Y=n.fromScaling(new Float64Array(16),[1/(n.EXTENT<<D),1/(n.EXTENT<<D),0]);n.translate(Y,Y,[G*n.EXTENT,H*n.EXTENT,0]),this._demMatrixCache[h.key]={matrix:Y,coord:h}}return{u_depth:2,u_terrain:3,u_terrain_dim:x&&x.dem&&x.dem.dim||1,u_terrain_matrix:S?this._demMatrixCache[h.key].matrix:this._emptyDemMatrix,u_terrain_unpack:x&&x.dem&&x.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(x&&x.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:x}}getFramebuffer(h){let x=this.painter,S=x.width/devicePixelRatio,I=x.height/devicePixelRatio;return!this._fbo||this._fbo.width===S&&this._fbo.height===I||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new U(x.context,{width:S,height:I,data:null},x.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(x.context.gl.NEAREST,x.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new U(x.context,{width:S,height:I,data:null},x.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(x.context.gl.NEAREST,x.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=x.context.createFramebuffer(S,I,!0,!1),this._fbo.depthAttachment.set(x.context.createRenderbuffer(x.context.gl.DEPTH_COMPONENT16,S,I))),this._fbo.colorAttachment.set(h==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let h=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let x=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let D=0,G=0;D<this._coordsTextureSize;D++)for(let H=0;H<this._coordsTextureSize;H++,G+=4)x[G+0]=255&H,x[G+1]=255&D,x[G+2]=H>>8<<4|D>>8,x[G+3]=0;let S=new n.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(x.buffer)),I=new U(h,S,h.gl.RGBA,{premultiply:!1});return I.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._coordsTexture=I,I}pointCoordinate(h){let x=new Uint8Array(4),S=this.painter.context,I=S.gl;S.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),I.readPixels(h.x,this.painter.height/devicePixelRatio-h.y-1,1,1,I.RGBA,I.UNSIGNED_BYTE,x),S.bindFramebuffer.set(null);let D=x[0]+(x[2]>>4<<8),G=x[1]+((15&x[2])<<8),H=this.coordsIndex[255-x[3]],Y=H&&this.sourceCache.getTileByID(H);if(!Y)return null;let J=this._coordsTextureSize,re=(1<<Y.tileID.canonical.z)*J;return new n.MercatorCoordinate((Y.tileID.canonical.x*J+D)/re,(Y.tileID.canonical.y*J+G)/re,this.getElevation(Y.tileID,D,G,J))}getTerrainMesh(){if(this._mesh)return this._mesh;let h=this.painter.context,x=new n.Pos3dArray,S=new n.TriangleIndexArray,I=this.meshSize,D=n.EXTENT/I,G=I*I;for(let ae=0;ae<=I;ae++)for(let _e=0;_e<=I;_e++)x.emplaceBack(_e*D,ae*D,0);for(let ae=0;ae<G;ae+=I+1)for(let _e=0;_e<I;_e++)S.emplaceBack(_e+ae,I+_e+ae+1,I+_e+ae+2),S.emplaceBack(_e+ae,I+_e+ae+2,_e+ae+1);let H=x.length,Y=H+2*(I+1);for(let ae of[0,1])for(let _e=0;_e<=I;_e++)for(let Ce of[0,1])x.emplaceBack(_e*D,ae*n.EXTENT,Ce);for(let ae=0;ae<2*I;ae+=2)S.emplaceBack(Y+ae,Y+ae+1,Y+ae+3),S.emplaceBack(Y+ae,Y+ae+3,Y+ae+2),S.emplaceBack(H+ae,H+ae+3,H+ae+1),S.emplaceBack(H+ae,H+ae+2,H+ae+3);let J=x.length,re=J+2*(I+1);for(let ae of[0,1])for(let _e=0;_e<=I;_e++)for(let Ce of[0,1])x.emplaceBack(ae*n.EXTENT,_e*D,Ce);for(let ae=0;ae<2*I;ae+=2)S.emplaceBack(J+ae,J+ae+1,J+ae+3),S.emplaceBack(J+ae,J+ae+3,J+ae+2),S.emplaceBack(re+ae,re+ae+3,re+ae+1),S.emplaceBack(re+ae,re+ae+2,re+ae+3);return this._mesh={indexBuffer:h.createIndexBuffer(S),vertexBuffer:h.createVertexBuffer(x,Y0.members),segments:n.SegmentVector.simpleSegment(0,0,x.length,S.length)},this._mesh}getMeshFrameDelta(h){return 2*Math.PI*n.earthRadius/Math.pow(2,h)/5}getMinTileElevationForLngLatZoom(h,x){var S;let{tileID:I}=this._getOverscaledTileIDFromLngLatZoom(h,x);return(S=this.getMinMaxElevation(I).minElevation)!==null&&S!==void 0?S:0}getMinMaxElevation(h){let x=this.getTerrainData(h).tile,S={minElevation:null,maxElevation:null};return x&&x.dem&&(S.minElevation=x.dem.min*this.exaggeration,S.maxElevation=x.dem.max*this.exaggeration),S}_getOverscaledTileIDFromLngLatZoom(h,x){let S=n.MercatorCoordinate.fromLngLat(h.wrap()),I=(1<<x)*n.EXTENT,D=S.x*I,G=S.y*I,H=Math.floor(D/n.EXTENT),Y=Math.floor(G/n.EXTENT);return{tileID:new n.OverscaledTileID(x,0,x,H,Y),mercatorX:D,mercatorY:G}}}class oo{constructor(h,x,S){this._context=h,this._size=x,this._tileSize=S,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let h of this._objects)h.texture.destroy(),h.fbo.destroy()}_createObject(h){let x=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),S=new U(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return S.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),x.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),x.colorAttachment.set(S.texture),{id:h,fbo:x,texture:S,stamp:-1,inUse:!1}}getObjectForId(h){return this._objects[h]}useObject(h){h.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(x=>h.id!==x),this._recentlyUsed.push(h.id)}stampObject(h){h.stamp=++this._stamp}getOrCreateFreeObject(){for(let x of this._recentlyUsed)if(!this._objects[x].inUse)return this._objects[x];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let h=this._createObject(this._objects.length);return this._objects.push(h),h}freeObject(h){h.inUse=!1}freeAllObjects(){for(let h of this._objects)this.freeObject(h)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(h=>!h.inUse)===!1}}let lu={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ll{constructor(h,x){this.painter=h,this.terrain=x,this.pool=new oo(h.context,30,x.sourceCache.tileSize*x.qualityFactor)}destruct(){this.pool.destruct()}getTexture(h){return this.pool.getObjectForId(h.rtt[this._stacks.length-1].id).texture}prepareForRender(h,x){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=h._order.filter(S=>!h._layers[S].isHidden(x)),this._coordsDescendingInv={};for(let S in h.sourceCaches){this._coordsDescendingInv[S]={};let I=h.sourceCaches[S].getVisibleCoordinates();for(let D of I){let G=this.terrain.sourceCache.getTerrainCoords(D);for(let H in G)this._coordsDescendingInv[S][H]||(this._coordsDescendingInv[S][H]=[]),this._coordsDescendingInv[S][H].push(G[H])}}this._coordsDescendingInvStr={};for(let S of h._order){let I=h._layers[S],D=I.source;if(lu[I.type]&&!this._coordsDescendingInvStr[D]){this._coordsDescendingInvStr[D]={};for(let G in this._coordsDescendingInv[D])this._coordsDescendingInvStr[D][G]=this._coordsDescendingInv[D][G].map(H=>H.key).sort().join()}}for(let S of this._renderableTiles)for(let I in this._coordsDescendingInvStr){let D=this._coordsDescendingInvStr[I][S.tileID.key];D&&D!==S.rttCoords[I]&&(S.rtt=[])}}renderLayer(h){if(h.isHidden(this.painter.transform.zoom))return!1;let x=h.type,S=this.painter,I=this._renderableLayerIds[this._renderableLayerIds.length-1]===h.id;if(lu[x]&&(this._prevType&&lu[this._prevType]||this._stacks.push([]),this._prevType=x,this._stacks[this._stacks.length-1].push(h.id),!I))return!0;if(lu[this._prevType]||lu[x]&&I){this._prevType=x;let D=this._stacks.length-1,G=this._stacks[D]||[];for(let H of this._renderableTiles){if(this.pool.isFull()&&(G0(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(H),H.rtt[D]){let J=this.pool.getObjectForId(H.rtt[D].id);if(J.stamp===H.rtt[D].stamp){this.pool.useObject(J);continue}}let Y=this.pool.getOrCreateFreeObject();this.pool.useObject(Y),this.pool.stampObject(Y),H.rtt[D]={id:Y.id,stamp:Y.stamp},S.context.bindFramebuffer.set(Y.fbo.framebuffer),S.context.clear({color:n.Color.transparent,stencil:0}),S.currentStencilSource=void 0;for(let J=0;J<G.length;J++){let re=S.style._layers[G[J]],ae=re.source?this._coordsDescendingInv[re.source][H.tileID.key]:[H.tileID];S.context.viewport.set([0,0,Y.fbo.width,Y.fbo.height]),S._renderTileClippingMasks(re,ae),S.renderLayer(S,S.style.sourceCaches[re.source],re,ae),re.source&&(H.rttCoords[re.source]=this._coordsDescendingInvStr[re.source][H.tileID.key])}}return G0(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),lu[x]}return!1}}let yv=o,jh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:n.config.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},cs=P=>{P.touchstart=P.dragStart,P.touchmoveWindow=P.dragMove,P.touchend=P.dragEnd},Rs={showCompass:!0,showZoom:!0,visualizePitch:!1};class X7{constructor(h,x,S=!1){this.mousedown=G=>{this.startMouse(n.extend({},G,{ctrlKey:!0,preventDefault:()=>G.preventDefault()}),a.mousePos(this.element,G)),a.addEventListener(window,"mousemove",this.mousemove),a.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=G=>{this.moveMouse(G,a.mousePos(this.element,G))},this.mouseup=G=>{this.mouseRotate.dragEnd(G),this.mousePitch&&this.mousePitch.dragEnd(G),this.offTemp()},this.touchstart=G=>{G.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=a.touchPos(this.element,G.targetTouches)[0],this.startTouch(G,this._startPos),a.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.addEventListener(window,"touchend",this.touchend))},this.touchmove=G=>{G.targetTouches.length!==1?this.reset():(this._lastPos=a.touchPos(this.element,G.targetTouches)[0],this.moveTouch(G,this._lastPos))},this.touchend=G=>{G.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;let I=h.dragRotate._mouseRotate.getClickTolerance(),D=h.dragRotate._mousePitch.getClickTolerance();this.element=x,this.mouseRotate=X0({clickTolerance:I,enable:!0}),this.touchRotate=(({enable:G,clickTolerance:H,bearingDegreesPerPixelMoved:Y=.8})=>{let J=new Pp;return new f1({clickTolerance:H,move:(re,ae)=>({bearingDelta:(ae.x-re.x)*Y}),moveStateManager:J,enable:G,assignEvents:cs})})({clickTolerance:I,enable:!0}),this.map=h,S&&(this.mousePitch=G7({clickTolerance:D,enable:!0}),this.touchPitch=(({enable:G,clickTolerance:H,pitchDegreesPerPixelMoved:Y=-.5})=>{let J=new Pp;return new f1({clickTolerance:H,move:(re,ae)=>({pitchDelta:(ae.y-re.y)*Y}),moveStateManager:J,enable:G,assignEvents:cs})})({clickTolerance:D,enable:!0})),a.addEventListener(x,"mousedown",this.mousedown),a.addEventListener(x,"touchstart",this.touchstart,{passive:!1}),a.addEventListener(x,"touchcancel",this.reset)}startMouse(h,x){this.mouseRotate.dragStart(h,x),this.mousePitch&&this.mousePitch.dragStart(h,x),a.disableDrag()}startTouch(h,x){this.touchRotate.dragStart(h,x),this.touchPitch&&this.touchPitch.dragStart(h,x),a.disableDrag()}moveMouse(h,x){let S=this.map,{bearingDelta:I}=this.mouseRotate.dragMove(h,x)||{};if(I&&S.setBearing(S.getBearing()+I),this.mousePitch){let{pitchDelta:D}=this.mousePitch.dragMove(h,x)||{};D&&S.setPitch(S.getPitch()+D)}}moveTouch(h,x){let S=this.map,{bearingDelta:I}=this.touchRotate.dragMove(h,x)||{};if(I&&S.setBearing(S.getBearing()+I),this.touchPitch){let{pitchDelta:D}=this.touchPitch.dragMove(h,x)||{};D&&S.setPitch(S.getPitch()+D)}}off(){let h=this.element;a.removeEventListener(h,"mousedown",this.mousedown),a.removeEventListener(h,"touchstart",this.touchstart,{passive:!1}),a.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.removeEventListener(window,"touchend",this.touchend),a.removeEventListener(h,"touchcancel",this.reset),this.offTemp()}offTemp(){a.enableDrag(),a.removeEventListener(window,"mousemove",this.mousemove),a.removeEventListener(window,"mouseup",this.mouseup),a.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.removeEventListener(window,"touchend",this.touchend)}}let la;function Xh(P,h,x){if(P=new n.LngLat(P.lng,P.lat),h){let S=new n.LngLat(P.lng-360,P.lat),I=new n.LngLat(P.lng+360,P.lat),D=x.locationPoint(P).distSqr(h);x.locationPoint(S).distSqr(h)<D?P=S:x.locationPoint(I).distSqr(h)<D&&(P=I)}for(;Math.abs(P.lng-x.center.lng)>180;){let S=x.locationPoint(P);if(S.x>=0&&S.y>=0&&S.x<=x.width&&S.y<=x.height)break;P.lng>x.center.lng?P.lng-=360:P.lng+=360}return P}let Wh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Z0(P,h,x){let S=P.classList;for(let I in Wh)S.remove(`maplibregl-${x}-anchor-${I}`);S.add(`maplibregl-${x}-anchor-${h}`)}class qh extends n.Evented{constructor(h){if(super(),this._onKeyPress=x=>{let S=x.code,I=x.charCode||x.keyCode;S!=="Space"&&S!=="Enter"&&I!==32&&I!==13||this.togglePopup()},this._onMapClick=x=>{let S=x.originalEvent.target,I=this._element;this._popup&&(S===I||I.contains(S))&&this.togglePopup()},this._update=x=>{if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Xh(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let S="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?S=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(S=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let I="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?I="rotateX(0deg)":this._pitchAlignment==="map"&&(I=`rotateX(${this._map.getPitch()}deg)`),x&&x.type!=="moveend"||(this._pos=this._pos.round()),a.setTransform(this._element,`${Wh[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${I} ${S}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{let D=this._map.unproject(this._pos),G=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=D.distanceTo(this._lngLat)>20*G?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=x=>{if(!this._isDragging){let S=this._clickTolerance||this._map._clickTolerance;this._isDragging=x.point.dist(this._pointerdownPos)>=S}this._isDragging&&(this._pos=x.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.Event("dragstart"))),this.fire(new n.Event("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new n.Event("dragend")),this._state="inactive"},this._addDragHandler=x=>{this._element.contains(x.originalEvent.target)&&(x.preventDefault(),this._positionDelta=x.point.sub(this._pos).add(this._offset),this._pointerdownPos=x.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment!=="auto"?h.pitchAlignment:this._rotationAlignment,h&&h.element)this._element=h.element,this._offset=n.Point.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=a.create("div"),this._element.setAttribute("aria-label","Map marker");let x=a.createNS("http://www.w3.org/2000/svg","svg"),S=41,I=27;x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height",`${S}px`),x.setAttributeNS(null,"width",`${I}px`),x.setAttributeNS(null,"viewBox",`0 0 ${I} ${S}`);let D=a.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"stroke","none"),D.setAttributeNS(null,"stroke-width","1"),D.setAttributeNS(null,"fill","none"),D.setAttributeNS(null,"fill-rule","evenodd");let G=a.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"fill-rule","nonzero");let H=a.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(3.0, 29.0)"),H.setAttributeNS(null,"fill","#000000");let Y=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let Ve of Y){let tt=a.createNS("http://www.w3.org/2000/svg","ellipse");tt.setAttributeNS(null,"opacity","0.04"),tt.setAttributeNS(null,"cx","10.5"),tt.setAttributeNS(null,"cy","5.80029008"),tt.setAttributeNS(null,"rx",Ve.rx),tt.setAttributeNS(null,"ry",Ve.ry),H.appendChild(tt)}let J=a.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"fill",this._color);let re=a.createNS("http://www.w3.org/2000/svg","path");re.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),J.appendChild(re);let ae=a.createNS("http://www.w3.org/2000/svg","g");ae.setAttributeNS(null,"opacity","0.25"),ae.setAttributeNS(null,"fill","#000000");let _e=a.createNS("http://www.w3.org/2000/svg","path");_e.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ae.appendChild(_e);let Ce=a.createNS("http://www.w3.org/2000/svg","g");Ce.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ce.setAttributeNS(null,"fill","#FFFFFF");let Ae=a.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(8.0, 8.0)");let Re=a.createNS("http://www.w3.org/2000/svg","circle");Re.setAttributeNS(null,"fill","#000000"),Re.setAttributeNS(null,"opacity","0.25"),Re.setAttributeNS(null,"cx","5.5"),Re.setAttributeNS(null,"cy","5.5"),Re.setAttributeNS(null,"r","5.4999962");let Te=a.createNS("http://www.w3.org/2000/svg","circle");Te.setAttributeNS(null,"fill","#FFFFFF"),Te.setAttributeNS(null,"cx","5.5"),Te.setAttributeNS(null,"cy","5.5"),Te.setAttributeNS(null,"r","5.4999962"),Ae.appendChild(Re),Ae.appendChild(Te),G.appendChild(H),G.appendChild(J),G.appendChild(ae),G.appendChild(Ce),G.appendChild(Ae),x.appendChild(G),x.setAttributeNS(null,"height",S*this._scale+"px"),x.setAttributeNS(null,"width",I*this._scale+"px"),this._element.appendChild(x),this._offset=n.Point.convert(h&&h.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()}),Z0(this._element,this._anchor,"marker"),h&&h.className)for(let x of h.className.split(" "))this._element.classList.add(x);this._popup=null}addTo(h){return this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._update),h.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),a.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=n.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){let I=Math.abs(13.5)/Math.SQRT2;h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[I,-1*(38.1-13.5+I)],"bottom-right":[-I,-1*(38.1-13.5+I)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=h,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){let h=this._popup;return h?(h.isOpen()?h.remove():h.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(h){return this._offset=n.Point.convert(h),this._update(),this}addClassName(h){this._element.classList.add(h)}removeClassName(h){this._element.classList.remove(h)}toggleClassName(h){return this._element.classList.toggle(h)}setDraggable(h){return this._draggable=!!h,this._map&&(h?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(h){return this._rotation=h||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(h){return this._rotationAlignment=h||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(h){return this._pitchAlignment=h&&h!=="auto"?h:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}let Yh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},m1=0,cu=!1,$p={maxWidth:100,unit:"metric"};function Q0(P,h,x){let S=x&&x.maxWidth||100,I=P._container.clientHeight/2,D=P.unproject([0,I]),G=P.unproject([S,I]),H=D.distanceTo(G);if(x&&x.unit==="imperial"){let Y=3.2808*H;Y>5280?uu(h,S,Y/5280,P._getUIString("ScaleControl.Miles")):uu(h,S,Y,P._getUIString("ScaleControl.Feet"))}else x&&x.unit==="nautical"?uu(h,S,H/1852,P._getUIString("ScaleControl.NauticalMiles")):H>=1e3?uu(h,S,H/1e3,P._getUIString("ScaleControl.Kilometers")):uu(h,S,H,P._getUIString("ScaleControl.Meters"))}function uu(P,h,x,S){let I=function(D){let G=Math.pow(10,`${Math.floor(D)}`.length-1),H=D/G;return H=H>=10?10:H>=5?5:H>=3?3:H>=2?2:H>=1?1:function(Y){let J=Math.pow(10,Math.ceil(-Math.log(Y)/Math.LN10));return Math.round(Y*J)/J}(H),G*H}(x);P.style.width=h*(I/x)+"px",P.innerHTML=`${I}&nbsp;${S}`}let Hp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Vp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function K0(P){if(P){if(typeof P=="number"){let h=Math.round(Math.abs(P)/Math.SQRT2);return{center:new n.Point(0,0),top:new n.Point(0,P),"top-left":new n.Point(h,h),"top-right":new n.Point(-h,h),bottom:new n.Point(0,-P),"bottom-left":new n.Point(h,-h),"bottom-right":new n.Point(-h,-h),left:new n.Point(P,0),right:new n.Point(-P,0)}}if(P instanceof n.Point||Array.isArray(P)){let h=n.Point.convert(P);return{center:h,top:h,"top-left":h,"top-right":h,bottom:h,"bottom-left":h,"bottom-right":h,left:h,right:h}}return{center:n.Point.convert(P.center||[0,0]),top:n.Point.convert(P.top||[0,0]),"top-left":n.Point.convert(P["top-left"]||[0,0]),"top-right":n.Point.convert(P["top-right"]||[0,0]),bottom:n.Point.convert(P.bottom||[0,0]),"bottom-left":n.Point.convert(P["bottom-left"]||[0,0]),"bottom-right":n.Point.convert(P["bottom-right"]||[0,0]),left:n.Point.convert(P.left||[0,0]),right:n.Point.convert(P.right||[0,0])}}return K0(new n.Point(0,0))}let J0={extend:(P,...h)=>n.extend(P,...h),run(P){P()},logToElement(P,h=!1,x="log"){let S=window.document.getElementById(x);S&&(h&&(S.innerHTML=""),S.innerHTML+=`<br>${P}`)}},jp=o;class Tr{static get version(){return jp}static get workerCount(){return nt.workerCount}static set workerCount(h){nt.workerCount=h}static get maxParallelImageRequests(){return n.config.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(h){n.config.MAX_PARALLEL_IMAGE_REQUESTS=h}static get workerUrl(){return n.config.WORKER_URL}static set workerUrl(h){n.config.WORKER_URL=h}static addProtocol(h,x){n.config.REGISTERED_PROTOCOLS[h]=x}static removeProtocol(h){delete n.config.REGISTERED_PROTOCOLS[h]}}return Tr.Map=class extends gv{constructor(P){if(n.PerformanceUtils.mark(n.PerformanceMarkers.create),(P=n.extend({},jh,P)).minZoom!=null&&P.maxZoom!=null&&P.minZoom>P.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(P.minPitch!=null&&P.maxPitch!=null&&P.minPitch>P.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(P.minPitch!=null&&P.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(P.maxPitch!=null&&P.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new V0(P.minZoom,P.maxZoom,P.minPitch,P.maxPitch,P.renderWorldCopies),{bearingSnap:P.bearingSnap}),this._cooperativeGesturesOnWheel=h=>{this._onCooperativeGesture(h,h[this._metaKey],1)},this._contextLost=h=>{h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.Event("webglcontextlost",{originalEvent:h}))},this._contextRestored=h=>{this._setupPainter(),this.resize(),this._update(),this.fire(new n.Event("webglcontextrestored",{originalEvent:h}))},this._onMapScroll=h=>{if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=P.interactive,this._cooperativeGestures=P.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=P.maxTileCacheSize,this._maxTileCacheZoomLevels=P.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=P.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=P.preserveDrawingBuffer,this._antialias=P.antialias,this._trackResize=P.trackResize,this._bearingSnap=P.bearingSnap,this._refreshExpiredTiles=P.refreshExpiredTiles,this._fadeDuration=P.fadeDuration,this._crossSourceCollisions=P.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=P.collectResourceTiming,this._renderTaskQueue=new di,this._controls=[],this._mapId=n.uniqueId(),this._locale=n.extend({},Ci,P.locale),this._clickTolerance=P.clickTolerance,this._overridePixelRatio=P.pixelRatio,this._maxCanvasSize=P.maxCanvasSize,this.transformCameraUpdate=P.transformCameraUpdate,this._imageQueueHandle=v.addThrottleControl(()=>this.isMoving()),this._requestManager=new b(P.transformRequest),typeof P.container=="string"){if(this._container=document.getElementById(P.container),!this._container)throw new Error(`Container '${P.container}' not found.`)}else{if(!(P.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=P.container}if(P.maxBounds&&this.setMaxBounds(P.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let h=!1,x=_c(S=>{this._trackResize&&!this._removed&&this.resize(S)._update()},50);this._resizeObserver=new ResizeObserver(S=>{h?x(S):h=!0}),this._resizeObserver.observe(this._container)}this.handlers=new j7(this,P),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=P.hash&&new N7(typeof P.hash=="string"&&P.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:P.center,zoom:P.zoom,bearing:P.bearing,pitch:P.pitch}),P.bounds&&(this.resize(),this.fitBounds(P.bounds,n.extend({},P.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=P.localIdeographFontFamily,this._validateStyle=P.validateStyle,P.style&&this.setStyle(P.style,{localIdeographFontFamily:P.localIdeographFontFamily}),P.attributionControl&&this.addControl(new ka({customAttribution:P.customAttribution})),P.maplibreLogo&&this.addControl(new Vh,P.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new n.Event(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new n.Event(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new n.Event("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(P,h){if(h===void 0&&(h=P.getDefaultPosition?P.getDefaultPosition():"top-right"),!P||!P.onAdd)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let x=P.onAdd(this);this._controls.push(P);let S=this._controlPositions[h];return h.indexOf("bottom")!==-1?S.insertBefore(x,S.firstChild):S.appendChild(x),this}removeControl(P){if(!P||!P.onRemove)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let h=this._controls.indexOf(P);return h>-1&&this._controls.splice(h,1),P.onRemove(this),this}hasControl(P){return this._controls.indexOf(P)>-1}calculateCameraOptionsFromTo(P,h,x,S){return S==null&&this.terrain&&(S=this.terrain.getElevationForLngLatZoom(x,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(P,h,x,S)}resize(P){var h;let x=this._containerDimensions(),S=x[0],I=x[1],D=this._getClampedPixelRatio(S,I);if(this._resizeCanvas(S,I,D),this.painter.resize(S,I,D),this.painter.overLimit()){let H=this.painter.context.gl;this._maxCanvasSize=[H.drawingBufferWidth,H.drawingBufferHeight];let Y=this._getClampedPixelRatio(S,I);this._resizeCanvas(S,I,Y),this.painter.resize(S,I,Y)}this.transform.resize(S,I),(h=this._requestedCameraState)===null||h===void 0||h.resize(S,I);let G=!this._moving;return G&&(this.stop(),this.fire(new n.Event("movestart",P)).fire(new n.Event("move",P))),this.fire(new n.Event("resize",P)),G&&this.fire(new n.Event("moveend",P)),this}_getClampedPixelRatio(P,h){let{0:x,1:S}=this._maxCanvasSize,I=this.getPixelRatio(),D=P*I,G=h*I;return Math.min(D>x?x/D:1,G>S?S/G:1)*I}getPixelRatio(){var P;return(P=this._overridePixelRatio)!==null&&P!==void 0?P:devicePixelRatio}setPixelRatio(P){this._overridePixelRatio=P,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(P){return this.transform.setMaxBounds(ne.convert(P)),this._update()}setMinZoom(P){if((P=P??-2)>=-2&&P<=this.transform.maxZoom)return this.transform.minZoom=P,this._update(),this.getZoom()<P&&this.setZoom(P),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(P){if((P=P??22)>=this.transform.minZoom)return this.transform.maxZoom=P,this._update(),this.getZoom()>P&&this.setZoom(P),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(P){if((P=P??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(P>=0&&P<=this.transform.maxPitch)return this.transform.minPitch=P,this._update(),this.getPitch()<P&&this.setPitch(P),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(P){if((P=P??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(P>=this.transform.minPitch)return this.transform.maxPitch=P,this._update(),this.getPitch()>P&&this.setPitch(P),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(P){return this.transform.renderWorldCopies=P,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(P){return this._cooperativeGestures=P,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(P){return this.transform.locationPoint(n.LngLat.convert(P),this.style&&this.terrain)}unproject(P){return this.transform.pointLocation(n.Point.convert(P),this.terrain)}isMoving(){var P;return this._moving||((P=this.handlers)===null||P===void 0?void 0:P.isMoving())}isZooming(){var P;return this._zooming||((P=this.handlers)===null||P===void 0?void 0:P.isZooming())}isRotating(){var P;return this._rotating||((P=this.handlers)===null||P===void 0?void 0:P.isRotating())}_createDelegatedListener(P,h,x){if(P==="mouseenter"||P==="mouseover"){let S=!1;return{layer:h,listener:x,delegates:{mousemove:D=>{let G=this.getLayer(h)?this.queryRenderedFeatures(D.point,{layers:[h]}):[];G.length?S||(S=!0,x.call(this,new Vs(P,this,D.originalEvent,{features:G}))):S=!1},mouseout:()=>{S=!1}}}}if(P==="mouseleave"||P==="mouseout"){let S=!1;return{layer:h,listener:x,delegates:{mousemove:G=>{(this.getLayer(h)?this.queryRenderedFeatures(G.point,{layers:[h]}):[]).length?S=!0:S&&(S=!1,x.call(this,new Vs(P,this,G.originalEvent)))},mouseout:G=>{S&&(S=!1,x.call(this,new Vs(P,this,G.originalEvent)))}}}}{let S=I=>{let D=this.getLayer(h)?this.queryRenderedFeatures(I.point,{layers:[h]}):[];D.length&&(I.features=D,x.call(this,I),delete I.features)};return{layer:h,listener:x,delegates:{[P]:S}}}}on(P,h,x){if(x===void 0)return super.on(P,h);let S=this._createDelegatedListener(P,h,x);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[P]=this._delegatedListeners[P]||[],this._delegatedListeners[P].push(S);for(let I in S.delegates)this.on(I,S.delegates[I]);return this}once(P,h,x){if(x===void 0)return super.once(P,h);let S=this._createDelegatedListener(P,h,x);for(let I in S.delegates)this.once(I,S.delegates[I]);return this}off(P,h,x){return x===void 0?super.off(P,h):(this._delegatedListeners&&this._delegatedListeners[P]&&(S=>{let I=this._delegatedListeners[P];for(let D=0;D<I.length;D++){let G=I[D];if(G.layer===h&&G.listener===x){for(let H in G.delegates)this.off(H,G.delegates[H]);return I.splice(D,1),this}}})(),this)}queryRenderedFeatures(P,h){if(!this.style)return[];let x,S=P instanceof n.Point||Array.isArray(P),I=S?P:[[0,0],[this.transform.width,this.transform.height]];if(h=h||(S?{}:P)||{},I instanceof n.Point||typeof I[0]=="number")x=[n.Point.convert(I)];else{let D=n.Point.convert(I[0]),G=n.Point.convert(I[1]);x=[D,new n.Point(G.x,D.y),G,new n.Point(D.x,G.y),D]}return this.style.queryRenderedFeatures(x,h,this.transform)}querySourceFeatures(P,h){return this.style.querySourceFeatures(P,h)}setStyle(P,h){return(h=n.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},h)).diff!==!1&&h.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&P?(this._diffStyle(P,h),this):(this._localIdeographFontFamily=h.localIdeographFontFamily,this._updateStyle(P,h))}setTransformRequest(P){return this._requestManager.setTransformRequest(P),this}_getUIString(P){let h=this._locale[P];if(h==null)throw new Error(`Missing UI string '${P}'`);return h}_updateStyle(P,h){if(h.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(P,h));let x=this.style&&h.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!P)),P?(this.style=new Fn(this,h||{}),this.style.setEventedParent(this,{style:this.style}),typeof P=="string"?this.style.loadURL(P,h,x):this.style.loadJSON(P,h,x),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Fn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(P,h){if(typeof P=="string"){let x=this._requestManager.transformRequest(P,E.Style);n.getJSON(x,(S,I)=>{S?this.fire(new n.ErrorEvent(S)):I&&this._updateDiff(I,h)})}else typeof P=="object"&&this._updateDiff(P,h)}_updateDiff(P,h){try{this.style.setState(P,h)&&this._update(!0)}catch(x){n.warnOnce(`Unable to perform style diff: ${x.message||x.error||x}.  Rebuilding the style from scratch.`),this._updateStyle(P,h)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():n.warnOnce("There is no style added to the map.")}addSource(P,h){return this._lazyInitEmptyStyle(),this.style.addSource(P,h),this._update(!0)}isSourceLoaded(P){let h=this.style&&this.style.sourceCaches[P];if(h!==void 0)return h.loaded();this.fire(new n.ErrorEvent(new Error(`There is no source with ID '${P}'`)))}setTerrain(P){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),P){let h=this.style.sourceCaches[P.source];if(!h)throw new Error(`cannot load terrain, because there exists no source with ID: ${P.source}`);for(let x in this.style._layers){let S=this.style._layers[x];S.type==="hillshade"&&S.source===P.source&&n.warnOnce("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Gp(this.painter,h,P),this.painter.renderToTexture=new ll(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=x=>{x.dataType==="style"?this.terrain.sourceCache.freeRtt():x.dataType==="source"&&x.tile&&(x.sourceId!==P.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(x.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new n.Event("terrain",{terrain:P})),this}getTerrain(){var P,h;return(h=(P=this.terrain)===null||P===void 0?void 0:P.options)!==null&&h!==void 0?h:null}areTilesLoaded(){let P=this.style&&this.style.sourceCaches;for(let h in P){let x=P[h]._tiles;for(let S in x){let I=x[S];if(I.state!=="loaded"&&I.state!=="errored")return!1}}return!0}addSourceType(P,h,x){return this._lazyInitEmptyStyle(),this.style.addSourceType(P,h,x)}removeSource(P){return this.style.removeSource(P),this._update(!0)}getSource(P){return this.style.getSource(P)}addImage(P,h,x={}){let{pixelRatio:S=1,sdf:I=!1,stretchX:D,stretchY:G,content:H}=x;if(this._lazyInitEmptyStyle(),!(h instanceof HTMLImageElement||n.isImageBitmap(h))){if(h.width===void 0||h.height===void 0)return this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:Y,height:J,data:re}=h,ae=h;return this.style.addImage(P,{data:new n.RGBAImage({width:Y,height:J},new Uint8Array(re)),pixelRatio:S,stretchX:D,stretchY:G,content:H,sdf:I,version:0,userImage:ae}),ae.onAdd&&ae.onAdd(this,P),this}}{let{width:Y,height:J,data:re}=n.browser.getImageData(h);this.style.addImage(P,{data:new n.RGBAImage({width:Y,height:J},re),pixelRatio:S,stretchX:D,stretchY:G,content:H,sdf:I,version:0})}}updateImage(P,h){let x=this.style.getImage(P);if(!x)return this.fire(new n.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let S=h instanceof HTMLImageElement||n.isImageBitmap(h)?n.browser.getImageData(h):h,{width:I,height:D,data:G}=S;if(I===void 0||D===void 0)return this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(I!==x.data.width||D!==x.data.height)return this.fire(new n.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));let H=!(h instanceof HTMLImageElement||n.isImageBitmap(h));return x.data.replace(G,H),this.style.updateImage(P,x),this}getImage(P){return this.style.getImage(P)}hasImage(P){return P?!!this.style.getImage(P):(this.fire(new n.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(P){this.style.removeImage(P)}loadImage(P,h){v.getImage(this._requestManager.transformRequest(P,E.Image),h)}listImages(){return this.style.listImages()}addLayer(P,h){return this._lazyInitEmptyStyle(),this.style.addLayer(P,h),this._update(!0)}moveLayer(P,h){return this.style.moveLayer(P,h),this._update(!0)}removeLayer(P){return this.style.removeLayer(P),this._update(!0)}getLayer(P){return this.style.getLayer(P)}setLayerZoomRange(P,h,x){return this.style.setLayerZoomRange(P,h,x),this._update(!0)}setFilter(P,h,x={}){return this.style.setFilter(P,h,x),this._update(!0)}getFilter(P){return this.style.getFilter(P)}setPaintProperty(P,h,x,S={}){return this.style.setPaintProperty(P,h,x,S),this._update(!0)}getPaintProperty(P,h){return this.style.getPaintProperty(P,h)}setLayoutProperty(P,h,x,S={}){return this.style.setLayoutProperty(P,h,x,S),this._update(!0)}getLayoutProperty(P,h){return this.style.getLayoutProperty(P,h)}setGlyphs(P,h={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(P,h),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(P,h,x={}){return this._lazyInitEmptyStyle(),this.style.addSprite(P,h,x,S=>{S||this._update(!0)}),this}removeSprite(P){return this._lazyInitEmptyStyle(),this.style.removeSprite(P),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(P,h={}){return this._lazyInitEmptyStyle(),this.style.setSprite(P,h,x=>{x||this._update(!0)}),this}setLight(P,h={}){return this._lazyInitEmptyStyle(),this.style.setLight(P,h),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(P,h){return this.style.setFeatureState(P,h),this._update()}removeFeatureState(P,h){return this.style.removeFeatureState(P,h),this._update()}getFeatureState(P){return this.style.getFeatureState(P)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let P=0,h=0;return this._container&&(P=this._container.clientWidth||400,h=this._container.clientHeight||300),[P,h]}_setupContainer(){let P=this._container;P.classList.add("maplibregl-map");let h=this._canvasContainer=a.create("div","maplibregl-canvas-container",P);this._interactive&&h.classList.add("maplibregl-interactive"),this._canvas=a.create("canvas","maplibregl-canvas",h),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");let x=this._containerDimensions(),S=this._getClampedPixelRatio(x[0],x[1]);this._resizeCanvas(x[0],x[1],S);let I=this._controlContainer=a.create("div","maplibregl-control-container",P),D=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(G=>{D[G]=a.create("div",`maplibregl-ctrl-${G} `,I)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=a.create("div","maplibregl-cooperative-gesture-screen",this._container);let P=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(P=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${P}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){a.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(P,h,x){this._canvas.width=Math.floor(x*P),this._canvas.height=Math.floor(x*h),this._canvas.style.width=`${P}px`,this._canvas.style.height=`${h}px`}_setupPainter(){let P={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1},h=null;this._canvas.addEventListener("webglcontextcreationerror",S=>{h={requestedAttributes:P},S&&(h.statusMessage=S.statusMessage,h.type=S.type)},{once:!0});let x=this._canvas.getContext("webgl2",P)||this._canvas.getContext("webgl",P);if(!x){let S="Failed to initialize WebGL";throw h?(h.message=S,new Error(JSON.stringify(h))):new Error(S)}this.painter=new L7(x,this.transform),l.testSupport(x)}_onCooperativeGesture(P,h,x){return!h&&x<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(P){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||P,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(P){return this._update(),this._renderTaskQueue.add(P)}_cancelRenderFrame(P){this._renderTaskQueue.remove(P)}_render(P){let h=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(P),this._removed)return;let x=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let I=this.transform.zoom,D=n.browser.now();this.style.zoomHistory.update(I,D);let G=new n.EvaluationParameters(I,{now:D,fadeDuration:h,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),H=G.crossFadingFactor();H===1&&H===this._crossFadingFactor||(x=!0,this._crossFadingFactor=H),this.style.update(G)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,h,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:h,showPadding:this.showPadding}),this.fire(new n.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,n.PerformanceUtils.mark(n.PerformanceMarkers.load),this.fire(new n.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let S=this._sourcesDirty||this._styleDirty||this._placementDirty;return S||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new n.Event("idle")),!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,n.PerformanceUtils.mark(n.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var P;this._hash&&this._hash.remove();for(let x of this._controls)x.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),v.removeThrottleControl(this._imageQueueHandle),(P=this._resizeObserver)===null||P===void 0||P.disconnect();let h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),a.remove(this._canvasContainer),a.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),n.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new n.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=n.browser.frame(P=>{n.PerformanceUtils.frame(P),this._frame=null,this._render(P)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(P){this._showTileBoundaries!==P&&(this._showTileBoundaries=P,this._update())}get showPadding(){return!!this._showPadding}set showPadding(P){this._showPadding!==P&&(this._showPadding=P,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(P){this._showCollisionBoxes!==P&&(this._showCollisionBoxes=P,P?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(P){this._showOverdrawInspector!==P&&(this._showOverdrawInspector=P,this._update())}get repaint(){return!!this._repaint}set repaint(P){this._repaint!==P&&(this._repaint=P,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(P){this._vertices=P,this._update()}get version(){return yv}getCameraTargetElevation(){return this.transform.elevation}},Tr.NavigationControl=class{constructor(P){this._updateZoomButtons=()=>{let h=this._map.getZoom(),x=h===this._map.getMaxZoom(),S=h===this._map.getMinZoom();this._zoomInButton.disabled=x,this._zoomOutButton.disabled=S,this._zoomInButton.setAttribute("aria-disabled",x.toString()),this._zoomOutButton.setAttribute("aria-disabled",S.toString())},this._rotateCompassArrow=()=>{let h=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=h},this._setButtonTitle=(h,x)=>{let S=this._map._getUIString(`NavigationControl.${x}`);h.title=S,h.setAttribute("aria-label",S)},this.options=n.extend({},Rs,P),this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",h=>h.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",h=>this._map.zoomIn({},{originalEvent:h})),a.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",h=>this._map.zoomOut({},{originalEvent:h})),a.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",h=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:h}):this._map.resetNorth({},{originalEvent:h})}),this._compassIcon=a.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(P){return this._map=P,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new X7(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){a.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(P,h){let x=a.create("button",P,this._container);return x.type="button",x.addEventListener("click",h),x}},Tr.GeolocateControl=class extends n.Evented{constructor(P){super(),this._onSuccess=h=>{if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new n.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new n.Event("geolocate",h)),this._finish()}},this._updateCamera=h=>{let x=new n.LngLat(h.coords.longitude,h.coords.latitude),S=h.coords.accuracy,I=this._map.getBearing(),D=n.extend({bearing:I},this.options.fitBoundsOptions),G=ne.fromLngLat(x,S);this._map.fitBounds(G,D,{geolocateSource:!0})},this._updateMarker=h=>{if(h){let x=new n.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(x).addTo(this._map),this._userLocationDotMarker.setLngLat(x).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=h=>{if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&cu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new n.Event("error",h)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=h=>{if(this._map){if(this._container.addEventListener("contextmenu",x=>x.preventDefault()),this._geolocateButton=a.create("button","maplibregl-ctrl-geolocate",this._container),a.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){n.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");let x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}else{let x=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=a.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new qh({element:this._dotElement}),this._circleElement=a.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new qh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",x=>{x.geolocateSource||this._watchState!=="ACTIVE_LOCK"||x.originalEvent&&x.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new n.Event("trackuserlocationend")))})}},this.options=n.extend({},Yh,P)}onAdd(P){return this._map=P,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(h,x=!1){la===void 0||x?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(S=>{la=S.state!=="denied",h(la)}).catch(()=>{la=!!window.navigator.geolocation,h(la)}):(la=!!window.navigator.geolocation,h(la)):h(la)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),a.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,m1=0,cu=!1}_isOutOfMapMaxBounds(P){let h=this._map.getMaxBounds(),x=P.coords;return h&&(x.longitude<h.getWest()||x.longitude>h.getEast()||x.latitude<h.getSouth()||x.latitude>h.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let P=this._map.getBounds(),h=P.getSouthEast(),x=P.getNorthEast(),S=h.distanceTo(x),I=Math.ceil(this._accuracy/(S/this._map._container.clientHeight)*2);this._circleElement.style.width=`${I}px`,this._circleElement.style.height=`${I}px`}trigger(){if(!this._setup)return n.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":m1--,cu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new n.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let P;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),m1++,m1>1?(P={maximumAge:6e5,timeout:0},cu=!0):(P=this.options.positionOptions,cu=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,P)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Tr.AttributionControl=ka,Tr.LogoControl=Vh,Tr.ScaleControl=class{constructor(P){this._onMove=()=>{Q0(this._map,this._container,this.options)},this.setUnit=h=>{this.options.unit=h,Q0(this._map,this._container,this.options)},this.options=n.extend({},$p,P)}getDefaultPosition(){return"bottom-left"}onAdd(P){return this._map=P,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-scale",P.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){a.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Tr.FullscreenControl=class extends n.Evented{constructor(P={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,P&&P.container&&(P.container instanceof HTMLElement?this._container=P.container:n.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(P){return this._map=P,this._container||(this._container=this._map.getContainer()),this._controlContainer=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){a.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let P=this._fullscreenButton=a.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);a.create("span","maplibregl-ctrl-icon",P).setAttribute("aria-hidden","true"),P.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let P=this._getTitle();this._fullscreenButton.setAttribute("aria-label",P),this._fullscreenButton.title=P}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new n.Event("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new n.Event("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Tr.TerrainControl=class{constructor(P){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=P}onAdd(P){return this._map=P,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=a.create("button","maplibregl-ctrl-terrain",this._container),a.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){a.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Tr.Popup=class extends n.Evented{constructor(P){super(),this.remove=()=>(this._content&&a.remove(this._content),this._container&&(a.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new n.Event("close")),this),this._onMouseUp=h=>{this._update(h.point)},this._onMouseMove=h=>{this._update(h.point)},this._onDrag=h=>{this._update(h.point)},this._update=h=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=a.create("div","maplibregl-popup",this._map.getContainer()),this._tip=a.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let G of this.options.className.split(" "))this._container.classList.add(G);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Xh(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!h)return;let x=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),S=this.options.anchor,I=K0(this.options.offset);if(!S){let G=this._container.offsetWidth,H=this._container.offsetHeight,Y;Y=x.y+I.bottom.y<H?["top"]:x.y>this._map.transform.height-H?["bottom"]:[],x.x<G/2?Y.push("left"):x.x>this._map.transform.width-G/2&&Y.push("right"),S=Y.length===0?"bottom":Y.join("-")}let D=x.add(I[S]).round();a.setTransform(this._container,`${Wh[S]} translate(${D.x}px,${D.y}px)`),Z0(this._container,S,"popup")},this._onClose=()=>{this.remove()},this.options=n.extend(Object.create(Hp),P)}addTo(P){return this._map&&this.remove(),this._map=P,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new n.Event("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(P){return this._lngLat=n.LngLat.convert(P),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(P){return this.setDOMContent(document.createTextNode(P))}setHTML(P){let h=document.createDocumentFragment(),x=document.createElement("body"),S;for(x.innerHTML=P;S=x.firstChild,S;)h.appendChild(S);return this.setDOMContent(h)}getMaxWidth(){var P;return(P=this._container)===null||P===void 0?void 0:P.style.maxWidth}setMaxWidth(P){return this.options.maxWidth=P,this._update(),this}setDOMContent(P){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=a.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(P),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(P){this._container&&this._container.classList.add(P)}removeClassName(P){this._container&&this._container.classList.remove(P)}setOffset(P){return this.options.offset=P,this._update(),this}toggleClassName(P){if(this._container)return this._container.classList.toggle(P)}_createCloseButton(){this.options.closeButton&&(this._closeButton=a.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let P=this._container.querySelector(Vp);P&&P.focus()}},Tr.Marker=qh,Tr.Style=Fn,Tr.LngLat=n.LngLat,Tr.LngLatBounds=ne,Tr.Point=n.Point,Tr.MercatorCoordinate=n.MercatorCoordinate,Tr.Evented=n.Evented,Tr.AJAXError=n.AJAXError,Tr.config=n.config,Tr.CanvasSource=Se,Tr.GeoJSONSource=ot,Tr.ImageSource=vt,Tr.RasterDEMTileSource=Je,Tr.RasterTileSource=He,Tr.VectorTileSource=De,Tr.VideoSource=ct,Tr.setRTLTextPlugin=n.setRTLTextPlugin,Tr.getRTLTextPluginStatus=n.getRTLTextPluginStatus,Tr.prewarm=function(){hi().acquire(Ie)},Tr.clearPrewarmedResources=function(){let P=Ht;P&&(P.isPreloaded()&&P.numActive()===1?(P.release(Ie),Ht=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},J0.extend(Tr,{isSafari:n.isSafari,getPerformanceMetrics:n.PerformanceUtils.getPerformanceMetrics}),Tr});var s=i;return s})});var eO=Ui((ftt,j4)=>{j4.exports=OQ;j4.exports.pair=UQ;j4.exports.format=ES;j4.exports.formatPair=BQ;j4.exports.coordToDMS=JN;function OQ(t,e){var i=TS(t,e);return i===null?null:i.val}function BQ(t){return ES(t.lat,"lat")+" "+ES(t.lon,"lon")}function ES(t,e){var i=JN(t,e);return i.whole+"\xB0 "+(i.minutes?i.minutes+"' ":"")+(i.seconds?i.seconds+'" ':"")+i.dir}function JN(t,e){var i={lat:["N","S"],lon:["E","W"]}[e]||"",r=i[t>=0?0:1],s=Math.abs(t),n=Math.floor(s),o=s-n,a=o*60,l=Math.floor(a),u=Math.floor((a-l)*60);return{whole:n,minutes:l,seconds:u,dir:r}}function TS(t,e){if(e||(e="NSEW"),typeof t!="string")return null;t=t.toUpperCase();var i=/^[\s\,]*([NSEW])?\s*([\-|\|\]?[0-9.]+)[]?\s*(?:([0-9.]+)[']\s*)?(?:([0-9.]+)(?:''|"||)\s*)?([NSEW])?/,r=t.match(i);if(!r)return null;var s=r[0],n;if(r[1]&&r[5]?(n=r[1],s=s.slice(0,-1)):n=r[1]||r[5],n&&e.indexOf(n)===-1)return null;var o=r[2]?parseFloat(r[2]):0,a=r[3]?parseFloat(r[3])/60:0,l=r[4]?parseFloat(r[4])/3600:0,u=o<0?-1:1;return(n==="S"||n==="W")&&(u*=-1),{val:(Math.abs(o)+a+l)*u,dim:n,matched:s,remain:t.slice(s.length)}}function UQ(t,e){t=t.trim();var i=TS(t,e);if(!i)return null;t=i.remain.trim();var r=TS(t,e);return!r||r.remain?null:i.dim?zQ(i.val,r.val,i.dim):[i.val,r.val]}function zQ(t,e,i){if(i==="N"||i==="S")return[t,e];if(i==="W"||i==="E")return[e,t]}});var KO=Ui((i3t,QO)=>{"use strict";QO.exports=sp;function sp(t,e){this.x=t,this.y=e}sp.prototype={clone:function(){return new sp(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=e*this.x-i*this.y,s=i*this.x+e*this.y;return this.x=r,this.y=s,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),s=e.x+i*(this.x-e.x)-r*(this.y-e.y),n=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=s,this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};sp.convert=function(t){return t instanceof sp?t:Array.isArray(t)?new sp(t[0],t[1]):t}});var pA=Ui((r3t,JO)=>{"use strict";var _K=KO();JO.exports=np;function np(t,e,i,r,s){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=s,t.readFields(xK,this,e)}function xK(t,e,i){t==1?e.id=i.readVarint():t==2?vK(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function vK(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var r=e._keys[t.readVarint()],s=e._values[t.readVarint()];e.properties[r]=s}}np.types=["Unknown","Point","LineString","Polygon"];np.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,s=0,n=0,o=[],a;t.pos<e;){if(r<=0){var l=t.readVarint();i=l&7,r=l>>3}if(r--,i===1||i===2)s+=t.readSVarint(),n+=t.readSVarint(),i===1&&(a&&o.push(a),a=[]),a.push(new _K(s,n));else if(i===7)a&&a.push(a[0].clone());else throw new Error("unknown command "+i)}return a&&o.push(a),o};np.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,s=0,n=0,o=1/0,a=-1/0,l=1/0,u=-1/0;t.pos<e;){if(r<=0){var d=t.readVarint();i=d&7,r=d>>3}if(r--,i===1||i===2)s+=t.readSVarint(),n+=t.readSVarint(),s<o&&(o=s),s>a&&(a=s),n<l&&(l=n),n>u&&(u=n);else if(i!==7)throw new Error("unknown command "+i)}return[o,l,a,u]};np.prototype.toGeoJSON=function(t,e,i){var r=this.extent*Math.pow(2,i),s=this.extent*t,n=this.extent*e,o=this.loadGeometry(),a=np.types[this.type],l,u;function d(_){for(var v=0;v<_.length;v++){var E=_[v],b=180-(E.y+n)*360/r;_[v]=[(E.x+s)*360/r-180,360/Math.PI*Math.atan(Math.exp(b*Math.PI/180))-90]}}switch(this.type){case 1:var m=[];for(l=0;l<o.length;l++)m[l]=o[l][0];o=m,d(o);break;case 2:for(l=0;l<o.length;l++)d(o[l]);break;case 3:for(o=bK(o),l=0;l<o.length;l++)for(u=0;u<o[l].length;u++)d(o[l][u]);break}o.length===1?o=o[0]:a="Multi"+a;var g={type:"Feature",geometry:{type:a,coordinates:o},properties:this.properties};return"id"in this&&(g.id=this.id),g};function bK(t){var e=t.length;if(e<=1)return[t];for(var i=[],r,s,n=0;n<e;n++){var o=wK(t[n]);o!==0&&(s===void 0&&(s=o<0),s===o<0?(r&&i.push(r),r=[t[n]]):r.push(t[n]))}return r&&i.push(r),i}function wK(t){for(var e=0,i=0,r=t.length,s=r-1,n,o;i<r;s=i++)n=t[i],o=t[s],e+=(o.x-n.x)*(n.y+o.y);return e}});var mA=Ui((s3t,tB)=>{"use strict";var EK=pA();tB.exports=eB;function eB(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(TK,this,e),this.length=this._features.length}function TK(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(SK(i))}function SK(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var r=t.readVarint()>>3;e=r===1?t.readString():r===2?t.readFloat():r===3?t.readDouble():r===4?t.readVarint64():r===5?t.readVarint():r===6?t.readSVarint():r===7?t.readBoolean():null}return e}eB.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new EK(this._pbf,e,this.extent,this._keys,this._values)}});var rB=Ui((n3t,iB)=>{"use strict";var AK=mA();iB.exports=CK;function CK(t,e){this.layers=t.readFields(IK,{},e)}function IK(t,e,i){if(t===3){var r=new AK(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}});var gA=Ui((o3t,zx)=>{zx.exports.VectorTile=rB();zx.exports.VectorTileFeature=pA();zx.exports.VectorTileLayer=mA()});var sB=Ui(yA=>{yA.read=function(t,e,i,r,s){var n,o,a=s*8-r-1,l=(1<<a)-1,u=l>>1,d=-7,m=i?s-1:0,g=i?-1:1,_=t[e+m];for(m+=g,n=_&(1<<-d)-1,_>>=-d,d+=a;d>0;n=n*256+t[e+m],m+=g,d-=8);for(o=n&(1<<-d)-1,n>>=-d,d+=r;d>0;o=o*256+t[e+m],m+=g,d-=8);if(n===0)n=1-u;else{if(n===l)return o?NaN:(_?-1:1)*(1/0);o=o+Math.pow(2,r),n=n-u}return(_?-1:1)*o*Math.pow(2,n-r)};yA.write=function(t,e,i,r,s,n){var o,a,l,u=n*8-s-1,d=(1<<u)-1,m=d>>1,g=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,_=r?0:n-1,v=r?1:-1,E=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=d):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+m>=1?e+=g/l:e+=g*Math.pow(2,1-m),e*l>=2&&(o++,l/=2),o+m>=d?(a=0,o=d):o+m>=1?(a=(e*l-1)*Math.pow(2,s),o=o+m):(a=e*Math.pow(2,m-1)*Math.pow(2,s),o=0));s>=8;t[i+_]=a&255,_+=v,a/=256,s-=8);for(o=o<<s|a,u+=s;u>0;t[i+_]=o&255,_+=v,o/=256,u-=8);t[i+_-v]|=E*128}});var xA=Ui((l3t,cB)=>{"use strict";cB.exports=zr;var Gx=sB();function zr(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}zr.Varint=0;zr.Fixed64=1;zr.Bytes=2;zr.Fixed32=5;var _A=65536*65536,nB=1/_A,kK=12,lB=typeof TextDecoder>"u"?null:new TextDecoder("utf8");zr.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),s=r>>3,n=this.pos;this.type=r&7,t(s,e,this),this.pos===n&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=$x(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=aB(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=$x(this.buf,this.pos)+$x(this.buf,this.pos+4)*_A;return this.pos+=8,t},readSFixed64:function(){var t=$x(this.buf,this.pos)+aB(this.buf,this.pos+4)*_A;return this.pos+=8,t},readFloat:function(){var t=Gx.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Gx.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,i,r;return r=e[this.pos++],i=r&127,r<128||(r=e[this.pos++],i|=(r&127)<<7,r<128)||(r=e[this.pos++],i|=(r&127)<<14,r<128)||(r=e[this.pos++],i|=(r&127)<<21,r<128)?i:(r=e[this.pos],i|=(r&15)<<28,MK(i,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=kK&&lB?VK(this.buf,e,t):HK(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==zr.Bytes)return t.push(this.readVarint(e));var i=s1(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==zr.Bytes)return t.push(this.readSVarint());var e=s1(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==zr.Bytes)return t.push(this.readBoolean());var e=s1(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==zr.Bytes)return t.push(this.readFloat());var e=s1(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==zr.Bytes)return t.push(this.readDouble());var e=s1(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==zr.Bytes)return t.push(this.readFixed32());var e=s1(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==zr.Bytes)return t.push(this.readSFixed32());var e=s1(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==zr.Bytes)return t.push(this.readFixed64());var e=s1(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==zr.Bytes)return t.push(this.readSFixed64());var e=s1(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===zr.Varint)for(;this.buf[this.pos++]>127;);else if(e===zr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===zr.Fixed32)this.pos+=4;else if(e===zr.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),ap(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),ap(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),ap(this.buf,t&-1,this.pos),ap(this.buf,Math.floor(t*nB),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),ap(this.buf,t&-1,this.pos),ap(this.buf,Math.floor(t*nB),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){PK(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=jK(this.buf,t,this.pos);var i=this.pos-e;i>=128&&oB(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),Gx.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Gx.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&oB(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,zr.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,FK,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,LK,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,BK,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,NK,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,OK,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,UK,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,zK,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,GK,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,$K,e)},writeBytesField:function(t,e){this.writeTag(t,zr.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,zr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,zr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,zr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,zr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,zr.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,zr.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,zr.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,zr.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,zr.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};function MK(t,e,i){var r=i.buf,s,n;if(n=r[i.pos++],s=(n&112)>>4,n<128||(n=r[i.pos++],s|=(n&127)<<3,n<128)||(n=r[i.pos++],s|=(n&127)<<10,n<128)||(n=r[i.pos++],s|=(n&127)<<17,n<128)||(n=r[i.pos++],s|=(n&127)<<24,n<128)||(n=r[i.pos++],s|=(n&1)<<31,n<128))return op(t,s,e);throw new Error("Expected varint not more than 10 bytes")}function s1(t){return t.type===zr.Bytes?t.readVarint()+t.pos:t.pos+1}function op(t,e,i){return i?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function PK(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(i=~(-t%4294967296),r=~(-t/4294967296),i^4294967295?i=i+1|0:(i=0,r=r+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),RK(i,r,e),DK(r,e)}function RK(t,e,i){i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos]=t&127}function DK(t,e){var i=(t&7)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function oB(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));i.realloc(r);for(var s=i.pos-1;s>=t;s--)i.buf[s+r]=i.buf[s]}function FK(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function LK(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function NK(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function OK(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function BK(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function UK(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function zK(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function GK(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function $K(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function $x(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function ap(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function aB(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function HK(t,e,i){for(var r="",s=e;s<i;){var n=t[s],o=null,a=n>239?4:n>223?3:n>191?2:1;if(s+a>i)break;var l,u,d;a===1?n<128&&(o=n):a===2?(l=t[s+1],(l&192)===128&&(o=(n&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=t[s+1],u=t[s+2],(l&192)===128&&(u&192)===128&&(o=(n&15)<<12|(l&63)<<6|u&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=t[s+1],u=t[s+2],d=t[s+3],(l&192)===128&&(u&192)===128&&(d&192)===128&&(o=(n&15)<<18|(l&63)<<12|(u&63)<<6|d&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),r+=String.fromCharCode(o),s+=a}return r}function VK(t,e,i){return lB.decode(t.subarray(e,i))}function jK(t,e,i){for(var r=0,s,n;r<e.length;r++){if(s=e.charCodeAt(r),s>55295&&s<57344)if(n)if(s<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=s;continue}else s=n-55296<<10|s-56320|65536,n=null;else{s>56319||r+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=s;continue}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);s<128?t[i++]=s:(s<2048?t[i++]=s>>6|192:(s<65536?t[i++]=s>>12|224:(t[i++]=s>>18|240,t[i++]=s>>12&63|128),t[i++]=s>>6&63|128),t[i++]=s&63|128)}return i}});var y0=Ui((V3t,yB)=>{var SA=uJ(),aJ=hJ(),lJ=dJ(),cJ=typeof window<"u"?window:global;yB.exports={assign:SA,create:aJ,trim:lJ,bind:fJ,slice:AA,each:gB,map:pJ,pluck:CA,isList:IA,isFunction:mJ,isObject:gJ,Global:cJ};function uJ(){return Object.assign?Object.assign:function(e,i,r,s){for(var n=1;n<arguments.length;n++)gB(Object(arguments[n]),function(o,a){e[a]=o});return e}}function hJ(){if(Object.create)return function(i,r,s,n){var o=AA(arguments,1);return SA.apply(this,[Object.create(i)].concat(o))};{let e=function(){};var t=e;return function(r,s,n,o){var a=AA(arguments,1);return e.prototype=r,SA.apply(this,[new e].concat(a))}}}function dJ(){return String.prototype.trim?function(e){return String.prototype.trim.call(e)}:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}function fJ(t,e){return function(){return e.apply(t,Array.prototype.slice.call(arguments,0))}}function AA(t,e){return Array.prototype.slice.call(t,e||0)}function gB(t,e){CA(t,function(i,r){return e(i,r),!1})}function pJ(t,e){var i=IA(t)?[]:{};return CA(t,function(r,s){return i[s]=e(r,s),!1}),i}function CA(t,e){if(IA(t)){for(var i=0;i<t.length;i++)if(e(t[i],i))return t[i]}else for(var r in t)if(t.hasOwnProperty(r)&&e(t[r],r))return t[r]}function IA(t){return t!=null&&typeof t!="function"&&typeof t.length=="number"}function mJ(t){return t&&{}.toString.call(t)==="[object Function]"}function gJ(t){return t&&{}.toString.call(t)==="[object Object]"}});var xB=Ui((j3t,_B)=>{var vh=y0(),yJ=vh.slice,_J=vh.pluck,cp=vh.each,xJ=vh.bind,vJ=vh.create,kA=vh.isList,MA=vh.isFunction,bJ=vh.isObject;_B.exports={createStore:PA};var wJ={version:"2.0.12",enabled:!1,get:function(t,e){var i=this.storage.read(this._namespacePrefix+t);return this._deserialize(i,e)},set:function(t,e){return e===void 0?this.remove(t):(this.storage.write(this._namespacePrefix+t,this._serialize(e)),e)},remove:function(t){this.storage.remove(this._namespacePrefix+t)},each:function(t){var e=this;this.storage.each(function(i,r){t.call(e,e._deserialize(i),(r||"").replace(e._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(t){return this._namespacePrefix=="__storejs_"+t+"_"},createStore:function(){return PA.apply(this,arguments)},addPlugin:function(t){this._addPlugin(t)},namespace:function(t){return PA(this.storage,this.plugins,t)}};function EJ(){var t=typeof console>"u"?null:console;if(t){var e=t.warn?t.warn:t.log;e.apply(t,arguments)}}function PA(t,e,i){i||(i=""),t&&!kA(t)&&(t=[t]),e&&!kA(e)&&(e=[e]);var r=i?"__storejs_"+i+"_":"",s=i?new RegExp("^"+r):null,n=/^[a-zA-Z0-9_\-]*$/;if(!n.test(i))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var o={_namespacePrefix:r,_namespaceRegexp:s,_testStorage:function(l){try{var u="__storejs__test__";l.write(u,u);var d=l.read(u)===u;return l.remove(u),d}catch{return!1}},_assignPluginFnProp:function(l,u){var d=this[u];this[u]=function(){var g=yJ(arguments,0),_=this;function v(){if(d)return cp(arguments,function(b,T){g[T]=b}),d.apply(_,g)}var E=[v].concat(g);return l.apply(_,E)}},_serialize:function(l){return JSON.stringify(l)},_deserialize:function(l,u){if(!l)return u;var d="";try{d=JSON.parse(l)}catch{d=l}return d!==void 0?d:u},_addStorage:function(l){this.enabled||this._testStorage(l)&&(this.storage=l,this.enabled=!0)},_addPlugin:function(l){var u=this;if(kA(l)){cp(l,function(g){u._addPlugin(g)});return}var d=_J(this.plugins,function(g){return l===g});if(!d){if(this.plugins.push(l),!MA(l))throw new Error("Plugins must be function values that return objects");var m=l.call(this);if(!bJ(m))throw new Error("Plugins must return an object of function properties");cp(m,function(g,_){if(!MA(g))throw new Error("Bad plugin property: "+_+" from plugin "+l.name+". Plugins should only return functions.");u._assignPluginFnProp(g,_)})}},addStorage:function(l){EJ("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(l)}},a=vJ(o,wJ,{plugins:[]});return a.raw={},cp(a,function(l,u){MA(l)&&(a.raw[u]=xJ(a,l))}),cp(t,function(l){a._addStorage(l)}),cp(e,function(l){a._addPlugin(l)}),a}});var wB=Ui((X3t,bB)=>{var TJ=y0(),SJ=TJ.Global;bB.exports={name:"localStorage",read:vB,write:AJ,each:CJ,remove:IJ,clearAll:kJ};function up(){return SJ.localStorage}function vB(t){return up().getItem(t)}function AJ(t,e){return up().setItem(t,e)}function CJ(t){for(var e=up().length-1;e>=0;e--){var i=up().key(e);t(vB(i),i)}}function IJ(t){return up().removeItem(t)}function kJ(){return up().clear()}});var SB=Ui((W3t,TB)=>{var MJ=y0(),PJ=MJ.Global;TB.exports={name:"oldFF-globalStorage",read:RJ,write:DJ,each:EB,remove:FJ,clearAll:LJ};var _0=PJ.globalStorage;function RJ(t){return _0[t]}function DJ(t,e){_0[t]=e}function EB(t){for(var e=_0.length-1;e>=0;e--){var i=_0.key(e);t(_0[i],i)}}function FJ(t){return _0.removeItem(t)}function LJ(){EB(function(t,e){delete _0[t]})}});var IB=Ui((q3t,CB)=>{var NJ=y0(),RA=NJ.Global;CB.exports={name:"oldIE-userDataStorage",write:OJ,read:BJ,each:UJ,remove:zJ,clearAll:GJ};var t7="storejs",e7=RA.document,i7=HJ(),AB=(RA.navigator?RA.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./);function OJ(t,e){if(!AB){var i=DA(t);i7(function(r){r.setAttribute(i,e),r.save(t7)})}}function BJ(t){if(!AB){var e=DA(t),i=null;return i7(function(r){i=r.getAttribute(e)}),i}}function UJ(t){i7(function(e){for(var i=e.XMLDocument.documentElement.attributes,r=i.length-1;r>=0;r--){var s=i[r];t(e.getAttribute(s.name),s.name)}})}function zJ(t){var e=DA(t);i7(function(i){i.removeAttribute(e),i.save(t7)})}function GJ(){i7(function(t){var e=t.XMLDocument.documentElement.attributes;t.load(t7);for(var i=e.length-1;i>=0;i--)t.removeAttribute(e[i].name);t.save(t7)})}var $J=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function DA(t){return t.replace(/^\d/,"___$&").replace($J,"___")}function HJ(){if(!e7||!e7.documentElement||!e7.documentElement.addBehavior)return null;var t="script",e,i,r;try{i=new ActiveXObject("htmlfile"),i.open(),i.write("<"+t+">document.w=window</"+t+'><iframe src="/favicon.ico"></iframe>'),i.close(),e=i.w.frames[0].document,r=e.createElement("div")}catch{r=e7.createElement("div"),e=e7.body}return function(s){var n=[].slice.call(arguments,0);n.unshift(r),e.appendChild(r),r.addBehavior("#default#userData"),r.load(t7),s.apply(this,n),e.removeChild(r)}}});var FB=Ui((Y3t,DB)=>{var kB=y0(),VJ=kB.Global,jJ=kB.trim;DB.exports={name:"cookieStorage",read:XJ,write:WJ,each:MB,remove:PB,clearAll:qJ};var r7=VJ.document;function XJ(t){if(!t||!RB(t))return null;var e="(?:^|.*;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(r7.cookie.replace(new RegExp(e),"$1"))}function MB(t){for(var e=r7.cookie.split(/; ?/g),i=e.length-1;i>=0;i--)if(jJ(e[i])){var r=e[i].split("="),s=unescape(r[0]),n=unescape(r[1]);t(n,s)}}function WJ(t,e){t&&(r7.cookie=escape(t)+"="+escape(e)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")}function PB(t){!t||!RB(t)||(r7.cookie=escape(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function qJ(){MB(function(t,e){PB(e)})}function RB(t){return new RegExp("(?:^|;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(r7.cookie)}});var OB=Ui((Z3t,NB)=>{var YJ=y0(),ZJ=YJ.Global;NB.exports={name:"sessionStorage",read:LB,write:QJ,each:KJ,remove:JJ,clearAll:eee};function hp(){return ZJ.sessionStorage}function LB(t){return hp().getItem(t)}function QJ(t,e){return hp().setItem(t,e)}function KJ(t){for(var e=hp().length-1;e>=0;e--){var i=hp().key(e);t(LB(i),i)}}function JJ(t){return hp().removeItem(t)}function eee(){return hp().clear()}});var UB=Ui((Q3t,BB)=>{BB.exports={name:"memoryStorage",read:tee,write:iee,each:ree,remove:see,clearAll:nee};var x0={};function tee(t){return x0[t]}function iee(t,e){x0[t]=e}function ree(t){for(var e in x0)x0.hasOwnProperty(e)&&t(x0[e],e)}function see(t){delete x0[t]}function nee(t){x0={}}});var GB=Ui((K3t,zB)=>{zB.exports=[wB(),SB(),IB(),FB(),OB(),UB()]});var $B=Ui((exports,module)=>{typeof JSON!="object"&&(JSON={});(function(){"use strict";var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(t){return t<10?"0"+t:t}function this_value(){return this.valueOf()}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;function quote(t){return rx_escapable.lastIndex=0,rx_escapable.test(t)?'"'+t.replace(rx_escapable,function(e){var i=meta[e];return typeof i=="string"?i:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var i,r,s,n,o=gap,a,l=e[t];switch(l&&typeof l=="object"&&typeof l.toJSON=="function"&&(l=l.toJSON(t)),typeof rep=="function"&&(l=rep.call(e,t,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,a=[],Object.prototype.toString.apply(l)==="[object Array]"){for(n=l.length,i=0;i<n;i+=1)a[i]=str(i,l)||"null";return s=a.length===0?"[]":gap?`[
`+gap+a.join(`,
`+gap)+`
`+o+"]":"["+a.join(",")+"]",gap=o,s}if(rep&&typeof rep=="object")for(n=rep.length,i=0;i<n;i+=1)typeof rep[i]=="string"&&(r=rep[i],s=str(r,l),s&&a.push(quote(r)+(gap?": ":":")+s));else for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(s=str(r,l),s&&a.push(quote(r)+(gap?": ":":")+s));return s=a.length===0?"{}":gap?`{
`+gap+a.join(`,
`+gap)+`
`+o+"}":"{"+a.join(",")+"}",gap=o,s}}typeof JSON.stringify!="function"&&(meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,e,i){var r;if(gap="",indent="",typeof i=="number")for(r=0;r<i;r+=1)indent+=" ";else typeof i=="string"&&(indent=i);if(rep=e,e&&typeof e!="function"&&(typeof e!="object"||typeof e.length!="number"))throw new Error("JSON.stringify");return str("",{"":t})}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){var j;function walk(t,e){var i,r,s=t[e];if(s&&typeof s=="object")for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(r=walk(s,i),r!==void 0?s[i]=r:delete s[i]);return reviver.call(t,e,s)}if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})})()});var VB=Ui((J3t,HB)=>{HB.exports=oee;function oee(){return $B(),{}}});var XB=Ui((e5t,jB)=>{var aee=xB(),lee=GB(),cee=[VB()];jB.exports=aee.createStore(lee,cee)});var xU=Ui((j5t,_U)=>{"use strict";_U.exports=function(t,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var i=typeof e.cycles=="boolean"?e.cycles:!1,r=e.cmp&&function(n){return function(o){return function(a,l){var u={key:a,value:o[a]},d={key:l,value:o[l]};return n(u,d)}}}(e.cmp),s=[];return function n(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,l;if(Array.isArray(o)){for(l="[",a=0;a<o.length;a++)a&&(l+=","),l+=n(o[a])||"null";return l+"]"}if(o===null)return"null";if(s.indexOf(o)!==-1){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var u=s.push(o)-1,d=Object.keys(o).sort(r&&r(o));for(l="",a=0;a<d.length;a++){var m=d[a],g=n(o[m]);g&&(l&&(l+=","),l+=JSON.stringify(m)+":"+g)}return s.splice(u,1),"{"+l+"}"}}(t)}});var qx={};p9(qx,{AbstractBehavior:()=>rn,AbstractMode:()=>gs,AbstractSystem:()=>ui,AddNoteMode:()=>F6,AddPointMode:()=>L6,BrowseMode:()=>N6,Category:()=>G2,Collection:()=>zc,Context:()=>Wx,DataLoaderSystem:()=>vm,Difference:()=>Wa,DragBehavior:()=>dm,DragNodeMode:()=>O6,DrawAreaMode:()=>B6,DrawBehavior:()=>fm,DrawLineMode:()=>U6,EditSystem:()=>bm,EsriService:()=>j6,FetchError:()=>am,Field:()=>W2,FilterSystem:()=>wm,Graph:()=>vn,HoverBehavior:()=>pm,ImagerySource:()=>Il,ImagerySourceBing:()=>j2,ImagerySourceCustom:()=>V2,ImagerySourceEsri:()=>X2,ImagerySourceNone:()=>H2,ImagerySystem:()=>Cm,ImproveOsmService:()=>X6,KartaviewService:()=>W6,KeepRightService:()=>q6,KeyOperationBehavior:()=>Er,LassoBehavior:()=>mm,LocalizationSystem:()=>Im,LocationSystem:()=>Pm,Map3dSystem:()=>d6,MapInteractionBehavior:()=>gm,MapNudgingBehavior:()=>ym,MapSystem:()=>h6,MapWithAIService:()=>Z6,MapillaryService:()=>Y6,MoveMode:()=>z6,NominatimService:()=>Q6,NsiService:()=>J6,OsmService:()=>n7,OsmWikibaseService:()=>a7,OsmoseService:()=>o7,PasteBehavior:()=>_m,PhotoSystem:()=>f6,Preset:()=>Gc,PresetSystem:()=>m6,QAItem:()=>vr,RapidSystem:()=>g6,RotateMode:()=>G6,SaveMode:()=>$6,SelectBehavior:()=>xm,SelectMode:()=>H6,SelectOsmMode:()=>V6,StorageSystem:()=>y6,StreetsideService:()=>l7,TaginfoService:()=>u7,Tree:()=>qa,UiDefs:()=>V4,UiField:()=>Ca,UiPanelBackground:()=>v6,UiPanelHistory:()=>b6,UiPanelLocation:()=>w6,UiPanelMeasurement:()=>E6,UiSystem:()=>C6,UploaderSystem:()=>I6,UrlHashSystem:()=>k6,ValidationFix:()=>Ti,ValidationIssue:()=>rr,ValidationSystem:()=>D6,VectorTileService:()=>m7,WikidataService:()=>g7,WikipediaService:()=>y7,actionAddEntity:()=>Or,actionAddMember:()=>Bd,actionAddMidpoint:()=>tn,actionAddVertex:()=>xo,actionChangeMember:()=>ih,actionChangePreset:()=>ja,actionChangeTags:()=>Hr,actionCircularize:()=>Sg,actionConnect:()=>Ud,actionCopyEntities:()=>U2,actionDeleteMember:()=>rh,actionDeleteMultiple:()=>Hu,actionDeleteNode:()=>Uc,actionDeleteRelation:()=>pn,actionDeleteWay:()=>Cl,actionDiscardTags:()=>Vu,actionDisconnect:()=>lm,actionExtract:()=>z2,actionJoin:()=>Ag,actionMerge:()=>Cg,actionMergeNodes:()=>Xa,actionMergePolygon:()=>Ig,actionMergeRemoteChanges:()=>Y2,actionMove:()=>$c,actionMoveMember:()=>Mg,actionMoveNode:()=>Hc,actionNoop:()=>as,actionOrthogonalize:()=>sh,actionRapidAcceptFeature:()=>Og,actionReflect:()=>Fg,actionRestrictTurn:()=>zD,actionReverse:()=>pl,actionRevert:()=>hm,actionRotate:()=>Pg,actionScale:()=>GD,actionSplit:()=>ju,actionStraightenNodes:()=>Rg,actionStraightenWay:()=>Dg,actionUnrestrictTurn:()=>$D,actionUpgradeTags:()=>Lg,behaviors:()=>ac,d3:()=>nte,geoChooseEdge:()=>Gs,geoHasLineIntersections:()=>OD,geoHasSelfIntersections:()=>zd,geoOrthoCalcScore:()=>kg,geoOrthoCanOrthogonalize:()=>Z2,geoOrthoMaxOffsetAngle:()=>UD,geoOrthoNormalizedDotProduct:()=>Gd,modeDragNote:()=>jO,modes:()=>Ia,operationCircularize:()=>qS,operationContinue:()=>YS,operationCopy:()=>M6,operationCycleHighwayTag:()=>ZS,operationDelete:()=>ra,operationDisconnect:()=>QS,operationDowngrade:()=>P6,operationExtract:()=>KS,operationMerge:()=>JS,operationMove:()=>eA,operationOrthogonalize:()=>tA,operationPaste:()=>R6,operationReflectLong:()=>rA,operationReflectShort:()=>iA,operationReverse:()=>sA,operationRotate:()=>nA,operationSplit:()=>oA,operationStraighten:()=>aA,osmAreaKeys:()=>id,osmChangeset:()=>Jo,osmEntity:()=>Dt,osmFlowingWaterwayTagValues:()=>gf,osmInferRestriction:()=>FD,osmIntersection:()=>DD,osmIsInterestingTag:()=>Do,osmIsOldMultipolygonOuterMember:()=>B2,osmJoinWays:()=>xa,osmLanes:()=>w8,osmLifecyclePrefixes:()=>S1,osmNode:()=>vi,osmNodeGeometriesForTags:()=>C1,osmNote:()=>Fr,osmOldMultipolygonOuterMember:()=>PD,osmOldMultipolygonOuterMemberOfRelation:()=>O2,osmOneWayTags:()=>I1,osmPavedTags:()=>rd,osmPointTags:()=>pf,osmRailwayTrackTagValues:()=>S9,osmRelation:()=>Cs,osmRemoveLifecyclePrefix:()=>f3,osmRoutableHighwayTagValues:()=>ml,osmSetAreaKeys:()=>w9,osmSetPointTags:()=>E9,osmSetVertexTags:()=>T9,osmTagSuggestingArea:()=>A1,osmTurn:()=>um,osmVertexTags:()=>mf,osmWay:()=>Cr,sdk:()=>ote,services:()=>Rn,svgTagClasses:()=>SU,systems:()=>Pn,uiAccount:()=>c_,uiAttribution:()=>d_,uiChangesetEditor:()=>f_,uiCmd:()=>Ri,uiCombobox:()=>gr,uiCommit:()=>g_,uiCommitWarnings:()=>m_,uiConfirm:()=>_h,uiConflicts:()=>y_,uiContributors:()=>__,uiDataEditor:()=>H4,uiDataHeader:()=>x_,uiDisclosure:()=>c0,uiEditMenu:()=>v_,uiEntityEditor:()=>C_,uiFeatureInfo:()=>KN,uiFeatureList:()=>I_,uiFieldAccess:()=>hS,uiFieldAddress:()=>dS,uiFieldCheck:()=>a0,uiFieldCombo:()=>il,uiFieldCycleway:()=>fS,uiFieldDefaultCheck:()=>a0,uiFieldEmail:()=>Aa,uiFieldIdentifier:()=>Aa,uiFieldLanes:()=>o_,uiFieldLocalized:()=>pS,uiFieldManyCombo:()=>il,uiFieldMultiCombo:()=>il,uiFieldNetworkCombo:()=>il,uiFieldNumber:()=>Aa,uiFieldOnewayCheck:()=>a0,uiFieldRadio:()=>p6,uiFieldRoadspeed:()=>mS,uiFieldSemiCombo:()=>il,uiFieldStructureRadio:()=>p6,uiFieldTel:()=>Aa,uiFieldText:()=>Aa,uiFieldTextarea:()=>gS,uiFieldTypeCombo:()=>il,uiFieldUrl:()=>Aa,uiFieldWikidata:()=>yS,uiFieldWikipedia:()=>l_,uiFields:()=>U4,uiFlash:()=>X4,uiFormFields:()=>G4,uiFullScreen:()=>k_,uiGeolocate:()=>M_,uiIcon:()=>Ye,uiImproveOsmComments:()=>P_,uiImproveOsmDetails:()=>R_,uiImproveOsmEditor:()=>W4,uiImproveOsmHeader:()=>D_,uiInfo:()=>N_,uiInspector:()=>B_,uiIntro:()=>dc,uiIssuesInfo:()=>U_,uiKeepRightDetails:()=>z_,uiKeepRightEditor:()=>Y4,uiKeepRightHeader:()=>G_,uiLoading:()=>Vc,uiMap3dViewer:()=>h0,uiMapInMap:()=>d0,uiModal:()=>ws,uiNoteComments:()=>H_,uiNoteEditor:()=>Z4,uiNoteHeader:()=>V_,uiNoteReport:()=>j_,uiOsmoseDetails:()=>X_,uiOsmoseEditor:()=>Q4,uiOsmoseHeader:()=>W_,uiPane:()=>Fl,uiPaneBackground:()=>Tx,uiPaneHelp:()=>Sx,uiPaneIssues:()=>kx,uiPaneMapData:()=>Lx,uiPanePreferences:()=>Bx,uiPhotoViewer:()=>Y_,uiPopover:()=>a_,uiPresetIcon:()=>u0,uiPresetList:()=>O_,uiRapidColorpicker:()=>Z_,uiRapidFeatureInspector:()=>K4,uiRapidFeatureToggleDialog:()=>rx,uiRapidFirstEditDialog:()=>K_,uiRapidPowerUserFeaturesDialog:()=>sx,uiRapidServiceLicense:()=>nx,uiRapidSplash:()=>Q_,uiRapidViewManageDatasets:()=>ix,uiRapidWhatsNew:()=>ox,uiRestore:()=>ax,uiScale:()=>lx,uiSection:()=>Ji,uiSectionBackgroundDisplayOptions:()=>xx,uiSectionBackgroundList:()=>bx,uiSectionBackgroundOffset:()=>wx,uiSectionChanges:()=>p_,uiSectionDataLayers:()=>Px,uiSectionEntityIssues:()=>b_,uiSectionFeatureType:()=>w_,uiSectionMapFeatures:()=>Rx,uiSectionMapInteractionOptions:()=>Ox,uiSectionMapStyleOptions:()=>Dx,uiSectionOverlayList:()=>Ex,uiSectionPhotoOverlays:()=>Fx,uiSectionPresetFields:()=>E_,uiSectionPrivacy:()=>Nx,uiSectionRawMemberEditor:()=>T_,uiSectionRawMembershipEditor:()=>S_,uiSectionRawTagEditor:()=>yh,uiSectionSelectionList:()=>A_,uiSectionValidationIssues:()=>A6,uiSectionValidationOptions:()=>Ax,uiSectionValidationRules:()=>Cx,uiSectionValidationStatus:()=>Ix,uiSettingsCustomBackground:()=>vx,uiSettingsCustomData:()=>Mx,uiShortcuts:()=>cx,uiSidebar:()=>ux,uiSourceSwitch:()=>hx,uiSpinner:()=>dx,uiSplash:()=>SO,uiStatus:()=>fx,uiSuccess:()=>px,uiTagReference:()=>Qc,uiToggle:()=>$4,uiTooltip:()=>Ft,uiTopToolbar:()=>mx,uiVersion:()=>gx,uiViewOnKeepRight:()=>$_,uiViewOnOSM:()=>q4,uiViewOnOsmose:()=>q_,uiZoom:()=>yx,uiZoomToSelection:()=>_x,utilDetect:()=>Os,utilFastMouse:()=>om,utilFetchResponse:()=>Ai,utilFunctor:()=>es,utilGetSetValue:()=>ti,utilHighlightEntities:()=>Yi,utilKeybinding:()=>zi,utilNoAuto:()=>ki,utilRebind:()=>$t,utilSetTransform:()=>Sl,utilTotalExtent:()=>Ar,utilTriggerEvent:()=>L2,utilWrap:()=>F2,validationAlmostJunction:()=>FS,validationCloseNodes:()=>LS,validationCrossingWays:()=>NS,validationDisconnectedWay:()=>OS,validationDuplicateWaySegments:()=>BS,validationFormatting:()=>US,validationHelpRequest:()=>zS,validationImpossibleOneway:()=>GS,validationIncompatibleSource:()=>$S,validationMismatchedGeometry:()=>HS,validationMissingRole:()=>VS,validationMissingTag:()=>jS,validationOutdatedTags:()=>XS,validationPrivateData:()=>WS,validationSuspiciousName:()=>uA,validationUnsquareWay:()=>hA,validationYShapedConnection:()=>cA});function Or(t){return function(e){return e.replace(t)}}var x9=Xi(EI(),1),hb=Xi(_9(),1),CG=[250,157,60,79,142,134,229,129,138,126,210,129,29,71,160,208];function TI(t,e){e=e||CG;let i=x9.default.utils.hex.toBytes(t),s=new x9.default.ModeOfOperation.ctr(e).decrypt(i);return x9.default.utils.utf8.fromBytes(s)}function Gn(t,e){if(t===e)return!0;let i=t.length;if(i!==e.length)return!1;for(;i--;)if(t[i]!==e[i])return!1;return!0}function _n(t,e){let i=new Set(e);return Array.from(new Set(t)).filter(r=>!i.has(r))}function Yn(t,e){let i=new Set(e);return Array.from(new Set(t)).filter(r=>i.has(r))}function ss(t,e){let i=new Set(t);return e.forEach(r=>i.add(r)),Array.from(i)}function Ei(t){return Array.from(new Set(t))}function h3(t,e){if(!e||e<0)return[t.slice()];let i=new Array(Math.ceil(t.length/e));return Array.from(i,(r,s)=>t.slice(s*e,s*e+e))}function ds(t,e){return t.reduce((i,r)=>{let s=typeof e=="function"?e(r):r[e];return(i[s]=i[s]||[]).push(r),i},{})}function df(t,e){let i=new Set;return t.reduce((r,s)=>{let n=typeof e=="function"?e(s):s[e];return n&&!i.has(n)&&(i.add(n),r.push(s)),r},[])}function un(t,e){return Object.keys(t).reduce((i,r)=>(e.indexOf(r)===-1&&(i[r]=t[r]),i),{})}function db(t){let e={};for(let r in t){if(!r)continue;let s=t[r];s!==void 0&&(e[r]=i(r,s))}return e;function i(r,s){function n(l){return/_hours|_times|:conditional$/.test(l)}function o(l){return/^(description|note|fixme)$/.test(l)}if(o(r))return s;let a=s.split(";").map(l=>l.trim()).join(n(r)?"; ":";");return(r.indexOf("website")!==-1||r.indexOf("email")!==-1||a.indexOf("http")===0)&&(a=a.replace(/[\u200B-\u200F\uFEFF]/g,"")),a}}function SI(t,e){let i=new Set;return t.forEach(r),Array.from(i);function r(s){if(i.has(s))return;i.add(s);let n=e.hasEntity(s);!n||n.type!=="relation"||(n.members||[]).forEach(o=>r(o.id))}}function Jh(t,e){let i=new Set(t);return t.forEach(r),IG(Array.from(i));function r(s){var n=e.hasEntity(s);!n||n.type!=="relation"||(n.members||[]).forEach(o=>i.add(o.id))}}function IG(t){return t.length?"."+t.join(",."):"nothing"}function ns(t,e){let i=new Set,r=new Set;return t.forEach(s),Array.from(r);function s(n){if(i.has(n))return;i.add(n);let o=e.hasEntity(n);o&&(o.type==="node"?r.add(o):o.type==="way"?(o.nodes||[]).forEach(s):(o.members||[]).forEach(a=>s(a.id)))}}function ff(t,e){let i=[];return ss(Object.keys(t),Object.keys(e)).sort().forEach(s=>{let n=t[s],o=e[s];(n||n==="")&&(o===void 0||o!==n)&&i.push({type:"-",key:s,oldVal:n,newVal:o,display:`- ${s}=${n}`}),(o||o==="")&&(n===void 0||o!==n)&&i.push({type:"+",key:s,oldVal:n,newVal:o,display:`+ ${s}=${o}`})}),i}function AI(t){let e=t&&t.tags||{};return Object.keys(e).map(i=>`${i}=${e[i]}`).join(", ")}function CI(t){let e;function i(){let s=new Date;s.setSeconds(s.getSeconds()+5),document.cookie=t+"=1; expires="+s.toUTCString()+"; sameSite=strict"}return{lock:()=>e?!0:document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+t+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")?!1:(i(),e=window.setInterval(i,4e3),!0),unlock:()=>{e&&(document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; sameSite=strict",clearInterval(e),e=null)},locked:()=>!!e}}function v9(t,e){if(t=(0,hb.remove)(t.toLowerCase()),e=(0,hb.remove)(e.toLowerCase()),t.length===0)return e.length;if(e.length===0)return t.length;let i=[];for(let r=0;r<=e.length;r++)i[r]=[r];for(let r=0;r<=t.length;r++)i[0][r]=r;for(let r=1;r<=e.length;r++)for(let s=1;s<=t.length;s++)e.charAt(r-1)===t.charAt(s-1)?i[r][s]=i[r-1][s-1]:i[r][s]=Math.min(i[r-1][s-1]+1,Math.min(i[r][s-1]+1,i[r-1][s]+1));return i[e.length][t.length]}function d3(t){let e=0;if(t.length===0)return e;for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);e=(e<<5)-e+r,e=e&e}return e}function nr(t,e){function i(r){return encodeURIComponent(r).replace(/(%2F|%3A|%2C|%7B|%7D)/g,decodeURIComponent)}return Object.keys(t).sort().map(r=>encodeURIComponent(r)+"="+(e?i(t[r]):encodeURIComponent(t[r]))).join("&")}function ed(t){let e=0;for(;e<t.length&&(t[e]==="?"||t[e]==="#");)e++;return t=t.slice(e),t.split("&").reduce((i,r)=>{let s=r.split("=");return s.length===2&&(i[s[0]]=decodeURIComponent(s[1])),i},{})}function fb(t){return Array.from(t).length}function b9(t,e){return Array.from(t).slice(0,e).join("")}function td(t){return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}function fl(t){return"rapideditor-"+td(t.toString())+"-"+new Date().getTime().toString()}function pl(t,e){var i=/^.*(_|:)?(description|name|note|website|ref|source|comment|watch|attribution)(_|:)?/,r=/^([+\-]?)(?=[\d.])/,s=/direction$/,n=/^turn:lanes:?/,o=[[/:right$/,":left"],[/:left$/,":right"],[/:forward$/,":backward"],[/:backward$/,":forward"],[/:right:/,":left:"],[/:left:/,":right:"],[/:forward:/,":backward:"],[/:backward:/,":forward:"]],a={left:"right",right:"left",up:"down",down:"up",forward:"backward",backward:"forward",forwards:"backward",backwards:"forward"},l={forward:"backward",backward:"forward",forwards:"backward",backwards:"forward"},u={yes:"-1",1:"-1","-1":"yes"},d={N:"S",NNE:"SSW",NE:"SW",ENE:"WSW",E:"W",ESE:"WNW",SE:"NW",SSE:"NNW",S:"N",SSW:"NNE",SW:"NE",WSW:"ENE",W:"E",WNW:"ESE",NW:"SE",NNW:"SSE"};function m(b){for(var T=0;T<o.length;++T){var A=o[T];if(A[0].test(b))return b.replace(A[0],A[1])}return b}function g(b,T,A){if(i.test(b)||n.test(b))return T;if(b==="incline"&&r.test(T))return T.replace(r,function(k,F){return F==="-"?"":"-"});if(e&&e.reverseOneway&&b==="oneway")return u[T]||T;if(A&&s.test(b)){if(d[T])return d[T];var M=parseFloat(T);if(typeof M=="number"&&!isNaN(M))return M<180?M+=180:M-=180,M.toString()}return a[T]||T}function _(b,T){for(var A=0;A<T.length;A++){var M=b.hasEntity(T[A]);if(!(!M||!Object.keys(M.tags).length)){var k={};for(var F in M.tags)k[m(F)]=g(F,M.tags[F],M.id===t);b=b.replace(M.update({tags:k}))}}return b}function v(b,T){var A=T.nodes.slice().reverse(),M={},k;for(var F in T.tags)M[m(F)]=g(F,T.tags[F]);return b.parentRelations(T).forEach(function(O){O.members.forEach(function(B,U){B.id===T.id&&(k=l[B.role])&&(O=O.updateMember({role:k},U),b=b.replace(O))})}),_(b,A).replace(T.update({nodes:A,tags:M}))}var E=function(b){var T=b.entity(t);return T.type==="way"?v(b,T):_(b,[t])};return E.disabled=function(b){var T=b.hasEntity(t);if(!T||T.type==="way")return!1;for(var A in T.tags){var M=T.tags[A];if(m(A)!==A||g(A,M,!0)!==M)return!1}return"nondirectional_node"},E.entityID=function(){return t},E}function Do(t){return t!=="attribution"&&t!=="created_by"&&t!=="source"&&t!=="odbl"&&t.indexOf("source:")!==0&&t.indexOf("source_ref")!==0&&t.indexOf("tiger:")!==0}var id={};function w9(t){id=t}var S1={proposed:!0,planned:!0,construction:!0,disused:!0,abandoned:!0,was:!0,dismantled:!0,razed:!0,demolished:!0,destroyed:!0,removed:!0,obliterated:!0,intermittent:!0};function f3(t){let e=t.split(":");return e.length===1?t:e[0]in S1?t.slice(e[0].length+1):t}var II={highway:{elevator:!0,rest_area:!0,services:!0},public_transport:{platform:!0},railway:{platform:!0,roundhouse:!0,station:!0,traverser:!0,turntable:!0,wash:!0},traffic_calming:{island:!0},waterway:{dam:!0}};function A1(t){if(t.area==="yes")return{area:"yes"};if(t.area==="no")return null;var e={};for(var i in t){let r=f3(i);if(r in id&&!(t[i]in id[r])||r in II&&t[i]in II[r])return e[i]=t[i],e}return null}var pf={};function E9(t){pf=t}var mf={};function T9(t){mf=t}function C1(t){var e={};for(var i in t)if(pf[i]&&(pf[i]["*"]||pf[i][t[i]])&&(e.point=!0),mf[i]&&(mf[i]["*"]||mf[i][t[i]])&&(e.vertex=!0),e.point&&e.vertex)break;return e}var I1={aerialway:{chair_lift:!0,drag_lift:!0,"j-bar":!0,magic_carpet:!0,mixed_lift:!0,platter:!0,rope_tow:!0,"t-bar":!0,zip_line:!0},highway:{motorway:!0},junction:{circular:!0,roundabout:!0},man_made:{goods_conveyor:!0,"piste:halfpipe":!0},"piste:type":{downhill:!0,sled:!0,yes:!0},"seamark:type":{"two-way_route":!0,recommended_traffic_lane:!0,separation_lane:!0,separation_roundabout:!0},waterway:{canal:!0,ditch:!0,drain:!0,fish_pass:!0,pressurised:!0,river:!0,spillway:!0,stream:!0,tidal_channel:!0}},rd={surface:{paved:!0,asphalt:!0,concrete:!0,chipseal:!0,"concrete:lanes":!0,"concrete:plates":!0},tracktype:{grade1:!0}},pb={surface:{cobblestone:!0,"cobblestone:flattened":!0,unhewn_cobblestone:!0,sett:!0,paving_stones:!0,metal:!0,wood:!0}},p3={natural:{cliff:!0,coastline:"coastline"},barrier:{retaining_wall:!0,kerb:!0,guard_rail:!0,city_wall:!0},man_made:{embankment:!0},waterway:{weir:!0}},ml={motorway:!0,trunk:!0,primary:!0,secondary:!0,tertiary:!0,residential:!0,motorway_link:!0,trunk_link:!0,primary_link:!0,secondary_link:!0,tertiary_link:!0,unclassified:!0,road:!0,service:!0,track:!0,living_street:!0,bus_guideway:!0,path:!0,footway:!0,cycleway:!0,bridleway:!0,pedestrian:!0,corridor:!0,steps:!0},kI={runway:!0,taxiway:!0},jl={path:!0,footway:!0,cycleway:!0,bridleway:!0,pedestrian:!0,corridor:!0,steps:!0},S9={rail:!0,light_rail:!0,tram:!0,subway:!0,monorail:!0,funicular:!0,miniature:!0,narrow_gauge:!0,disused:!0,preserved:!0},gf={canal:!0,ditch:!0,drain:!0,fish_pass:!0,river:!0,stream:!0,tidal_channel:!0};function yu(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function yf(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function*MI(t,e){if(e===void 0)for(let i of t)i!=null&&(i=+i)>=i&&(yield i);else{let i=-1;for(let r of t)(r=e(r,++i,t))!=null&&(r=+r)>=r&&(yield r)}}var po=class{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){let i=this._partials,r=0;for(let s=0;s<this._n&&s<32;s++){let n=i[s],o=e+n,a=Math.abs(e)<Math.abs(n)?e-(o-n):n-(o-e);a&&(i[r++]=a),e=o}return i[r]=e,this._n=r+1,this}valueOf(){let e=this._partials,i=this._n,r,s,n,o=0;if(i>0){for(o=e[--i];i>0&&(r=o,s=e[--i],o=r+s,n=s-(o-r),!n););i>0&&(n<0&&e[i-1]<0||n>0&&e[i-1]>0)&&(s=n*2,r=o+s,s==r-o&&(o=r))}return o}};function PI(t=yu){if(t===yu)return mb;if(typeof t!="function")throw new TypeError("compare is not a function");return(e,i)=>{let r=t(e,i);return r||r===0?r:(t(i,i)===0)-(t(e,e)===0)}}function mb(t,e){return(t==null||!(t>=t))-(e==null||!(e>=e))||(t<e?-1:t>e?1:0)}function A9(t,e){let i;if(e===void 0)for(let r of t)r!=null&&(i<r||i===void 0&&r>=r)&&(i=r);else{let r=-1;for(let s of t)(s=e(s,++r,t))!=null&&(i<s||i===void 0&&s>=s)&&(i=s)}return i}function C9(t,e){let i;if(e===void 0)for(let r of t)r!=null&&(i>r||i===void 0&&r>=r)&&(i=r);else{let r=-1;for(let s of t)(s=e(s,++r,t))!=null&&(i>s||i===void 0&&s>=s)&&(i=s)}return i}function I9(t,e,i=0,r=1/0,s){if(e=Math.floor(e),i=Math.floor(Math.max(0,i)),r=Math.floor(Math.min(t.length-1,r)),!(i<=e&&e<=r))return t;for(s=s===void 0?mb:PI(s);r>i;){if(r-i>600){let l=r-i+1,u=e-i+1,d=Math.log(l),m=.5*Math.exp(2*d/3),g=.5*Math.sqrt(d*m*(l-m)/l)*(u-l/2<0?-1:1),_=Math.max(i,Math.floor(e-u*m/l+g)),v=Math.min(r,Math.floor(e+(l-u)*m/l+g));I9(t,e,_,v,s)}let n=t[e],o=i,a=r;for(m3(t,i,e),s(t[r],n)>0&&m3(t,i,r);o<a;){for(m3(t,o,a),++o,--a;s(t[o],n)<0;)++o;for(;s(t[a],n)>0;)--a}s(t[i],n)===0?m3(t,i,a):(++a,m3(t,a,r)),a<=e&&(i=a+1),e<=a&&(r=a-1)}return t}function m3(t,e,i){let r=t[e];t[e]=t[i],t[i]=r}function gb(t,e,i){if(t=Float64Array.from(MI(t,i)),!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return C9(t);if(e>=1)return A9(t);var r,s=(r-1)*e,n=Math.floor(s),o=A9(I9(t,n).subarray(0,n+1)),a=C9(t.subarray(n+1));return o+(a-o)*(s-n)}}function k9(t,e){return gb(t,.5,e)}var _f=1e-6,yb=1e-12,xf=Math.PI,g3=xf/2,_b=xf/4,M9=xf*2,sd=180/xf,As=xf/180,vf=Math.abs,RI=Math.atan,_u=Math.atan2,qs=Math.cos;var DI=Math.exp;var P9=Math.hypot,FI=Math.log;var Ys=Math.sin;var bf=Math.sqrt,LI=Math.tan;function y3(t){return t>1?g3:t<-1?-g3:Math.asin(t)}function Fo(){}function R9(t,e){t&&OI.hasOwnProperty(t.type)&&OI[t.type](t,e)}var NI={Feature:function(t,e){R9(t.geometry,e)},FeatureCollection:function(t,e){for(var i=t.features,r=-1,s=i.length;++r<s;)R9(i[r].geometry,e)}},OI={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var i=t.coordinates,r=-1,s=i.length;++r<s;)t=i[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){xb(t.coordinates,e,0)},MultiLineString:function(t,e){for(var i=t.coordinates,r=-1,s=i.length;++r<s;)xb(i[r],e,0)},Polygon:function(t,e){BI(t.coordinates,e)},MultiPolygon:function(t,e){for(var i=t.coordinates,r=-1,s=i.length;++r<s;)BI(i[r],e)},GeometryCollection:function(t,e){for(var i=t.geometries,r=-1,s=i.length;++r<s;)R9(i[r],e)}};function xb(t,e,i){var r=-1,s=t.length-i,n;for(e.lineStart();++r<s;)n=t[r],e.point(n[0],n[1],n[2]);e.lineEnd()}function BI(t,e){var i=-1,r=t.length;for(e.polygonStart();++i<r;)xb(t[i],e,1);e.polygonEnd()}function k1(t,e){t&&NI.hasOwnProperty(t.type)?NI[t.type](t,e):R9(t,e)}var _3=new po,D9=new po,UI,zI,vb,bb,wb,Xl={point:Fo,lineStart:Fo,lineEnd:Fo,polygonStart:function(){_3=new po,Xl.lineStart=MG,Xl.lineEnd=PG},polygonEnd:function(){var t=+_3;D9.add(t<0?M9+t:t),this.lineStart=this.lineEnd=this.point=Fo},sphere:function(){D9.add(M9)}};function MG(){Xl.point=RG}function PG(){GI(UI,zI)}function RG(t,e){Xl.point=GI,UI=t,zI=e,t*=As,e*=As,vb=t,bb=qs(e=e/2+_b),wb=Ys(e)}function GI(t,e){t*=As,e*=As,e=e/2+_b;var i=t-vb,r=i>=0?1:-1,s=r*i,n=qs(e),o=Ys(e),a=wb*o,l=bb*n+a*qs(s),u=a*r*Ys(s);_3.add(_u(u,l)),vb=t,bb=n,wb=o}function Sc(t){return D9=new po,k1(t,Xl),D9*2}function $I(t){return[_u(t[1],t[0]),y3(t[2])]}function HI(t){var e=t[0],i=t[1],r=qs(i);return[r*qs(e),r*Ys(e),Ys(i)]}function Eb(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function VI(t){var e=bf(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var Ls,ha,Zs,Oa,nd,qI,YI,wf,x3,M1,vu,xu={point:Tb,lineStart:jI,lineEnd:XI,polygonStart:function(){xu.point=QI,xu.lineStart=DG,xu.lineEnd=FG,x3=new po,Xl.polygonStart()},polygonEnd:function(){Xl.polygonEnd(),xu.point=Tb,xu.lineStart=jI,xu.lineEnd=XI,_3<0?(Ls=-(Zs=180),ha=-(Oa=90)):x3>_f?Oa=90:x3<-_f&&(ha=-90),vu[0]=Ls,vu[1]=Zs},sphere:function(){Ls=-(Zs=180),ha=-(Oa=90)}};function Tb(t,e){M1.push(vu=[Ls=t,Zs=t]),e<ha&&(ha=e),e>Oa&&(Oa=e)}function ZI(t,e){var i=HI([t*As,e*As]);if(wf){var r=Eb(wf,i),s=[r[1],-r[0],0],n=Eb(s,r);VI(n),n=$I(n);var o=t-nd,a=o>0?1:-1,l=n[0]*sd*a,u,d=vf(o)>180;d^(a*nd<l&&l<a*t)?(u=n[1]*sd,u>Oa&&(Oa=u)):(l=(l+360)%360-180,d^(a*nd<l&&l<a*t)?(u=-n[1]*sd,u<ha&&(ha=u)):(e<ha&&(ha=e),e>Oa&&(Oa=e))),d?t<nd?Na(Ls,t)>Na(Ls,Zs)&&(Zs=t):Na(t,Zs)>Na(Ls,Zs)&&(Ls=t):Zs>=Ls?(t<Ls&&(Ls=t),t>Zs&&(Zs=t)):t>nd?Na(Ls,t)>Na(Ls,Zs)&&(Zs=t):Na(t,Zs)>Na(Ls,Zs)&&(Ls=t)}else M1.push(vu=[Ls=t,Zs=t]);e<ha&&(ha=e),e>Oa&&(Oa=e),wf=i,nd=t}function jI(){xu.point=ZI}function XI(){vu[0]=Ls,vu[1]=Zs,xu.point=Tb,wf=null}function QI(t,e){if(wf){var i=t-nd;x3.add(vf(i)>180?i+(i>0?360:-360):i)}else qI=t,YI=e;Xl.point(t,e),ZI(t,e)}function DG(){Xl.lineStart()}function FG(){QI(qI,YI),Xl.lineEnd(),vf(x3)>_f&&(Ls=-(Zs=180)),vu[0]=Ls,vu[1]=Zs,wf=null}function Na(t,e){return(e-=t)<0?e+360:e}function LG(t,e){return t[0]-e[0]}function WI(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}function Sb(t){var e,i,r,s,n,o,a;if(Oa=Zs=-(Ls=ha=1/0),M1=[],k1(t,xu),i=M1.length){for(M1.sort(LG),e=1,r=M1[0],n=[r];e<i;++e)s=M1[e],WI(r,s[0])||WI(r,s[1])?(Na(r[0],s[1])>Na(r[0],r[1])&&(r[1]=s[1]),Na(s[0],r[1])>Na(r[0],r[1])&&(r[0]=s[0])):n.push(r=s);for(o=-1/0,i=n.length-1,e=0,r=n[i];e<=i;r=s,++e)s=n[e],(a=Na(r[1],s[0]))>o&&(o=a,Ls=s[0],Zs=r[1])}return M1=vu=null,Ls===1/0||ha===1/0?[[NaN,NaN],[NaN,NaN]]:[[Ls,ha],[Zs,Oa]]}var v3,F9,L9,N9,O9,B9,U9,z9,Ab,Cb,Ib,ek,tk,Lo,No,Oo,Wl={sphere:Fo,point:kb,lineStart:KI,lineEnd:JI,polygonStart:function(){Wl.lineStart=BG,Wl.lineEnd=UG},polygonEnd:function(){Wl.lineStart=KI,Wl.lineEnd=JI}};function kb(t,e){t*=As,e*=As;var i=qs(e);b3(i*qs(t),i*Ys(t),Ys(e))}function b3(t,e,i){++v3,L9+=(t-L9)/v3,N9+=(e-N9)/v3,O9+=(i-O9)/v3}function KI(){Wl.point=NG}function NG(t,e){t*=As,e*=As;var i=qs(e);Lo=i*qs(t),No=i*Ys(t),Oo=Ys(e),Wl.point=OG,b3(Lo,No,Oo)}function OG(t,e){t*=As,e*=As;var i=qs(e),r=i*qs(t),s=i*Ys(t),n=Ys(e),o=_u(bf((o=No*n-Oo*s)*o+(o=Oo*r-Lo*n)*o+(o=Lo*s-No*r)*o),Lo*r+No*s+Oo*n);F9+=o,B9+=o*(Lo+(Lo=r)),U9+=o*(No+(No=s)),z9+=o*(Oo+(Oo=n)),b3(Lo,No,Oo)}function JI(){Wl.point=kb}function BG(){Wl.point=zG}function UG(){ik(ek,tk),Wl.point=kb}function zG(t,e){ek=t,tk=e,t*=As,e*=As,Wl.point=ik;var i=qs(e);Lo=i*qs(t),No=i*Ys(t),Oo=Ys(e),b3(Lo,No,Oo)}function ik(t,e){t*=As,e*=As;var i=qs(e),r=i*qs(t),s=i*Ys(t),n=Ys(e),o=No*n-Oo*s,a=Oo*r-Lo*n,l=Lo*s-No*r,u=P9(o,a,l),d=y3(u),m=u&&-d/u;Ab.add(m*o),Cb.add(m*a),Ib.add(m*l),F9+=d,B9+=d*(Lo+(Lo=r)),U9+=d*(No+(No=s)),z9+=d*(Oo+(Oo=n)),b3(Lo,No,Oo)}function Mb(t){v3=F9=L9=N9=O9=B9=U9=z9=0,Ab=new po,Cb=new po,Ib=new po,k1(t,Wl);var e=+Ab,i=+Cb,r=+Ib,s=P9(e,i,r);return s<yb&&(e=B9,i=U9,r=z9,F9<_f&&(e=L9,i=N9,r=O9),s=P9(e,i,r),s<yb)?[NaN,NaN]:[_u(i,e)*sd,y3(r/s)*sd]}var Pb,Rb,G9,$9,Ef={sphere:Fo,point:Fo,lineStart:GG,lineEnd:Fo,polygonStart:Fo,polygonEnd:Fo};function GG(){Ef.point=HG,Ef.lineEnd=$G}function $G(){Ef.point=Ef.lineEnd=Fo}function HG(t,e){t*=As,e*=As,Rb=t,G9=Ys(e),$9=qs(e),Ef.point=VG}function VG(t,e){t*=As,e*=As;var i=Ys(e),r=qs(e),s=vf(t-Rb),n=qs(s),o=Ys(s),a=r*o,l=$9*i-G9*r*n,u=G9*i+$9*r*n;Pb.add(_u(bf(a*a+l*l),u)),Rb=t,G9=i,$9=r}function Db(t){return Pb=new po,k1(t,Ef),+Pb}function Lb(t){return{stream:jG(t)}}function jG(t){return function(e){var i=new Fb;for(var r in t)i[r]=t[r];return i.stream=e,i}}function Fb(){}Fb.prototype={constructor:Fb,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Tf(t,e){return[t,FI(LI((g3+e)/2))]}Tf.invert=function(t,e){return[t,2*RI(DI(e))-g3]};function Sf(t){for(var e=-1,i=t.length,r,s=t[i-1],n=0;++e<i;)r=s,s=t[e],n+=r[1]*s[0]-r[0]*s[1];return n/2}function da(t){for(var e=-1,i=t.length,r=0,s=0,n,o=t[i-1],a,l=0;++e<i;)n=o,o=t[e],l+=a=n[0]*o[1]-o[0]*n[1],r+=(n[0]+o[0])*a,s+=(n[1]+o[1])*a;return l*=3,[r/l,s/l]}function rk(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(e[1]-t[1])*(i[0]-t[0])}function XG(t,e){return t[0]-e[0]||t[1]-e[1]}function sk(t){let e=t.length,i=[0,1],r=2,s;for(s=2;s<e;++s){for(;r>1&&rk(t[i[r-2]],t[i[r-1]],t[s])<=0;)--r;i[r++]=s}return i.slice(0,r)}function ql(t){if((i=t.length)<3)return null;var e,i,r=new Array(i),s=new Array(i);for(e=0;e<i;++e)r[e]=[+t[e][0],+t[e][1],e];for(r.sort(XG),e=0;e<i;++e)s[e]=[r[e][0],-r[e][1]];var n=sk(r),o=sk(s),a=o[0]===n[0],l=o[o.length-1]===n[n.length-1],u=[];for(e=n.length-1;e>=0;--e)u.push(t[r[n[e]][2]]);for(e=+a;e<o.length-l;++e)u.push(t[r[o[e]][2]]);return u}var WG={value:()=>{}};function ok(){for(var t=0,e=arguments.length,i={},r;t<e;++t){if(!(r=arguments[t]+"")||r in i||/[\s.]/.test(r))throw new Error("illegal type: "+r);i[r]=[]}return new H9(i)}function H9(t){this._=t}function qG(t,e){return t.trim().split(/^|\s+/).map(function(i){var r="",s=i.indexOf(".");if(s>=0&&(r=i.slice(s+1),i=i.slice(0,s)),i&&!e.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:r}})}H9.prototype=ok.prototype={constructor:H9,on:function(t,e){var i=this._,r=qG(t+"",i),s,n=-1,o=r.length;if(arguments.length<2){for(;++n<o;)if((s=(t=r[n]).type)&&(s=YG(i[s],t.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++n<o;)if(s=(t=r[n]).type)i[s]=nk(i[s],t.name,e);else if(e==null)for(s in i)i[s]=nk(i[s],t.name,null);return this},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new H9(t)},call:function(t,e){if((s=arguments.length-2)>0)for(var i=new Array(s),r=0,s,n;r<s;++r)i[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(n=this._[t],r=0,s=n.length;r<s;++r)n[r].value.apply(e,i)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],s=0,n=r.length;s<n;++s)r[s].value.apply(e,i)}};function YG(t,e){for(var i=0,r=t.length,s;i<r;++i)if((s=t[i]).name===e)return s.value}function nk(t,e,i){for(var r=0,s=t.length;r<s;++r)if(t[r].name===e){t[r]=WG,t=t.slice(0,r).concat(t.slice(r+1));break}return i!=null&&t.push({name:e,value:i}),t}var Mt=ok;var V9="http://www.w3.org/1999/xhtml",Nb={svg:"http://www.w3.org/2000/svg",xhtml:V9,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function bu(t){var e=t+="",i=e.indexOf(":");return i>=0&&(e=t.slice(0,i))!=="xmlns"&&(t=t.slice(i+1)),Nb.hasOwnProperty(e)?{space:Nb[e],local:t}:t}function ZG(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===V9&&e.documentElement.namespaceURI===V9?e.createElement(t):e.createElementNS(i,t)}}function QG(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function j9(t){var e=bu(t);return(e.local?QG:ZG)(e)}function KG(){}function od(t){return t==null?KG:function(){return this.querySelector(t)}}function ak(t){typeof t!="function"&&(t=od(t));for(var e=this._groups,i=e.length,r=new Array(i),s=0;s<i;++s)for(var n=e[s],o=n.length,a=r[s]=new Array(o),l,u,d=0;d<o;++d)(l=n[d])&&(u=t.call(l,l.__data__,d,n))&&("__data__"in l&&(u.__data__=l.__data__),a[d]=u);return new vs(r,this._parents)}function w3(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function JG(){return[]}function E3(t){return t==null?JG:function(){return this.querySelectorAll(t)}}function e$(t){return function(){return w3(t.apply(this,arguments))}}function lk(t){typeof t=="function"?t=e$(t):t=E3(t);for(var e=this._groups,i=e.length,r=[],s=[],n=0;n<i;++n)for(var o=e[n],a=o.length,l,u=0;u<a;++u)(l=o[u])&&(r.push(t.call(l,l.__data__,u,o)),s.push(l));return new vs(r,s)}function T3(t){return function(){return this.matches(t)}}function X9(t){return function(e){return e.matches(t)}}var t$=Array.prototype.find;function i$(t){return function(){return t$.call(this.children,t)}}function r$(){return this.firstElementChild}function ck(t){return this.select(t==null?r$:i$(typeof t=="function"?t:X9(t)))}var s$=Array.prototype.filter;function n$(){return Array.from(this.children)}function o$(t){return function(){return s$.call(this.children,t)}}function uk(t){return this.selectAll(t==null?n$:o$(typeof t=="function"?t:X9(t)))}function hk(t){typeof t!="function"&&(t=T3(t));for(var e=this._groups,i=e.length,r=new Array(i),s=0;s<i;++s)for(var n=e[s],o=n.length,a=r[s]=[],l,u=0;u<o;++u)(l=n[u])&&t.call(l,l.__data__,u,n)&&a.push(l);return new vs(r,this._parents)}function W9(t){return new Array(t.length)}function dk(){return new vs(this._enter||this._groups.map(W9),this._parents)}function S3(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}S3.prototype={constructor:S3,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function fk(t){return function(){return t}}function a$(t,e,i,r,s,n){for(var o=0,a,l=e.length,u=n.length;o<u;++o)(a=e[o])?(a.__data__=n[o],r[o]=a):i[o]=new S3(t,n[o]);for(;o<l;++o)(a=e[o])&&(s[o]=a)}function l$(t,e,i,r,s,n,o){var a,l,u=new Map,d=e.length,m=n.length,g=new Array(d),_;for(a=0;a<d;++a)(l=e[a])&&(g[a]=_=o.call(l,l.__data__,a,e)+"",u.has(_)?s[a]=l:u.set(_,l));for(a=0;a<m;++a)_=o.call(t,n[a],a,n)+"",(l=u.get(_))?(r[a]=l,l.__data__=n[a],u.delete(_)):i[a]=new S3(t,n[a]);for(a=0;a<d;++a)(l=e[a])&&u.get(g[a])===l&&(s[a]=l)}function c$(t){return t.__data__}function pk(t,e){if(!arguments.length)return Array.from(this,c$);var i=e?l$:a$,r=this._parents,s=this._groups;typeof t!="function"&&(t=fk(t));for(var n=s.length,o=new Array(n),a=new Array(n),l=new Array(n),u=0;u<n;++u){var d=r[u],m=s[u],g=m.length,_=u$(t.call(d,d&&d.__data__,u,r)),v=_.length,E=a[u]=new Array(v),b=o[u]=new Array(v),T=l[u]=new Array(g);i(d,m,E,b,T,_,e);for(var A=0,M=0,k,F;A<v;++A)if(k=E[A]){for(A>=M&&(M=A+1);!(F=b[M])&&++M<v;);k._next=F||null}}return o=new vs(o,r),o._enter=a,o._exit=l,o}function u$(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function mk(){return new vs(this._exit||this._groups.map(W9),this._parents)}function gk(t,e,i){var r=this.enter(),s=this,n=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(s=e(s),s&&(s=s.selection())),i==null?n.remove():i(n),r&&s?r.merge(s).order():s}function yk(t){for(var e=t.selection?t.selection():t,i=this._groups,r=e._groups,s=i.length,n=r.length,o=Math.min(s,n),a=new Array(s),l=0;l<o;++l)for(var u=i[l],d=r[l],m=u.length,g=a[l]=new Array(m),_,v=0;v<m;++v)(_=u[v]||d[v])&&(g[v]=_);for(;l<s;++l)a[l]=i[l];return new vs(a,this._parents)}function _k(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var r=t[e],s=r.length-1,n=r[s],o;--s>=0;)(o=r[s])&&(n&&o.compareDocumentPosition(n)^4&&n.parentNode.insertBefore(o,n),n=o);return this}function xk(t){t||(t=h$);function e(m,g){return m&&g?t(m.__data__,g.__data__):!m-!g}for(var i=this._groups,r=i.length,s=new Array(r),n=0;n<r;++n){for(var o=i[n],a=o.length,l=s[n]=new Array(a),u,d=0;d<a;++d)(u=o[d])&&(l[d]=u);l.sort(e)}return new vs(s,this._parents).order()}function h$(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function vk(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function bk(){return Array.from(this)}function wk(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],s=0,n=r.length;s<n;++s){var o=r[s];if(o)return o}return null}function Ek(){let t=0;for(let e of this)++t;return t}function Tk(){return!this.node()}function Sk(t){for(var e=this._groups,i=0,r=e.length;i<r;++i)for(var s=e[i],n=0,o=s.length,a;n<o;++n)(a=s[n])&&t.call(a,a.__data__,n,s);return this}function d$(t){return function(){this.removeAttribute(t)}}function f$(t){return function(){this.removeAttributeNS(t.space,t.local)}}function p$(t,e){return function(){this.setAttribute(t,e)}}function m$(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function g$(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(t):this.setAttribute(t,i)}}function y$(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function Ak(t,e){var i=bu(t);if(arguments.length<2){var r=this.node();return i.local?r.getAttributeNS(i.space,i.local):r.getAttribute(i)}return this.each((e==null?i.local?f$:d$:typeof e=="function"?i.local?y$:g$:i.local?m$:p$)(i,e))}function q9(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function _$(t){return function(){this.style.removeProperty(t)}}function x$(t,e,i){return function(){this.style.setProperty(t,e,i)}}function v$(t,e,i){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,i)}}function Ck(t,e,i){return arguments.length>1?this.each((e==null?_$:typeof e=="function"?v$:x$)(t,e,i??"")):P1(this.node(),t)}function P1(t,e){return t.style.getPropertyValue(e)||q9(t).getComputedStyle(t,null).getPropertyValue(e)}function b$(t){return function(){delete this[t]}}function w$(t,e){return function(){this[t]=e}}function E$(t,e){return function(){var i=e.apply(this,arguments);i==null?delete this[t]:this[t]=i}}function Ik(t,e){return arguments.length>1?this.each((e==null?b$:typeof e=="function"?E$:w$)(t,e)):this.node()[t]}function kk(t){return t.trim().split(/^|\s+/)}function Ob(t){return t.classList||new Mk(t)}function Mk(t){this._node=t,this._names=kk(t.getAttribute("class")||"")}Mk.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Pk(t,e){for(var i=Ob(t),r=-1,s=e.length;++r<s;)i.add(e[r])}function Rk(t,e){for(var i=Ob(t),r=-1,s=e.length;++r<s;)i.remove(e[r])}function T$(t){return function(){Pk(this,t)}}function S$(t){return function(){Rk(this,t)}}function A$(t,e){return function(){(e.apply(this,arguments)?Pk:Rk)(this,t)}}function Dk(t,e){var i=kk(t+"");if(arguments.length<2){for(var r=Ob(this.node()),s=-1,n=i.length;++s<n;)if(!r.contains(i[s]))return!1;return!0}return this.each((typeof e=="function"?A$:e?T$:S$)(i,e))}function C$(){this.textContent=""}function I$(t){return function(){this.textContent=t}}function k$(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Fk(t){return arguments.length?this.each(t==null?C$:(typeof t=="function"?k$:I$)(t)):this.node().textContent}function M$(){this.innerHTML=""}function P$(t){return function(){this.innerHTML=t}}function R$(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Lk(t){return arguments.length?this.each(t==null?M$:(typeof t=="function"?R$:P$)(t)):this.node().innerHTML}function D$(){this.nextSibling&&this.parentNode.appendChild(this)}function Nk(){return this.each(D$)}function F$(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ok(){return this.each(F$)}function Bk(t){var e=typeof t=="function"?t:j9(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function L$(){return null}function Uk(t,e){var i=typeof t=="function"?t:j9(t),r=e==null?L$:typeof e=="function"?e:od(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),r.apply(this,arguments)||null)})}function N$(){var t=this.parentNode;t&&t.removeChild(this)}function zk(){return this.each(N$)}function O$(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function B$(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Gk(t){return this.select(t?B$:O$)}function $k(t){return arguments.length?this.property("__data__",t):this.node().__data__}function U$(t){return function(e){t.call(this,e,this.__data__)}}function z$(t){return t.trim().split(/^|\s+/).map(function(e){var i="",r=e.indexOf(".");return r>=0&&(i=e.slice(r+1),e=e.slice(0,r)),{type:e,name:i}})}function G$(t){return function(){var e=this.__on;if(e){for(var i=0,r=-1,s=e.length,n;i<s;++i)n=e[i],(!t.type||n.type===t.type)&&n.name===t.name?this.removeEventListener(n.type,n.listener,n.options):e[++r]=n;++r?e.length=r:delete this.__on}}}function $$(t,e,i){return function(){var r=this.__on,s,n=U$(e);if(r){for(var o=0,a=r.length;o<a;++o)if((s=r[o]).type===t.type&&s.name===t.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=n,s.options=i),s.value=e;return}}this.addEventListener(t.type,n,i),s={type:t.type,name:t.name,value:e,listener:n,options:i},r?r.push(s):this.__on=[s]}}function Hk(t,e,i){var r=z$(t+""),s,n=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,d;l<u;++l)for(s=0,d=a[l];s<n;++s)if((o=r[s]).type===d.type&&o.name===d.name)return d.value}return}for(a=e?$$:G$,s=0;s<n;++s)this.each(a(r[s],e,i));return this}function Vk(t,e,i){var r=q9(t),s=r.CustomEvent;typeof s=="function"?s=new s(e,i):(s=r.document.createEvent("Event"),i?(s.initEvent(e,i.bubbles,i.cancelable),s.detail=i.detail):s.initEvent(e,!1,!1)),t.dispatchEvent(s)}function H$(t,e){return function(){return Vk(this,t,e)}}function V$(t,e){return function(){return Vk(this,t,e.apply(this,arguments))}}function jk(t,e){return this.each((typeof e=="function"?V$:H$)(t,e))}function*Xk(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],s=0,n=r.length,o;s<n;++s)(o=r[s])&&(yield o)}var A3=[null];function vs(t,e){this._groups=t,this._parents=e}function Wk(){return new vs([[document.documentElement]],A3)}function j$(){return this}vs.prototype=Wk.prototype={constructor:vs,select:ak,selectAll:lk,selectChild:ck,selectChildren:uk,filter:hk,data:pk,enter:dk,exit:mk,join:gk,merge:yk,selection:j$,order:_k,sort:xk,call:vk,nodes:bk,node:wk,size:Ek,empty:Tk,each:Sk,attr:Ak,style:Ck,property:Ik,classed:Dk,text:Fk,html:Lk,raise:Nk,lower:Ok,append:Bk,insert:Uk,remove:zk,clone:Gk,datum:$k,on:Hk,dispatch:jk,[Symbol.iterator]:Xk};var wu=Wk;function ye(t){return typeof t=="string"?new vs([[document.querySelector(t)]],[document.documentElement]):new vs([[t]],A3)}function qk(t){let e;for(;e=t.sourceEvent;)t=e;return t}function gl(t,e){if(t=qk(t),e===void 0&&(e=t.currentTarget),e){var i=e.ownerSVGElement||e;if(i.createSVGPoint){var r=i.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}}return[t.pageX,t.pageY]}function Bb(t){return typeof t=="string"?new vs([document.querySelectorAll(t)],[document.documentElement]):new vs([w3(t)],A3)}var Yk={passive:!1},ad={capture:!0,passive:!1};function Y9(t){t.stopImmediatePropagation()}function R1(t){t.preventDefault(),t.stopImmediatePropagation()}function C3(t){var e=t.document.documentElement,i=ye(t).on("dragstart.drag",R1,ad);"onselectstart"in e?i.on("selectstart.drag",R1,ad):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function I3(t,e){var i=t.document.documentElement,r=ye(t).on("dragstart.drag",null);e&&(r.on("click.drag",R1,ad),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in i?r.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}var k3=t=>()=>t;function M3(t,{sourceEvent:e,subject:i,target:r,identifier:s,active:n,x:o,y:a,dx:l,dy:u,dispatch:d}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:i,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:n,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:d}})}M3.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function X$(t){return!t.ctrlKey&&!t.button}function W$(){return this.parentNode}function q$(t,e){return e??{x:t.x,y:t.y}}function Y$(){return navigator.maxTouchPoints||"ontouchstart"in this}function P3(){var t=X$,e=W$,i=q$,r=Y$,s={},n=Mt("start","drag","end"),o=0,a,l,u,d,m=0;function g(k){k.on("mousedown.drag",_).filter(r).on("touchstart.drag",b).on("touchmove.drag",T,Yk).on("touchend.drag touchcancel.drag",A).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function _(k,F){if(!(d||!t.call(this,k,F))){var O=M(this,e.call(this,k,F),k,F,"mouse");O&&(ye(k.view).on("mousemove.drag",v,ad).on("mouseup.drag",E,ad),C3(k.view),Y9(k),u=!1,a=k.clientX,l=k.clientY,O("start",k))}}function v(k){if(R1(k),!u){var F=k.clientX-a,O=k.clientY-l;u=F*F+O*O>m}s.mouse("drag",k)}function E(k){ye(k.view).on("mousemove.drag mouseup.drag",null),I3(k.view,u),R1(k),s.mouse("end",k)}function b(k,F){if(t.call(this,k,F)){var O=k.changedTouches,B=e.call(this,k,F),U=O.length,$,q;for($=0;$<U;++$)(q=M(this,B,k,F,O[$].identifier,O[$]))&&(Y9(k),q("start",k,O[$]))}}function T(k){var F=k.changedTouches,O=F.length,B,U;for(B=0;B<O;++B)(U=s[F[B].identifier])&&(R1(k),U("drag",k,F[B]))}function A(k){var F=k.changedTouches,O=F.length,B,U;for(d&&clearTimeout(d),d=setTimeout(function(){d=null},500),B=0;B<O;++B)(U=s[F[B].identifier])&&(Y9(k),U("end",k,F[B]))}function M(k,F,O,B,U,$){var q=n.copy(),W=gl($||O,F),Z,Q,X;if((X=i.call(k,new M3("beforestart",{sourceEvent:O,target:g,identifier:U,active:o,x:W[0],y:W[1],dx:0,dy:0,dispatch:q}),B))!=null)return Z=X.x-W[0]||0,Q=X.y-W[1]||0,function ce(de,le,te){var ee=W,oe;switch(de){case"start":s[U]=ce,oe=o++;break;case"end":delete s[U],--o;case"drag":W=gl(te||le,F),oe=o;break}q.call(de,k,new M3(de,{sourceEvent:le,subject:X,target:g,identifier:U,active:oe,x:W[0]+Z,y:W[1]+Q,dx:W[0]-ee[0],dy:W[1]-ee[1],dispatch:q}),B)}}return g.filter=function(k){return arguments.length?(t=typeof k=="function"?k:k3(!!k),g):t},g.container=function(k){return arguments.length?(e=typeof k=="function"?k:k3(k),g):e},g.subject=function(k){return arguments.length?(i=typeof k=="function"?k:k3(k),g):i},g.touchable=function(k){return arguments.length?(r=typeof k=="function"?k:k3(!!k),g):r},g.on=function(){var k=n.on.apply(n,arguments);return k===n?g:k},g.clickDistance=function(k){return arguments.length?(m=(k=+k)*k,g):Math.sqrt(m)},g}function Z9(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function Ub(t,e){var i=Object.create(t.prototype);for(var r in e)i[r]=e[r];return i}function F3(){}var R3=.7,J9=1/R3,Af="\\s*([+-]?\\d+)\\s*",D3="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ac="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Z$=/^#([0-9a-f]{3,8})$/,Q$=new RegExp(`^rgb\\(${Af},${Af},${Af}\\)$`),K$=new RegExp(`^rgb\\(${Ac},${Ac},${Ac}\\)$`),J$=new RegExp(`^rgba\\(${Af},${Af},${Af},${D3}\\)$`),eH=new RegExp(`^rgba\\(${Ac},${Ac},${Ac},${D3}\\)$`),tH=new RegExp(`^hsl\\(${D3},${Ac},${Ac}\\)$`),iH=new RegExp(`^hsla\\(${D3},${Ac},${Ac},${D3}\\)$`),Zk={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Z9(F3,Zl,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Qk,formatHex:Qk,formatHex8:rH,formatHsl:sH,formatRgb:Kk,toString:Kk});function Qk(){return this.rgb().formatHex()}function rH(){return this.rgb().formatHex8()}function sH(){return sM(this).formatHsl()}function Kk(){return this.rgb().formatRgb()}function Zl(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=Z$.exec(t))?(i=e[1].length,e=parseInt(e[1],16),i===6?Jk(e):i===3?new fa(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?Q9(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?Q9(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Q$.exec(t))?new fa(e[1],e[2],e[3],1):(e=K$.exec(t))?new fa(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=J$.exec(t))?Q9(e[1],e[2],e[3],e[4]):(e=eH.exec(t))?Q9(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=tH.exec(t))?iM(e[1],e[2]/100,e[3]/100,1):(e=iH.exec(t))?iM(e[1],e[2]/100,e[3]/100,e[4]):Zk.hasOwnProperty(t)?Jk(Zk[t]):t==="transparent"?new fa(NaN,NaN,NaN,0):null}function Jk(t){return new fa(t>>16&255,t>>8&255,t&255,1)}function Q9(t,e,i,r){return r<=0&&(t=e=i=NaN),new fa(t,e,i,r)}function nH(t){return t instanceof F3||(t=Zl(t)),t?(t=t.rgb(),new fa(t.r,t.g,t.b,t.opacity)):new fa}function Cf(t,e,i,r){return arguments.length===1?nH(t):new fa(t,e,i,r??1)}function fa(t,e,i,r){this.r=+t,this.g=+e,this.b=+i,this.opacity=+r}Z9(fa,Cf,Ub(F3,{brighter(t){return t=t==null?J9:Math.pow(J9,t),new fa(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?R3:Math.pow(R3,t),new fa(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new fa(cd(this.r),cd(this.g),cd(this.b),e8(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:eM,formatHex:eM,formatHex8:oH,formatRgb:tM,toString:tM}));function eM(){return`#${ld(this.r)}${ld(this.g)}${ld(this.b)}`}function oH(){return`#${ld(this.r)}${ld(this.g)}${ld(this.b)}${ld((isNaN(this.opacity)?1:this.opacity)*255)}`}function tM(){let t=e8(this.opacity);return`${t===1?"rgb(":"rgba("}${cd(this.r)}, ${cd(this.g)}, ${cd(this.b)}${t===1?")":`, ${t})`}`}function e8(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function cd(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ld(t){return t=cd(t),(t<16?"0":"")+t.toString(16)}function iM(t,e,i,r){return r<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new Yl(t,e,i,r)}function sM(t){if(t instanceof Yl)return new Yl(t.h,t.s,t.l,t.opacity);if(t instanceof F3||(t=Zl(t)),!t)return new Yl;if(t instanceof Yl)return t;t=t.rgb();var e=t.r/255,i=t.g/255,r=t.b/255,s=Math.min(e,i,r),n=Math.max(e,i,r),o=NaN,a=n-s,l=(n+s)/2;return a?(e===n?o=(i-r)/a+(i<r)*6:i===n?o=(r-e)/a+2:o=(e-i)/a+4,a/=l<.5?n+s:2-n-s,o*=60):a=l>0&&l<1?0:o,new Yl(o,a,l,t.opacity)}function nM(t,e,i,r){return arguments.length===1?sM(t):new Yl(t,e,i,r??1)}function Yl(t,e,i,r){this.h=+t,this.s=+e,this.l=+i,this.opacity=+r}Z9(Yl,nM,Ub(F3,{brighter(t){return t=t==null?J9:Math.pow(J9,t),new Yl(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?R3:Math.pow(R3,t),new Yl(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,r=i+(i<.5?i:1-i)*e,s=2*i-r;return new fa(zb(t>=240?t-240:t+120,s,r),zb(t,s,r),zb(t<120?t+240:t-120,s,r),this.opacity)},clamp(){return new Yl(rM(this.h),K9(this.s),K9(this.l),e8(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let t=e8(this.opacity);return`${t===1?"hsl(":"hsla("}${rM(this.h)}, ${K9(this.s)*100}%, ${K9(this.l)*100}%${t===1?")":`, ${t})`}`}}));function rM(t){return t=(t||0)%360,t<0?t+360:t}function K9(t){return Math.max(0,Math.min(1,t||0))}function zb(t,e,i){return(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)*255}function Gb(t,e,i,r,s){var n=t*t,o=n*t;return((1-3*t+3*n-o)*e+(4-6*n+3*o)*i+(1+3*t+3*n-3*o)*r+o*s)/6}function oM(t){var e=t.length-1;return function(i){var r=i<=0?i=0:i>=1?(i=1,e-1):Math.floor(i*e),s=t[r],n=t[r+1],o=r>0?t[r-1]:2*s-n,a=r<e-1?t[r+2]:2*n-s;return Gb((i-r/e)*e,o,s,n,a)}}function aM(t){var e=t.length;return function(i){var r=Math.floor(((i%=1)<0?++i:i)*e),s=t[(r+e-1)%e],n=t[r%e],o=t[(r+1)%e],a=t[(r+2)%e];return Gb((i-r/e)*e,s,n,o,a)}}var L3=t=>()=>t;function aH(t,e){return function(i){return t+i*e}}function lH(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(r){return Math.pow(t+r*e,i)}}function lM(t){return(t=+t)==1?t8:function(e,i){return i-e?lH(e,i,t):L3(isNaN(e)?i:e)}}function t8(t,e){var i=e-t;return i?aH(t,i):L3(isNaN(t)?e:t)}var Cc=function t(e){var i=lM(e);function r(s,n){var o=i((s=Cf(s)).r,(n=Cf(n)).r),a=i(s.g,n.g),l=i(s.b,n.b),u=t8(s.opacity,n.opacity);return function(d){return s.r=o(d),s.g=a(d),s.b=l(d),s.opacity=u(d),s+""}}return r.gamma=t,r}(1);function cM(t){return function(e){var i=e.length,r=new Array(i),s=new Array(i),n=new Array(i),o,a;for(o=0;o<i;++o)a=Cf(e[o]),r[o]=a.r||0,s[o]=a.g||0,n[o]=a.b||0;return r=t(r),s=t(s),n=t(n),a.opacity=1,function(l){return a.r=r(l),a.g=s(l),a.b=n(l),a+""}}}var cH=cM(oM),uH=cM(aM);function uM(t,e){e||(e=[]);var i=t?Math.min(e.length,t.length):0,r=e.slice(),s;return function(n){for(s=0;s<i;++s)r[s]=t[s]*(1-n)+e[s]*n;return r}}function hM(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function dM(t,e){var i=e?e.length:0,r=t?Math.min(i,t.length):0,s=new Array(r),n=new Array(i),o;for(o=0;o<r;++o)s[o]=D1(t[o],e[o]);for(;o<i;++o)n[o]=e[o];return function(a){for(o=0;o<r;++o)n[o]=s[o](a);return n}}function fM(t,e){var i=new Date;return t=+t,e=+e,function(r){return i.setTime(t*(1-r)+e*r),i}}function Qs(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}function pM(t,e){var i={},r={},s;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in t?i[s]=D1(t[s],e[s]):r[s]=e[s];return function(n){for(s in i)r[s]=i[s](n);return r}}var Hb=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,$b=new RegExp(Hb.source,"g");function hH(t){return function(){return t}}function dH(t){return function(e){return t(e)+""}}function N3(t,e){var i=Hb.lastIndex=$b.lastIndex=0,r,s,n,o=-1,a=[],l=[];for(t=t+"",e=e+"";(r=Hb.exec(t))&&(s=$b.exec(e));)(n=s.index)>i&&(n=e.slice(i,n),a[o]?a[o]+=n:a[++o]=n),(r=r[0])===(s=s[0])?a[o]?a[o]+=s:a[++o]=s:(a[++o]=null,l.push({i:o,x:Qs(r,s)})),i=$b.lastIndex;return i<e.length&&(n=e.slice(i),a[o]?a[o]+=n:a[++o]=n),a.length<2?l[0]?dH(l[0].x):hH(e):(e=l.length,function(u){for(var d=0,m;d<e;++d)a[(m=l[d]).i]=m.x(u);return a.join("")})}function D1(t,e){var i=typeof e,r;return e==null||i==="boolean"?L3(e):(i==="number"?Qs:i==="string"?(r=Zl(e))?(e=r,Cc):N3:e instanceof Zl?Cc:e instanceof Date?fM:hM(e)?uM:Array.isArray(e)?dM:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?pM:Qs)(t,e)}var mM=180/Math.PI,i8={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Vb(t,e,i,r,s,n){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*i+e*r)&&(i-=t*l,r-=e*l),(a=Math.sqrt(i*i+r*r))&&(i/=a,r/=a,l/=a),t*r<e*i&&(t=-t,e=-e,l=-l,o=-o),{translateX:s,translateY:n,rotate:Math.atan2(e,t)*mM,skewX:Math.atan(l)*mM,scaleX:o,scaleY:a}}var r8;function gM(t){let e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?i8:Vb(e.a,e.b,e.c,e.d,e.e,e.f)}function yM(t){return t==null?i8:(r8||(r8=document.createElementNS("http://www.w3.org/2000/svg","g")),r8.setAttribute("transform",t),(t=r8.transform.baseVal.consolidate())?(t=t.matrix,Vb(t.a,t.b,t.c,t.d,t.e,t.f)):i8)}function _M(t,e,i,r){function s(u){return u.length?u.pop()+" ":""}function n(u,d,m,g,_,v){if(u!==m||d!==g){var E=_.push("translate(",null,e,null,i);v.push({i:E-4,x:Qs(u,m)},{i:E-2,x:Qs(d,g)})}else(m||g)&&_.push("translate("+m+e+g+i)}function o(u,d,m,g){u!==d?(u-d>180?d+=360:d-u>180&&(u+=360),g.push({i:m.push(s(m)+"rotate(",null,r)-2,x:Qs(u,d)})):d&&m.push(s(m)+"rotate("+d+r)}function a(u,d,m,g){u!==d?g.push({i:m.push(s(m)+"skewX(",null,r)-2,x:Qs(u,d)}):d&&m.push(s(m)+"skewX("+d+r)}function l(u,d,m,g,_,v){if(u!==m||d!==g){var E=_.push(s(_)+"scale(",null,",",null,")");v.push({i:E-4,x:Qs(u,m)},{i:E-2,x:Qs(d,g)})}else(m!==1||g!==1)&&_.push(s(_)+"scale("+m+","+g+")")}return function(u,d){var m=[],g=[];return u=t(u),d=t(d),n(u.translateX,u.translateY,d.translateX,d.translateY,m,g),o(u.rotate,d.rotate,m,g),a(u.skewX,d.skewX,m,g),l(u.scaleX,u.scaleY,d.scaleX,d.scaleY,m,g),u=d=null,function(_){for(var v=-1,E=g.length,b;++v<E;)m[(b=g[v]).i]=b.x(_);return m.join("")}}}var jb=_M(gM,"px, ","px)","deg)"),Xb=_M(yM,", ",")",")");var fH=1e-12;function xM(t){return((t=Math.exp(t))+1/t)/2}function pH(t){return((t=Math.exp(t))-1/t)/2}function mH(t){return((t=Math.exp(2*t))-1)/(t+1)}var Wb=function t(e,i,r){function s(n,o){var a=n[0],l=n[1],u=n[2],d=o[0],m=o[1],g=o[2],_=d-a,v=m-l,E=_*_+v*v,b,T;if(E<fH)T=Math.log(g/u)/e,b=function(B){return[a+B*_,l+B*v,u*Math.exp(e*B*T)]};else{var A=Math.sqrt(E),M=(g*g-u*u+r*E)/(2*u*i*A),k=(g*g-u*u-r*E)/(2*g*i*A),F=Math.log(Math.sqrt(M*M+1)-M),O=Math.log(Math.sqrt(k*k+1)-k);T=(O-F)/e,b=function(B){var U=B*T,$=xM(F),q=u/(i*A)*($*mH(e*U+F)-pH(F));return[a+q*_,l+q*v,u*$/xM(e*U+F)]}}return b.duration=T*1e3*e/Math.SQRT2,b}return s.rho=function(n){var o=Math.max(.001,+n),a=o*o,l=a*a;return t(o,a,l)},s}(Math.SQRT2,2,4);var If=0,B3=0,O3=0,bM=1e3,s8,U3,n8=0,ud=0,o8=0,z3=typeof performance=="object"&&performance.now?performance:Date,wM=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function $3(){return ud||(wM(gH),ud=z3.now()+o8)}function gH(){ud=0}function G3(){this._call=this._time=this._next=null}G3.prototype=kf.prototype={constructor:G3,restart:function(t,e,i){if(typeof t!="function")throw new TypeError("callback is not a function");i=(i==null?$3():+i)+(e==null?0:+e),!this._next&&U3!==this&&(U3?U3._next=this:s8=this,U3=this),this._call=t,this._time=i,qb()},stop:function(){this._call&&(this._call=null,this._time=1/0,qb())}};function kf(t,e,i){var r=new G3;return r.restart(t,e,i),r}function a8(){$3(),++If;for(var t=s8,e;t;)(e=ud-t._time)>=0&&t._call.call(void 0,e),t=t._next;--If}function vM(){ud=(n8=z3.now())+o8,If=B3=0;try{a8()}finally{If=0,_H(),ud=0}}function yH(){var t=z3.now(),e=t-n8;e>bM&&(o8-=e,n8=t)}function _H(){for(var t,e=s8,i,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(i=e._next,e._next=null,e=t?t._next=i:s8=i);U3=t,qb(r)}function qb(t){if(!If){B3&&(B3=clearTimeout(B3));var e=t-ud;e>24?(t<1/0&&(B3=setTimeout(vM,t-z3.now()-o8)),O3&&(O3=clearInterval(O3))):(O3||(n8=z3.now(),O3=setInterval(yH,bM)),If=1,wM(vM))}}function Mf(t,e,i){var r=new G3;return e=e==null?0:+e,r.restart(s=>{r.stop(),t(s+e)},e,i),r}var xH=Mt("start","end","cancel","interrupt"),vH=[],SM=0,EM=1,c8=2,l8=3,TM=4,u8=5,H3=6;function F1(t,e,i,r,s,n){var o=t.__transition;if(!o)t.__transition={};else if(i in o)return;bH(t,i,{name:e,index:r,group:s,on:xH,tween:vH,time:n.time,delay:n.delay,duration:n.duration,ease:n.ease,timer:null,state:SM})}function V3(t,e){var i=An(t,e);if(i.state>SM)throw new Error("too late; already scheduled");return i}function Zn(t,e){var i=An(t,e);if(i.state>l8)throw new Error("too late; already running");return i}function An(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function bH(t,e,i){var r=t.__transition,s;r[e]=i,i.timer=kf(n,0,i.time);function n(u){i.state=EM,i.timer.restart(o,i.delay,i.time),i.delay<=u&&o(u-i.delay)}function o(u){var d,m,g,_;if(i.state!==EM)return l();for(d in r)if(_=r[d],_.name===i.name){if(_.state===l8)return Mf(o);_.state===TM?(_.state=H3,_.timer.stop(),_.on.call("interrupt",t,t.__data__,_.index,_.group),delete r[d]):+d<e&&(_.state=H3,_.timer.stop(),_.on.call("cancel",t,t.__data__,_.index,_.group),delete r[d])}if(Mf(function(){i.state===l8&&(i.state=TM,i.timer.restart(a,i.delay,i.time),a(u))}),i.state=c8,i.on.call("start",t,t.__data__,i.index,i.group),i.state===c8){for(i.state=l8,s=new Array(g=i.tween.length),d=0,m=-1;d<g;++d)(_=i.tween[d].value.call(t,t.__data__,i.index,i.group))&&(s[++m]=_);s.length=m+1}}function a(u){for(var d=u<i.duration?i.ease.call(null,u/i.duration):(i.timer.restart(l),i.state=u8,1),m=-1,g=s.length;++m<g;)s[m].call(t,d);i.state===u8&&(i.on.call("end",t,t.__data__,i.index,i.group),l())}function l(){i.state=H3,i.timer.stop(),delete r[e];for(var u in r)return;delete t.__transition}}function L1(t,e){var i=t.__transition,r,s,n=!0,o;if(i){e=e==null?null:e+"";for(o in i){if((r=i[o]).name!==e){n=!1;continue}s=r.state>c8&&r.state<u8,r.state=H3,r.timer.stop(),r.on.call(s?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete i[o]}n&&delete t.__transition}}function AM(t){return this.each(function(){L1(this,t)})}function wH(t,e){var i,r;return function(){var s=Zn(this,t),n=s.tween;if(n!==i){r=i=n;for(var o=0,a=r.length;o<a;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}s.tween=r}}function EH(t,e,i){var r,s;if(typeof i!="function")throw new Error;return function(){var n=Zn(this,t),o=n.tween;if(o!==r){s=(r=o).slice();for(var a={name:e,value:i},l=0,u=s.length;l<u;++l)if(s[l].name===e){s[l]=a;break}l===u&&s.push(a)}n.tween=s}}function CM(t,e){var i=this._id;if(t+="",arguments.length<2){for(var r=An(this.node(),i).tween,s=0,n=r.length,o;s<n;++s)if((o=r[s]).name===t)return o.value;return null}return this.each((e==null?wH:EH)(i,t,e))}function Pf(t,e,i){var r=t._id;return t.each(function(){var s=Zn(this,r);(s.value||(s.value={}))[e]=i.apply(this,arguments)}),function(s){return An(s,r).value[e]}}function h8(t,e){var i;return(typeof e=="number"?Qs:e instanceof Zl?Cc:(i=Zl(e))?(e=i,Cc):N3)(t,e)}function TH(t){return function(){this.removeAttribute(t)}}function SH(t){return function(){this.removeAttributeNS(t.space,t.local)}}function AH(t,e,i){var r,s=i+"",n;return function(){var o=this.getAttribute(t);return o===s?null:o===r?n:n=e(r=o,i)}}function CH(t,e,i){var r,s=i+"",n;return function(){var o=this.getAttributeNS(t.space,t.local);return o===s?null:o===r?n:n=e(r=o,i)}}function IH(t,e,i){var r,s,n;return function(){var o,a=i(this),l;return a==null?void this.removeAttribute(t):(o=this.getAttribute(t),l=a+"",o===l?null:o===r&&l===s?n:(s=l,n=e(r=o,a)))}}function kH(t,e,i){var r,s,n;return function(){var o,a=i(this),l;return a==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),l=a+"",o===l?null:o===r&&l===s?n:(s=l,n=e(r=o,a)))}}function IM(t,e){var i=bu(t),r=i==="transform"?Xb:h8;return this.attrTween(t,typeof e=="function"?(i.local?kH:IH)(i,r,Pf(this,"attr."+t,e)):e==null?(i.local?SH:TH)(i):(i.local?CH:AH)(i,r,e))}function MH(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}function PH(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}function RH(t,e){var i,r;function s(){var n=e.apply(this,arguments);return n!==r&&(i=(r=n)&&PH(t,n)),i}return s._value=e,s}function DH(t,e){var i,r;function s(){var n=e.apply(this,arguments);return n!==r&&(i=(r=n)&&MH(t,n)),i}return s._value=e,s}function kM(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;var r=bu(t);return this.tween(i,(r.local?RH:DH)(r,e))}function FH(t,e){return function(){V3(this,t).delay=+e.apply(this,arguments)}}function LH(t,e){return e=+e,function(){V3(this,t).delay=e}}function MM(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?FH:LH)(e,t)):An(this.node(),e).delay}function NH(t,e){return function(){Zn(this,t).duration=+e.apply(this,arguments)}}function OH(t,e){return e=+e,function(){Zn(this,t).duration=e}}function PM(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?NH:OH)(e,t)):An(this.node(),e).duration}function BH(t,e){if(typeof e!="function")throw new Error;return function(){Zn(this,t).ease=e}}function RM(t){var e=this._id;return arguments.length?this.each(BH(e,t)):An(this.node(),e).ease}function UH(t,e){return function(){var i=e.apply(this,arguments);if(typeof i!="function")throw new Error;Zn(this,t).ease=i}}function DM(t){if(typeof t!="function")throw new Error;return this.each(UH(this._id,t))}function FM(t){typeof t!="function"&&(t=T3(t));for(var e=this._groups,i=e.length,r=new Array(i),s=0;s<i;++s)for(var n=e[s],o=n.length,a=r[s]=[],l,u=0;u<o;++u)(l=n[u])&&t.call(l,l.__data__,u,n)&&a.push(l);return new Bo(r,this._parents,this._name,this._id)}function LM(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,r=e.length,s=i.length,n=Math.min(r,s),o=new Array(r),a=0;a<n;++a)for(var l=e[a],u=i[a],d=l.length,m=o[a]=new Array(d),g,_=0;_<d;++_)(g=l[_]||u[_])&&(m[_]=g);for(;a<r;++a)o[a]=e[a];return new Bo(o,this._parents,this._name,this._id)}function zH(t){return(t+"").trim().split(/^|\s+/).every(function(e){var i=e.indexOf(".");return i>=0&&(e=e.slice(0,i)),!e||e==="start"})}function GH(t,e,i){var r,s,n=zH(e)?V3:Zn;return function(){var o=n(this,t),a=o.on;a!==r&&(s=(r=a).copy()).on(e,i),o.on=s}}function NM(t,e){var i=this._id;return arguments.length<2?An(this.node(),i).on.on(t):this.each(GH(i,t,e))}function $H(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}function OM(){return this.on("end.remove",$H(this._id))}function BM(t){var e=this._name,i=this._id;typeof t!="function"&&(t=od(t));for(var r=this._groups,s=r.length,n=new Array(s),o=0;o<s;++o)for(var a=r[o],l=a.length,u=n[o]=new Array(l),d,m,g=0;g<l;++g)(d=a[g])&&(m=t.call(d,d.__data__,g,a))&&("__data__"in d&&(m.__data__=d.__data__),u[g]=m,F1(u[g],e,i,g,u,An(d,i)));return new Bo(n,this._parents,e,i)}function UM(t){var e=this._name,i=this._id;typeof t!="function"&&(t=E3(t));for(var r=this._groups,s=r.length,n=[],o=[],a=0;a<s;++a)for(var l=r[a],u=l.length,d,m=0;m<u;++m)if(d=l[m]){for(var g=t.call(d,d.__data__,m,l),_,v=An(d,i),E=0,b=g.length;E<b;++E)(_=g[E])&&F1(_,e,i,E,g,v);n.push(g),o.push(d)}return new Bo(n,o,e,i)}var HH=wu.prototype.constructor;function zM(){return new HH(this._groups,this._parents)}function VH(t,e){var i,r,s;return function(){var n=P1(this,t),o=(this.style.removeProperty(t),P1(this,t));return n===o?null:n===i&&o===r?s:s=e(i=n,r=o)}}function GM(t){return function(){this.style.removeProperty(t)}}function jH(t,e,i){var r,s=i+"",n;return function(){var o=P1(this,t);return o===s?null:o===r?n:n=e(r=o,i)}}function XH(t,e,i){var r,s,n;return function(){var o=P1(this,t),a=i(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(t),P1(this,t))),o===l?null:o===r&&l===s?n:(s=l,n=e(r=o,a))}}function WH(t,e){var i,r,s,n="style."+e,o="end."+n,a;return function(){var l=Zn(this,t),u=l.on,d=l.value[n]==null?a||(a=GM(e)):void 0;(u!==i||s!==d)&&(r=(i=u).copy()).on(o,s=d),l.on=r}}function $M(t,e,i){var r=(t+="")=="transform"?jb:h8;return e==null?this.styleTween(t,VH(t,r)).on("end.style."+t,GM(t)):typeof e=="function"?this.styleTween(t,XH(t,r,Pf(this,"style."+t,e))).each(WH(this._id,t)):this.styleTween(t,jH(t,r,e),i).on("end.style."+t,null)}function qH(t,e,i){return function(r){this.style.setProperty(t,e.call(this,r),i)}}function YH(t,e,i){var r,s;function n(){var o=e.apply(this,arguments);return o!==s&&(r=(s=o)&&qH(t,o,i)),r}return n._value=e,n}function HM(t,e,i){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,YH(t,e,i??""))}function ZH(t){return function(){this.textContent=t}}function QH(t){return function(){var e=t(this);this.textContent=e??""}}function VM(t){return this.tween("text",typeof t=="function"?QH(Pf(this,"text",t)):ZH(t==null?"":t+""))}function KH(t){return function(e){this.textContent=t.call(this,e)}}function JH(t){var e,i;function r(){var s=t.apply(this,arguments);return s!==i&&(e=(i=s)&&KH(s)),e}return r._value=t,r}function jM(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,JH(t))}function XM(){for(var t=this._name,e=this._id,i=d8(),r=this._groups,s=r.length,n=0;n<s;++n)for(var o=r[n],a=o.length,l,u=0;u<a;++u)if(l=o[u]){var d=An(l,e);F1(l,t,i,u,o,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new Bo(r,this._parents,t,i)}function WM(){var t,e,i=this,r=i._id,s=i.size();return new Promise(function(n,o){var a={value:o},l={value:function(){--s===0&&n()}};i.each(function(){var u=Zn(this,r),d=u.on;d!==t&&(e=(t=d).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),u.on=e}),s===0&&n()})}var eV=0;function Bo(t,e,i,r){this._groups=t,this._parents=e,this._name=i,this._id=r}function qM(t){return wu().transition(t)}function d8(){return++eV}var Eu=wu.prototype;Bo.prototype=qM.prototype={constructor:Bo,select:BM,selectAll:UM,selectChild:Eu.selectChild,selectChildren:Eu.selectChildren,filter:FM,merge:LM,selection:zM,transition:XM,call:Eu.call,nodes:Eu.nodes,node:Eu.node,size:Eu.size,empty:Eu.empty,each:Eu.each,on:NM,attr:IM,attrTween:kM,style:$M,styleTween:HM,text:VM,textTween:jM,remove:OM,tween:CM,delay:MM,duration:PM,ease:RM,easeVarying:DM,end:WM,[Symbol.iterator]:Eu[Symbol.iterator]};var j3=t=>+t;function hd(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var tV={time:null,delay:0,duration:250,ease:hd};function iV(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return i}function YM(t){var e,i;t instanceof Bo?(e=t._id,t=t._name):(e=d8(),(i=tV).time=$3(),t=t==null?null:t+"");for(var r=this._groups,s=r.length,n=0;n<s;++n)for(var o=r[n],a=o.length,l,u=0;u<a;++u)(l=o[u])&&F1(l,t,e,u,o,i||iV(l,e));return new Bo(r,this._parents,t,e)}wu.prototype.interrupt=AM;wu.prototype.transition=YM;var X3=t=>()=>t;function Yb(t,{sourceEvent:e,target:i,transform:r,dispatch:s}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:s}})}function Ql(t,e,i){this.k=t,this.x=e,this.y=i}Ql.prototype={constructor:Ql,scale:function(t){return t===1?this:new Ql(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Ql(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var yl=new Ql(1,0,0);Zb.prototype=Ql.prototype;function Zb(t){for(;!t.__zoom;)if(!(t=t.parentNode))return yl;return t.__zoom}function f8(t){t.stopImmediatePropagation()}function Rf(t){t.preventDefault(),t.stopImmediatePropagation()}function rV(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function sV(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function ZM(){return this.__zoom||yl}function nV(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function oV(){return navigator.maxTouchPoints||"ontouchstart"in this}function aV(t,e,i){var r=t.invertX(e[0][0])-i[0][0],s=t.invertX(e[1][0])-i[1][0],n=t.invertY(e[0][1])-i[0][1],o=t.invertY(e[1][1])-i[1][1];return t.translate(s>r?(r+s)/2:Math.min(0,r)||Math.max(0,s),o>n?(n+o)/2:Math.min(0,n)||Math.max(0,o))}function Df(){var t=rV,e=sV,i=aV,r=nV,s=oV,n=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,l=Wb,u=Mt("start","zoom","end"),d,m,g,_=500,v=150,E=0,b=10;function T(X){X.property("__zoom",ZM).on("wheel.zoom",U,{passive:!1}).on("mousedown.zoom",$).on("dblclick.zoom",q).filter(s).on("touchstart.zoom",W).on("touchmove.zoom",Z).on("touchend.zoom touchcancel.zoom",Q).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}T.transform=function(X,ce,de,le){var te=X.selection?X.selection():X;te.property("__zoom",ZM),X!==te?F(X,ce,de,le):te.interrupt().each(function(){O(this,arguments).event(le).start().zoom(null,typeof ce=="function"?ce.apply(this,arguments):ce).end()})},T.scaleBy=function(X,ce,de,le){T.scaleTo(X,function(){var te=this.__zoom.k,ee=typeof ce=="function"?ce.apply(this,arguments):ce;return te*ee},de,le)},T.scaleTo=function(X,ce,de,le){T.transform(X,function(){var te=e.apply(this,arguments),ee=this.__zoom,oe=de==null?k(te):typeof de=="function"?de.apply(this,arguments):de,ie=ee.invert(oe),ne=typeof ce=="function"?ce.apply(this,arguments):ce;return i(M(A(ee,ne),oe,ie),te,o)},de,le)},T.translateBy=function(X,ce,de,le){T.transform(X,function(){return i(this.__zoom.translate(typeof ce=="function"?ce.apply(this,arguments):ce,typeof de=="function"?de.apply(this,arguments):de),e.apply(this,arguments),o)},null,le)},T.translateTo=function(X,ce,de,le,te){T.transform(X,function(){var ee=e.apply(this,arguments),oe=this.__zoom,ie=le==null?k(ee):typeof le=="function"?le.apply(this,arguments):le;return i(yl.translate(ie[0],ie[1]).scale(oe.k).translate(typeof ce=="function"?-ce.apply(this,arguments):-ce,typeof de=="function"?-de.apply(this,arguments):-de),ee,o)},le,te)};function A(X,ce){return ce=Math.max(n[0],Math.min(n[1],ce)),ce===X.k?X:new Ql(ce,X.x,X.y)}function M(X,ce,de){var le=ce[0]-de[0]*X.k,te=ce[1]-de[1]*X.k;return le===X.x&&te===X.y?X:new Ql(X.k,le,te)}function k(X){return[(+X[0][0]+ +X[1][0])/2,(+X[0][1]+ +X[1][1])/2]}function F(X,ce,de,le){X.on("start.zoom",function(){O(this,arguments).event(le).start()}).on("interrupt.zoom end.zoom",function(){O(this,arguments).event(le).end()}).tween("zoom",function(){var te=this,ee=arguments,oe=O(te,ee).event(le),ie=e.apply(te,ee),ne=de==null?k(ie):typeof de=="function"?de.apply(te,ee):de,me=Math.max(ie[1][0]-ie[0][0],ie[1][1]-ie[0][1]),De=te.__zoom,He=typeof ce=="function"?ce.apply(te,ee):ce,Je=l(De.invert(ne).concat(me/De.k),He.invert(ne).concat(me/He.k));return function(ot){if(ot===1)ot=He;else{var gt=Je(ot),vt=me/gt[2];ot=new Ql(vt,ne[0]-gt[0]*vt,ne[1]-gt[1]*vt)}oe.zoom(null,ot)}})}function O(X,ce,de){return!de&&X.__zooming||new B(X,ce)}function B(X,ce){this.that=X,this.args=ce,this.active=0,this.sourceEvent=null,this.extent=e.apply(X,ce),this.taps=0}B.prototype={event:function(X){return X&&(this.sourceEvent=X),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(X,ce){return this.mouse&&X!=="mouse"&&(this.mouse[1]=ce.invert(this.mouse[0])),this.touch0&&X!=="touch"&&(this.touch0[1]=ce.invert(this.touch0[0])),this.touch1&&X!=="touch"&&(this.touch1[1]=ce.invert(this.touch1[0])),this.that.__zoom=ce,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(X){var ce=ye(this.that).datum();u.call(X,this.that,new Yb(X,{sourceEvent:this.sourceEvent,target:T,type:X,transform:this.that.__zoom,dispatch:u}),ce)}};function U(X,...ce){if(!t.apply(this,arguments))return;var de=O(this,ce).event(X),le=this.__zoom,te=Math.max(n[0],Math.min(n[1],le.k*Math.pow(2,r.apply(this,arguments)))),ee=gl(X);if(de.wheel)(de.mouse[0][0]!==ee[0]||de.mouse[0][1]!==ee[1])&&(de.mouse[1]=le.invert(de.mouse[0]=ee)),clearTimeout(de.wheel);else{if(le.k===te)return;de.mouse=[ee,le.invert(ee)],L1(this),de.start()}Rf(X),de.wheel=setTimeout(oe,v),de.zoom("mouse",i(M(A(le,te),de.mouse[0],de.mouse[1]),de.extent,o));function oe(){de.wheel=null,de.end()}}function $(X,...ce){if(g||!t.apply(this,arguments))return;var de=X.currentTarget,le=O(this,ce,!0).event(X),te=ye(X.view).on("mousemove.zoom",ne,!0).on("mouseup.zoom",me,!0),ee=gl(X,de),oe=X.clientX,ie=X.clientY;C3(X.view),f8(X),le.mouse=[ee,this.__zoom.invert(ee)],L1(this),le.start();function ne(De){if(Rf(De),!le.moved){var He=De.clientX-oe,Je=De.clientY-ie;le.moved=He*He+Je*Je>E}le.event(De).zoom("mouse",i(M(le.that.__zoom,le.mouse[0]=gl(De,de),le.mouse[1]),le.extent,o))}function me(De){te.on("mousemove.zoom mouseup.zoom",null),I3(De.view,le.moved),Rf(De),le.event(De).end()}}function q(X,...ce){if(t.apply(this,arguments)){var de=this.__zoom,le=gl(X.changedTouches?X.changedTouches[0]:X,this),te=de.invert(le),ee=de.k*(X.shiftKey?.5:2),oe=i(M(A(de,ee),le,te),e.apply(this,ce),o);Rf(X),a>0?ye(this).transition().duration(a).call(F,oe,le,X):ye(this).call(T.transform,oe,le,X)}}function W(X,...ce){if(t.apply(this,arguments)){var de=X.touches,le=de.length,te=O(this,ce,X.changedTouches.length===le).event(X),ee,oe,ie,ne;for(f8(X),oe=0;oe<le;++oe)ie=de[oe],ne=gl(ie,this),ne=[ne,this.__zoom.invert(ne),ie.identifier],te.touch0?!te.touch1&&te.touch0[2]!==ne[2]&&(te.touch1=ne,te.taps=0):(te.touch0=ne,ee=!0,te.taps=1+!!d);d&&(d=clearTimeout(d)),ee&&(te.taps<2&&(m=ne[0],d=setTimeout(function(){d=null},_)),L1(this),te.start())}}function Z(X,...ce){if(this.__zooming){var de=O(this,ce).event(X),le=X.changedTouches,te=le.length,ee,oe,ie,ne;for(Rf(X),ee=0;ee<te;++ee)oe=le[ee],ie=gl(oe,this),de.touch0&&de.touch0[2]===oe.identifier?de.touch0[0]=ie:de.touch1&&de.touch1[2]===oe.identifier&&(de.touch1[0]=ie);if(oe=de.that.__zoom,de.touch1){var me=de.touch0[0],De=de.touch0[1],He=de.touch1[0],Je=de.touch1[1],ot=(ot=He[0]-me[0])*ot+(ot=He[1]-me[1])*ot,gt=(gt=Je[0]-De[0])*gt+(gt=Je[1]-De[1])*gt;oe=A(oe,Math.sqrt(ot/gt)),ie=[(me[0]+He[0])/2,(me[1]+He[1])/2],ne=[(De[0]+Je[0])/2,(De[1]+Je[1])/2]}else if(de.touch0)ie=de.touch0[0],ne=de.touch0[1];else return;de.zoom("touch",i(M(oe,ie,ne),de.extent,o))}}function Q(X,...ce){if(this.__zooming){var de=O(this,ce).event(X),le=X.changedTouches,te=le.length,ee,oe;for(f8(X),g&&clearTimeout(g),g=setTimeout(function(){g=null},_),ee=0;ee<te;++ee)oe=le[ee],de.touch0&&de.touch0[2]===oe.identifier?delete de.touch0:de.touch1&&de.touch1[2]===oe.identifier&&delete de.touch1;if(de.touch1&&!de.touch0&&(de.touch0=de.touch1,delete de.touch1),de.touch0)de.touch0[1]=this.__zoom.invert(de.touch0[0]);else if(de.end(),de.taps===2&&(oe=gl(oe,this),Math.hypot(m[0]-oe[0],m[1]-oe[1])<b)){var ie=ye(this).on("dblclick.zoom");ie&&ie.apply(this,arguments)}}}return T.wheelDelta=function(X){return arguments.length?(r=typeof X=="function"?X:X3(+X),T):r},T.filter=function(X){return arguments.length?(t=typeof X=="function"?X:X3(!!X),T):t},T.touchable=function(X){return arguments.length?(s=typeof X=="function"?X:X3(!!X),T):s},T.extent=function(X){return arguments.length?(e=typeof X=="function"?X:X3([[+X[0][0],+X[0][1]],[+X[1][0],+X[1][1]]]),T):e},T.scaleExtent=function(X){return arguments.length?(n[0]=+X[0],n[1]=+X[1],T):[n[0],n[1]]},T.translateExtent=function(X){return arguments.length?(o[0][0]=+X[0][0],o[1][0]=+X[1][0],o[0][1]=+X[0][1],o[1][1]=+X[1][1],T):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},T.constrain=function(X){return arguments.length?(i=X,T):i},T.duration=function(X){return arguments.length?(a=+X,T):a},T.interpolate=function(X){return arguments.length?(l=X,T):l},T.on=function(){var X=u.on.apply(u,arguments);return X===u?T:X},T.clickDistance=function(X){return arguments.length?(E=(X=+X)*X,T):Math.sqrt(E)},T.tapDistance=function(X){return arguments.length?(b=+X,T):b},T}var Ic=2*Math.PI,p8=6356752314245179e-9,m8=6378137;function Qb(t){return t*(Ic*m8/360)}function Y3(t,e){return Math.abs(e)>=90?0:t*(Ic*p8/360)*Math.abs(Math.cos(e*(Math.PI/180)))}function kc(t){return t/(Ic*m8/360)}function Cn(t,e){return Math.abs(e)>=90?0:t/(Ic*p8/360)/Math.abs(Math.cos(e*(Math.PI/180)))}function g8(t,e){return e=e||256,[t[0]*e/(Ic*p8),-t[1]*e/(Ic*m8)]}function y8(t,e){return e=e||256,[t[0]*Ic*p8/e,-t[1]*Ic*m8/e]}function fr(t,e){let i=Y3(t[0]-e[0],(t[1]+e[1])/2),r=Qb(t[1]-e[1]);return Math.sqrt(i*i+r*r)}function Ba(t,e){e=e||256;let i=Math.log(e)*Math.LOG2E;return Math.log(t*Ic)/Math.LN2-i}function In(t,e){return e=e||256,e*Math.pow(2,t)/Ic}function _8(t,e){let i=1/0,r;for(let s=0;s<t.length;s++){let n=fr(t[s],e);n<i&&(i=n,r=s)}return r!==void 0?{index:r,distance:i,point:t[r]}:null}var mt=class{constructor(t,e){this.min=[1/0,1/0],this.max=[-1/0,-1/0];let i;t instanceof mt?(i=t.min,e=t.max):i=t,i&&i.length===2&&(this.min[0]=i[0],this.min[1]=i[1],e||(e=i)),e&&e.length===2&&(this.max[0]=e[0],this.max[1]=e[1])}equals(t){return this.min[0]===t.min[0]&&this.min[1]===t.min[1]&&this.max[0]===t.max[0]&&this.max[1]===t.max[1]}area(){return Math.abs((this.max[0]-this.min[0])*(this.max[1]-this.min[1]))}center(){return[(this.min[0]+this.max[0])/2,(this.min[1]+this.max[1])/2]}rectangle(){return[this.min[0],this.min[1],this.max[0],this.max[1]]}toParam(){return this.rectangle().join(",")}bbox(){return{minX:this.min[0],minY:this.min[1],maxX:this.max[0],maxY:this.max[1]}}polygon(){return[[this.min[0],this.min[1]],[this.min[0],this.max[1]],[this.max[0],this.max[1]],[this.max[0],this.min[1]],[this.min[0],this.min[1]]]}contains(t){return t.min[0]>=this.min[0]&&t.min[1]>=this.min[1]&&t.max[0]<=this.max[0]&&t.max[1]<=this.max[1]}intersects(t){return t.min[0]<=this.max[0]&&t.min[1]<=this.max[1]&&t.max[0]>=this.min[0]&&t.max[1]>=this.min[1]}intersection(t){return this.intersects(t)?new mt([Math.max(t.min[0],this.min[0]),Math.max(t.min[1],this.min[1])],[Math.min(t.max[0],this.max[0]),Math.min(t.max[1],this.max[1])]):new mt}percentContainedIn(t){let e=this.intersection(t).area(),i=this.area();return e===1/0||i===1/0?0:e===0||i===0?t.contains(this)?1:0:e/i}extend(t){return new mt([Math.min(t.min[0],this.min[0]),Math.min(t.min[1],this.min[1])],[Math.max(t.max[0],this.max[0]),Math.max(t.max[1],this.max[1])])}padByMeters(t){let e=kc(t),i=Cn(t,this.center()[1]);return new mt([this.min[0]-i,this.min[1]-e],[this.max[0]+i,this.max[1]+e])}};function Wi(t,e,i){return i?Math.abs(t[0]-e[0])<=i&&Math.abs(t[1]-e[1])<=i:t[0]===e[0]&&t[1]===e[1]}function Sr(t,e){return[t[0]+e[0],t[1]+e[1]]}function tr(t,e){return[t[0]-e[0],t[1]-e[1]]}function Uo(t,e){return[t[0]*e,t[1]*e]}function pr(t,e,i){return[t[0]+(e[0]-t[0])*i,t[1]+(e[1]-t[1])*i]}function Hi(t,e){e=e||[0,0];let i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function Kb(t,e=[0,0]){return(t[0]-e[0])**2+(t[1]-e[1])**2}function Ff(t){let e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return e!==0?Uo(t,1/e):[0,0]}function fs(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])}function _l(t,e,i){i=i||[0,0];let r=tr(t,i),s=tr(e,i);return r[0]*s[0]+r[1]*s[1]}function x8(t,e,i){i=i||[0,0];let r=Ff(tr(t,i)),s=Ff(tr(e,i));return _l(r,s)}function q3(t,e,i){i=i||[0,0];let r=tr(t,i),s=tr(e,i);return r[0]*s[1]-r[1]*s[0]}function KM(t,e){let i=1/0,r,s;for(let n=0;n<e.length-1;n++){let o=e[n],a=tr(e[n+1],o),l=tr(t,o),u=_l(l,a)/_l(a,a),d;u<0?d=o:u>1?d=e[n+1]:d=[o[0]+u*a[0],o[1]+u*a[1]];let m=Hi(d,t);m<i&&(i=m,r=n+1,s=d)}return r!==void 0&&s!==void 0?{index:r,distance:i,target:s}:null}function JM(t,e){return t[0]===e[0]&&t[1]===e[1]||t[0]===e[1]&&t[1]===e[0]}function Tu(t,e,i){return t.map(r=>{let s=tr(r,i);return[s[0]*Math.cos(e)-s[1]*Math.sin(e)+i[0],s[0]*Math.sin(e)+s[1]*Math.cos(e)+i[1]]})}function Su(t,e){if(t.length!==2||e.length!==2)return null;let i=[t[0][0],t[0][1]],r=[t[1][0],t[1][1]],s=[e[0][0],e[0][1]],n=[e[1][0],e[1][1]],o=tr(r,i),a=tr(n,s),l=q3(tr(s,i),o),u=q3(o,a);if(l&&u){let d=l/u,m=q3(tr(s,i),a)/u;if(m>=0&&m<=1&&d>=0&&d<=1)return pr(i,r,m)}return null}function v8(t,e){let i=[];for(let r=0;r<t.length-1;r++)for(let s=0;s<e.length-1;s++){let n=[t[r],t[r+1]],o=[e[s],e[s+1]],a=Su(n,o);a&&i.push(a)}return i}function lV(t,e){for(let i=0;i<t.length-1;i++)for(let r=0;r<e.length-1;r++){let s=[t[i],t[i+1]],n=[e[r],e[r+1]];if(Su(s,n))return!0}return!1}function Lf(t,e){let i=t[0],r=t[1],s=!1;for(let n=0,o=e.length-1;n<e.length;o=n++){let a=e[n][0],l=e[n][1],u=e[o][0],d=e[o][1];l>r!=d>r&&i<(u-a)*(r-l)/(d-l)+a&&(s=!s)}return s}function Nf(t,e){return e.every(i=>Lf(i,t))}function eP(t,e,i){function r(s,n){return n.some(o=>Lf(o,s))}return r(t,e)||!!i&&lV(t,e)}function Of(t){let e=ql(t);if(!e)return null;let i=da(e),r=1/0,s=new mt,n=0,o=e[0];for(let a=0;a<=e.length-1;a++){let l=a===e.length-1?e[0]:e[a+1],u=Math.atan2(l[1]-o[1],l[0]-o[0]),m=Tu(e,-u,i).reduce((_,v)=>(_.min[0]=Math.min(_.min[0],v[0]),_.min[1]=Math.min(_.min[1],v[1]),_.max[0]=Math.max(_.max[0],v[0]),_.max[1]=Math.max(_.max[1],v[1]),_),new mt),g=m.area();g<r&&(r=g,s=m,n=u),o=l}return{poly:Tu(s.polygon(),n,i),angle:n}}function Jb(t){let e=0;for(let i=0;i<t.length-1;i++)e+=Hi(t[i],t[i+1]);return e}function b8(t,e){let i=[80,20,50,20],r=0,s=0;return t[0]>e[0]-i[1]&&(r=-10),t[0]<i[3]&&(r=10),t[1]>e[1]-i[2]&&(s=-10),t[1]<i[0]&&(s=10),r||s?[r,s]:null}var zo=class{constructor(t,e,i){this._proj=Tf,this._dimensions=[[0,0],[0,0]],this._x=t||0,this._y=e||0,this._k=i||256/Math.PI}project(t){return t=this._proj(t[0]*Math.PI/180,t[1]*Math.PI/180),[t[0]*this._k+this._x,this._y-t[1]*this._k]}invert(t){return t=this._proj.invert((t[0]-this._x)/this._k,(this._y-t[1])/this._k),[t[0]*180/Math.PI,t[1]*180/Math.PI]}scale(t){return t===void 0?this._k:(this._k=+t,this)}translate(t){return t===void 0?[this._x,this._y]:(this._x=+t[0],this._y=+t[1],this)}dimensions(t){return t===void 0?this._dimensions:(this._dimensions=t,this)}transform(t){return t===void 0?yl.translate(this._x,this._y).scale(this._k):(this._x=+t.x,this._y=+t.y,this._k=+t.k,this)}getStream(){let t=this;return Lb({point:function(e,i){let r=t.project([e,i]);this.stream.point(r[0],r[1])}}).stream}};function W3(t,e,i){return Math.max(e,Math.min(t,i))}function QM(t,e){return Array.from(Array(1+e-t).keys()).map(i=>t+i)}var Ns=class{constructor(){this._tileSize=256,this._zoomRange=[0,24],this._margin=0,this._skipNullIsland=!1}getTiles(t){let e=t.dimensions(),i=t.translate(),r=t.scale(),s=Ba(r,this._tileSize),n=W3(Math.round(s),this._zoomRange[0],this._zoomRange[1]),o=0,a=Math.pow(2,n)-1,l=Math.log(this._tileSize)*Math.LOG2E,u=Math.pow(2,s-n+l),d=[r*Math.PI-i[0],r*Math.PI-i[1]],m=[d[0]+e[0][0],d[1]+e[0][1]],g=[d[0]+e[1][0],d[1]+e[1][1]],_=new mt(m,g),v=Math.pow(2,n)/2*this._tileSize,E=In(n,this._tileSize),b=new zo(v,v,E),T=QM(W3(Math.floor(m[0]/u)-this._margin,o,a),W3(Math.floor(g[0]/u)+this._margin,o,a)),A=QM(W3(Math.floor(m[1]/u)-this._margin,o,a),W3(Math.floor(g[1]/u)+this._margin,o,a)),M=[];for(let k=0;k<A.length;k++){let F=A[k];for(let O=0;O<T.length;O++){let B=T[O],U=[B,F,n];if(this._skipNullIsland&&Ns.isNearNullIsland(B,F,n))continue;let $=[B*this._tileSize,F*this._tileSize],q=[(B+1)*this._tileSize,(F+1)*this._tileSize],W=new mt($,q),Z=_.intersects(W),Q=b.invert([$[0],q[1]]),X=b.invert([q[0],$[1]]),ce={id:U.toString(),xyz:U,pxExtent:new mt($,q),wgs84Extent:new mt(Q,X),isVisible:Z};Z?M.unshift(ce):M.push(ce)}}return{tiles:M}}getGeoJSON(t){return{type:"FeatureCollection",features:t.tiles.map(i=>({type:"Feature",properties:{id:i.id,name:i.id},geometry:{type:"Polygon",coordinates:[i.wgs84Extent.polygon()]}}))}}tileSize(t){return t===void 0?this._tileSize:(this._tileSize=t,this)}zoomRange(t,e){return t===void 0?this._zoomRange:(e===void 0&&(e=t),this._zoomRange=[t,e],this)}margin(t){return t===void 0?this._margin:(this._margin=+t,this)}skipNullIsland(t){return t===void 0?this._skipNullIsland:(this._skipNullIsland=t,this)}static isNearNullIsland(t,e,i){if(i>=7){let r=Math.pow(2,i-1),s=Math.pow(2,i-6),n=r-s/2,o=r+s/2-1;return t>=n&&t<=o&&e>=n&&e<=o}return!1}};var uV=0;function Dt(t){if(!(this instanceof Dt))return t&&t.type?Dt[t.type].apply(this,arguments):t&&t.id?Dt[Dt.id.type(t.id)].apply(this,arguments):new Dt().initialize(arguments)}Dt.id=function(t){return Dt.id.fromOSM(t,Dt.id.next[t]--)};Dt.id.next={changeset:-1,node:-1,way:-1,relation:-1};Dt.id.fromOSM=function(t,e){return t[0]+e};Dt.id.toOSM=function(t){return t.slice(1)};Dt.id.type=function(t){return{c:"changeset",n:"node",w:"way",r:"relation"}[t[0]]};Dt.key=function(t){return t.id+"v"+(t.v||0)};var Bf;Dt.deprecatedTagValuesByKey=function(t){return Bf||(Bf={},t.forEach(function(e){var i=Object.keys(e.old);if(i.length===1){var r=i[0],s=e.old[r];s!=="*"&&(Bf[r]?Bf[r].push(s):Bf[r]=[s])}})),Bf};Dt.prototype={tags:{},initialize:function(t){for(var e=0;e<t.length;++e){var i=t[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(i[r]===void 0?delete this[r]:this[r]=i[r])}return!this.id&&this.type&&(this.id=Dt.id(this.type)),this.hasOwnProperty("visible")||(this.visible=!0),this},copy:function(t,e){if(e[this.id])return e[this.id];var i=Dt(this,{id:void 0,user:void 0,version:void 0,v:void 0});return e[this.id]=i,i},osmId:function(){return Dt.id.toOSM(this.id)},isNew:function(){return this.osmId()<0},update:function(t){return Dt(this,t).touch()},touch:function(){return this.v=uV++,this},mergeTags:function(t){var e=Object.assign({},this.tags),i=!1;for(var r in t){var s=e[r],n=t[r];if(!s)i=!0,e[r]=n;else if(r==="building"){if(n==="yes")continue;s==="yes"&&(i=!0,e[r]=n)}else s!==n&&(i=!0,e[r]=b9(ss(s.split(/;\s*/),n.split(/;\s*/)).join(";"),255))}return i?this.update({tags:e}):this},intersects:function(t,e){return this.extent(e).intersects(t)},hasNonGeometryTags:function(){return Object.keys(this.tags).some(function(t){return t!=="area"})},hasParentRelations:function(t){return t.parentRelations(this).length>0},hasInterestingTags:function(){return Object.keys(this.tags).some(Do)},isHighwayIntersection:function(){return!1},isDegenerate:function(){return!0},deprecatedTags:function(t){var e=this.tags;if(Object.keys(e).length===0)return[];var i=[];return t.forEach(function(r){var s=Object.keys(r.old);if(r.replace){var n=Object.keys(r.replace).some(function(a){if(!e[a]||r.old[a])return!1;var l=r.replace[a];return!(l==="*"||l===e[a])});if(n)return}var o=s.every(function(a){if(!e[a])return!1;if(r.old[a]==="*"||r.old[a]===e[a])return!0;var l=e[a].split(";").filter(Boolean);if(l.length===0)return!1;if(l.length>1)return l.indexOf(r.old[a])!==-1;if(e[a]===r.old[a])if(r.replace&&r.old[a]===r.replace[a]){var u=Object.keys(r.replace);return!u.every(function(d){return e[d]===r.replace[d]})}else return!0;return!1});o&&i.push(r)}),i}};function w8(t){if(t.type!=="way"||!t.tags.highway)return null;var e=t.tags,i=t.isOneWay(),r=hV(e,i),s=dV(e),n=fV(e,i,r),o=n.forward,a=n.backward,l=n.bothways,u={};u.unspecified=ew(e["turn:lanes"]),u.forward=ew(e["turn:lanes:forward"]),u.backward=ew(e["turn:lanes:backward"]);var d={};d.unspecified=tw(e["maxspeed:lanes"],s),d.forward=tw(e["maxspeed:lanes:forward"],s),d.backward=tw(e["maxspeed:lanes:backward"],s);var m={};m.unspecified=Go(e["psv:lanes"]),m.forward=Go(e["psv:lanes:forward"]),m.backward=Go(e["psv:lanes:backward"]);var g={};g.unspecified=Go(e["bus:lanes"]),g.forward=Go(e["bus:lanes:forward"]),g.backward=Go(e["bus:lanes:backward"]);var _={};_.unspecified=Go(e["taxi:lanes"]),_.forward=Go(e["taxi:lanes:forward"]),_.backward=Go(e["taxi:lanes:backward"]);var v={};v.unspecified=Go(e["hov:lanes"]),v.forward=Go(e["hov:lanes:forward"]),v.backward=Go(e["hov:lanes:backward"]);var E={};E.unspecified=Go(e["hgv:lanes"]),E.forward=Go(e["hgv:lanes:forward"]),E.backward=Go(e["hgv:lanes:backward"]);var b={};b.unspecified=iw(e["bicycleway:lanes"]),b.forward=iw(e["bicycleway:lanes:forward"]),b.backward=iw(e["bicycleway:lanes:backward"]);var T={forward:[],backward:[],unspecified:[]};return N1(T,u,"turnLane"),N1(T,d,"maxspeed"),N1(T,m,"psv"),N1(T,g,"bus"),N1(T,_,"taxi"),N1(T,v,"hov"),N1(T,E,"hgv"),N1(T,b,"bicycleway"),{metadata:{count:r,oneway:i,forward:o,backward:a,bothways:l,turnLanes:u,maxspeed:s,maxspeedLanes:d,psvLanes:m,busLanes:g,taxiLanes:_,hovLanes:v,hgvLanes:E,bicyclewayLanes:b},lanes:T}}function hV(t,e){var i;if(t.lanes&&(i=parseInt(t.lanes,10),i>0))return i;switch(t.highway){case"trunk":case"motorway":i=e?2:4;break;default:i=e?1:2;break}return i}function dV(t){var e=t.maxspeed;if(e){var i=/^([0-9][\.0-9]+?)(?:[ ]?(?:km\/h|kmh|kph|mph|knots))?$/;if(i.test(e))return parseInt(e,10)}}function fV(t,e,i){var r=parseInt(t["lanes:forward"],10),s=parseInt(t["lanes:backward"],10),n=parseInt(t["lanes:both_ways"],10)>0?1:0;return parseInt(t.oneway,10)===-1?(r=0,n=0,s=i):e?(r=i,n=0,s=0):isNaN(r)&&isNaN(s)?(s=Math.floor((i-n)/2),r=i-n-s):isNaN(r)?(s>i-n&&(s=i-n),r=i-n-s):isNaN(s)&&(r>i-n&&(r=i-n),s=i-n-r),{forward:r,backward:s,bothways:n}}function ew(t){if(t){var e=["left","slight_left","sharp_left","through","right","slight_right","sharp_right","reverse","merge_to_left","merge_to_right","none"];return t.split("|").map(function(i){return i===""&&(i="none"),i.split(";").map(function(r){return e.indexOf(r)===-1?"unknown":r})})}}function tw(t,e){if(t)return t.split("|").map(function(i){if(i==="none")return i;var r=parseInt(i,10);return i===""||r===e?null:isNaN(r)?"unknown":r})}function Go(t){if(t){var e=["yes","no","designated"];return t.split("|").map(function(i){return i===""&&(i="no"),e.indexOf(i)===-1?"unknown":i})}}function iw(t){if(t){var e=["yes","no","designated","lane"];return t.split("|").map(function(i){return i===""&&(i="no"),e.indexOf(i)===-1?"unknown":i})}}function N1(t,e,i){e.forward&&e.forward.forEach(function(r,s){t.forward[s]||(t.forward[s]={}),t.forward[s][i]=r}),e.backward&&e.backward.forEach(function(r,s){t.backward[s]||(t.backward[s]={}),t.backward[s][i]=r}),e.unspecified&&e.unspecified.forEach(function(r,s){t.unspecified[s]||(t.unspecified[s]={}),t.unspecified[s][i]=r})}var ir;function Os(t){if(ir&&!t)return ir;ir={};let e=navigator.userAgent,i=null;i=e.match(/(edg)\/?\s*(\.?\d+(\.\d+)*)/i),i!==null&&(ir.browser="Edge",ir.version=i[2]),ir.browser||(i=e.match(/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/i),i!==null&&(ir.browser="msie",ir.version=i[1])),ir.browser||(i=e.match(/(opr)\/?\s*(\.?\d+(\.\d+)*)/i),i!==null&&(ir.browser="Opera",ir.version=i[2])),ir.browser||(i=e.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i),i!==null&&(ir.browser=i[1],ir.version=i[2],i=e.match(/version\/([\.\d]+)/i),i!==null&&(ir.version=i[1]))),ir.browser||(ir.browser=navigator.appName,ir.version=navigator.appVersion),ir.version=ir.version.split(/\W/).slice(0,2).join("."),ir.opera=ir.browser.toLowerCase()==="opera"&&parseFloat(ir.version)<15,ir.browser.toLowerCase()==="msie"?ir.support=!1:ir.support=!0,ir.filedrop=window.FileReader&&"ondrop"in window,ir.download=!(ir.ie||ir.browser.toLowerCase()==="edge"),ir.cssfilters=!(ir.ie||ir.browser.toLowerCase()==="edge"),/Win/.test(e)?(ir.os="win",ir.platform="Windows"):/Mac/.test(e)?(ir.os="mac",ir.platform="Macintosh"):/X11/.test(e)||/Linux/.test(e)?(ir.os="linux",ir.platform="Linux"):(ir.os="win",ir.platform="Unknown"),ir.isMobileWebKit=(/\b(iPad|iPhone|iPod)\b/.test(e)||navigator.platform==="MacIntel"&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>1)&&/WebKit/.test(e)&&!/Edge/.test(e)&&!window.MSStream,ir.browserLocales=Array.from(new Set([navigator.language].concat(navigator.languages||[]).concat([navigator.userLanguage]).filter(Boolean)));let r=window.top.location,s=r.origin;return s||(s=r.protocol+"//"+r.hostname+(r.port?":"+r.port:"")),ir.host=s+r.pathname,ir}var $o=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))($o||{}),rw=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS",t))(rw||{}),E8=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(E8||{}),Ii=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(Ii||{}),pa=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(pa||{}),Bt=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(Bt||{}),Au=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(Au||{}),mi=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(mi||{}),T8=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(T8||{}),Qn=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(Qn||{}),ma=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(ma||{}),xn=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(xn||{}),Ks=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(Ks||{}),Ua=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(Ua||{}),S8=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(S8||{}),Ho=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(Ho||{}),Js=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(Js||{});var Xr=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(Xr||{}),ga=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(ga||{});var sw={createCanvas:(t,e)=>{let i=document.createElement("canvas");return i.width=t,i.height=e,i},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>new DOMParser().parseFromString(t,"text/xml")};var ut={ADAPTER:sw,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var nw=/iPhone/i,tP=/iPod/i,iP=/iPad/i,rP=/\biOS-universal(?:.+)Mac\b/i,ow=/\bAndroid(?:.+)Mobile\b/i,sP=/Android/i,Uf=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,A8=/Silk/i,Cu=/Windows Phone/i,nP=/\bWindows(?:.+)ARM\b/i,oP=/BlackBerry/i,aP=/BB10/i,lP=/Opera Mini/i,cP=/\b(CriOS|Chrome)(?:.+)Mobile/i,uP=/Mobile(?:.+)Firefox\b/i,hP=function(t){return typeof t<"u"&&t.platform==="MacIntel"&&typeof t.maxTouchPoints=="number"&&t.maxTouchPoints>1&&typeof MSStream>"u"};function pV(t){return function(e){return e.test(t)}}function O1(t){var e={userAgent:"",platform:"",maxTouchPoints:0};!t&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof t=="string"?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0});var i=e.userAgent,r=i.split("[FBAN");typeof r[1]<"u"&&(i=r[0]),r=i.split("Twitter"),typeof r[1]<"u"&&(i=r[0]);var s=pV(i),n={apple:{phone:s(nw)&&!s(Cu),ipod:s(tP),tablet:!s(nw)&&(s(iP)||hP(e))&&!s(Cu),universal:s(rP),device:(s(nw)||s(tP)||s(iP)||s(rP)||hP(e))&&!s(Cu)},amazon:{phone:s(Uf),tablet:!s(Uf)&&s(A8),device:s(Uf)||s(A8)},android:{phone:!s(Cu)&&s(Uf)||!s(Cu)&&s(ow),tablet:!s(Cu)&&!s(Uf)&&!s(ow)&&(s(A8)||s(sP)),device:!s(Cu)&&(s(Uf)||s(A8)||s(ow)||s(sP))||s(/\bokhttp\b/i)},windows:{phone:s(Cu),tablet:s(nP),device:s(Cu)||s(nP)},other:{blackberry:s(oP),blackberry10:s(aP),opera:s(lP),firefox:s(uP),chrome:s(cP),device:s(oP)||s(aP)||s(lP)||s(uP)||s(cP)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}var mV=O1.default??O1,xl=mV(globalThis.navigator);var At={};p9(At,{BaseTextureCache:()=>Xo,BoundingBox:()=>Yf,CanvasRenderTarget:()=>O8,DATA_URI:()=>L8,EventEmitter:()=>en.default,ProgramCache:()=>l5,TextureCache:()=>Hn,clearTextureCache:()=>eR,correctBlendMode:()=>jP,createIndicesForQuads:()=>YP,decomposeDataUri:()=>sR,deprecation:()=>er,destroyTextureCache:()=>JP,determineCrossOrigin:()=>z8,earcut:()=>nR.default,getBufferType:()=>B1,getCanvasBoundingBox:()=>B8,getResolutionOfUrl:()=>c5,hex2rgb:()=>GP,hex2string:()=>$P,interleaveTypedArrays:()=>ZP,isMobile:()=>xl,isPow2:()=>o5,isWebGLSupported:()=>D8,log2:()=>a5,nextPow2:()=>U1,path:()=>_w,premultiplyBlendMode:()=>n5,premultiplyRgba:()=>XP,premultiplyTint:()=>WP,premultiplyTintToRgba:()=>qP,removeItems:()=>N8,rgb2hex:()=>VP,sayHello:()=>MP,sign:()=>QP,skipHello:()=>kP,string2hex:()=>HP,trimCanvas:()=>rR,uid:()=>Pc,url:()=>R8});ut.RETINA_PREFIX=/@([0-9\.]+)x/;ut.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var en=Xi(lw(),1),nR=Xi(fw(),1);var jf=Xi(yw(),1),R8={parse:jf.parse,format:jf.format,resolve:jf.resolve};function Kl(t){if(typeof t!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function r5(t){return t.split("?")[0].split("#")[0]}function XV(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function WV(t,e,i){return t.replace(new RegExp(XV(e),"g"),i)}function qV(t,e){let i="",r=0,s=-1,n=0,o=-1;for(let a=0;a<=t.length;++a){if(a<t.length)o=t.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(s===a-1||n===1))if(s!==a-1&&n===2){if(i.length<2||r!==2||i.charCodeAt(i.length-1)!==46||i.charCodeAt(i.length-2)!==46){if(i.length>2){let l=i.lastIndexOf("/");if(l!==i.length-1){l===-1?(i="",r=0):(i=i.slice(0,l),r=i.length-1-i.lastIndexOf("/")),s=a,n=0;continue}}else if(i.length===2||i.length===1){i="",r=0,s=a,n=0;continue}}e&&(i.length>0?i+="/..":i="..",r=2)}else i.length>0?i+=`/${t.slice(s+1,a)}`:i=t.slice(s+1,a),r=a-s-1;s=a,n=0}else o===46&&n!==-1?++n:n=-1}return i}var _w={toPosix(t){return WV(t,"\\","/")},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl(t){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t)},hasProtocol(t){return/^[^/:]+:\//.test(this.toPosix(t))},getProtocol(t){Kl(t),t=this.toPosix(t);let e="",i=/^file:\/\/\//.exec(t),r=/^[^/:]+:\/\//.exec(t),s=/^[^/:]+:\//.exec(t);if(i||r||s){let n=i?.[0]||r?.[0]||s?.[0];e=n,t=t.slice(n.length)}return e},toAbsolute(t,e,i){if(this.isDataUrl(t))return t;let r=r5(this.toPosix(e??ut.ADAPTER.getBaseUrl())),s=r5(this.toPosix(i??this.rootname(r)));return Kl(t),t=this.toPosix(t),t.startsWith("/")?_w.join(s,t.slice(1)):this.isAbsolute(t)?t:this.join(r,t)},normalize(t){if(t=this.toPosix(t),Kl(t),t.length===0)return".";let e="",i=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));let r=t.endsWith("/");return t=qV(t,!1),t.length>0&&r&&(t+="/"),i?`/${t}`:e+t},isAbsolute(t){return Kl(t),t=this.toPosix(t),this.hasProtocol(t)?!0:t.startsWith("/")},join(...t){if(t.length===0)return".";let e;for(let i=0;i<t.length;++i){let r=t[i];if(Kl(r),r.length>0)if(e===void 0)e=r;else{let s=t[i-1]??"";this.extname(s)?e+=`/../${r}`:e+=`/${r}`}}return e===void 0?".":this.normalize(e)},dirname(t){if(Kl(t),t.length===0)return".";t=this.toPosix(t);let e=t.charCodeAt(0),i=e===47,r=-1,s=!0,n=this.getProtocol(t),o=t;t=t.slice(n.length);for(let a=t.length-1;a>=1;--a)if(e=t.charCodeAt(a),e===47){if(!s){r=a;break}}else s=!1;return r===-1?i?"/":this.isUrl(o)?n+t:n:i&&r===1?"//":n+t.slice(0,r)},rootname(t){Kl(t),t=this.toPosix(t);let e="";if(t.startsWith("/")?e="/":e=this.getProtocol(t),this.isUrl(t)){let i=t.indexOf("/",e.length);i!==-1?e=t.slice(0,i):e=t,e.endsWith("/")||(e+="/")}return e},basename(t,e){Kl(t),e&&Kl(e),t=r5(this.toPosix(t));let i=0,r=-1,s=!0,n;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(n=t.length-1;n>=0;--n){let l=t.charCodeAt(n);if(l===47){if(!s){i=n+1;break}}else a===-1&&(s=!1,a=n+1),o>=0&&(l===e.charCodeAt(o)?--o===-1&&(r=n):(o=-1,r=a))}return i===r?r=a:r===-1&&(r=t.length),t.slice(i,r)}for(n=t.length-1;n>=0;--n)if(t.charCodeAt(n)===47){if(!s){i=n+1;break}}else r===-1&&(s=!1,r=n+1);return r===-1?"":t.slice(i,r)},extname(t){Kl(t),t=r5(this.toPosix(t));let e=-1,i=0,r=-1,s=!0,n=0;for(let o=t.length-1;o>=0;--o){let a=t.charCodeAt(o);if(a===47){if(!s){i=o+1;break}continue}r===-1&&(s=!1,r=o+1),a===46?e===-1?e=o:n!==1&&(n=1):e!==-1&&(n=-1)}return e===-1||r===-1||n===0||n===1&&e===r-1&&e===i+1?"":t.slice(e,r)},parse(t){Kl(t);let e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;t=r5(this.toPosix(t));let i=t.charCodeAt(0),r=this.isAbsolute(t),s,n="";e.root=this.rootname(t),r||this.hasProtocol(t)?s=1:s=0;let o=-1,a=0,l=-1,u=!0,d=t.length-1,m=0;for(;d>=s;--d){if(i=t.charCodeAt(d),i===47){if(!u){a=d+1;break}continue}l===-1&&(u=!1,l=d+1),i===46?o===-1?o=d:m!==1&&(m=1):o!==-1&&(m=-1)}return o===-1||l===-1||m===0||m===1&&o===l-1&&o===a+1?l!==-1&&(a===0&&r?e.base=e.name=t.slice(1,l):e.base=e.name=t.slice(a,l)):(a===0&&r?(e.name=t.slice(1,o),e.base=t.slice(1,l)):(e.name=t.slice(a,o),e.base=t.slice(a,l)),e.ext=t.slice(o,l)),e.dir=this.dirname(t),n&&(e.dir=n+e.dir),e},sep:"/",delimiter:":"};var IP={};function er(t,e,i=3){if(IP[e])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${t}`):(r=r.split(`
`).splice(i).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${t}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${t}`),console.warn(r))),IP[e]=!0}function kP(){er("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function MP(){er("7.0.0",`sayHello is deprecated, please use Renderer's "hello" option`)}var xw;function D8(){return typeof xw>"u"&&(xw=function(){let e={stencil:!0,failIfMajorPerformanceCaveat:ut.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!ut.ADAPTER.getWebGLRenderingContext())return!1;let i=ut.ADAPTER.createCanvas(),r=i.getContext("webgl",e)||i.getContext("experimental-webgl",e),s=!!r?.getContextAttributes()?.stencil;if(r){let n=r.getExtension("WEBGL_lose_context");n&&n.loseContext()}return r=null,s}catch{return!1}}()),xw}var YV={grad:.9,turn:360,rad:360/(2*Math.PI)},Iu=function(t){return typeof t=="string"?t.length>0:typeof t=="number"},$n=function(t,e,i){return e===void 0&&(e=0),i===void 0&&(i=Math.pow(10,e)),Math.round(i*t)/i+0},bl=function(t,e,i){return e===void 0&&(e=0),i===void 0&&(i=1),t>i?i:t>e?t:e},BP=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},PP=function(t){return{r:bl(t.r,0,255),g:bl(t.g,0,255),b:bl(t.b,0,255),a:bl(t.a)}},vw=function(t){return{r:$n(t.r),g:$n(t.g),b:$n(t.b),a:$n(t.a,3)}},ZV=/^#([0-9a-f]{3,8})$/i,F8=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},UP=function(t){var e=t.r,i=t.g,r=t.b,s=t.a,n=Math.max(e,i,r),o=n-Math.min(e,i,r),a=o?n===e?(i-r)/o:n===i?2+(r-e)/o:4+(e-i)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:s}},zP=function(t){var e=t.h,i=t.s,r=t.v,s=t.a;e=e/360*6,i/=100,r/=100;var n=Math.floor(e),o=r*(1-i),a=r*(1-(e-n)*i),l=r*(1-(1-e+n)*i),u=n%6;return{r:255*[r,a,o,o,l,r][u],g:255*[l,r,r,a,o,o][u],b:255*[o,o,l,r,r,a][u],a:s}},RP=function(t){return{h:BP(t.h),s:bl(t.s,0,100),l:bl(t.l,0,100),a:bl(t.a)}},DP=function(t){return{h:$n(t.h),s:$n(t.s),l:$n(t.l),a:$n(t.a,3)}},FP=function(t){return zP((i=(e=t).s,{h:e.h,s:(i*=((r=e.l)<50?r:100-r)/100)>0?2*i/(r+i)*100:0,v:r+i,a:e.a}));var e,i,r},s5=function(t){return{h:(e=UP(t)).h,s:(s=(200-(i=e.s))*(r=e.v)/100)>0&&s<200?i*r/100/(s<=100?s:200-s)*100:0,l:s/2,a:e.a};var e,i,r,s},QV=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,KV=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,JV=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ej=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ew={string:[[function(t){var e=ZV.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:t.length===4?$n(parseInt(t[3]+t[3],16)/255,2):1}:t.length===6||t.length===8?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:t.length===8?$n(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=JV.exec(t)||ej.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:PP({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=QV.exec(t)||KV.exec(t);if(!e)return null;var i,r,s=RP({h:(i=e[1],r=e[2],r===void 0&&(r="deg"),Number(i)*(YV[r]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return FP(s)},"hsl"]],object:[[function(t){var e=t.r,i=t.g,r=t.b,s=t.a,n=s===void 0?1:s;return Iu(e)&&Iu(i)&&Iu(r)?PP({r:Number(e),g:Number(i),b:Number(r),a:Number(n)}):null},"rgb"],[function(t){var e=t.h,i=t.s,r=t.l,s=t.a,n=s===void 0?1:s;if(!Iu(e)||!Iu(i)||!Iu(r))return null;var o=RP({h:Number(e),s:Number(i),l:Number(r),a:Number(n)});return FP(o)},"hsl"],[function(t){var e=t.h,i=t.s,r=t.v,s=t.a,n=s===void 0?1:s;if(!Iu(e)||!Iu(i)||!Iu(r))return null;var o=function(a){return{h:BP(a.h),s:bl(a.s,0,100),v:bl(a.v,0,100),a:bl(a.a)}}({h:Number(e),s:Number(i),v:Number(r),a:Number(n)});return zP(o)},"hsv"]]},LP=function(t,e){for(var i=0;i<e.length;i++){var r=e[i][0](t);if(r)return[r,e[i][1]]}return[null,void 0]},tj=function(t){return typeof t=="string"?LP(t.trim(),Ew.string):typeof t=="object"&&t!==null?LP(t,Ew.object):[null,void 0]};var bw=function(t,e){var i=s5(t);return{h:i.h,s:bl(i.s+100*e,0,100),l:i.l,a:i.a}},ww=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},NP=function(t,e){var i=s5(t);return{h:i.h,s:i.s,l:bl(i.l+100*e,0,100),a:i.a}},Tw=function(){function t(e){this.parsed=tj(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return this.parsed!==null},t.prototype.brightness=function(){return $n(ww(this.rgba),2)},t.prototype.isDark=function(){return ww(this.rgba)<.5},t.prototype.isLight=function(){return ww(this.rgba)>=.5},t.prototype.toHex=function(){return e=vw(this.rgba),i=e.r,r=e.g,s=e.b,o=(n=e.a)<1?F8($n(255*n)):"","#"+F8(i)+F8(r)+F8(s)+o;var e,i,r,s,n,o},t.prototype.toRgb=function(){return vw(this.rgba)},t.prototype.toRgbString=function(){return e=vw(this.rgba),i=e.r,r=e.g,s=e.b,(n=e.a)<1?"rgba("+i+", "+r+", "+s+", "+n+")":"rgb("+i+", "+r+", "+s+")";var e,i,r,s,n},t.prototype.toHsl=function(){return DP(s5(this.rgba))},t.prototype.toHslString=function(){return e=DP(s5(this.rgba)),i=e.h,r=e.s,s=e.l,(n=e.a)<1?"hsla("+i+", "+r+"%, "+s+"%, "+n+")":"hsl("+i+", "+r+"%, "+s+"%)";var e,i,r,s,n},t.prototype.toHsv=function(){return e=UP(this.rgba),{h:$n(e.h),s:$n(e.s),v:$n(e.v),a:$n(e.a,3)};var e},t.prototype.invert=function(){return jo({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},t.prototype.saturate=function(e){return e===void 0&&(e=.1),jo(bw(this.rgba,e))},t.prototype.desaturate=function(e){return e===void 0&&(e=.1),jo(bw(this.rgba,-e))},t.prototype.grayscale=function(){return jo(bw(this.rgba,-1))},t.prototype.lighten=function(e){return e===void 0&&(e=.1),jo(NP(this.rgba,e))},t.prototype.darken=function(e){return e===void 0&&(e=.1),jo(NP(this.rgba,-e))},t.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},t.prototype.alpha=function(e){return typeof e=="number"?jo({r:(i=this.rgba).r,g:i.g,b:i.b,a:e}):$n(this.rgba.a,3);var i},t.prototype.hue=function(e){var i=s5(this.rgba);return typeof e=="number"?jo({h:e,s:i.s,l:i.l,a:i.a}):$n(i.h)},t.prototype.isEqual=function(e){return this.toHex()===jo(e).toHex()},t}(),jo=function(t){return t instanceof Tw?t:new Tw(t)},OP=[],Xf=function(t){t.forEach(function(e){OP.indexOf(e)<0&&(e(Tw,Ew),OP.push(e))})};function Wf(t,e){var i={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var s in i)r[i[s]]=s;var n={};t.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,u=r[this.toHex()];if(u)return u;if(o?.closest){var d=this.toRgb(),m=1/0,g="black";if(!n.length)for(var _ in i)n[_]=new t(i[_]).toRgb();for(var v in i){var E=(a=d,l=n[v],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));E<m&&(m=E,g=v)}return g}},e.string.push([function(o){var a=o.toLowerCase(),l=a==="transparent"?"#0000":i[a];return l?new t(l).toRgb():null},"name"])}Xf([Wf]);var qf=class{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof qf)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){let i=typeof t;if(i!==typeof e)return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((s,n)=>s===e[n]);if(t!==null&&e!==null){let s=Object.keys(t),n=Object.keys(e);return s.length!==n.length?!1:s.every(o=>t[o]===e[o])}return t===e}toRgba(){let[t,e,i,r]=this._components;return{r:t,g:e,b:i,a:r}}toRgb(){let[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){let[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){let[e,i,r]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(r*255),t}toRgbArray(t){t=t??[];let[e,i,r]=this._components;return t[0]=e,t[1]=i,t[2]=r,t}toNumber(){return this._int}toLittleEndianNumber(){let t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){let[e,i,r,s]=qf.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=r,this._components[3]*=s,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,r=this._int>>8&255,s=this._int&255;return e&&(i=i*t+.5|0,r=r*t+.5|0,s=s*t+.5|0),(t*255<<24)+(i<<16)+(r<<8)+s}toHex(){let t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){let e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){let[e,i,r]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(r*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];let[e,i,r,s]=this._components;return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}normalize(t){let e,i,r,s;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){let n=t;e=(n>>16&255)/255,i=(n>>8&255)/255,r=(n&255)/255,s=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,r,s=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,r,s=255]=t,e/=255,i/=255,r/=255,s/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){let o=qf.HEX_PATTERN.exec(t);o&&(t=`#${o[2]}`)}let n=jo(t);n.isValid()&&({r:e,g:i,b:r,a:s}=n.rgba,e/=255,i/=255,r/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=r,this._components[3]=s,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);let[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach((r,s)=>{t[s]=Math.min(Math.max(r,e),i)}),t)}},za=qf;za.shared=new qf;za.temp=new qf;za.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;function GP(t,e=[]){return er("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),za.shared.setValue(t).toRgbArray(e)}function $P(t){return er("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),za.shared.setValue(t).toHex()}function HP(t){return er("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),za.shared.setValue(t).toNumber()}function VP(t){return er("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),za.shared.setValue(t).toNumber()}function ij(){let t=[],e=[];for(let r=0;r<32;r++)t[r]=r,e[r]=r;t[Ii.NORMAL_NPM]=Ii.NORMAL,t[Ii.ADD_NPM]=Ii.ADD,t[Ii.SCREEN_NPM]=Ii.SCREEN,e[Ii.NORMAL]=Ii.NORMAL_NPM,e[Ii.ADD]=Ii.ADD_NPM,e[Ii.SCREEN]=Ii.SCREEN_NPM;let i=[];return i.push(e),i.push(t),i}var n5=ij();function jP(t,e){return n5[e?1:0][t]}function XP(t,e,i,r=!0){return er("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),za.shared.setValue(t).premultiply(e,r).toArray(i??new Float32Array(4))}function WP(t,e){return er("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),za.shared.setValue(t).toPremultiplied(e)}function qP(t,e,i,r=!0){return er("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),za.shared.setValue(t).premultiply(e,r).toArray(i??new Float32Array(4))}var L8=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function YP(t,e=null){let i=t*6;if(e=e||new Uint16Array(i),e.length!==i)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${i}`);for(let r=0,s=0;r<i;r+=6,s+=4)e[r+0]=s+0,e[r+1]=s+1,e[r+2]=s+2,e[r+3]=s+0,e[r+4]=s+2,e[r+5]=s+3;return e}function B1(t){if(t.BYTES_PER_ELEMENT===4)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(t.BYTES_PER_ELEMENT===2){if(t instanceof Uint16Array)return"Uint16Array"}else if(t.BYTES_PER_ELEMENT===1&&t instanceof Uint8Array)return"Uint8Array";return null}var rj={Float32Array,Uint32Array,Int32Array,Uint8Array};function ZP(t,e){let i=0,r=0,s={};for(let l=0;l<t.length;l++)r+=e[l],i+=t[l].length;let n=new ArrayBuffer(i*4),o=null,a=0;for(let l=0;l<t.length;l++){let u=e[l],d=t[l],m=B1(d);s[m]||(s[m]=new rj[m](n)),o=s[m];for(let g=0;g<d.length;g++){let _=(g/u|0)*r+a,v=g%u;o[_+v]=d[g]}a+=u}return new Float32Array(n)}function U1(t){return t+=t===0?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t+1}function o5(t){return!(t&t-1)&&!!t}function a5(t){let e=(t>65535?1:0)<<4;t>>>=e;let i=(t>255?1:0)<<3;return t>>>=i,e|=i,i=(t>15?1:0)<<2,t>>>=i,e|=i,i=(t>3?1:0)<<1,t>>>=i,e|=i,e|t>>1}function N8(t,e,i){let r=t.length,s;if(e>=r||i===0)return;i=e+i>r?r-e:i;let n=r-i;for(s=e;s<n;++s)t[s]=t[s+i];t.length=n}function QP(t){return t===0?0:t<0?-1:1}var sj=0;function Pc(){return++sj}var KP=class{constructor(t,e,i,r){this.left=t,this.top=e,this.right=i,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}},Yf=KP;Yf.EMPTY=new KP(0,0,0,0);var l5={},Hn=Object.create(null),Xo=Object.create(null);function JP(){let t;for(t in Hn)Hn[t].destroy();for(t in Xo)Xo[t].destroy()}function eR(){let t;for(t in Hn)delete Hn[t];for(t in Xo)delete Xo[t]}var O8=class{constructor(e,i,r){this._canvas=ut.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||ut.RESOLUTION,this.resize(e,i)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,i){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(i*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}};function tR(t,e,i){for(let r=0,s=4*i*e;r<e;++r,s+=4)if(t[s+3]!==0)return!1;return!0}function iR(t,e,i,r,s){let n=4*e;for(let o=r,a=r*n+4*i;o<=s;++o,a+=n)if(t[a+3]!==0)return!1;return!0}function B8(t){let{width:e,height:i}=t,r=t.getContext("2d",{willReadFrequently:!0});if(r===null)throw new TypeError("Failed to get canvas 2D context");let n=r.getImageData(0,0,e,i).data,o=0,a=0,l=e-1,u=i-1;for(;a<i&&tR(n,e,a);)++a;if(a===i)return Yf.EMPTY;for(;tR(n,e,u);)--u;for(;iR(n,e,o,a,u);)++o;for(;iR(n,e,l,a,u);)--l;return++l,++u,new Yf(o,a,l,u)}function rR(t){let e=B8(t),{width:i,height:r}=e,s=null;if(!e.isEmpty()){let n=t.getContext("2d");if(n===null)throw new TypeError("Failed to get canvas 2D context");s=n.getImageData(e.left,e.top,i,r)}return{width:i,height:r,data:s}}function sR(t){let e=L8.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}}var U8;function z8(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location,U8||(U8=document.createElement("a")),U8.href=t;let i=R8.parse(U8.href),r=!i.port&&e.port===""||i.port===e.port;return i.hostname!==e.hostname||!r||i.protocol!==e.protocol?"anonymous":""}function c5(t,e=1){let i=ut.RETINA_PREFIX?.exec(t);return i?parseFloat(i[1]):e}Xf([Wf]);var Zf=class{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Zf)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){let i=typeof t;if(i!==typeof e)return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((s,n)=>s===e[n]);if(t!==null&&e!==null){let s=Object.keys(t),n=Object.keys(e);return s.length!==n.length?!1:s.every(o=>t[o]===e[o])}return t===e}toRgba(){let[t,e,i,r]=this._components;return{r:t,g:e,b:i,a:r}}toRgb(){let[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){let[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){let[e,i,r]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(r*255),t}toRgbArray(t){t=t??[];let[e,i,r]=this._components;return t[0]=e,t[1]=i,t[2]=r,t}toNumber(){return this._int}toLittleEndianNumber(){let t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){let[e,i,r,s]=Zf.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=r,this._components[3]*=s,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,r=this._int>>8&255,s=this._int&255;return e&&(i=i*t+.5|0,r=r*t+.5|0,s=s*t+.5|0),(t*255<<24)+(i<<16)+(r<<8)+s}toHex(){let t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){let e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){let[e,i,r]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(r*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];let[e,i,r,s]=this._components;return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}normalize(t){let e,i,r,s;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){let n=t;e=(n>>16&255)/255,i=(n>>8&255)/255,r=(n&255)/255,s=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,r,s=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,r,s=255]=t,e/=255,i/=255,r/=255,s/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){let o=Zf.HEX_PATTERN.exec(t);o&&(t=`#${o[2]}`)}let n=jo(t);n.isValid()&&({r:e,g:i,b:r,a:s}=n.rgba,e/=255,i/=255,r/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=r,this._components[3]=s,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);let[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach((r,s)=>{t[s]=Math.min(Math.max(r,e),i)}),t)}},fi=Zf;fi.shared=new Zf;fi.temp=new Zf;fi.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;var yt=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(yt||{}),Sw=t=>{if(typeof t=="function"||typeof t=="object"&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={...typeof t.extension!="object"?{type:t.extension}:t.extension,ref:t}}if(typeof t=="object")t={...t};else throw new Error("Invalid extension type");return typeof t.type=="string"&&(t.type=[t.type]),t},oR=(t,e)=>Sw(t).priority??e,St={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(Sw).forEach(e=>{e.type.forEach(i=>this._removeHandlers[i]?.(e))}),this},add(...t){return t.map(Sw).forEach(e=>{e.type.forEach(i=>{let r=this._addHandlers,s=this._queue;r[i]?r[i](e):(s[i]=s[i]||[],s[i].push(e))})}),this},handle(t,e,i){let r=this._addHandlers,s=this._removeHandlers;if(r[t]||s[t])throw new Error(`Extension type ${t} already has a handler`);r[t]=e,s[t]=i;let n=this._queue;return n[t]&&(n[t].forEach(o=>e(o)),delete n[t]),this},handleByMap(t,e){return this.handle(t,i=>{e[i.name]=i.ref},i=>{delete e[i.name]})},handleByList(t,e,i=-1){return this.handle(t,r=>{e.includes(r.ref)||(e.push(r.ref),e.sort((s,n)=>oR(n,i)-oR(s,i)))},r=>{let s=e.indexOf(r.ref);s!==-1&&e.splice(s,1)})}};var z1=class{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}};var nj=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function oj(t){let e="";for(let i=0;i<t;++i)i>0&&(e+=`
else `),i<t-1&&(e+=`if(test == ${i}.0){}`);return e}function G8(t,e){if(t===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");let i=e.createShader(e.FRAGMENT_SHADER);for(;;){let r=nj.replace(/%forloop%/gi,oj(t));if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))t=t/2|0;else break}return t}var Aw=0,Cw=1,Iw=2,kw=3,Mw=4,Pw=5,Kn=class t{constructor(){this.data=0,this.blendMode=Ii.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Aw)}set blend(e){!!(this.data&1<<Aw)!==e&&(this.data^=1<<Aw)}get offsets(){return!!(this.data&1<<Cw)}set offsets(e){!!(this.data&1<<Cw)!==e&&(this.data^=1<<Cw)}get culling(){return!!(this.data&1<<Iw)}set culling(e){!!(this.data&1<<Iw)!==e&&(this.data^=1<<Iw)}get depthTest(){return!!(this.data&1<<kw)}set depthTest(e){!!(this.data&1<<kw)!==e&&(this.data^=1<<kw)}get depthMask(){return!!(this.data&1<<Pw)}set depthMask(e){!!(this.data&1<<Pw)!==e&&(this.data^=1<<Pw)}get clockwiseFrontFace(){return!!(this.data&1<<Mw)}set clockwiseFrontFace(e){!!(this.data&1<<Mw)!==e&&(this.data^=1<<Mw)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==Ii.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){let e=new t;return e.depthTest=!1,e.blend=!0,e}};var Qf=[];function Kf(t,e){if(!t)return null;let i="";if(typeof t=="string"){let r=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);r&&(i=r[1].toLowerCase())}for(let r=Qf.length-1;r>=0;--r){let s=Qf[r];if(s.test&&s.test(t,i))return new s(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}var hn=class{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,i,r,s,n,o,a,l){if(arguments.length>8)throw new Error("max arguments reached");let{name:u,items:d}=this;this._aliasCount++;for(let m=0,g=d.length;m<g;m++)d[m][u](e,i,r,s,n,o,a,l);return d===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){let i=this.items.indexOf(e);return i!==-1&&(this.ensureNonAliasedItems(),this.items.splice(i,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}};Object.defineProperties(hn.prototype,{dispatch:{value:hn.prototype.emit},run:{value:hn.prototype.emit}});var Wo=class{constructor(e=0,i=0){this._width=e,this._height=i,this.destroyed=!1,this.internal=!1,this.onResize=new hn("setRealSize"),this.onUpdate=new hn("update"),this.onError=new hn("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,i){(e!==this._width||i!==this._height)&&(this._width=e,this._height=i,this.onResize.emit(e,i))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,i,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,i){return!1}};var ya=class extends Wo{constructor(e,i){let{width:r,height:s}=i||{};if(!r||!s)throw new Error("BufferResource width or height invalid");super(r,s),this.data=e}upload(e,i,r){let s=e.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===Ks.UNPACK);let n=i.realWidth,o=i.realHeight;return r.width===n&&r.height===o?s.texSubImage2D(i.target,0,0,0,n,o,i.format,r.type,this.data):(r.width=n,r.height=o,s.texImage2D(i.target,0,r.internalFormat,n,o,0,i.format,r.type,this.data)),!0}dispose(){this.data=null}static test(e){return e instanceof Float32Array||e instanceof Uint8Array||e instanceof Uint32Array}};var aj={scaleMode:Qn.NEAREST,format:Bt.RGBA,alphaMode:Ks.NPM},Jf=class extends en.default{constructor(t=null,e=null){super(),e=Object.assign({},Jf.defaultOptions,e);let{alphaMode:i,mipmap:r,anisotropicLevel:s,scaleMode:n,width:o,height:a,wrapMode:l,format:u,type:d,target:m,resolution:g,resourceOptions:_}=e;t&&!(t instanceof Wo)&&(t=Kf(t,_),t.internal=!0),this.resolution=g||ut.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=s,this._wrapMode=l,this._scaleMode=n,this.format=u,this.type=d,this.target=m,this.alphaMode=i,this.uid=Pc(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=o5(this.realWidth)&&o5(this.realHeight)}setResolution(t){let e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Xo[this.cacheId],delete Hn[this.cacheId],this.cacheId=null),this.dispose(),Jf.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,i=ut.STRICT_TEXTURE_CACHE){let r=typeof t=="string",s=null;if(r)s=t;else{if(!t._pixiId){let o=e?.pixiIdPrefix||"pixiid";t._pixiId=`${o}_${Pc()}`}s=t._pixiId}let n=Xo[s];if(r&&i&&!n)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return n||(n=new Jf(t,e),n.cacheId=s,Jf.addToCache(n,s)),n}static fromBuffer(t,e,i,r){t=t||new Float32Array(e*i*4);let s=new ya(t,{width:e,height:i}),n=t instanceof Float32Array?mi.FLOAT:mi.UNSIGNED_BYTE;return new Jf(s,Object.assign({},aj,{type:n},r))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Xo[e]&&Xo[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Xo[e]=t)}static removeFromCache(t){if(typeof t=="string"){let e=Xo[t];if(e){let i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Xo[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Xo[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}},li=Jf;li.defaultOptions={mipmap:xn.POW2,anisotropicLevel:0,scaleMode:Qn.LINEAR,wrapMode:ma.CLAMP,alphaMode:Ks.UNPACK,target:Au.TEXTURE_2D,format:Bt.RGBA,type:mi.UNSIGNED_BYTE};li._globalBatch=0;var G1=class{constructor(){this.texArray=null,this.blend=0,this.type=pa.TRIANGLES,this.start=0,this.size=0,this.data=null}};var lj=0,Kr=class t{constructor(e,i=!0,r=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=i,this.id=lj++,this.disposeRunner=new hn("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?ga.ELEMENT_ARRAY_BUFFER:ga.ARRAY_BUFFER}get index(){return this.type===ga.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new t(e)}};var e2=class t{constructor(e,i=0,r=!1,s=mi.FLOAT,n,o,a,l=1){this.buffer=e,this.size=i,this.normalized=r,this.type=s,this.stride=n,this.start=o,this.instance=a,this.divisor=l}destroy(){this.buffer=null}static from(e,i,r,s,n){return new t(e,i,r,s,n)}};var cj={Float32Array,Uint32Array,Int32Array,Uint8Array};function aR(t,e){let i=0,r=0,s={};for(let l=0;l<t.length;l++)r+=e[l],i+=t[l].length;let n=new ArrayBuffer(i*4),o=null,a=0;for(let l=0;l<t.length;l++){let u=e[l],d=t[l],m=B1(d);s[m]||(s[m]=new cj[m](n)),o=s[m];for(let g=0;g<d.length;g++){let _=(g/u|0)*r+a,v=g%u;o[_+v]=d[g]}a+=u}return new Float32Array(n)}var lR={5126:4,5123:2,5121:1},uj=0,hj={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},qo=class t{constructor(e=[],i={}){this.buffers=e,this.indexBuffer=null,this.attributes=i,this.glVertexArrayObjects={},this.id=uj++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new hn("disposeGeometry"),this.refCount=0}addAttribute(e,i,r=0,s=!1,n,o,a,l=!1){if(!i)throw new Error("You must pass a buffer when creating an attribute");i instanceof Kr||(i instanceof Array&&(i=new Float32Array(i)),i=new Kr(i));let u=e.split("|");if(u.length>1){for(let m=0;m<u.length;m++)this.addAttribute(u[m],i,r,s,n);return this}let d=this.buffers.indexOf(i);return d===-1&&(this.buffers.push(i),d=this.buffers.length-1),this.attributes[e]=new e2(d,r,s,n,o,a,l),this.instanced=this.instanced||l,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof Kr||(e instanceof Array&&(e=new Uint16Array(e)),e=new Kr(e)),e.type=ga.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;let e=[],i=[],r=new Kr,s;for(s in this.attributes){let n=this.attributes[s],o=this.buffers[n.buffer];e.push(o.data),i.push(n.size*lR[n.type]/4),n.buffer=0}for(r.data=aR(e,i),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(let e in this.attributes){let i=this.attributes[e];return this.buffers[i.buffer].data.length/(i.stride/4||i.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){let e=new t;for(let i=0;i<this.buffers.length;i++)e.buffers[i]=new Kr(this.buffers[i].data.slice(0));for(let i in this.attributes){let r=this.attributes[i];e.attributes[i]=new e2(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=ga.ELEMENT_ARRAY_BUFFER),e}static merge(e){let i=new t,r=[],s=[],n=[],o;for(let a=0;a<e.length;a++){o=e[a];for(let l=0;l<o.buffers.length;l++)s[l]=s[l]||0,s[l]+=o.buffers[l].data.length,n[l]=0}for(let a=0;a<o.buffers.length;a++)r[a]=new hj[B1(o.buffers[a].data)](s[a]),i.buffers[a]=new Kr(r[a]);for(let a=0;a<e.length;a++){o=e[a];for(let l=0;l<o.buffers.length;l++)r[l].set(o.buffers[l].data,n[l]),n[l]+=o.buffers[l].data.length}if(i.attributes=o.attributes,o.indexBuffer){i.indexBuffer=i.buffers[o.buffers.indexOf(o.indexBuffer)],i.indexBuffer.type=ga.ELEMENT_ARRAY_BUFFER;let a=0,l=0,u=0,d=0;for(let m=0;m<o.buffers.length;m++)if(o.buffers[m]!==o.indexBuffer){d=m;break}for(let m in o.attributes){let g=o.attributes[m];(g.buffer|0)===d&&(l+=g.size*lR[g.type]/4)}for(let m=0;m<e.length;m++){let g=e[m].indexBuffer.data;for(let _=0;_<g.length;_++)i.indexBuffer.data[_+u]+=a;a+=e[m].buffers[d].data.length/l,u+=g.length}}return i}};var fd=class extends qo{constructor(e=!1){super(),this._buffer=new Kr(null,e,!1),this._indexBuffer=new Kr(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,mi.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,mi.FLOAT).addAttribute("aColor",this._buffer,4,!0,mi.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,mi.FLOAT).addIndex(this._indexBuffer)}};var $1=Math.PI*2,Rw=180/Math.PI,Jl=Math.PI/180,os=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(os||{});var Jt=class t{constructor(e=0,i=0){this.x=0,this.y=0,this.x=e,this.y=i}clone(){return new t(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,i=e){return this.x=e,this.y=i,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}};var $8=[new Jt,new Jt,new Jt,new Jt],ei=class t{constructor(e=0,i=0,r=0,s=0){this.x=Number(e),this.y=Number(i),this.width=Number(r),this.height=Number(s),this.type=os.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new t(0,0,0,0)}clone(){return new t(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,i){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&i>=this.y&&i<this.y+this.height}intersects(e,i){if(!i){let U=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=U)return!1;let q=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>q}let r=this.left,s=this.right,n=this.top,o=this.bottom;if(s<=r||o<=n)return!1;let a=$8[0].set(e.left,e.top),l=$8[1].set(e.left,e.bottom),u=$8[2].set(e.right,e.top),d=$8[3].set(e.right,e.bottom);if(u.x<=a.x||l.y<=a.y)return!1;let m=Math.sign(i.a*i.d-i.b*i.c);if(m===0||(i.apply(a,a),i.apply(l,l),i.apply(u,u),i.apply(d,d),Math.max(a.x,l.x,u.x,d.x)<=r||Math.min(a.x,l.x,u.x,d.x)>=s||Math.max(a.y,l.y,u.y,d.y)<=n||Math.min(a.y,l.y,u.y,d.y)>=o))return!1;let g=m*(l.y-a.y),_=m*(a.x-l.x),v=g*r+_*n,E=g*s+_*n,b=g*r+_*o,T=g*s+_*o;if(Math.max(v,E,b,T)<=g*a.x+_*a.y||Math.min(v,E,b,T)>=g*d.x+_*d.y)return!1;let A=m*(a.y-u.y),M=m*(u.x-a.x),k=A*r+M*n,F=A*s+M*n,O=A*r+M*o,B=A*s+M*o;return!(Math.max(k,F,O,B)<=A*a.x+M*a.y||Math.min(k,F,O,B)>=A*d.x+M*d.y)}pad(e=0,i=e){return this.x-=e,this.y-=i,this.width+=e*2,this.height+=i*2,this}fit(e){let i=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),s=Math.max(this.y,e.y),n=Math.min(this.y+this.height,e.y+e.height);return this.x=i,this.width=Math.max(r-i,0),this.y=s,this.height=Math.max(n-s,0),this}ceil(e=1,i=.001){let r=Math.ceil((this.x+this.width-i)*e)/e,s=Math.ceil((this.y+this.height-i)*e)/e;return this.x=Math.floor((this.x+i)*e)/e,this.y=Math.floor((this.y+i)*e)/e,this.width=r-this.x,this.height=s-this.y,this}enlarge(e){let i=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),s=Math.min(this.y,e.y),n=Math.max(this.y+this.height,e.y+e.height);return this.x=i,this.width=r-i,this.y=s,this.height=n-s,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}};var H1=class t{constructor(e=0,i=0,r=0){this.x=e,this.y=i,this.radius=r,this.type=os.CIRC}clone(){return new t(this.x,this.y,this.radius)}contains(e,i){if(this.radius<=0)return!1;let r=this.radius*this.radius,s=this.x-e,n=this.y-i;return s*=s,n*=n,s+n<=r}getBounds(){return new ei(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}};var u5=class t{constructor(e=0,i=0,r=0,s=0){this.x=e,this.y=i,this.width=r,this.height=s,this.type=os.ELIP}clone(){return new t(this.x,this.y,this.width,this.height)}contains(e,i){if(this.width<=0||this.height<=0)return!1;let r=(e-this.x)/this.width,s=(i-this.y)/this.height;return r*=r,s*=s,r+s<=1}getBounds(){return new ei(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}};var Jn=class t{constructor(...e){let i=Array.isArray(e[0])?e[0]:e;if(typeof i[0]!="number"){let r=[];for(let s=0,n=i.length;s<n;s++)r.push(i[s].x,i[s].y);i=r}this.points=i,this.type=os.POLY,this.closeStroke=!0}clone(){let e=this.points.slice(),i=new t(e);return i.closeStroke=this.closeStroke,i}contains(e,i){let r=!1,s=this.points.length/2;for(let n=0,o=s-1;n<s;o=n++){let a=this.points[n*2],l=this.points[n*2+1],u=this.points[o*2],d=this.points[o*2+1];l>i!=d>i&&e<(u-a)*((i-l)/(d-l))+a&&(r=!r)}return r}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((e,i)=>`${e}, ${i}`,"")}]`}};var h5=class t{constructor(e=0,i=0,r=0,s=0,n=20){this.x=e,this.y=i,this.width=r,this.height=s,this.radius=n,this.type=os.RREC}clone(){return new t(this.x,this.y,this.width,this.height,this.radius)}contains(e,i){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&i>=this.y&&i<=this.y+this.height){let r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(i>=this.y+r&&i<=this.y+this.height-r||e>=this.x+r&&e<=this.x+this.width-r)return!0;let s=e-(this.x+r),n=i-(this.y+r),o=r*r;if(s*s+n*n<=o||(s=e-(this.x+this.width-r),s*s+n*n<=o)||(n=i-(this.y+this.height-r),s*s+n*n<=o)||(s=e-(this.x+r),s*s+n*n<=o))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}};var hr=class t{constructor(e=1,i=0,r=0,s=1,n=0,o=0){this.array=null,this.a=e,this.b=i,this.c=r,this.d=s,this.tx=n,this.ty=o}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,i,r,s,n,o){return this.a=e,this.b=i,this.c=r,this.d=s,this.tx=n,this.ty=o,this}toArray(e,i){this.array||(this.array=new Float32Array(9));let r=i||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(e,i){i=i||new Jt;let r=e.x,s=e.y;return i.x=this.a*r+this.c*s+this.tx,i.y=this.b*r+this.d*s+this.ty,i}applyInverse(e,i){i=i||new Jt;let r=1/(this.a*this.d+this.c*-this.b),s=e.x,n=e.y;return i.x=this.d*r*s+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,i.y=this.a*r*n+-this.b*r*s+(-this.ty*this.a+this.tx*this.b)*r,i}translate(e,i){return this.tx+=e,this.ty+=i,this}scale(e,i){return this.a*=e,this.d*=i,this.c*=e,this.b*=i,this.tx*=e,this.ty*=i,this}rotate(e){let i=Math.cos(e),r=Math.sin(e),s=this.a,n=this.c,o=this.tx;return this.a=s*i-this.b*r,this.b=s*r+this.b*i,this.c=n*i-this.d*r,this.d=n*r+this.d*i,this.tx=o*i-this.ty*r,this.ty=o*r+this.ty*i,this}append(e){let i=this.a,r=this.b,s=this.c,n=this.d;return this.a=e.a*i+e.b*s,this.b=e.a*r+e.b*n,this.c=e.c*i+e.d*s,this.d=e.c*r+e.d*n,this.tx=e.tx*i+e.ty*s+this.tx,this.ty=e.tx*r+e.ty*n+this.ty,this}setTransform(e,i,r,s,n,o,a,l,u){return this.a=Math.cos(a+u)*n,this.b=Math.sin(a+u)*n,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=e-(r*this.a+s*this.c),this.ty=i-(r*this.b+s*this.d),this}prepend(e){let i=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){let r=this.a,s=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=s*e.a+this.d*e.c,this.d=s*e.b+this.d*e.d}return this.tx=i*e.a+this.ty*e.c+e.tx,this.ty=i*e.b+this.ty*e.d+e.ty,this}decompose(e){let i=this.a,r=this.b,s=this.c,n=this.d,o=e.pivot,a=-Math.atan2(-s,n),l=Math.atan2(r,i),u=Math.abs(a+l);return u<1e-5||Math.abs($1-u)<1e-5?(e.rotation=l,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=a,e.skew.y=l),e.scale.x=Math.sqrt(i*i+r*r),e.scale.y=Math.sqrt(s*s+n*n),e.position.x=this.tx+(o.x*i+o.y*s),e.position.y=this.ty+(o.x*r+o.y*n),e}invert(){let e=this.a,i=this.b,r=this.c,s=this.d,n=this.tx,o=e*s-i*r;return this.a=s/o,this.b=-i/o,this.c=-r/o,this.d=e/o,this.tx=(r*this.ty-s*n)/o,this.ty=-(e*this.ty-i*n)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){let e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new t}static get TEMP_MATRIX(){return new t}};var pd=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],md=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],gd=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],yd=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Dw=[],cR=[],H8=Math.sign;function dj(){for(let t=0;t<16;t++){let e=[];Dw.push(e);for(let i=0;i<16;i++){let r=H8(pd[t]*pd[i]+gd[t]*md[i]),s=H8(md[t]*pd[i]+yd[t]*md[i]),n=H8(pd[t]*gd[i]+gd[t]*yd[i]),o=H8(md[t]*gd[i]+yd[t]*yd[i]);for(let a=0;a<16;a++)if(pd[a]===r&&md[a]===s&&gd[a]===n&&yd[a]===o){e.push(a);break}}}for(let t=0;t<16;t++){let e=new hr;e.set(pd[t],md[t],gd[t],yd[t],0,0),cR.push(e)}}dj();var bs={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>pd[t],uY:t=>md[t],vX:t=>gd[t],vY:t=>yd[t],inv:t=>t&8?t&15:-t&7,add:(t,e)=>Dw[t][e],sub:(t,e)=>Dw[t][bs.inv(e)],rotate180:t=>t^4,isVertical:t=>(t&3)===2,byDirection:(t,e)=>Math.abs(t)*2<=Math.abs(e)?e>=0?bs.S:bs.N:Math.abs(e)*2<=Math.abs(t)?t>0?bs.E:bs.W:e>0?t>0?bs.SE:bs.SW:t>0?bs.NE:bs.NW,matrixAppendRotationInv:(t,e,i=0,r=0)=>{let s=cR[bs.inv(e)];s.tx=i,s.ty=r,t.append(s)}};var Yo=class t{constructor(e,i,r=0,s=0){this._x=r,this._y=s,this.cb=e,this.scope=i}clone(e=this.cb,i=this.scope){return new t(e,i,this._x,this._y)}set(e=0,i=e){return(this._x!==e||this._y!==i)&&(this._x=e,this._y=i,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}};var uR=class{constructor(){this.worldTransform=new hr,this.localTransform=new hr,this.position=new Yo(this.onChange,this,0,0),this.scale=new Yo(this.onChange,this,1,1),this.pivot=new Yo(this.onChange,this,0,0),this.skew=new Yo(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){let t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){let e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){let i=t.worldTransform,r=this.worldTransform;r.a=e.a*i.a+e.b*i.c,r.b=e.a*i.b+e.b*i.d,r.c=e.c*i.a+e.d*i.c,r.d=e.c*i.b+e.d*i.d,r.tx=e.tx*i.a+e.ty*i.c+i.tx,r.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}},_d=uR;_d.IDENTITY=new uR;var hR=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`;var dR=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function V8(t,e,i){let r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}function Fw(t){let e=new Array(t);for(let i=0;i<e.length;i++)e[i]=!1;return e}function d5(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return Fw(2*e);case"bvec3":return Fw(3*e);case"bvec4":return Fw(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var Rc=[{test:t=>t.type==="float"&&t.size===1&&!t.isArray,code:t=>`
            if(uv["${t}"] !== ud["${t}"].value)
            {
                ud["${t}"].value = uv["${t}"]
                gl.uniform1f(ud["${t}"].location, uv["${t}"])
            }
            `},{test:(t,e)=>(t.type==="sampler2D"||t.type==="samplerCube"||t.type==="sampler2DArray")&&t.size===1&&!t.isArray&&(e==null||e.castToBaseTexture!==void 0),code:t=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${t}"], t);

            if(ud["${t}"].value !== t)
            {
                ud["${t}"].value = t;
                gl.uniform1i(ud["${t}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(t,e)=>t.type==="mat3"&&t.size===1&&!t.isArray&&e.a!==void 0,code:t=>`
            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));
            `,codeUbo:t=>`
                var ${t}_matrix = uv.${t}.toArray(true);

                data[offset] = ${t}_matrix[0];
                data[offset+1] = ${t}_matrix[1];
                data[offset+2] = ${t}_matrix[2];
        
                data[offset + 4] = ${t}_matrix[3];
                data[offset + 5] = ${t}_matrix[4];
                data[offset + 6] = ${t}_matrix[5];
        
                data[offset + 8] = ${t}_matrix[6];
                data[offset + 9] = ${t}_matrix[7];
                data[offset + 10] = ${t}_matrix[8];
            `},{test:(t,e)=>t.type==="vec2"&&t.size===1&&!t.isArray&&e.x!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${t}"].location, v.x, v.y);
                }`,codeUbo:t=>`
                v = uv.${t};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:t=>t.type==="vec2"&&t.size===1&&!t.isArray,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);
                }
            `},{test:(t,e)=>t.type==="vec4"&&t.size===1&&!t.isArray&&e.width!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:t=>`
                    v = uv.${t};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(t,e)=>t.type==="vec4"&&t.size===1&&!t.isArray&&e.red!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:t=>`
                    v = uv.${t};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(t,e)=>t.type==="vec3"&&t.size===1&&!t.isArray&&e.red!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)
                }`,codeUbo:t=>`
                    v = uv.${t};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:t=>t.type==="vec4"&&t.size===1&&!t.isArray,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])
                }`}];var fj={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},pj={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function Lw(t,e){let i=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(let r in t.uniforms){let s=e[r];if(!s){t.uniforms[r]?.group&&(t.uniforms[r].ubo?i.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');
                    `):i.push(`
                        renderer.shader.syncUniformGroup(uv.${r}, syncData);
                    `));continue}let n=t.uniforms[r],o=!1;for(let a=0;a<Rc.length;a++)if(Rc[a].test(s,n)){i.push(Rc[a].code(r,n)),o=!0;break}if(!o){let l=(s.size===1&&!s.isArray?fj:pj)[s.type].replace("location",`ud["${r}"].location`);i.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${l};`)}}return new Function("ud","uv","renderer","syncData",i.join(`
`))}var fR={},j8=fR;function X8(){if(j8===fR||j8?.isContextLost()){let t=ut.ADAPTER.createCanvas(),e;ut.PREFER_ENV>=$o.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),j8=e}return j8}var W8;function Nw(){if(!W8){W8=Ho.MEDIUM;let t=X8();t&&t.getShaderPrecisionFormat&&(W8=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision?Ho.HIGH:Ho.MEDIUM)}return W8}function pR(t,e){let i=t.getShaderSource(e).split(`
`).map((u,d)=>`${d}: ${u}`),r=t.getShaderInfoLog(e),s=r.split(`
`),n={},o=s.map(u=>parseFloat(u.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(u=>u&&!n[u]?(n[u]=!0,!0):!1),a=[""];o.forEach(u=>{i[u-1]=`%c${i[u-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});let l=i.join(`
`);a[0]=l,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function Ow(t,e,i,r){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(i,t.COMPILE_STATUS)||pR(t,i),t.getShaderParameter(r,t.COMPILE_STATUS)||pR(t,r),console.error("PixiJS Error: Could not initialize shader."),t.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}var mj={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function f5(t){return mj[t]}var q8=null,mR={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function p5(t,e){if(!q8){let i=Object.keys(mR);q8={};for(let r=0;r<i.length;++r){let s=i[r];q8[t[s]]=mR[s]}}return q8[e]}function Y8(t,e,i){if(t.substring(0,9)!=="precision"){let r=e;return e===Ho.HIGH&&i!==Ho.HIGH&&(r=Ho.MEDIUM),`precision ${r} float;
${t}`}else if(i!==Ho.HIGH&&t.substring(0,15)==="precision highp")return t.replace("precision highp","precision mediump");return t}var m5;function Z8(){if(typeof m5=="boolean")return m5;try{m5=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{m5=!1}return m5}var gj=0,Q8={},t2=class{constructor(t,e,i="pixi-shader",r={}){this.extra={},this.id=gj++,this.vertexSrc=t||t2.defaultVertexSrc,this.fragmentSrc=e||t2.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=r,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),Q8[i]?(Q8[i]++,i+=`-${Q8[i]}`):Q8[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=Y8(this.vertexSrc,t2.defaultVertexPrecision,Ho.HIGH),this.fragmentSrc=Y8(this.fragmentSrc,t2.defaultFragmentPrecision,Nw())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return dR}static get defaultFragmentSrc(){return hR}static from(t,e,i){let r=t+e,s=l5[r];return s||(l5[r]=s=new t2(t,e,i)),s}},Vn=t2;Vn.defaultVertexPrecision=Ho.HIGH;Vn.defaultFragmentPrecision=xl.apple.device?Ho.HIGH:Ho.MEDIUM;var yj=0,Zo=class t{constructor(e,i,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=yj++,this.static=!!i,this.ubo=!!r,e instanceof Kr?(this.buffer=e,this.buffer.type=ga.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new Kr(new Float32Array(1)),this.buffer.type=ga.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,i,r){if(!this.ubo)this.uniforms[e]=new t(i,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(e,i,r){return new t(e,i,r)}static uboFrom(e,i){return new t(e,i??!0,!0)}};var eo=class t{constructor(e,i){this.uniformBindCount=0,this.program=e,i?i instanceof Zo?this.uniformGroup=i:this.uniformGroup=new Zo(i):this.uniformGroup=new Zo({}),this.disposeRunner=new hn("disposeShader")}checkUniformExists(e,i){if(i.uniforms[e])return!0;for(let r in i.uniforms){let s=i.uniforms[r];if(s.group&&this.checkUniformExists(e,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,i,r){let s=Vn.from(e,i);return new t(s,r)}};var g5=class{constructor(e,i){if(this.vertexSrc=e,this.fragTemplate=i,this.programCache={},this.defaultGroupCache={},!i.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!i.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){let r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=n;this.defaultGroupCache[e]=Zo.from({uSamplers:r},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${e}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new Vn(this.vertexSrc,s)}let i={tint:new Float32Array([1,1,1,1]),translationMatrix:new hr,default:this.defaultGroupCache[e]};return new eo(this.programCache[e],i)}generateSampleSrc(e){let i="";i+=`
`,i+=`
`;for(let r=0;r<e;r++)r>0&&(i+=`
else `),r<e-1&&(i+=`if(vTextureId < ${r}.5)`),i+=`
{`,i+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,i+=`
}`;return i+=`
`,i+=`
`,i}};var V1=class{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}};function gR(){return!xl.apple.device}function yR(t){let e=!0,i=ut.ADAPTER.getNavigator();if(xl.tablet||xl.phone){if(xl.apple.device){let r=i.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(e=!1)}if(xl.android.device){let r=i.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(e=!1)}}return e?t:4}var ec=class{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}};var _R=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`;var xR=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;var tc=class extends ec{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=fd,this.vertexSize=6,this.state=Kn.for2d(),this.size=tc.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??yR(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??gR(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return er("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return xR}static get defaultFragmentTemplate(){return _R}setShaderGenerator({vertex:t=tc.defaultVertexSrc,fragment:e=tc.defaultFragmentTemplate}={}){this.shaderGenerator=new g5(t,e)}contextChange(){let t=this.renderer.gl;ut.PREFER_ENV===$o.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),tc.defaultMaxTextures),this.maxTextures=G8(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){let{_drawCallPool:t,_textureArrayPool:e}=tc,i=this.size/4,r=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new G1);for(;e.length<r;)e.push(new V1);for(let s=0;s<this.maxTextures;s++)this._tempBoundTextures[s]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){let{_bufferedTextures:t,maxTextures:e}=this,i=tc._textureArrayPool,r=this.renderer.batch,s=this._tempBoundTextures,n=this.renderer.textureGC.count,o=++li._globalBatch,a=0,l=i[0],u=0;r.copyBoundTextures(s,e);for(let d=0;d<this._bufferSize;++d){let m=t[d];t[d]=null,m._batchEnabled!==o&&(l.count>=e&&(r.boundArray(l,s,o,e),this.buildDrawCalls(l,u,d),u=d,l=i[++a],++o),m._batchEnabled=o,m.touched=n,l.elements[l.count++]=m)}l.count>0&&(r.boundArray(l,s,o,e),this.buildDrawCalls(l,u,this._bufferSize),++a,++o);for(let d=0;d<s.length;d++)s[d]=null;li._globalBatch=o}buildDrawCalls(t,e,i){let{_bufferedElements:r,_attributeBuffer:s,_indexBuffer:n,vertexSize:o}=this,a=tc._drawCallPool,l=this._dcIndex,u=this._aIndex,d=this._iIndex,m=a[l];m.start=this._iIndex,m.texArray=t;for(let g=e;g<i;++g){let _=r[g],v=_._texture.baseTexture,E=n5[v.alphaMode?1:0][_.blendMode];r[g]=null,e<g&&m.blend!==E&&(m.size=d-m.start,e=g,m=a[++l],m.texArray=t,m.start=d),this.packInterleavedGeometry(_,s,n,u,d),u+=_.vertexData.length/2*o,d+=_.indices.length,m.blend=E}e<i&&(m.size=d-m.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=d}bindAndClearTexArray(t){let e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){let{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:i}=this;tc.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){let t=this._dcIndex,{gl:e,state:i}=this.renderer,r=tc._drawCallPool,s=null;for(let n=0;n<t;n++){let{texArray:o,type:a,size:l,start:u,blend:d}=r[n];s!==o&&(s=o,this.bindAndClearTexArray(o)),this.state.blendMode=d,i.set(this.state),e.drawElements(a,l,e.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),tc.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){let e=U1(Math.ceil(t/8)),i=a5(e),r=e*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._aBuffers[r];return s||(this._aBuffers[r]=s=new z1(r*this.vertexSize*4)),s}getIndexBuffer(t){let e=U1(Math.ceil(t/12)),i=a5(e),r=e*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._iBuffers[i];return s||(this._iBuffers[i]=s=new Uint16Array(r)),s}packInterleavedGeometry(t,e,i,r,s){let{uint32View:n,float32View:o}=e,a=r/this.vertexSize,l=t.uvs,u=t.indices,d=t.vertexData,m=t._texture.baseTexture._batchLocation,g=Math.min(t.worldAlpha,1),_=fi.shared.setValue(t._tintRGB).toPremultiplied(g,t._texture.baseTexture.alphaMode>0);for(let v=0;v<d.length;v+=2)o[r++]=d[v],o[r++]=d[v+1],o[r++]=l[v],o[r++]=l[v+1],n[r++]=_,o[r++]=m;for(let v=0;v<u.length;v++)i[s++]=a+u[v]}},Ga=tc;Ga.defaultBatchSize=4096;Ga.extension={name:"batch",type:yt.RendererPlugin};Ga._drawCallPool=[];Ga._textureArrayPool=[];St.add(Ga);var vR=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`;var bR=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var y5=class extends eo{constructor(t,e,i){let r=Vn.from(t||y5.defaultVertexSrc,e||y5.defaultFragmentSrc);super(r,i),this.padding=0,this.resolution=y5.defaultResolution,this.multisample=y5.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Kn}apply(t,e,i,r,s){t.applyFilter(this,e,i,r)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return bR}static get defaultFragmentSrc(){return vR}},Wt=y5;Wt.defaultResolution=1;Wt.defaultMultisample=Xr.NONE;var ku=class{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new fi(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;let{backgroundColor:i,background:r,backgroundAlpha:s}=e,n=r??i;n!==void 0&&(this.color=n),this.alpha=s}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}};ku.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};ku.extension={type:[yt.RendererSystem,yt.CanvasRendererSystem],name:"background"};St.add(ku);var i2=class{constructor(e){this.renderer=e,this.emptyRenderer=new ec(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,i){let{boundTextures:r}=this.renderer.texture;for(let s=i-1;s>=0;--s)e[s]=r[s]||null,e[s]&&(e[s]._batchLocation=s)}boundArray(e,i,r,s){let{elements:n,ids:o,count:a}=e,l=0;for(let u=0;u<a;u++){let d=n[u],m=d._batchLocation;if(m>=0&&m<s&&i[m]===d){o[u]=m;continue}for(;l<s;){let g=i[l];if(g&&g._batchEnabled===r&&g._batchLocation===l){l++;continue}o[u]=l,d._batchLocation=l,i[l]=d;break}}}destroy(){this.renderer=null}};i2.extension={type:yt.RendererSystem,name:"batch"};St.add(i2);var wR=0,Mu=class{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=wR++}init(e){if(e.context)this.initFromContext(e.context);else{let i=this.renderer.background.alpha<1,r=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:i,premultipliedAlpha:r,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=wR++,this.renderer.runners.contextChange.emit(e);let i=this.renderer.view;i.addEventListener!==void 0&&(i.addEventListener("webglcontextlost",this.handleContextLost,!1),i.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){let i=this.createContext(this.renderer.view,e);this.initFromContext(i)}createContext(e,i){let r;if(ut.PREFER_ENV>=$o.WEBGL2&&(r=e.getContext("webgl2",i)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=e.getContext("webgl",i)||e.getContext("experimental-webgl",i),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){let{gl:e}=this,i={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,i,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,i,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){let e=this.renderer.view;this.renderer=null,e.removeEventListener!==void 0&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){let i=e.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),i&&!i.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");let s=r||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}};Mu.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"};Mu.extension={type:yt.RendererSystem,name:"context"};St.add(Mu);var K8=class extends ya{upload(e,i,r){let s=e.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===Ks.UNPACK);let n=i.realWidth,o=i.realHeight;return r.width===n&&r.height===o?s.texSubImage2D(i.target,0,0,0,n,o,i.format,r.type,this.data):(r.width=n,r.height=o,s.texImage2D(i.target,0,r.internalFormat,n,o,0,i.format,r.type,this.data)),!0}};var j1=class{constructor(e,i){this.width=Math.round(e||100),this.height=Math.round(i||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new hn("disposeFramebuffer"),this.multisample=Xr.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,i){return this.colorTextures[e]=i||new li(null,{scaleMode:Qn.NEAREST,resolution:1,mipmap:xn.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new li(new K8(null,{width:this.width,height:this.height}),{scaleMode:Qn.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:xn.OFF,format:Bt.DEPTH_COMPONENT,type:mi.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,i){if(e=Math.round(e),i=Math.round(i),!(e===this.width&&i===this.height)){this.width=e,this.height=i,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){let s=this.colorTextures[r],n=s.resolution;s.setSize(e/n,i/n)}if(this.depthTexture){let r=this.depthTexture.resolution;this.depthTexture.setSize(e/r,i/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}};var X1=class extends li{constructor(e={}){if(typeof e=="number"){let i=arguments[0],r=arguments[1],s=arguments[2],n=arguments[3];e={width:i,height:r,scaleMode:s,resolution:n}}e.width=e.width||100,e.height=e.height||100,e.multisample??(e.multisample=Xr.NONE),super(null,e),this.mipmap=xn.OFF,this.valid=!0,this._clear=new fi([0,0,0,0]),this.framebuffer=new j1(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(e,i){this.framebuffer.resize(e*this.resolution,i*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}};var to=class extends Wo{constructor(e){let i=e,r=i.naturalWidth||i.videoWidth||i.width,s=i.naturalHeight||i.videoHeight||i.height;super(r,s),this.source=e,this.noSubImage=!1}static crossOrigin(e,i,r){r===void 0&&!i.startsWith("data:")?e.crossOrigin=z8(i):r!==!1&&(e.crossOrigin=typeof r=="string"?r:"anonymous")}upload(e,i,r,s){let n=e.gl,o=i.realWidth,a=i.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1&&s.buffered.length===0)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===Ks.UNPACK),!this.noSubImage&&i.target===n.TEXTURE_2D&&r.width===o&&r.height===a?n.texSubImage2D(n.TEXTURE_2D,0,0,0,i.format,r.type,s):(r.width=o,r.height=a,n.texImage2D(i.target,0,r.internalFormat,i.format,r.type,s)),!0}update(){if(this.destroyed)return;let e=this.source,i=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;this.resize(i,r),super.update()}dispose(){this.source=null}};var W1=class extends to{constructor(e,i){if(i=i||{},typeof e=="string"){let r=new Image;to.crossOrigin(r,e,i.crossorigin),r.src=e,e=r}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(i.createBitmap??ut.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,this.bitmap=null,this._load=null,i.autoLoad!==!1&&this.load()}load(e){return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise((i,r)=>{let s=this.source;this.url=s.src;let n=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.resize(s.width,s.height),this._load=null,this.createBitmap?i(this.process()):i(this))};s.complete&&s.src?n():(s.onload=n,s.onerror=o=>{r(o),this.onError.emit(o)})}),this._load)}process(){let e=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);let i=globalThis.createImageBitmap,r=!e.crossOrigin||e.crossOrigin==="anonymous";return this._process=fetch(e.src,{mode:r?"cors":"no-cors"}).then(s=>s.blob()).then(s=>i(s,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ks.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,i,r){if(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,i,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,i,r,this.bitmap),!this.preserveBitmap){let s=!0,n=i._glTextures;for(let o in n){let a=n[o];if(a!==r&&a.dirtyId!==i.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&(typeof e=="string"||e instanceof HTMLImageElement)}};var r2=class{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,i,r){let s=i.width,n=i.height;if(r){let o=e.width/2/s,a=e.height/2/n,l=e.x/s+o,u=e.y/n+a;r=bs.add(r,bs.NW),this.x0=l+o*bs.uX(r),this.y0=u+a*bs.uY(r),r=bs.add(r,2),this.x1=l+o*bs.uX(r),this.y1=u+a*bs.uY(r),r=bs.add(r,2),this.x2=l+o*bs.uX(r),this.y2=u+a*bs.uY(r),r=bs.add(r,2),this.x3=l+o*bs.uX(r),this.y3=u+a*bs.uY(r)}else this.x0=e.x/s,this.y0=e.y/n,this.x1=(e.x+e.width)/s,this.y1=e.y/n,this.x2=(e.x+e.width)/s,this.y2=(e.y+e.height)/n,this.x3=e.x/s,this.y3=(e.y+e.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}};var ER=new r2;function J8(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}var qt=class t extends en.default{constructor(e,i,r,s,n,o,a){if(super(),this.noFrame=!1,i||(this.noFrame=!0,i=new ei(0,0,1,1)),e instanceof t&&(e=e.baseTexture),this.baseTexture=e,this._frame=i,this.trim=s,this.valid=!1,this._uvs=ER,this.uvMatrix=null,this.orig=r||i,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new Jt(o.x,o.y):new Jt(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=i:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){let{resource:i}=this.baseTexture;i?.url&&Hn[i.url]&&t.removeFromCache(i.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,t.removeFromCache(this),this.textureCacheIds=null}clone(){let e=this._frame.clone(),i=this._frame===this.orig?e:this.orig.clone(),r=new t(this.baseTexture,!this.noFrame&&e,i,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=e),r}updateUvs(){this._uvs===ER&&(this._uvs=new r2),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,i={},r=ut.STRICT_TEXTURE_CACHE){let s=typeof e=="string",n=null;if(s)n=e;else if(e instanceof li){if(!e.cacheId){let a=i?.pixiIdPrefix||"pixiid";e.cacheId=`${a}-${Pc()}`,li.addToCache(e,e.cacheId)}n=e.cacheId}else{if(!e._pixiId){let a=i?.pixiIdPrefix||"pixiid";e._pixiId=`${a}_${Pc()}`}n=e._pixiId}let o=Hn[n];if(s&&r&&!o)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!o&&!(e instanceof li)?(i.resolution||(i.resolution=c5(e)),o=new t(new li(e,i)),o.baseTexture.cacheId=n,li.addToCache(o.baseTexture,n),t.addToCache(o,n)):!o&&e instanceof li&&(o=new t(e),t.addToCache(o,n)),o}static fromURL(e,i){let r=Object.assign({autoLoad:!1},i?.resourceOptions),s=t.from(e,Object.assign({resourceOptions:r},i),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then(()=>Promise.resolve(s))}static fromBuffer(e,i,r,s){return new t(li.fromBuffer(e,i,r,s))}static fromLoader(e,i,r,s){let n=new li(e,Object.assign({scaleMode:li.defaultOptions.scaleMode,resolution:c5(i)},s)),{resource:o}=n;o instanceof W1&&(o.url=i);let a=new t(n);return r||(r=i),li.addToCache(a.baseTexture,r),t.addToCache(a,r),r!==i&&(li.addToCache(a.baseTexture,i),t.addToCache(a,i)),a.baseTexture.valid?Promise.resolve(a):new Promise(l=>{a.baseTexture.once("loaded",()=>l(a))})}static addToCache(e,i){i&&(e.textureCacheIds.includes(i)||e.textureCacheIds.push(i),Hn[i]&&Hn[i]!==e&&console.warn(`Texture added to the cache with an id [${i}] that already had an entry`),Hn[i]=e)}static removeFromCache(e){if(typeof e=="string"){let i=Hn[e];if(i){let r=i.textureCacheIds.indexOf(e);return r>-1&&i.textureCacheIds.splice(r,1),delete Hn[e],i}}else if(e?.textureCacheIds){for(let i=0;i<e.textureCacheIds.length;++i)Hn[e.textureCacheIds[i]]===e&&delete Hn[e.textureCacheIds[i]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;let{x:i,y:r,width:s,height:n}=e,o=i+s>this.baseTexture.width,a=r+n>this.baseTexture.height;if(o||a){let l=o&&a?"and":"or",u=`X: ${i} + ${s} = ${i+s} > ${this.baseTexture.width}`,d=`Y: ${r} + ${n} = ${r+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${u} ${l} ${d}`)}this.valid=s&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return t._EMPTY||(t._EMPTY=new t(new li),J8(t._EMPTY),J8(t._EMPTY.baseTexture)),t._EMPTY}static get WHITE(){if(!t._WHITE){let e=ut.ADAPTER.createCanvas(16,16),i=e.getContext("2d");e.width=16,e.height=16,i.fillStyle="white",i.fillRect(0,0,16,16),t._WHITE=new t(li.from(e)),J8(t._WHITE),J8(t._WHITE.baseTexture)}return t._WHITE}};var $a=class t extends qt{constructor(e,i){super(e,i),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,i,r=!0){let s=this.baseTexture.resolution,n=Math.round(e*s)/s,o=Math.round(i*s)/s;this.valid=n>0&&o>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=o,r&&this.baseTexture.resize(n,o),this.updateUvs()}setResolution(e){let{baseTexture:i}=this;i.resolution!==e&&(i.setResolution(e),this.resize(i.width,i.height,!1))}static create(e){return new t(new X1(e))}};var s2=class{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,i,r=Xr.NONE){let s=new X1(Object.assign({width:e,height:i,resolution:1,multisample:r},this.textureOptions));return new $a(s)}getOptimalTexture(e,i,r=1,s=Xr.NONE){let n;e=Math.ceil(e*r-1e-6),i=Math.ceil(i*r-1e-6),!this.enableFullScreen||e!==this._pixelsWidth||i!==this._pixelsHeight?(e=U1(e),i=U1(i),n=((e&65535)<<16|i&65535)>>>0,s>1&&(n+=s*4294967296)):n=s>1?-s:-1,this.texturePool[n]||(this.texturePool[n]=[]);let o=this.texturePool[n].pop();return o||(o=this.createTexture(e,i,s)),o.filterPoolKey=n,o.setResolution(r),o}getFilterTexture(e,i,r){let s=this.getOptimalTexture(e.width,e.height,i||e.resolution,r||Xr.NONE);return s.filterFrame=e.filterFrame,s}returnTexture(e){let i=e.filterPoolKey;e.filterFrame=null,this.texturePool[i].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=e!==!1,e)for(let i in this.texturePool){let r=this.texturePool[i];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0)}this.texturePool={}}setScreenSize(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(let i in this.texturePool){if(!(Number(i)<0))continue;let r=this.texturePool[i];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0);this.texturePool[i]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}};s2.SCREEN_KEY=-1;var _5=class extends qo{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}};var xd=class extends qo{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Kr(this.vertices),this.uvBuffer=new Kr(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,i){let r=0,s=0;return this.uvs[0]=r,this.uvs[1]=s,this.uvs[2]=r+i.width/e.width,this.uvs[3]=s,this.uvs[4]=r+i.width/e.width,this.uvs[5]=s+i.height/e.height,this.uvs[6]=r,this.uvs[7]=s+i.height/e.height,r=i.x,s=i.y,this.vertices[0]=r,this.vertices[1]=s,this.vertices[2]=r+i.width,this.vertices[3]=s,this.vertices[4]=r+i.width,this.vertices[5]=s+i.height,this.vertices[6]=r,this.vertices[7]=s+i.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}};var x5=class{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Xr.NONE,this.sourceFrame=new ei,this.destinationFrame=new ei,this.bindingSourceFrame=new ei,this.bindingDestinationFrame=new ei,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}};var eg=[new Jt,new Jt,new Jt,new Jt],Bw=new hr,n2=class{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new s2,this.statePool=[],this.quad=new _5,this.quadUv=new xd,this.tempRect=new ei,this.activeState={},this.globalUniforms=new Zo({outputFrame:new ei,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,i){let r=this.renderer,s=this.defaultFilterStack,n=this.statePool.pop()||new x5,o=this.renderer.renderTexture,a=i[0].resolution,l=i[0].multisample,u=i[0].padding,d=i[0].autoFit,m=i[0].legacy??!0;for(let v=1;v<i.length;v++){let E=i[v];a=Math.min(a,E.resolution),l=Math.min(l,E.multisample),u=this.useMaxPadding?Math.max(u,E.padding):u+E.padding,d=d&&E.autoFit,m=m||(E.legacy??!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),s.push(n),n.resolution=a,n.multisample=l,n.legacy=m,n.target=e,n.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),n.sourceFrame.pad(u);let g=this.tempRect.copyFrom(o.sourceFrame);r.projection.transform&&this.transformAABB(Bw.copyFrom(r.projection.transform).invert(),g),d?(n.sourceFrame.fit(g),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(g)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,o.current?o.current.resolution:r.resolution,o.sourceFrame,o.destinationFrame,r.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,a,l),n.filters=i,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;let _=this.tempRect;_.x=0,_.y=0,_.width=n.sourceFrame.width,_.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(o.sourceFrame),n.bindingDestinationFrame.copyFrom(o.destinationFrame),n.transform=r.projection.transform,r.projection.transform=null,o.bind(n.renderTexture,n.sourceFrame,_),r.framebuffer.clear(0,0,0,0)}pop(){let e=this.defaultFilterStack,i=e.pop(),r=i.filters;this.activeState=i;let s=this.globalUniforms.uniforms;s.outputFrame=i.sourceFrame,s.resolution=i.resolution;let n=s.inputSize,o=s.inputPixel,a=s.inputClamp;if(n[0]=i.destinationFrame.width,n[1]=i.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=Math.round(n[0]*i.resolution),o[1]=Math.round(n[1]*i.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=i.sourceFrame.width*n[2]-.5*o[2],a[3]=i.sourceFrame.height*n[3]-.5*o[3],i.legacy){let u=s.filterArea;u[0]=i.destinationFrame.width,u[1]=i.destinationFrame.height,u[2]=i.sourceFrame.x,u[3]=i.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();let l=e[e.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,i.renderTexture,l.renderTexture,Ua.BLEND,i),this.returnFilterTexture(i.renderTexture);else{let u=i.renderTexture,d=this.getOptimalFilterTexture(u.width,u.height,i.resolution);d.filterFrame=u.filterFrame;let m=0;for(m=0;m<r.length-1;++m){m===1&&i.multisample>1&&(d=this.getOptimalFilterTexture(u.width,u.height,i.resolution),d.filterFrame=u.filterFrame),r[m].apply(this,u,d,Ua.CLEAR,i);let g=u;u=d,d=g}r[m].apply(this,u,l.renderTexture,Ua.BLEND,i),m>1&&i.multisample>1&&this.returnFilterTexture(i.renderTexture),this.returnFilterTexture(u),this.returnFilterTexture(d)}i.clear(),this.statePool.push(i)}bindAndClear(e,i=Ua.CLEAR){let{renderTexture:r,state:s}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e?.filterFrame){let o=this.tempRect;o.x=0,o.y=0,o.width=e.filterFrame.width,o.height=e.filterFrame.height,r.bind(e,e.filterFrame,o)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);let n=s.stateId&1||this.forceClear;(i===Ua.CLEAR||i===Ua.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,i,r,s){let n=this.renderer;n.state.set(e.state),this.bindAndClear(r,s),e.uniforms.uSampler=i,e.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(i._frame,i.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(pa.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(pa.TRIANGLE_STRIP))}calculateSpriteMatrix(e,i){let{sourceFrame:r,destinationFrame:s}=this.activeState,{orig:n}=i._texture,o=e.set(s.width,0,0,s.height,r.x,r.y),a=i.worldTransform.copyTo(hr.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/n.width,1/n.height),o.translate(i.anchor.x,i.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,i,r=1,s=Xr.NONE){return this.texturePool.getOptimalTexture(e,i,r,s)}getFilterTexture(e,i,r){if(typeof e=="number"){let n=e;e=i,i=n}e=e||this.activeState.renderTexture;let s=this.texturePool.getOptimalTexture(e.width,e.height,i||e.resolution,r||Xr.NONE);return s.filterFrame=e.filterFrame,s}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,i){let r=eg[0],s=eg[1],n=eg[2],o=eg[3];r.set(i.left,i.top),s.set(i.left,i.bottom),n.set(i.right,i.top),o.set(i.right,i.bottom),e.apply(r,r),e.apply(s,s),e.apply(n,n),e.apply(o,o);let a=Math.min(r.x,s.x,n.x,o.x),l=Math.min(r.y,s.y,n.y,o.y),u=Math.max(r.x,s.x,n.x,o.x),d=Math.max(r.y,s.y,n.y,o.y);i.x=a,i.y=l,i.width=u-a,i.height=d-l}roundFrame(e,i,r,s,n){if(!(e.width<=0||e.height<=0||r.width<=0||r.height<=0)){if(n){let{a:o,b:a,c:l,d:u}=n;if((Math.abs(a)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(u)>1e-4))return}n=n?Bw.copyFrom(n):Bw.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.transformAABB(n,e),e.ceil(i),this.transformAABB(n.invert(),e)}}};n2.extension={type:yt.RendererSystem,name:"filter"};St.add(n2);var v5=class{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Xr.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}};var _j=new ei,o2=class{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new j1(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);let e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new ei,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let i=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;ut.PREFER_ENV===$o.WEBGL_LEGACY&&(i=null,r=null),i?e.drawBuffers=s=>i.drawBuffersWEBGL(s):(this.hasMRT=!1,e.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,i,r=0){let{gl:s}=this;if(e){let n=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(e.dirtyId++,e.dirtyFormat++,n.mipLevel=r),n.dirtyId!==e.dirtyId&&(n.dirtyId=e.dirtyId,n.dirtyFormat!==e.dirtyFormat?(n.dirtyFormat=e.dirtyFormat,n.dirtySize=e.dirtySize,this.updateFramebuffer(e,r)):n.dirtySize!==e.dirtySize&&(n.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let o=0;o<e.colorTextures.length;o++){let a=e.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),i){let o=i.width>>r,a=i.height>>r,l=o/i.width;this.setViewport(i.x*l,i.y*l,o,a)}else{let o=e.width>>r,a=e.height>>r;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),i?this.setViewport(i.x,i.y,i.width,i.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,i,r,s){let n=this.viewport;e=Math.round(e),i=Math.round(i),r=Math.round(r),s=Math.round(s),(n.width!==r||n.height!==s||n.x!==e||n.y!==i)&&(n.x=e,n.y=i,n.width=r,n.height=s,this.gl.viewport(e,i,r,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,i,r,s,n=E8.COLOR|E8.DEPTH){let{gl:o}=this;o.clearColor(e,i,r,s),o.clear(n)}initFramebuffer(e){let{gl:i}=this,r=new v5(i.createFramebuffer());return r.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(e),e.disposeRunner.add(this),r}resizeFramebuffer(e){let{gl:i}=this,r=e.glFramebuffers[this.CONTEXT_UID];r.stencil&&(i.bindRenderbuffer(i.RENDERBUFFER,r.stencil),r.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.DEPTH24_STENCIL8,e.width,e.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e.width,e.height));let s=e.colorTextures,n=s.length;i.drawBuffers||(n=Math.min(n,1));for(let o=0;o<n;o++){let a=s[o],l=a.parentTextureArray||a;this.renderer.texture.bind(l,0),o===0&&r.msaaBuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,r.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,i){let{gl:r}=this,s=e.glFramebuffers[this.CONTEXT_UID],n=e.colorTextures,o=n.length;r.drawBuffers||(o=Math.min(o,1)),s.multisample>1&&this.canMultisampleFramebuffer(e)?s.msaaBuffer=s.msaaBuffer||r.createRenderbuffer():s.msaaBuffer&&(r.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));let a=[];for(let l=0;l<o;l++){let u=n[l],d=u.parentTextureArray||u;this.renderer.texture.bind(d,0),l===0&&s.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,s.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,d._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,s.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+l,u.target,d._glTextures[this.CONTEXT_UID].texture,i),a.push(r.COLOR_ATTACHMENT0+l))}if(a.length>1&&r.drawBuffers(a),e.depthTexture&&this.writeDepthTexture){let u=e.depthTexture;this.renderer.texture.bind(u,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,u._glTextures[this.CONTEXT_UID].texture,i)}(e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)?(s.stencil=s.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,s.stencil),s.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,r.DEPTH24_STENCIL8,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,s.stencil)):s.stencil&&(r.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){let{msaaSamples:i}=this,r=Xr.NONE;if(e<=1||i===null)return r;for(let s=0;s<i.length;s++)if(i[s]<=e){r=i[s];break}return r===1&&(r=Xr.NONE),r}blit(e,i,r){let{current:s,renderer:n,gl:o,CONTEXT_UID:a}=this;if(n.context.webGLVersion!==2||!s)return;let l=s.glFramebuffers[a];if(!l)return;if(!e){if(!l.msaaBuffer)return;let d=s.colorTextures[0];if(!d)return;l.blitFramebuffer||(l.blitFramebuffer=new j1(s.width,s.height),l.blitFramebuffer.addColorTexture(0,d)),e=l.blitFramebuffer,e.colorTextures[0]!==d&&(e.colorTextures[0]=d,e.dirtyId++,e.dirtyFormat++),(e.width!==s.width||e.height!==s.height)&&(e.width=s.width,e.height=s.height,e.dirtyId++,e.dirtySize++)}i||(i=_j,i.width=s.width,i.height=s.height),r||(r=i);let u=i.width===r.width&&i.height===r.height;this.bind(e),o.bindFramebuffer(o.READ_FRAMEBUFFER,l.framebuffer),o.blitFramebuffer(i.left,i.top,i.right,i.bottom,r.left,r.top,r.right,r.bottom,o.COLOR_BUFFER_BIT,u?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,i){let r=e.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!r)return;delete e.glFramebuffers[this.CONTEXT_UID];let n=this.managedFramebuffers.indexOf(e);n>=0&&this.managedFramebuffers.splice(n,1),e.disposeRunner.remove(this),i||(s.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&s.deleteRenderbuffer(r.msaaBuffer),r.stencil&&s.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,i)}disposeAll(e){let i=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<i.length;r++)this.disposeFramebuffer(i[r],e)}forceStencil(){let e=this.current;if(!e)return;let i=e.glFramebuffers[this.CONTEXT_UID];if(!i||i.stencil)return;e.stencil=!0;let r=e.width,s=e.height,n=this.gl,o=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o),i.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,i.multisample,n.DEPTH24_STENCIL8,r,s):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,r,s),i.stencil=o,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new ei}destroy(){this.renderer=null}};o2.extension={type:yt.RendererSystem,name:"framebuffer"};St.add(o2);var Uw={5126:4,5123:2,5121:1},a2=class{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);let e=this.gl=this.renderer.gl,i=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,i.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;ut.PREFER_ENV===$o.WEBGL_LEGACY&&(r=null),r?(e.createVertexArray=()=>r.createVertexArrayOES(),e.bindVertexArray=s=>r.bindVertexArrayOES(s),e.deleteVertexArray=s=>r.deleteVertexArrayOES(s)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(i.webGLVersion!==2){let r=e.getExtension("ANGLE_instanced_arrays");r?(e.vertexAttribDivisor=(s,n)=>r.vertexAttribDivisorANGLE(s,n),e.drawElementsInstanced=(s,n,o,a,l)=>r.drawElementsInstancedANGLE(s,n,o,a,l),e.drawArraysInstanced=(s,n,o,a)=>r.drawArraysInstancedANGLE(s,n,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=i.webGLVersion===2||!!i.extensions.uint32ElementIndex}bind(e,i){i=i||this.renderer.shader.shader;let{gl:r}=this,s=e.glVertexArrayObjects[this.CONTEXT_UID],n=!1;s||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=s={},n=!0);let o=s[i.program.id]||this.initGeometryVao(e,i,n);this._activeGeometry=e,this._activeVao!==o&&(this._activeVao=o,this.hasVao?r.bindVertexArray(o):this.activateVao(e,i.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){let e=this._activeGeometry,i=this.renderer.buffer;for(let r=0;r<e.buffers.length;r++){let s=e.buffers[r];i.update(s)}}checkCompatibility(e,i){let r=e.attributes,s=i.attributeData;for(let n in s)if(!r[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(e,i){let r=e.attributes,s=i.attributeData,n=["g",e.id];for(let o in r)s[o]&&n.push(o,s[o].location);return n.join("-")}initGeometryVao(e,i,r=!0){let s=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,a=i.program;a.glPrograms[n]||this.renderer.shader.generateProgram(i),this.checkCompatibility(e,a);let l=this.getSignature(e,a),u=e.glVertexArrayObjects[this.CONTEXT_UID],d=u[l];if(d)return u[a.id]=d,d;let m=e.buffers,g=e.attributes,_={},v={};for(let E in m)_[E]=0,v[E]=0;for(let E in g)!g[E].size&&a.attributeData[E]?g[E].size=a.attributeData[E].size:g[E].size||console.warn(`PIXI Geometry attribute '${E}' size cannot be determined (likely the bound shader does not have the attribute)`),_[g[E].buffer]+=g[E].size*Uw[g[E].type];for(let E in g){let b=g[E],T=b.size;b.stride===void 0&&(_[b.buffer]===T*Uw[b.type]?b.stride=0:b.stride=_[b.buffer]),b.start===void 0&&(b.start=v[b.buffer],v[b.buffer]+=T*Uw[b.type])}d=s.createVertexArray(),s.bindVertexArray(d);for(let E=0;E<m.length;E++){let b=m[E];o.bind(b),r&&b._glBuffers[n].refCount++}return this.activateVao(e,a),u[a.id]=d,u[l]=d,s.bindVertexArray(null),o.unbind(ga.ARRAY_BUFFER),d}disposeGeometry(e,i){if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];let r=e.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,n=e.buffers,o=this.renderer?.buffer;if(e.disposeRunner.remove(this),!!r){if(o)for(let a=0;a<n.length;a++){let l=n[a]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!i&&o.dispose(n[a],i))}if(!i){for(let a in r)if(a[0]==="g"){let l=r[a];this._activeVao===l&&this.unbind(),s.deleteVertexArray(l)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){let i=Object.keys(this.managedGeometries);for(let r=0;r<i.length;r++)this.disposeGeometry(this.managedGeometries[i[r]],e)}activateVao(e,i){let r=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,o=e.buffers,a=e.attributes;e.indexBuffer&&n.bind(e.indexBuffer);let l=null;for(let u in a){let d=a[u],m=o[d.buffer],g=m._glBuffers[s];if(i.attributeData[u]){l!==g&&(n.bind(m),l=g);let _=i.attributeData[u].location;if(r.enableVertexAttribArray(_),r.vertexAttribPointer(_,d.size,d.type||r.FLOAT,d.normalized,d.stride,d.start),d.instance)if(this.hasInstance)r.vertexAttribDivisor(_,d.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,i,r,s){let{gl:n}=this,o=this._activeGeometry;if(o.indexBuffer){let a=o.indexBuffer.data.BYTES_PER_ELEMENT,l=a===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(e,i||o.indexBuffer.data.length,l,(r||0)*a,s||1):n.drawElements(e,i||o.indexBuffer.data.length,l,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(e,r,i||o.getSize(),s||1):n.drawArrays(e,r,i||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}};a2.extension={type:yt.RendererSystem,name:"geometry"};St.add(a2);var TR=new hr,q1=class{constructor(e,i){this._texture=e,this.mapCoord=new hr,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof i>"u"?.5:i,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,i){i===void 0&&(i=e);let r=this.mapCoord;for(let s=0;s<e.length;s+=2){let n=e[s],o=e[s+1];i[s]=n*r.a+o*r.c+r.tx,i[s+1]=n*r.b+o*r.d+r.ty}return i}update(e){let i=this._texture;if(!i||!i.valid||!e&&this._textureID===i._updateID)return!1;this._textureID=i._updateID,this._updateID++;let r=i._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);let s=i.orig,n=i.trim;n&&(TR.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(TR));let o=i.baseTexture,a=this.uClampFrame,l=this.clampMargin/o.resolution,u=this.clampOffset;return a[0]=(i._frame.x+l+u)/o.width,a[1]=(i._frame.y+l+u)/o.height,a[2]=(i._frame.x+i._frame.width-l+u)/o.width,a[3]=(i._frame.y+i._frame.height-l+u)/o.height,this.uClampOffset[0]=u/o.realWidth,this.uClampOffset[1]=u/o.realHeight,this.isSimple=i._frame.width===o.width&&i._frame.height===o.height&&i.rotate===0,!0}};var SR=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`;var AR=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;var b5=class extends Wt{constructor(e,i,r){let s=null;typeof e!="string"&&i===void 0&&r===void 0&&(s=e,e=void 0,i=void 0,r=void 0),super(e||AR,i||SR,r),this.maskSprite=s,this.maskMatrix=new hr}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,i,r,s){let n=this._maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new q1(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,e.applyFilter(this,i,r,s))}};var w5=class{constructor(e=null){this.type=Js.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Wt.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Js.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}};var l2=class{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,i){let r=i;if(!r.isMaskData){let n=this.maskDataPool.pop()||new w5;n.pooled=!0,n.maskObject=i,r=n}let s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(s),r._colorMask=s?s._colorMask:15,r.autoDetect&&this.detect(r),r._target=e,r.type!==Js.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case Js.SCISSOR:this.renderer.scissor.push(r);break;case Js.STENCIL:this.renderer.stencil.push(r);break;case Js.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case Js.COLOR:this.pushColorMask(r);break;default:break}r.type===Js.SPRITE&&this.maskStack.push(r)}pop(e){let i=this.maskStack.pop();if(!(!i||i._target!==e)){if(i.enabled)switch(i.type){case Js.SCISSOR:this.renderer.scissor.pop(i);break;case Js.STENCIL:this.renderer.stencil.pop(i.maskObject);break;case Js.SPRITE:this.popSpriteMask(i);break;case Js.COLOR:this.popColorMask(i);break;default:break}if(i.reset(),i.pooled&&this.maskDataPool.push(i),this.maskStack.length!==0){let r=this.maskStack[this.maskStack.length-1];r.type===Js.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(e){let i=e.maskObject;i?i.isSprite?e.type=Js.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=Js.SCISSOR:e.type=Js.STENCIL:e.type=Js.COLOR}pushSpriteMask(e){let{maskObject:i}=e,r=e._target,s=e._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new b5]));let n=this.renderer,o=n.renderTexture,a,l;if(o.current){let d=o.current;a=e.resolution||d.resolution,l=e.multisample??d.multisample}else a=e.resolution||n.resolution,l=e.multisample??n.multisample;s[0].resolution=a,s[0].multisample=l,s[0].maskSprite=i;let u=r.filterArea;r.filterArea=i.getBounds(!0),n.filter.push(r,s),r.filterArea=u,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){let i=e._colorMask,r=e._colorMask=i&e.colorMask;r!==i&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(e){let i=e._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==i&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}};l2.extension={type:yt.RendererSystem,name:"mask"};St.add(l2);var c2=class{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){let{gl:i}=this.renderer,r=this.getStackLength();this.maskStack=e;let s=this.getStackLength();s!==r&&(s===0?i.disable(this.glConst):(i.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}};var CR=new hr,IR=[],tg=class extends c2{constructor(t){super(t),this.glConst=ut.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){let t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;let e=t._scissorRect,{maskObject:i}=t,{renderer:r}=this,s=r.renderTexture,n=i.getBounds(!0,IR.pop()??new ei);this.roundFrameToPixels(n,s.current?s.current.resolution:r.resolution,s.sourceFrame,s.destinationFrame,r.projection.transform),e&&n.fit(e),t._scissorRectLocal=n}static isMatrixRotated(t){if(!t)return!1;let{a:e,b:i,c:r,d:s}=t;return(Math.abs(i)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(s)>1e-4)}testScissor(t){let{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||tg.isMatrixRotated(e.worldTransform)||tg.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);let i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,e,i,r,s){tg.isMatrixRotated(s)||(s=s?CR.copyFrom(s):CR.identity(),s.translate(-i.x,-i.y).scale(r.width/i.width,r.height/i.height).translate(r.x,r.y),this.renderer.filter.transformAABB(s,t),t.fit(r),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);let{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){let{gl:e}=this.renderer;t&&IR.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){let t=this.maskStack[this.maskStack.length-1]._scissorRect,e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}},ig=tg;ig.extension={type:yt.RendererSystem,name:"scissor"};St.add(ig);var u2=class extends c2{constructor(e){super(e),this.glConst=ut.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){let e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){let i=e.maskObject,{gl:r}=this.renderer,s=e._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),e._stencilCounter++;let n=e._colorMask;n!==0&&(e._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,s,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),i.renderable=!0,i.render(this.renderer),this.renderer.batch.flush(),i.renderable=!1,n!==0&&(e._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(e){let i=this.renderer.gl;if(this.getStackLength()===0)i.disable(i.STENCIL_TEST);else{let r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=r?r._colorMask:15;s!==0&&(r._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilOp(i.KEEP,i.KEEP,i.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(r._colorMask=s,i.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){let e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}};u2.extension={type:yt.RendererSystem,name:"stencil"};St.add(u2);var h2=class{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return er("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract}},prepare:{enumerable:!1,get(){return er("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare}},interaction:{enumerable:!1,get(){return er("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events}}})}init(){let e=this.rendererPlugins;for(let i in e)this.plugins[i]=new e[i](this.renderer)}destroy(){for(let e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}};h2.extension={type:[yt.RendererSystem,yt.CanvasRendererSystem],name:"_plugin"};St.add(h2);var d2=class{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new hr,this.transform=null}update(e,i,r,s){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=i||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,s),this.transform&&this.projectionMatrix.append(this.transform);let n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(e,i,r,s){let n=this.projectionMatrix,o=s?-1:1;n.identity(),n.a=1/i.width*2,n.d=o*(1/i.height*2),n.tx=-1-i.x*n.a,n.ty=-o-i.y*n.d}setTransform(e){}destroy(){this.renderer=null}};d2.extension={type:yt.RendererSystem,name:"projection"};St.add(d2);var xj=new _d,f2=class{constructor(e){this.renderer=e,this._tempMatrix=new hr}generateTexture(e,i){let{region:r,...s}=i||{},n=r||e.getLocalBounds(null,!0);n.width===0&&(n.width=1),n.height===0&&(n.height=1);let o=$a.create({width:n.width,height:n.height,...s});this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;let a=e.transform;return e.transform=xj,this.renderer.render(e,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=a,o}destroy(){}};f2.extension={type:[yt.RendererSystem,yt.CanvasRendererSystem],name:"textureGenerator"};St.add(f2);var vd=new ei,E5=new ei,p2=class{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new ei,this.destinationFrame=new ei,this.viewportFrame=new ei}contextChange(){let e=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(e=null,i,r){let s=this.renderer;this.current=e;let n,o,a;e?(n=e.baseTexture,a=n.resolution,i||(vd.width=e.frame.width,vd.height=e.frame.height,i=vd),r||(E5.x=e.frame.x,E5.y=e.frame.y,E5.width=i.width,E5.height=i.height,r=E5),o=n.framebuffer):(a=s.resolution,i||(vd.width=s._view.screen.width,vd.height=s._view.screen.height,i=vd),r||(r=vd,r.width=i.width,r.height=i.height));let l=this.viewportFrame;l.x=r.x*a,l.y=r.y*a,l.width=r.width*a,l.height=r.height*a,e||(l.y=s.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(o,l),this.renderer.projection.update(r,i,a,!o),e?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(i),this.destinationFrame.copyFrom(r)}clear(e,i){let r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=fi.shared.setValue(e||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);let n=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=n.width!==o.width||n.height!==o.height;if(a){let{x:l,y:u,width:d,height:m}=this.viewportFrame;l=Math.round(l),u=Math.round(u),d=Math.round(d),m=Math.round(m),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,u,d,m)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,i),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}};p2.extension={type:yt.RendererSystem,name:"renderTexture"};St.add(p2);var T5=class{constructor(e,i){this.program=e,this.uniformData=i,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}};function kR(t,e){let i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){let n=e.getActiveAttrib(t,s);if(n.name.startsWith("gl_"))continue;let o=p5(e,n.type),a={type:o,name:n.name,size:f5(o),location:e.getAttribLocation(t,n.name)};i[n.name]=a}return i}function MR(t,e){let i={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<r;s++){let n=e.getActiveUniform(t,s),o=n.name.replace(/\[.*?\]$/,""),a=!!n.name.match(/\[.*?\]$/),l=p5(e,n.type);i[o]={name:o,index:s,type:l,size:n.size,isArray:a,value:d5(l,n.size)}}return i}function zw(t,e){let i=V8(t,t.VERTEX_SHADER,e.vertexSrc),r=V8(t,t.FRAGMENT_SHADER,e.fragmentSrc),s=t.createProgram();t.attachShader(s,i),t.attachShader(s,r);let n=e.extra?.transformFeedbackVaryings;if(n&&(typeof t.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):t.transformFeedbackVaryings(s,n.names,n.bufferMode==="separate"?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||Ow(t,s,i,r),e.attributeData=kR(s,t),e.uniformData=MR(s,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){let l=Object.keys(e.attributeData);l.sort((u,d)=>u>d?1:-1);for(let u=0;u<l.length;u++)e.attributeData[l[u]].location=u,t.bindAttribLocation(s,u,l[u]);t.linkProgram(s)}t.deleteShader(i),t.deleteShader(r);let o={};for(let l in e.uniformData){let u=e.uniformData[l];o[l]={location:t.getUniformLocation(s,l),value:d5(u.type,u.size)}}return new T5(s,o)}function vj(t,e,i,r,s){i.buffer.update(s)}var bj={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},PR={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function RR(t){let e=t.map(n=>({data:n,offset:0,dataLen:0,dirty:0})),i=0,r=0,s=0;for(let n=0;n<e.length;n++){let o=e[n];if(i=PR[o.data.type],o.data.size>1&&(i=Math.max(i,16)*o.data.size),o.dataLen=i,r%i!==0&&r<16){let a=r%i%16;r+=a,s+=a}r+i>16?(s=Math.ceil(s/16)*16,o.offset=s,s+=i,r=i):(o.offset=s,r+=i,s+=i)}return s=Math.ceil(s/16)*16,{uboElements:e,size:s}}function DR(t,e){let i=[];for(let r in t)e[r]&&i.push(e[r]);return i.sort((r,s)=>r.index-s.index),i}function Gw(t,e){if(!t.autoManage)return{size:0,syncFunc:vj};let i=DR(t.uniforms,e),{uboElements:r,size:s}=RR(i),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<r.length;o++){let a=r[o],l=t.uniforms[a.data.name],u=a.data.name,d=!1;for(let m=0;m<Rc.length;m++){let g=Rc[m];if(g.codeUbo&&g.test(a.data,l)){n.push(`offset = ${a.offset/4};`,Rc[m].codeUbo(a.data.name,l)),d=!0;break}}if(!d)if(a.data.size>1){let m=f5(a.data.type),g=Math.max(PR[a.data.type]/16,1),_=m/g,v=(4-_%4)%4;n.push(`
                cv = ud.${u}.value;
                v = uv.${u};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*g}; i++)
                {
                    for(var j = 0; j < ${_}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${v};
                }

                `)}else{let m=bj[a.data.type];n.push(`
                cv = ud.${u}.value;
                v = uv.${u};
                offset = ${a.offset/4};
                ${m};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}var wj=0,rg={textureCount:0,uboCount:0},m2=class{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=wj++}systemCheck(){if(!Z8())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,i){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;let r=e.program,s=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==r&&(this.program=r,this.gl.useProgram(s.program)),i||(rg.textureCount=0,rg.uboCount=0,this.syncUniformGroup(e.uniformGroup,rg)),s}setUniforms(e){let i=this.shader.program,r=i.glPrograms[this.renderer.CONTEXT_UID];i.syncUniforms(r.uniformData,e,this.renderer)}syncUniformGroup(e,i){let r=this.getGlProgram();(!e.static||e.dirtyId!==r.uniformDirtyGroups[e.id])&&(r.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,r,i))}syncUniforms(e,i,r){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(i.uniformData,e.uniforms,this.renderer,r)}createSyncGroups(e){let i=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[i]||(this.cache[i]=Lw(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[i],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,i){let r=this.getGlProgram();if(!e.static||e.dirtyId!==0||!r.uniformGroups[e.id]){e.dirtyId=0;let s=r.uniformGroups[e.id]||this.createSyncBufferGroup(e,r,i);e.buffer.update(),s(r.uniformData,e.uniforms,this.renderer,rg,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,r.uniformBufferBindings[i])}createSyncBufferGroup(e,i,r){let{gl:s}=this.renderer;this.renderer.buffer.bind(e.buffer);let n=this.gl.getUniformBlockIndex(i.program,r);i.uniformBufferBindings[r]=this.shader.uniformBindCount,s.uniformBlockBinding(i.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;let o=this.getSignature(e,this.shader.program.uniformData,"ubo"),a=this._uboCache[o];if(a||(a=this._uboCache[o]=Gw(e,this.shader.program.uniformData)),e.autoManage){let l=new Float32Array(a.size/4);e.buffer.update(l)}return i.uniformGroups[e.id]=a.syncFunc,i.uniformGroups[e.id]}getSignature(e,i,r){let s=e.uniforms,n=[`${r}-`];for(let o in s)n.push(o),i[o]&&n.push(i[o].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){let i=this.gl,r=e.program,s=zw(i,r);return r.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}};m2.extension={type:yt.RendererSystem,name:"shader"};St.add(m2);var Pu=class{constructor(e){this.renderer=e}run(e){let{renderer:i}=this;i.runners.init.emit(i.options),e.hello&&console.log(`PixiJS 7.2.4 - ${i.rendererLogId} - https://pixijs.com`),i.resize(i.screen.width,i.screen.height)}destroy(){}};Pu.defaultOptions={hello:!1};Pu.extension={type:[yt.RendererSystem,yt.CanvasRendererSystem],name:"startup"};St.add(Pu);function FR(t,e=[]){return e[Ii.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.ADD]=[t.ONE,t.ONE],e[Ii.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.NONE]=[0,0],e[Ii.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[Ii.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Ii.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[Ii.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[Ii.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[Ii.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[Ii.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[Ii.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[Ii.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[Ii.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[Ii.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}var Ej=0,Tj=1,Sj=2,Aj=3,Cj=4,Ij=5,$w=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=Ii.NONE,this._blendEq=!1,this.map=[],this.map[Ej]=this.setBlend,this.map[Tj]=this.setOffset,this.map[Sj]=this.setCullFace,this.map[Aj]=this.setDepthTest,this.map[Cj]=this.setFrontFace,this.map[Ij]=this.setDepthMask,this.checks=[],this.defaultState=new Kn,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=FR(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)e&1&&this.map[i].call(this,!!(t.data&1<<i)),e=e>>1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck($w.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck($w.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;let e=this.blendModes[t],i=this.gl;e.length===2?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){let i=this.checks.indexOf(t);e&&i===-1?this.checks.push(t):!e&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}},sg=$w;sg.extension={type:yt.RendererSystem,name:"state"};St.add(sg);var g2=class extends en.default{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);let i=(e.priority??[]).filter(s=>e.systems[s]),r=[...i,...Object.keys(e.systems).filter(s=>!i.includes(s))];for(let s of r)this.addSystem(e.systems[s],s)}addRunners(...e){e.forEach(i=>{this.runners[i]=new hn(i)})}addSystem(e,i){let r=new e(this);if(this[i])throw new Error(`Whoops! The name "${i}" is already in use`);this[i]=r,this._systemsHash[i]=r;for(let s in this.runners)this.runners[s].add(r);return this}emitWithCustomOptions(e,i){let r=Object.keys(this._systemsHash);e.items.forEach(s=>{let n=r.find(o=>this._systemsHash[o]===s);s[e.name](i[n])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}};var ng=class{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=ng.defaultMaxIdle,this.checkCountMax=ng.defaultCheckCountMax,this.mode=ng.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==S8.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){let t=this.renderer.texture,e=t.managedTextures,i=!1;for(let r=0;r<e.length;r++){let s=e[r];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[r]=null,i=!0)}if(i){let r=0;for(let s=0;s<e.length;s++)e[s]!==null&&(e[r++]=e[s]);e.length=r}}unload(t){let e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let r=t.children.length-1;r>=0;r--)this.unload(t.children[r])}destroy(){this.renderer=null}},_a=ng;_a.defaultMode=S8.AUTO;_a.defaultMaxIdle=60*60;_a.defaultCheckCountMax=60*10;_a.extension={type:yt.RendererSystem,name:"textureGC"};St.add(_a);var bd=class{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=mi.UNSIGNED_BYTE,this.internalFormat=Bt.RGBA,this.samplerType=0}};function LR(t){let e;return"WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?e={[mi.UNSIGNED_BYTE]:{[Bt.RGBA]:t.RGBA8,[Bt.RGB]:t.RGB8,[Bt.RG]:t.RG8,[Bt.RED]:t.R8,[Bt.RGBA_INTEGER]:t.RGBA8UI,[Bt.RGB_INTEGER]:t.RGB8UI,[Bt.RG_INTEGER]:t.RG8UI,[Bt.RED_INTEGER]:t.R8UI,[Bt.ALPHA]:t.ALPHA,[Bt.LUMINANCE]:t.LUMINANCE,[Bt.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[mi.BYTE]:{[Bt.RGBA]:t.RGBA8_SNORM,[Bt.RGB]:t.RGB8_SNORM,[Bt.RG]:t.RG8_SNORM,[Bt.RED]:t.R8_SNORM,[Bt.RGBA_INTEGER]:t.RGBA8I,[Bt.RGB_INTEGER]:t.RGB8I,[Bt.RG_INTEGER]:t.RG8I,[Bt.RED_INTEGER]:t.R8I},[mi.UNSIGNED_SHORT]:{[Bt.RGBA_INTEGER]:t.RGBA16UI,[Bt.RGB_INTEGER]:t.RGB16UI,[Bt.RG_INTEGER]:t.RG16UI,[Bt.RED_INTEGER]:t.R16UI,[Bt.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[mi.SHORT]:{[Bt.RGBA_INTEGER]:t.RGBA16I,[Bt.RGB_INTEGER]:t.RGB16I,[Bt.RG_INTEGER]:t.RG16I,[Bt.RED_INTEGER]:t.R16I},[mi.UNSIGNED_INT]:{[Bt.RGBA_INTEGER]:t.RGBA32UI,[Bt.RGB_INTEGER]:t.RGB32UI,[Bt.RG_INTEGER]:t.RG32UI,[Bt.RED_INTEGER]:t.R32UI,[Bt.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[mi.INT]:{[Bt.RGBA_INTEGER]:t.RGBA32I,[Bt.RGB_INTEGER]:t.RGB32I,[Bt.RG_INTEGER]:t.RG32I,[Bt.RED_INTEGER]:t.R32I},[mi.FLOAT]:{[Bt.RGBA]:t.RGBA32F,[Bt.RGB]:t.RGB32F,[Bt.RG]:t.RG32F,[Bt.RED]:t.R32F,[Bt.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[mi.HALF_FLOAT]:{[Bt.RGBA]:t.RGBA16F,[Bt.RGB]:t.RGB16F,[Bt.RG]:t.RG16F,[Bt.RED]:t.R16F},[mi.UNSIGNED_SHORT_5_6_5]:{[Bt.RGB]:t.RGB565},[mi.UNSIGNED_SHORT_4_4_4_4]:{[Bt.RGBA]:t.RGBA4},[mi.UNSIGNED_SHORT_5_5_5_1]:{[Bt.RGBA]:t.RGB5_A1},[mi.UNSIGNED_INT_2_10_10_10_REV]:{[Bt.RGBA]:t.RGB10_A2,[Bt.RGBA_INTEGER]:t.RGB10_A2UI},[mi.UNSIGNED_INT_10F_11F_11F_REV]:{[Bt.RGB]:t.R11F_G11F_B10F},[mi.UNSIGNED_INT_5_9_9_9_REV]:{[Bt.RGB]:t.RGB9_E5},[mi.UNSIGNED_INT_24_8]:{[Bt.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[mi.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[Bt.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:e={[mi.UNSIGNED_BYTE]:{[Bt.RGBA]:t.RGBA,[Bt.RGB]:t.RGB,[Bt.ALPHA]:t.ALPHA,[Bt.LUMINANCE]:t.LUMINANCE,[Bt.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[mi.UNSIGNED_SHORT_5_6_5]:{[Bt.RGB]:t.RGB},[mi.UNSIGNED_SHORT_4_4_4_4]:{[Bt.RGBA]:t.RGBA},[mi.UNSIGNED_SHORT_5_5_5_1]:{[Bt.RGBA]:t.RGBA}},e}var y2=class{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new li,this.hasIntegerTextures=!1}contextChange(){let e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=LR(e);let i=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=i;for(let s=0;s<i;s++)this.boundTextures[s]=null;this.emptyTextures={};let r=new bd(e.createTexture());e.bindTexture(e.TEXTURE_2D,r.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=r,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new bd(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(e,i=0){let{gl:r}=this;if(e=e?.castToBaseTexture(),e?.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;let s=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[i]!==e&&(this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),r.bindTexture(e.target,s.texture)),s.dirtyId!==e.dirtyId?(this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),this.updateTexture(e)):s.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[i]=e}else this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[i]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){let{gl:i,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<r.length;s++)r[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<r.length;s++)r[s]===e&&(this.currentLocation!==s&&(i.activeTexture(i.TEXTURE0+s),this.currentLocation=s),i.bindTexture(e.target,this.emptyTextures[e.target].texture),r[s]=null)}ensureSamplerType(e){let{boundTextures:i,hasIntegerTextures:r,CONTEXT_UID:s}=this;if(r)for(let n=e-1;n>=0;--n){let o=i[n];o&&o._glTextures[s].samplerType!==T8.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(e){let i=new bd(this.gl.createTexture());return i.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=i,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),i}initTextureType(e,i){i.internalFormat=this.internalFormats[e.type]?.[e.format]??e.format,this.webGLVersion===2&&e.type===mi.HALF_FLOAT?i.type=this.gl.HALF_FLOAT:i.type=e.type}updateTexture(e){let i=e._glTextures[this.CONTEXT_UID];if(!i)return;let r=this.renderer;if(this.initTextureType(e,i),e.resource?.upload(r,e,i))i.samplerType!==T8.FLOAT&&(this.hasIntegerTextures=!0);else{let s=e.realWidth,n=e.realHeight,o=r.gl;(i.width!==s||i.height!==n||i.dirtyId<0)&&(i.width=s,i.height=n,o.texImage2D(e.target,0,i.internalFormat,s,n,0,e.format,i.type,null))}e.dirtyStyleId!==i.dirtyStyleId&&this.updateTextureStyle(e),i.dirtyId=e.dirtyId}destroyTexture(e,i){let{gl:r}=this;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),r.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!i)){let s=this.managedTextures.indexOf(e);s!==-1&&N8(this.managedTextures,s,1)}}updateTextureStyle(e){let i=e._glTextures[this.CONTEXT_UID];i&&((e.mipmap===xn.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?i.mipmap=!1:i.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?i.wrapMode=ma.CLAMP:i.wrapMode=e.wrapMode,e.resource?.style(this.renderer,e,i)||this.setStyle(e,i),i.dirtyStyleId=e.dirtyStyleId)}setStyle(e,i){let r=this.gl;if(i.mipmap&&e.mipmap!==xn.ON_MANUAL&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,i.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,i.wrapMode),i.mipmap){r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===Qn.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);let s=this.renderer.context.extensions.anisotropicFiltering;if(s&&e.anisotropicLevel>0&&e.scaleMode===Qn.LINEAR){let n=Math.min(e.anisotropicLevel,r.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(e.target,s.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===Qn.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode===Qn.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}};y2.extension={type:yt.RendererSystem,name:"texture"};St.add(y2);var _2=class{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){let{gl:i,CONTEXT_UID:r}=this,s=e._glTransformFeedbacks[r]||this.createGLTransformFeedback(e);i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,s)}unbind(){let{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,i){let{gl:r,renderer:s}=this;i&&s.shader.bind(i),r.beginTransformFeedback(e)}endTransformFeedback(){let{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){let{gl:i,renderer:r,CONTEXT_UID:s}=this,n=i.createTransformFeedback();e._glTransformFeedbacks[s]=n,i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,n);for(let o=0;o<e.buffers.length;o++){let a=e.buffers[o];a&&(r.buffer.update(a),a._glBuffers[s].refCount++,i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[s].buffer||null))}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),n}disposeTransformFeedback(e,i){let r=e._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this);let n=this.renderer.buffer;if(n)for(let o=0;o<e.buffers.length;o++){let a=e.buffers[o];if(!a)continue;let l=a._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!i&&n.dispose(a,i))}r&&(i||s.deleteTransformFeedback(r),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}};_2.extension={type:yt.RendererSystem,name:"transformFeedback"};St.add(_2);var Ru=class{constructor(e){this.renderer=e}init(e){this.screen=new ei(0,0,e.width,e.height),this.element=e.view||ut.ADAPTER.createCanvas(),this.resolution=e.resolution||ut.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,i){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(i*this.resolution);let r=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=r,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",r,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){e&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}};Ru.defaultOptions={width:800,height:600,resolution:ut.RESOLUTION,autoDensity:!1};Ru.extension={type:[yt.RendererSystem,yt.CanvasRendererSystem],name:"_view"};St.add(Ru);ut.PREFER_ENV=$o.WEBGL2;ut.STRICT_TEXTURE_CACHE=!1;ut.RENDER_OPTIONS={...Mu.defaultOptions,...ku.defaultOptions,...Ru.defaultOptions,...Pu.defaultOptions};Object.defineProperties(ut,{WRAP_MODE:{get(){return li.defaultOptions.wrapMode},set(t){er("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),li.defaultOptions.wrapMode=t}},SCALE_MODE:{get(){return li.defaultOptions.scaleMode},set(t){er("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),li.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get(){return li.defaultOptions.mipmap},set(t){er("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),li.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get(){return li.defaultOptions.anisotropicLevel},set(t){er("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),li.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get(){return er("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Wt.defaultResolution},set(t){Wt.defaultResolution=t}},FILTER_MULTISAMPLE:{get(){return er("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Wt.defaultMultisample},set(t){Wt.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get(){return Ga.defaultMaxTextures},set(t){er("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Ga.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get(){return Ga.defaultBatchSize},set(t){er("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Ga.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get(){return Ga.canUploadSameBuffer},set(t){er("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Ga.canUploadSameBuffer=t}},GC_MODE:{get(){return _a.defaultMode},set(t){er("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),_a.defaultMode=t}},GC_MAX_IDLE:{get(){return _a.defaultMaxIdle},set(t){er("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),_a.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get(){return _a.defaultCheckCountMax},set(t){er("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),_a.defaultCheckCountMax=t}},PRECISION_VERTEX:{get(){return Vn.defaultVertexPrecision},set(t){er("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Vn.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get(){return Vn.defaultFragmentPrecision},set(t){er("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Vn.defaultFragmentPrecision=t}}});var Ha=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(Ha||{});var x2=class{constructor(e,i=null,r=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=i,this.priority=r,this.once=s}match(e,i=null){return this.fn===e&&this.context===i}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));let i=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),i}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);let i=this.next;return this.next=e?null:i,this.previous=null,i}};var Va=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new x2(null,null,1/0),this.deltaMS=1/Va.targetFPMS,this.elapsedMS=1/Va.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=Ha.NORMAL){return this._addListener(new x2(t,e,i))}addOnce(t,e,i=Ha.NORMAL){return this._addListener(new x2(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){let s=t-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=t-s%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Va.targetFPMS;let i=this._head,r=i.next;for(;r;)r=r.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){let e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,Va.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{let e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Va._shared){let t=Va._shared=new Va;t.autoStart=!0,t._protected=!0}return Va._shared}static get system(){if(!Va._system){let t=Va._system=new Va;t.autoStart=!0,t._protected=!0}return Va._system}},Us=Va;Us.targetFPMS=.06;Object.defineProperties(ut,{TARGET_FPMS:{get(){return Us.targetFPMS},set(t){er("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Us.targetFPMS=t}}});var S5=class{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(i){this._ticker&&this._ticker.remove(this.render,this),this._ticker=i,i&&i.add(this.render,this,Ha.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Us.shared:new Us,e.autoStart&&this.start()}static destroy(){if(this._ticker){let e=this._ticker;this.ticker=null,e.destroy()}}};S5.extension=yt.Application;St.add(S5);var NR=[];St.handleByList(yt.Renderer,NR);function Hw(t){for(let e of NR)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}var OR=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`;var BR=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var Vw=OR,A5=BR;var C5=class{constructor(e){this.renderer=e}contextChange(e){let i;if(this.renderer.context.webGLVersion===1){let r=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),i=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,r)}else{let r=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),i=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,r)}i>=Xr.HIGH?this.multisample=Xr.HIGH:i>=Xr.MEDIUM?this.multisample=Xr.MEDIUM:i>=Xr.LOW?this.multisample=Xr.LOW:this.multisample=Xr.NONE}destroy(){}};C5.extension={type:yt.RendererSystem,name:"_multisample"};St.add(C5);var og=class{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}};var I5=class{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){let{gl:i,CONTEXT_UID:r}=this,s=e._glBuffers[r]||this.createGLBuffer(e);i.bindBuffer(e.type,s.buffer)}unbind(e){let{gl:i}=this;i.bindBuffer(e,null)}bindBufferBase(e,i){let{gl:r,CONTEXT_UID:s}=this;if(this.boundBufferBases[i]!==e){let n=e._glBuffers[s]||this.createGLBuffer(e);this.boundBufferBases[i]=e,r.bindBufferBase(r.UNIFORM_BUFFER,i,n.buffer)}}bindBufferRange(e,i,r){let{gl:s,CONTEXT_UID:n}=this;r=r||0;let o=e._glBuffers[n]||this.createGLBuffer(e);s.bindBufferRange(s.UNIFORM_BUFFER,i||0,o.buffer,r*256,256)}update(e){let{gl:i,CONTEXT_UID:r}=this,s=e._glBuffers[r]||this.createGLBuffer(e);if(e._updateID!==s.updateID)if(s.updateID=e._updateID,i.bindBuffer(e.type,s.buffer),s.byteLength>=e.data.byteLength)i.bufferSubData(e.type,0,e.data);else{let n=e.static?i.STATIC_DRAW:i.DYNAMIC_DRAW;s.byteLength=e.data.byteLength,i.bufferData(e.type,e.data,n)}}dispose(e,i){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];let r=e._glBuffers[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this),r&&(i||s.deleteBuffer(r.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){let i=Object.keys(this.managedBuffers);for(let r=0;r<i.length;r++)this.dispose(this.managedBuffers[i[r]],e)}createGLBuffer(e){let{CONTEXT_UID:i,gl:r}=this;return e._glBuffers[i]=new og(r.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[i]}};I5.extension={type:yt.RendererSystem,name:"buffer"};St.add(I5);var k5=class{constructor(e){this.renderer=e}render(e,i){let r=this.renderer,s,n,o,a;if(i&&(s=i.renderTexture,n=i.clear,o=i.transform,a=i.skipUpdateTransform),this.renderingToScreen=!s,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=o,!r.context.isLost){if(s||(this.lastObjectRendered=e),!a){let l=e.enableTempParent();e.updateTransform(),e.disableTempParent(l)}r.renderTexture.bind(s),r.batch.currentRenderer.start(),(n??r.background.clearBeforeRender)&&r.renderTexture.clear(),e.render(r),r.batch.currentRenderer.flush(),s&&(i.blit&&r.framebuffer.blit(),s.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}};k5.extension={type:yt.RendererSystem,name:"objectRenderer"};St.add(k5);var jw=class extends g2{constructor(t){super(),this.type=rw.WEBGL,t=Object.assign({},ut.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Zo({projectionMatrix:new hr},!0);let e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:jw.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(er("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=jw.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t?.forceCanvas?!1:D8()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return er("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return er("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return er("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return er("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){er("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return er("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){er("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return er("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}},wd=jw;wd.extension={type:yt.Renderer,priority:1};wd.__plugins={};wd.__systems={};St.handleByMap(yt.RendererPlugin,wd.__plugins);St.handleByMap(yt.RendererSystem,wd.__systems);St.add(wd);var Y1=class extends Wo{constructor(e,i){let{width:r,height:s}=i||{};super(r,s),this.items=[],this.itemDirtyIds=[];for(let n=0;n<e;n++){let o=new li;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,i){for(let r=0;r<this.length;r++)e[r]&&(e[r].castToBaseTexture?this.addBaseTextureAt(e[r].castToBaseTexture(),r):e[r]instanceof Wo?this.addResourceAt(e[r],r):this.addResourceAt(Kf(e[r],i),r))}dispose(){for(let e=0,i=this.length;e<i;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,i){if(!this.items[i])throw new Error(`Index ${i} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[i].setResource(e),this}bind(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let i=0;i<this.length;i++)this.items[i].parentTextureArray=e,this.items[i].on("update",e.update,e)}unbind(e){super.unbind(e);for(let i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",e.update,e)}load(){if(this._load)return this._load;let i=this.items.map(r=>r.resource).filter(r=>r).map(r=>r.load());return this._load=Promise.all(i).then(()=>{let{realWidth:r,realHeight:s}=this.items[0];return this.resize(r,s),Promise.resolve(this)}),this._load}};var v2=class extends Y1{constructor(e,i){let{width:r,height:s}=i||{},n,o;Array.isArray(e)?(n=e,o=e.length):o=e,super(o,{width:r,height:s}),n&&this.initFromArray(n,i)}addBaseTextureAt(e,i){if(e.resource)this.addResourceAt(e.resource,i);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(e){super.bind(e),e.target=Au.TEXTURE_2D_ARRAY}upload(e,i,r){let{length:s,itemDirtyIds:n,items:o}=this,{gl:a}=e;r.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,s,0,i.format,r.type,null);for(let l=0;l<s;l++){let u=o[l];n[l]<u.dirtyId&&(n[l]=u.dirtyId,u.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,l,u.resource.width,u.resource.height,1,i.format,r.type,u.resource.source))}return!0}};var b2=class extends to{constructor(e){super(e)}static test(e){let{OffscreenCanvas:i}=globalThis;return i&&e instanceof i?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}};var M5=class extends Y1{constructor(t,e){let{width:i,height:r,autoLoad:s,linkBaseTexture:n}=e||{};if(t&&t.length!==M5.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:r});for(let o=0;o<M5.SIDES;o++)this.items[o].target=Au.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=n!==!1,t&&this.initFromArray(t,e),s!==!1&&this.load()}bind(t){super.bind(t),t.target=Au.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=Au.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,i){let r=this.itemDirtyIds;for(let s=0;s<M5.SIDES;s++){let n=this.items[s];(r[s]<n.dirtyId||i.dirtyId<e.dirtyId)&&(n.valid&&n.resource?(n.resource.upload(t,n,i),r[s]=n.dirtyId):r[s]<-1&&(t.gl.texImage2D(n.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),r[s]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===M5.SIDES}},P5=M5;P5.SIDES=6;var w2=class t extends to{constructor(e,i){i=i||{};let r,s;typeof e=="string"?(r=t.EMPTY,s=e):(r=e,s=null),super(r),this.url=s,this.crossOrigin=i.crossOrigin??!0,this.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,this._load=null,i.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(e,i)=>{if(this.url===null){e(this);return}try{let r=await ut.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;let s=await r.blob();if(this.destroyed)return;let n=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ks.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=n,this.update(),e(this)}catch(r){if(this.destroyed)return;i(r),this.onError.emit(r)}}),this._load)}upload(e,i,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),super.upload(e,i,r)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof e=="string"||e instanceof ImageBitmap)}static get EMPTY(){return t._EMPTY=t._EMPTY??ut.ADAPTER.createCanvas(0,0),t._EMPTY}};var ag=class extends to{constructor(t,e){e=e||{},super(ut.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),t(this)},ag.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){let t=new Image;to.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;let e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=e*this.scale,s=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/i*e,s=this._overrideHeight||this._overrideWidth/e*i),r=Math.round(r),s=Math.round(s);let n=this.source;n.width=r,n.height=s,n._pixiId=`canvas_${Pc()}`,n.getContext("2d").drawImage(t,0,0,e,i,0,0,r,s),this._resolve(),this._resolve=null}}static getSize(t){let e=ag.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&ag.SVG_XML.test(t)}},ic=ag;ic.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;ic.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var Xw=class extends to{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){let i=document.createElement("video");i.setAttribute("preload","auto"),i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline",""),typeof t=="string"&&(t=[t]);let r=t[0].src||t[0];to.crossOrigin(i,r,e.crossorigin);for(let s=0;s<t.length;++s){let n=document.createElement("source"),{src:o,mime:a}=t[s];o=o||t[s];let l=o.split("?").shift().toLowerCase(),u=l.slice(l.lastIndexOf(".")+1);a=a||Xw.MIME_TYPES[u]||`video/${u}`,n.src=o,n.type=a,i.appendChild(n)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){let e=Us.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;let t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise(e=>{this.valid?e(this):(this._resolve=e,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)}_isSourcePlaying(){let t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Us.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Us.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){let t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);let e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._isConnectedToTicker&&(Us.shared.remove(this.update,this),this._isConnectedToTicker=!1);let t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Us.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Us.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t)}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Xw.TYPES.includes(e)}},E2=Xw;E2.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];E2.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};Qf.push(w2,W1,b2,E2,ic,ya,P5,v2);var Dc=class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?ei.EMPTY:(e=e||new ei(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,i){let{a:r,b:s,c:n,d:o,tx:a,ty:l}=e,u=r*i.x+n*i.y+a,d=s*i.x+o*i.y+l;this.minX=Math.min(this.minX,u),this.maxX=Math.max(this.maxX,u),this.minY=Math.min(this.minY,d),this.maxY=Math.max(this.maxY,d)}addQuad(e){let i=this.minX,r=this.minY,s=this.maxX,n=this.maxY,o=e[0],a=e[1];i=o<i?o:i,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=e[2],a=e[3],i=o<i?o:i,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=e[4],a=e[5],i=o<i?o:i,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=e[6],a=e[7],i=o<i?o:i,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,this.minX=i,this.minY=r,this.maxX=s,this.maxY=n}addFrame(e,i,r,s,n){this.addFrameMatrix(e.worldTransform,i,r,s,n)}addFrameMatrix(e,i,r,s,n){let o=e.a,a=e.b,l=e.c,u=e.d,d=e.tx,m=e.ty,g=this.minX,_=this.minY,v=this.maxX,E=this.maxY,b=o*i+l*r+d,T=a*i+u*r+m;g=b<g?b:g,_=T<_?T:_,v=b>v?b:v,E=T>E?T:E,b=o*s+l*r+d,T=a*s+u*r+m,g=b<g?b:g,_=T<_?T:_,v=b>v?b:v,E=T>E?T:E,b=o*i+l*n+d,T=a*i+u*n+m,g=b<g?b:g,_=T<_?T:_,v=b>v?b:v,E=T>E?T:E,b=o*s+l*n+d,T=a*s+u*n+m,g=b<g?b:g,_=T<_?T:_,v=b>v?b:v,E=T>E?T:E,this.minX=g,this.minY=_,this.maxX=v,this.maxY=E}addVertexData(e,i,r){let s=this.minX,n=this.minY,o=this.maxX,a=this.maxY;for(let l=i;l<r;l+=2){let u=e[l],d=e[l+1];s=u<s?u:s,n=d<n?d:n,o=u>o?u:o,a=d>a?d:a}this.minX=s,this.minY=n,this.maxX=o,this.maxY=a}addVertices(e,i,r,s){this.addVerticesMatrix(e.worldTransform,i,r,s)}addVerticesMatrix(e,i,r,s,n=0,o=n){let a=e.a,l=e.b,u=e.c,d=e.d,m=e.tx,g=e.ty,_=this.minX,v=this.minY,E=this.maxX,b=this.maxY;for(let T=r;T<s;T+=2){let A=i[T],M=i[T+1],k=a*A+u*M+m,F=d*M+l*A+g;_=Math.min(_,k-n),E=Math.max(E,k+n),v=Math.min(v,F-o),b=Math.max(b,F+o)}this.minX=_,this.minY=v,this.maxX=E,this.maxY=b}addBounds(e){let i=this.minX,r=this.minY,s=this.maxX,n=this.maxY;this.minX=e.minX<i?e.minX:i,this.minY=e.minY<r?e.minY:r,this.maxX=e.maxX>s?e.maxX:s,this.maxY=e.maxY>n?e.maxY:n}addBoundsMask(e,i){let r=e.minX>i.minX?e.minX:i.minX,s=e.minY>i.minY?e.minY:i.minY,n=e.maxX<i.maxX?e.maxX:i.maxX,o=e.maxY<i.maxY?e.maxY:i.maxY;if(r<=n&&s<=o){let a=this.minX,l=this.minY,u=this.maxX,d=this.maxY;this.minX=r<a?r:a,this.minY=s<l?s:l,this.maxX=n>u?n:u,this.maxY=o>d?o:d}}addBoundsMatrix(e,i){this.addFrameMatrix(i,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,i){let r=e.minX>i.x?e.minX:i.x,s=e.minY>i.y?e.minY:i.y,n=e.maxX<i.x+i.width?e.maxX:i.x+i.width,o=e.maxY<i.y+i.height?e.maxY:i.y+i.height;if(r<=n&&s<=o){let a=this.minX,l=this.minY,u=this.maxX,d=this.maxY;this.minX=r<a?r:a,this.minY=s<l?s:l,this.maxX=n>u?n:u,this.maxY=o>d?o:d}}pad(e=0,i=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=i,this.maxY+=i)}addFramePad(e,i,r,s,n,o){e-=n,i-=o,r+=n,s+=o,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<i?this.minY:i,this.maxY=this.maxY>s?this.maxY:s}};var $r=class t extends At.EventEmitter{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new _d,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Dc,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){let i=Object.keys(e);for(let r=0;r<i.length;++r){let s=i[r];Object.defineProperty(t.prototype,s,Object.getOwnPropertyDescriptor(e,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,i){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),i||(this._boundsRect||(this._boundsRect=new ei),i=this._boundsRect),this._bounds.getRectangle(i)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new ei),e=this._localBoundsRect),this._localBounds||(this._localBounds=new Dc);let i=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;let s=this._bounds,n=this._boundsID;this._bounds=this._localBounds;let o=this.getBounds(!1,e);return this.parent=r,this.transform=i,this._bounds=s,this._bounds.updateID+=this._boundsID-n,o}toGlobal(e,i,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,i)}toLocal(e,i,r,s){return i&&(e=i.toGlobal(e,r,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,r)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){this.parent?.removeChild(this)}setTransform(e=0,i=0,r=1,s=1,n=0,o=0,a=0,l=0,u=0){return this.position.x=e,this.position.y=i,this.scale.x=r||1,this.scale.y=s||1,this.rotation=n,this.skew.x=o,this.skew.y=a,this.pivot.x=l,this.pivot.y=u,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new lg),this.tempDisplayObjectParent}enableTempParent(){let e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*Rw}set angle(e){this.transform.rotation=e*Jl}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex=e,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){let i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount--,i._maskRefCount===0&&(i.renderable=!0,i.isMask=!1))}if(this._mask=e,this._mask){let i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount===0&&(i.renderable=!1,i.isMask=!0),i._maskRefCount++)}}}},lg=class extends $r{constructor(){super(...arguments),this.sortDirty=null}};$r.prototype.displayObjectUpdateTransform=$r.prototype.updateTransform;var kj=new hr;function Mj(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}var Ww=class extends $r{constructor(){super(),this.children=[],this.sortableChildren=Ww.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{let e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;let i=this.getChildIndex(t),r=this.getChildIndex(e);this.children[i]=e,this.children[r]=t,this.onChildrenChange(i<r?i:r)}getChildIndex(t){let e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);let i=this.getChildIndex(t);At.removeItems(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{let e=t[0],i=this.children.indexOf(e);if(i===-1)return null;e.parent=null,e.transform._parentID=-1,At.removeItems(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this),this.emit("childRemoved",e,this,i)}return t[0]}removeChildAt(t){let e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,At.removeItems(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){let i=t,r=e,s=r-i,n;if(s>0&&s<=r){n=this.children.splice(i,s);for(let o=0;o<n.length;++o)n[o].parent=null,n[o].transform&&(n[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let o=0;o<n.length;++o)n[o].emit("removed",this),this.emit("childRemoved",n[o],this,o);return n}else if(s===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,i=this.children.length;e<i;++e){let r=this.children[e];r._lastSortedIndex=e,!t&&r.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(Mj),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){let i=this.children[t];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){let e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){let i=e._mask.isMaskData?e._mask.maskObject:e._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(e._bounds,i._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){let i=super.getLocalBounds(t);if(!e)for(let r=0,s=this.children.length;r<s;++r){let n=this.children[r];n.visible&&n.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(t){let e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let i,r;this.cullArea?(i=this.cullArea,r=this.worldTransform):this._render!==Ww.prototype._render&&(i=this.getBounds(!0));let s=t.projection.transform;if(s&&(r?(r=kj.copyFrom(r),r.prepend(s)):r=s),i&&e.intersects(i,r))this._render(t);else if(this.cullArea)return;for(let n=0,o=this.children.length;n<o;++n){let a=this.children[n],l=a.cullable;a.cullable=l||!this.cullArea,a.render(t),a.cullable=l}}render(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}}renderAdvanced(t){let e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let s=0;s<e.length;s++)e[s].enabled&&this._enabledFilters.push(e[s])}let r=e&&this._enabledFilters?.length||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==Js.NONE));if(r&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let s=0,n=this.children.length;s<n;++s)this.children[s].render(t)}r&&t.batch.flush(),i&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;let e=typeof t=="boolean"?t:t?.children,i=this.removeChildren(0,this.children.length);if(e)for(let r=0;r<i.length;++r)i[r].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){let e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){let e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}},qi=Ww;qi.defaultSortableChildren=!1;qi.prototype.containerUpdateTransform=qi.prototype.updateTransform;Object.defineProperties(ut,{SORTABLE_CHILDREN:{get(){return qi.defaultSortableChildren},set(t){At.deprecation("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),qi.defaultSortableChildren=t}}});var R5=new Jt,Pj=new Uint16Array([0,1,2,0,2,3]),Jr=class t extends qi{constructor(e){super(),this._anchor=new Yo(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new fi(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=Ii.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||qt.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Pj,this.pluginName="batch",this.isSprite=!0,this._roundPixels=ut.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=At.sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=At.sign(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){let e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;let i=this.transform.worldTransform,r=i.a,s=i.b,n=i.c,o=i.d,a=i.tx,l=i.ty,u=this.vertexData,d=e.trim,m=e.orig,g=this._anchor,_=0,v=0,E=0,b=0;if(d?(v=d.x-g._x*m.width,_=v+d.width,b=d.y-g._y*m.height,E=b+d.height):(v=-g._x*m.width,_=v+m.width,b=-g._y*m.height,E=b+m.height),u[0]=r*v+n*b+a,u[1]=o*b+s*v+l,u[2]=r*_+n*b+a,u[3]=o*b+s*_+l,u[4]=r*_+n*E+a,u[5]=o*E+s*_+l,u[6]=r*v+n*E+a,u[7]=o*E+s*v+l,this._roundPixels){let T=ut.RESOLUTION;for(let A=0;A<u.length;++A)u[A]=Math.round(u[A]*T)/T}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;let e=this._texture,i=this.vertexTrimmedData,r=e.orig,s=this._anchor,n=this.transform.worldTransform,o=n.a,a=n.b,l=n.c,u=n.d,d=n.tx,m=n.ty,g=-s._x*r.width,_=g+r.width,v=-s._y*r.height,E=v+r.height;i[0]=o*g+l*v+d,i[1]=u*v+a*g+m,i[2]=o*_+l*v+d,i[3]=u*v+a*_+m,i[4]=o*_+l*E+d,i[5]=u*E+a*_+m,i[6]=o*g+l*E+d,i[7]=u*E+a*g+m}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){let e=this._texture.trim,i=this._texture.orig;!e||e.width===i.width&&e.height===i.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return this.children.length===0?(this._localBounds||(this._localBounds=new Dc),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new ei),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,R5);let i=this._texture.orig.width,r=this._texture.orig.height,s=-i*this.anchor.x,n=0;return R5.x>=s&&R5.x<s+i&&(n=-r*this.anchor.y,R5.y>=n&&R5.y<n+r)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof e=="boolean"?e:e?.texture){let r=typeof e=="boolean"?e:e?.baseTexture;this._texture.destroy(!!r)}this._texture=null}static from(e,i){let r=e instanceof qt?e:qt.from(e,i);return new t(r)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){let i=At.sign(this.scale.x)||1;this.scale.x=i*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){let i=At.sign(this.scale.y)||1;this.scale.y=i*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||qt.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}};var UR=new hr;$r.prototype._cacheAsBitmap=!1;$r.prototype._cacheData=null;$r.prototype._cacheAsBitmapResolution=null;$r.prototype._cacheAsBitmapMultisample=null;var qw=class{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}};Object.defineProperties($r.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;this._cacheAsBitmap=t;let e;t?(this._cacheData||(this._cacheData=new qw),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}});$r.prototype._renderCached=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))};$r.prototype._initCachedDisplayObject=function(e){if(this._cacheData?.sprite)return;let i=this.alpha;this.alpha=1,e.batch.flush();let r=this.getLocalBounds(null,!0).clone();if(this.filters?.length){let g=this.filters[0].padding;r.pad(g)}r.ceil(ut.RESOLUTION);let s=e.renderTexture.current,n=e.renderTexture.sourceFrame.clone(),o=e.renderTexture.destinationFrame.clone(),a=e.projection.transform,l=$a.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||e.resolution,multisample:this.cacheAsBitmapMultisample??e.multisample}),u=`cacheAsBitmap_${At.uid()}`;this._cacheData.textureCacheId=u,li.addToCache(l.baseTexture,u),qt.addToCache(l,u);let d=this.transform.localTransform.copyTo(UR).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,e.render(this,{renderTexture:l,clear:!0,transform:d,skipUpdateTransform:!1}),e.framebuffer.blit(),e.projection.transform=a,e.renderTexture.bind(s,n,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;let m=new Jr(l);m.transform.worldTransform=this.transform.worldTransform,m.anchor.x=-(r.x/r.width),m.anchor.y=-(r.y/r.height),m.alpha=i,m._bounds=this._bounds,this._cacheData.sprite=m,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=m.containsPoint.bind(m)};$r.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))};$r.prototype._initCachedDisplayObjectCanvas=function(e){if(this._cacheData?.sprite)return;let i=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;let s=e.canvasContext.activeContext,n=e._projTransform;i.ceil(ut.RESOLUTION);let o=$a.create({width:i.width,height:i.height}),a=`cacheAsBitmap_${At.uid()}`;this._cacheData.textureCacheId=a,li.addToCache(o.baseTexture,a),qt.addToCache(o,a);let l=UR;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=i.x,l.ty-=i.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,{renderTexture:o,clear:!0,transform:l,skipUpdateTransform:!1}),e.canvasContext.activeContext=s,e._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;let u=new Jr(o);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(i.x/i.width),u.anchor.y=-(i.y/i.height),u.alpha=r,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=u.containsPoint.bind(u)};$r.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};$r.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};$r.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,li.removeFromCache(this._cacheData.textureCacheId),qt.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};$r.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)};$r.prototype.name=null;qi.prototype.getChildByName=function(e,i){for(let r=0,s=this.children.length;r<s;r++)if(this.children[r].name===e)return this.children[r];if(i)for(let r=0,s=this.children.length;r<s;r++){let n=this.children[r];if(!n.getChildByName)continue;let o=n.getChildByName(e,!0);if(o)return o}return null};$r.prototype.getGlobalPosition=function(e=new Jt,i=!1){return this.parent?this.parent.toGlobal(this.position,e,i):(e.x=this.position.x,e.y=this.position.y),e};var zR=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;var T2=class extends Wt{constructor(e=1){super(Vw,zR,{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}};var Rj={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Dj=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function GR(t){let e=Rj[t],i=e.length,r=Dj,s="",n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;",o;for(let a=0;a<t;a++){let l=n.replace("%index%",a.toString());o=a,a>=i&&(o=t-a-1),l=l.replace("%value%",e[o].toString()),s+=l,s+=`
`}return r=r.replace("%blur%",s),r=r.replace("%size%",t.toString()),r}var Fj=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function $R(t,e){let i=Math.ceil(t/2),r=Fj,s="",n;e?n="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":n="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<t;o++){let a=n.replace("%index%",o.toString());a=a.replace("%sampleIndex%",`${o-(i-1)}.0`),s+=a,s+=`
`}return r=r.replace("%blur%",s),r=r.replace("%size%",t.toString()),r}var Du=class extends Wt{constructor(e,i=8,r=4,s=Wt.defaultResolution,n=5){let o=$R(n,e),a=GR(n);super(o,a),this.horizontal=e,this.resolution=s,this._quality=0,this.quality=r,this.blur=i}apply(e,i,r,s){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/i.width):this.uniforms.strength=1/r.height*(r.height/i.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/i.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/i.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)e.applyFilter(this,i,r,s);else{let n=e.getFilterTexture(),o=e.renderer,a=i,l=n;this.state.blend=!1,e.applyFilter(this,a,l,Ua.CLEAR);for(let u=1;u<this.passes-1;u++){e.bindAndClear(a,Ua.BLIT),this.uniforms.uSampler=l;let d=l;l=a,a=d,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,l,r,s),e.returnFilterTexture(n)}}get blur(){return this.strength}set blur(e){this.padding=1+Math.abs(e)*2,this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}};var D5=class extends Wt{constructor(e=8,i=4,r=Wt.defaultResolution,s=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Du(!0,e,i,r,s),this.blurYFilter=new Du(!1,e,i,r,s),this.resolution=r,this.quality=i,this.blur=e,this.repeatEdgePixels=!1}apply(e,i,r,s){let n=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(n&&o){let a=e.getFilterTexture();this.blurXFilter.apply(e,i,a,Ua.CLEAR),this.blurYFilter.apply(e,a,r,s),e.returnFilterTexture(a)}else o?this.blurYFilter.apply(e,i,r,s):this.blurXFilter.apply(e,i,r,s)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}};var HR=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;var Ed=class extends Wt{constructor(){let e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(A5,HR,e),this.alpha=1}_loadMatrix(e,i=!1){let r=e;i&&(this._multiply(r,this.uniforms.m,e),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(e,i,r){return e[0]=i[0]*r[0]+i[1]*r[5]+i[2]*r[10]+i[3]*r[15],e[1]=i[0]*r[1]+i[1]*r[6]+i[2]*r[11]+i[3]*r[16],e[2]=i[0]*r[2]+i[1]*r[7]+i[2]*r[12]+i[3]*r[17],e[3]=i[0]*r[3]+i[1]*r[8]+i[2]*r[13]+i[3]*r[18],e[4]=i[0]*r[4]+i[1]*r[9]+i[2]*r[14]+i[3]*r[19]+i[4],e[5]=i[5]*r[0]+i[6]*r[5]+i[7]*r[10]+i[8]*r[15],e[6]=i[5]*r[1]+i[6]*r[6]+i[7]*r[11]+i[8]*r[16],e[7]=i[5]*r[2]+i[6]*r[7]+i[7]*r[12]+i[8]*r[17],e[8]=i[5]*r[3]+i[6]*r[8]+i[7]*r[13]+i[8]*r[18],e[9]=i[5]*r[4]+i[6]*r[9]+i[7]*r[14]+i[8]*r[19]+i[9],e[10]=i[10]*r[0]+i[11]*r[5]+i[12]*r[10]+i[13]*r[15],e[11]=i[10]*r[1]+i[11]*r[6]+i[12]*r[11]+i[13]*r[16],e[12]=i[10]*r[2]+i[11]*r[7]+i[12]*r[12]+i[13]*r[17],e[13]=i[10]*r[3]+i[11]*r[8]+i[12]*r[13]+i[13]*r[18],e[14]=i[10]*r[4]+i[11]*r[9]+i[12]*r[14]+i[13]*r[19]+i[14],e[15]=i[15]*r[0]+i[16]*r[5]+i[17]*r[10]+i[18]*r[15],e[16]=i[15]*r[1]+i[16]*r[6]+i[17]*r[11]+i[18]*r[16],e[17]=i[15]*r[2]+i[16]*r[7]+i[17]*r[12]+i[18]*r[17],e[18]=i[15]*r[3]+i[16]*r[8]+i[17]*r[13]+i[18]*r[18],e[19]=i[15]*r[4]+i[16]*r[9]+i[17]*r[14]+i[18]*r[19]+i[19],e}_colorMatrix(e){let i=new Float32Array(e);return i[4]/=255,i[9]/=255,i[14]/=255,i[19]/=255,i}brightness(e,i){let r=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(r,i)}tint(e,i){let[r,s,n]=fi.shared.setValue(e).toArray(),o=[r,0,0,0,0,0,s,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(o,i)}greyscale(e,i){let r=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(r,i)}blackAndWhite(e){let i=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(i,e)}hue(e,i){e=(e||0)/180*Math.PI;let r=Math.cos(e),s=Math.sin(e),n=Math.sqrt,o=1/3,a=n(o),l=r+(1-r)*o,u=o*(1-r)-a*s,d=o*(1-r)+a*s,m=o*(1-r)+a*s,g=r+o*(1-r),_=o*(1-r)-a*s,v=o*(1-r)-a*s,E=o*(1-r)+a*s,b=r+o*(1-r),T=[l,u,d,0,0,m,g,_,0,0,v,E,b,0,0,0,0,0,1,0];this._loadMatrix(T,i)}contrast(e,i){let r=(e||0)+1,s=-.5*(r-1),n=[r,0,0,0,s,0,r,0,0,s,0,0,r,0,s,0,0,0,1,0];this._loadMatrix(n,i)}saturate(e=0,i){let r=e*2/3+1,s=(r-1)*-.5,n=[r,s,s,0,0,s,r,s,0,0,s,s,r,0,0,0,0,0,1,0];this._loadMatrix(n,i)}desaturate(){this.saturate(-1)}negative(e){let i=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(i,e)}sepia(e){let i=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(i,e)}technicolor(e){let i=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(i,e)}polaroid(e){let i=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(i,e)}toBGR(e){let i=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(i,e)}kodachrome(e){let i=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(i,e)}browni(e){let i=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(i,e)}vintage(e){let i=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(i,e)}colorTone(e,i,r,s,n){e=e||.2,i=i||.15,r=r||16770432,s=s||3375104;let o=fi.shared,[a,l,u]=o.setValue(r).toArray(),[d,m,g]=o.setValue(s).toArray(),_=[.3,.59,.11,0,0,a,l,u,e,0,d,m,g,i,0,a-d,l-m,u-g,0,0];this._loadMatrix(_,n)}night(e,i){e=e||.1;let r=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(r,i)}predator(e,i){let r=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(r,i)}lsd(e){let i=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(i,e)}reset(){let e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}};Ed.prototype.grayscale=Ed.prototype.greyscale;var VR=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`;var jR=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;var F5=class extends Wt{constructor(e,i){let r=new hr;e.renderable=!1,super(jR,VR,{mapSampler:e._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=r,i==null&&(i=20),this.scale=new Jt(i,i)}apply(e,i,r,s){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;let n=this.maskSprite.worldTransform,o=Math.sqrt(n.a*n.a+n.b*n.b),a=Math.sqrt(n.c*n.c+n.d*n.d);o!==0&&a!==0&&(this.uniforms.rotation[0]=n.a/o,this.uniforms.rotation[1]=n.b/o,this.uniforms.rotation[2]=n.c/a,this.uniforms.rotation[3]=n.d/a),e.applyFilter(this,i,r,s)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}};var XR=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`;var WR=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;var L5=class extends Wt{constructor(){super(WR,XR)}};var qR=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;var N5=class extends Wt{constructor(e=.5,i=Math.random()){super(A5,qR,{uNoise:0,uSeed:0}),this.noise=e,this.seed=i}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}};var O5={AlphaFilter:T2,BlurFilter:D5,BlurFilterPass:Du,ColorMatrixFilter:Ed,DisplacementFilter:F5,FXAAFilter:L5,NoiseFilter:N5};Object.entries(O5).forEach(([t,e])=>{Object.defineProperty(O5,t,{get(){return At.deprecation("7.1.0",`filters.${t} has moved to ${t}`),e}})});var Yw=class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(Us.system.add(this.tickerUpdate,this,Ha.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Us.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}let e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&e.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}},Fc=new Yw;var Fu=class t{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=t.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Jt,this.page=new Jt,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,i,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,i,r,s,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}};var Lc=class extends Fu{constructor(){super(...arguments),this.client=new Jt,this.movement=new Jt,this.offset=new Jt,this.global=new Jt,this.screen=new Jt}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,i,r){return e.worldTransform.applyInverse(r||this.global,i)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,i,r,s,n,o,a,l,u,d,m,g,_,v,E){throw new Error("Method not implemented.")}};var go=class extends Lc{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}};var rc=class extends Lc{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}};rc.DOM_DELTA_PIXEL=0;rc.DOM_DELTA_LINE=1;rc.DOM_DELTA_PAGE=2;var Lj=2048,Nj=new Jt,Zw=new Jt,B5=class{constructor(e){this.dispatch=new At.EventEmitter,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,i){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:i,priority:0}),this.mappingTable[e].sort((r,s)=>r.priority-s.priority)}dispatchEvent(e,i){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,i),this.dispatch.emit(i||e.type,e)}mapEvent(e){if(!this.rootTarget)return;let i=this.mappingTable[e.type];if(i)for(let r=0,s=i.length;r<s;r++)i[r].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,i){Fc.pauseUpdate=!0;let s=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",n=this[s](this.rootTarget,this.rootTarget.eventMode,Nj.set(e,i),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(e,i){if(!e.target)return;let r=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let s=0,n=r.length-1;s<n;s++)if(e.currentTarget=r[s],this.notifyTarget(e,i),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,i),!(e.propagationStopped||e.propagationImmediatelyStopped)){e.eventPhase=e.BUBBLING_PHASE;for(let s=r.length-2;s>=0;s--)if(e.currentTarget=r[s],this.notifyTarget(e,i),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,i,r=this._allInteractiveElements){if(r.length===0)return;e.eventPhase=e.BUBBLING_PHASE;let s=Array.isArray(i)?i:[i];for(let n=r.length-1;n>=0;n--)s.forEach(o=>{e.currentTarget=r[n],this.notifyTarget(e,o)})}propagationPath(e){let i=[e];for(let r=0;r<Lj&&e!==this.rootTarget;r++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");i.push(e.parent),e=e.parent}return i.reverse(),i}hitTestMoveRecursive(e,i,r,s,n,o=!1){let a=!1;if(this._interactivePrune(e))return null;if((e.eventMode==="dynamic"||i==="dynamic")&&(Fc.pauseUpdate=!1),e.interactiveChildren&&e.children){let d=e.children;for(let m=d.length-1;m>=0;m--){let g=d[m],_=this.hitTestMoveRecursive(g,this._isInteractive(i)?i:g.eventMode,r,s,n,o||n(e,r));if(_){if(_.length>0&&!_[_.length-1].parent)continue;let v=e.isInteractive();(_.length>0||v)&&(v&&this._allInteractiveElements.push(e),_.push(e)),this._hitElements.length===0&&(this._hitElements=_),a=!0}}}let l=this._isInteractive(i),u=e.isInteractive();return u&&u&&this._allInteractiveElements.push(e),o||this._hitElements.length>0?null:a?this._hitElements:l&&!n(e,r)&&s(e,r)?u?[e]:[]:null}hitTestRecursive(e,i,r,s,n){if(this._interactivePrune(e)||n(e,r))return null;if((e.eventMode==="dynamic"||i==="dynamic")&&(Fc.pauseUpdate=!1),e.interactiveChildren&&e.children){let l=e.children;for(let u=l.length-1;u>=0;u--){let d=l[u],m=this.hitTestRecursive(d,this._isInteractive(i)?i:d.eventMode,r,s,n);if(m){if(m.length>0&&!m[m.length-1].parent)continue;let g=e.isInteractive();return(m.length>0||g)&&m.push(e),m}}}let o=this._isInteractive(i),a=e.isInteractive();return o&&s(e,r)?a?[e]:[]:null}_isInteractive(e){return e==="static"||e==="dynamic"}_interactivePrune(e){return!!(!e||e.isMask||!e.visible||!e.renderable||e.eventMode==="none"||e.eventMode==="passive"&&!e.interactiveChildren||e.isMask)}hitPruneFn(e,i){if(e.hitArea&&(e.worldTransform.applyInverse(i,Zw),!e.hitArea.contains(Zw.x,Zw.y)))return!0;if(e._mask){let r=e._mask.isMaskData?e._mask.maskObject:e._mask;if(r&&!r.containsPoint?.(i))return!0}return!1}hitTestFn(e,i){return e.eventMode==="passive"?!1:e.hitArea?!0:e.containsPoint?e.containsPoint(i):!1}notifyTarget(e,i){i=i??e.type;let r=`on${i}`;e.currentTarget[r]?.(e);let s=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${i}capture`:i;this.notifyListeners(e,s),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,i)}mapPointerDown(e){if(!(e instanceof go)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let i=this.createPointerEvent(e);if(this.dispatchEvent(i,"pointerdown"),i.pointerType==="touch")this.dispatchEvent(i,"touchstart");else if(i.pointerType==="mouse"||i.pointerType==="pen"){let s=i.button===2;this.dispatchEvent(i,s?"rightdown":"mousedown")}let r=this.trackingData(e.pointerId);r.pressTargetsByButton[e.button]=i.composedPath(),this.freeEvent(i)}mapPointerMove(e){if(!(e instanceof go)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;let i=this.createPointerEvent(e);this._isPointerMoveEvent=!1;let r=i.pointerType==="mouse"||i.pointerType==="pen",s=this.trackingData(e.pointerId),n=this.findMountedTarget(s.overTargets);if(s.overTargets?.length>0&&n!==i.target){let l=e.type==="mousemove"?"mouseout":"pointerout",u=this.createPointerEvent(e,l,n);if(this.dispatchEvent(u,"pointerout"),r&&this.dispatchEvent(u,"mouseout"),!i.composedPath().includes(n)){let d=this.createPointerEvent(e,"pointerleave",n);for(d.eventPhase=d.AT_TARGET;d.target&&!i.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),r&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(u)}if(n!==i.target){let l=e.type==="mousemove"?"mouseover":"pointerover",u=this.clonePointerEvent(i,l);this.dispatchEvent(u,"pointerover"),r&&this.dispatchEvent(u,"mouseover");let d=n?.parent;for(;d&&d!==this.rootTarget.parent&&d!==i.target;)d=d.parent;if(!d||d===this.rootTarget.parent){let g=this.clonePointerEvent(i,"pointerenter");for(g.eventPhase=g.AT_TARGET;g.target&&g.target!==n&&g.target!==this.rootTarget.parent;)g.currentTarget=g.target,this.notifyTarget(g),r&&this.notifyTarget(g,"mouseenter"),g.target=g.target.parent;this.freeEvent(g)}this.freeEvent(u)}let o=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(i,"pointermove"),a&&o.push("globalpointermove"),i.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(i,"touchmove"),a&&o.push("globaltouchmove")),r&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(i,"mousemove"),a&&o.push("globalmousemove"),this.cursor=i.target?.cursor),o.length>0&&this.all(i,o),this._allInteractiveElements.length=0,this._hitElements.length=0,s.overTargets=i.composedPath(),this.freeEvent(i)}mapPointerOver(e){if(!(e instanceof go)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let i=this.trackingData(e.pointerId),r=this.createPointerEvent(e),s=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),s&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=r.target?.cursor);let n=this.clonePointerEvent(r,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),s&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;i.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(n)}mapPointerOut(e){if(!(e instanceof go)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let i=this.trackingData(e.pointerId);if(i.overTargets){let r=e.pointerType==="mouse"||e.pointerType==="pen",s=this.findMountedTarget(i.overTargets),n=this.createPointerEvent(e,"pointerout",s);this.dispatchEvent(n),r&&this.dispatchEvent(n,"mouseout");let o=this.createPointerEvent(e,"pointerleave",s);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),r&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;i.overTargets=null,this.freeEvent(n),this.freeEvent(o)}this.cursor=null}mapPointerUp(e){if(!(e instanceof go)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let i=performance.now(),r=this.createPointerEvent(e);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){let a=r.button===2;this.dispatchEvent(r,a?"rightup":"mouseup")}let s=this.trackingData(e.pointerId),n=this.findMountedTarget(s.pressTargetsByButton[e.button]),o=n;if(n&&!r.composedPath().includes(n)){let a=n;for(;a&&!r.composedPath().includes(a);){if(r.currentTarget=a,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){let l=r.button===2;this.notifyTarget(r,l?"rightupoutside":"mouseupoutside")}a=a.parent}delete s.pressTargetsByButton[e.button],o=a}if(o){let a=this.clonePointerEvent(r,"click");a.target=o,a.path=null,s.clicksByButton[e.button]||(s.clicksByButton[e.button]={clickCount:0,target:a.target,timeStamp:i});let l=s.clicksByButton[e.button];if(l.target===a.target&&i-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=a.target,l.timeStamp=i,a.detail=l.clickCount,a.pointerType==="mouse"){let u=a.button===2;this.dispatchEvent(a,u?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(r)}mapPointerUpOutside(e){if(!(e instanceof go)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let i=this.trackingData(e.pointerId),r=this.findMountedTarget(i.pressTargetsByButton[e.button]),s=this.createPointerEvent(e);if(r){let n=r;for(;n;)s.currentTarget=n,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch"?this.notifyTarget(s,"touchendoutside"):(s.pointerType==="mouse"||s.pointerType==="pen")&&this.notifyTarget(s,s.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete i.pressTargetsByButton[e.button]}this.freeEvent(s)}mapWheel(e){if(!(e instanceof rc)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}let i=this.createWheelEvent(e);this.dispatchEvent(i),this.freeEvent(i)}findMountedTarget(e){if(!e)return null;let i=e[0];for(let r=1;r<e.length&&e[r].parent===i;r++)i=e[r];return i}createPointerEvent(e,i,r){let s=this.allocateEvent(go);return this.copyPointerData(e,s),this.copyMouseData(e,s),this.copyData(e,s),s.nativeEvent=e.nativeEvent,s.originalEvent=e,s.target=r??this.hitTest(s.global.x,s.global.y)??this._hitElements[0],typeof i=="string"&&(s.type=i),s}createWheelEvent(e){let i=this.allocateEvent(rc);return this.copyWheelData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.nativeEvent=e.nativeEvent,i.originalEvent=e,i.target=this.hitTest(i.global.x,i.global.y),i}clonePointerEvent(e,i){let r=this.allocateEvent(go);return r.nativeEvent=e.nativeEvent,r.originalEvent=e.originalEvent,this.copyPointerData(e,r),this.copyMouseData(e,r),this.copyData(e,r),r.target=e.target,r.path=e.composedPath().slice(),r.type=i??r.type,r}copyWheelData(e,i){i.deltaMode=e.deltaMode,i.deltaX=e.deltaX,i.deltaY=e.deltaY,i.deltaZ=e.deltaZ}copyPointerData(e,i){e instanceof go&&i instanceof go&&(i.pointerId=e.pointerId,i.width=e.width,i.height=e.height,i.isPrimary=e.isPrimary,i.pointerType=e.pointerType,i.pressure=e.pressure,i.tangentialPressure=e.tangentialPressure,i.tiltX=e.tiltX,i.tiltY=e.tiltY,i.twist=e.twist)}copyMouseData(e,i){e instanceof Lc&&i instanceof Lc&&(i.altKey=e.altKey,i.button=e.button,i.buttons=e.buttons,i.client.copyFrom(e.client),i.ctrlKey=e.ctrlKey,i.metaKey=e.metaKey,i.movement.copyFrom(e.movement),i.screen.copyFrom(e.screen),i.shiftKey=e.shiftKey,i.global.copyFrom(e.global))}copyData(e,i){i.isTrusted=e.isTrusted,i.srcElement=e.srcElement,i.timeStamp=performance.now(),i.type=e.type,i.detail=e.detail,i.view=e.view,i.which=e.which,i.layer.copyFrom(e.layer),i.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);let i=this.eventPool.get(e).pop()||new e(this);return i.eventPhase=i.NONE,i.currentTarget=null,i.path=null,i.target=null,i}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");let i=e.constructor;this.eventPool.has(i)||this.eventPool.set(i,[]),this.eventPool.get(i).push(e)}notifyListeners(e,i){let r=e.currentTarget._events[i];if(r&&e.currentTarget.isInteractive())if("fn"in r)r.once&&e.currentTarget.removeListener(i,r.fn,void 0,!0),r.fn.call(r.context,e);else for(let s=0,n=r.length;s<n&&!e.propagationImmediatelyStopped;s++)r[s].once&&e.currentTarget.removeListener(i,r[s].fn,void 0,!0),r[s].fn.call(r[s].context,e)}};var Oj=1,Bj={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Qw=class{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new B5(null),Fc.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new go(null),this.rootWheelEvent=new rc(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Qw.defaultEventFeatures},{set:(e,i,r)=>(i==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=r),e[i]=r,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){let{view:e,resolution:i}=this.renderer;this.setTargetElement(e),this.resolution=i,Qw._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;let i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch"))return;let e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let i=0,r=e.length;i<r;i++){let s=e[i],n=this.bootstrapEvent(this.rootPointerEvent,s);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch"))return;Fc.pointerMoved();let e=this.normalizeToPointerData(t);for(let i=0,r=e.length;i<r;i++){let s=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch"))return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);let i=e!==this.domElement?"outside":"",r=this.normalizeToPointerData(t);for(let s=0,n=r.length;s<n;s++){let o=this.bootstrapEvent(this.rootPointerEvent,r[s]);o.type+=i,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch"))return;let e=this.normalizeToPointerData(t);for(let i=0,r=e.length;i<r;i++){let s=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;let e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,Fc.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Fc.addTickerListener();let t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Fc.removeTickerListener();let t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){let r;this.domElement.parentElement?r=this.domElement.getBoundingClientRect():r={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};let s=1/this.resolution;t.x=(e-r.left)*(this.domElement.width/r.width)*s,t.y=(i-r.top)*(this.domElement.height/r.height)*s}normalizeToPointerData(t){let e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,r=t.changedTouches.length;i<r;i++){let s=t.changedTouches[i];typeof s.button>"u"&&(s.button=0),typeof s.buttons>"u"&&(s.buttons=1),typeof s.isPrimary>"u"&&(s.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof s.width>"u"&&(s.width=s.radiusX||1),typeof s.height>"u"&&(s.height=s.radiusY||1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="touch"),typeof s.pointerId>"u"&&(s.pointerId=s.identifier||0),typeof s.pressure>"u"&&(s.pressure=s.force||.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),typeof s.layerX>"u"&&(s.layerX=s.offsetX=s.clientX),typeof s.layerY>"u"&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=t.type,e.push(s)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){let i=t;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=Oj),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){let e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=Bj[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}},Td=Qw;Td.extension={name:"events",type:[yt.RendererSystem,yt.CanvasRendererSystem]};Td.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};St.add(Td);function YR(t){return t==="dynamic"||t==="static"}var ZR={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??YR(Td.defaultEventMode)},set interactive(t){At.deprecation("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=t,this.eventMode=t?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Td.defaultEventMode},set eventMode(t){this._internalInteractive=YR(t),this._internalEventMode=t},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(t,e,i){let r=typeof i=="boolean"&&i||typeof i=="object"&&i.capture,s=typeof e=="function"?void 0:e;t=r?`${t}capture`:t,e=typeof e=="function"?e:e.handleEvent,this.on(t,e,s)},removeEventListener(t,e,i){let r=typeof i=="boolean"&&i||typeof i=="object"&&i.capture,s=typeof e=="function"?void 0:e;t=r?`${t}capture`:t,e=typeof e=="function"?e:e.handleEvent,this.off(t,e,s)},dispatchEvent(t){if(!(t instanceof Fu))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};$r.mixin(ZR);var Kw={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};$r.mixin(Kw);var Uj=9,cg=100,zj=0,Gj=0,QR=2,KR=1,$j=-1e3,Hj=-1e3,Vj=2,U5=class{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(At.isMobile.tablet||At.isMobile.phone)&&this.createTouchHook();let i=document.createElement("div");i.style.width=`${cg}px`,i.style.height=`${cg}px`,i.style.position="absolute",i.style.top=`${zj}px`,i.style.left=`${Gj}px`,i.style.zIndex=QR.toString(),this.div=i,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){let e=document.createElement("button");e.style.width=`${KR}px`,e.style.height=`${KR}px`,e.style.position="absolute",e.style.top=`${$j}px`,e.style.left=`${Hj}px`,e.style.zIndex=Vj.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);let i=e.children;if(i)for(let r=0;r<i.length;r++)this.updateAccessibleObjects(i[r])}update(){let e=performance.now();if(At.isMobile.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);let{x:i,y:r,width:s,height:n}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:l}=this.renderer,u=s/o*l,d=n/a*l,m=this.div;m.style.left=`${i}px`,m.style.top=`${r}px`,m.style.width=`${o}px`,m.style.height=`${a}px`;for(let g=0;g<this.children.length;g++){let _=this.children[g];if(_.renderId!==this.renderId)_._accessibleActive=!1,At.removeItems(this.children,g,1),this.div.removeChild(_._accessibleDiv),this.pool.push(_._accessibleDiv),_._accessibleDiv=null,g--;else{m=_._accessibleDiv;let v=_.hitArea,E=_.worldTransform;_.hitArea?(m.style.left=`${(E.tx+v.x*E.a)*u}px`,m.style.top=`${(E.ty+v.y*E.d)*d}px`,m.style.width=`${v.width*E.a*u}px`,m.style.height=`${v.height*E.d*d}px`):(v=_.getBounds(),this.capHitArea(v),m.style.left=`${v.x*u}px`,m.style.top=`${v.y*d}px`,m.style.width=`${v.width*u}px`,m.style.height=`${v.height*d}px`,m.title!==_.accessibleTitle&&_.accessibleTitle!==null&&(m.title=_.accessibleTitle),m.getAttribute("aria-label")!==_.accessibleHint&&_.accessibleHint!==null&&m.setAttribute("aria-label",_.accessibleHint)),(_.accessibleTitle!==m.title||_.tabIndex!==m.tabIndex)&&(m.title=_.accessibleTitle,m.tabIndex=_.tabIndex,this.debug&&this.updateDebugHTML(m))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);let{width:i,height:r}=this.renderer;e.x+e.width>i&&(e.width=i-e.x),e.y+e.height>r&&(e.height=r-e.y)}addChild(e){let i=this.pool.pop();i||(i=document.createElement("button"),i.style.width=`${cg}px`,i.style.height=`${cg}px`,i.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",i.style.position="absolute",i.style.zIndex=QR.toString(),i.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?i.setAttribute("aria-live","off"):i.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?i.setAttribute("aria-relevant","additions"):i.setAttribute("aria-relevant","text"),i.addEventListener("click",this._onClick.bind(this)),i.addEventListener("focus",this._onFocus.bind(this)),i.addEventListener("focusout",this._onFocusOut.bind(this))),i.style.pointerEvents=e.accessiblePointerEvents,i.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?i.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(i.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&e.accessibleHint!==null&&i.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(i),e._accessibleActive=!0,e._accessibleDiv=i,i.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,i){let{displayObject:r}=e.target,s=this.renderer.events.rootBoundary,n=Object.assign(new Fu(s),{target:r});s.rootTarget=this.renderer.lastObjectRendered,i.forEach(o=>s.dispatchEvent(n,o))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){e.keyCode===Uj&&this.activate()}_onMouseMove(e){e.movementX===0&&e.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}};U5.extension={name:"accessibility",type:[yt.RendererPlugin,yt.CanvasRendererPlugin]};St.add(U5);var Jw=class{constructor(t){this.stage=new qi,t=Object.assign({forceCanvas:!1},t),this.renderer=Hw(t),Jw._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(t,e){let i=Jw._plugins.slice(0);i.reverse(),i.forEach(r=>{r.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}},Sd=Jw;Sd._plugins=[];St.handleByList(yt.Application,Sd._plugins);var z5=class{static init(e){Object.defineProperty(this,"resizeTo",{set(i){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=i,i&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let i,r;if(this._resizeTo===globalThis.window)i=globalThis.innerWidth,r=globalThis.innerHeight;else{let{clientWidth:s,clientHeight:n}=this._resizeTo;i=s,r=n}this.renderer.resize(i,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}};z5.extension=yt.Application;St.add(z5);var JR={loader:yt.LoadParser,resolver:yt.ResolveParser,cache:yt.CacheParser,detection:yt.DetectionParser};St.handle(yt.Asset,t=>{let e=t.ref;Object.entries(JR).filter(([i])=>!!e[i]).forEach(([i,r])=>St.add(Object.assign(e[i],{extension:e[i].extension??r})))},t=>{let e=t.ref;Object.keys(JR).filter(i=>!!e[i]).forEach(i=>St.remove(e[i]))});var ug=class{constructor(e,i=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=i}add(e){e.forEach(i=>{this._assetList.push(i)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;let e=[],i=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<i;r++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}};function wl(t,e){if(Array.isArray(e)){for(let i of e)if(t.startsWith(`data:${i}`))return!0;return!1}return t.startsWith(`data:${e}`)}function yo(t,e){let i=t.split("?")[0],r=At.path.extname(i).toLowerCase();return Array.isArray(e)?e.includes(r):r===e}var Qo=(t,e)=>(Array.isArray(t)||(t=[t]),e?t.map(i=>typeof i=="string"?e(i):i):t);var Ad=(t,e)=>{let i=e.split("?")[1];return i&&(t+=`?${i}`),t};function eD(t,e,i,r,s){let n=e[i];for(let o=0;o<n.length;o++){let a=n[o];i<e.length-1?eD(t.replace(r[i],a),e,i+1,r,s):s.push(t.replace(r[i],a))}}function hg(t){let e=/\{(.*?)\}/g,i=t.match(e),r=[];if(i){let s=[];i.forEach(n=>{let o=n.substring(1,n.length-1).split(",");s.push(o)}),eD(t,s,0,i,r)}else r.push(t);return r}var Lu=t=>!Array.isArray(t);var eE=class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){let i=this._cache.get(e);return i||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),i}set(e,i){let r=Qo(e),s;for(let a=0;a<this.parsers.length;a++){let l=this.parsers[a];if(l.test(i)){s=l.getCacheableAssets(r,i);break}}s||(s={},r.forEach(a=>{s[a]=i}));let n=Object.keys(s),o={cacheKeys:n,keys:r};if(r.forEach(a=>{this._cacheMap.set(a,o)}),n.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==i&&console.warn("[Cache] already has key:",a),this._cache.set(a,s[a])}),i instanceof qt){let a=i;r.forEach(l=>{a.baseTexture!==qt.EMPTY.baseTexture&&li.addToCache(a.baseTexture,l),qt.addToCache(a,l)})}}remove(e){if(this._cacheMap.get(e),!this._cacheMap.has(e)){console.warn(`[Assets] Asset id ${e} was not found in the Cache`);return}let i=this._cacheMap.get(e);i.cacheKeys.forEach(s=>{this._cache.delete(s)}),i.keys.forEach(s=>{this._cacheMap.delete(s)})}get parsers(){return this._parsers}},Z1=new eE;var dg=class{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,i,r)=>(this._parsersValidated=!1,e[i]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,i){let r={promise:null,parser:null};return r.promise=(async()=>{let s=null,n=null;if(i.loadParser&&(n=this._parserHash[i.loadParser],n||console.warn(`[Assets] specified load parser "${i.loadParser}" not found while loading ${e}`)),!n){for(let o=0;o<this.parsers.length;o++){let a=this.parsers[o];if(a.load&&a.test?.(e,i,this)){n=a;break}}if(!n)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}s=await n.load(e,i,this),r.parser=n;for(let o=0;o<this.parsers.length;o++){let a=this.parsers[o];a.parse&&a.parse&&await a.testParse?.(s,i,this)&&(s=await a.parse(s,i,this)||s,r.parser=a)}return s})(),r}async load(e,i){this._parsersValidated||this._validateParsers();let r=0,s={},n=Lu(e),o=Qo(e,u=>({src:u})),a=o.length,l=o.map(async u=>{let d=At.path.toAbsolute(u.src);if(!s[u.src])try{this.promiseCache[d]||(this.promiseCache[d]=this._getLoadPromiseAndParser(d,u)),s[u.src]=await this.promiseCache[d].promise,i&&i(++r/a)}catch(m){throw delete this.promiseCache[d],delete s[u.src],new Error(`[Loader.load] Failed to load ${d}.
${m}`)}});return await Promise.all(l),n?s[o[0].src]:s}async unload(e){let r=Qo(e,s=>({src:s})).map(async s=>{let n=At.path.toAbsolute(s.src),o=this.promiseCache[n];if(o){let a=await o.promise;o.parser?.unload?.(a,s,this),delete this.promiseCache[n]}});await Promise.all(r)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,i)=>(e[i.name]&&console.warn(`[Assets] loadParser name conflict "${i.name}"`),{...e,[i.name]:i}),{})}};var dn=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(dn||{});var jj=".json",Xj="application/json",tE={extension:{type:yt.LoadParser,priority:dn.Low},name:"loadJson",test(t){return wl(t,Xj)||yo(t,jj)},async load(t){return await(await ut.ADAPTER.fetch(t)).json()}};St.add(tE);var Wj=".txt",qj="text/plain",iE={name:"loadTxt",extension:{type:yt.LoadParser,priority:dn.Low},test(t){return wl(t,qj)||yo(t,Wj)},async load(t){return await(await ut.ADAPTER.fetch(t)).text()}};St.add(iE);var Yj=["normal","bold","100","200","300","400","500","600","700","800","900"],Zj=[".ttf",".otf",".woff",".woff2"],Qj=["font/ttf","font/otf","font/woff","font/woff2"],Kj=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function rE(t){let e=At.path.extname(t),s=At.path.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1)),n=s.length>0;for(let a of s)if(!a.match(Kj)){n=!1;break}let o=s.join(" ");return n||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}var sE={extension:{type:yt.LoadParser,priority:dn.Low},name:"loadWebFont",test(t){return wl(t,Qj)||yo(t,Zj)},async load(t,e){let i=ut.ADAPTER.getFontFaceSet();if(i){let r=[],s=e.data?.family??rE(t),n=e.data?.weights?.filter(a=>Yj.includes(a))??["normal"],o=e.data??{};for(let a=0;a<n.length;a++){let l=n[a],u=new FontFace(s,`url(${encodeURI(t)})`,{...o,weight:l});await u.load(),i.add(u),r.push(u)}return r.length===1?r[0]:r}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(t){(Array.isArray(t)?t:[t]).forEach(e=>ut.ADAPTER.getFontFaceSet().delete(e))}};St.add(sE);var tD=0,nE,Jj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",eX={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${Jj}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},tX={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`},oE,aE=class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{let i=URL.createObjectURL(new Blob([eX.code],{type:"application/javascript"})),r=new Worker(i);r.addEventListener("message",s=>{r.terminate(),URL.revokeObjectURL(i),e(s.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){nE===void 0&&(nE=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<nE&&(oE||(oE=URL.createObjectURL(new Blob([tX.code],{type:"application/javascript"}))),this._createdWorkers++,e=new Worker(oE),e.addEventListener("message",i=>{this.complete(i.data),this.returnWorker(i.target),this.next()})),e}returnWorker(e){this.workerPool.push(e)}complete(e){e.error!==void 0?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}async _run(e,i){await this._initWorkers();let r=new Promise((s,n)=>{this.queue.push({id:e,arguments:i,resolve:s,reject:n})});return this.next(),r}next(){if(!this.queue.length)return;let e=this.getWorker();if(!e)return;let i=this.queue.pop(),r=i.id;this.resolveHash[tD]={resolve:i.resolve,reject:i.reject},e.postMessage({data:i.arguments,uuid:tD++,id:r})}},lE=new aE;function Nc(t,e,i){let r=new qt(t);return r.baseTexture.on("dispose",()=>{delete e.promiseCache[i]}),r}var iX=[".jpeg",".jpg",".png",".webp",".avif"],rX=["image/jpeg","image/png","image/webp","image/avif"];async function cE(t){let e=await ut.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);let i=await e.blob();return await createImageBitmap(i)}var Nu={name:"loadTextures",extension:{type:yt.LoadParser,priority:dn.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(t){return wl(t,rX)||yo(t,iX)},async load(t,e,i){let r=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await lE.isImageBitmapSupported()?r=await lE.loadImageBitmap(t):r=await cE(t):r=await new Promise(n=>{r=new Image,r.crossOrigin=this.config.crossOrigin,r.src=t,r.complete?n(r):r.onload=()=>{n(r)}});let s=new li(r,{resolution:At.getResolutionOfUrl(t),...e.data});return s.resource.src=t,Nc(s,i,t)},unload(t){t.destroy(!0)}};St.add(Nu);var sX=".svg",nX="image/svg+xml",uE={extension:{type:yt.LoadParser,priority:dn.High},name:"loadSVG",test(t){return wl(t,nX)||yo(t,sX)},async testParse(t){return ic.test(t)},async parse(t,e,i){let r=new ic(t,e?.data?.resourceOptions);await r.load();let s=new li(r,{resolution:At.getResolutionOfUrl(t),...e?.data});return s.resource.src=t,Nc(s,i,t)},async load(t,e){return(await ut.ADAPTER.fetch(t)).text()},unload:Nu.unload};St.add(uE);var fg=class{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,i)=>`${e}${this._bundleIdConnector}${i}`,extractAssetIdFromBundle:(e,i)=>i.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(i=>{this._preferredOrder.push(i),i.priority||(i.priority=Object.keys(i.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{let i=e;this._defaultSearchParams=Object.keys(i).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(i[r])}`).join("&")}}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(i=>{this.addBundle(i.name,i.assets)})}addBundle(e,i){let r=[];Array.isArray(i)?i.forEach(s=>{if(typeof s.name=="string"){let n=this._createBundleAssetId(e,s.name);r.push(n),this.add([s.name,n],s.srcs,s.data)}else{let n=s.name.map(o=>this._createBundleAssetId(e,o));n.forEach(o=>{r.push(o)}),this.add([...s.name,...n],s.srcs)}}):Object.keys(i).forEach(s=>{r.push(this._createBundleAssetId(e,s)),this.add([s,this._createBundleAssetId(e,s)],i[s])}),this._bundles[e]=r}add(e,i,r){let s=Qo(e);s.forEach(o=>{this.hasKey(o)&&console.warn(`[Resolver] already has key: ${o} overwriting`)}),Array.isArray(i)||(typeof i=="string"?i=hg(i):i=[i]);let n=i.map(o=>{let a=o;if(typeof o=="string"){let l=!1;for(let u=0;u<this._parsers.length;u++){let d=this._parsers[u];if(d.test(o)){a=d.parse(o),l=!0;break}}l||(a={src:o})}return a.format||(a.format=a.src.split(".").pop()),a.alias||(a.alias=s),(this._basePath||this._rootPath)&&(a.src=At.path.toAbsolute(a.src,this._basePath,this._rootPath)),a.src=this._appendDefaultSearchParams(a.src),a.data=a.data??r,a});s.forEach(o=>{this._assetMap[o]=n})}resolveBundle(e){let i=Lu(e);e=Qo(e);let r={};return e.forEach(s=>{let n=this._bundles[s];if(n){let o=this.resolve(n),a={};for(let l in o){let u=o[l];a[this._extractAssetIdFromBundle(s,l)]=u}r[s]=a}}),i?r[e[0]]:r}resolveUrl(e){let i=this.resolve(e);if(typeof e!="string"){let r={};for(let s in i)r[s]=i[s].src;return r}return i.src}resolve(e){let i=Lu(e);e=Qo(e);let r={};return e.forEach(s=>{if(!this._resolverHash[s])if(this._assetMap[s]){let n=this._assetMap[s],o=this._getPreferredOrder(n),a=n[0];o?.priority.forEach(l=>{o.params[l].forEach(u=>{let d=n.filter(m=>m[l]?m[l]===u:!1);d.length&&(n=d)})}),this._resolverHash[s]=n[0]??a}else{let n=s;(this._basePath||this._rootPath)&&(n=At.path.toAbsolute(n,this._basePath,this._rootPath)),n=this._appendDefaultSearchParams(n),this._resolverHash[s]={src:n}}r[s]=this._resolverHash[s]}),i?r[e[0]]:r}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let i=0;i<e.length;i++){let r=e[0],s=this._preferredOrder.find(n=>n.params.format.includes(r.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;let i=/\?/.test(e)?"&":"?";return`${e}${i}${this._defaultSearchParams}`}};var pg=class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new fg,this.loader=new dg,this.cache=Z1,this._backgroundLoader=new ug(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let n=e.manifest;typeof n=="string"&&(n=await this.load(n)),this.resolver.addManifest(n)}let i=e.texturePreference?.resolution??1,r=typeof i=="number"?[i]:i,s=[];if(e.texturePreference?.format){let n=e.texturePreference?.format;s=typeof n=="string"?[n]:n;for(let o of this._detections)await o.test()||(s=await o.remove(s))}else for(let n of this._detections)await n.test()&&(s=await n.add(s));this.resolver.prefer({params:{format:s,resolution:r}}),e.preferences&&this.setPreferences(e.preferences)}add(e,i,r){this.resolver.add(e,i,r)}async load(e,i){this._initialized||await this.init();let r=Lu(e),s=Qo(e).map(a=>typeof a!="string"?(this.resolver.add(a.src,a),a.src):(this.resolver.hasKey(a)||this.resolver.add(a,a),a)),n=this.resolver.resolve(s),o=await this._mapLoadToResolve(n,i);return r?o[s[0]]:o}addBundle(e,i){this.resolver.addBundle(e,i)}async loadBundle(e,i){this._initialized||await this.init();let r=!1;typeof e=="string"&&(r=!0,e=[e]);let s=this.resolver.resolveBundle(e),n={},o=Object.keys(s),a=0,l=0,u=()=>{i?.(++a/l)},d=o.map(m=>{let g=s[m];return l+=Object.keys(g).length,this._mapLoadToResolve(g,u).then(_=>{n[m]=_})});return await Promise.all(d),r?n[e[0]]:n}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);let i=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(i))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);let i=this.resolver.resolveBundle(e);Object.values(i).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return Z1.get(e);let i={};for(let r=0;r<e.length;r++)i[r]=Z1.get(e[r]);return i}async _mapLoadToResolve(e,i){let r=Object.values(e),s=Object.keys(e);this._backgroundLoader.active=!1;let n=await this.loader.load(r,i);this._backgroundLoader.active=!0;let o={};return r.forEach((a,l)=>{let u=n[a.src],d=[a.src];a.alias&&d.push(...a.alias),o[s[l]]=u,Z1.set(d,u)}),o}async unload(e){this._initialized||await this.init();let i=Qo(e).map(s=>typeof s!="string"?s.src:s),r=this.resolver.resolve(i);await this._unloadFromResolved(r)}async unloadBundle(e){this._initialized||await this.init(),e=Qo(e);let i=this.resolver.resolveBundle(e),r=Object.keys(i).map(s=>this._unloadFromResolved(i[s]));await Promise.all(r)}async _unloadFromResolved(e){let i=Object.values(e);i.forEach(r=>{Z1.remove(r.src)}),await this.loader.unload(i)}get detections(){return this._detections}get preferWorkers(){return Nu.config.preferWorkers}set preferWorkers(e){At.deprecation("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach(i=>{i.config&&Object.keys(i.config).filter(r=>r in e).forEach(r=>{i.config[r]=e[r]})})}},Q1=new pg;St.handleByList(yt.LoadParser,Q1.loader.parsers).handleByList(yt.ResolveParser,Q1.resolver.parsers).handleByList(yt.CacheParser,Q1.cache.parsers).handleByList(yt.DetectionParser,Q1.detections);var hE={extension:yt.CacheParser,test:t=>Array.isArray(t)&&t.every(e=>e instanceof qt),getCacheableAssets:(t,e)=>{let i={};return t.forEach(r=>{e.forEach((s,n)=>{i[r+(n===0?"":n+1)]=s})}),i}};St.add(hE);var dE={extension:{type:yt.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;let t="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",e=await ut.ADAPTER.fetch(t).then(i=>i.blob());return createImageBitmap(e).then(()=>!0,()=>!1)},add:async t=>[...t,"avif"],remove:async t=>t.filter(e=>e!=="avif")};St.add(dE);var fE={extension:{type:yt.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;let t="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",e=await ut.ADAPTER.fetch(t).then(i=>i.blob());return createImageBitmap(e).then(()=>!0,()=>!1)},add:async t=>[...t,"webp"],remove:async t=>t.filter(e=>e!=="webp")};St.add(fE);var iD=["png","jpg","jpeg"],pE={extension:{type:yt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...iD],remove:async t=>t.filter(e=>!iD.includes(e))};St.add(pE);var mE={extension:yt.ResolveParser,test:Nu.test,parse:t=>({resolution:parseFloat(ut.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t})};St.add(mE);var Ko=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t))(Ko||{}),K1={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};var Ou,S2;function rD(){S2={s3tc:Ou.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Ou.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Ou.getExtension("WEBGL_compressed_texture_etc"),etc1:Ou.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Ou.getExtension("WEBGL_compressed_texture_pvrtc")||Ou.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Ou.getExtension("WEBGL_compressed_texture_atc"),astc:Ou.getExtension("WEBGL_compressed_texture_astc")}}var gE={extension:{type:yt.DetectionParser,priority:2},test:async()=>{let e=ut.ADAPTER.createCanvas().getContext("webgl");return e?(Ou=e,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async t=>{S2||rD();let e=[];for(let i in S2)S2[i]&&e.push(i);return[...e,...t]},remove:async t=>(S2||rD(),t.filter(e=>!(e in S2)))};St.add(gE);var A2=class extends ya{constructor(e,i={width:1,height:1,autoLoad:!0}){let r,s;typeof e=="string"?(r=e,s=new Uint8Array):(r=null,s=e),super(s,i),this.origin=r,this.buffer=s?new z1(s):null,this._load=null,this.loaded=!1,this.origin!==null&&i.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>(this.data=new Uint32Array(e),this.buffer=new z1(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),this)),this._load)}};var Bu=class t extends A2{constructor(e,i){super(e,i),this.format=i.format,this.levels=i.levels||1,this._width=i.width,this._height=i.height,this._extension=t._formatToExtension(this.format),(i.levelBuffers||this.buffer)&&(this._levelBuffers=i.levelBuffers||t._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,i,r){let s=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let o=0,a=this.levels;o<a;o++){let{levelID:l,levelWidth:u,levelHeight:d,levelBuffer:m}=this._levelBuffers[o];s.compressedTexImage2D(s.TEXTURE_2D,l,this.format,u,d,0,m)}return!0}onBlobLoaded(){this._levelBuffers=t._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(e>=36196)return"etc1";if(e>=35986&&e<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(e,i,r,s,n,o,a){let l=new Array(r),u=e.byteOffset,d=o,m=a,g=d+s-1&~(s-1),_=m+n-1&~(n-1),v=g*_*K1[i];for(let E=0;E<r;E++)l[E]={levelID:E,levelWidth:r>1?d:g,levelHeight:r>1?m:_,levelBuffer:new Uint8Array(e.buffer,u,v)},u+=v,d=d>>1||1,m=m>>1||1,g=d+s-1&~(s-1),_=m+n-1&~(n-1),v=g*_*K1[i];return l}};var yE=4,mg=124,oX=32,sD=20,aX=542327876,gg={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},lX={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},yg={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4};var cX=1,uX=2,hX=4,dX=64,fX=512,pX=131072,mX=827611204,gX=861165636,yX=894720068,_X=808540228,xX=4,vX={[mX]:Ko.COMPRESSED_RGBA_S3TC_DXT1_EXT,[gX]:Ko.COMPRESSED_RGBA_S3TC_DXT3_EXT,[yX]:Ko.COMPRESSED_RGBA_S3TC_DXT5_EXT},bX={70:Ko.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Ko.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Ko.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Ko.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Ko.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Ko.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Ko.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Ko.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Ko.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function _g(t){let e=new Uint32Array(t);if(e[0]!==aX)throw new Error("Invalid DDS file magic word");let r=new Uint32Array(t,0,mg/Uint32Array.BYTES_PER_ELEMENT),s=r[gg.HEIGHT],n=r[gg.WIDTH],o=r[gg.MIPMAP_COUNT],a=new Uint32Array(t,gg.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,oX/Uint32Array.BYTES_PER_ELEMENT),l=a[cX];if(l&hX){let u=a[lX.FOURCC];if(u!==_X){let M=vX[u],k=yE+mg,F=new Uint8Array(t,k);return[new Bu(F,{format:M,width:n,height:s,levels:o})]}let d=yE+mg,m=new Uint32Array(e.buffer,d,sD/Uint32Array.BYTES_PER_ELEMENT),g=m[yg.DXGI_FORMAT],_=m[yg.RESOURCE_DIMENSION],v=m[yg.MISC_FLAG],E=m[yg.ARRAY_SIZE],b=bX[g];if(b===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${g}`);if(v===xX)throw new Error("DDSParser does not support cubemap textures");if(_===6)throw new Error("DDSParser does not supported 3D texture data");let T=new Array,A=yE+mg+sD;if(E===1)T.push(new Uint8Array(t,A));else{let M=K1[b],k=0,F=n,O=s;for(let U=0;U<o;U++){let $=Math.max(1,F+3&-4),q=Math.max(1,O+3&-4),W=$*q*M;k+=W,F=F>>>1,O=O>>>1}let B=A;for(let U=0;U<E;U++)T.push(new Uint8Array(t,B,k)),B+=k}return T.map(M=>new Bu(M,{format:b,width:n,height:s,levels:o}))}throw l&dX?new Error("DDSParser does not support uncompressed texture data."):l&fX?new Error("DDSParser does not supported YUV uncompressed texture data."):l&pX?new Error("DDSParser does not support single-channel (lumninance) texture data!"):l&uX?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}var nD=[171,75,84,88,32,49,49,187,13,10,26,10],wX=67305985,sc={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},_E=64,xg={[mi.UNSIGNED_BYTE]:1,[mi.UNSIGNED_SHORT]:2,[mi.INT]:4,[mi.UNSIGNED_INT]:4,[mi.FLOAT]:4,[mi.HALF_FLOAT]:8},xE={[Bt.RGBA]:4,[Bt.RGB]:3,[Bt.RG]:2,[Bt.RED]:1,[Bt.LUMINANCE]:1,[Bt.LUMINANCE_ALPHA]:2,[Bt.ALPHA]:1},vE={[mi.UNSIGNED_SHORT_4_4_4_4]:2,[mi.UNSIGNED_SHORT_5_5_5_1]:2,[mi.UNSIGNED_SHORT_5_6_5]:2};function vg(t,e,i=!1){let r=new DataView(e);if(!EX(t,r))return null;let s=r.getUint32(sc.ENDIANNESS,!0)===wX,n=r.getUint32(sc.GL_TYPE,s),o=r.getUint32(sc.GL_FORMAT,s),a=r.getUint32(sc.GL_INTERNAL_FORMAT,s),l=r.getUint32(sc.PIXEL_WIDTH,s),u=r.getUint32(sc.PIXEL_HEIGHT,s)||1,d=r.getUint32(sc.PIXEL_DEPTH,s)||1,m=r.getUint32(sc.NUMBER_OF_ARRAY_ELEMENTS,s)||1,g=r.getUint32(sc.NUMBER_OF_FACES,s),_=r.getUint32(sc.NUMBER_OF_MIPMAP_LEVELS,s),v=r.getUint32(sc.BYTES_OF_KEY_VALUE_DATA,s);if(u===0||d!==1)throw new Error("Only 2D textures are supported");if(g!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(m!==1)throw new Error("WebGL does not support array textures");let E=4,b=4,T=l+3&-4,A=u+3&-4,M=new Array(m),k=l*u;n===0&&(k=T*A);let F;if(n!==0?xg[n]?F=xg[n]*xE[o]:F=vE[n]:F=K1[a],F===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");let O=i?SX(r,v,s):null,U=k*F,$=l,q=u,W=T,Z=A,Q=_E+v;for(let X=0;X<_;X++){let ce=r.getUint32(Q,s),de=Q+4;for(let le=0;le<m;le++){let te=M[le];te||(te=M[le]=new Array(_)),te[X]={levelID:X,levelWidth:_>1||n!==0?$:W,levelHeight:_>1||n!==0?q:Z,levelBuffer:new Uint8Array(e,de,U)},de+=U}Q+=ce+4,Q=Q%4!==0?Q+4-Q%4:Q,$=$>>1||1,q=q>>1||1,W=$+E-1&~(E-1),Z=q+b-1&~(b-1),U=W*Z*F}return n!==0?{uncompressed:M.map(X=>{let ce=X[0].levelBuffer,de=!1;return n===mi.FLOAT?ce=new Float32Array(X[0].levelBuffer.buffer,X[0].levelBuffer.byteOffset,X[0].levelBuffer.byteLength/4):n===mi.UNSIGNED_INT?(de=!0,ce=new Uint32Array(X[0].levelBuffer.buffer,X[0].levelBuffer.byteOffset,X[0].levelBuffer.byteLength/4)):n===mi.INT&&(de=!0,ce=new Int32Array(X[0].levelBuffer.buffer,X[0].levelBuffer.byteOffset,X[0].levelBuffer.byteLength/4)),{resource:new ya(ce,{width:X[0].levelWidth,height:X[0].levelHeight}),type:n,format:de?TX(o):o}}),kvData:O}:{compressed:M.map(X=>new Bu(null,{format:a,width:l,height:u,levels:_,levelBuffers:X})),kvData:O}}function EX(t,e){for(let i=0;i<nD.length;i++)if(e.getUint8(i)!==nD[i])return console.error(`${t} is not a valid *.ktx file!`),!1;return!0}function TX(t){switch(t){case Bt.RGBA:return Bt.RGBA_INTEGER;case Bt.RGB:return Bt.RGB_INTEGER;case Bt.RG:return Bt.RG_INTEGER;case Bt.RED:return Bt.RED_INTEGER;default:return t}}function SX(t,e,i){let r=new Map,s=0;for(;s<e;){let n=t.getUint32(_E+s,i),o=_E+s+4,a=3-(n+3)%4;if(n===0||n>e-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<n&&t.getUint8(o+l)!==0;l++);if(l===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}let u=new TextDecoder().decode(new Uint8Array(t.buffer,o,l)),d=new DataView(t.buffer,o+l+1,n-l-1);r.set(u,d),s+=4+n+a}return r}var bE={extension:{type:yt.LoadParser,priority:dn.High},name:"loadDDS",test(t){return yo(t,".dds")},async load(t,e,i){let s=await(await ut.ADAPTER.fetch(t)).arrayBuffer(),o=_g(s).map(a=>{let l=new li(a,{mipmap:xn.OFF,alphaMode:Ks.NO_PREMULTIPLIED_ALPHA,resolution:At.getResolutionOfUrl(t),...e.data});return Nc(l,i,t)});return o.length===1?o[0]:o},unload(t){Array.isArray(t)?t.forEach(e=>e.destroy(!0)):t.destroy(!0)}};St.add(bE);var wE={extension:{type:yt.LoadParser,priority:dn.High},name:"loadKTX",test(t){return yo(t,".ktx")},async load(t,e,i){let s=await(await ut.ADAPTER.fetch(t)).arrayBuffer(),{compressed:n,uncompressed:o,kvData:a}=vg(t,s),l=n??o,u={mipmap:xn.OFF,alphaMode:Ks.NO_PREMULTIPLIED_ALPHA,resolution:At.getResolutionOfUrl(t),...e.data},d=l.map(m=>{l===o&&Object.assign(u,{type:m.type,format:m.format});let g=new li(m,u);return g.ktxKeyValueData=a,Nc(g,i,t)});return d.length===1?d[0]:d},unload(t){Array.isArray(t)?t.forEach(e=>e.destroy(!0)):t.destroy(!0)}};St.add(wE);var EE={extension:yt.ResolveParser,test:t=>{let i=t.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(i)},parse:t=>{if(t.split("?")[0].split(".").pop()==="ktx"){let r=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(r.some(s=>t.endsWith(s)))return{resolution:parseFloat(ut.RETINA_PREFIX.exec(t)?.[1]??"1"),format:r.find(s=>t.endsWith(s)),src:t}}return{resolution:parseFloat(ut.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t}}};St.add(EE);var AX=new ei,CX=4,G5=class{constructor(t){this.renderer=t}async image(t,e,i){let r=new Image;return r.src=await this.base64(t,e,i),r}async base64(t,e,i){let r=this.canvas(t);if(r.toBlob!==void 0)return new Promise((s,n)=>{r.toBlob(o=>{if(!o){n(new Error("ICanvas.toBlob failed!"));return}let a=new FileReader;a.onload=()=>s(a.result),a.onerror=n,a.readAsDataURL(o)},e,i)});if(r.toDataURL!==void 0)return r.toDataURL(e,i);if(r.convertToBlob!==void 0){let s=await r.convertToBlob({type:e,quality:i});return new Promise((n,o)=>{let a=new FileReader;a.onload=()=>n(a.result),a.onerror=o,a.readAsDataURL(s)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){let{pixels:i,width:r,height:s,flipY:n}=this._rawPixels(t,e);n&&G5._flipY(i,r,s),G5._unpremultiplyAlpha(i);let o=new At.CanvasRenderTarget(r,s,1),a=new ImageData(new Uint8ClampedArray(i.buffer),r,s);return o.context.putImageData(a,0,0),o.canvas}pixels(t,e){let{pixels:i,width:r,height:s,flipY:n}=this._rawPixels(t,e);return n&&G5._flipY(i,r,s),G5._unpremultiplyAlpha(i),i}_rawPixels(t,e){let i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let r,s=!1,n,o=!1;if(t&&(t instanceof $a?n=t:(n=i.generateTexture(t,{resolution:i.resolution,multisample:i.multisample}),o=!0)),n){if(r=n.baseTexture.resolution,e=e??n.frame,s=!1,!o){i.renderTexture.bind(n);let m=n.framebuffer.glFramebuffers[i.CONTEXT_UID];m.blitFramebuffer&&i.framebuffer.bind(m.blitFramebuffer)}}else r=i.resolution,e||(e=AX,e.width=i.width/r,e.height=i.height/r),s=!0,i.renderTexture.bind();let a=Math.round(e.width*r),l=Math.round(e.height*r),u=new Uint8Array(CX*a*l),d=i.gl;return d.readPixels(Math.round(e.x*r),Math.round(e.y*r),a,l,d.RGBA,d.UNSIGNED_BYTE,u),o&&n?.destroy(!0),{pixels:u,width:a,height:l,flipY:s}}destroy(){this.renderer=null}static _flipY(t,e,i){let r=e<<2,s=i>>1,n=new Uint8Array(r);for(let o=0;o<s;o++){let a=o*r,l=(i-o-1)*r;n.set(t.subarray(a,a+r)),t.copyWithin(a,l,l+r),t.set(n,l)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));let e=t.length;for(let i=0;i<e;i+=4){let r=t[i+3];if(r!==0){let s=255.001/r;t[i]=t[i]*s+.5,t[i+1]=t[i+1]*s+.5,t[i+2]=t[i+2]*s+.5}}}},TE=G5;TE.extension={name:"extract",type:yt.RendererSystem};St.add(TE);var Uu={build(t){let e=t.points,i,r,s,n,o,a;if(t.type===os.CIRC){let v=t.shape;i=v.x,r=v.y,o=a=v.radius,s=n=0}else if(t.type===os.ELIP){let v=t.shape;i=v.x,r=v.y,o=v.width,a=v.height,s=n=0}else{let v=t.shape,E=v.width/2,b=v.height/2;i=v.x+E,r=v.y+b,o=a=Math.max(0,Math.min(v.radius,Math.min(E,b))),s=E-o,n=b-a}if(!(o>=0&&a>=0&&s>=0&&n>=0)){e.length=0;return}let l=Math.ceil(2.3*Math.sqrt(o+a)),u=l*8+(s?4:0)+(n?4:0);if(e.length=u,u===0)return;if(l===0){e.length=8,e[0]=e[6]=i+s,e[1]=e[3]=r+n,e[2]=e[4]=i-s,e[5]=e[7]=r-n;return}let d=0,m=l*4+(s?2:0)+2,g=m,_=u;{let v=s+o,E=n,b=i+v,T=i-v,A=r+E;if(e[d++]=b,e[d++]=A,e[--m]=A,e[--m]=T,n){let M=r-E;e[g++]=T,e[g++]=M,e[--_]=M,e[--_]=b}}for(let v=1;v<l;v++){let E=Math.PI/2*(v/l),b=s+Math.cos(E)*o,T=n+Math.sin(E)*a,A=i+b,M=i-b,k=r+T,F=r-T;e[d++]=A,e[d++]=k,e[--m]=k,e[--m]=M,e[g++]=M,e[g++]=F,e[--_]=F,e[--_]=A}{let v=s,E=n+a,b=i+v,T=i-v,A=r+E,M=r-E;e[d++]=b,e[d++]=A,e[--_]=M,e[--_]=b,s&&(e[d++]=T,e[d++]=A,e[--_]=M,e[--_]=T)}},triangulate(t,e){let i=t.points,r=e.points,s=e.indices;if(i.length===0)return;let n=r.length/2,o=n,a,l;if(t.type!==os.RREC){let d=t.shape;a=d.x,l=d.y}else{let d=t.shape;a=d.x+d.width/2,l=d.y+d.height/2}let u=t.matrix;r.push(t.matrix?u.a*a+u.c*l+u.tx:a,t.matrix?u.b*a+u.d*l+u.ty:l),n++,r.push(i[0],i[1]);for(let d=2;d<i.length;d+=2)r.push(i[d],i[d+1]),s.push(n++,o,n);s.push(o+1,o,n)}};function oD(t,e=!1){let i=t.length;if(i<6)return;let r=0;for(let s=0,n=t[i-2],o=t[i-1];s<i;s+=2){let a=t[s],l=t[s+1];r+=(a-n)*(l+o),n=a,o=l}if(!e&&r>0||e&&r<=0){let s=i/2;for(let n=s+s%2;n<i;n+=2){let o=i-n-2,a=i-n-1,l=n,u=n+1;[t[o],t[l]]=[t[l],t[o]],[t[a],t[u]]=[t[u],t[a]]}}}var Cd={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let i=t.points,r=t.holes,s=e.points,n=e.indices;if(i.length>=6){oD(i,!1);let o=[];for(let u=0;u<r.length;u++){let d=r[u];oD(d.points,!0),o.push(i.length/2),i=i.concat(d.points)}let a=At.earcut(i,o,2);if(!a)return;let l=s.length/2;for(let u=0;u<a.length;u+=3)n.push(a[u]+l),n.push(a[u+1]+l),n.push(a[u+2]+l);for(let u=0;u<i.length;u++)s.push(i[u])}}};var $5={build(t){let e=t.shape,i=e.x,r=e.y,s=e.width,n=e.height,o=t.points;o.length=0,s>=0&&n>=0&&o.push(i,r,i+s,r,i+s,r+n,i,r+n)},triangulate(t,e){let i=t.points,r=e.points;if(i.length===0)return;let s=r.length/2;r.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),e.indices.push(s,s+1,s+2,s+1,s+2,s+3)}};var H5={build(t){Uu.build(t)},triangulate(t,e){Uu.triangulate(t,e)}};var Br=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(Br||{}),Oi=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(Oi||{}),El={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let i=Math.ceil(t/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}};var J1=class{static curveTo(e,i,r,s,n,o){let a=o[o.length-2],u=o[o.length-1]-i,d=a-e,m=s-i,g=r-e,_=Math.abs(u*g-d*m);if(_<1e-8||n===0)return(o[o.length-2]!==e||o[o.length-1]!==i)&&o.push(e,i),null;let v=u*u+d*d,E=m*m+g*g,b=u*m+d*g,T=n*Math.sqrt(v)/_,A=n*Math.sqrt(E)/_,M=T*b/v,k=A*b/E,F=T*g+A*d,O=T*m+A*u,B=d*(A+M),U=u*(A+M),$=g*(T+k),q=m*(T+k),W=Math.atan2(U-O,B-F),Z=Math.atan2(q-O,$-F);return{cx:F+e,cy:O+i,radius:n,startAngle:W,endAngle:Z,anticlockwise:d*m>g*u}}static arc(e,i,r,s,n,o,a,l,u){let d=a-o,m=El._segmentsCount(Math.abs(d)*n,Math.ceil(Math.abs(d)/$1)*40),g=d/(m*2),_=g*2,v=Math.cos(g),E=Math.sin(g),b=m-1,T=b%1/b;for(let A=0;A<=b;++A){let M=A+T*A,k=g+o+_*M,F=Math.cos(k),O=-Math.sin(k);u.push((v*F+E*O)*n+r,(v*-O+E*F)*n+s)}}};var Id=class{constructor(){this.reset()}begin(e,i,r){this.reset(),this.style=e,this.start=i,this.attribStart=r}end(e,i){this.attribSize=i-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}};var kd=class t{static curveLength(e,i,r,s,n,o,a,l){let d=0,m=0,g=0,_=0,v=0,E=0,b=0,T=0,A=0,M=0,k=0,F=e,O=i;for(let B=1;B<=10;++B)m=B/10,g=m*m,_=g*m,v=1-m,E=v*v,b=E*v,T=b*e+3*E*m*r+3*v*g*n+_*a,A=b*i+3*E*m*s+3*v*g*o+_*l,M=F-T,k=O-A,F=T,O=A,d+=Math.sqrt(M*M+k*k);return d}static curveTo(e,i,r,s,n,o,a){let l=a[a.length-2],u=a[a.length-1];a.length-=2;let d=El._segmentsCount(t.curveLength(l,u,e,i,r,s,n,o)),m=0,g=0,_=0,v=0,E=0;a.push(l,u);for(let b=1,T=0;b<=d;++b)T=b/d,m=1-T,g=m*m,_=g*m,v=T*T,E=v*T,a.push(_*l+3*g*T*e+3*m*v*r+E*n,_*u+3*g*T*i+3*m*v*s+E*o)}};function aD(t,e,i,r,s,n,o,a){let l=t-i*s,u=e-r*s,d=t+i*n,m=e+r*n,g,_;o?(g=r,_=-i):(g=-r,_=i);let v=l+g,E=u+_,b=d+g,T=m+_;return a.push(v,E,b,T),2}function Md(t,e,i,r,s,n,o,a){let l=i-t,u=r-e,d=Math.atan2(l,u),m=Math.atan2(s-t,n-e);a&&d<m?d+=Math.PI*2:!a&&d>m&&(m+=Math.PI*2);let g=d,_=m-d,v=Math.abs(_),E=Math.sqrt(l*l+u*u),b=(15*v*Math.sqrt(E)/Math.PI>>0)+1,T=_/b;if(g+=T,a){o.push(t,e,i,r);for(let A=1,M=g;A<b;A++,M+=T)o.push(t,e,t+Math.sin(M)*E,e+Math.cos(M)*E);o.push(t,e,s,n)}else{o.push(i,r,t,e);for(let A=1,M=g;A<b;A++,M+=T)o.push(t+Math.sin(M)*E,e+Math.cos(M)*E,t,e);o.push(s,n,t,e)}return b*2}function IX(t,e){let i=t.shape,r=t.points||i.points.slice(),s=e.closePointEps;if(r.length===0)return;let n=t.lineStyle,o=new Jt(r[0],r[1]),a=new Jt(r[r.length-2],r[r.length-1]),l=i.type!==os.POLY||i.closeStroke,u=Math.abs(o.x-a.x)<s&&Math.abs(o.y-a.y)<s;if(l){r=r.slice(),u&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));let le=(o.x+a.x)*.5,te=(a.y+o.y)*.5;r.unshift(le,te),r.push(le,te)}let d=e.points,m=r.length/2,g=r.length,_=d.length/2,v=n.width/2,E=v*v,b=n.miterLimit*n.miterLimit,T=r[0],A=r[1],M=r[2],k=r[3],F=0,O=0,B=-(A-k),U=T-M,$=0,q=0,W=Math.sqrt(B*B+U*U);B/=W,U/=W,B*=v,U*=v;let Z=n.alignment,Q=(1-Z)*2,X=Z*2;l||(n.cap===Oi.ROUND?g+=Md(T-B*(Q-X)*.5,A-U*(Q-X)*.5,T-B*Q,A-U*Q,T+B*X,A+U*X,d,!0)+2:n.cap===Oi.SQUARE&&(g+=aD(T,A,B,U,Q,X,!0,d))),d.push(T-B*Q,A-U*Q,T+B*X,A+U*X);for(let le=1;le<m-1;++le){T=r[(le-1)*2],A=r[(le-1)*2+1],M=r[le*2],k=r[le*2+1],F=r[(le+1)*2],O=r[(le+1)*2+1],B=-(A-k),U=T-M,W=Math.sqrt(B*B+U*U),B/=W,U/=W,B*=v,U*=v,$=-(k-O),q=M-F,W=Math.sqrt($*$+q*q),$/=W,q/=W,$*=v,q*=v;let te=M-T,ee=A-k,oe=M-F,ie=O-k,ne=te*oe+ee*ie,me=ee*oe-ie*te,De=me<0;if(Math.abs(me)<.001*Math.abs(ne)){d.push(M-B*Q,k-U*Q,M+B*X,k+U*X),ne>=0&&(n.join===Br.ROUND?g+=Md(M,k,M-B*Q,k-U*Q,M-$*Q,k-q*Q,d,!1)+4:g+=2,d.push(M-$*X,k-q*X,M+$*Q,k+q*Q));continue}let He=(-B+T)*(-U+k)-(-B+M)*(-U+A),Je=(-$+F)*(-q+k)-(-$+M)*(-q+O),ot=(te*Je-oe*He)/me,gt=(ie*He-ee*Je)/me,vt=(ot-M)*(ot-M)+(gt-k)*(gt-k),ct=M+(ot-M)*Q,Se=k+(gt-k)*Q,Qe=M-(ot-M)*X,xt=k-(gt-k)*X,It=Math.min(te*te+ee*ee,oe*oe+ie*ie),Gt=De?Q:X,Ni=It+Gt*Gt*E,je=vt<=Ni,be=n.join;if(be===Br.MITER&&vt/E>b&&(be=Br.BEVEL),je)switch(be){case Br.MITER:{d.push(ct,Se,Qe,xt);break}case Br.BEVEL:{De?d.push(ct,Se,M+B*X,k+U*X,ct,Se,M+$*X,k+q*X):d.push(M-B*Q,k-U*Q,Qe,xt,M-$*Q,k-q*Q,Qe,xt),g+=2;break}case Br.ROUND:{De?(d.push(ct,Se,M+B*X,k+U*X),g+=Md(M,k,M+B*X,k+U*X,M+$*X,k+q*X,d,!0)+4,d.push(ct,Se,M+$*X,k+q*X)):(d.push(M-B*Q,k-U*Q,Qe,xt),g+=Md(M,k,M-B*Q,k-U*Q,M-$*Q,k-q*Q,d,!1)+4,d.push(M-$*Q,k-q*Q,Qe,xt));break}}else{switch(d.push(M-B*Q,k-U*Q,M+B*X,k+U*X),be){case Br.MITER:{De?d.push(Qe,xt,Qe,xt):d.push(ct,Se,ct,Se),g+=2;break}case Br.ROUND:{De?g+=Md(M,k,M+B*X,k+U*X,M+$*X,k+q*X,d,!0)+2:g+=Md(M,k,M-B*Q,k-U*Q,M-$*Q,k-q*Q,d,!1)+2;break}}d.push(M-$*Q,k-q*Q,M+$*X,k+q*X),g+=2}}T=r[(m-2)*2],A=r[(m-2)*2+1],M=r[(m-1)*2],k=r[(m-1)*2+1],B=-(A-k),U=T-M,W=Math.sqrt(B*B+U*U),B/=W,U/=W,B*=v,U*=v,d.push(M-B*Q,k-U*Q,M+B*X,k+U*X),l||(n.cap===Oi.ROUND?g+=Md(M-B*(Q-X)*.5,k-U*(Q-X)*.5,M-B*Q,k-U*Q,M+B*X,k+U*X,d,!1)+2:n.cap===Oi.SQUARE&&(g+=aD(M,k,B,U,Q,X,!1,d)));let ce=e.indices,de=El.epsilon*El.epsilon;for(let le=_;le<g+_-2;++le)T=d[le*2],A=d[le*2+1],M=d[(le+1)*2],k=d[(le+1)*2+1],F=d[(le+2)*2],O=d[(le+2)*2+1],!(Math.abs(T*(k-O)+M*(O-A)+F*(A-k))<de)&&ce.push(le,le+1,le+2)}function kX(t,e){let i=0,r=t.shape,s=t.points||r.points,n=r.type!==os.POLY||r.closeStroke;if(s.length===0)return;let o=e.points,a=e.indices,l=s.length/2,u=o.length/2,d=u;for(o.push(s[0],s[1]),i=1;i<l;i++)o.push(s[i*2],s[i*2+1]),a.push(d,d+1),d++;n&&a.push(d,u)}function C2(t,e){t.lineStyle.native?kX(t,e):IX(t,e)}var Pd=class t{static curveLength(e,i,r,s,n,o){let a=e-2*r+n,l=i-2*s+o,u=2*r-2*e,d=2*s-2*i,m=4*(a*a+l*l),g=4*(a*u+l*d),_=u*u+d*d,v=2*Math.sqrt(m+g+_),E=Math.sqrt(m),b=2*m*E,T=2*Math.sqrt(_),A=g/E;return(b*v+E*g*(v-T)+(4*_*m-g*g)*Math.log((2*E+A+v)/(A+T)))/(4*b)}static curveTo(e,i,r,s,n){let o=n[n.length-2],a=n[n.length-1],l=El._segmentsCount(t.curveLength(o,a,e,i,r,s)),u=0,d=0;for(let m=1;m<=l;++m){let g=m/l;u=o+(e-o)*g,d=a+(i-a)*g,n.push(u+(e+(r-e)*g-u)*g,d+(i+(s-i)*g-d)*g)}}};var I2={[os.POLY]:Cd,[os.CIRC]:Uu,[os.ELIP]:Uu,[os.RECT]:$5,[os.RREC]:H5},V5=[],Rd=[];var k2=class t{constructor(e,i=null,r=null,s=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=r,this.fillStyle=i,this.matrix=s,this.type=e.type}clone(){return new t(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}};var M2=new Jt,lD=class extends fd{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Dc,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Rd.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){let e=this.batches[t];e.reset(),V5.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,i=null,r=null){let s=new k2(t,e,i,r);return this.graphicsData.push(s),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;let i=new k2(t,null,null,e),r=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=r.lineStyle,r.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){let e=this.graphicsData;for(let i=0;i<e.length;++i){let r=e[i];if(r.fillStyle.visible&&r.shape&&(r.matrix?r.matrix.applyInverse(t,M2):M2.copyFrom(t),r.shape.contains(M2.x,M2.y))){let s=!1;if(r.holes){for(let n=0;n<r.holes.length;n++)if(r.holes[n].shape.contains(M2.x,M2.y)){s=!0;break}}if(!s)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;let t=this.uvs,e=this.graphicsData,i=null,r=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],r=i.style);for(let a=this.shapeIndex;a<e.length;a++){this.shapeIndex++;let l=e[a],u=l.fillStyle,d=l.lineStyle;I2[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(u.visible||d.visible)&&this.processHoles(l.holes);for(let g=0;g<2;g++){let _=g===0?u:d;if(!_.visible)continue;let v=_.texture.baseTexture,E=this.indices.length,b=this.points.length/2;v.wrapMode=ma.REPEAT,g===0?this.processFill(l):this.processLine(l);let T=this.points.length/2-b;T!==0&&(i&&!this._compareStyles(r,_)&&(i.end(E,b),i=null),i||(i=V5.pop()||new Id,i.begin(_,E,b),this.batches.push(i),r=_),this.addUvs(this.points,t,_.texture,b,T,_.matrix))}}let s=this.indices.length,n=this.points.length/2;if(i&&i.end(s,n),this.batches.length===0){this.batchable=!0;return}let o=n>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){let i=this.graphicsData[t],r=i.fillStyle,s=i.lineStyle;if(r&&!r.texture.baseTexture.valid||s&&!s.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);let t=this.batches;for(let e=0,i=t.length;e<i;e++){let r=t[e];for(let s=0;s<r.size;s++){let n=r.start+s;this.indicesUint16[n]=this.indicesUint16[n]-r.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;let t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<lD.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++li._globalBatch;for(let d=0;d<this.drawCalls.length;d++)this.drawCalls[d].texArray.clear(),Rd.push(this.drawCalls[d]);this.drawCalls.length=0;let e=this.colors,i=this.textureIds,r=Rd.pop();r||(r=new G1,r.texArray=new V1),r.texArray.count=0,r.start=0,r.size=0,r.type=pa.TRIANGLES;let s=0,n=null,o=0,a=!1,l=pa.TRIANGLES,u=0;this.drawCalls.push(r);for(let d=0;d<this.batches.length;d++){let m=this.batches[d],g=8,_=m.style,v=_.texture.baseTexture;a!==!!_.native&&(a=!!_.native,l=a?pa.LINES:pa.TRIANGLES,n=null,s=g,t++),n!==v&&(n=v,v._batchEnabled!==t&&(s===g&&(t++,s=0,r.size>0&&(r=Rd.pop(),r||(r=new G1,r.texArray=new V1),this.drawCalls.push(r)),r.start=u,r.size=0,r.texArray.count=0,r.type=l),v.touched=1,v._batchEnabled=t,v._batchLocation=s,v.wrapMode=ma.REPEAT,r.texArray.elements[r.texArray.count++]=v,s++)),r.size+=m.size,u+=m.size,o=v._batchLocation,this.addColors(e,_.color,_.alpha,m.attribSize,m.attribStart),this.addTextureIds(i,o,m.attribSize,m.attribStart)}li._globalBatch=t,this.packAttributes()}packAttributes(){let t=this.points,e=this.uvs,i=this.colors,r=this.textureIds,s=new ArrayBuffer(t.length*3*4),n=new Float32Array(s),o=new Uint32Array(s),a=0;for(let l=0;l<t.length/2;l++)n[a++]=t[l*2],n[a++]=t[l*2+1],n[a++]=e[l*2],n[a++]=e[l*2+1],o[a++]=i[l],n[a++]=r[l];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?Cd.triangulate(t,this):I2[t.type].triangulate(t,this)}processLine(t){C2(t,this);for(let e=0;e<t.holes.length;e++)C2(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){let i=t[e];I2[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){let t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let i=0;i<t.length/2;i++){let r=t[i*2],s=t[i*2+1];t[i*2]=e.a*r+e.c*s+e.tx,t[i*2+1]=e.b*r+e.d*s+e.ty}}addColors(t,e,i,r,s=0){let n=fi.shared.setValue(e).toLittleEndianNumber(),o=fi.shared.setValue(n).toPremultiplied(i);t.length=Math.max(t.length,s+r);for(let a=0;a<r;a++)t[s+a]=o}addTextureIds(t,e,i,r=0){t.length=Math.max(t.length,r+i);for(let s=0;s<i;s++)t[r+s]=e}addUvs(t,e,i,r,s,n=null){let o=0,a=e.length,l=i.frame;for(;o<s;){let d=t[(r+o)*2],m=t[(r+o)*2+1];if(n){let g=n.a*d+n.c*m+n.tx;m=n.b*d+n.d*m+n.ty,d=g}o++,e.push(d/l.width,m/l.height)}let u=i.baseTexture;(l.width<u.width||l.height<u.height)&&this.adjustUvs(e,i,a,s)}adjustUvs(t,e,i,r){let s=e.baseTexture,n=1e-6,o=i+r*2,a=e.frame,l=a.width/s.width,u=a.height/s.height,d=a.x/a.width,m=a.y/a.height,g=Math.floor(t[i]+n),_=Math.floor(t[i+1]+n);for(let v=i+2;v<o;v+=2)g=Math.min(g,Math.floor(t[v]+n)),_=Math.min(_,Math.floor(t[v+1]+n));d-=g,m-=_;for(let v=i;v<o;v+=2)t[v]=(t[v]+d)*l,t[v+1]=(t[v+1]+m)*u}},bg=lD;bg.BATCHABLE_SIZE=100;var Dd=class t{constructor(){this.color=16777215,this.alpha=1,this.texture=qt.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){let e=new t;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=qt.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}};var j5=class t extends Dd{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Oi.BUTT,this.join=Br.MITER,this.miterLimit=10}clone(){let e=new t;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}};var SE={},wg=class extends qi{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Dd,this._lineStyle=new j5,this._matrix=null,this._holeMode=!1,this.state=Kn.for2d(),this._geometry=t||new bg,this._geometry.refCount++,this._transformID=-1,this._tintColor=new fi(16777215),this.blendMode=Ii.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new wg(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,i,r=.5,s=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:i,alignment:r,native:s}),this.lineTextureStyle(t)}lineTextureStyle(t){let e={width:0,texture:qt.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Oi.BUTT,join:Br.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();let i=t.width>0&&t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:i},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){let t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Jn,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Jn,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);let i=this.currentPath.points,r=i[i.length-2],s=i[i.length-1];return(r!==t||s!==e)&&i.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,i,r){this._initCurve();let s=this.currentPath.points;return s.length===0&&this.moveTo(0,0),Pd.curveTo(t,e,i,r,s),this}bezierCurveTo(t,e,i,r,s,n){return this._initCurve(),kd.curveTo(t,e,i,r,s,n,this.currentPath.points),this}arcTo(t,e,i,r,s){this._initCurve(t,e);let n=this.currentPath.points,o=J1.curveTo(t,e,i,r,s,n);if(o){let{cx:a,cy:l,radius:u,startAngle:d,endAngle:m,anticlockwise:g}=o;this.arc(a,l,u,d,m,g)}return this}arc(t,e,i,r,s,n=!1){if(r===s)return this;if(!n&&s<=r?s+=$1:n&&r<=s&&(r+=$1),s-r===0)return this;let a=t+Math.cos(r)*i,l=e+Math.sin(r)*i,u=this._geometry.closePointEps,d=this.currentPath?this.currentPath.points:null;if(d){let m=Math.abs(d[d.length-2]-a),g=Math.abs(d[d.length-1]-l);m<u&&g<u||d.push(a,l)}else this.moveTo(a,l),d=this.currentPath.points;return J1.arc(a,l,t,e,i,r,s,n,d),this}beginFill(t=0,e){return this.beginTextureFill({texture:qt.WHITE,color:t,alpha:e})}normalizeColor(t){let e=fi.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){let e={texture:qt.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();let i=t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:i},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,i,r){return this.drawShape(new ei(t,e,i,r))}drawRoundedRect(t,e,i,r,s){return this.drawShape(new h5(t,e,i,r,s))}drawCircle(t,e,i){return this.drawShape(new H1(t,e,i))}drawEllipse(t,e,i,r){return this.drawShape(new u5(t,e,i,r))}drawPolygon(...t){let e,i=!0,r=t[0];r.points?(i=r.closeStroke,e=r.points):Array.isArray(t[0])?e=t[0]:e=t;let s=new Jn(e);return s.closeStroke=i,this.drawShape(s),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){let t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===os.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();let e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){let t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(let r=0;r<i;r++){let s=t.batches[r],n=s.style.color,o=new Float32Array(this.vertexData.buffer,s.attribStart*4*2,s.attribSize*2),a=new Float32Array(t.uvsFloat32.buffer,s.attribStart*4*2,s.attribSize*2),l=new Uint16Array(t.indicesUint16.buffer,s.start*2,s.size),u={vertexData:o,blendMode:e,indices:l,uvs:a,_batchRGB:fi.shared.setValue(n).toRgbArray(),_tintRGB:n,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[r]=u}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,i=this.batches.length;e<i;e++){let r=this.batches[e];r.worldAlpha=this.worldAlpha*r.alpha,t.plugins[this.pluginName].render(r)}}}_renderDirect(t){let e=this._resolveDirectShader(t),i=this._geometry,r=this.worldAlpha,s=e.uniforms,n=i.drawCalls;s.translationMatrix=this.transform.worldTransform,fi.shared.setValue(this._tintColor).premultiply(r).toArray(s.tint),t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(let o=0,a=n.length;o<a;o++)this._renderDrawCallDirect(t,i.drawCalls[o])}_renderDrawCallDirect(t,e){let{texArray:i,type:r,size:s,start:n}=e,o=i.count;for(let a=0;a<o;a++)t.texture.bind(i.elements[a],a);t.geometry.draw(r,s,n)}_resolveDirectShader(t){let e=this.shader,i=this.pluginName;if(!e){if(!SE[i]){let{maxTextures:r}=t.plugins[i],s=new Int32Array(r);for(let a=0;a<r;a++)s[a]=a;let n={tint:new Float32Array([1,1,1,1]),translationMatrix:new hr,default:Zo.from({uSamplers:s},!0)},o=t.plugins[i]._shader.program;SE[i]=new eo(o,n)}e=SE[i]}return e}_calculateBounds(){this.finishPoly();let t=this._geometry;if(!t.graphicsData.length)return;let{minX:e,minY:i,maxX:r,maxY:s}=t.bounds;this._bounds.addFrame(this.transform,e,i,r,s)}containsPoint(t){return this.worldTransform.applyInverse(t,wg._TEMP_POINT),this._geometry.containsPoint(wg._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){let e=this.batches[t];e._tintRGB=fi.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){let t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;let e=this.transform.worldTransform,i=e.a,r=e.b,s=e.c,n=e.d,o=e.tx,a=e.ty,l=this._geometry.points,u=this.vertexData,d=0;for(let m=0;m<l.length;m+=2){let g=l[m],_=l[m+1];u[d++]=i*g+s*_+o,u[d++]=n*_+r*g+a}}closePath(){let t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}},Gi=wg;Gi.curves=El;Gi._TEMP_POINT=new Jt;var cD={buildPoly:Cd,buildCircle:Uu,buildRectangle:$5,buildRoundedRectangle:H5,buildLine:C2,ArcUtils:J1,BezierUtils:kd,QuadraticUtils:Pd,BatchPart:Id,FILL_COMMANDS:I2,BATCH_POOL:V5,DRAW_CALL_POOL:Rd};var X5=class{constructor(e,i){this.uvBuffer=e,this.uvMatrix=i,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;let i=this.uvBuffer.data;(!this.data||this.data.length!==i.length)&&(this.data=new Float32Array(i.length)),this.uvMatrix.multiplyUvs(i,this.data),this._updateID++}};var AE=new Jt,uD=new Jn,hD=class extends qi{constructor(t,e,i,r=pa.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=i||Kn.for2d(),this.drawMode=r,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=ut.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){let e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===pa.TRIANGLES&&e.length<hD.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){let e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){let e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;let r=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[r]),t.plugins[r].render(this)}calculateVertices(){let e=this.geometry.buffers[0],i=e.data,r=e._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==i.length&&(this.vertexData=new Float32Array(i.length));let s=this.transform.worldTransform,n=s.a,o=s.b,a=s.c,l=s.d,u=s.tx,d=s.ty,m=this.vertexData;for(let g=0;g<m.length/2;g++){let _=i[g*2],v=i[g*2+1];m[g*2]=n*_+a*v+u,m[g*2+1]=o*_+l*v+d}if(this._roundPixels){let g=ut.RESOLUTION;for(let _=0;_<m.length;++_)m[_]=Math.round(m[_]*g)/g}this.vertexDirty=r}calculateUvs(){let t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new X5(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,AE);let e=this.geometry.getBuffer("aVertexPosition").data,i=uD.points,r=this.geometry.getIndex().data,s=r.length,n=this.drawMode===4?3:1;for(let o=0;o+2<s;o+=n){let a=r[o]*2,l=r[o+1]*2,u=r[o+2]*2;if(i[0]=e[a],i[1]=e[a+1],i[2]=e[l],i[3]=e[l+1],i[4]=e[u],i[5]=e[u+1],uD.contains(AE.x,AE.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}},nc=hD;nc.BATCHABLE_SIZE=100;var zu=class extends qo{constructor(e,i,r){super();let s=new Kr(e),n=new Kr(i,!0),o=new Kr(r,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,mi.FLOAT).addAttribute("aTextureCoord",n,2,!1,mi.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}};var dD=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`;var fD=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;var Tl=class extends eo{constructor(e,i){let r={uSampler:e,alpha:1,uTextureMatrix:hr.IDENTITY,uColor:new Float32Array([1,1,1,1])};i=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},i),i.uniforms&&Object.assign(r,i.uniforms),super(i.program||Vn.from(fD,dD),r),this._colorDirty=!1,this.uvMatrix=new q1(e),this.batchable=i.program===void 0,this.pluginName=i.pluginName,this._tintColor=new fi(i.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=i.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this.tint&&(this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;let i=this.texture.baseTexture.alphaMode;fi.shared.setValue(this._tintColor).premultiply(this._alpha,i).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}};var W5=class extends zu{constructor(e=200,i,r=0){super(new Float32Array(i.length*4),new Float32Array(i.length*4),new Uint16Array((i.length-1)*6)),this.points=i,this._width=e,this.textureScale=r,this.build()}get width(){return this._width}build(){let e=this.points;if(!e)return;let i=this.getBuffer("aVertexPosition"),r=this.getBuffer("aTextureCoord"),s=this.getIndex();if(e.length<1)return;i.data.length/4!==e.length&&(i.data=new Float32Array(e.length*4),r.data=new Float32Array(e.length*4),s.data=new Uint16Array((e.length-1)*6));let n=r.data,o=s.data;n[0]=0,n[1]=0,n[2]=0,n[3]=1;let a=0,l=e[0],u=this._width*this.textureScale,d=e.length;for(let g=0;g<d;g++){let _=g*4;if(this.textureScale>0){let v=l.x-e[g].x,E=l.y-e[g].y,b=Math.sqrt(v*v+E*E);l=e[g],a+=b/u}else a=g/(d-1);n[_]=a,n[_+1]=0,n[_+2]=a,n[_+3]=1}let m=0;for(let g=0;g<d-1;g++){let _=g*2;o[m++]=_,o[m++]=_+1,o[m++]=_+2,o[m++]=_+2,o[m++]=_+1,o[m++]=_+3}r.update(),s.update(),this.updateVertices()}updateVertices(){let e=this.points;if(e.length<1)return;let i=e[0],r,s=0,n=0,o=this.buffers[0].data,a=e.length,l=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let u=0;u<a;u++){let d=e[u],m=u*4;u<e.length-1?r=e[u+1]:r=d,n=-(r.x-i.x),s=r.y-i.y;let g=(1-u/(a-1))*10;g>1&&(g=1);let _=Math.sqrt(s*s+n*n);_<1e-6?(s=0,n=0):(s/=_,n/=_,s*=l,n*=l),o[m]=d.x+s,o[m+1]=d.y+n,o[m+2]=d.x-s,o[m+3]=d.y-n,i=d}this.buffers[0].update()}update(){this.textureScale>0?this.build():this.updateVertices()}};var q5=class extends nc{constructor(e,i,r=0){let s=new W5(e.height,i,r),n=new Tl(e);r>0&&(e.baseTexture.wrapMode=ma.REPEAT),super(s,n),this.autoUpdate=!0}_render(e){let i=this.geometry;(this.autoUpdate||i._width!==this.shader.texture.height)&&(i._width=this.shader.texture.height,i.update()),super._render(e)}};var Y5=class extends qi{constructor(e=1500,i,r=16384,s=!1){super();let n=16384;r>n&&(r=n),this._properties=[!1,!0,!1,!1,!1],this._maxSize=e,this._batchSize=r,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=Ii.NORMAL,this.autoResize=s,this.roundPixels=!0,this.baseTexture=null,this.setProperties(i),this._tintColor=new fi(0),this.tintRgb=new Float32Array(3),this.tint=16777215}setProperties(e){e&&(this._properties[0]="vertices"in e||"scale"in e?!!e.vertices||!!e.scale:this._properties[0],this._properties[1]="position"in e?!!e.position:this._properties[1],this._properties[2]="rotation"in e?!!e.rotation:this._properties[2],this._properties[3]="uvs"in e?!!e.uvs:this._properties[3],this._properties[4]="tint"in e||"alpha"in e?!!e.tint||!!e.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintColor.toRgbArray(this.tintRgb)}render(e){!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",()=>this.onChildrenChange(0))),e.batch.setObjectRenderer(e.plugins.particle),e.plugins.particle.render(this))}onChildrenChange(e){let i=Math.floor(e/this._batchSize);for(;this._bufferUpdateIDs.length<i;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[i]=++this._updateID}dispose(){if(this._buffers){for(let e=0;e<this._buffers.length;++e)this._buffers[e].destroy();this._buffers=null}}destroy(e){super.destroy(e),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}};var Z5=class{constructor(e,i,r){this.geometry=new qo,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<e.length;++s){let n=e[s];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||mi.FLOAT,offset:n.offset},i[s]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){let e=this.geometry,i=0;this.indexBuffer=new Kr(At.createIndicesForQuads(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){let a=this.dynamicProperties[o];a.offset=i,i+=a.size,this.dynamicStride+=a.size}let r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new Kr(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){let a=this.staticProperties[o];a.offset=s,s+=a.size,this.staticStride+=a.size}let n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new Kr(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){let a=this.dynamicProperties[o];e.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===mi.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let o=0;o<this.staticProperties.length;++o){let a=this.staticProperties[o];e.addAttribute(a.attributeName,this.staticBuffer,0,a.type===mi.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(e,i,r){for(let s=0;s<this.dynamicProperties.length;s++){let n=this.dynamicProperties[s];n.uploadFunction(e,i,r,n.type===mi.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,i,r){for(let s=0;s<this.staticProperties.length;s++){let n=this.staticProperties[s];n.uploadFunction(e,i,r,n.type===mi.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}};var pD=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`;var mD=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;var Q5=class extends ec{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new hr,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:mi.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=eo.from(mD,pD,{}),this.state=Kn.for2d()}render(e){let i=e.children,r=e._maxSize,s=e._batchSize,n=this.renderer,o=i.length;if(o===0)return;o>r&&!e.autoResize&&(o=r);let a=e._buffers;a||(a=e._buffers=this.generateBuffers(e));let l=i[0]._texture.baseTexture,u=l.alphaMode>0;this.state.blendMode=At.correctBlendMode(e.blendMode,u),n.state.set(this.state);let d=n.gl,m=e.worldTransform.copyTo(this.tempMatrix);m.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=m.toArray(!0),this.shader.uniforms.uColor=fi.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,u).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let g=!1;for(let _=0,v=0;_<o;_+=s,v+=1){let E=o-_;E>s&&(E=s),v>=a.length&&a.push(this._generateOneMoreBuffer(e));let b=a[v];b.uploadDynamic(i,_,E);let T=e._bufferUpdateIDs[v]||0;g=g||b._updateID<T,g&&(b._updateID=e._updateID,b.uploadStatic(i,_,E)),n.geometry.bind(b.geometry),d.drawElements(d.TRIANGLES,E*6,d.UNSIGNED_SHORT,0)}}generateBuffers(e){let i=[],r=e._maxSize,s=e._batchSize,n=e._properties;for(let o=0;o<r;o+=s)i.push(new Z5(this.properties,n,s));return i}_generateOneMoreBuffer(e){let i=e._batchSize,r=e._properties;return new Z5(this.properties,r,i)}uploadVertices(e,i,r,s,n,o){let a=0,l=0,u=0,d=0;for(let m=0;m<r;++m){let g=e[i+m],_=g._texture,v=g.scale.x,E=g.scale.y,b=_.trim,T=_.orig;b?(l=b.x-g.anchor.x*T.width,a=l+b.width,d=b.y-g.anchor.y*T.height,u=d+b.height):(a=T.width*(1-g.anchor.x),l=T.width*-g.anchor.x,u=T.height*(1-g.anchor.y),d=T.height*-g.anchor.y),s[o]=l*v,s[o+1]=d*E,s[o+n]=a*v,s[o+n+1]=d*E,s[o+n*2]=a*v,s[o+n*2+1]=u*E,s[o+n*3]=l*v,s[o+n*3+1]=u*E,o+=n*4}}uploadPosition(e,i,r,s,n,o){for(let a=0;a<r;a++){let l=e[i+a].position;s[o]=l.x,s[o+1]=l.y,s[o+n]=l.x,s[o+n+1]=l.y,s[o+n*2]=l.x,s[o+n*2+1]=l.y,s[o+n*3]=l.x,s[o+n*3+1]=l.y,o+=n*4}}uploadRotation(e,i,r,s,n,o){for(let a=0;a<r;a++){let l=e[i+a].rotation;s[o]=l,s[o+n]=l,s[o+n*2]=l,s[o+n*3]=l,o+=n*4}}uploadUvs(e,i,r,s,n,o){for(let a=0;a<r;++a){let l=e[i+a]._texture._uvs;l?(s[o]=l.x0,s[o+1]=l.y0,s[o+n]=l.x1,s[o+n+1]=l.y1,s[o+n*2]=l.x2,s[o+n*2+1]=l.y2,s[o+n*3]=l.x3,s[o+n*3+1]=l.y3,o+=n*4):(s[o]=0,s[o+1]=0,s[o+n]=0,s[o+n+1]=0,s[o+n*2]=0,s[o+n*2+1]=0,s[o+n*3]=0,s[o+n*3+1]=0,o+=n*4)}}uploadTint(e,i,r,s,n,o){for(let a=0;a<r;++a){let l=e[i+a],u=fi.shared.setValue(l._tintRGB).toPremultiplied(l.alpha,l.texture.baseTexture.alphaMode>0);s[o]=u,s[o+n]=u,s[o+n*2]=u,s[o+n*3]=u,o+=n*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}};Q5.extension={name:"particle",type:yt.RendererPlugin};St.add(Q5);var eh=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(eh||{});var Eg={willReadFrequently:!0},Si=class{static get experimentalLetterSpacingSupported(){let t=Si._experimentalLetterSpacingSupported;if(t!==void 0){let e=ut.ADAPTER.getCanvasRenderingContext2D().prototype;t=Si._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,r,s,n,o,a,l){this.text=t,this.style=e,this.width=i,this.height=r,this.lines=s,this.lineWidths=n,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=l}static measureText(t,e,i,r=Si._canvas){i=i??e.wordWrap;let s=e.toFontString(),n=Si.measureFont(s);n.fontSize===0&&(n.fontSize=e.fontSize,n.ascent=e.fontSize);let o=r.getContext("2d",Eg);o.font=s;let l=(i?Si.wordWrap(t,e,r):t).split(/(?:\r\n|\r|\n)/),u=new Array(l.length),d=0;for(let v=0;v<l.length;v++){let E=Si._measureText(l[v],e.letterSpacing,o);u[v]=E,d=Math.max(d,E)}let m=d+e.strokeThickness;e.dropShadow&&(m+=e.dropShadowDistance);let g=e.lineHeight||n.fontSize+e.strokeThickness,_=Math.max(g,n.fontSize+e.strokeThickness*2)+(l.length-1)*(g+e.leading);return e.dropShadow&&(_+=e.dropShadowDistance),new Si(t,e,m,_,l,u,g+e.leading,d,n)}static _measureText(t,e,i){let r=!1;Si.experimentalLetterSpacingSupported&&(Si.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,r=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let s=i.measureText(t).width;return s>0&&(r?s-=e:s+=(Si.graphemeSegmenter(t).length-1)*e),s}static wordWrap(t,e,i=Si._canvas){let r=i.getContext("2d",Eg),s=0,n="",o="",a=Object.create(null),{letterSpacing:l,whiteSpace:u}=e,d=Si.collapseSpaces(u),m=Si.collapseNewlines(u),g=!d,_=e.wordWrapWidth+l,v=Si.tokenize(t);for(let E=0;E<v.length;E++){let b=v[E];if(Si.isNewline(b)){if(!m){o+=Si.addLine(n),g=!d,n="",s=0;continue}b=" "}if(d){let A=Si.isBreakingSpace(b),M=Si.isBreakingSpace(n[n.length-1]);if(A&&M)continue}let T=Si.getFromCache(b,l,a,r);if(T>_)if(n!==""&&(o+=Si.addLine(n),n="",s=0),Si.canBreakWords(b,e.breakWords)){let A=Si.wordWrapSplit(b);for(let M=0;M<A.length;M++){let k=A[M],F=k,O=1;for(;A[M+O];){let U=A[M+O];if(!Si.canBreakChars(F,U,b,M,e.breakWords))k+=U;else break;F=U,O++}M+=O-1;let B=Si.getFromCache(k,l,a,r);B+s>_&&(o+=Si.addLine(n),g=!1,n="",s=0),n+=k,s+=B}}else{n.length>0&&(o+=Si.addLine(n),n="",s=0);let A=E===v.length-1;o+=Si.addLine(b,!A),g=!1,n="",s=0}else T+s>_&&(g=!1,o+=Si.addLine(n),n="",s=0),(n.length>0||!Si.isBreakingSpace(b)||g)&&(n+=b,s+=T)}return o+=Si.addLine(n,!1),o}static addLine(t,e=!0){return t=Si.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,i,r){let s=i[t];return typeof s!="number"&&(s=Si._measureText(t,e,r)+e,i[t]=s),s}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){let i=t[e];if(!Si.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:Si._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:Si._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){let e=[],i="";if(typeof t!="string")return e;for(let r=0;r<t.length;r++){let s=t[r],n=t[r+1];if(Si.isBreakingSpace(s,n)||Si.isNewline(s)){i!==""&&(e.push(i),i=""),e.push(s);continue}i+=s}return i!==""&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,r,s){return!0}static wordWrapSplit(t){return Si.graphemeSegmenter(t)}static measureFont(t){if(Si._fonts[t])return Si._fonts[t];let e={ascent:0,descent:0,fontSize:0},i=Si._canvas,r=Si._context;r.font=t;let s=Si.METRICS_STRING+Si.BASELINE_SYMBOL,n=Math.ceil(r.measureText(s).width),o=Math.ceil(r.measureText(Si.BASELINE_SYMBOL).width),a=Math.ceil(Si.HEIGHT_MULTIPLIER*o);if(o=o*Si.BASELINE_MULTIPLIER|0,n===0||a===0)return Si._fonts[t]=e,e;i.width=n,i.height=a,r.fillStyle="#f00",r.fillRect(0,0,n,a),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(s,0,o);let l=r.getImageData(0,0,n,a).data,u=l.length,d=n*4,m=0,g=0,_=!1;for(m=0;m<o;++m){for(let v=0;v<d;v+=4)if(l[g+v]!==255){_=!0;break}if(!_)g+=d;else break}for(e.ascent=o-m,g=u-d,_=!1,m=a;m>o;--m){for(let v=0;v<d;v+=4)if(l[g+v]!==255){_=!0;break}if(!_)g-=d;else break}return e.descent=m-o,e.fontSize=e.ascent+e.descent,Si._fonts[t]=e,e}static clearMetrics(t=""){t?delete Si._fonts[t]:Si._fonts={}}static get _canvas(){if(!Si.__canvas){let t;try{let e=new OffscreenCanvas(0,0);if(e.getContext("2d",Eg)?.measureText)return Si.__canvas=e,e;t=ut.ADAPTER.createCanvas()}catch{t=ut.ADAPTER.createCanvas()}t.width=t.height=10,Si.__canvas=t}return Si.__canvas}static get _context(){return Si.__context||(Si.__context=Si._canvas.getContext("2d",Eg)),Si.__context}},fn=Si;fn.METRICS_STRING="|\xC9q\xC5";fn.BASELINE_SYMBOL="M";fn.BASELINE_MULTIPLIER=1.4;fn.HEIGHT_MULTIPLIER=2;fn.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){let t=new Intl.Segmenter;return e=>[...t.segment(e)].map(i=>i.segment)}return t=>[...t]})();fn.experimentalLetterSpacing=!1;fn._fonts={};fn._newlines=[10,13];fn._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var RX=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],K5=class{constructor(t){this.styleID=0,this.reset(),IE(this,t,t)}clone(){let t={};return IE(t,this,K5.defaultStyle),new K5(t)}reset(){IE(this,K5.defaultStyle,K5.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){let e=CE(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){let e=CE(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){DX(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){let e=CE(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){let t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let r=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&!RX.includes(r)&&(r=`"${r}"`),e[i]=r}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}},kn=K5;kn.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:eh.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};function CE(t){let e=fi.shared;return Array.isArray(t)?t.map(i=>e.setValue(i).toHex()):e.setValue(t).toHex()}function DX(t,e){if(!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}function IE(t,e,i){for(let r in i)Array.isArray(e[r])?t[r]=e[r].slice():t[r]=e[r]}var FX={texture:!0,children:!1,baseTexture:!0},kE=class extends Jr{constructor(t,e,i){let r=!1;i||(i=ut.ADAPTER.createCanvas(),r=!0),i.width=3,i.height=3;let s=qt.from(i);s.orig=new ei,s.trim=new ei,super(s),this._ownCanvas=r,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=kE.defaultResolution??ut.RESOLUTION,this._autoResolution=kE.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return fn.experimentalLetterSpacing}static set experimentalLetterSpacing(t){At.deprecation("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),fn.experimentalLetterSpacing=t}updateText(t){let e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();let i=this.context,r=fn.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=r.width,n=r.height,o=r.lines,a=r.lineHeight,l=r.lineWidths,u=r.maxLineWidth,d=r.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,s)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,n)+e.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;let m,g,_=e.dropShadow?2:1;for(let v=0;v<_;++v){let E=e.dropShadow&&v===0,b=E?Math.ceil(Math.max(1,n)+e.padding*2):0,T=b*this._resolution;if(E){i.fillStyle="black",i.strokeStyle="black";let M=e.dropShadowColor,k=e.dropShadowBlur*this._resolution,F=e.dropShadowDistance*this._resolution;i.shadowColor=fi.shared.setValue(M).setAlpha(e.dropShadowAlpha).toRgbaString(),i.shadowBlur=k,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*F,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*F+T}else i.fillStyle=this._generateFillStyle(e,o,r),i.strokeStyle=e.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let A=(a-d.fontSize)/2;a-d.fontSize<0&&(A=0);for(let M=0;M<o.length;M++)m=e.strokeThickness/2,g=e.strokeThickness/2+M*a+d.ascent+A,e.align==="right"?m+=u-l[M]:e.align==="center"&&(m+=(u-l[M])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[M],m+e.padding,g+e.padding-b,!0),e.fill&&this.drawLetterSpacing(o[M],m+e.padding,g+e.padding-b)}this.updateTexture()}drawLetterSpacing(t,e,i,r=!1){let n=this._style.letterSpacing,o=!1;if(fn.experimentalLetterSpacingSupported&&(fn.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),n===0||o){r?this.context.strokeText(t,e,i):this.context.fillText(t,e,i);return}let a=e,l=fn.graphemeSegmenter(t),u=this.context.measureText(t).width,d=0;for(let m=0;m<l.length;++m){let g=l[m];r?this.context.strokeText(g,a,i):this.context.fillText(g,a,i);let _="";for(let v=m+1;v<l.length;++v)_+=l[v];d=this.context.measureText(_).width,a+=u-d+n,u=d}}updateTexture(){let t=this.canvas;if(this._style.trim){let n=At.trimCanvas(t);n.data&&(t.width=n.width,t.height=n.height,this.context.putImageData(n.data,0,0))}let e=this._texture,i=this._style,r=i.trim?0:i.padding,s=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-r,e.trim.y=-r,e.orig.width=e._frame.width-r*2,e.orig.height=e._frame.height-r*2,this._onTextureUpdate(),s.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,i){let r=t.fill;if(Array.isArray(r)){if(r.length===1)return r[0]}else return r;let s,n=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,a=this.canvas.width/this._resolution-n-o*2,l=this.canvas.height/this._resolution-n-o*2,u=r.slice(),d=t.fillGradientStops.slice();if(!d.length){let m=u.length+1;for(let g=1;g<m;++g)d.push(g/m)}if(u.unshift(r[0]),d.unshift(0),u.push(r[r.length-1]),d.push(1),t.fillGradientType===eh.LINEAR_VERTICAL){s=this.context.createLinearGradient(a/2,o,a/2,l+o);let m=i.fontProperties.fontSize+t.strokeThickness;for(let g=0;g<e.length;g++){let _=i.lineHeight*(g-1)+m,v=i.lineHeight*g,E=v;g>0&&_>v&&(E=(v+_)/2);let b=v+m,T=i.lineHeight*(g+1),A=b;g+1<e.length&&T<b&&(A=(b+T)/2);let M=(A-E)/l;for(let k=0;k<u.length;k++){let F=0;typeof d[k]=="number"?F=d[k]:F=k/u.length;let O=Math.min(1,Math.max(0,E/l+F*M));O=Number(O.toFixed(5)),s.addColorStop(O,u[k])}}}else{s=this.context.createLinearGradient(o,l/2,a+o,l/2);let m=u.length+1,g=1;for(let _=0;_<u.length;_++){let v;typeof d[_]=="number"?v=d[_]:v=g/m,s.addColorStop(v,u[_]),g++}}return s}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},FX,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);let e=At.sign(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);let e=At.sign(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof kn?this._style=t:this._style=new kn(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}},Fd=kE;Fd.defaultAutoResolution=!0;var J5=class{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}};function LX(t,e){let i=!1;if(t?._textures?.length){for(let r=0;r<t._textures.length;r++)if(t._textures[r]instanceof qt){let s=t._textures[r].baseTexture;e.includes(s)||(e.push(s),i=!0)}}return i}function NX(t,e){if(t.baseTexture instanceof li){let i=t.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function OX(t,e){if(t._texture&&t._texture instanceof qt){let i=t._texture.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function BX(t,e){return e instanceof Fd?(e.updateText(!0),!0):!1}function UX(t,e){if(e instanceof kn){let i=e.toFontString();return fn.measureFont(i),!0}return!1}function zX(t,e){if(t instanceof Fd){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);let i=t._texture.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function GX(t,e){return t instanceof kn?(e.includes(t)||e.push(t),!0):!1}var gD=class{constructor(t){this.limiter=new J5(gD.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(zX),this.registerFindHook(GX),this.registerFindHook(LX),this.registerFindHook(NX),this.registerFindHook(OX),this.registerUploadHook(BX),this.registerUploadHook(UX)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Us.system.addOnce(this.tick,this,Ha.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){let t=this.queue[0],e=!1;if(t&&!t._destroyed){for(let i=0,r=this.uploadHooks.length;i<r;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)Us.system.addOnce(this.tick,this,Ha.UTILITY);else{this.ticking=!1;let t=this.completes.slice(0);this.completes.length=0;for(let e=0,i=t.length;e<i;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof qi)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Us.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}},Ld=gD;Ld.uploadsPerFrame=4;Object.defineProperties(ut,{UPLOADS_PER_FRAME:{get(){return Ld.uploadsPerFrame},set(t){At.deprecation("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Ld.uploadsPerFrame=t}}});function yD(t,e){return e instanceof li?(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0):!1}function $X(t,e){if(!(e instanceof Gi))return!1;let{geometry:i}=e;e.finishPoly(),i.updateBatches();let{batches:r}=i;for(let s=0;s<r.length;s++){let{texture:n}=r[s].style;n&&yD(t,n.baseTexture)}return i.batchable||t.geometry.bind(i,e._resolveDirectShader(t)),!0}function HX(t,e){return t instanceof Gi?(e.push(t),!0):!1}var em=class extends Ld{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(HX),this.registerUploadHook(yD),this.registerUploadHook($X)}};em.extension={name:"prepare",type:yt.RendererSystem};St.add(em);var jve=new Jt;var _D=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`;var xD=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`;var vD=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`;var ME=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`;var bD=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;var Tg=new hr,tm=class extends ec{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new xd,this.state=Kn.for2d()}contextChange(){let e=this.renderer,i={globals:e.globalUniforms};this.simpleShader=eo.from(ME,bD,i),this.shader=e.context.webGLVersion>1?eo.from(xD,_D,i):eo.from(ME,vD,i)}render(e){let i=this.renderer,r=this.quad,s=r.vertices;s[0]=s[6]=e._width*-e.anchor.x,s[1]=s[3]=e._height*-e.anchor.y,s[2]=s[4]=e._width*(1-e.anchor.x),s[5]=s[7]=e._height*(1-e.anchor.y);let n=e.uvRespectAnchor?e.anchor.x:0,o=e.uvRespectAnchor?e.anchor.y:0;s=r.uvs,s[0]=s[6]=-n,s[1]=s[3]=-o,s[2]=s[4]=1-n,s[5]=s[7]=1-o,r.invalidate();let a=e._texture,l=a.baseTexture,u=l.alphaMode>0,d=e.tileTransform.localTransform,m=e.uvMatrix,g=l.isPowerOfTwo&&a.frame.width===l.width&&a.frame.height===l.height;g&&(l._glTextures[i.CONTEXT_UID]?g=l.wrapMode!==ma.CLAMP:l.wrapMode===ma.CLAMP&&(l.wrapMode=ma.REPEAT));let _=g?this.simpleShader:this.shader,v=a.width,E=a.height,b=e._width,T=e._height;Tg.set(d.a*v/b,d.b*v/T,d.c*E/b,d.d*E/T,d.tx/b,d.ty/T),Tg.invert(),g?Tg.prepend(m.mapCoord):(_.uniforms.uMapCoord=m.mapCoord.toArray(!0),_.uniforms.uClampFrame=m.uClampFrame,_.uniforms.uClampOffset=m.uClampOffset),_.uniforms.uTransform=Tg.toArray(!0),_.uniforms.uColor=fi.shared.setValue(e.tint).premultiply(e.worldAlpha,u).toArray(_.uniforms.uColor),_.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),_.uniforms.uSampler=a,i.shader.bind(_),i.geometry.bind(r),this.state.blendMode=At.correctBlendMode(e.blendMode,u),i.state.set(this.state),i.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}};tm.extension={name:"tilingSprite",type:yt.RendererPlugin};St.add(tm);var im=class{constructor(t,e,i=null){this.linkedSheets=[],this._texture=t instanceof qt?t:null,this.baseTexture=t instanceof li?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;let r=this.baseTexture.resource;this.resolution=this._updateResolution(i||(r?r.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){let{scale:e}=this.data.meta,i=At.getResolutionOfUrl(t,null);return i===null&&(i=parseFloat(e??"1")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=im.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t,i=im.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){let r=this._frameKeys[e],s=this._frames[r],n=s.frame;if(n){let o=null,a=null,l=s.trimmed!==!1&&s.sourceSize?s.sourceSize:s.frame,u=new ei(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);s.rotated?o=new ei(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):o=new ei(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),s.trimmed!==!1&&s.spriteSourceSize&&(a=new ei(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[r]=new qt(this.baseTexture,o,u,a,s.rotated?2:0,s.anchor,s.borders),qt.addToCache(this.textures[r],r)}e++}}_processAnimations(){let t=this.data.animations||{};for(let e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){let r=t[e][i];this.animations[e].push(this.textures[r])}}}_parseComplete(){let t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*im.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*im.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){for(let e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}},rm=im;rm.BATCH_SIZE=1e3;var VX=["jpg","png","jpeg","avif","webp"];function wD(t,e,i){let r={};if(t.forEach(s=>{r[s]=e}),Object.keys(e.textures).forEach(s=>{r[s]=e.textures[s]}),!i){let s=At.path.dirname(t[0]);e.linkedSheets.forEach((n,o)=>{let a=wD([`${s}/${e.data.meta.related_multi_packs[o]}`],n,!0);Object.assign(r,a)})}return r}var ED={extension:yt.Asset,cache:{test:t=>t instanceof rm,getCacheableAssets:(t,e)=>wD(t,e,!1)},resolver:{test:t=>{let i=t.split("?")[0].split("."),r=i.pop(),s=i.pop();return r==="json"&&VX.includes(s)},parse:t=>{let e=t.split(".");return{resolution:parseFloat(ut.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e[e.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:yt.LoadParser,priority:dn.Normal},async testParse(t,e){return At.path.extname(e.src).toLowerCase()===".json"&&!!t.frames},async parse(t,e,i){let r=At.path.dirname(e.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");let s=r+t.meta.image;s=Ad(s,e.src);let o=(await i.load([s]))[s],a=new rm(o.baseTexture,t,e.src);await a.parse();let l=t?.meta?.related_multi_packs;if(Array.isArray(l)){let u=[];for(let m of l){if(typeof m!="string")continue;let g=r+m;e.data?.ignoreMultiPack||(g=Ad(g,e.src),u.push(i.load({src:g,data:{ignoreMultiPack:!0}})))}let d=await Promise.all(u);a.linkedSheets=d,d.forEach(m=>{m.linkedSheets=[a].concat(a.linkedSheets.filter(g=>g!==m))})}return a},unload(t){t.destroy(!0)}}};St.add(ED);var Oc=class{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}};var Bc=class{static test(e){return typeof e=="string"&&e.startsWith("info face=")}static parse(e){let i=e.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(let n in i){let o=i[n].match(/^[a-z]+/gm)[0],a=i[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(let u in a){let d=a[u].split("="),m=d[0],g=d[1].replace(/"/gm,""),_=parseFloat(g),v=isNaN(_)?g:_;l[m]=v}r[o].push(l)}let s=new Oc;return r.info.forEach(n=>s.info.push({face:n.face,size:parseInt(n.size,10)})),r.common.forEach(n=>s.common.push({lineHeight:parseInt(n.lineHeight,10)})),r.page.forEach(n=>s.page.push({id:parseInt(n.id,10),file:n.file})),r.char.forEach(n=>s.char.push({id:parseInt(n.id,10),page:parseInt(n.page,10),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10),xoffset:parseInt(n.xoffset,10),yoffset:parseInt(n.yoffset,10),xadvance:parseInt(n.xadvance,10)})),r.kerning.forEach(n=>s.kerning.push({first:parseInt(n.first,10),second:parseInt(n.second,10),amount:parseInt(n.amount,10)})),r.distanceField.forEach(n=>s.distanceField.push({distanceRange:parseInt(n.distanceRange,10),fieldType:n.fieldType})),s}};var Gu=class{static test(e){let i=e;return"getElementsByTagName"in i&&i.getElementsByTagName("page").length&&i.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(e){let i=new Oc,r=e.getElementsByTagName("info"),s=e.getElementsByTagName("common"),n=e.getElementsByTagName("page"),o=e.getElementsByTagName("char"),a=e.getElementsByTagName("kerning"),l=e.getElementsByTagName("distanceField");for(let u=0;u<r.length;u++)i.info.push({face:r[u].getAttribute("face"),size:parseInt(r[u].getAttribute("size"),10)});for(let u=0;u<s.length;u++)i.common.push({lineHeight:parseInt(s[u].getAttribute("lineHeight"),10)});for(let u=0;u<n.length;u++)i.page.push({id:parseInt(n[u].getAttribute("id"),10)||0,file:n[u].getAttribute("file")});for(let u=0;u<o.length;u++){let d=o[u];i.char.push({id:parseInt(d.getAttribute("id"),10),page:parseInt(d.getAttribute("page"),10)||0,x:parseInt(d.getAttribute("x"),10),y:parseInt(d.getAttribute("y"),10),width:parseInt(d.getAttribute("width"),10),height:parseInt(d.getAttribute("height"),10),xoffset:parseInt(d.getAttribute("xoffset"),10),yoffset:parseInt(d.getAttribute("yoffset"),10),xadvance:parseInt(d.getAttribute("xadvance"),10)})}for(let u=0;u<a.length;u++)i.kerning.push({first:parseInt(a[u].getAttribute("first"),10),second:parseInt(a[u].getAttribute("second"),10),amount:parseInt(a[u].getAttribute("amount"),10)});for(let u=0;u<l.length;u++)i.distanceField.push({fieldType:l[u].getAttribute("fieldType"),distanceRange:parseInt(l[u].getAttribute("distanceRange"),10)});return i}};var $u=class{static test(e){return typeof e=="string"&&e.includes("<font>")?Gu.test(ut.ADAPTER.parseXML(e)):!1}static parse(e){return Gu.parse(ut.ADAPTER.parseXML(e))}};var PE=[Bc,Gu,$u];function RE(t){for(let e=0;e<PE.length;e++)if(PE[e].test(t))return PE[e];return null}function DE(t,e,i,r,s,n){let o=i.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let a,l=i.dropShadow?i.dropShadowDistance:0,u=i.padding||0,d=t.width/r-l-u*2,m=t.height/r-l-u*2,g=o.slice(),_=i.fillGradientStops.slice();if(!_.length){let v=g.length+1;for(let E=1;E<v;++E)_.push(E/v)}if(g.unshift(o[0]),_.unshift(0),g.push(o[o.length-1]),_.push(1),i.fillGradientType===eh.LINEAR_VERTICAL){a=e.createLinearGradient(d/2,u,d/2,m+u);let v=0,b=(n.fontProperties.fontSize+i.strokeThickness)/m;for(let T=0;T<s.length;T++){let A=n.lineHeight*T;for(let M=0;M<g.length;M++){let k=0;typeof _[M]=="number"?k=_[M]:k=M/g.length;let F=A/m+k*b,O=Math.max(v,F);O=Math.min(O,1),a.addColorStop(O,g[M]),v=O}}}else{a=e.createLinearGradient(u,m/2,d+u,m/2);let v=g.length+1,E=1;for(let b=0;b<g.length;b++){let T;typeof _[b]=="number"?T=_[b]:T=E/v,a.addColorStop(T,g[b]),E++}}return a}function FE(t,e,i,r,s,n,o){let a=i.text,l=i.fontProperties;e.translate(r,s),e.scale(n,n);let u=o.strokeThickness/2,d=-(o.strokeThickness/2);if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=DE(t,e,o,n,[a],i),e.strokeStyle=o.stroke,o.dropShadow){let m=o.dropShadowColor,g=o.dropShadowBlur*n,_=o.dropShadowDistance*n;e.shadowColor=fi.shared.setValue(m).setAlpha(o.dropShadowAlpha).toRgbaString(),e.shadowBlur=g,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*_,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*_}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,u,d+i.lineHeight-l.descent),o.fill&&e.fillText(a,u,d+i.lineHeight-l.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function Nd(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}function sm(t){return Array.from?Array.from(t):t.split("")}function LE(t){typeof t=="string"&&(t=[t]);let e=[];for(let i=0,r=t.length;i<r;i++){let s=t[i];if(Array.isArray(s)){if(s.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);let n=s[0].charCodeAt(0),o=s[1].charCodeAt(0);if(o<n)throw new Error("[BitmapFont]: Invalid character range.");for(let a=n,l=o;a<=l;a++)e.push(String.fromCharCode(a))}else e.push(...sm(s))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}var oc=class{constructor(t,e,i){let[r]=t.info,[s]=t.common,[n]=t.page,[o]=t.distanceField,a=At.getResolutionOfUrl(n.file),l={};this._ownsTextures=i,this.font=r.face,this.size=r.size,this.lineHeight=s.lineHeight/a,this.chars={},this.pageTextures=l;for(let u=0;u<t.page.length;u++){let{id:d,file:m}=t.page[u];l[d]=e instanceof Array?e[u]:e[m],o?.fieldType&&o.fieldType!=="none"&&(l[d].baseTexture.alphaMode=Ks.NO_PREMULTIPLIED_ALPHA,l[d].baseTexture.mipmap=xn.OFF)}for(let u=0;u<t.char.length;u++){let{id:d,page:m}=t.char[u],{x:g,y:_,width:v,height:E,xoffset:b,yoffset:T,xadvance:A}=t.char[u];g/=a,_/=a,v/=a,E/=a,b/=a,T/=a,A/=a;let M=new ei(g+l[m].frame.x/a,_+l[m].frame.y/a,v,E);this.chars[d]={xOffset:b,yOffset:T,xAdvance:A,kerning:{},texture:new qt(l[m].baseTexture,M),page:m}}for(let u=0;u<t.kerning.length;u++){let{first:d,second:m,amount:g}=t.kerning[u];d/=a,m/=a,g/=a,this.chars[m]&&(this.chars[m].kerning[d]=g)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??"none"}destroy(){for(let t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(let t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,i){let r;if(t instanceof Oc)r=t;else{let n=RE(t);if(!n)throw new Error("Unrecognized data format for font.");r=n.parse(t)}e instanceof qt&&(e=[e]);let s=new oc(r,e,i);return oc.available[s.font]=s,s}static uninstall(t){let e=oc.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete oc.available[t]}static from(t,e,i){if(!t)throw new Error("[BitmapFont] Property `name` is required.");let{chars:r,padding:s,resolution:n,textureWidth:o,textureHeight:a,...l}=Object.assign({},oc.defaultOptions,i),u=LE(r),d=e instanceof kn?e:new kn(e),m=o,g=new Oc;g.info[0]={face:d.fontFamily,size:d.fontSize},g.common[0]={lineHeight:d.fontSize};let _=0,v=0,E,b,T,A=0,M=[],k=[];for(let O=0;O<u.length;O++){E||(E=ut.ADAPTER.createCanvas(),E.width=o,E.height=a,b=E.getContext("2d"),T=new li(E,{resolution:n,...l}),M.push(T),k.push(new qt(T)),g.page.push({id:k.length-1,file:""}));let B=u[O],U=fn.measureText(B,d,!1,E),$=U.width,q=Math.ceil(U.height),W=Math.ceil((d.fontStyle==="italic"?2:1)*$);if(v>=a-q*n){if(v===0)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${B}')`);--O,E=null,b=null,T=null,v=0,_=0,A=0;continue}if(A=Math.max(q+U.fontProperties.descent,A),W*n+_>=m){if(_===0)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${B}')`);--O,v+=A*n,v=Math.ceil(v),_=0,A=0;continue}FE(E,b,U,_,v,n,d);let Z=Nd(U.text);g.char.push({id:Z,page:k.length-1,x:_/n,y:v/n,width:W,height:q,xoffset:0,yoffset:0,xadvance:$-(d.dropShadow?d.dropShadowDistance:0)-(d.stroke?d.strokeThickness:0)}),_+=(W+2*s)*n,_=Math.ceil(_)}for(let O=0,B=u.length;O<B;O++){let U=u[O];for(let $=0;$<B;$++){let q=u[$],W=b.measureText(U).width,Z=b.measureText(q).width,X=b.measureText(U+q).width-(W+Z);X&&g.kerning.push({first:Nd(U),second:Nd(q),amount:X})}}let F=new oc(g,k,!0);return oc.available[t]!==void 0&&oc.uninstall(t),oc.available[t]=F,F}},zs=oc;zs.ALPHA=[["a","z"],["A","Z"]," "];zs.NUMERIC=[["0","9"]];zs.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];zs.ASCII=[[" ","~"]];zs.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:oc.ALPHANUMERIC};zs.available={};var TD=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`;var SD=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;var AD=[],CD=[],ID=[],kD=class extends qi{constructor(t,e={}){super();let{align:i,tint:r,maxWidth:s,letterSpacing:n,fontName:o,fontSize:a}=Object.assign({},kD.styleDefaults,e);if(!zs.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new fi(r),this._font=void 0,this._fontName=o,this._fontSize=a,this.text=t,this._maxWidth=s,this._maxLineHeight=0,this._letterSpacing=n,this._anchor=new Yo(()=>{this.dirty=!0},this,0,0),this._roundPixels=ut.ROUND_PIXELS,this.dirty=!0,this._resolution=ut.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){let t=zs.available[this._fontName],e=this.fontSize,i=e/t.size,r=new Jt,s=[],n=[],o=[],a=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",l=sm(a),u=this._maxWidth*t.size/e,d=t.distanceFieldType==="none"?AD:CD,m=null,g=0,_=0,v=0,E=-1,b=0,T=0,A=0,M=0;for(let q=0;q<l.length;q++){let W=l[q],Z=Nd(W);if(/(?:\s)/.test(W)&&(E=q,b=g,M++),W==="\r"||W===`
`){n.push(g),o.push(-1),_=Math.max(_,g),++v,++T,r.x=0,r.y+=t.lineHeight,m=null,M=0;continue}let Q=t.chars[Z];if(!Q)continue;m&&Q.kerning[m]&&(r.x+=Q.kerning[m]);let X=ID.pop()||{texture:qt.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Jt};X.texture=Q.texture,X.line=v,X.charCode=Z,X.position.x=Math.round(r.x+Q.xOffset+this._letterSpacing/2),X.position.y=Math.round(r.y+Q.yOffset),X.prevSpaces=M,s.push(X),g=X.position.x+Math.max(Q.xAdvance-Q.xOffset,Q.texture.orig.width),r.x+=Q.xAdvance+this._letterSpacing,A=Math.max(A,Q.yOffset+Q.texture.height),m=Z,E!==-1&&u>0&&r.x>u&&(++T,At.removeItems(s,1+E-T,1+q-E),q=E,E=-1,n.push(b),o.push(s.length>0?s[s.length-1].prevSpaces:0),_=Math.max(_,b),v++,r.x=0,r.y+=t.lineHeight,m=null,M=0)}let k=l[l.length-1];k!=="\r"&&k!==`
`&&(/(?:\s)/.test(k)&&(g=b),n.push(g),_=Math.max(_,g),o.push(-1));let F=[];for(let q=0;q<=v;q++){let W=0;this._align==="right"?W=_-n[q]:this._align==="center"?W=(_-n[q])/2:this._align==="justify"&&(W=o[q]<0?0:(_-n[q])/o[q]),F.push(W)}let O=s.length,B={},U=[],$=this._activePagesMeshData;d.push(...$);for(let q=0;q<O;q++){let W=s[q].texture,Z=W.baseTexture.uid;if(!B[Z]){let Q=d.pop();if(!Q){let ce=new zu,de,le;t.distanceFieldType==="none"?(de=new Tl(qt.EMPTY),le=Ii.NORMAL):(de=new Tl(qt.EMPTY,{program:Vn.from(SD,TD),uniforms:{uFWidth:0}}),le=Ii.NORMAL_NPM);let te=new nc(ce,de);te.blendMode=le,Q={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:te,vertices:null,uvs:null,indices:null}}Q.index=0,Q.indexCount=0,Q.vertexCount=0,Q.uvsCount=0,Q.total=0;let{_textureCache:X}=this;X[Z]=X[Z]||new qt(W.baseTexture),Q.mesh.texture=X[Z],Q.mesh.tint=this._tintColor.value,U.push(Q),B[Z]=Q}B[Z].total++}for(let q=0;q<$.length;q++)U.includes($[q])||this.removeChild($[q].mesh);for(let q=0;q<U.length;q++)U[q].mesh.parent!==this&&this.addChild(U[q].mesh);this._activePagesMeshData=U;for(let q in B){let W=B[q],Z=W.total;if(!(W.indices?.length>6*Z)||W.vertices.length<nc.BATCHABLE_SIZE*2)W.vertices=new Float32Array(4*2*Z),W.uvs=new Float32Array(4*2*Z),W.indices=new Uint16Array(6*Z);else{let Q=W.total,X=W.vertices;for(let ce=Q*4*2;ce<X.length;ce++)X[ce]=0}W.mesh.size=6*Z}for(let q=0;q<O;q++){let W=s[q],Z=W.position.x+F[W.line]*(this._align==="justify"?W.prevSpaces:1);this._roundPixels&&(Z=Math.round(Z));let Q=Z*i,X=W.position.y*i,ce=W.texture,de=B[ce.baseTexture.uid],le=ce.frame,te=ce._uvs,ee=de.index++;de.indices[ee*6+0]=0+ee*4,de.indices[ee*6+1]=1+ee*4,de.indices[ee*6+2]=2+ee*4,de.indices[ee*6+3]=0+ee*4,de.indices[ee*6+4]=2+ee*4,de.indices[ee*6+5]=3+ee*4,de.vertices[ee*8+0]=Q,de.vertices[ee*8+1]=X,de.vertices[ee*8+2]=Q+le.width*i,de.vertices[ee*8+3]=X,de.vertices[ee*8+4]=Q+le.width*i,de.vertices[ee*8+5]=X+le.height*i,de.vertices[ee*8+6]=Q,de.vertices[ee*8+7]=X+le.height*i,de.uvs[ee*8+0]=te.x0,de.uvs[ee*8+1]=te.y0,de.uvs[ee*8+2]=te.x1,de.uvs[ee*8+3]=te.y1,de.uvs[ee*8+4]=te.x2,de.uvs[ee*8+5]=te.y2,de.uvs[ee*8+6]=te.x3,de.uvs[ee*8+7]=te.y3}this._textWidth=_*i,this._textHeight=(r.y+t.lineHeight)*i;for(let q in B){let W=B[q];if(this.anchor.x!==0||this.anchor.y!==0){let ce=0,de=this._textWidth*this.anchor.x,le=this._textHeight*this.anchor.y;for(let te=0;te<W.total;te++)W.vertices[ce++]-=de,W.vertices[ce++]-=le,W.vertices[ce++]-=de,W.vertices[ce++]-=le,W.vertices[ce++]-=de,W.vertices[ce++]-=le,W.vertices[ce++]-=de,W.vertices[ce++]-=le}this._maxLineHeight=A*i;let Z=W.mesh.geometry.getBuffer("aVertexPosition"),Q=W.mesh.geometry.getBuffer("aTextureCoord"),X=W.mesh.geometry.getIndex();Z.data=W.vertices,Q.data=W.uvs,X.data=W.indices,Z.update(),Q.update(),X.update()}for(let q=0;q<s.length;q++)ID.push(s[q]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);let{distanceFieldRange:e,distanceFieldType:i,size:r}=zs.available[this._fontName];if(i!=="none"){let{a:s,b:n,c:o,d:a}=this.worldTransform,l=Math.sqrt(s*s+n*n),u=Math.sqrt(o*o+a*a),d=(Math.abs(l)+Math.abs(u))/2,m=this.fontSize/r,g=t._view.resolution;for(let _ of this._activePagesMeshData)_.mesh.shader.uniforms.uFWidth=d*e*m*g}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){let t=zs.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!zs.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??zs.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){let{_textureCache:e}=this,r=zs.available[this._fontName].distanceFieldType==="none"?AD:CD;r.push(...this._activePagesMeshData);for(let s of this._activePagesMeshData)this.removeChild(s.mesh);this._activePagesMeshData=[],r.filter(s=>e[s.mesh.texture.baseTexture.uid]).forEach(s=>{s.mesh.texture=qt.EMPTY});for(let s in e)e[s].destroy(),delete e[s];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}},P2=kD;P2.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};var jX=[".xml",".fnt"],MD={extension:{type:yt.LoadParser,priority:dn.Normal},name:"loadBitmapFont",test(t){return jX.includes(At.path.extname(t).toLowerCase())},async testParse(t){return Bc.test(t)||$u.test(t)},async parse(t,e,i){let r=Bc.test(t)?Bc.parse(t):$u.parse(t),{src:s}=e,{page:n}=r,o=[];for(let u=0;u<n.length;++u){let d=n[u].file,m=At.path.join(At.path.dirname(s),d);m=Ad(m,s),o.push(m)}let a=await i.load(o),l=o.map(u=>a[u]);return zs.install(r,l,!0)},async load(t,e){return(await ut.ADAPTER.fetch(t)).text()},unload(t){t.destroy()}};St.add(MD);var R2=class extends kn{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new R2(Object.keys(R2.defaultOptions).reduce((e,i)=>({...e,[i]:t[i]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete R2.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){let{availableFonts:i}=R2;if(i[t]){let r=i[t];return this._fonts.push(r),r.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return ut.ADAPTER.fetch(t).then(r=>r.blob()).then(async r=>new Promise((s,n)=>{let o=URL.createObjectURL(r),a=new FileReader;a.onload=()=>s([o,a.result]),a.onerror=n,a.readAsDataURL(r)})).then(async([r,s])=>{let n=Object.assign({family:At.path.basename(t,At.path.extname(t)),weight:"normal",style:"normal",src:r,dataSrc:s,refs:1,originalUrl:t,fontFace:null},e);i[t]=n,this._fonts.push(n),this.styleID++;let o=new FontFace(n.family,`url(${n.src})`,{weight:n.weight,style:n.style});n.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){let e=t.filter(i=>!this._overrides.includes(i));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){let e=t.filter(i=>this._overrides.includes(i));e.length>0&&(this._overrides=this._overrides.filter(i=>!e.includes(i)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style}; 
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=At.rgb2hex(t)),typeof t=="number"?At.hex2string(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor),e=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),r=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));let s=`${i}px ${r}px`;return this.dropShadowBlur>0?`text-shadow: ${s} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${s} ${t}`}reset(){Object.assign(this,R2.defaultOptions)}onBeforeDraw(){let{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){let{userAgent:t}=ut.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}},Od=R2;Od.availableFonts={};Od.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};var D2=class extends Jr{constructor(t="",e={}){super(qt.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;let i=new Image,r=qt.from(i,{scaleMode:ut.SCALE_MODE,resourceOptions:{autoLoad:!1}});r.orig=new ei,r.trim=new ei,this.texture=r;let s="http://www.w3.org/2000/svg",n="http://www.w3.org/1999/xhtml",o=document.createElementNS(s,"svg"),a=document.createElementNS(s,"foreignObject"),l=document.createElementNS(n,"div"),u=document.createElementNS(n,"style");a.setAttribute("width","10000"),a.setAttribute("height","10000"),a.style.overflow="hidden",o.appendChild(a),this.maxWidth=D2.defaultMaxWidth,this.maxHeight=D2.defaultMaxHeight,this._domElement=l,this._styleElement=u,this._svgRoot=o,this._foreignObject=a,this._foreignObject.appendChild(u),this._foreignObject.appendChild(l),this._image=i,this._loadImage=new Image,this._autoResolution=D2.defaultAutoResolution,this._resolution=D2.defaultResolution??ut.RESOLUTION,this.text=t,this.style=e}measureText(t){let{text:e,style:i,resolution:r}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:i.toCSS(r)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);let s=this._domElement.getBoundingClientRect();this._svgRoot.remove();let n=Math.min(this.maxWidth,Math.ceil(s.width)),o=Math.min(this.maxHeight,Math.ceil(s.height));return this._svgRoot.setAttribute("width",n.toString()),this._svgRoot.setAttribute("height",o.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(r)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:n+i.padding*2,height:o+i.padding*2}}async updateText(t=!0){let{style:e,_image:i,_loadImage:r}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;let{width:s,height:n}=this.measureText();i.width=r.width=Math.ceil(Math.max(1,s)),i.height=r.height=Math.ceil(Math.max(1,n)),this._loading||(this._loading=!0,await new Promise(o=>{r.onload=async()=>{await e.onBeforeDraw(),this._loading=!1,i.src=r.src,r.onload=null,r.src="",this.updateTexture(),o()};let a=new XMLSerializer().serializeToString(this._svgRoot);r.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(a)}`}))}get source(){return this._image}updateTexture(){let{style:t,texture:e,_image:i,resolution:r}=this,{padding:s}=t,{baseTexture:n}=e;e.trim.width=e._frame.width=i.width/r,e.trim.height=e._frame.height=i.height/r,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-s*2,e.orig.height=e._frame.height-s*2,this._onTextureUpdate(),n.setRealSize(i.width,i.height,r),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},D2.defaultDestroyOptions,t),super.destroy(t);let e=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=e,this._svgRoot?.remove(),this._svgRoot=e,this._domElement?.remove(),this._domElement=e,this._foreignObject?.remove(),this._foreignObject=e,this._styleElement?.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);let e=At.sign(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);let e=At.sign(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof Od?(this.ownsStyle=!1,this._style=t):t instanceof kn?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=Od.from(t)):(this.ownsStyle=!0,this._style=new Od(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}},nm=D2;nm.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0};nm.defaultMaxWidth=2024;nm.defaultMaxHeight=2024;nm.defaultAutoResolution=!0;function Ar(t,e){return t.reduce(function(i,r){let s=typeof r=="string"?e.hasEntity(r):r;if(s){let n=s.extent(e);i.min=[Math.min(i.min[0],n.min[0]),Math.min(i.min[1],n.min[1])],i.max=[Math.max(i.max[0],n.max[0]),Math.max(i.max[1],n.max[1])]}return i},new mt)}function NE(t){let e=[];for(let i=0;i<t.length;i+=2)e.push(new Jt(t[i],t[i+1]));return e}function Yi(t,e,i){let r=i.scene();e?t.forEach(s=>r.classData("osm",s,"highlighted")):r.clearClass("highlighted"),i.systems.map.immediateRedraw()}function Sl(t,e,i,r,s){let n=`translate3d(${e}px,${i}px,0)`,o=r?` scale(${r})`:"",a=s?` rotate(${s}deg)`:"";return t.style("transform",`${n}${o}${a}`)}function om(t){let e=t.getBoundingClientRect(),i=e.left,r=e.top,s=+t.clientLeft,n=+t.clientTop;return function(o){return[o.clientX-i-s,o.clientY-r-n]}}function F2(t,e){return t<0&&(t+=Math.ceil(-t/e)*e),t%e}function es(t){return typeof t=="function"?t:()=>t}function ki(t){let e=t.size()&&t.node().tagName.toLowerCase()==="textarea";return t.attr("autocomplete","new-password").attr("autocorrect","off").attr("autocapitalize","off").attr("data-1p-ignore","").attr("data-lpignore","true").attr("spellcheck",e?"true":"false")}var am=class extends Error{constructor(e){let i=e.status+" "+e.statusText;super(i),this.name="FetchError",this.status=e.status,this.statusText=e.statusText,this.response=e}};function Ai(t){if(!t.ok)throw new am(t);let e=(t.headers.get("content-type")||"").split(";")[0];if(!e)switch((new URL(t.url).pathname.split("/").at(-1)||"").toLowerCase().split(".").at(-1)||""){case"geojson":case"json":e="application/json";break;case"htm":case"html":e="text/html";break;case"svg":e="image/svg+xml";break;case"gpx":case"kml":case"xml":e="application/xml";break;case"mvt":case"pb":case"pbf":case"pmtiles":case"proto":e="application/protobuf";break;default:e="text/plain"}switch(e){case"application/geo+json":case"application/json":case"application/vnd.geo+json":case"text/x-json":return t.status===204||t.status===205?void 0:t.json();case"application/xhtml+xml":case"application/xml":case"image/svg+xml":case"text/html":case"text/xml":return t.text().then(i=>new window.DOMParser().parseFromString(i,e));case"application/octet-stream":case"application/protobuf":case"application/vnd.google.protobuf":case"application/vnd.mapbox-vector-tile":case"application/x-protobuf":return t.arrayBuffer();default:return t.text()}}function ti(t,e){function i(r){function s(){delete this.value}function n(){this.value!==r&&(this.value=r)}function o(){var a=r.apply(this,arguments);a==null?delete this.value:this.value!==a&&(this.value=a)}return r==null?s:typeof r=="function"?o:n}return arguments.length===1?t.property("value"):t.each(i(e))}function zi(t){var e={};function i(o,a){var l=!1,u=Object.keys(e).map(function(_){return e[_]}),d,m;for(d=0;d<u.length;d++)if(m=u[d],!!m.event.modifiers.shiftKey&&!!m.capture===a&&g(o,m,!0)){m.callback(o),l=!0;break}if(l)return;for(d=0;d<u.length;d++)if(m=u[d],!m.event.modifiers.shiftKey&&!!m.capture===a&&g(o,m,!1)){m.callback(o);break}function g(_,v,E){var b=_,T=!1,A=!0;return b.key!==void 0&&(A=b.key.charCodeAt(0)>255,T=!0,v.event.key===void 0?T=!1:Array.isArray(v.event.key)?v.event.key.map(function(M){return M.toLowerCase()}).indexOf(b.key.toLowerCase())===-1&&(T=!1):b.key.toLowerCase()!==v.event.key.toLowerCase()&&(T=!1)),!T&&A&&(T=b.keyCode===v.event.keyCode),!(!T||!(b.ctrlKey&&b.altKey)&&(b.ctrlKey!==v.event.modifiers.ctrlKey||b.altKey!==v.event.modifiers.altKey)||b.metaKey!==v.event.modifiers.metaKey||E&&b.shiftKey!==v.event.modifiers.shiftKey)}}function r(o){i(o,!0)}function s(o){var a=ye(o.target).node().tagName;a==="INPUT"||a==="SELECT"||a==="TEXTAREA"||i(o,!1)}function n(o){return o=o||ye(document),o.on("keydown.capture."+t,r,!0),o.on("keydown.bubble."+t,s,!1),n}return n.unbind=function(o){return e=[],o=o||ye(document),o.on("keydown.capture."+t,null),o.on("keydown.bubble."+t,null),n},n.clear=function(){return e={},n},n.off=function(o,a){for(var l=Ei([].concat(o)),u=0;u<l.length;u++){var d=l[u]+(a?"-capture":"-bubble");delete e[d]}return n},n.on=function(o,a,l){if(typeof a!="function")return n.off(o,l);for(var u=Ei([].concat(o)),d=0;d<u.length;d++){var m=u[d]+(l?"-capture":"-bubble"),g={id:m,capture:l,callback:a,event:{key:void 0,keyCode:0,modifiers:{shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1}}};e[m]&&console.warn('warning: duplicate keybinding for "'+m+'"'),e[m]=g;for(var _=u[d].toLowerCase().match(/(?:(?:[^+])+|[]|\+\+|^\+$)/g),v=0;v<_.length;v++)if(_[v]==="++"&&(_[v]="+"),_[v]in zi.modifierCodes){var E=zi.modifierProperties[zi.modifierCodes[_[v]]];g.event.modifiers[E]=!0}else g.event.key=zi.keys[_[v]]||_[v],_[v]in zi.keyCodes&&(g.event.keyCode=zi.keyCodes[_[v]])}return n},n}zi.modifierCodes={"\u21E7":16,shift:16,"\u2303":17,ctrl:17,"\u2325":18,alt:18,option:18,"\u2318":91,meta:91,cmd:91,super:91,win:91};zi.modifierProperties={16:"shiftKey",17:"ctrlKey",18:"altKey",91:"metaKey"};zi.plusKeys=["plus","ffplus","=","ffequals","\u2260","\xB1"];zi.minusKeys=["_","-","ffminus","dash","\u2013","\u2014"];zi.keys={"\u232B":"Backspace",backspace:"Backspace","\u21E5":"Tab","\u21C6":"Tab",tab:"Tab","\u21A9":"Enter","\u21B5":"Enter","\u23CE":"Enter",return:"Enter",enter:"Enter","\u2305":"Enter",pause:"Pause","pause-break":"Pause","\u21EA":"CapsLock",caps:"CapsLock","caps-lock":"CapsLock","\u238B":["Escape","Esc"],escape:["Escape","Esc"],esc:["Escape","Esc"],space:[" ","Spacebar"],"\u2196":"PageUp",pgup:"PageUp","page-up":"PageUp","\u2198":"PageDown",pgdown:"PageDown","page-down":"PageDown","\u21DF":"End",end:"End","\u21DE":"Home",home:"Home",ins:"Insert",insert:"Insert","\u2326":["Delete","Del"],del:["Delete","Del"],delete:["Delete","Del"],"\u2190":["ArrowLeft","Left"],left:["ArrowLeft","Left"],"arrow-left":["ArrowLeft","Left"],"\u2191":["ArrowUp","Up"],up:["ArrowUp","Up"],"arrow-up":["ArrowUp","Up"],"\u2192":["ArrowRight","Right"],right:["ArrowRight","Right"],"arrow-right":["ArrowRight","Right"],"\u2193":["ArrowDown","Down"],down:["ArrowDown","Down"],"arrow-down":["ArrowDown","Down"],"*":["*","Multiply"],star:["*","Multiply"],asterisk:["*","Multiply"],multiply:["*","Multiply"],"+":["+","Add"],plus:["+","Add"],"-":["-","Subtract"],subtract:["-","Subtract"],dash:["-","Subtract"],semicolon:";",equals:"=",comma:",",period:".","full-stop":".",slash:"/","forward-slash":"/",tick:"`","back-quote":"`","open-bracket":"[","back-slash":"\\","close-bracket":"]",quote:"'",apostrophe:"'","num-0":"0","num-1":"1","num-2":"2","num-3":"3","num-4":"4","num-5":"5","num-6":"6","num-7":"7","num-8":"8","num-9":"9",f1:"F1",f2:"F2",f3:"F3",f4:"F4",f5:"F5",f6:"F6",f7:"F7",f8:"F8",f9:"F9",f10:"F10",f11:"F11",f12:"F12",f13:"F13",f14:"F14",f15:"F15",f16:"F16",f17:"F17",f18:"F18",f19:"F19",f20:"F20",f21:"F21",f22:"F22",f23:"F23",f24:"F24",f25:"F25"};zi.keyCodes={"\u232B":8,backspace:8,"\u21E5":9,"\u21C6":9,tab:9,"\u21A9":13,"\u21B5":13,"\u23CE":13,return:13,enter:13,"\u2305":13,pause:19,"pause-break":19,"\u21EA":20,caps:20,"caps-lock":20,"\u238B":27,escape:27,esc:27,space:32,"\u2196":33,pgup:33,"page-up":33,"\u2198":34,pgdown:34,"page-down":34,"\u21DF":35,end:35,"\u21DE":36,home:36,ins:45,insert:45,"\u2326":46,del:46,delete:46,"\u2190":37,left:37,"arrow-left":37,"\u2191":38,up:38,"arrow-up":38,"\u2192":39,right:39,"arrow-right":39,"\u2193":40,down:40,"arrow-down":40,ffequals:61,"*":106,star:106,asterisk:106,multiply:106,"+":107,plus:107,"-":109,subtract:109,"|":124,ffplus:171,ffminus:173,";":186,semicolon:186,"=":187,equals:187,",":188,comma:188,dash:189,".":190,period:190,"full-stop":190,"/":191,slash:191,"forward-slash":191,"`":192,tick:192,"back-quote":192,"[":219,"open-bracket":219,"\\":220,"back-slash":220,"]":221,"close-bracket":221,"'":222,quote:222,apostrophe:222};var Al=95,th=0;for(;++Al<106;)zi.keyCodes["num-"+th]=Al,++th;Al=47;th=0;for(;++Al<58;)zi.keyCodes[th]=Al,++th;Al=111;th=1;for(;++Al<136;)zi.keyCodes["f"+th]=Al,++th;Al=64;for(;++Al<91;)zi.keyCodes[String.fromCharCode(Al).toLowerCase()]=Al;function $t(t,e){for(var i=1,r=arguments.length,s;++i<r;)t[s=arguments[i]]=XX(t,e,e[s]);return t}function XX(t,e,i){return function(){var r=i.apply(e,arguments);return r===e?t:r}}function L2(t,e){t.each(function(){var i=document.createEvent("HTMLEvents");i.initEvent(e,!0,!0),this.dispatchEvent(i)})}function Cr(){if(this instanceof Cr)arguments.length&&this.initialize(arguments);else return new Cr().initialize(arguments)}Dt.way=Cr;Cr.prototype=Object.create(Dt.prototype);Object.assign(Cr.prototype,{type:"way",nodes:[],copy:function(t,e){if(e[this.id])return e[this.id];var i=Dt.prototype.copy.call(this,t,e),r=this.nodes.map(function(s){return t.entity(s).copy(t,e).id});return i=i.update({nodes:r}),e[this.id]=i,i},extent:function(t){return t.transient(this,"extent",function(){return Ar(this.nodes,t)})},first:function(){return this.nodes[0]},last:function(){return this.nodes[this.nodes.length-1]},contains:function(t){return this.nodes.indexOf(t)>=0},affix:function(t){if(this.nodes[0]===t)return"prefix";if(this.nodes[this.nodes.length-1]===t)return"suffix"},layer:function(){return isFinite(this.tags.layer)?Math.max(-10,Math.min(+this.tags.layer,10)):this.tags.covered==="yes"?-1:this.tags.location==="overground"?1:this.tags.location==="underground"?-1:this.tags.location==="underwater"?-10:this.tags.power==="line"||this.tags.power==="minor_line"||this.tags.aerialway?10:this.tags.bridge?1:this.tags.cutting||this.tags.tunnel||this.tags.waterway?-1:this.tags.man_made==="pipeline"||this.tags.boundary?-10:0},impliedLineWidthMeters:function(){var t={highway:{motorway:5,motorway_link:5,trunk:4.5,trunk_link:4.5,primary:4,secondary:4,tertiary:4,primary_link:4,secondary_link:4,tertiary_link:4,unclassified:4,road:4,living_street:4,bus_guideway:4,pedestrian:4,residential:3.5,service:3.5,track:3,cycleway:2.5,bridleway:2,corridor:2,steps:2,path:1.5,footway:1.5},railway:{rail:2.5,light_rail:2.5,tram:2.5,subway:2.5,monorail:2.5,funicular:2.5,disused:2.5,preserved:2.5,miniature:1.5,narrow_gauge:1.5},waterway:{river:50,canal:25,stream:5,tidal_channel:5,fish_pass:2.5,drain:2.5,ditch:1.5}};for(var e in t)if(this.tags[e]&&t[e][this.tags[e]]){var i=t[e][this.tags[e]];if(e==="highway"){var r=this.tags.lanes&&parseInt(this.tags.lanes,10);return r||(r=this.isOneWay()?1:2),i*r}return i}return null},isOneWay:function(){var t={yes:!0,1:!0,"-1":!0,reversible:!0,alternating:!0,no:!1,0:!1};if(t[this.tags.oneway]!==void 0)return t[this.tags.oneway];for(var e in this.tags)if(e in I1&&this.tags[e]in I1[e])return!0;return!1},sidednessIdentifier:function(){for(let t in this.tags){let e=this.tags[t],i=f3(t);if(i in p3&&e in p3[i])return p3[i][e]===!0?i:p3[i][e]}return null},isSided:function(){return this.tags.two_sided==="yes"?!1:this.sidednessIdentifier()!==null},lanes:function(){return w8(this)},isClosed:function(){return this.nodes.length>1&&this.first()===this.last()},isConvex:function(t){if(!this.isClosed()||this.isDegenerate())return null;for(var e=Ei(t.childNodes(this)),i=e.map(function(d){return d.loc}),r=0,s=0,n=0;n<i.length;n++){var o=i[(n+1)%i.length],a=i[n],l=i[(n+2)%i.length],u=q3(a,l,o);if(r=u>0?1:u<0?-1:0,r!==0){if(s&&r!==s)return!1;s=r}}return!0},tagSuggestingArea:function(){return A1(this.tags)},isArea:function(){return this.tags.area==="yes"?!0:!this.isClosed()||this.tags.area==="no"?!1:this.tagSuggestingArea()!==null},isDegenerate:function(){return new Set(this.nodes).size<(this.isArea()?3:2)},areAdjacent:function(t,e){for(var i=0;i<this.nodes.length;i++)if(this.nodes[i]===t&&(this.nodes[i-1]===e||this.nodes[i+1]===e))return!0;return!1},geometry:function(t){return t.transient(this,"geometry",function(){return this.isArea()?"area":"line"})},segments:function(t){function e(i){var r=i.hasEntity(this.nodes[0]),s=i.hasEntity(this.nodes[1]);return r&&s&&new mt([Math.min(r.loc[0],s.loc[0]),Math.min(r.loc[1],s.loc[1])],[Math.max(r.loc[0],s.loc[0]),Math.max(r.loc[1],s.loc[1])])}return t.transient(this,"segments",function(){for(var i=[],r=0;r<this.nodes.length-1;r++)i.push({id:this.id+"-"+r,wayId:this.id,index:r,nodes:[this.nodes[r],this.nodes[r+1]],extent:e});return i})},close:function(){if(this.isClosed()||!this.nodes.length)return this;var t=this.nodes.slice();return t=t.filter(N2),t.push(t[0]),this.update({nodes:t})},unclose:function(){if(!this.isClosed())return this;for(var t=this.nodes.slice(),e=this.first(),i=t.length-1;i>0&&t.length>1&&t[i]===e;)t.splice(i,1),i=t.length-1;return t=t.filter(N2),this.update({nodes:t})},addNode:function(t,e){var i=this.nodes.slice(),r=this.isClosed(),s=r?i.length-1:i.length;if(e===void 0&&(e=s),e<0||e>s)throw new RangeError("index "+e+" out of range 0.."+s);if(r){for(var n=this.first(),o=1;o<i.length&&i.length>2&&i[o]===n;)i.splice(o,1),e>o&&e--;for(o=i.length-1;o>0&&i.length>1&&i[o]===n;)i.splice(o,1),e>o&&e--,o=i.length-1}return i.splice(e,0,t),i=i.filter(N2),r&&(i.length===1||i[0]!==i[i.length-1])&&i.push(i[0]),this.update({nodes:i})},updateNode:function(t,e){var i=this.nodes.slice(),r=this.isClosed(),s=i.length-1;if(e===void 0||e<0||e>s)throw new RangeError("index "+e+" out of range 0.."+s);if(r){for(var n=this.first(),o=1;o<i.length&&i.length>2&&i[o]===n;)i.splice(o,1),e>o&&e--;for(o=i.length-1;o>0&&i.length>1&&i[o]===n;)i.splice(o,1),e===o&&(e=0),o=i.length-1}return i.splice(e,1,t),i=i.filter(N2),r&&(i.length===1||i[0]!==i[i.length-1])&&i.push(i[0]),this.update({nodes:i})},replaceNode:function(t,e){for(var i=this.nodes.slice(),r=this.isClosed(),s=0;s<i.length;s++)i[s]===t&&(i[s]=e);return i=i.filter(N2),r&&(i.length===1||i[0]!==i[i.length-1])&&i.push(i[0]),this.update({nodes:i})},removeNode:function(t){var e=this.nodes.slice(),i=this.isClosed();return e=e.filter(function(r){return r!==t}).filter(N2),i&&(e.length===1||e[0]!==e[e.length-1])&&e.push(e[0]),this.update({nodes:e})},asJXON:function(t){var e={way:{"@id":this.osmId(),"@version":this.version||0,nd:this.nodes.map(function(i){return{keyAttributes:{ref:Dt.id.toOSM(i)}}},this),tag:Object.keys(this.tags).map(function(i){return{keyAttributes:{k:i,v:this.tags[i]}}},this)}};return t&&(e.way["@changeset"]=t),e},asGeoJSON:function(t){return t.transient(this,"GeoJSON",function(){var e=t.childNodes(this).map(function(i){return i.loc});return this.isArea()&&this.isClosed()?{type:"Polygon",coordinates:[e]}:{type:"LineString",coordinates:e}})},area:function(t){return t.transient(this,"area",function(){var e=t.childNodes(this),i={type:"Polygon",coordinates:[e.map(function(s){return s.loc})]};!this.isClosed()&&e.length&&i.coordinates[0].push(e[0].loc);var r=Sc(i);return r>2*Math.PI&&(i.coordinates[0]=i.coordinates[0].reverse(),r=Sc(i)),isNaN(r)?0:r})}});function N2(t,e,i){return e===0||t!==i[e-1]}function O2(t,e){if(t.type!=="relation"||!t.isMultipolygon()||Object.keys(t.tags).filter(Do).length>1)return!1;var i;for(var r in t.members){var s=t.members[r];if((!s.role||s.role==="outer")&&(i||s.type!=="way"||!e.hasEntity(s.id)||(i=e.entity(s.id),Object.keys(i.tags).filter(Do).length===0)))return!1}return i}function B2(t,e){if(t.type!=="way"||Object.keys(t.tags).filter(Do).length===0)return!1;var i=e.parentRelations(t);if(i.length!==1)return!1;var r=i[0];if(!r.isMultipolygon()||Object.keys(r.tags).filter(Do).length>1)return!1;for(var s=r.members,n,o=0;o<s.length;o++)if(n=s[o],n.id===t.id&&n.role&&n.role!=="outer"||n.id!==t.id&&(!n.role||n.role==="outer"))return!1;return r}function PD(t,e){if(t.type!=="way")return!1;var i=e.parentRelations(t);if(i.length!==1)return!1;var r=i[0];if(!r.isMultipolygon()||Object.keys(r.tags).filter(Do).length>1)return!1;for(var s=r.members,n,o,a=0;a<s.length;a++)if(n=s[a],!n.role||n.role==="outer"){if(o)return!1;o=n}if(!o)return!1;var l=e.hasEntity(o.id);return!l||!Object.keys(l.tags).filter(Do).length?!1:l}function xa(t,e){function i(v){return e.childNodes(e.entity(v.id))}function r(v){var E=pl(v.id,{reverseOneway:!0});return o.actions.push(E),v instanceof Cr?E(e).entity(v.id):v}t=t.filter(function(v){return v.type==="way"&&e.hasEntity(v.id)});var s,n=!0;for(s=0;s<t.length;s++)if(t[s]instanceof Cr){n=!1;break}var o=[];for(o.actions=[];t.length;){for(var a=t.shift(),l=[a],u=i(a).slice();t.length;){var d=u[0],m=u[u.length-1],g=null,_=null;for(s=0;s<t.length;s++)if(a=t[s],_=i(a),n&&l.length===1&&_[0]!==m&&_[_.length-1]!==m&&(_[_.length-1]===d||_[0]===d)&&(l[0]=r(l[0]),u.reverse(),d=u[0],m=u[u.length-1]),_[0]===m){g=u.push,_=_.slice(1);break}else if(_[_.length-1]===m){g=u.push,_=_.slice(0,-1).reverse(),a=r(a);break}else if(_[_.length-1]===d){g=u.unshift,_=_.slice(0,-1);break}else if(_[0]===d){g=u.unshift,_=_.slice(1).reverse(),a=r(a);break}else g=_=null;if(!_)break;g.apply(l,[a]),g.apply(u,_),t.splice(s,1)}l.nodes=u,o.push(l)}return o}function Bd(t,e,i,r){return function(o){var a=o.entity(t),l=/stop|platform/.test(e.role);return(isNaN(i)||r)&&e.type==="way"&&!l?o=s(a,o):(l&&isNaN(i)&&(i=0),o=o.replace(a.addMember(e,i))),o};function s(n,o){var a,l,u,d,m,g,_=[],v=[];for(d=0;d<n.members.length;d++){var E=n.members[d];/stop|platform/.test(E.role)?_.push(E):v.push(E)}if(n=n.update({members:v}),r){l=Cr({id:"wTemp",nodes:r.nodes}),o=o.replace(l);var b={id:l.id,type:"way",role:e.role},T=n.replaceMember({id:r.originalID},b,!0);a=ds(T.members,"type"),a.way=a.way||[]}else a=ds(n.members,"type"),a.way=a.way||[],a.way.push(e);v=q(a.way);var A=xa(v,o);for(d=0;d<A.length;d++){var M=A[d],k=M.nodes.slice(),F=M[0].index;for(m=0;m<v.length&&v[m].index!==F;m++);for(g=0;g<M.length;g++){u=M[g];var O=o.entity(u.id);l&&u.id===l.id&&(k[0].id===r.nodes[0]?u.pair=[{id:r.originalID,type:"way",role:u.role},{id:r.insertedID,type:"way",role:u.role}]:u.pair=[{id:r.insertedID,type:"way",role:u.role},{id:r.originalID,type:"way",role:u.role}]),g>0&&(m+g>=v.length||u.index!==v[m+g].index)&&$(v,u.index,m+g),k.splice(0,O.nodes.length-1)}}l&&(o=o.remove(l));var B=[];for(d=0;d<v.length;d++)u=v[d],u.index!==-1&&(u.pair?(B.push(u.pair[0]),B.push(u.pair[1])):B.push(un(u,["index"])));var U=_.concat(a.node||[],B,a.relation||[]);return o.replace(n.update({members:U}));function $(W,Z,Q){var X;for(X=0;X<W.length&&W[X].index!==Z;X++);var ce=Object.assign({},W[X]);W[X].index=-1,ce.index=Q,W.splice(Q,0,ce)}function q(W){for(var Z=new Array(W.length),Q=0;Q<W.length;Q++)Z[Q]=Object.assign({},W[Q]),Z[Q].index=Q;return Z}}}function tn(t,e){return function(i){i=i.replace(e.move(t.loc));var r=Yn(i.parentWays(i.entity(t.edge[0])),i.parentWays(i.entity(t.edge[1])));return r.forEach(function(s){for(var n=0;n<s.nodes.length-1;n++)if(JM([s.nodes[n],s.nodes[n+1]],t.edge)){i=i.replace(i.entity(s.id).addNode(e.id,n+1));return}}),i}}function xo(t,e,i){return function(r){return r.replace(r.entity(t).addNode(e,i))}}function ih(t,e,i){return function(r){return r.replace(r.entity(t).updateMember(e,i))}}function ja(t,e,i,r){return function(n){let o=n.entity(t),a=o.geometry(n),l=o.tags;return e&&(l=e.unsetTags(l,a,i&&i.addTags?Object.keys(i.addTags):null)),i&&(l=i.setTags(l,a,r)),n.replace(o.update({tags:l}))}}function Hr(t,e){return function(i){let r=i.entity(t);return i.replace(r.update({tags:e}))}}function vi(){if(this instanceof vi)arguments.length&&this.initialize(arguments);else return new vi().initialize(arguments)}Dt.node=vi;vi.prototype=Object.create(Dt.prototype);Object.assign(vi.prototype,{type:"node",loc:[9999,9999],extent:function(){return new mt(this.loc)},geometry:function(t){return t.transient(this,"geometry",function(){return t.isPoi(this)?"point":"vertex"})},move:function(t){return this.update({loc:t})},isDegenerate:function(){return!(Array.isArray(this.loc)&&this.loc.length===2&&this.loc[0]>=-180&&this.loc[0]<=180&&this.loc[1]>=-90&&this.loc[1]<=90)},directions:function(t,e){var i,r;if(this.isHighwayIntersection(t)&&(this.tags.stop||"").toLowerCase()==="all")i="all";else{i=(this.tags.direction||"").toLowerCase();var s=/:direction$/i,n=Object.keys(this.tags);for(r=0;r<n.length;r++)if(s.test(n[r])){i=this.tags[n[r]].toLowerCase();break}}if(i==="")return[];var o={north:0,n:0,northnortheast:22,nne:22,northeast:45,ne:45,eastnortheast:67,ene:67,east:90,e:90,eastsoutheast:112,ese:112,southeast:135,se:135,southsoutheast:157,sse:157,south:180,s:180,southsouthwest:202,ssw:202,southwest:225,sw:225,westsouthwest:247,wsw:247,west:270,w:270,westnorthwest:292,wnw:292,northwest:315,nw:315,northnorthwest:337,nnw:337},a=i.split(";"),l=[];return a.forEach(function(u){if(o[u]!==void 0&&(u=o[u]),u!==""&&!isNaN(+u)){l.push(+u);return}var d=this.tags["traffic_sign:backward"]||u==="backward"||u==="both"||u==="all",m=this.tags["traffic_sign:forward"]||u==="forward"||u==="both"||u==="all";if(!(!m&&!d)){var g={};t.parentWays(this).forEach(function(_){var v=_.nodes;for(r=0;r<v.length;r++)v[r]===this.id&&(m&&r>0&&(g[v[r-1]]=!0),d&&r<v.length-1&&(g[v[r+1]]=!0))},this),Object.keys(g).forEach(function(_){var v=e.project(this.loc),E=e.project(t.entity(_).loc);l.push(fs(v,E)*180/Math.PI+90)},this)}},this),Ei(l)},isCrossing:function(){return this.tags.highway==="crossing"||this.tags.railway&&this.tags.railway.indexOf("crossing")!==-1},isEndpoint:function(t){return t.transient(this,"isEndpoint",function(){var e=this.id;return t.parentWays(this).filter(function(i){return!i.isClosed()&&!!i.affix(e)}).length>0})},isConnected:function(t){return t.transient(this,"isConnected",function(){var e=t.parentWays(this);if(e.length>1){for(var i in e)if(e[i].geometry(t)==="line"&&e[i].hasInterestingTags())return!0}else if(e.length===1){var r=e[0],s=r.nodes.slice();return r.isClosed()&&s.pop(),s.indexOf(this.id)!==s.lastIndexOf(this.id)}return!1})},parentIntersectionWays:function(t){return t.transient(this,"parentIntersectionWays",function(){return t.parentWays(this).filter(function(e){return(e.tags.highway||e.tags.waterway||e.tags.railway||e.tags.aeroway)&&e.geometry(t)==="line"})})},isIntersection:function(t){return this.parentIntersectionWays(t).length>1},isHighwayIntersection:function(t){return t.transient(this,"isHighwayIntersection",function(){return t.parentWays(this).filter(function(e){return e.tags.highway&&e.geometry(t)==="line"}).length>1})},isOnAddressLine:function(t){return t.transient(this,"isOnAddressLine",function(){return t.parentWays(this).filter(function(e){return e.tags.hasOwnProperty("addr:interpolation")&&e.geometry(t)==="line"}).length>0})},asJXON:function(t){var e={node:{"@id":this.osmId(),"@lon":this.loc[0],"@lat":this.loc[1],"@version":this.version||0,tag:Object.keys(this.tags).map(function(i){return{keyAttributes:{k:i,v:this.tags[i]}}},this)}};return t&&(e.node["@changeset"]=t),e},asGeoJSON:function(){return{type:"Point",coordinates:this.loc}}});function Sg(t,e,i){i=(i||20)*Math.PI/180;var r=function(s,n){(n===null||!isFinite(n))&&(n=1),n=Math.min(Math.max(+n,0),1);var o=s.entity(t),a={};s.childNodes(o).forEach(function(Ni){a[Ni.id]||(a[Ni.id]=Ni)}),o.isConvex(s)||(s=r.makeConvex(s));var l=Ei(s.childNodes(o)),u=l.filter(function(Ni){return s.parentWays(Ni).length!==1}),d=l.map(function(Ni){return e.project(Ni.loc)}),m=u.map(function(Ni){return e.project(Ni.loc)}),g=d.length===2?pr(d[0],d[1],.5):da(d),_=k9(d,function(Ni){return Hi(g,Ni)}),v=Sf(d)>0?1:-1,E,b,T,A;if(u.length||(u=[l[0]],m=[d[0]]),u.length===1){var M=l.indexOf(u[0]),k=Math.floor((M+l.length/2)%l.length);u.push(l[k]),m.push(d[k])}for(b=0;b<m.length;b++){var F=(b+1)%u.length,O=u[b],B=u[F],U=l.indexOf(O),$=l.indexOf(B),q=-1,W=$-U,Z={},Q=[],X,ce,de,le,te,ee,oe,ie;W<0&&(W+=l.length);var ne=Hi(g,m[b])||1e-4;m[b]=[g[0]+(m[b][0]-g[0])/ne*_,g[1]+(m[b][1]-g[1])/ne*_],ee=e.invert(m[b]),oe=u[b],ie=a[oe.id],oe=oe.move(pr(ie.loc,ee,n)),s=s.replace(oe),X=Math.atan2(m[b][1]-g[1],m[b][0]-g[0]),ce=Math.atan2(m[F][1]-g[1],m[F][0]-g[0]),de=ce-X,de*v>0&&(de=-v*(2*Math.PI-Math.abs(de)));do q++,le=de/(W+q);while(Math.abs(le)>i);for(T=1;T<W;T++)te=X+T*le,ee=e.invert([g[0]+Math.cos(te)*_,g[1]+Math.sin(te)*_]),oe=l[(T+U)%l.length],ie=a[oe.id],Z[oe.id]=te,oe=oe.move(pr(ie.loc,ee,n)),s=s.replace(oe);for(T=0;T<q;T++){te=X+(W+T)*le,ee=e.invert([g[0]+Math.cos(te)*_,g[1]+Math.sin(te)*_]);var me=1/0;for(var De in Z){var He=Z[De],Je=Math.abs(He-te);Je<me&&(me=Je,ie=a[De])}oe=vi({loc:pr(ie.loc,ee,n)}),s=s.replace(oe),l.splice($+T,0,oe),Q.push(oe.id)}if(W===1&&Q.length){var ot=o.nodes.lastIndexOf(O.id),gt=o.nodes.lastIndexOf(B.id),vt=gt-ot;vt<-1&&(vt=1);var ct=s.parentWays(u[b]);for(T=0;T<ct.length;T++){var Se=ct[T];if(Se!==o&&Se.areAdjacent(O.id,B.id)){var Qe=Se.nodes.lastIndexOf(O.id),xt=Se.nodes.lastIndexOf(B.id),It=xt-Qe,Gt=xt;for(It<-1&&(It=1),vt!==It&&(Q.reverse(),Gt=Qe),A=0;A<Q.length;A++)Se=Se.addNode(Q[A],Gt+A);s=s.replace(Se)}}}}return E=l.map(function(Ni){return Ni.id}),E.push(E[0]),o=o.update({nodes:E}),s=s.replace(o),s};return r.makeConvex=function(s){var n=s.entity(t),o=Ei(s.childNodes(n)),a=o.map(function(T){return e.project(T.loc)}),l=Sf(a)>0?1:-1,u=ql(a),d,m;for(l===-1&&(o.reverse(),a.reverse()),d=0;d<u.length-1;d++){var g=a.indexOf(u[d]),_=a.indexOf(u[d+1]),v=_-g;for(v<0&&(v+=o.length),m=1;m<v;m++){var E=pr(u[d],u[d+1],m/v),b=o[(m+g)%o.length].move(e.invert(E));s=s.replace(b)}}return s},r.disabled=function(s){if(!s.entity(t).isClosed())return"not_closed";var n=s.entity(t),o=Ei(s.childNodes(n)),a=o.map(function(k){return e.project(k.loc)}),l=ql(a),u=Math.PI/180;if(l.length!==a.length||l.length<3)return!1;var d=da(a),m=Kb(d,a[0]),g,_;for(g=0;g<l.length;g++){_=l[g];var v=Kb(_,d),E=Math.abs(v-m);if(E>.05*m)return!1}for(g=0;g<l.length;g++){_=l[g];var b=l[(g+1)%l.length],T=Math.atan2(_[1]-d[1],_[0]-d[0]),A=Math.atan2(b[1]-d[1],b[0]-d[0]),M=A-T;if(M<0&&(M=-M),M>Math.PI&&(M=2*Math.PI-M),M>i+u)return!1}return"already_circular"},r.transitionable=!0,r}function Cl(t){function e(r,s){if(s.parentWays(r).length||s.parentRelations(r).length)return!1;var n=C1(r.tags);return n.point?!1:n.vertex?!0:!r.hasInterestingTags()}var i=function(r){var s=r.entity(t);return r.parentRelations(s).forEach(function(n){n=n.removeMembersWithID(t),r=r.replace(n),n.isDegenerate()&&(r=pn(n.id)(r))}),new Set(s.nodes).forEach(function(n){r=r.replace(s.removeNode(n));var o=r.entity(n);e(o,r)&&(r=r.remove(o))}),r.remove(s)};return i}function Hu(t){var e={way:Cl,node:Uc,relation:pn},i=function(r){return t.forEach(function(s){r.hasEntity(s)&&(r=e[r.entity(s).type](s)(r))}),r};return i}function pn(t,e){function i(s,n){return!n.parentWays(s).length&&!n.parentRelations(s).length&&!s.hasInterestingTags()&&!e}var r=function(s){var n=s.entity(t);s.parentRelations(n).forEach(function(a){a=a.removeMembersWithID(t),s=s.replace(a),a.isDegenerate()&&(s=pn(a.id)(s))});var o=Ei(n.members.map(function(a){return a.id}));return o.forEach(function(a){s=s.replace(n.removeMembersWithID(a));var l=s.entity(a);i(l,s)&&(s=Hu([a])(s))}),s.remove(n)};return r}function Uc(t){var e=function(i){var r=i.entity(t);return i.parentWays(r).forEach(function(s){s=s.removeNode(t),i=i.replace(s),s.isDegenerate()&&(i=Cl(s.id)(i))}),i.parentRelations(r).forEach(function(s){s=s.removeMembersWithID(t),i=i.replace(s),s.isDegenerate()&&(i=pn(s.id)(i))}),i.remove(r)};return e}function Ud(t){var e=function(i){var r,s,n,o,a;for(o=0;o<t.length&&(r=i.entity(t[o]),!r.version);o++);for(o=0;o<t.length;o++)if(s=i.entity(t[o]),s.id!==r.id){for(n=i.parentWays(s),a=0;a<n.length;a++)i=i.replace(n[a].replaceNode(s.id,r.id));for(n=i.parentRelations(s),a=0;a<n.length;a++)i=i.replace(n[a].replaceMember(s,r));r=r.mergeTags(s.tags),i=Uc(s.id)(i)}for(i=i.replace(r),n=i.parentWays(r),o=0;o<n.length;o++)n[o].isDegenerate()&&(i=Cl(n[o].id)(i));return i};return e.disabled=function(i){var r={},s=[],n,o,a,l,u,d,m,g,_;for(m=0;m<t.length&&(n=i.entity(t[m]),!n.version);m++);for(m=0;m<t.length;m++)for(o=i.entity(t[m]),l=i.parentRelations(o),g=0;g<l.length;g++){if(u=l[g],d=u.memberById(o.id).role||"",u.hasFromViaTo()&&s.push(u.id),r[u.id]!==void 0&&r[u.id]!==d)return"relation";r[u.id]=d}for(m=0;m<t.length;m++){o=i.entity(t[m]);var v=i.parentWays(o);for(g=0;g<v.length;g++){var E=v[g];for(l=i.parentRelations(E),_=0;_<l.length;_++)u=l[_],u.hasFromViaTo()&&s.push(u.id)}}for(s=Ei(s),m=0;m<s.length;m++)if(u=i.entity(s[m]),!!u.isComplete(i)){var b=u.members.filter(function(te){return te.type==="way"}).map(function(te){return i.entity(te.id)});b=Ei(b);var T=u.memberByRole("from"),A=u.memberByRole("to"),M=T.id===A.id,k={from:[],via:[],to:[],keyfrom:[],keyto:[]};for(g=0;g<u.members.length;g++)le(u.members[g],k);k.keyfrom=Ei(k.keyfrom.filter(ce)),k.keyto=Ei(k.keyto.filter(ce));var F=de(k.keyfrom,k.keyto);k.from=k.from.filter(F),k.via=k.via.filter(F),k.to=k.to.filter(F);var O=!1,B=!1,U=!1,$=!1,q=!1;for(g=0;g<t.length;g++){var W=t[g];k.from.indexOf(W)!==-1&&(O=!0),k.via.indexOf(W)!==-1&&(B=!0),k.to.indexOf(W)!==-1&&(U=!0),k.keyfrom.indexOf(W)!==-1&&($=!0),k.keyto.indexOf(W)!==-1&&(q=!0)}if(O&&U&&!M||O&&B||U&&B)return"restriction";if($||q){if(t.length!==2)return"restriction";var Z=null,Q=null;for(g=0;g<b.length;g++)a=b[g],a.contains(t[0])&&(Z=t[0]),a.contains(t[1])&&(Q=t[1]);if(Z&&Q){var X=!1;for(g=0;g<b.length;g++)if(a=b[g],a.areAdjacent(Z,Q)){X=!0;break}if(!X)return"restriction"}}for(g=0;g<b.length;g++){for(a=b[g].update({}),_=0;_<t.length;_++)t[_]!==n.id&&(a.areAdjacent(t[_],n.id)?a=a.removeNode(t[_]):a=a.replaceNode(t[_],n.id));if(a.isDegenerate())return"restriction"}}return!1;function ce(te,ee,oe){return oe.indexOf(te)!==oe.lastIndexOf(te)}function de(te,ee){return function(oe){return te.indexOf(oe)===-1&&ee.indexOf(oe)===-1}}function le(te,ee){var oe=i.hasEntity(te.id);if(oe){var ie=te.role||"";ee[ie]||(ee[ie]=[]),te.type==="node"?(ee[ie].push(te.id),ie==="via"&&(ee.keyfrom.push(te.id),ee.keyto.push(te.id))):te.type==="way"&&(ee[ie].push.apply(ee[ie],oe.nodes),(ie==="from"||ie==="via")&&(ee.keyfrom.push(oe.first()),ee.keyfrom.push(oe.last())),(ie==="to"||ie==="via")&&(ee.keyto.push(oe.first()),ee.keyto.push(oe.last())))}}},e}function U2(t,e){var i={},r=function(s){t.forEach(function(o){e.entity(o).copy(e,i)});for(var n in i)s=s.replace(i[n]);return s};return r.copies=function(){return i},r}function rh(t,e){return function(i){var r=i.entity(t).removeMember(e);return i=i.replace(r),r.isDegenerate()&&(i=pn(r.id)(i)),i}}function Vu(t,e){return e=e||{},i=>{return t.modified().forEach(r),t.created().forEach(r),i;function r(s){let n=Object.keys(s.tags),o=!1,a={};for(let l=0;l<n.length;l++){let u=n[l];e[u]||!s.tags[u]?o=!0:a[u]=s.tags[u]}o&&(i=i.replace(s.update({tags:a})))}}}function lm(t,e){var i,r=function(s){var n=s.entity(t),o=r.connections(s);return o.forEach(function(a){var l=s.entity(a.wayID),u=vi({id:e,loc:n.loc,tags:n.tags});s=s.replace(u),a.index===0&&l.isArea()?s=s.replace(l.replaceNode(l.nodes[0],u.id)):l.isClosed()&&a.index===l.nodes.length-1?s=s.replace(l.unclose().addNode(u.id)):s=s.replace(l.updateNode(u.id,a.index))}),s};return r.connections=function(s){for(var n=[],o=!1,a=s.parentWays(s.entity(t)),l,u,d=0;d<a.length;d++){if(l=a[d],i&&i.indexOf(l.id)===-1){o=!0;continue}if(l.isArea()&&l.nodes[0]===t)n.push({wayID:l.id,index:0});else for(var m=0;m<l.nodes.length;m++)if(u=l.nodes[m],u===t){if(l.isClosed()&&a.length>1&&i&&i.indexOf(l.id)!==-1&&m===l.nodes.length-1)continue;n.push({wayID:l.id,index:m})}}if(o)return n;if(t[1]!=="-"&&n.length>1&&n[0].wayID[1]==="-"){for(var g=1;g<n.length;g++)if(n[g].wayID[1]!=="-")return n.splice(g,1),n}return n.slice(1)},r.disabled=function(s){var n=r.connections(s);if(n.length===0)return"not_connected";var o=s.parentWays(s.entity(t)),a={},l;if(o.forEach(function(u){var d=s.parentRelations(u);d.forEach(function(m){m.id in a?i?(i.indexOf(u.id)!==-1||i.indexOf(a[m.id])!==-1)&&(l=m):l=m:a[m.id]=u.id})}),l)return"relation"},r.limitWays=function(s){return arguments.length?(i=s,r):i},r}function z2(t,e){let i,r=function(o){let a=o.entity(t);return a.type==="node"?s(a,o):n(a,o)};function s(o,a){i=o.id;let l=vi({loc:o.loc});a=a.replace(l);for(let u of a.parentWays(o))a=a.replace(u.replaceNode(t,l.id));for(let u of a.parentRelations(o))a=a.replace(u.replaceMember(o,l));return a}function n(o,a){let l=o.geometry(a),u=["source","wheelchair"],d=["area"],m=/architect|building|height|layer|nycdoitt:bin|roof/i,g=o.asGeoJSON(a),v=(g.type==="LineString"?g.coordinates:g.type==="Polygon"?g.coordinates[0]:g.type==="MultiPolygon"?g.coordinates[0][0]:[]).map(B=>e.project(B)),E;if(v.length)v.length===1?E=v[0]:v.length===2?E=pr(v[0],v[1],.5):E=da(v);else return a;let b=e.invert(E);(!b||!isFinite(b[0])||!isFinite(b[1]))&&(b=o.extent(a).center());let T={area:!0,corridor:!0,elevator:!0,level:!0,room:!0},A=o.tags.building&&o.tags.building!=="no"||o.tags["building:part"]&&o.tags["building:part"]!=="no",M=l==="area"&&o.tags.indoor&&T[o.tags.indoor],k=Object.assign({},o.tags),F={};for(let B in k)o.type==="relation"&&B==="type"||d.indexOf(B)===-1&&(M&&B==="indoor"||A&&m.test(B)||(F[B]=k[B],!(u.indexOf(B)!==-1||B.match(/^addr:.{1,}/))&&(M&&B==="level"||delete k[B])));!A&&!M&&l==="area"&&(k.area="yes");let O=vi({loc:b,tags:F});return a=a.replace(O),i=O.id,a.replace(o.update({tags:k}))}return r.getExtractedNodeID=function(){return i},r}function Ag(t,e={}){function i(s){var n=t.map(function(o){return s.entity(o)});return Object.assign({line:[]},ds(n,function(o){return o.geometry(s)}))}var r=function(s){var n=t.map(s.entity,s);n.sort(function(g,_){var v=g.isSided(),E=_.isSided();return v&&!E?-1:E&&!v?1:0});let o=(n.filter(g=>!g.isNew()).sort((g,_)=>+g.osmId()-+_.osmId())[0]||n[0]).id;var a=xa(n,s),l=a[0];s=a.actions.reduce(function(g,_){return _(g)},s);var u=s.entity(o);if(u=u.update({nodes:l.nodes.map(function(g){return g.id})}),s=s.replace(u),l.forEach(function(g){g.id!==o&&(s.parentRelations(g).forEach(function(_){s=s.replace(_.replaceMember(g,u))}),u=u.mergeTags(g.tags),s=s.replace(u),s=Cl(g.id)(s))}),e.tagnosticRoadCombine&&n.length&&n[0].tags.highway){var d=Object.assign({},u.tags);d.highway=n[0].tags.highway,u=u.update({tags:d}),s=s.replace(u)}function m(){if(u.isClosed()){var g=s.parentMultipolygons(u).filter(function(b){return b.members.length===1});if(g.length===1){var _=g[0];for(var v in u.tags)if(_.tags[v]&&_.tags[v]!==u.tags[v])return;u=u.mergeTags(_.tags),s=s.replace(u),s=pn(_.id,!0)(s);var E=Object.assign({},u.tags);u.geometry(s)!=="area"&&(E.area="yes"),delete E.type,u=u.update({tags:E}),s=s.replace(u)}}}return m(),s};return r.resultingWayNodesLength=function(s){return t.reduce(function(n,o){return n+s.entity(o).nodes.length},0)-t.length-1},r.disabled=function(s){var n=i(s);if(t.length<2||t.length!==n.line.length)return"not_eligible";var o=xa(t.map(s.entity,s),s);if(o.length>1)return"not_adjacent";var a,l=function(k){return s.parentRelations(s.entity(k)).filter(F=>!F.isRestriction()&&!F.isConnectivity()).sort((F,O)=>F.id-O.id)},u=l(t[0]);for(a=1;a<t.length;a++){var d=l(t[a]);if(!Gn(u,d))return"conflicting_relations"}for(a=0;a<t.length-1;a++)for(var m=a+1;m<t.length;m++){var g=s.childNodes(s.entity(t[a])).map(function(k){return k.loc}),_=s.childNodes(s.entity(t[m])).map(function(k){return k.loc}),v=v8(g,_),E=Yn(o[0].nodes.map(function(k){return k.loc.toString()}),v.map(function(k){return k.toString()}));if(E.length!==v.length)return"paths_intersect"}var b=o[0].nodes.map(function(k){return k.id}).slice(1,-1),T,A={},M=!1;if(o[0].forEach(function(k){var F=s.parentRelations(k);F.forEach(function(B){(B.isRestriction()||B.isConnectivity())&&B.members.some(function(U){return b.indexOf(U.id)>=0})&&(T=B)});for(var O in k.tags)O in A?A[O]&&Do(O)&&A[O]!==k.tags[O]&&(M=!0,O==="highway"&&e.tagnosticRoadCombine&&!window.mocha&&(M=!1)):A[O]=k.tags[O]}),T)return T.isRestriction()?"restriction":"connectivity";if(M)return"conflicting_tags"},r}function Cg(t){function e(r){var s=t.map(function(n){return r.entity(n)});return Object.assign({point:[],area:[],line:[],relation:[]},ds(s,function(n){return n.geometry(r)}))}var i=function(r){var s=e(r),n=s.area[0]||s.line[0],o=s.point;if(o.forEach(function(l){n=n.mergeTags(l.tags),r=r.replace(n),r.parentRelations(l).forEach(function(_){r=r.replace(_.replaceMember(l,n))});for(var u=Ei(r.childNodes(n)),d=l,m=0;m<u.length;m++){var g=u[m];if(!(r.parentWays(g).length>1||r.parentRelations(g).length||g.hasInterestingTags())){r=r.replace(l.update({tags:{},loc:g.loc})),n=n.replaceNode(g.id,l.id),r=r.replace(n),d=g;break}}r=r.remove(d)}),n.tags.area==="yes"){var a=Object.assign({},n.tags);delete a.area,A1(a)&&(n=n.update({tags:a}),r=r.replace(n))}return r};return i.disabled=function(r){var s=e(r);if(s.point.length===0||s.area.length+s.line.length!==1||s.relation.length!==0)return"not_eligible"},i}function Xa(t,e){function i(s){if(!t.length)return null;for(var n=[0,0],o=0,a,l=0;l<t.length;l++){var u=s.entity(t[l]);u.hasInterestingTags()&&(a=++o===1?u.loc:null),n=Sr(n,u.loc)}return a||Uo(n,1/t.length)}var r=function(s){if(t.length<2)return s;var n=e;n||(n=i(s));for(var o=0;o<t.length;o++){var a=s.entity(t[o]);a.loc!==n&&(s=s.replace(a.move(n)))}return Ud(t)(s)};return r.disabled=function(s){if(t.length<2)return"not_eligible";for(var n=0;n<t.length;n++){var o=s.entity(t[n]);if(o.type!=="node")return"not_eligible"}return Ud(t).disabled(s)},r}function Jo(){if(this instanceof Jo)arguments.length&&this.initialize(arguments);else return new Jo().initialize(arguments)}Dt.changeset=Jo;Jo.prototype=Object.create(Dt.prototype);Object.assign(Jo.prototype,{type:"changeset",extent:function(){return new new mt()},geometry:function(){return"changeset"},asJXON:function(){return{osm:{changeset:{tag:Object.keys(this.tags).map(function(t){return{"@k":t,"@v":this.tags[t]}},this),"@version":.6,"@generator":"Rapid"}}}},osmChangeJXON:function(t){var e=this.id;function i(n,o){for(var a={},l=0;l<n.length;l++){var u=Object.keys(n[l])[0];a[u]||(a[u]=[]),a[u].push(n[l][u])}var d={};return o.forEach(function(m){a[m]&&(d[m]=a[m])}),d}function r(n){function o(E){return d.find(function(b){return E.keyAttributes.type==="relation"&&E.keyAttributes.ref===b["@id"]})}function a(E){return!u[E["@id"]]&&!l.find(function(b){return b["@id"]===E["@id"]})}var l=[],u={},d=n.relation;if(!d)return n;for(var m=0;m<d.length;m++){var g=d[m];for(u[g["@id"]]||l.push(g);l.length>0;){var _=l[0],v=_.member.map(o).filter(Boolean).filter(a);v.length===0?(u[_["@id"]]=_,l.shift()):l=v.concat(l)}}return n.relation=Object.values(u),n}function s(n){return n.asJXON(e)}return{osmChange:{"@version":.6,"@generator":"Rapid",create:r(i(t.created.map(s),["node","way","relation"])),modify:i(t.modified.map(s),["node","way","relation"]),delete:Object.assign(i(t.deleted.map(s),["relation","way","node"]),{"@if-unused":!0})}}},asGeoJSON:function(){return{}}});function Fr(){if(this instanceof Fr)arguments.length&&this.initialize(arguments);else return new Fr().initialize(arguments)}Fr.id=function(){return Fr.id.next--};Fr.id.next=-1;Object.assign(Fr.prototype,{type:"note",initialize:function(t){for(var e=0;e<t.length;++e){var i=t[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(i[r]===void 0?delete this[r]:this[r]=i[r])}return this.id||(this.id=Fr.id().toString()),this},extent:function(){return new mt(this.loc)},update:function(t){return Fr(this,t)},isNew:function(){return this.id<0},move:function(t){return this.update({loc:t})}});function Cs(){if(this instanceof Cs)arguments.length&&this.initialize(arguments);else return new Cs().initialize(arguments)}Dt.relation=Cs;Cs.prototype=Object.create(Dt.prototype);Cs.creationOrder=function(t,e){var i=parseInt(Dt.id.toOSM(t.id),10),r=parseInt(Dt.id.toOSM(e.id),10);return i<0||r<0?i-r:r-i};Object.assign(Cs.prototype,{type:"relation",members:[],copy:function(t,e){if(e[this.id])return e[this.id];var i=Dt.prototype.copy.call(this,t,e),r=this.members.map(function(s){return Object.assign({},s,{id:t.entity(s.id).copy(t,e).id})});return i=i.update({members:r}),e[this.id]=i,i},extent:function(t,e){return t.transient(this,"extent",function(){if(e&&e[this.id])return new mt;e=e||{},e[this.id]=!0;for(var i=new mt,r=0;r<this.members.length;r++){var s=t.hasEntity(this.members[r].id);s&&(i=i.extend(s.extent(t,e)))}return i})},geometry:function(t){return t.transient(this,"geometry",function(){return this.isMultipolygon()?"area":"relation"})},isDegenerate:function(){return this.members.length===0},indexedMembers:function(){for(var t=new Array(this.members.length),e=0;e<this.members.length;e++)t[e]=Object.assign({},this.members[e],{index:e});return t},memberByRole:function(t){for(var e=0;e<this.members.length;e++)if(this.members[e].role===t)return Object.assign({},this.members[e],{index:e})},membersByRole:function(t){for(var e=[],i=0;i<this.members.length;i++)this.members[i].role===t&&e.push(Object.assign({},this.members[i],{index:i}));return e},memberById:function(t){for(var e=0;e<this.members.length;e++)if(this.members[e].id===t)return Object.assign({},this.members[e],{index:e})},memberByIdAndRole:function(t,e){for(var i=0;i<this.members.length;i++)if(this.members[i].id===t&&this.members[i].role===e)return Object.assign({},this.members[i],{index:i})},addMember:function(t,e){var i=this.members.slice();return i.splice(e===void 0?i.length:e,0,t),this.update({members:i})},updateMember:function(t,e){var i=this.members.slice();return i.splice(e,1,Object.assign({},i[e],t)),this.update({members:i})},removeMember:function(t){var e=this.members.slice();return e.splice(t,1),this.update({members:e})},removeMembersWithID:function(t){var e=this.members.filter(function(i){return i.id!==t});return this.update({members:e})},moveMember:function(t,e){var i=this.members.slice();return i.splice(e,0,i.splice(t,1)[0]),this.update({members:i})},replaceMember:function(t,e,i){if(!this.memberById(t.id))return this;for(var r=[],s=0;s<this.members.length;s++){var n=this.members[s];n.id!==t.id?r.push(n):(i||!this.memberByIdAndRole(e.id,n.role))&&r.push({id:e.id,type:e.type,role:n.role})}return this.update({members:r})},asJXON:function(t){var e={relation:{"@id":this.osmId(),"@version":this.version||0,member:this.members.map(function(i){return{keyAttributes:{type:i.type,role:i.role,ref:Dt.id.toOSM(i.id)}}},this),tag:Object.keys(this.tags).map(function(i){return{keyAttributes:{k:i,v:this.tags[i]}}},this)}};return t&&(e.relation["@changeset"]=t),e},asGeoJSON:function(t){return t.transient(this,"GeoJSON",function(){return this.isMultipolygon()?{type:"MultiPolygon",coordinates:this.multipolygon(t)}:{type:"FeatureCollection",properties:this.tags,features:this.members.map(function(e){return Object.assign({role:e.role},t.entity(e.id).asGeoJSON(t))})}})},area:function(t){return t.transient(this,"area",function(){return Sc(this.asGeoJSON(t))})},isMultipolygon:function(){return this.tags.type==="multipolygon"},isComplete:function(t){for(var e=0;e<this.members.length;e++)if(!t.hasEntity(this.members[e].id))return!1;return!0},hasFromViaTo:function(){return this.members.some(function(t){return t.role==="from"})&&this.members.some(function(t){return t.role==="via"})&&this.members.some(function(t){return t.role==="to"})},isRestriction:function(){return!!(this.tags.type&&this.tags.type.match(/^restriction:?/))},isValidRestriction:function(){if(!this.isRestriction())return!1;var t=this.members.filter(function(r){return r.role==="from"}),e=this.members.filter(function(r){return r.role==="via"}),i=this.members.filter(function(r){return r.role==="to"});return!(t.length!==1&&this.tags.restriction!=="no_entry"||t.some(function(r){return r.type!=="way"})||i.length!==1&&this.tags.restriction!=="no_exit"||i.some(function(r){return r.type!=="way"})||e.length===0||e.length>1&&e.some(function(r){return r.type!=="way"}))},isConnectivity:function(){return!!(this.tags.type&&this.tags.type.match(/^connectivity:?/))},multipolygon:function(t){var e=this.members.filter(function(u){return(u.role||"outer")==="outer"}),i=this.members.filter(function(u){return u.role==="inner"});e=xa(e,t),i=xa(i,t);var r=function(u){return u.nodes.length>2&&u.nodes[0]!==u.nodes[u.nodes.length-1]&&u.nodes.push(u.nodes[0]),u.nodes.map(function(d){return d.loc})};e=e.map(r),i=i.map(r);var s=e.map(function(u){return[Sc({type:"Polygon",coordinates:[u]})>2*Math.PI?u.reverse():u]});function n(u){var d,m;for(d=0;d<e.length;d++)if(m=e[d],Nf(m,u))return d;for(d=0;d<e.length;d++)if(m=e[d],eP(m,u,!1))return d}for(var o=0;o<i.length;o++){var a=i[o];Sc({type:"Polygon",coordinates:[a]})<2*Math.PI&&(a=a.reverse());var l=n(i[o]);l!==void 0?s[l].push(i[o]):s.push([i[o]])}return s}});var vr=class t{constructor(e,i,r,s,n){this.loc=e,this.service=i.id,this.itemType=r,this.id=s||`${t.id()}`,this.update(n),i&&typeof i.getIcon=="function"&&(this.icon=i.getIcon(r))}update(e){let{loc:i,service:r,itemType:s,id:n}=this;return Object.keys(e).forEach(o=>this[o]=e[o]),this.loc=i,this.service=r,this.itemType=s,this.id=n,this}static id(){return this.nextId--}};vr.nextId=-1;function ju(t,e){typeof t=="string"&&(t=[t]);var i,r="longest",s=[];function n(d,m,g){var _=d.entity(m).loc,v=d.entity(g).loc,E=1e-6;return _&&v?fr(_,v):E}function o(d,m,g){var _=new Array(d.length),v,E,b=0,T;function A(k){return F2(k,d.length)}for(v=0,E=A(m+1);E!==m;E=A(E+1))v+=n(g,d[E],d[A(E-1)]),_[E]=v;for(v=0,E=A(m-1);E!==m;E=A(E-1))v+=n(g,d[E],d[A(E+1)]),v<_[E]&&(_[E]=v);for(E=0;E<d.length;E++){var M=_[E]/n(g,d[m],d[E]);M>b&&(T=E,b=M)}return T}function a(d,m){for(var g=0,_=0;_<m.length-1;_++)g+=n(d,m[_],m[_+1]);return g}function l(d,m,g,_){var v=Cr({id:_,tags:g.tags}),E=g.nodes.slice(),b,T,A=g.isArea(),M=B2(g,d);if(g.isClosed()){var k=g.nodes.slice(0,-1),F=k.indexOf(m),O=o(k,F,d);O<F?(b=k.slice(F).concat(k.slice(0,O+1)),T=k.slice(O,F+1)):(b=k.slice(F,O+1),T=k.slice(O).concat(k.slice(0,F+1)))}else{var B=g.nodes.indexOf(m,1);b=g.nodes.slice(0,B+1),T=g.nodes.slice(B)}var U=a(d,b),$=a(d,T);if(r==="longest"&&$>U){g=g.update({nodes:T}),v=v.update({nodes:b});var q=U;U=$,$=q}else g=g.update({nodes:b}),v=v.update({nodes:T});if(g.tags.step_count){var W=parseFloat(g.tags.step_count);if(W&&isFinite(W)&&W>0&&Math.round(W)===W){var Z=Object.assign({},g.tags),Q=Object.assign({},v.tags),X=U/(U+$),ce=Math.round(W*X);Z.step_count=ce.toString(),Q.step_count=(W-ce).toString(),g=g.update({tags:Z}),v=v.update({tags:Q})}}if(d=d.replace(g),d=d.replace(v),d.parentRelations(g).forEach(function(le){var te;if(le.hasFromViaTo()){var ee=le.memberByRole("from"),oe=le.membersByRole("via"),ie=le.memberByRole("to"),ne;if(ee.id===g.id||ie.id===g.id){var me=!1;if(oe.length===1&&oe[0].type==="node")me=v.contains(oe[0].id);else for(ne=0;ne<oe.length;ne++)if(oe[ne].type==="way"){var De=d.hasEntity(oe[ne].id);if(De&&Yn(v.nodes,De.nodes).length){me=!0;break}}me&&(le=le.replaceMember(g,v),d=d.replace(le))}else for(ne=0;ne<oe.length;ne++)if(oe[ne].type==="way"&&oe[ne].id===g.id){te={id:v.id,type:"way",role:"via"},d=Bd(le.id,te,oe[ne].index+1)(d);break}}else{le===M&&(d=d.replace(le.mergeTags(g.tags)),d=d.replace(g.update({tags:{}})),d=d.replace(v.update({tags:{}}))),te={id:v.id,type:"way",role:le.memberById(g.id).role};var He={originalID:g.id,insertedID:v.id,nodes:E};d=Bd(le.id,te,void 0,He)(d)}}),!M&&A){var de=Cs({tags:Object.assign({},g.tags,{type:"multipolygon"}),members:[{id:g.id,role:"outer",type:"way"},{id:v.id,role:"outer",type:"way"}]});d=d.replace(de),d=d.replace(g.update({tags:{}})),d=d.replace(v.update({tags:{}}))}return s.push(v.id),d}var u=function(d){s=[];for(var m=0,g=0;g<t.length;g++)for(var _=t[g],v=u.waysForNode(_,d),E=0;E<v.length;E++)d=l(d,_,v[E],e&&e[m]),m+=1;return d};return u.getCreatedWayIDs=function(){return s},u.waysForNode=function(d,m){var g=m.entity(d),_=m.parentWays(g).filter(E);if(!i){var v=_.some(function(b){return b.geometry(m)==="line"});if(v)return _.filter(function(b){return b.geometry(m)==="line"})}return _;function E(b){if(i&&i.indexOf(b.id)===-1)return!1;if(b.isClosed())return!0;for(var T=1;T<b.nodes.length-1;T++)if(b.nodes[T]===d)return!0;return!1}},u.ways=function(d){return Ei([].concat.apply([],t.map(function(m){return u.waysForNode(m,d)})))},u.disabled=function(d){for(var m=0;m<t.length;m++){var g=t[m],_=u.waysForNode(g,d);if(_.length===0||i&&i.length!==_.length)return"not_eligible"}},u.limitWays=function(d){return arguments.length?(i=d,u):i},u.keepHistoryOn=function(d){return arguments.length?(r=d,u):r},u}var WX=50,zc=class t{constructor(e,i){this.context=e,this.array=i,this._memo=new Map}item(e){let i=this._memo.get(e);return i||(i=this.array.find(r=>r.id===e),i&&this._memo.set(e,i),i)}index(e){return this.array.findIndex(i=>i.id===e)}matchGeometry(e){let i=this.array.filter(r=>r.matchGeometry(e));return new t(this.context,i)}matchAllGeometry(e){let i=this.array.filter(r=>r&&r.matchAllGeometry(e));return new t(this.context,i)}fallback(e){let i=e;return i==="vertex"&&(i="point"),this.item(i)}search(e,i,r){if(!e)return this;e=e.toLowerCase().trim();function s(F){let O=F.indexOf(e);return O===0||F[O-1]===" "}function n(F){return F.indexOf(e)===0}function o(F){return function(B,U){let $=B[F](),q=U[F]();if(e===$)return-1;if(e===q)return 1;let W=U.orig.matchScore-B.orig.matchScore;return W!==0||(W=$.indexOf(e)-q.indexOf(e),W!==0)?W:$.length-q.length}}let a=this.array;if(Array.isArray(r)){let O=this.context.systems.locations.locationSetsAt(r);a=a.filter(B=>!B.locationSetID||O[B.locationSetID])}let l=a.filter(F=>F.searchable!==!1&&F.suggestion!==!0),u=a.filter(F=>F.suggestion===!0),d=l.filter(F=>s(F.searchName())).sort(o("searchName")),m=u.filter(F=>n(F.searchName())).sort(o("searchName")),g=l.filter(F=>s(F.searchNameStripped())).sort(o("searchNameStripped")),_=u.filter(F=>n(F.searchNameStripped())).sort(o("searchNameStripped")),v=l.filter(F=>(F.terms()||[]).some(s)),E=u.filter(F=>(F.terms()||[]).some(s)),b=l.filter(F=>Object.values(F.tags||{}).filter(O=>O!=="*").some(s)),T=l.map(F=>({preset:F,dist:v9(e,F.searchName())})).filter(F=>F.dist+Math.min(e.length-F.preset.searchName().length,0)<3).sort((F,O)=>F.dist-O.dist).map(F=>F.preset),A=u.map(F=>({preset:F,dist:v9(e,F.searchName())})).filter(F=>F.dist+Math.min(e.length-F.preset.searchName().length,0)<1).sort((F,O)=>F.dist-O.dist).map(F=>F.preset),M=l.filter(F=>(F.terms()||[]).some(O=>v9(e,O)+Math.min(e.length-O.length,0)<3)),k=d.concat(m,g,_,v,E,b,T,A,M).slice(0,WX-1);if(typeof i=="string"){let F=this.fallback(i);F&&k.push(F)}return new t(this.context,Ei(k))}};var G2=class{constructor(e,i,r,s={}){this.context=e,this.id=i,this.safeid=td(i),this.allPresets=s,this.orig={},this.orig.name=r.name??"",this.orig.icon=r.icon,this.orig.matchScore=-1,this.orig.members=r.members??[],Object.assign(this,un(this.orig,["name","matchScore","members"]));let n=this.orig.members.map(o=>s[o]).filter(Boolean);this.members=new zc(e,n),this.geometry=n.reduce((o,a)=>{for(let l in a.geometry){let u=a.geometry[l];o.indexOf(u)===-1&&o.push(u)}return o},[]),this._searchName=null,this._searchNameStripped=null}matchGeometry(e){return this.geometry.includes(e)}matchAllGeometry(e){return this.members.array.some(i=>i.matchAllGeometry(e))}matchScore(){return-1}name(){return this.context.systems.l10n.t(`_tagging.presets.categories.${this.id}.name`,{default:this.id})}nameLabel(){return this.context.systems.l10n.tHtml(`_tagging.presets.categories.${this.id}.name`,{default:this.id})}terms(){return[]}searchName(){return this._searchName||(this._searchName=this.name().toLowerCase()),this._searchName}searchNameStripped(){return this._searchNameStripped||(this._searchNameStripped=this._stripDiacritics(this.searchName())),this._searchNameStripped}searchAliases(){return[]}searchAliasesStripped(){return[]}isFallback(){return!1}_stripDiacritics(e){return e.normalize&&(e=e.normalize("NFD")),e=e.replace(/[\u0300-\u036f]/g,""),e}};var cm=Xi($2(),1);var Wa=class{constructor(e,i){this._base=e,this._head=i,this._changes=new Map,this.didChange={};let r=new Set([...i.local.entities.keys(),...e.local.entities.keys()]);for(let s of r){let n=i.hasEntity(s),o=e.hasEntity(s);if(n!==o){if(o&&!n){this._changes.set(s,{base:o,head:n}),this.didChange.deletion=!0;continue}if(!o&&n){this._changes.set(s,{base:o,head:n}),this.didChange.addition=!0;continue}if(n&&o){if(n.members&&o.members&&!(0,cm.default)(n.members,o.members)){this._changes.set(s,{base:o,head:n}),this.didChange.geometry=!0,this.didChange.properties=!0;continue}n.loc&&o.loc&&!Wi(n.loc,o.loc)&&(this._changes.set(s,{base:o,head:n}),this.didChange.geometry=!0),n.nodes&&o.nodes&&!(0,cm.default)(n.nodes,o.nodes)&&(this._changes.set(s,{base:o,head:n}),this.didChange.geometry=!0),n.tags&&o.tags&&!(0,cm.default)(n.tags,o.tags)&&(this._changes.set(s,{base:o,head:n}),this.didChange.properties=!0)}}}}get changes(){return this._changes}modified(){let e=[];for(let i of this._changes.values())i.base&&i.head&&e.push(i.head);return e}created(){let e=[];for(let i of this._changes.values())!i.base&&i.head&&e.push(i.head);return e}deleted(){let e=[];for(let i of this._changes.values())i.base&&!i.head&&e.push(i.base);return e}summary(){let e=this._base,i=this._head,r=new Map;for(let n of this._changes.values()){let o=n.head,a=n.base;if(o&&o.geometry(i)!=="vertex")s(o,i,a?"modified":"created");else if(a&&a.geometry(e)!=="vertex")s(a,e,"deleted");else if(a&&o){let l=!Wi(a.loc,o.loc),u=!(0,cm.default)(a.tags,o.tags);if(l)for(let d of i.parentWays(o))r.has(d.id)||s(d,i,"modified");(u||l&&o.hasInterestingTags())&&s(o,i,"modified")}else o&&o.hasInterestingTags()?s(o,i,"created"):a&&a.hasInterestingTags()&&s(a,e,"deleted")}return r;function s(n,o,a){r.set(n.id,{entity:n,graph:o,changeType:a})}}complete(){let e=this._head,i=new Map;for(let[s,n]of this._changes){let o=n.head,a=n.base,l=o||a;if(i.set(s,o),l.type==="way"){let u=o?o.nodes:[],d=a?a.nodes:[];for(let m of ss(u,d))i.set(m,e.hasEntity(m))}if(l.type==="relation"&&l.isMultipolygon()){let u=o?o.members.map(m=>m.id):[],d=a?a.members.map(m=>m.id):[];for(let m of ss(u,d)){let g=e.hasEntity(m);g&&i.set(m,g)}}r(e.parentWays(l),i),r(e.parentRelations(l),i)}return i;function r(s){for(let n of s)i.has(n.id)||(i.set(n.id,n),r(e.parentRelations(n)))}}};var Il=class{constructor(e,i){this.context=e,this._id=i.id,this._idtx=i.id.replace(/\./g,"<TX_DOT>"),this._name=i.name,this._description=i.description,this._template=i.encrypted?TI(i.template):i.template,this.best=!!i.best,this.endDate=i.endDate,this.icon=i.icon,this.overlay=i.overlay,this.overzoom=i.overzoom!==!1,this.polygon=i.polygon,this.projection=i.projection,this.startDate=i.startDate,this.terms_html=i.terms_html,this.terms_text=i.terms_text,this.terms_url=i.terms_url,this.tileSize=i.tileSize||256,this.type=i.type,this.zoomExtent=i.zoomExtent||[0,22],this.isBlocked=!1,this.offset=[0,0]}get id(){return this._id}get idtx(){return this._idtx}get name(){return this.context.systems.l10n.t(`imagery.${this._idtx}.name`,{default:this._name})}get label(){return this.context.systems.l10n.tHtml(`imagery.${this._idtx}.name`,{default:this._name})}get description(){return this.context.systems.l10n.tHtml(`imagery.${this._idtx}.description`,{default:this._description})}get imageryUsed(){return this._name||this._id}get template(){return this._template}get area(){if(!this.polygon)return Number.MAX_VALUE;let e=Sc({type:"MultiPolygon",coordinates:[this.polygon]});return isNaN(e)?0:e}validZoom(e){return this.zoomExtent[0]<=e&&(this.overzoom||this.zoomExtent[1]>e)}isLocatorOverlay(){return this._id==="mapbox_locator_overlay"}copyrightNotices(){}getMetadata(e,i,r){let s={start:this._localeDateString(this.startDate),end:this._localeDateString(this.endDate)};s.range=this._vintageRange(s),r(null,{vintage:s})}nudge(e,i){return this.offset[0]+=e[0]/Math.pow(2,i),this.offset[1]+=e[1]/Math.pow(2,i),this}url(e){let i=this._template;if(i==="")return i;function r(s,n,o,a){let l=Math.pow(2,a),u=n/l*Math.PI*2-Math.PI,d=Math.atan(Math.sinh(Math.PI*(1-2*o/l))),m;switch(s){case"EPSG:4326":return{x:u*180/Math.PI,y:d*180/Math.PI};default:return m=Tf(u,d),{x:2003750834e-2/Math.PI*m[0],y:2003750834e-2/Math.PI*m[1]}}}if(this.type||(/SERVICE=WMS|\{(proj|wkid|bbox)\}/.test(this._template)?(this.type="wms",this.projection="EPSG:3857"):/\{(x|y)\}/.test(this._template)?this.type="tms":/\{u\}/.test(this._template)&&(this.type="bing")),this.type==="wms"){let s=this.tileSize,n=this.projection,o=r(n,e[0],e[1],e[2]),a=r(n,e[0]+1,e[1]+1,e[2]);i=i.replace(/\{(\w+)\}/g,(l,u)=>{switch(u){case"width":case"height":return s;case"proj":return n;case"wkid":return n.replace(/^EPSG:/,"");case"bbox":return n==="EPSG:4326"&&/VERSION=1.3|CRS={proj}/.test(this._template.toUpperCase())?a.y+","+o.x+","+o.y+","+a.x:o.x+","+a.y+","+a.x+","+o.y;case"w":return o.x;case"s":return a.y;case"n":return a.x;case"e":return o.y;default:return l}})}else if(this.type==="tms"){let s=window.devicePixelRatio&&window.devicePixelRatio>=2;i=i.replace("{x}",e[0]).replace("{y}",e[1]).replace(/\{[t-]y\}/,Math.pow(2,e[2])-e[1]-1).replace(/\{z(oom)?\}/,e[2]).replace(/\{@2x\}|\{r\}/,s?"@2x":"")}else this.type==="bing"&&(i=i.replace("{u}",()=>{let s="";for(let n=e[2];n>0;n--){let o=0,a=1<<n-1;e[0]&a&&o++,e[1]&a&&(o+=2),s+=o.toString()}return s}));return i=i.replace(/\{switch:([^}]+)\}/,(s,n)=>{let o=n.split(",");return o[(e[0]+e[1])%o.length]}),i}_localeDateString(e){if(!e)return null;let i={day:"numeric",month:"short",year:"numeric"},r=new Date(e);if(isNaN(r.getTime()))return null;let s=this.context.localizationSystem.localeCode();return r.toLocaleDateString(s,i)}_vintageRange(e){let i;return(e.start||e.end)&&(i=e.start||"?",e.start!==e.end&&(i+=" - "+(e.end||"?"))),i}},H2=class extends Il{constructor(e){super(e,{id:"none",template:""})}get name(){return this.context.systems.l10n.t("background.none")}get label(){return this.context.systems.l10n.tHtml("background.none")}get area(){return-1}get imageryUsed(){return null}},V2=class extends Il{constructor(e,i=""){super(e,{id:"custom",template:i})}get name(){return this.context.systems.l10n.t("background.custom")}get label(){return this.context.systems.l10n.tHtml("background.custom")}get area(){return-2}get imageryUsed(){let e=this._template;if(e.indexOf("?")!==-1){let i=e.split("?",2),r=ed(i[1]);["access_token","connectId","token"].forEach(s=>{r[s]&&(r[s]="{apikey}")}),e=i[0]+"?"+nr(r,!0)}return e=e.replace(/token\/(\w+)/,"token/{apikey}"),`Custom (${e} )`}set template(e){this._template=e}get template(){return this._template}},j2=class extends Il{constructor(e,i){super(e,i),this._template="https://ecn.t{switch:0,1,2,3}.tiles.virtualearth.net/tiles/a{u}.jpeg?g=1&pr=odbl&n=z",this.terms_url="https://blog.openstreetmap.org/2010/11/30/microsoft-imagery-details"}},X2=class extends Il{constructor(e,i){super(e,i),/blankTile/.test(this._template)||(this._template+="?blankTile=false"),this._cache={},this._inflight={},this._prevCenter=null}fetchTilemap(e){if(this._prevCenter&&fr(e,this._prevCenter)<5e3)return;this._prevCenter=e;let i=this.url([1,2,3]),r=20,s=Math.floor((e[0]+180)/360*Math.pow(2,r)),n=Math.floor((1-Math.log(Math.tan(e[1]*Math.PI/180)+1/Math.cos(e[1]*Math.PI/180))/Math.PI)/2*Math.pow(2,r)),o=i.replace(/tile\/[0-9]+\/[0-9]+\/[0-9]+\?blankTile=false/,"tilemap")+"/"+r+"/"+n+"/"+s+"/8/8";fetch(o).then(Ai).then(a=>{if(!a)throw new Error("Unknown Error");let l=!0;for(let u=0;u<a.data.length;u++)if(!a.data[u]){l=!1;break}this.zoomExtent[1]=l?22:19}).catch(a=>console.error(a))}getMetadata(e,i,r){let s=i.slice(0,3).join("/"),n=Math.min(i[2],this.zoomExtent[1]),o=e[0]+","+e[1],a=this.context.systems.l10n.t("info_panels.background.unknown");if(this._inflight[s])return;let l;switch(!0){case(n>=20&&this._id==="EsriWorldImageryClarity"):l=4;break;case n>=19:l=3;break;case n>=17:l=2;break;case n>=13:l=0;break;default:l=99}let u;if(this._id==="EsriWorldImagery")u="https://services.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/";else if(this._id==="EsriWorldImageryClarity")u="https://serviceslab.arcgisonline.com/arcgis/rest/services/Clarity_World_Imagery/MapServer/";else return;if(u+=l+"/query?returnGeometry=false&geometry="+o+"&inSR=4326&geometryType=esriGeometryPoint&outFields=*&f=json",this._cache[s]||(this._cache[s]={}),this._cache[s]&&this._cache[s].metadata)return r(null,this._cache[s].metadata);let d={},m={};l===99?(d={start:null,end:null,range:null},m={vintage:null,source:a,description:a,resolution:a,accuracy:a},r(null,m)):(this._inflight[s]=!0,fetch(u).then(Ai).then(_=>{if(delete this._inflight[s],_){if(_.features&&_.features.length<1)throw new Error("No Results");if(_.error&&_.error.message)throw new Error(_.error.message)}else throw new Error("Unknown Error");let v=this._localeDateString(_.features[0].attributes.SRC_DATE2);d={start:v,end:v,range:v},m={vintage:d,source:g(_.features[0].attributes.NICE_NAME),description:g(_.features[0].attributes.NICE_DESC),resolution:g(+parseFloat(_.features[0].attributes.SRC_RES).toFixed(4)),accuracy:g(+parseFloat(_.features[0].attributes.SRC_ACC).toFixed(4))},isFinite(m.resolution)&&(m.resolution+=" m"),isFinite(m.accuracy)&&(m.accuracy+=" m"),this._cache[s].metadata=m,r&&r(null,m)}).catch(_=>{delete this._inflight[s],r&&r(_.message)}));function g(_){return String(_).trim()||a}}};var W2=class{constructor(e,i,r,s={}){this.context=e,this.id=i,this.safeid=td(i),this.allFields=s,this.orig={},this.orig.autoSuggestions=r.autoSuggestions??!0,this.orig.caseSensitive=r.caseSensitive??!1,this.orig.customValues=r.customValues??!0,this.orig.default=r.default,this.orig.geometry=r.geometry,this.orig.icon=r.icon,this.orig.increment=r.increment??1,this.orig.key=r.key,this.orig.keys=r.keys??[r.key],this.orig.label=r.label??"",this.orig.locationSet=r.locationSet,this.orig.maxValue=r.maxValue,this.orig.minValue=r.minValue,this.orig.options=r.options,this.orig.pattern=r.pattern,this.orig.placeholder=r.placeholder??"",this.orig.prerequisiteTag=r.prerequisiteTag,this.orig.reference=r.reference,this.orig.snake_case=r.snake_case??!0,this.orig.strings=r.strings,this.orig.terms=(r.terms??[]).join(),this.orig.type=r.type,this.orig.universal=r.universal??!1,this.orig.urlFormat=r.urlFormat,this.orig.usage=r.usage,Object.assign(this,un(this.orig,["increment","label","placeholder","terms"])),this.title=this.title.bind(this),this.label=this.label.bind(this),this.placeholder=this.placeholder.bind(this),this.terms=this.terms.bind(this)}increment(){return this.type==="number"?this.orig.increment:void 0}title(){return this._resolveReference("label").t("label",{default:this.id})}label(){return this._resolveReference("label").tHtml("label",{default:this.id})}placeholder(){return this._resolveReference("placeholder").t("placeholder",{default:this.orig.placeholder})}terms(){return this._resolveReference("terms").t("terms",{default:this.orig.terms}).toLowerCase().trim().split(/\s*,+\s*/)}matchGeometry(e){return!this.geometry||this.geometry.indexOf(e)!==-1}matchAllGeometry(e){return!this.geometry||e.every(i=>this.geometry.indexOf(i)!==-1)}t(e,i){return this.context.systems.l10n.t(`_tagging.presets.fields.${this.id}.${e}`,i)}tHtml(e,i){return this.context.systems.l10n.tHtml(`_tagging.presets.fields.${this.id}.${e}`,i)}tAppend(e,i){return this.context.systems.l10n.tAppend(`_tagging.presets.fields.${this.id}.${e}`,i)}hasTextForStringID(e){return this.context.systems.l10n.hasTextForStringID(`_tagging.presets.fields.${this.id}.${e}`)}_resolveReference(e){let r=(this.orig[e]||"").match(/^\{(.*)\}$/);if(r){let s=this.allFields[r[1]];if(s)return s;console.error(`Unable to resolve referenced field: ${r[1]}`)}return this}};var vn=class t{constructor(e,i){e instanceof t?(this._base=e._base,this._local={entities:new Map(e._local.entities),parentWays:new Map(e._local.parentWays),parentRels:new Map(e._local.parentRels)}):(this._base={entities:new Map,parentWays:new Map,parentRels:new Map},this._local={entities:new Map,parentWays:new Map,parentRels:new Map},this.rebase(e||[],[this])),this._transients=new Map,this._childNodes=new Map,this._frozen=!i}get base(){return this._base}get local(){return this._local}get frozen(){return this._frozen}hasEntity(e){let i=this._base.entities,r=this._local.entities;return r.has(e)?r.get(e):i.get(e)}entity(e){let i=this.hasEntity(e);if(!i)throw new Error(`Entity ${e} not found`);return i}geometry(e){return this.entity(e).geometry(this)}transient(e,i,r){let s=e.id,n=this._transients.get(s);n||(n=new Map,this._transients.set(s,n));let o=n.get(i);return o!==void 0||(o=r.call(e),n.set(i,o)),o}isPoi(e){if(e.type!=="node")return!1;let i=this._base.parentWays;return(this._local.parentWays.get(e.id)??i.get(e.id)??new Set).size===0}isShared(e){if(e.type!=="node")return!1;let i=this._base.parentWays,s=this._local.parentWays.get(e.id)??i.get(e.id)??new Set;if(s.size===0)return!1;if(s.size>1)return!0;let n=[...s][0],o=this.entity(n),a=o.isClosed()?o.nodes.length-1:o.nodes.length;for(let l=0,u=0;l<a;l++)if(e.id===o.nodes[l]&&u++,u>1)return!0;return!1}parentWays(e){let i=this._base.parentWays,s=this._local.parentWays.get(e.id)??i.get(e.id)??new Set;return Array.from(s).map(n=>this.entity(n))}parentRelations(e){let i=this._base.parentRels,s=this._local.parentRels.get(e.id)??i.get(e.id)??new Set;return Array.from(s).map(n=>this.entity(n))}parentMultipolygons(e){return this.parentRelations(e).filter(i=>i.isMultipolygon())}childNodes(e){if(!e.nodes)return[];let i=this._childNodes.get(e.id);if(i)return i;i=new Array(e.nodes.length);for(let r=0;r<e.nodes.length;++r)i[r]=this.entity(e.nodes[r]);return this._childNodes.set(e.id,i),i}rebase(e,i,r){let s=this._base,n=i[i.length-1]._local.entities,o=new Set;for(let a of e)if(!(!a.visible||!r&&s.entities.has(a.id))&&(s.entities.set(a.id,a),this._updateCalculated(void 0,a,s.parentWays,s.parentRels),a.type==="way"))for(let l of a.nodes)n.has(l)&&n.get(l)===void 0&&o.add(l);for(let a of i){let l=a._local.entities;for(let u of o)l.has(u)&&l.get(u)===void 0&&l.delete(u);a._updateRebased()}}_updateRebased(){let e=this._base,i=this._local;for(let[r,s]of i.parentWays){let n=e.parentWays.get(r);if(n)for(let o of n)i.entities.has(o)||s.add(o)}for(let[r,s]of i.parentRels){let n=e.parentRels.get(r);if(n)for(let o of n)i.entities.has(o)||s.add(o)}this._transients=new Map}_updateCalculated(e,i,r,s){let n=this._base,o=this._local;r=r||o.parentWays,s=s||o.parentRels;let a=i??e;if(!a)return;let l,u;if(a.type==="way"){e&&i?(l=_n(e.nodes,i.nodes),u=_n(i.nodes,e.nodes)):e?(l=e.nodes,u=[]):i&&(l=[],u=i.nodes);for(let d of l){let m=new Set(o.parentWays.get(d)??n.parentWays.get(d)??[]);m.delete(a.id),r.set(d,m)}for(let d of u){let m=new Set(o.parentWays.get(d)??n.parentWays.get(d)??[]);m.add(a.id),r.set(d,m)}}else if(a.type==="relation"){let d=e?e.members.map(g=>g.id):[],m=i?i.members.map(g=>g.id):[];e&&i?(l=_n(d,m),u=_n(m,d)):e?(l=d,u=[]):i&&(l=[],u=m);for(let g of l){let _=new Set(o.parentRels.get(g)??n.parentRels.get(g)??[]);_.delete(a.id),s.set(g,_)}for(let g of u){let _=new Set(o.parentRels.get(g)??n.parentRels.get(g)??[]);_.add(a.id),s.set(g,_)}}}replace(e){let i=e.id,r=this.hasEntity(i);return r===e?this:this.update(function(){this._updateCalculated(r,e),this._local.entities.set(i,e)})}remove(e){let i=e.id,r=this.hasEntity(i);return r?this.update(function(){this._updateCalculated(r,void 0),this._local.entities.set(i,void 0)}):this}revert(e){let i=this._base.entities.get(e),r=this.hasEntity(e);return r===i?this:this.update(function(){this._updateCalculated(r,i),this._local.entities.delete(e)})}update(...e){let i=this._frozen?new t(this,!0):this;for(let r of e)r.call(i,i);return this._frozen&&(i._frozen=!0),i}load(e){let i=this._base,r=this._local;r.entities=new Map;for(let[s,n]of Object.entries(e)){let o=i.entities.get(s);r.entities.set(s,n),this._updateCalculated(o,n)}return this}};var Gc=class{constructor(e,i,r,s={},n={}){this.context=e,this.id=i,this.safeid=td(i),this.allFields=s,this.allPresets=n,this.orig={},this.orig.addTags=r.addTags??r.tags??{},this.orig.aliases=r.aliases??[],this.orig.fields=r.fields??[],this.orig.geometry=r.geometry??[],this.orig.icon=r.icon,this.orig.imageURL=r.imageURL,this.orig.locationSet=r.locationSet,this.orig.matchScore=r.matchScore??1,this.orig.moreFields=r.moreFields??[],this.orig.name=r.name??"",this.orig.reference=r.reference??{},this.orig.removeTags=r.removeTags??r.addTags??r.tags??{},this.orig.replacement=r.replacement,this.orig.searchable=r.searchable??!0,this.orig.suggestion=r.suggestion,this.orig.tags=r.tags??{},this.orig.terms=(r.terms??[]).join(),Object.assign(this,un(this.orig,["aliases","fields","matchScore","moreFields","name","reference","terms"])),this._resolved={fields:null,moreFields:null},this._searchName=null,this._searchNameStripped=null,this._searchAliases=null,this._searchAliasesStripped=null}aliases(){return this._resolveName("name").t("aliases",{default:this.orig.aliases}).trim().split(/\s*[\r\n]+\s*/)}name(){return this._resolveName("name").t("name",{default:this.orig.name||this.id})}nameLabel(){return this._resolveName("name").tHtml("name",{default:this.orig.name||this.id})}fields(){return this._resolved.fields||(this._resolved.fields=this._resolveFields("fields"))}moreFields(){return this._resolved.moreFields||(this._resolved.moreFields=this._resolveFields("moreFields"))}resetFields(){return this._resolved={fields:null,moreFields:null}}matchGeometry(e){return this.geometry.includes(e)}matchAllGeometry(e){return e.every(i=>this.matchGeometry(i))}matchScore(e){let i=this.tags,r={},s=0;for(let o in i)if(r[o]=!0,e[o]===i[o])s+=this.orig.matchScore;else if(i[o]==="*"&&o in e)s+=this.orig.matchScore/2;else return-1;let n=this.addTags;for(let o in n)!r[o]&&e[o]===n[o]&&(s+=this.orig.matchScore);return s}t(e,i){return this.context.t(`_tagging.presets.presets.${this.id}.${e}`,i)}tHtml(e,i){return this.context.tHtml(`_tagging.presets.presets.${this.id}.${e}`,i)}tAppend(e,i){return this.context.tAppend(`_tagging.presets.presets.${this.id}.${e}`,i)}subtitle(){if(this.suggestion){let e=this.id.split("/");return e.pop(),this.context.t("_tagging.presets.presets."+e.join("/")+".name")}return null}subtitleLabel(){if(this.suggestion){let e=this.id.split("/");return e.pop(),this.context.tHtml("_tagging.presets.presets."+e.join("/")+".name")}return null}terms(){return this._resolveName("name").t("terms",{default:this.orig.terms}).toLowerCase().trim().split(/\s*,+\s*/)}searchName(){return this._searchName||(this._searchName=(this.suggestion?this.orig.name:this.name()).toLowerCase()),this._searchName}searchNameStripped(){return this._searchNameStripped||(this._searchNameStripped=this._stripDiacritics(this.searchName())),this._searchNameStripped}searchAliases(){return this._searchAliases||(this._searchAliases=this.aliases().map(e=>e.toLowerCase())),this._searchAliases}searchAliasesStripped(){return this._searchAliasesStripped||(this._searchAliasesStripped=this.searchAliases().map(this._stripDiacritics)),this._searchAliasesStripped}isFallback(){return["point","line","area","relation"].includes(this.id)}reference(){let e=this.tags.wikidata||this.tags["flag:wikidata"]||this.tags["brand:wikidata"]||this.tags["network:wikidata"]||this.tags["operator:wikidata"];if(e)return{qid:e};let i=this.orig.reference.key||Object.keys(un(this.tags,"name"))[0],r=this.orig.reference.value||this.tags[i];return r==="*"?{key:i}:{key:i,value:r}}unsetTags(e,i,r,s){let n=r?un(this.removeTags,r):this.removeTags;return e=un(e,Object.keys(n)),i&&!s&&this.fields().forEach(o=>{o.matchGeometry(i)&&o.key&&o.default===e[o.key]&&delete e[o.key]}),delete e.area,e}setTags(e,i,r){let s=this.addTags;e=Object.assign({},e);for(let n in s)s[n]==="*"?(this.tags[n]||!e[n]||e[n]==="no")&&(e[n]="yes"):e[n]=s[n];if(!s.hasOwnProperty("area")&&(delete e.area,i==="area")){let n=!0;if(this.geometry.indexOf("line")===-1){for(let o in s)if(o in id){n=!1;break}}n&&(e.area="yes")}return i&&!r&&this.fields().forEach(n=>{n.matchGeometry(i)&&n.key&&!e[n.key]&&n.default&&(e[n.key]=n.default)}),e}_stripDiacritics(e){return e.normalize&&(e=e.normalize("NFD")),e=e.replace(/[\u0300-\u036f]/g,""),e}_resolveName(e){let r=(this.orig[e]||"").match(/^\{(.*)\}$/);if(r){let s=this.allPresets[r[1]];if(s)return s;console.warn(`Unable to resolve referenced preset: ${r[1]}.${e}`)}return this}_resolveFields(e){let i=this.orig[e]||"",r=this,s=[];for(let a of i){let l=a.match(/^\{(.*)\}$/);l!==null?s=s.concat(n(l[1],e)):this.allFields[a]?s.push(this.allFields[a]):console.warn(`Cannot resolve "${a}" found in ${this.id}.${e}`)}if(!s.length){let a=this.id.lastIndexOf("/"),l=a&&this.id.substring(0,a);l&&(s=n(l,e))}return Ei(s);function n(a,l){let u=r.allPresets[a];return u?l==="fields"?u.fields().filter(o):l==="moreFields"?u.moreFields():[]:[]}function o(a){return!(a.key&&r.tags[a.key]!==void 0&&a.type!=="multiCombo"&&a.type!=="semiCombo"&&a.type!=="manyCombo"&&a.type!=="check")}}};var UE=Xi(kl(),1);var qa=class{constructor(e){this._current=e,this._entityRBush=new UE.default,this._entityBoxes=new Map,this._entitySegments=new Map,this._segmentRBush=new UE.default,this._segmentBoxes=new Map}_removeEntity(e){let i=this._entityBoxes.get(e);i&&(this._entityRBush.remove(i),this._entityBoxes.delete(e));let r=this._entitySegments.get(e)??[];for(let s of r){let n=s.id,o=this._segmentBoxes.get(n);o&&(this._segmentRBush.remove(o),this._segmentBoxes.delete(n))}this._entitySegments.delete(e)}_loadEntities(e){let i=this._current,r=[],s=[];for(let[n,o]of e){let a=o.extent(i);if(!a)continue;let l=a.bbox();if(l.id=n,this._entityBoxes.set(n,l),r.push(l),typeof o.segments!="function")continue;let u=o.segments(i)??[];this._entitySegments.set(n,u);for(let d of u){let m=d.id,g=d.extent(i);if(!g)continue;let _=g.bbox();_.id=m,_.segment=d,this._segmentBoxes.set(m,_),s.push(_)}}r.length&&this._entityRBush.load(r),s.length&&this._segmentRBush.load(s)}_includeParents(e,i,r){let s=this._current,n=e.id;if(r||(r=new Set),!r.has(n)){r.add(n);for(let o of s.parentWays(e))this._entityBoxes.has(o.id)&&(this._removeEntity(o.id),i.set(o.id,o)),this._includeParents(o,i,r);for(let o of s.parentRelations(e))this._entityBoxes.has(o.id)&&(this._removeEntity(o.id),i.set(o.id,o)),this._includeParents(o,i,r)}}_setCurrentGraph(e){if(e===this._current)return;let i=new Wa(this._current,e);this._current=e;let r=i.didChange;if(!r.addition&&!r.deletion&&!r.geometry)return;let s=new Map;if(r.deletion)for(let n of i.deleted())this._removeEntity(n.id);if(r.geometry)for(let n of i.modified())this._removeEntity(n.id),s.set(n.id,n),this._includeParents(n,s);if(r.addition)for(let n of i.created())s.set(n.id,n);this._loadEntities(s)}rebase(e,i){let s=this._current.local,n=new Map;for(let o of e){if(!o.visible)continue;let a=o.id;s.entities.has(a)&&s.entities.get(a)===void 0||this._entityBoxes.has(a)&&!i||(this._removeEntity(a),n.set(a,o),this._includeParents(o,n))}this._loadEntities(n)}intersects(e,i){return this._setCurrentGraph(i),this._entityRBush.search(e.bbox()).map(r=>i.entity(r.id))}waySegments(e,i){return this._setCurrentGraph(i),this._segmentRBush.search(e.bbox()).map(r=>r.segment)}};var Ti=class{constructor(e){this.title=e.title,this.onClick=e.onClick,this.disabledReason=e.disabledReason,this.icon=e.icon,this.entityIds=e.entityIds||[],this.issue=null}};var rr=class{constructor(e,i){this.context=e,this.type=i.type,this.subtype=i.subtype,this.severity=i.severity,this.message=i.message,this.reference=i.reference,this.entityIds=i.entityIds,this.loc=i.loc,this.data=i.data,this.dynamicFixes=i.dynamicFixes,this.hash=i.hash,this.id=this._generateID(),this.key=this._generateKey(),this.autoArgs=i.autoArgs,this.autoFix=null}extent(e){return this.loc?new mt(this.loc):this.entityIds&&this.entityIds.length?Ar(this.entityIds,e):null}fixes(){let e=typeof this.dynamicFixes=="function"?this.dynamicFixes():[];this.severity==="warning"&&e.push(new Ti({title:this.context.tHtml("issues.fix.ignore_issue.title"),icon:"rapid-icon-close",onClick:()=>{this.context.systems.validator.ignoreIssue(this.id)}}));for(let i of e)i.id=i.title,i.issue=this;return e}_generateID(){let e=[this.type];if(this.hash&&e.push(this.hash),this.subtype&&e.push(this.subtype),this.entityIds){let i=this.entityIds.slice().sort();e.push.apply(e,i)}return e.join(":")}_generateKey(){return this.id+":"+Date.now().toString()}};function um(t){if(!(this instanceof um))return new um(t);Object.assign(this,t)}function DD(t,e,i){i=i||30;var r=new vn,s,n,o;function a(ne){return t.parentRelations(ne).some(function(me){return me.isRestriction()})}function l(ne){if(ne.isArea()||ne.isDegenerate())return!1;var me={motorway:!0,motorway_link:!0,trunk:!0,trunk_link:!0,primary:!0,primary_link:!0,secondary:!0,secondary_link:!0,tertiary:!0,tertiary_link:!0,residential:!0,unclassified:!0,living_street:!0,service:!0,road:!0,track:!0};return me[ne.tags.highway]}for(var u=t.entity(e),d=[u],m,g=[],_=[],v,E=[],b=[],T,A=[],M,k=[],F,O=[];d.length;){v=d.pop(),m=t.parentWays(v);var B=!1;for(s=0;s<m.length;s++)if(T=m[s],!(!l(T)&&!a(T))){for(E.push(T),B=!0,A=Ei(t.childNodes(T)),n=0;n<A.length;n++)if(M=A[n],M!==v&&g.indexOf(M)===-1&&!(fr(M.loc,u.loc)>i)){var U=!1;for(k=t.parentWays(M),o=0;o<k.length;o++)if(F=k[o],F!==T&&E.indexOf(F)===-1&&l(F)){U=!0;break}U&&d.push(M)}}B&&g.push(v)}g=Ei(g),E=Ei(E),E.forEach(function(ne){t.childNodes(ne).forEach(function(me){r=r.replace(me)}),r=r.replace(ne),t.parentRelations(ne).forEach(function(me){me.isRestriction()&&(me.isValidRestriction(t)?r=r.replace(me):me.isComplete(t)&&O.push(pn(me.id)))})}),E.forEach(function(ne){var me=r.entity(ne.id);if(me.tags.oneway==="-1"){var De=pl(me.id,{reverseOneway:!0});O.push(De),r=De(r)}});var $=Dt.id.next.way;g.forEach(function(ne){var me=ju([ne.id]).keepHistoryOn("first");me.disabled(r)||me.ways(r).forEach(function(De){var He=ju([ne.id]).limitWays([De.id]).keepHistoryOn("first");O.push(He),r=He(r)})}),Dt.id.next.way=$,_=g.map(function(ne){return ne.id}),g=[],E=[],_.forEach(function(ne){var me=r.entity(ne),De=r.parentWays(me);g.push(me),E=E.concat(De)}),g=Ei(g),E=Ei(E),_=g.map(function(ne){return ne.id}),b=E.map(function(ne){return ne.id});function q(ne,me){var De=ne.isOneWay(),He=me.indexOf(ne.first())!==-1,Je=me.indexOf(ne.last())!==-1,ot=He&&Je,gt=He&&!De||Je,vt=He||Je&&!De;return ne.update({__first:He,__last:Je,__from:gt,__via:ot,__to:vt,__oneWay:De})}E=[],b.forEach(function(ne){var me=q(r.entity(ne),_);r=r.replace(me),E.push(me)});var W,Z=[],Q=[];do for(W=!1,d=_.slice(),s=0;s<d.length;s++){var X=d[s];if(v=r.hasEntity(X),!v){_.indexOf(X)!==-1&&_.splice(_.indexOf(X),1),Q.push(X);continue}if(k=r.parentWays(v),k.length<3&&_.indexOf(X)!==-1&&_.splice(_.indexOf(X),1),k.length===2){var ce=k[0],de=k[1],le=ce&&!ce.__via,te=de&&!de.__via,ee,oe;le&&!te?(ee=ce,oe=de):!le&&te&&(ee=de,oe=ce),ee&&oe&&(oe=q(oe,_),r=r.replace(oe).remove(ee),Z.push(ee.id),W=!0)}k=r.parentWays(v),k.length<2&&(_.indexOf(X)!==-1&&_.splice(_.indexOf(X),1),Q.push(X),W=!0),k.length<1&&(r=r.remove(v))}while(W);g=g.filter(function(ne){return Q.indexOf(ne.id)===-1}).map(function(ne){return r.entity(ne.id)}),E=E.filter(function(ne){return Z.indexOf(ne.id)===-1}).map(function(ne){return r.entity(ne.id)});var ie={graph:r,actions:O,vertices:g,ways:E};return ie.turns=function(ne,me){if(!ne)return[];me||(me=0);var De=ie.graph,He=ie.vertices.map(function(Se){return Se.id}),Je=De.entity(ne);if(!Je||!(Je.__from||Je.__via))return[];var ot=me*2+3,gt=[];return vt(Je),gt;function vt(Se,Qe,xt,It){if(Qe=(Qe||[]).slice(),!(Qe.length>=ot)){Qe.push(Se.id),xt=(xt||[]).slice();var Gt,Ni;if(Se.type==="node"){var je=De.parentWays(Se),be=[];for(Gt=0;Gt<je.length;Gt++){var ge=je[Gt];if(!(ge.__oneWay&&ge.nodes[0]!==Se.id)&&!(Qe.indexOf(ge.id)!==-1&&Qe.length>=3)){var xe=null;for(Ni=0;Ni<xt.length;Ni++){var Pe=xt[Ni],Oe=Pe.memberByRole("from"),Ie=Pe.membersByRole("via"),nt=Pe.memberByRole("to"),ht=/^only_/.test(Pe.tags.restriction),Ht=Oe.id===ne,hi=!1,at=!1;if(nt.id===ge.id)if(Ie.length===1&&Ie[0].type==="node")hi=Ie[0].id===Se.id&&(Ht&&Qe.length===2||!Ht&&Qe.length>2);else{var Ot=[];for(o=2;o<Qe.length;o+=2)Ot.push(Qe[o]);var Pt=[];for(o=0;o<Ie.length;o++)Ie[o].type==="way"&&Pt.push(Ie[o].id);var Zi=_n(Ot,Pt);hi=!Zi.length}else if(ht){for(o=0;o<Ie.length;o++)if(Ie[o].type==="way"&&Ie[o].id===ge.id){at=!0;break}}if(hi?ht?xe={id:Pe.id,direct:Ht,from:Oe.id,only:!0,end:!0}:xe={id:Pe.id,direct:Ht,from:Oe.id,no:!0,end:!0}:at?xe={id:Pe.id,direct:!1,from:Oe.id,only:!0,end:!1}:ht&&(xe={id:Pe.id,direct:!1,from:Oe.id,no:!0,end:!0}),xe&&xe.direct)break}be.push({way:ge,restrict:xe})}}be.forEach(function(Fi){vt(Fi.way,Qe,xt,Fi.restrict)})}else{if(Qe.length>=3){var ji=Qe.slice();if(It&&It.direct===!1){for(Gt=0;Gt<ji.length;Gt++)if(ji[Gt]===It.from){ji=ji.slice(Gt);break}}var Ke=ct(ji);if(Ke&&(It&&(Ke.restrictionID=It.id,Ke.no=It.no,Ke.only=It.only,Ke.direct=It.direct),gt.push(um(Ke))),Qe[0]===Qe[2])return}if(It&&It.end)return;var dt=De.entity(Se.first()),Lt=De.entity(Se.last()),Yt=fr(dt.loc,Lt.loc),Kt=[];if(Qe.length>1&&(Yt>i||!Se.__via))return;!Se.__oneWay&&He.indexOf(dt.id)!==-1&&Qe.indexOf(dt.id)===-1&&Kt.push(dt),He.indexOf(Lt.id)!==-1&&Qe.indexOf(Lt.id)===-1&&Kt.push(Lt),Kt.forEach(function(Fi){var Ir=De.parentRelations(Se).filter(function(Qi){if(!Qi.isRestriction())return!1;var ys=Qi.memberByRole("from");if(!ys||ys.id!==Se.id)return!1;var ls=/^only_/.test(Qi.tags.restriction);if(!ls)return!0;var Me=!1,he=Qi.membersByRole("via");if(he.length===1&&he[0].type==="node")Me=he[0].id===Fi.id;else for(var pe=0;pe<he.length;pe++)if(he[pe].type==="way"){var Ee=De.entity(he[pe].id);if(Ee.first()===Fi.id||Ee.last()===Fi.id){Me=!0;break}}return Me});vt(Fi,Qe,xt.concat(Ir),!1)})}}}function ct(Se){if(Se.length<3)return;var Qe,xt,It,Gt,Ni,je,be,ge,xe;if(Qe=Se[0],Gt=Se[Se.length-1],Se.length===3&&Qe===Gt){var Pe=De.entity(Qe);if(Pe.__oneWay)return null;xe=!0,ge=It=je=Se[1],xt=Ni=Oe(Qe,ge)}else xe=!1,It=Se[1],xt=Oe(Qe,It),je=Se[Se.length-2],Ni=Oe(Gt,je),Se.length===3?ge=Se[1]:(be=Se.filter(function(Ie){return Ie[0]==="w"}),be=be.slice(1,be.length-1));return{key:Se.join("_"),path:Se,from:{node:xt,way:Qe,vertex:It},via:{node:ge,ways:be},to:{node:Ni,way:Gt,vertex:je},u:xe};function Oe(Ie,nt){var ht=De.entity(Ie).nodes;return nt===ht[0]?ht[1]:ht[ht.length-2]}}},ie}function FD(t,e,i){for(var r=t.entity(e.from.way),s=t.entity(e.from.node),n=t.entity(e.from.vertex),o=t.entity(e.to.way),a=t.entity(e.to.node),l=t.entity(e.to.vertex),u=r.tags.oneway==="yes",d=o.tags.oneway==="yes",m=(fs(i.project(n.loc),i.project(s.loc))-fs(i.project(l.loc),i.project(a.loc)))*(180/Math.PI);m<0;)m+=360;return s===a||(m<23||m>336)&&u&&d||(m<40||m>319)&&u&&d&&e.from.vertex!==e.to.vertex?"no_u_turn":m<158?"no_right_turn":m>202?"no_left_turn":"no_straight_on"}function Ig(t,e){function i(s){var n=t.map(function(a){return s.entity(a)}),o=ds(n,function(a){return a.type==="way"&&a.isClosed()?"closedWay":a.type==="relation"&&a.isMultipolygon()?"multipolygon":"other"});return Object.assign({closedWay:[],multipolygon:[],other:[]},o)}var r=function(s){for(var n=i(s),o=n.multipolygon.reduce(function(v,E){return v.concat(xa(E.members,s))},[]).concat(n.closedWay.map(function(v){var E=[{id:v.id}];return E.nodes=s.childNodes(v),E})),a=o.map(function(v,E){return o.map(function(b,T){return E===T?null:Nf(b.nodes.map(function(A){return A.loc}),v.nodes.map(function(A){return A.loc}))})}),l=[],u=!0;o.length;)g(o),o=o.filter(d),a=a.filter(d).map(m);function d(v,E){return a[E].some(function(b){return b})}function m(v){return v.filter(d)}function g(v){v.forEach(function(E,b){d(E,b)||E.forEach(function(T){l.push({type:"way",id:T.id,role:u?"outer":"inner"})})}),u=!u}var _=n.multipolygon[0]||Cs({id:e,tags:{type:"multipolygon"}});return n.multipolygon.slice(1).forEach(function(v){_=_.mergeTags(v.tags),s=s.remove(v)}),n.closedWay.forEach(function(v){function E(b){return b.id===v.id&&b.role!=="inner"}l.some(E)&&(_=_.mergeTags(v.tags),s=s.replace(v.update({tags:{}})))}),s.replace(_.update({members:l,tags:un(_.tags,["area"])}))};return r.disabled=function(s){var n=i(s);if(n.other.length>0||n.closedWay.length+n.multipolygon.length<2)return"not_eligible";if(!n.multipolygon.every(function(a){return a.isComplete(s)}))return"incomplete_relation";if(n.multipolygon.length){if(n.closedWay.some(function(a){return Yn(s.parentMultipolygons(a),n.multipolygon).length}))return"not_eligible"}else{var o=[];if(n.closedWay.forEach(function(a,l){l===0?o=s.parentMultipolygons(a):o=Yn(o,s.parentMultipolygons(a))}),o=o.filter(function(a){return a.members.length===n.closedWay.length}),o.length)return"not_eligible"}},r}var q2=Xi($2(),1);function qX(t,e){let i={};for(let n=0;n<e.length;n++){let o=e[n];i[o]?i[o].push(n):i[o]=[n]}let s=[{buffer1index:-1,buffer2index:-1,chain:null}];for(let n=0;n<t.length;n++){let o=t[n],a=i[o]||[],l=0,u=s[0];for(let d=0;d<a.length;d++){let m=a[d],g;for(g=l;g<s.length&&!(s[g].buffer2index<m&&(g===s.length-1||s[g+1].buffer2index>m));g++);if(g<s.length){let _={buffer1index:n,buffer2index:m,chain:s[g]};if(l===s.length?s.push(u):s[l]=u,l=g+1,u=_,l===s.length)break}}s[l]=u}return s[s.length-1]}function LD(t,e){let i=qX(t,e),r=[],s=t.length,n=e.length;for(let o=i;o!==null;o=o.chain){let a=s-o.buffer1index-1,l=n-o.buffer2index-1;s=o.buffer1index,n=o.buffer2index,(a||l)&&r.push({buffer1:[s+1,a],buffer1Content:t.slice(s+1,s+1+a),buffer2:[n+1,l],buffer2Content:e.slice(n+1,n+1+l)})}return r.reverse(),r}function YX(t,e,i){let r=[];function s(l,u){r.push({ab:u,oStart:l.buffer1[0],oLength:l.buffer1[1],abStart:l.buffer2[0],abLength:l.buffer2[1]})}LD(e,t).forEach(l=>s(l,"a")),LD(e,i).forEach(l=>s(l,"b")),r.sort((l,u)=>l.oStart-u.oStart);let n=[],o=0;function a(l){l>o&&(n.push({stable:!0,buffer:"o",bufferStart:o,bufferLength:l-o,bufferContent:e.slice(o,l)}),o=l)}for(;r.length;){let l=r.shift(),u=l.oStart,d=l.oStart+l.oLength,m=[l];for(a(u);r.length;){let g=r[0],_=g.oStart;if(_>d)break;d=Math.max(d,_+g.oLength),m.push(r.shift())}if(m.length===1){if(l.abLength>0){let g=l.ab==="a"?t:i;n.push({stable:!0,buffer:l.ab,bufferStart:l.abStart,bufferLength:l.abLength,bufferContent:g.slice(l.abStart,l.abStart+l.abLength)})}}else{let g={a:[t.length,-1,e.length,-1],b:[i.length,-1,e.length,-1]};for(;m.length;){l=m.shift();let A=l.oStart,M=A+l.oLength,k=l.abStart,F=k+l.abLength,O=g[l.ab];O[0]=Math.min(k,O[0]),O[1]=Math.max(F,O[1]),O[2]=Math.min(A,O[2]),O[3]=Math.max(M,O[3])}let _=g.a[0]+(u-g.a[2]),v=g.a[1]+(d-g.a[3]),E=g.b[0]+(u-g.b[2]),b=g.b[1]+(d-g.b[3]),T={stable:!1,aStart:_,aLength:v-_,aContent:t.slice(_,v),oStart:u,oLength:d-u,oContent:e.slice(u,d),bStart:E,bLength:b-E,bContent:i.slice(E,b)};n.push(T)}o=d}return a(e.length),n}function ND(t,e,i,r){r=Object.assign({excludeFalseConflicts:!0,stringSeparator:/\s+/},r),typeof t=="string"&&(t=t.split(r.stringSeparator)),typeof e=="string"&&(e=e.split(r.stringSeparator)),typeof i=="string"&&(i=i.split(r.stringSeparator));let n=[],o=YX(t,e,i),a=[];function l(){a.length&&n.push({ok:a}),a=[]}function u(d,m){if(d.length!==m.length)return!1;for(let g=0;g<d.length;g++)if(d[g]!==m[g])return!1;return!0}return o.forEach(d=>{d.stable?a.push(...d.bufferContent):r.excludeFalseConflicts&&u(d.aContent,d.bContent)?a.push(...d.aContent):(l(),n.push({conflict:{a:d.aContent,aIndex:d.aStart,o:d.oContent,oIndex:d.oStart,b:d.bContent,bIndex:d.bStart}}))}),l(),n}function Y2(t,e={}){let i=e.localGraph,r=e.remoteGraph,s=e.discardTags??{},n=e.formatUser??(b=>b),o=e.localize??(b=>b),a=e.strategy??"safe",l=[];function u(b,T){return a==="force_local"||Wi(T.loc,b.loc,1e-6)?T:a==="force_remote"?T.update({loc:b.loc}):(l.push(o("merge_remote_changes.conflict.location",{user:n(b.user)})),T)}function d(b,T,A){if(a==="force_local"||(0,q2.default)(A.nodes,T.nodes))return A;if(a==="force_remote")return A.update({nodes:T.nodes});let M=l.length,k=b.nodes||[],F=A.nodes||[],O=T.nodes||[],B=ND(F,k,O,{excludeFalseConflicts:!0}),U=[];for(let $ of B)if($.ok)U.push.apply(U,$.ok);else{let q=$.conflict;if((0,q2.default)(q.o,q.a))U.push.apply(U,q.b);else if((0,q2.default)(q.o,q.b))U.push.apply(U,q.a);else{l.push(o("merge_remote_changes.conflict.nodelist",{user:n(T.user)}));break}}return l.length===M?A.update({nodes:U}):A}function m(b,T,A,M){function k(O,B){let U=M.parentWays(O).some($=>$.id!==B.id);return O.hasInterestingTags()||U||M.parentRelations(O).length>0}let F=l.length;for(let O of T){let B=M.hasEntity(O);if(b.nodes.indexOf(O)===-1){B&&!k(B,b)&&A.removeIDs.push(O);continue}let U=i.hasEntity(O),$=r.hasEntity(O),q;if(a==="force_remote"&&$&&$.visible)A.replacements.push($);else if(a==="force_local"&&U)q=Dt(U),$&&(q=q.update({version:$.version})),A.replacements.push(q);else if(a==="safe"&&U&&$&&U.version!==$.version){if(q=Dt(U,{version:$.version}),$.visible?q=u($,q):l.push(o("merge_remote_changes.conflict.deleted",{user:n($.user)})),l.length!==F)break;A.replacements.push(q)}}return b}function g(b,T){for(let A of b.replacements)T=T.replace(A);return b.removeIDs.length&&(T=Hu(b.removeIDs)(T)),T}function _(b,T){return a==="force_local"||(0,q2.default)(T.members,b.members)?T:a==="force_remote"?T.update({members:b.members}):(l.push(o("merge_remote_changes.conflict.memberlist",{user:n(b.user)})),T)}function v(b,T,A){if(a==="force_local"||(0,q2.default)(A.tags,T.tags))return A;if(a==="force_remote")return A.update({tags:T.tags});let M=l.length,k=b.tags??{},F=A.tags??{},O=T.tags??{},B=ss(ss(Object.keys(k),Object.keys(F)),Object.keys(O)).filter(function(Z){return!s[Z]}),U=Object.assign({},F),$=!1;for(var q=0;q<B.length;q++){var W=B[q];k[W]!==O[W]&&F[W]!==O[W]&&(k[W]!==F[W]?l.push(o("merge_remote_changes.conflict.tags",{tag:W,local:F[W],remote:O[W],user:n(T.user)})):(O.hasOwnProperty(W)?U[W]=O[W]:delete U[W],$=!0))}return $&&l.length===M?A.update({tags:U}):A}let E=function(b){let T={replacements:[],removeIDs:[]},A=b.base.entities.get(t),M=i.entity(t),k=r.entity(t),F=Dt(M,{version:k.version});return k.visible?(F.type==="node"?F=u(k,F):F.type==="way"?(b.rebase(r.childNodes(k),[b],!1),F=d(A,k,F),F=m(F,ss(M.nodes,k.nodes),T,b)):F.type==="relation"&&(F=_(k,F)),F=v(A,k,F),l.length||(b=g(T,b).replace(F)),b):a==="force_remote"?Hu([t])(b):a==="force_local"?(F.type==="way"&&(F=m(F,Ei(M.nodes),T,b),b=g(T,b)),b.replace(F)):(l.push(o("merge_remote_changes.conflict.deleted",{user:n(k.user)})),b)};return E.conflicts=function(){return l},E}function Gs(t,e,i,r){for(var s=Hi,n=t.map(function(T){return i.project(T.loc)}),o=t.map(function(T){return T.id}),a=1/0,l,u,d=0;d<n.length-1;d++)if(!(o[d]===r||o[d+1]===r)){var m=n[d],g=tr(n[d+1],m),_=tr(e,m),v=_l(_,g)/_l(g,g),E;v<0?E=m:v>1?E=n[d+1]:E=[m[0]+v*g[0],m[1]+v*g[1]];var b=s(E,e);b<a&&(a=b,l=d+1,u=i.invert(E))}return l!==void 0?{index:l,distance:a,loc:u}:null}function OD(t,e,i){var r=[],s=[],n,o,a,l,u;for(n=0;n<t.length-1;n++)a=t[n],l=t[n+1],u=[a.loc,l.loc],(a.id===i||l.id===i)&&r.push(u);for(n=0;n<e.length-1;n++)a=e[n],l=e[n+1],u=[a.loc,l.loc],s.push(u);for(n=0;n<r.length;n++)for(o=0;o<s.length;o++){var d=r[n],m=s[o],g=Su(d,m);if(g)return!0}return!1}function zd(t,e){var i=[],r=[],s,n;for(s=0;s<t.length-1;s++){var o=t[s],a=t[s+1],l=[o.loc,a.loc];o.id===e||a.id===e?i.push(l):r.push(l)}for(s=0;s<i.length;s++)for(n=0;n<r.length;n++){var u=i[s],d=r[n];if(!(Wi(u[1],d[0])||Wi(u[0],d[1])||Wi(u[0],d[0])||Wi(u[1],d[1]))){var m=Su(u,d);if(m){var g=1e-8;if(Wi(u[1],m,g)||Wi(u[0],m,g)||Wi(d[1],m,g)||Wi(d[0],m,g))continue;return!0}}}return!1}function Gd(t,e,i){return Wi(i,t)||Wi(i,e)?1:x8(t,e,i)}function BD(t,e,i,r,s){var n=Math.abs(t);return n<e||s&&Math.abs(n-1)<e?0:n<i||n>r?t:null}function kg(t,e,i,r){for(var s=0,n=e?0:1,o=e?t.length:t.length-1,a=t.map(function(E){return E.coord}),l=Math.cos((90-r)*Math.PI/180),u=Math.cos(r*Math.PI/180),d=n;d<o;d++){var m=a[(d-1+a.length)%a.length],g=a[d],_=a[(d+1)%a.length],v=BD(Gd(m,_,g),i,l,u);v!==null&&(s=s+2*Math.min(Math.abs(v-1),Math.min(Math.abs(v),Math.abs(v+1))))}return s}function UD(t,e,i){for(var r=-1/0,s=e?0:1,n=e?t.length:t.length-1,o=s;o<n;o++){var a=t[(o-1+t.length)%t.length],l=t[o],u=t[(o+1)%t.length],d=Gd(a,u,l),m=Math.acos(Math.abs(d))*180/Math.PI;m>45&&(m=90-m),!(m>=i)&&m>r&&(r=m)}return r===-1/0?null:r}function Z2(t,e,i,r,s){for(var n=null,o=e?0:1,a=e?t.length:t.length-1,l=Math.cos((90-r)*Math.PI/180),u=Math.cos(r*Math.PI/180),d=o;d<a;d++){var m=t[(d-1+t.length)%t.length],g=t[d],_=t[(d+1)%t.length],v=BD(Gd(m,_,g),i,l,u,s);if(v!==null){if(Math.abs(v)>0)return 1;n=0}}return n}function $c(t,e,i,r){var s=e;function n(g){function _(b){if(t.indexOf(b)!==-1)return!0;var T=g.parentWays(g.entity(b));if(T.length<3)return!0;var A=T.every(function(M){return r.moving[M.id]});return A||delete r.moving[b],A}function v(b){for(var T=0;T<b.length;T++){var A=b[T];if(!r.moving[A]){r.moving[A]=!0;var M=g.hasEntity(A);M&&(M.type==="node"?(r.nodes.push(A),r.startLoc[A]=M.loc):M.type==="way"?(r.ways.push(A),v(M.nodes)):v(M.members.map(function(k){return k.id})))}}}function E(b){function T(Z,Q){return!Z.isClosed()&&!!Z.affix(Q)}for(var A=0;A<b.length;A++)for(var M=b[A],k=g.childNodes(g.entity(M)),F=0;F<k.length;F++){var O=k[F],B=g.parentWays(O);if(B.length===2){for(var U=g.entity(M),$=null,q=0;q<B.length;q++){var W=B[q];if(!r.moving[W.id]){$=W;break}}$&&(Yn(U.nodes,$.nodes).length>2||U.isArea()||$.isArea()||r.intersections.push({nodeId:O.id,movedId:U.id,unmovedId:$.id,movedIsEP:T(U,O.id),unmovedIsEP:T($,O.id)}))}}}r||(r={}),r.ok||(r.moving={},r.intersections=[],r.replacedVertex={},r.startLoc={},r.nodes=[],r.ways=[],v(t),E(r.ways),r.nodes=r.nodes.filter(_),r.ok=!0)}function o(g,_,v,E){var b=v.entity(_),T=v.entity(g),A=b.nodes.indexOf(g),M,k,F;b.isClosed()?(M=b.nodes.length-1,k=(A+M-1)%M,F=(A+M+1)%M):(M=b.nodes.length,k=A-1,F=A+1);var O=v.hasEntity(b.nodes[k]),B=v.hasEntity(b.nodes[F]);if(!O||!B)return v;var U=_+"_"+g,$=r.replacedVertex[U];$||($=vi(),r.replacedVertex[U]=$,r.startLoc[$.id]=r.startLoc[g]);var q,W;E?(q=i.project(r.startLoc[g]),W=i.invert(Sr(q,E))):W=r.startLoc[g],$=$.move(W);var Z=i.project($.loc),Q=i.project(O.loc),X=i.project(B.loc),ce=Math.abs(fs(Z,Q)-fs(Z,X))*(180/Math.PI);if(ce>175&&ce<185)return v;var de=[O.loc,$.loc,T.loc,B.loc].map(ie=>i.project(ie)),le=[O.loc,T.loc,$.loc,B.loc].map(ie=>i.project(ie)),te=Jb(de),ee=Jb(le),oe=te<=ee?A:F;return b.isClosed()&&oe===0&&(oe=M),b=b.addNode($.id,oe),v.replace($).replace(b)}function a(g,_){var v=_.entity(g),E=1e-6,b,T;function A(k,F){return F.parentWays(k).length>1||F.parentRelations(k).length||k.hasInterestingTags()}for(var M=0;M<v.nodes.length;M++)T=_.entity(v.nodes[M]),b&&T&&Wi(b.loc,T.loc,E)&&(A(b,_)?A(T,_)||(v=v.removeNode(T.id),_=_.replace(v).remove(T)):(v=v.removeNode(b.id),_=_.replace(v).remove(b))),b=T;return _}function l(g,_){var v=_.entity(g.nodeId),E=_.entity(g.movedId),b=_.entity(g.unmovedId),T=g.movedIsEP,A=g.unmovedIsEP;if(T&&A)return _;var M=_.childNodes(E).filter(function(W){return W!==v}),k=_.childNodes(b).filter(function(W){return W!==v});E.isClosed()&&E.first()===v.id&&M.push(M[0]),b.isClosed()&&b.first()===v.id&&k.push(k[0]);var F=!T&&Gs(M,i.project(v.loc),i),O=!A&&Gs(k,i.project(v.loc),i),B;if(!T&&!A)for(var U=1e-6,$=10,q=0;q<$&&(B=pr(F.loc,O.loc,.5),F=Gs(M,i.project(B),i),O=Gs(k,i.project(B),i),!(Math.abs(F.distance-O.distance)<U));q++);else T?B=O.loc:B=F.loc;return _=_.replace(v.move(B)),!T&&F.index!==E.nodes.indexOf(v.id)&&(E=E.removeNode(v.id).addNode(v.id,F.index),_=_.replace(E)),!A&&O.index!==b.nodes.indexOf(v.id)&&(b=b.removeNode(v.id).addNode(v.id,O.index),_=_.replace(b)),_}function u(g){for(var _=0;_<r.intersections.length;_++){var v=r.intersections[_];g=o(v.nodeId,v.movedId,g,s),g=o(v.nodeId,v.unmovedId,g,null),g=l(v,g),g=a(v.movedId,g),g=a(v.unmovedId,g)}return g}function d(g){function _(q){return Sr(i.project(q),s)}for(var v=0;v<r.intersections.length;v++){var E=r.intersections[v];if(!(E.movedIsEP&&E.unmovedIsEP)&&E.movedIsEP){for(var b=g.entity(E.nodeId),T=i.project(b.loc),A=Sr(T,s),M=g.childNodes(g.entity(E.movedId)),k=M.map(function(q){return _(q.loc)}),F=g.childNodes(g.entity(E.unmovedId)),O=F.map(function(q){return i.project(q.loc)}),B=v8(k,O),U=0;v<B.length;v++)if(!Wi(B[U],A)){var $=Gs(F,A,i);s=tr(i.project($.loc),T)}}}}var m=function(g){if(s[0]===0&&s[1]===0)return g;n(g),r.intersections.length&&d(g);for(var _=0;_<r.nodes.length;_++){var v=g.entity(r.nodes[_]),E=i.project(v.loc),b=Sr(E,s);g=g.replace(v.move(i.invert(b)))}return r.intersections.length&&(g=u(g)),g};return m.delta=function(){return s},m}function Mg(t,e,i){return function(r){return r.replace(r.entity(t).moveMember(e,i))}}function Hc(t,e){var i=function(r,s){(s===null||!isFinite(s))&&(s=1),s=Math.min(Math.max(+s,0),1);var n=r.entity(t);return r.replace(n.move(pr(n.loc,e,s)))};return i.transitionable=!0,i}function as(){return function(t){return t}}function sh(t,e,i,r,s){var n=s||1e-4,o=r||13,a=Math.cos((90-o)*Math.PI/180),l=Math.cos(o*Math.PI/180),u=function(m,g){(g===null||!isFinite(g))&&(g=1),g=Math.min(Math.max(+g,0),1);var _=m.entity(t);if(_=_.removeNode(""),_.tags.nonsquare){var v=Object.assign({},_.tags);delete v.nonsquare,_=_.update({tags:v})}m=m.replace(_);var E=_.isClosed(),b=m.childNodes(_).slice();if(E&&b.pop(),i!==void 0&&(b=d(b,i,E),b.length!==3))return m;var T={},A=[],M={i:0,dotp:1},k,F,O,B,U,$,q;for($=0;$<b.length;$++)k=b[$],T[k.id]=(T[k.id]||0)+1,A.push({id:k.id,coord:e.project(k.loc)});if(A.length===3){for($=0;$<1e3&&(U=A.map(ne),A[M.i].coord=Sr(A[M.i].coord,U[M.i]),B=M.dotp,!(B<n));$++);k=m.entity(b[M.i].id),O=e.invert(A[M.i].coord),m=m.replace(k.move(pr(k.loc,O,g)))}else{var W=[],Z=[];for($=0;$<A.length;$++){F=A[$];var Q=0;if(E||$>0&&$<A.length-1){var X=A[($-1+A.length)%A.length],ce=A[($+1)%A.length];Q=Math.abs(Gd(X.coord,ce.coord,F.coord))}Q>l?W.push(F):Z.push(F)}var de=ie(Z),le=ie(Z);for(B=1/0,$=0;$<1e3;$++){for(U=Z.map(ne),q=0;q<U.length;q++)Z[q].coord=Sr(Z[q].coord,U[q]);var te=kg(Z,E,n,o);if(te<B&&(de=ie(Z),B=te),B<n)break}var ee=de.map(function(me){return me.coord});for(E&&ee.push(ee[0]),$=0;$<de.length;$++)F=de[$],Wi(le[$].coord,F.coord)||(k=m.entity(F.id),O=e.invert(F.coord),m=m.replace(k.move(pr(k.loc,O,g))));for($=0;$<W.length;$++)if(F=W[$],!(T[F.id]>1))if(k=m.entity(F.id),g===1&&m.parentWays(k).length===1&&m.parentRelations(k).length===0&&!k.hasInterestingTags())m=Uc(k.id)(m);else{var oe=KM(F.coord,ee);oe&&(O=e.invert(oe.target),m=m.replace(k.move(pr(k.loc,O,g))))}}return m;function ie(me){return me.map(function(De){return{id:De.id,coord:[De.coord[0],De.coord[1]]}})}function ne(me,De,He){if(!E&&(De===0||De===He.length-1))return[0,0];if(T[He[De].id]>1)return[0,0];var Je=He[(De-1+He.length)%He.length].coord,ot=me.coord,gt=He[(De+1)%He.length].coord,vt=tr(Je,ot),ct=tr(gt,ot),Se=2*Math.min(Hi(vt),Hi(ct));vt=Ff(vt),ct=Ff(ct);var Qe=vt[0]*ct[0]+vt[1]*ct[1],xt=Math.abs(Qe);if(xt<a){M.i=De,M.dotp=xt;var It=Ff(Sr(vt,ct));return Uo(It,.1*Qe*Se)}return[0,0]}};function d(m,g,_){for(var v=_?0:1,E=_?m.length:m.length-1,b=v;b<E;b++)if(m[b].id===g)return[m[(b-1+m.length)%m.length],m[b],m[(b+1)%m.length]];return[]}return u.disabled=function(m){var g=m.entity(t);g=g.removeNode(""),m=m.replace(g);var _=g.isClosed(),v=m.childNodes(g).slice();_&&v.pop();var E=!1;if(i!==void 0&&(E=!0,v=d(v,i,_),v.length!==3))return"end_vertex";var b=v.map(function(A){return e.project(A.loc)}),T=Z2(b,_,n,o,E);return T===null?"not_squarish":T===0?"square_enough":!1},u.transitionable=!0,u}function zD(t,e,i){return function(r){var s=r.entity(t.from.way),n=r.entity(t.to.way),o=t.via.node&&r.entity(t.via.node),a=t.via.ways&&t.via.ways.map(function(u){return r.entity(u)}),l=[];return l.push({id:s.id,type:"way",role:"from"}),o?l.push({id:o.id,type:"node",role:"via"}):a&&a.forEach(function(u){l.push({id:u.id,type:"way",role:"via"})}),l.push({id:n.id,type:"way",role:"to"}),r.replace(Cs({id:i,tags:{type:"restriction",restriction:e},members:l}))}}function hm(t){var e=function(i){var r=i.hasEntity(t),s=i.base.entities.get(t);return r&&!s&&(r.type==="node"&&i.parentWays(r).forEach(function(n){n=n.removeNode(t),i=i.replace(n),n.isDegenerate()&&(i=Cl(n.id)(i))}),i.parentRelations(r).forEach(function(n){n=n.removeMembersWithID(t),i=i.replace(n),n.isDegenerate()&&(i=pn(n.id)(i))})),i.revert(t)};return e}function Pg(t,e,i,r){var s=function(n){return n.update(function(o){ns(t,o).forEach(function(a){var l=Tu([r.project(a.loc)],i,e)[0];o=o.replace(a.move(r.invert(l)))})})};return s}function GD(t,e,i,r){return function(s){return s.update(function(n){let o,a;ns(t,n).forEach(function(l){o=r.project(l.loc),a=[o[0]-e[0],o[1]-e[1]],o=[e[0]+i*a[0],e[1]+i*a[1]],n=n.replace(l.move(r.invert(o)))})})}}function Rg(t,e){function i(n,o,a){return _l(n,a,o)/_l(a,a,o)}function r(n){var o=Of(n),a=[(o.poly[0][0]+o.poly[1][0])/2,(o.poly[0][1]+o.poly[1][1])/2],l=[(o.poly[2][0]+o.poly[3][0])/2,(o.poly[2][1]+o.poly[3][1])/2],u=[(o.poly[3][0]+o.poly[4][0])/2,(o.poly[3][1]+o.poly[4][1])/2],d=[(o.poly[1][0]+o.poly[2][0])/2,(o.poly[1][1]+o.poly[2][1])/2],m=Hi(a,l)>Hi(u,d);return m?[a,l]:[u,d]}var s=function(n,o){(o===null||!isFinite(o))&&(o=1),o=Math.min(Math.max(+o,0),1);for(var a=t.map(function(A){return n.entity(A)}),l=a.map(function(A){return e.project(A.loc)}),u=r(l),d=u[0],m=u[1],g=0;g<l.length;g++){var _=a[g],v=l[g],E=i(v,d,m),b=pr(d,m,E),T=e.invert(b);n=n.replace(_.move(pr(_.loc,T,o)))}return n};return s.disabled=function(n){for(var o=t.map(function(T){return n.entity(T)}),a=o.map(function(T){return e.project(T.loc)}),l=r(a),u=l[0],d=l[1],m=0,g=0;g<a.length;g++){var _=a[g],v=i(_,u,d),E=pr(u,d,v),b=Hi(E,_);!isNaN(b)&&b>m&&(m=b)}if(m<1e-4)return"straight_enough"},s.transitionable=!0,s}function Dg(t,e){function i(o,a,l){return _l(o,l,a)/_l(l,l,a)}function r(o){for(var a=[],l=[],u=[],d=[],m=t.filter(function(F){return o.entity(F).type==="way"}),g=t.filter(function(F){return o.entity(F).type==="node"}),_=0;_<m.length;_++){var v=o.entity(m[_]);a=v.nodes.slice(0),d.push(a),l.push(a[0]),u.push(a[a.length-1])}l=l.filter(function(F){return l.indexOf(F)===l.lastIndexOf(F)}),u=u.filter(function(F){return u.indexOf(F)===u.lastIndexOf(F)});var E=_n(l,u).concat(_n(u,l))[0],b=[];a=[];for(var T=function(F,O){return O.filter(function(B){return B[0]===F||B[B.length-1]===F})[0]};d.length;)b=T(E,d),d=_n(d,[b]),b[0]!==E&&b.reverse(),a=a.concat(b),E=a[a.length-1];if(g.length===2){var A=a.indexOf(g[0]),M=a.indexOf(g[1]),k=[A,M];k.sort(function(F,O){return F-O}),a=a.slice(k[0],k[1]+1)}return a.map(function(F){return o.entity(F)})}function s(o,a){return a.parentWays(o).length>1||a.parentRelations(o).length||o.hasInterestingTags()}var n=function(o,a){(a===null||!isFinite(a))&&(a=1),a=Math.min(Math.max(+a,0),1);var l=r(o),u=l.map(function(M){return e.project(M.loc)}),d=u[0],m=u[u.length-1],g=[],_;for(_=1;_<u.length-1;_++){var v=l[_],E=u[_];if(a<1||s(v,o)){var b=i(E,d,m),T=pr(d,m,b),A=e.invert(T);o=o.replace(v.move(pr(v.loc,A,a)))}else g.indexOf(v)===-1&&g.push(v)}for(_=0;_<g.length;_++)o=Uc(g[_].id)(o);return o};return n.disabled=function(o){var a=r(o),l=a.map(function(M){return e.project(M.loc)}),u=l[0],d=l[l.length-1],m=.2*Hi(u,d),g;if(m===0)return"too_bendy";var _=0;for(g=1;g<l.length-1;g++){var v=l[g],E=i(v,u,d),b=pr(u,d,E),T=Hi(b,v);if(isNaN(T)||T>m)return"too_bendy";T>_&&(_=T)}var A=a.every(function(M,k){return k===0||k===a.length-1||s(M,o)});if(_<1e-4&&A)return"straight_enough"},n.transitionable=!0,n}function $D(t){return function(e){return pn(t.restrictionID)(e)}}function Fg(t,e){var i=!0,r=function(s,n){(n===null||!isFinite(n))&&(n=1),n=Math.min(Math.max(+n,0),1);var o=ns(t,s),a=o.map(function($){return e.project($.loc)}),l=Of(a),u=[(l.poly[0][0]+l.poly[1][0])/2,(l.poly[0][1]+l.poly[1][1])/2],d=[(l.poly[2][0]+l.poly[3][0])/2,(l.poly[2][1]+l.poly[3][1])/2],m=[(l.poly[3][0]+l.poly[4][0])/2,(l.poly[3][1]+l.poly[4][1])/2],g=[(l.poly[1][0]+l.poly[2][0])/2,(l.poly[1][1]+l.poly[2][1])/2],_,v,E=Hi(u,d)>Hi(m,g);i&&E||!i&&!E?(_=u,v=d):(_=m,v=g);for(var b=v[0]-_[0],T=v[1]-_[1],A=(b*b-T*T)/(b*b+T*T),M=2*b*T/(b*b+T*T),k=0;k<o.length;k++){var F=o[k],O=e.project(F.loc),B=[A*(O[0]-_[0])+M*(O[1]-_[1])+_[0],M*(O[0]-_[0])-A*(O[1]-_[1])+_[1]],U=e.invert(B);F=F.move(pr(F.loc,U,n)),s=s.replace(F)}return s};return r.useLongAxis=function(s){return arguments.length?(i=s,r):i},r.transitionable=!0,r}function Lg(t,e,i){return function(r){var s=r.entity(t),n=Object.assign({},s.tags),o,a;for(var l in e)if(l in n)if(e[l]==="*")o=n[l],delete n[l];else if(e[l]===n[l])delete n[l];else{var u=n[l].split(";").filter(Boolean),d=u.indexOf(e[l]);u.length===1||d===-1?delete n[l]:(i&&i[l]&&(a=d),u.splice(d,1),n[l]=u.join(";"))}if(i)for(var m in i){var g=i[m];if(g==="*"){if(n[m]&&n[m]!=="no")continue;n[m]="yes"}else if(g==="$1")n[m]=o;else if(n[m]&&e[m]&&a!==void 0){var _=n[m].split(";").filter(Boolean);_.indexOf(g)===-1&&(_.splice(a,0,g),n[m]=_.join(";"))}else n[m]=g}return r.replace(s.update({tags:n}))}}function ZX(t,e,i,r,s){var n=Math.abs(r.loc[0]-s.loc[0])>Math.abs(r.loc[1]-s.loc[1]),o=n?function(b,T){return r.loc[0]<s.loc[0]?b.loc[0]-T.loc[0]:T.loc[0]-b.loc[0]}:function(b,T){return r.loc[1]<s.loc[1]?b.loc[1]-T.loc[1]:T.loc[1]-b.loc[1]},a=i.nodes,l=a.indexOf(r.id),u=a.indexOf(s.id);if(l===-1||u===-1||l>=u||o(r,s)>=0)return null;for(var d=l+1;d<u&&o(e,t.entity(a[d]))>0;)d++;var m=t.entity(a[d-1]).loc,g=t.entity(a[d]).loc,_=e.loc,v=Math.abs(m[0]-g[0])>Math.abs(m[1]-g[1])?(_[0]-m[0])/(g[0]-m[0]):(_[1]-m[1])/(g[1]-m[1]),E=pr(m,g,v);return{insertIdx:d,interpLoc:E}}function zE(t,e){return Math.abs(t[0]-e[0])>2e-5||Math.abs(t[1]-e[1])>2e-5}function Ng(t){delete t.__fbid__,delete t.__origid__,delete t.__service__,delete t.__datasetid__,delete t.tags.conn,delete t.tags.dupe}function Og(t,e){return function(i){var r={},s=e.entity(t);return s.type==="node"?n(s):s.type==="way"?o(s):s.type==="relation"&&a(s),i;function n(l){var u=vi(l);return u.tags=Object.assign({},u.tags),Ng(u),i=i.replace(u),u}function o(l){var u=Cr(l);u.nodes=l.nodes.slice(),u.tags=Object.assign({},u.tags),Ng(u);var d=u.nodes.map(function(m){var g=vi(e.entity(m));g.tags=Object.assign({},g.tags);var _=g.tags.conn&&g.tags.conn.split(","),v=g.tags.dupe;if(Ng(g),v&&i.hasEntity(v)&&!zE(i.entity(v).loc,g.loc)?g=i.entity(v):i.hasEntity(g.id)&&zE(i.entity(g.id).loc,g.loc)&&(g=vi({loc:g.loc})),_&&i.hasEntity(_[0])){var E=i.hasEntity(_[0]),b=i.hasEntity(_[1]),T=i.hasEntity(_[2]);if(E&&b&&T){var A=ZX(i,g,E,b,T);A&&!zE(A.interpLoc,g.loc)&&(g.loc=A.interpLoc,i=i.replace(E.addNode(g.id,A.insertIdx)))}}return i=i.replace(g),g.id});return u=u.update({nodes:d}),i=i.replace(u),u}function a(l){var u=r[l.id];if(u)return u;var d=Cs(l);d.members=l.members.slice(),d.tags=Object.assign({},l.tags),Ng(d);var m=d.members.map(function(g){var _=e.entity(g.id),v;return _.type==="node"?v=n(_):_.type==="way"?v=o(_):_.type==="relation"&&(v=a(_)),Object.assign(g,{id:v.id})});return d=d.update({members:m}),i=i.replace(d),r[l.id]=d,d}}}var rn=class extends en.default{constructor(e){super(),this.context=e,this.id="",this._enabled=!1}enable(){this._enabled||(this._enabled=!0)}disable(){this._enabled&&(this._enabled=!1)}get enabled(){return this._enabled}_getEventData(e){let i={id:e.pointerId??e.pointerType??"unknown",event:e,originalEvent:e.originalEvent,coord:[e.global.x,e.global.y],time:e.timeStamp,isCancelled:!1,target:null};if(!e.target)return i;let r=e.target,s=r?.__feature__;return s?(i.target={displayObject:r,feature:s,featureID:s.id,layer:s.layer,layerID:s.layer.id,data:s.data,dataID:s.dataID},i):(r=e.target.parent,s=r?.__feature__,s?(i.target={displayObject:r,feature:s,featureID:s.id,layer:s.layer,layerID:s.layer.id,data:s.data,dataID:s.dataID},i):(i.target={displayObject:e.target,feature:null,featureID:null,layer:null,layerID:null,data:null,dataID:null},i))}};var QX=1,KX=4,dm=class extends rn{constructor(e){super(e),this.id="drag",this.dragTarget=null,this.lastDown=null,this.lastMove=null,this._doMove=this._doMove.bind(this),this._pointercancel=this._pointercancel.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.lastDown=null,this.lastMove=null,this.dragTarget=null;let e=this.context.systems.map.renderer.events;e.on("modifierchange",this._doMove),e.on("pointerover",this._doMove),e.on("pointerout",this._doMove),e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup),e.on("pointercancel",this._pointercancel)}disable(){if(!this._enabled)return;let e=this.lastMove;e&&this.dragTarget&&(e.target=null,this.dragTarget.feature.active=!1,this.emit("cancel",e)),this._enabled=!1,this.lastDown=null,this.lastMove=null,this.dragTarget=null;let i=this.context.systems.map.renderer.events;i.off("modifierchange",this._doMove),i.off("pointerover",this._doMove),i.off("pointerout",this._doMove),i.off("pointerdown",this._pointerdown),i.off("pointermove",this._pointermove),i.off("pointerup",this._pointerup),i.off("pointercancel",this._pointercancel)}_pointerdown(e){if(this.lastDown||e.pointerType==="mouse"&&e.button!==0)return;let i=this._getEventData(e),r=i.target?.data instanceof vi,s=i.target?.data?.type==="midpoint";(r||s)&&i.target?.layerID==="osm"&&(this.lastDown=i,this.lastMove=null,this.dragTarget=null)}_pointermove(e){let i=this.context.systems.map;if(i.supersurface.select(".edit-menu").size()){this._pointercancel(e);return}if(!i.renderer.events.pointerOverRenderer)return;let n=this.lastDown,o=this._getEventData(e);if(!(!n||n.id!==o.id)){if(this.lastMove=o,this.dragTarget)this._doMove();else if(n.target){let a=Hi(n.coord,o.coord),l=e.pointerType==="pen"?KX:QX;if(a>=l){let u=Object.assign({},n.target);this.dragTarget=u,u.feature.active=!0;let d=new Map().set(u.data.id,u.data),m=this.context.selectedIDs();this.context.enter("drag-node",{selection:d,reselectIDs:m}),this.emit("start",n)}}}}_pointerup(e){let i=this.lastDown,r=this._getEventData(e);!i||i.id!==r.id||(this.dragTarget&&(this._snappingDisabled()?r.target=null:r.target=Object.assign({},r.target)),this.lastDown=null,this.lastMove=null,this.dragTarget&&(this.dragTarget.feature.active=!1,this.dragTarget=null,this.emit("end",r)))}_pointercancel(e){let i=this._getEventData(e);this.lastDown=null,this.lastMove=null,this.dragTarget&&(this.dragTarget.feature.active=!1,this.dragTarget=null,this.emit("cancel",i))}_snappingDisabled(){let e=this.context.systems.map.renderer.events;if(!e.pointerOverRenderer)return!1;let i=e.modifierKeys;return i.has("Alt")||i.has("Control")||i.has("Meta")}_doMove(){if(!this._enabled||!this.lastMove)return;let e=Object.assign({},this.lastMove);this._snappingDisabled()&&(e.target=null),this.emit("move",e)}};var HD=4,VD=12,fm=class extends rn{constructor(e){super(e),this.id="draw",this._spaceClickDisabled=!1,this.lastDown=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._doClick=this._doClick.bind(this),this._doMove=this._doMove.bind(this),this._keydown=this._keydown.bind(this),this._keyup=this._keyup.bind(this),this._pointercancel=this._pointercancel.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.lastDown=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._spaceClickDisabled=!1;let e=this.context.systems.map.renderer.events;e.on("keydown",this._keydown),e.on("keyup",this._keyup),e.on("modifierchange",this._doMove),e.on("pointerover",this._doMove),e.on("pointerout",this._doMove),e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup),e.on("pointercancel",this._pointercancel)}disable(){if(!this._enabled)return;this._enabled=!1,this.lastDown=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._spaceClickDisabled=!1;let e=this.context.systems.map.renderer.events;e.off("keydown",this._keydown),e.off("keyup",this._keyup),e.off("modifierchange",this._doMove),e.off("pointerover",this._doMove),e.off("pointerout",this._doMove),e.off("pointerdown",this._pointerdown),e.off("pointermove",this._pointermove),e.off("pointerup",this._pointerup),e.off("pointercancel",this._pointercancel)}_keydown(e){["Enter","Escape","Esc"].includes(e.key)?(e.preventDefault(),this.emit("finish")):["Backspace","Delete","Del"].includes(e.key)?(e.preventDefault(),this.emit("cancel")):!this._spaceClickDisabled&&[" ","Spacebar"].includes(e.key)&&(e.preventDefault(),e.stopPropagation(),this._spacebar())}_keyup(e){this._spaceClickDisabled&&[" ","Spacebar"].includes(e.key)&&(e.preventDefault(),e.stopPropagation(),this._spaceClickDisabled=!1)}_pointerdown(e){if(this.lastDown)return;let i=this._getEventData(e);this.lastDown=i,this.lastClick=null,this.emit("down",i)}_pointermove(e){let i=this._getEventData(e);this.lastMove=i,this._spaceClickDisabled&&this.lastSpace&&Hi(i.coord,this.lastSpace.coord)>VD&&(this._spaceClickDisabled=!1);let r=this.lastDown;r&&!r.isCancelled&&r.id===i.id&&Hi(r.coord,i.coord)>=HD&&(r.isCancelled=!0),this._doMove()}_pointerup(e){let i=this.lastDown,r=this._getEventData(e);if(!i||i.id!==r.id||(this.lastDown=null,i.isCancelled))return;let s=Hi(i.coord,r.coord);(s<HD||s<VD&&r.time-i.time<500)&&(this.lastClick=r,this._doClick())}_pointercancel(){this.lastDown=null}_spacebar(){this._spaceClickDisabled||this.lastMove&&(this._spaceClickDisabled=!0,this.lastSpace=this.lastMove,this.lastClick=this.lastMove,this._doClick())}_doMove(){if(!this._enabled||!this.lastMove)return;let i=this.context.systems.map.renderer.events;if(!i.pointerOverRenderer)return;let r=i.modifierKeys,s=r.has("Alt")||r.has("Control")||r.has("Meta"),n=Object.assign({},this.lastMove);(s||!1)&&(n.target=null),this.emit("move",n)}_doClick(){if(!this._enabled||!this.lastClick)return;let r=this.context.systems.map.renderer.events.modifierKeys,s=r.has("Alt")||r.has("Control")||r.has("Meta"),n=Object.assign({},this.lastClick);(s||!1)&&(n.target=null),this.emit("click",n)}};var pm=class extends rn{constructor(e){super(e),this.id="hover",this.lastMove=null,this.hoverTarget=null,this._doHover=this._doHover.bind(this),this._pointermove=this._pointermove.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.lastMove=null,this.hoverTarget=null;let e=this.context.systems.map.renderer.events;e.on("modifierchange",this._doHover),e.on("pointerover",this._doHover),e.on("pointerout",this._doHover),e.on("pointermove",this._pointermove)}disable(){if(!this._enabled)return;let e=this.lastMove;this.hoverTarget&&e&&(e.target=null,this._doHover()),this._enabled=!1,this.lastMove=null,this.hoverTarget=null;let i=this.context.systems.map.renderer.events;i.off("modifierchange",this._doHover),i.off("pointerover",this._doHover),i.off("pointerout",this._doHover),i.off("pointermove",this._pointermove)}_pointermove(e){this._enabled&&(this.lastMove=this._getEventData(e),this._doHover())}_doHover(){if(!this._enabled||!this.lastMove||this.context.behaviors["map-interaction"].gesture)return;let r=this.context.systems.map.renderer.events,s=r.modifierKeys,n=s.has("Alt")||s.has("Control")||s.has("Meta"),o=Object.assign({},this.lastMove);(n||!1||!r.pointerOverRenderer)&&(o.target=null);let l=this.hoverTarget?.featureID||null,u=o?.target?.featureID||null;l!==u&&(this.hoverTarget=Object.assign({},o.target),this.emit("hoverchange",o))}};var Er=class extends rn{constructor(e,i){super(e),this.id=`key-${i.id}`,this._operation=i,window.mocha||(this._keybinding=this.context.keybinding()),this._keydown=this._keydown.bind(this)}enable(){if(this._enabled)return;let e=this._operation;e.available()&&e.keys&&(this._keybinding.on(e.keys,this._keydown),this._enabled=!0)}disable(){if(!this._enabled)return;this._enabled=!1;let e=this._operation;e.keys&&this._keybinding.off(e.keys)}_keydown(e){let i=this.context,r=this._operation;if(r.availableForKeypress&&!r.availableForKeypress())return;e.preventDefault(),r.disabled()?i.systems.ui.flash.duration(4e3).iconName(`#rapid-operation-${r.id}`).iconClass("operation disabled").label(r.tooltip)():(i.systems.ui.flash.duration(2e3).iconName(`#rapid-operation-${r.id}`).iconClass("operation").label(r.annotation()||r.title)(),r.point&&r.point(null),r())}};var mm=class extends rn{constructor(e){super(e),this.id="lasso",this._lassoing=!1,this._extent=null,this._coords=[],this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this._lassoing=!1,this._extent=null;let e=this.context.systems.map.renderer.events;e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup)}disable(){if(!this._enabled)return;this._enabled=!1,this._lassoing=!1,this._extent=null;let e=this.context.systems.map.renderer.events;e.off("pointerdown",this._pointerdown),e.off("pointermove",this._pointermove),e.off("pointerup",this._pointerup)}_pointerdown(){let e=this.context.systems.map.renderer.events;if(!e.pointerOverRenderer)return;if(e.modifierKeys.has("Shift")){this._lassoing=!0;let s=this.context.systems.map.mouseLoc();this._extent=new mt(s),this._coords.push(s)}}_pointermove(){if(!this._lassoing||!this.context.systems.map.renderer.events.pointerOverRenderer)return;let i=this.context.systems.map.mouseLoc();this._extent=this._extent.extend(new mt(i)),this._coords.push(i);let r=this.context.scene().layers.get("map-ui");r.lassoPolygonData=this._coords,this.context.systems.map.immediateRedraw()}_pointerup(){if(!this._lassoing)return;this._lassoing=!1;let e=this.context.scene().layers.get("map-ui"),i=this._lassoed();this._coords=[],e.lassoPolygonData=this._coords,this._extent=null,i.length&&this.context.enter("select-osm",{selectedIDs:i})}_normalize(e,i){return[[Math.min(e[0],i[0]),Math.min(e[1],i[1])],[Math.max(e[0],i[0]),Math.max(e[1],i[1])]]}_lassoed(){let e=this.context.graph(),i=this.context,r=this._coords,s=i.systems.locations;if(!this.context.editable())return[];let n=this.context.systems.edits.intersects(this._extent).filter(o=>o.type==="node"&&Lf(o.loc,r)&&!i.systems.filters.isHidden(o,e,o.geometry(e))&&!s.blocksAt(o.loc).length);return n.sort(function(o,a){let l=e.parentWays(o),u=e.parentWays(a);if(l.length&&u.length){let d=Yn(l,u);if(d.length){let m=d[0].nodes;return m.indexOf(o.id)-m.indexOf(a.id)}else return parseFloat(l[0].id.slice(1))-parseFloat(u[0].id.slice(1))}else if(l.length||u.length)return l.length-u.length;return o.loc[0]-a.loc[0]}),n.map(o=>o.id)}};var WD=256,JX=2,eW=24,jD=In(JX,WD),XD=In(eW,WD),tW=1,iW=4,gm=class extends rn{constructor(e){super(e),this.id="map-interaction",this.lastDown=null,this.gesture=null,this.doubleClickEnabled=!0,this._click=this._click.bind(this),this._keydown=this._keydown.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this),this._pointercancel=this._pointercancel.bind(this),this._wheel=this._wheel.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.lastDown=null,this.gesture=null;let e=this.context.systems.map.renderer.events;e.on("click",this._click),e.on("keydown",this._keydown),e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup),e.on("pointercancel",this._pointercancel),e.on("wheel",this._wheel)}disable(){if(!this._enabled)return;this._enabled=!1,this.lastDown=null,this.gesture=null;let e=this.context.systems.map.renderer.events;e.off("click",this._click),e.off("keydown",this._keydown),e.off("pointerdown",this._pointerdown),e.off("pointermove",this._pointermove),e.off("pointerup",this._pointerup),e.off("pointercancel",this._pointercancel),e.off("wheel",this._wheel)}_keydown(e){if((document.activeElement?.tagName??"BODY")!=="BODY")return;let s=this.context.systems.map,n=100;if(!e.shiftKey){let[a,l]=s.dimensions,u=e.altKey||e.metaKey||e.ctrlKey,d;e.key==="ArrowLeft"?d=u?[a/2,0]:[80,0]:e.key==="ArrowRight"?d=u?[-a/2,0]:[-80,0]:e.key==="ArrowUp"?d=u?[0,l/2]:[0,80]:e.key==="ArrowDown"&&(d=u?[0,-l/2]:[0,-80]),d&&(e.preventDefault(),s.pan(d,n))}}_click(e){if(!this.doubleClickEnabled||e.detail!==2||e.pointerType==="mouse"&&e.button!==0)return;function i(m,g,_){return Math.max(g,Math.min(m,_))}let[r,s]=[e.global.x,e.global.y],n=this.context.projection.transform(),o=e.getModifierState("Shift"),a=[(r-n.x)/n.k,(s-n.y)/n.k],l=n.k*(o?.5:2);l=i(l,jD,XD);let u=r-a[0]*l,d=s-a[1]*l;this.context.systems.map.transformEase({x:u,y:d,k:l})}_pointerdown(e){if(this.lastDown)return;let i=this.context.systems.map.renderer.events;if(i.modifierKeys.has("Shift"))return;let r=this._getEventData(e);r.target?.data instanceof vi&&r.target?.layerID==="osm"&&e.pointerType==="mouse"&&e.button===0||(this.lastDown=r,this.gesture=null,i.setCursor("grabbing"))}_pointermove(e){let i=this.lastDown,r=this._getEventData(e);if(!(!i||i.id!==r.id)){if(!this.gesture){let s=Hi(i.coord,r.coord),n=i.originalEvent.pointerType==="pen"?iW:tW;this.was=[r.originalEvent.clientX,r.originalEvent.clientY],s>=n&&(this.gesture="pan")}if(this.gesture==="pan"){let s=r.originalEvent,n=this.context.projection.transform(),o=s.clientX-this.was[0],a=s.clientY-this.was[1];this.was=[s.clientX,s.clientY];let l={x:n.x+o,y:n.y+a,k:n.k};this.context.systems.map.transform(l)}}}_pointerup(e){let i=this.lastDown,r=this._getEventData(e);if(!i||i.id!==r.id)return;this.lastDown=null,this.gesture=null,this.context.systems.map.renderer.events.setCursor("inherit")}_pointercancel(){this.lastDown=null,this.gesture=null,this.context.systems.map.renderer.events.setCursor("inherit")}_wheel(e){let[i,r]=[e.offsetX,e.offsetY],[s,n]=[e._normalizedDeltaX,e._normalizedDeltaY],o=this.context.projection.transform(),a;function l(u,d,m){return Math.max(d,Math.min(u,m))}if(e._gesture==="zoom"){let u=(i-o.x)/o.k,d=(r-o.y)/o.k,m=o.k*Math.pow(2,-n/500);m=l(m,jD,XD);let g=i-u*m,_=r-d*m;a={x:g,y:_,k:m}}else a={x:o.x-s,y:o.y-n,k:o.k};this.context.systems.map.transform(a)}};var qD=.1,ym=class extends rn{constructor(e){super(e),this.id="map-nudging",this._pointermove=this._pointermove.bind(this)}enable(){if(this._enabled)return;this.context.systems.map.renderer.events.on("pointermove",this._pointermove)}allow(){this._enabled=!0}disable(){if(!this._enabled)return;this._enabled=!1,this.context.systems.map.renderer.events.off("pointermove",this._pointermove)}_pointermove(e){if(!this._enabled)return;let i=[e.global.x,e.global.y],r=b8(i,this.context.systems.map.dimensions);if(r){let[s,n]=[r[0]*qD,r[1]*qD],o=this.context.projection.transform(),a={x:o.x+s,y:o.y+n,k:o.k};this.context.systems.map.transform(a)}}};var YD=Os().os==="mac",_m=class extends rn{constructor(e){super(e),this.id="paste",this._keydown=this._keydown.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.context.systems.map.renderer.events.on("keydown",this._keydown)}disable(){if(!this._enabled)return;this._enabled=!1,this.context.systems.map.renderer.events.off("keydown",this._keydown)}_keydown(e){(YD&&e.metaKey||!YD&&e.ctrlKey)&&e.key==="v"&&this._doPaste(e)}_doPaste(e){let i=this.context,r=i.copyIDs;if(!r.length)return;let s=i.systems.map.renderer.events;if(!s.pointerOverRenderer)return;e.preventDefault(),e.stopPropagation();let n=i.copyGraph,o=i.projection,a=U2(r,n);i.perform(a);let l=a.copies(),u=new mt,d=new Set,m=new Set;Object.values(l).forEach(A=>m.add(A.id));for(let A in l){let M=n.entity(A),k=l[A];u=u.extend(M.extent(n)),i.graph().parentWays(k).some(B=>m.has(B.id))||d.add(k.id)}let g=i.copyLoc,_=g&&o.project(g)||o.project(u.center()),v=s.coord||i.systems.map.centerPoint(),E=tr(v,_),b=i.t("operations.paste.annotation",{n:d.size});i.perform($c(Array.from(d),E,o),b);let T=new Map;for(let A of d)T.set(A,i.entity(A));i.enter("move",{selection:T})}};var GE=4,ZD=12,xm=class extends rn{constructor(e){super(e),this.id="select",this._multiSelection=new Set,this._spaceClickDisabled=!1,this._longPressTimeout=null,this._showsMenu=!1,this.lastDown=null,this.lastUp=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._cancelLongPress=this._cancelLongPress.bind(this),this._doLongPress=this._doLongPress.bind(this),this._keydown=this._keydown.bind(this),this._keyup=this._keyup.bind(this),this._pointercancel=this._pointercancel.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this._multiSelection.clear(),this._spaceClickDisabled=!1,this._longPressTimeout=null,this._showsMenu=!1,this.lastDown=null,this.lastUp=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null;let e=this.context.systems.map.renderer.events;e.on("keydown",this._keydown),e.on("keyup",this._keyup),e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup),e.on("pointercancel",this._pointercancel)}disable(){if(!this._enabled)return;this._enabled=!1,this._multiSelection.clear(),this._spaceClickDisabled=!1,this._longPressTimeout=null,this._showsMenu=!1,this.lastDown=null,this.lastUp=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._cancelLongPress();let e=this.context.systems.map.renderer.events;e.off("keydown",this._keydown),e.off("keyup",this._keyup),e.off("pointerdown",this._pointerdown),e.off("pointermove",this._pointermove),e.off("pointerup",this._pointerup),e.off("pointercancel",this._pointercancel)}_keydown(e){if(this._cancelLongPress(),e.key==="ContextMenu"){e.preventDefault(),this._doContextMenu();return}else if(!this._spaceClickDisabled&&[" ","Spacebar"].includes(e.key)){let i=document.activeElement;if(i&&new Set(["INPUT","TEXTAREA"]).has(i.nodeName))return;e.preventDefault(),e.stopPropagation(),this._spacebar()}}_keyup(e){this._spaceClickDisabled&&[" ","Spacebar"].includes(e.key)&&(e.preventDefault(),e.stopPropagation(),this._spaceClickDisabled=!1)}_pointerdown(e){if(this.lastDown)return;this.context.systems.ui.closeEditMenu(),this._showsMenu=!1;let i=this._getEventData(e);this.lastDown=i,this.lastClick=null,this._cancelLongPress(),e.pointerType==="touch"&&(this._longPressTimeout=window.setTimeout(this._doLongPress,750,i))}_pointermove(e){let i=this._getEventData(e);this.lastMove=i,this._spaceClickDisabled&&this.lastSpace&&Hi(i.coord,this.lastSpace.coord)>ZD&&(this._spaceClickDisabled=!1);let r=this.lastDown;r&&!r.isCancelled&&r.id===i.id&&Hi(r.coord,i.coord)>=GE&&(r.isCancelled=!0)}_pointerup(e){let i=this.lastDown,r=this._getEventData(e);if(!i||i.id!==r.id||(this.lastDown=null,i.isCancelled))return;let s=Hi(i.coord,r.coord),n=Hi(r.coord,this.lastUp?this.lastUp.coord:0);r.event.button===0&&this.lastUp?.target?.dataID&&n<GE&&this.lastUp?.target?.dataID===r.target?.dataID&&r.time-(this.lastUp?this.lastUp.time:0)<500?(this.lastClick=this.lastUp=r,this._doDoubleClick()):(s<GE||s<ZD&&r.time-i.time<500)&&(this.lastClick=this.lastUp=r,i.originalEvent.button===2?(this.context.selectedIDs().includes(i.target.dataID)||this._doSelect(),this._doContextMenu()):this._doSelect())}_pointercancel(){this.lastDown=null}_spacebar(){this._spaceClickDisabled||this.lastMove&&(this._spaceClickDisabled=!0,this.lastSpace=this.lastMove,this.lastClick=this.lastMove,this._doSelect())}_doSelect(){if(!this._enabled||!this.lastClick)return;this._cancelLongPress();let e=this.context,r=e.systems.map.renderer.events.modifierKeys,s=r.has("Alt")||r.has("Control")||r.has("Meta"),n=r.has("Shift"),o=Object.assign({},this.lastClick);s&&(o.target=null);let a=o.target,l=a?.data,u=a?.dataID;if(l){let d=this.context.behaviors["map-interaction"];d.doubleClickEnabled=!1,window.setTimeout(()=>d.doubleClickEnabled=!0,500)}if(l?.type==="midpoint"&&(l=l.way,u=l.id),!l){e.systems.photos.selectPhoto(null),e.mode?.id!=="browse"&&!this._multiSelection.size&&e.enter("browse");return}if(l.__fbid__||l.__featurehash__||l instanceof Fr||l instanceof vr){let d=new Map().set(u,l);e.enter("select",{selection:d});return}if(l instanceof Dt){let d=e.selectedIDs();n?d.includes(u)?this._showsMenu||(d=d.filter(m=>m!==u),e.enter("select-osm",{selectedIDs:d})):(d.push(u),e.enter("select-osm",{selectedIDs:d})):(!this._showsMenu||d.length<=1||!d.includes(u))&&e.enter("select-osm",{selectedIDs:[u]})}if(l.captured_at){let d=a.layerID;e.systems.map.centerEase(l.loc),e.systems.photos.selectPhoto(d,u)}if(l.first_seen_at){let d=e.services.mapillary;if(!d?.started)return;e.systems.map.centerEase(event.loc);let m=d.getActiveImage()&&d.getActiveImage().id;d.getDetectionsAsync(u).then(g=>{if(!g.length)return;let _=g[0].image.id;e.systems.photos.selectPhoto("mapillary",_)})}}_cancelLongPress(){this._longPressTimeout&&(window.clearTimeout(this._longPressTimeout),this._longPressTimeout=null,this._showsMenu=!1)}_doLongPress(e){this._longPressTimeout=null,this.lastDown===e&&!e.isCancelled&&(this.lastClick=e,e.isCancelled=!0,this._doSelect(),this._doContextMenu())}_doDoubleClick(){if(!this._enabled||!this.lastUp)return;let e=this.context,i=this.lastUp.coord,r=this.lastUp.target?.data,s=r instanceof Cr&&!r.__fbid__,n=r.type==="midpoint";if(s){let o=e.graph(),a=e.projection,l=a.invert(i),u=Gs(o.childNodes(r),i,a),d=[r.nodes[u.index-1],r.nodes[u.index]];e.perform(tn({loc:l,edge:d},vi()),e.t("operations.add.annotation.vertex")),e.systems.validator.validate()}else if(n){let o=[r.a.id,r.b.id];e.perform(tn({loc:r.loc,edge:o},vi()),e.t("operations.add.annotation.vertex")),e.systems.validator.validate()}}_doContextMenu(){if(!this._enabled||!this.lastClick)return;let e=this.context,r=e.systems.map.renderer.events.modifierKeys,s=r.has("Alt")||r.has("Control")||r.has("Meta"),n=Object.assign({},this.lastClick);s&&(n.target=null),this._showsMenu?(e.systems.ui.closeEditMenu(),this._showsMenu=!1):(this._showsMenu=!0,e.systems.ui.showEditMenu(n.coord))}};var ac={available:new Map};ac.available.set("drag",dm);ac.available.set("draw",fm);ac.available.set("hover",pm);ac.available.set("lasso",mm);ac.available.set("map-interaction",gm);ac.available.set("map-nudging",ym);ac.available.set("paste",_m);ac.available.set("select",xm);var ui=class extends en.default{constructor(e){super(),this.context=e,this.id="",this.dependencies=new Set,this.autoStart=!0,this._started=!1}get started(){return this._started}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}};var vm=class extends ui{constructor(e){super(e),this.id="data",this.dependencies=new Set;let i=new Map;if(i.set("address_formats","data/address_formats.min.json"),i.set("deprecated","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.4/dist/deprecated.min.json"),i.set("discarded","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.4/dist/discarded.min.json"),i.set("imagery","data/imagery.min.json"),i.set("intro_graph","data/intro_graph.min.json"),i.set("intro_rapid_graph","data/intro_rapid_graph.min.json"),i.set("keepRight","data/keepRight.min.json"),i.set("languages","data/languages.min.json"),i.set("locales","locales/index.min.json"),i.set("oci_defaults","https://cdn.jsdelivr.net/npm/osm-community-index@5.6/dist/defaults.min.json"),i.set("oci_features","https://cdn.jsdelivr.net/npm/osm-community-index@5.6/dist/featureCollection.min.json"),i.set("oci_resources","https://cdn.jsdelivr.net/npm/osm-community-index@5.6/dist/resources.min.json"),i.set("phone_formats","data/phone_formats.min.json"),i.set("preset_categories","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.4/dist/preset_categories.min.json"),i.set("preset_defaults","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.4/dist/preset_defaults.min.json"),i.set("preset_fields","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.4/dist/fields.min.json"),i.set("preset_presets","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.4/dist/presets.min.json"),i.set("qa_data","data/qa_data.min.json"),i.set("shortcuts","data/shortcuts.min.json"),i.set("territory_languages","data/territory_languages.min.json"),i.set("wmf_sitematrix","https://cdn.jsdelivr.net/npm/wmf-sitematrix@0.1/wikipedia.min.json"),this.fileMap=i,this._cachedData={},this._inflight={},window.mocha){let r=this._cachedData;r.address_formats=[{format:[["housenumber","street"],["city","postcode"]]}],r.deprecated=[{old:{highway:"no"}},{old:{highway:"ford"},replace:{ford:"*"}}],r.discarded={},r.imagery=[],r.keepRight={},r.languages={de:{nativeName:"Deutsch"},en:{nativeName:"English"}},r.locales={en:{rtl:!1,pct:1}},r.locale_general_en={en:{}},r.locale_tagging_en={en:{}},r.locales_index_general={en:{rtl:!1,pct:1}},r.locales_index_tagging={en:{rtl:!1,pct:1}},r.phone_formats={},r.preset_categories={},r.preset_defaults={},r.preset_fields={},r.preset_presets={},r.qa_data={improveOSM:{},osmose:{}},r.shortcuts=[],r.territory_languages={},r.wmf_sitematrix=[["English","English","en"],["German","Deutsch","de"]]}}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}getDataAsync(e){if(this._cachedData[e])return Promise.resolve(this._cachedData[e]);let i=this.fileMap.get(e),r=i&&this.context.asset(i);if(!r)return Promise.reject(`Unknown data file for "${e}"`);let s=this._inflight[r];return s||(this._inflight[r]=s=fetch(r).then(Ai).then(n=>{if(delete this._inflight[r],!n)throw new Error(`No data loaded for "${e}"`);return this._cachedData[e]=n,n}).catch(n=>{throw delete this._inflight[r],n})),s}};function Ye(t,e=""){let i=t.replace("#","");return function(s){s.selectAll(`svg.icon-${i}`).data([i],n=>n).enter().append("svg").attr("class",`icon icon-${i}`+(e?` ${e}`:"")).append("use").attr("xlink:href",t)}}function ws(t,e){let i=zi("modal"),r=t.select("div.modal"),s=r.empty();r.transition().duration(200).style("opacity",0).remove();let n=t.append("div").attr("class","shaded").style("opacity",0);n.close=()=>{n.transition().duration(200).style("opacity",0).remove(),o.transition().duration(200).style("top","0px"),ye(document).call(i.unbind)};let o=n.append("div").attr("class","modal fillL");return o.append("input").attr("class","keytrap keytrap-first").on("focus.keytrap",l),e||(n.on("click.remove-modal",u=>{u.target===this&&n.close()}),o.append("button").attr("class","close").on("click",n.close).call(Ye("#rapid-icon-close")),i.on("\u232B",n.close).on("\u238B",n.close),ye(document).call(i)),o.append("div").attr("class","content"),o.append("input").attr("class","keytrap keytrap-last").on("focus.keytrap",a),s?n.transition().style("opacity",1):n.style("opacity",1),n;function a(){let u=o.select("a, button, input:not(.keytrap), select, textarea").node();u?u.focus():ye(this).node().blur()}function l(){let u=o.selectAll("a, button, input:not(.keytrap), select, textarea").nodes();u.length?u[u.length-1].focus():ye(this).node().blur()}}function Vc(t){let e=ye(null),i="",r=!1,s=n=>{e=ws(n,r);let o=e.select(".content").classed("loading-modal",!0).append("div").attr("class","modal-section fillL");return o.append("img").attr("class","loader").attr("src",t.asset("img/loader-white.gif")),o.append("h3").html(i),e.select("button.close").attr("class","hide"),s};return s.message=function(n){return arguments.length?(i=n,s):i},s.blocking=function(n){return arguments.length?(r=n,s):r},s.close=()=>{e.remove()},s.isShown=()=>e&&!e.empty()&&e.node().parentNode,s}var rW=150,bm=class extends ui{constructor(e){super(e),this.id="edits",this.dependencies=new Set(["storage","map","rapid"]),this._mutex=CI("lock"),this._hasRestorableChanges=!1,this._imageryUsed=[],this._photosUsed=[],this._checkpoints={},this._pausedGraph=!1,this._stack=[],this._tree=null,this._index=0,this._initPromise=null,this.graph=this.graph.bind(this),this.pauseChangeDispatch=this.pauseChangeDispatch.bind(this),this.resumeChangeDispatch=this.resumeChangeDispatch.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let r of this.dependencies)if(!this.context.systems[r])return Promise.reject(`Cannot init:  ${this.id} requires ${r}`);this.reset();let e=this.context.systems.storage,i=e.initAsync();return this._initPromise=i.then(()=>{this._hasRestorableChanges=this._mutex.lock()&&e.hasItem(this._historyKey())})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this.reset(),Promise.resolve()}reset(){ye(document).interrupt("editTransition");let e=new vn;this._stack=[{graph:e}],this._tree=new qa(e),this._index=0,this._checkpoints={},this.emit("reset")}graph(){return this._stack[this._index].graph}tree(){return this._tree}base(){return this._stack[0].graph}peekAnnotation(){return this._stack[this._index].annotation}peekAllAnnotations(){let e=[];for(let i=0;i<=this._index;i++)this._stack[i].annotation&&e.push(this._stack[i].annotation);return e}merge(e,i){let r=this.base(),s=this.graph();i instanceof Set||(i=new Set(e.map(a=>a.id)));let n=new Set;for(let a of e)r.hasEntity(a.id)||n.add(a.id);for(let a of i){let l=s.hasEntity(a);if(l?.type==="relation")for(let u of l.members)n.has(u.id)&&l.touch()}let o=this._stack.map(a=>a.graph);r.rebase(e,o,!1),this._tree.rebase(e,!1),this.emit("merge",i)}perform(...e){ye(document).interrupt("editTransition");let i=e[0],r=!1;if((e.length===1||e.length===2&&typeof e[1]!="function")&&(r=!!i.transitionable),r)ye(document).transition("editTransition").duration(rW).ease(j3).tween("history.tween",()=>s=>{s<1&&this._overwrite([i],s)}).on("start",()=>{this._perform([i],0)}).on("end interrupt",()=>{this._overwrite(e,1)});else return this._perform(e)}replace(...e){return ye(document).interrupt("editTransition"),this._replace(e,1)}overwrite(...e){return ye(document).interrupt("editTransition"),this._overwrite(e,1)}pop(e){ye(document).interrupt("editTransition");let i=this._stack[this._index].graph;for((isNaN(+e)||+e<0)&&(e=1);e-- >0&&this._index>0;)this._index--,this._stack.pop();return this._change(i)}undo(){ye(document).interrupt("editTransition");let e=this._stack[this._index];for(;this._index>0&&(this._index--,!this._stack[this._index].annotation););return this.emit("undone",this._stack[this._index],e),this._change(e.graph)}redo(){ye(document).interrupt("editTransition");let e=this._stack[this._index],i=this._index;for(;i<this._stack.length-1;)if(i++,this._stack[i].annotation){this._index=i,this.emit("redone",this._stack[this._index],e);break}return this._change(e.graph)}pauseChangeDispatch(){this._pausedGraph||(this._pausedGraph=this._stack[this._index].graph)}resumeChangeDispatch(){if(this._pausedGraph){let e=this._pausedGraph;return this._pausedGraph=null,this._change(e)}}undoAnnotation(){let e=this._index;for(;e>=0;){if(this._stack[e].annotation)return this._stack[e].annotation;e--}}redoAnnotation(){let e=this._index+1;for(;e<=this._stack.length-1;){if(this._stack[e].annotation)return this._stack[e].annotation;e++}}intersects(e){return this._tree.intersects(e,this._stack[this._index].graph)}difference(){let e=this._stack[0].graph,i=this._stack[this._index].graph;return new Wa(e,i)}changes(e){let i=this._stack[0].graph,r=this._stack[this._index].graph;e&&(r=e(r));let s=new Wa(i,r);return{modified:s.modified(),created:s.created(),deleted:s.deleted()}}hasChanges(){return this.difference().changes.size>0}imageryUsed(e){if(e!==void 0)return this._imageryUsed=e,this;{let i=new Set;return this._stack.slice(1,this._index+1).forEach(function(r){for(let s of r.imageryUsed??[])s!=="Custom"&&i.add(s)}),Array.from(i)}}photosUsed(e){if(e!==void 0)return this._photosUsed=e,this;{let i=new Set;return this._stack.slice(1,this._index+1).forEach(function(r){for(let s of r.photosUsed??[])i.add(s)}),Array.from(i)}}setCheckpoint(e){return ye(document).interrupt("editTransition"),this._checkpoints[e]={stack:this._stack,index:this._index},this}resetToCheckpoint(e){if(ye(document).interrupt("editTransition"),e!==void 0&&this._checkpoints.hasOwnProperty(e)){let i=this._stack[this._index].graph;this._stack=this._checkpoints[e].stack,this._index=this._checkpoints[e].index;let r=this._stack[this._index].graph,s=new Wa(i,r);this.emit("change",s)}}toIntroGraph(){let e={n:0,r:0,w:0},i={},r=this.graph(),s=new Map;for(let a of r.base.entities.values()){let l=o(a);s.set(l.id,l)}for(let[a,l]of r.local.entities)if(l){let u=o(l);s.set(u.id,u)}else s.delete(a);for(let a of s.values())Array.isArray(a.nodes)&&(a.nodes=a.nodes.map(l=>i[l]??l)),Array.isArray(a.members)&&(a.members=a.members.map(l=>(l.id=i[l.id]||l.id,l)));let n={};for(let[a,l]of s)n[a]=l;return JSON.stringify({dataIntroGraph:n});function o(a){let l=un(a,["type","user","v","version","visible"]);l.tags&&!Object.keys(l.tags)&&delete l.tags,Array.isArray(l.loc)&&(l.loc[0]=+l.loc[0].toFixed(6),l.loc[1]=+l.loc[1].toFixed(6));let u=a.id.match(/([nrw])-\d*/);if(u!==null){let d=u[1],m;do m=d+ ++e[d];while(s.has(m));i[a.id]=m,l.id=m}return l}}toJSON(){if(!this.hasChanges())return;let e=this.base(),i=new Map,r=new Map,s=[];for(let n of this._stack){let o=n.graph,a=[],l=[];for(let[d,m]of o.local.entities){if(m){let _=Dt.key(m);i.set(_,m),a.push(_)}else l.push(d);let g=e.hasEntity(d);if(g&&!r.has(d)&&r.set(d,g),m&&m.nodes)for(let _ of m.nodes){let v=e.hasEntity(_);v&&!r.has(v.id)&&r.set(v.id,v)}if(g)for(let _ of e.parentWays(g))r.has(_.id)||r.set(_.id,_)}let u={};a.length&&(u.modified=a),l.length&&(u.deleted=l),n.imageryUsed&&(u.imageryUsed=n.imageryUsed),n.photosUsed&&(u.photosUsed=n.photosUsed),n.annotation&&(u.annotation=n.annotation),n.transform&&(u.transform=n.transform),n.selectedIDs&&(u.selectedIDs=n.selectedIDs),s.push(u)}return JSON.stringify({version:3,entities:[...i.values()],baseEntities:[...r.values()],stack:s,nextIDs:Dt.id.next,index:this._index,timestamp:new Date().getTime()})}fromJSON(e,i){let r=this.context,s=r.systems.rapid,n=r.systems.map,o=this.base(),a=JSON.parse(e),l=!0;if(Dt.id.next=a.nextIDs,this._index=a.index,a.version!==2&&a.version!==3)throw new Error(`History version ${a.version} not supported.`);let u=new Map;for(let m of a.entities)u.set(Dt.key(m),Dt(m));if(a.version>=3){let m=a.baseEntities.map(_=>Dt(_)),g=this._stack.map(_=>_.graph);if(o.rebase(m,g,!0),this._tree.rebase(m,!0),i){let _=r.services.osm,b=m.filter(T=>T.type==="way").reduce(function(T,A){return ss(T,A.nodes)},[]).filter(T=>!o.hasEntity(T));if(b.length&&_){l=!1,n.redrawEnabled=!1;let T=Vc(r).blocking(!0);r.container().call(T);let A=function(M,k){if(!M){let F=ds(k.data,"visible"),O=F.true||[],B=F.false||[];if(O.length){let U=O.map(q=>q.id),$=this._stack.map(q=>q.graph);b=_n(b,U),o.rebase(O,$,!0),this._tree.rebase(O,!0)}B.forEach(function(U){_.loadEntityVersion(U.id,+U.version-1,A)})}(M||!b.length)&&(T.close(),n.redrawEnabled=!0,this.emit("change"),this.emit("restore"))};_.loadMultiple(b,A)}}}this._stack=a.stack.map((m,g)=>{if(g===0)return this._stack[0];let _={};if(Array.isArray(m.modified)&&m.modified.forEach(v=>{let E=u.get(v);_[E.id]=E}),Array.isArray(m.deleted)&&m.deleted.forEach(v=>{_[v]=void 0}),s&&m.annotation?.type==="rapid_accept_feature"){let v=m.annotation.source;s.sources.add("mapwithai"),v&&/^esri/.test(v)&&s.sources.add("esri")}return{graph:new vn(o).load(_),annotation:m.annotation,imageryUsed:m.imageryUsed,photosUsed:m.photosUsed,transform:m.transform,selectedIDs:m.selectedIDs}});let d=this._stack[this._index].transform;return d&&n.transform(d),l&&(this.emit("change"),this.emit("restore")),this}lock(){return this._mutex.lock()}unlock(){return this._mutex.unlock()}save(){if(!this._mutex.locked()||this._hasRestorableChanges)return;let e=this.context.systems.storage,i=this.toJSON();i?e.setItem(this._historyKey(),i)||this.emit("storage_error"):e.removeItem(this._historyKey())}clearSaved(){if(this.context.debouncedSave.cancel(),!this._mutex.locked())return;this._hasRestorableChanges=!1;let e=this.context.systems.storage;e.removeItem(this._historyKey()),e.removeItem("comment"),e.removeItem("hashtags"),e.removeItem("source")}savedHistoryJSON(){return this.context.systems.storage.getItem(this._historyKey())}hasRestorableChanges(){return this._hasRestorableChanges}restore(){if(this._mutex.locked()){this._hasRestorableChanges=!1;let e=this.savedHistoryJSON();e&&this.fromJSON(e,!0)}}_historyKey(){return"Rapid_"+window.location.origin+"_saved_history"}_act(e,i){let r=e.slice(),s;typeof r.at(-1)!="function"&&(s=r.pop());let n=this._stack[this._index].graph;for(let o of r)n=o(n,i);return{graph:n,annotation:s,imageryUsed:this._imageryUsed,photosUsed:this._photosUsed,transform:this.context.projection.transform(),selectedIDs:this.context.selectedIDs()}}_perform(e,i){let r=this._stack[this._index].graph;this._stack=this._stack.slice(0,this._index+1);let s=this._act(e,i);return this._stack.push(s),this._index++,this._change(r)}_replace(e,i){let r=this._stack[this._index].graph,s=this._act(e,i);return this._stack[this._index]=s,this._change(r)}_overwrite(e,i){let r=this._stack[this._index].graph;this._index>0&&(this._index--,this._stack.pop()),this._stack=this._stack.slice(0,this._index+1);let s=this._act(e,i);return this._stack.push(s),this._index++,this._change(r)}_change(e){let i=new Wa(e,this.graph());return this._pausedGraph||this.emit("change",i),i}};var Bg={motorway:!0,motorway_link:!0,trunk:!0,trunk_link:!0,primary:!0,primary_link:!0,secondary:!0,secondary_link:!0,tertiary:!0,tertiary_link:!0,residential:!0,unclassified:!0,living_street:!0},Ug={busway:!0,service:!0,road:!0,track:!0},zg={path:!0,footway:!0,cycleway:!0,bridleway:!0,steps:!0,pedestrian:!0},jn=class{constructor(e){this.filter=e,this.enabled=!0,this.count=0}},wm=class extends ui{constructor(e){super(e),this.id="filters",this.dependencies=new Set(["storage","urlhash"]),this._rules=new Map,this._hidden=new Set,this._forceVisible=new Set,this._cache={},this._initPromise=null,this._hashchange=this._hashchange.bind(this),this._rules.set("points",new jn(this._isPoint.bind(this))),this._rules.set("traffic_roads",new jn(this._isTrafficRoad.bind(this))),this._rules.set("service_roads",new jn(this._isServiceRoad.bind(this))),this._rules.set("paths",new jn(this._isPath.bind(this))),this._rules.set("buildings",new jn(this._isBuilding.bind(this))),this._rules.set("building_parts",new jn(this._isBuildingPart.bind(this))),this._rules.set("indoor",new jn(this._isIndoor.bind(this))),this._rules.set("landuse",new jn(this._isLanduse.bind(this))),this._rules.set("boundaries",new jn(this._isBoundary.bind(this))),this._rules.set("water",new jn(this._isWater.bind(this))),this._rules.set("rail",new jn(this._isRail.bind(this))),this._rules.set("pistes",new jn(this._isPiste.bind(this))),this._rules.set("aerialways",new jn(this._isAerialway.bind(this))),this._rules.set("power",new jn(this._isPower.bind(this))),this._rules.set("past_future",new jn(this._isPastFuture.bind(this))),this._rules.set("others",new jn(this._isOther.bind(this)))}initAsync(){if(this._initPromise)return this._initPromise;for(let s of this.dependencies)if(!this.context.systems[s])return Promise.reject(`Cannot init:  ${this.id} requires ${s}`);let e=this.context.systems.storage,i=this.context.systems.urlhash,r=Promise.all([e.initAsync(),i.initAsync()]);return this._initPromise=r.then(()=>{i.on("hashchange",this._hashchange);let s=i.getParam("disable_features")??e.getItem("disabled-features");if(s){let n=s.replace(/;/g,",").split(",").map(o=>o.trim()).filter(Boolean);for(let o of n){this._hidden.add(o);let a=this._rules.get(o);a.enabled=!1}}})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this._cache={},this._forceVisible.clear(),Promise.resolve()}get keys(){return[...this._rules.keys()]}get hidden(){return this._hidden}isEnabled(e){return this._rules.get(e)?.enabled}enable(e){let i=this._rules.get(e);i&&!i.enabled&&(i.enabled=!0,this._update())}enableAll(){let e=!1;for(let i of this._rules.values())i.enabled||(e=!0,i.enabled=!0);e&&this._update()}disable(e){let i=this._rules.get(e);i&&i.enabled&&(i.enabled=!1,this._update())}disableAll(){let e=!1;for(let i of this._rules.values())i.enabled&&(e=!0,i.enabled=!1);e&&this._update()}toggle(e){let i=this._rules.get(e);i&&(i.enabled=!i.enabled,this._update())}resetStats(){for(let e of this._rules.values())e.count=0;this.emit("filterchange")}gatherStats(e,i){let r=ds(e,"type"),s=[].concat(r.relation||[],r.way||[],r.node||[]);for(let n of this._rules.values())n.count=0;for(let n of s){let o=n.geometry(i),a=Object.keys(this.getMatches(n,i,o));for(let l of a){let u=this._rules.get(l);u.count++}}}stats(){let e={};for(let[i,r]of this._rules)e[i]=r.count;return e}clear(e){for(let i of e)this.clearEntity(i)}clearEntity(e){let i=Dt.key(e);delete this._cache[i]}getMatches(e,i,r){if(r==="vertex")return{};if(r==="relation"&&e.tags.type!=="boundary")return{};let s=Dt.key(e);if(this._cache[s]||(this._cache[s]={}),!this._cache[s].matches){let n={},o=!1;for(let[a,l]of this._rules){if(a==="others"){if(o)continue;if(e.type==="way"){let u=this.getParents(e,i,r);if(u.length===1&&u[0].isMultipolygon()||u.length>0&&u.every(d=>d.tags.type==="boundary")){let d=Dt.key(u[0]);if(this._cache[d]&&this._cache[d].matches){n=Object.assign({},this._cache[d].matches);continue}}}}l.filter(e.tags,r)&&(n[a]=o=!0)}this._cache[s].matches=n}return this._cache[s].matches}getParents(e,i,r){if(r==="point")return[];let s=Dt.key(e);if(this._cache[s]||(this._cache[s]={}),!this._cache[s].parents){let n;r==="vertex"?n=i.parentWays(e):n=i.parentRelations(e),this._cache[s].parents=n}return this._cache[s].parents}isHiddenPreset(e,i){if(!this._hidden.size||!e.tags)return!1;let r=e.setTags({},i);for(let[s,n]of this._rules)if(n.filter(r,i))return this._hidden.has(s)?s:!1;return!1}isHiddenFeature(e,i,r){if(!this._hidden.size||!e.version||this._forceVisible.has(e.id))return!1;let s=Object.keys(this.getMatches(e,i,r));return s.length&&s.every(n=>this._hidden.has(n))}isHiddenChild(e,i,r){if(!this._hidden.size||!e.version||r==="point"||this._forceVisible.has(e.id))return!1;let s=this.getParents(e,i,r);if(!s.length)return!1;for(let n of s)if(!this.isHidden(n,i,n.geometry(i)))return!1;return!0}hasHiddenConnections(e,i){if(!this._hidden.size)return!1;let r,s;return e.type==="midpoint"?(r=[i.entity(e.edge[0]),i.entity(e.edge[1])],s=[]):(r=e.nodes?i.childNodes(e):[],s=this.getParents(e,i,e.geometry(i))),s=r.reduce((n,o)=>i.isShared(o)?ss(n,i.parentWays(o)):n,s),s.some(n=>this.isHidden(n,i,n.geometry(i)))}isHidden(e,i,r){return!this._hidden.size||!e.version?!1:r==="vertex"?this.isHiddenChild(e,i,r):this.isHiddenFeature(e,i,r)}filter(e,i){if(!this._hidden.size)return e;var r=[];for(let s of e)this.isHidden(s,i,s.geometry(i))||r.push(s);return r}forceVisible(e){this._forceVisible=new Set;for(let i of e){this._forceVisible.add(i);let r=this.context.hasEntity(i);if(r?.type==="relation")for(let s of r.members)this._forceVisible.add(s.id)}}_hashchange(e,i){let r=e.get("disable_features"),s=i.get("disable_features");if(r!==s){let n=new Set;typeof r=="string"&&(n=new Set(r.replace(/;/g,",").split(",")));let o=!1;for(let[a,l]of this._rules)l.enabled&&n.has(a)?(l.enabled=!1,o=!0):!l.enabled&&!n.has(a)&&(l.enabled=!0,o=!0);o&&this._update()}}_update(){this._hidden=new Set;for(let[s,n]of this._rules)n.enabled||this._hidden.add(s);let e=[...this._hidden].join(",");this.context.systems.urlhash.setParam("disable_features",e.length?e:null),this.context.systems.storage.setItem("disabled-features",e),this.emit("filterchange")}_isPoint(e,i){return i==="point"}_isTrafficRoad(e){return Bg[e.highway]}_isServiceRoad(e){return Ug[e.highway]}_isPath(e){return zg[e.highway]}_isBuilding(e){return!!e.building&&e.building!=="no"||e.parking==="multi-storey"||e.parking==="sheds"||e.parking==="carports"||e.parking==="garage_boxes"}_isBuildingPart(e){return e["building:part"]}_isIndoor(e){return e.indoor}_isLanduse(e,i){return i==="area"&&!this._isBuilding(e)&&!this._isBuildingPart(e)&&!this._isIndoor(e)&&!this._isWater(e)&&!this._isAerialway(e)}_isBoundary(e){return!!e.boundary&&!(Bg[e.highway]||Ug[e.highway]||zg[e.highway]||e.waterway||e.railway||e.landuse||e.natural||e.building||e.power)}_isWater(e){return!!e.waterway||e.natural==="water"||e.natural==="coastline"||e.natural==="bay"||e.landuse==="pond"||e.landuse==="basin"||e.landuse==="reservoir"||e.landuse==="salt_pond"}_isRail(e){return(!!e.railway||e.landuse==="railway")&&!(Bg[e.highway]||Ug[e.highway]||zg[e.highway])}_isPiste(e){return e["piste:type"]}_isAerialway(e){return e.aerialway&&e.aerialway!=="yes"&&e.aerialway!=="station"}_isPower(e){return!!e.power}_isPastFuture(e){if(Bg[e.highway]||Ug[e.highway]||zg[e.highway])return!1;for(let i of Object.keys(e))if(S1[i]||S1[e[i]])return!0;return!1}_isOther(e,i){return i==="line"||i==="area"}};var aF=Xi(Am(),1);var Cm=class extends ui{constructor(e){super(e),this.id="imagery",this.dependencies=new Set(["data","edits","l10n","map","urlhash"]),this._initPromise=null,this._imageryIndex=null,this._baseLayer=null,this._overlayLayers=new Map,this._checkedBlocklists=[],this._isValid=!0,this._brightness=1,this._contrast=1,this._saturation=1,this._sharpness=1,this._numGridSplits=0,this._hashchange=this._hashchange.bind(this),this.updateImagery=this.updateImagery.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let a of this.dependencies)if(!this.context.systems[a])return Promise.reject(`Cannot init:  ${this.id} requires ${a}`);let e=this.context,i=e.systems.data,r=e.systems.map,s=e.systems.storage,n=e.systems.urlhash,o=Promise.all([r.initAsync(),i.initAsync(),s.initAsync(),n.initAsync()]);return this._initPromise=o.then(()=>n.on("hashchange",this._hashchange)).then(()=>i.getDataAsync("imagery")).then(a=>this._initImageryIndex(a))}_initImageryIndex(e){let i=this.context;this._imageryIndex={features:new Map,sources:new Map,query:null};let r=e.map(l=>{if(!l.polygon)return null;let u=l.polygon.map(m=>[m]),d={type:"Feature",properties:{id:l.id},geometry:{type:"MultiPolygon",coordinates:u}};return this._imageryIndex.features.set(l.id.toLowerCase(),d),d}).filter(Boolean);this._imageryIndex.query=(0,aF.default)({type:"FeatureCollection",features:r});for(let l of e){let u;l.type==="bing"?u=new j2(i,l):/^EsriWorldImagery/.test(l.id)?u=new X2(i,l):u=new Il(i,l),this._imageryIndex.sources.set(l.id.toLowerCase(),u)}let s=new H2(i);this._imageryIndex.sources.set(s.id,s);let n=new V2(i),o=this.context.systems.storage;n.template=o.getItem("background-custom-template")||"",this._imageryIndex.sources.set(n.id,n);let a=this._imageryIndex.sources.get("mapbox_locator_overlay");a&&this.toggleOverlayLayer(a)}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context.systems.map,i=e.startAsync();return this._startPromise=i.then(()=>{e.scene.on("layerchange",this.updateImagery),this._started=!0})}resetAsync(){return Promise.resolve()}_hashchange(e,i){let r=e.get("background"),s=i.get("background");if(!r||r!==s){let u;typeof r=="string"&&(u=this.getSource(r)),u||(u=this.chooseDefaultSource()),this.baseLayerSource(u)}let n=e.get("overlays"),o=i.get("overlays");if(n!==o){let u=new Set;if(typeof n=="string"){let d=n.split(",").map(m=>m.trim().toLowerCase()).filter(Boolean);u=new Set(d)}this.enableOverlayLayers(u)}let a=e.get("offset"),l=i.get("offset");if(a!==l){let u,d;typeof a=="string"&&([u,d]=a.replace(/;/g,",").split(",").map(m=>m.trim()).map(Number)),(isNaN(u)||!isFinite(u))&&(u=0),(isNaN(d)||!isFinite(d))&&(d=0),this.offset=g8([u,d])}}updateImagery(){let e=this._baseLayer;if(this.context.inIntro||!e)return;let i=[],r=[],s=e.imageryUsed;s&&this._isValid&&i.push(s);let n=e.id;n==="custom"&&(n=`custom:${e.template}`);for(let m of this._overlayLayers.values())m.isLocatorOverlay()||(r.push(m.id),i.push(m.imageryUsed));this.context.systems.edits.imageryUsed(i);let o=this.context.systems.urlhash;o.setParam("background",n),o.setParam("overlays",r.length?r.join(","):null);let a=y8(e.offset),l=.01,u=+a[0].toFixed(2),d=+a[1].toFixed(2);o.setParam("offset",Math.abs(u)>l||Math.abs(d)>l?`${u},${d}`:null)}sources(e,i){if(!this._imageryIndex)return[];let r=new Set;(this._imageryIndex.query.bbox(e.rectangle(),!0)||[]).forEach(u=>r.add(u.id));let s=this._baseLayer,n=[...this._imageryIndex.sources.values()],a=this.context.services.osm?.imageryBlocklists??[];if(a.length!==this._checkedBlocklists.length||a.some((u,d)=>String(u)!==this._checkedBlocklists[d])){for(let u of n)u.isBlocked=a.some(d=>d.test(u.template));this._checkedBlocklists=a.map(u=>String(u))}return n.filter(u=>s===u?!0:u.isBlocked?!1:u.polygon?i&&i<6?!1:r.has(u.id):!0)}baseLayerSource(e){if(!arguments.length)return this._baseLayer;let i=this.context.services.osm;if(!i)return this;let r=i?.imageryBlocklists??[],s=e.template,n=!1,o=0,a;for(a of r)if(n=a.test(s),o++,n)break;return o||(a=/.*\.google(apis)?\..*\/(vt|kh)[\?\/].*([xyz]=.*){3}.*/,n=a.test(s)),this._baseLayer=n?this.getSource("none"):e,this.updateImagery(),this.emit("imagerychange"),this}chooseDefaultSource(){let e=this.context.systems.map,i=this.sources(e.extent(),e.zoom()),r=i[0],s=i.find(l=>l.best),o=this.context.systems.storage.getItem("background-last-used")||"none",a=o!=="none"&&this.getSource(o);return s||a||this.getSource("Bing")||r||this.getSource("none")}getSource(e){return this._imageryIndex?this._imageryIndex.sources.get(e.toLowerCase()):null}showsLayer(e){let i=this._baseLayer;return!e||!i?!1:e.id===i.id||this._overlayLayers.has(e.id)}overlayLayerSources(){return[...this._overlayLayers.values()]}toggleOverlayLayer(e){this._overlayLayers.has(e.id)?this._overlayLayers.delete(e.id):this._overlayLayers.set(e.id,e),this.updateImagery(),this.emit("imagerychange")}enableOverlayLayers(e){for(let[i,r]of this._overlayLayers)r.isLocatorOverlay()||this._overlayLayers.delete(i);for(let i of e){let r=this.getSource(i);r&&this._overlayLayers.set(r.id,r)}this.updateImagery(),this.emit("imagerychange")}nudge(e,i){this._baseLayer&&(this._baseLayer.nudge(e,i),this.updateImagery(),this.emit("imagerychange"))}get offset(){return this._baseLayer?.offset||[0,0]}set offset([e,i]=[0,0]){let[r,s]=this._baseLayer?.offset||[0,0];e===r&&i===s||this._baseLayer&&(this._baseLayer.offset=[e,i],this.updateImagery(),this.emit("imagerychange"))}get brightness(){return this._brightness}set brightness(e=1){e!==this._brightness&&(this._brightness=e,this.context.scene().layers.get("background")?.setBrightness(e),this.emit("imagerychange"))}get contrast(){return this._contrast}set contrast(e=1){e!==this._contrast&&(this._contrast=e,this.context.scene().layers.get("background")?.setContrast(e),this.emit("imagerychange"))}get saturation(){return this._saturation}set saturation(e=1){e!==this._saturation&&(this._saturation=e,this.context.scene().layers.get("background")?.setSaturation(e),this.emit("imagerychange"))}get sharpness(){return this._sharpness}set sharpness(e=1){e!==this._sharpness&&(this._sharpness=e,this.context.scene().layers.get("background")?.setSharpness(e),this.emit("imagerychange"))}get numGridSplits(){return this._numGridSplits}set numGridSplits(e=0){e!==this._numGridSplits&&(this._numGridSplits=e,this.emit("imagerychange"))}};function lF(t,e,i){let r=i-e;return((t-e)%r+r)%r+e}function cF(t,e,i){return Math.max(e,Math.min(t,i))}var Im=class extends ui{constructor(e){super(e),this.id="l10n",this.dependencies=new Set(["data","presets","urlhash"]),this._supportedLanguages={},this._supportedLocales={},this._cache={},this._initPromise=null,this._preferredLocaleCodes=[],this._currLocaleCode="en-US",this._currLocaleCodes=["en-US","en"],this._currLanguageCode="en",this._currTextDirection="ltr",this._currIsMetric=!1,this._languageNames={},this._scriptNames={},this.t=this.t.bind(this),this.tHtml=this.tHtml.bind(this),this.tAppend=this.tAppend.bind(this)}localeCode(){return this._currLocaleCode}localeCodes(){return this._currLocaleCodes}languageCode(){return this._currLanguageCode}textDirection(){return this._currTextDirection}usesMetric(){return this._currIsMetric}languageNames(){return this._languageNames}scriptNames(){return this._scriptNames}isRTL(){return this._currTextDirection==="rtl"}set preferredLocaleCodes(e){typeof e=="string"?this._preferredLocaleCodes=e.split(/,|;| /gi).filter(Boolean):this._preferredLocaleCodes=e||[]}get preferredLocaleCodes(){return this._preferredLocaleCodes}initAsync(){if(this._initPromise)return this._initPromise;for(let n of this.dependencies)if(!this.context.systems[n])return Promise.reject(`Cannot init:  ${this.id} requires ${n}`);let e={general:"locales",tagging:"https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.4/dist/translations"},i=this.context.systems.data,r=this.context.systems.urlhash,s=Promise.all([i.initAsync(),r.initAsync()]);return this._initPromise=s.then(()=>{let n=["languages","locales"],o=i.fileMap;for(let a in e){let l=`locales_index_${a}`;o.has(l)||o.set(l,e[a]+"/index.min.json"),n.push(l)}return Promise.all(n.map(a=>i.getDataAsync(a)))}).then(n=>{this._supportedLanguages=n[0],this._supportedLocales=n[1];let o=r.initialHashParams.get("locale");o&&(this._preferredLocaleCodes=o.split(",").map(d=>d.trim()).filter(Boolean));let a=n.slice(2),l=(this._preferredLocaleCodes||[]).concat(Os().browserLocales).concat(["en"]);this._currLocaleCodes=this._localesToUseFrom(l),this._currLocaleCode=this._currLocaleCodes[0];let u=[];return a.forEach((d,m)=>{this._currLocaleCodes.forEach(g=>{let _=Object.keys(e)[m],v=Object.values(e)[m];d[g]&&u.push(this.loadLocaleAsync(g,_,v))})}),Promise.all(u)}).then(()=>this._updateForCurrentLocale()).catch(n=>console.error(n))}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}loadLocaleAsync(e,i,r){if(e.toLowerCase()==="en-us"&&(e="en"),this._cache[i]&&this._cache[i][e])return Promise.resolve(e);let s=this.context.systems.data,n=s.fileMap,o=`locale_${i}_${e}`;return n.has(o)||n.set(o,`${r}/${e}.min.json`),s.getDataAsync(o).then(a=>(this._cache[i]||(this._cache[i]={}),this._cache[i][e]=a[e],e))}pluralRule(e,i=this._currLocaleCode){let r="Intl"in window&&Intl.PluralRules&&new Intl.PluralRules(i);return r?r.select(e):e===1?"one":"other"}_getString(e,i,r){let s=e.trim(),n="general";if(s[0]==="_"){let m=s.split(".");n=m[0].slice(1),s=m.slice(1).join(".")}r=r||this._currLocaleCode;let o=s.split(".").map(m=>m.replace(/<TX_DOT>/g,".")).reverse(),a=r;a.toLowerCase()==="en-us"&&(a="en");let l=this._cache[n]&&this._cache[n][a];for(;l!==void 0&&o.length;)l=l[o.pop()];if(l!==void 0){if(i){if(typeof l=="object"&&Object.keys(l).length){let m=Object.values(i).find(g=>typeof g=="number");if(m!==void 0){let g=this.pluralRule(m,r);l[g]?l=l[g]:l=Object.values(l)[0]}}if(typeof l=="string")for(let m in i){let g=i[m];typeof g=="number"&&(g.toLocaleString?g=g.toLocaleString(r,{style:"decimal",useGrouping:!0,minimumFractionDigits:0}):g=g.toString());let _=`{${m}}`,v=new RegExp(_,"g");l=l.replace(v,g)}}if(typeof l=="string")return{text:l,locale:r}}let u=this._currLocaleCodes.indexOf(r);if(u>=0&&u<this._currLocaleCodes.length-1){let m=this._currLocaleCodes[u+1];return this._getString(e,i,m)}if(i&&"default"in i)return{text:i.default,locale:null};let d=`Missing ${r} translation: ${e}`;return typeof console<"u"&&console.error(d),{text:d,locale:"en"}}hasTextForStringID(e){return!!this._getString(e,{default:"nothing found"}).locale}t(e,i,r){return this._getString(e,i,r).text}tHtml(e,i,r){let s=this._getString(e,i,r);return s.text?this.htmlForLocalizedText(s.text,s.locale):""}tAppend(e,i,r){let s=function(n){let o=this._getString(e,i,r);return n.append("span").attr("class","localized-text").attr("lang",o.locale||"und").text((i?.prefix||"")+o.text+(i?.suffix||""))};return s.stringID=e,s}htmlForLocalizedText(e,i){return`<span class="localized-text" lang="${i||"unknown"}">${e}</span>`}languageName(e,i){if(this._languageNames[e])return this._languageNames[e];if(i&&i.localOnly)return null;let r=this._supportedLanguages[e];if(r){if(r.nativeName)return this.t("translate.language_and_code",{language:r.nativeName,code:e});if(r.base&&r.script){let s=r.base;if(this._languageNames[s]){let n=r.script,o=this._scriptNames[n]||n;return this.t("translate.language_and_code",{language:this._languageNames[s],code:o})}else if(this._supportedLanguages[s]&&this._supportedLanguages[s].nativeName)return this.t("translate.language_and_code",{language:this._supportedLanguages[s].nativeName,code:e})}}return e}displayName(e,i){let r=this._currLanguageCode.toLowerCase(),s=e.route,n=e[`name:${r}`]??e.name??"",o={name:n,direction:e.direction,from:e.from,network:i?void 0:e.cycle_network??e.network,ref:e.ref,to:e.to,via:e.via};if(s&&o.ref&&o.name)return o.network?this.t("inspector.display_name.network_ref_name",o):this.t("inspector.display_name.ref_name",o);if(n)return n;let a=[];return o.network&&a.push("network"),o.ref&&a.push("ref"),s&&(o.direction?a.push("direction"):o.from&&o.to&&(a.push("from"),a.push("to"),o.via&&a.push("via"))),a.length?this.t("inspector.display_name."+a.join("_"),o):""}displayPOIName(e){let i=this._currLanguageCode.toLowerCase();return e[`name:${i}`]??e.name??e[`brand:${i}`]??e.brand??e[`operator:${i}`]??e.operator??""}displayType(e){return{n:this.t("inspector.node"),w:this.t("inspector.way"),r:this.t("inspector.relation")}[e.charAt(0)]}displayLabel(e,i,r){let s=this.displayName(e.tags),n=this.context.systems.presets,o=typeof i=="string"?n.matchTags(e.tags,i):n.match(e,i),a=o&&(o.suggestion?o.subtitle():o.name()),l;return r?l=[a,s].filter(Boolean).join(" "):l=s||a,l??this.displayType(e.id)}displayLength(e,i){let r=this._currLocaleCode,s=e*(i?3.28084:1),n;return i?s>=5280?(s/=5280,n="miles"):n="feet":s>=1e3?(s/=1e3,n="kilometers"):n="meters",this.t(`units.${n}`,{quantity:s.toLocaleString(r,{maximumSignificantDigits:4})})}displayArea(e,i){let r=this._currLocaleCode,s=e*(i?10.7639111056:1),n,o,a,l;i?(s>=6969600?(n=s/27878400,a="square_miles"):(n=s,a="square_feet"),s>4356&&s<4356e4&&(o=s/43560,l="acres")):(s>=25e4?(n=s/1e6,a="square_kilometers"):(n=s,a="square_meters"),s>1e3&&s<1e7&&(o=s/1e4,l="hectares"));let u=this.t(`units.${a}`,{quantity:n.toLocaleString(r,{maximumSignificantDigits:4})});if(l){let d=this.t(`units.${l}`,{quantity:o.toLocaleString(r,{maximumSignificantDigits:2})});return this.t("units.area_pair",{area1:u,area2:d})}else return u}dmsCoordinatePair(e){return this.t("units.coordinate_pair",{latitude:this._displayCoordinate(cF(e[1],-90,90),"north","south"),longitude:this._displayCoordinate(lF(e[0],-180,180),"east","west")})}decimalCoordinatePair(e){return this.t("units.coordinate_pair",{latitude:cF(e[1],-90,90).toFixed(7),longitude:lF(e[0],-180,180).toFixed(7)})}_displayCoordinate(e,i,r){let s=this._currLocaleCode,n=(Math.abs(e)-Math.floor(Math.abs(e)))*60,o=(n-Math.floor(n))*60,a=this.t("units.arcdegrees",{quantity:Math.floor(Math.abs(e)).toLocaleString(s)}),l;return Math.floor(o)>0?l=a+this.t("units.arcminutes",{quantity:Math.floor(n).toLocaleString(s)})+this.t("units.arcseconds",{quantity:Math.round(o).toLocaleString(s)}):Math.floor(n)>0?l=a+this.t("units.arcminutes",{quantity:Math.round(n).toLocaleString(s)}):l=this.t("units.arcdegrees",{quantity:Math.round(Math.abs(e)).toLocaleString(s)}),e===0?l:this.t("units.coordinate",{coordinate:l,direction:this.t("units."+(e>0?i:r))})}_localesToUseFrom(e){let i=new Set;return e.forEach(r=>{if(this._supportedLocales[r]&&i.add(r),r.includes("-")){let s=r.split("-")[0];this._supportedLocales[s]&&i.add(s)}}),Array.from(i)}_updateForCurrentLocale(){if(!this._currLocaleCode)return;let[e,i]=this._currLocaleCode.toLowerCase().split("-",2);this._currLanguageCode=e,this._currIsMetric=i!=="us";let s=this.context.systems.urlhash.initialHashParams.get("rtl");if(s==="true")this._currTextDirection="rtl";else if(s==="false")this._currTextDirection="ltr";else{let o=this._supportedLocales[this._currLocaleCode]||this._supportedLocales[this._currLanguageCode];this._currTextDirection=o&&o.rtl?"rtl":"ltr"}let n=this._currLocaleCode;n.toLowerCase()==="en-us"&&(n="en"),this._languageNames=this._cache.general[n].languageNames,this._scriptNames=this._cache.general[n].scriptNames}};var uF=Xi(Am(),1),pW={type:"FeatureCollection",features:[{type:"Feature",properties:{wikidata:"Q21",nameEn:"England",aliases:["GB-ENG"],country:"GB",groups:["Q23666","Q3336843","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44"]},geometry:{type:"MultiPolygon",coordinates:[[[[-6.03913,51.13217],[-7.74976,48.64773],[1.17405,50.74239],[2.18458,51.52087],[2.56575,51.85301],[.792,57.56437],[-2.30613,55.62698],[-2.17058,55.45916],[-2.6095,55.28488],[-2.63532,55.19452],[-3.02906,55.04606],[-3.09361,54.94924],[-3.38407,54.94278],[-4.1819,54.57861],[-3.5082,53.54318],[-3.08228,53.25526],[-3.03675,53.25092],[-2.92329,53.19383],[-2.92022,53.17685],[-2.98598,53.15589],[-2.90649,53.10964],[-2.87469,53.12337],[-2.89131,53.09374],[-2.83133,52.99184],[-2.7251,52.98389],[-2.72221,52.92969],[-2.80549,52.89428],[-2.85897,52.94487],[-2.92401,52.93836],[-2.97243,52.9651],[-3.13576,52.895],[-3.15744,52.84947],[-3.16105,52.79599],[-3.08734,52.77504],[-3.01001,52.76636],[-2.95581,52.71794],[-3.01724,52.72083],[-3.04398,52.65435],[-3.13648,52.58208],[-3.12926,52.5286],[-3.09746,52.53077],[-3.08662,52.54811],[-3.00929,52.57774],[-2.99701,52.551],[-3.03603,52.49969],[-3.13359,52.49174],[-3.22971,52.45344],[-3.22754,52.42526],[-3.04687,52.34504],[-2.95364,52.3501],[-2.99701,52.323],[-3.00785,52.2753],[-3.09289,52.20546],[-3.12638,52.08114],[-2.97111,51.90456],[-2.8818,51.93196],[-2.78742,51.88833],[-2.74277,51.84367],[-2.66234,51.83555],[-2.66336,51.59504],[-3.20563,51.31615],[-6.03913,51.13217]]]]}},{type:"Feature",properties:{wikidata:"Q22",nameEn:"Scotland",aliases:["GB-SCT"],country:"GB",groups:["Q23666","Q3336843","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44"]},geometry:{type:"MultiPolygon",coordinates:[[[[.792,57.56437],[-.3751,61.32236],[-14.78497,57.60709],[-6.82333,55.83103],[-4.69044,54.3629],[-3.38407,54.94278],[-3.09361,54.94924],[-3.02906,55.04606],[-2.63532,55.19452],[-2.6095,55.28488],[-2.17058,55.45916],[-2.30613,55.62698],[.792,57.56437]]]]}},{type:"Feature",properties:{wikidata:"Q25",nameEn:"Wales",aliases:["GB-WLS"],country:"GB",groups:["Q23666","Q3336843","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44"]},geometry:{type:"MultiPolygon",coordinates:[[[[-3.5082,53.54318],[-5.37267,53.63269],[-6.03913,51.13217],[-3.20563,51.31615],[-2.66336,51.59504],[-2.66234,51.83555],[-2.74277,51.84367],[-2.78742,51.88833],[-2.8818,51.93196],[-2.97111,51.90456],[-3.12638,52.08114],[-3.09289,52.20546],[-3.00785,52.2753],[-2.99701,52.323],[-2.95364,52.3501],[-3.04687,52.34504],[-3.22754,52.42526],[-3.22971,52.45344],[-3.13359,52.49174],[-3.03603,52.49969],[-2.99701,52.551],[-3.00929,52.57774],[-3.08662,52.54811],[-3.09746,52.53077],[-3.12926,52.5286],[-3.13648,52.58208],[-3.04398,52.65435],[-3.01724,52.72083],[-2.95581,52.71794],[-3.01001,52.76636],[-3.08734,52.77504],[-3.16105,52.79599],[-3.15744,52.84947],[-3.13576,52.895],[-2.97243,52.9651],[-2.92401,52.93836],[-2.85897,52.94487],[-2.80549,52.89428],[-2.72221,52.92969],[-2.7251,52.98389],[-2.83133,52.99184],[-2.89131,53.09374],[-2.87469,53.12337],[-2.90649,53.10964],[-2.98598,53.15589],[-2.92022,53.17685],[-2.92329,53.19383],[-3.03675,53.25092],[-3.08228,53.25526],[-3.5082,53.54318]]]]}},{type:"Feature",properties:{wikidata:"Q26",nameEn:"Northern Ireland",aliases:["GB-NIR"],country:"GB",groups:["Q22890","Q3336843","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44"]},geometry:{type:"MultiPolygon",coordinates:[[[[-6.34755,55.49206],[-7.2471,55.06933],[-7.34464,55.04688],[-7.4033,55.00391],[-7.40004,54.94498],[-7.44404,54.9403],[-7.4473,54.87003],[-7.47626,54.83084],[-7.54508,54.79401],[-7.54671,54.74606],[-7.64449,54.75265],[-7.75041,54.7103],[-7.83352,54.73854],[-7.93293,54.66603],[-7.70315,54.62077],[-7.8596,54.53671],[-7.99812,54.54427],[-8.04538,54.48941],[-8.179,54.46763],[-8.04555,54.36292],[-7.87101,54.29299],[-7.8596,54.21779],[-7.81397,54.20159],[-7.69501,54.20731],[-7.55812,54.12239],[-7.4799,54.12239],[-7.44567,54.1539],[-7.32834,54.11475],[-7.30553,54.11869],[-7.34005,54.14698],[-7.29157,54.17191],[-7.28017,54.16714],[-7.29687,54.1354],[-7.29493,54.12013],[-7.26316,54.13863],[-7.25012,54.20063],[-7.14908,54.22732],[-7.19145,54.31296],[-7.02034,54.4212],[-6.87775,54.34682],[-6.85179,54.29176],[-6.81583,54.22791],[-6.74575,54.18788],[-6.70175,54.20218],[-6.6382,54.17071],[-6.66264,54.0666],[-6.62842,54.03503],[-6.47849,54.06947],[-6.36605,54.07234],[-6.36279,54.11248],[-6.32694,54.09337],[-6.29003,54.11278],[-6.26218,54.09785],[-5.83481,53.87749],[-4.69044,54.3629],[-6.34755,55.49206]]]]}},{type:"Feature",properties:{wikidata:"Q35",nameEn:"Denmark",country:"DK",groups:["EU","154","150","UN"],callingCodes:["45"]},geometry:{type:"MultiPolygon",coordinates:[[[[12.16597,56.60205],[10.40861,58.38489],[7.28637,57.35913],[8.02459,55.09613],[8.45719,55.06747],[8.55769,54.91837],[8.63979,54.91069],[8.76387,54.8948],[8.81178,54.90518],[8.92795,54.90452],[9.04629,54.87249],[9.14275,54.87421],[9.20571,54.85841],[9.24631,54.84726],[9.23445,54.83432],[9.2474,54.8112],[9.32771,54.80602],[9.33849,54.80233],[9.36496,54.81749],[9.38532,54.83968],[9.41213,54.84254],[9.43155,54.82586],[9.4659,54.83131],[9.58937,54.88785],[9.62734,54.88057],[9.61187,54.85548],[9.73563,54.8247],[9.89314,54.84171],[10.16755,54.73883],[10.31111,54.65968],[11.00303,54.63689],[11.90309,54.38543],[12.85844,54.82438],[13.93395,54.84044],[15.36991,54.73263],[15.79951,55.54655],[14.89259,55.5623],[14.28399,55.1553],[12.84405,55.13257],[12.60345,55.42675],[12.88472,55.63369],[12.6372,55.91371],[12.65312,56.04345],[12.07466,56.29488],[12.16597,56.60205]]]]}},{type:"Feature",properties:{wikidata:"Q55",nameEn:"Netherlands",country:"NL",groups:["EU","155","150","UN"],callingCodes:["31"]},geometry:{type:"MultiPolygon",coordinates:[[[[5.45168,54.20039],[2.56575,51.85301],[3.36263,51.37112],[3.38696,51.33436],[3.35847,51.31572],[3.38289,51.27331],[3.41704,51.25933],[3.43488,51.24135],[3.52698,51.2458],[3.51502,51.28697],[3.58939,51.30064],[3.78999,51.25766],[3.78783,51.2151],[3.90125,51.20371],[3.97889,51.22537],[4.01957,51.24504],[4.05165,51.24171],[4.16721,51.29348],[4.24024,51.35371],[4.21923,51.37443],[4.33265,51.37687],[4.34086,51.35738],[4.39292,51.35547],[4.43777,51.36989],[4.38064,51.41965],[4.39747,51.43316],[4.38122,51.44905],[4.47736,51.4778],[4.5388,51.48184],[4.54675,51.47265],[4.52846,51.45002],[4.53521,51.4243],[4.57489,51.4324],[4.65442,51.42352],[4.72935,51.48424],[4.74578,51.48937],[4.77321,51.50529],[4.78803,51.50284],[4.84139,51.4799],[4.82409,51.44736],[4.82946,51.4213],[4.78314,51.43319],[4.76577,51.43046],[4.77229,51.41337],[4.78941,51.41102],[4.84988,51.41502],[4.90016,51.41404],[4.92152,51.39487],[5.00393,51.44406],[5.0106,51.47167],[5.03281,51.48679],[5.04774,51.47022],[5.07891,51.4715],[5.10456,51.43163],[5.07102,51.39469],[5.13105,51.34791],[5.13377,51.31592],[5.16222,51.31035],[5.2002,51.32243],[5.24244,51.30495],[5.22542,51.26888],[5.23814,51.26064],[5.26461,51.26693],[5.29716,51.26104],[5.33886,51.26314],[5.347,51.27502],[5.41672,51.26248],[5.4407,51.28169],[5.46519,51.2849],[5.48476,51.30053],[5.515,51.29462],[5.5569,51.26544],[5.5603,51.22249],[5.65145,51.19788],[5.65528,51.18736],[5.70344,51.1829],[5.74617,51.18928],[5.77735,51.17845],[5.77697,51.1522],[5.82564,51.16753],[5.85508,51.14445],[5.80798,51.11661],[5.8109,51.10861],[5.83226,51.10585],[5.82921,51.09328],[5.79903,51.09371],[5.79835,51.05834],[5.77258,51.06196],[5.75961,51.03113],[5.77688,51.02483],[5.76242,50.99703],[5.71864,50.96092],[5.72875,50.95428],[5.74752,50.96202],[5.75927,50.95601],[5.74644,50.94723],[5.72545,50.92312],[5.72644,50.91167],[5.71626,50.90796],[5.69858,50.91046],[5.67886,50.88142],[5.64504,50.87107],[5.64009,50.84742],[5.65259,50.82309],[5.70118,50.80764],[5.68995,50.79641],[5.70107,50.7827],[5.68091,50.75804],[5.69469,50.75529],[5.72216,50.76398],[5.73904,50.75674],[5.74356,50.7691],[5.76533,50.78159],[5.77513,50.78308],[5.80673,50.7558],[5.84548,50.76542],[5.84888,50.75448],[5.88734,50.77092],[5.89129,50.75125],[5.89132,50.75124],[5.95942,50.7622],[5.97545,50.75441],[6.01976,50.75398],[6.02624,50.77453],[5.97497,50.79992],[5.98404,50.80988],[6.00462,50.80065],[6.02328,50.81694],[6.01921,50.84435],[6.05623,50.8572],[6.05702,50.85179],[6.07431,50.84674],[6.07693,50.86025],[6.08805,50.87223],[6.07486,50.89307],[6.09297,50.92066],[6.01615,50.93367],[6.02697,50.98303],[5.95282,50.98728],[5.90296,50.97356],[5.90493,51.00198],[5.87849,51.01969],[5.86735,51.05182],[5.9134,51.06736],[5.9541,51.03496],[5.98292,51.07469],[6.16706,51.15677],[6.17384,51.19589],[6.07889,51.17038],[6.07889,51.24432],[6.16977,51.33169],[6.22674,51.36135],[6.22641,51.39948],[6.20654,51.40049],[6.21724,51.48568],[6.18017,51.54096],[6.09055,51.60564],[6.11759,51.65609],[6.02767,51.6742],[6.04091,51.71821],[5.95003,51.7493],[5.98665,51.76944],[5.94568,51.82786],[5.99848,51.83195],[6.06705,51.86136],[6.10337,51.84829],[6.16902,51.84094],[6.11551,51.89769],[6.15349,51.90439],[6.21443,51.86801],[6.29872,51.86801],[6.30593,51.84998],[6.40704,51.82771],[6.38815,51.87257],[6.47179,51.85395],[6.50231,51.86313],[6.58556,51.89386],[6.68386,51.91861],[6.72319,51.89518],[6.82357,51.96711],[6.83035,51.9905],[6.68128,52.05052],[6.76117,52.11895],[6.83984,52.11728],[6.97189,52.20329],[6.9897,52.2271],[7.03729,52.22695],[7.06365,52.23789],[7.02703,52.27941],[7.07044,52.37805],[7.03417,52.40237],[6.99041,52.47235],[6.94293,52.43597],[6.69507,52.488],[6.71641,52.62905],[6.77307,52.65375],[7.04557,52.63318],[7.07253,52.81083],[7.21694,53.00742],[7.17898,53.13817],[7.22681,53.18165],[7.21679,53.20058],[7.19052,53.31866],[7.00198,53.32672],[6.91025,53.44221],[5.45168,54.20039]],[[4.93295,51.44945],[4.95244,51.45207],[4.9524,51.45014],[4.93909,51.44632],[4.93295,51.44945]],[[4.91493,51.4353],[4.91935,51.43634],[4.92227,51.44252],[4.91811,51.44621],[4.92287,51.44741],[4.92811,51.4437],[4.92566,51.44273],[4.92815,51.43856],[4.92879,51.44161],[4.93544,51.44634],[4.94025,51.44193],[4.93416,51.44185],[4.93471,51.43861],[4.94265,51.44003],[4.93986,51.43064],[4.92952,51.42984],[4.92652,51.43329],[4.91493,51.4353]]]]}},{type:"Feature",properties:{wikidata:"Q782",nameEn:"Hawaii",aliases:["US-HI"],country:"US",groups:["Q35657","061","009","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-177.8563,29.18961],[-179.49839,27.86265],[-151.6784,9.55515],[-154.05867,45.51124],[-177.5224,27.7635],[-177.8563,29.18961]]]]}},{type:"Feature",properties:{wikidata:"Q797",nameEn:"Alaska",aliases:["US-AK"],country:"US",groups:["Q35657","021","003","019","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[169.34848,52.47228],[180,51.0171],[179.84401,55.10087],[169.34848,52.47228]]],[[[-168.95635,65.98512],[-169.03888,65.48473],[-172.76104,63.77445],[-179.55295,57.62081],[-179.55295,50.81807],[-133.92876,54.62289],[-130.61931,54.70835],[-130.64499,54.76912],[-130.44184,54.85377],[-130.27203,54.97174],[-130.18765,55.07744],[-130.08035,55.21556],[-129.97513,55.28029],[-130.15373,55.74895],[-130.00857,55.91344],[-130.00093,56.00325],[-130.10173,56.12178],[-130.33965,56.10849],[-130.77769,56.36185],[-131.8271,56.62247],[-133.38523,58.42773],[-133.84645,58.73543],[-134.27175,58.8634],[-134.48059,59.13231],[-134.55699,59.1297],[-134.7047,59.2458],[-135.00267,59.28745],[-135.03069,59.56208],[-135.48007,59.79937],[-136.31566,59.59083],[-136.22381,59.55526],[-136.33727,59.44466],[-136.47323,59.46617],[-136.52365,59.16752],[-136.82619,59.16198],[-137.4925,58.89415],[-137.60623,59.24465],[-138.62145,59.76431],[-138.71149,59.90728],[-139.05365,59.99655],[-139.20603,60.08896],[-139.05831,60.35205],[-139.68991,60.33693],[-139.98024,60.18027],[-140.45648,60.30919],[-140.5227,60.22077],[-141.00116,60.30648],[-140.97446,84.39275],[-168.25765,71.99091],[-168.95635,65.98512]]]]}},{type:"Feature",properties:{wikidata:"Q3492",nameEn:"Sumatra",aliases:["ID-SM"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[109.82788,2.86812],[110.90339,7.52694],[105.01437,3.24936],[104.56723,1.44271],[104.34728,1.33529],[104.12282,1.27714],[104.03085,1.26954],[103.74084,1.12902],[103.66049,1.18825],[103.56591,1.19719],[103.03657,1.30383],[96.11174,6.69841],[74.28481,-3.17525],[102.92489,-8.17146],[106.32259,-5.50116],[106.38511,-5.16715],[109.17017,-4.07401],[109.3962,-2.07276],[108.50935,-2.01066],[107.94791,1.06924],[109.82788,2.86812]]]]}},{type:"Feature",properties:{wikidata:"Q3757",nameEn:"Java",aliases:["ID-JW"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[109.17017,-4.07401],[106.38511,-5.16715],[106.32259,-5.50116],[102.92489,-8.17146],[116.22542,-10.49172],[114.39575,-8.2889],[114.42235,-8.09762],[114.92859,-7.49253],[116.33992,-7.56171],[116.58433,-5.30385],[109.17017,-4.07401]]]]}},{type:"Feature",properties:{wikidata:"Q3795",nameEn:"Kalimantan",aliases:["ID-KA"],country:"ID",groups:["Q36117","035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[120.02464,2.83703],[118.06469,4.16638],[117.67641,4.16535],[117.47313,4.18857],[117.25801,4.35108],[115.90217,4.37708],[115.58276,3.93499],[115.53713,3.14776],[115.11343,2.82879],[115.1721,2.49671],[114.80706,2.21665],[114.80706,1.92351],[114.57892,1.5],[114.03788,1.44787],[113.64677,1.23933],[113.01448,1.42832],[113.021,1.57819],[112.48648,1.56516],[112.2127,1.44135],[112.15679,1.17004],[111.94553,1.12016],[111.82846,.99349],[111.55434,.97864],[111.22979,1.08326],[110.62374,.873],[110.49182,.88088],[110.35354,.98869],[109.66397,1.60425],[109.66397,1.79972],[109.57923,1.80624],[109.53794,1.91771],[109.62558,1.99182],[109.82788,2.86812],[107.94791,1.06924],[108.50935,-2.01066],[109.3962,-2.07276],[109.17017,-4.07401],[116.58433,-5.30385],[120.02464,2.83703]]]]}},{type:"Feature",properties:{wikidata:"Q3803",nameEn:"Lesser Sunda Islands",aliases:["ID-NU"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[116.96967,-8.01483],[114.92859,-7.49253],[114.42235,-8.09762],[114.39575,-8.2889],[116.22542,-10.49172],[122.14954,-11.52517],[125.68138,-9.85176],[125.09025,-9.46406],[124.97892,-9.19281],[125.04044,-9.17093],[125.09434,-9.19669],[125.18907,-9.16434],[125.18632,-9.03142],[125.11764,-8.96359],[124.97742,-9.08128],[124.94011,-8.85617],[124.46701,-9.13002],[124.45971,-9.30263],[124.38554,-9.3582],[124.35258,-9.43002],[124.3535,-9.48493],[124.28115,-9.50453],[124.28115,-9.42189],[124.21247,-9.36904],[124.14517,-9.42324],[124.10539,-9.41206],[124.04286,-9.34243],[124.04628,-9.22671],[124.33472,-9.11416],[124.92337,-8.75859],[125.87688,-7.49892],[116.96967,-8.01483]]]]}},{type:"Feature",properties:{wikidata:"Q3812",nameEn:"Sulawesi",aliases:["ID-SL"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[128.34321,3.90322],[126.69413,6.02692],[119.56457,.90759],[116.58433,-5.30385],[116.33992,-7.56171],[116.96967,-8.01483],[125.87688,-7.49892],[123.78965,-.86805],[128.34321,3.90322]]]]}},{type:"Feature",properties:{wikidata:"Q3827",nameEn:"Maluku Islands",aliases:["ID-ML"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[129.63187,2.21409],[128.34321,3.90322],[123.78965,-.86805],[125.87688,-7.49892],[125.58506,-7.95311],[125.87691,-8.31789],[127.42116,-8.22471],[127.55165,-9.05052],[135.49042,-9.2276],[135.35517,-5.01442],[132.8312,-4.70282],[130.8468,-2.61103],[128.40647,-2.30349],[129.71519,-.24692],[129.63187,2.21409]]]]}},{type:"Feature",properties:{wikidata:"Q3845",nameEn:"Western New Guinea",aliases:["ID-PP"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[135.49042,-9.2276],[141.01842,-9.35091],[141.01763,-6.90181],[140.90448,-6.85033],[140.85295,-6.72996],[140.99813,-6.3233],[141.02352,.08993],[129.63187,2.21409],[129.71519,-.24692],[128.40647,-2.30349],[130.8468,-2.61103],[132.8312,-4.70282],[135.35517,-5.01442],[135.49042,-9.2276]]]]}},{type:"Feature",properties:{wikidata:"Q5765",nameEn:"Balearic Islands",aliases:["ES-IB"],country:"ES",groups:["EU","039","150","UN"],callingCodes:["34 971"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.27707,35.35051],[5.10072,39.89531],[3.75438,42.33445],[-2.27707,35.35051]]]]}},{type:"Feature",properties:{wikidata:"Q5823",nameEn:"Ceuta",aliases:["ES-CE"],country:"ES",groups:["EA","EU","015","002","UN"],level:"subterritory",callingCodes:["34"]},geometry:{type:"MultiPolygon",coordinates:[[[[-5.38491,35.92591],[-5.37338,35.88417],[-5.35844,35.87375],[-5.34379,35.8711],[-5.21179,35.90091],[-5.38491,35.92591]]]]}},{type:"Feature",properties:{wikidata:"Q5831",nameEn:"Melilla",aliases:["ES-ML"],country:"ES",groups:["EA","EU","015","002","UN"],level:"subterritory",callingCodes:["34"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.91909,35.33927],[-2.96038,35.31609],[-2.96648,35.30475],[-2.96978,35.29459],[-2.97035,35.28852],[-2.96507,35.28801],[-2.96826,35.28296],[-2.96516,35.27967],[-2.95431,35.2728],[-2.95065,35.26576],[-2.93893,35.26737],[-2.92272,35.27509],[-2.91909,35.33927]]]]}},{type:"Feature",properties:{wikidata:"Q7835",nameEn:"Crimea",country:"RU",groups:["151","150","UN"],level:"subterritory",callingCodes:["7"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.5,44],[36.4883,45.0488],[36.475,45.2411],[36.5049,45.3136],[36.6545,45.3417],[36.6645,45.4514],[35.0498,45.7683],[34.9601,45.7563],[34.7991,45.8101],[34.8015,45.9005],[34.7548,45.907],[34.6668,45.9714],[34.6086,45.9935],[34.5589,45.9935],[34.5201,45.951],[34.4873,45.9427],[34.4415,45.9599],[34.4122,46.0025],[34.3391,46.0611],[34.2511,46.0532],[34.181,46.068],[34.1293,46.1049],[34.0731,46.1177],[34.0527,46.1084],[33.9155,46.1594],[33.8523,46.1986],[33.7972,46.2048],[33.7405,46.1855],[33.646,46.2303],[33.6152,46.2261],[33.6385,46.1415],[33.6147,46.1356],[33.5732,46.1032],[33.5909,46.0601],[33.5597,46.0307],[31.5,45.5],[33.5,44]]]]}},{type:"Feature",properties:{wikidata:"Q12837",nameEn:"Iberia",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q14056",nameEn:"Jan Mayen",aliases:["NO-22"],country:"NO",groups:["SJ","154","150","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[-9.18243,72.23144],[-10.71459,70.09565],[-5.93364,70.76368],[-9.18243,72.23144]]]]}},{type:"Feature",properties:{wikidata:"Q19188",nameEn:"Mainland China",country:"CN",groups:["030","142","UN"],callingCodes:["86"]},geometry:{type:"MultiPolygon",coordinates:[[[[125.6131,53.07229],[125.17522,53.20225],[124.46078,53.21881],[123.86158,53.49391],[123.26989,53.54843],[122.85966,53.47395],[122.35063,53.49565],[121.39213,53.31888],[120.85633,53.28499],[120.0451,52.7359],[120.04049,52.58773],[120.46454,52.63811],[120.71673,52.54099],[120.61346,52.32447],[120.77337,52.20805],[120.65907,51.93544],[120.10963,51.671],[119.13553,50.37412],[119.38598,50.35162],[119.27996,50.13348],[119.11003,50.00276],[118.61623,49.93809],[117.82343,49.52696],[117.48208,49.62324],[117.27597,49.62544],[116.71193,49.83813],[116.03781,48.87014],[116.06565,48.81716],[115.78876,48.51781],[115.811,48.25699],[115.52082,48.15367],[115.57128,47.91988],[115.94296,47.67741],[116.21879,47.88505],[116.4465,47.83662],[116.67405,47.89039],[116.9723,47.87285],[117.37875,47.63627],[117.50181,47.77216],[117.80196,48.01661],[118.03676,48.00982],[118.11009,48.04],[118.22677,48.03853],[118.29654,48.00246],[118.55766,47.99277],[118.7564,47.76947],[119.12343,47.66458],[119.13995,47.53997],[119.35892,47.48104],[119.31964,47.42617],[119.54918,47.29505],[119.56019,47.24874],[119.62403,47.24575],[119.71209,47.19192],[119.85518,46.92196],[119.91242,46.90091],[119.89261,46.66423],[119.80455,46.67631],[119.77373,46.62947],[119.68127,46.59015],[119.65265,46.62342],[119.42827,46.63783],[119.32827,46.61433],[119.24978,46.64761],[119.10448,46.65516],[119.00541,46.74273],[118.92616,46.72765],[118.89974,46.77139],[118.8337,46.77742],[118.78747,46.68689],[118.30534,46.73519],[117.69554,46.50991],[117.60748,46.59771],[117.41782,46.57862],[117.36609,46.36335],[116.83166,46.38637],[116.75551,46.33083],[116.58612,46.30211],[116.26678,45.96479],[116.24012,45.8778],[116.27366,45.78637],[116.16989,45.68603],[115.60329,45.44717],[114.94546,45.37377],[114.74612,45.43585],[114.54801,45.38337],[114.5166,45.27189],[113.70918,44.72891],[112.74662,44.86297],[112.4164,45.06858],[111.98695,45.09074],[111.76275,44.98032],[111.40498,44.3461],[111.96289,43.81596],[111.93776,43.68709],[111.79758,43.6637],[111.59087,43.51207],[111.0149,43.3289],[110.4327,42.78293],[110.08401,42.6411],[109.89402,42.63111],[109.452,42.44842],[109.00679,42.45302],[108.84489,42.40246],[107.57258,42.40898],[107.49681,42.46221],[107.29755,42.41395],[107.24774,42.36107],[106.76517,42.28741],[105.0123,41.63188],[104.51667,41.66113],[104.52258,41.8706],[103.92804,41.78246],[102.72403,42.14675],[102.07645,42.22519],[101.80515,42.50074],[100.84979,42.67087],[100.33297,42.68231],[99.50671,42.56535],[97.1777,42.7964],[96.37926,42.72055],[96.35658,42.90363],[95.89543,43.2528],[95.52594,43.99353],[95.32891,44.02407],[95.39772,44.2805],[95.01191,44.25274],[94.71959,44.35284],[94.10003,44.71016],[93.51161,44.95964],[91.64048,45.07408],[90.89169,45.19667],[90.65114,45.49314],[90.70907,45.73437],[91.03026,46.04194],[90.99672,46.14207],[90.89639,46.30711],[91.07696,46.57315],[91.0147,46.58171],[91.03649,46.72916],[90.84035,46.99525],[90.76108,46.99399],[90.48542,47.30438],[90.48854,47.41826],[90.33598,47.68303],[90.10871,47.7375],[90.06512,47.88177],[89.76624,47.82745],[89.55453,48.0423],[89.0711,47.98528],[88.93186,48.10263],[88.8011,48.11302],[88.58316,48.21893],[88.58939,48.34531],[87.96361,48.58478],[88.0788,48.71436],[87.73822,48.89582],[87.88171,48.95853],[87.81333,49.17354],[87.48983,49.13794],[87.478,49.07403],[87.28386,49.11626],[86.87238,49.12432],[86.73568,48.99918],[86.75343,48.70331],[86.38069,48.46064],[85.73581,48.3939],[85.5169,48.05493],[85.61067,47.49753],[85.69696,47.2898],[85.54294,47.06171],[85.22443,47.04816],[84.93995,46.87399],[84.73077,47.01394],[83.92184,46.98912],[83.04622,47.19053],[82.21792,45.56619],[82.58474,45.40027],[82.51374,45.1755],[81.73278,45.3504],[80.11169,45.03352],[79.8987,44.89957],[80.38384,44.63073],[80.40229,44.23319],[80.40031,44.10986],[80.75156,43.44948],[80.69718,43.32589],[80.77771,43.30065],[80.78817,43.14235],[80.62913,43.141],[80.3735,43.01557],[80.58999,42.9011],[80.38169,42.83142],[80.26886,42.8366],[80.16892,42.61137],[80.26841,42.23797],[80.17807,42.21166],[80.17842,42.03211],[79.92977,42.04113],[78.3732,41.39603],[78.15757,41.38565],[78.12873,41.23091],[77.81287,41.14307],[77.76206,41.01574],[77.52723,41.00227],[77.3693,41.0375],[77.28004,41.0033],[76.99302,41.0696],[76.75681,40.95354],[76.5261,40.46114],[76.33659,40.3482],[75.96168,40.38064],[75.91361,40.2948],[75.69663,40.28642],[75.5854,40.66874],[75.22834,40.45382],[75.08243,40.43945],[74.82013,40.52197],[74.78168,40.44886],[74.85996,40.32857],[74.69875,40.34668],[74.35063,40.09742],[74.25533,40.13191],[73.97049,40.04378],[73.83006,39.76136],[73.9051,39.75073],[73.92354,39.69565],[73.94683,39.60733],[73.87018,39.47879],[73.59831,39.46425],[73.59241,39.40843],[73.5004,39.38402],[73.55396,39.3543],[73.54572,39.27567],[73.60638,39.24534],[73.75823,39.023],[73.81728,39.04007],[73.82964,38.91517],[73.7445,38.93867],[73.7033,38.84782],[73.80656,38.66449],[73.79806,38.61106],[73.97933,38.52945],[74.17022,38.65504],[74.51217,38.47034],[74.69619,38.42947],[74.69894,38.22155],[74.80331,38.19889],[74.82665,38.07359],[74.9063,38.03033],[74.92416,37.83428],[75.00935,37.77486],[74.8912,37.67576],[74.94338,37.55501],[75.06011,37.52779],[75.15899,37.41443],[75.09719,37.37297],[75.12328,37.31839],[74.88887,37.23275],[74.80605,37.21565],[74.49981,37.24518],[74.56453,37.03023],[75.13839,37.02622],[75.40481,36.95382],[75.45562,36.71971],[75.72737,36.7529],[75.92391,36.56986],[76.0324,36.41198],[76.00906,36.17511],[75.93028,36.13136],[76.15325,35.9264],[76.14913,35.82848],[76.33453,35.84296],[76.50961,35.8908],[76.77323,35.66062],[76.84539,35.67356],[76.96624,35.5932],[77.44277,35.46132],[77.70232,35.46244],[77.80532,35.52058],[78.11664,35.48022],[78.03466,35.3785],[78.00033,35.23954],[78.22692,34.88771],[78.18435,34.7998],[78.27781,34.61484],[78.54964,34.57283],[78.56475,34.50835],[78.74465,34.45174],[79.05364,34.32482],[78.99802,34.3027],[78.91769,34.15452],[78.66225,34.08858],[78.65657,34.03195],[78.73367,34.01121],[78.77349,33.73871],[78.67599,33.66445],[78.73636,33.56521],[79.15252,33.17156],[79.14016,33.02545],[79.46562,32.69668],[79.26768,32.53277],[79.13174,32.47766],[79.0979,32.38051],[78.99322,32.37948],[78.96713,32.33655],[78.7831,32.46873],[78.73916,32.69438],[78.38897,32.53938],[78.4645,32.45367],[78.49609,32.2762],[78.68754,32.10256],[78.74404,32.00384],[78.78036,31.99478],[78.69933,31.78723],[78.84516,31.60631],[78.71032,31.50197],[78.77898,31.31209],[78.89344,31.30481],[79.01931,31.42817],[79.14016,31.43403],[79.30694,31.17357],[79.59884,30.93943],[79.93255,30.88288],[80.20721,30.58541],[80.54504,30.44936],[80.83343,30.32023],[81.03953,30.20059],[81.12842,30.01395],[81.24362,30.0126],[81.29032,30.08806],[81.2623,30.14596],[81.33355,30.15303],[81.39928,30.21862],[81.41018,30.42153],[81.5459,30.37688],[81.62033,30.44703],[81.99082,30.33423],[82.10135,30.35439],[82.10757,30.23745],[82.19475,30.16884],[82.16984,30.0692],[82.38622,30.02608],[82.5341,29.9735],[82.73024,29.81695],[83.07116,29.61957],[83.28131,29.56813],[83.44787,29.30513],[83.63156,29.16249],[83.82303,29.30513],[83.97559,29.33091],[84.18107,29.23451],[84.24801,29.02783],[84.2231,28.89571],[84.47528,28.74023],[84.62317,28.73887],[84.85511,28.58041],[85.06059,28.68562],[85.19135,28.62825],[85.18668,28.54076],[85.10729,28.34092],[85.38127,28.28336],[85.4233,28.32996],[85.59765,28.30529],[85.60854,28.25045],[85.69105,28.38475],[85.71907,28.38064],[85.74864,28.23126],[85.84672,28.18187],[85.90743,28.05144],[85.97813,27.99023],[85.94946,27.9401],[86.06309,27.90021],[86.12069,27.93047],[86.08333,28.02121],[86.088,28.09264],[86.18607,28.17364],[86.22966,27.9786],[86.42736,27.91122],[86.51609,27.96623],[86.56265,28.09569],[86.74181,28.10638],[86.75582,28.04182],[87.03757,27.94835],[87.11696,27.84104],[87.56996,27.84517],[87.72718,27.80938],[87.82681,27.95248],[88.13378,27.88015],[88.1278,27.95417],[88.25332,27.9478],[88.54858,28.06057],[88.63235,28.12356],[88.83559,28.01936],[88.88091,27.85192],[88.77517,27.45415],[88.82981,27.38814],[88.91901,27.32483],[88.93678,27.33777],[88.96947,27.30319],[89.00216,27.32532],[88.95355,27.4106],[88.97213,27.51671],[89.0582,27.60985],[89.12825,27.62502],[89.59525,28.16433],[89.79762,28.23979],[90.13387,28.19178],[90.58842,28.02838],[90.69894,28.07784],[91.20019,27.98715],[91.25779,28.07509],[91.46327,28.0064],[91.48973,27.93903],[91.5629,27.84823],[91.6469,27.76358],[91.84722,27.76325],[91.87057,27.7195],[92.27432,27.89077],[92.32101,27.79363],[92.42538,27.80092],[92.7275,27.98662],[92.73025,28.05814],[92.65472,28.07632],[92.67486,28.15018],[92.93075,28.25671],[93.14635,28.37035],[93.18069,28.50319],[93.44621,28.67189],[93.72797,28.68821],[94.35897,29.01965],[94.2752,29.11687],[94.69318,29.31739],[94.81353,29.17804],[95.0978,29.14446],[95.11291,29.09527],[95.2214,29.10727],[95.26122,29.07727],[95.3038,29.13847],[95.41091,29.13007],[95.50842,29.13487],[95.72086,29.20797],[95.75149,29.32063],[95.84899,29.31464],[96.05361,29.38167],[96.31316,29.18643],[96.18682,29.11087],[96.20467,29.02325],[96.3626,29.10607],[96.61391,28.72742],[96.40929,28.51526],[96.48895,28.42955],[96.6455,28.61657],[96.85561,28.4875],[96.88445,28.39452],[96.98882,28.32564],[97.1289,28.3619],[97.34547,28.21385],[97.41729,28.29783],[97.47085,28.2688],[97.50518,28.49716],[97.56835,28.55628],[97.70705,28.5056],[97.79632,28.33168],[97.90069,28.3776],[98.15337,28.12114],[98.13964,27.9478],[98.32641,27.51385],[98.42529,27.55404],[98.43353,27.67086],[98.69582,27.56499],[98.7333,26.85615],[98.77547,26.61994],[98.72741,26.36183],[98.67797,26.24487],[98.7329,26.17218],[98.66884,26.09165],[98.63128,26.15492],[98.57085,26.11547],[98.60763,26.01512],[98.70818,25.86241],[98.63128,25.79937],[98.54064,25.85129],[98.40606,25.61129],[98.31268,25.55307],[98.25774,25.6051],[98.16848,25.62739],[98.18084,25.56298],[98.12591,25.50722],[98.14925,25.41547],[97.92541,25.20815],[97.83614,25.2715],[97.77023,25.11492],[97.72216,25.08508],[97.72903,24.91332],[97.79949,24.85655],[97.76481,24.8289],[97.73127,24.83015],[97.70181,24.84557],[97.64354,24.79171],[97.56648,24.76475],[97.56383,24.75535],[97.5542,24.74943],[97.54675,24.74202],[97.56525,24.72838],[97.56286,24.54535],[97.52757,24.43748],[97.60029,24.4401],[97.66998,24.45288],[97.7098,24.35658],[97.65624,24.33781],[97.66723,24.30027],[97.71941,24.29652],[97.76799,24.26365],[97.72998,24.2302],[97.72799,24.18883],[97.75305,24.16902],[97.72903,24.12606],[97.62363,24.00506],[97.5247,23.94032],[97.64667,23.84574],[97.72302,23.89288],[97.79456,23.94836],[97.79416,23.95663],[97.84328,23.97603],[97.86545,23.97723],[97.88811,23.97446],[97.8955,23.97758],[97.89676,23.97931],[97.89683,23.98389],[97.88814,23.98605],[97.88414,23.99405],[97.88616,24.00463],[97.90998,24.02094],[97.93951,24.01953],[97.98691,24.03897],[97.99583,24.04932],[98.04709,24.07616],[98.05302,24.07408],[98.05671,24.07961],[98.0607,24.07812],[98.06703,24.08028],[98.07806,24.07988],[98.20666,24.11406],[98.54476,24.13119],[98.59256,24.08371],[98.85319,24.13042],[98.87998,24.15624],[98.89632,24.10612],[98.67797,23.9644],[98.68209,23.80492],[98.79607,23.77947],[98.82933,23.72921],[98.81775,23.694],[98.88396,23.59555],[98.80294,23.5345],[98.82877,23.47908],[98.87683,23.48995],[98.92104,23.36946],[98.87573,23.33038],[98.93958,23.31414],[98.92515,23.29535],[98.88597,23.18656],[99.05975,23.16382],[99.04601,23.12215],[99.25741,23.09025],[99.34127,23.13099],[99.52214,23.08218],[99.54218,22.90014],[99.43537,22.94086],[99.45654,22.85726],[99.31243,22.73893],[99.38247,22.57544],[99.37972,22.50188],[99.28771,22.4105],[99.17318,22.18025],[99.19176,22.16983],[99.1552,22.15874],[99.33166,22.09656],[99.47585,22.13345],[99.85351,22.04183],[99.96612,22.05965],[99.99084,21.97053],[99.94003,21.82782],[99.98654,21.71064],[100.04956,21.66843],[100.12679,21.70539],[100.17486,21.65306],[100.10757,21.59945],[100.12542,21.50365],[100.1625,21.48704],[100.18447,21.51898],[100.25863,21.47043],[100.35201,21.53176],[100.42892,21.54325],[100.4811,21.46148],[100.57861,21.45637],[100.72143,21.51898],[100.87265,21.67396],[101.11744,21.77659],[101.15156,21.56129],[101.2124,21.56422],[101.19349,21.41959],[101.26912,21.36482],[101.2229,21.23271],[101.29326,21.17254],[101.54563,21.25668],[101.6068,21.23329],[101.59491,21.18621],[101.60886,21.17947],[101.66977,21.20004],[101.70548,21.14911],[101.7622,21.14813],[101.79266,21.19025],[101.76745,21.21571],[101.83887,21.20983],[101.84412,21.25291],[101.74014,21.30967],[101.74224,21.48276],[101.7727,21.51794],[101.7475,21.5873],[101.80001,21.57461],[101.83257,21.61562],[101.74555,21.72852],[101.7791,21.83019],[101.62566,21.96574],[101.57525,22.13026],[101.60675,22.13513],[101.53638,22.24794],[101.56789,22.28876],[101.61306,22.27515],[101.68973,22.46843],[101.7685,22.50337],[101.86828,22.38397],[101.90714,22.38688],[101.91344,22.44417],[101.98487,22.42766],[102.03633,22.46164],[102.1245,22.43372],[102.14099,22.40092],[102.16621,22.43336],[102.26428,22.41321],[102.25339,22.4607],[102.41061,22.64184],[102.38415,22.67919],[102.42618,22.69212],[102.46665,22.77108],[102.51802,22.77969],[102.57095,22.7036],[102.60675,22.73376],[102.8636,22.60735],[102.9321,22.48659],[103.0722,22.44775],[103.07843,22.50097],[103.17961,22.55705],[103.15782,22.59873],[103.18895,22.64471],[103.28079,22.68063],[103.32282,22.8127],[103.43179,22.75816],[103.43646,22.70648],[103.52675,22.59155],[103.57812,22.65764],[103.56255,22.69499],[103.64506,22.79979],[103.87904,22.56683],[103.93286,22.52703],[103.94513,22.52553],[103.95191,22.5134],[103.96352,22.50584],[103.96783,22.51173],[103.97384,22.50634],[103.99247,22.51958],[104.01088,22.51823],[104.03734,22.72945],[104.11384,22.80363],[104.27084,22.8457],[104.25683,22.76534],[104.35593,22.69353],[104.47225,22.75813],[104.58122,22.85571],[104.60457,22.81841],[104.65283,22.83419],[104.72755,22.81984],[104.77114,22.90017],[104.84942,22.93631],[104.86765,22.95178],[104.8334,23.01484],[104.79478,23.12934],[104.87382,23.12854],[104.87992,23.17141],[104.91435,23.18666],[104.9486,23.17235],[104.96532,23.20463],[104.98712,23.19176],[105.07002,23.26248],[105.11672,23.25247],[105.17276,23.28679],[105.22569,23.27249],[105.32376,23.39684],[105.40782,23.28107],[105.42805,23.30824],[105.49966,23.20669],[105.56037,23.16806],[105.57594,23.075],[105.72382,23.06641],[105.8726,22.92756],[105.90119,22.94168],[105.99568,22.94178],[106.00179,22.99049],[106.19705,22.98475],[106.27022,22.87722],[106.34961,22.86718],[106.49749,22.91164],[106.51306,22.94891],[106.55976,22.92311],[106.60179,22.92884],[106.6516,22.86862],[106.6734,22.89587],[106.71387,22.88296],[106.71128,22.85982],[106.78422,22.81532],[106.81271,22.8226],[106.83685,22.8098],[106.82404,22.7881],[106.76293,22.73491],[106.72321,22.63606],[106.71698,22.58432],[106.65316,22.5757],[106.61269,22.60301],[106.58395,22.474],[106.55665,22.46498],[106.57221,22.37],[106.55976,22.34841],[106.6516,22.33977],[106.69986,22.22309],[106.67495,22.1885],[106.6983,22.15102],[106.70142,22.02409],[106.68274,21.99811],[106.69276,21.96013],[106.72551,21.97923],[106.74345,22.00965],[106.81038,21.97934],[106.9178,21.97357],[106.92714,21.93459],[106.97228,21.92592],[106.99252,21.95191],[107.05634,21.92303],[107.06101,21.88982],[107.00964,21.85948],[107.02615,21.81981],[107.10771,21.79879],[107.20734,21.71493],[107.24625,21.7077],[107.29296,21.74674],[107.35834,21.6672],[107.35989,21.60063],[107.38636,21.59774],[107.41593,21.64839],[107.47197,21.6672],[107.49532,21.62958],[107.49065,21.59774],[107.54047,21.5934],[107.56537,21.61945],[107.66967,21.60787],[107.80355,21.66141],[107.86114,21.65128],[107.90006,21.5905],[107.92652,21.58906],[107.95232,21.5388],[107.96774,21.53601],[107.97074,21.54072],[107.97383,21.53961],[107.97932,21.54503],[108.02926,21.54997],[108.0569,21.53604],[108.10003,21.47338],[108.00365,17.98159],[111.60491,13.57105],[118.41371,24.06775],[118.11703,24.39734],[118.28244,24.51231],[118.35291,24.51645],[118.42453,24.54644],[118.6333,24.46259],[119.42295,25.0886],[119.98511,25.37624],[119.78816,26.2348],[120.0693,26.3959],[120.5128,26.536],[121.03532,26.8787],[123.5458,31.01942],[122.29378,31.76513],[122.80525,33.30571],[123.85601,37.49093],[123.90497,38.79949],[124.17532,39.8232],[124.23201,39.9248],[124.35029,39.95639],[124.37089,40.03004],[124.3322,40.05573],[124.38556,40.11047],[124.40719,40.13655],[124.86913,40.45387],[125.71172,40.85223],[125.76869,40.87908],[126.00335,40.92835],[126.242,41.15454],[126.53189,41.35206],[126.60631,41.65565],[126.90729,41.79955],[127.17841,41.59714],[127.29712,41.49473],[127.92943,41.44291],[128.02633,41.42103],[128.03311,41.39232],[128.12967,41.37931],[128.18546,41.41279],[128.20061,41.40895],[128.30716,41.60322],[128.15119,41.74568],[128.04487,42.01769],[128.94007,42.03537],[128.96068,42.06657],[129.15178,42.17224],[129.22285,42.26491],[129.22423,42.3553],[129.28541,42.41574],[129.42882,42.44702],[129.54701,42.37254],[129.60482,42.44461],[129.72541,42.43739],[129.75294,42.59409],[129.77183,42.69435],[129.7835,42.76521],[129.80719,42.79218],[129.83277,42.86746],[129.85261,42.96494],[129.8865,43.00395],[129.95082,43.01051],[129.96409,42.97306],[130.12957,42.98361],[130.09764,42.91425],[130.26095,42.9027],[130.23068,42.80125],[130.2385,42.71127],[130.41826,42.6011],[130.44361,42.54849],[130.50123,42.61636],[130.55143,42.52158],[130.62107,42.58413],[130.56576,42.68925],[130.40213,42.70788],[130.44361,42.76205],[130.66524,42.84753],[131.02438,42.86518],[131.02668,42.91246],[131.135,42.94114],[131.10274,43.04734],[131.20414,43.13654],[131.19031,43.21385],[131.30324,43.39498],[131.29402,43.46695],[131.19492,43.53047],[131.21105,43.82383],[131.26176,43.94011],[131.23583,43.96085],[131.25484,44.03131],[131.30365,44.04262],[131.1108,44.70266],[130.95639,44.85154],[131.48415,44.99513],[131.68466,45.12374],[131.66852,45.2196],[131.76532,45.22609],[131.86903,45.33636],[131.99417,45.2567],[132.83978,45.05916],[132.96373,45.0212],[133.12293,45.1332],[133.09279,45.25693],[133.19419,45.51913],[133.41083,45.57723],[133.48457,45.86203],[133.60442,45.90053],[133.67569,45.9759],[133.72695,46.05576],[133.68047,46.14697],[133.88097,46.25066],[133.91496,46.4274],[133.84104,46.46681],[134.03538,46.75668],[134.20016,47.33458],[134.50898,47.4812],[134.7671,47.72051],[134.55508,47.98651],[134.67098,48.1564],[134.75328,48.36763],[134.49516,48.42884],[132.66989,47.96491],[132.57309,47.71741],[131.90448,47.68011],[131.2635,47.73325],[131.09871,47.6852],[130.95985,47.6957],[130.90915,47.90623],[130.65103,48.10052],[130.84462,48.30942],[130.52147,48.61745],[130.66946,48.88251],[130.43232,48.90844],[130.2355,48.86741],[129.85416,49.11067],[129.67598,49.29596],[129.50685,49.42398],[129.40398,49.44194],[129.35317,49.3481],[129.23232,49.40353],[129.11153,49.36813],[128.72896,49.58676],[127.83476,49.5748],[127.53516,49.84306],[127.49299,50.01251],[127.60515,50.23503],[127.37384,50.28393],[127.36009,50.43787],[127.28765,50.46585],[127.36335,50.58306],[127.28165,50.72075],[127.14586,50.91152],[126.93135,51.0841],[126.90369,51.3238],[126.68349,51.70607],[126.44606,51.98254],[126.558,52.13738],[125.6131,53.07229]],[[113.56865,22.20973],[113.57123,22.20416],[113.60504,22.20464],[113.63011,22.10782],[113.57191,22.07696],[113.54839,22.10909],[113.54942,22.14519],[113.54093,22.15497],[113.52659,22.18271],[113.53552,22.20607],[113.53301,22.21235],[113.53591,22.21369],[113.54093,22.21314],[113.54333,22.21688],[113.5508,22.21672],[113.56865,22.20973]],[[114.50148,22.15017],[113.92195,22.13873],[113.83338,22.1826],[113.81621,22.2163],[113.86771,22.42972],[114.03113,22.5065],[114.05438,22.5026],[114.05729,22.51104],[114.06272,22.51617],[114.07267,22.51855],[114.07817,22.52997],[114.08606,22.53276],[114.09048,22.53716],[114.09692,22.53435],[114.1034,22.5352],[114.11181,22.52878],[114.11656,22.53415],[114.12665,22.54003],[114.13823,22.54319],[114.1482,22.54091],[114.15123,22.55163],[114.1597,22.56041],[114.17247,22.55944],[114.18338,22.55444],[114.20655,22.55706],[114.22185,22.55343],[114.22888,22.5436],[114.25154,22.55977],[114.44998,22.55977],[114.50148,22.15017]]]]}},{type:"Feature",properties:{wikidata:"Q22890",nameEn:"Ireland",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q23666",nameEn:"Great Britain",country:"GB",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q23681",nameEn:"Northern Cyprus",groups:["Q644636","145","142"],driveSide:"left",callingCodes:["90 392"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.67678,35.03866],[33.67742,35.05963],[33.68474,35.06602],[33.69095,35.06237],[33.70861,35.07644],[33.7161,35.07279],[33.70209,35.04882],[33.71482,35.03722],[33.73824,35.05321],[33.76106,35.04253],[33.78581,35.05104],[33.82067,35.07826],[33.84168,35.06823],[33.8541,35.07201],[33.87479,35.08881],[33.87097,35.09389],[33.87622,35.10457],[33.87224,35.12293],[33.88561,35.12449],[33.88943,35.12007],[33.88737,35.11408],[33.89853,35.11377],[33.91789,35.08688],[33.91299,35.07579],[33.90247,35.07686],[33.89485,35.06873],[33.88367,35.07877],[33.85261,35.0574],[33.8355,35.05777],[33.82051,35.0667],[33.8012,35.04786],[33.81524,35.04192],[33.83055,35.02865],[33.82875,35.01685],[33.84045,35.00616],[33.85216,35.00579],[33.85891,35.001],[33.85621,34.98956],[33.83505,34.98108],[33.84811,34.97075],[33.86432,34.97592],[33.90075,34.96623],[33.98684,34.76642],[35.48515,34.70851],[35.51152,36.10954],[32.82353,35.70297],[32.46489,35.48584],[32.60361,35.16647],[32.64864,35.19967],[32.70947,35.18328],[32.70779,35.14127],[32.85733,35.07742],[32.86406,35.1043],[32.94471,35.09422],[33.01192,35.15639],[33.08249,35.17319],[33.11105,35.15639],[33.15138,35.19504],[33.27068,35.16815],[33.3072,35.16816],[33.31955,35.18096],[33.35056,35.18328],[33.34964,35.17803],[33.35596,35.17942],[33.35612,35.17402],[33.36569,35.17479],[33.3717,35.1788],[33.37248,35.18698],[33.38575,35.2018],[33.4076,35.20062],[33.41675,35.16325],[33.46813,35.10564],[33.48136,35.0636],[33.47825,35.04103],[33.45178,35.02078],[33.45256,35.00288],[33.47666,35.00701],[33.48915,35.06594],[33.53975,35.08151],[33.57478,35.06049],[33.567,35.04803],[33.59658,35.03635],[33.61215,35.0527],[33.63765,35.03869],[33.67678,35.03866]]]]}},{type:"Feature",properties:{wikidata:"Q25231",nameEn:"Svalbard",aliases:["NO-21"],country:"NO",groups:["SJ","154","150","UN"],level:"subterritory",callingCodes:["47 79"]},geometry:{type:"MultiPolygon",coordinates:[[[[-7.49892,77.24208],[32.07813,72.01005],[36.85549,84.09565],[-7.49892,77.24208]]]]}},{type:"Feature",properties:{wikidata:"Q25263",nameEn:"Azores",aliases:["PT-20"],country:"PT",groups:["Q3320166","Q2914565","Q105472","EU","039","150","UN"],callingCodes:["351"]},geometry:{type:"MultiPolygon",coordinates:[[[[-23.12984,40.26428],[-36.43765,41.39418],[-22.54767,33.34416],[-23.12984,40.26428]]]]}},{type:"Feature",properties:{wikidata:"Q25359",nameEn:"Navassa Island",aliases:["UM-76"],country:"US",groups:["UM","Q1352230","029","003","419","019","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-74.7289,18.71009],[-75.71816,18.46438],[-74.76465,18.06252],[-74.7289,18.71009]]]]}},{type:"Feature",properties:{wikidata:"Q25396",nameEn:"Bonaire",aliases:["BQ-BO","NL-BQ1"],country:"NL",groups:["Q1451600","BQ","029","003","419","019","UN"],level:"subterritory",callingCodes:["599 7"]},geometry:{type:"MultiPolygon",coordinates:[[[[-67.89186,12.4116],[-68.90012,12.62309],[-68.33524,11.78151],[-68.01417,11.77722],[-67.89186,12.4116]]]]}},{type:"Feature",properties:{wikidata:"Q25528",nameEn:"Saba",aliases:["BQ-SA","NL-BQ2"],country:"NL",groups:["Q1451600","BQ","029","003","419","019","UN"],level:"subterritory",callingCodes:["599 4"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.07669,17.79659],[-63.81314,17.95045],[-63.22932,17.32592],[-63.07669,17.79659]]]]}},{type:"Feature",properties:{wikidata:"Q26180",nameEn:"Sint Eustatius",aliases:["BQ-SE","NL-BQ3"],country:"NL",groups:["Q1451600","BQ","029","003","419","019","UN"],level:"subterritory",callingCodes:["599 3"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.07669,17.79659],[-63.34999,16.94218],[-62.76692,17.64353],[-63.07669,17.79659]]]]}},{type:"Feature",properties:{wikidata:"Q26253",nameEn:"Madeira",aliases:["PT-30"],country:"PT",groups:["Q3320166","Q2914565","Q105472","EU","039","150","UN"],callingCodes:["351"]},geometry:{type:"MultiPolygon",coordinates:[[[[-19.30302,33.65304],[-16.04789,29.65076],[-11.68307,33.12333],[-19.30302,33.65304]]]]}},{type:"Feature",properties:{wikidata:"Q26927",nameEn:"Lakshadweep",aliases:["IN-LD"],country:"IN",groups:["034","142","UN"],driveSide:"left",callingCodes:["91"]},geometry:{type:"MultiPolygon",coordinates:[[[[67.64074,11.57295],[76.59015,5.591],[72.67494,13.58102],[67.64074,11.57295]]]]}},{type:"Feature",properties:{wikidata:"Q27329",nameEn:"Asian Russia",country:"RU",groups:["142","UN"],callingCodes:["7"]},geometry:{type:"MultiPolygon",coordinates:[[[[-179.99933,64.74703],[-172.76104,63.77445],[-169.03888,65.48473],[-168.95635,65.98512],[-168.25765,71.99091],[-179.9843,71.90735],[-179.99933,64.74703]]],[[[59.99809,51.98263],[60.19925,51.99173],[60.48915,52.15175],[60.72581,52.15538],[60.78201,52.22067],[61.05417,52.35096],[60.98021,52.50068],[60.84709,52.52228],[60.84118,52.63912],[60.71693,52.66245],[60.71989,52.75923],[61.05842,52.92217],[61.23462,53.03227],[62.0422,52.96105],[62.12799,52.99133],[62.14574,53.09626],[61.19024,53.30536],[61.14291,53.41481],[61.29082,53.50992],[61.37957,53.45887],[61.57185,53.50112],[61.55706,53.57144],[60.90626,53.62937],[61.22574,53.80268],[61.14283,53.90063],[60.99796,53.93699],[61.26863,53.92797],[61.3706,54.08464],[61.47603,54.08048],[61.56941,53.95703],[61.65318,54.02445],[62.03913,53.94768],[62.00966,54.04134],[62.38535,54.03961],[62.45931,53.90737],[62.56876,53.94047],[62.58651,54.05871],[63.80604,54.27079],[63.91224,54.20013],[64.02715,54.22679],[63.97686,54.29763],[64.97216,54.4212],[65.11033,54.33028],[65.24663,54.35721],[65.20174,54.55216],[68.21308,54.98645],[68.26661,55.09226],[68.19206,55.18823],[68.90865,55.38148],[69.34224,55.36344],[69.74917,55.35545],[70.19179,55.1476],[70.76493,55.3027],[70.96009,55.10558],[71.08288,54.71253],[71.24185,54.64965],[71.08706,54.33376],[71.10379,54.13326],[71.96141,54.17736],[72.17477,54.36303],[72.43415,53.92685],[72.71026,54.1161],[73.37963,53.96132],[73.74778,54.07194],[73.68921,53.86522],[73.25412,53.61532],[73.39218,53.44623],[75.07405,53.80831],[75.43398,53.98652],[75.3668,54.07439],[76.91052,54.4677],[76.82266,54.1798],[76.44076,54.16017],[76.54243,53.99329],[77.90383,53.29807],[79.11255,52.01171],[80.08138,50.77658],[80.4127,50.95581],[80.44819,51.20855],[80.80318,51.28262],[81.16999,51.15662],[81.06091,50.94833],[81.41248,50.97524],[81.46581,50.77658],[81.94999,50.79307],[82.55443,50.75412],[83.14607,51.00796],[83.8442,50.87375],[84.29385,50.27257],[84.99198,50.06793],[85.24047,49.60239],[86.18709,49.50259],[86.63674,49.80136],[86.79056,49.74787],[86.61307,49.60239],[86.82606,49.51796],[87.03071,49.25142],[87.31465,49.23603],[87.28386,49.11626],[87.478,49.07403],[87.48983,49.13794],[87.81333,49.17354],[87.98977,49.18147],[88.15543,49.30314],[88.17223,49.46934],[88.42449,49.48821],[88.82499,49.44808],[89.70687,49.72535],[89.59711,49.90851],[91.86048,50.73734],[92.07173,50.69585],[92.44714,50.78762],[93.01109,50.79001],[92.99595,50.63183],[94.30823,50.57498],[94.39258,50.22193],[94.49477,50.17832],[94.6121,50.04239],[94.97166,50.04725],[95.02465,49.96941],[95.74757,49.97915],[95.80056,50.04239],[96.97388,49.88413],[97.24639,49.74737],[97.56811,49.84265],[97.56432,49.92801],[97.76871,49.99861],[97.85197,49.91339],[98.29481,50.33561],[98.31373,50.4996],[98.06393,50.61262],[97.9693,50.78044],[98.01472,50.86652],[97.83305,51.00248],[98.05257,51.46696],[98.22053,51.46579],[98.33222,51.71832],[98.74142,51.8637],[98.87768,52.14563],[99.27888,51.96876],[99.75578,51.90108],[99.89203,51.74903],[100.61116,51.73028],[101.39085,51.45753],[101.5044,51.50467],[102.14032,51.35566],[102.32194,50.67982],[102.71178,50.38873],[103.70343,50.13952],[105.32528,50.4648],[106.05562,50.40582],[106.07865,50.33474],[106.47156,50.31909],[106.49628,50.32436],[106.51122,50.34408],[106.58373,50.34044],[106.80326,50.30177],[107.00007,50.1977],[107.1174,50.04239],[107.36407,49.97612],[107.96116,49.93191],[107.95387,49.66659],[108.27937,49.53167],[108.53969,49.32325],[109.18017,49.34709],[109.51325,49.22859],[110.24373,49.16676],[110.39891,49.25083],[110.64493,49.1816],[113.02647,49.60772],[113.20216,49.83356],[114.325,50.28098],[114.9703,50.19254],[115.26068,49.97367],[115.73602,49.87688],[116.22402,50.04477],[116.62502,49.92919],[116.71193,49.83813],[117.27597,49.62544],[117.48208,49.62324],[117.82343,49.52696],[118.61623,49.93809],[119.11003,50.00276],[119.27996,50.13348],[119.38598,50.35162],[119.13553,50.37412],[120.10963,51.671],[120.65907,51.93544],[120.77337,52.20805],[120.61346,52.32447],[120.71673,52.54099],[120.46454,52.63811],[120.04049,52.58773],[120.0451,52.7359],[120.85633,53.28499],[121.39213,53.31888],[122.35063,53.49565],[122.85966,53.47395],[123.26989,53.54843],[123.86158,53.49391],[124.46078,53.21881],[125.17522,53.20225],[125.6131,53.07229],[126.558,52.13738],[126.44606,51.98254],[126.68349,51.70607],[126.90369,51.3238],[126.93135,51.0841],[127.14586,50.91152],[127.28165,50.72075],[127.36335,50.58306],[127.28765,50.46585],[127.36009,50.43787],[127.37384,50.28393],[127.60515,50.23503],[127.49299,50.01251],[127.53516,49.84306],[127.83476,49.5748],[128.72896,49.58676],[129.11153,49.36813],[129.23232,49.40353],[129.35317,49.3481],[129.40398,49.44194],[129.50685,49.42398],[129.67598,49.29596],[129.85416,49.11067],[130.2355,48.86741],[130.43232,48.90844],[130.66946,48.88251],[130.52147,48.61745],[130.84462,48.30942],[130.65103,48.10052],[130.90915,47.90623],[130.95985,47.6957],[131.09871,47.6852],[131.2635,47.73325],[131.90448,47.68011],[132.57309,47.71741],[132.66989,47.96491],[134.49516,48.42884],[134.75328,48.36763],[134.67098,48.1564],[134.55508,47.98651],[134.7671,47.72051],[134.50898,47.4812],[134.20016,47.33458],[134.03538,46.75668],[133.84104,46.46681],[133.91496,46.4274],[133.88097,46.25066],[133.68047,46.14697],[133.72695,46.05576],[133.67569,45.9759],[133.60442,45.90053],[133.48457,45.86203],[133.41083,45.57723],[133.19419,45.51913],[133.09279,45.25693],[133.12293,45.1332],[132.96373,45.0212],[132.83978,45.05916],[131.99417,45.2567],[131.86903,45.33636],[131.76532,45.22609],[131.66852,45.2196],[131.68466,45.12374],[131.48415,44.99513],[130.95639,44.85154],[131.1108,44.70266],[131.30365,44.04262],[131.25484,44.03131],[131.23583,43.96085],[131.26176,43.94011],[131.21105,43.82383],[131.19492,43.53047],[131.29402,43.46695],[131.30324,43.39498],[131.19031,43.21385],[131.20414,43.13654],[131.10274,43.04734],[131.135,42.94114],[131.02668,42.91246],[131.02438,42.86518],[130.66524,42.84753],[130.44361,42.76205],[130.40213,42.70788],[130.56576,42.68925],[130.62107,42.58413],[130.55143,42.52158],[130.56835,42.43281],[130.60805,42.4317],[130.64181,42.41422],[130.66367,42.38024],[130.65022,42.32281],[131.95041,41.5445],[140.9182,45.92937],[145.82343,44.571],[145.23667,43.76813],[153.94307,38.42848],[180,62.52334],[180,71.53642],[155.31937,81.93282],[76.13964,83.37843],[64.18965,69.94255],[66.1708,67.61252],[61.98014,65.72191],[60.74386,64.95767],[59.63945,64.78384],[59.80579,64.13948],[59.24834,63.01859],[59.61398,62.44915],[59.36223,61.3882],[59.50685,60.91162],[58.3853,59.487],[59.15636,59.14682],[59.40376,58.45822],[58.71104,58.07475],[58.81412,57.71602],[58.13789,57.68097],[58.07604,57.08308],[57.28024,56.87898],[57.51527,56.08729],[59.28419,56.15739],[59.49035,55.60486],[58.81825,55.03378],[57.25137,55.26262],[57.14829,54.84204],[57.95234,54.39672],[59.95217,54.85853],[59.70487,54.14846],[58.94336,53.953],[58.79644,52.43392],[59.22409,52.28437],[59.25033,52.46803],[60.17516,52.39457],[60.17253,52.25814],[59.91279,52.06924],[59.99809,51.98263]]]]}},{type:"Feature",properties:{wikidata:"Q34366",nameEn:"Tasmania",aliases:["AU-TAS"],country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[123.64533,-39.13605],[159.69067,-56.28945],[159.74028,-39.1978],[123.64533,-39.13605]]]]}},{type:"Feature",properties:{wikidata:"Q34497",nameEn:"Saint Helena",aliases:["SH-HL"],country:"GB",groups:["SH","BOTS","011","202","002","UN"],level:"subterritory",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["290"]},geometry:{type:"MultiPolygon",coordinates:[[[[-8.3824,-13.9131],[-6.17428,-19.07236],[-3.29308,-15.22647],[-8.3824,-13.9131]]]]}},{type:"Feature",properties:{wikidata:"Q35657",nameEn:"US States",country:"US",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q36117",nameEn:"Borneo",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q36678",nameEn:"West Bank",country:"PS",groups:["145","142"],callingCodes:["970"]},geometry:{type:"MultiPolygon",coordinates:[[[[35.47672,31.49578],[35.55941,31.76535],[35.52758,31.9131],[35.54375,31.96587],[35.52012,32.04076],[35.57111,32.21877],[35.55807,32.38674],[35.42078,32.41562],[35.41048,32.43706],[35.41598,32.45593],[35.42034,32.46009],[35.40224,32.50136],[35.35212,32.52047],[35.30685,32.51024],[35.29306,32.50947],[35.25049,32.52453],[35.2244,32.55289],[35.15937,32.50466],[35.10882,32.4757],[35.10024,32.47856],[35.09236,32.47614],[35.08564,32.46948],[35.07059,32.4585],[35.05423,32.41754],[35.05311,32.4024],[35.0421,32.38242],[35.05142,32.3667],[35.04243,32.35008],[35.01772,32.33863],[35.01119,32.28684],[35.02939,32.2671],[35.01841,32.23981],[34.98885,32.20758],[34.95703,32.19522],[34.96009,32.17503],[34.99039,32.14626],[34.98507,32.12606],[34.99437,32.10962],[34.9863,32.09551],[35.00261,32.027],[34.98682,31.96935],[35.00124,31.93264],[35.03489,31.92448],[35.03978,31.89276],[35.03489,31.85919],[34.99712,31.85569],[34.9724,31.83352],[35.01978,31.82944],[35.05617,31.85685],[35.07677,31.85627],[35.14174,31.81325],[35.18603,31.80901],[35.18169,31.82542],[35.19461,31.82687],[35.21469,31.81835],[35.216,31.83894],[35.21128,31.863],[35.20381,31.86716],[35.20673,31.88151],[35.20791,31.8821],[35.20945,31.8815],[35.21016,31.88237],[35.21276,31.88153],[35.2136,31.88241],[35.22014,31.88264],[35.22294,31.87889],[35.22567,31.86745],[35.22817,31.8638],[35.2249,31.85433],[35.2304,31.84222],[35.24816,31.8458],[35.25753,31.8387],[35.251,31.83085],[35.26404,31.82567],[35.25573,31.81362],[35.26058,31.79064],[35.25225,31.7678],[35.26319,31.74846],[35.25182,31.73945],[35.24981,31.72543],[35.2438,31.7201],[35.24315,31.71244],[35.23972,31.70896],[35.22392,31.71899],[35.21937,31.71578],[35.20538,31.72388],[35.18023,31.72067],[35.16478,31.73242],[35.15474,31.73352],[35.15119,31.73634],[35.13931,31.73012],[35.12933,31.7325],[35.11895,31.71454],[35.10782,31.71594],[35.08226,31.69107],[35.00879,31.65426],[34.95249,31.59813],[34.9415,31.55601],[34.94356,31.50743],[34.93258,31.47816],[34.89756,31.43891],[34.87833,31.39321],[34.88932,31.37093],[34.92571,31.34337],[35.02459,31.35979],[35.13033,31.3551],[35.22921,31.37445],[35.39675,31.49572],[35.47672,31.49578]]]]}},{type:"Feature",properties:{wikidata:"Q37362",nameEn:"Akrotiri and Dhekelia",aliases:["SBA"],country:"GB"},geometry:null},{type:"Feature",properties:{wikidata:"Q38095",nameEn:"Gal\xE1pagos Islands",aliases:["EC-W"],country:"EC",groups:["005","419","019","UN"],callingCodes:["593"]},geometry:{type:"MultiPolygon",coordinates:[[[[-93.12365,2.64343],[-92.46744,-2.52874],[-87.07749,-.8849],[-93.12365,2.64343]]]]}},{type:"Feature",properties:{wikidata:"Q39760",nameEn:"Gaza Strip",country:"PS",groups:["145","142"],callingCodes:["970"]},geometry:{type:"MultiPolygon",coordinates:[[[[34.052,31.46619],[34.21853,31.32363],[34.23572,31.2966],[34.24012,31.29591],[34.26742,31.21998],[34.29417,31.24194],[34.36523,31.28963],[34.37381,31.30598],[34.36505,31.36404],[34.40077,31.40926],[34.48892,31.48365],[34.56797,31.54197],[34.48681,31.59711],[34.29262,31.70393],[34.052,31.46619]]]]}},{type:"Feature",properties:{wikidata:"Q40888",nameEn:"Andaman and Nicobar Islands",aliases:["IN-AN"],country:"IN",groups:["034","142","UN"],driveSide:"left",callingCodes:["91"]},geometry:{type:"MultiPolygon",coordinates:[[[[94.42132,5.96581],[94.6371,13.81803],[86.7822,13.41052],[94.42132,5.96581]]]]}},{type:"Feature",properties:{wikidata:"Q41684",nameEn:"Stewart Island",country:"NZ",groups:["053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[166.59185,-47.61313],[169.70504,-47.56021],[167.52103,-46.41337],[166.59185,-47.61313]]]]}},{type:"Feature",properties:{wikidata:"Q43296",nameEn:"Wake Island",aliases:["WK","WAK","WKUM","872","UM-79"],country:"US",groups:["UM","Q1352230","057","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[167.34779,18.97692],[166.67967,20.14834],[165.82549,18.97692],[167.34779,18.97692]]]]}},{type:"Feature",properties:{wikidata:"Q46275",nameEn:"New Zealand Subantarctic Islands",country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left"},geometry:{type:"MultiPolygon",coordinates:[[[[164.30551,-47.88072],[161.96603,-56.07661],[179.49541,-50.04657],[179.49541,-47.2902],[169.91032,-47.66283],[164.30551,-47.88072]]]]}},{type:"Feature",properties:{wikidata:"Q46395",nameEn:"British Overseas Territories",aliases:["BOTS","UKOTS"],country:"GB",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q46772",nameEn:"Kerguelen Islands",country:"FR",groups:["EU","TF","Q1451600","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[61.9216,-49.39746],[70.67507,-51.14192],[74.25129,-45.45074],[61.9216,-49.39746]]]]}},{type:"Feature",properties:{wikidata:"Q46879",nameEn:"Baker Island",aliases:["UM-81"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-175.33482,-1.40631],[-175.31323,.5442],[-177.91421,.39582],[-175.33482,-1.40631]]]]}},{type:"Feature",properties:{wikidata:"Q47863",nameEn:"Midway Atoll",aliases:["MI","MID","MIUM","488","UM-71"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-176.29741,29.09786],[-177.77531,29.29793],[-177.5224,27.7635],[-176.29741,29.09786]]]]}},{type:"Feature",properties:{wikidata:"Q62218",nameEn:"Jarvis Island",aliases:["UM-86"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-160.42921,-1.4364],[-159.12443,.19975],[-160.38779,.30331],[-160.42921,-1.4364]]]]}},{type:"Feature",properties:{wikidata:"Q105472",nameEn:"Macaronesia",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q114935",nameEn:"Kermadec Islands",country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[-174.40891,-29.09438],[-180,-24.21376],[-179.96512,-35.00791],[-174.40891,-29.09438]]]]}},{type:"Feature",properties:{wikidata:"Q115459",nameEn:"Chatham Islands",aliases:["NZ-CIT"],country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[-179.93224,-45.18423],[-172.47015,-45.17912],[-176.30998,-41.38382],[-179.93224,-45.18423]]]]}},{type:"Feature",properties:{wikidata:"Q118863",nameEn:"North Island",country:"NZ",groups:["053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[179.49541,-47.2902],[179.49541,-36.79303],[174.17679,-32.62487],[170.27492,-36.38133],[174.58663,-40.80446],[174.46634,-41.55028],[179.49541,-47.2902]]]]}},{type:"Feature",properties:{wikidata:"Q120755",nameEn:"South Island",country:"NZ",groups:["053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[169.70504,-47.56021],[179.49541,-47.2902],[174.46634,-41.55028],[174.58663,-40.80446],[170.27492,-36.38133],[166.56976,-39.94841],[164.8365,-46.0205],[167.52103,-46.41337],[169.70504,-47.56021]]]]}},{type:"Feature",properties:{wikidata:"Q123076",nameEn:"Palmyra Atoll",aliases:["UM-95"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-161.06795,5.2462],[-161.0731,7.1291],[-163.24478,5.24198],[-161.06795,5.2462]]]]}},{type:"Feature",properties:{wikidata:"Q130574",nameEn:"Chafarinas Islands",country:"ES",groups:["EU","Q191011","015","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[-2.40316,35.16893],[-2.43262,35.20652],[-2.45965,35.16527],[-2.40316,35.16893]]]]}},{type:"Feature",properties:{wikidata:"Q130895",nameEn:"Kingman Reef",aliases:["UM-89"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-161.0731,7.1291],[-163.16627,7.15036],[-163.24478,5.24198],[-161.0731,7.1291]]]]}},{type:"Feature",properties:{wikidata:"Q131008",nameEn:"Johnston Atoll",aliases:["JT","JTN","JTUM","396","UM-67"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-170.65691,16.57199],[-168.87689,16.01159],[-169.2329,17.4933],[-170.65691,16.57199]]]]}},{type:"Feature",properties:{wikidata:"Q131305",nameEn:"Howland Island",aliases:["UM-84"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-177.91421,.39582],[-175.31323,.5442],[-176.74464,2.28109],[-177.91421,.39582]]]]}},{type:"Feature",properties:{wikidata:"Q133888",nameEn:"Ashmore and Cartier Islands",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[123.7463,-11.1783],[120.6877,-13.59408],[125.29076,-12.33139],[123.7463,-11.1783]]]]}},{type:"Feature",properties:{wikidata:"Q153732",nameEn:"Mariana Islands",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q172216",nameEn:"Coral Sea Islands",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[159.77159,-28.41151],[156.73836,-14.50464],[145.2855,-9.62524],[147.69992,-17.5933],[152.93188,-20.92631],[154.02855,-24.43238],[159.77159,-28.41151]]]]}},{type:"Feature",properties:{wikidata:"Q179313",nameEn:"Alderney",country:"GB",groups:["GG","830","Q185086","154","150","UN"],level:"subterritory",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01481"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.36485,49.48223],[-2.09454,49.46288],[-2.02963,49.91866],[-2.49556,49.79012],[-2.36485,49.48223]]]]}},{type:"Feature",properties:{wikidata:"Q185086",nameEn:"Crown Dependencies",country:"GB",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q190571",nameEn:"Scattered Islands",country:"FR",groups:["EU","TF","Q1451600","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[53.53458,-16.36909],[54.96649,-16.28353],[54.61476,-15.02273],[53.53458,-16.36909]]],[[[38.55969,-20.75596],[40.68027,-23.38889],[43.52893,-15.62903],[38.55969,-20.75596]]],[[[47.03092,-11.05648],[47.11593,-12.08552],[47.96702,-11.46447],[47.03092,-11.05648]]]]}},{type:"Feature",properties:{wikidata:"Q191011",nameEn:"Plazas de soberan\xEDa",country:"ES"},geometry:null},{type:"Feature",properties:{wikidata:"Q191146",nameEn:"Pe\xF1\xF3n de V\xE9lez de la Gomera",country:"ES",groups:["EU","Q191011","015","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[-4.30191,35.17419],[-4.30112,35.17058],[-4.29436,35.17149],[-4.30191,35.17419]]]]}},{type:"Feature",properties:{wikidata:"Q201698",nameEn:"Crozet Islands",country:"FR",groups:["EU","TF","Q1451600","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[55.03425,-43.65017],[46.31615,-46.28749],[54.5587,-47.93013],[55.03425,-43.65017]]]]}},{type:"Feature",properties:{wikidata:"Q578170",nameEn:"Contiguous United States",aliases:["CONUS"],country:"US",groups:["Q35657","021","003","019","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-97.13927,25.96583],[-96.92418,25.97377],[-80.57035,24.0565],[-78.91214,27.76553],[-61.98255,37.34815],[-67.16117,44.20069],[-66.93432,44.82597],[-66.96824,44.83078],[-66.98249,44.87071],[-66.96824,44.90965],[-67.0216,44.95333],[-67.11316,45.11176],[-67.15965,45.16179],[-67.19603,45.16771],[-67.20349,45.1722],[-67.22751,45.16344],[-67.27039,45.1934],[-67.29748,45.18173],[-67.29754,45.14865],[-67.34927,45.122],[-67.48201,45.27351],[-67.42394,45.37969],[-67.50578,45.48971],[-67.42144,45.50584],[-67.43815,45.59162],[-67.6049,45.60725],[-67.80705,45.69528],[-67.80653,45.80022],[-67.75654,45.82324],[-67.80961,45.87531],[-67.75196,45.91814],[-67.78111,45.9392],[-67.78578,47.06473],[-67.87993,47.10377],[-67.94843,47.1925],[-68.23244,47.35712],[-68.37458,47.35851],[-68.38332,47.28723],[-68.57914,47.28431],[-68.60575,47.24659],[-68.70125,47.24399],[-68.89222,47.1807],[-69.05039,47.2456],[-69.05073,47.30076],[-69.05148,47.42012],[-69.22119,47.46461],[-69.99966,46.69543],[-70.05812,46.41768],[-70.18547,46.35357],[-70.29078,46.18832],[-70.23855,46.1453],[-70.31025,45.96424],[-70.24694,45.95138],[-70.25976,45.89675],[-70.41523,45.79497],[-70.38934,45.73215],[-70.54019,45.67291],[-70.68516,45.56964],[-70.72651,45.49771],[-70.62518,45.42286],[-70.65383,45.37592],[-70.78372,45.43269],[-70.82638,45.39828],[-70.80236,45.37444],[-70.84816,45.22698],[-70.89864,45.2398],[-70.91169,45.29849],[-70.95193,45.33895],[-71.0107,45.34819],[-71.01866,45.31573],[-71.08364,45.30623],[-71.14568,45.24128],[-71.19723,45.25438],[-71.22338,45.25184],[-71.29371,45.29996],[-71.37133,45.24624],[-71.44252,45.2361],[-71.40364,45.21382],[-71.42778,45.12624],[-71.48735,45.07784],[-71.50067,45.01357],[-73.35025,45.00942],[-74.32699,44.99029],[-74.66689,45.00646],[-74.8447,45.00606],[-74.99101,44.98051],[-75.01363,44.95608],[-75.2193,44.87821],[-75.41441,44.76614],[-75.76813,44.51537],[-75.8217,44.43176],[-75.95947,44.34463],[-76.00018,44.34896],[-76.16285,44.28262],[-76.1664,44.23051],[-76.244,44.19643],[-76.31222,44.19894],[-76.35324,44.13493],[-76.43859,44.09393],[-76.79706,43.63099],[-79.25796,43.54052],[-79.06921,43.26183],[-79.05512,43.25375],[-79.05544,43.21224],[-79.05002,43.20133],[-79.05384,43.17418],[-79.04652,43.16396],[-79.0427,43.13934],[-79.06881,43.12029],[-79.05671,43.10937],[-79.07486,43.07845],[-79.01055,43.06659],[-78.99941,43.05612],[-79.02424,43.01983],[-79.02074,42.98444],[-78.98126,42.97],[-78.96312,42.95509],[-78.93224,42.95229],[-78.90905,42.93022],[-78.90712,42.89733],[-78.93684,42.82887],[-82.67862,41.67615],[-83.11184,41.95671],[-83.14962,42.04089],[-83.12724,42.2376],[-83.09837,42.28877],[-83.07837,42.30978],[-83.02253,42.33045],[-82.82964,42.37355],[-82.64242,42.55594],[-82.58873,42.54984],[-82.57583,42.5718],[-82.51858,42.611],[-82.51063,42.66025],[-82.46613,42.76615],[-82.4826,42.8068],[-82.45331,42.93139],[-82.4253,42.95423],[-82.4146,42.97626],[-82.42469,42.992],[-82.48419,45.30225],[-83.59589,45.82131],[-83.43746,45.99749],[-83.57017,46.105],[-83.83329,46.12169],[-83.90453,46.05922],[-83.95399,46.05634],[-84.1096,46.23987],[-84.09756,46.25512],[-84.11615,46.2681],[-84.11254,46.32329],[-84.13451,46.39218],[-84.11196,46.50248],[-84.12885,46.53068],[-84.17723,46.52753],[-84.1945,46.54061],[-84.2264,46.53337],[-84.26351,46.49508],[-84.29893,46.49127],[-84.34174,46.50683],[-84.42101,46.49853],[-84.4481,46.48972],[-84.47607,46.45225],[-84.55635,46.45974],[-84.85871,46.88881],[-88.37033,48.30586],[-89.48837,48.01412],[-89.57972,48.00023],[-89.77248,48.02607],[-89.89974,47.98109],[-90.07418,48.11043],[-90.56312,48.09488],[-90.56444,48.12184],[-90.75045,48.09143],[-90.87588,48.2484],[-91.08016,48.18096],[-91.25025,48.08522],[-91.43248,48.04912],[-91.45829,48.07454],[-91.58025,48.04339],[-91.55649,48.10611],[-91.70451,48.11805],[-91.71231,48.19875],[-91.86125,48.21278],[-91.98929,48.25409],[-92.05339,48.35958],[-92.14732,48.36578],[-92.202,48.35252],[-92.26662,48.35651],[-92.30939,48.31251],[-92.27167,48.25046],[-92.37185,48.22259],[-92.48147,48.36609],[-92.45588,48.40624],[-92.50712,48.44921],[-92.65606,48.43471],[-92.71323,48.46081],[-92.69927,48.49573],[-92.62747,48.50278],[-92.6342,48.54133],[-92.7287,48.54005],[-92.94973,48.60866],[-93.25391,48.64266],[-93.33946,48.62787],[-93.3712,48.60599],[-93.39758,48.60364],[-93.40693,48.60948],[-93.44472,48.59147],[-93.47022,48.54357],[-93.66382,48.51845],[-93.79267,48.51631],[-93.80939,48.52439],[-93.80676,48.58232],[-93.83288,48.62745],[-93.85769,48.63284],[-94.23215,48.65202],[-94.25104,48.65729],[-94.25172,48.68404],[-94.27153,48.70232],[-94.4174,48.71049],[-94.44258,48.69223],[-94.53826,48.70216],[-94.54885,48.71543],[-94.58903,48.71803],[-94.69335,48.77883],[-94.69669,48.80918],[-94.70486,48.82365],[-94.70087,48.8339],[-94.687,48.84077],[-94.75017,49.09931],[-94.77355,49.11998],[-94.82487,49.29483],[-94.8159,49.32299],[-94.85381,49.32492],[-94.95681,49.37035],[-94.99532,49.36579],[-95.01419,49.35647],[-95.05825,49.35311],[-95.12903,49.37056],[-95.15357,49.384],[-95.15355,48.9996],[-123.32163,49.00419],[-123.0093,48.83186],[-123.0093,48.76586],[-123.26565,48.6959],[-123.15614,48.35395],[-123.50039,48.21223],[-125.03842,48.53282],[-133.98258,38.06389],[-118.48109,32.5991],[-117.1243,32.53427],[-115.88053,32.63624],[-114.71871,32.71894],[-114.76736,32.64094],[-114.80584,32.62028],[-114.81141,32.55543],[-114.79524,32.55731],[-114.82011,32.49609],[-111.07523,31.33232],[-108.20979,31.33316],[-108.20899,31.78534],[-106.529,31.784],[-106.52266,31.77509],[-106.51251,31.76922],[-106.50962,31.76155],[-106.50111,31.75714],[-106.48815,31.74769],[-106.47298,31.75054],[-106.46726,31.75998],[-106.45244,31.76523],[-106.43419,31.75478],[-106.41773,31.75196],[-106.38003,31.73151],[-106.3718,31.71165],[-106.34864,31.69663],[-106.33419,31.66303],[-106.30305,31.62154],[-106.28084,31.56173],[-106.24612,31.54193],[-106.23711,31.51262],[-106.20346,31.46305],[-106.09025,31.40569],[-106.00363,31.39181],[-104.77674,30.4236],[-104.5171,29.64671],[-104.3969,29.57105],[-104.39363,29.55396],[-104.37752,29.54255],[-103.15787,28.93865],[-102.60596,29.8192],[-101.47277,29.7744],[-101.05686,29.44738],[-101.01128,29.36947],[-100.96725,29.3477],[-100.94579,29.34523],[-100.94056,29.33371],[-100.87982,29.296],[-100.79696,29.24688],[-100.67294,29.09744],[-100.63689,28.90812],[-100.59809,28.88197],[-100.52313,28.75598],[-100.5075,28.74066],[-100.51222,28.70679],[-100.50029,28.66117],[-99.55409,27.61314],[-99.51478,27.55836],[-99.52955,27.49747],[-99.50208,27.50021],[-99.48045,27.49016],[-99.482,27.47128],[-99.49744,27.43746],[-99.53573,27.30926],[-99.08477,26.39849],[-99.03053,26.41249],[-99.00546,26.3925],[-98.35126,26.15129],[-98.30491,26.10475],[-98.27075,26.09457],[-98.24603,26.07191],[-97.97017,26.05232],[-97.95155,26.0625],[-97.66511,26.01708],[-97.52025,25.88518],[-97.49828,25.89877],[-97.45669,25.86874],[-97.42511,25.83969],[-97.37332,25.83854],[-97.35946,25.92189],[-97.13927,25.96583]]]]}},{type:"Feature",properties:{wikidata:"Q620634",nameEn:"Bir Tawil",groups:["015","002"],level:"territory"},geometry:{type:"MultiPolygon",coordinates:[[[[33.17563,22.00405],[33.57251,21.72406],[33.99686,21.76784],[34.0765,22.00501],[33.17563,22.00405]]]]}},{type:"Feature",properties:{wikidata:"Q639185",nameEn:"Peros Banhos",country:"GB",groups:["IO","BOTS","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[72.12587,-4.02588],[70.1848,-6.37445],[72.09518,-5.61768],[72.12587,-4.02588]]]]}},{type:"Feature",properties:{wikidata:"Q644636",nameEn:"Cyprus",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q851132",nameEn:"New Zealand Outlying Islands",country:"NZ",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q875134",nameEn:"European Russia",country:"RU",groups:["151","150","UN"],callingCodes:["7"]},geometry:{type:"MultiPolygon",coordinates:[[[[18.57853,55.25302],[19.64312,54.45423],[19.8038,54.44203],[20.63871,54.3706],[21.41123,54.32395],[22.79705,54.36264],[22.7253,54.41732],[22.70208,54.45312],[22.67788,54.532],[22.71293,54.56454],[22.68021,54.58486],[22.7522,54.63525],[22.74225,54.64339],[22.75467,54.6483],[22.73397,54.66604],[22.73631,54.72952],[22.87317,54.79492],[22.85083,54.88711],[22.76422,54.92521],[22.68723,54.9811],[22.65451,54.97037],[22.60075,55.01863],[22.58907,55.07085],[22.47688,55.04408],[22.31562,55.0655],[22.14267,55.05345],[22.11697,55.02131],[22.06087,55.02935],[22.02582,55.05078],[22.03984,55.07888],[21.99543,55.08691],[21.96505,55.07353],[21.85521,55.09493],[21.64954,55.1791],[21.55605,55.20311],[21.51095,55.18507],[21.46766,55.21115],[21.38446,55.29348],[21.35465,55.28427],[21.26425,55.24456],[20.95181,55.27994],[20.60454,55.40986],[18.57853,55.25302]]],[[[26.32936,60.00121],[26.90044,59.63819],[27.85643,59.58538],[28.04187,59.47017],[28.19061,59.39962],[28.21137,59.38058],[28.20537,59.36491],[28.19284,59.35791],[28.14215,59.28934],[28.00689,59.28351],[27.90911,59.24353],[27.87978,59.18097],[27.80482,59.1116],[27.74429,58.98351],[27.36366,58.78381],[27.55489,58.39525],[27.48541,58.22615],[27.62393,58.09462],[27.67282,57.92627],[27.81841,57.89244],[27.78526,57.83963],[27.56689,57.83356],[27.50171,57.78842],[27.52615,57.72843],[27.3746,57.66834],[27.40393,57.62125],[27.31919,57.57672],[27.34698,57.52242],[27.56832,57.53728],[27.52453,57.42826],[27.86101,57.29402],[27.66511,56.83921],[27.86101,56.88204],[28.04768,56.59004],[28.13526,56.57989],[28.10069,56.524],[28.19057,56.44637],[28.16599,56.37806],[28.23716,56.27588],[28.15217,56.16964],[28.30571,56.06035],[28.36888,56.05805],[28.37987,56.11399],[28.43068,56.09407],[28.5529,56.11705],[28.68337,56.10173],[28.63668,56.07262],[28.73418,55.97131],[29.08299,56.03427],[29.21717,55.98971],[29.44692,55.95978],[29.3604,55.75862],[29.51283,55.70294],[29.61446,55.77716],[29.80672,55.79569],[29.97975,55.87281],[30.12136,55.8358],[30.27776,55.86819],[30.30987,55.83592],[30.48257,55.81066],[30.51346,55.78982],[30.51037,55.76568],[30.63344,55.73079],[30.67464,55.64176],[30.72957,55.66268],[30.7845,55.58514],[30.86003,55.63169],[30.93419,55.6185],[30.95204,55.50667],[30.90123,55.46621],[30.93144,55.3914],[30.8257,55.3313],[30.81946,55.27931],[30.87944,55.28223],[30.97369,55.17134],[31.02071,55.06167],[31.00972,55.02783],[30.94243,55.03964],[30.9081,55.02232],[30.95754,54.98609],[30.93144,54.9585],[30.81759,54.94064],[30.8264,54.90062],[30.75165,54.80699],[30.95479,54.74346],[30.97127,54.71967],[31.0262,54.70698],[30.98226,54.68872],[30.99187,54.67046],[31.19339,54.66947],[31.21399,54.63113],[31.08543,54.50361],[31.22945,54.46585],[31.3177,54.34067],[31.30791,54.25315],[31.57002,54.14535],[31.89599,54.0837],[31.88744,54.03653],[31.85019,53.91801],[31.77028,53.80015],[31.89137,53.78099],[32.12621,53.81586],[32.36663,53.7166],[32.45717,53.74039],[32.50112,53.68594],[32.40499,53.6656],[32.47777,53.5548],[32.74968,53.45597],[32.73257,53.33494],[32.51725,53.28431],[32.40773,53.18856],[32.15368,53.07594],[31.82373,53.10042],[31.787,53.18033],[31.62496,53.22886],[31.56316,53.19432],[31.40523,53.21406],[31.36403,53.13504],[31.3915,53.09712],[31.33519,53.08805],[31.32283,53.04101],[31.24147,53.031],[31.35667,52.97854],[31.592,52.79011],[31.57277,52.71613],[31.50406,52.69707],[31.63869,52.55361],[31.56316,52.51518],[31.61397,52.48843],[31.62084,52.33849],[31.57971,52.32146],[31.70735,52.26711],[31.6895,52.1973],[31.77877,52.18636],[31.7822,52.11406],[31.81722,52.09955],[31.85018,52.11305],[31.96141,52.08015],[31.92159,52.05144],[32.08813,52.03319],[32.23331,52.08085],[32.2777,52.10266],[32.34044,52.1434],[32.33083,52.23685],[32.38988,52.24946],[32.3528,52.32842],[32.54781,52.32423],[32.69475,52.25535],[32.85405,52.27888],[32.89937,52.2461],[33.18913,52.3754],[33.51323,52.35779],[33.48027,52.31499],[33.55718,52.30324],[33.78789,52.37204],[34.05239,52.20132],[34.11199,52.14087],[34.09413,52.00835],[34.41136,51.82793],[34.42922,51.72852],[34.07765,51.67065],[34.17599,51.63253],[34.30562,51.5205],[34.22048,51.4187],[34.33446,51.363],[34.23009,51.26429],[34.31661,51.23936],[34.38802,51.2746],[34.6613,51.25053],[34.6874,51.18],[34.82472,51.17483],[34.97304,51.2342],[35.14058,51.23162],[35.12685,51.16191],[35.20375,51.04723],[35.31774,51.08434],[35.40837,51.04119],[35.32598,50.94524],[35.39307,50.92145],[35.41367,50.80227],[35.47704,50.77274],[35.48116,50.66405],[35.39464,50.64751],[35.47463,50.49247],[35.58003,50.45117],[35.61711,50.35707],[35.73659,50.35489],[35.80388,50.41356],[35.8926,50.43829],[36.06893,50.45205],[36.20763,50.3943],[36.30101,50.29088],[36.47817,50.31457],[36.58371,50.28563],[36.56655,50.2413],[36.64571,50.218],[36.69377,50.26982],[36.91762,50.34963],[37.08468,50.34935],[37.48204,50.46079],[37.47243,50.36277],[37.62486,50.29966],[37.62879,50.24481],[37.61113,50.21976],[37.75807,50.07896],[37.79515,50.08425],[37.90776,50.04194],[38.02999,49.94482],[38.02999,49.90592],[38.21675,49.98104],[38.18517,50.08161],[38.32524,50.08866],[38.35408,50.00664],[38.65688,49.97176],[38.68677,50.00904],[38.73311,49.90238],[38.90477,49.86787],[38.9391,49.79524],[39.1808,49.88911],[39.27968,49.75976],[39.44496,49.76067],[39.59142,49.73758],[39.65047,49.61761],[39.84548,49.56064],[40.13249,49.61672],[40.16683,49.56865],[40.03636,49.52321],[40.03087,49.45452],[40.1141,49.38798],[40.14912,49.37681],[40.18331,49.34996],[40.22176,49.25683],[40.01988,49.1761],[39.93437,49.05709],[39.6836,49.05121],[39.6683,48.99454],[39.71353,48.98959],[39.72649,48.9754],[39.74874,48.98675],[39.78368,48.91596],[39.98967,48.86901],[40.03636,48.91957],[40.08168,48.87443],[39.97182,48.79398],[39.79466,48.83739],[39.73104,48.7325],[39.71765,48.68673],[39.67226,48.59368],[39.79764,48.58668],[39.84548,48.57821],[39.86196,48.46633],[39.88794,48.44226],[39.94847,48.35055],[39.84136,48.33321],[39.84273,48.30947],[39.90041,48.3049],[39.91465,48.26743],[39.95248,48.29972],[39.9693,48.29904],[39.97325,48.31399],[39.99241,48.31768],[40.00752,48.22445],[39.94847,48.22811],[39.83724,48.06501],[39.88256,48.04482],[39.77544,48.04206],[39.82213,47.96396],[39.73935,47.82876],[38.87979,47.87719],[38.79628,47.81109],[38.76379,47.69346],[38.35062,47.61631],[38.28679,47.53552],[38.28954,47.39255],[38.22225,47.30788],[38.33074,47.30508],[38.32112,47.2585],[38.23049,47.2324],[38.22955,47.12069],[38.3384,46.98085],[38.12112,46.86078],[37.62608,46.82615],[35.23066,45.79231],[35.04991,45.76827],[36.6645,45.4514],[36.6545,45.3417],[36.5049,45.3136],[36.475,45.2411],[36.4883,45.0488],[33.5943,44.03313],[39.81147,43.06294],[40.0078,43.38551],[40.00853,43.40578],[40.01552,43.42025],[40.01007,43.42411],[40.03312,43.44262],[40.04445,43.47776],[40.10657,43.57344],[40.65957,43.56212],[41.64935,43.22331],[42.40563,43.23226],[42.66667,43.13917],[42.75889,43.19651],[43.03322,43.08883],[43.0419,43.02413],[43.81453,42.74297],[43.73119,42.62043],[43.95517,42.55396],[44.54202,42.75699],[44.70002,42.74679],[44.80941,42.61277],[44.88754,42.74934],[45.15318,42.70598],[45.36501,42.55268],[45.78692,42.48358],[45.61676,42.20768],[46.42738,41.91323],[46.5332,41.87389],[46.58924,41.80547],[46.75269,41.8623],[46.8134,41.76252],[47.00955,41.63583],[46.99554,41.59743],[47.03757,41.55434],[47.10762,41.59044],[47.34579,41.27884],[47.49004,41.26366],[47.54504,41.20275],[47.62288,41.22969],[47.75831,41.19455],[47.87973,41.21798],[48.07587,41.49957],[48.22064,41.51472],[48.2878,41.56221],[48.40277,41.60441],[48.42301,41.65444],[48.55078,41.77917],[48.5867,41.84306],[48.80971,41.95365],[49.2134,44.84989],[49.88945,46.04554],[49.32259,46.26944],[49.16518,46.38542],[48.54988,46.56267],[48.51142,46.69268],[49.01136,46.72716],[48.52326,47.4102],[48.45173,47.40818],[48.15348,47.74545],[47.64973,47.76559],[47.41689,47.83687],[47.38731,47.68176],[47.12107,47.83687],[47.11516,48.27188],[46.49011,48.43019],[46.78392,48.95352],[47.00857,49.04921],[47.04658,49.19834],[46.78398,49.34026],[46.9078,49.86707],[47.18319,49.93721],[47.34589,50.09308],[47.30448,50.30894],[47.58551,50.47867],[48.10044,50.09242],[48.24519,49.86099],[48.42564,49.82283],[48.68352,49.89546],[48.90782,50.02281],[48.57946,50.63278],[48.86936,50.61589],[49.12673,50.78639],[49.41959,50.85927],[49.39001,51.09396],[49.76866,51.11067],[49.97277,51.2405],[50.26859,51.28677],[50.59695,51.61859],[51.26254,51.68466],[51.301,51.48799],[51.77431,51.49536],[51.8246,51.67916],[52.36119,51.74161],[52.54329,51.48444],[53.46165,51.49445],[53.69299,51.23466],[54.12248,51.11542],[54.46331,50.85554],[54.41894,50.61214],[54.55797,50.52006],[54.71476,50.61214],[54.56685,51.01958],[54.72067,51.03261],[55.67774,50.54508],[56.11398,50.7471],[56.17906,50.93204],[57.17302,51.11253],[57.44221,50.88354],[57.74986,50.93017],[57.75578,51.13852],[58.3208,51.15151],[58.87974,50.70852],[59.48928,50.64216],[59.51886,50.49937],[59.81172,50.54451],[60.01288,50.8163],[60.17262,50.83312],[60.31914,50.67705],[60.81833,50.6629],[61.4431,50.80679],[61.56889,51.23679],[61.6813,51.25716],[61.55114,51.32746],[61.50677,51.40687],[60.95655,51.48615],[60.92401,51.61124],[60.5424,51.61675],[60.36787,51.66815],[60.50986,51.7964],[60.09867,51.87135],[59.99809,51.98263],[59.91279,52.06924],[60.17253,52.25814],[60.17516,52.39457],[59.25033,52.46803],[59.22409,52.28437],[58.79644,52.43392],[58.94336,53.953],[59.70487,54.14846],[59.95217,54.85853],[57.95234,54.39672],[57.14829,54.84204],[57.25137,55.26262],[58.81825,55.03378],[59.49035,55.60486],[59.28419,56.15739],[57.51527,56.08729],[57.28024,56.87898],[58.07604,57.08308],[58.13789,57.68097],[58.81412,57.71602],[58.71104,58.07475],[59.40376,58.45822],[59.15636,59.14682],[58.3853,59.487],[59.50685,60.91162],[59.36223,61.3882],[59.61398,62.44915],[59.24834,63.01859],[59.80579,64.13948],[59.63945,64.78384],[60.74386,64.95767],[61.98014,65.72191],[66.1708,67.61252],[64.18965,69.94255],[76.13964,83.37843],[36.85549,84.09565],[32.07813,72.01005],[31.59909,70.16571],[30.84095,69.80584],[30.95011,69.54699],[30.52662,69.54699],[30.16363,69.65244],[29.97205,69.41623],[29.27631,69.2811],[29.26623,69.13794],[29.0444,69.0119],[28.91738,69.04774],[28.45957,68.91417],[28.78224,68.86696],[28.43941,68.53366],[28.62982,68.19816],[29.34179,68.06655],[29.66955,67.79872],[30.02041,67.67523],[29.91155,67.51507],[28.9839,66.94139],[29.91155,66.13863],[30.16363,65.66935],[29.97205,65.70256],[29.74013,65.64025],[29.84096,65.56945],[29.68972,65.31803],[29.61914,65.23791],[29.8813,65.22101],[29.84096,65.1109],[29.61914,65.05993],[29.68972,64.80789],[30.05271,64.79072],[30.12329,64.64862],[30.01238,64.57513],[30.06279,64.35782],[30.4762,64.25728],[30.55687,64.09036],[30.25437,63.83364],[29.98213,63.75795],[30.49637,63.46666],[31.23244,63.22239],[31.29294,63.09035],[31.58535,62.91642],[31.38369,62.66284],[31.10136,62.43042],[29.01829,61.17448],[28.82816,61.1233],[28.47974,60.93365],[27.77352,60.52722],[27.71177,60.3893],[27.44953,60.22766],[26.32936,60.00121]]]]}},{type:"Feature",properties:{wikidata:"Q1083368",nameEn:"Mainland Finland",country:"FI",groups:["EU","154","150","UN"],callingCodes:["358"]},geometry:{type:"MultiPolygon",coordinates:[[[[29.12697,69.69193],[28.36883,69.81658],[28.32849,69.88605],[27.97558,69.99671],[27.95542,70.0965],[27.57226,70.06215],[27.05802,69.92069],[26.64461,69.96565],[26.40261,69.91377],[25.96904,69.68397],[25.69679,69.27039],[25.75729,68.99383],[25.61613,68.89602],[25.42455,68.90328],[25.12206,68.78684],[25.10189,68.63307],[24.93048,68.61102],[24.90023,68.55579],[24.74898,68.65143],[24.18432,68.73936],[24.02299,68.81601],[23.781,68.84514],[23.68017,68.70276],[23.13064,68.64684],[22.53321,68.74393],[22.38367,68.71561],[22.27276,68.89514],[21.63833,69.27485],[21.27827,69.31281],[21.00732,69.22755],[20.98641,69.18809],[21.11099,69.10291],[21.05775,69.0356],[20.72171,69.11874],[20.55258,69.06069],[20.78802,69.03087],[20.91658,68.96764],[20.85104,68.93142],[20.90649,68.89696],[21.03001,68.88969],[22.00429,68.50692],[22.73028,68.40881],[23.10336,68.26551],[23.15377,68.14759],[23.26469,68.15134],[23.40081,68.05545],[23.65793,67.9497],[23.45627,67.85297],[23.54701,67.59306],[23.39577,67.46974],[23.75372,67.43688],[23.75372,67.29914],[23.54701,67.25435],[23.58735,67.20752],[23.56214,67.17038],[23.98563,66.84149],[23.98059,66.79585],[23.89488,66.772],[23.85959,66.56434],[23.63776,66.43568],[23.67591,66.3862],[23.64982,66.30603],[23.71339,66.21299],[23.90497,66.15802],[24.15791,65.85385],[24.14798,65.83466],[24.15107,65.81427],[24.14112,65.39731],[20.15877,63.06556],[19.23413,60.61414],[20.96741,60.71528],[21.15143,60.54555],[21.08159,60.20167],[21.02509,60.12142],[21.35468,59.67511],[20.5104,59.15546],[26.32936,60.00121],[27.44953,60.22766],[27.71177,60.3893],[27.77352,60.52722],[28.47974,60.93365],[28.82816,61.1233],[29.01829,61.17448],[31.10136,62.43042],[31.38369,62.66284],[31.58535,62.91642],[31.29294,63.09035],[31.23244,63.22239],[30.49637,63.46666],[29.98213,63.75795],[30.25437,63.83364],[30.55687,64.09036],[30.4762,64.25728],[30.06279,64.35782],[30.01238,64.57513],[30.12329,64.64862],[30.05271,64.79072],[29.68972,64.80789],[29.61914,65.05993],[29.84096,65.1109],[29.8813,65.22101],[29.61914,65.23791],[29.68972,65.31803],[29.84096,65.56945],[29.74013,65.64025],[29.97205,65.70256],[30.16363,65.66935],[29.91155,66.13863],[28.9839,66.94139],[29.91155,67.51507],[30.02041,67.67523],[29.66955,67.79872],[29.34179,68.06655],[28.62982,68.19816],[28.43941,68.53366],[28.78224,68.86696],[28.45957,68.91417],[28.91738,69.04774],[28.81248,69.11997],[28.8629,69.22395],[29.31664,69.47994],[29.12697,69.69193]]]]}},{type:"Feature",properties:{wikidata:"Q1184963",nameEn:"Alhucemas Islands",country:"ES",groups:["EU","Q191011","015","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[-3.90602,35.21494],[-3.88372,35.20767],[-3.89343,35.22728],[-3.90602,35.21494]]]]}},{type:"Feature",properties:{wikidata:"Q1298289",nameEn:"Egmont Islands",country:"GB",groups:["IO","BOTS","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[70.1848,-6.37445],[70.67958,-8.2663],[72.17991,-6.68509],[70.1848,-6.37445]]]]}},{type:"Feature",properties:{wikidata:"Q1352230",nameEn:"US Territories",country:"US",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q1451600",nameEn:"Overseas Countries and Territories of the EU",aliases:["OCT"],level:"subunion"},geometry:null},{type:"Feature",properties:{wikidata:"Q1544253",nameEn:"Great Chagos Bank",country:"GB",groups:["IO","BOTS","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[70.1848,-6.37445],[72.17991,-6.68509],[73.20573,-5.20727],[70.1848,-6.37445]]]]}},{type:"Feature",properties:{wikidata:"Q1585511",nameEn:"Salomon Atoll",country:"GB",groups:["IO","BOTS","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[72.09518,-5.61768],[73.20573,-5.20727],[72.12587,-4.02588],[72.09518,-5.61768]]]]}},{type:"Feature",properties:{wikidata:"Q1681727",nameEn:"Saint-Paul and Amsterdam",country:"FR",groups:["EU","TF","Q1451600","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[76.31747,-42.16264],[80.15867,-36.04977],[71.22311,-38.75287],[76.31747,-42.16264]]]]}},{type:"Feature",properties:{wikidata:"Q1901211",nameEn:"East Malaysia",country:"MY",groups:["Q36117","035","142","UN"],driveSide:"left",callingCodes:["60"]},geometry:{type:"MultiPolygon",coordinates:[[[[110.90339,7.52694],[109.82788,2.86812],[109.62558,1.99182],[109.53794,1.91771],[109.57923,1.80624],[109.66397,1.79972],[109.66397,1.60425],[110.35354,.98869],[110.49182,.88088],[110.62374,.873],[111.22979,1.08326],[111.55434,.97864],[111.82846,.99349],[111.94553,1.12016],[112.15679,1.17004],[112.2127,1.44135],[112.48648,1.56516],[113.021,1.57819],[113.01448,1.42832],[113.64677,1.23933],[114.03788,1.44787],[114.57892,1.5],[114.80706,1.92351],[114.80706,2.21665],[115.1721,2.49671],[115.11343,2.82879],[115.53713,3.14776],[115.58276,3.93499],[115.90217,4.37708],[117.25801,4.35108],[117.47313,4.18857],[117.67641,4.16535],[118.06469,4.16638],[118.93936,4.09009],[119.52945,5.35672],[117.98544,6.27477],[117.93857,6.89845],[117.17735,7.52841],[116.79524,7.43869],[115.02521,5.35005],[115.16236,5.01011],[115.15092,4.87604],[115.20737,4.8256],[115.27819,4.63661],[115.2851,4.42295],[115.36346,4.33563],[115.31275,4.30806],[115.09978,4.39123],[115.07737,4.53418],[115.04064,4.63706],[115.02278,4.74137],[115.02955,4.82087],[115.05038,4.90275],[114.99417,4.88201],[114.96982,4.81146],[114.88841,4.81905],[114.8266,4.75062],[114.77303,4.72871],[114.83189,4.42387],[114.88039,4.4257],[114.78539,4.12205],[114.64211,4.00694],[114.49922,4.13108],[114.4416,4.27588],[114.32176,4.2552],[114.32176,4.34942],[114.26876,4.49878],[114.15813,4.57],[114.07448,4.58441],[114.10166,4.76112],[110.90339,7.52694]]]]}},{type:"Feature",properties:{wikidata:"Q1973345",nameEn:"Peninsular Malaysia",country:"MY",groups:["035","142","UN"],driveSide:"left",callingCodes:["60"]},geometry:{type:"MultiPolygon",coordinates:[[[[102.46318,7.22462],[102.09086,6.23546],[102.08127,6.22679],[102.07732,6.193],[102.09182,6.14161],[102.01835,6.05407],[101.99209,6.04075],[101.97114,6.01992],[101.9714,6.00575],[101.94712,5.98421],[101.92819,5.85511],[101.91776,5.84269],[101.89188,5.8386],[101.80144,5.74505],[101.75074,5.79091],[101.69773,5.75881],[101.58019,5.93534],[101.25524,5.78633],[101.25755,5.71065],[101.14062,5.61613],[100.98815,5.79464],[101.02708,5.91013],[101.087,5.9193],[101.12388,6.11411],[101.06165,6.14161],[101.12618,6.19431],[101.10313,6.25617],[100.85884,6.24929],[100.81045,6.45086],[100.74822,6.46231],[100.74361,6.50811],[100.66986,6.45086],[100.43027,6.52389],[100.42351,6.51762],[100.41791,6.5189],[100.41152,6.52299],[100.35413,6.54932],[100.31929,6.65413],[100.32607,6.65933],[100.32671,6.66526],[100.31884,6.66423],[100.31618,6.66781],[100.30828,6.66462],[100.29651,6.68439],[100.19511,6.72559],[100.12,6.42105],[100.0756,6.4045],[99.91873,6.50233],[99.50117,6.44501],[99.31854,5.99868],[99.75778,3.86466],[103.03657,1.30383],[103.56591,1.19719],[103.62738,1.35255],[103.67468,1.43166],[103.7219,1.46108],[103.74161,1.4502],[103.76395,1.45183],[103.81181,1.47953],[103.86383,1.46288],[103.89565,1.42841],[103.93384,1.42926],[104.00131,1.42405],[104.02277,1.4438],[104.04622,1.44691],[104.07348,1.43322],[104.08871,1.42015],[104.09162,1.39694],[104.08072,1.35998],[104.12282,1.27714],[104.34728,1.33529],[104.56723,1.44271],[105.01437,3.24936],[102.46318,7.22462]]]]}},{type:"Feature",properties:{wikidata:"Q2093907",nameEn:"Three Kings Islands",country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left"},geometry:{type:"MultiPolygon",coordinates:[[[[174.17679,-32.62487],[170.93268,-32.97889],[171.97383,-34.64644],[174.17679,-32.62487]]]]}},{type:"Feature",properties:{wikidata:"Q2298216",nameEn:"Solander Islands",country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left"},geometry:{type:"MultiPolygon",coordinates:[[[[167.39068,-46.49187],[166.5534,-46.39484],[166.84561,-46.84889],[167.39068,-46.49187]]]]}},{type:"Feature",properties:{wikidata:"Q2872203",nameEn:"Mainland Australia",country:"AU",groups:["053","009","UN"],level:"subcountryGroup",driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[88.16419,-23.49578],[123.64533,-39.13605],[159.74028,-39.1978],[159.76765,-29.76946],[154.02855,-24.43238],[152.93188,-20.92631],[147.69992,-17.5933],[145.2855,-9.62524],[143.87386,-9.02382],[143.29772,-9.33993],[142.48658,-9.36754],[142.19246,-9.15378],[141.88934,-9.36111],[141.01842,-9.35091],[135.49042,-9.2276],[127.55165,-9.05052],[125.29076,-12.33139],[88.16419,-23.49578]]]]}},{type:"Feature",properties:{wikidata:"Q2914565",nameEn:"Autonomous Regions of Portugal",country:"PT",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q2915956",nameEn:"Mainland Portugal",country:"PT",groups:["Q12837","EU","039","150","UN"],level:"subcountryGroup",callingCodes:["351"]},geometry:{type:"MultiPolygon",coordinates:[[[[-10.39881,36.12218],[-7.37282,36.96896],[-7.39769,37.16868],[-7.41133,37.20314],[-7.41854,37.23813],[-7.43227,37.25152],[-7.43974,37.38913],[-7.46878,37.47127],[-7.51759,37.56119],[-7.41981,37.75729],[-7.33441,37.81193],[-7.27314,37.90145],[-7.24544,37.98884],[-7.12648,38.00296],[-7.10366,38.04404],[-7.05966,38.01966],[-7.00375,38.01914],[-6.93418,38.21454],[-7.09389,38.17227],[-7.15581,38.27597],[-7.32529,38.44336],[-7.265,38.61674],[-7.26174,38.72107],[-7.03848,38.87221],[-7.051,38.907],[-6.95211,39.0243],[-6.97004,39.07619],[-7.04011,39.11919],[-7.10692,39.10275],[-7.14929,39.11287],[-7.12811,39.17101],[-7.23566,39.20132],[-7.23403,39.27579],[-7.3149,39.34857],[-7.2927,39.45847],[-7.49477,39.58794],[-7.54121,39.66717],[-7.33507,39.64569],[-7.24707,39.66576],[-7.01613,39.66877],[-6.97492,39.81488],[-6.91463,39.86618],[-6.86737,40.01986],[-6.94233,40.10716],[-7.00589,40.12087],[-7.02544,40.18564],[-7.00426,40.23169],[-6.86085,40.26776],[-6.86085,40.2976],[-6.80218,40.33239],[-6.78426,40.36468],[-6.84618,40.42177],[-6.84944,40.46394],[-6.7973,40.51723],[-6.80218,40.55067],[-6.84292,40.56801],[-6.79567,40.65955],[-6.82826,40.74603],[-6.82337,40.84472],[-6.79892,40.84842],[-6.80707,40.88047],[-6.84292,40.89771],[-6.8527,40.93958],[-6.9357,41.02888],[-6.913,41.03922],[-6.88843,41.03027],[-6.84781,41.02692],[-6.80942,41.03629],[-6.79241,41.05397],[-6.75655,41.10187],[-6.77319,41.13049],[-6.69711,41.1858],[-6.68286,41.21641],[-6.65046,41.24725],[-6.55937,41.24417],[-6.38551,41.35274],[-6.38553,41.38655],[-6.3306,41.37677],[-6.26777,41.48796],[-6.19128,41.57638],[-6.29863,41.66432],[-6.44204,41.68258],[-6.49907,41.65823],[-6.54633,41.68623],[-6.56426,41.74219],[-6.51374,41.8758],[-6.56752,41.88429],[-6.5447,41.94371],[-6.58544,41.96674],[-6.61967,41.94008],[-6.75004,41.94129],[-6.76959,41.98734],[-6.81196,41.99097],[-6.82174,41.94493],[-6.94396,41.94403],[-6.95537,41.96553],[-6.98144,41.9728],[-7.01078,41.94977],[-7.07596,41.94977],[-7.08574,41.97401],[-7.14115,41.98855],[-7.18549,41.97515],[-7.18677,41.88793],[-7.32366,41.8406],[-7.37092,41.85031],[-7.42864,41.80589],[-7.42854,41.83262],[-7.44759,41.84451],[-7.45566,41.86488],[-7.49803,41.87095],[-7.52737,41.83939],[-7.62188,41.83089],[-7.58603,41.87944],[-7.65774,41.88308],[-7.69848,41.90977],[-7.84188,41.88065],[-7.88055,41.84571],[-7.88751,41.92553],[-7.90707,41.92432],[-7.92336,41.8758],[-7.9804,41.87337],[-8.01136,41.83453],[-8.0961,41.81024],[-8.16455,41.81753],[-8.16944,41.87944],[-8.19551,41.87459],[-8.2185,41.91237],[-8.16232,41.9828],[-8.08796,42.01398],[-8.08847,42.05767],[-8.11729,42.08537],[-8.18178,42.06436],[-8.19406,42.12141],[-8.18947,42.13853],[-8.1986,42.15402],[-8.22406,42.1328],[-8.24681,42.13993],[-8.2732,42.12396],[-8.29809,42.106],[-8.32161,42.10218],[-8.33912,42.08358],[-8.36353,42.09065],[-8.38323,42.07683],[-8.40143,42.08052],[-8.42512,42.07199],[-8.44123,42.08218],[-8.48185,42.0811],[-8.52837,42.07658],[-8.5252,42.06264],[-8.54563,42.0537],[-8.58086,42.05147],[-8.59493,42.05708],[-8.63791,42.04691],[-8.64626,42.03668],[-8.65832,42.02972],[-8.6681,41.99703],[-8.69071,41.98862],[-8.7478,41.96282],[-8.74606,41.9469],[-8.75712,41.92833],[-8.81794,41.90375],[-8.87157,41.86488],[-11.19304,41.83075],[-10.39881,36.12218]]]]}},{type:"Feature",properties:{wikidata:"Q3311985",nameEn:"Guernsey",country:"GB",groups:["GG","830","Q185086","154","150","UN"],level:"subterritory",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01481"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.49556,49.79012],[-3.28154,49.57329],[-2.65349,49.15373],[-2.36485,49.48223],[-2.49556,49.79012]]]]}},{type:"Feature",properties:{wikidata:"Q3320166",nameEn:"Outermost Regions of the EU",aliases:["OMR"],level:"subunion"},geometry:null},{type:"Feature",properties:{wikidata:"Q3336843",nameEn:"Countries of the United Kingdom",aliases:["GB-UKM"],country:"GB",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q6736667",nameEn:"Mainland India",country:"IN",groups:["034","142","UN"],driveSide:"left",callingCodes:["91"]},geometry:{type:"MultiPolygon",coordinates:[[[[89.08044,21.41871],[89.07114,22.15335],[88.9367,22.58527],[88.94614,22.66941],[88.9151,22.75228],[88.96713,22.83346],[88.87063,22.95235],[88.88327,23.03885],[88.86377,23.08759],[88.99148,23.21134],[88.71133,23.2492],[88.79254,23.46028],[88.79351,23.50535],[88.74841,23.47361],[88.56507,23.64044],[88.58087,23.87105],[88.66189,23.87607],[88.73743,23.91751],[88.6976,24.14703],[88.74841,24.1959],[88.68801,24.31464],[88.50934,24.32474],[88.12296,24.51301],[88.08786,24.63232],[88.00683,24.66477],[88.15515,24.85806],[88.14004,24.93529],[88.21832,24.96642],[88.27325,24.88796],[88.33917,24.86803],[88.46277,25.07468],[88.44766,25.20149],[88.94067,25.18534],[89.00463,25.26583],[89.01105,25.30303],[88.85278,25.34679],[88.81296,25.51546],[88.677,25.46959],[88.4559,25.59227],[88.45103,25.66245],[88.242,25.80811],[88.13138,25.78773],[88.08804,25.91334],[88.16581,26.0238],[88.1844,26.14417],[88.34757,26.22216],[88.35153,26.29123],[88.51649,26.35923],[88.48749,26.45855],[88.36938,26.48683],[88.35153,26.45241],[88.33093,26.48929],[88.41196,26.63837],[88.4298,26.54489],[88.62144,26.46783],[88.69485,26.38353],[88.67837,26.26291],[88.78961,26.31093],[88.85004,26.23211],[89.05328,26.2469],[88.91321,26.37984],[88.92357,26.40711],[88.95612,26.4564],[89.08899,26.38845],[89.15869,26.13708],[89.35953,26.0077],[89.53515,26.00382],[89.57101,25.9682],[89.63968,26.22595],[89.70201,26.15138],[89.73581,26.15818],[89.77865,26.08387],[89.77728,26.04254],[89.86592,25.93115],[89.80585,25.82489],[89.84388,25.70042],[89.86129,25.61714],[89.81208,25.37244],[89.84086,25.31854],[89.83371,25.29548],[89.87629,25.28337],[89.90478,25.31038],[90.1155,25.22686],[90.40034,25.1534],[90.65042,25.17788],[90.87427,25.15799],[91.25517,25.20677],[91.63648,25.12846],[92.0316,25.1834],[92.33957,25.07593],[92.39147,25.01471],[92.49887,24.88796],[92.38626,24.86055],[92.25854,24.9191],[92.15796,24.54435],[92.11662,24.38997],[91.96603,24.3799],[91.89258,24.14674],[91.82596,24.22345],[91.76004,24.23848],[91.73257,24.14703],[91.65292,24.22095],[91.63782,24.1132],[91.55542,24.08687],[91.37414,24.10693],[91.35741,23.99072],[91.29587,24.0041],[91.22308,23.89616],[91.25192,23.83463],[91.15579,23.6599],[91.28293,23.37538],[91.36453,23.06612],[91.40848,23.07117],[91.4035,23.27522],[91.46615,23.2328],[91.54993,23.01051],[91.61571,22.93929],[91.7324,23.00043],[91.81634,23.08001],[91.76417,23.26619],[91.84789,23.42235],[91.95642,23.47361],[91.95093,23.73284],[92.04706,23.64229],[92.15417,23.73409],[92.26541,23.70392],[92.38214,23.28705],[92.37665,22.9435],[92.5181,22.71441],[92.60029,22.1522],[92.56616,22.13554],[92.60949,21.97638],[92.67532,22.03547],[92.70416,22.16017],[92.86208,22.05456],[92.89504,21.95143],[92.93899,22.02656],[92.99804,21.98964],[92.99255,22.05965],[93.04885,22.20595],[93.15734,22.18687],[93.14224,22.24535],[93.19991,22.25425],[93.18206,22.43716],[93.13537,22.45873],[93.11477,22.54374],[93.134,22.59573],[93.09417,22.69459],[93.134,22.92498],[93.12988,23.05772],[93.2878,23.00464],[93.38478,23.13698],[93.36862,23.35426],[93.38781,23.36139],[93.39981,23.38828],[93.38805,23.4728],[93.43475,23.68299],[93.3908,23.7622],[93.3908,23.92925],[93.36059,23.93176],[93.32351,24.04468],[93.34735,24.10151],[93.41415,24.07854],[93.46633,23.97067],[93.50616,23.94432],[93.62871,24.00922],[93.75952,24.0003],[93.80279,23.92549],[93.92089,23.95812],[94.14081,23.83333],[94.30215,24.23752],[94.32362,24.27692],[94.45279,24.56656],[94.50729,24.59281],[94.5526,24.70764],[94.60204,24.70889],[94.73937,25.00545],[94.74212,25.13606],[94.57458,25.20318],[94.68032,25.47003],[94.80117,25.49359],[95.18556,26.07338],[95.11428,26.1019],[95.12801,26.38397],[95.05798,26.45408],[95.23513,26.68499],[95.30339,26.65372],[95.437,26.7083],[95.81603,27.01335],[95.93002,27.04149],[96.04949,27.19428],[96.15591,27.24572],[96.40779,27.29818],[96.55761,27.29928],[96.73888,27.36638],[96.88445,27.25046],[96.85287,27.2065],[96.89132,27.17474],[97.14675,27.09041],[97.17422,27.14052],[96.91431,27.45752],[96.90112,27.62149],[97.29919,27.92233],[97.35824,27.87256],[97.38845,28.01329],[97.35412,28.06663],[97.31292,28.06784],[97.34547,28.21385],[97.1289,28.3619],[96.98882,28.32564],[96.88445,28.39452],[96.85561,28.4875],[96.6455,28.61657],[96.48895,28.42955],[96.40929,28.51526],[96.61391,28.72742],[96.3626,29.10607],[96.20467,29.02325],[96.18682,29.11087],[96.31316,29.18643],[96.05361,29.38167],[95.84899,29.31464],[95.75149,29.32063],[95.72086,29.20797],[95.50842,29.13487],[95.41091,29.13007],[95.3038,29.13847],[95.26122,29.07727],[95.2214,29.10727],[95.11291,29.09527],[95.0978,29.14446],[94.81353,29.17804],[94.69318,29.31739],[94.2752,29.11687],[94.35897,29.01965],[93.72797,28.68821],[93.44621,28.67189],[93.18069,28.50319],[93.14635,28.37035],[92.93075,28.25671],[92.67486,28.15018],[92.65472,28.07632],[92.73025,28.05814],[92.7275,27.98662],[92.42538,27.80092],[92.32101,27.79363],[92.27432,27.89077],[91.87057,27.7195],[91.84722,27.76325],[91.6469,27.76358],[91.55819,27.6144],[91.65007,27.48287],[92.01132,27.47352],[92.12019,27.27829],[92.04702,27.26861],[92.03457,27.07334],[92.11863,26.893],[92.05523,26.8692],[91.83181,26.87318],[91.50067,26.79223],[90.67715,26.77215],[90.48504,26.8594],[90.39271,26.90704],[90.30402,26.85098],[90.04535,26.72422],[89.86124,26.73307],[89.63369,26.74402],[89.42349,26.83727],[89.3901,26.84225],[89.38319,26.85963],[89.37913,26.86224],[89.1926,26.81329],[89.12825,26.81661],[89.09554,26.89089],[88.95807,26.92668],[88.92301,26.99286],[88.8714,26.97488],[88.86984,27.10937],[88.74219,27.144],[88.91901,27.32483],[88.82981,27.38814],[88.77517,27.45415],[88.88091,27.85192],[88.83559,28.01936],[88.63235,28.12356],[88.54858,28.06057],[88.25332,27.9478],[88.1278,27.95417],[88.13378,27.88015],[88.1973,27.85067],[88.19107,27.79285],[88.04008,27.49223],[88.07277,27.43007],[88.01646,27.21612],[88.01587,27.21388],[87.9887,27.11045],[88.11719,26.98758],[88.13422,26.98705],[88.12302,26.95324],[88.19107,26.75516],[88.1659,26.68177],[88.16452,26.64111],[88.09963,26.54195],[88.09414,26.43732],[88.00895,26.36029],[87.90115,26.44923],[87.89085,26.48565],[87.84193,26.43663],[87.7918,26.46737],[87.76004,26.40711],[87.67893,26.43501],[87.66803,26.40294],[87.59175,26.38342],[87.55274,26.40596],[87.51571,26.43106],[87.46566,26.44058],[87.37314,26.40815],[87.34568,26.34787],[87.26568,26.37294],[87.26587,26.40592],[87.24682,26.4143],[87.18863,26.40558],[87.14751,26.40542],[87.09147,26.45039],[87.0707,26.58571],[87.04691,26.58685],[87.01559,26.53228],[86.95912,26.52076],[86.94543,26.52076],[86.82898,26.43919],[86.76797,26.45892],[86.74025,26.42386],[86.69124,26.45169],[86.62686,26.46891],[86.61313,26.48658],[86.57073,26.49825],[86.54258,26.53819],[86.49726,26.54218],[86.31564,26.61925],[86.26235,26.61886],[86.22513,26.58863],[86.13596,26.60651],[86.02729,26.66756],[85.8492,26.56667],[85.85126,26.60866],[85.83126,26.61134],[85.76907,26.63076],[85.72315,26.67471],[85.73483,26.79613],[85.66239,26.84822],[85.61621,26.86721],[85.59461,26.85161],[85.5757,26.85955],[85.56471,26.84133],[85.47752,26.79292],[85.34302,26.74954],[85.21159,26.75933],[85.18046,26.80519],[85.19291,26.86909],[85.15883,26.86966],[85.02635,26.85381],[85.05592,26.88991],[85.00536,26.89523],[84.97186,26.9149],[84.96687,26.95599],[84.85754,26.98984],[84.82913,27.01989],[84.793,26.9968],[84.64496,27.04669],[84.69166,27.21294],[84.62161,27.33885],[84.29315,27.39],[84.25735,27.44941],[84.21376,27.45218],[84.10791,27.52399],[84.02229,27.43836],[83.93306,27.44939],[83.86182,27.4241],[83.85595,27.35797],[83.61288,27.47013],[83.39495,27.4798],[83.38872,27.39276],[83.35136,27.33885],[83.29999,27.32778],[83.2673,27.36235],[83.27197,27.38309],[83.19413,27.45632],[82.94938,27.46036],[82.93261,27.50328],[82.74119,27.49838],[82.70378,27.72122],[82.46405,27.6716],[82.06554,27.92222],[81.97214,27.93322],[81.91223,27.84995],[81.47867,28.08303],[81.48179,28.12148],[81.38683,28.17638],[81.32923,28.13521],[81.19847,28.36284],[81.03471,28.40054],[80.55142,28.69182],[80.50575,28.6706],[80.52443,28.54897],[80.44504,28.63098],[80.37188,28.63371],[80.12125,28.82346],[80.06957,28.82763],[80.05743,28.91479],[80.18085,29.13649],[80.23178,29.11626],[80.26602,29.13938],[80.24112,29.21414],[80.28626,29.20327],[80.31428,29.30784],[80.24322,29.44299],[80.37939,29.57098],[80.41858,29.63581],[80.38428,29.68513],[80.36803,29.73865],[80.41554,29.79451],[80.43458,29.80466],[80.48997,29.79566],[80.56247,29.86661],[80.57179,29.91422],[80.60226,29.95732],[80.67076,29.95732],[80.8778,30.13384],[80.86673,30.17321],[80.91143,30.22173],[80.92547,30.17193],[81.03953,30.20059],[80.83343,30.32023],[80.54504,30.44936],[80.20721,30.58541],[79.93255,30.88288],[79.59884,30.93943],[79.30694,31.17357],[79.14016,31.43403],[79.01931,31.42817],[78.89344,31.30481],[78.77898,31.31209],[78.71032,31.50197],[78.84516,31.60631],[78.69933,31.78723],[78.78036,31.99478],[78.74404,32.00384],[78.68754,32.10256],[78.49609,32.2762],[78.4645,32.45367],[78.38897,32.53938],[78.73916,32.69438],[78.7831,32.46873],[78.96713,32.33655],[78.99322,32.37948],[79.0979,32.38051],[79.13174,32.47766],[79.26768,32.53277],[79.46562,32.69668],[79.14016,33.02545],[79.15252,33.17156],[78.73636,33.56521],[78.67599,33.66445],[78.77349,33.73871],[78.73367,34.01121],[78.65657,34.03195],[78.66225,34.08858],[78.91769,34.15452],[78.99802,34.3027],[79.05364,34.32482],[78.74465,34.45174],[78.56475,34.50835],[78.54964,34.57283],[78.27781,34.61484],[78.18435,34.7998],[78.22692,34.88771],[78.00033,35.23954],[78.03466,35.3785],[78.11664,35.48022],[77.80532,35.52058],[77.70232,35.46244],[77.44277,35.46132],[76.96624,35.5932],[76.84539,35.67356],[76.77323,35.66062],[76.75475,35.52617],[76.85088,35.39754],[76.93465,35.39866],[77.11796,35.05419],[76.99251,34.93349],[76.87193,34.96906],[76.74514,34.92488],[76.74377,34.84039],[76.67648,34.76371],[76.47186,34.78965],[76.15463,34.6429],[76.04614,34.67566],[75.75438,34.51827],[75.38009,34.55021],[75.01479,34.64629],[74.6663,34.703],[74.58083,34.77386],[74.31239,34.79626],[74.12897,34.70073],[73.96423,34.68244],[73.93401,34.63386],[73.93951,34.57169],[73.89419,34.54568],[73.88732,34.48911],[73.74999,34.3781],[73.74862,34.34183],[73.8475,34.32935],[73.90517,34.35317],[73.98208,34.2522],[73.90677,34.10504],[73.88732,34.05105],[73.91341,34.01235],[74.21554,34.03853],[74.25262,34.01577],[74.26086,33.92237],[74.14001,33.83002],[74.05898,33.82089],[74.00891,33.75437],[73.96423,33.73071],[73.98968,33.66155],[73.97367,33.64061],[74.03576,33.56718],[74.10115,33.56392],[74.18121,33.4745],[74.17983,33.3679],[74.08782,33.26232],[74.01366,33.25199],[74.02144,33.18908],[74.15374,33.13477],[74.17571,33.07495],[74.31854,33.02891],[74.34875,32.97823],[74.31227,32.92795],[74.41467,32.90563],[74.45312,32.77755],[74.6289,32.75561],[74.64675,32.82604],[74.7113,32.84219],[74.65345,32.71225],[74.69542,32.66792],[74.64424,32.60985],[74.65251,32.56416],[74.67431,32.56676],[74.68362,32.49298],[74.84725,32.49075],[74.97634,32.45367],[75.03265,32.49538],[75.28259,32.36556],[75.38046,32.26836],[75.25649,32.10187],[75.00793,32.03786],[74.9269,32.0658],[74.86236,32.04485],[74.79919,31.95983],[74.58907,31.87824],[74.47771,31.72227],[74.57498,31.60382],[74.61517,31.55698],[74.59319,31.50197],[74.64713,31.45605],[74.59773,31.4136],[74.53223,31.30321],[74.51629,31.13829],[74.56023,31.08303],[74.60281,31.10419],[74.60006,31.13711],[74.6852,31.12771],[74.67971,31.05479],[74.5616,31.04153],[73.88993,30.36305],[73.95736,30.28466],[73.97225,30.19829],[73.80299,30.06969],[73.58665,30.01848],[73.3962,29.94707],[73.28094,29.56646],[73.05886,29.1878],[73.01337,29.16422],[72.94272,29.02487],[72.40402,28.78283],[72.29495,28.66367],[72.20329,28.3869],[71.9244,28.11555],[71.89921,27.96035],[70.79054,27.68423],[70.60927,28.02178],[70.37307,28.01208],[70.12502,27.8057],[70.03136,27.56627],[69.58519,27.18109],[69.50904,26.74892],[69.88555,26.56836],[70.05584,26.60398],[70.17532,26.55362],[70.17532,26.24118],[70.08193,26.08094],[70.0985,25.93238],[70.2687,25.71156],[70.37444,25.67443],[70.53649,25.68928],[70.60378,25.71898],[70.67382,25.68186],[70.66695,25.39314],[70.89148,25.15064],[70.94002,24.92843],[71.09405,24.69017],[70.97594,24.60904],[71.00341,24.46038],[71.12838,24.42662],[71.04461,24.34657],[70.94985,24.3791],[70.85784,24.30903],[70.88393,24.27398],[70.71502,24.23517],[70.57906,24.27774],[70.5667,24.43787],[70.11712,24.30915],[70.03428,24.172],[69.73335,24.17007],[69.59579,24.29777],[69.29778,24.28712],[69.19341,24.25646],[69.07806,24.29777],[68.97781,24.26021],[68.90914,24.33156],[68.7416,24.31904],[68.74643,23.97027],[68.39339,23.96838],[68.20763,23.85849],[68.11329,23.53945],[76.59015,5.591],[79.50447,8.91876],[79.42124,9.80115],[80.48418,10.20786],[89.08044,21.41871]]]]}},{type:"Feature",properties:{wikidata:"Q9143535",nameEn:"Akrotiri",country:"GB",groups:["Q644636","Q37362","BOTS","145","142","UN"],level:"subterritory",driveSide:"left",callingCodes:["357"]},geometry:{type:"MultiPolygon",coordinates:[[[[32.86014,34.70585],[32.82717,34.70622],[32.79433,34.67883],[32.76136,34.68318],[32.75515,34.64985],[32.74412,34.43926],[33.26744,34.49942],[33.0138,34.64424],[32.96968,34.64046],[32.96718,34.63446],[32.95891,34.62919],[32.95323,34.64075],[32.95471,34.64528],[32.94976,34.65204],[32.94796,34.6587],[32.95325,34.66462],[32.97079,34.66112],[32.97736,34.65277],[32.99014,34.65518],[32.98668,34.67268],[32.99135,34.68061],[32.95539,34.68471],[32.94683,34.67907],[32.94379,34.67111],[32.93693,34.67027],[32.93449,34.66241],[32.92807,34.66736],[32.93043,34.67091],[32.91398,34.67343],[32.9068,34.66102],[32.86167,34.68734],[32.86014,34.70585]]]]}},{type:"Feature",properties:{wikidata:"Q9206745",nameEn:"Dhekelia",country:"GB",groups:["Q644636","Q37362","BOTS","145","142","UN"],level:"subterritory",driveSide:"left",callingCodes:["357"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.70575,34.97947],[33.83531,34.73974],[33.98684,34.76642],[33.90075,34.96623],[33.86432,34.97592],[33.84811,34.97075],[33.83505,34.98108],[33.85621,34.98956],[33.85891,35.001],[33.85216,35.00579],[33.84045,35.00616],[33.82875,35.01685],[33.83055,35.02865],[33.81524,35.04192],[33.8012,35.04786],[33.82051,35.0667],[33.8355,35.05777],[33.85261,35.0574],[33.88367,35.07877],[33.89485,35.06873],[33.90247,35.07686],[33.91299,35.07579],[33.91789,35.08688],[33.89853,35.11377],[33.88737,35.11408],[33.88943,35.12007],[33.88561,35.12449],[33.87224,35.12293],[33.87622,35.10457],[33.87097,35.09389],[33.87479,35.08881],[33.8541,35.07201],[33.84168,35.06823],[33.82067,35.07826],[33.78581,35.05104],[33.76106,35.04253],[33.73824,35.05321],[33.71482,35.03722],[33.70209,35.04882],[33.7161,35.07279],[33.70861,35.07644],[33.69095,35.06237],[33.68474,35.06602],[33.67742,35.05963],[33.67678,35.03866],[33.69938,35.03123],[33.69731,35.01754],[33.71514,35.00294],[33.70639,34.99303],[33.70575,34.97947]],[[33.77312,34.9976],[33.77553,34.99518],[33.78516,34.99582],[33.79191,34.98914],[33.78917,34.98854],[33.78571,34.98951],[33.78318,34.98699],[33.78149,34.98854],[33.77843,34.988],[33.7778,34.98981],[33.76738,34.99188],[33.76605,34.99543],[33.75682,34.99916],[33.75994,35.00113],[33.77312,34.9976]],[[33.74144,35.01053],[33.7343,35.01178],[33.73781,35.02181],[33.74265,35.02329],[33.74983,35.02274],[33.7492,35.01319],[33.74144,35.01053]]]]}},{type:"Feature",properties:{wikidata:"Q16390686",nameEn:"Peninsular Spain",country:"ES",groups:["Q12837","EU","039","150","UN"],callingCodes:["34"]},geometry:{type:"MultiPolygon",coordinates:[[[[3.75438,42.33445],[3.17156,42.43545],[3.11379,42.43646],[3.10027,42.42621],[3.08167,42.42748],[3.03734,42.47363],[2.96518,42.46692],[2.94283,42.48174],[2.92107,42.4573],[2.88413,42.45938],[2.86983,42.46843],[2.85675,42.45444],[2.84335,42.45724],[2.77464,42.41046],[2.75497,42.42578],[2.72056,42.42298],[2.65311,42.38771],[2.6747,42.33974],[2.57934,42.35808],[2.55516,42.35351],[2.54382,42.33406],[2.48457,42.33933],[2.43508,42.37568],[2.43299,42.39423],[2.38504,42.39977],[2.25551,42.43757],[2.20578,42.41633],[2.16599,42.42314],[2.12789,42.41291],[2.11621,42.38393],[2.06241,42.35906],[2.00488,42.35399],[1.96482,42.37787],[1.9574,42.42401],[1.94084,42.43039],[1.94061,42.43333],[1.94292,42.44316],[1.93663,42.45439],[1.88853,42.4501],[1.83037,42.48395],[1.76335,42.48863],[1.72515,42.50338],[1.70571,42.48867],[1.66826,42.50779],[1.65674,42.47125],[1.58933,42.46275],[1.57953,42.44957],[1.55937,42.45808],[1.55073,42.43299],[1.5127,42.42959],[1.44529,42.43724],[1.43838,42.47848],[1.41648,42.48315],[1.46661,42.50949],[1.44759,42.54431],[1.41245,42.53539],[1.4234,42.55959],[1.44529,42.56722],[1.42512,42.58292],[1.44197,42.60217],[1.35562,42.71944],[1.15928,42.71407],[1.0804,42.78569],[.98292,42.78754],[.96166,42.80629],[.93089,42.79154],[.711,42.86372],[.66121,42.84021],[.65421,42.75872],[.67873,42.69458],[.40214,42.69779],[.36251,42.72282],[.29407,42.67431],[.25336,42.7174],[.17569,42.73424],[-.02468,42.68513],[-.10519,42.72761],[-.16141,42.79535],[-.17939,42.78974],[-.3122,42.84788],[-.38833,42.80132],[-.41319,42.80776],[-.44334,42.79939],[-.50863,42.82713],[-.55497,42.77846],[-.67637,42.88303],[-.69837,42.87945],[-.72608,42.89318],[-.73422,42.91228],[-.72037,42.92541],[-.75478,42.96916],[-.81652,42.95166],[-.97133,42.96239],[-1.00963,42.99279],[-1.10333,43.0059],[-1.22881,43.05534],[-1.25244,43.04164],[-1.30531,43.06859],[-1.30052,43.09581],[-1.27118,43.11961],[-1.32209,43.1127],[-1.34419,43.09665],[-1.35272,43.02658],[-1.44067,43.047],[-1.47555,43.08372],[-1.41562,43.12815],[-1.3758,43.24511],[-1.40942,43.27272],[-1.45289,43.27049],[-1.50992,43.29481],[-1.55963,43.28828],[-1.57674,43.25269],[-1.61341,43.25269],[-1.63052,43.28591],[-1.62481,43.30726],[-1.69407,43.31378],[-1.73074,43.29481],[-1.7397,43.32979],[-1.75079,43.3317],[-1.75334,43.34107],[-1.77068,43.34396],[-1.78714,43.35476],[-1.78332,43.36399],[-1.79319,43.37497],[-1.77289,43.38957],[-1.81005,43.59738],[-10.14298,44.17365],[-11.19304,41.83075],[-8.87157,41.86488],[-8.81794,41.90375],[-8.75712,41.92833],[-8.74606,41.9469],[-8.7478,41.96282],[-8.69071,41.98862],[-8.6681,41.99703],[-8.65832,42.02972],[-8.64626,42.03668],[-8.63791,42.04691],[-8.59493,42.05708],[-8.58086,42.05147],[-8.54563,42.0537],[-8.5252,42.06264],[-8.52837,42.07658],[-8.48185,42.0811],[-8.44123,42.08218],[-8.42512,42.07199],[-8.40143,42.08052],[-8.38323,42.07683],[-8.36353,42.09065],[-8.33912,42.08358],[-8.32161,42.10218],[-8.29809,42.106],[-8.2732,42.12396],[-8.24681,42.13993],[-8.22406,42.1328],[-8.1986,42.15402],[-8.18947,42.13853],[-8.19406,42.12141],[-8.18178,42.06436],[-8.11729,42.08537],[-8.08847,42.05767],[-8.08796,42.01398],[-8.16232,41.9828],[-8.2185,41.91237],[-8.19551,41.87459],[-8.16944,41.87944],[-8.16455,41.81753],[-8.0961,41.81024],[-8.01136,41.83453],[-7.9804,41.87337],[-7.92336,41.8758],[-7.90707,41.92432],[-7.88751,41.92553],[-7.88055,41.84571],[-7.84188,41.88065],[-7.69848,41.90977],[-7.65774,41.88308],[-7.58603,41.87944],[-7.62188,41.83089],[-7.52737,41.83939],[-7.49803,41.87095],[-7.45566,41.86488],[-7.44759,41.84451],[-7.42854,41.83262],[-7.42864,41.80589],[-7.37092,41.85031],[-7.32366,41.8406],[-7.18677,41.88793],[-7.18549,41.97515],[-7.14115,41.98855],[-7.08574,41.97401],[-7.07596,41.94977],[-7.01078,41.94977],[-6.98144,41.9728],[-6.95537,41.96553],[-6.94396,41.94403],[-6.82174,41.94493],[-6.81196,41.99097],[-6.76959,41.98734],[-6.75004,41.94129],[-6.61967,41.94008],[-6.58544,41.96674],[-6.5447,41.94371],[-6.56752,41.88429],[-6.51374,41.8758],[-6.56426,41.74219],[-6.54633,41.68623],[-6.49907,41.65823],[-6.44204,41.68258],[-6.29863,41.66432],[-6.19128,41.57638],[-6.26777,41.48796],[-6.3306,41.37677],[-6.38553,41.38655],[-6.38551,41.35274],[-6.55937,41.24417],[-6.65046,41.24725],[-6.68286,41.21641],[-6.69711,41.1858],[-6.77319,41.13049],[-6.75655,41.10187],[-6.79241,41.05397],[-6.80942,41.03629],[-6.84781,41.02692],[-6.88843,41.03027],[-6.913,41.03922],[-6.9357,41.02888],[-6.8527,40.93958],[-6.84292,40.89771],[-6.80707,40.88047],[-6.79892,40.84842],[-6.82337,40.84472],[-6.82826,40.74603],[-6.79567,40.65955],[-6.84292,40.56801],[-6.80218,40.55067],[-6.7973,40.51723],[-6.84944,40.46394],[-6.84618,40.42177],[-6.78426,40.36468],[-6.80218,40.33239],[-6.86085,40.2976],[-6.86085,40.26776],[-7.00426,40.23169],[-7.02544,40.18564],[-7.00589,40.12087],[-6.94233,40.10716],[-6.86737,40.01986],[-6.91463,39.86618],[-6.97492,39.81488],[-7.01613,39.66877],[-7.24707,39.66576],[-7.33507,39.64569],[-7.54121,39.66717],[-7.49477,39.58794],[-7.2927,39.45847],[-7.3149,39.34857],[-7.23403,39.27579],[-7.23566,39.20132],[-7.12811,39.17101],[-7.14929,39.11287],[-7.10692,39.10275],[-7.04011,39.11919],[-6.97004,39.07619],[-6.95211,39.0243],[-7.051,38.907],[-7.03848,38.87221],[-7.26174,38.72107],[-7.265,38.61674],[-7.32529,38.44336],[-7.15581,38.27597],[-7.09389,38.17227],[-6.93418,38.21454],[-7.00375,38.01914],[-7.05966,38.01966],[-7.10366,38.04404],[-7.12648,38.00296],[-7.24544,37.98884],[-7.27314,37.90145],[-7.33441,37.81193],[-7.41981,37.75729],[-7.51759,37.56119],[-7.46878,37.47127],[-7.43974,37.38913],[-7.43227,37.25152],[-7.41854,37.23813],[-7.41133,37.20314],[-7.39769,37.16868],[-7.37282,36.96896],[-7.2725,35.73269],[-5.10878,36.05227],[-2.27707,35.35051],[3.75438,42.33445]],[[-5.27801,36.14942],[-5.34064,36.03744],[-5.40526,36.15488],[-5.34536,36.15501],[-5.33822,36.15272],[-5.27801,36.14942]]],[[[1.99838,42.44682],[2.01564,42.45171],[1.99216,42.46208],[1.98579,42.47486],[1.99766,42.4858],[1.98916,42.49351],[1.98022,42.49569],[1.97697,42.48568],[1.97227,42.48487],[1.97003,42.48081],[1.96215,42.47854],[1.95606,42.45785],[1.96125,42.45364],[1.98378,42.44697],[1.99838,42.44682]]]]}},{type:"Feature",properties:{wikidata:"Q98059339",nameEn:"Mainland Norway",country:"NO",groups:["154","150","UN"],callingCodes:["47"]},geometry:{type:"MultiPolygon",coordinates:[[[[10.40861,58.38489],[10.64958,58.89391],[11.08911,58.98745],[11.15367,59.07862],[11.34459,59.11672],[11.4601,58.99022],[11.45199,58.89604],[11.65732,58.90177],[11.8213,59.24985],[11.69297,59.59442],[11.92112,59.69531],[11.87121,59.86039],[12.15641,59.8926],[12.36317,59.99259],[12.52003,60.13846],[12.59133,60.50559],[12.2277,61.02442],[12.69115,61.06584],[12.86939,61.35427],[12.57707,61.56547],[12.40595,61.57226],[12.14746,61.7147],[12.29187,62.25699],[12.07085,62.6297],[12.19919,63.00104],[11.98529,63.27487],[12.19919,63.47935],[12.14928,63.59373],[12.74105,64.02171],[13.23411,64.09087],[13.98222,64.00953],[14.16051,64.18725],[14.11117,64.46674],[13.64276,64.58402],[14.50926,65.31786],[14.53778,66.12399],[15.05113,66.15572],[15.49318,66.28509],[15.37197,66.48217],[16.35589,67.06419],[16.39154,67.21653],[16.09922,67.4364],[16.12774,67.52106],[16.38441,67.52923],[16.7409,67.91037],[17.30416,68.11591],[17.90787,67.96537],[18.13836,68.20874],[18.1241,68.53721],[18.39503,68.58672],[18.63032,68.50849],[18.97255,68.52416],[19.93508,68.35911],[20.22027,68.48759],[19.95647,68.55546],[20.22027,68.67246],[20.33435,68.80174],[20.28444,68.93283],[20.0695,69.04469],[20.55258,69.06069],[20.72171,69.11874],[21.05775,69.0356],[21.11099,69.10291],[20.98641,69.18809],[21.00732,69.22755],[21.27827,69.31281],[21.63833,69.27485],[22.27276,68.89514],[22.38367,68.71561],[22.53321,68.74393],[23.13064,68.64684],[23.68017,68.70276],[23.781,68.84514],[24.02299,68.81601],[24.18432,68.73936],[24.74898,68.65143],[24.90023,68.55579],[24.93048,68.61102],[25.10189,68.63307],[25.12206,68.78684],[25.42455,68.90328],[25.61613,68.89602],[25.75729,68.99383],[25.69679,69.27039],[25.96904,69.68397],[26.40261,69.91377],[26.64461,69.96565],[27.05802,69.92069],[27.57226,70.06215],[27.95542,70.0965],[27.97558,69.99671],[28.32849,69.88605],[28.36883,69.81658],[29.12697,69.69193],[29.31664,69.47994],[28.8629,69.22395],[28.81248,69.11997],[28.91738,69.04774],[29.0444,69.0119],[29.26623,69.13794],[29.27631,69.2811],[29.97205,69.41623],[30.16363,69.65244],[30.52662,69.54699],[30.95011,69.54699],[30.84095,69.80584],[31.59909,70.16571],[32.07813,72.01005],[-11.60274,67.73467],[7.28637,57.35913],[10.40861,58.38489]]]]}},{type:"Feature",properties:{wikidata:"Q98543636",nameEn:"Mainland Ecuador",country:"EC",groups:["005","419","019","UN"],callingCodes:["593"]},geometry:{type:"MultiPolygon",coordinates:[[[[-84.52388,-3.36941],[-80.30602,-3.39149],[-80.20647,-3.431],[-80.24123,-3.46124],[-80.24586,-3.48677],[-80.23651,-3.48652],[-80.22629,-3.501],[-80.20535,-3.51667],[-80.21642,-3.5888],[-80.19848,-3.59249],[-80.18741,-3.63994],[-80.19926,-3.68894],[-80.13232,-3.90317],[-80.46386,-4.01342],[-80.4822,-4.05477],[-80.45023,-4.20938],[-80.32114,-4.21323],[-80.46386,-4.41516],[-80.39256,-4.48269],[-80.13945,-4.29786],[-79.79722,-4.47558],[-79.59402,-4.46848],[-79.26248,-4.95167],[-79.1162,-4.97774],[-79.01659,-5.01481],[-78.85149,-4.66795],[-78.68394,-4.60754],[-78.34362,-3.38633],[-78.24589,-3.39907],[-78.22642,-3.51113],[-78.14324,-3.47653],[-78.19369,-3.36431],[-77.94147,-3.05454],[-76.6324,-2.58397],[-76.05203,-2.12179],[-75.57429,-1.55961],[-75.3872,-.9374],[-75.22862,-.95588],[-75.22862,-.60048],[-75.53615,-.19213],[-75.60169,-.18708],[-75.61997,-.10012],[-75.40192,-.17196],[-75.25764,-.11943],[-75.82927,.09578],[-76.23441,.42294],[-76.41215,.38228],[-76.4094,.24015],[-76.89177,.24736],[-77.52001,.40782],[-77.49984,.64476],[-77.67815,.73863],[-77.66416,.81604],[-77.68613,.83029],[-77.7148,.85003],[-77.85677,.80197],[-78.42749,1.15389],[-78.87137,1.47457],[-82.12561,4.00341],[-84.52388,-3.36941]]]]}},{type:"Feature",properties:{m49:"001",wikidata:"Q2",nameEn:"World",aliases:["Earth","Planet"],level:"world"},geometry:null},{type:"Feature",properties:{m49:"002",wikidata:"Q15",nameEn:"Africa",level:"region"},geometry:null},{type:"Feature",properties:{m49:"003",wikidata:"Q49",nameEn:"North America",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"005",wikidata:"Q18",nameEn:"South America",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"009",wikidata:"Q538",nameEn:"Oceania",level:"region"},geometry:null},{type:"Feature",properties:{m49:"011",wikidata:"Q4412",nameEn:"Western Africa",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"013",wikidata:"Q27611",nameEn:"Central America",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"014",wikidata:"Q27407",nameEn:"Eastern Africa",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"015",wikidata:"Q27381",nameEn:"Northern Africa",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"017",wikidata:"Q27433",nameEn:"Middle Africa",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"018",wikidata:"Q27394",nameEn:"Southern Africa",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"019",wikidata:"Q828",nameEn:"Americas",level:"region"},geometry:null},{type:"Feature",properties:{m49:"021",wikidata:"Q2017699",nameEn:"Northern America",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"029",wikidata:"Q664609",nameEn:"Caribbean",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"030",wikidata:"Q27231",nameEn:"Eastern Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"034",wikidata:"Q771405",nameEn:"Southern Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"035",wikidata:"Q11708",nameEn:"South-eastern Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"039",wikidata:"Q27449",nameEn:"Southern Europe",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"053",wikidata:"Q45256",nameEn:"Australia and New Zealand",aliases:["Australasia"],level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"054",wikidata:"Q37394",nameEn:"Melanesia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"057",wikidata:"Q3359409",nameEn:"Micronesia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"061",wikidata:"Q35942",nameEn:"Polynesia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"142",wikidata:"Q48",nameEn:"Asia",level:"region"},geometry:null},{type:"Feature",properties:{m49:"143",wikidata:"Q27275",nameEn:"Central Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"145",wikidata:"Q27293",nameEn:"Western Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"150",wikidata:"Q46",nameEn:"Europe",level:"region"},geometry:null},{type:"Feature",properties:{m49:"151",wikidata:"Q27468",nameEn:"Eastern Europe",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"154",wikidata:"Q27479",nameEn:"Northern Europe",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"155",wikidata:"Q27496",nameEn:"Western Europe",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"202",wikidata:"Q132959",nameEn:"Sub-Saharan Africa",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"419",wikidata:"Q72829598",nameEn:"Latin America and the Caribbean",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"680",wikidata:"Q3405693",nameEn:"Sark",country:"GB",groups:["GG","830","Q185086","154","150","UN"],level:"subterritory",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01481"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.36485,49.48223],[-2.65349,49.15373],[-2.09454,49.46288],[-2.36485,49.48223]]]]}},{type:"Feature",properties:{m49:"830",wikidata:"Q42314",nameEn:"Channel Islands",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{iso1A2:"AC",iso1A3:"ASC",wikidata:"Q46197",nameEn:"Ascension Island",aliases:["SH-AC"],country:"GB",groups:["SH","BOTS","011","202","002","UN"],isoStatus:"excRes",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["247"]},geometry:{type:"MultiPolygon",coordinates:[[[[-14.82771,-8.70814],[-13.33271,-8.07391],[-14.91926,-6.63386],[-14.82771,-8.70814]]]]}},{type:"Feature",properties:{iso1A2:"AD",iso1A3:"AND",iso1N3:"020",wikidata:"Q228",nameEn:"Andorra",groups:["Q12837","039","150","UN"],callingCodes:["376"]},geometry:{type:"MultiPolygon",coordinates:[[[[1.72515,42.50338],[1.73683,42.55492],[1.7858,42.57698],[1.72588,42.59098],[1.73452,42.61515],[1.68267,42.62533],[1.6625,42.61982],[1.63485,42.62957],[1.60085,42.62703],[1.55418,42.65669],[1.50867,42.64483],[1.48043,42.65203],[1.46718,42.63296],[1.47986,42.61346],[1.44197,42.60217],[1.42512,42.58292],[1.44529,42.56722],[1.4234,42.55959],[1.41245,42.53539],[1.44759,42.54431],[1.46661,42.50949],[1.41648,42.48315],[1.43838,42.47848],[1.44529,42.43724],[1.5127,42.42959],[1.55073,42.43299],[1.55937,42.45808],[1.57953,42.44957],[1.58933,42.46275],[1.65674,42.47125],[1.66826,42.50779],[1.70571,42.48867],[1.72515,42.50338]]]]}},{type:"Feature",properties:{iso1A2:"AE",iso1A3:"ARE",iso1N3:"784",wikidata:"Q878",nameEn:"United Arab Emirates",groups:["145","142","UN"],callingCodes:["971"]},geometry:{type:"MultiPolygon",coordinates:[[[[56.26534,25.62825],[56.25341,25.61443],[56.26636,25.60643],[56.25365,25.60211],[56.20473,25.61119],[56.18363,25.65508],[56.14826,25.66351],[56.13579,25.73524],[56.17416,25.77239],[56.13963,25.82765],[56.19334,25.9795],[56.15498,26.06828],[56.08666,26.05038],[55.81777,26.18798],[55.14145,25.62624],[53.97892,24.64436],[52.82259,25.51697],[52.35509,25.00368],[52.02277,24.75635],[51.83108,24.71675],[51.58834,24.66608],[51.41644,24.39615],[51.58871,24.27256],[51.59617,24.12041],[52.56622,22.94341],[55.13599,22.63334],[55.2137,22.71065],[55.22634,23.10378],[55.57358,23.669],[55.48677,23.94946],[55.73301,24.05994],[55.8308,24.01633],[56.01799,24.07426],[55.95472,24.2172],[55.83367,24.20193],[55.77658,24.23476],[55.76558,24.23227],[55.75257,24.23466],[55.75382,24.2466],[55.75939,24.26114],[55.76781,24.26209],[55.79145,24.27914],[55.80747,24.31069],[55.83395,24.32776],[55.83271,24.41521],[55.76461,24.5287],[55.83271,24.68567],[55.83408,24.77858],[55.81348,24.80102],[55.81116,24.9116],[55.85094,24.96858],[55.90849,24.96771],[55.96316,25.00857],[56.05715,24.95727],[56.05106,24.87461],[55.97467,24.89639],[55.97836,24.87673],[56.03535,24.81161],[56.06128,24.74457],[56.13684,24.73699],[56.20062,24.78565],[56.20568,24.85063],[56.30269,24.88334],[56.34873,24.93205],[56.3227,24.97284],[56.86325,25.03856],[56.82555,25.7713],[56.26534,25.62825]],[[56.26062,25.33108],[56.3005,25.31815],[56.3111,25.30107],[56.35172,25.30681],[56.34438,25.26653],[56.27628,25.23404],[56.24341,25.22867],[56.20872,25.24104],[56.20838,25.25668],[56.24465,25.27505],[56.25008,25.28843],[56.23362,25.31253],[56.26062,25.33108]]],[[[56.28423,25.26344],[56.29379,25.2754],[56.28102,25.28486],[56.2716,25.27916],[56.27086,25.26128],[56.28423,25.26344]]]]}},{type:"Feature",properties:{iso1A2:"AF",iso1A3:"AFG",iso1N3:"004",wikidata:"Q889",nameEn:"Afghanistan",groups:["034","142","UN"],callingCodes:["93"]},geometry:{type:"MultiPolygon",coordinates:[[[[70.61526,38.34774],[70.60407,38.28046],[70.54673,38.24541],[70.4898,38.12546],[70.17206,37.93276],[70.1863,37.84296],[70.27694,37.81258],[70.28243,37.66706],[70.15015,37.52519],[69.95971,37.5659],[69.93362,37.61378],[69.84435,37.60616],[69.80041,37.5746],[69.51888,37.5844],[69.44954,37.4869],[69.36645,37.40462],[69.45022,37.23315],[69.39529,37.16752],[69.25152,37.09426],[69.03274,37.25174],[68.96407,37.32603],[68.88168,37.33368],[68.91189,37.26704],[68.80889,37.32494],[68.81438,37.23862],[68.6798,37.27906],[68.61851,37.19815],[68.41888,37.13906],[68.41201,37.10402],[68.29253,37.10621],[68.27605,37.00977],[68.18542,37.02074],[68.02194,36.91923],[67.87917,37.0591],[67.7803,37.08978],[67.78329,37.1834],[67.51868,37.26102],[67.2581,37.17216],[67.2224,37.24545],[67.13039,37.27168],[67.08232,37.35469],[66.95598,37.40162],[66.64699,37.32958],[66.55743,37.35409],[66.30993,37.32409],[65.72274,37.55438],[65.64137,37.45061],[65.64263,37.34388],[65.51778,37.23881],[64.97945,37.21913],[64.61141,36.6351],[64.62514,36.44311],[64.57295,36.34362],[64.43288,36.24401],[64.05385,36.10433],[63.98519,36.03773],[63.56496,35.95106],[63.53475,35.90881],[63.29579,35.85985],[63.12276,35.86208],[63.10318,35.81782],[63.23262,35.67487],[63.10079,35.63024],[63.12276,35.53196],[63.0898,35.43131],[62.90853,35.37086],[62.74098,35.25432],[62.62288,35.22067],[62.48006,35.28796],[62.29878,35.13312],[62.29191,35.25964],[62.15871,35.33278],[62.05709,35.43803],[61.97743,35.4604],[61.77693,35.41341],[61.58742,35.43803],[61.27371,35.61482],[61.18187,35.30249],[61.0991,35.27845],[61.12831,35.09938],[61.06926,34.82139],[61.00197,34.70631],[60.99922,34.63064],[60.72316,34.52857],[60.91321,34.30411],[60.66502,34.31539],[60.50209,34.13992],[60.5838,33.80793],[60.5485,33.73422],[60.57762,33.59772],[60.69573,33.56054],[60.91133,33.55596],[60.88908,33.50219],[60.56485,33.12944],[60.86191,32.22565],[60.84541,31.49561],[61.70929,31.37391],[61.80569,31.16167],[61.80957,31.12576],[61.83257,31.0452],[61.8335,30.97669],[61.78268,30.92724],[61.80829,30.84224],[60.87231,29.86514],[62.47751,29.40782],[63.5876,29.50456],[64.12966,29.39157],[64.19796,29.50407],[64.62116,29.58903],[65.04005,29.53957],[66.24175,29.85181],[66.36042,29.9583],[66.23609,30.06321],[66.34869,30.404],[66.28413,30.57001],[66.39194,30.9408],[66.42645,30.95309],[66.58175,30.97532],[66.68166,31.07597],[66.72561,31.20526],[66.83273,31.26867],[67.04147,31.31561],[67.03323,31.24519],[67.29964,31.19586],[67.78854,31.33203],[67.7748,31.4188],[67.62374,31.40473],[67.58323,31.52772],[67.72056,31.52304],[67.86887,31.63536],[68.00071,31.6564],[68.1655,31.82691],[68.25614,31.80357],[68.27605,31.75863],[68.44222,31.76446],[68.57475,31.83158],[68.6956,31.75687],[68.79997,31.61665],[68.91078,31.59687],[68.95995,31.64822],[69.00939,31.62249],[69.11514,31.70782],[69.20577,31.85957],[69.3225,31.93186],[69.27032,32.14141],[69.27932,32.29119],[69.23599,32.45946],[69.2868,32.53938],[69.38155,32.56601],[69.44747,32.6678],[69.43649,32.7302],[69.38018,32.76601],[69.47082,32.85834],[69.5436,32.8768],[69.49854,32.88843],[69.49004,33.01509],[69.57656,33.09911],[69.71526,33.09911],[69.79766,33.13247],[69.85259,33.09451],[70.02563,33.14282],[70.07369,33.22557],[70.13686,33.21064],[70.32775,33.34496],[70.17062,33.53535],[70.20141,33.64387],[70.14785,33.6553],[70.14236,33.71701],[70.00503,33.73528],[69.85671,33.93719],[69.87307,33.9689],[69.90203,34.04194],[70.54336,33.9463],[70.88119,33.97933],[71.07345,34.06242],[71.06933,34.10564],[71.09307,34.11961],[71.09453,34.13524],[71.13078,34.16503],[71.12815,34.26619],[71.17662,34.36769],[71.02401,34.44835],[71.0089,34.54568],[71.11602,34.63047],[71.08718,34.69034],[71.28356,34.80882],[71.29472,34.87728],[71.50329,34.97328],[71.49917,35.00478],[71.55273,35.02615],[71.52938,35.09023],[71.67495,35.21262],[71.5541,35.28776],[71.54294,35.31037],[71.65435,35.4479],[71.49917,35.6267],[71.55273,35.71483],[71.37969,35.95865],[71.19505,36.04134],[71.60491,36.39429],[71.80267,36.49924],[72.18135,36.71838],[72.6323,36.84601],[73.82685,36.91421],[74.04856,36.82648],[74.43389,37.00977],[74.53739,36.96224],[74.56453,37.03023],[74.49981,37.24518],[74.80605,37.21565],[74.88887,37.23275],[74.8294,37.3435],[74.68383,37.3948],[74.56161,37.37734],[74.41055,37.3948],[74.23339,37.41116],[74.20308,37.34208],[73.8564,37.26158],[73.82552,37.22659],[73.64974,37.23643],[73.61129,37.27469],[73.76647,37.33913],[73.77197,37.4417],[73.29633,37.46495],[73.06884,37.31729],[72.79693,37.22222],[72.66381,37.02014],[72.54095,37.00007],[72.31676,36.98115],[71.83229,36.68084],[71.67083,36.67346],[71.57195,36.74943],[71.51502,36.89128],[71.48481,36.93218],[71.46923,36.99925],[71.45578,37.03094],[71.43097,37.05855],[71.44127,37.11856],[71.4494,37.18137],[71.4555,37.21418],[71.47386,37.2269],[71.48339,37.23937],[71.4824,37.24921],[71.48536,37.26017],[71.50674,37.31502],[71.49821,37.31975],[71.4862,37.33405],[71.47685,37.40281],[71.49612,37.4279],[71.5256,37.47971],[71.50616,37.50733],[71.49693,37.53527],[71.5065,37.60912],[71.51972,37.61945],[71.54186,37.69691],[71.55234,37.73209],[71.53053,37.76534],[71.54324,37.77104],[71.55752,37.78677],[71.59255,37.79956],[71.58843,37.92425],[71.51565,37.95349],[71.32871,37.88564],[71.296,37.93403],[71.2809,37.91995],[71.24969,37.93031],[71.27278,37.96496],[71.27622,37.99946],[71.28922,38.01272],[71.29878,38.04429],[71.36444,38.15358],[71.37803,38.25641],[71.33869,38.27335],[71.33114,38.30339],[71.21291,38.32797],[71.1451,38.40106],[71.10957,38.40671],[71.10592,38.42077],[71.09542,38.42517],[71.0556,38.40176],[71.03545,38.44779],[70.98693,38.48862],[70.92728,38.43021],[70.88719,38.46826],[70.84376,38.44688],[70.82538,38.45394],[70.81697,38.44507],[70.80521,38.44447],[70.79766,38.44944],[70.78702,38.45031],[70.78581,38.45502],[70.77132,38.45548],[70.75455,38.4252],[70.72485,38.4131],[70.69807,38.41861],[70.67438,38.40597],[70.6761,38.39144],[70.69189,38.37031],[70.64966,38.34999],[70.61526,38.34774]]]]}},{type:"Feature",properties:{iso1A2:"AG",iso1A3:"ATG",iso1N3:"028",wikidata:"Q781",nameEn:"Antigua and Barbuda",groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 268"]},geometry:{type:"MultiPolygon",coordinates:[[[[-61.66959,18.6782],[-62.58307,16.68909],[-62.1023,16.97277],[-61.23098,16.62484],[-61.66959,18.6782]]]]}},{type:"Feature",properties:{iso1A2:"AI",iso1A3:"AIA",iso1N3:"660",wikidata:"Q25228",nameEn:"Anguilla",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 264"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.79029,19.11219],[-63.35989,18.06012],[-62.62718,18.26185],[-63.79029,19.11219]]]]}},{type:"Feature",properties:{iso1A2:"AL",iso1A3:"ALB",iso1N3:"008",wikidata:"Q222",nameEn:"Albania",groups:["039","150","UN"],callingCodes:["355"]},geometry:{type:"MultiPolygon",coordinates:[[[[20.07761,42.55582],[20.01834,42.54622],[20.00842,42.5109],[19.9324,42.51699],[19.82333,42.46581],[19.76549,42.50237],[19.74731,42.57422],[19.77375,42.58517],[19.73244,42.66299],[19.65972,42.62774],[19.4836,42.40831],[19.42352,42.36546],[19.42,42.33019],[19.28623,42.17745],[19.40687,42.10024],[19.37548,42.06835],[19.36867,42.02564],[19.37691,41.96977],[19.34601,41.95675],[19.33812,41.90669],[19.37451,41.8842],[19.37597,41.84849],[19.26406,41.74971],[19.0384,40.35325],[19.95905,39.82857],[19.97622,39.78684],[19.92466,39.69533],[19.98042,39.6504],[20.00957,39.69227],[20.05189,39.69112],[20.12956,39.65805],[20.15988,39.652],[20.22376,39.64532],[20.22707,39.67459],[20.27412,39.69884],[20.31961,39.72799],[20.29152,39.80421],[20.30804,39.81563],[20.38572,39.78516],[20.41475,39.81437],[20.41546,39.82832],[20.31135,39.99438],[20.37911,39.99058],[20.42373,40.06777],[20.48487,40.06271],[20.51297,40.08168],[20.55593,40.06524],[20.61081,40.07866],[20.62566,40.0897],[20.67162,40.09433],[20.71789,40.27739],[20.78234,40.35803],[20.7906,40.42726],[20.83688,40.47882],[20.94925,40.46625],[20.96908,40.51526],[21.03932,40.56299],[21.05833,40.66586],[20.98134,40.76046],[20.95752,40.76982],[20.98396,40.79109],[20.97887,40.85475],[20.97693,40.90103],[20.94305,40.92399],[20.83671,40.92752],[20.81567,40.89662],[20.73504,40.9081],[20.71634,40.91781],[20.65558,41.08009],[20.63454,41.0889],[20.59832,41.09066],[20.58546,41.11179],[20.59715,41.13644],[20.51068,41.2323],[20.49432,41.33679],[20.52119,41.34381],[20.55976,41.4087],[20.51301,41.442],[20.49039,41.49277],[20.45331,41.51436],[20.45809,41.5549],[20.52103,41.56473],[20.55508,41.58113],[20.51769,41.65975],[20.52937,41.69292],[20.51301,41.72433],[20.53405,41.78099],[20.57144,41.7897],[20.55976,41.87068],[20.59524,41.8818],[20.57946,41.91593],[20.63069,41.94913],[20.59434,42.03879],[20.55633,42.08173],[20.56955,42.12097],[20.48857,42.25444],[20.3819,42.3029],[20.34479,42.32656],[20.24399,42.32168],[20.21797,42.41237],[20.17127,42.50469],[20.07761,42.55582]]]]}},{type:"Feature",properties:{iso1A2:"AM",iso1A3:"ARM",iso1N3:"051",wikidata:"Q399",nameEn:"Armenia",groups:["145","142","UN"],callingCodes:["374"]},geometry:{type:"MultiPolygon",coordinates:[[[[45.0133,41.29747],[44.93493,41.25685],[44.81437,41.30371],[44.80053,41.25949],[44.81749,41.23488],[44.84358,41.23088],[44.89911,41.21366],[44.87887,41.20195],[44.82084,41.21513],[44.72814,41.20338],[44.61462,41.24018],[44.59322,41.1933],[44.46791,41.18204],[44.34417,41.2382],[44.34337,41.20312],[44.32139,41.2079],[44.18148,41.24644],[44.16591,41.19141],[43.84835,41.16329],[43.74717,41.1117],[43.67712,41.13398],[43.4717,41.12611],[43.44984,41.0988],[43.47319,41.02251],[43.58683,40.98961],[43.67712,40.93084],[43.67712,40.84846],[43.74872,40.7365],[43.7425,40.66805],[43.63664,40.54159],[43.54791,40.47413],[43.60862,40.43267],[43.59928,40.34019],[43.71136,40.16673],[43.65221,40.14889],[43.65688,40.11199],[43.92307,40.01787],[44.1057,40.03555],[44.1778,40.02845],[44.26973,40.04866],[44.46635,39.97733],[44.61845,39.8281],[44.75779,39.7148],[44.88354,39.74432],[44.92869,39.72157],[45.06604,39.79277],[45.18554,39.67846],[45.17464,39.58614],[45.21784,39.58074],[45.23535,39.61373],[45.30385,39.61373],[45.29606,39.57654],[45.46992,39.49888],[45.70547,39.60174],[45.80804,39.56716],[45.83,39.46487],[45.79225,39.3695],[45.99774,39.28931],[46.02303,39.09978],[46.06973,39.0744],[46.14785,38.84206],[46.20601,38.85262],[46.34059,38.92076],[46.53497,38.86548],[46.51805,38.94982],[46.54296,39.07078],[46.44022,39.19636],[46.52584,39.18912],[46.54141,39.15895],[46.58032,39.21204],[46.63481,39.23013],[46.56476,39.24942],[46.50093,39.33736],[46.43244,39.35181],[46.37795,39.42039],[46.4013,39.45405],[46.53051,39.47809],[46.51027,39.52373],[46.57721,39.54414],[46.57098,39.56694],[46.52117,39.58734],[46.42465,39.57534],[46.40286,39.63651],[46.18493,39.60533],[45.96543,39.78859],[45.82533,39.82925],[45.7833,39.9475],[45.60895,39.97733],[45.59806,40.0131],[45.78642,40.03218],[45.83779,39.98925],[45.97944,40.181],[45.95609,40.27846],[45.65098,40.37696],[45.42994,40.53804],[45.45484,40.57707],[45.35366,40.65979],[45.4206,40.7424],[45.55914,40.78366],[45.60584,40.87436],[45.40814,40.97904],[45.44083,41.01663],[45.39725,41.02603],[45.35677,40.99784],[45.28859,41.03757],[45.26162,41.0228],[45.25897,41.0027],[45.1994,41.04518],[45.16493,41.05068],[45.1634,41.08082],[45.1313,41.09369],[45.12923,41.06059],[45.06784,41.05379],[45.08028,41.10917],[45.19942,41.13299],[45.1969,41.168],[45.11811,41.19967],[45.05201,41.19211],[45.02932,41.2101],[45.05497,41.2464],[45.0133,41.29747]],[[45.21324,40.9817],[45.21219,40.99001],[45.20518,40.99348],[45.19312,40.98998],[45.18382,41.0066],[45.20625,41.01484],[45.23487,41.00226],[45.23095,40.97828],[45.21324,40.9817]],[[45.00864,41.03411],[44.9903,41.05657],[44.96031,41.06345],[44.95383,41.07553],[44.97169,41.09176],[45.00864,41.09407],[45.03406,41.07931],[45.04517,41.06653],[45.03792,41.03938],[45.00864,41.03411]]],[[[45.50279,40.58424],[45.56071,40.64765],[45.51825,40.67382],[45.47927,40.65023],[45.50279,40.58424]]]]}},{type:"Feature",properties:{iso1A2:"AO",iso1A3:"AGO",iso1N3:"024",wikidata:"Q916",nameEn:"Angola",groups:["017","202","002","UN"],callingCodes:["244"]},geometry:{type:"MultiPolygon",coordinates:[[[[16.55507,-5.85631],[13.04371,-5.87078],[12.42245,-6.07585],[11.95767,-5.94705],[12.20376,-5.76338],[12.26557,-5.74031],[12.52318,-5.74353],[12.52301,-5.17481],[12.53599,-5.1618],[12.53586,-5.14658],[12.51589,-5.1332],[12.49815,-5.14058],[12.46297,-5.09408],[12.60251,-5.01715],[12.63465,-4.94632],[12.70868,-4.95505],[12.8733,-4.74346],[13.11195,-4.67745],[13.09648,-4.63739],[12.91489,-4.47907],[12.87096,-4.40315],[12.76844,-4.38709],[12.64835,-4.55937],[12.40964,-4.60609],[12.32324,-4.78415],[12.25587,-4.79437],[12.20901,-4.75642],[12.16068,-4.90089],[12.00924,-5.02627],[11.50888,-5.33417],[10.5065,-17.25284],[11.75063,-17.25013],[12.07076,-17.15165],[12.52111,-17.24495],[12.97145,-16.98567],[13.36212,-16.98048],[13.95896,-17.43141],[14.28743,-17.38814],[18.39229,-17.38927],[18.84226,-17.80375],[21.14283,-17.94318],[21.42741,-18.02787],[23.47474,-17.62877],[23.20038,-17.47563],[22.17217,-16.50269],[22.00323,-16.18028],[21.97988,-13.00148],[24.03339,-12.99091],[23.90937,-12.844],[24.06672,-12.29058],[23.98804,-12.13149],[24.02603,-11.15368],[24.00027,-10.89356],[23.86868,-11.02856],[23.45631,-10.946],[23.16602,-11.10577],[22.54205,-11.05784],[22.25951,-11.24911],[22.17954,-10.85884],[22.32604,-10.76291],[22.19039,-9.94628],[21.84856,-9.59871],[21.79824,-7.29628],[20.56263,-7.28566],[20.61689,-6.90876],[20.31846,-6.91953],[20.30218,-6.98955],[19.5469,-7.00195],[19.33698,-7.99743],[18.33635,-8.00126],[17.5828,-8.13784],[16.96282,-7.21787],[16.55507,-5.85631]]]]}},{type:"Feature",properties:{iso1A2:"AQ",iso1A3:"ATA",iso1N3:"010",wikidata:"Q51",nameEn:"Antarctica",level:"region",callingCodes:["672"]},geometry:{type:"MultiPolygon",coordinates:[[[[180,-60],[-180,-60],[-180,-90],[180,-90],[180,-60]]]]}},{type:"Feature",properties:{iso1A2:"AR",iso1A3:"ARG",iso1N3:"032",wikidata:"Q414",nameEn:"Argentina",aliases:["RA"],groups:["005","419","019","UN"],callingCodes:["54"]},geometry:{type:"MultiPolygon",coordinates:[[[[-72.31343,-50.58411],[-72.33873,-51.59954],[-71.99889,-51.98018],[-69.97824,-52.00845],[-68.41683,-52.33516],[-68.60702,-52.65781],[-68.60733,-54.9125],[-68.01394,-54.8753],[-67.46182,-54.92205],[-67.11046,-54.94199],[-66.07313,-55.19618],[-63.67376,-55.11859],[-54.78916,-36.21945],[-57.83001,-34.69099],[-58.34425,-34.15035],[-58.44442,-33.84033],[-58.40475,-33.11777],[-58.1224,-32.98842],[-58.22362,-32.52416],[-58.10036,-32.25338],[-58.20252,-31.86966],[-58.00076,-31.65016],[-58.0023,-31.53084],[-58.07569,-31.44916],[-57.98127,-31.3872],[-57.9908,-31.34924],[-57.86729,-31.06352],[-57.89476,-30.95994],[-57.8024,-30.77193],[-57.89115,-30.49572],[-57.64859,-30.35095],[-57.61478,-30.25165],[-57.65132,-30.19229],[-57.09386,-29.74211],[-56.81251,-29.48154],[-56.62789,-29.18073],[-56.57295,-29.11357],[-56.54171,-29.11447],[-56.05265,-28.62651],[-56.00458,-28.60421],[-56.01729,-28.51223],[-55.65418,-28.18304],[-55.6262,-28.17124],[-55.33303,-27.94661],[-55.16872,-27.86224],[-55.1349,-27.89759],[-54.90805,-27.73149],[-54.90159,-27.63132],[-54.67657,-27.57214],[-54.50416,-27.48232],[-54.41888,-27.40882],[-54.19268,-27.30751],[-54.19062,-27.27639],[-54.15978,-27.2889],[-53.80144,-27.09844],[-53.73372,-26.6131],[-53.68269,-26.33359],[-53.64505,-26.28089],[-53.64186,-26.25976],[-53.64632,-26.24798],[-53.63881,-26.25075],[-53.63739,-26.2496],[-53.65237,-26.23289],[-53.65018,-26.19501],[-53.73968,-26.10012],[-53.73391,-26.07006],[-53.7264,-26.0664],[-53.73086,-26.05842],[-53.73511,-26.04211],[-53.83691,-25.94849],[-53.90831,-25.55513],[-54.52926,-25.62846],[-54.5502,-25.58915],[-54.59398,-25.59224],[-54.62063,-25.91213],[-54.60664,-25.9691],[-54.67359,-25.98607],[-54.69333,-26.37705],[-54.70732,-26.45099],[-54.80868,-26.55669],[-55.00584,-26.78754],[-55.06351,-26.80195],[-55.16948,-26.96068],[-55.25243,-26.93808],[-55.39611,-26.97679],[-55.62322,-27.1941],[-55.59094,-27.32444],[-55.74475,-27.44485],[-55.89195,-27.3467],[-56.18313,-27.29851],[-56.85337,-27.5165],[-58.04205,-27.2387],[-58.59549,-27.29973],[-58.65321,-27.14028],[-58.3198,-26.83443],[-58.1188,-26.16704],[-57.87176,-25.93604],[-57.57431,-25.47269],[-57.80821,-25.13863],[-58.25492,-24.92528],[-58.33055,-24.97099],[-59.33886,-24.49935],[-59.45482,-24.34787],[-60.03367,-24.00701],[-60.28163,-24.04436],[-60.99754,-23.80934],[-61.0782,-23.62932],[-61.9756,-23.0507],[-62.22768,-22.55807],[-62.51761,-22.37684],[-62.64455,-22.25091],[-62.8078,-22.12534],[-62.81124,-21.9987],[-63.66482,-21.99918],[-63.68113,-22.0544],[-63.70963,-21.99934],[-63.93287,-21.99934],[-64.22918,-22.55807],[-64.31489,-22.88824],[-64.35108,-22.73282],[-64.4176,-22.67692],[-64.58888,-22.25035],[-64.67174,-22.18957],[-64.90014,-22.12136],[-64.99524,-22.08255],[-65.47435,-22.08908],[-65.57743,-22.07675],[-65.58694,-22.09794],[-65.61166,-22.09504],[-65.7467,-22.10105],[-65.9261,-21.93335],[-66.04832,-21.9187],[-66.03836,-21.84829],[-66.24077,-21.77837],[-66.29714,-22.08741],[-66.7298,-22.23644],[-67.18382,-22.81525],[-66.99632,-22.99839],[-67.33563,-24.04237],[-68.24825,-24.42596],[-68.56909,-24.69831],[-68.38372,-25.08636],[-68.57622,-25.32505],[-68.38372,-26.15353],[-68.56909,-26.28146],[-68.59048,-26.49861],[-68.27677,-26.90626],[-68.43363,-27.08414],[-68.77586,-27.16029],[-69.22504,-27.95042],[-69.66709,-28.44055],[-69.80969,-29.07185],[-69.99507,-29.28351],[-69.8596,-30.26131],[-70.14479,-30.36595],[-70.55832,-31.51559],[-69.88099,-33.34489],[-69.87386,-34.13344],[-70.49416,-35.24145],[-70.38008,-36.02375],[-70.95047,-36.4321],[-71.24279,-37.20264],[-70.89532,-38.6923],[-71.37826,-38.91474],[-71.92726,-40.72714],[-71.74901,-42.11711],[-72.15541,-42.15941],[-72.14828,-42.85321],[-71.64206,-43.64774],[-71.81318,-44.38097],[-71.16436,-44.46244],[-71.26418,-44.75684],[-72.06985,-44.81756],[-71.35687,-45.22075],[-71.75614,-45.61611],[-71.68577,-46.55385],[-71.94152,-47.13595],[-72.50478,-47.80586],[-72.27662,-48.28727],[-72.54042,-48.52392],[-72.56894,-48.81116],[-73.09655,-49.14342],[-73.45156,-49.79461],[-73.55259,-49.92488],[-73.15765,-50.78337],[-72.31343,-50.58411]]]]}},{type:"Feature",properties:{iso1A2:"AS",iso1A3:"ASM",iso1N3:"016",wikidata:"Q16641",nameEn:"American Samoa",aliases:["US-AS"],country:"US",groups:["Q1352230","061","009","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 684"]},geometry:{type:"MultiPolygon",coordinates:[[[[-171.39864,-10.21587],[-170.99605,-15.1275],[-166.32598,-15.26169],[-171.39864,-10.21587]]]]}},{type:"Feature",properties:{iso1A2:"AT",iso1A3:"AUT",iso1N3:"040",wikidata:"Q40",nameEn:"Austria",groups:["EU","155","150","UN"],callingCodes:["43"]},geometry:{type:"MultiPolygon",coordinates:[[[[15.34823,48.98444],[15.28305,48.98831],[15.26177,48.95766],[15.16358,48.94278],[15.15534,48.99056],[14.99878,49.01444],[14.97612,48.96983],[14.98917,48.90082],[14.95072,48.79101],[14.98032,48.77959],[14.9782,48.7766],[14.98112,48.77524],[14.9758,48.76857],[14.95641,48.75915],[14.94773,48.76268],[14.81545,48.7874],[14.80821,48.77711],[14.80584,48.73489],[14.72756,48.69502],[14.71794,48.59794],[14.66762,48.58215],[14.60808,48.62881],[14.56139,48.60429],[14.4587,48.64695],[14.43076,48.58855],[14.33909,48.55852],[14.20691,48.5898],[14.09104,48.5943],[14.01482,48.63788],[14.06151,48.66873],[13.84023,48.76988],[13.82266,48.75544],[13.81863,48.73257],[13.79337,48.71375],[13.81791,48.69832],[13.81283,48.68426],[13.81901,48.6761],[13.82609,48.62345],[13.80038,48.59487],[13.80519,48.58026],[13.76921,48.55324],[13.7513,48.5624],[13.74816,48.53058],[13.72802,48.51208],[13.66113,48.53558],[13.65186,48.55092],[13.62508,48.55501],[13.59705,48.57013],[13.57535,48.55912],[13.51291,48.59023],[13.50131,48.58091],[13.50663,48.57506],[13.46967,48.55157],[13.45214,48.56472],[13.43695,48.55776],[13.45727,48.51092],[13.42527,48.45711],[13.43929,48.43386],[13.40709,48.37292],[13.30897,48.31575],[13.26039,48.29422],[13.18093,48.29577],[13.126,48.27867],[13.0851,48.27711],[13.02083,48.25689],[12.95306,48.20629],[12.87126,48.20318],[12.84475,48.16556],[12.836,48.1647],[12.8362,48.15876],[12.82673,48.15245],[12.80676,48.14979],[12.78595,48.12445],[12.7617,48.12796],[12.74973,48.10885],[12.76141,48.07373],[12.8549,48.01122],[12.87476,47.96195],[12.91683,47.95647],[12.9211,47.95135],[12.91985,47.94069],[12.92668,47.93879],[12.93419,47.94063],[12.93642,47.94436],[12.93886,47.94046],[12.94163,47.92927],[13.00588,47.84374],[12.98543,47.82896],[12.96311,47.79957],[12.93202,47.77302],[12.94371,47.76281],[12.9353,47.74788],[12.91711,47.74026],[12.90274,47.72513],[12.91333,47.7178],[12.92969,47.71094],[12.98578,47.7078],[13.01382,47.72116],[13.07692,47.68814],[13.09562,47.63304],[13.06407,47.60075],[13.06641,47.58577],[13.04537,47.58183],[13.05355,47.56291],[13.03252,47.53373],[13.04537,47.49426],[12.9998,47.46267],[12.98344,47.48716],[12.9624,47.47452],[12.85256,47.52741],[12.84672,47.54556],[12.80699,47.54477],[12.77427,47.58025],[12.82101,47.61493],[12.76492,47.64485],[12.77777,47.66689],[12.7357,47.6787],[12.6071,47.6741],[12.57438,47.63238],[12.53816,47.63553],[12.50076,47.62293],[12.44117,47.6741],[12.43883,47.6977],[12.37222,47.68433],[12.336,47.69534],[12.27991,47.68827],[12.26004,47.67725],[12.24017,47.69534],[12.26238,47.73544],[12.2542,47.7433],[12.22571,47.71776],[12.18303,47.70065],[12.16217,47.70105],[12.16769,47.68167],[12.18347,47.66663],[12.18507,47.65984],[12.19895,47.64085],[12.20801,47.61082],[12.20398,47.60667],[12.18568,47.6049],[12.17737,47.60121],[12.18145,47.61019],[12.17824,47.61506],[12.13734,47.60639],[12.05788,47.61742],[12.02282,47.61033],[12.0088,47.62451],[11.85572,47.60166],[11.84052,47.58354],[11.63934,47.59202],[11.60681,47.57881],[11.58811,47.55515],[11.58578,47.52281],[11.52618,47.50939],[11.4362,47.51413],[11.38128,47.47465],[11.4175,47.44621],[11.33804,47.44937],[11.29597,47.42566],[11.27844,47.39956],[11.22002,47.3964],[11.25157,47.43277],[11.20482,47.43198],[11.12536,47.41222],[11.11835,47.39719],[10.97111,47.39561],[10.97111,47.41617],[10.98513,47.42882],[10.92437,47.46991],[10.93839,47.48018],[10.90918,47.48571],[10.87061,47.4786],[10.86945,47.5015],[10.91268,47.51334],[10.88814,47.53701],[10.77596,47.51729],[10.7596,47.53228],[10.6965,47.54253],[10.68832,47.55752],[10.63456,47.5591],[10.60337,47.56755],[10.56912,47.53584],[10.48849,47.54057],[10.47329,47.58552],[10.43473,47.58394],[10.44992,47.5524],[10.4324,47.50111],[10.44291,47.48453],[10.46278,47.47901],[10.47446,47.43318],[10.4359,47.41183],[10.4324,47.38494],[10.39851,47.37623],[10.33424,47.30813],[10.23257,47.27088],[10.17531,47.27167],[10.17648,47.29149],[10.2147,47.31014],[10.19998,47.32832],[10.23757,47.37609],[10.22774,47.38904],[10.2127,47.38019],[10.17648,47.38889],[10.16362,47.36674],[10.11805,47.37228],[10.09819,47.35724],[10.06897,47.40709],[10.1052,47.4316],[10.09001,47.46005],[10.07131,47.45531],[10.03859,47.48927],[10.00003,47.48216],[9.96029,47.53899],[9.92407,47.53111],[9.87733,47.54688],[9.87499,47.52953],[9.8189,47.54688],[9.82591,47.58158],[9.80254,47.59419],[9.76748,47.5934],[9.72736,47.53457],[9.55125,47.53629],[9.56312,47.49495],[9.58208,47.48344],[9.59482,47.46305],[9.60205,47.46165],[9.60484,47.46358],[9.60841,47.47178],[9.62158,47.45858],[9.62475,47.45685],[9.6423,47.45599],[9.65728,47.45383],[9.65863,47.44847],[9.64483,47.43842],[9.6446,47.43233],[9.65043,47.41937],[9.65136,47.40504],[9.6629,47.39591],[9.67334,47.39191],[9.67445,47.38429],[9.6711,47.37824],[9.66243,47.37136],[9.65427,47.36824],[9.62476,47.36639],[9.59978,47.34671],[9.58513,47.31334],[9.55857,47.29919],[9.54773,47.2809],[9.53116,47.27029],[9.56766,47.24281],[9.55176,47.22585],[9.56981,47.21926],[9.58264,47.20673],[9.56539,47.17124],[9.62623,47.14685],[9.63395,47.08443],[9.61216,47.07732],[9.60717,47.06091],[9.87935,47.01337],[9.88266,46.93343],[9.98058,46.91434],[10.10715,46.84296],[10.22675,46.86942],[10.24128,46.93147],[10.30031,46.92093],[10.36933,47.00212],[10.48376,46.93891],[10.47197,46.85698],[10.54783,46.84505],[10.66405,46.87614],[10.75753,46.82258],[10.72974,46.78972],[11.00764,46.76896],[11.10618,46.92966],[11.33355,46.99862],[11.50739,47.00644],[11.74789,46.98484],[12.19254,47.09331],[12.21781,47.03996],[12.11675,47.01241],[12.2006,46.88854],[12.27591,46.88651],[12.38708,46.71529],[12.59992,46.6595],[12.94445,46.60401],[13.27627,46.56059],[13.64088,46.53438],[13.7148,46.5222],[13.89837,46.52331],[14.00422,46.48474],[14.04002,46.49117],[14.12097,46.47724],[14.15989,46.43327],[14.28326,46.44315],[14.314,46.43327],[14.42608,46.44614],[14.45877,46.41717],[14.52176,46.42617],[14.56463,46.37208],[14.5942,46.43434],[14.66892,46.44936],[14.72185,46.49974],[14.81836,46.51046],[14.83549,46.56614],[14.86419,46.59411],[14.87129,46.61],[14.92283,46.60848],[14.96002,46.63459],[14.98024,46.6009],[15.01451,46.641],[15.14215,46.66131],[15.23711,46.63994],[15.41235,46.65556],[15.45514,46.63697],[15.46906,46.61321],[15.54431,46.6312],[15.55333,46.64988],[15.54533,46.66985],[15.59826,46.68908],[15.62317,46.67947],[15.63255,46.68069],[15.6365,46.6894],[15.6543,46.69228],[15.6543,46.70616],[15.67411,46.70735],[15.69523,46.69823],[15.72279,46.69548],[15.73823,46.70011],[15.76771,46.69863],[15.78518,46.70712],[15.8162,46.71897],[15.87691,46.7211],[15.94864,46.68769],[15.98512,46.68463],[15.99988,46.67947],[16.04036,46.6549],[16.04347,46.68694],[16.02808,46.71094],[15.99769,46.7266],[15.98432,46.74991],[15.99126,46.78199],[15.99054,46.82772],[16.05786,46.83927],[16.10983,46.867],[16.19904,46.94134],[16.22403,46.939],[16.27594,46.9643],[16.28202,47.00159],[16.51369,47.00084],[16.43936,47.03548],[16.52176,47.05747],[16.46134,47.09395],[16.52863,47.13974],[16.44932,47.14418],[16.46442,47.16845],[16.4523,47.18812],[16.42801,47.18422],[16.41739,47.20649],[16.43663,47.21127],[16.44142,47.25079],[16.47782,47.25918],[16.45104,47.41181],[16.49908,47.39416],[16.52414,47.41007],[16.57152,47.40868],[16.6718,47.46139],[16.64821,47.50155],[16.71059,47.52692],[16.64193,47.63114],[16.58699,47.61772],[16.4222,47.66537],[16.55129,47.72268],[16.53514,47.73837],[16.54779,47.75074],[16.61183,47.76171],[16.65679,47.74197],[16.72089,47.73469],[16.7511,47.67878],[16.82938,47.68432],[16.86509,47.72268],[16.87538,47.68895],[17.08893,47.70928],[17.05048,47.79377],[17.07039,47.81129],[17.00997,47.86245],[17.08275,47.87719],[17.11022,47.92461],[17.09786,47.97336],[17.16001,48.00636],[17.07039,48.0317],[17.09168,48.09366],[17.05735,48.14179],[17.02919,48.13996],[16.97701,48.17385],[16.89461,48.31332],[16.90903,48.32519],[16.84243,48.35258],[16.83317,48.38138],[16.83588,48.3844],[16.8497,48.38321],[16.85204,48.44968],[16.94611,48.53614],[16.93955,48.60371],[16.90354,48.71541],[16.79779,48.70998],[16.71883,48.73806],[16.68518,48.7281],[16.67008,48.77699],[16.46134,48.80865],[16.40915,48.74576],[16.37345,48.729],[16.06034,48.75436],[15.84404,48.86921],[15.78087,48.87644],[15.75341,48.8516],[15.6921,48.85973],[15.61622,48.89541],[15.51357,48.91549],[15.48027,48.94481],[15.34823,48.98444]]]]}},{type:"Feature",properties:{iso1A2:"AU",iso1A3:"AUS",iso1N3:"036",wikidata:"Q408",nameEn:"Australia"},geometry:null},{type:"Feature",properties:{iso1A2:"AW",iso1A3:"ABW",iso1N3:"533",wikidata:"Q21203",nameEn:"Aruba",aliases:["NL-AW"],country:"NL",groups:["Q1451600","029","003","419","019","UN"],callingCodes:["297"]},geometry:{type:"MultiPolygon",coordinates:[[[[-70.00823,12.98375],[-70.35625,12.58277],[-69.60231,12.17],[-70.00823,12.98375]]]]}},{type:"Feature",properties:{iso1A2:"AX",iso1A3:"ALA",iso1N3:"248",wikidata:"Q5689",nameEn:"\xC5land Islands",country:"FI",groups:["EU","154","150","UN"],callingCodes:["358 18","358 457"]},geometry:{type:"MultiPolygon",coordinates:[[[[19.08191,60.19152],[20.5104,59.15546],[21.35468,59.67511],[21.02509,60.12142],[21.08159,60.20167],[21.15143,60.54555],[20.96741,60.71528],[19.23413,60.61414],[19.08191,60.19152]]]]}},{type:"Feature",properties:{iso1A2:"AZ",iso1A3:"AZE",iso1N3:"031",wikidata:"Q227",nameEn:"Azerbaijan",groups:["145","142","UN"],callingCodes:["994"]},geometry:{type:"MultiPolygon",coordinates:[[[[46.42738,41.91323],[46.3984,41.84399],[46.30863,41.79133],[46.23962,41.75811],[46.20538,41.77205],[46.17891,41.72094],[46.19759,41.62327],[46.24429,41.59883],[46.26531,41.63339],[46.28182,41.60089],[46.3253,41.60912],[46.34039,41.5947],[46.34126,41.57454],[46.29794,41.5724],[46.33925,41.4963],[46.40307,41.48464],[46.4669,41.43331],[46.63658,41.37727],[46.72375,41.28609],[46.66148,41.20533],[46.63969,41.09515],[46.55096,41.1104],[46.48558,41.0576],[46.456,41.09984],[46.37661,41.10805],[46.27698,41.19011],[46.13221,41.19479],[45.95786,41.17956],[45.80842,41.2229],[45.69946,41.29545],[45.75705,41.35157],[45.71035,41.36208],[45.68389,41.3539],[45.45973,41.45898],[45.4006,41.42402],[45.31352,41.47168],[45.26285,41.46433],[45.1797,41.42231],[45.09867,41.34065],[45.0133,41.29747],[45.05497,41.2464],[45.02932,41.2101],[45.05201,41.19211],[45.11811,41.19967],[45.1969,41.168],[45.19942,41.13299],[45.08028,41.10917],[45.06784,41.05379],[45.12923,41.06059],[45.1313,41.09369],[45.1634,41.08082],[45.16493,41.05068],[45.1994,41.04518],[45.25897,41.0027],[45.26162,41.0228],[45.28859,41.03757],[45.35677,40.99784],[45.39725,41.02603],[45.44083,41.01663],[45.40814,40.97904],[45.60584,40.87436],[45.55914,40.78366],[45.4206,40.7424],[45.35366,40.65979],[45.45484,40.57707],[45.42994,40.53804],[45.65098,40.37696],[45.95609,40.27846],[45.97944,40.181],[45.83779,39.98925],[45.78642,40.03218],[45.59806,40.0131],[45.60895,39.97733],[45.7833,39.9475],[45.82533,39.82925],[45.96543,39.78859],[46.18493,39.60533],[46.40286,39.63651],[46.42465,39.57534],[46.52117,39.58734],[46.57098,39.56694],[46.57721,39.54414],[46.51027,39.52373],[46.53051,39.47809],[46.4013,39.45405],[46.37795,39.42039],[46.43244,39.35181],[46.50093,39.33736],[46.56476,39.24942],[46.63481,39.23013],[46.58032,39.21204],[46.54141,39.15895],[46.52584,39.18912],[46.44022,39.19636],[46.54296,39.07078],[46.51805,38.94982],[46.53497,38.86548],[46.75752,39.03231],[46.83822,39.13143],[46.92539,39.16644],[46.95341,39.13505],[47.05771,39.20143],[47.05927,39.24846],[47.31301,39.37492],[47.38978,39.45999],[47.50099,39.49615],[47.84774,39.66285],[47.98977,39.70999],[48.34264,39.42935],[48.37385,39.37584],[48.15984,39.30028],[48.12404,39.25208],[48.15361,39.19419],[48.31239,39.09278],[48.33884,39.03022],[48.28437,38.97186],[48.08627,38.94434],[48.07734,38.91616],[48.01409,38.90333],[48.02581,38.82705],[48.24773,38.71883],[48.3146,38.59958],[48.45084,38.61013],[48.58793,38.45076],[48.62217,38.40198],[48.70001,38.40564],[48.78979,38.45026],[48.81072,38.44853],[48.84969,38.45015],[48.88288,38.43975],[52.39847,39.43556],[48.80971,41.95365],[48.5867,41.84306],[48.55078,41.77917],[48.42301,41.65444],[48.40277,41.60441],[48.2878,41.56221],[48.22064,41.51472],[48.07587,41.49957],[47.87973,41.21798],[47.75831,41.19455],[47.62288,41.22969],[47.54504,41.20275],[47.49004,41.26366],[47.34579,41.27884],[47.10762,41.59044],[47.03757,41.55434],[46.99554,41.59743],[47.00955,41.63583],[46.8134,41.76252],[46.75269,41.8623],[46.58924,41.80547],[46.5332,41.87389],[46.42738,41.91323]],[[45.50279,40.58424],[45.47927,40.65023],[45.51825,40.67382],[45.56071,40.64765],[45.50279,40.58424]]],[[[45.00864,41.03411],[45.03792,41.03938],[45.04517,41.06653],[45.03406,41.07931],[45.00864,41.09407],[44.97169,41.09176],[44.95383,41.07553],[44.96031,41.06345],[44.9903,41.05657],[45.00864,41.03411]]],[[[45.21324,40.9817],[45.23095,40.97828],[45.23487,41.00226],[45.20625,41.01484],[45.18382,41.0066],[45.19312,40.98998],[45.20518,40.99348],[45.21219,40.99001],[45.21324,40.9817]]],[[[45.46992,39.49888],[45.29606,39.57654],[45.30385,39.61373],[45.23535,39.61373],[45.21784,39.58074],[45.17464,39.58614],[45.18554,39.67846],[45.06604,39.79277],[44.92869,39.72157],[44.88354,39.74432],[44.75779,39.7148],[44.80977,39.65768],[44.81043,39.62677],[44.88916,39.59653],[44.96746,39.42998],[45.05932,39.36435],[45.08751,39.35052],[45.16168,39.21952],[45.30489,39.18333],[45.40148,39.09007],[45.40452,39.07224],[45.44811,39.04927],[45.44966,38.99243],[45.6131,38.964],[45.6155,38.94304],[45.65172,38.95199],[45.83883,38.90768],[45.90266,38.87739],[45.94624,38.89072],[46.00228,38.87376],[46.06766,38.87861],[46.14785,38.84206],[46.06973,39.0744],[46.02303,39.09978],[45.99774,39.28931],[45.79225,39.3695],[45.83,39.46487],[45.80804,39.56716],[45.70547,39.60174],[45.46992,39.49888]]]]}},{type:"Feature",properties:{iso1A2:"BA",iso1A3:"BIH",iso1N3:"070",wikidata:"Q225",nameEn:"Bosnia and Herzegovina",groups:["039","150","UN"],callingCodes:["387"]},geometry:{type:"MultiPolygon",coordinates:[[[[17.84826,45.04489],[17.66571,45.13408],[17.59104,45.10816],[17.51469,45.10791],[17.47589,45.12656],[17.45615,45.12523],[17.4498,45.16119],[17.41229,45.13335],[17.33573,45.14521],[17.32092,45.16246],[17.26815,45.18444],[17.25131,45.14957],[17.24325,45.146],[17.18438,45.14764],[17.0415,45.20759],[16.9385,45.22742],[16.92405,45.27607],[16.83804,45.18951],[16.81137,45.18434],[16.78219,45.19002],[16.74845,45.20393],[16.64962,45.20714],[16.60194,45.23042],[16.56559,45.22307],[16.5501,45.2212],[16.52982,45.22713],[16.49155,45.21153],[16.4634,45.14522],[16.40023,45.1147],[16.38309,45.05955],[16.38219,45.05139],[16.3749,45.05206],[16.35863,45.03529],[16.35404,45.00241],[16.29036,44.99732],[16.12153,45.09616],[15.98412,45.23088],[15.83512,45.22459],[15.76371,45.16508],[15.78842,45.11519],[15.74585,45.0638],[15.78568,44.97401],[15.74723,44.96818],[15.76096,44.87045],[15.79472,44.8455],[15.72584,44.82334],[15.8255,44.71501],[15.89348,44.74964],[16.05828,44.61538],[16.00884,44.58605],[16.03012,44.55572],[16.10566,44.52586],[16.16814,44.40679],[16.12969,44.38275],[16.21346,44.35231],[16.18688,44.27012],[16.36864,44.08263],[16.43662,44.07523],[16.43629,44.02826],[16.50528,44.0244],[16.55472,43.95326],[16.70922,43.84887],[16.75316,43.77157],[16.80736,43.76011],[17.00585,43.58037],[17.15828,43.49376],[17.24411,43.49376],[17.29699,43.44542],[17.25579,43.40353],[17.286,43.33065],[17.46986,43.16559],[17.64268,43.08595],[17.70879,42.97223],[17.5392,42.92787],[17.6444,42.88641],[17.68151,42.92725],[17.7948,42.89556],[17.80854,42.9182],[17.88201,42.83668],[18.24318,42.6112],[18.36197,42.61423],[18.43735,42.55921],[18.49778,42.58409],[18.53751,42.57376],[18.55504,42.58409],[18.52232,42.62279],[18.57373,42.64429],[18.54841,42.68328],[18.54603,42.69171],[18.55221,42.69045],[18.56789,42.72074],[18.47324,42.74992],[18.45921,42.81682],[18.47633,42.85829],[18.4935,42.86433],[18.49661,42.89306],[18.49076,42.95553],[18.52232,43.01451],[18.66254,43.03928],[18.64735,43.14766],[18.66605,43.2056],[18.71747,43.2286],[18.6976,43.25243],[18.76538,43.29838],[18.85342,43.32426],[18.84794,43.33735],[18.83912,43.34795],[18.90911,43.36383],[18.95819,43.32899],[18.95001,43.29327],[19.00844,43.24988],[19.04233,43.30008],[19.08206,43.29668],[19.08673,43.31453],[19.04071,43.397],[19.01078,43.43854],[18.96053,43.45042],[18.95469,43.49367],[18.91379,43.50299],[19.01078,43.55806],[19.04934,43.50384],[19.13933,43.5282],[19.15685,43.53943],[19.22807,43.5264],[19.24774,43.53061],[19.2553,43.5938],[19.33426,43.58833],[19.36653,43.60921],[19.41941,43.54056],[19.42696,43.57987],[19.50455,43.58385],[19.5176,43.71403],[19.3986,43.79668],[19.23465,43.98764],[19.24363,44.01502],[19.38439,43.96611],[19.52515,43.95573],[19.56498,43.99922],[19.61836,44.01464],[19.61991,44.05254],[19.57467,44.04716],[19.55999,44.06894],[19.51167,44.08158],[19.47321,44.1193],[19.48386,44.14332],[19.47338,44.15034],[19.43905,44.13088],[19.40927,44.16722],[19.3588,44.18353],[19.34773,44.23244],[19.32464,44.27185],[19.26945,44.26957],[19.23306,44.26097],[19.20508,44.2917],[19.18328,44.28383],[19.16741,44.28648],[19.13332,44.31492],[19.13556,44.338],[19.11547,44.34218],[19.1083,44.3558],[19.11865,44.36712],[19.10298,44.36924],[19.10365,44.37795],[19.10704,44.38249],[19.10749,44.39421],[19.11785,44.40313],[19.14681,44.41463],[19.14837,44.45253],[19.12278,44.50132],[19.13369,44.52521],[19.16699,44.52197],[19.26388,44.65412],[19.32543,44.74058],[19.36722,44.88164],[19.18183,44.92055],[19.01994,44.85493],[18.8704,44.85097],[18.76347,44.90669],[18.76369,44.93707],[18.80661,44.93561],[18.78357,44.97741],[18.65723,45.07544],[18.47939,45.05871],[18.41896,45.11083],[18.32077,45.1021],[18.24387,45.13699],[18.1624,45.07654],[18.03121,45.12632],[18.01594,45.15163],[17.99479,45.14958],[17.97834,45.13831],[17.97336,45.12245],[17.93706,45.08016],[17.87148,45.04645],[17.84826,45.04489]]]]}},{type:"Feature",properties:{iso1A2:"BB",iso1A3:"BRB",iso1N3:"052",wikidata:"Q244",nameEn:"Barbados",groups:["029","003","419","019","UN"],driveSide:"left",callingCodes:["1 246"]},geometry:{type:"MultiPolygon",coordinates:[[[[-58.56442,13.24471],[-59.80731,13.87556],[-59.82929,12.70644],[-58.56442,13.24471]]]]}},{type:"Feature",properties:{iso1A2:"BD",iso1A3:"BGD",iso1N3:"050",wikidata:"Q902",nameEn:"Bangladesh",groups:["034","142","UN"],driveSide:"left",callingCodes:["880"]},geometry:{type:"MultiPolygon",coordinates:[[[[89.15869,26.13708],[89.08899,26.38845],[88.95612,26.4564],[88.92357,26.40711],[88.91321,26.37984],[89.05328,26.2469],[88.85004,26.23211],[88.78961,26.31093],[88.67837,26.26291],[88.69485,26.38353],[88.62144,26.46783],[88.4298,26.54489],[88.41196,26.63837],[88.33093,26.48929],[88.35153,26.45241],[88.36938,26.48683],[88.48749,26.45855],[88.51649,26.35923],[88.35153,26.29123],[88.34757,26.22216],[88.1844,26.14417],[88.16581,26.0238],[88.08804,25.91334],[88.13138,25.78773],[88.242,25.80811],[88.45103,25.66245],[88.4559,25.59227],[88.677,25.46959],[88.81296,25.51546],[88.85278,25.34679],[89.01105,25.30303],[89.00463,25.26583],[88.94067,25.18534],[88.44766,25.20149],[88.46277,25.07468],[88.33917,24.86803],[88.27325,24.88796],[88.21832,24.96642],[88.14004,24.93529],[88.15515,24.85806],[88.00683,24.66477],[88.08786,24.63232],[88.12296,24.51301],[88.50934,24.32474],[88.68801,24.31464],[88.74841,24.1959],[88.6976,24.14703],[88.73743,23.91751],[88.66189,23.87607],[88.58087,23.87105],[88.56507,23.64044],[88.74841,23.47361],[88.79351,23.50535],[88.79254,23.46028],[88.71133,23.2492],[88.99148,23.21134],[88.86377,23.08759],[88.88327,23.03885],[88.87063,22.95235],[88.96713,22.83346],[88.9151,22.75228],[88.94614,22.66941],[88.9367,22.58527],[89.07114,22.15335],[89.08044,21.41871],[92.47409,20.38654],[92.26071,21.05697],[92.17752,21.17445],[92.20087,21.337],[92.37939,21.47764],[92.43158,21.37025],[92.55105,21.3856],[92.60187,21.24615],[92.68152,21.28454],[92.59775,21.6092],[92.62187,21.87037],[92.60949,21.97638],[92.56616,22.13554],[92.60029,22.1522],[92.5181,22.71441],[92.37665,22.9435],[92.38214,23.28705],[92.26541,23.70392],[92.15417,23.73409],[92.04706,23.64229],[91.95093,23.73284],[91.95642,23.47361],[91.84789,23.42235],[91.76417,23.26619],[91.81634,23.08001],[91.7324,23.00043],[91.61571,22.93929],[91.54993,23.01051],[91.46615,23.2328],[91.4035,23.27522],[91.40848,23.07117],[91.36453,23.06612],[91.28293,23.37538],[91.15579,23.6599],[91.25192,23.83463],[91.22308,23.89616],[91.29587,24.0041],[91.35741,23.99072],[91.37414,24.10693],[91.55542,24.08687],[91.63782,24.1132],[91.65292,24.22095],[91.73257,24.14703],[91.76004,24.23848],[91.82596,24.22345],[91.89258,24.14674],[91.96603,24.3799],[92.11662,24.38997],[92.15796,24.54435],[92.25854,24.9191],[92.38626,24.86055],[92.49887,24.88796],[92.39147,25.01471],[92.33957,25.07593],[92.0316,25.1834],[91.63648,25.12846],[91.25517,25.20677],[90.87427,25.15799],[90.65042,25.17788],[90.40034,25.1534],[90.1155,25.22686],[89.90478,25.31038],[89.87629,25.28337],[89.83371,25.29548],[89.84086,25.31854],[89.81208,25.37244],[89.86129,25.61714],[89.84388,25.70042],[89.80585,25.82489],[89.86592,25.93115],[89.77728,26.04254],[89.77865,26.08387],[89.73581,26.15818],[89.70201,26.15138],[89.63968,26.22595],[89.57101,25.9682],[89.53515,26.00382],[89.35953,26.0077],[89.15869,26.13708]]]]}},{type:"Feature",properties:{iso1A2:"BE",iso1A3:"BEL",iso1N3:"056",wikidata:"Q31",nameEn:"Belgium",groups:["EU","155","150","UN"],callingCodes:["32"]},geometry:{type:"MultiPolygon",coordinates:[[[[4.93295,51.44945],[4.93909,51.44632],[4.9524,51.45014],[4.95244,51.45207],[4.93295,51.44945]]],[[[4.91493,51.4353],[4.92652,51.43329],[4.92952,51.42984],[4.93986,51.43064],[4.94265,51.44003],[4.93471,51.43861],[4.93416,51.44185],[4.94025,51.44193],[4.93544,51.44634],[4.92879,51.44161],[4.92815,51.43856],[4.92566,51.44273],[4.92811,51.4437],[4.92287,51.44741],[4.91811,51.44621],[4.92227,51.44252],[4.91935,51.43634],[4.91493,51.4353]]],[[[4.82946,51.4213],[4.82409,51.44736],[4.84139,51.4799],[4.78803,51.50284],[4.77321,51.50529],[4.74578,51.48937],[4.72935,51.48424],[4.65442,51.42352],[4.57489,51.4324],[4.53521,51.4243],[4.52846,51.45002],[4.54675,51.47265],[4.5388,51.48184],[4.47736,51.4778],[4.38122,51.44905],[4.39747,51.43316],[4.38064,51.41965],[4.43777,51.36989],[4.39292,51.35547],[4.34086,51.35738],[4.33265,51.37687],[4.21923,51.37443],[4.24024,51.35371],[4.16721,51.29348],[4.05165,51.24171],[4.01957,51.24504],[3.97889,51.22537],[3.90125,51.20371],[3.78783,51.2151],[3.78999,51.25766],[3.58939,51.30064],[3.51502,51.28697],[3.52698,51.2458],[3.43488,51.24135],[3.41704,51.25933],[3.38289,51.27331],[3.35847,51.31572],[3.38696,51.33436],[3.36263,51.37112],[2.56575,51.85301],[2.18458,51.52087],[2.55904,51.07014],[2.57551,51.00326],[2.63074,50.94746],[2.59093,50.91751],[2.63331,50.81457],[2.71165,50.81295],[2.81056,50.71773],[2.8483,50.72276],[2.86985,50.7033],[2.87937,50.70298],[2.88504,50.70656],[2.90069,50.69263],[2.91036,50.6939],[2.90873,50.702],[2.95019,50.75138],[2.96778,50.75242],[3.00537,50.76588],[3.04314,50.77674],[3.09163,50.77717],[3.10614,50.78303],[3.11206,50.79416],[3.11987,50.79188],[3.1257,50.78603],[3.15017,50.79031],[3.16476,50.76843],[3.18339,50.74981],[3.18811,50.74025],[3.20064,50.73547],[3.19017,50.72569],[3.20845,50.71662],[3.22042,50.71019],[3.24593,50.71389],[3.26063,50.70086],[3.26141,50.69151],[3.2536,50.68977],[3.264,50.67668],[3.23951,50.6585],[3.2729,50.60718],[3.28575,50.52724],[3.37693,50.49538],[3.44629,50.51009],[3.47385,50.53397],[3.51564,50.5256],[3.49509,50.48885],[3.5683,50.50192],[3.58361,50.49049],[3.61014,50.49568],[3.64426,50.46275],[3.66153,50.45165],[3.67494,50.40239],[3.67262,50.38663],[3.65709,50.36873],[3.66976,50.34563],[3.71009,50.30305],[3.70987,50.3191],[3.73911,50.34809],[3.84314,50.35219],[3.90781,50.32814],[3.96771,50.34989],[4.0268,50.35793],[4.0689,50.3254],[4.10237,50.31247],[4.10957,50.30234],[4.11954,50.30425],[4.13665,50.25609],[4.16808,50.25786],[4.15524,50.2833],[4.17347,50.28838],[4.17861,50.27443],[4.20651,50.27333],[4.21945,50.25539],[4.15524,50.21103],[4.16014,50.19239],[4.13561,50.13078],[4.20147,50.13535],[4.23101,50.06945],[4.16294,50.04719],[4.13508,50.01976],[4.14239,49.98034],[4.20532,49.95803],[4.31963,49.97043],[4.35051,49.95315],[4.43488,49.94122],[4.51098,49.94659],[4.5414,49.96911],[4.68695,49.99685],[4.70064,50.09384],[4.75237,50.11314],[4.82438,50.16878],[4.83279,50.15331],[4.88602,50.15182],[4.8382,50.06738],[4.78827,49.95609],[4.88529,49.9236],[4.85134,49.86457],[4.86965,49.82271],[4.85464,49.78995],[4.96714,49.79872],[5.09249,49.76193],[5.14545,49.70287],[5.26232,49.69456],[5.31465,49.66846],[5.33039,49.6555],[5.30214,49.63055],[5.3137,49.61225],[5.33851,49.61599],[5.34837,49.62889],[5.3974,49.61596],[5.43713,49.5707],[5.46734,49.52648],[5.46541,49.49825],[5.55001,49.52729],[5.60909,49.51228],[5.64505,49.55146],[5.75649,49.54321],[5.7577,49.55915],[5.77435,49.56298],[5.79195,49.55228],[5.81838,49.54777],[5.84143,49.5533],[5.84692,49.55663],[5.8424,49.56082],[5.87256,49.57539],[5.86986,49.58756],[5.84971,49.58674],[5.84826,49.5969],[5.8762,49.60898],[5.87609,49.62047],[5.88393,49.62802],[5.88552,49.63507],[5.90599,49.63853],[5.90164,49.6511],[5.9069,49.66377],[5.86175,49.67862],[5.86527,49.69291],[5.88677,49.70951],[5.86503,49.72739],[5.84193,49.72161],[5.82562,49.72395],[5.83149,49.74729],[5.82245,49.75048],[5.78871,49.7962],[5.75409,49.79239],[5.74953,49.81428],[5.74364,49.82058],[5.74844,49.82435],[5.7404,49.83452],[5.74076,49.83823],[5.74975,49.83933],[5.74953,49.84709],[5.75884,49.84811],[5.74567,49.85368],[5.75861,49.85631],[5.75269,49.8711],[5.78415,49.87922],[5.73621,49.89796],[5.77314,49.93646],[5.77291,49.96056],[5.80833,49.96451],[5.81163,49.97142],[5.83467,49.97823],[5.83968,49.9892],[5.82331,49.99662],[5.81866,50.01286],[5.8551,50.02683],[5.86904,50.04614],[5.85474,50.06342],[5.8857,50.07824],[5.89488,50.11476],[5.95929,50.13295],[5.96453,50.17259],[6.02488,50.18283],[6.03093,50.16362],[6.06406,50.15344],[6.08577,50.17246],[6.12028,50.16374],[6.1137,50.13668],[6.1379,50.12964],[6.15298,50.14126],[6.14132,50.14971],[6.14588,50.17106],[6.18739,50.1822],[6.18364,50.20815],[6.16853,50.2234],[6.208,50.25179],[6.28797,50.27458],[6.29949,50.30887],[6.32488,50.32333],[6.35701,50.31139],[6.40641,50.32425],[6.40785,50.33557],[6.3688,50.35898],[6.34406,50.37994],[6.36852,50.40776],[6.37219,50.45397],[6.34005,50.46083],[6.3465,50.48833],[6.30809,50.50058],[6.26637,50.50272],[6.22335,50.49578],[6.20599,50.52089],[6.19193,50.5212],[6.18716,50.52653],[6.19579,50.5313],[6.19735,50.53576],[6.17802,50.54179],[6.17739,50.55875],[6.20281,50.56952],[6.22581,50.5907],[6.24005,50.58732],[6.24888,50.59869],[6.2476,50.60392],[6.26957,50.62444],[6.17852,50.6245],[6.11707,50.72231],[6.04428,50.72861],[6.0406,50.71848],[6.0326,50.72647],[6.03889,50.74618],[6.01976,50.75398],[5.97545,50.75441],[5.95942,50.7622],[5.89132,50.75124],[5.89129,50.75125],[5.88734,50.77092],[5.84888,50.75448],[5.84548,50.76542],[5.80673,50.7558],[5.77513,50.78308],[5.76533,50.78159],[5.74356,50.7691],[5.73904,50.75674],[5.72216,50.76398],[5.69469,50.75529],[5.68091,50.75804],[5.70107,50.7827],[5.68995,50.79641],[5.70118,50.80764],[5.65259,50.82309],[5.64009,50.84742],[5.64504,50.87107],[5.67886,50.88142],[5.69858,50.91046],[5.71626,50.90796],[5.72644,50.91167],[5.72545,50.92312],[5.74644,50.94723],[5.75927,50.95601],[5.74752,50.96202],[5.72875,50.95428],[5.71864,50.96092],[5.76242,50.99703],[5.77688,51.02483],[5.75961,51.03113],[5.77258,51.06196],[5.79835,51.05834],[5.79903,51.09371],[5.82921,51.09328],[5.83226,51.10585],[5.8109,51.10861],[5.80798,51.11661],[5.85508,51.14445],[5.82564,51.16753],[5.77697,51.1522],[5.77735,51.17845],[5.74617,51.18928],[5.70344,51.1829],[5.65528,51.18736],[5.65145,51.19788],[5.5603,51.22249],[5.5569,51.26544],[5.515,51.29462],[5.48476,51.30053],[5.46519,51.2849],[5.4407,51.28169],[5.41672,51.26248],[5.347,51.27502],[5.33886,51.26314],[5.29716,51.26104],[5.26461,51.26693],[5.23814,51.26064],[5.22542,51.26888],[5.24244,51.30495],[5.2002,51.32243],[5.16222,51.31035],[5.13377,51.31592],[5.13105,51.34791],[5.07102,51.39469],[5.10456,51.43163],[5.07891,51.4715],[5.04774,51.47022],[5.03281,51.48679],[5.0106,51.47167],[5.00393,51.44406],[4.92152,51.39487],[4.90016,51.41404],[4.84988,51.41502],[4.78941,51.41102],[4.77229,51.41337],[4.76577,51.43046],[4.78314,51.43319],[4.82946,51.4213]]]]}},{type:"Feature",properties:{iso1A2:"BF",iso1A3:"BFA",iso1N3:"854",wikidata:"Q965",nameEn:"Burkina Faso",groups:["011","202","002","UN"],callingCodes:["226"]},geometry:{type:"MultiPolygon",coordinates:[[[[.23859,15.00135],[.06588,14.96961],[-.24673,15.07805],[-.72004,15.08655],[-1.05875,14.7921],[-1.32166,14.72774],[-1.68083,14.50023],[-1.97945,14.47709],[-1.9992,14.19011],[-2.10223,14.14878],[-2.47587,14.29671],[-2.66175,14.14713],[-2.84667,14.05532],[-2.90831,13.81174],[-2.88189,13.64921],[-3.26407,13.70699],[-3.28396,13.5422],[-3.23599,13.29035],[-3.43507,13.27272],[-3.4313,13.1588],[-3.54454,13.1781],[-3.7911,13.36665],[-3.96282,13.38164],[-3.90558,13.44375],[-3.96501,13.49778],[-4.34477,13.12927],[-4.21819,12.95722],[-4.238,12.71467],[-4.47356,12.71252],[-4.41412,12.31922],[-4.57703,12.19875],[-4.54841,12.1385],[-4.62546,12.13204],[-4.62987,12.06531],[-4.70692,12.06746],[-4.72893,12.01579],[-5.07897,11.97918],[-5.26389,11.84778],[-5.40258,11.8327],[-5.26389,11.75728],[-5.29251,11.61715],[-5.22867,11.60421],[-5.20665,11.43811],[-5.25509,11.36905],[-5.25949,11.24816],[-5.32553,11.21578],[-5.32994,11.13371],[-5.49284,11.07538],[-5.41579,10.84628],[-5.47083,10.75329],[-5.46643,10.56074],[-5.51058,10.43177],[-5.39602,10.2929],[-5.12465,10.29788],[-4.96453,9.99923],[-4.96621,9.89132],[-4.6426,9.70696],[-4.31392,9.60062],[-4.25999,9.76012],[-3.69703,9.94279],[-3.31779,9.91125],[-3.27228,9.84981],[-3.19306,9.93781],[-3.16609,9.85147],[-3.00765,9.74019],[-2.93012,9.57403],[-2.76494,9.40778],[-2.68802,9.49343],[-2.76534,9.56589],[-2.74174,9.83172],[-2.83108,10.40252],[-2.94232,10.64281],[-2.83373,11.0067],[-.67143,10.99811],[-.61937,10.91305],[-.44298,11.04292],[-.42391,11.11661],[-.38219,11.12596],[-.35955,11.07801],[-.28566,11.12713],[-.27374,11.17157],[-.13493,11.14075],[.50388,11.01011],[.48852,10.98561],[.50521,10.98035],[.4958,10.93269],[.66104,10.99964],[.91245,10.99597],[.9813,11.08876],[1.03409,11.04719],[1.42823,11.46822],[2.00988,11.42227],[2.29983,11.68254],[2.39723,11.89473],[2.05785,12.35539],[2.26349,12.41915],[.99167,13.10727],[.99253,13.37515],[1.18873,13.31771],[1.21217,13.37853],[1.24516,13.33968],[1.28509,13.35488],[1.24429,13.39373],[1.20088,13.38951],[1.02813,13.46635],[.99514,13.5668],[.77637,13.64442],[.77377,13.6866],[.61924,13.68491],[.38051,14.05575],[.16936,14.51654],[.23859,15.00135]]]]}},{type:"Feature",properties:{iso1A2:"BG",iso1A3:"BGR",iso1N3:"100",wikidata:"Q219",nameEn:"Bulgaria",groups:["EU","151","150","UN"],callingCodes:["359"]},geometry:{type:"MultiPolygon",coordinates:[[[[23.05288,43.79494],[22.85314,43.84452],[22.83753,43.88055],[22.87873,43.9844],[23.01674,44.01946],[23.04988,44.07694],[22.67173,44.21564],[22.61711,44.16938],[22.61688,44.06534],[22.41449,44.00514],[22.35558,43.81281],[22.41043,43.69566],[22.47582,43.6558],[22.53397,43.47225],[22.82036,43.33665],[22.89727,43.22417],[23.00806,43.19279],[22.98104,43.11199],[22.89521,43.03625],[22.78397,42.98253],[22.74826,42.88701],[22.54302,42.87774],[22.43309,42.82057],[22.4997,42.74144],[22.43983,42.56851],[22.55669,42.50144],[22.51961,42.3991],[22.47498,42.3915],[22.45919,42.33822],[22.34773,42.31725],[22.38136,42.30339],[22.47251,42.20393],[22.50289,42.19527],[22.51224,42.15457],[22.67701,42.06614],[22.86749,42.02275],[22.90254,41.87587],[22.96682,41.77137],[23.01239,41.76527],[23.03342,41.71034],[22.95513,41.63265],[22.96331,41.35782],[22.93334,41.34104],[23.1833,41.31755],[23.21953,41.33773],[23.22771,41.37106],[23.31301,41.40525],[23.33639,41.36317],[23.40416,41.39999],[23.52453,41.40262],[23.63203,41.37632],[23.67644,41.41139],[23.76525,41.40175],[23.80148,41.43943],[23.89613,41.45257],[23.91483,41.47971],[23.96975,41.44118],[24.06908,41.46132],[24.06323,41.53222],[24.10063,41.54796],[24.18126,41.51735],[24.27124,41.57682],[24.30513,41.51297],[24.52599,41.56808],[24.61129,41.42278],[24.71529,41.41928],[24.8041,41.34913],[24.82514,41.4035],[24.86136,41.39298],[24.90928,41.40876],[24.942,41.38685],[25.11611,41.34212],[25.28322,41.23411],[25.48187,41.28506],[25.52394,41.2798],[25.55082,41.31667],[25.61042,41.30614],[25.66183,41.31316],[25.70507,41.29209],[25.8266,41.34563],[25.87919,41.30526],[26.12926,41.35878],[26.16548,41.42278],[26.20288,41.43943],[26.14796,41.47533],[26.176,41.50072],[26.17951,41.55409],[26.14328,41.55496],[26.15146,41.60828],[26.07083,41.64584],[26.06148,41.70345],[26.16841,41.74858],[26.21325,41.73223],[26.22888,41.74139],[26.2654,41.71544],[26.30255,41.70925],[26.35957,41.71149],[26.32952,41.73637],[26.33589,41.76802],[26.36952,41.82265],[26.53968,41.82653],[26.57961,41.90024],[26.56051,41.92995],[26.62996,41.97644],[26.79143,41.97386],[26.95638,42.00741],[27.03277,42.0809],[27.08486,42.08735],[27.19251,42.06028],[27.22376,42.10152],[27.27411,42.10409],[27.45478,41.96591],[27.52379,41.93756],[27.55191,41.90928],[27.69949,41.97515],[27.81235,41.94803],[27.83492,41.99709],[27.91479,41.97902],[28.02971,41.98066],[28.32297,41.98371],[29.24336,43.70874],[28.23293,43.76],[27.99558,43.84193],[27.92008,44.00761],[27.73468,43.95326],[27.64542,44.04958],[27.60834,44.01206],[27.39757,44.0141],[27.26845,44.12602],[26.95141,44.13555],[26.62712,44.05698],[26.38764,44.04356],[26.10115,43.96908],[26.05584,43.90925],[25.94911,43.85745],[25.72792,43.69263],[25.39528,43.61866],[25.17144,43.70261],[25.10718,43.6831],[24.96682,43.72693],[24.73542,43.68523],[24.62281,43.74082],[24.50264,43.76314],[24.35364,43.70211],[24.18149,43.68218],[23.73978,43.80627],[23.61687,43.79289],[23.4507,43.84936],[23.26772,43.84843],[23.05288,43.79494]]]]}},{type:"Feature",properties:{iso1A2:"BH",iso1A3:"BHR",iso1N3:"048",wikidata:"Q398",nameEn:"Bahrain",groups:["145","142","UN"],callingCodes:["973"]},geometry:{type:"MultiPolygon",coordinates:[[[[50.93865,26.30758],[50.71771,26.73086],[50.38162,26.53976],[50.26923,26.08243],[50.302,25.87592],[50.57069,25.57887],[50.80824,25.54641],[50.7801,25.595],[50.86149,25.6965],[50.81266,25.88946],[50.93865,26.30758]]]]}},{type:"Feature",properties:{iso1A2:"BI",iso1A3:"BDI",iso1N3:"108",wikidata:"Q967",nameEn:"Burundi",groups:["014","202","002","UN"],callingCodes:["257"]},geometry:{type:"MultiPolygon",coordinates:[[[[30.54501,-2.41404],[30.42933,-2.31064],[30.14034,-2.43626],[29.95911,-2.33348],[29.88237,-2.75105],[29.36805,-2.82933],[29.32234,-2.6483],[29.0562,-2.58632],[29.04081,-2.7416],[29.00167,-2.78523],[29.00404,-2.81978],[29.0505,-2.81774],[29.09119,-2.87871],[29.09797,-2.91935],[29.16037,-2.95457],[29.17258,-2.99385],[29.25633,-3.05471],[29.21463,-3.3514],[29.23708,-3.75856],[29.43673,-4.44845],[29.63827,-4.44681],[29.75109,-4.45836],[29.77289,-4.41733],[29.82885,-4.36153],[29.88172,-4.35743],[30.03323,-4.26631],[30.22042,-4.01738],[30.45915,-3.56532],[30.84165,-3.25152],[30.83823,-2.97837],[30.6675,-2.98987],[30.57926,-2.89791],[30.4987,-2.9573],[30.40662,-2.86151],[30.52747,-2.65841],[30.41789,-2.66266],[30.54501,-2.41404]]]]}},{type:"Feature",properties:{iso1A2:"BJ",iso1A3:"BEN",iso1N3:"204",wikidata:"Q962",nameEn:"Benin",aliases:["DY"],groups:["011","202","002","UN"],callingCodes:["229"]},geometry:{type:"MultiPolygon",coordinates:[[[[3.59375,11.70269],[3.48187,11.86092],[3.31613,11.88495],[3.25352,12.01467],[2.83978,12.40585],[2.6593,12.30631],[2.37783,12.24804],[2.39657,12.10952],[2.45824,11.98672],[2.39723,11.89473],[2.29983,11.68254],[2.00988,11.42227],[1.42823,11.46822],[1.03409,11.04719],[.9813,11.08876],[.91245,10.99597],[.8804,10.803],[.80358,10.71459],[.77666,10.37665],[1.35507,9.99525],[1.36624,9.5951],[1.33675,9.54765],[1.41746,9.3226],[1.5649,9.16941],[1.61838,9.0527],[1.64249,6.99562],[1.55877,6.99737],[1.61812,6.74843],[1.58105,6.68619],[1.76906,6.43189],[1.79826,6.28221],[1.62913,6.24075],[1.67336,6.02702],[2.74181,6.13349],[2.70566,6.38038],[2.70464,6.50831],[2.74334,6.57291],[2.7325,6.64057],[2.78204,6.70514],[2.78823,6.76356],[2.73405,6.78508],[2.74024,6.92802],[2.71702,6.95722],[2.76965,7.13543],[2.74489,7.42565],[2.79442,7.43486],[2.78668,7.5116],[2.73405,7.5423],[2.73095,7.7755],[2.67523,7.87825],[2.77907,9.06924],[3.08017,9.10006],[3.14147,9.28375],[3.13928,9.47167],[3.25093,9.61632],[3.34726,9.70696],[3.32099,9.78032],[3.35383,9.83641],[3.54429,9.87739],[3.66908,10.18136],[3.57275,10.27185],[3.6844,10.46351],[3.78292,10.40538],[3.84243,10.59316],[3.71505,11.13015],[3.49175,11.29765],[3.59375,11.70269]]]]}},{type:"Feature",properties:{iso1A2:"BL",iso1A3:"BLM",iso1N3:"652",wikidata:"Q25362",nameEn:"Saint-Barth\xE9lemy",country:"FR",groups:["EU","Q1451600","029","003","419","019","UN"],callingCodes:["590"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.62718,18.26185],[-63.1055,17.86651],[-62.34423,17.49165],[-62.62718,18.26185]]]]}},{type:"Feature",properties:{iso1A2:"BM",iso1A3:"BMU",iso1N3:"060",wikidata:"Q23635",nameEn:"Bermuda",country:"GB",groups:["BOTS","021","003","019","UN"],driveSide:"left",callingCodes:["1 441"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.20987,32.6953],[-65.31453,32.68437],[-65.63955,31.43417],[-63.20987,32.6953]]]]}},{type:"Feature",properties:{iso1A2:"BN",iso1A3:"BRN",iso1N3:"096",wikidata:"Q921",nameEn:"Brunei",groups:["Q36117","035","142","UN"],driveSide:"left",callingCodes:["673"]},geometry:{type:"MultiPolygon",coordinates:[[[[115.16236,5.01011],[115.02521,5.35005],[114.10166,4.76112],[114.07448,4.58441],[114.15813,4.57],[114.26876,4.49878],[114.32176,4.34942],[114.32176,4.2552],[114.4416,4.27588],[114.49922,4.13108],[114.64211,4.00694],[114.78539,4.12205],[114.88039,4.4257],[114.83189,4.42387],[114.77303,4.72871],[114.8266,4.75062],[114.88841,4.81905],[114.96982,4.81146],[114.99417,4.88201],[115.05038,4.90275],[115.02955,4.82087],[115.02278,4.74137],[115.04064,4.63706],[115.07737,4.53418],[115.09978,4.39123],[115.31275,4.30806],[115.36346,4.33563],[115.2851,4.42295],[115.27819,4.63661],[115.20737,4.8256],[115.15092,4.87604],[115.16236,5.01011]]]]}},{type:"Feature",properties:{iso1A2:"BO",iso1A3:"BOL",iso1N3:"068",wikidata:"Q750",nameEn:"Bolivia",groups:["005","419","019","UN"],callingCodes:["591"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.90248,-12.52544],[-64.22539,-12.45267],[-64.30708,-12.46398],[-64.99778,-11.98604],[-65.30027,-11.48749],[-65.28141,-10.86289],[-65.35402,-10.78685],[-65.37923,-10.35141],[-65.29019,-9.86253],[-65.40615,-9.63894],[-65.56244,-9.84266],[-65.68343,-9.75323],[-67.17784,-10.34016],[-68.71533,-11.14749],[-68.7651,-11.0496],[-68.75179,-11.03688],[-68.75265,-11.02383],[-68.74802,-11.00891],[-69.42792,-10.93451],[-69.47839,-10.95254],[-69.57156,-10.94555],[-68.98115,-11.8979],[-68.65044,-12.50689],[-68.85615,-12.87769],[-68.8864,-13.40792],[-69.05265,-13.68546],[-68.88135,-14.18639],[-69.36254,-14.94634],[-69.14856,-15.23478],[-69.40336,-15.61358],[-69.20291,-16.16668],[-69.09986,-16.22693],[-68.96238,-16.194],[-68.79464,-16.33272],[-68.98358,-16.42165],[-69.04027,-16.57214],[-69.00853,-16.66769],[-69.16896,-16.72233],[-69.62883,-17.28142],[-69.46863,-17.37466],[-69.46897,-17.4988],[-69.46623,-17.60518],[-69.34126,-17.72753],[-69.28671,-17.94844],[-69.07496,-18.03715],[-69.14807,-18.16893],[-69.07432,-18.28259],[-68.94987,-18.93302],[-68.87082,-19.06003],[-68.80602,-19.08355],[-68.61989,-19.27584],[-68.41218,-19.40499],[-68.66761,-19.72118],[-68.54611,-19.84651],[-68.57132,-20.03134],[-68.74273,-20.08817],[-68.7276,-20.46178],[-68.44023,-20.62701],[-68.55383,-20.7355],[-68.53957,-20.91542],[-68.40403,-20.94562],[-68.18816,-21.28614],[-67.85114,-22.87076],[-67.54284,-22.89771],[-67.18382,-22.81525],[-66.7298,-22.23644],[-66.29714,-22.08741],[-66.24077,-21.77837],[-66.03836,-21.84829],[-66.04832,-21.9187],[-65.9261,-21.93335],[-65.7467,-22.10105],[-65.61166,-22.09504],[-65.58694,-22.09794],[-65.57743,-22.07675],[-65.47435,-22.08908],[-64.99524,-22.08255],[-64.90014,-22.12136],[-64.67174,-22.18957],[-64.58888,-22.25035],[-64.4176,-22.67692],[-64.35108,-22.73282],[-64.31489,-22.88824],[-64.22918,-22.55807],[-63.93287,-21.99934],[-63.70963,-21.99934],[-63.68113,-22.0544],[-63.66482,-21.99918],[-62.81124,-21.9987],[-62.8078,-22.12534],[-62.64455,-22.25091],[-62.2757,-21.06657],[-62.26883,-20.55311],[-61.93912,-20.10053],[-61.73723,-19.63958],[-60.00638,-19.2981],[-59.06965,-19.29148],[-58.23216,-19.80058],[-58.16225,-20.16193],[-57.8496,-19.98346],[-58.14215,-19.76276],[-57.78463,-19.03259],[-57.71113,-19.03161],[-57.69134,-19.00544],[-57.71995,-18.97546],[-57.71995,-18.89573],[-57.76764,-18.90087],[-57.56807,-18.25655],[-57.48237,-18.24219],[-57.69877,-17.8431],[-57.73949,-17.56095],[-57.90082,-17.44555],[-57.99661,-17.5273],[-58.32935,-17.28195],[-58.5058,-16.80958],[-58.30918,-16.3699],[-58.32431,-16.25861],[-58.41506,-16.32636],[-60.16069,-16.26479],[-60.23797,-15.50267],[-60.58224,-15.09887],[-60.23968,-15.09515],[-60.27887,-14.63021],[-60.46037,-14.22496],[-60.48053,-13.77981],[-61.05527,-13.50054],[-61.81151,-13.49564],[-63.76259,-12.42952],[-63.90248,-12.52544]]]]}},{type:"Feature",properties:{iso1A2:"BQ",iso1A3:"BES",iso1N3:"535",wikidata:"Q27561",nameEn:"Caribbean Netherlands",country:"NL"},geometry:null},{type:"Feature",properties:{iso1A2:"BR",iso1A3:"BRA",iso1N3:"076",wikidata:"Q155",nameEn:"Brazil",groups:["005","419","019","UN"],callingCodes:["55"]},geometry:{type:"MultiPolygon",coordinates:[[[[-59.69361,4.34069],[-59.78878,4.45637],[-60.15953,4.53456],[-60.04189,4.69801],[-59.98129,5.07097],[-60.20944,5.28754],[-60.32352,5.21299],[-60.73204,5.20931],[-60.5802,4.94312],[-60.86539,4.70512],[-60.98303,4.54167],[-61.15703,4.49839],[-61.31457,4.54167],[-61.29675,4.44216],[-61.48569,4.43149],[-61.54629,4.2822],[-62.13094,4.08309],[-62.44822,4.18621],[-62.57656,4.04754],[-62.74411,4.03331],[-62.7655,3.73099],[-62.98296,3.59935],[-63.21111,3.96219],[-63.4464,3.9693],[-63.42233,3.89995],[-63.50611,3.83592],[-63.67099,4.01731],[-63.70218,3.91417],[-63.86082,3.94796],[-63.99183,3.90172],[-64.14512,4.12932],[-64.57648,4.12576],[-64.72977,4.28931],[-64.84028,4.24665],[-64.48379,3.7879],[-64.02908,2.79797],[-64.0257,2.48156],[-63.39114,2.4317],[-63.39827,2.16098],[-64.06135,1.94722],[-64.08274,1.64792],[-64.34654,1.35569],[-64.38932,1.5125],[-65.11657,1.12046],[-65.57288,.62856],[-65.50158,.92086],[-65.6727,1.01353],[-66.28507,.74585],[-66.85795,1.22998],[-67.08222,1.17441],[-67.15784,1.80439],[-67.299,1.87494],[-67.40488,2.22258],[-67.9292,1.82455],[-68.18632,2.00091],[-68.26699,1.83463],[-68.18128,1.72881],[-69.38621,1.70865],[-69.53746,1.76408],[-69.83491,1.69353],[-69.82987,1.07864],[-69.26017,1.06856],[-69.14422,.84172],[-69.20976,.57958],[-69.47696,.71065],[-70.04162,.55437],[-70.03658,-.19681],[-69.603,-.51947],[-69.59796,-.75136],[-69.4215,-1.01853],[-69.43395,-1.42219],[-69.94708,-4.2431],[-70.00888,-4.37833],[-70.11305,-4.27281],[-70.19582,-4.3607],[-70.33236,-4.15214],[-70.77601,-4.15717],[-70.96814,-4.36915],[-71.87003,-4.51661],[-72.64391,-5.0391],[-72.83973,-5.14765],[-73.24579,-6.05764],[-73.12983,-6.43852],[-73.73986,-6.87919],[-73.77011,-7.28944],[-73.96938,-7.58465],[-73.65485,-7.77897],[-73.76576,-7.89884],[-72.92886,-9.04074],[-73.21498,-9.40904],[-72.72216,-9.41397],[-72.31883,-9.5184],[-72.14742,-9.98049],[-71.23394,-9.9668],[-70.53373,-9.42628],[-70.58453,-9.58303],[-70.55429,-9.76692],[-70.62487,-9.80666],[-70.64134,-11.0108],[-70.51395,-10.92249],[-70.38791,-11.07096],[-69.90896,-10.92744],[-69.57835,-10.94051],[-69.57156,-10.94555],[-69.47839,-10.95254],[-69.42792,-10.93451],[-68.74802,-11.00891],[-68.75265,-11.02383],[-68.75179,-11.03688],[-68.7651,-11.0496],[-68.71533,-11.14749],[-67.17784,-10.34016],[-65.68343,-9.75323],[-65.56244,-9.84266],[-65.40615,-9.63894],[-65.29019,-9.86253],[-65.37923,-10.35141],[-65.35402,-10.78685],[-65.28141,-10.86289],[-65.30027,-11.48749],[-64.99778,-11.98604],[-64.30708,-12.46398],[-64.22539,-12.45267],[-63.90248,-12.52544],[-63.76259,-12.42952],[-61.81151,-13.49564],[-61.05527,-13.50054],[-60.48053,-13.77981],[-60.46037,-14.22496],[-60.27887,-14.63021],[-60.23968,-15.09515],[-60.58224,-15.09887],[-60.23797,-15.50267],[-60.16069,-16.26479],[-58.41506,-16.32636],[-58.32431,-16.25861],[-58.30918,-16.3699],[-58.5058,-16.80958],[-58.32935,-17.28195],[-57.99661,-17.5273],[-57.90082,-17.44555],[-57.73949,-17.56095],[-57.69877,-17.8431],[-57.48237,-18.24219],[-57.56807,-18.25655],[-57.76764,-18.90087],[-57.71995,-18.89573],[-57.71995,-18.97546],[-57.69134,-19.00544],[-57.71113,-19.03161],[-57.78463,-19.03259],[-58.14215,-19.76276],[-57.8496,-19.98346],[-58.16225,-20.16193],[-57.84536,-20.93155],[-57.93492,-21.65505],[-57.88239,-21.6868],[-57.94642,-21.73799],[-57.98625,-22.09157],[-56.6508,-22.28387],[-56.5212,-22.11556],[-56.45893,-22.08072],[-56.23206,-22.25347],[-55.8331,-22.29008],[-55.74941,-22.46436],[-55.741,-22.52018],[-55.72366,-22.5519],[-55.6986,-22.56268],[-55.68742,-22.58407],[-55.62493,-22.62765],[-55.63849,-22.95122],[-55.5446,-23.22811],[-55.52288,-23.2595],[-55.5555,-23.28237],[-55.43585,-23.87157],[-55.44117,-23.9185],[-55.41784,-23.9657],[-55.12292,-23.99669],[-55.0518,-23.98666],[-55.02691,-23.97317],[-54.6238,-23.83078],[-54.32807,-24.01865],[-54.28207,-24.07305],[-54.4423,-25.13381],[-54.62033,-25.46026],[-54.60196,-25.48397],[-54.59509,-25.53696],[-54.59398,-25.59224],[-54.5502,-25.58915],[-54.52926,-25.62846],[-53.90831,-25.55513],[-53.83691,-25.94849],[-53.73511,-26.04211],[-53.73086,-26.05842],[-53.7264,-26.0664],[-53.73391,-26.07006],[-53.73968,-26.10012],[-53.65018,-26.19501],[-53.65237,-26.23289],[-53.63739,-26.2496],[-53.63881,-26.25075],[-53.64632,-26.24798],[-53.64186,-26.25976],[-53.64505,-26.28089],[-53.68269,-26.33359],[-53.73372,-26.6131],[-53.80144,-27.09844],[-54.15978,-27.2889],[-54.19062,-27.27639],[-54.19268,-27.30751],[-54.41888,-27.40882],[-54.50416,-27.48232],[-54.67657,-27.57214],[-54.90159,-27.63132],[-54.90805,-27.73149],[-55.1349,-27.89759],[-55.16872,-27.86224],[-55.33303,-27.94661],[-55.6262,-28.17124],[-55.65418,-28.18304],[-56.01729,-28.51223],[-56.00458,-28.60421],[-56.05265,-28.62651],[-56.54171,-29.11447],[-56.57295,-29.11357],[-56.62789,-29.18073],[-56.81251,-29.48154],[-57.09386,-29.74211],[-57.65132,-30.19229],[-57.22502,-30.26121],[-56.90236,-30.02578],[-56.49267,-30.39471],[-56.4795,-30.3899],[-56.4619,-30.38457],[-55.87388,-31.05053],[-55.58866,-30.84117],[-55.5634,-30.8686],[-55.55373,-30.8732],[-55.55218,-30.88193],[-55.54572,-30.89051],[-55.53431,-30.89714],[-55.53276,-30.90218],[-55.52712,-30.89997],[-55.51862,-30.89828],[-55.50841,-30.9027],[-55.50821,-30.91349],[-54.17384,-31.86168],[-53.76024,-32.0751],[-53.39572,-32.58596],[-53.37671,-32.57005],[-53.1111,-32.71147],[-53.53459,-33.16843],[-53.52794,-33.68908],[-53.44031,-33.69344],[-53.39593,-33.75169],[-53.37138,-33.74313],[-52.83257,-34.01481],[-28.34015,-20.99094],[-28.99601,1.86593],[-51.35485,4.8383],[-51.63798,4.51394],[-51.61983,4.14596],[-51.79599,3.89336],[-51.82312,3.85825],[-51.85573,3.83427],[-52.31787,3.17896],[-52.6906,2.37298],[-52.96539,2.1881],[-53.78743,2.34412],[-54.16286,2.10779],[-54.6084,2.32856],[-55.01919,2.564],[-55.71493,2.40342],[-55.96292,2.53188],[-56.13054,2.27723],[-55.92159,2.05236],[-55.89863,1.89861],[-55.99278,1.83137],[-56.47045,1.95135],[-56.7659,1.89509],[-57.07092,1.95304],[-57.09109,2.01854],[-57.23981,1.95808],[-57.35073,1.98327],[-57.55743,1.69605],[-57.77281,1.73344],[-57.97336,1.64566],[-58.01873,1.51966],[-58.33887,1.58014],[-58.4858,1.48399],[-58.53571,1.29154],[-58.84229,1.17749],[-58.92072,1.31293],[-59.25583,1.40559],[-59.74066,1.87596],[-59.7264,2.27497],[-59.91177,2.36759],[-59.99733,2.92312],[-59.79769,3.37162],[-59.86899,3.57089],[-59.51963,3.91951],[-59.73353,4.20399],[-59.69361,4.34069]]]]}},{type:"Feature",properties:{iso1A2:"BS",iso1A3:"BHS",iso1N3:"044",wikidata:"Q778",nameEn:"The Bahamas",groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 242"]},geometry:{type:"MultiPolygon",coordinates:[[[[-72.98446,20.4801],[-71.70065,25.7637],[-78.91214,27.76553],[-80.65727,23.71953],[-72.98446,20.4801]]]]}},{type:"Feature",properties:{iso1A2:"BT",iso1A3:"BTN",iso1N3:"064",wikidata:"Q917",nameEn:"Bhutan",groups:["034","142","UN"],driveSide:"left",callingCodes:["975"]},geometry:{type:"MultiPolygon",coordinates:[[[[91.6469,27.76358],[91.5629,27.84823],[91.48973,27.93903],[91.46327,28.0064],[91.25779,28.07509],[91.20019,27.98715],[90.69894,28.07784],[90.58842,28.02838],[90.13387,28.19178],[89.79762,28.23979],[89.59525,28.16433],[89.12825,27.62502],[89.0582,27.60985],[88.97213,27.51671],[88.95355,27.4106],[89.00216,27.32532],[88.96947,27.30319],[88.93678,27.33777],[88.91901,27.32483],[88.74219,27.144],[88.86984,27.10937],[88.8714,26.97488],[88.92301,26.99286],[88.95807,26.92668],[89.09554,26.89089],[89.12825,26.81661],[89.1926,26.81329],[89.37913,26.86224],[89.38319,26.85963],[89.3901,26.84225],[89.42349,26.83727],[89.63369,26.74402],[89.86124,26.73307],[90.04535,26.72422],[90.30402,26.85098],[90.39271,26.90704],[90.48504,26.8594],[90.67715,26.77215],[91.50067,26.79223],[91.83181,26.87318],[92.05523,26.8692],[92.11863,26.893],[92.03457,27.07334],[92.04702,27.26861],[92.12019,27.27829],[92.01132,27.47352],[91.65007,27.48287],[91.55819,27.6144],[91.6469,27.76358]]]]}},{type:"Feature",properties:{iso1A2:"BV",iso1A3:"BVT",iso1N3:"074",wikidata:"Q23408",nameEn:"Bouvet Island",country:"NO",groups:["005","419","019","UN"]},geometry:{type:"MultiPolygon",coordinates:[[[[4.54042,-54.0949],[2.28941,-54.13089],[3.35353,-55.17558],[4.54042,-54.0949]]]]}},{type:"Feature",properties:{iso1A2:"BW",iso1A3:"BWA",iso1N3:"072",wikidata:"Q963",nameEn:"Botswana",groups:["018","202","002","UN"],driveSide:"left",callingCodes:["267"]},geometry:{type:"MultiPolygon",coordinates:[[[[25.26433,-17.79571],[25.16882,-17.78253],[25.05895,-17.84452],[24.95586,-17.79674],[24.73364,-17.89338],[24.71887,-17.9218],[24.6303,-17.9863],[24.57485,-18.07151],[24.40577,-17.95726],[24.19416,-18.01919],[23.61088,-18.4881],[23.29618,-17.99855],[23.0996,-18.00075],[21.45556,-18.31795],[20.99904,-18.31743],[20.99751,-22.00026],[19.99912,-21.99991],[19.99817,-24.76768],[20.02809,-24.78725],[20.03678,-24.81004],[20.29826,-24.94869],[20.64795,-25.47827],[20.86081,-26.14892],[20.61754,-26.4692],[20.63275,-26.78181],[20.68596,-26.9039],[20.87031,-26.80047],[21.13353,-26.86661],[21.37869,-26.82083],[21.69322,-26.86152],[21.7854,-26.79199],[21.77114,-26.69015],[21.83291,-26.65959],[21.90703,-26.66808],[22.06192,-26.61882],[22.21206,-26.3773],[22.41921,-26.23078],[22.56365,-26.19668],[22.70808,-25.99186],[22.86012,-25.50572],[23.03497,-25.29971],[23.47588,-25.29971],[23.9244,-25.64286],[24.18287,-25.62916],[24.36531,-25.773],[24.44703,-25.73021],[24.67319,-25.81749],[24.8946,-25.80723],[25.01718,-25.72507],[25.12266,-25.75931],[25.33076,-25.76616],[25.58543,-25.6343],[25.6643,-25.4491],[25.69661,-25.29284],[25.72702,-25.25503],[25.88571,-24.87802],[25.84295,-24.78661],[25.8515,-24.75727],[26.39409,-24.63468],[26.46346,-24.60358],[26.51667,-24.47219],[26.84165,-24.24885],[26.99749,-23.65486],[27.33768,-23.40917],[27.52393,-23.37952],[27.6066,-23.21894],[27.74154,-23.2137],[27.93539,-23.04941],[27.93729,-22.96194],[28.04752,-22.90243],[28.04562,-22.8394],[28.34874,-22.5694],[28.63287,-22.55887],[28.91889,-22.44299],[29.0151,-22.22907],[29.10881,-22.21202],[29.15268,-22.21399],[29.18974,-22.18599],[29.21955,-22.17771],[29.37703,-22.19581],[29.3533,-22.18363],[29.24648,-22.05967],[29.1974,-22.07472],[29.14501,-22.07275],[29.08495,-22.04867],[29.04108,-22.00563],[29.02191,-21.95665],[29.02191,-21.90647],[29.04023,-21.85864],[29.07763,-21.81877],[28.58114,-21.63455],[28.49942,-21.66634],[28.29416,-21.59037],[28.01669,-21.57624],[27.91407,-21.31621],[27.69171,-21.08409],[27.72972,-20.51735],[27.69361,-20.48531],[27.28865,-20.49873],[27.29831,-20.28935],[27.21278,-20.08244],[26.72246,-19.92707],[26.17227,-19.53709],[25.96226,-19.08152],[25.99837,-19.02943],[25.94326,-18.90362],[25.82353,-18.82808],[25.79217,-18.6355],[25.68859,-18.56165],[25.53465,-18.39041],[25.39972,-18.12691],[25.31799,-18.07091],[25.23909,-17.90832],[25.26433,-17.79571]]]]}},{type:"Feature",properties:{iso1A2:"BY",iso1A3:"BLR",iso1N3:"112",wikidata:"Q184",nameEn:"Belarus",groups:["151","150","UN"],callingCodes:["375"]},geometry:{type:"MultiPolygon",coordinates:[[[[28.15217,56.16964],[27.97865,56.11849],[27.63065,55.89687],[27.61683,55.78558],[27.3541,55.8089],[27.27804,55.78299],[27.1559,55.85032],[26.97153,55.8102],[26.87448,55.7172],[26.76872,55.67658],[26.71802,55.70645],[26.64888,55.70515],[26.63231,55.67968],[26.63167,55.57887],[26.55094,55.5093],[26.5522,55.40277],[26.44937,55.34832],[26.5709,55.32572],[26.6714,55.33902],[26.80929,55.31642],[26.83266,55.30444],[26.835,55.28182],[26.73017,55.24226],[26.72983,55.21788],[26.68075,55.19787],[26.69243,55.16718],[26.54753,55.14181],[26.51481,55.16051],[26.46249,55.12814],[26.35121,55.1525],[26.30628,55.12536],[26.23202,55.10439],[26.26941,55.08032],[26.20397,54.99729],[26.13386,54.98924],[26.05907,54.94631],[25.99129,54.95705],[25.89462,54.93438],[25.74122,54.80108],[25.75977,54.57252],[25.68045,54.5321],[25.64813,54.48704],[25.62203,54.4656],[25.63371,54.42075],[25.5376,54.33158],[25.55425,54.31591],[25.68513,54.31727],[25.78553,54.23327],[25.78563,54.15747],[25.71084,54.16704],[25.64875,54.1259],[25.54724,54.14925],[25.51452,54.17799],[25.56823,54.25212],[25.509,54.30267],[25.35559,54.26544],[25.22705,54.26271],[25.19199,54.219],[25.0728,54.13419],[24.991,54.14241],[24.96894,54.17589],[24.77131,54.11091],[24.85311,54.02862],[24.74279,53.96663],[24.69185,53.96543],[24.69652,54.01901],[24.62275,54.00217],[24.44411,53.90076],[24.34128,53.90076],[24.19638,53.96405],[23.98837,53.92554],[23.95098,53.9613],[23.81309,53.94205],[23.80543,53.89558],[23.71726,53.93379],[23.61677,53.92691],[23.51284,53.95052],[23.62004,53.60942],[23.81995,53.24131],[23.85657,53.22923],[23.91393,53.16469],[23.87548,53.0831],[23.92184,53.02079],[23.94689,52.95919],[23.91805,52.94016],[23.93763,52.71332],[23.73615,52.6149],[23.58296,52.59868],[23.45112,52.53774],[23.34141,52.44845],[23.18196,52.28812],[23.20071,52.22848],[23.47859,52.18215],[23.54314,52.12148],[23.61,52.11264],[23.64066,52.07626],[23.68733,51.9906],[23.61523,51.92066],[23.62691,51.78208],[23.53198,51.74298],[23.57053,51.55938],[23.56236,51.53673],[23.62751,51.50512],[23.6736,51.50255],[23.60906,51.62122],[23.7766,51.66809],[23.91118,51.63316],[23.8741,51.59734],[23.99907,51.58369],[24.13075,51.66979],[24.3163,51.75063],[24.29021,51.80841],[24.37123,51.88222],[24.98784,51.91273],[25.20228,51.97143],[25.46163,51.92205],[25.73673,51.91973],[25.80574,51.94556],[25.83217,51.92587],[26.00408,51.92967],[26.19084,51.86781],[26.39367,51.87315],[26.46962,51.80501],[26.69759,51.82284],[26.80043,51.75777],[26.9489,51.73788],[26.99422,51.76933],[27.20602,51.77291],[27.20948,51.66713],[27.26613,51.65957],[27.24828,51.60161],[27.47212,51.61184],[27.51058,51.5854],[27.55727,51.63486],[27.71932,51.60672],[27.67125,51.50854],[27.76052,51.47604],[27.85253,51.62293],[27.91844,51.61952],[27.95827,51.56065],[28.10658,51.57857],[28.23452,51.66988],[28.37592,51.54505],[28.47051,51.59734],[28.64429,51.5664],[28.69161,51.44695],[28.73143,51.46236],[28.75615,51.41442],[28.78224,51.45294],[28.76027,51.48802],[28.81795,51.55552],[28.95528,51.59222],[28.99098,51.56833],[29.1187,51.65872],[29.16402,51.64679],[29.20659,51.56918],[29.25603,51.57089],[29.25191,51.49828],[29.32881,51.37843],[29.42357,51.4187],[29.49773,51.39814],[29.54372,51.48372],[29.7408,51.53417],[29.77376,51.4461],[30.17888,51.51025],[30.34642,51.42555],[30.36153,51.33984],[30.56203,51.25655],[30.64992,51.35014],[30.51946,51.59649],[30.68804,51.82806],[30.76443,51.89739],[30.90897,52.00699],[30.95589,52.07775],[31.13332,52.1004],[31.25142,52.04131],[31.38326,52.12991],[31.7822,52.11406],[31.77877,52.18636],[31.6895,52.1973],[31.70735,52.26711],[31.57971,52.32146],[31.62084,52.33849],[31.61397,52.48843],[31.56316,52.51518],[31.63869,52.55361],[31.50406,52.69707],[31.57277,52.71613],[31.592,52.79011],[31.35667,52.97854],[31.24147,53.031],[31.32283,53.04101],[31.33519,53.08805],[31.3915,53.09712],[31.36403,53.13504],[31.40523,53.21406],[31.56316,53.19432],[31.62496,53.22886],[31.787,53.18033],[31.82373,53.10042],[32.15368,53.07594],[32.40773,53.18856],[32.51725,53.28431],[32.73257,53.33494],[32.74968,53.45597],[32.47777,53.5548],[32.40499,53.6656],[32.50112,53.68594],[32.45717,53.74039],[32.36663,53.7166],[32.12621,53.81586],[31.89137,53.78099],[31.77028,53.80015],[31.85019,53.91801],[31.88744,54.03653],[31.89599,54.0837],[31.57002,54.14535],[31.30791,54.25315],[31.3177,54.34067],[31.22945,54.46585],[31.08543,54.50361],[31.21399,54.63113],[31.19339,54.66947],[30.99187,54.67046],[30.98226,54.68872],[31.0262,54.70698],[30.97127,54.71967],[30.95479,54.74346],[30.75165,54.80699],[30.8264,54.90062],[30.81759,54.94064],[30.93144,54.9585],[30.95754,54.98609],[30.9081,55.02232],[30.94243,55.03964],[31.00972,55.02783],[31.02071,55.06167],[30.97369,55.17134],[30.87944,55.28223],[30.81946,55.27931],[30.8257,55.3313],[30.93144,55.3914],[30.90123,55.46621],[30.95204,55.50667],[30.93419,55.6185],[30.86003,55.63169],[30.7845,55.58514],[30.72957,55.66268],[30.67464,55.64176],[30.63344,55.73079],[30.51037,55.76568],[30.51346,55.78982],[30.48257,55.81066],[30.30987,55.83592],[30.27776,55.86819],[30.12136,55.8358],[29.97975,55.87281],[29.80672,55.79569],[29.61446,55.77716],[29.51283,55.70294],[29.3604,55.75862],[29.44692,55.95978],[29.21717,55.98971],[29.08299,56.03427],[28.73418,55.97131],[28.63668,56.07262],[28.68337,56.10173],[28.5529,56.11705],[28.43068,56.09407],[28.37987,56.11399],[28.36888,56.05805],[28.30571,56.06035],[28.15217,56.16964]]]]}},{type:"Feature",properties:{iso1A2:"BZ",iso1A3:"BLZ",iso1N3:"084",wikidata:"Q242",nameEn:"Belize",groups:["013","003","419","019","UN"],roadSpeedUnit:"mph",callingCodes:["501"]},geometry:{type:"MultiPolygon",coordinates:[[[[-88.3268,18.49048],[-88.48242,18.49164],[-88.71505,18.0707],[-88.8716,17.89535],[-89.03839,18.0067],[-89.15105,17.95104],[-89.14985,17.81563],[-89.15025,17.04813],[-89.22683,15.88619],[-89.17418,15.90898],[-89.02415,15.9063],[-88.95358,15.88698],[-88.40779,16.09624],[-86.92368,17.61462],[-87.84815,18.18511],[-87.85693,18.18266],[-87.86657,18.19971],[-87.87604,18.18313],[-87.90671,18.15213],[-88.03165,18.16657],[-88.03238,18.41778],[-88.26593,18.47617],[-88.29909,18.47591],[-88.3268,18.49048]]]]}},{type:"Feature",properties:{iso1A2:"CA",iso1A3:"CAN",iso1N3:"124",wikidata:"Q16",nameEn:"Canada",groups:["021","003","019","UN"],callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-67.20349,45.1722],[-67.19603,45.16771],[-67.15965,45.16179],[-67.11316,45.11176],[-67.0216,44.95333],[-66.96824,44.90965],[-66.98249,44.87071],[-66.96824,44.83078],[-66.93432,44.82597],[-67.16117,44.20069],[-61.98255,37.34815],[-56.27503,47.39728],[-53.12387,41.40385],[-46.37635,57.3249],[-77.52957,77.23408],[-68.21821,80.48551],[-49.33696,84.57952],[-140.97446,84.39275],[-141.00116,60.30648],[-140.5227,60.22077],[-140.45648,60.30919],[-139.98024,60.18027],[-139.68991,60.33693],[-139.05831,60.35205],[-139.20603,60.08896],[-139.05365,59.99655],[-138.71149,59.90728],[-138.62145,59.76431],[-137.60623,59.24465],[-137.4925,58.89415],[-136.82619,59.16198],[-136.52365,59.16752],[-136.47323,59.46617],[-136.33727,59.44466],[-136.22381,59.55526],[-136.31566,59.59083],[-135.48007,59.79937],[-135.03069,59.56208],[-135.00267,59.28745],[-134.7047,59.2458],[-134.55699,59.1297],[-134.48059,59.13231],[-134.27175,58.8634],[-133.84645,58.73543],[-133.38523,58.42773],[-131.8271,56.62247],[-130.77769,56.36185],[-130.33965,56.10849],[-130.10173,56.12178],[-130.00093,56.00325],[-130.00857,55.91344],[-130.15373,55.74895],[-129.97513,55.28029],[-130.08035,55.21556],[-130.18765,55.07744],[-130.27203,54.97174],[-130.44184,54.85377],[-130.64499,54.76912],[-130.61931,54.70835],[-133.92876,54.62289],[-133.36909,48.51151],[-125.03842,48.53282],[-123.50039,48.21223],[-123.15614,48.35395],[-123.26565,48.6959],[-123.0093,48.76586],[-123.0093,48.83186],[-123.32163,49.00419],[-95.15355,48.9996],[-95.15357,49.384],[-95.12903,49.37056],[-95.05825,49.35311],[-95.01419,49.35647],[-94.99532,49.36579],[-94.95681,49.37035],[-94.85381,49.32492],[-94.8159,49.32299],[-94.82487,49.29483],[-94.77355,49.11998],[-94.75017,49.09931],[-94.687,48.84077],[-94.70087,48.8339],[-94.70486,48.82365],[-94.69669,48.80918],[-94.69335,48.77883],[-94.58903,48.71803],[-94.54885,48.71543],[-94.53826,48.70216],[-94.44258,48.69223],[-94.4174,48.71049],[-94.27153,48.70232],[-94.25172,48.68404],[-94.25104,48.65729],[-94.23215,48.65202],[-93.85769,48.63284],[-93.83288,48.62745],[-93.80676,48.58232],[-93.80939,48.52439],[-93.79267,48.51631],[-93.66382,48.51845],[-93.47022,48.54357],[-93.44472,48.59147],[-93.40693,48.60948],[-93.39758,48.60364],[-93.3712,48.60599],[-93.33946,48.62787],[-93.25391,48.64266],[-92.94973,48.60866],[-92.7287,48.54005],[-92.6342,48.54133],[-92.62747,48.50278],[-92.69927,48.49573],[-92.71323,48.46081],[-92.65606,48.43471],[-92.50712,48.44921],[-92.45588,48.40624],[-92.48147,48.36609],[-92.37185,48.22259],[-92.27167,48.25046],[-92.30939,48.31251],[-92.26662,48.35651],[-92.202,48.35252],[-92.14732,48.36578],[-92.05339,48.35958],[-91.98929,48.25409],[-91.86125,48.21278],[-91.71231,48.19875],[-91.70451,48.11805],[-91.55649,48.10611],[-91.58025,48.04339],[-91.45829,48.07454],[-91.43248,48.04912],[-91.25025,48.08522],[-91.08016,48.18096],[-90.87588,48.2484],[-90.75045,48.09143],[-90.56444,48.12184],[-90.56312,48.09488],[-90.07418,48.11043],[-89.89974,47.98109],[-89.77248,48.02607],[-89.57972,48.00023],[-89.48837,48.01412],[-88.37033,48.30586],[-84.85871,46.88881],[-84.55635,46.45974],[-84.47607,46.45225],[-84.4481,46.48972],[-84.42101,46.49853],[-84.34174,46.50683],[-84.29893,46.49127],[-84.26351,46.49508],[-84.2264,46.53337],[-84.1945,46.54061],[-84.17723,46.52753],[-84.12885,46.53068],[-84.11196,46.50248],[-84.13451,46.39218],[-84.11254,46.32329],[-84.11615,46.2681],[-84.09756,46.25512],[-84.1096,46.23987],[-83.95399,46.05634],[-83.90453,46.05922],[-83.83329,46.12169],[-83.57017,46.105],[-83.43746,45.99749],[-83.59589,45.82131],[-82.48419,45.30225],[-82.42469,42.992],[-82.4146,42.97626],[-82.4253,42.95423],[-82.45331,42.93139],[-82.4826,42.8068],[-82.46613,42.76615],[-82.51063,42.66025],[-82.51858,42.611],[-82.57583,42.5718],[-82.58873,42.54984],[-82.64242,42.55594],[-82.82964,42.37355],[-83.02253,42.33045],[-83.07837,42.30978],[-83.09837,42.28877],[-83.12724,42.2376],[-83.14962,42.04089],[-83.11184,41.95671],[-82.67862,41.67615],[-78.93684,42.82887],[-78.90712,42.89733],[-78.90905,42.93022],[-78.93224,42.95229],[-78.96312,42.95509],[-78.98126,42.97],[-79.02074,42.98444],[-79.02424,43.01983],[-78.99941,43.05612],[-79.01055,43.06659],[-79.07486,43.07845],[-79.05671,43.10937],[-79.06881,43.12029],[-79.0427,43.13934],[-79.04652,43.16396],[-79.05384,43.17418],[-79.05002,43.20133],[-79.05544,43.21224],[-79.05512,43.25375],[-79.06921,43.26183],[-79.25796,43.54052],[-76.79706,43.63099],[-76.43859,44.09393],[-76.35324,44.13493],[-76.31222,44.19894],[-76.244,44.19643],[-76.1664,44.23051],[-76.16285,44.28262],[-76.00018,44.34896],[-75.95947,44.34463],[-75.8217,44.43176],[-75.76813,44.51537],[-75.41441,44.76614],[-75.2193,44.87821],[-75.01363,44.95608],[-74.99101,44.98051],[-74.8447,45.00606],[-74.66689,45.00646],[-74.32699,44.99029],[-73.35025,45.00942],[-71.50067,45.01357],[-71.48735,45.07784],[-71.42778,45.12624],[-71.40364,45.21382],[-71.44252,45.2361],[-71.37133,45.24624],[-71.29371,45.29996],[-71.22338,45.25184],[-71.19723,45.25438],[-71.14568,45.24128],[-71.08364,45.30623],[-71.01866,45.31573],[-71.0107,45.34819],[-70.95193,45.33895],[-70.91169,45.29849],[-70.89864,45.2398],[-70.84816,45.22698],[-70.80236,45.37444],[-70.82638,45.39828],[-70.78372,45.43269],[-70.65383,45.37592],[-70.62518,45.42286],[-70.72651,45.49771],[-70.68516,45.56964],[-70.54019,45.67291],[-70.38934,45.73215],[-70.41523,45.79497],[-70.25976,45.89675],[-70.24694,45.95138],[-70.31025,45.96424],[-70.23855,46.1453],[-70.29078,46.18832],[-70.18547,46.35357],[-70.05812,46.41768],[-69.99966,46.69543],[-69.22119,47.46461],[-69.05148,47.42012],[-69.05073,47.30076],[-69.05039,47.2456],[-68.89222,47.1807],[-68.70125,47.24399],[-68.60575,47.24659],[-68.57914,47.28431],[-68.38332,47.28723],[-68.37458,47.35851],[-68.23244,47.35712],[-67.94843,47.1925],[-67.87993,47.10377],[-67.78578,47.06473],[-67.78111,45.9392],[-67.75196,45.91814],[-67.80961,45.87531],[-67.75654,45.82324],[-67.80653,45.80022],[-67.80705,45.69528],[-67.6049,45.60725],[-67.43815,45.59162],[-67.42144,45.50584],[-67.50578,45.48971],[-67.42394,45.37969],[-67.48201,45.27351],[-67.34927,45.122],[-67.29754,45.14865],[-67.29748,45.18173],[-67.27039,45.1934],[-67.22751,45.16344],[-67.20349,45.1722]]]]}},{type:"Feature",properties:{iso1A2:"CC",iso1A3:"CCK",iso1N3:"166",wikidata:"Q36004",nameEn:"Cocos (Keeling) Islands",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[96.61846,-10.82438],[96.02343,-12.68334],[97.93979,-12.33309],[96.61846,-10.82438]]]]}},{type:"Feature",properties:{iso1A2:"CD",iso1A3:"COD",iso1N3:"180",wikidata:"Q974",nameEn:"Democratic Republic of the Congo",aliases:["ZR"],groups:["017","202","002","UN"],callingCodes:["243"]},geometry:{type:"MultiPolygon",coordinates:[[[[27.44012,5.07349],[27.09575,5.22305],[26.93064,5.13535],[26.85579,5.03887],[26.74572,5.10685],[26.48595,5.04984],[26.13371,5.25594],[25.86073,5.19455],[25.53271,5.37431],[25.34558,5.29101],[25.31256,5.03668],[24.71816,4.90509],[24.46719,5.0915],[23.38847,4.60013],[22.94817,4.82392],[22.89094,4.79321],[22.84691,4.69887],[22.78526,4.71423],[22.6928,4.47285],[22.60915,4.48821],[22.5431,4.22041],[22.45504,4.13039],[22.27682,4.11347],[22.10721,4.20723],[21.6405,4.317],[21.55904,4.25553],[21.25744,4.33676],[21.21341,4.29285],[21.11214,4.33895],[21.08793,4.39603],[20.90383,4.44877],[20.60184,4.42394],[18.62755,3.47564],[18.63857,3.19342],[18.10683,2.26876],[18.08034,1.58553],[17.85887,1.04327],[17.86989,.58873],[17.95255,.48128],[17.93877,.32424],[17.81204,.23884],[17.66051,-.26535],[17.72112,-.52707],[17.32438,-.99265],[16.97999,-1.12762],[16.70724,-1.45815],[16.50336,-1.8795],[16.16173,-2.16586],[16.22785,-2.59528],[16.1755,-3.25014],[16.21407,-3.2969],[15.89448,-3.9513],[15.53081,-4.042],[15.48121,-4.22062],[15.41785,-4.28381],[15.32693,-4.27282],[15.25411,-4.31121],[15.1978,-4.32388],[14.83101,-4.80838],[14.67948,-4.92093],[14.5059,-4.84956],[14.41499,-4.8825],[14.37366,-4.56125],[14.47284,-4.42941],[14.3957,-4.36623],[14.40672,-4.28381],[13.9108,-4.50906],[13.81162,-4.41842],[13.71794,-4.44864],[13.70417,-4.72601],[13.50305,-4.77818],[13.41764,-4.89897],[13.11182,-4.5942],[13.09648,-4.63739],[13.11195,-4.67745],[12.8733,-4.74346],[12.70868,-4.95505],[12.63465,-4.94632],[12.60251,-5.01715],[12.46297,-5.09408],[12.49815,-5.14058],[12.51589,-5.1332],[12.53586,-5.14658],[12.53599,-5.1618],[12.52301,-5.17481],[12.52318,-5.74353],[12.26557,-5.74031],[12.20376,-5.76338],[11.95767,-5.94705],[12.42245,-6.07585],[13.04371,-5.87078],[16.55507,-5.85631],[16.96282,-7.21787],[17.5828,-8.13784],[18.33635,-8.00126],[19.33698,-7.99743],[19.5469,-7.00195],[20.30218,-6.98955],[20.31846,-6.91953],[20.61689,-6.90876],[20.56263,-7.28566],[21.79824,-7.29628],[21.84856,-9.59871],[22.19039,-9.94628],[22.32604,-10.76291],[22.17954,-10.85884],[22.25951,-11.24911],[22.54205,-11.05784],[23.16602,-11.10577],[23.45631,-10.946],[23.86868,-11.02856],[24.00027,-10.89356],[24.34528,-11.06816],[24.42612,-11.44975],[25.34069,-11.19707],[25.33058,-11.65767],[26.01777,-11.91488],[26.88687,-12.01868],[27.04351,-11.61312],[27.22541,-11.60323],[27.21025,-11.76157],[27.59932,-12.22123],[28.33199,-12.41375],[29.01918,-13.41353],[29.60531,-13.21685],[29.65078,-13.41844],[29.81551,-13.44683],[29.8139,-12.14898],[29.48404,-12.23604],[29.4992,-12.43843],[29.18592,-12.37921],[28.48357,-11.87532],[28.37241,-11.57848],[28.65032,-10.65133],[28.62795,-9.92942],[28.68532,-9.78],[28.56208,-9.49122],[28.51627,-9.44726],[28.52636,-9.35379],[28.36562,-9.30091],[28.38526,-9.23393],[28.9711,-8.66935],[28.88917,-8.4831],[30.79243,-8.27382],[30.2567,-7.14121],[29.52552,-6.2731],[29.43673,-4.44845],[29.23708,-3.75856],[29.21463,-3.3514],[29.25633,-3.05471],[29.17258,-2.99385],[29.16037,-2.95457],[29.09797,-2.91935],[29.09119,-2.87871],[29.0505,-2.81774],[29.00404,-2.81978],[29.00167,-2.78523],[29.04081,-2.7416],[29.00357,-2.70596],[28.94346,-2.69124],[28.89793,-2.66111],[28.90226,-2.62385],[28.89288,-2.55848],[28.87943,-2.55165],[28.86193,-2.53185],[28.86209,-2.5231],[28.87497,-2.50887],[28.88846,-2.50493],[28.89342,-2.49017],[28.89132,-2.47557],[28.86846,-2.44866],[28.86826,-2.41888],[28.89601,-2.37321],[28.95642,-2.37321],[29.00051,-2.29001],[29.105,-2.27043],[29.17562,-2.12278],[29.11847,-1.90576],[29.24458,-1.69663],[29.24323,-1.66826],[29.36322,-1.50887],[29.45038,-1.5054],[29.53062,-1.40499],[29.59061,-1.39016],[29.58388,-.89821],[29.63006,-.8997],[29.62708,-.71055],[29.67176,-.55714],[29.67474,-.47969],[29.65091,-.46777],[29.72687,-.08051],[29.7224,.07291],[29.77454,.16675],[29.81922,.16824],[29.87284,.39166],[29.97413,.52124],[29.95477,.64486],[29.98307,.84295],[30.1484,.89805],[30.22139,.99635],[30.24671,1.14974],[30.48503,1.21675],[31.30127,2.11006],[31.28042,2.17853],[31.20148,2.2217],[31.1985,2.29462],[31.12104,2.27676],[31.07934,2.30207],[31.06593,2.35862],[30.96911,2.41071],[30.91102,2.33332],[30.83059,2.42559],[30.74271,2.43601],[30.75612,2.5863],[30.8857,2.83923],[30.8574,2.9508],[30.77101,3.04897],[30.84251,3.26908],[30.93486,3.40737],[30.94081,3.50847],[30.85153,3.48867],[30.85997,3.5743],[30.80713,3.60506],[30.78512,3.67097],[30.56277,3.62703],[30.57378,3.74567],[30.55396,3.84451],[30.47691,3.83353],[30.27658,3.95653],[30.22374,3.93896],[30.1621,4.10586],[30.06964,4.13221],[29.79666,4.37809],[29.82087,4.56246],[29.49726,4.7007],[29.43341,4.50101],[29.22207,4.34297],[29.03054,4.48784],[28.8126,4.48784],[28.6651,4.42638],[28.20719,4.35614],[27.79551,4.59976],[27.76469,4.79284],[27.65462,4.89375],[27.56656,4.89375],[27.44012,5.07349]]]]}},{type:"Feature",properties:{iso1A2:"CF",iso1A3:"CAF",iso1N3:"140",wikidata:"Q929",nameEn:"Central African Republic",groups:["017","202","002","UN"],callingCodes:["236"]},geometry:{type:"MultiPolygon",coordinates:[[[[22.87758,10.91915],[22.45889,11.00246],[21.72139,10.64136],[21.71479,10.29932],[21.63553,10.217],[21.52766,10.2105],[21.34934,9.95907],[21.26348,9.97642],[20.82979,9.44696],[20.36748,9.11019],[19.06421,9.00367],[18.86388,8.87971],[19.11044,8.68172],[18.79783,8.25929],[18.67455,8.22226],[18.62612,8.14163],[18.64153,8.08714],[18.6085,8.05009],[18.02731,8.01085],[17.93926,7.95853],[17.67288,7.98905],[16.8143,7.53971],[16.6668,7.67281],[16.658,7.75353],[16.59415,7.76444],[16.58315,7.88657],[16.41583,7.77971],[16.40703,7.68809],[15.79942,7.44149],[15.73118,7.52006],[15.49743,7.52179],[15.23397,7.25135],[15.04717,6.77085],[14.96311,6.75693],[14.79966,6.39043],[14.80122,6.34866],[14.74206,6.26356],[14.56149,6.18928],[14.43073,6.08867],[14.42917,6.00508],[14.49455,5.91683],[14.60974,5.91838],[14.62375,5.70466],[14.58951,5.59777],[14.62531,5.51411],[14.52724,5.28319],[14.57083,5.23979],[14.65489,5.21343],[14.73383,4.6135],[15.00825,4.41458],[15.08609,4.30282],[15.10644,4.1362],[15.17482,4.05131],[15.07686,4.01805],[15.73522,3.24348],[15.77725,3.26835],[16.05449,3.02306],[16.08252,2.45708],[16.19357,2.21537],[16.50126,2.84739],[16.46701,2.92512],[16.57598,3.47999],[16.68283,3.54257],[17.01746,3.55136],[17.35649,3.63045],[17.46876,3.70515],[17.60966,3.63705],[17.83421,3.61068],[17.85842,3.53378],[18.05656,3.56893],[18.14902,3.54476],[18.17323,3.47665],[18.24148,3.50302],[18.2723,3.57992],[18.39558,3.58212],[18.49245,3.63924],[18.58711,3.49423],[18.62755,3.47564],[20.60184,4.42394],[20.90383,4.44877],[21.08793,4.39603],[21.11214,4.33895],[21.21341,4.29285],[21.25744,4.33676],[21.55904,4.25553],[21.6405,4.317],[22.10721,4.20723],[22.27682,4.11347],[22.45504,4.13039],[22.5431,4.22041],[22.60915,4.48821],[22.6928,4.47285],[22.78526,4.71423],[22.84691,4.69887],[22.89094,4.79321],[22.94817,4.82392],[23.38847,4.60013],[24.46719,5.0915],[24.71816,4.90509],[25.31256,5.03668],[25.34558,5.29101],[25.53271,5.37431],[25.86073,5.19455],[26.13371,5.25594],[26.48595,5.04984],[26.74572,5.10685],[26.85579,5.03887],[26.93064,5.13535],[27.09575,5.22305],[27.44012,5.07349],[27.26886,5.25876],[27.23017,5.37167],[27.28621,5.56382],[27.22705,5.62889],[27.22705,5.71254],[26.51721,6.09655],[26.58259,6.1987],[26.32729,6.36272],[26.38022,6.63493],[25.90076,7.09549],[25.37461,7.33024],[25.35281,7.42595],[25.20337,7.50312],[25.20649,7.61115],[25.29214,7.66675],[25.25319,7.8487],[24.98855,7.96588],[24.85156,8.16933],[24.35965,8.26177],[24.13238,8.36959],[24.25691,8.69288],[23.51905,8.71749],[23.59065,8.99743],[23.44744,8.99128],[23.4848,9.16959],[23.56263,9.19418],[23.64358,9.28637],[23.64981,9.44303],[23.62179,9.53823],[23.69155,9.67566],[23.67164,9.86923],[23.3128,10.45214],[23.02221,10.69235],[22.87758,10.91915]]]]}},{type:"Feature",properties:{iso1A2:"CG",iso1A3:"COG",iso1N3:"178",wikidata:"Q971",nameEn:"Republic of the Congo",groups:["017","202","002","UN"],callingCodes:["242"]},geometry:{type:"MultiPolygon",coordinates:[[[[18.62755,3.47564],[18.58711,3.49423],[18.49245,3.63924],[18.39558,3.58212],[18.2723,3.57992],[18.24148,3.50302],[18.17323,3.47665],[18.14902,3.54476],[18.05656,3.56893],[17.85842,3.53378],[17.83421,3.61068],[17.60966,3.63705],[17.46876,3.70515],[17.35649,3.63045],[17.01746,3.55136],[16.68283,3.54257],[16.57598,3.47999],[16.46701,2.92512],[16.50126,2.84739],[16.19357,2.21537],[16.15568,2.18955],[16.08563,2.19733],[16.05294,1.9811],[16.14634,1.70259],[16.02647,1.65591],[16.02959,1.76483],[15.48942,1.98265],[15.34776,1.91264],[15.22634,2.03243],[15.00996,1.98887],[14.61145,2.17866],[13.29457,2.16106],[13.13461,1.57238],[13.25447,1.32339],[13.15519,1.23368],[13.89582,1.4261],[14.25186,1.39842],[14.48179,.9152],[14.26066,.57255],[14.10909,.58563],[13.88648,.26652],[13.90632,-.2287],[14.06862,-.20826],[14.2165,-.38261],[14.41887,-.44799],[14.52569,-.57818],[14.41838,-1.89412],[14.25932,-1.97624],[14.23518,-2.15671],[14.16202,-2.23916],[14.23829,-2.33715],[14.10442,-2.49268],[13.85846,-2.46935],[13.92073,-2.35581],[13.75884,-2.09293],[13.47977,-2.43224],[13.02759,-2.33098],[12.82172,-1.91091],[12.61312,-1.8129],[12.44656,-1.92025],[12.47925,-2.32626],[12.04895,-2.41704],[11.96866,-2.33559],[11.74605,-2.39936],[11.57637,-2.33379],[11.64487,-2.61865],[11.5359,-2.85654],[11.64798,-2.81146],[11.80365,-3.00424],[11.70558,-3.0773],[11.70227,-3.17465],[11.96554,-3.30267],[11.8318,-3.5812],[11.92719,-3.62768],[11.87083,-3.71571],[11.68608,-3.68942],[11.57949,-3.52798],[11.48764,-3.51089],[11.22301,-3.69888],[11.12647,-3.94169],[10.75913,-4.39519],[11.50888,-5.33417],[12.00924,-5.02627],[12.16068,-4.90089],[12.20901,-4.75642],[12.25587,-4.79437],[12.32324,-4.78415],[12.40964,-4.60609],[12.64835,-4.55937],[12.76844,-4.38709],[12.87096,-4.40315],[12.91489,-4.47907],[13.09648,-4.63739],[13.11182,-4.5942],[13.41764,-4.89897],[13.50305,-4.77818],[13.70417,-4.72601],[13.71794,-4.44864],[13.81162,-4.41842],[13.9108,-4.50906],[14.40672,-4.28381],[14.3957,-4.36623],[14.47284,-4.42941],[14.37366,-4.56125],[14.41499,-4.8825],[14.5059,-4.84956],[14.67948,-4.92093],[14.83101,-4.80838],[15.1978,-4.32388],[15.25411,-4.31121],[15.32693,-4.27282],[15.41785,-4.28381],[15.48121,-4.22062],[15.53081,-4.042],[15.89448,-3.9513],[16.21407,-3.2969],[16.1755,-3.25014],[16.22785,-2.59528],[16.16173,-2.16586],[16.50336,-1.8795],[16.70724,-1.45815],[16.97999,-1.12762],[17.32438,-.99265],[17.72112,-.52707],[17.66051,-.26535],[17.81204,.23884],[17.93877,.32424],[17.95255,.48128],[17.86989,.58873],[17.85887,1.04327],[18.08034,1.58553],[18.10683,2.26876],[18.63857,3.19342],[18.62755,3.47564]]]]}},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[8.72809,47.69282],[8.72617,47.69651],[8.73671,47.7169],[8.70543,47.73121],[8.74251,47.75168],[8.71778,47.76571],[8.68985,47.75686],[8.68022,47.78599],[8.65292,47.80066],[8.64425,47.76398],[8.62408,47.7626],[8.61657,47.79998],[8.56415,47.80633],[8.56814,47.78001],[8.48868,47.77215],[8.45771,47.7493],[8.44807,47.72426],[8.40569,47.69855],[8.4211,47.68407],[8.40473,47.67499],[8.41346,47.66676],[8.42264,47.66667],[8.44711,47.65379],[8.4667,47.65747],[8.46605,47.64103],[8.49656,47.64709],[8.5322,47.64687],[8.52801,47.66059],[8.56141,47.67088],[8.57683,47.66158],[8.6052,47.67258],[8.61113,47.66332],[8.62884,47.65098],[8.62049,47.63757],[8.60412,47.63735],[8.61471,47.64514],[8.60701,47.65271],[8.59545,47.64298],[8.60348,47.61204],[8.57586,47.59537],[8.55756,47.62394],[8.51686,47.63476],[8.50747,47.61897],[8.45578,47.60121],[8.46637,47.58389],[8.48949,47.588],[8.49431,47.58107],[8.43235,47.56617],[8.39477,47.57826],[8.38273,47.56608],[8.35512,47.57014],[8.32735,47.57133],[8.30277,47.58607],[8.29524,47.5919],[8.29722,47.60603],[8.2824,47.61225],[8.26313,47.6103],[8.25863,47.61571],[8.23809,47.61204],[8.22577,47.60385],[8.22011,47.6181],[8.20617,47.62141],[8.19378,47.61636],[8.1652,47.5945],[8.14947,47.59558],[8.13823,47.59147],[8.13662,47.58432],[8.11543,47.5841],[8.10395,47.57918],[8.10002,47.56504],[8.08557,47.55768],[8.06663,47.56374],[8.04383,47.55443],[8.02136,47.55096],[8.00113,47.55616],[7.97581,47.55493],[7.95682,47.55789],[7.94494,47.54511],[7.91251,47.55031],[7.90673,47.57674],[7.88664,47.58854],[7.84412,47.5841],[7.81901,47.58798],[7.79486,47.55691],[7.75261,47.54599],[7.71961,47.54219],[7.69642,47.53297],[7.68101,47.53232],[7.6656,47.53752],[7.66174,47.54554],[7.65083,47.54662],[7.63338,47.56256],[7.67655,47.56435],[7.68904,47.57133],[7.67115,47.5871],[7.68486,47.59601],[7.69385,47.60099],[7.68229,47.59905],[7.67395,47.59212],[7.64599,47.59695],[7.64213,47.5944],[7.64309,47.59151],[7.61929,47.57683],[7.60459,47.57869],[7.60523,47.58519],[7.58945,47.59017],[7.58386,47.57536],[7.56684,47.57785],[7.56548,47.57617],[7.55689,47.57232],[7.55652,47.56779],[7.53634,47.55553],[7.52831,47.55347],[7.51723,47.54578],[7.50873,47.54546],[7.49691,47.53821],[7.50588,47.52856],[7.51904,47.53515],[7.53199,47.5284],[7.5229,47.51644],[7.49804,47.51798],[7.51076,47.49651],[7.47534,47.47932],[7.43356,47.49712],[7.42923,47.48628],[7.4583,47.47216],[7.4462,47.46264],[7.43088,47.45846],[7.40308,47.43638],[7.35603,47.43432],[7.33526,47.44186],[7.24669,47.4205],[7.17026,47.44312],[7.19583,47.49455],[7.16249,47.49025],[7.12781,47.50371],[7.07425,47.48863],[7.0231,47.50522],[6.98425,47.49432],[7.0024,47.45264],[6.93953,47.43388],[6.93744,47.40714],[6.88542,47.37262],[6.87959,47.35335],[7.03125,47.36996],[7.0564,47.35134],[7.05305,47.33304],[6.94316,47.28747],[6.95108,47.26428],[6.9508,47.24338],[6.8489,47.15933],[6.76788,47.1208],[6.68823,47.06616],[6.71531,47.0494],[6.43341,46.92703],[6.46456,46.88865],[6.43216,46.80336],[6.45209,46.77502],[6.38351,46.73171],[6.27135,46.68251],[6.11084,46.57649],[6.1567,46.54402],[6.07269,46.46244],[6.08427,46.44305],[6.06407,46.41676],[6.09926,46.40768],[6.15016,46.3778],[6.15985,46.37721],[6.16987,46.36759],[6.15738,46.3491],[6.13876,46.33844],[6.1198,46.31157],[6.11697,46.29547],[6.1013,46.28512],[6.11926,46.2634],[6.12446,46.25059],[6.10071,46.23772],[6.08563,46.24651],[6.07072,46.24085],[6.0633,46.24583],[6.05029,46.23518],[6.04602,46.23127],[6.03342,46.2383],[6.02461,46.23313],[5.97542,46.21525],[5.96515,46.19638],[5.99573,46.18587],[5.98846,46.17046],[5.98188,46.17392],[5.97508,46.15863],[5.9641,46.14412],[5.95781,46.12925],[5.97893,46.13303],[5.9871,46.14499],[6.01791,46.14228],[6.03614,46.13712],[6.04564,46.14031],[6.05203,46.15191],[6.07491,46.14879],[6.09199,46.15191],[6.09926,46.14373],[6.13397,46.1406],[6.15305,46.15194],[6.18116,46.16187],[6.18871,46.16644],[6.18707,46.17999],[6.19552,46.18401],[6.19807,46.18369],[6.20539,46.19163],[6.21114,46.1927],[6.21273,46.19409],[6.21603,46.19507],[6.21844,46.19837],[6.22222,46.19888],[6.22175,46.20045],[6.23544,46.20714],[6.23913,46.20511],[6.24821,46.20531],[6.26007,46.21165],[6.27694,46.21566],[6.29663,46.22688],[6.31041,46.24417],[6.29474,46.26221],[6.26749,46.24745],[6.24952,46.26255],[6.23775,46.27822],[6.25137,46.29014],[6.24826,46.30175],[6.21981,46.31304],[6.25432,46.3632],[6.53358,46.45431],[6.82312,46.42661],[6.8024,46.39171],[6.77152,46.34784],[6.86052,46.28512],[6.78968,46.14058],[6.89321,46.12548],[6.87868,46.03855],[6.93862,46.06502],[7.00946,45.9944],[7.04151,45.92435],[7.10685,45.85653],[7.56343,45.97421],[7.85949,45.91485],[7.9049,45.99945],[7.98881,45.99867],[8.02906,46.10331],[8.11383,46.11577],[8.16866,46.17817],[8.08814,46.26692],[8.31162,46.38044],[8.30648,46.41587],[8.42464,46.46367],[8.46317,46.43712],[8.45032,46.26869],[8.62242,46.12112],[8.75697,46.10395],[8.80778,46.10085],[8.85617,46.0748],[8.79414,46.00913],[8.78585,45.98973],[8.79362,45.99207],[8.8319,45.9879],[8.85121,45.97239],[8.86688,45.96135],[8.88904,45.95465],[8.93649,45.86775],[8.94372,45.86587],[8.93504,45.86245],[8.91129,45.8388],[8.94737,45.84285],[8.9621,45.83707],[8.99663,45.83466],[9.00324,45.82055],[9.0298,45.82127],[9.03279,45.82865],[9.03793,45.83548],[9.03505,45.83976],[9.04059,45.8464],[9.04546,45.84968],[9.06642,45.8761],[9.09065,45.89906],[8.99257,45.9698],[9.01618,46.04928],[9.24503,46.23616],[9.29226,46.32717],[9.25502,46.43743],[9.28136,46.49685],[9.36128,46.5081],[9.40487,46.46621],[9.45936,46.50873],[9.46117,46.37481],[9.57015,46.2958],[9.71273,46.29266],[9.73086,46.35071],[9.95249,46.38045],[10.07055,46.21668],[10.14439,46.22992],[10.17862,46.25626],[10.10506,46.3372],[10.165,46.41051],[10.03715,46.44479],[10.10307,46.61003],[10.23674,46.63484],[10.25309,46.57432],[10.46136,46.53164],[10.49375,46.62049],[10.44686,46.64162],[10.40475,46.63671],[10.38659,46.67847],[10.47197,46.85698],[10.48376,46.93891],[10.36933,47.00212],[10.30031,46.92093],[10.24128,46.93147],[10.22675,46.86942],[10.10715,46.84296],[9.98058,46.91434],[9.88266,46.93343],[9.87935,47.01337],[9.60717,47.06091],[9.55721,47.04762],[9.54041,47.06495],[9.47548,47.05257],[9.47139,47.06402],[9.51362,47.08505],[9.52089,47.10019],[9.51044,47.13727],[9.48774,47.17402],[9.4891,47.19346],[9.50318,47.22153],[9.52406,47.24959],[9.53116,47.27029],[9.54773,47.2809],[9.55857,47.29919],[9.58513,47.31334],[9.59978,47.34671],[9.62476,47.36639],[9.65427,47.36824],[9.66243,47.37136],[9.6711,47.37824],[9.67445,47.38429],[9.67334,47.39191],[9.6629,47.39591],[9.65136,47.40504],[9.65043,47.41937],[9.6446,47.43233],[9.64483,47.43842],[9.65863,47.44847],[9.65728,47.45383],[9.6423,47.45599],[9.62475,47.45685],[9.62158,47.45858],[9.60841,47.47178],[9.60484,47.46358],[9.60205,47.46165],[9.59482,47.46305],[9.58208,47.48344],[9.56312,47.49495],[9.55125,47.53629],[9.25619,47.65939],[9.18203,47.65598],[9.17593,47.65399],[9.1755,47.65584],[9.1705,47.65513],[9.15181,47.66904],[9.13845,47.66389],[9.09891,47.67801],[9.02093,47.6868],[8.94093,47.65596],[8.89946,47.64769],[8.87625,47.65441],[8.87383,47.67045],[8.85065,47.68209],[8.86989,47.70504],[8.82002,47.71458],[8.80663,47.73821],[8.77309,47.72059],[8.76965,47.7075],[8.79966,47.70222],[8.79511,47.67462],[8.75856,47.68969],[8.72809,47.69282]],[[8.95861,45.96485],[8.96668,45.98436],[8.97741,45.98317],[8.97604,45.96151],[8.95861,45.96485]],[[8.70847,47.68904],[8.68985,47.69552],[8.66837,47.68437],[8.65769,47.68928],[8.67508,47.6979],[8.66416,47.71367],[8.70237,47.71453],[8.71773,47.69088],[8.70847,47.68904]]]]},properties:{iso1A2:"CH",iso1A3:"CHE",iso1N3:"756",wikidata:"Q39",nameEn:"Switzerland",groups:["155","150","UN"],callingCodes:["41"]}},{type:"Feature",properties:{iso1A2:"CI",iso1A3:"CIV",iso1N3:"384",wikidata:"Q1008",nameEn:"C\xF4te d'Ivoire",groups:["011","202","002","UN"],callingCodes:["225"]},geometry:{type:"MultiPolygon",coordinates:[[[[-7.52774,3.7105],[-3.34019,4.17519],[-3.10675,5.08515],[-3.11073,5.12675],[-3.063,5.13665],[-2.96554,5.10397],[-2.95261,5.12477],[-2.75502,5.10657],[-2.73074,5.1364],[-2.77625,5.34621],[-2.72737,5.34789],[-2.76614,5.60963],[-2.85378,5.65156],[-2.93132,5.62137],[-2.96671,5.6415],[-2.95323,5.71865],[-3.01896,5.71697],[-3.25999,6.62521],[-3.21954,6.74407],[-3.23327,6.81744],[-2.95438,7.23737],[-2.97822,7.27165],[-2.92339,7.60847],[-2.79467,7.86002],[-2.78395,7.94974],[-2.74819,7.92613],[-2.67787,8.02055],[-2.61232,8.02645],[-2.62901,8.11495],[-2.49037,8.20872],[-2.58243,8.7789],[-2.66357,9.01771],[-2.77799,9.04949],[-2.69814,9.22717],[-2.68802,9.49343],[-2.76494,9.40778],[-2.93012,9.57403],[-3.00765,9.74019],[-3.16609,9.85147],[-3.19306,9.93781],[-3.27228,9.84981],[-3.31779,9.91125],[-3.69703,9.94279],[-4.25999,9.76012],[-4.31392,9.60062],[-4.6426,9.70696],[-4.96621,9.89132],[-4.96453,9.99923],[-5.12465,10.29788],[-5.39602,10.2929],[-5.51058,10.43177],[-5.65135,10.46767],[-5.78124,10.43952],[-5.99478,10.19694],[-6.18851,10.24244],[-6.1731,10.46983],[-6.24795,10.74248],[-6.325,10.68624],[-6.40646,10.69922],[-6.42847,10.5694],[-6.52974,10.59104],[-6.63541,10.66893],[-6.68164,10.35074],[-6.93921,10.35291],[-7.01186,10.25111],[-6.97444,10.21644],[-7.00966,10.15794],[-7.0603,10.14711],[-7.13331,10.24877],[-7.3707,10.24677],[-7.44555,10.44602],[-7.52261,10.4655],[-7.54462,10.40921],[-7.63048,10.46334],[-7.92107,10.15577],[-7.97971,10.17117],[-8.01225,10.1021],[-8.11921,10.04577],[-8.15652,9.94288],[-8.09434,9.86936],[-8.14657,9.55062],[-8.03463,9.39604],[-7.85056,9.41812],[-7.90777,9.20456],[-7.73862,9.08422],[-7.92518,8.99332],[-7.95503,8.81146],[-7.69882,8.66148],[-7.65653,8.36873],[-7.92518,8.50652],[-8.22991,8.48438],[-8.2411,8.24196],[-8.062,8.16071],[-7.98675,8.20134],[-7.99919,8.11023],[-7.94695,8.00925],[-8.06449,8.04989],[-8.13414,7.87991],[-8.09931,7.78626],[-8.21374,7.54466],[-8.4003,7.6285],[-8.47114,7.55676],[-8.41935,7.51203],[-8.37458,7.25794],[-8.29249,7.1691],[-8.31736,6.82837],[-8.59456,6.50612],[-8.48652,6.43797],[-8.45666,6.49977],[-8.38453,6.35887],[-8.3298,6.36381],[-8.17557,6.28222],[-8.00642,6.31684],[-7.90692,6.27728],[-7.83478,6.20309],[-7.8497,6.08932],[-7.79747,6.07696],[-7.78254,5.99037],[-7.70294,5.90625],[-7.67309,5.94337],[-7.48155,5.80974],[-7.46165,5.84934],[-7.43677,5.84687],[-7.43926,5.74787],[-7.37209,5.61173],[-7.43428,5.42355],[-7.36463,5.32944],[-7.46165,5.26256],[-7.48901,5.14118],[-7.55369,5.08667],[-7.53876,4.94294],[-7.59349,4.8909],[-7.53259,4.35145],[-7.52774,3.7105]]]]}},{type:"Feature",properties:{iso1A2:"CK",iso1A3:"COK",iso1N3:"184",wikidata:"Q26988",nameEn:"Cook Islands",country:"NZ",groups:["061","009","UN"],driveSide:"left",callingCodes:["682"]},geometry:{type:"MultiPolygon",coordinates:[[[[-168.15106,-10.26955],[-156.45576,-31.75456],[-156.48634,-15.52824],[-156.50903,-7.4975],[-168.15106,-10.26955]]]]}},{type:"Feature",properties:{iso1A2:"CL",iso1A3:"CHL",iso1N3:"152",wikidata:"Q298",nameEn:"Chile",groups:["005","419","019","UN"],callingCodes:["56"]},geometry:{type:"MultiPolygon",coordinates:[[[[-68.60702,-52.65781],[-68.41683,-52.33516],[-69.97824,-52.00845],[-71.99889,-51.98018],[-72.33873,-51.59954],[-72.31343,-50.58411],[-73.15765,-50.78337],[-73.55259,-49.92488],[-73.45156,-49.79461],[-73.09655,-49.14342],[-72.56894,-48.81116],[-72.54042,-48.52392],[-72.27662,-48.28727],[-72.50478,-47.80586],[-71.94152,-47.13595],[-71.68577,-46.55385],[-71.75614,-45.61611],[-71.35687,-45.22075],[-72.06985,-44.81756],[-71.26418,-44.75684],[-71.16436,-44.46244],[-71.81318,-44.38097],[-71.64206,-43.64774],[-72.14828,-42.85321],[-72.15541,-42.15941],[-71.74901,-42.11711],[-71.92726,-40.72714],[-71.37826,-38.91474],[-70.89532,-38.6923],[-71.24279,-37.20264],[-70.95047,-36.4321],[-70.38008,-36.02375],[-70.49416,-35.24145],[-69.87386,-34.13344],[-69.88099,-33.34489],[-70.55832,-31.51559],[-70.14479,-30.36595],[-69.8596,-30.26131],[-69.99507,-29.28351],[-69.80969,-29.07185],[-69.66709,-28.44055],[-69.22504,-27.95042],[-68.77586,-27.16029],[-68.43363,-27.08414],[-68.27677,-26.90626],[-68.59048,-26.49861],[-68.56909,-26.28146],[-68.38372,-26.15353],[-68.57622,-25.32505],[-68.38372,-25.08636],[-68.56909,-24.69831],[-68.24825,-24.42596],[-67.33563,-24.04237],[-66.99632,-22.99839],[-67.18382,-22.81525],[-67.54284,-22.89771],[-67.85114,-22.87076],[-68.18816,-21.28614],[-68.40403,-20.94562],[-68.53957,-20.91542],[-68.55383,-20.7355],[-68.44023,-20.62701],[-68.7276,-20.46178],[-68.74273,-20.08817],[-68.57132,-20.03134],[-68.54611,-19.84651],[-68.66761,-19.72118],[-68.41218,-19.40499],[-68.61989,-19.27584],[-68.80602,-19.08355],[-68.87082,-19.06003],[-68.94987,-18.93302],[-69.07432,-18.28259],[-69.14807,-18.16893],[-69.07496,-18.03715],[-69.28671,-17.94844],[-69.34126,-17.72753],[-69.46623,-17.60518],[-69.46897,-17.4988],[-69.66483,-17.65083],[-69.79087,-17.65563],[-69.82868,-17.72048],[-69.75305,-17.94605],[-69.81607,-18.12582],[-69.96732,-18.25992],[-70.16394,-18.31737],[-70.31267,-18.31258],[-70.378,-18.3495],[-70.59118,-18.35072],[-113.52687,-26.52828],[-68.11646,-58.14883],[-66.07313,-55.19618],[-67.11046,-54.94199],[-67.46182,-54.92205],[-68.01394,-54.8753],[-68.60733,-54.9125],[-68.60702,-52.65781]]]]}},{type:"Feature",properties:{iso1A2:"CM",iso1A3:"CMR",iso1N3:"120",wikidata:"Q1009",nameEn:"Cameroon",groups:["017","202","002","UN"],callingCodes:["237"]},geometry:{type:"MultiPolygon",coordinates:[[[[14.83314,12.62963],[14.55058,12.78256],[14.56101,12.91036],[14.46881,13.08259],[14.08251,13.0797],[14.20204,12.53405],[14.17523,12.41916],[14.22215,12.36533],[14.4843,12.35223],[14.6474,12.17466],[14.61612,11.7798],[14.55207,11.72001],[14.64591,11.66166],[14.6124,11.51283],[14.17821,11.23831],[13.97489,11.30258],[13.78945,11.00154],[13.7403,11.00593],[13.70753,10.94451],[13.73434,10.9255],[13.54964,10.61236],[13.5705,10.53183],[13.43644,10.13326],[13.34111,10.12299],[13.25025,10.03647],[13.25323,10.00127],[13.286,9.9822],[13.27409,9.93232],[13.24132,9.91031],[13.25025,9.86042],[13.29941,9.8296],[13.25472,9.76795],[13.22642,9.57266],[13.02385,9.49334],[12.85628,9.36698],[12.91958,9.33905],[12.90022,9.11411],[12.81085,8.91992],[12.79,8.75361],[12.71701,8.7595],[12.68722,8.65938],[12.44146,8.6152],[12.4489,8.52536],[12.26123,8.43696],[12.24782,8.17904],[12.19271,8.10826],[12.20909,7.97553],[11.99908,7.67302],[12.01844,7.52981],[11.93205,7.47812],[11.84864,7.26098],[11.87396,7.09398],[11.63117,6.9905],[11.55818,6.86186],[11.57755,6.74059],[11.51499,6.60892],[11.42264,6.5882],[11.42041,6.53789],[11.09495,6.51717],[11.09644,6.68437],[10.94302,6.69325],[10.8179,6.83377],[10.83727,6.9358],[10.60789,7.06885],[10.59746,7.14719],[10.57214,7.16345],[10.53639,6.93432],[10.21466,6.88996],[10.15135,7.03781],[9.86314,6.77756],[9.77824,6.79088],[9.70674,6.51717],[9.51757,6.43874],[8.84209,5.82562],[8.88156,5.78857],[8.83687,5.68483],[8.92029,5.58403],[8.78027,5.1243],[8.60302,4.87353],[8.34397,4.30689],[9.22018,3.72052],[9.81162,2.33797],[9.82123,2.35097],[9.83754,2.32428],[9.83238,2.29079],[9.84716,2.24676],[9.89012,2.20457],[9.90749,2.20049],[9.991,2.16561],[11.3561,2.17217],[11.37116,2.29975],[13.28534,2.25716],[13.29457,2.16106],[14.61145,2.17866],[15.00996,1.98887],[15.22634,2.03243],[15.34776,1.91264],[15.48942,1.98265],[16.02959,1.76483],[16.02647,1.65591],[16.14634,1.70259],[16.05294,1.9811],[16.08563,2.19733],[16.15568,2.18955],[16.19357,2.21537],[16.08252,2.45708],[16.05449,3.02306],[15.77725,3.26835],[15.73522,3.24348],[15.07686,4.01805],[15.17482,4.05131],[15.10644,4.1362],[15.08609,4.30282],[15.00825,4.41458],[14.73383,4.6135],[14.65489,5.21343],[14.57083,5.23979],[14.52724,5.28319],[14.62531,5.51411],[14.58951,5.59777],[14.62375,5.70466],[14.60974,5.91838],[14.49455,5.91683],[14.42917,6.00508],[14.43073,6.08867],[14.56149,6.18928],[14.74206,6.26356],[14.80122,6.34866],[14.79966,6.39043],[14.96311,6.75693],[15.04717,6.77085],[15.23397,7.25135],[15.49743,7.52179],[15.56964,7.58936],[15.59272,7.7696],[15.50743,7.79302],[15.20426,8.50892],[15.09484,8.65982],[14.83566,8.80557],[14.35707,9.19611],[14.37094,9.2954],[13.97544,9.6365],[14.01793,9.73169],[14.1317,9.82413],[14.20411,10.00055],[14.4673,10.00264],[14.80082,9.93818],[14.95722,9.97926],[15.05999,9.94845],[15.14043,9.99246],[15.24618,9.99246],[15.41408,9.92876],[15.68761,9.99344],[15.50535,10.1098],[15.30874,10.31063],[15.23724,10.47764],[15.14936,10.53915],[15.15532,10.62846],[15.06737,10.80921],[15.09127,10.87431],[15.04957,11.02347],[15.10021,11.04101],[15.0585,11.40481],[15.13149,11.5537],[15.06595,11.71126],[15.11579,11.79313],[15.04808,11.8731],[15.05786,12.0608],[15.0349,12.10698],[15.00146,12.1223],[14.96952,12.0925],[14.89019,12.16593],[14.90827,12.3269],[14.83314,12.62963]]]]}},{type:"Feature",properties:{iso1A2:"CN",iso1A3:"CHN",iso1N3:"156",wikidata:"Q148",nameEn:"People's Republic of China"},geometry:null},{type:"Feature",properties:{iso1A2:"CO",iso1A3:"COL",iso1N3:"170",wikidata:"Q739",nameEn:"Colombia",groups:["005","419","019","UN"],callingCodes:["57"]},geometry:{type:"MultiPolygon",coordinates:[[[[-71.19849,12.65801],[-81.58685,18.0025],[-82.06974,14.49418],[-82.56142,11.91792],[-78.79327,9.93766],[-77.58292,9.22278],[-77.32389,8.81247],[-77.45064,8.49991],[-77.17257,7.97422],[-77.57185,7.51147],[-77.72514,7.72348],[-77.72157,7.47612],[-77.81426,7.48319],[-77.89178,7.22681],[-78.06168,7.07793],[-82.12561,4.00341],[-78.87137,1.47457],[-78.42749,1.15389],[-77.85677,.80197],[-77.7148,.85003],[-77.68613,.83029],[-77.66416,.81604],[-77.67815,.73863],[-77.49984,.64476],[-77.52001,.40782],[-76.89177,.24736],[-76.4094,.24015],[-76.41215,.38228],[-76.23441,.42294],[-75.82927,.09578],[-75.25764,-.11943],[-75.18513,-.0308],[-74.42701,-.50218],[-74.26675,-.97229],[-73.65312,-1.26222],[-72.92587,-2.44514],[-71.75223,-2.15058],[-70.94377,-2.23142],[-70.04609,-2.73906],[-70.71396,-3.7921],[-70.52393,-3.87553],[-70.3374,-3.79505],[-69.94708,-4.2431],[-69.43395,-1.42219],[-69.4215,-1.01853],[-69.59796,-.75136],[-69.603,-.51947],[-70.03658,-.19681],[-70.04162,.55437],[-69.47696,.71065],[-69.20976,.57958],[-69.14422,.84172],[-69.26017,1.06856],[-69.82987,1.07864],[-69.83491,1.69353],[-69.53746,1.76408],[-69.38621,1.70865],[-68.18128,1.72881],[-68.26699,1.83463],[-68.18632,2.00091],[-67.9292,1.82455],[-67.40488,2.22258],[-67.299,1.87494],[-67.15784,1.80439],[-67.08222,1.17441],[-66.85795,1.22998],[-67.21967,2.35778],[-67.65696,2.81691],[-67.85862,2.79173],[-67.85862,2.86727],[-67.30945,3.38393],[-67.50067,3.75812],[-67.62671,3.74303],[-67.85358,4.53249],[-67.83341,5.31104],[-67.59141,5.5369],[-67.63914,5.64963],[-67.58558,5.84537],[-67.43513,5.98835],[-67.4625,6.20625],[-67.60654,6.2891],[-69.41843,6.1072],[-70.10716,6.96516],[-70.7596,7.09799],[-71.03941,6.98163],[-71.37234,7.01588],[-71.42212,7.03854],[-71.44118,7.02116],[-71.82441,7.04314],[-72.04895,7.03837],[-72.19437,7.37034],[-72.43132,7.40034],[-72.47415,7.48928],[-72.45321,7.57232],[-72.47827,7.65604],[-72.46763,7.79518],[-72.44454,7.86031],[-72.46183,7.90682],[-72.45806,7.91141],[-72.47042,7.92306],[-72.48183,7.92909],[-72.48801,7.94329],[-72.47213,7.96106],[-72.39137,8.03534],[-72.35163,8.01163],[-72.36987,8.19976],[-72.4042,8.36513],[-72.65474,8.61428],[-72.77415,9.10165],[-72.94052,9.10663],[-73.02119,9.27584],[-73.36905,9.16636],[-72.98085,9.85253],[-72.88002,10.44309],[-72.4767,11.1117],[-72.24983,11.14138],[-71.9675,11.65536],[-71.3275,11.85],[-70.92579,11.96275],[-71.19849,12.65801]]]]}},{type:"Feature",properties:{iso1A2:"CP",iso1A3:"CPT",wikidata:"Q161258",nameEn:"Clipperton Island",country:"FR",groups:["EU","013","003","019","UN"],isoStatus:"excRes"},geometry:{type:"MultiPolygon",coordinates:[[[[-110.36279,9.79626],[-108.755,9.84085],[-109.04145,11.13245],[-110.36279,9.79626]]]]}},{type:"Feature",properties:{iso1A2:"CR",iso1A3:"CRI",iso1N3:"188",wikidata:"Q800",nameEn:"Costa Rica",groups:["013","003","419","019","UN"],callingCodes:["506"]},geometry:{type:"MultiPolygon",coordinates:[[[[-83.68276,11.01562],[-83.66597,10.79916],[-83.90838,10.71161],[-84.68197,11.07568],[-84.92439,10.9497],[-85.60529,11.22607],[-85.71223,11.06868],[-86.14524,11.09059],[-87.41779,5.02401],[-82.94503,7.93865],[-82.89978,8.04083],[-82.89137,8.05755],[-82.88641,8.10219],[-82.9388,8.26634],[-83.05209,8.33394],[-82.93056,8.43465],[-82.8679,8.44042],[-82.8382,8.48117],[-82.83322,8.52464],[-82.83975,8.54755],[-82.82739,8.60153],[-82.8794,8.6981],[-82.92068,8.74832],[-82.91377,8.774],[-82.88253,8.83331],[-82.72126,8.97125],[-82.93516,9.07687],[-82.93516,9.46741],[-82.84871,9.4973],[-82.87919,9.62645],[-82.77206,9.59573],[-82.66667,9.49746],[-82.61345,9.49881],[-82.56507,9.57279],[-82.51044,9.65379],[-83.54024,10.96805],[-83.68276,11.01562]]]]}},{type:"Feature",properties:{iso1A2:"CU",iso1A3:"CUB",iso1N3:"192",wikidata:"Q241",nameEn:"Cuba",groups:["029","003","419","019","UN"],callingCodes:["53"]},geometry:{type:"MultiPolygon",coordinates:[[[[-73.62304,20.6935],[-82.02215,24.23074],[-85.77883,21.92705],[-74.81171,18.82201],[-73.62304,20.6935]]]]}},{type:"Feature",properties:{iso1A2:"CV",iso1A3:"CPV",iso1N3:"132",wikidata:"Q1011",nameEn:"Cape Verde",groups:["Q105472","011","202","002","UN"],callingCodes:["238"]},geometry:{type:"MultiPolygon",coordinates:[[[[-28.81604,14.57305],[-20.39702,14.12816],[-23.37101,19.134],[-28.81604,14.57305]]]]}},{type:"Feature",properties:{iso1A2:"CW",iso1A3:"CUW",iso1N3:"531",wikidata:"Q25279",nameEn:"Cura\xE7ao",aliases:["NL-CW"],country:"NL",groups:["Q1451600","029","003","419","019","UN"],callingCodes:["599"]},geometry:{type:"MultiPolygon",coordinates:[[[[-68.90012,12.62309],[-69.59009,12.46019],[-68.99639,11.79035],[-68.33524,11.78151],[-68.90012,12.62309]]]]}},{type:"Feature",properties:{iso1A2:"CX",iso1A3:"CXR",iso1N3:"162",wikidata:"Q31063",nameEn:"Christmas Island",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[105.66835,-9.31927],[104.67494,-11.2566],[106.66176,-11.14349],[105.66835,-9.31927]]]]}},{type:"Feature",properties:{iso1A2:"CY",iso1A3:"CYP",iso1N3:"196",wikidata:"Q229",nameEn:"Republic of Cyprus",groups:["Q644636","EU","145","142","UN"],driveSide:"left",callingCodes:["357"]},geometry:{type:"MultiPolygon",coordinates:[[[[32.46489,35.48584],[30.15137,34.08517],[32.74412,34.43926],[32.75515,34.64985],[32.76136,34.68318],[32.79433,34.67883],[32.82717,34.70622],[32.86014,34.70585],[32.86167,34.68734],[32.9068,34.66102],[32.91398,34.67343],[32.93043,34.67091],[32.92807,34.66736],[32.93449,34.66241],[32.93693,34.67027],[32.94379,34.67111],[32.94683,34.67907],[32.95539,34.68471],[32.99135,34.68061],[32.98668,34.67268],[32.99014,34.65518],[32.97736,34.65277],[32.97079,34.66112],[32.95325,34.66462],[32.94796,34.6587],[32.94976,34.65204],[32.95471,34.64528],[32.95323,34.64075],[32.95891,34.62919],[32.96718,34.63446],[32.96968,34.64046],[33.0138,34.64424],[33.26744,34.49942],[33.83531,34.73974],[33.70575,34.97947],[33.70639,34.99303],[33.71514,35.00294],[33.69731,35.01754],[33.69938,35.03123],[33.67678,35.03866],[33.63765,35.03869],[33.61215,35.0527],[33.59658,35.03635],[33.567,35.04803],[33.57478,35.06049],[33.53975,35.08151],[33.48915,35.06594],[33.47666,35.00701],[33.45256,35.00288],[33.45178,35.02078],[33.47825,35.04103],[33.48136,35.0636],[33.46813,35.10564],[33.41675,35.16325],[33.4076,35.20062],[33.38575,35.2018],[33.37248,35.18698],[33.3717,35.1788],[33.36569,35.17479],[33.35612,35.17402],[33.35596,35.17942],[33.34964,35.17803],[33.35056,35.18328],[33.31955,35.18096],[33.3072,35.16816],[33.27068,35.16815],[33.15138,35.19504],[33.11105,35.15639],[33.08249,35.17319],[33.01192,35.15639],[32.94471,35.09422],[32.86406,35.1043],[32.85733,35.07742],[32.70779,35.14127],[32.70947,35.18328],[32.64864,35.19967],[32.60361,35.16647],[32.46489,35.48584]]],[[[33.74144,35.01053],[33.7492,35.01319],[33.74983,35.02274],[33.74265,35.02329],[33.73781,35.02181],[33.7343,35.01178],[33.74144,35.01053]]],[[[33.77312,34.9976],[33.75994,35.00113],[33.75682,34.99916],[33.76605,34.99543],[33.76738,34.99188],[33.7778,34.98981],[33.77843,34.988],[33.78149,34.98854],[33.78318,34.98699],[33.78571,34.98951],[33.78917,34.98854],[33.79191,34.98914],[33.78516,34.99582],[33.77553,34.99518],[33.77312,34.9976]]]]}},{type:"Feature",properties:{iso1A2:"CZ",iso1A3:"CZE",iso1N3:"203",wikidata:"Q213",nameEn:"Czechia",groups:["EU","151","150","UN"],callingCodes:["420"]},geometry:{type:"MultiPolygon",coordinates:[[[[14.82803,50.86966],[14.79139,50.81438],[14.70661,50.84096],[14.61993,50.86049],[14.63434,50.8883],[14.65259,50.90513],[14.64802,50.93241],[14.58024,50.91443],[14.56374,50.922],[14.59702,50.96148],[14.59908,50.98685],[14.58215,50.99306],[14.56432,51.01008],[14.53438,51.00374],[14.53321,51.01679],[14.49873,51.02242],[14.50809,51.0427],[14.49991,51.04692],[14.49154,51.04382],[14.49202,51.02286],[14.45827,51.03712],[14.41335,51.02086],[14.30098,51.05515],[14.25665,50.98935],[14.28776,50.97718],[14.32353,50.98556],[14.32793,50.97379],[14.30251,50.96606],[14.31422,50.95243],[14.39848,50.93866],[14.38691,50.89907],[14.30098,50.88448],[14.27123,50.89386],[14.24314,50.88761],[14.22331,50.86049],[14.02982,50.80662],[13.98864,50.8177],[13.89113,50.78533],[13.89444,50.74142],[13.82942,50.7251],[13.76316,50.73487],[13.70204,50.71771],[13.65977,50.73096],[13.52474,50.70394],[13.53748,50.67654],[13.5226,50.64721],[13.49742,50.63133],[13.46413,50.60102],[13.42189,50.61243],[13.37485,50.64931],[13.37805,50.627],[13.32264,50.60317],[13.32594,50.58009],[13.29454,50.57904],[13.25158,50.59268],[13.19043,50.50237],[13.13424,50.51709],[13.08301,50.50132],[13.0312,50.50944],[13.02038,50.4734],[13.02147,50.44763],[12.98433,50.42016],[12.94058,50.40944],[12.82465,50.45738],[12.73476,50.43237],[12.73044,50.42268],[12.70731,50.39948],[12.67261,50.41949],[12.51356,50.39694],[12.48747,50.37278],[12.49214,50.35228],[12.48256,50.34784],[12.46643,50.35527],[12.43722,50.33774],[12.43371,50.32506],[12.39924,50.32302],[12.40158,50.29521],[12.36594,50.28289],[12.35425,50.23993],[12.33263,50.24367],[12.32445,50.20442],[12.33847,50.19432],[12.32596,50.17146],[12.29232,50.17524],[12.28063,50.19544],[12.28755,50.22429],[12.23943,50.24594],[12.24791,50.25525],[12.26953,50.25189],[12.25119,50.27079],[12.20823,50.2729],[12.18013,50.32146],[12.10907,50.32041],[12.13716,50.27396],[12.09287,50.25032],[12.19335,50.19997],[12.21484,50.16399],[12.1917,50.13434],[12.2073,50.10315],[12.23709,50.10213],[12.27433,50.0771],[12.26111,50.06331],[12.30798,50.05719],[12.49908,49.97305],[12.47264,49.94222],[12.55197,49.92094],[12.48256,49.83575],[12.46603,49.78882],[12.40489,49.76321],[12.4462,49.70233],[12.52553,49.68415],[12.53544,49.61888],[12.56188,49.6146],[12.60155,49.52887],[12.64782,49.52565],[12.64121,49.47628],[12.669,49.42935],[12.71227,49.42363],[12.75854,49.3989],[12.78168,49.34618],[12.88414,49.33541],[12.88249,49.35479],[12.94859,49.34079],[13.03618,49.30417],[13.02957,49.27399],[13.05883,49.26259],[13.17665,49.16713],[13.17019,49.14339],[13.20405,49.12303],[13.23689,49.11412],[13.28242,49.1228],[13.39479,49.04812],[13.40802,48.98851],[13.50221,48.93752],[13.50552,48.97441],[13.58319,48.96899],[13.61624,48.9462],[13.67739,48.87886],[13.73854,48.88538],[13.76994,48.83537],[13.78977,48.83319],[13.8096,48.77877],[13.84023,48.76988],[14.06151,48.66873],[14.01482,48.63788],[14.09104,48.5943],[14.20691,48.5898],[14.33909,48.55852],[14.43076,48.58855],[14.4587,48.64695],[14.56139,48.60429],[14.60808,48.62881],[14.66762,48.58215],[14.71794,48.59794],[14.72756,48.69502],[14.80584,48.73489],[14.80821,48.77711],[14.81545,48.7874],[14.94773,48.76268],[14.95641,48.75915],[14.9758,48.76857],[14.98112,48.77524],[14.9782,48.7766],[14.98032,48.77959],[14.95072,48.79101],[14.98917,48.90082],[14.97612,48.96983],[14.99878,49.01444],[15.15534,48.99056],[15.16358,48.94278],[15.26177,48.95766],[15.28305,48.98831],[15.34823,48.98444],[15.48027,48.94481],[15.51357,48.91549],[15.61622,48.89541],[15.6921,48.85973],[15.75341,48.8516],[15.78087,48.87644],[15.84404,48.86921],[16.06034,48.75436],[16.37345,48.729],[16.40915,48.74576],[16.46134,48.80865],[16.67008,48.77699],[16.68518,48.7281],[16.71883,48.73806],[16.79779,48.70998],[16.90354,48.71541],[16.93955,48.60371],[17.00215,48.70887],[17.11202,48.82925],[17.19355,48.87602],[17.29054,48.85546],[17.3853,48.80936],[17.45671,48.85004],[17.5295,48.81117],[17.7094,48.86721],[17.73126,48.87885],[17.77944,48.92318],[17.87831,48.92679],[17.91814,49.01784],[18.06885,49.03157],[18.1104,49.08624],[18.15022,49.24518],[18.18456,49.28909],[18.36446,49.3267],[18.4139,49.36517],[18.4084,49.40003],[18.44686,49.39467],[18.54848,49.47059],[18.53063,49.49022],[18.57183,49.51162],[18.6144,49.49824],[18.67757,49.50895],[18.74761,49.492],[18.84521,49.51672],[18.84786,49.5446],[18.80479,49.6815],[18.72838,49.68163],[18.69817,49.70473],[18.62676,49.71983],[18.62943,49.74603],[18.62645,49.75002],[18.61368,49.75426],[18.61278,49.7618],[18.57183,49.83334],[18.60341,49.86256],[18.57045,49.87849],[18.57697,49.91565],[18.54299,49.92537],[18.54495,49.9079],[18.53423,49.89906],[18.41604,49.93498],[18.33562,49.94747],[18.33278,49.92415],[18.31914,49.91565],[18.27794,49.93863],[18.27107,49.96779],[18.21752,49.97309],[18.20241,49.99958],[18.10628,50.00223],[18.07898,50.04535],[18.03212,50.06574],[18.00396,50.04954],[18.04585,50.03311],[18.04585,50.01194],[18.00191,50.01723],[17.86886,49.97452],[17.77669,50.02253],[17.7506,50.07896],[17.6888,50.12037],[17.66683,50.10275],[17.59404,50.16437],[17.70528,50.18812],[17.76296,50.23382],[17.72176,50.25665],[17.74648,50.29966],[17.69292,50.32859],[17.67764,50.28977],[17.58889,50.27837],[17.3702,50.28123],[17.34548,50.2628],[17.34273,50.32947],[17.27681,50.32246],[17.19991,50.3654],[17.19579,50.38817],[17.14498,50.38117],[17.1224,50.39494],[16.89229,50.45117],[16.85933,50.41093],[16.90877,50.38642],[16.94448,50.31281],[16.99803,50.30316],[17.02138,50.27772],[16.99803,50.25753],[17.02825,50.23118],[17.00353,50.21449],[16.98018,50.24172],[16.8456,50.20834],[16.7014,50.09659],[16.63137,50.1142],[16.55446,50.16613],[16.56407,50.21009],[16.42674,50.32509],[16.39379,50.3207],[16.3622,50.34875],[16.36495,50.37679],[16.30289,50.38292],[16.28118,50.36891],[16.22821,50.41054],[16.21585,50.40627],[16.19526,50.43291],[16.31413,50.50274],[16.34572,50.49575],[16.44597,50.58041],[16.33611,50.66579],[16.23174,50.67101],[16.20839,50.63096],[16.10265,50.66405],[16.02437,50.60046],[15.98317,50.61528],[16.0175,50.63009],[15.97219,50.69799],[15.87331,50.67188],[15.81683,50.75666],[15.73186,50.73885],[15.43798,50.80833],[15.3803,50.77187],[15.36656,50.83956],[15.2773,50.8907],[15.27043,50.97724],[15.2361,50.99886],[15.1743,50.9833],[15.16744,51.01959],[15.11937,50.99021],[15.10152,51.01095],[15.06218,51.02269],[15.03895,51.0123],[15.02433,51.0242],[14.96419,50.99108],[15.01088,50.97984],[14.99852,50.86817],[14.82803,50.86966]]]]}},{type:"Feature",properties:{iso1A2:"DE",iso1A3:"DEU",iso1N3:"276",wikidata:"Q183",nameEn:"Germany",groups:["EU","155","150","UN"],callingCodes:["49"]},geometry:{type:"MultiPolygon",coordinates:[[[[8.70847,47.68904],[8.71773,47.69088],[8.70237,47.71453],[8.66416,47.71367],[8.67508,47.6979],[8.65769,47.68928],[8.66837,47.68437],[8.68985,47.69552],[8.70847,47.68904]]],[[[8.72617,47.69651],[8.72809,47.69282],[8.75856,47.68969],[8.79511,47.67462],[8.79966,47.70222],[8.76965,47.7075],[8.77309,47.72059],[8.80663,47.73821],[8.82002,47.71458],[8.86989,47.70504],[8.85065,47.68209],[8.87383,47.67045],[8.87625,47.65441],[8.89946,47.64769],[8.94093,47.65596],[9.02093,47.6868],[9.09891,47.67801],[9.13845,47.66389],[9.15181,47.66904],[9.1705,47.65513],[9.1755,47.65584],[9.17593,47.65399],[9.18203,47.65598],[9.25619,47.65939],[9.55125,47.53629],[9.72736,47.53457],[9.76748,47.5934],[9.80254,47.59419],[9.82591,47.58158],[9.8189,47.54688],[9.87499,47.52953],[9.87733,47.54688],[9.92407,47.53111],[9.96029,47.53899],[10.00003,47.48216],[10.03859,47.48927],[10.07131,47.45531],[10.09001,47.46005],[10.1052,47.4316],[10.06897,47.40709],[10.09819,47.35724],[10.11805,47.37228],[10.16362,47.36674],[10.17648,47.38889],[10.2127,47.38019],[10.22774,47.38904],[10.23757,47.37609],[10.19998,47.32832],[10.2147,47.31014],[10.17648,47.29149],[10.17531,47.27167],[10.23257,47.27088],[10.33424,47.30813],[10.39851,47.37623],[10.4324,47.38494],[10.4359,47.41183],[10.47446,47.43318],[10.46278,47.47901],[10.44291,47.48453],[10.4324,47.50111],[10.44992,47.5524],[10.43473,47.58394],[10.47329,47.58552],[10.48849,47.54057],[10.56912,47.53584],[10.60337,47.56755],[10.63456,47.5591],[10.68832,47.55752],[10.6965,47.54253],[10.7596,47.53228],[10.77596,47.51729],[10.88814,47.53701],[10.91268,47.51334],[10.86945,47.5015],[10.87061,47.4786],[10.90918,47.48571],[10.93839,47.48018],[10.92437,47.46991],[10.98513,47.42882],[10.97111,47.41617],[10.97111,47.39561],[11.11835,47.39719],[11.12536,47.41222],[11.20482,47.43198],[11.25157,47.43277],[11.22002,47.3964],[11.27844,47.39956],[11.29597,47.42566],[11.33804,47.44937],[11.4175,47.44621],[11.38128,47.47465],[11.4362,47.51413],[11.52618,47.50939],[11.58578,47.52281],[11.58811,47.55515],[11.60681,47.57881],[11.63934,47.59202],[11.84052,47.58354],[11.85572,47.60166],[12.0088,47.62451],[12.02282,47.61033],[12.05788,47.61742],[12.13734,47.60639],[12.17824,47.61506],[12.18145,47.61019],[12.17737,47.60121],[12.18568,47.6049],[12.20398,47.60667],[12.20801,47.61082],[12.19895,47.64085],[12.18507,47.65984],[12.18347,47.66663],[12.16769,47.68167],[12.16217,47.70105],[12.18303,47.70065],[12.22571,47.71776],[12.2542,47.7433],[12.26238,47.73544],[12.24017,47.69534],[12.26004,47.67725],[12.27991,47.68827],[12.336,47.69534],[12.37222,47.68433],[12.43883,47.6977],[12.44117,47.6741],[12.50076,47.62293],[12.53816,47.63553],[12.57438,47.63238],[12.6071,47.6741],[12.7357,47.6787],[12.77777,47.66689],[12.76492,47.64485],[12.82101,47.61493],[12.77427,47.58025],[12.80699,47.54477],[12.84672,47.54556],[12.85256,47.52741],[12.9624,47.47452],[12.98344,47.48716],[12.9998,47.46267],[13.04537,47.49426],[13.03252,47.53373],[13.05355,47.56291],[13.04537,47.58183],[13.06641,47.58577],[13.06407,47.60075],[13.09562,47.63304],[13.07692,47.68814],[13.01382,47.72116],[12.98578,47.7078],[12.92969,47.71094],[12.91333,47.7178],[12.90274,47.72513],[12.91711,47.74026],[12.9353,47.74788],[12.94371,47.76281],[12.93202,47.77302],[12.96311,47.79957],[12.98543,47.82896],[13.00588,47.84374],[12.94163,47.92927],[12.93886,47.94046],[12.93642,47.94436],[12.93419,47.94063],[12.92668,47.93879],[12.91985,47.94069],[12.9211,47.95135],[12.91683,47.95647],[12.87476,47.96195],[12.8549,48.01122],[12.76141,48.07373],[12.74973,48.10885],[12.7617,48.12796],[12.78595,48.12445],[12.80676,48.14979],[12.82673,48.15245],[12.8362,48.15876],[12.836,48.1647],[12.84475,48.16556],[12.87126,48.20318],[12.95306,48.20629],[13.02083,48.25689],[13.0851,48.27711],[13.126,48.27867],[13.18093,48.29577],[13.26039,48.29422],[13.30897,48.31575],[13.40709,48.37292],[13.43929,48.43386],[13.42527,48.45711],[13.45727,48.51092],[13.43695,48.55776],[13.45214,48.56472],[13.46967,48.55157],[13.50663,48.57506],[13.50131,48.58091],[13.51291,48.59023],[13.57535,48.55912],[13.59705,48.57013],[13.62508,48.55501],[13.65186,48.55092],[13.66113,48.53558],[13.72802,48.51208],[13.74816,48.53058],[13.7513,48.5624],[13.76921,48.55324],[13.80519,48.58026],[13.80038,48.59487],[13.82609,48.62345],[13.81901,48.6761],[13.81283,48.68426],[13.81791,48.69832],[13.79337,48.71375],[13.81863,48.73257],[13.82266,48.75544],[13.84023,48.76988],[13.8096,48.77877],[13.78977,48.83319],[13.76994,48.83537],[13.73854,48.88538],[13.67739,48.87886],[13.61624,48.9462],[13.58319,48.96899],[13.50552,48.97441],[13.50221,48.93752],[13.40802,48.98851],[13.39479,49.04812],[13.28242,49.1228],[13.23689,49.11412],[13.20405,49.12303],[13.17019,49.14339],[13.17665,49.16713],[13.05883,49.26259],[13.02957,49.27399],[13.03618,49.30417],[12.94859,49.34079],[12.88249,49.35479],[12.88414,49.33541],[12.78168,49.34618],[12.75854,49.3989],[12.71227,49.42363],[12.669,49.42935],[12.64121,49.47628],[12.64782,49.52565],[12.60155,49.52887],[12.56188,49.6146],[12.53544,49.61888],[12.52553,49.68415],[12.4462,49.70233],[12.40489,49.76321],[12.46603,49.78882],[12.48256,49.83575],[12.55197,49.92094],[12.47264,49.94222],[12.49908,49.97305],[12.30798,50.05719],[12.26111,50.06331],[12.27433,50.0771],[12.23709,50.10213],[12.2073,50.10315],[12.1917,50.13434],[12.21484,50.16399],[12.19335,50.19997],[12.09287,50.25032],[12.13716,50.27396],[12.10907,50.32041],[12.18013,50.32146],[12.20823,50.2729],[12.25119,50.27079],[12.26953,50.25189],[12.24791,50.25525],[12.23943,50.24594],[12.28755,50.22429],[12.28063,50.19544],[12.29232,50.17524],[12.32596,50.17146],[12.33847,50.19432],[12.32445,50.20442],[12.33263,50.24367],[12.35425,50.23993],[12.36594,50.28289],[12.40158,50.29521],[12.39924,50.32302],[12.43371,50.32506],[12.43722,50.33774],[12.46643,50.35527],[12.48256,50.34784],[12.49214,50.35228],[12.48747,50.37278],[12.51356,50.39694],[12.67261,50.41949],[12.70731,50.39948],[12.73044,50.42268],[12.73476,50.43237],[12.82465,50.45738],[12.94058,50.40944],[12.98433,50.42016],[13.02147,50.44763],[13.02038,50.4734],[13.0312,50.50944],[13.08301,50.50132],[13.13424,50.51709],[13.19043,50.50237],[13.25158,50.59268],[13.29454,50.57904],[13.32594,50.58009],[13.32264,50.60317],[13.37805,50.627],[13.37485,50.64931],[13.42189,50.61243],[13.46413,50.60102],[13.49742,50.63133],[13.5226,50.64721],[13.53748,50.67654],[13.52474,50.70394],[13.65977,50.73096],[13.70204,50.71771],[13.76316,50.73487],[13.82942,50.7251],[13.89444,50.74142],[13.89113,50.78533],[13.98864,50.8177],[14.02982,50.80662],[14.22331,50.86049],[14.24314,50.88761],[14.27123,50.89386],[14.30098,50.88448],[14.38691,50.89907],[14.39848,50.93866],[14.31422,50.95243],[14.30251,50.96606],[14.32793,50.97379],[14.32353,50.98556],[14.28776,50.97718],[14.25665,50.98935],[14.30098,51.05515],[14.41335,51.02086],[14.45827,51.03712],[14.49202,51.02286],[14.49154,51.04382],[14.49991,51.04692],[14.50809,51.0427],[14.49873,51.02242],[14.53321,51.01679],[14.53438,51.00374],[14.56432,51.01008],[14.58215,50.99306],[14.59908,50.98685],[14.59702,50.96148],[14.56374,50.922],[14.58024,50.91443],[14.64802,50.93241],[14.65259,50.90513],[14.63434,50.8883],[14.61993,50.86049],[14.70661,50.84096],[14.79139,50.81438],[14.82803,50.86966],[14.81664,50.88148],[14.89681,50.9422],[14.89252,50.94999],[14.92942,50.99744],[14.95529,51.04552],[14.97938,51.07742],[14.98229,51.11354],[14.99689,51.12205],[14.99079,51.14284],[14.99646,51.14365],[15.00083,51.14974],[14.99414,51.15813],[14.99311,51.16249],[15.0047,51.16874],[15.01242,51.21285],[15.04288,51.28387],[14.98008,51.33449],[14.96899,51.38367],[14.9652,51.44793],[14.94749,51.47155],[14.73219,51.52922],[14.72652,51.53902],[14.73047,51.54606],[14.71125,51.56209],[14.7727,51.61263],[14.75759,51.62318],[14.75392,51.67445],[14.69065,51.70842],[14.66386,51.73282],[14.64625,51.79472],[14.60493,51.80473],[14.59089,51.83302],[14.6588,51.88359],[14.6933,51.9044],[14.70601,51.92944],[14.7177,51.94048],[14.72163,51.95188],[14.71836,51.95606],[14.7139,51.95643],[14.70488,51.97679],[14.71339,52.00337],[14.76026,52.06624],[14.72971,52.09167],[14.6917,52.10283],[14.67683,52.13936],[14.70616,52.16927],[14.68344,52.19612],[14.71319,52.22144],[14.70139,52.25038],[14.58149,52.28007],[14.56378,52.33838],[14.55228,52.35264],[14.54423,52.42568],[14.63056,52.48993],[14.60081,52.53116],[14.6289,52.57136],[14.61073,52.59847],[14.22071,52.81175],[14.13806,52.82392],[14.12256,52.84311],[14.15873,52.87715],[14.14056,52.95786],[14.25954,53.00264],[14.35044,53.05829],[14.38679,53.13669],[14.36696,53.16444],[14.37853,53.20405],[14.40662,53.21098],[14.45125,53.26241],[14.44133,53.27427],[14.4215,53.27724],[14.35209,53.49506],[14.3273,53.50587],[14.30416,53.55499],[14.31904,53.61581],[14.2853,53.63392],[14.28477,53.65955],[14.27133,53.66613],[14.2836,53.67721],[14.26782,53.69866],[14.27249,53.74464],[14.21323,53.8664],[14.20823,53.90776],[14.18544,53.91258],[14.20647,53.91671],[14.22634,53.9291],[14.20811,54.12784],[13.93395,54.84044],[12.85844,54.82438],[11.90309,54.38543],[11.00303,54.63689],[10.31111,54.65968],[10.16755,54.73883],[9.89314,54.84171],[9.73563,54.8247],[9.61187,54.85548],[9.62734,54.88057],[9.58937,54.88785],[9.4659,54.83131],[9.43155,54.82586],[9.41213,54.84254],[9.38532,54.83968],[9.36496,54.81749],[9.33849,54.80233],[9.32771,54.80602],[9.2474,54.8112],[9.23445,54.83432],[9.24631,54.84726],[9.20571,54.85841],[9.14275,54.87421],[9.04629,54.87249],[8.92795,54.90452],[8.81178,54.90518],[8.76387,54.8948],[8.63979,54.91069],[8.55769,54.91837],[8.45719,55.06747],[8.02459,55.09613],[5.45168,54.20039],[6.91025,53.44221],[7.00198,53.32672],[7.19052,53.31866],[7.21679,53.20058],[7.22681,53.18165],[7.17898,53.13817],[7.21694,53.00742],[7.07253,52.81083],[7.04557,52.63318],[6.77307,52.65375],[6.71641,52.62905],[6.69507,52.488],[6.94293,52.43597],[6.99041,52.47235],[7.03417,52.40237],[7.07044,52.37805],[7.02703,52.27941],[7.06365,52.23789],[7.03729,52.22695],[6.9897,52.2271],[6.97189,52.20329],[6.83984,52.11728],[6.76117,52.11895],[6.68128,52.05052],[6.83035,51.9905],[6.82357,51.96711],[6.72319,51.89518],[6.68386,51.91861],[6.58556,51.89386],[6.50231,51.86313],[6.47179,51.85395],[6.38815,51.87257],[6.40704,51.82771],[6.30593,51.84998],[6.29872,51.86801],[6.21443,51.86801],[6.15349,51.90439],[6.11551,51.89769],[6.16902,51.84094],[6.10337,51.84829],[6.06705,51.86136],[5.99848,51.83195],[5.94568,51.82786],[5.98665,51.76944],[5.95003,51.7493],[6.04091,51.71821],[6.02767,51.6742],[6.11759,51.65609],[6.09055,51.60564],[6.18017,51.54096],[6.21724,51.48568],[6.20654,51.40049],[6.22641,51.39948],[6.22674,51.36135],[6.16977,51.33169],[6.07889,51.24432],[6.07889,51.17038],[6.17384,51.19589],[6.16706,51.15677],[5.98292,51.07469],[5.9541,51.03496],[5.9134,51.06736],[5.86735,51.05182],[5.87849,51.01969],[5.90493,51.00198],[5.90296,50.97356],[5.95282,50.98728],[6.02697,50.98303],[6.01615,50.93367],[6.09297,50.92066],[6.07486,50.89307],[6.08805,50.87223],[6.07693,50.86025],[6.07431,50.84674],[6.05702,50.85179],[6.05623,50.8572],[6.01921,50.84435],[6.02328,50.81694],[6.00462,50.80065],[5.98404,50.80988],[5.97497,50.79992],[6.02624,50.77453],[6.01976,50.75398],[6.03889,50.74618],[6.0326,50.72647],[6.0406,50.71848],[6.04428,50.72861],[6.11707,50.72231],[6.17852,50.6245],[6.26957,50.62444],[6.2476,50.60392],[6.24888,50.59869],[6.24005,50.58732],[6.22581,50.5907],[6.20281,50.56952],[6.17739,50.55875],[6.17802,50.54179],[6.19735,50.53576],[6.19579,50.5313],[6.18716,50.52653],[6.19193,50.5212],[6.20599,50.52089],[6.22335,50.49578],[6.26637,50.50272],[6.30809,50.50058],[6.3465,50.48833],[6.34005,50.46083],[6.37219,50.45397],[6.36852,50.40776],[6.34406,50.37994],[6.3688,50.35898],[6.40785,50.33557],[6.40641,50.32425],[6.35701,50.31139],[6.32488,50.32333],[6.29949,50.30887],[6.28797,50.27458],[6.208,50.25179],[6.16853,50.2234],[6.18364,50.20815],[6.18739,50.1822],[6.14588,50.17106],[6.14132,50.14971],[6.15298,50.14126],[6.1379,50.12964],[6.12055,50.09171],[6.11274,50.05916],[6.13458,50.04141],[6.13044,50.02929],[6.14666,50.02207],[6.13794,50.01466],[6.13273,50.02019],[6.1295,50.01849],[6.13806,50.01056],[6.14948,50.00908],[6.14147,49.99563],[6.1701,49.98518],[6.16466,49.97086],[6.17872,49.9537],[6.18554,49.95622],[6.18045,49.96611],[6.19089,49.96991],[6.19856,49.95053],[6.22094,49.94955],[6.22608,49.929],[6.21882,49.92403],[6.22926,49.92096],[6.23496,49.89972],[6.26146,49.88203],[6.28874,49.87592],[6.29692,49.86685],[6.30963,49.87021],[6.32303,49.85133],[6.32098,49.83728],[6.33585,49.83785],[6.34267,49.84974],[6.36576,49.85032],[6.40022,49.82029],[6.42521,49.81591],[6.42905,49.81091],[6.44131,49.81443],[6.45425,49.81164],[6.47111,49.82263],[6.48718,49.81267],[6.50647,49.80916],[6.51215,49.80124],[6.52121,49.81338],[6.53122,49.80666],[6.52169,49.79787],[6.50534,49.78952],[6.51669,49.78336],[6.51056,49.77515],[6.51828,49.76855],[6.51646,49.75961],[6.50174,49.75292],[6.50193,49.73291],[6.51805,49.72425],[6.51397,49.72058],[6.50261,49.72718],[6.49535,49.72645],[6.49694,49.72205],[6.5042,49.71808],[6.50647,49.71353],[6.49785,49.71118],[6.48014,49.69767],[6.46048,49.69092],[6.44654,49.67799],[6.42937,49.66857],[6.42726,49.66078],[6.43768,49.66021],[6.4413,49.65722],[6.41861,49.61723],[6.39822,49.60081],[6.385,49.59946],[6.37464,49.58886],[6.38342,49.5799],[6.38024,49.57593],[6.36676,49.57813],[6.35825,49.57053],[6.38228,49.55855],[6.38072,49.55171],[6.35666,49.52931],[6.36788,49.50377],[6.36907,49.48931],[6.36778,49.46937],[6.38352,49.46463],[6.39168,49.4667],[6.40274,49.46546],[6.42432,49.47683],[6.55404,49.42464],[6.533,49.40748],[6.60091,49.36864],[6.58807,49.35358],[6.572,49.35027],[6.60186,49.31055],[6.66583,49.28065],[6.69274,49.21661],[6.71843,49.2208],[6.73256,49.20486],[6.71137,49.18808],[6.73765,49.16375],[6.78265,49.16793],[6.83385,49.15162],[6.84703,49.15734],[6.86225,49.18185],[6.85016,49.19354],[6.85119,49.20038],[6.83555,49.21249],[6.85939,49.22376],[6.89298,49.20863],[6.91875,49.22261],[6.93831,49.2223],[6.94028,49.21641],[6.95963,49.203],[6.97273,49.2099],[7.01318,49.19018],[7.03459,49.19096],[7.0274,49.17042],[7.03178,49.15734],[7.04662,49.13724],[7.04409,49.12123],[7.04843,49.11422],[7.05548,49.11185],[7.06642,49.11415],[7.07162,49.1255],[7.09007,49.13094],[7.07859,49.15031],[7.10715,49.15631],[7.10384,49.13787],[7.12504,49.14253],[7.1358,49.1282],[7.1593,49.1204],[7.23473,49.12971],[7.29514,49.11426],[7.3195,49.14231],[7.35995,49.14399],[7.3662,49.17308],[7.44052,49.18354],[7.44455,49.16765],[7.49473,49.17],[7.49172,49.13915],[7.53012,49.09818],[7.56416,49.08136],[7.62575,49.07654],[7.63618,49.05428],[7.75948,49.04562],[7.79557,49.06583],[7.86386,49.03499],[7.93641,49.05544],[7.97783,49.03161],[8.14189,48.97833],[8.22604,48.97352],[8.20031,48.95856],[8.19989,48.95825],[8.12813,48.87985],[8.10253,48.81829],[8.06802,48.78957],[8.0326,48.79017],[8.01534,48.76085],[7.96994,48.75606],[7.96812,48.72491],[7.89002,48.66317],[7.84098,48.64217],[7.80057,48.5857],[7.80167,48.54758],[7.80647,48.51239],[7.76833,48.48945],[7.73109,48.39192],[7.74562,48.32736],[7.69022,48.30018],[7.6648,48.22219],[7.57137,48.12292],[7.56966,48.03265],[7.62302,47.97898],[7.55673,47.87371],[7.52921,47.77747],[7.54761,47.72912],[7.53722,47.71635],[7.51266,47.70197],[7.51915,47.68335],[7.52067,47.66437],[7.53384,47.65115],[7.5591,47.63849],[7.57423,47.61628],[7.58851,47.60794],[7.59301,47.60058],[7.58945,47.59017],[7.60523,47.58519],[7.60459,47.57869],[7.61929,47.57683],[7.64309,47.59151],[7.64213,47.5944],[7.64599,47.59695],[7.67395,47.59212],[7.68229,47.59905],[7.69385,47.60099],[7.68486,47.59601],[7.67115,47.5871],[7.68904,47.57133],[7.67655,47.56435],[7.63338,47.56256],[7.65083,47.54662],[7.66174,47.54554],[7.6656,47.53752],[7.68101,47.53232],[7.69642,47.53297],[7.71961,47.54219],[7.75261,47.54599],[7.79486,47.55691],[7.81901,47.58798],[7.84412,47.5841],[7.88664,47.58854],[7.90673,47.57674],[7.91251,47.55031],[7.94494,47.54511],[7.95682,47.55789],[7.97581,47.55493],[8.00113,47.55616],[8.02136,47.55096],[8.04383,47.55443],[8.06663,47.56374],[8.08557,47.55768],[8.10002,47.56504],[8.10395,47.57918],[8.11543,47.5841],[8.13662,47.58432],[8.13823,47.59147],[8.14947,47.59558],[8.1652,47.5945],[8.19378,47.61636],[8.20617,47.62141],[8.22011,47.6181],[8.22577,47.60385],[8.23809,47.61204],[8.25863,47.61571],[8.26313,47.6103],[8.2824,47.61225],[8.29722,47.60603],[8.29524,47.5919],[8.30277,47.58607],[8.32735,47.57133],[8.35512,47.57014],[8.38273,47.56608],[8.39477,47.57826],[8.43235,47.56617],[8.49431,47.58107],[8.48949,47.588],[8.46637,47.58389],[8.45578,47.60121],[8.50747,47.61897],[8.51686,47.63476],[8.55756,47.62394],[8.57586,47.59537],[8.60348,47.61204],[8.59545,47.64298],[8.60701,47.65271],[8.61471,47.64514],[8.60412,47.63735],[8.62049,47.63757],[8.62884,47.65098],[8.61113,47.66332],[8.6052,47.67258],[8.57683,47.66158],[8.56141,47.67088],[8.52801,47.66059],[8.5322,47.64687],[8.49656,47.64709],[8.46605,47.64103],[8.4667,47.65747],[8.44711,47.65379],[8.42264,47.66667],[8.41346,47.66676],[8.40473,47.67499],[8.4211,47.68407],[8.40569,47.69855],[8.44807,47.72426],[8.45771,47.7493],[8.48868,47.77215],[8.56814,47.78001],[8.56415,47.80633],[8.61657,47.79998],[8.62408,47.7626],[8.64425,47.76398],[8.65292,47.80066],[8.68022,47.78599],[8.68985,47.75686],[8.71778,47.76571],[8.74251,47.75168],[8.70543,47.73121],[8.73671,47.7169],[8.72617,47.69651]]]]}},{type:"Feature",properties:{iso1A2:"DG",iso1A3:"DGA",wikidata:"Q184851",nameEn:"Diego Garcia",country:"GB",groups:["IO","BOTS","014","202","002","UN"],isoStatus:"excRes",callingCodes:["246"]},geometry:{type:"MultiPolygon",coordinates:[[[[73.14823,-7.76302],[73.09982,-6.07324],[71.43792,-7.73904],[73.14823,-7.76302]]]]}},{type:"Feature",properties:{iso1A2:"DJ",iso1A3:"DJI",iso1N3:"262",wikidata:"Q977",nameEn:"Djibouti",groups:["014","202","002","UN"],callingCodes:["253"]},geometry:{type:"MultiPolygon",coordinates:[[[[43.90659,12.3823],[43.90659,12.3823],[43.32909,12.59711],[43.29075,12.79154],[42.86195,12.58747],[42.7996,12.42629],[42.6957,12.36201],[42.46941,12.52661],[42.4037,12.46478],[41.95461,11.81157],[41.82878,11.72361],[41.77727,11.49902],[41.8096,11.33606],[41.80056,10.97127],[42.06302,10.92599],[42.13691,10.97586],[42.42669,10.98493],[42.62989,11.09711],[42.75111,11.06992],[42.79037,10.98493],[42.95776,10.98533],[43.90659,12.3823]]]]}},{type:"Feature",properties:{iso1A2:"DK",iso1A3:"DNK",iso1N3:"208",wikidata:"Q756617",nameEn:"Kingdom of Denmark"},geometry:null},{type:"Feature",properties:{iso1A2:"DM",iso1A3:"DMA",iso1N3:"212",wikidata:"Q784",nameEn:"Dominica",groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 767"]},geometry:{type:"MultiPolygon",coordinates:[[[[-61.32485,14.91445],[-60.86656,15.82603],[-61.95646,15.5094],[-61.32485,14.91445]]]]}},{type:"Feature",properties:{iso1A2:"DO",iso1A3:"DOM",iso1N3:"214",wikidata:"Q786",nameEn:"Dominican Republic",groups:["029","003","419","019","UN"],callingCodes:["1 809","1 829","1 849"]},geometry:{type:"MultiPolygon",coordinates:[[[[-67.87844,21.7938],[-72.38946,20.27111],[-71.77419,19.73128],[-71.75865,19.70231],[-71.7429,19.58445],[-71.71449,19.55364],[-71.71268,19.53374],[-71.6802,19.45008],[-71.69448,19.37866],[-71.77766,19.33823],[-71.73229,19.26686],[-71.62642,19.21212],[-71.65337,19.11759],[-71.69938,19.10916],[-71.71088,19.08353],[-71.74088,19.0437],[-71.88102,18.95007],[-71.77766,18.95007],[-71.72624,18.87802],[-71.71885,18.78423],[-71.82556,18.62551],[-71.95412,18.64939],[-72.00201,18.62312],[-71.88102,18.50125],[-71.90875,18.45821],[-71.69952,18.34101],[-71.78271,18.18302],[-71.75465,18.14405],[-71.74994,18.11115],[-71.73783,18.07177],[-71.75671,18.03456],[-72.29523,17.48026],[-68.39466,16.14167],[-67.87844,21.7938]]]]}},{type:"Feature",properties:{iso1A2:"DZ",iso1A3:"DZA",iso1N3:"012",wikidata:"Q262",nameEn:"Algeria",groups:["015","002","UN"],callingCodes:["213"]},geometry:{type:"MultiPolygon",coordinates:[[[[8.59123,37.14286],[5.10072,39.89531],[-2.27707,35.35051],[-2.21248,35.08532],[-2.21445,35.04378],[-2.04734,34.93218],[-1.97833,34.93218],[-1.97469,34.886],[-1.73707,34.74226],[-1.84569,34.61907],[-1.69788,34.48056],[-1.78042,34.39018],[-1.64666,34.10405],[-1.73494,33.71721],[-1.59508,33.59929],[-1.67067,33.27084],[-1.46249,33.0499],[-1.54244,32.95499],[-1.37794,32.73628],[-.9912,32.52467],[-1.24998,32.32993],[-1.24453,32.1917],[-1.15735,32.12096],[-1.22829,32.07832],[-2.46166,32.16603],[-2.93873,32.06557],[-2.82784,31.79459],[-3.66314,31.6339],[-3.66386,31.39202],[-3.77647,31.31912],[-3.77103,31.14984],[-3.54944,31.0503],[-3.65418,30.85566],[-3.64735,30.67539],[-4.31774,30.53229],[-4.6058,30.28343],[-5.21671,29.95253],[-5.58831,29.48103],[-5.72121,29.52322],[-5.75616,29.61407],[-6.69965,29.51623],[-6.78351,29.44634],[-6.95824,29.50924],[-7.61585,29.36252],[-8.6715,28.71194],[-8.66879,27.6666],[-8.66674,27.31569],[-4.83423,24.99935],[1.15698,21.12843],[1.20992,20.73533],[3.24648,19.81703],[3.12501,19.1366],[3.36082,18.9745],[4.26651,19.14224],[5.8153,19.45101],[7.38361,20.79165],[7.48273,20.87258],[11.96886,23.51735],[11.62498,24.26669],[11.41061,24.21456],[10.85323,24.5595],[10.33159,24.5465],[10.02432,24.98124],[10.03146,25.35635],[9.38834,26.19288],[9.51696,26.39148],[9.89569,26.57696],[9.78136,29.40961],[9.3876,30.16738],[9.55544,30.23971],[9.07483,32.07865],[8.35999,32.50101],[8.31895,32.83483],[8.1179,33.05086],[8.11433,33.10175],[7.83028,33.18851],[7.73687,33.42114],[7.54088,33.7726],[7.52851,34.06493],[7.66174,34.20167],[7.74207,34.16492],[7.81242,34.21841],[7.86264,34.3987],[8.20482,34.57575],[8.29655,34.72798],[8.25189,34.92009],[8.30727,34.95378],[8.3555,35.10007],[8.47318,35.23376],[8.30329,35.29884],[8.36086,35.47774],[8.35371,35.66373],[8.26472,35.73669],[8.2626,35.91733],[8.40731,36.42208],[8.18936,36.44939],[8.16167,36.48817],[8.47609,36.66607],[8.46537,36.7706],[8.57613,36.78062],[8.67706,36.8364],[8.62972,36.86499],[8.64044,36.9401],[8.59123,37.14286]]]]}},{type:"Feature",properties:{iso1A2:"EA",wikidata:"Q28868874",nameEn:"Ceuta, Melilla",country:"ES",level:"territory",isoStatus:"excRes"},geometry:null},{type:"Feature",properties:{iso1A2:"EC",iso1A3:"ECU",iso1N3:"218",wikidata:"Q736",nameEn:"Ecuador"},geometry:null},{type:"Feature",properties:{iso1A2:"EE",iso1A3:"EST",iso1N3:"233",wikidata:"Q191",nameEn:"Estonia",aliases:["EW"],groups:["EU","154","150","UN"],callingCodes:["372"]},geometry:{type:"MultiPolygon",coordinates:[[[[26.32936,60.00121],[20.5104,59.15546],[19.84909,57.57876],[22.80496,57.87798],[23.20055,57.56697],[24.26221,57.91787],[24.3579,57.87471],[25.19484,58.0831],[25.28237,57.98539],[25.29581,58.08288],[25.73499,57.90193],[26.05949,57.84744],[26.0324,57.79037],[26.02456,57.78342],[26.027,57.78158],[26.0266,57.77441],[26.02069,57.77169],[26.02415,57.76865],[26.03332,57.7718],[26.0543,57.76105],[26.08098,57.76619],[26.2029,57.7206],[26.1866,57.6849],[26.29253,57.59244],[26.46527,57.56885],[26.54675,57.51813],[26.90364,57.62823],[27.34698,57.52242],[27.31919,57.57672],[27.40393,57.62125],[27.3746,57.66834],[27.52615,57.72843],[27.50171,57.78842],[27.56689,57.83356],[27.78526,57.83963],[27.81841,57.89244],[27.67282,57.92627],[27.62393,58.09462],[27.48541,58.22615],[27.55489,58.39525],[27.36366,58.78381],[27.74429,58.98351],[27.80482,59.1116],[27.87978,59.18097],[27.90911,59.24353],[28.00689,59.28351],[28.14215,59.28934],[28.19284,59.35791],[28.20537,59.36491],[28.21137,59.38058],[28.19061,59.39962],[28.04187,59.47017],[27.85643,59.58538],[26.90044,59.63819],[26.32936,60.00121]]]]}},{type:"Feature",properties:{iso1A2:"EG",iso1A3:"EGY",iso1N3:"818",wikidata:"Q79",nameEn:"Egypt",groups:["015","002","UN"],callingCodes:["20"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.62659,31.82938],[26.92891,33.39516],[24.8458,31.39877],[25.01077,30.73861],[24.71117,30.17441],[24.99968,29.24574],[24.99885,21.99535],[33.17563,22.00405],[34.0765,22.00501],[37.8565,22.00903],[34.4454,27.91479],[34.8812,29.36878],[34.92298,29.45305],[34.26742,31.21998],[34.24012,31.29591],[34.23572,31.2966],[34.21853,31.32363],[34.052,31.46619],[33.62659,31.82938]]]]}},{type:"Feature",properties:{iso1A2:"EH",iso1A3:"ESH",iso1N3:"732",wikidata:"Q6250",nameEn:"Western Sahara",groups:["015","002"],callingCodes:["212"]},geometry:{type:"MultiPolygon",coordinates:[[[[-8.66879,27.6666],[-8.77527,27.66663],[-8.71787,26.9898],[-9.08698,26.98639],[-9.56957,26.90042],[-9.81998,26.71379],[-10.68417,26.90984],[-11.35695,26.8505],[-11.23622,26.72023],[-11.38635,26.611],[-11.62052,26.05229],[-12.06001,26.04442],[-12.12281,25.13682],[-12.92147,24.39502],[-13.00628,24.01923],[-13.75627,23.77231],[-14.10361,22.75501],[-14.1291,22.41636],[-14.48112,22.00886],[-14.47329,21.63839],[-14.78487,21.36587],[-16.44269,21.39745],[-16.9978,21.36239],[-17.02707,21.34022],[-17.21511,21.34226],[-17.35589,20.80492],[-17.0471,20.76408],[-17.0695,20.85742],[-17.06781,20.92697],[-17.0396,20.9961],[-17.0357,21.05368],[-16.99806,21.12142],[-16.95474,21.33997],[-13.01525,21.33343],[-13.08438,22.53866],[-13.15313,22.75649],[-13.10753,22.89493],[-13.00412,23.02297],[-12.5741,23.28975],[-12.36213,23.3187],[-12.14969,23.41935],[-12.00251,23.4538],[-12.0002,25.9986],[-8.66721,25.99918],[-8.66674,27.31569],[-8.66879,27.6666]]]]}},{type:"Feature",properties:{iso1A2:"ER",iso1A3:"ERI",iso1N3:"232",wikidata:"Q986",nameEn:"Eritrea",groups:["014","202","002","UN"],callingCodes:["291"]},geometry:{type:"MultiPolygon",coordinates:[[[[40.99158,15.81743],[39.63762,18.37348],[38.57727,17.98125],[38.45916,17.87167],[38.37133,17.66269],[38.13362,17.53906],[37.50967,17.32199],[37.42694,17.04041],[36.99777,17.07172],[36.92193,16.23451],[36.76371,15.80831],[36.69761,15.75323],[36.54276,15.23478],[36.44337,15.14963],[36.54376,14.25597],[36.56536,14.26177],[36.55659,14.28237],[36.63364,14.31172],[36.85787,14.32201],[37.01622,14.2561],[37.09486,14.27155],[37.13206,14.40746],[37.3106,14.44657],[37.47319,14.2149],[37.528,14.18413],[37.91287,14.89447],[38.0364,14.72745],[38.25562,14.67287],[38.3533,14.51323],[38.45748,14.41445],[38.78306,14.4754],[38.98058,14.54895],[39.02834,14.63717],[39.16074,14.65187],[39.14772,14.61827],[39.19547,14.56996],[39.23888,14.56365],[39.26927,14.48801],[39.2302,14.44598],[39.2519,14.40393],[39.37685,14.54402],[39.52756,14.49011],[39.50585,14.55735],[39.58182,14.60987],[39.76632,14.54264],[39.9443,14.41024],[40.07236,14.54264],[40.14649,14.53969],[40.21128,14.39342],[40.25686,14.41445],[40.9167,14.11152],[41.25097,13.60787],[41.62864,13.38626],[42.05841,12.80912],[42.21469,12.75832],[42.2798,12.6355],[42.4037,12.46478],[42.46941,12.52661],[42.6957,12.36201],[42.7996,12.42629],[42.86195,12.58747],[43.29075,12.79154],[40.99158,15.81743]]]]}},{type:"Feature",properties:{iso1A2:"ES",iso1A3:"ESP",iso1N3:"724",wikidata:"Q29",nameEn:"Spain"},geometry:null},{type:"Feature",properties:{iso1A2:"ET",iso1A3:"ETH",iso1N3:"231",wikidata:"Q115",nameEn:"Ethiopia",groups:["014","202","002","UN"],callingCodes:["251"]},geometry:{type:"MultiPolygon",coordinates:[[[[42.4037,12.46478],[42.2798,12.6355],[42.21469,12.75832],[42.05841,12.80912],[41.62864,13.38626],[41.25097,13.60787],[40.9167,14.11152],[40.25686,14.41445],[40.21128,14.39342],[40.14649,14.53969],[40.07236,14.54264],[39.9443,14.41024],[39.76632,14.54264],[39.58182,14.60987],[39.50585,14.55735],[39.52756,14.49011],[39.37685,14.54402],[39.2519,14.40393],[39.2302,14.44598],[39.26927,14.48801],[39.23888,14.56365],[39.19547,14.56996],[39.14772,14.61827],[39.16074,14.65187],[39.02834,14.63717],[38.98058,14.54895],[38.78306,14.4754],[38.45748,14.41445],[38.3533,14.51323],[38.25562,14.67287],[38.0364,14.72745],[37.91287,14.89447],[37.528,14.18413],[37.47319,14.2149],[37.3106,14.44657],[37.13206,14.40746],[37.09486,14.27155],[37.01622,14.2561],[36.85787,14.32201],[36.63364,14.31172],[36.55659,14.28237],[36.56536,14.26177],[36.54376,14.25597],[36.44653,13.95666],[36.48824,13.83954],[36.38993,13.56459],[36.24545,13.36759],[36.13374,12.92665],[36.16651,12.88019],[36.14268,12.70879],[36.01458,12.72478],[35.70476,12.67101],[35.24302,11.91132],[35.11492,11.85156],[35.05832,11.71158],[35.09556,11.56278],[34.95704,11.24448],[35.01215,11.19626],[34.93172,10.95946],[34.97789,10.91559],[34.97491,10.86147],[34.86916,10.78832],[34.86618,10.74588],[34.77532,10.69027],[34.77383,10.74588],[34.59062,10.89072],[34.4372,10.781],[34.2823,10.53508],[34.34783,10.23914],[34.32102,10.11599],[34.22718,10.02506],[34.20484,9.9033],[34.13186,9.7492],[34.08717,9.55243],[34.10229,9.50238],[34.14304,9.04654],[34.14453,8.60204],[34.01346,8.50041],[33.89579,8.4842],[33.87195,8.41938],[33.71407,8.3678],[33.66938,8.44442],[33.54575,8.47094],[33.3119,8.45474],[33.19721,8.40317],[33.1853,8.29264],[33.18083,8.13047],[33.08401,8.05822],[33.0006,7.90333],[33.04944,7.78989],[33.24637,7.77939],[33.32531,7.71297],[33.44745,7.7543],[33.71407,7.65983],[33.87642,7.5491],[34.02984,7.36449],[34.03878,7.27437],[34.01495,7.25664],[34.19369,7.12807],[34.19369,7.04382],[34.35753,6.91963],[34.47669,6.91076],[34.53925,6.82794],[34.53776,6.74808],[34.65096,6.72589],[34.77459,6.5957],[34.87736,6.60161],[35.01738,6.46991],[34.96227,6.26415],[35.00546,5.89387],[35.12611,5.68937],[35.13058,5.62118],[35.31188,5.50106],[35.29938,5.34042],[35.50792,5.42431],[35.8576,5.33413],[35.81968,5.10757],[35.82118,4.77382],[35.9419,4.61933],[35.95449,4.53244],[36.03924,4.44406],[36.84474,4.44518],[37.07724,4.33503],[38.14168,3.62487],[38.45812,3.60445],[38.52336,3.62551],[38.91938,3.51198],[39.07736,3.5267],[39.19954,3.47834],[39.49444,3.45521],[39.51551,3.40895],[39.55132,3.39634],[39.58339,3.47434],[39.76808,3.67058],[39.86043,3.86974],[40.77498,4.27683],[41.1754,3.94079],[41.89488,3.97375],[42.07619,4.17667],[42.55853,4.20518],[42.84526,4.28357],[42.97746,4.44032],[43.04177,4.57923],[43.40263,4.79289],[44.02436,4.9451],[44.98104,4.91821],[47.97917,8.00124],[47.92477,8.00111],[46.99339,7.9989],[44.19222,8.93028],[43.32613,9.59205],[43.23518,9.84605],[43.0937,9.90579],[42.87643,10.18441],[42.69452,10.62672],[42.95776,10.98533],[42.79037,10.98493],[42.75111,11.06992],[42.62989,11.09711],[42.42669,10.98493],[42.13691,10.97586],[42.06302,10.92599],[41.80056,10.97127],[41.8096,11.33606],[41.77727,11.49902],[41.82878,11.72361],[41.95461,11.81157],[42.4037,12.46478]]]]}},{type:"Feature",properties:{iso1A2:"EU",iso1A3:"EUE",wikidata:"Q458",nameEn:"European Union",level:"union",isoStatus:"excRes"},geometry:null},{type:"Feature",properties:{iso1A2:"FI",iso1A3:"FIN",iso1N3:"246",wikidata:"Q33",nameEn:"Finland",aliases:["SF"]},geometry:null},{type:"Feature",properties:{iso1A2:"FJ",iso1A3:"FJI",iso1N3:"242",wikidata:"Q712",nameEn:"Fiji",groups:["054","009","UN"],driveSide:"left",callingCodes:["679"]},geometry:{type:"MultiPolygon",coordinates:[[[[174.245,-23.1974],[179.99999,-22.5],[179.99999,-11.5],[174,-11.5],[174.245,-23.1974]]],[[[-176.76826,-14.95183],[-180,-14.96041],[-180,-22.90585],[-176.74538,-22.89767],[-176.76826,-14.95183]]]]}},{type:"Feature",properties:{iso1A2:"FK",iso1A3:"FLK",iso1N3:"238",wikidata:"Q9648",nameEn:"Falkland Islands",country:"GB",groups:["BOTS","005","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["500"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.67376,-55.11859],[-54.56126,-51.26248],[-61.26735,-50.63919],[-63.67376,-55.11859]]]]}},{type:"Feature",properties:{iso1A2:"FM",iso1A3:"FSM",iso1N3:"583",wikidata:"Q702",nameEn:"Federated States of Micronesia",groups:["057","009","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["691"]},geometry:{type:"MultiPolygon",coordinates:[[[[138.20583,13.3783],[136.27107,6.73747],[156.88247,-1.39237],[165.19726,6.22546],[138.20583,13.3783]]]]}},{type:"Feature",properties:{iso1A2:"FO",iso1A3:"FRO",iso1N3:"234",wikidata:"Q4628",nameEn:"Faroe Islands",country:"DK",groups:["154","150","UN"],callingCodes:["298"]},geometry:{type:"MultiPolygon",coordinates:[[[[-8.51774,62.35338],[-6.51083,60.95272],[-5.70102,62.77194],[-8.51774,62.35338]]]]}},{type:"Feature",properties:{iso1A2:"FR",iso1A3:"FRA",iso1N3:"250",wikidata:"Q142",nameEn:"France"},geometry:null},{type:"Feature",properties:{iso1A2:"FX",iso1A3:"FXX",iso1N3:"249",wikidata:"Q212429",nameEn:"Metropolitan France",country:"FR",groups:["EU","155","150","UN"],isoStatus:"excRes",callingCodes:["33"]},geometry:{type:"MultiPolygon",coordinates:[[[[2.55904,51.07014],[2.18458,51.52087],[1.17405,50.74239],[-2.02963,49.91866],[-2.09454,49.46288],[-1.83944,49.23037],[-2.00491,48.86706],[-2.65349,49.15373],[-6.28985,48.93406],[-1.81005,43.59738],[-1.77289,43.38957],[-1.79319,43.37497],[-1.78332,43.36399],[-1.78714,43.35476],[-1.77068,43.34396],[-1.75334,43.34107],[-1.75079,43.3317],[-1.7397,43.32979],[-1.73074,43.29481],[-1.69407,43.31378],[-1.62481,43.30726],[-1.63052,43.28591],[-1.61341,43.25269],[-1.57674,43.25269],[-1.55963,43.28828],[-1.50992,43.29481],[-1.45289,43.27049],[-1.40942,43.27272],[-1.3758,43.24511],[-1.41562,43.12815],[-1.47555,43.08372],[-1.44067,43.047],[-1.35272,43.02658],[-1.34419,43.09665],[-1.32209,43.1127],[-1.27118,43.11961],[-1.30052,43.09581],[-1.30531,43.06859],[-1.25244,43.04164],[-1.22881,43.05534],[-1.10333,43.0059],[-1.00963,42.99279],[-.97133,42.96239],[-.81652,42.95166],[-.75478,42.96916],[-.72037,42.92541],[-.73422,42.91228],[-.72608,42.89318],[-.69837,42.87945],[-.67637,42.88303],[-.55497,42.77846],[-.50863,42.82713],[-.44334,42.79939],[-.41319,42.80776],[-.38833,42.80132],[-.3122,42.84788],[-.17939,42.78974],[-.16141,42.79535],[-.10519,42.72761],[-.02468,42.68513],[.17569,42.73424],[.25336,42.7174],[.29407,42.67431],[.36251,42.72282],[.40214,42.69779],[.67873,42.69458],[.65421,42.75872],[.66121,42.84021],[.711,42.86372],[.93089,42.79154],[.96166,42.80629],[.98292,42.78754],[1.0804,42.78569],[1.15928,42.71407],[1.35562,42.71944],[1.44197,42.60217],[1.47986,42.61346],[1.46718,42.63296],[1.48043,42.65203],[1.50867,42.64483],[1.55418,42.65669],[1.60085,42.62703],[1.63485,42.62957],[1.6625,42.61982],[1.68267,42.62533],[1.73452,42.61515],[1.72588,42.59098],[1.7858,42.57698],[1.73683,42.55492],[1.72515,42.50338],[1.76335,42.48863],[1.83037,42.48395],[1.88853,42.4501],[1.93663,42.45439],[1.94292,42.44316],[1.94061,42.43333],[1.94084,42.43039],[1.9574,42.42401],[1.96482,42.37787],[2.00488,42.35399],[2.06241,42.35906],[2.11621,42.38393],[2.12789,42.41291],[2.16599,42.42314],[2.20578,42.41633],[2.25551,42.43757],[2.38504,42.39977],[2.43299,42.39423],[2.43508,42.37568],[2.48457,42.33933],[2.54382,42.33406],[2.55516,42.35351],[2.57934,42.35808],[2.6747,42.33974],[2.65311,42.38771],[2.72056,42.42298],[2.75497,42.42578],[2.77464,42.41046],[2.84335,42.45724],[2.85675,42.45444],[2.86983,42.46843],[2.88413,42.45938],[2.92107,42.4573],[2.94283,42.48174],[2.96518,42.46692],[3.03734,42.47363],[3.08167,42.42748],[3.10027,42.42621],[3.11379,42.43646],[3.17156,42.43545],[3.75438,42.33445],[7.60802,41.05927],[10.09675,41.44089],[9.56115,43.20816],[7.50102,43.51859],[7.42422,43.72209],[7.40903,43.7296],[7.41113,43.73156],[7.41291,43.73168],[7.41298,43.73311],[7.41233,43.73439],[7.42062,43.73977],[7.42299,43.74176],[7.42443,43.74087],[7.42809,43.74396],[7.43013,43.74895],[7.43624,43.75014],[7.43708,43.75197],[7.4389,43.75151],[7.4379,43.74963],[7.47823,43.73341],[7.53006,43.78405],[7.50423,43.84345],[7.49355,43.86551],[7.51162,43.88301],[7.56075,43.89932],[7.56858,43.94506],[7.60771,43.95772],[7.65266,43.9763],[7.66848,43.99943],[7.6597,44.03009],[7.72508,44.07578],[7.66878,44.12795],[7.68694,44.17487],[7.63245,44.17877],[7.62155,44.14881],[7.36364,44.11882],[7.34547,44.14359],[7.27827,44.1462],[7.16929,44.20352],[7.00764,44.23736],[6.98221,44.28289],[6.89171,44.36637],[6.88784,44.42043],[6.94504,44.43112],[6.86233,44.49834],[6.85507,44.53072],[6.96042,44.62129],[6.95133,44.66264],[7.00582,44.69364],[7.07484,44.68073],[7.00401,44.78782],[7.02217,44.82519],[6.93499,44.8664],[6.90774,44.84322],[6.75518,44.89915],[6.74519,44.93661],[6.74791,45.01939],[6.66981,45.02324],[6.62803,45.11175],[6.7697,45.16044],[6.85144,45.13226],[6.96706,45.20841],[7.07074,45.21228],[7.13115,45.25386],[7.10572,45.32924],[7.18019,45.40071],[7.00037,45.509],[6.98948,45.63869],[6.80785,45.71864],[6.80785,45.83265],[6.95315,45.85163],[7.04151,45.92435],[7.00946,45.9944],[6.93862,46.06502],[6.87868,46.03855],[6.89321,46.12548],[6.78968,46.14058],[6.86052,46.28512],[6.77152,46.34784],[6.8024,46.39171],[6.82312,46.42661],[6.53358,46.45431],[6.25432,46.3632],[6.21981,46.31304],[6.24826,46.30175],[6.25137,46.29014],[6.23775,46.27822],[6.24952,46.26255],[6.26749,46.24745],[6.29474,46.26221],[6.31041,46.24417],[6.29663,46.22688],[6.27694,46.21566],[6.26007,46.21165],[6.24821,46.20531],[6.23913,46.20511],[6.23544,46.20714],[6.22175,46.20045],[6.22222,46.19888],[6.21844,46.19837],[6.21603,46.19507],[6.21273,46.19409],[6.21114,46.1927],[6.20539,46.19163],[6.19807,46.18369],[6.19552,46.18401],[6.18707,46.17999],[6.18871,46.16644],[6.18116,46.16187],[6.15305,46.15194],[6.13397,46.1406],[6.09926,46.14373],[6.09199,46.15191],[6.07491,46.14879],[6.05203,46.15191],[6.04564,46.14031],[6.03614,46.13712],[6.01791,46.14228],[5.9871,46.14499],[5.97893,46.13303],[5.95781,46.12925],[5.9641,46.14412],[5.97508,46.15863],[5.98188,46.17392],[5.98846,46.17046],[5.99573,46.18587],[5.96515,46.19638],[5.97542,46.21525],[6.02461,46.23313],[6.03342,46.2383],[6.04602,46.23127],[6.05029,46.23518],[6.0633,46.24583],[6.07072,46.24085],[6.08563,46.24651],[6.10071,46.23772],[6.12446,46.25059],[6.11926,46.2634],[6.1013,46.28512],[6.11697,46.29547],[6.1198,46.31157],[6.13876,46.33844],[6.15738,46.3491],[6.16987,46.36759],[6.15985,46.37721],[6.15016,46.3778],[6.09926,46.40768],[6.06407,46.41676],[6.08427,46.44305],[6.07269,46.46244],[6.1567,46.54402],[6.11084,46.57649],[6.27135,46.68251],[6.38351,46.73171],[6.45209,46.77502],[6.43216,46.80336],[6.46456,46.88865],[6.43341,46.92703],[6.71531,47.0494],[6.68823,47.06616],[6.76788,47.1208],[6.8489,47.15933],[6.9508,47.24338],[6.95108,47.26428],[6.94316,47.28747],[7.05305,47.33304],[7.0564,47.35134],[7.03125,47.36996],[6.87959,47.35335],[6.88542,47.37262],[6.93744,47.40714],[6.93953,47.43388],[7.0024,47.45264],[6.98425,47.49432],[7.0231,47.50522],[7.07425,47.48863],[7.12781,47.50371],[7.16249,47.49025],[7.19583,47.49455],[7.17026,47.44312],[7.24669,47.4205],[7.33526,47.44186],[7.35603,47.43432],[7.40308,47.43638],[7.43088,47.45846],[7.4462,47.46264],[7.4583,47.47216],[7.42923,47.48628],[7.43356,47.49712],[7.47534,47.47932],[7.51076,47.49651],[7.49804,47.51798],[7.5229,47.51644],[7.53199,47.5284],[7.51904,47.53515],[7.50588,47.52856],[7.49691,47.53821],[7.50873,47.54546],[7.51723,47.54578],[7.52831,47.55347],[7.53634,47.55553],[7.55652,47.56779],[7.55689,47.57232],[7.56548,47.57617],[7.56684,47.57785],[7.58386,47.57536],[7.58945,47.59017],[7.59301,47.60058],[7.58851,47.60794],[7.57423,47.61628],[7.5591,47.63849],[7.53384,47.65115],[7.52067,47.66437],[7.51915,47.68335],[7.51266,47.70197],[7.53722,47.71635],[7.54761,47.72912],[7.52921,47.77747],[7.55673,47.87371],[7.62302,47.97898],[7.56966,48.03265],[7.57137,48.12292],[7.6648,48.22219],[7.69022,48.30018],[7.74562,48.32736],[7.73109,48.39192],[7.76833,48.48945],[7.80647,48.51239],[7.80167,48.54758],[7.80057,48.5857],[7.84098,48.64217],[7.89002,48.66317],[7.96812,48.72491],[7.96994,48.75606],[8.01534,48.76085],[8.0326,48.79017],[8.06802,48.78957],[8.10253,48.81829],[8.12813,48.87985],[8.19989,48.95825],[8.20031,48.95856],[8.22604,48.97352],[8.14189,48.97833],[7.97783,49.03161],[7.93641,49.05544],[7.86386,49.03499],[7.79557,49.06583],[7.75948,49.04562],[7.63618,49.05428],[7.62575,49.07654],[7.56416,49.08136],[7.53012,49.09818],[7.49172,49.13915],[7.49473,49.17],[7.44455,49.16765],[7.44052,49.18354],[7.3662,49.17308],[7.35995,49.14399],[7.3195,49.14231],[7.29514,49.11426],[7.23473,49.12971],[7.1593,49.1204],[7.1358,49.1282],[7.12504,49.14253],[7.10384,49.13787],[7.10715,49.15631],[7.07859,49.15031],[7.09007,49.13094],[7.07162,49.1255],[7.06642,49.11415],[7.05548,49.11185],[7.04843,49.11422],[7.04409,49.12123],[7.04662,49.13724],[7.03178,49.15734],[7.0274,49.17042],[7.03459,49.19096],[7.01318,49.19018],[6.97273,49.2099],[6.95963,49.203],[6.94028,49.21641],[6.93831,49.2223],[6.91875,49.22261],[6.89298,49.20863],[6.85939,49.22376],[6.83555,49.21249],[6.85119,49.20038],[6.85016,49.19354],[6.86225,49.18185],[6.84703,49.15734],[6.83385,49.15162],[6.78265,49.16793],[6.73765,49.16375],[6.71137,49.18808],[6.73256,49.20486],[6.71843,49.2208],[6.69274,49.21661],[6.66583,49.28065],[6.60186,49.31055],[6.572,49.35027],[6.58807,49.35358],[6.60091,49.36864],[6.533,49.40748],[6.55404,49.42464],[6.42432,49.47683],[6.40274,49.46546],[6.39168,49.4667],[6.38352,49.46463],[6.36778,49.46937],[6.3687,49.4593],[6.28818,49.48465],[6.27875,49.503],[6.25029,49.50609],[6.2409,49.51408],[6.19543,49.50536],[6.17386,49.50934],[6.15366,49.50226],[6.16115,49.49297],[6.14321,49.48796],[6.12814,49.49365],[6.12346,49.4735],[6.10325,49.4707],[6.09845,49.46351],[6.10072,49.45268],[6.08373,49.45594],[6.07887,49.46399],[6.05553,49.46663],[6.04176,49.44801],[6.02743,49.44845],[6.02648,49.45451],[5.97693,49.45513],[5.96876,49.49053],[5.94224,49.49608],[5.94128,49.50034],[5.86571,49.50015],[5.83389,49.52152],[5.83467,49.52717],[5.84466,49.53027],[5.83648,49.5425],[5.81664,49.53775],[5.80871,49.5425],[5.81838,49.54777],[5.79195,49.55228],[5.77435,49.56298],[5.7577,49.55915],[5.75649,49.54321],[5.64505,49.55146],[5.60909,49.51228],[5.55001,49.52729],[5.46541,49.49825],[5.46734,49.52648],[5.43713,49.5707],[5.3974,49.61596],[5.34837,49.62889],[5.33851,49.61599],[5.3137,49.61225],[5.30214,49.63055],[5.33039,49.6555],[5.31465,49.66846],[5.26232,49.69456],[5.14545,49.70287],[5.09249,49.76193],[4.96714,49.79872],[4.85464,49.78995],[4.86965,49.82271],[4.85134,49.86457],[4.88529,49.9236],[4.78827,49.95609],[4.8382,50.06738],[4.88602,50.15182],[4.83279,50.15331],[4.82438,50.16878],[4.75237,50.11314],[4.70064,50.09384],[4.68695,49.99685],[4.5414,49.96911],[4.51098,49.94659],[4.43488,49.94122],[4.35051,49.95315],[4.31963,49.97043],[4.20532,49.95803],[4.14239,49.98034],[4.13508,50.01976],[4.16294,50.04719],[4.23101,50.06945],[4.20147,50.13535],[4.13561,50.13078],[4.16014,50.19239],[4.15524,50.21103],[4.21945,50.25539],[4.20651,50.27333],[4.17861,50.27443],[4.17347,50.28838],[4.15524,50.2833],[4.16808,50.25786],[4.13665,50.25609],[4.11954,50.30425],[4.10957,50.30234],[4.10237,50.31247],[4.0689,50.3254],[4.0268,50.35793],[3.96771,50.34989],[3.90781,50.32814],[3.84314,50.35219],[3.73911,50.34809],[3.70987,50.3191],[3.71009,50.30305],[3.66976,50.34563],[3.65709,50.36873],[3.67262,50.38663],[3.67494,50.40239],[3.66153,50.45165],[3.64426,50.46275],[3.61014,50.49568],[3.58361,50.49049],[3.5683,50.50192],[3.49509,50.48885],[3.51564,50.5256],[3.47385,50.53397],[3.44629,50.51009],[3.37693,50.49538],[3.28575,50.52724],[3.2729,50.60718],[3.23951,50.6585],[3.264,50.67668],[3.2536,50.68977],[3.26141,50.69151],[3.26063,50.70086],[3.24593,50.71389],[3.22042,50.71019],[3.20845,50.71662],[3.19017,50.72569],[3.20064,50.73547],[3.18811,50.74025],[3.18339,50.74981],[3.16476,50.76843],[3.15017,50.79031],[3.1257,50.78603],[3.11987,50.79188],[3.11206,50.79416],[3.10614,50.78303],[3.09163,50.77717],[3.04314,50.77674],[3.00537,50.76588],[2.96778,50.75242],[2.95019,50.75138],[2.90873,50.702],[2.91036,50.6939],[2.90069,50.69263],[2.88504,50.70656],[2.87937,50.70298],[2.86985,50.7033],[2.8483,50.72276],[2.81056,50.71773],[2.71165,50.81295],[2.63331,50.81457],[2.59093,50.91751],[2.63074,50.94746],[2.57551,51.00326],[2.55904,51.07014]],[[1.99838,42.44682],[1.98378,42.44697],[1.96125,42.45364],[1.95606,42.45785],[1.96215,42.47854],[1.97003,42.48081],[1.97227,42.48487],[1.97697,42.48568],[1.98022,42.49569],[1.98916,42.49351],[1.99766,42.4858],[1.98579,42.47486],[1.99216,42.46208],[2.01564,42.45171],[1.99838,42.44682]]]]}},{type:"Feature",properties:{iso1A2:"GA",iso1A3:"GAB",iso1N3:"266",wikidata:"Q1000",nameEn:"Gabon",groups:["017","202","002","UN"],callingCodes:["241"]},geometry:{type:"MultiPolygon",coordinates:[[[[13.29457,2.16106],[13.28534,2.25716],[11.37116,2.29975],[11.3561,2.17217],[11.35307,1.00251],[9.79648,1.0019],[9.75065,1.06753],[9.66433,1.06723],[7.24416,-.64092],[10.75913,-4.39519],[11.12647,-3.94169],[11.22301,-3.69888],[11.48764,-3.51089],[11.57949,-3.52798],[11.68608,-3.68942],[11.87083,-3.71571],[11.92719,-3.62768],[11.8318,-3.5812],[11.96554,-3.30267],[11.70227,-3.17465],[11.70558,-3.0773],[11.80365,-3.00424],[11.64798,-2.81146],[11.5359,-2.85654],[11.64487,-2.61865],[11.57637,-2.33379],[11.74605,-2.39936],[11.96866,-2.33559],[12.04895,-2.41704],[12.47925,-2.32626],[12.44656,-1.92025],[12.61312,-1.8129],[12.82172,-1.91091],[13.02759,-2.33098],[13.47977,-2.43224],[13.75884,-2.09293],[13.92073,-2.35581],[13.85846,-2.46935],[14.10442,-2.49268],[14.23829,-2.33715],[14.16202,-2.23916],[14.23518,-2.15671],[14.25932,-1.97624],[14.41838,-1.89412],[14.52569,-.57818],[14.41887,-.44799],[14.2165,-.38261],[14.06862,-.20826],[13.90632,-.2287],[13.88648,.26652],[14.10909,.58563],[14.26066,.57255],[14.48179,.9152],[14.25186,1.39842],[13.89582,1.4261],[13.15519,1.23368],[13.25447,1.32339],[13.13461,1.57238],[13.29457,2.16106]]]]}},{type:"Feature",properties:{iso1A2:"GB",iso1A3:"GBR",iso1N3:"826",wikidata:"Q145",ccTLD:".uk",nameEn:"United Kingdom",aliases:["UK"]},geometry:null},{type:"Feature",properties:{iso1A2:"GD",iso1A3:"GRD",iso1N3:"308",wikidata:"Q769",nameEn:"Grenada",aliases:["WG"],groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 473"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.64026,12.69984],[-61.77886,11.36496],[-59.94058,12.34011],[-62.64026,12.69984]]]]}},{type:"Feature",properties:{iso1A2:"GE",iso1A3:"GEO",iso1N3:"268",wikidata:"Q230",nameEn:"Georgia",groups:["145","142","UN"],callingCodes:["995"]},geometry:{type:"MultiPolygon",coordinates:[[[[46.42738,41.91323],[45.61676,42.20768],[45.78692,42.48358],[45.36501,42.55268],[45.15318,42.70598],[44.88754,42.74934],[44.80941,42.61277],[44.70002,42.74679],[44.54202,42.75699],[43.95517,42.55396],[43.73119,42.62043],[43.81453,42.74297],[43.0419,43.02413],[43.03322,43.08883],[42.75889,43.19651],[42.66667,43.13917],[42.40563,43.23226],[41.64935,43.22331],[40.65957,43.56212],[40.10657,43.57344],[40.04445,43.47776],[40.03312,43.44262],[40.01007,43.42411],[40.01552,43.42025],[40.00853,43.40578],[40.0078,43.38551],[39.81147,43.06294],[40.89217,41.72528],[41.54366,41.52185],[41.7148,41.4932],[41.7124,41.47417],[41.81939,41.43621],[41.95134,41.52466],[42.26387,41.49346],[42.51772,41.43606],[42.59202,41.58183],[42.72794,41.59714],[42.84471,41.58912],[42.78995,41.50126],[42.84899,41.47265],[42.8785,41.50516],[43.02956,41.37891],[43.21707,41.30331],[43.13373,41.25503],[43.1945,41.25242],[43.23096,41.17536],[43.36118,41.2028],[43.44973,41.17666],[43.4717,41.12611],[43.67712,41.13398],[43.74717,41.1117],[43.84835,41.16329],[44.16591,41.19141],[44.18148,41.24644],[44.32139,41.2079],[44.34337,41.20312],[44.34417,41.2382],[44.46791,41.18204],[44.59322,41.1933],[44.61462,41.24018],[44.72814,41.20338],[44.82084,41.21513],[44.87887,41.20195],[44.89911,41.21366],[44.84358,41.23088],[44.81749,41.23488],[44.80053,41.25949],[44.81437,41.30371],[44.93493,41.25685],[45.0133,41.29747],[45.09867,41.34065],[45.1797,41.42231],[45.26285,41.46433],[45.31352,41.47168],[45.4006,41.42402],[45.45973,41.45898],[45.68389,41.3539],[45.71035,41.36208],[45.75705,41.35157],[45.69946,41.29545],[45.80842,41.2229],[45.95786,41.17956],[46.13221,41.19479],[46.27698,41.19011],[46.37661,41.10805],[46.456,41.09984],[46.48558,41.0576],[46.55096,41.1104],[46.63969,41.09515],[46.66148,41.20533],[46.72375,41.28609],[46.63658,41.37727],[46.4669,41.43331],[46.40307,41.48464],[46.33925,41.4963],[46.29794,41.5724],[46.34126,41.57454],[46.34039,41.5947],[46.3253,41.60912],[46.28182,41.60089],[46.26531,41.63339],[46.24429,41.59883],[46.19759,41.62327],[46.17891,41.72094],[46.20538,41.77205],[46.23962,41.75811],[46.30863,41.79133],[46.3984,41.84399],[46.42738,41.91323]]]]}},{type:"Feature",properties:{iso1A2:"GF",iso1A3:"GUF",iso1N3:"254",wikidata:"Q3769",nameEn:"French Guiana",country:"FR",groups:["Q3320166","EU","005","419","019","UN"],callingCodes:["594"]},geometry:{type:"MultiPolygon",coordinates:[[[[-51.35485,4.8383],[-53.7094,6.2264],[-54.01074,5.68785],[-54.01877,5.52789],[-54.26916,5.26909],[-54.4717,4.91964],[-54.38444,4.13222],[-54.19367,3.84387],[-54.05128,3.63557],[-53.98914,3.627],[-53.9849,3.58697],[-54.28534,2.67798],[-54.42864,2.42442],[-54.6084,2.32856],[-54.16286,2.10779],[-53.78743,2.34412],[-52.96539,2.1881],[-52.6906,2.37298],[-52.31787,3.17896],[-51.85573,3.83427],[-51.82312,3.85825],[-51.79599,3.89336],[-51.61983,4.14596],[-51.63798,4.51394],[-51.35485,4.8383]]]]}},{type:"Feature",properties:{iso1A2:"GG",iso1A3:"GGY",iso1N3:"831",wikidata:"Q25230",nameEn:"Bailiwick of Guernsey",country:"GB"},geometry:null},{type:"Feature",properties:{iso1A2:"GH",iso1A3:"GHA",iso1N3:"288",wikidata:"Q117",nameEn:"Ghana",groups:["011","202","002","UN"],callingCodes:["233"]},geometry:{type:"MultiPolygon",coordinates:[[[[-.13493,11.14075],[-.27374,11.17157],[-.28566,11.12713],[-.35955,11.07801],[-.38219,11.12596],[-.42391,11.11661],[-.44298,11.04292],[-.61937,10.91305],[-.67143,10.99811],[-2.83373,11.0067],[-2.94232,10.64281],[-2.83108,10.40252],[-2.74174,9.83172],[-2.76534,9.56589],[-2.68802,9.49343],[-2.69814,9.22717],[-2.77799,9.04949],[-2.66357,9.01771],[-2.58243,8.7789],[-2.49037,8.20872],[-2.62901,8.11495],[-2.61232,8.02645],[-2.67787,8.02055],[-2.74819,7.92613],[-2.78395,7.94974],[-2.79467,7.86002],[-2.92339,7.60847],[-2.97822,7.27165],[-2.95438,7.23737],[-3.23327,6.81744],[-3.21954,6.74407],[-3.25999,6.62521],[-3.01896,5.71697],[-2.95323,5.71865],[-2.96671,5.6415],[-2.93132,5.62137],[-2.85378,5.65156],[-2.76614,5.60963],[-2.72737,5.34789],[-2.77625,5.34621],[-2.73074,5.1364],[-2.75502,5.10657],[-2.95261,5.12477],[-2.96554,5.10397],[-3.063,5.13665],[-3.11073,5.12675],[-3.10675,5.08515],[-3.34019,4.17519],[1.07031,5.15655],[1.27574,5.93551],[1.19771,6.11522],[1.19966,6.17069],[1.09187,6.17074],[1.05969,6.22998],[1.03108,6.24064],[.99652,6.33779],[.89283,6.33779],[.71048,6.53083],[.74862,6.56517],[.63659,6.63857],[.6497,6.73682],[.58176,6.76049],[.57406,6.80348],[.52853,6.82921],[.56508,6.92971],[.52098,6.94391],[.52217,6.9723],[.59606,7.01252],[.65327,7.31643],[.62943,7.41099],[.57223,7.39326],[.52455,7.45354],[.51979,7.58706],[.58295,7.62368],[.62943,7.85751],[.58891,8.12779],[.6056,8.13959],[.61156,8.18324],[.5913,8.19622],[.63897,8.25873],[.73432,8.29529],[.64731,8.48866],[.47211,8.59945],[.37319,8.75262],[.52455,8.87746],[.45424,9.04581],[.56388,9.40697],[.49118,9.48339],[.36485,9.49749],[.33148,9.44812],[.25758,9.42696],[.2254,9.47869],[.31241,9.50337],[.30406,9.521],[.2409,9.52335],[.23851,9.57389],[.38153,9.58682],[.36008,9.6256],[.29334,9.59387],[.26712,9.66437],[.28261,9.69022],[.32313,9.6491],[.34816,9.66907],[.34816,9.71607],[.32075,9.72781],[.36366,10.03309],[.41252,10.02018],[.41371,10.06361],[.35293,10.09412],[.39584,10.31112],[.33028,10.30408],[.29453,10.41546],[.18846,10.4096],[.12886,10.53149],[-.05945,10.63458],[-.09141,10.7147],[-.07327,10.71845],[-.07183,10.76794],[-.0228,10.81916],[-.02685,10.8783],[-.00908,10.91644],[-.0063,10.96417],[.03355,10.9807],[.02395,11.06229],[.00342,11.08317],[-.00514,11.10763],[-.0275,11.11202],[-.05733,11.08628],[-.14462,11.10811],[-.13493,11.14075]]]]}},{type:"Feature",properties:{iso1A2:"GI",iso1A3:"GIB",iso1N3:"292",wikidata:"Q1410",nameEn:"Gibraltar",country:"GB",groups:["Q12837","BOTS","039","150","UN"],callingCodes:["350"]},geometry:{type:"MultiPolygon",coordinates:[[[[-5.34064,36.03744],[-5.27801,36.14942],[-5.33822,36.15272],[-5.34536,36.15501],[-5.40526,36.15488],[-5.34064,36.03744]]]]}},{type:"Feature",properties:{iso1A2:"GL",iso1A3:"GRL",iso1N3:"304",wikidata:"Q223",nameEn:"Greenland",country:"DK",groups:["Q1451600","021","003","019","UN"],callingCodes:["299"]},geometry:{type:"MultiPolygon",coordinates:[[[[-49.33696,84.57952],[-68.21821,80.48551],[-77.52957,77.23408],[-46.37635,57.3249],[-9.68082,72.73731],[-5.7106,84.28058],[-49.33696,84.57952]]]]}},{type:"Feature",properties:{iso1A2:"GM",iso1A3:"GMB",iso1N3:"270",wikidata:"Q1005",nameEn:"The Gambia",groups:["011","202","002","UN"],callingCodes:["220"]},geometry:{type:"MultiPolygon",coordinates:[[[[-15.14917,13.57989],[-14.36795,13.23033],[-13.79409,13.34472],[-13.8955,13.59126],[-14.34721,13.46578],[-14.93719,13.80173],[-15.36504,13.79313],[-15.47902,13.58758],[-17.43598,13.59273],[-17.43966,13.04579],[-16.74676,13.06025],[-16.69343,13.16791],[-15.80355,13.16729],[-15.80478,13.34832],[-15.26908,13.37768],[-15.14917,13.57989]]]]}},{type:"Feature",properties:{iso1A2:"GN",iso1A3:"GIN",iso1N3:"324",wikidata:"Q1006",nameEn:"Guinea",groups:["011","202","002","UN"],callingCodes:["224"]},geometry:{type:"MultiPolygon",coordinates:[[[[-11.37536,12.40788],[-11.46267,12.44559],[-11.91331,12.42008],[-12.35415,12.32758],[-12.87336,12.51892],[-13.06603,12.49342],[-13.05296,12.64003],[-13.70523,12.68013],[-13.7039,12.60313],[-13.65089,12.49515],[-13.64168,12.42764],[-13.70851,12.24978],[-13.92745,12.24077],[-13.94589,12.16869],[-13.7039,12.00869],[-13.7039,11.70195],[-14.09799,11.63649],[-14.26623,11.67486],[-14.31513,11.60713],[-14.51173,11.49708],[-14.66677,11.51188],[-14.77786,11.36323],[-14.95993,10.99244],[-15.07174,10.89557],[-15.96748,10.162],[-14.36218,8.64107],[-13.29911,9.04245],[-13.18586,9.0925],[-13.08953,9.0409],[-12.94095,9.26335],[-12.76788,9.3133],[-12.47254,9.86834],[-12.24262,9.92386],[-12.12634,9.87203],[-11.91023,9.93927],[-11.89624,9.99763],[-11.2118,10.00098],[-10.6534,9.29919],[-10.74484,9.07998],[-10.5783,9.06386],[-10.56197,8.81225],[-10.47707,8.67669],[-10.61422,8.5314],[-10.70565,8.29235],[-10.63934,8.35326],[-10.54891,8.31174],[-10.37257,8.48941],[-10.27575,8.48711],[-10.203,8.47991],[-10.14579,8.52665],[-10.05375,8.50697],[-10.05873,8.42578],[-9.77763,8.54633],[-9.47415,8.35195],[-9.50898,8.18455],[-9.41445,8.02448],[-9.44928,7.9284],[-9.35724,7.74111],[-9.37465,7.62032],[-9.48161,7.37122],[-9.41943,7.41809],[-9.305,7.42056],[-9.20798,7.38109],[-9.18311,7.30461],[-9.09107,7.1985],[-8.93435,7.2824],[-8.85724,7.26019],[-8.8448,7.35149],[-8.72789,7.51429],[-8.67814,7.69428],[-8.55874,7.70167],[-8.55874,7.62525],[-8.47114,7.55676],[-8.4003,7.6285],[-8.21374,7.54466],[-8.09931,7.78626],[-8.13414,7.87991],[-8.06449,8.04989],[-7.94695,8.00925],[-7.99919,8.11023],[-7.98675,8.20134],[-8.062,8.16071],[-8.2411,8.24196],[-8.22991,8.48438],[-7.92518,8.50652],[-7.65653,8.36873],[-7.69882,8.66148],[-7.95503,8.81146],[-7.92518,8.99332],[-7.73862,9.08422],[-7.90777,9.20456],[-7.85056,9.41812],[-8.03463,9.39604],[-8.14657,9.55062],[-8.09434,9.86936],[-8.15652,9.94288],[-8.11921,10.04577],[-8.01225,10.1021],[-7.97971,10.17117],[-7.9578,10.2703],[-8.10207,10.44649],[-8.22711,10.41722],[-8.32614,10.69273],[-8.2667,10.91762],[-8.35083,11.06234],[-8.66923,10.99397],[-8.40058,11.37466],[-8.80854,11.66715],[-8.94784,12.34842],[-9.13689,12.50875],[-9.38067,12.48446],[-9.32097,12.29009],[-9.63938,12.18312],[-9.714,12.0226],[-10.30604,12.24634],[-10.71897,11.91552],[-10.80355,12.1053],[-10.99758,12.24634],[-11.24136,12.01286],[-11.50006,12.17826],[-11.37536,12.40788]]]]}},{type:"Feature",properties:{iso1A2:"GP",iso1A3:"GLP",iso1N3:"312",wikidata:"Q17012",nameEn:"Guadeloupe",country:"FR",groups:["Q3320166","EU","029","003","419","019","UN"],callingCodes:["590"]},geometry:{type:"MultiPolygon",coordinates:[[[[-60.03183,16.1129],[-61.60296,16.73066],[-63.00549,15.26166],[-60.03183,16.1129]]]]}},{type:"Feature",properties:{iso1A2:"GQ",iso1A3:"GNQ",iso1N3:"226",wikidata:"Q983",nameEn:"Equatorial Guinea",groups:["017","202","002","UN"],callingCodes:["240"]},geometry:{type:"MultiPolygon",coordinates:[[[[9.22018,3.72052],[8.34397,4.30689],[7.71762,.6674],[3.35016,-3.29031],[9.66433,1.06723],[9.75065,1.06753],[9.79648,1.0019],[11.35307,1.00251],[11.3561,2.17217],[9.991,2.16561],[9.90749,2.20049],[9.89012,2.20457],[9.84716,2.24676],[9.83238,2.29079],[9.83754,2.32428],[9.82123,2.35097],[9.81162,2.33797],[9.22018,3.72052]]]]}},{type:"Feature",properties:{iso1A2:"GR",iso1A3:"GRC",iso1N3:"300",wikidata:"Q41",nameEn:"Greece",aliases:["EL"],groups:["EU","039","150","UN"],callingCodes:["30"]},geometry:{type:"MultiPolygon",coordinates:[[[[26.03489,40.73051],[26.0754,40.72772],[26.08638,40.73214],[26.12495,40.74283],[26.12854,40.77339],[26.15685,40.80709],[26.21351,40.83298],[26.20856,40.86048],[26.26169,40.9168],[26.29441,40.89119],[26.28623,40.93005],[26.32259,40.94042],[26.35894,40.94292],[26.33297,40.98388],[26.3606,41.02027],[26.31928,41.07386],[26.32259,41.24929],[26.39861,41.25053],[26.5209,41.33993],[26.5837,41.32131],[26.62997,41.34613],[26.61767,41.42281],[26.59742,41.48058],[26.59196,41.60491],[26.5209,41.62592],[26.47958,41.67037],[26.35957,41.71149],[26.30255,41.70925],[26.2654,41.71544],[26.22888,41.74139],[26.21325,41.73223],[26.16841,41.74858],[26.06148,41.70345],[26.07083,41.64584],[26.15146,41.60828],[26.14328,41.55496],[26.17951,41.55409],[26.176,41.50072],[26.14796,41.47533],[26.20288,41.43943],[26.16548,41.42278],[26.12926,41.35878],[25.87919,41.30526],[25.8266,41.34563],[25.70507,41.29209],[25.66183,41.31316],[25.61042,41.30614],[25.55082,41.31667],[25.52394,41.2798],[25.48187,41.28506],[25.28322,41.23411],[25.11611,41.34212],[24.942,41.38685],[24.90928,41.40876],[24.86136,41.39298],[24.82514,41.4035],[24.8041,41.34913],[24.71529,41.41928],[24.61129,41.42278],[24.52599,41.56808],[24.30513,41.51297],[24.27124,41.57682],[24.18126,41.51735],[24.10063,41.54796],[24.06323,41.53222],[24.06908,41.46132],[23.96975,41.44118],[23.91483,41.47971],[23.89613,41.45257],[23.80148,41.43943],[23.76525,41.40175],[23.67644,41.41139],[23.63203,41.37632],[23.52453,41.40262],[23.40416,41.39999],[23.33639,41.36317],[23.31301,41.40525],[23.22771,41.37106],[23.21953,41.33773],[23.1833,41.31755],[22.93334,41.34104],[22.81199,41.3398],[22.76408,41.32225],[22.74538,41.16321],[22.71266,41.13945],[22.65306,41.18168],[22.62852,41.14385],[22.58295,41.11568],[22.5549,41.13065],[22.42285,41.11921],[22.26744,41.16409],[22.17629,41.15969],[22.1424,41.12449],[22.06527,41.15617],[21.90869,41.09191],[21.91102,41.04786],[21.7556,40.92525],[21.69601,40.9429],[21.57448,40.86076],[21.53007,40.90759],[21.41555,40.9173],[21.35595,40.87578],[21.25779,40.86165],[21.21105,40.8855],[21.15262,40.85546],[20.97887,40.85475],[20.98396,40.79109],[20.95752,40.76982],[20.98134,40.76046],[21.05833,40.66586],[21.03932,40.56299],[20.96908,40.51526],[20.94925,40.46625],[20.83688,40.47882],[20.7906,40.42726],[20.78234,40.35803],[20.71789,40.27739],[20.67162,40.09433],[20.62566,40.0897],[20.61081,40.07866],[20.55593,40.06524],[20.51297,40.08168],[20.48487,40.06271],[20.42373,40.06777],[20.37911,39.99058],[20.31135,39.99438],[20.41546,39.82832],[20.41475,39.81437],[20.38572,39.78516],[20.30804,39.81563],[20.29152,39.80421],[20.31961,39.72799],[20.27412,39.69884],[20.22707,39.67459],[20.22376,39.64532],[20.15988,39.652],[20.12956,39.65805],[20.05189,39.69112],[20.00957,39.69227],[19.98042,39.6504],[19.92466,39.69533],[19.97622,39.78684],[19.95905,39.82857],[19.0384,40.35325],[19.20409,39.7532],[22.5213,33.45682],[29.73302,35.92555],[29.69611,36.10365],[29.61805,36.14179],[29.61002,36.1731],[29.48192,36.18377],[29.30783,36.01033],[28.23708,36.56812],[27.95037,36.46155],[27.89482,36.69898],[27.46117,36.53789],[27.24613,36.71622],[27.45627,36.9008],[27.20312,36.94571],[27.14757,37.32],[26.95583,37.64989],[26.99377,37.69034],[27.16428,37.72343],[27.05537,37.9131],[26.21136,38.17558],[26.24183,38.44695],[26.32173,38.48731],[26.21136,38.65436],[26.61814,38.81372],[26.70773,39.0312],[26.43357,39.43096],[25.94257,39.39358],[25.61285,40.17161],[26.04292,40.3958],[25.94795,40.72797],[26.03489,40.73051]]]]}},{type:"Feature",properties:{iso1A2:"GS",iso1A3:"SGS",iso1N3:"239",wikidata:"Q35086",nameEn:"South Georgia and South Sandwich Islands",country:"GB",groups:["BOTS","005","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["500"]},geometry:{type:"MultiPolygon",coordinates:[[[[-35.26394,-43.68272],[-53.39656,-59.87088],[-22.31757,-59.85974],[-35.26394,-43.68272]]]]}},{type:"Feature",properties:{iso1A2:"GT",iso1A3:"GTM",iso1N3:"320",wikidata:"Q774",nameEn:"Guatemala",groups:["013","003","419","019","UN"],callingCodes:["502"]},geometry:{type:"MultiPolygon",coordinates:[[[[-89.14985,17.81563],[-90.98678,17.81655],[-90.99199,17.25192],[-91.43809,17.25373],[-91.04436,16.92175],[-90.69064,16.70697],[-90.61212,16.49832],[-90.40499,16.40524],[-90.44567,16.07573],[-91.73182,16.07371],[-92.20983,15.26077],[-92.0621,15.07406],[-92.1454,14.98143],[-92.1423,14.88647],[-92.18161,14.84147],[-92.1454,14.6804],[-92.2261,14.53423],[-92.37213,14.39277],[-90.55276,12.8866],[-90.11344,13.73679],[-90.10505,13.85104],[-89.88937,14.0396],[-89.81807,14.07073],[-89.76103,14.02923],[-89.73251,14.04133],[-89.75569,14.07073],[-89.70756,14.1537],[-89.61844,14.21937],[-89.52397,14.22628],[-89.50614,14.26084],[-89.58814,14.33165],[-89.57441,14.41637],[-89.39028,14.44561],[-89.34776,14.43013],[-89.35189,14.47553],[-89.23719,14.58046],[-89.15653,14.57802],[-89.13132,14.71582],[-89.23467,14.85596],[-89.15149,14.97775],[-89.18048,14.99967],[-89.15149,15.07392],[-88.97343,15.14039],[-88.32467,15.63665],[-88.31459,15.66942],[-88.24022,15.69247],[-88.22552,15.72294],[-88.20359,16.03858],[-88.40779,16.09624],[-88.95358,15.88698],[-89.02415,15.9063],[-89.17418,15.90898],[-89.22683,15.88619],[-89.15025,17.04813],[-89.14985,17.81563]]]]}},{type:"Feature",properties:{iso1A2:"GU",iso1A3:"GUM",iso1N3:"316",wikidata:"Q16635",nameEn:"Guam",aliases:["US-GU"],country:"US",groups:["Q1352230","Q153732","057","009","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 671"]},geometry:{type:"MultiPolygon",coordinates:[[[[146.25931,13.85876],[143.82485,13.92273],[144.61642,12.82462],[146.25931,13.85876]]]]}},{type:"Feature",properties:{iso1A2:"GW",iso1A3:"GNB",iso1N3:"624",wikidata:"Q1007",nameEn:"Guinea-Bissau",groups:["011","202","002","UN"],callingCodes:["245"]},geometry:{type:"MultiPolygon",coordinates:[[[[-14.31513,11.60713],[-14.26623,11.67486],[-14.09799,11.63649],[-13.7039,11.70195],[-13.7039,12.00869],[-13.94589,12.16869],[-13.92745,12.24077],[-13.70851,12.24978],[-13.64168,12.42764],[-13.65089,12.49515],[-13.7039,12.60313],[-13.70523,12.68013],[-15.17582,12.6847],[-15.67302,12.42974],[-16.20591,12.46157],[-16.38191,12.36449],[-16.70562,12.34803],[-17.4623,11.92379],[-15.96748,10.162],[-15.07174,10.89557],[-14.95993,10.99244],[-14.77786,11.36323],[-14.66677,11.51188],[-14.51173,11.49708],[-14.31513,11.60713]]]]}},{type:"Feature",properties:{iso1A2:"GY",iso1A3:"GUY",iso1N3:"328",wikidata:"Q734",nameEn:"Guyana",groups:["005","419","019","UN"],driveSide:"left",callingCodes:["592"]},geometry:{type:"MultiPolygon",coordinates:[[[[-56.84822,6.73257],[-59.54058,8.6862],[-59.98508,8.53046],[-59.85562,8.35213],[-59.80661,8.28906],[-59.83156,8.23261],[-59.97059,8.20791],[-60.02407,8.04557],[-60.38056,7.8302],[-60.51959,7.83373],[-60.64793,7.56877],[-60.71923,7.55817],[-60.59802,7.33194],[-60.63367,7.25061],[-60.54098,7.14804],[-60.44116,7.20817],[-60.28074,7.1162],[-60.39419,6.94847],[-60.54873,6.8631],[-61.13632,6.70922],[-61.20762,6.58174],[-61.15058,6.19558],[-61.4041,5.95304],[-60.73204,5.20931],[-60.32352,5.21299],[-60.20944,5.28754],[-59.98129,5.07097],[-60.04189,4.69801],[-60.15953,4.53456],[-59.78878,4.45637],[-59.69361,4.34069],[-59.73353,4.20399],[-59.51963,3.91951],[-59.86899,3.57089],[-59.79769,3.37162],[-59.99733,2.92312],[-59.91177,2.36759],[-59.7264,2.27497],[-59.74066,1.87596],[-59.25583,1.40559],[-58.92072,1.31293],[-58.84229,1.17749],[-58.53571,1.29154],[-58.4858,1.48399],[-58.33887,1.58014],[-58.01873,1.51966],[-57.97336,1.64566],[-57.77281,1.73344],[-57.55743,1.69605],[-57.35073,1.98327],[-57.23981,1.95808],[-57.09109,2.01854],[-57.07092,1.95304],[-56.7659,1.89509],[-56.47045,1.95135],[-56.55439,2.02003],[-56.70519,2.02964],[-57.35891,3.32121],[-58.0307,3.95513],[-57.8699,4.89394],[-57.37442,5.0208],[-57.22536,5.15605],[-57.31629,5.33714],[-56.84822,6.73257]]]]}},{type:"Feature",properties:{iso1A2:"HK",iso1A3:"HKG",iso1N3:"344",wikidata:"Q8646",nameEn:"Hong Kong",country:"CN",groups:["030","142","UN"],driveSide:"left",callingCodes:["852"]},geometry:{type:"MultiPolygon",coordinates:[[[[113.92195,22.13873],[114.50148,22.15017],[114.44998,22.55977],[114.25154,22.55977],[114.22888,22.5436],[114.22185,22.55343],[114.20655,22.55706],[114.18338,22.55444],[114.17247,22.55944],[114.1597,22.56041],[114.15123,22.55163],[114.1482,22.54091],[114.13823,22.54319],[114.12665,22.54003],[114.11656,22.53415],[114.11181,22.52878],[114.1034,22.5352],[114.09692,22.53435],[114.09048,22.53716],[114.08606,22.53276],[114.07817,22.52997],[114.07267,22.51855],[114.06272,22.51617],[114.05729,22.51104],[114.05438,22.5026],[114.03113,22.5065],[113.86771,22.42972],[113.81621,22.2163],[113.83338,22.1826],[113.92195,22.13873]]]]}},{type:"Feature",properties:{iso1A2:"HM",iso1A3:"HMD",iso1N3:"334",wikidata:"Q131198",nameEn:"Heard Island and McDonald Islands",country:"AU",groups:["053","009","UN"],driveSide:"left"},geometry:{type:"MultiPolygon",coordinates:[[[[71.08716,-53.87687],[75.44182,-53.99822],[72.87012,-51.48322],[71.08716,-53.87687]]]]}},{type:"Feature",properties:{iso1A2:"HN",iso1A3:"HND",iso1N3:"340",wikidata:"Q783",nameEn:"Honduras",groups:["013","003","419","019","UN"],callingCodes:["504"]},geometry:{type:"MultiPolygon",coordinates:[[[[-83.86109,17.73736],[-88.20359,16.03858],[-88.22552,15.72294],[-88.24022,15.69247],[-88.31459,15.66942],[-88.32467,15.63665],[-88.97343,15.14039],[-89.15149,15.07392],[-89.18048,14.99967],[-89.15149,14.97775],[-89.23467,14.85596],[-89.13132,14.71582],[-89.15653,14.57802],[-89.23719,14.58046],[-89.35189,14.47553],[-89.34776,14.43013],[-89.04187,14.33644],[-88.94608,14.20207],[-88.85785,14.17763],[-88.815,14.11652],[-88.73182,14.10919],[-88.70661,14.04317],[-88.49738,13.97224],[-88.48982,13.86458],[-88.25791,13.91108],[-88.23018,13.99915],[-88.07641,13.98447],[-88.00331,13.86948],[-87.7966,13.91353],[-87.68821,13.80829],[-87.73106,13.75443],[-87.78148,13.52906],[-87.71657,13.50577],[-87.72115,13.46083],[-87.73841,13.44169],[-87.77354,13.45767],[-87.83467,13.44655],[-87.84675,13.41078],[-87.80177,13.35689],[-87.73714,13.32715],[-87.69751,13.25228],[-87.55124,13.12523],[-87.37107,12.98646],[-87.06306,13.00892],[-87.03785,12.98682],[-86.93197,13.05313],[-86.93383,13.18677],[-86.87066,13.30641],[-86.71267,13.30348],[-86.76812,13.79605],[-86.35219,13.77157],[-86.14801,14.04317],[-86.00685,14.08474],[-86.03458,13.99181],[-85.75477,13.8499],[-85.73964,13.9698],[-85.45762,14.11304],[-85.32149,14.2562],[-85.18602,14.24929],[-85.1575,14.53934],[-84.90082,14.80489],[-84.82596,14.82212],[-84.70119,14.68078],[-84.48373,14.63249],[-84.10584,14.76353],[-83.89551,14.76697],[-83.62101,14.89448],[-83.49268,15.01158],[-83.13724,15.00002],[-83.04763,15.03256],[-82.06974,14.49418],[-81.58685,18.0025],[-83.86109,17.73736]]]]}},{type:"Feature",properties:{iso1A2:"HR",iso1A3:"HRV",iso1N3:"191",wikidata:"Q224",nameEn:"Croatia",groups:["EU","039","150","UN"],callingCodes:["385"]},geometry:{type:"MultiPolygon",coordinates:[[[[17.6444,42.88641],[17.5392,42.92787],[17.70879,42.97223],[17.64268,43.08595],[17.46986,43.16559],[17.286,43.33065],[17.25579,43.40353],[17.29699,43.44542],[17.24411,43.49376],[17.15828,43.49376],[17.00585,43.58037],[16.80736,43.76011],[16.75316,43.77157],[16.70922,43.84887],[16.55472,43.95326],[16.50528,44.0244],[16.43629,44.02826],[16.43662,44.07523],[16.36864,44.08263],[16.18688,44.27012],[16.21346,44.35231],[16.12969,44.38275],[16.16814,44.40679],[16.10566,44.52586],[16.03012,44.55572],[16.00884,44.58605],[16.05828,44.61538],[15.89348,44.74964],[15.8255,44.71501],[15.72584,44.82334],[15.79472,44.8455],[15.76096,44.87045],[15.74723,44.96818],[15.78568,44.97401],[15.74585,45.0638],[15.78842,45.11519],[15.76371,45.16508],[15.83512,45.22459],[15.98412,45.23088],[16.12153,45.09616],[16.29036,44.99732],[16.35404,45.00241],[16.35863,45.03529],[16.3749,45.05206],[16.38219,45.05139],[16.38309,45.05955],[16.40023,45.1147],[16.4634,45.14522],[16.49155,45.21153],[16.52982,45.22713],[16.5501,45.2212],[16.56559,45.22307],[16.60194,45.23042],[16.64962,45.20714],[16.74845,45.20393],[16.78219,45.19002],[16.81137,45.18434],[16.83804,45.18951],[16.92405,45.27607],[16.9385,45.22742],[17.0415,45.20759],[17.18438,45.14764],[17.24325,45.146],[17.25131,45.14957],[17.26815,45.18444],[17.32092,45.16246],[17.33573,45.14521],[17.41229,45.13335],[17.4498,45.16119],[17.45615,45.12523],[17.47589,45.12656],[17.51469,45.10791],[17.59104,45.10816],[17.66571,45.13408],[17.84826,45.04489],[17.87148,45.04645],[17.93706,45.08016],[17.97336,45.12245],[17.97834,45.13831],[17.99479,45.14958],[18.01594,45.15163],[18.03121,45.12632],[18.1624,45.07654],[18.24387,45.13699],[18.32077,45.1021],[18.41896,45.11083],[18.47939,45.05871],[18.65723,45.07544],[18.78357,44.97741],[18.80661,44.93561],[18.76369,44.93707],[18.76347,44.90669],[18.8704,44.85097],[19.01994,44.85493],[18.98957,44.90645],[19.02871,44.92541],[19.06853,44.89915],[19.15573,44.95409],[19.05205,44.97692],[19.1011,45.01191],[19.07952,45.14668],[19.14063,45.12972],[19.19144,45.17863],[19.43589,45.17137],[19.41941,45.23475],[19.28208,45.23813],[19.10774,45.29547],[18.97446,45.37528],[18.99918,45.49333],[19.08364,45.48804],[19.07471,45.53086],[18.94562,45.53712],[18.88776,45.57253],[18.96691,45.66731],[18.90305,45.71863],[18.85783,45.85493],[18.81394,45.91329],[18.80211,45.87995],[18.6792,45.92057],[18.57483,45.80772],[18.44368,45.73972],[18.12439,45.78905],[18.08869,45.76511],[17.99805,45.79671],[17.87377,45.78522],[17.66545,45.84207],[17.56821,45.93728],[17.35672,45.95209],[17.14592,46.16697],[16.8903,46.28122],[16.8541,46.36255],[16.7154,46.39523],[16.6639,46.45203],[16.59527,46.47524],[16.52604,46.47831],[16.5007,46.49644],[16.44036,46.5171],[16.38771,46.53608],[16.37193,46.55008],[16.29793,46.5121],[16.26733,46.51505],[16.26759,46.50566],[16.23961,46.49653],[16.25124,46.48067],[16.27398,46.42875],[16.27329,46.41467],[16.30162,46.40437],[16.30233,46.37837],[16.18824,46.38282],[16.14859,46.40547],[16.05281,46.39141],[16.05065,46.3833],[16.07314,46.36458],[16.07616,46.3463],[15.97965,46.30652],[15.79284,46.25811],[15.78817,46.21719],[15.75479,46.20336],[15.75436,46.21969],[15.67395,46.22478],[15.6434,46.21396],[15.64904,46.19229],[15.59909,46.14761],[15.6083,46.11992],[15.62317,46.09103],[15.72977,46.04682],[15.71246,46.01196],[15.70327,46.00015],[15.70636,45.92116],[15.67967,45.90455],[15.68383,45.88867],[15.68232,45.86819],[15.70411,45.8465],[15.66662,45.84085],[15.64185,45.82915],[15.57952,45.84953],[15.52234,45.82195],[15.47325,45.8253],[15.47531,45.79802],[15.40836,45.79491],[15.25423,45.72275],[15.30872,45.69014],[15.34919,45.71623],[15.4057,45.64727],[15.38952,45.63682],[15.34214,45.64702],[15.34695,45.63382],[15.31027,45.6303],[15.27747,45.60504],[15.29837,45.5841],[15.30249,45.53224],[15.38188,45.48752],[15.33051,45.45258],[15.27758,45.46678],[15.16862,45.42309],[15.05187,45.49079],[15.02385,45.48533],[14.92266,45.52788],[14.90554,45.47769],[14.81992,45.45913],[14.80124,45.49515],[14.71718,45.53442],[14.68605,45.53006],[14.69694,45.57366],[14.59576,45.62812],[14.60977,45.66403],[14.57397,45.67165],[14.53816,45.6205],[14.5008,45.60852],[14.49769,45.54424],[14.36693,45.48642],[14.32487,45.47142],[14.27681,45.4902],[14.26611,45.48239],[14.24239,45.50607],[14.22371,45.50388],[14.20348,45.46896],[14.07116,45.48752],[14.00578,45.52352],[13.96063,45.50825],[13.99488,45.47551],[13.97309,45.45258],[13.90771,45.45149],[13.88124,45.42637],[13.81742,45.43729],[13.7785,45.46787],[13.67398,45.4436],[13.62902,45.45898],[13.56979,45.4895],[13.45644,45.59464],[13.05142,45.33128],[13.12821,44.48877],[16.15283,42.18525],[18.45131,42.21682],[18.54128,42.39171],[18.52152,42.42302],[18.43588,42.48556],[18.44307,42.51077],[18.43735,42.55921],[18.36197,42.61423],[18.24318,42.6112],[17.88201,42.83668],[17.80854,42.9182],[17.7948,42.89556],[17.68151,42.92725],[17.6444,42.88641]]]]}},{type:"Feature",properties:{iso1A2:"HT",iso1A3:"HTI",iso1N3:"332",wikidata:"Q790",nameEn:"Haiti",aliases:["RH"],groups:["029","003","419","019","UN"],callingCodes:["509"]},geometry:{type:"MultiPolygon",coordinates:[[[[-71.71885,18.78423],[-71.72624,18.87802],[-71.77766,18.95007],[-71.88102,18.95007],[-71.74088,19.0437],[-71.71088,19.08353],[-71.69938,19.10916],[-71.65337,19.11759],[-71.62642,19.21212],[-71.73229,19.26686],[-71.77766,19.33823],[-71.69448,19.37866],[-71.6802,19.45008],[-71.71268,19.53374],[-71.71449,19.55364],[-71.7429,19.58445],[-71.75865,19.70231],[-71.77419,19.73128],[-72.38946,20.27111],[-73.37289,20.43199],[-74.7289,18.71009],[-74.76465,18.06252],[-72.29523,17.48026],[-71.75671,18.03456],[-71.73783,18.07177],[-71.74994,18.11115],[-71.75465,18.14405],[-71.78271,18.18302],[-71.69952,18.34101],[-71.90875,18.45821],[-71.88102,18.50125],[-72.00201,18.62312],[-71.95412,18.64939],[-71.82556,18.62551],[-71.71885,18.78423]]]]}},{type:"Feature",properties:{iso1A2:"HU",iso1A3:"HUN",iso1N3:"348",wikidata:"Q28",nameEn:"Hungary",groups:["EU","151","150","UN"],callingCodes:["36"]},geometry:{type:"MultiPolygon",coordinates:[[[[21.72525,48.34628],[21.67134,48.3989],[21.6068,48.50365],[21.44063,48.58456],[21.11516,48.49546],[20.83248,48.5824],[20.5215,48.53336],[20.29943,48.26104],[20.24312,48.2784],[19.92452,48.1283],[19.63338,48.25006],[19.52489,48.19791],[19.47957,48.09437],[19.28182,48.08336],[19.23924,48.0595],[19.01952,48.07052],[18.82176,48.04206],[18.76134,47.97499],[18.76821,47.87469],[18.8506,47.82308],[18.74074,47.8157],[18.66521,47.76772],[18.56496,47.76588],[18.29305,47.73541],[18.02938,47.75665],[17.71215,47.7548],[17.23699,48.02094],[17.16001,48.00636],[17.09786,47.97336],[17.11022,47.92461],[17.08275,47.87719],[17.00997,47.86245],[17.07039,47.81129],[17.05048,47.79377],[17.08893,47.70928],[16.87538,47.68895],[16.86509,47.72268],[16.82938,47.68432],[16.7511,47.67878],[16.72089,47.73469],[16.65679,47.74197],[16.61183,47.76171],[16.54779,47.75074],[16.53514,47.73837],[16.55129,47.72268],[16.4222,47.66537],[16.58699,47.61772],[16.64193,47.63114],[16.71059,47.52692],[16.64821,47.50155],[16.6718,47.46139],[16.57152,47.40868],[16.52414,47.41007],[16.49908,47.39416],[16.45104,47.41181],[16.47782,47.25918],[16.44142,47.25079],[16.43663,47.21127],[16.41739,47.20649],[16.42801,47.18422],[16.4523,47.18812],[16.46442,47.16845],[16.44932,47.14418],[16.52863,47.13974],[16.46134,47.09395],[16.52176,47.05747],[16.43936,47.03548],[16.51369,47.00084],[16.28202,47.00159],[16.27594,46.9643],[16.22403,46.939],[16.19904,46.94134],[16.10983,46.867],[16.14365,46.8547],[16.15711,46.85434],[16.21892,46.86961],[16.2365,46.87775],[16.2941,46.87137],[16.34547,46.83836],[16.3408,46.80641],[16.31303,46.79838],[16.30966,46.7787],[16.37816,46.69975],[16.42641,46.69228],[16.41863,46.66238],[16.38594,46.6549],[16.39217,46.63673],[16.50139,46.56684],[16.52885,46.53303],[16.52604,46.5051],[16.59527,46.47524],[16.6639,46.45203],[16.7154,46.39523],[16.8541,46.36255],[16.8903,46.28122],[17.14592,46.16697],[17.35672,45.95209],[17.56821,45.93728],[17.66545,45.84207],[17.87377,45.78522],[17.99805,45.79671],[18.08869,45.76511],[18.12439,45.78905],[18.44368,45.73972],[18.57483,45.80772],[18.6792,45.92057],[18.80211,45.87995],[18.81394,45.91329],[18.99712,45.93537],[19.01284,45.96529],[19.0791,45.96458],[19.10388,46.04015],[19.14543,45.9998],[19.28826,45.99694],[19.52473,46.1171],[19.56113,46.16824],[19.66007,46.19005],[19.81491,46.1313],[19.93508,46.17553],[20.01816,46.17696],[20.03533,46.14509],[20.09713,46.17315],[20.26068,46.12332],[20.28324,46.1438],[20.35573,46.16629],[20.45377,46.14405],[20.49718,46.18721],[20.63863,46.12728],[20.76085,46.21002],[20.74574,46.25467],[20.86797,46.28884],[21.06572,46.24897],[21.16872,46.30118],[21.28061,46.44941],[21.26929,46.4993],[21.33214,46.63035],[21.43926,46.65109],[21.5151,46.72147],[21.48935,46.7577],[21.52028,46.84118],[21.59307,46.86935],[21.59581,46.91628],[21.68645,46.99595],[21.648,47.03902],[21.78395,47.11104],[21.94463,47.38046],[22.01055,47.37767],[22.03389,47.42508],[22.00917,47.50492],[22.31816,47.76126],[22.41979,47.7391],[22.46559,47.76583],[22.67247,47.7871],[22.76617,47.8417],[22.77991,47.87211],[22.89849,47.95851],[22.84276,47.98602],[22.87847,48.04665],[22.81804,48.11363],[22.73427,48.12005],[22.66835,48.09162],[22.58733,48.10813],[22.59007,48.15121],[22.49806,48.25189],[22.38133,48.23726],[22.2083,48.42534],[22.14689,48.4005],[21.83339,48.36242],[21.8279,48.33321],[21.72525,48.34628]]]]}},{type:"Feature",properties:{iso1A2:"IC",wikidata:"Q5813",nameEn:"Canary Islands",country:"ES",groups:["Q3320166","Q105472","EU","039","150","UN"],isoStatus:"excRes",callingCodes:["34"]},geometry:{type:"MultiPolygon",coordinates:[[[[-12.00985,30.24121],[-25.3475,27.87574],[-14.43883,27.02969],[-12.00985,30.24121]]]]}},{type:"Feature",properties:{iso1A2:"ID",iso1A3:"IDN",iso1N3:"360",wikidata:"Q252",nameEn:"Indonesia",aliases:["RI"]},geometry:null},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-6.26218,54.09785],[-6.29003,54.11278],[-6.32694,54.09337],[-6.36279,54.11248],[-6.36605,54.07234],[-6.47849,54.06947],[-6.62842,54.03503],[-6.66264,54.0666],[-6.6382,54.17071],[-6.70175,54.20218],[-6.74575,54.18788],[-6.81583,54.22791],[-6.85179,54.29176],[-6.87775,54.34682],[-7.02034,54.4212],[-7.19145,54.31296],[-7.14908,54.22732],[-7.25012,54.20063],[-7.26316,54.13863],[-7.29493,54.12013],[-7.29687,54.1354],[-7.28017,54.16714],[-7.29157,54.17191],[-7.34005,54.14698],[-7.30553,54.11869],[-7.32834,54.11475],[-7.44567,54.1539],[-7.4799,54.12239],[-7.55812,54.12239],[-7.69501,54.20731],[-7.81397,54.20159],[-7.8596,54.21779],[-7.87101,54.29299],[-8.04555,54.36292],[-8.179,54.46763],[-8.04538,54.48941],[-7.99812,54.54427],[-7.8596,54.53671],[-7.70315,54.62077],[-7.93293,54.66603],[-7.83352,54.73854],[-7.75041,54.7103],[-7.64449,54.75265],[-7.54671,54.74606],[-7.54508,54.79401],[-7.47626,54.83084],[-7.4473,54.87003],[-7.44404,54.9403],[-7.40004,54.94498],[-7.4033,55.00391],[-7.34464,55.04688],[-7.2471,55.06933],[-6.34755,55.49206],[-7.75229,55.93854],[-11.75,54],[-11,51],[-6.03913,51.13217],[-5.37267,53.63269],[-6.26218,54.09785]]]]},properties:{iso1A2:"IE",iso1A3:"IRL",iso1N3:"372",wikidata:"Q27",nameEn:"Republic of Ireland",groups:["EU","Q22890","154","150","UN"],driveSide:"left",callingCodes:["353"]}},{type:"Feature",properties:{iso1A2:"IL",iso1A3:"ISR",iso1N3:"376",wikidata:"Q801",nameEn:"Israel",groups:["145","142","UN"],callingCodes:["972"]},geometry:{type:"MultiPolygon",coordinates:[[[[34.052,31.46619],[34.29262,31.70393],[34.48681,31.59711],[34.56797,31.54197],[34.48892,31.48365],[34.40077,31.40926],[34.36505,31.36404],[34.37381,31.30598],[34.36523,31.28963],[34.29417,31.24194],[34.26742,31.21998],[34.92298,29.45305],[34.97718,29.54294],[34.98207,29.58147],[35.02147,29.66343],[35.14108,30.07374],[35.19183,30.34636],[35.16218,30.43535],[35.19595,30.50297],[35.21379,30.60401],[35.29311,30.71365],[35.33456,30.81224],[35.33984,30.8802],[35.41371,30.95565],[35.43658,31.12444],[35.40316,31.25535],[35.47672,31.49578],[35.39675,31.49572],[35.22921,31.37445],[35.13033,31.3551],[35.02459,31.35979],[34.92571,31.34337],[34.88932,31.37093],[34.87833,31.39321],[34.89756,31.43891],[34.93258,31.47816],[34.94356,31.50743],[34.9415,31.55601],[34.95249,31.59813],[35.00879,31.65426],[35.08226,31.69107],[35.10782,31.71594],[35.11895,31.71454],[35.12933,31.7325],[35.13931,31.73012],[35.15119,31.73634],[35.15474,31.73352],[35.16478,31.73242],[35.18023,31.72067],[35.20538,31.72388],[35.21937,31.71578],[35.22392,31.71899],[35.23972,31.70896],[35.24315,31.71244],[35.2438,31.7201],[35.24981,31.72543],[35.25182,31.73945],[35.26319,31.74846],[35.25225,31.7678],[35.26058,31.79064],[35.25573,31.81362],[35.26404,31.82567],[35.251,31.83085],[35.25753,31.8387],[35.24816,31.8458],[35.2304,31.84222],[35.2249,31.85433],[35.22817,31.8638],[35.22567,31.86745],[35.22294,31.87889],[35.22014,31.88264],[35.2136,31.88241],[35.21276,31.88153],[35.21016,31.88237],[35.20945,31.8815],[35.20791,31.8821],[35.20673,31.88151],[35.20381,31.86716],[35.21128,31.863],[35.216,31.83894],[35.21469,31.81835],[35.19461,31.82687],[35.18169,31.82542],[35.18603,31.80901],[35.14174,31.81325],[35.07677,31.85627],[35.05617,31.85685],[35.01978,31.82944],[34.9724,31.83352],[34.99712,31.85569],[35.03489,31.85919],[35.03978,31.89276],[35.03489,31.92448],[35.00124,31.93264],[34.98682,31.96935],[35.00261,32.027],[34.9863,32.09551],[34.99437,32.10962],[34.98507,32.12606],[34.99039,32.14626],[34.96009,32.17503],[34.95703,32.19522],[34.98885,32.20758],[35.01841,32.23981],[35.02939,32.2671],[35.01119,32.28684],[35.01772,32.33863],[35.04243,32.35008],[35.05142,32.3667],[35.0421,32.38242],[35.05311,32.4024],[35.05423,32.41754],[35.07059,32.4585],[35.08564,32.46948],[35.09236,32.47614],[35.10024,32.47856],[35.10882,32.4757],[35.15937,32.50466],[35.2244,32.55289],[35.25049,32.52453],[35.29306,32.50947],[35.30685,32.51024],[35.35212,32.52047],[35.40224,32.50136],[35.42034,32.46009],[35.41598,32.45593],[35.41048,32.43706],[35.42078,32.41562],[35.55807,32.38674],[35.55494,32.42687],[35.57485,32.48669],[35.56614,32.64393],[35.59813,32.65159],[35.61669,32.67999],[35.66527,32.681],[35.68467,32.70715],[35.75983,32.74803],[35.78745,32.77938],[35.83758,32.82817],[35.84021,32.8725],[35.87012,32.91976],[35.89298,32.9456],[35.87188,32.98028],[35.84802,33.1031],[35.81911,33.11077],[35.81911,33.1336],[35.84285,33.16673],[35.83846,33.19397],[35.81647,33.2028],[35.81295,33.24841],[35.77513,33.27342],[35.813,33.3172],[35.77477,33.33609],[35.62019,33.27278],[35.62283,33.24226],[35.58502,33.26653],[35.58326,33.28381],[35.56523,33.28969],[35.55555,33.25844],[35.54544,33.25513],[35.54808,33.236],[35.5362,33.23196],[35.54228,33.19865],[35.52573,33.11921],[35.50335,33.114],[35.50272,33.09056],[35.448,33.09264],[35.43059,33.06659],[35.35223,33.05617],[35.31429,33.10515],[35.1924,33.08743],[35.10645,33.09318],[34.78515,33.20368],[33.62659,31.82938],[34.052,31.46619]]]]}},{type:"Feature",properties:{iso1A2:"IM",iso1A3:"IMN",iso1N3:"833",wikidata:"Q9676",nameEn:"Isle of Man",country:"GB",groups:["Q185086","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01624","44 07624","44 07524","44 07924"]},geometry:{type:"MultiPolygon",coordinates:[[[[-3.98763,54.07351],[-4.1819,54.57861],[-5.6384,53.81157],[-3.98763,54.07351]]]]}},{type:"Feature",properties:{iso1A2:"IN",iso1A3:"IND",iso1N3:"356",wikidata:"Q668",nameEn:"India"},geometry:null},{type:"Feature",properties:{iso1A2:"IO",iso1A3:"IOT",iso1N3:"086",wikidata:"Q43448",nameEn:"British Indian Ocean Territory",country:"GB"},geometry:null},{type:"Feature",properties:{iso1A2:"IQ",iso1A3:"IRQ",iso1N3:"368",wikidata:"Q796",nameEn:"Iraq",groups:["145","142","UN"],callingCodes:["964"]},geometry:{type:"MultiPolygon",coordinates:[[[[42.78887,37.38615],[42.56725,37.14878],[42.35724,37.10998],[42.36697,37.0627],[41.81736,36.58782],[41.40058,36.52502],[41.28864,36.35368],[41.2564,36.06012],[41.37027,35.84095],[41.38184,35.62502],[41.26569,35.42708],[41.21654,35.1508],[41.2345,34.80049],[41.12388,34.65742],[40.97676,34.39788],[40.64314,34.31604],[38.79171,33.37328],[39.08202,32.50304],[38.98762,32.47694],[39.04251,32.30203],[39.26157,32.35555],[39.29903,32.23259],[40.01521,32.05667],[42.97601,30.72204],[42.97796,30.48295],[44.72255,29.19736],[46.42415,29.05947],[46.5527,29.10283],[46.89695,29.50584],[47.15166,30.01044],[47.37192,30.10421],[47.7095,30.10453],[48.01114,29.98906],[48.06782,30.02906],[48.17332,30.02448],[48.40479,29.85763],[48.59531,29.66815],[48.83867,29.78572],[48.61441,29.93675],[48.51011,29.96238],[48.44785,30.00148],[48.4494,30.04456],[48.43384,30.08233],[48.38869,30.11062],[48.38714,30.13485],[48.41671,30.17254],[48.41117,30.19846],[48.26393,30.3408],[48.24385,30.33846],[48.21279,30.31644],[48.19425,30.32796],[48.18321,30.39703],[48.14585,30.44133],[48.02443,30.4789],[48.03221,30.9967],[47.68219,31.00004],[47.6804,31.39086],[47.86337,31.78422],[47.64771,32.07666],[47.52474,32.15972],[47.57144,32.20583],[47.37529,32.47808],[47.17218,32.45393],[46.46788,32.91992],[46.32298,32.9731],[46.17198,32.95612],[46.09103,32.98354],[46.15175,33.07229],[46.03966,33.09577],[46.05367,33.13097],[46.11905,33.11924],[46.20623,33.20395],[45.99919,33.5082],[45.86687,33.49263],[45.96183,33.55751],[45.89801,33.63661],[45.77814,33.60938],[45.50261,33.94968],[45.42789,33.9458],[45.41077,33.97421],[45.47264,34.03099],[45.56176,34.15088],[45.58667,34.30147],[45.53552,34.35148],[45.49171,34.3439],[45.46697,34.38221],[45.43879,34.45949],[45.51883,34.47692],[45.53219,34.60441],[45.59074,34.55558],[45.60224,34.55057],[45.73923,34.54416],[45.70031,34.69277],[45.65672,34.7222],[45.68284,34.76624],[45.70031,34.82322],[45.73641,34.83975],[45.79682,34.85133],[45.78904,34.91135],[45.86532,34.89858],[45.89477,34.95805],[45.87864,35.03441],[45.92173,35.0465],[45.92203,35.09538],[45.93108,35.08148],[45.94756,35.09188],[46.06508,35.03699],[46.07747,35.0838],[46.11763,35.07551],[46.19116,35.11097],[46.15642,35.1268],[46.16229,35.16984],[46.19738,35.18536],[46.18457,35.22561],[46.11367,35.23729],[46.15474,35.2883],[46.13152,35.32548],[46.05358,35.38568],[45.98453,35.49848],[46.01518,35.52012],[45.97584,35.58132],[46.03028,35.57416],[46.01307,35.59756],[46.0165,35.61501],[45.99452,35.63574],[46.0117,35.65059],[46.01631,35.69139],[46.23736,35.71414],[46.34166,35.78363],[46.32921,35.82655],[46.17198,35.8013],[46.08325,35.8581],[45.94711,35.82218],[45.89784,35.83708],[45.81442,35.82107],[45.76145,35.79898],[45.6645,35.92872],[45.60018,35.96069],[45.55245,35.99943],[45.46594,36.00042],[45.38275,35.97156],[45.33916,35.99424],[45.37652,36.06222],[45.37312,36.09917],[45.32235,36.17383],[45.30038,36.27769],[45.26261,36.3001],[45.27394,36.35846],[45.23953,36.43257],[45.11811,36.40751],[45.00759,36.5402],[45.06985,36.62645],[45.06985,36.6814],[45.01537,36.75128],[44.84725,36.77622],[44.83479,36.81362],[44.90173,36.86096],[44.91199,36.91468],[44.89862,37.01897],[44.81611,37.04383],[44.75229,37.11958],[44.78319,37.1431],[44.76698,37.16162],[44.63179,37.19229],[44.42631,37.05825],[44.38117,37.05825],[44.35315,37.04955],[44.35937,37.02843],[44.30645,36.97373],[44.25975,36.98119],[44.18503,37.09551],[44.22239,37.15756],[44.27998,37.16501],[44.2613,37.25055],[44.13521,37.32486],[44.02002,37.33229],[43.90949,37.22453],[43.84878,37.22205],[43.82699,37.19477],[43.8052,37.22825],[43.7009,37.23692],[43.63085,37.21957],[43.56702,37.25675],[43.50787,37.24436],[43.33508,37.33105],[43.30083,37.30629],[43.11403,37.37436],[42.93705,37.32015],[42.78887,37.38615]]]]}},{type:"Feature",properties:{iso1A2:"IR",iso1A3:"IRN",iso1N3:"364",wikidata:"Q794",nameEn:"Iran",groups:["034","142","UN"],callingCodes:["98"]},geometry:{type:"MultiPolygon",coordinates:[[[[44.96746,39.42998],[44.88916,39.59653],[44.81043,39.62677],[44.71806,39.71124],[44.65422,39.72163],[44.6137,39.78393],[44.47298,39.68788],[44.48111,39.61579],[44.41849,39.56659],[44.42832,39.4131],[44.37921,39.4131],[44.29818,39.378],[44.22452,39.4169],[44.03667,39.39223],[44.1043,39.19842],[44.20946,39.13975],[44.18863,38.93881],[44.30322,38.81581],[44.26155,38.71427],[44.28065,38.6465],[44.32058,38.62752],[44.3207,38.49799],[44.3119,38.37887],[44.38309,38.36117],[44.44386,38.38295],[44.50115,38.33939],[44.42476,38.25763],[44.22509,37.88859],[44.3883,37.85433],[44.45948,37.77065],[44.55498,37.783],[44.62096,37.71985],[44.56887,37.6429],[44.61401,37.60165],[44.58449,37.45018],[44.81021,37.2915],[44.75986,37.21549],[44.7868,37.16644],[44.78319,37.1431],[44.75229,37.11958],[44.81611,37.04383],[44.89862,37.01897],[44.91199,36.91468],[44.90173,36.86096],[44.83479,36.81362],[44.84725,36.77622],[45.01537,36.75128],[45.06985,36.6814],[45.06985,36.62645],[45.00759,36.5402],[45.11811,36.40751],[45.23953,36.43257],[45.27394,36.35846],[45.26261,36.3001],[45.30038,36.27769],[45.32235,36.17383],[45.37312,36.09917],[45.37652,36.06222],[45.33916,35.99424],[45.38275,35.97156],[45.46594,36.00042],[45.55245,35.99943],[45.60018,35.96069],[45.6645,35.92872],[45.76145,35.79898],[45.81442,35.82107],[45.89784,35.83708],[45.94711,35.82218],[46.08325,35.8581],[46.17198,35.8013],[46.32921,35.82655],[46.34166,35.78363],[46.23736,35.71414],[46.01631,35.69139],[46.0117,35.65059],[45.99452,35.63574],[46.0165,35.61501],[46.01307,35.59756],[46.03028,35.57416],[45.97584,35.58132],[46.01518,35.52012],[45.98453,35.49848],[46.05358,35.38568],[46.13152,35.32548],[46.15474,35.2883],[46.11367,35.23729],[46.18457,35.22561],[46.19738,35.18536],[46.16229,35.16984],[46.15642,35.1268],[46.19116,35.11097],[46.11763,35.07551],[46.07747,35.0838],[46.06508,35.03699],[45.94756,35.09188],[45.93108,35.08148],[45.92203,35.09538],[45.92173,35.0465],[45.87864,35.03441],[45.89477,34.95805],[45.86532,34.89858],[45.78904,34.91135],[45.79682,34.85133],[45.73641,34.83975],[45.70031,34.82322],[45.68284,34.76624],[45.65672,34.7222],[45.70031,34.69277],[45.73923,34.54416],[45.60224,34.55057],[45.59074,34.55558],[45.53219,34.60441],[45.51883,34.47692],[45.43879,34.45949],[45.46697,34.38221],[45.49171,34.3439],[45.53552,34.35148],[45.58667,34.30147],[45.56176,34.15088],[45.47264,34.03099],[45.41077,33.97421],[45.42789,33.9458],[45.50261,33.94968],[45.77814,33.60938],[45.89801,33.63661],[45.96183,33.55751],[45.86687,33.49263],[45.99919,33.5082],[46.20623,33.20395],[46.11905,33.11924],[46.05367,33.13097],[46.03966,33.09577],[46.15175,33.07229],[46.09103,32.98354],[46.17198,32.95612],[46.32298,32.9731],[46.46788,32.91992],[47.17218,32.45393],[47.37529,32.47808],[47.57144,32.20583],[47.52474,32.15972],[47.64771,32.07666],[47.86337,31.78422],[47.6804,31.39086],[47.68219,31.00004],[48.03221,30.9967],[48.02443,30.4789],[48.14585,30.44133],[48.18321,30.39703],[48.19425,30.32796],[48.21279,30.31644],[48.24385,30.33846],[48.26393,30.3408],[48.41117,30.19846],[48.41671,30.17254],[48.38714,30.13485],[48.38869,30.11062],[48.43384,30.08233],[48.4494,30.04456],[48.44785,30.00148],[48.51011,29.96238],[48.61441,29.93675],[48.83867,29.78572],[49.98877,27.87827],[50.37726,27.89227],[54.39838,25.68383],[55.14145,25.62624],[55.81777,26.18798],[56.2644,26.58649],[56.68954,26.76645],[56.79239,26.41236],[56.82555,25.7713],[56.86325,25.03856],[61.46682,24.57869],[61.6433,25.27541],[61.683,25.66638],[61.83968,25.7538],[61.83831,26.07249],[61.89391,26.26251],[62.05117,26.31647],[62.21304,26.26601],[62.31484,26.528],[62.77352,26.64099],[63.1889,26.65072],[63.18688,26.83844],[63.25005,26.84212],[63.25005,27.08692],[63.32283,27.14437],[63.19649,27.25674],[62.80604,27.22412],[62.79684,27.34381],[62.84905,27.47627],[62.7638,28.02992],[62.79412,28.28108],[62.59499,28.24842],[62.40259,28.42703],[61.93581,28.55284],[61.65978,28.77937],[61.53765,29.00507],[61.31508,29.38903],[60.87231,29.86514],[61.80829,30.84224],[61.78268,30.92724],[61.8335,30.97669],[61.83257,31.0452],[61.80957,31.12576],[61.80569,31.16167],[61.70929,31.37391],[60.84541,31.49561],[60.86191,32.22565],[60.56485,33.12944],[60.88908,33.50219],[60.91133,33.55596],[60.69573,33.56054],[60.57762,33.59772],[60.5485,33.73422],[60.5838,33.80793],[60.50209,34.13992],[60.66502,34.31539],[60.91321,34.30411],[60.72316,34.52857],[60.99922,34.63064],[61.00197,34.70631],[61.06926,34.82139],[61.12831,35.09938],[61.0991,35.27845],[61.18187,35.30249],[61.27371,35.61482],[61.22719,35.67038],[61.26152,35.80749],[61.22444,35.92879],[61.12007,35.95992],[61.22719,36.12759],[61.1393,36.38782],[61.18187,36.55348],[61.14516,36.64644],[60.34767,36.63214],[60.00768,37.04102],[59.74678,37.12499],[59.55178,37.13594],[59.39385,37.34257],[59.39797,37.47892],[59.33507,37.53146],[59.22905,37.51161],[58.9338,37.67374],[58.6921,37.64548],[58.5479,37.70526],[58.47786,37.6433],[58.39959,37.63134],[58.22999,37.6856],[58.21399,37.77281],[57.79534,37.89299],[57.35042,37.98546],[57.37236,38.09321],[57.21169,38.28965],[57.03453,38.18717],[56.73928,38.27887],[56.62255,38.24005],[56.43303,38.26054],[56.32454,38.18502],[56.33278,38.08132],[55.97847,38.08024],[55.76561,38.12238],[55.44152,38.08564],[55.13412,37.94705],[54.851,37.75739],[54.77684,37.62264],[54.81804,37.61285],[54.77822,37.51597],[54.67247,37.43532],[54.58664,37.45809],[54.36211,37.34912],[54.24565,37.32047],[53.89734,37.3464],[48.88288,38.43975],[48.84969,38.45015],[48.81072,38.44853],[48.78979,38.45026],[48.70001,38.40564],[48.62217,38.40198],[48.58793,38.45076],[48.45084,38.61013],[48.3146,38.59958],[48.24773,38.71883],[48.02581,38.82705],[48.01409,38.90333],[48.07734,38.91616],[48.08627,38.94434],[48.28437,38.97186],[48.33884,39.03022],[48.31239,39.09278],[48.15361,39.19419],[48.12404,39.25208],[48.15984,39.30028],[48.37385,39.37584],[48.34264,39.42935],[47.98977,39.70999],[47.84774,39.66285],[47.50099,39.49615],[47.38978,39.45999],[47.31301,39.37492],[47.05927,39.24846],[47.05771,39.20143],[46.95341,39.13505],[46.92539,39.16644],[46.83822,39.13143],[46.75752,39.03231],[46.53497,38.86548],[46.34059,38.92076],[46.20601,38.85262],[46.14785,38.84206],[46.06766,38.87861],[46.00228,38.87376],[45.94624,38.89072],[45.90266,38.87739],[45.83883,38.90768],[45.65172,38.95199],[45.6155,38.94304],[45.6131,38.964],[45.44966,38.99243],[45.44811,39.04927],[45.40452,39.07224],[45.40148,39.09007],[45.30489,39.18333],[45.16168,39.21952],[45.08751,39.35052],[45.05932,39.36435],[44.96746,39.42998]]]]}},{type:"Feature",properties:{iso1A2:"IS",iso1A3:"ISL",iso1N3:"352",wikidata:"Q189",nameEn:"Iceland",groups:["154","150","UN"],callingCodes:["354"]},geometry:{type:"MultiPolygon",coordinates:[[[[-33.15676,62.62995],[-8.25539,63.0423],[-15.70914,69.67442],[-33.15676,62.62995]]]]}},{type:"Feature",properties:{iso1A2:"IT",iso1A3:"ITA",iso1N3:"380",wikidata:"Q38",nameEn:"Italy",groups:["EU","039","150","UN"],callingCodes:["39"]},geometry:{type:"MultiPolygon",coordinates:[[[[8.95861,45.96485],[8.97604,45.96151],[8.97741,45.98317],[8.96668,45.98436],[8.95861,45.96485]]],[[[7.63035,43.57419],[9.56115,43.20816],[10.09675,41.44089],[7.60802,41.05927],[7.89009,38.19924],[11.2718,37.6713],[12.13667,34.20326],[14.02721,36.53141],[17.67657,35.68918],[18.83516,40.36999],[16.15283,42.18525],[13.12821,44.48877],[13.05142,45.33128],[13.45644,45.59464],[13.6076,45.64761],[13.7198,45.59352],[13.74587,45.59811],[13.78445,45.5825],[13.84106,45.58185],[13.86771,45.59898],[13.8695,45.60835],[13.9191,45.6322],[13.87933,45.65207],[13.83422,45.68703],[13.83332,45.70855],[13.8235,45.7176],[13.66986,45.79955],[13.59784,45.8072],[13.58858,45.83503],[13.57563,45.8425],[13.58644,45.88173],[13.59565,45.89446],[13.60857,45.89907],[13.61931,45.91782],[13.63815,45.93607],[13.6329,45.94894],[13.64307,45.98326],[13.63458,45.98947],[13.62074,45.98388],[13.58903,45.99009],[13.56759,45.96991],[13.52963,45.96588],[13.50104,45.98078],[13.47474,46.00546],[13.49702,46.01832],[13.50998,46.04498],[13.49568,46.04839],[13.50104,46.05986],[13.57072,46.09022],[13.64053,46.13587],[13.66472,46.17392],[13.64451,46.18966],[13.56682,46.18703],[13.56114,46.2054],[13.47587,46.22725],[13.42218,46.20758],[13.37671,46.29668],[13.44808,46.33507],[13.43418,46.35992],[13.47019,46.3621],[13.5763,46.40915],[13.5763,46.42613],[13.59777,46.44137],[13.68684,46.43881],[13.7148,46.5222],[13.64088,46.53438],[13.27627,46.56059],[12.94445,46.60401],[12.59992,46.6595],[12.38708,46.71529],[12.27591,46.88651],[12.2006,46.88854],[12.11675,47.01241],[12.21781,47.03996],[12.19254,47.09331],[11.74789,46.98484],[11.50739,47.00644],[11.33355,46.99862],[11.10618,46.92966],[11.00764,46.76896],[10.72974,46.78972],[10.75753,46.82258],[10.66405,46.87614],[10.54783,46.84505],[10.47197,46.85698],[10.38659,46.67847],[10.40475,46.63671],[10.44686,46.64162],[10.49375,46.62049],[10.46136,46.53164],[10.25309,46.57432],[10.23674,46.63484],[10.10307,46.61003],[10.03715,46.44479],[10.165,46.41051],[10.10506,46.3372],[10.17862,46.25626],[10.14439,46.22992],[10.07055,46.21668],[9.95249,46.38045],[9.73086,46.35071],[9.71273,46.29266],[9.57015,46.2958],[9.46117,46.37481],[9.45936,46.50873],[9.40487,46.46621],[9.36128,46.5081],[9.28136,46.49685],[9.25502,46.43743],[9.29226,46.32717],[9.24503,46.23616],[9.01618,46.04928],[8.99257,45.9698],[9.09065,45.89906],[9.06642,45.8761],[9.04546,45.84968],[9.04059,45.8464],[9.03505,45.83976],[9.03793,45.83548],[9.03279,45.82865],[9.0298,45.82127],[9.00324,45.82055],[8.99663,45.83466],[8.9621,45.83707],[8.94737,45.84285],[8.91129,45.8388],[8.93504,45.86245],[8.94372,45.86587],[8.93649,45.86775],[8.88904,45.95465],[8.86688,45.96135],[8.85121,45.97239],[8.8319,45.9879],[8.79362,45.99207],[8.78585,45.98973],[8.79414,46.00913],[8.85617,46.0748],[8.80778,46.10085],[8.75697,46.10395],[8.62242,46.12112],[8.45032,46.26869],[8.46317,46.43712],[8.42464,46.46367],[8.30648,46.41587],[8.31162,46.38044],[8.08814,46.26692],[8.16866,46.17817],[8.11383,46.11577],[8.02906,46.10331],[7.98881,45.99867],[7.9049,45.99945],[7.85949,45.91485],[7.56343,45.97421],[7.10685,45.85653],[7.04151,45.92435],[6.95315,45.85163],[6.80785,45.83265],[6.80785,45.71864],[6.98948,45.63869],[7.00037,45.509],[7.18019,45.40071],[7.10572,45.32924],[7.13115,45.25386],[7.07074,45.21228],[6.96706,45.20841],[6.85144,45.13226],[6.7697,45.16044],[6.62803,45.11175],[6.66981,45.02324],[6.74791,45.01939],[6.74519,44.93661],[6.75518,44.89915],[6.90774,44.84322],[6.93499,44.8664],[7.02217,44.82519],[7.00401,44.78782],[7.07484,44.68073],[7.00582,44.69364],[6.95133,44.66264],[6.96042,44.62129],[6.85507,44.53072],[6.86233,44.49834],[6.94504,44.43112],[6.88784,44.42043],[6.89171,44.36637],[6.98221,44.28289],[7.00764,44.23736],[7.16929,44.20352],[7.27827,44.1462],[7.34547,44.14359],[7.36364,44.11882],[7.62155,44.14881],[7.63245,44.17877],[7.68694,44.17487],[7.66878,44.12795],[7.72508,44.07578],[7.6597,44.03009],[7.66848,43.99943],[7.65266,43.9763],[7.60771,43.95772],[7.56858,43.94506],[7.56075,43.89932],[7.51162,43.88301],[7.49355,43.86551],[7.50423,43.84345],[7.53006,43.78405],[7.63035,43.57419]],[[12.45181,41.90056],[12.44834,41.90095],[12.44582,41.90194],[12.44815,41.90326],[12.44984,41.90545],[12.45091,41.90625],[12.45543,41.90738],[12.45561,41.90629],[12.45762,41.9058],[12.45755,41.9033],[12.45826,41.90281],[12.45834,41.90174],[12.4577,41.90115],[12.45691,41.90125],[12.45626,41.90172],[12.45435,41.90143],[12.45446,41.90028],[12.45181,41.90056]],[[12.45648,43.89369],[12.44184,43.90498],[12.41641,43.89991],[12.40935,43.9024],[12.41233,43.90956],[12.40733,43.92379],[12.41551,43.92984],[12.41165,43.93769],[12.40506,43.94325],[12.40415,43.95485],[12.41414,43.95273],[12.42005,43.9578],[12.43662,43.95698],[12.44684,43.96597],[12.46205,43.97463],[12.47853,43.98052],[12.49406,43.98492],[12.50678,43.99113],[12.51463,43.99122],[12.5154,43.98508],[12.51064,43.98165],[12.51109,43.97201],[12.50622,43.97131],[12.50875,43.96198],[12.50655,43.95796],[12.51427,43.94897],[12.51553,43.94096],[12.50496,43.93017],[12.50269,43.92363],[12.49724,43.92248],[12.49247,43.91774],[12.49429,43.90973],[12.48771,43.89706],[12.45648,43.89369]]]]}},{type:"Feature",properties:{iso1A2:"JE",iso1A3:"JEY",iso1N3:"832",wikidata:"Q785",nameEn:"Bailiwick of Jersey",country:"GB",groups:["830","Q185086","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01534"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.00491,48.86706],[-1.83944,49.23037],[-2.09454,49.46288],[-2.65349,49.15373],[-2.00491,48.86706]]]]}},{type:"Feature",properties:{iso1A2:"JM",iso1A3:"JAM",iso1N3:"388",wikidata:"Q766",nameEn:"Jamaica",aliases:["JA"],groups:["029","003","419","019","UN"],driveSide:"left",callingCodes:["1 876","1 658"]},geometry:{type:"MultiPolygon",coordinates:[[[[-74.09729,17.36817],[-78.9741,19.59515],[-78.34606,16.57862],[-74.09729,17.36817]]]]}},{type:"Feature",properties:{iso1A2:"JO",iso1A3:"JOR",iso1N3:"400",wikidata:"Q810",nameEn:"Jordan",groups:["145","142","UN"],callingCodes:["962"]},geometry:{type:"MultiPolygon",coordinates:[[[[39.04251,32.30203],[38.98762,32.47694],[39.08202,32.50304],[38.79171,33.37328],[36.83946,32.31293],[36.40959,32.37908],[36.23948,32.50108],[36.20875,32.49529],[36.20379,32.52751],[36.08074,32.51463],[36.02239,32.65911],[35.96633,32.66237],[35.93307,32.71966],[35.88405,32.71321],[35.75983,32.74803],[35.68467,32.70715],[35.66527,32.681],[35.61669,32.67999],[35.59813,32.65159],[35.56614,32.64393],[35.57485,32.48669],[35.55494,32.42687],[35.55807,32.38674],[35.57111,32.21877],[35.52012,32.04076],[35.54375,31.96587],[35.52758,31.9131],[35.55941,31.76535],[35.47672,31.49578],[35.40316,31.25535],[35.43658,31.12444],[35.41371,30.95565],[35.33984,30.8802],[35.33456,30.81224],[35.29311,30.71365],[35.21379,30.60401],[35.19595,30.50297],[35.16218,30.43535],[35.19183,30.34636],[35.14108,30.07374],[35.02147,29.66343],[34.98207,29.58147],[34.97718,29.54294],[34.92298,29.45305],[34.8812,29.36878],[36.07081,29.18469],[36.50005,29.49696],[36.75083,29.86903],[37.4971,29.99949],[37.66395,30.33245],[37.99354,30.49998],[36.99791,31.50081],[38.99233,31.99721],[39.29903,32.23259],[39.26157,32.35555],[39.04251,32.30203]]]]}},{type:"Feature",properties:{iso1A2:"JP",iso1A3:"JPN",iso1N3:"392",wikidata:"Q17",nameEn:"Japan",groups:["030","142","UN"],driveSide:"left",callingCodes:["81"]},geometry:{type:"MultiPolygon",coordinates:[[[[145.82361,43.38904],[145.23667,43.76813],[145.82343,44.571],[140.9182,45.92937],[133.61399,37.41],[129.2669,34.87122],[122.26612,25.98197],[123.92912,17.8782],[155.16731,23.60141],[145.82361,43.38904]]]]}},{type:"Feature",properties:{iso1A2:"KE",iso1A3:"KEN",iso1N3:"404",wikidata:"Q114",nameEn:"Kenya",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["254"]},geometry:{type:"MultiPolygon",coordinates:[[[[35.9419,4.61933],[35.51424,4.61643],[35.42366,4.76969],[35.47843,4.91872],[35.30992,4.90402],[35.34151,5.02364],[34.47601,4.72162],[33.9873,4.23316],[34.06046,4.15235],[34.15429,3.80464],[34.45815,3.67385],[34.44922,3.51627],[34.39112,3.48802],[34.41794,3.44342],[34.40006,3.37949],[34.45815,3.18319],[34.56242,3.11478],[34.60114,2.93034],[34.65774,2.8753],[34.73967,2.85447],[34.78137,2.76223],[34.77244,2.70272],[34.95267,2.47209],[34.90947,2.42447],[34.98692,1.97348],[34.9899,1.6668],[34.92734,1.56109],[34.87819,1.5596],[34.7918,1.36752],[34.82606,1.30944],[34.82606,1.26626],[34.80223,1.22754],[34.67562,1.21265],[34.58029,1.14712],[34.57427,1.09868],[34.52369,1.10692],[34.43349,.85254],[34.40041,.80266],[34.31516,.75693],[34.27345,.63182],[34.20196,.62289],[34.13493,.58118],[34.11408,.48884],[34.08727,.44713],[34.10067,.36372],[33.90936,.10581],[33.98449,-.13079],[33.9264,-.54188],[33.93107,-.99298],[34.02286,-1.00779],[34.03084,-1.05101],[34.0824,-1.02264],[37.67199,-3.06222],[37.71745,-3.304],[37.5903,-3.42735],[37.63099,-3.50723],[37.75036,-3.54243],[37.81321,-3.69179],[39.21631,-4.67835],[39.44306,-4.93877],[39.62121,-4.68136],[41.75542,-1.85308],[41.56362,-1.66375],[41.56,-1.59812],[41.00099,-.83068],[40.98767,2.82959],[41.31368,3.14314],[41.89488,3.97375],[41.1754,3.94079],[40.77498,4.27683],[39.86043,3.86974],[39.76808,3.67058],[39.58339,3.47434],[39.55132,3.39634],[39.51551,3.40895],[39.49444,3.45521],[39.19954,3.47834],[39.07736,3.5267],[38.91938,3.51198],[38.52336,3.62551],[38.45812,3.60445],[38.14168,3.62487],[37.07724,4.33503],[36.84474,4.44518],[36.03924,4.44406],[35.95449,4.53244],[35.9419,4.61933]]]]}},{type:"Feature",properties:{iso1A2:"KG",iso1A3:"KGZ",iso1N3:"417",wikidata:"Q813",nameEn:"Kyrgyzstan",groups:["143","142","UN"],callingCodes:["996"]},geometry:{type:"MultiPolygon",coordinates:[[[[74.88756,42.98612],[74.75,42.99029],[74.70331,43.02519],[74.64615,43.05881],[74.57491,43.13702],[74.22489,43.24657],[73.55634,43.03071],[73.50992,42.82356],[73.44393,42.43098],[71.88792,42.83578],[71.62405,42.76613],[71.53272,42.8014],[71.2724,42.77853],[71.22785,42.69248],[71.17807,42.67381],[71.15232,42.60486],[70.97717,42.50147],[70.85973,42.30188],[70.94483,42.26238],[71.13263,42.28356],[71.28719,42.18033],[70.69777,41.92554],[70.17682,41.5455],[70.48909,41.40335],[70.67586,41.47953],[70.78572,41.36419],[70.77885,41.24813],[70.86263,41.23833],[70.9615,41.16393],[71.02193,41.19494],[71.11806,41.15359],[71.25813,41.18796],[71.27187,41.11015],[71.34877,41.16807],[71.40198,41.09436],[71.46148,41.13958],[71.43814,41.19644],[71.46688,41.31883],[71.57227,41.29175],[71.6787,41.42111],[71.65914,41.49599],[71.73054,41.54713],[71.71132,41.43012],[71.76625,41.4466],[71.83914,41.3546],[71.91457,41.2982],[71.85964,41.19081],[72.07249,41.11739],[72.10745,41.15483],[72.16433,41.16483],[72.17594,41.15522],[72.14864,41.13363],[72.1792,41.10621],[72.21061,41.05607],[72.17594,41.02377],[72.18339,40.99571],[72.324,41.03381],[72.34026,41.04539],[72.34757,41.06104],[72.36138,41.04384],[72.38511,41.02785],[72.45206,41.03018],[72.48742,40.97136],[72.55109,40.96046],[72.59136,40.86947],[72.68157,40.84942],[72.84291,40.85512],[72.94454,40.8094],[73.01869,40.84681],[73.13267,40.83512],[73.13412,40.79122],[73.0612,40.76678],[72.99133,40.76457],[72.93296,40.73089],[72.8722,40.71111],[72.85372,40.7116],[72.84754,40.67229],[72.80137,40.67856],[72.74866,40.60873],[72.74894,40.59592],[72.75982,40.57273],[72.74862,40.57131],[72.74768,40.58051],[72.73995,40.58409],[72.69579,40.59778],[72.66713,40.59076],[72.66713,40.5219],[72.47795,40.5532],[72.40517,40.61917],[72.34406,40.60144],[72.41714,40.55736],[72.38384,40.51535],[72.41513,40.50856],[72.44191,40.48222],[72.40346,40.4007],[72.24368,40.46091],[72.18648,40.49893],[71.96401,40.31907],[72.05464,40.27586],[71.85002,40.25647],[71.82646,40.21872],[71.73054,40.14818],[71.71719,40.17886],[71.69621,40.18492],[71.70569,40.20391],[71.68386,40.26984],[71.61931,40.26775],[71.61725,40.20615],[71.51549,40.22986],[71.51215,40.26943],[71.4246,40.28619],[71.36663,40.31593],[71.13042,40.34106],[71.05901,40.28765],[70.95789,40.28761],[70.9818,40.22392],[70.80495,40.16813],[70.7928,40.12797],[70.65827,40.0981],[70.65946,39.9878],[70.58912,39.95211],[70.55033,39.96619],[70.47557,39.93216],[70.57384,39.99394],[70.58297,40.00891],[70.01283,40.23288],[69.67001,40.10639],[69.64704,40.12165],[69.57615,40.10524],[69.55555,40.12296],[69.53794,40.11833],[69.53855,40.0887],[69.5057,40.03277],[69.53615,39.93991],[69.43557,39.92877],[69.43134,39.98431],[69.35649,40.01994],[69.26938,39.8127],[69.3594,39.52516],[69.68677,39.59281],[69.87491,39.53882],[70.11111,39.58223],[70.2869,39.53141],[70.44757,39.60128],[70.64087,39.58792],[70.7854,39.38933],[71.06418,39.41586],[71.08752,39.50704],[71.49814,39.61397],[71.55856,39.57588],[71.5517,39.45722],[71.62688,39.44056],[71.76816,39.45456],[71.80164,39.40631],[71.7522,39.32031],[71.79202,39.27355],[71.90601,39.27674],[72.04059,39.36704],[72.09689,39.26823],[72.17242,39.2661],[72.23834,39.17248],[72.33173,39.33093],[72.62027,39.39696],[72.85934,39.35116],[73.18454,39.35536],[73.31912,39.38615],[73.45096,39.46677],[73.59831,39.46425],[73.87018,39.47879],[73.94683,39.60733],[73.92354,39.69565],[73.9051,39.75073],[73.83006,39.76136],[73.97049,40.04378],[74.25533,40.13191],[74.35063,40.09742],[74.69875,40.34668],[74.85996,40.32857],[74.78168,40.44886],[74.82013,40.52197],[75.08243,40.43945],[75.22834,40.45382],[75.5854,40.66874],[75.69663,40.28642],[75.91361,40.2948],[75.96168,40.38064],[76.33659,40.3482],[76.5261,40.46114],[76.75681,40.95354],[76.99302,41.0696],[77.28004,41.0033],[77.3693,41.0375],[77.52723,41.00227],[77.76206,41.01574],[77.81287,41.14307],[78.12873,41.23091],[78.15757,41.38565],[78.3732,41.39603],[79.92977,42.04113],[80.17842,42.03211],[80.17807,42.21166],[79.97364,42.42816],[79.52921,42.44778],[79.19763,42.804],[78.91502,42.76839],[78.48469,42.89649],[75.82823,42.94848],[75.72174,42.79672],[75.29966,42.86183],[75.22619,42.85528],[74.88756,42.98612]],[[70.74189,39.86319],[70.63105,39.77923],[70.59667,39.83542],[70.54998,39.85137],[70.52631,39.86989],[70.53651,39.89155],[70.74189,39.86319]],[[71.86463,39.98598],[71.84316,39.95582],[71.7504,39.93701],[71.71511,39.96348],[71.78838,40.01404],[71.86463,39.98598]],[[71.21139,40.03369],[71.1427,39.95026],[71.23067,39.93581],[71.16101,39.88423],[71.10531,39.91354],[71.04979,39.89808],[71.10501,39.95568],[71.09063,39.99],[71.11668,39.99291],[71.11037,40.01984],[71.01035,40.05481],[71.00236,40.18154],[71.06305,40.1771],[71.12218,40.03052],[71.21139,40.03369]]]]}},{type:"Feature",properties:{iso1A2:"KH",iso1A3:"KHM",iso1N3:"116",wikidata:"Q424",nameEn:"Cambodia",groups:["035","142","UN"],callingCodes:["855"]},geometry:{type:"MultiPolygon",coordinates:[[[[105.87328,11.55953],[105.81645,11.56876],[105.80867,11.60536],[105.8507,11.66635],[105.88962,11.67854],[105.95188,11.63738],[106.00792,11.7197],[106.02038,11.77457],[106.06708,11.77761],[106.13158,11.73283],[106.18539,11.75171],[106.26478,11.72122],[106.30525,11.67549],[106.37219,11.69836],[106.44691,11.66787],[106.45158,11.68616],[106.41577,11.76999],[106.44535,11.8279],[106.44068,11.86294],[106.4687,11.86751],[106.4111,11.97413],[106.70687,11.96956],[106.79405,12.0807],[106.92325,12.06548],[106.99953,12.08983],[107.15831,12.27547],[107.34511,12.33327],[107.42917,12.24657],[107.4463,12.29373],[107.55059,12.36824],[107.5755,12.52177],[107.55993,12.7982],[107.49611,12.88926],[107.49144,13.01215],[107.62843,13.3668],[107.61909,13.52577],[107.53503,13.73908],[107.45252,13.78897],[107.46498,13.91593],[107.44318,13.99751],[107.38247,13.99147],[107.35757,14.02319],[107.37158,14.07906],[107.33577,14.11832],[107.40427,14.24509],[107.39493,14.32655],[107.44941,14.41552],[107.48521,14.40346],[107.52569,14.54665],[107.52102,14.59034],[107.55371,14.628],[107.54361,14.69092],[107.47238,14.61523],[107.44435,14.52785],[107.37897,14.54443],[107.3276,14.58812],[107.29803,14.58963],[107.26534,14.54292],[107.256,14.48716],[107.21241,14.48716],[107.17038,14.41782],[107.09722,14.3937],[107.03962,14.45099],[107.04585,14.41782],[106.98825,14.36806],[106.9649,14.3198],[106.90574,14.33639],[106.8497,14.29416],[106.80767,14.31226],[106.73762,14.42687],[106.63333,14.44194],[106.59908,14.50977],[106.57106,14.50525],[106.54148,14.59565],[106.50723,14.58963],[106.45898,14.55045],[106.47766,14.50977],[106.43874,14.52032],[106.40916,14.45249],[106.32355,14.44043],[106.25194,14.48415],[106.21302,14.36203],[106.00131,14.36957],[105.99509,14.32734],[106.02311,14.30623],[106.04801,14.20363],[106.10872,14.18401],[106.11962,14.11307],[106.18656,14.06324],[106.16632,14.01794],[106.10094,13.98471],[106.10405,13.9137],[105.90791,13.92881],[105.78182,14.02247],[105.78338,14.08438],[105.5561,14.15684],[105.44869,14.10703],[105.36775,14.09948],[105.2759,14.17496],[105.20894,14.34967],[105.17748,14.34432],[105.14012,14.23873],[105.08408,14.20402],[105.02804,14.23722],[104.97667,14.38806],[104.69335,14.42726],[104.55014,14.36091],[104.27616,14.39861],[103.93836,14.3398],[103.70175,14.38052],[103.71109,14.4348],[103.53518,14.42575],[103.39353,14.35639],[103.16469,14.33075],[102.93275,14.19044],[102.91251,14.01531],[102.77864,13.93374],[102.72727,13.77806],[102.56848,13.69366],[102.5481,13.6589],[102.58635,13.6286],[102.62483,13.60883],[102.57573,13.60461],[102.5358,13.56933],[102.44601,13.5637],[102.36859,13.57488],[102.33828,13.55613],[102.361,13.50551],[102.35563,13.47307],[102.35692,13.38274],[102.34611,13.35618],[102.36001,13.31142],[102.36146,13.26006],[102.43422,13.09061],[102.46011,13.08057],[102.52275,12.99813],[102.48694,12.97537],[102.49335,12.92711],[102.53053,12.77506],[102.4994,12.71736],[102.51963,12.66117],[102.57567,12.65358],[102.7796,12.43781],[102.78116,12.40284],[102.73134,12.37091],[102.70176,12.1686],[102.77026,12.06815],[102.78427,11.98746],[102.83957,11.8519],[102.90973,11.75613],[102.91449,11.65512],[102.52395,11.25257],[102.47649,9.66162],[103.99198,10.48391],[104.43778,10.42386],[104.47963,10.43046],[104.49869,10.4057],[104.59018,10.53073],[104.87933,10.52833],[104.95094,10.64003],[105.09571,10.72722],[105.02722,10.89236],[105.08326,10.95656],[105.11449,10.96332],[105.34011,10.86179],[105.42884,10.96878],[105.50045,10.94586],[105.77751,11.03671],[105.86376,10.89839],[105.84603,10.85873],[105.93403,10.83853],[105.94535,10.9168],[106.06708,10.8098],[106.18539,10.79451],[106.14301,10.98176],[106.20095,10.97795],[106.1757,11.07301],[106.1527,11.10476],[106.10444,11.07879],[105.86782,11.28343],[105.88962,11.43605],[105.87328,11.55953]]]]}},{type:"Feature",properties:{iso1A2:"KI",iso1A3:"KIR",iso1N3:"296",wikidata:"Q710",nameEn:"Kiribati",groups:["057","009","UN"],driveSide:"left",callingCodes:["686"]},geometry:{type:"MultiPolygon",coordinates:[[[[169,3.9],[169,-3.5],[178,-3.5],[178,3.9],[169,3.9]]],[[[-161.06795,5.2462],[-158.12991,-1.86122],[-175.33482,-1.40631],[-175.31804,-7.54825],[-156.50903,-7.4975],[-156.48634,-15.52824],[-135.59706,-4.70473],[-161.06795,5.2462]]]]}},{type:"Feature",properties:{iso1A2:"KM",iso1A3:"COM",iso1N3:"174",wikidata:"Q970",nameEn:"Comoros",groups:["014","202","002","UN"],callingCodes:["269"]},geometry:{type:"MultiPolygon",coordinates:[[[[42.63904,-10.02522],[43.28731,-13.97126],[45.4971,-11.75965],[42.63904,-10.02522]]]]}},{type:"Feature",properties:{iso1A2:"KN",iso1A3:"KNA",iso1N3:"659",wikidata:"Q763",nameEn:"St. Kitts and Nevis",groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 869"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.29333,17.43155],[-62.76692,17.64353],[-63.09677,17.21372],[-62.63813,16.65446],[-62.29333,17.43155]]]]}},{type:"Feature",properties:{iso1A2:"KP",iso1A3:"PRK",iso1N3:"408",wikidata:"Q423",nameEn:"North Korea",groups:["030","142","UN"],callingCodes:["850"]},geometry:{type:"MultiPolygon",coordinates:[[[[130.26095,42.9027],[130.09764,42.91425],[130.12957,42.98361],[129.96409,42.97306],[129.95082,43.01051],[129.8865,43.00395],[129.85261,42.96494],[129.83277,42.86746],[129.80719,42.79218],[129.7835,42.76521],[129.77183,42.69435],[129.75294,42.59409],[129.72541,42.43739],[129.60482,42.44461],[129.54701,42.37254],[129.42882,42.44702],[129.28541,42.41574],[129.22423,42.3553],[129.22285,42.26491],[129.15178,42.17224],[128.96068,42.06657],[128.94007,42.03537],[128.04487,42.01769],[128.15119,41.74568],[128.30716,41.60322],[128.20061,41.40895],[128.18546,41.41279],[128.12967,41.37931],[128.03311,41.39232],[128.02633,41.42103],[127.92943,41.44291],[127.29712,41.49473],[127.17841,41.59714],[126.90729,41.79955],[126.60631,41.65565],[126.53189,41.35206],[126.242,41.15454],[126.00335,40.92835],[125.76869,40.87908],[125.71172,40.85223],[124.86913,40.45387],[124.40719,40.13655],[124.38556,40.11047],[124.3322,40.05573],[124.37089,40.03004],[124.35029,39.95639],[124.23201,39.9248],[124.17532,39.8232],[123.90497,38.79949],[123.85601,37.49093],[124.67666,38.05679],[124.84224,37.977],[124.87921,37.80827],[125.06408,37.66334],[125.37112,37.62643],[125.81159,37.72949],[126.13074,37.70512],[126.18776,37.74728],[126.19097,37.81462],[126.24402,37.83113],[126.43239,37.84095],[126.46818,37.80873],[126.56709,37.76857],[126.59918,37.76364],[126.66067,37.7897],[126.68793,37.83728],[126.68793,37.9175],[126.67023,37.95852],[126.84961,38.0344],[126.88106,38.10246],[126.95887,38.1347],[126.95338,38.17735],[127.04479,38.25518],[127.15749,38.30722],[127.38727,38.33227],[127.49672,38.30647],[127.55013,38.32257],[128.02917,38.31861],[128.27652,38.41657],[128.31105,38.58462],[128.37487,38.62345],[128.65655,38.61914],[131.95041,41.5445],[130.65022,42.32281],[130.66367,42.38024],[130.64181,42.41422],[130.60805,42.4317],[130.56835,42.43281],[130.55143,42.52158],[130.50123,42.61636],[130.44361,42.54849],[130.41826,42.6011],[130.2385,42.71127],[130.23068,42.80125],[130.26095,42.9027]]]]}},{type:"Feature",properties:{iso1A2:"KR",iso1A3:"KOR",iso1N3:"410",wikidata:"Q884",nameEn:"South Korea",groups:["030","142","UN"],callingCodes:["82"]},geometry:{type:"MultiPolygon",coordinates:[[[[133.11729,37.53115],[128.65655,38.61914],[128.37487,38.62345],[128.31105,38.58462],[128.27652,38.41657],[128.02917,38.31861],[127.55013,38.32257],[127.49672,38.30647],[127.38727,38.33227],[127.15749,38.30722],[127.04479,38.25518],[126.95338,38.17735],[126.95887,38.1347],[126.88106,38.10246],[126.84961,38.0344],[126.67023,37.95852],[126.68793,37.9175],[126.68793,37.83728],[126.66067,37.7897],[126.59918,37.76364],[126.56709,37.76857],[126.46818,37.80873],[126.43239,37.84095],[126.24402,37.83113],[126.19097,37.81462],[126.18776,37.74728],[126.13074,37.70512],[125.81159,37.72949],[125.37112,37.62643],[125.06408,37.66334],[124.87921,37.80827],[124.84224,37.977],[124.67666,38.05679],[123.85601,37.49093],[122.80525,33.30571],[125.99728,32.63328],[129.2669,34.87122],[133.11729,37.53115]]]]}},{type:"Feature",properties:{iso1A2:"KW",iso1A3:"KWT",iso1N3:"414",wikidata:"Q817",nameEn:"Kuwait",groups:["145","142","UN"],callingCodes:["965"]},geometry:{type:"MultiPolygon",coordinates:[[[[49.00421,28.81495],[48.59531,29.66815],[48.40479,29.85763],[48.17332,30.02448],[48.06782,30.02906],[48.01114,29.98906],[47.7095,30.10453],[47.37192,30.10421],[47.15166,30.01044],[46.89695,29.50584],[46.5527,29.10283],[47.46202,29.0014],[47.58376,28.83382],[47.59863,28.66798],[47.70561,28.5221],[48.42991,28.53628],[49.00421,28.81495]]]]}},{type:"Feature",properties:{iso1A2:"KY",iso1A3:"CYM",iso1N3:"136",wikidata:"Q5785",nameEn:"Cayman Islands",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 345"]},geometry:{type:"MultiPolygon",coordinates:[[[[-82.11509,19.60401],[-80.36068,18.11751],[-79.32727,20.06742],[-82.11509,19.60401]]]]}},{type:"Feature",properties:{iso1A2:"KZ",iso1A3:"KAZ",iso1N3:"398",wikidata:"Q232",nameEn:"Kazakhstan",groups:["143","142","UN"],callingCodes:["7"]},geometry:{type:"MultiPolygon",coordinates:[[[[68.90865,55.38148],[68.19206,55.18823],[68.26661,55.09226],[68.21308,54.98645],[65.20174,54.55216],[65.24663,54.35721],[65.11033,54.33028],[64.97216,54.4212],[63.97686,54.29763],[64.02715,54.22679],[63.91224,54.20013],[63.80604,54.27079],[62.58651,54.05871],[62.56876,53.94047],[62.45931,53.90737],[62.38535,54.03961],[62.00966,54.04134],[62.03913,53.94768],[61.65318,54.02445],[61.56941,53.95703],[61.47603,54.08048],[61.3706,54.08464],[61.26863,53.92797],[60.99796,53.93699],[61.14283,53.90063],[61.22574,53.80268],[60.90626,53.62937],[61.55706,53.57144],[61.57185,53.50112],[61.37957,53.45887],[61.29082,53.50992],[61.14291,53.41481],[61.19024,53.30536],[62.14574,53.09626],[62.12799,52.99133],[62.0422,52.96105],[61.23462,53.03227],[61.05842,52.92217],[60.71989,52.75923],[60.71693,52.66245],[60.84118,52.63912],[60.84709,52.52228],[60.98021,52.50068],[61.05417,52.35096],[60.78201,52.22067],[60.72581,52.15538],[60.48915,52.15175],[60.19925,51.99173],[59.99809,51.98263],[60.09867,51.87135],[60.50986,51.7964],[60.36787,51.66815],[60.5424,51.61675],[60.92401,51.61124],[60.95655,51.48615],[61.50677,51.40687],[61.55114,51.32746],[61.6813,51.25716],[61.56889,51.23679],[61.4431,50.80679],[60.81833,50.6629],[60.31914,50.67705],[60.17262,50.83312],[60.01288,50.8163],[59.81172,50.54451],[59.51886,50.49937],[59.48928,50.64216],[58.87974,50.70852],[58.3208,51.15151],[57.75578,51.13852],[57.74986,50.93017],[57.44221,50.88354],[57.17302,51.11253],[56.17906,50.93204],[56.11398,50.7471],[55.67774,50.54508],[54.72067,51.03261],[54.56685,51.01958],[54.71476,50.61214],[54.55797,50.52006],[54.41894,50.61214],[54.46331,50.85554],[54.12248,51.11542],[53.69299,51.23466],[53.46165,51.49445],[52.54329,51.48444],[52.36119,51.74161],[51.8246,51.67916],[51.77431,51.49536],[51.301,51.48799],[51.26254,51.68466],[50.59695,51.61859],[50.26859,51.28677],[49.97277,51.2405],[49.76866,51.11067],[49.39001,51.09396],[49.41959,50.85927],[49.12673,50.78639],[48.86936,50.61589],[48.57946,50.63278],[48.90782,50.02281],[48.68352,49.89546],[48.42564,49.82283],[48.24519,49.86099],[48.10044,50.09242],[47.58551,50.47867],[47.30448,50.30894],[47.34589,50.09308],[47.18319,49.93721],[46.9078,49.86707],[46.78398,49.34026],[47.04658,49.19834],[47.00857,49.04921],[46.78392,48.95352],[46.49011,48.43019],[47.11516,48.27188],[47.12107,47.83687],[47.38731,47.68176],[47.41689,47.83687],[47.64973,47.76559],[48.15348,47.74545],[48.45173,47.40818],[48.52326,47.4102],[49.01136,46.72716],[48.51142,46.69268],[48.54988,46.56267],[49.16518,46.38542],[49.32259,46.26944],[49.88945,46.04554],[49.2134,44.84989],[52.26048,41.69249],[52.47884,41.78034],[52.97575,42.1308],[54.20635,42.38477],[54.95182,41.92424],[55.45471,41.25609],[56.00314,41.32584],[55.97584,44.99322],[55.97584,44.99328],[55.97584,44.99338],[55.97584,44.99343],[55.97584,44.99348],[55.97584,44.99353],[55.97584,44.99359],[55.97584,44.99369],[55.97584,44.99374],[55.97584,44.99384],[55.97584,44.9939],[55.97584,44.994],[55.97584,44.99405],[55.97584,44.99415],[55.97584,44.99421],[55.97584,44.99426],[55.97584,44.99431],[55.97584,44.99436],[55.97584,44.99441],[55.97594,44.99446],[55.97605,44.99452],[55.97605,44.99457],[55.97605,44.99462],[55.97605,44.99467],[55.97605,44.99477],[55.97615,44.99477],[55.97615,44.99483],[55.97615,44.99493],[55.97615,44.99498],[55.97615,44.99503],[55.97615,44.99508],[55.97625,44.99514],[55.97636,44.99519],[55.97636,44.99524],[55.97646,44.99529],[55.97646,44.99534],[55.97656,44.99539],[55.97667,44.99545],[55.97677,44.9955],[55.97677,44.99555],[55.97677,44.9956],[55.97687,44.9956],[55.97698,44.99565],[55.97698,44.9957],[55.97708,44.99576],[55.97718,44.99581],[55.97729,44.99586],[55.97739,44.99586],[55.97739,44.99591],[55.97749,44.99591],[55.9776,44.99591],[55.9777,44.99596],[55.9777,44.99601],[55.9778,44.99607],[55.97791,44.99607],[55.97801,44.99607],[55.97801,44.99612],[55.97811,44.99617],[55.97822,44.99617],[55.97832,44.99622],[55.97842,44.99622],[58.59711,45.58671],[61.01475,44.41383],[62.01711,43.51008],[63.34656,43.64003],[64.53885,43.56941],[64.96464,43.74748],[65.18666,43.48835],[65.53277,43.31856],[65.85194,42.85481],[66.09482,42.93426],[66.00546,41.94455],[66.53302,41.87388],[66.69129,41.1311],[67.9644,41.14611],[67.98511,41.02794],[68.08273,41.08148],[68.1271,41.0324],[67.96736,40.83798],[68.49983,40.56437],[68.63,40.59358],[68.58444,40.91447],[68.49983,40.99669],[68.62221,41.03019],[68.65662,40.93861],[68.73945,40.96989],[68.7217,41.05025],[69.01308,41.22804],[69.05006,41.36183],[69.15137,41.43078],[69.17701,41.43769],[69.18528,41.45175],[69.20439,41.45391],[69.22671,41.46298],[69.23332,41.45847],[69.25059,41.46693],[69.29778,41.43673],[69.35554,41.47211],[69.37468,41.46555],[69.45081,41.46246],[69.39485,41.51518],[69.45751,41.56863],[69.49545,41.545],[70.94483,42.26238],[70.85973,42.30188],[70.97717,42.50147],[71.15232,42.60486],[71.17807,42.67381],[71.22785,42.69248],[71.2724,42.77853],[71.53272,42.8014],[71.62405,42.76613],[71.88792,42.83578],[73.44393,42.43098],[73.50992,42.82356],[73.55634,43.03071],[74.22489,43.24657],[74.57491,43.13702],[74.64615,43.05881],[74.70331,43.02519],[74.75,42.99029],[74.88756,42.98612],[75.22619,42.85528],[75.29966,42.86183],[75.72174,42.79672],[75.82823,42.94848],[78.48469,42.89649],[78.91502,42.76839],[79.19763,42.804],[79.52921,42.44778],[79.97364,42.42816],[80.17807,42.21166],[80.26841,42.23797],[80.16892,42.61137],[80.26886,42.8366],[80.38169,42.83142],[80.58999,42.9011],[80.3735,43.01557],[80.62913,43.141],[80.78817,43.14235],[80.77771,43.30065],[80.69718,43.32589],[80.75156,43.44948],[80.40031,44.10986],[80.40229,44.23319],[80.38384,44.63073],[79.8987,44.89957],[80.11169,45.03352],[81.73278,45.3504],[82.51374,45.1755],[82.58474,45.40027],[82.21792,45.56619],[83.04622,47.19053],[83.92184,46.98912],[84.73077,47.01394],[84.93995,46.87399],[85.22443,47.04816],[85.54294,47.06171],[85.69696,47.2898],[85.61067,47.49753],[85.5169,48.05493],[85.73581,48.3939],[86.38069,48.46064],[86.75343,48.70331],[86.73568,48.99918],[86.87238,49.12432],[87.28386,49.11626],[87.31465,49.23603],[87.03071,49.25142],[86.82606,49.51796],[86.61307,49.60239],[86.79056,49.74787],[86.63674,49.80136],[86.18709,49.50259],[85.24047,49.60239],[84.99198,50.06793],[84.29385,50.27257],[83.8442,50.87375],[83.14607,51.00796],[82.55443,50.75412],[81.94999,50.79307],[81.46581,50.77658],[81.41248,50.97524],[81.06091,50.94833],[81.16999,51.15662],[80.80318,51.28262],[80.44819,51.20855],[80.4127,50.95581],[80.08138,50.77658],[79.11255,52.01171],[77.90383,53.29807],[76.54243,53.99329],[76.44076,54.16017],[76.82266,54.1798],[76.91052,54.4677],[75.3668,54.07439],[75.43398,53.98652],[75.07405,53.80831],[73.39218,53.44623],[73.25412,53.61532],[73.68921,53.86522],[73.74778,54.07194],[73.37963,53.96132],[72.71026,54.1161],[72.43415,53.92685],[72.17477,54.36303],[71.96141,54.17736],[71.10379,54.13326],[71.08706,54.33376],[71.24185,54.64965],[71.08288,54.71253],[70.96009,55.10558],[70.76493,55.3027],[70.19179,55.1476],[69.74917,55.35545],[69.34224,55.36344],[68.90865,55.38148]]]]}},{type:"Feature",properties:{iso1A2:"LA",iso1A3:"LAO",iso1N3:"418",wikidata:"Q819",nameEn:"Laos",groups:["035","142","UN"],callingCodes:["856"]},geometry:{type:"MultiPolygon",coordinates:[[[[102.1245,22.43372],[102.03633,22.46164],[101.98487,22.42766],[101.91344,22.44417],[101.90714,22.38688],[101.86828,22.38397],[101.7685,22.50337],[101.68973,22.46843],[101.61306,22.27515],[101.56789,22.28876],[101.53638,22.24794],[101.60675,22.13513],[101.57525,22.13026],[101.62566,21.96574],[101.7791,21.83019],[101.74555,21.72852],[101.83257,21.61562],[101.80001,21.57461],[101.7475,21.5873],[101.7727,21.51794],[101.74224,21.48276],[101.74014,21.30967],[101.84412,21.25291],[101.83887,21.20983],[101.76745,21.21571],[101.79266,21.19025],[101.7622,21.14813],[101.70548,21.14911],[101.66977,21.20004],[101.60886,21.17947],[101.59491,21.18621],[101.6068,21.23329],[101.54563,21.25668],[101.29326,21.17254],[101.2229,21.23271],[101.26912,21.36482],[101.19349,21.41959],[101.2124,21.56422],[101.15156,21.56129],[101.16198,21.52808],[101.00234,21.39612],[100.80173,21.2934],[100.72716,21.31786],[100.63578,21.05639],[100.55281,21.02796],[100.50974,20.88574],[100.64628,20.88279],[100.60112,20.8347],[100.51079,20.82194],[100.36375,20.82783],[100.1957,20.68247],[100.08404,20.36626],[100.09999,20.31614],[100.09337,20.26293],[100.11785,20.24787],[100.1712,20.24324],[100.16668,20.2986],[100.22076,20.31598],[100.25769,20.3992],[100.33383,20.4028],[100.37439,20.35156],[100.41473,20.25625],[100.44992,20.23644],[100.4537,20.19971],[100.47567,20.19133],[100.51052,20.14928],[100.55218,20.17741],[100.58808,20.15791],[100.5094,19.87904],[100.398,19.75047],[100.49604,19.53504],[100.58219,19.49164],[100.64606,19.55884],[100.77231,19.48324],[100.90302,19.61901],[101.08928,19.59748],[101.26545,19.59242],[101.26991,19.48324],[101.21347,19.46223],[101.20604,19.35296],[101.24911,19.33334],[101.261,19.12717],[101.35606,19.04716],[101.25803,18.89545],[101.22832,18.73377],[101.27585,18.68875],[101.06047,18.43247],[101.18227,18.34367],[101.15108,18.25624],[101.19118,18.2125],[101.1793,18.0544],[101.02185,17.87637],[100.96541,17.57926],[101.15108,17.47586],[101.44667,17.7392],[101.72294,17.92867],[101.78087,18.07559],[101.88485,18.02474],[102.11359,18.21532],[102.45523,17.97106],[102.59234,17.96127],[102.60971,17.95411],[102.61432,17.92273],[102.5896,17.84889],[102.59485,17.83537],[102.68194,17.80151],[102.69946,17.81686],[102.67543,17.84529],[102.68538,17.86653],[102.75954,17.89561],[102.79044,17.93612],[102.81988,17.94233],[102.86323,17.97531],[102.95812,18.0054],[102.9912,17.9949],[103.01998,17.97095],[103.0566,18.00144],[103.07823,18.03833],[103.07343,18.12351],[103.1493,18.17799],[103.14994,18.23172],[103.17093,18.2618],[103.29757,18.30475],[103.23818,18.34875],[103.24779,18.37807],[103.30977,18.4341],[103.41044,18.4486],[103.47773,18.42841],[103.60957,18.40528],[103.699,18.34125],[103.82449,18.33979],[103.85642,18.28666],[103.93916,18.33914],[103.97725,18.33631],[104.06533,18.21656],[104.10927,18.10826],[104.21776,17.99335],[104.2757,17.86139],[104.35432,17.82871],[104.45404,17.66788],[104.69867,17.53038],[104.80061,17.39367],[104.80716,17.19025],[104.73712,17.01404],[104.7373,16.91125],[104.76442,16.84752],[104.7397,16.81005],[104.76099,16.69302],[104.73349,16.565],[104.88057,16.37311],[105.00262,16.25627],[105.06204,16.09792],[105.42001,16.00657],[105.38508,15.987],[105.34115,15.92737],[105.37959,15.84074],[105.42285,15.76971],[105.46573,15.74742],[105.61756,15.68792],[105.60446,15.53301],[105.58191,15.41031],[105.47635,15.3796],[105.4692,15.33709],[105.50662,15.32054],[105.58043,15.32724],[105.46661,15.13132],[105.61162,15.00037],[105.5121,14.80802],[105.53864,14.55731],[105.43783,14.43865],[105.20894,14.34967],[105.2759,14.17496],[105.36775,14.09948],[105.44869,14.10703],[105.5561,14.15684],[105.78338,14.08438],[105.78182,14.02247],[105.90791,13.92881],[106.10405,13.9137],[106.10094,13.98471],[106.16632,14.01794],[106.18656,14.06324],[106.11962,14.11307],[106.10872,14.18401],[106.04801,14.20363],[106.02311,14.30623],[105.99509,14.32734],[106.00131,14.36957],[106.21302,14.36203],[106.25194,14.48415],[106.32355,14.44043],[106.40916,14.45249],[106.43874,14.52032],[106.47766,14.50977],[106.45898,14.55045],[106.50723,14.58963],[106.54148,14.59565],[106.57106,14.50525],[106.59908,14.50977],[106.63333,14.44194],[106.73762,14.42687],[106.80767,14.31226],[106.8497,14.29416],[106.90574,14.33639],[106.9649,14.3198],[106.98825,14.36806],[107.04585,14.41782],[107.03962,14.45099],[107.09722,14.3937],[107.17038,14.41782],[107.21241,14.48716],[107.256,14.48716],[107.26534,14.54292],[107.29803,14.58963],[107.3276,14.58812],[107.37897,14.54443],[107.44435,14.52785],[107.47238,14.61523],[107.54361,14.69092],[107.51579,14.79282],[107.59285,14.87795],[107.48277,14.93751],[107.46516,15.00982],[107.61486,15.0566],[107.61926,15.13949],[107.58844,15.20111],[107.62587,15.2266],[107.60605,15.37524],[107.62367,15.42193],[107.53341,15.40496],[107.50699,15.48771],[107.3815,15.49832],[107.34408,15.62345],[107.27583,15.62769],[107.27143,15.71459],[107.21859,15.74638],[107.21419,15.83747],[107.34188,15.89464],[107.39471,15.88829],[107.46296,16.01106],[107.44975,16.08511],[107.33968,16.05549],[107.25822,16.13587],[107.14595,16.17816],[107.15035,16.26271],[107.09091,16.3092],[107.02597,16.31132],[106.97385,16.30204],[106.96638,16.34938],[106.88067,16.43594],[106.88727,16.52671],[106.84104,16.55415],[106.74418,16.41904],[106.65832,16.47816],[106.66052,16.56892],[106.61477,16.60713],[106.58267,16.6012],[106.59013,16.62259],[106.55485,16.68704],[106.55265,16.86831],[106.52183,16.87884],[106.51963,16.92097],[106.54824,16.92729],[106.55045,17.0031],[106.50862,16.9673],[106.43597,17.01362],[106.31929,17.20509],[106.29287,17.3018],[106.24444,17.24714],[106.18991,17.28227],[106.09019,17.36399],[105.85744,17.63221],[105.76612,17.67147],[105.60381,17.89356],[105.64784,17.96687],[105.46292,18.22008],[105.38366,18.15315],[105.15942,18.38691],[105.10408,18.43533],[105.1327,18.58355],[105.19654,18.64196],[105.12829,18.70453],[104.64617,18.85668],[104.5361,18.97747],[103.87125,19.31854],[104.06058,19.43484],[104.10832,19.51575],[104.05617,19.61743],[104.06498,19.66926],[104.23229,19.70242],[104.41281,19.70035],[104.53169,19.61743],[104.64837,19.62365],[104.68359,19.72729],[104.8355,19.80395],[104.8465,19.91783],[104.9874,20.09573],[104.91695,20.15567],[104.86852,20.14121],[104.61315,20.24452],[104.62195,20.36633],[104.72102,20.40554],[104.66158,20.47774],[104.47886,20.37459],[104.40621,20.3849],[104.38199,20.47155],[104.63957,20.6653],[104.27412,20.91433],[104.11121,20.96779],[103.98024,20.91531],[103.82282,20.8732],[103.73478,20.6669],[103.68633,20.66324],[103.45737,20.82382],[103.38032,20.79501],[103.21497,20.89832],[103.12055,20.89994],[103.03469,21.05821],[102.97745,21.05821],[102.89825,21.24707],[102.80794,21.25736],[102.88939,21.3107],[102.94223,21.46034],[102.86297,21.4255],[102.98846,21.58936],[102.97965,21.74076],[102.86077,21.71213],[102.85637,21.84501],[102.81894,21.83888],[102.82115,21.73667],[102.74189,21.66713],[102.67145,21.65894],[102.62301,21.91447],[102.49092,21.99002],[102.51734,22.02676],[102.18712,22.30403],[102.14099,22.40092],[102.1245,22.43372]]]]}},{type:"Feature",properties:{iso1A2:"LB",iso1A3:"LBN",iso1N3:"422",wikidata:"Q822",nameEn:"Lebanon",aliases:["RL"],groups:["145","142","UN"],callingCodes:["961"]},geometry:{type:"MultiPolygon",coordinates:[[[[35.94816,33.47886],[35.94465,33.52774],[36.05723,33.57904],[35.9341,33.6596],[36.06778,33.82927],[36.14517,33.85118],[36.3967,33.83365],[36.38263,33.86579],[36.28589,33.91981],[36.41078,34.05253],[36.50576,34.05982],[36.5128,34.09916],[36.62537,34.20251],[36.59195,34.2316],[36.58667,34.27667],[36.60778,34.31009],[36.56556,34.31881],[36.53039,34.3798],[36.55853,34.41609],[36.46179,34.46541],[36.4442,34.50165],[36.34745,34.5002],[36.3369,34.52629],[36.39846,34.55672],[36.41429,34.61175],[36.45299,34.59438],[36.46003,34.6378],[36.42941,34.62505],[36.35384,34.65447],[36.35135,34.68516],[36.32399,34.69334],[36.29165,34.62991],[35.98718,34.64977],[35.97386,34.63322],[35.48515,34.70851],[34.78515,33.20368],[35.10645,33.09318],[35.1924,33.08743],[35.31429,33.10515],[35.35223,33.05617],[35.43059,33.06659],[35.448,33.09264],[35.50272,33.09056],[35.50335,33.114],[35.52573,33.11921],[35.54228,33.19865],[35.5362,33.23196],[35.54808,33.236],[35.54544,33.25513],[35.55555,33.25844],[35.56523,33.28969],[35.58326,33.28381],[35.58502,33.26653],[35.62283,33.24226],[35.62019,33.27278],[35.77477,33.33609],[35.81324,33.36354],[35.82577,33.40479],[35.88668,33.43183],[35.94816,33.47886]]]]}},{type:"Feature",properties:{iso1A2:"LC",iso1A3:"LCA",iso1N3:"662",wikidata:"Q760",nameEn:"St. Lucia",aliases:["WL"],groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 758"]},geometry:{type:"MultiPolygon",coordinates:[[[[-59.95997,14.20285],[-61.69315,14.26451],[-59.94058,12.34011],[-59.95997,14.20285]]]]}},{type:"Feature",properties:{iso1A2:"LI",iso1A3:"LIE",iso1N3:"438",wikidata:"Q347",nameEn:"Liechtenstein",aliases:["FL"],groups:["155","150","UN"],callingCodes:["423"]},geometry:{type:"MultiPolygon",coordinates:[[[[9.60717,47.06091],[9.61216,47.07732],[9.63395,47.08443],[9.62623,47.14685],[9.56539,47.17124],[9.58264,47.20673],[9.56981,47.21926],[9.55176,47.22585],[9.56766,47.24281],[9.53116,47.27029],[9.52406,47.24959],[9.50318,47.22153],[9.4891,47.19346],[9.48774,47.17402],[9.51044,47.13727],[9.52089,47.10019],[9.51362,47.08505],[9.47139,47.06402],[9.47548,47.05257],[9.54041,47.06495],[9.55721,47.04762],[9.60717,47.06091]]]]}},{type:"Feature",properties:{iso1A2:"LK",iso1A3:"LKA",iso1N3:"144",wikidata:"Q854",nameEn:"Sri Lanka",groups:["034","142","UN"],driveSide:"left",callingCodes:["94"]},geometry:{type:"MultiPolygon",coordinates:[[[[76.59015,5.591],[85.15017,5.21497],[80.48418,10.20786],[79.42124,9.80115],[79.50447,8.91876],[76.59015,5.591]]]]}},{type:"Feature",properties:{iso1A2:"LR",iso1A3:"LBR",iso1N3:"430",wikidata:"Q1014",nameEn:"Liberia",groups:["011","202","002","UN"],callingCodes:["231"]},geometry:{type:"MultiPolygon",coordinates:[[[[-8.47114,7.55676],[-8.55874,7.62525],[-8.55874,7.70167],[-8.67814,7.69428],[-8.72789,7.51429],[-8.8448,7.35149],[-8.85724,7.26019],[-8.93435,7.2824],[-9.09107,7.1985],[-9.18311,7.30461],[-9.20798,7.38109],[-9.305,7.42056],[-9.41943,7.41809],[-9.48161,7.37122],[-9.37465,7.62032],[-9.35724,7.74111],[-9.44928,7.9284],[-9.41445,8.02448],[-9.50898,8.18455],[-9.47415,8.35195],[-9.77763,8.54633],[-10.05873,8.42578],[-10.05375,8.50697],[-10.14579,8.52665],[-10.203,8.47991],[-10.27575,8.48711],[-10.30084,8.30008],[-10.31635,8.28554],[-10.29839,8.21283],[-10.35227,8.15223],[-10.45023,8.15627],[-10.51554,8.1393],[-10.57523,8.04829],[-10.60492,8.04072],[-10.60422,7.7739],[-11.29417,7.21576],[-11.4027,6.97746],[-11.50429,6.92704],[-12.15048,6.15992],[-7.52774,3.7105],[-7.53259,4.35145],[-7.59349,4.8909],[-7.53876,4.94294],[-7.55369,5.08667],[-7.48901,5.14118],[-7.46165,5.26256],[-7.36463,5.32944],[-7.43428,5.42355],[-7.37209,5.61173],[-7.43926,5.74787],[-7.43677,5.84687],[-7.46165,5.84934],[-7.48155,5.80974],[-7.67309,5.94337],[-7.70294,5.90625],[-7.78254,5.99037],[-7.79747,6.07696],[-7.8497,6.08932],[-7.83478,6.20309],[-7.90692,6.27728],[-8.00642,6.31684],[-8.17557,6.28222],[-8.3298,6.36381],[-8.38453,6.35887],[-8.45666,6.49977],[-8.48652,6.43797],[-8.59456,6.50612],[-8.31736,6.82837],[-8.29249,7.1691],[-8.37458,7.25794],[-8.41935,7.51203],[-8.47114,7.55676]]]]}},{type:"Feature",properties:{iso1A2:"LS",iso1A3:"LSO",iso1N3:"426",wikidata:"Q1013",nameEn:"Lesotho",groups:["018","202","002","UN"],driveSide:"left",callingCodes:["266"]},geometry:{type:"MultiPolygon",coordinates:[[[[29.33204,-29.45598],[29.44883,-29.3772],[29.40524,-29.21246],[28.68043,-28.58744],[28.65091,-28.57025],[28.40612,-28.6215],[28.30518,-28.69531],[28.2348,-28.69471],[28.1317,-28.7293],[28.02503,-28.85991],[27.98675,-28.8787],[27.9392,-28.84864],[27.88933,-28.88156],[27.8907,-28.91612],[27.75458,-28.89839],[27.55974,-29.18954],[27.5158,-29.2261],[27.54258,-29.25575],[27.48679,-29.29349],[27.45125,-29.29708],[27.47254,-29.31968],[27.4358,-29.33465],[27.33464,-29.48161],[27.01016,-29.65439],[27.09489,-29.72796],[27.22719,-30.00718],[27.29603,-30.05473],[27.32555,-30.14785],[27.40778,-30.14577],[27.37293,-30.19401],[27.36649,-30.27246],[27.38108,-30.33456],[27.45452,-30.32239],[27.56901,-30.42504],[27.56781,-30.44562],[27.62137,-30.50509],[27.6521,-30.51707],[27.67819,-30.53437],[27.69467,-30.55862],[27.74814,-30.60635],[28.12073,-30.68072],[28.2319,-30.28476],[28.399,-30.1592],[28.68627,-30.12885],[28.80222,-30.10579],[28.9338,-30.05072],[29.16548,-29.91706],[29.12553,-29.76266],[29.28545,-29.58456],[29.33204,-29.45598]]]]}},{type:"Feature",properties:{iso1A2:"LT",iso1A3:"LTU",iso1N3:"440",wikidata:"Q37",nameEn:"Lithuania",groups:["EU","154","150","UN"],callingCodes:["370"]},geometry:{type:"MultiPolygon",coordinates:[[[[24.89005,56.46666],[24.83686,56.41565],[24.70022,56.40483],[24.57353,56.31525],[24.58143,56.29125],[24.42746,56.26522],[24.32334,56.30226],[24.13139,56.24881],[24.02657,56.3231],[23.75726,56.37282],[23.49803,56.34307],[23.40486,56.37689],[23.31606,56.3827],[23.17312,56.36795],[23.09531,56.30511],[22.96988,56.41213],[22.83048,56.367],[22.69354,56.36284],[22.56441,56.39305],[22.3361,56.4016],[22.09728,56.42851],[22.00548,56.41508],[21.74558,56.33181],[21.57888,56.31406],[21.49736,56.29106],[21.24644,56.16917],[21.15016,56.07818],[20.68447,56.04073],[20.60454,55.40986],[20.95181,55.27994],[21.26425,55.24456],[21.35465,55.28427],[21.38446,55.29348],[21.46766,55.21115],[21.51095,55.18507],[21.55605,55.20311],[21.64954,55.1791],[21.85521,55.09493],[21.96505,55.07353],[21.99543,55.08691],[22.03984,55.07888],[22.02582,55.05078],[22.06087,55.02935],[22.11697,55.02131],[22.14267,55.05345],[22.31562,55.0655],[22.47688,55.04408],[22.58907,55.07085],[22.60075,55.01863],[22.65451,54.97037],[22.68723,54.9811],[22.76422,54.92521],[22.85083,54.88711],[22.87317,54.79492],[22.73631,54.72952],[22.73397,54.66604],[22.75467,54.6483],[22.74225,54.64339],[22.7522,54.63525],[22.68021,54.58486],[22.71293,54.56454],[22.67788,54.532],[22.70208,54.45312],[22.7253,54.41732],[22.79705,54.36264],[22.83756,54.40827],[23.00584,54.38514],[22.99649,54.35927],[23.05726,54.34565],[23.04323,54.31567],[23.104,54.29794],[23.13905,54.31567],[23.15526,54.31076],[23.15938,54.29894],[23.24656,54.25701],[23.3494,54.25155],[23.39525,54.21672],[23.42418,54.17911],[23.45223,54.17775],[23.49196,54.14764],[23.52702,54.04622],[23.48261,53.98855],[23.51284,53.95052],[23.61677,53.92691],[23.71726,53.93379],[23.80543,53.89558],[23.81309,53.94205],[23.95098,53.9613],[23.98837,53.92554],[24.19638,53.96405],[24.34128,53.90076],[24.44411,53.90076],[24.62275,54.00217],[24.69652,54.01901],[24.69185,53.96543],[24.74279,53.96663],[24.85311,54.02862],[24.77131,54.11091],[24.96894,54.17589],[24.991,54.14241],[25.0728,54.13419],[25.19199,54.219],[25.22705,54.26271],[25.35559,54.26544],[25.509,54.30267],[25.56823,54.25212],[25.51452,54.17799],[25.54724,54.14925],[25.64875,54.1259],[25.71084,54.16704],[25.78563,54.15747],[25.78553,54.23327],[25.68513,54.31727],[25.55425,54.31591],[25.5376,54.33158],[25.63371,54.42075],[25.62203,54.4656],[25.64813,54.48704],[25.68045,54.5321],[25.75977,54.57252],[25.74122,54.80108],[25.89462,54.93438],[25.99129,54.95705],[26.05907,54.94631],[26.13386,54.98924],[26.20397,54.99729],[26.26941,55.08032],[26.23202,55.10439],[26.30628,55.12536],[26.35121,55.1525],[26.46249,55.12814],[26.51481,55.16051],[26.54753,55.14181],[26.69243,55.16718],[26.68075,55.19787],[26.72983,55.21788],[26.73017,55.24226],[26.835,55.28182],[26.83266,55.30444],[26.80929,55.31642],[26.6714,55.33902],[26.5709,55.32572],[26.44937,55.34832],[26.5522,55.40277],[26.55094,55.5093],[26.63167,55.57887],[26.63231,55.67968],[26.58248,55.6754],[26.46661,55.70375],[26.39561,55.71156],[26.18509,55.86813],[26.03815,55.95884],[25.90047,56.0013],[25.85893,56.00188],[25.81773,56.05444],[25.69246,56.08892],[25.68588,56.14725],[25.53621,56.16663],[25.39751,56.15707],[25.23099,56.19147],[25.09325,56.1878],[25.05762,56.26742],[24.89005,56.46666]]]]}},{type:"Feature",properties:{iso1A2:"LU",iso1A3:"LUX",iso1N3:"442",wikidata:"Q32",nameEn:"Luxembourg",groups:["EU","155","150","UN"],callingCodes:["352"]},geometry:{type:"MultiPolygon",coordinates:[[[[6.1379,50.12964],[6.1137,50.13668],[6.12028,50.16374],[6.08577,50.17246],[6.06406,50.15344],[6.03093,50.16362],[6.02488,50.18283],[5.96453,50.17259],[5.95929,50.13295],[5.89488,50.11476],[5.8857,50.07824],[5.85474,50.06342],[5.86904,50.04614],[5.8551,50.02683],[5.81866,50.01286],[5.82331,49.99662],[5.83968,49.9892],[5.83467,49.97823],[5.81163,49.97142],[5.80833,49.96451],[5.77291,49.96056],[5.77314,49.93646],[5.73621,49.89796],[5.78415,49.87922],[5.75269,49.8711],[5.75861,49.85631],[5.74567,49.85368],[5.75884,49.84811],[5.74953,49.84709],[5.74975,49.83933],[5.74076,49.83823],[5.7404,49.83452],[5.74844,49.82435],[5.74364,49.82058],[5.74953,49.81428],[5.75409,49.79239],[5.78871,49.7962],[5.82245,49.75048],[5.83149,49.74729],[5.82562,49.72395],[5.84193,49.72161],[5.86503,49.72739],[5.88677,49.70951],[5.86527,49.69291],[5.86175,49.67862],[5.9069,49.66377],[5.90164,49.6511],[5.90599,49.63853],[5.88552,49.63507],[5.88393,49.62802],[5.87609,49.62047],[5.8762,49.60898],[5.84826,49.5969],[5.84971,49.58674],[5.86986,49.58756],[5.87256,49.57539],[5.8424,49.56082],[5.84692,49.55663],[5.84143,49.5533],[5.81838,49.54777],[5.80871,49.5425],[5.81664,49.53775],[5.83648,49.5425],[5.84466,49.53027],[5.83467,49.52717],[5.83389,49.52152],[5.86571,49.50015],[5.94128,49.50034],[5.94224,49.49608],[5.96876,49.49053],[5.97693,49.45513],[6.02648,49.45451],[6.02743,49.44845],[6.04176,49.44801],[6.05553,49.46663],[6.07887,49.46399],[6.08373,49.45594],[6.10072,49.45268],[6.09845,49.46351],[6.10325,49.4707],[6.12346,49.4735],[6.12814,49.49365],[6.14321,49.48796],[6.16115,49.49297],[6.15366,49.50226],[6.17386,49.50934],[6.19543,49.50536],[6.2409,49.51408],[6.25029,49.50609],[6.27875,49.503],[6.28818,49.48465],[6.3687,49.4593],[6.36778,49.46937],[6.36907,49.48931],[6.36788,49.50377],[6.35666,49.52931],[6.38072,49.55171],[6.38228,49.55855],[6.35825,49.57053],[6.36676,49.57813],[6.38024,49.57593],[6.38342,49.5799],[6.37464,49.58886],[6.385,49.59946],[6.39822,49.60081],[6.41861,49.61723],[6.4413,49.65722],[6.43768,49.66021],[6.42726,49.66078],[6.42937,49.66857],[6.44654,49.67799],[6.46048,49.69092],[6.48014,49.69767],[6.49785,49.71118],[6.50647,49.71353],[6.5042,49.71808],[6.49694,49.72205],[6.49535,49.72645],[6.50261,49.72718],[6.51397,49.72058],[6.51805,49.72425],[6.50193,49.73291],[6.50174,49.75292],[6.51646,49.75961],[6.51828,49.76855],[6.51056,49.77515],[6.51669,49.78336],[6.50534,49.78952],[6.52169,49.79787],[6.53122,49.80666],[6.52121,49.81338],[6.51215,49.80124],[6.50647,49.80916],[6.48718,49.81267],[6.47111,49.82263],[6.45425,49.81164],[6.44131,49.81443],[6.42905,49.81091],[6.42521,49.81591],[6.40022,49.82029],[6.36576,49.85032],[6.34267,49.84974],[6.33585,49.83785],[6.32098,49.83728],[6.32303,49.85133],[6.30963,49.87021],[6.29692,49.86685],[6.28874,49.87592],[6.26146,49.88203],[6.23496,49.89972],[6.22926,49.92096],[6.21882,49.92403],[6.22608,49.929],[6.22094,49.94955],[6.19856,49.95053],[6.19089,49.96991],[6.18045,49.96611],[6.18554,49.95622],[6.17872,49.9537],[6.16466,49.97086],[6.1701,49.98518],[6.14147,49.99563],[6.14948,50.00908],[6.13806,50.01056],[6.1295,50.01849],[6.13273,50.02019],[6.13794,50.01466],[6.14666,50.02207],[6.13044,50.02929],[6.13458,50.04141],[6.11274,50.05916],[6.12055,50.09171],[6.1379,50.12964]]]]}},{type:"Feature",properties:{iso1A2:"LV",iso1A3:"LVA",iso1N3:"428",wikidata:"Q211",nameEn:"Latvia",groups:["EU","154","150","UN"],callingCodes:["371"]},geometry:{type:"MultiPolygon",coordinates:[[[[27.34698,57.52242],[26.90364,57.62823],[26.54675,57.51813],[26.46527,57.56885],[26.29253,57.59244],[26.1866,57.6849],[26.2029,57.7206],[26.08098,57.76619],[26.0543,57.76105],[26.03332,57.7718],[26.02415,57.76865],[26.02069,57.77169],[26.0266,57.77441],[26.027,57.78158],[26.02456,57.78342],[26.0324,57.79037],[26.05949,57.84744],[25.73499,57.90193],[25.29581,58.08288],[25.28237,57.98539],[25.19484,58.0831],[24.3579,57.87471],[24.26221,57.91787],[23.20055,57.56697],[22.80496,57.87798],[19.84909,57.57876],[19.64795,57.06466],[20.68447,56.04073],[21.15016,56.07818],[21.24644,56.16917],[21.49736,56.29106],[21.57888,56.31406],[21.74558,56.33181],[22.00548,56.41508],[22.09728,56.42851],[22.3361,56.4016],[22.56441,56.39305],[22.69354,56.36284],[22.83048,56.367],[22.96988,56.41213],[23.09531,56.30511],[23.17312,56.36795],[23.31606,56.3827],[23.40486,56.37689],[23.49803,56.34307],[23.75726,56.37282],[24.02657,56.3231],[24.13139,56.24881],[24.32334,56.30226],[24.42746,56.26522],[24.58143,56.29125],[24.57353,56.31525],[24.70022,56.40483],[24.83686,56.41565],[24.89005,56.46666],[25.05762,56.26742],[25.09325,56.1878],[25.23099,56.19147],[25.39751,56.15707],[25.53621,56.16663],[25.68588,56.14725],[25.69246,56.08892],[25.81773,56.05444],[25.85893,56.00188],[25.90047,56.0013],[26.03815,55.95884],[26.18509,55.86813],[26.39561,55.71156],[26.46661,55.70375],[26.58248,55.6754],[26.63231,55.67968],[26.64888,55.70515],[26.71802,55.70645],[26.76872,55.67658],[26.87448,55.7172],[26.97153,55.8102],[27.1559,55.85032],[27.27804,55.78299],[27.3541,55.8089],[27.61683,55.78558],[27.63065,55.89687],[27.97865,56.11849],[28.15217,56.16964],[28.23716,56.27588],[28.16599,56.37806],[28.19057,56.44637],[28.10069,56.524],[28.13526,56.57989],[28.04768,56.59004],[27.86101,56.88204],[27.66511,56.83921],[27.86101,57.29402],[27.52453,57.42826],[27.56832,57.53728],[27.34698,57.52242]]]]}},{type:"Feature",properties:{iso1A2:"LY",iso1A3:"LBY",iso1N3:"434",wikidata:"Q1016",nameEn:"Libya",groups:["015","002","UN"],callingCodes:["218"]},geometry:{type:"MultiPolygon",coordinates:[[[[26.92891,33.39516],[11.58941,33.36891],[11.55852,33.1409],[11.51549,33.09826],[11.46037,32.6307],[11.57828,32.48013],[11.53898,32.4138],[11.04234,32.2145],[10.7315,31.97235],[10.62788,31.96629],[10.48497,31.72956],[10.31364,31.72648],[10.12239,31.42098],[10.29516,30.90337],[9.88152,30.34074],[9.76848,30.34366],[9.55544,30.23971],[9.3876,30.16738],[9.78136,29.40961],[9.89569,26.57696],[9.51696,26.39148],[9.38834,26.19288],[10.03146,25.35635],[10.02432,24.98124],[10.33159,24.5465],[10.85323,24.5595],[11.41061,24.21456],[11.62498,24.26669],[11.96886,23.51735],[13.5631,23.16574],[14.22918,22.61719],[14.99751,23.00539],[15.99566,23.49639],[23.99539,19.49944],[23.99715,20.00038],[24.99794,19.99661],[24.99885,21.99535],[24.99968,29.24574],[24.71117,30.17441],[25.01077,30.73861],[24.8458,31.39877],[26.92891,33.39516]]]]}},{type:"Feature",properties:{iso1A2:"MA",iso1A3:"MAR",iso1N3:"504",wikidata:"Q1028",nameEn:"Morocco",groups:["015","002","UN"],callingCodes:["212"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.27707,35.35051],[-5.10878,36.05227],[-7.2725,35.73269],[-14.43883,27.02969],[-17.27295,21.93519],[-17.21511,21.34226],[-17.02707,21.34022],[-16.9978,21.36239],[-16.44269,21.39745],[-14.78487,21.36587],[-14.47329,21.63839],[-14.48112,22.00886],[-14.1291,22.41636],[-14.10361,22.75501],[-13.75627,23.77231],[-13.00628,24.01923],[-12.92147,24.39502],[-12.12281,25.13682],[-12.06001,26.04442],[-11.62052,26.05229],[-11.38635,26.611],[-11.23622,26.72023],[-11.35695,26.8505],[-10.68417,26.90984],[-9.81998,26.71379],[-9.56957,26.90042],[-9.08698,26.98639],[-8.71787,26.9898],[-8.77527,27.66663],[-8.66879,27.6666],[-8.6715,28.71194],[-7.61585,29.36252],[-6.95824,29.50924],[-6.78351,29.44634],[-6.69965,29.51623],[-5.75616,29.61407],[-5.72121,29.52322],[-5.58831,29.48103],[-5.21671,29.95253],[-4.6058,30.28343],[-4.31774,30.53229],[-3.64735,30.67539],[-3.65418,30.85566],[-3.54944,31.0503],[-3.77103,31.14984],[-3.77647,31.31912],[-3.66386,31.39202],[-3.66314,31.6339],[-2.82784,31.79459],[-2.93873,32.06557],[-2.46166,32.16603],[-1.22829,32.07832],[-1.15735,32.12096],[-1.24453,32.1917],[-1.24998,32.32993],[-.9912,32.52467],[-1.37794,32.73628],[-1.54244,32.95499],[-1.46249,33.0499],[-1.67067,33.27084],[-1.59508,33.59929],[-1.73494,33.71721],[-1.64666,34.10405],[-1.78042,34.39018],[-1.69788,34.48056],[-1.84569,34.61907],[-1.73707,34.74226],[-1.97469,34.886],[-1.97833,34.93218],[-2.04734,34.93218],[-2.21445,35.04378],[-2.21248,35.08532],[-2.27707,35.35051]],[[-2.91909,35.33927],[-2.92272,35.27509],[-2.93893,35.26737],[-2.95065,35.26576],[-2.95431,35.2728],[-2.96516,35.27967],[-2.96826,35.28296],[-2.96507,35.28801],[-2.97035,35.28852],[-2.96978,35.29459],[-2.96648,35.30475],[-2.96038,35.31609],[-2.91909,35.33927]],[[-3.90602,35.21494],[-3.89343,35.22728],[-3.88372,35.20767],[-3.90602,35.21494]],[[-4.30191,35.17419],[-4.29436,35.17149],[-4.30112,35.17058],[-4.30191,35.17419]],[[-2.40316,35.16893],[-2.45965,35.16527],[-2.43262,35.20652],[-2.40316,35.16893]],[[-5.38491,35.92591],[-5.21179,35.90091],[-5.34379,35.8711],[-5.35844,35.87375],[-5.37338,35.88417],[-5.38491,35.92591]]]]}},{type:"Feature",properties:{iso1A2:"MC",iso1A3:"MCO",iso1N3:"492",wikidata:"Q235",nameEn:"Monaco",groups:["155","150","UN"],callingCodes:["377"]},geometry:{type:"MultiPolygon",coordinates:[[[[7.47823,43.73341],[7.4379,43.74963],[7.4389,43.75151],[7.43708,43.75197],[7.43624,43.75014],[7.43013,43.74895],[7.42809,43.74396],[7.42443,43.74087],[7.42299,43.74176],[7.42062,43.73977],[7.41233,43.73439],[7.41298,43.73311],[7.41291,43.73168],[7.41113,43.73156],[7.40903,43.7296],[7.42422,43.72209],[7.47823,43.73341]]]]}},{type:"Feature",properties:{iso1A2:"MD",iso1A3:"MDA",iso1N3:"498",wikidata:"Q217",nameEn:"Moldova",groups:["151","150","UN"],callingCodes:["373"]},geometry:{type:"MultiPolygon",coordinates:[[[[27.74422,48.45926],[27.6658,48.44034],[27.59027,48.46311],[27.5889,48.49224],[27.46942,48.454],[27.44333,48.41209],[27.37741,48.41026],[27.37604,48.44398],[27.32159,48.4434],[27.27855,48.37534],[27.13434,48.37288],[27.08078,48.43214],[27.0231,48.42485],[27.03821,48.37653],[26.93384,48.36558],[26.85556,48.41095],[26.71274,48.40388],[26.82809,48.31629],[26.79239,48.29071],[26.6839,48.35828],[26.62823,48.25804],[26.81161,48.25049],[26.87708,48.19919],[26.94265,48.1969],[26.98042,48.15752],[26.96119,48.13003],[27.04118,48.12522],[27.02985,48.09083],[27.15622,47.98538],[27.1618,47.92391],[27.29069,47.73722],[27.25519,47.71366],[27.32202,47.64009],[27.3979,47.59473],[27.47942,47.48113],[27.55731,47.46637],[27.60263,47.32507],[27.68706,47.28962],[27.73172,47.29248],[27.81892,47.1381],[28.09095,46.97621],[28.12173,46.82283],[28.24808,46.64305],[28.22281,46.50481],[28.25769,46.43334],[28.18902,46.35283],[28.19864,46.31869],[28.10937,46.22852],[28.13684,46.18099],[28.08612,46.01105],[28.13111,45.92819],[28.16568,45.6421],[28.08927,45.6051],[28.18741,45.47358],[28.21139,45.46895],[28.30201,45.54744],[28.41836,45.51715],[28.43072,45.48538],[28.51449,45.49982],[28.49252,45.56716],[28.54196,45.58062],[28.51587,45.6613],[28.47879,45.66994],[28.52823,45.73803],[28.70401,45.78019],[28.69852,45.81753],[28.78503,45.83475],[28.74383,45.96664],[28.98004,46.00385],[29.00613,46.04962],[28.94643,46.09176],[29.06656,46.19716],[28.94953,46.25852],[28.98478,46.31803],[29.004,46.31495],[28.9306,46.45699],[29.01241,46.46177],[29.02409,46.49582],[29.23547,46.55435],[29.24886,46.37912],[29.35357,46.49505],[29.49914,46.45889],[29.5939,46.35472],[29.6763,46.36041],[29.66359,46.4215],[29.74496,46.45605],[29.88329,46.35851],[29.94114,46.40114],[30.09103,46.38694],[30.16794,46.40967],[30.02511,46.45132],[29.88916,46.54302],[29.94409,46.56002],[29.9743,46.75325],[29.94522,46.80055],[29.98814,46.82358],[29.87405,46.88199],[29.75458,46.8604],[29.72986,46.92234],[29.57056,46.94766],[29.62137,47.05069],[29.61038,47.09932],[29.53044,47.07851],[29.49732,47.12878],[29.57696,47.13581],[29.54996,47.24962],[29.59665,47.25521],[29.5733,47.36508],[29.48678,47.36043],[29.47854,47.30366],[29.39889,47.30179],[29.3261,47.44664],[29.18603,47.43387],[29.11743,47.55001],[29.22414,47.60012],[29.22242,47.73607],[29.27255,47.79953],[29.20663,47.80367],[29.27804,47.88893],[29.19839,47.89261],[29.1723,47.99013],[28.9306,47.96255],[28.8414,48.03392],[28.85232,48.12506],[28.69896,48.13106],[28.53921,48.17453],[28.48428,48.0737],[28.42454,48.12047],[28.43701,48.15832],[28.38712,48.17567],[28.34009,48.13147],[28.30609,48.14018],[28.30586,48.1597],[28.34912,48.1787],[28.36996,48.20543],[28.35519,48.24957],[28.32508,48.23384],[28.2856,48.23202],[28.19314,48.20749],[28.17666,48.25963],[28.07504,48.23494],[28.09873,48.3124],[28.04527,48.32661],[27.95883,48.32368],[27.88391,48.36699],[27.87533,48.4037],[27.81902,48.41874],[27.79225,48.44244],[27.74422,48.45926]]]]}},{type:"Feature",properties:{iso1A2:"ME",iso1A3:"MNE",iso1N3:"499",wikidata:"Q236",nameEn:"Montenegro",groups:["039","150","UN"],callingCodes:["382"]},geometry:{type:"MultiPolygon",coordinates:[[[[19.22807,43.5264],[19.15685,43.53943],[19.13933,43.5282],[19.04934,43.50384],[19.01078,43.55806],[18.91379,43.50299],[18.95469,43.49367],[18.96053,43.45042],[19.01078,43.43854],[19.04071,43.397],[19.08673,43.31453],[19.08206,43.29668],[19.04233,43.30008],[19.00844,43.24988],[18.95001,43.29327],[18.95819,43.32899],[18.90911,43.36383],[18.83912,43.34795],[18.84794,43.33735],[18.85342,43.32426],[18.76538,43.29838],[18.6976,43.25243],[18.71747,43.2286],[18.66605,43.2056],[18.64735,43.14766],[18.66254,43.03928],[18.52232,43.01451],[18.49076,42.95553],[18.49661,42.89306],[18.4935,42.86433],[18.47633,42.85829],[18.45921,42.81682],[18.47324,42.74992],[18.56789,42.72074],[18.55221,42.69045],[18.54603,42.69171],[18.54841,42.68328],[18.57373,42.64429],[18.52232,42.62279],[18.55504,42.58409],[18.53751,42.57376],[18.49778,42.58409],[18.43735,42.55921],[18.44307,42.51077],[18.43588,42.48556],[18.52152,42.42302],[18.54128,42.39171],[18.45131,42.21682],[19.26406,41.74971],[19.37597,41.84849],[19.37451,41.8842],[19.33812,41.90669],[19.34601,41.95675],[19.37691,41.96977],[19.36867,42.02564],[19.37548,42.06835],[19.40687,42.10024],[19.28623,42.17745],[19.42,42.33019],[19.42352,42.36546],[19.4836,42.40831],[19.65972,42.62774],[19.73244,42.66299],[19.77375,42.58517],[19.74731,42.57422],[19.76549,42.50237],[19.82333,42.46581],[19.9324,42.51699],[20.00842,42.5109],[20.01834,42.54622],[20.07761,42.55582],[20.0969,42.65559],[20.02915,42.71147],[20.02088,42.74789],[20.04898,42.77701],[20.2539,42.76245],[20.27869,42.81945],[20.35692,42.8335],[20.34528,42.90676],[20.16415,42.97177],[20.14896,42.99058],[20.12325,42.96237],[20.05431,42.99571],[20.04729,43.02732],[19.98887,43.0538],[19.96549,43.11098],[19.92576,43.08539],[19.79255,43.11951],[19.76918,43.16044],[19.64063,43.19027],[19.62661,43.2286],[19.54598,43.25158],[19.52962,43.31623],[19.48171,43.32644],[19.44315,43.38846],[19.22229,43.47926],[19.22807,43.5264]]]]}},{type:"Feature",properties:{iso1A2:"MF",iso1A3:"MAF",iso1N3:"663",wikidata:"Q126125",nameEn:"Saint-Martin",country:"FR",groups:["Q3320166","EU","029","003","419","019","UN"],callingCodes:["590"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.93924,18.02904],[-62.62718,18.26185],[-63.35989,18.06012],[-63.33064,17.9615],[-63.13502,18.05445],[-63.11042,18.05339],[-63.09686,18.04608],[-63.07759,18.04943],[-63.0579,18.06614],[-63.04039,18.05619],[-63.02323,18.05757],[-62.93924,18.02904]]]]}},{type:"Feature",properties:{iso1A2:"MG",iso1A3:"MDG",iso1N3:"450",wikidata:"Q1019",nameEn:"Madagascar",aliases:["RM"],groups:["014","202","002","UN"],callingCodes:["261"]},geometry:{type:"MultiPolygon",coordinates:[[[[51.93891,-10.85085],[45.84651,-12.77177],[42.14681,-19.63341],[45.80092,-33.00974],[51.93891,-10.85085]]]]}},{type:"Feature",properties:{iso1A2:"MH",iso1A3:"MHL",iso1N3:"584",wikidata:"Q709",nameEn:"Marshall Islands",groups:["057","009","UN"],roadSpeedUnit:"mph",callingCodes:["692"]},geometry:{type:"MultiPolygon",coordinates:[[[[169,3.9],[173.53711,5.70687],[169.29099,15.77133],[159.04653,10.59067],[169,3.9]]]]}},{type:"Feature",properties:{iso1A2:"MK",iso1A3:"MKD",iso1N3:"807",wikidata:"Q221",nameEn:"North Macedonia",groups:["039","150","UN"],callingCodes:["389"]},geometry:{type:"MultiPolygon",coordinates:[[[[22.34773,42.31725],[22.29275,42.34913],[22.29605,42.37477],[22.16384,42.32103],[22.02908,42.29848],[21.94405,42.34669],[21.91595,42.30392],[21.84654,42.3247],[21.77176,42.2648],[21.70111,42.23789],[21.58992,42.25915],[21.52145,42.24465],[21.50823,42.27156],[21.43882,42.2789],[21.43882,42.23609],[21.38428,42.24465],[21.30496,42.1418],[21.29913,42.13954],[21.31983,42.10993],[21.22728,42.08909],[21.16614,42.19815],[21.11491,42.20794],[20.75464,42.05229],[20.76786,41.91839],[20.68523,41.85318],[20.59524,41.8818],[20.55976,41.87068],[20.57144,41.7897],[20.53405,41.78099],[20.51301,41.72433],[20.52937,41.69292],[20.51769,41.65975],[20.55508,41.58113],[20.52103,41.56473],[20.45809,41.5549],[20.45331,41.51436],[20.49039,41.49277],[20.51301,41.442],[20.55976,41.4087],[20.52119,41.34381],[20.49432,41.33679],[20.51068,41.2323],[20.59715,41.13644],[20.58546,41.11179],[20.59832,41.09066],[20.63454,41.0889],[20.65558,41.08009],[20.71634,40.91781],[20.73504,40.9081],[20.81567,40.89662],[20.83671,40.92752],[20.94305,40.92399],[20.97693,40.90103],[20.97887,40.85475],[21.15262,40.85546],[21.21105,40.8855],[21.25779,40.86165],[21.35595,40.87578],[21.41555,40.9173],[21.53007,40.90759],[21.57448,40.86076],[21.69601,40.9429],[21.7556,40.92525],[21.91102,41.04786],[21.90869,41.09191],[22.06527,41.15617],[22.1424,41.12449],[22.17629,41.15969],[22.26744,41.16409],[22.42285,41.11921],[22.5549,41.13065],[22.58295,41.11568],[22.62852,41.14385],[22.65306,41.18168],[22.71266,41.13945],[22.74538,41.16321],[22.76408,41.32225],[22.81199,41.3398],[22.93334,41.34104],[22.96331,41.35782],[22.95513,41.63265],[23.03342,41.71034],[23.01239,41.76527],[22.96682,41.77137],[22.90254,41.87587],[22.86749,42.02275],[22.67701,42.06614],[22.51224,42.15457],[22.50289,42.19527],[22.47251,42.20393],[22.38136,42.30339],[22.34773,42.31725]]]]}},{type:"Feature",properties:{iso1A2:"ML",iso1A3:"MLI",iso1N3:"466",wikidata:"Q912",nameEn:"Mali",groups:["011","202","002","UN"],callingCodes:["223"]},geometry:{type:"MultiPolygon",coordinates:[[[[-4.83423,24.99935],[-6.57191,25.0002],[-5.60725,16.49919],[-5.33435,16.33354],[-5.50165,15.50061],[-9.32979,15.50032],[-9.31106,15.69412],[-9.33314,15.7044],[-9.44673,15.60553],[-9.40447,15.4396],[-10.71721,15.4223],[-10.90932,15.11001],[-11.43483,15.62339],[-11.70705,15.51558],[-11.94903,14.76143],[-12.23936,14.76324],[-11.93043,13.84505],[-12.06897,13.71049],[-11.83345,13.33333],[-11.63025,13.39174],[-11.39935,12.97808],[-11.37536,12.40788],[-11.50006,12.17826],[-11.24136,12.01286],[-10.99758,12.24634],[-10.80355,12.1053],[-10.71897,11.91552],[-10.30604,12.24634],[-9.714,12.0226],[-9.63938,12.18312],[-9.32097,12.29009],[-9.38067,12.48446],[-9.13689,12.50875],[-8.94784,12.34842],[-8.80854,11.66715],[-8.40058,11.37466],[-8.66923,10.99397],[-8.35083,11.06234],[-8.2667,10.91762],[-8.32614,10.69273],[-8.22711,10.41722],[-8.10207,10.44649],[-7.9578,10.2703],[-7.97971,10.17117],[-7.92107,10.15577],[-7.63048,10.46334],[-7.54462,10.40921],[-7.52261,10.4655],[-7.44555,10.44602],[-7.3707,10.24677],[-7.13331,10.24877],[-7.0603,10.14711],[-7.00966,10.15794],[-6.97444,10.21644],[-7.01186,10.25111],[-6.93921,10.35291],[-6.68164,10.35074],[-6.63541,10.66893],[-6.52974,10.59104],[-6.42847,10.5694],[-6.40646,10.69922],[-6.325,10.68624],[-6.24795,10.74248],[-6.1731,10.46983],[-6.18851,10.24244],[-5.99478,10.19694],[-5.78124,10.43952],[-5.65135,10.46767],[-5.51058,10.43177],[-5.46643,10.56074],[-5.47083,10.75329],[-5.41579,10.84628],[-5.49284,11.07538],[-5.32994,11.13371],[-5.32553,11.21578],[-5.25949,11.24816],[-5.25509,11.36905],[-5.20665,11.43811],[-5.22867,11.60421],[-5.29251,11.61715],[-5.26389,11.75728],[-5.40258,11.8327],[-5.26389,11.84778],[-5.07897,11.97918],[-4.72893,12.01579],[-4.70692,12.06746],[-4.62987,12.06531],[-4.62546,12.13204],[-4.54841,12.1385],[-4.57703,12.19875],[-4.41412,12.31922],[-4.47356,12.71252],[-4.238,12.71467],[-4.21819,12.95722],[-4.34477,13.12927],[-3.96501,13.49778],[-3.90558,13.44375],[-3.96282,13.38164],[-3.7911,13.36665],[-3.54454,13.1781],[-3.4313,13.1588],[-3.43507,13.27272],[-3.23599,13.29035],[-3.28396,13.5422],[-3.26407,13.70699],[-2.88189,13.64921],[-2.90831,13.81174],[-2.84667,14.05532],[-2.66175,14.14713],[-2.47587,14.29671],[-2.10223,14.14878],[-1.9992,14.19011],[-1.97945,14.47709],[-1.68083,14.50023],[-1.32166,14.72774],[-1.05875,14.7921],[-.72004,15.08655],[-.24673,15.07805],[.06588,14.96961],[.23859,15.00135],[.72632,14.95898],[.96711,14.98275],[1.31275,15.27978],[3.01806,15.34571],[3.03134,15.42221],[3.50368,15.35934],[4.19893,16.39923],[4.21787,17.00118],[4.26762,17.00432],[4.26651,19.14224],[3.36082,18.9745],[3.12501,19.1366],[3.24648,19.81703],[1.20992,20.73533],[1.15698,21.12843],[-4.83423,24.99935]]]]}},{type:"Feature",properties:{iso1A2:"MM",iso1A3:"MMR",iso1N3:"104",wikidata:"Q836",nameEn:"Myanmar",aliases:["Burma","BU"],groups:["035","142","UN"],callingCodes:["95"]},geometry:{type:"MultiPolygon",coordinates:[[[[92.62187,21.87037],[92.59775,21.6092],[92.68152,21.28454],[92.60187,21.24615],[92.55105,21.3856],[92.43158,21.37025],[92.37939,21.47764],[92.20087,21.337],[92.17752,21.17445],[92.26071,21.05697],[92.47409,20.38654],[92.61042,13.76986],[94.6371,13.81803],[97.63455,9.60854],[98.12555,9.44056],[98.33094,9.91973],[98.47298,9.95782],[98.52291,9.92389],[98.55174,9.92804],[98.7391,10.31488],[98.81944,10.52761],[98.77275,10.62548],[98.78511,10.68351],[98.86819,10.78336],[99.0069,10.85485],[98.99701,10.92962],[99.02337,10.97217],[99.06938,10.94857],[99.32756,11.28545],[99.31573,11.32081],[99.39485,11.3925],[99.47598,11.62434],[99.5672,11.62732],[99.64108,11.78948],[99.64891,11.82699],[99.53424,12.02317],[99.56445,12.14805],[99.47519,12.1353],[99.409,12.60603],[99.29254,12.68921],[99.18905,12.84799],[99.18748,12.9898],[99.10646,13.05804],[99.12225,13.19847],[99.20617,13.20575],[99.16695,13.72621],[98.97356,14.04868],[98.56762,14.37701],[98.24874,14.83013],[98.18821,15.13125],[98.22,15.21327],[98.30446,15.30667],[98.40522,15.25268],[98.41906,15.27103],[98.39351,15.34177],[98.4866,15.39154],[98.56027,15.33471],[98.58598,15.46821],[98.541,15.65406],[98.59853,15.87197],[98.57019,16.04578],[98.69585,16.13353],[98.8376,16.11706],[98.92656,16.36425],[98.84485,16.42354],[98.68074,16.27068],[98.63817,16.47424],[98.57912,16.55983],[98.5695,16.62826],[98.51113,16.64503],[98.51833,16.676],[98.51472,16.68521],[98.51579,16.69433],[98.51043,16.70107],[98.49713,16.69022],[98.50253,16.7139],[98.46994,16.73613],[98.53833,16.81934],[98.49603,16.8446],[98.52624,16.89979],[98.39441,17.06266],[98.34566,17.04822],[98.10439,17.33847],[98.11185,17.36829],[97.91829,17.54504],[97.76407,17.71595],[97.66794,17.88005],[97.73723,17.97912],[97.60841,18.23846],[97.64116,18.29778],[97.56219,18.33885],[97.50383,18.26844],[97.34522,18.54596],[97.36444,18.57138],[97.5258,18.4939],[97.76752,18.58097],[97.73836,18.88478],[97.66487,18.9371],[97.73654,18.9812],[97.73797,19.04261],[97.83479,19.09972],[97.84024,19.22217],[97.78606,19.26769],[97.84186,19.29526],[97.78769,19.39429],[97.88423,19.5041],[97.84715,19.55782],[98.04364,19.65755],[98.03314,19.80941],[98.13829,19.78541],[98.24884,19.67876],[98.51182,19.71303],[98.56065,19.67807],[98.83661,19.80931],[98.98679,19.7419],[99.0735,20.10298],[99.20328,20.12877],[99.416,20.08614],[99.52943,20.14811],[99.5569,20.20676],[99.46077,20.36198],[99.46008,20.39673],[99.68255,20.32077],[99.81096,20.33687],[99.86383,20.44371],[99.88211,20.44488],[99.88451,20.44596],[99.89168,20.44548],[99.89301,20.44311],[99.89692,20.44789],[99.90499,20.4487],[99.91616,20.44986],[99.95721,20.46301],[100.08404,20.36626],[100.1957,20.68247],[100.36375,20.82783],[100.51079,20.82194],[100.60112,20.8347],[100.64628,20.88279],[100.50974,20.88574],[100.55281,21.02796],[100.63578,21.05639],[100.72716,21.31786],[100.80173,21.2934],[101.00234,21.39612],[101.16198,21.52808],[101.15156,21.56129],[101.11744,21.77659],[100.87265,21.67396],[100.72143,21.51898],[100.57861,21.45637],[100.4811,21.46148],[100.42892,21.54325],[100.35201,21.53176],[100.25863,21.47043],[100.18447,21.51898],[100.1625,21.48704],[100.12542,21.50365],[100.10757,21.59945],[100.17486,21.65306],[100.12679,21.70539],[100.04956,21.66843],[99.98654,21.71064],[99.94003,21.82782],[99.99084,21.97053],[99.96612,22.05965],[99.85351,22.04183],[99.47585,22.13345],[99.33166,22.09656],[99.1552,22.15874],[99.19176,22.16983],[99.17318,22.18025],[99.28771,22.4105],[99.37972,22.50188],[99.38247,22.57544],[99.31243,22.73893],[99.45654,22.85726],[99.43537,22.94086],[99.54218,22.90014],[99.52214,23.08218],[99.34127,23.13099],[99.25741,23.09025],[99.04601,23.12215],[99.05975,23.16382],[98.88597,23.18656],[98.92515,23.29535],[98.93958,23.31414],[98.87573,23.33038],[98.92104,23.36946],[98.87683,23.48995],[98.82877,23.47908],[98.80294,23.5345],[98.88396,23.59555],[98.81775,23.694],[98.82933,23.72921],[98.79607,23.77947],[98.68209,23.80492],[98.67797,23.9644],[98.89632,24.10612],[98.87998,24.15624],[98.85319,24.13042],[98.59256,24.08371],[98.54476,24.13119],[98.20666,24.11406],[98.07806,24.07988],[98.06703,24.08028],[98.0607,24.07812],[98.05671,24.07961],[98.05302,24.07408],[98.04709,24.07616],[97.99583,24.04932],[97.98691,24.03897],[97.93951,24.01953],[97.90998,24.02094],[97.88616,24.00463],[97.88414,23.99405],[97.88814,23.98605],[97.89683,23.98389],[97.89676,23.97931],[97.8955,23.97758],[97.88811,23.97446],[97.86545,23.97723],[97.84328,23.97603],[97.79416,23.95663],[97.79456,23.94836],[97.72302,23.89288],[97.64667,23.84574],[97.5247,23.94032],[97.62363,24.00506],[97.72903,24.12606],[97.75305,24.16902],[97.72799,24.18883],[97.72998,24.2302],[97.76799,24.26365],[97.71941,24.29652],[97.66723,24.30027],[97.65624,24.33781],[97.7098,24.35658],[97.66998,24.45288],[97.60029,24.4401],[97.52757,24.43748],[97.56286,24.54535],[97.56525,24.72838],[97.54675,24.74202],[97.5542,24.74943],[97.56383,24.75535],[97.56648,24.76475],[97.64354,24.79171],[97.70181,24.84557],[97.73127,24.83015],[97.76481,24.8289],[97.79949,24.85655],[97.72903,24.91332],[97.72216,25.08508],[97.77023,25.11492],[97.83614,25.2715],[97.92541,25.20815],[98.14925,25.41547],[98.12591,25.50722],[98.18084,25.56298],[98.16848,25.62739],[98.25774,25.6051],[98.31268,25.55307],[98.40606,25.61129],[98.54064,25.85129],[98.63128,25.79937],[98.70818,25.86241],[98.60763,26.01512],[98.57085,26.11547],[98.63128,26.15492],[98.66884,26.09165],[98.7329,26.17218],[98.67797,26.24487],[98.72741,26.36183],[98.77547,26.61994],[98.7333,26.85615],[98.69582,27.56499],[98.43353,27.67086],[98.42529,27.55404],[98.32641,27.51385],[98.13964,27.9478],[98.15337,28.12114],[97.90069,28.3776],[97.79632,28.33168],[97.70705,28.5056],[97.56835,28.55628],[97.50518,28.49716],[97.47085,28.2688],[97.41729,28.29783],[97.34547,28.21385],[97.31292,28.06784],[97.35412,28.06663],[97.38845,28.01329],[97.35824,27.87256],[97.29919,27.92233],[96.90112,27.62149],[96.91431,27.45752],[97.17422,27.14052],[97.14675,27.09041],[96.89132,27.17474],[96.85287,27.2065],[96.88445,27.25046],[96.73888,27.36638],[96.55761,27.29928],[96.40779,27.29818],[96.15591,27.24572],[96.04949,27.19428],[95.93002,27.04149],[95.81603,27.01335],[95.437,26.7083],[95.30339,26.65372],[95.23513,26.68499],[95.05798,26.45408],[95.12801,26.38397],[95.11428,26.1019],[95.18556,26.07338],[94.80117,25.49359],[94.68032,25.47003],[94.57458,25.20318],[94.74212,25.13606],[94.73937,25.00545],[94.60204,24.70889],[94.5526,24.70764],[94.50729,24.59281],[94.45279,24.56656],[94.32362,24.27692],[94.30215,24.23752],[94.14081,23.83333],[93.92089,23.95812],[93.80279,23.92549],[93.75952,24.0003],[93.62871,24.00922],[93.50616,23.94432],[93.46633,23.97067],[93.41415,24.07854],[93.34735,24.10151],[93.32351,24.04468],[93.36059,23.93176],[93.3908,23.92925],[93.3908,23.7622],[93.43475,23.68299],[93.38805,23.4728],[93.39981,23.38828],[93.38781,23.36139],[93.36862,23.35426],[93.38478,23.13698],[93.2878,23.00464],[93.12988,23.05772],[93.134,22.92498],[93.09417,22.69459],[93.134,22.59573],[93.11477,22.54374],[93.13537,22.45873],[93.18206,22.43716],[93.19991,22.25425],[93.14224,22.24535],[93.15734,22.18687],[93.04885,22.20595],[92.99255,22.05965],[92.99804,21.98964],[92.93899,22.02656],[92.89504,21.95143],[92.86208,22.05456],[92.70416,22.16017],[92.67532,22.03547],[92.60949,21.97638],[92.62187,21.87037]]]]}},{type:"Feature",properties:{iso1A2:"MN",iso1A3:"MNG",iso1N3:"496",wikidata:"Q711",nameEn:"Mongolia",groups:["030","142","UN"],callingCodes:["976"]},geometry:{type:"MultiPolygon",coordinates:[[[[102.14032,51.35566],[101.5044,51.50467],[101.39085,51.45753],[100.61116,51.73028],[99.89203,51.74903],[99.75578,51.90108],[99.27888,51.96876],[98.87768,52.14563],[98.74142,51.8637],[98.33222,51.71832],[98.22053,51.46579],[98.05257,51.46696],[97.83305,51.00248],[98.01472,50.86652],[97.9693,50.78044],[98.06393,50.61262],[98.31373,50.4996],[98.29481,50.33561],[97.85197,49.91339],[97.76871,49.99861],[97.56432,49.92801],[97.56811,49.84265],[97.24639,49.74737],[96.97388,49.88413],[95.80056,50.04239],[95.74757,49.97915],[95.02465,49.96941],[94.97166,50.04725],[94.6121,50.04239],[94.49477,50.17832],[94.39258,50.22193],[94.30823,50.57498],[92.99595,50.63183],[93.01109,50.79001],[92.44714,50.78762],[92.07173,50.69585],[91.86048,50.73734],[89.59711,49.90851],[89.70687,49.72535],[88.82499,49.44808],[88.42449,49.48821],[88.17223,49.46934],[88.15543,49.30314],[87.98977,49.18147],[87.81333,49.17354],[87.88171,48.95853],[87.73822,48.89582],[88.0788,48.71436],[87.96361,48.58478],[88.58939,48.34531],[88.58316,48.21893],[88.8011,48.11302],[88.93186,48.10263],[89.0711,47.98528],[89.55453,48.0423],[89.76624,47.82745],[90.06512,47.88177],[90.10871,47.7375],[90.33598,47.68303],[90.48854,47.41826],[90.48542,47.30438],[90.76108,46.99399],[90.84035,46.99525],[91.03649,46.72916],[91.0147,46.58171],[91.07696,46.57315],[90.89639,46.30711],[90.99672,46.14207],[91.03026,46.04194],[90.70907,45.73437],[90.65114,45.49314],[90.89169,45.19667],[91.64048,45.07408],[93.51161,44.95964],[94.10003,44.71016],[94.71959,44.35284],[95.01191,44.25274],[95.39772,44.2805],[95.32891,44.02407],[95.52594,43.99353],[95.89543,43.2528],[96.35658,42.90363],[96.37926,42.72055],[97.1777,42.7964],[99.50671,42.56535],[100.33297,42.68231],[100.84979,42.67087],[101.80515,42.50074],[102.07645,42.22519],[102.72403,42.14675],[103.92804,41.78246],[104.52258,41.8706],[104.51667,41.66113],[105.0123,41.63188],[106.76517,42.28741],[107.24774,42.36107],[107.29755,42.41395],[107.49681,42.46221],[107.57258,42.40898],[108.84489,42.40246],[109.00679,42.45302],[109.452,42.44842],[109.89402,42.63111],[110.08401,42.6411],[110.4327,42.78293],[111.0149,43.3289],[111.59087,43.51207],[111.79758,43.6637],[111.93776,43.68709],[111.96289,43.81596],[111.40498,44.3461],[111.76275,44.98032],[111.98695,45.09074],[112.4164,45.06858],[112.74662,44.86297],[113.70918,44.72891],[114.5166,45.27189],[114.54801,45.38337],[114.74612,45.43585],[114.94546,45.37377],[115.60329,45.44717],[116.16989,45.68603],[116.27366,45.78637],[116.24012,45.8778],[116.26678,45.96479],[116.58612,46.30211],[116.75551,46.33083],[116.83166,46.38637],[117.36609,46.36335],[117.41782,46.57862],[117.60748,46.59771],[117.69554,46.50991],[118.30534,46.73519],[118.78747,46.68689],[118.8337,46.77742],[118.89974,46.77139],[118.92616,46.72765],[119.00541,46.74273],[119.10448,46.65516],[119.24978,46.64761],[119.32827,46.61433],[119.42827,46.63783],[119.65265,46.62342],[119.68127,46.59015],[119.77373,46.62947],[119.80455,46.67631],[119.89261,46.66423],[119.91242,46.90091],[119.85518,46.92196],[119.71209,47.19192],[119.62403,47.24575],[119.56019,47.24874],[119.54918,47.29505],[119.31964,47.42617],[119.35892,47.48104],[119.13995,47.53997],[119.12343,47.66458],[118.7564,47.76947],[118.55766,47.99277],[118.29654,48.00246],[118.22677,48.03853],[118.11009,48.04],[118.03676,48.00982],[117.80196,48.01661],[117.50181,47.77216],[117.37875,47.63627],[116.9723,47.87285],[116.67405,47.89039],[116.4465,47.83662],[116.21879,47.88505],[115.94296,47.67741],[115.57128,47.91988],[115.52082,48.15367],[115.811,48.25699],[115.78876,48.51781],[116.06565,48.81716],[116.03781,48.87014],[116.71193,49.83813],[116.62502,49.92919],[116.22402,50.04477],[115.73602,49.87688],[115.26068,49.97367],[114.9703,50.19254],[114.325,50.28098],[113.20216,49.83356],[113.02647,49.60772],[110.64493,49.1816],[110.39891,49.25083],[110.24373,49.16676],[109.51325,49.22859],[109.18017,49.34709],[108.53969,49.32325],[108.27937,49.53167],[107.95387,49.66659],[107.96116,49.93191],[107.36407,49.97612],[107.1174,50.04239],[107.00007,50.1977],[106.80326,50.30177],[106.58373,50.34044],[106.51122,50.34408],[106.49628,50.32436],[106.47156,50.31909],[106.07865,50.33474],[106.05562,50.40582],[105.32528,50.4648],[103.70343,50.13952],[102.71178,50.38873],[102.32194,50.67982],[102.14032,51.35566]]]]}},{type:"Feature",properties:{iso1A2:"MO",iso1A3:"MAC",iso1N3:"446",wikidata:"Q14773",nameEn:"Macau",aliases:["Macao"],country:"CN",groups:["030","142","UN"],driveSide:"left",callingCodes:["853"]},geometry:{type:"MultiPolygon",coordinates:[[[[113.54942,22.14519],[113.54839,22.10909],[113.57191,22.07696],[113.63011,22.10782],[113.60504,22.20464],[113.57123,22.20416],[113.56865,22.20973],[113.5508,22.21672],[113.54333,22.21688],[113.54093,22.21314],[113.53593,22.2137],[113.53301,22.21235],[113.53552,22.20607],[113.52659,22.18271],[113.54093,22.15497],[113.54942,22.14519]]]]}},{type:"Feature",properties:{iso1A2:"MP",iso1A3:"MNP",iso1N3:"580",wikidata:"Q16644",nameEn:"Northern Mariana Islands",aliases:["US-MP"],country:"US",groups:["Q1352230","Q153732","057","009","UN"],roadSpeedUnit:"mph",callingCodes:["1 670"]},geometry:{type:"MultiPolygon",coordinates:[[[[135.52896,14.32623],[152.19114,13.63487],[145.05972,21.28731],[135.52896,14.32623]]]]}},{type:"Feature",properties:{iso1A2:"MQ",iso1A3:"MTQ",iso1N3:"474",wikidata:"Q17054",nameEn:"Martinique",country:"FR",groups:["Q3320166","EU","029","003","419","019","UN"],callingCodes:["596"]},geometry:{type:"MultiPolygon",coordinates:[[[[-59.95997,14.20285],[-61.07821,15.25109],[-61.69315,14.26451],[-59.95997,14.20285]]]]}},{type:"Feature",properties:{iso1A2:"MR",iso1A3:"MRT",iso1N3:"478",wikidata:"Q1025",nameEn:"Mauritania",groups:["011","202","002","UN"],callingCodes:["222"]},geometry:{type:"MultiPolygon",coordinates:[[[[-5.60725,16.49919],[-6.57191,25.0002],[-4.83423,24.99935],[-8.66674,27.31569],[-8.66721,25.99918],[-12.0002,25.9986],[-12.00251,23.4538],[-12.14969,23.41935],[-12.36213,23.3187],[-12.5741,23.28975],[-13.00412,23.02297],[-13.10753,22.89493],[-13.15313,22.75649],[-13.08438,22.53866],[-13.01525,21.33343],[-16.95474,21.33997],[-16.99806,21.12142],[-17.0357,21.05368],[-17.0396,20.9961],[-17.06781,20.92697],[-17.0695,20.85742],[-17.0471,20.76408],[-17.15288,16.07139],[-16.50854,16.09032],[-16.48967,16.0496],[-16.44814,16.09753],[-16.4429,16.20605],[-16.27016,16.51565],[-15.6509,16.50315],[-15.00557,16.64997],[-14.32144,16.61495],[-13.80075,16.13961],[-13.43135,16.09022],[-13.11029,15.52116],[-12.23936,14.76324],[-11.94903,14.76143],[-11.70705,15.51558],[-11.43483,15.62339],[-10.90932,15.11001],[-10.71721,15.4223],[-9.40447,15.4396],[-9.44673,15.60553],[-9.33314,15.7044],[-9.31106,15.69412],[-9.32979,15.50032],[-5.50165,15.50061],[-5.33435,16.33354],[-5.60725,16.49919]]]]}},{type:"Feature",properties:{iso1A2:"MS",iso1A3:"MSR",iso1N3:"500",wikidata:"Q13353",nameEn:"Montserrat",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 664"]},geometry:{type:"MultiPolygon",coordinates:[[[[-61.91508,16.51165],[-62.1023,16.97277],[-62.58307,16.68909],[-61.91508,16.51165]]]]}},{type:"Feature",properties:{iso1A2:"MT",iso1A3:"MLT",iso1N3:"470",wikidata:"Q233",nameEn:"Malta",groups:["EU","039","150","UN"],driveSide:"left",callingCodes:["356"]},geometry:{type:"MultiPolygon",coordinates:[[[[15.70991,35.79901],[14.07544,36.41525],[13.27636,35.20764],[15.70991,35.79901]]]]}},{type:"Feature",properties:{iso1A2:"MU",iso1A3:"MUS",iso1N3:"480",wikidata:"Q1027",nameEn:"Mauritius",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["230"]},geometry:{type:"MultiPolygon",coordinates:[[[[56.09755,-9.55401],[57.50644,-31.92637],[68.4673,-19.15185],[56.09755,-9.55401]]]]}},{type:"Feature",properties:{iso1A2:"MV",iso1A3:"MDV",iso1N3:"462",wikidata:"Q826",nameEn:"Maldives",groups:["034","142","UN"],driveSide:"left",callingCodes:["960"]},geometry:{type:"MultiPolygon",coordinates:[[[[71.9161,8.55531],[72.57428,-3.7623],[76.59015,5.591],[71.9161,8.55531]]]]}},{type:"Feature",properties:{iso1A2:"MW",iso1A3:"MWI",iso1N3:"454",wikidata:"Q1020",nameEn:"Malawi",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["265"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.48052,-9.62442],[33.31581,-9.48554],[33.14925,-9.49322],[32.99397,-9.36712],[32.95389,-9.40138],[33.00476,-9.5133],[33.00256,-9.63053],[33.05485,-9.61316],[33.10163,-9.66525],[33.12144,-9.58929],[33.2095,-9.61099],[33.31517,-9.82364],[33.36581,-9.81063],[33.37902,-9.9104],[33.31297,-10.05133],[33.53863,-10.20148],[33.54797,-10.36077],[33.70675,-10.56896],[33.47636,-10.78465],[33.28022,-10.84428],[33.25998,-10.88862],[33.39697,-11.15296],[33.29267,-11.3789],[33.29267,-11.43536],[33.23663,-11.40637],[33.24252,-11.59302],[33.32692,-11.59248],[33.33937,-11.91252],[33.25998,-12.14242],[33.3705,-12.34931],[33.47636,-12.32498],[33.54485,-12.35996],[33.37517,-12.54085],[33.28177,-12.54692],[33.18837,-12.61377],[33.05917,-12.59554],[32.94397,-12.76868],[32.96733,-12.88251],[33.02181,-12.88707],[32.98289,-13.12671],[33.0078,-13.19492],[32.86113,-13.47292],[32.84176,-13.52794],[32.73683,-13.57682],[32.68436,-13.55769],[32.66468,-13.60019],[32.68654,-13.64268],[32.7828,-13.64805],[32.84528,-13.71576],[32.76962,-13.77224],[32.79015,-13.80755],[32.88985,-13.82956],[32.99042,-13.95689],[33.02977,-14.05022],[33.07568,-13.98447],[33.16749,-13.93992],[33.24249,-14.00019],[33.66677,-14.61306],[33.7247,-14.4989],[33.88503,-14.51652],[33.92898,-14.47929],[34.08588,-14.48893],[34.18733,-14.43823],[34.22355,-14.43607],[34.34453,-14.3985],[34.35843,-14.38652],[34.39277,-14.39467],[34.4192,-14.43191],[34.44641,-14.47746],[34.45053,-14.49873],[34.47628,-14.53363],[34.48932,-14.53646],[34.49636,-14.55091],[34.52366,-14.5667],[34.53962,-14.59776],[34.55112,-14.64494],[34.53516,-14.67782],[34.52057,-14.68263],[34.54503,-14.74672],[34.567,-14.77345],[34.61522,-14.99583],[34.57503,-15.30619],[34.43126,-15.44778],[34.44981,-15.60864],[34.25195,-15.90321],[34.43126,-16.04737],[34.40344,-16.20923],[35.04805,-16.83167],[35.13771,-16.81687],[35.17017,-16.93521],[35.04805,-17.00027],[35.0923,-17.13235],[35.3062,-17.1244],[35.27065,-16.93817],[35.30929,-16.82871],[35.27219,-16.69402],[35.14235,-16.56812],[35.25828,-16.4792],[35.30157,-16.2211],[35.43355,-16.11371],[35.52365,-16.15414],[35.70107,-16.10147],[35.80487,-16.03907],[35.85303,-15.41913],[35.78799,-15.17428],[35.91812,-14.89514],[35.87212,-14.89478],[35.86945,-14.67481],[35.5299,-14.27714],[35.47989,-14.15594],[34.86229,-13.48958],[34.60253,-13.48487],[34.37831,-12.17408],[34.46088,-12.0174],[34.70739,-12.15652],[34.82903,-12.04837],[34.57917,-11.87849],[34.64241,-11.57499],[34.96296,-11.57354],[34.91153,-11.39799],[34.79375,-11.32245],[34.63305,-11.11731],[34.61161,-11.01611],[34.67047,-10.93796],[34.65946,-10.6828],[34.57581,-10.56271],[34.51911,-10.12279],[34.54499,-10.0678],[34.03865,-9.49398],[33.95829,-9.54066],[33.9638,-9.62206],[33.93298,-9.71647],[33.76677,-9.58516],[33.48052,-9.62442]]]]}},{type:"Feature",properties:{iso1A2:"MX",iso1A3:"MEX",iso1N3:"484",wikidata:"Q96",nameEn:"Mexico",groups:["013","003","419","019","UN"],callingCodes:["52"]},geometry:{type:"MultiPolygon",coordinates:[[[[-117.1243,32.53427],[-118.48109,32.5991],[-120.12904,18.41089],[-92.37213,14.39277],[-92.2261,14.53423],[-92.1454,14.6804],[-92.18161,14.84147],[-92.1423,14.88647],[-92.1454,14.98143],[-92.0621,15.07406],[-92.20983,15.26077],[-91.73182,16.07371],[-90.44567,16.07573],[-90.40499,16.40524],[-90.61212,16.49832],[-90.69064,16.70697],[-91.04436,16.92175],[-91.43809,17.25373],[-90.99199,17.25192],[-90.98678,17.81655],[-89.14985,17.81563],[-89.15105,17.95104],[-89.03839,18.0067],[-88.8716,17.89535],[-88.71505,18.0707],[-88.48242,18.49164],[-88.3268,18.49048],[-88.29909,18.47591],[-88.26593,18.47617],[-88.03238,18.41778],[-88.03165,18.16657],[-87.90671,18.15213],[-87.87604,18.18313],[-87.86657,18.19971],[-87.85693,18.18266],[-87.84815,18.18511],[-86.92368,17.61462],[-85.9092,21.8218],[-96.92418,25.97377],[-97.13927,25.96583],[-97.35946,25.92189],[-97.37332,25.83854],[-97.42511,25.83969],[-97.45669,25.86874],[-97.49828,25.89877],[-97.52025,25.88518],[-97.66511,26.01708],[-97.95155,26.0625],[-97.97017,26.05232],[-98.24603,26.07191],[-98.27075,26.09457],[-98.30491,26.10475],[-98.35126,26.15129],[-99.00546,26.3925],[-99.03053,26.41249],[-99.08477,26.39849],[-99.53573,27.30926],[-99.49744,27.43746],[-99.482,27.47128],[-99.48045,27.49016],[-99.50208,27.50021],[-99.52955,27.49747],[-99.51478,27.55836],[-99.55409,27.61314],[-100.50029,28.66117],[-100.51222,28.70679],[-100.5075,28.74066],[-100.52313,28.75598],[-100.59809,28.88197],[-100.63689,28.90812],[-100.67294,29.09744],[-100.79696,29.24688],[-100.87982,29.296],[-100.94056,29.33371],[-100.94579,29.34523],[-100.96725,29.3477],[-101.01128,29.36947],[-101.05686,29.44738],[-101.47277,29.7744],[-102.60596,29.8192],[-103.15787,28.93865],[-104.37752,29.54255],[-104.39363,29.55396],[-104.3969,29.57105],[-104.5171,29.64671],[-104.77674,30.4236],[-106.00363,31.39181],[-106.09025,31.40569],[-106.20346,31.46305],[-106.23711,31.51262],[-106.24612,31.54193],[-106.28084,31.56173],[-106.30305,31.62154],[-106.33419,31.66303],[-106.34864,31.69663],[-106.3718,31.71165],[-106.38003,31.73151],[-106.41773,31.75196],[-106.43419,31.75478],[-106.45244,31.76523],[-106.46726,31.75998],[-106.47298,31.75054],[-106.48815,31.74769],[-106.50111,31.75714],[-106.50962,31.76155],[-106.51251,31.76922],[-106.52266,31.77509],[-106.529,31.784],[-108.20899,31.78534],[-108.20979,31.33316],[-111.07523,31.33232],[-114.82011,32.49609],[-114.79524,32.55731],[-114.81141,32.55543],[-114.80584,32.62028],[-114.76736,32.64094],[-114.71871,32.71894],[-115.88053,32.63624],[-117.1243,32.53427]]]]}},{type:"Feature",properties:{iso1A2:"MY",iso1A3:"MYS",iso1N3:"458",wikidata:"Q833",nameEn:"Malaysia"},geometry:null},{type:"Feature",properties:{iso1A2:"MZ",iso1A3:"MOZ",iso1N3:"508",wikidata:"Q1029",nameEn:"Mozambique",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["258"]},geometry:{type:"MultiPolygon",coordinates:[[[[40.74206,-10.25691],[40.44265,-10.4618],[40.00295,-10.80255],[39.58249,-10.96043],[39.24395,-11.17433],[38.88996,-11.16978],[38.47258,-11.4199],[38.21598,-11.27289],[37.93618,-11.26228],[37.8388,-11.3123],[37.76614,-11.53352],[37.3936,-11.68949],[36.80309,-11.56836],[36.62068,-11.72884],[36.19094,-11.70008],[36.19094,-11.57593],[35.82767,-11.41081],[35.63599,-11.55927],[34.96296,-11.57354],[34.64241,-11.57499],[34.57917,-11.87849],[34.82903,-12.04837],[34.70739,-12.15652],[34.46088,-12.0174],[34.37831,-12.17408],[34.60253,-13.48487],[34.86229,-13.48958],[35.47989,-14.15594],[35.5299,-14.27714],[35.86945,-14.67481],[35.87212,-14.89478],[35.91812,-14.89514],[35.78799,-15.17428],[35.85303,-15.41913],[35.80487,-16.03907],[35.70107,-16.10147],[35.52365,-16.15414],[35.43355,-16.11371],[35.30157,-16.2211],[35.25828,-16.4792],[35.14235,-16.56812],[35.27219,-16.69402],[35.30929,-16.82871],[35.27065,-16.93817],[35.3062,-17.1244],[35.0923,-17.13235],[35.04805,-17.00027],[35.17017,-16.93521],[35.13771,-16.81687],[35.04805,-16.83167],[34.40344,-16.20923],[34.43126,-16.04737],[34.25195,-15.90321],[34.44981,-15.60864],[34.43126,-15.44778],[34.57503,-15.30619],[34.61522,-14.99583],[34.567,-14.77345],[34.54503,-14.74672],[34.52057,-14.68263],[34.53516,-14.67782],[34.55112,-14.64494],[34.53962,-14.59776],[34.52366,-14.5667],[34.49636,-14.55091],[34.48932,-14.53646],[34.47628,-14.53363],[34.45053,-14.49873],[34.44641,-14.47746],[34.4192,-14.43191],[34.39277,-14.39467],[34.35843,-14.38652],[34.34453,-14.3985],[34.22355,-14.43607],[34.18733,-14.43823],[34.08588,-14.48893],[33.92898,-14.47929],[33.88503,-14.51652],[33.7247,-14.4989],[33.66677,-14.61306],[33.24249,-14.00019],[30.22098,-14.99447],[30.41902,-15.62269],[30.42568,-15.9962],[30.91597,-15.99924],[30.97761,-16.05848],[31.13171,-15.98019],[31.30563,-16.01193],[31.42451,-16.15154],[31.67988,-16.19595],[31.90223,-16.34388],[31.91324,-16.41569],[32.02772,-16.43892],[32.28529,-16.43892],[32.42838,-16.4727],[32.71017,-16.59932],[32.69917,-16.66893],[32.78943,-16.70267],[32.97655,-16.70689],[32.91051,-16.89446],[32.84113,-16.92259],[32.96554,-17.11971],[33.00517,-17.30477],[33.0426,-17.3468],[32.96554,-17.48964],[32.98536,-17.55891],[33.0492,-17.60298],[32.94133,-17.99705],[33.03159,-18.35054],[33.02278,-18.4696],[32.88629,-18.51344],[32.88629,-18.58023],[32.95013,-18.69079],[32.9017,-18.7992],[32.82465,-18.77419],[32.70137,-18.84712],[32.73439,-18.92628],[32.69917,-18.94293],[32.72118,-19.02204],[32.84006,-19.0262],[32.87088,-19.09279],[32.85107,-19.29238],[32.77966,-19.36098],[32.78282,-19.47513],[32.84446,-19.48343],[32.84666,-19.68462],[32.95013,-19.67219],[33.06461,-19.77787],[33.01178,-20.02007],[32.93032,-20.03868],[32.85987,-20.16686],[32.85987,-20.27841],[32.66174,-20.56106],[32.55167,-20.56312],[32.48122,-20.63319],[32.51644,-20.91929],[32.37115,-21.133],[32.48236,-21.32873],[32.41234,-21.31246],[31.38336,-22.36919],[31.30611,-22.422],[31.55779,-23.176],[31.56539,-23.47268],[31.67942,-23.60858],[31.70223,-23.72695],[31.77445,-23.90082],[31.87707,-23.95293],[31.90368,-24.18892],[31.9835,-24.29983],[32.03196,-25.10785],[32.01676,-25.38117],[31.97875,-25.46356],[32.00631,-25.65044],[31.92649,-25.84216],[31.974,-25.95387],[32.00916,-25.999],[32.08599,-26.00978],[32.10435,-26.15656],[32.07352,-26.40185],[32.13409,-26.5317],[32.13315,-26.84345],[32.19409,-26.84032],[32.22302,-26.84136],[32.29584,-26.852],[32.35222,-26.86027],[34.51034,-26.91792],[42.99868,-12.65261],[40.74206,-10.25691]]]]}},{type:"Feature",properties:{iso1A2:"NA",iso1A3:"NAM",iso1N3:"516",wikidata:"Q1030",nameEn:"Namibia",groups:["018","202","002","UN"],driveSide:"left",callingCodes:["264"]},geometry:{type:"MultiPolygon",coordinates:[[[[14.28743,-17.38814],[13.95896,-17.43141],[13.36212,-16.98048],[12.97145,-16.98567],[12.52111,-17.24495],[12.07076,-17.15165],[11.75063,-17.25013],[10.5065,-17.25284],[12.51595,-32.27486],[16.45332,-28.63117],[16.46592,-28.57126],[16.59922,-28.53246],[16.90446,-28.057],[17.15405,-28.08573],[17.4579,-28.68718],[18.99885,-28.89165],[19.99882,-28.42622],[19.99817,-24.76768],[19.99912,-21.99991],[20.99751,-22.00026],[20.99904,-18.31743],[21.45556,-18.31795],[23.0996,-18.00075],[23.29618,-17.99855],[23.61088,-18.4881],[24.19416,-18.01919],[24.40577,-17.95726],[24.57485,-18.07151],[24.6303,-17.9863],[24.71887,-17.9218],[24.73364,-17.89338],[24.95586,-17.79674],[25.05895,-17.84452],[25.16882,-17.78253],[25.26433,-17.79571],[25.00198,-17.58221],[24.70864,-17.49501],[24.5621,-17.52963],[24.38712,-17.46818],[24.32811,-17.49082],[24.23619,-17.47489],[23.47474,-17.62877],[21.42741,-18.02787],[21.14283,-17.94318],[18.84226,-17.80375],[18.39229,-17.38927],[14.28743,-17.38814]]]]}},{type:"Feature",properties:{iso1A2:"NC",iso1A3:"NCL",iso1N3:"540",wikidata:"Q33788",nameEn:"New Caledonia",country:"FR",groups:["EU","Q1451600","054","009","UN"],callingCodes:["687"]},geometry:{type:"MultiPolygon",coordinates:[[[[159.77159,-28.41151],[174.245,-23.1974],[156.73836,-14.50464],[159.77159,-28.41151]]]]}},{type:"Feature",properties:{iso1A2:"NE",iso1A3:"NER",iso1N3:"562",wikidata:"Q1032",nameEn:"Niger",aliases:["RN"],groups:["011","202","002","UN"],callingCodes:["227"]},geometry:{type:"MultiPolygon",coordinates:[[[[14.22918,22.61719],[13.5631,23.16574],[11.96886,23.51735],[7.48273,20.87258],[7.38361,20.79165],[5.8153,19.45101],[4.26651,19.14224],[4.26762,17.00432],[4.21787,17.00118],[4.19893,16.39923],[3.50368,15.35934],[3.03134,15.42221],[3.01806,15.34571],[1.31275,15.27978],[.96711,14.98275],[.72632,14.95898],[.23859,15.00135],[.16936,14.51654],[.38051,14.05575],[.61924,13.68491],[.77377,13.6866],[.77637,13.64442],[.99514,13.5668],[1.02813,13.46635],[1.20088,13.38951],[1.24429,13.39373],[1.28509,13.35488],[1.24516,13.33968],[1.21217,13.37853],[1.18873,13.31771],[.99253,13.37515],[.99167,13.10727],[2.26349,12.41915],[2.05785,12.35539],[2.39723,11.89473],[2.45824,11.98672],[2.39657,12.10952],[2.37783,12.24804],[2.6593,12.30631],[2.83978,12.40585],[3.25352,12.01467],[3.31613,11.88495],[3.48187,11.86092],[3.59375,11.70269],[3.61075,11.69181],[3.67988,11.75429],[3.67122,11.80865],[3.63063,11.83042],[3.61955,11.91847],[3.67775,11.97599],[3.63136,12.11826],[3.66364,12.25884],[3.65111,12.52223],[3.94339,12.74979],[4.10006,12.98862],[4.14367,13.17189],[4.14186,13.47586],[4.23456,13.47725],[4.4668,13.68286],[4.87425,13.78],[4.9368,13.7345],[5.07396,13.75052],[5.21026,13.73627],[5.27797,13.75474],[5.35437,13.83567],[5.52957,13.8845],[6.15771,13.64564],[6.27411,13.67835],[6.43053,13.6006],[6.69617,13.34057],[6.94445,12.99825],[7.0521,13.00076],[7.12676,13.02445],[7.22399,13.1293],[7.39241,13.09717],[7.81085,13.34902],[8.07997,13.30847],[8.25185,13.20369],[8.41853,13.06166],[8.49493,13.07519],[8.60431,13.01768],[8.64251,12.93985],[8.97413,12.83661],[9.65995,12.80614],[10.00373,13.18171],[10.19993,13.27129],[10.46731,13.28819],[10.66004,13.36422],[11.4535,13.37773],[11.88236,13.2527],[12.04209,13.14452],[12.16189,13.10056],[12.19315,13.12423],[12.47095,13.06673],[12.58033,13.27805],[12.6793,13.29157],[12.87376,13.48919],[13.05085,13.53984],[13.19844,13.52802],[13.33213,13.71195],[13.6302,13.71094],[13.47559,14.40881],[13.48259,14.46704],[13.68573,14.55276],[13.67878,14.64013],[13.809,14.72915],[13.78991,14.87519],[13.86301,15.04043],[14.37425,15.72591],[15.50373,16.89649],[15.6032,18.77402],[15.75098,19.93002],[15.99632,20.35364],[15.6721,20.70069],[15.59841,20.74039],[15.56004,20.79488],[15.55382,20.86507],[15.57248,20.92138],[15.62515,20.95395],[15.28332,21.44557],[15.20213,21.49365],[15.19692,21.99339],[14.99751,23.00539],[14.22918,22.61719]]]]}},{type:"Feature",properties:{iso1A2:"NF",iso1A3:"NFK",iso1N3:"574",wikidata:"Q31057",nameEn:"Norfolk Island",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["672 3"]},geometry:{type:"MultiPolygon",coordinates:[[[[169.82316,-28.16667],[166.29505,-28.29175],[167.94076,-30.60745],[169.82316,-28.16667]]]]}},{type:"Feature",properties:{iso1A2:"NG",iso1A3:"NGA",iso1N3:"566",wikidata:"Q1033",nameEn:"Nigeria",groups:["011","202","002","UN"],callingCodes:["234"]},geometry:{type:"MultiPolygon",coordinates:[[[[6.15771,13.64564],[5.52957,13.8845],[5.35437,13.83567],[5.27797,13.75474],[5.21026,13.73627],[5.07396,13.75052],[4.9368,13.7345],[4.87425,13.78],[4.4668,13.68286],[4.23456,13.47725],[4.14186,13.47586],[4.14367,13.17189],[4.10006,12.98862],[3.94339,12.74979],[3.65111,12.52223],[3.66364,12.25884],[3.63136,12.11826],[3.67775,11.97599],[3.61955,11.91847],[3.63063,11.83042],[3.67122,11.80865],[3.67988,11.75429],[3.61075,11.69181],[3.59375,11.70269],[3.49175,11.29765],[3.71505,11.13015],[3.84243,10.59316],[3.78292,10.40538],[3.6844,10.46351],[3.57275,10.27185],[3.66908,10.18136],[3.54429,9.87739],[3.35383,9.83641],[3.32099,9.78032],[3.34726,9.70696],[3.25093,9.61632],[3.13928,9.47167],[3.14147,9.28375],[3.08017,9.10006],[2.77907,9.06924],[2.67523,7.87825],[2.73095,7.7755],[2.73405,7.5423],[2.78668,7.5116],[2.79442,7.43486],[2.74489,7.42565],[2.76965,7.13543],[2.71702,6.95722],[2.74024,6.92802],[2.73405,6.78508],[2.78823,6.76356],[2.78204,6.70514],[2.7325,6.64057],[2.74334,6.57291],[2.70464,6.50831],[2.70566,6.38038],[2.74181,6.13349],[5.87055,3.78489],[8.34397,4.30689],[8.60302,4.87353],[8.78027,5.1243],[8.92029,5.58403],[8.83687,5.68483],[8.88156,5.78857],[8.84209,5.82562],[9.51757,6.43874],[9.70674,6.51717],[9.77824,6.79088],[9.86314,6.77756],[10.15135,7.03781],[10.21466,6.88996],[10.53639,6.93432],[10.57214,7.16345],[10.59746,7.14719],[10.60789,7.06885],[10.83727,6.9358],[10.8179,6.83377],[10.94302,6.69325],[11.09644,6.68437],[11.09495,6.51717],[11.42041,6.53789],[11.42264,6.5882],[11.51499,6.60892],[11.57755,6.74059],[11.55818,6.86186],[11.63117,6.9905],[11.87396,7.09398],[11.84864,7.26098],[11.93205,7.47812],[12.01844,7.52981],[11.99908,7.67302],[12.20909,7.97553],[12.19271,8.10826],[12.24782,8.17904],[12.26123,8.43696],[12.4489,8.52536],[12.44146,8.6152],[12.68722,8.65938],[12.71701,8.7595],[12.79,8.75361],[12.81085,8.91992],[12.90022,9.11411],[12.91958,9.33905],[12.85628,9.36698],[13.02385,9.49334],[13.22642,9.57266],[13.25472,9.76795],[13.29941,9.8296],[13.25025,9.86042],[13.24132,9.91031],[13.27409,9.93232],[13.286,9.9822],[13.25323,10.00127],[13.25025,10.03647],[13.34111,10.12299],[13.43644,10.13326],[13.5705,10.53183],[13.54964,10.61236],[13.73434,10.9255],[13.70753,10.94451],[13.7403,11.00593],[13.78945,11.00154],[13.97489,11.30258],[14.17821,11.23831],[14.6124,11.51283],[14.64591,11.66166],[14.55207,11.72001],[14.61612,11.7798],[14.6474,12.17466],[14.4843,12.35223],[14.22215,12.36533],[14.17523,12.41916],[14.20204,12.53405],[14.08251,13.0797],[13.6302,13.71094],[13.33213,13.71195],[13.19844,13.52802],[13.05085,13.53984],[12.87376,13.48919],[12.6793,13.29157],[12.58033,13.27805],[12.47095,13.06673],[12.19315,13.12423],[12.16189,13.10056],[12.04209,13.14452],[11.88236,13.2527],[11.4535,13.37773],[10.66004,13.36422],[10.46731,13.28819],[10.19993,13.27129],[10.00373,13.18171],[9.65995,12.80614],[8.97413,12.83661],[8.64251,12.93985],[8.60431,13.01768],[8.49493,13.07519],[8.41853,13.06166],[8.25185,13.20369],[8.07997,13.30847],[7.81085,13.34902],[7.39241,13.09717],[7.22399,13.1293],[7.12676,13.02445],[7.0521,13.00076],[6.94445,12.99825],[6.69617,13.34057],[6.43053,13.6006],[6.27411,13.67835],[6.15771,13.64564]]]]}},{type:"Feature",properties:{iso1A2:"NI",iso1A3:"NIC",iso1N3:"558",wikidata:"Q811",nameEn:"Nicaragua",groups:["013","003","419","019","UN"],callingCodes:["505"]},geometry:{type:"MultiPolygon",coordinates:[[[[-83.13724,15.00002],[-83.49268,15.01158],[-83.62101,14.89448],[-83.89551,14.76697],[-84.10584,14.76353],[-84.48373,14.63249],[-84.70119,14.68078],[-84.82596,14.82212],[-84.90082,14.80489],[-85.1575,14.53934],[-85.18602,14.24929],[-85.32149,14.2562],[-85.45762,14.11304],[-85.73964,13.9698],[-85.75477,13.8499],[-86.03458,13.99181],[-86.00685,14.08474],[-86.14801,14.04317],[-86.35219,13.77157],[-86.76812,13.79605],[-86.71267,13.30348],[-86.87066,13.30641],[-86.93383,13.18677],[-86.93197,13.05313],[-87.03785,12.98682],[-87.06306,13.00892],[-87.37107,12.98646],[-87.55124,13.12523],[-87.7346,13.13228],[-88.11443,12.63306],[-86.14524,11.09059],[-85.71223,11.06868],[-85.60529,11.22607],[-84.92439,10.9497],[-84.68197,11.07568],[-83.90838,10.71161],[-83.66597,10.79916],[-83.68276,11.01562],[-82.56142,11.91792],[-82.06974,14.49418],[-83.04763,15.03256],[-83.13724,15.00002]]]]}},{type:"Feature",properties:{iso1A2:"NL",iso1A3:"NLD",iso1N3:"528",wikidata:"Q29999",nameEn:"Kingdom of the Netherlands"},geometry:null},{type:"Feature",properties:{iso1A2:"NO",iso1A3:"NOR",iso1N3:"578",wikidata:"Q20",nameEn:"Norway"},geometry:null},{type:"Feature",properties:{iso1A2:"NP",iso1A3:"NPL",iso1N3:"524",wikidata:"Q837",nameEn:"Nepal",groups:["034","142","UN"],driveSide:"left",callingCodes:["977"]},geometry:{type:"MultiPolygon",coordinates:[[[[88.13378,27.88015],[87.82681,27.95248],[87.72718,27.80938],[87.56996,27.84517],[87.11696,27.84104],[87.03757,27.94835],[86.75582,28.04182],[86.74181,28.10638],[86.56265,28.09569],[86.51609,27.96623],[86.42736,27.91122],[86.22966,27.9786],[86.18607,28.17364],[86.088,28.09264],[86.08333,28.02121],[86.12069,27.93047],[86.06309,27.90021],[85.94946,27.9401],[85.97813,27.99023],[85.90743,28.05144],[85.84672,28.18187],[85.74864,28.23126],[85.71907,28.38064],[85.69105,28.38475],[85.60854,28.25045],[85.59765,28.30529],[85.4233,28.32996],[85.38127,28.28336],[85.10729,28.34092],[85.18668,28.54076],[85.19135,28.62825],[85.06059,28.68562],[84.85511,28.58041],[84.62317,28.73887],[84.47528,28.74023],[84.2231,28.89571],[84.24801,29.02783],[84.18107,29.23451],[83.97559,29.33091],[83.82303,29.30513],[83.63156,29.16249],[83.44787,29.30513],[83.28131,29.56813],[83.07116,29.61957],[82.73024,29.81695],[82.5341,29.9735],[82.38622,30.02608],[82.16984,30.0692],[82.19475,30.16884],[82.10757,30.23745],[82.10135,30.35439],[81.99082,30.33423],[81.62033,30.44703],[81.5459,30.37688],[81.41018,30.42153],[81.39928,30.21862],[81.33355,30.15303],[81.2623,30.14596],[81.29032,30.08806],[81.24362,30.0126],[81.12842,30.01395],[81.03953,30.20059],[80.92547,30.17193],[80.91143,30.22173],[80.86673,30.17321],[80.8778,30.13384],[80.67076,29.95732],[80.60226,29.95732],[80.57179,29.91422],[80.56247,29.86661],[80.48997,29.79566],[80.43458,29.80466],[80.41554,29.79451],[80.36803,29.73865],[80.38428,29.68513],[80.41858,29.63581],[80.37939,29.57098],[80.24322,29.44299],[80.31428,29.30784],[80.28626,29.20327],[80.24112,29.21414],[80.26602,29.13938],[80.23178,29.11626],[80.18085,29.13649],[80.05743,28.91479],[80.06957,28.82763],[80.12125,28.82346],[80.37188,28.63371],[80.44504,28.63098],[80.52443,28.54897],[80.50575,28.6706],[80.55142,28.69182],[81.03471,28.40054],[81.19847,28.36284],[81.32923,28.13521],[81.38683,28.17638],[81.48179,28.12148],[81.47867,28.08303],[81.91223,27.84995],[81.97214,27.93322],[82.06554,27.92222],[82.46405,27.6716],[82.70378,27.72122],[82.74119,27.49838],[82.93261,27.50328],[82.94938,27.46036],[83.19413,27.45632],[83.27197,27.38309],[83.2673,27.36235],[83.29999,27.32778],[83.35136,27.33885],[83.38872,27.39276],[83.39495,27.4798],[83.61288,27.47013],[83.85595,27.35797],[83.86182,27.4241],[83.93306,27.44939],[84.02229,27.43836],[84.10791,27.52399],[84.21376,27.45218],[84.25735,27.44941],[84.29315,27.39],[84.62161,27.33885],[84.69166,27.21294],[84.64496,27.04669],[84.793,26.9968],[84.82913,27.01989],[84.85754,26.98984],[84.96687,26.95599],[84.97186,26.9149],[85.00536,26.89523],[85.05592,26.88991],[85.02635,26.85381],[85.15883,26.86966],[85.19291,26.86909],[85.18046,26.80519],[85.21159,26.75933],[85.34302,26.74954],[85.47752,26.79292],[85.56471,26.84133],[85.5757,26.85955],[85.59461,26.85161],[85.61621,26.86721],[85.66239,26.84822],[85.73483,26.79613],[85.72315,26.67471],[85.76907,26.63076],[85.83126,26.61134],[85.85126,26.60866],[85.8492,26.56667],[86.02729,26.66756],[86.13596,26.60651],[86.22513,26.58863],[86.26235,26.61886],[86.31564,26.61925],[86.49726,26.54218],[86.54258,26.53819],[86.57073,26.49825],[86.61313,26.48658],[86.62686,26.46891],[86.69124,26.45169],[86.74025,26.42386],[86.76797,26.45892],[86.82898,26.43919],[86.94543,26.52076],[86.95912,26.52076],[87.01559,26.53228],[87.04691,26.58685],[87.0707,26.58571],[87.09147,26.45039],[87.14751,26.40542],[87.18863,26.40558],[87.24682,26.4143],[87.26587,26.40592],[87.26568,26.37294],[87.34568,26.34787],[87.37314,26.40815],[87.46566,26.44058],[87.51571,26.43106],[87.55274,26.40596],[87.59175,26.38342],[87.66803,26.40294],[87.67893,26.43501],[87.76004,26.40711],[87.7918,26.46737],[87.84193,26.43663],[87.89085,26.48565],[87.90115,26.44923],[88.00895,26.36029],[88.09414,26.43732],[88.09963,26.54195],[88.16452,26.64111],[88.1659,26.68177],[88.19107,26.75516],[88.12302,26.95324],[88.13422,26.98705],[88.11719,26.98758],[87.9887,27.11045],[88.01587,27.21388],[88.01646,27.21612],[88.07277,27.43007],[88.04008,27.49223],[88.19107,27.79285],[88.1973,27.85067],[88.13378,27.88015]]]]}},{type:"Feature",properties:{iso1A2:"NR",iso1A3:"NRU",iso1N3:"520",wikidata:"Q697",nameEn:"Nauru",groups:["057","009","UN"],driveSide:"left",callingCodes:["674"]},geometry:{type:"MultiPolygon",coordinates:[[[[166.95155,.14829],[166.21778,-.7977],[167.60042,-.88259],[166.95155,.14829]]]]}},{type:"Feature",properties:{iso1A2:"NU",iso1A3:"NIU",iso1N3:"570",wikidata:"Q34020",nameEn:"Niue",country:"NZ",groups:["061","009","UN"],driveSide:"left",callingCodes:["683"]},geometry:{type:"MultiPolygon",coordinates:[[[[-170.83899,-18.53439],[-170.82274,-20.44429],[-168.63096,-18.60489],[-170.83899,-18.53439]]]]}},{type:"Feature",properties:{iso1A2:"NZ",iso1A3:"NZL",iso1N3:"554",wikidata:"Q664",nameEn:"New Zealand"},geometry:null},{type:"Feature",properties:{iso1A2:"OM",iso1A3:"OMN",iso1N3:"512",wikidata:"Q842",nameEn:"Oman",groups:["145","142","UN"],callingCodes:["968"]},geometry:{type:"MultiPolygon",coordinates:[[[[56.82555,25.7713],[56.79239,26.41236],[56.68954,26.76645],[56.2644,26.58649],[55.81777,26.18798],[56.08666,26.05038],[56.15498,26.06828],[56.19334,25.9795],[56.13963,25.82765],[56.17416,25.77239],[56.13579,25.73524],[56.14826,25.66351],[56.18363,25.65508],[56.20473,25.61119],[56.25365,25.60211],[56.26636,25.60643],[56.25341,25.61443],[56.26534,25.62825],[56.82555,25.7713]]],[[[56.26062,25.33108],[56.23362,25.31253],[56.25008,25.28843],[56.24465,25.27505],[56.20838,25.25668],[56.20872,25.24104],[56.24341,25.22867],[56.27628,25.23404],[56.34438,25.26653],[56.35172,25.30681],[56.3111,25.30107],[56.3005,25.31815],[56.26062,25.33108]],[[56.28423,25.26344],[56.27086,25.26128],[56.2716,25.27916],[56.28102,25.28486],[56.29379,25.2754],[56.28423,25.26344]]],[[[61.45114,22.55394],[56.86325,25.03856],[56.3227,24.97284],[56.34873,24.93205],[56.30269,24.88334],[56.20568,24.85063],[56.20062,24.78565],[56.13684,24.73699],[56.06128,24.74457],[56.03535,24.81161],[55.97836,24.87673],[55.97467,24.89639],[56.05106,24.87461],[56.05715,24.95727],[55.96316,25.00857],[55.90849,24.96771],[55.85094,24.96858],[55.81116,24.9116],[55.81348,24.80102],[55.83408,24.77858],[55.83271,24.68567],[55.76461,24.5287],[55.83271,24.41521],[55.83395,24.32776],[55.80747,24.31069],[55.79145,24.27914],[55.76781,24.26209],[55.75939,24.26114],[55.75382,24.2466],[55.75257,24.23466],[55.76558,24.23227],[55.77658,24.23476],[55.83367,24.20193],[55.95472,24.2172],[56.01799,24.07426],[55.8308,24.01633],[55.73301,24.05994],[55.48677,23.94946],[55.57358,23.669],[55.22634,23.10378],[55.2137,22.71065],[55.66469,21.99658],[54.99756,20.00083],[52.00311,19.00083],[52.78009,17.35124],[52.74267,17.29519],[52.81185,17.28568],[57.49095,8.14549],[61.45114,22.55394]]]]}},{type:"Feature",properties:{iso1A2:"PA",iso1A3:"PAN",iso1N3:"591",wikidata:"Q804",nameEn:"Panama",groups:["013","003","419","019","UN"],callingCodes:["507"]},geometry:{type:"MultiPolygon",coordinates:[[[[-77.32389,8.81247],[-77.58292,9.22278],[-78.79327,9.93766],[-82.51044,9.65379],[-82.56507,9.57279],[-82.61345,9.49881],[-82.66667,9.49746],[-82.77206,9.59573],[-82.87919,9.62645],[-82.84871,9.4973],[-82.93516,9.46741],[-82.93516,9.07687],[-82.72126,8.97125],[-82.88253,8.83331],[-82.91377,8.774],[-82.92068,8.74832],[-82.8794,8.6981],[-82.82739,8.60153],[-82.83975,8.54755],[-82.83322,8.52464],[-82.8382,8.48117],[-82.8679,8.44042],[-82.93056,8.43465],[-83.05209,8.33394],[-82.9388,8.26634],[-82.88641,8.10219],[-82.89137,8.05755],[-82.89978,8.04083],[-82.94503,7.93865],[-82.13751,6.97312],[-78.06168,7.07793],[-77.89178,7.22681],[-77.81426,7.48319],[-77.72157,7.47612],[-77.72514,7.72348],[-77.57185,7.51147],[-77.17257,7.97422],[-77.45064,8.49991],[-77.32389,8.81247]]]]}},{type:"Feature",properties:{iso1A2:"PE",iso1A3:"PER",iso1N3:"604",wikidata:"Q419",nameEn:"Peru",groups:["005","419","019","UN"],callingCodes:["51"]},geometry:{type:"MultiPolygon",coordinates:[[[[-74.26675,-.97229],[-74.42701,-.50218],[-75.18513,-.0308],[-75.25764,-.11943],[-75.40192,-.17196],[-75.61997,-.10012],[-75.60169,-.18708],[-75.53615,-.19213],[-75.22862,-.60048],[-75.22862,-.95588],[-75.3872,-.9374],[-75.57429,-1.55961],[-76.05203,-2.12179],[-76.6324,-2.58397],[-77.94147,-3.05454],[-78.19369,-3.36431],[-78.14324,-3.47653],[-78.22642,-3.51113],[-78.24589,-3.39907],[-78.34362,-3.38633],[-78.68394,-4.60754],[-78.85149,-4.66795],[-79.01659,-5.01481],[-79.1162,-4.97774],[-79.26248,-4.95167],[-79.59402,-4.46848],[-79.79722,-4.47558],[-80.13945,-4.29786],[-80.39256,-4.48269],[-80.46386,-4.41516],[-80.32114,-4.21323],[-80.45023,-4.20938],[-80.4822,-4.05477],[-80.46386,-4.01342],[-80.13232,-3.90317],[-80.19926,-3.68894],[-80.18741,-3.63994],[-80.19848,-3.59249],[-80.21642,-3.5888],[-80.20535,-3.51667],[-80.22629,-3.501],[-80.23651,-3.48652],[-80.24586,-3.48677],[-80.24123,-3.46124],[-80.20647,-3.431],[-80.30602,-3.39149],[-84.52388,-3.36941],[-85.71054,-21.15413],[-70.59118,-18.35072],[-70.378,-18.3495],[-70.31267,-18.31258],[-70.16394,-18.31737],[-69.96732,-18.25992],[-69.81607,-18.12582],[-69.75305,-17.94605],[-69.82868,-17.72048],[-69.79087,-17.65563],[-69.66483,-17.65083],[-69.46897,-17.4988],[-69.46863,-17.37466],[-69.62883,-17.28142],[-69.16896,-16.72233],[-69.00853,-16.66769],[-69.04027,-16.57214],[-68.98358,-16.42165],[-68.79464,-16.33272],[-68.96238,-16.194],[-69.09986,-16.22693],[-69.20291,-16.16668],[-69.40336,-15.61358],[-69.14856,-15.23478],[-69.36254,-14.94634],[-68.88135,-14.18639],[-69.05265,-13.68546],[-68.8864,-13.40792],[-68.85615,-12.87769],[-68.65044,-12.50689],[-68.98115,-11.8979],[-69.57156,-10.94555],[-69.57835,-10.94051],[-69.90896,-10.92744],[-70.38791,-11.07096],[-70.51395,-10.92249],[-70.64134,-11.0108],[-70.62487,-9.80666],[-70.55429,-9.76692],[-70.58453,-9.58303],[-70.53373,-9.42628],[-71.23394,-9.9668],[-72.14742,-9.98049],[-72.31883,-9.5184],[-72.72216,-9.41397],[-73.21498,-9.40904],[-72.92886,-9.04074],[-73.76576,-7.89884],[-73.65485,-7.77897],[-73.96938,-7.58465],[-73.77011,-7.28944],[-73.73986,-6.87919],[-73.12983,-6.43852],[-73.24579,-6.05764],[-72.83973,-5.14765],[-72.64391,-5.0391],[-71.87003,-4.51661],[-70.96814,-4.36915],[-70.77601,-4.15717],[-70.33236,-4.15214],[-70.19582,-4.3607],[-70.11305,-4.27281],[-70.00888,-4.37833],[-69.94708,-4.2431],[-70.3374,-3.79505],[-70.52393,-3.87553],[-70.71396,-3.7921],[-70.04609,-2.73906],[-70.94377,-2.23142],[-71.75223,-2.15058],[-72.92587,-2.44514],[-73.65312,-1.26222],[-74.26675,-.97229]]]]}},{type:"Feature",properties:{iso1A2:"PF",iso1A3:"PYF",iso1N3:"258",wikidata:"Q30971",nameEn:"French Polynesia",country:"FR",groups:["EU","Q1451600","061","009","UN"],callingCodes:["689"]},geometry:{type:"MultiPolygon",coordinates:[[[[-135.59706,-4.70473],[-156.48634,-15.52824],[-156.45576,-31.75456],[-133.59543,-28.4709],[-135.59706,-4.70473]]]]}},{type:"Feature",properties:{iso1A2:"PG",iso1A3:"PNG",iso1N3:"598",wikidata:"Q691",nameEn:"Papua New Guinea",groups:["054","009","UN"],driveSide:"left",callingCodes:["675"]},geometry:{type:"MultiPolygon",coordinates:[[[[141.03157,2.12829],[140.99813,-6.3233],[140.85295,-6.72996],[140.90448,-6.85033],[141.01763,-6.90181],[141.01842,-9.35091],[141.88934,-9.36111],[142.19246,-9.15378],[142.48658,-9.36754],[143.29772,-9.33993],[143.87386,-9.02382],[145.2855,-9.62524],[156.73836,-14.50464],[154.74815,-7.33315],[155.60735,-6.92266],[155.69784,-6.92661],[155.92557,-6.84664],[156.03993,-6.65703],[156.03296,-6.55528],[160.43769,-4.17974],[141.03157,2.12829]]]]}},{type:"Feature",properties:{iso1A2:"PH",iso1A3:"PHL",iso1N3:"608",wikidata:"Q928",nameEn:"Philippines",aliases:["PI","RP"],groups:["035","142","UN"],callingCodes:["63"]},geometry:{type:"MultiPolygon",coordinates:[[[[129.19694,7.84182],[121.8109,21.77688],[120.69238,21.52331],[118.82252,14.67191],[115.39742,10.92666],[116.79524,7.43869],[117.17735,7.52841],[117.93857,6.89845],[117.98544,6.27477],[119.52945,5.35672],[118.93936,4.09009],[118.06469,4.16638],[121.14448,2.12444],[129.19694,7.84182]]]]}},{type:"Feature",properties:{iso1A2:"PK",iso1A3:"PAK",iso1N3:"586",wikidata:"Q843",nameEn:"Pakistan",groups:["034","142","UN"],driveSide:"left",callingCodes:["92"]},geometry:{type:"MultiPolygon",coordinates:[[[[75.72737,36.7529],[75.45562,36.71971],[75.40481,36.95382],[75.13839,37.02622],[74.56453,37.03023],[74.53739,36.96224],[74.43389,37.00977],[74.04856,36.82648],[73.82685,36.91421],[72.6323,36.84601],[72.18135,36.71838],[71.80267,36.49924],[71.60491,36.39429],[71.19505,36.04134],[71.37969,35.95865],[71.55273,35.71483],[71.49917,35.6267],[71.65435,35.4479],[71.54294,35.31037],[71.5541,35.28776],[71.67495,35.21262],[71.52938,35.09023],[71.55273,35.02615],[71.49917,35.00478],[71.50329,34.97328],[71.29472,34.87728],[71.28356,34.80882],[71.08718,34.69034],[71.11602,34.63047],[71.0089,34.54568],[71.02401,34.44835],[71.17662,34.36769],[71.12815,34.26619],[71.13078,34.16503],[71.09453,34.13524],[71.09307,34.11961],[71.06933,34.10564],[71.07345,34.06242],[70.88119,33.97933],[70.54336,33.9463],[69.90203,34.04194],[69.87307,33.9689],[69.85671,33.93719],[70.00503,33.73528],[70.14236,33.71701],[70.14785,33.6553],[70.20141,33.64387],[70.17062,33.53535],[70.32775,33.34496],[70.13686,33.21064],[70.07369,33.22557],[70.02563,33.14282],[69.85259,33.09451],[69.79766,33.13247],[69.71526,33.09911],[69.57656,33.09911],[69.49004,33.01509],[69.49854,32.88843],[69.5436,32.8768],[69.47082,32.85834],[69.38018,32.76601],[69.43649,32.7302],[69.44747,32.6678],[69.38155,32.56601],[69.2868,32.53938],[69.23599,32.45946],[69.27932,32.29119],[69.27032,32.14141],[69.3225,31.93186],[69.20577,31.85957],[69.11514,31.70782],[69.00939,31.62249],[68.95995,31.64822],[68.91078,31.59687],[68.79997,31.61665],[68.6956,31.75687],[68.57475,31.83158],[68.44222,31.76446],[68.27605,31.75863],[68.25614,31.80357],[68.1655,31.82691],[68.00071,31.6564],[67.86887,31.63536],[67.72056,31.52304],[67.58323,31.52772],[67.62374,31.40473],[67.7748,31.4188],[67.78854,31.33203],[67.29964,31.19586],[67.03323,31.24519],[67.04147,31.31561],[66.83273,31.26867],[66.72561,31.20526],[66.68166,31.07597],[66.58175,30.97532],[66.42645,30.95309],[66.39194,30.9408],[66.28413,30.57001],[66.34869,30.404],[66.23609,30.06321],[66.36042,29.9583],[66.24175,29.85181],[65.04005,29.53957],[64.62116,29.58903],[64.19796,29.50407],[64.12966,29.39157],[63.5876,29.50456],[62.47751,29.40782],[60.87231,29.86514],[61.31508,29.38903],[61.53765,29.00507],[61.65978,28.77937],[61.93581,28.55284],[62.40259,28.42703],[62.59499,28.24842],[62.79412,28.28108],[62.7638,28.02992],[62.84905,27.47627],[62.79684,27.34381],[62.80604,27.22412],[63.19649,27.25674],[63.32283,27.14437],[63.25005,27.08692],[63.25005,26.84212],[63.18688,26.83844],[63.1889,26.65072],[62.77352,26.64099],[62.31484,26.528],[62.21304,26.26601],[62.05117,26.31647],[61.89391,26.26251],[61.83831,26.07249],[61.83968,25.7538],[61.683,25.66638],[61.6433,25.27541],[61.46682,24.57869],[68.11329,23.53945],[68.20763,23.85849],[68.39339,23.96838],[68.74643,23.97027],[68.7416,24.31904],[68.90914,24.33156],[68.97781,24.26021],[69.07806,24.29777],[69.19341,24.25646],[69.29778,24.28712],[69.59579,24.29777],[69.73335,24.17007],[70.03428,24.172],[70.11712,24.30915],[70.5667,24.43787],[70.57906,24.27774],[70.71502,24.23517],[70.88393,24.27398],[70.85784,24.30903],[70.94985,24.3791],[71.04461,24.34657],[71.12838,24.42662],[71.00341,24.46038],[70.97594,24.60904],[71.09405,24.69017],[70.94002,24.92843],[70.89148,25.15064],[70.66695,25.39314],[70.67382,25.68186],[70.60378,25.71898],[70.53649,25.68928],[70.37444,25.67443],[70.2687,25.71156],[70.0985,25.93238],[70.08193,26.08094],[70.17532,26.24118],[70.17532,26.55362],[70.05584,26.60398],[69.88555,26.56836],[69.50904,26.74892],[69.58519,27.18109],[70.03136,27.56627],[70.12502,27.8057],[70.37307,28.01208],[70.60927,28.02178],[70.79054,27.68423],[71.89921,27.96035],[71.9244,28.11555],[72.20329,28.3869],[72.29495,28.66367],[72.40402,28.78283],[72.94272,29.02487],[73.01337,29.16422],[73.05886,29.1878],[73.28094,29.56646],[73.3962,29.94707],[73.58665,30.01848],[73.80299,30.06969],[73.97225,30.19829],[73.95736,30.28466],[73.88993,30.36305],[74.5616,31.04153],[74.67971,31.05479],[74.6852,31.12771],[74.60006,31.13711],[74.60281,31.10419],[74.56023,31.08303],[74.51629,31.13829],[74.53223,31.30321],[74.59773,31.4136],[74.64713,31.45605],[74.59319,31.50197],[74.61517,31.55698],[74.57498,31.60382],[74.47771,31.72227],[74.58907,31.87824],[74.79919,31.95983],[74.86236,32.04485],[74.9269,32.0658],[75.00793,32.03786],[75.25649,32.10187],[75.38046,32.26836],[75.28259,32.36556],[75.03265,32.49538],[74.97634,32.45367],[74.84725,32.49075],[74.68362,32.49298],[74.67431,32.56676],[74.65251,32.56416],[74.64424,32.60985],[74.69542,32.66792],[74.65345,32.71225],[74.7113,32.84219],[74.64675,32.82604],[74.6289,32.75561],[74.45312,32.77755],[74.41467,32.90563],[74.31227,32.92795],[74.34875,32.97823],[74.31854,33.02891],[74.17571,33.07495],[74.15374,33.13477],[74.02144,33.18908],[74.01366,33.25199],[74.08782,33.26232],[74.17983,33.3679],[74.18121,33.4745],[74.10115,33.56392],[74.03576,33.56718],[73.97367,33.64061],[73.98968,33.66155],[73.96423,33.73071],[74.00891,33.75437],[74.05898,33.82089],[74.14001,33.83002],[74.26086,33.92237],[74.25262,34.01577],[74.21554,34.03853],[73.91341,34.01235],[73.88732,34.05105],[73.90677,34.10504],[73.98208,34.2522],[73.90517,34.35317],[73.8475,34.32935],[73.74862,34.34183],[73.74999,34.3781],[73.88732,34.48911],[73.89419,34.54568],[73.93951,34.57169],[73.93401,34.63386],[73.96423,34.68244],[74.12897,34.70073],[74.31239,34.79626],[74.58083,34.77386],[74.6663,34.703],[75.01479,34.64629],[75.38009,34.55021],[75.75438,34.51827],[76.04614,34.67566],[76.15463,34.6429],[76.47186,34.78965],[76.67648,34.76371],[76.74377,34.84039],[76.74514,34.92488],[76.87193,34.96906],[76.99251,34.93349],[77.11796,35.05419],[76.93465,35.39866],[76.85088,35.39754],[76.75475,35.52617],[76.77323,35.66062],[76.50961,35.8908],[76.33453,35.84296],[76.14913,35.82848],[76.15325,35.9264],[75.93028,36.13136],[76.00906,36.17511],[76.0324,36.41198],[75.92391,36.56986],[75.72737,36.7529]]]]}},{type:"Feature",properties:{iso1A2:"PL",iso1A3:"POL",iso1N3:"616",wikidata:"Q36",nameEn:"Poland",groups:["EU","151","150","UN"],callingCodes:["48"]},geometry:{type:"MultiPolygon",coordinates:[[[[18.57853,55.25302],[14.20811,54.12784],[14.22634,53.9291],[14.20647,53.91671],[14.18544,53.91258],[14.20823,53.90776],[14.21323,53.8664],[14.27249,53.74464],[14.26782,53.69866],[14.2836,53.67721],[14.27133,53.66613],[14.28477,53.65955],[14.2853,53.63392],[14.31904,53.61581],[14.30416,53.55499],[14.3273,53.50587],[14.35209,53.49506],[14.4215,53.27724],[14.44133,53.27427],[14.45125,53.26241],[14.40662,53.21098],[14.37853,53.20405],[14.36696,53.16444],[14.38679,53.13669],[14.35044,53.05829],[14.25954,53.00264],[14.14056,52.95786],[14.15873,52.87715],[14.12256,52.84311],[14.13806,52.82392],[14.22071,52.81175],[14.61073,52.59847],[14.6289,52.57136],[14.60081,52.53116],[14.63056,52.48993],[14.54423,52.42568],[14.55228,52.35264],[14.56378,52.33838],[14.58149,52.28007],[14.70139,52.25038],[14.71319,52.22144],[14.68344,52.19612],[14.70616,52.16927],[14.67683,52.13936],[14.6917,52.10283],[14.72971,52.09167],[14.76026,52.06624],[14.71339,52.00337],[14.70488,51.97679],[14.7139,51.95643],[14.71836,51.95606],[14.72163,51.95188],[14.7177,51.94048],[14.70601,51.92944],[14.6933,51.9044],[14.6588,51.88359],[14.59089,51.83302],[14.60493,51.80473],[14.64625,51.79472],[14.66386,51.73282],[14.69065,51.70842],[14.75392,51.67445],[14.75759,51.62318],[14.7727,51.61263],[14.71125,51.56209],[14.73047,51.54606],[14.72652,51.53902],[14.73219,51.52922],[14.94749,51.47155],[14.9652,51.44793],[14.96899,51.38367],[14.98008,51.33449],[15.04288,51.28387],[15.01242,51.21285],[15.0047,51.16874],[14.99311,51.16249],[14.99414,51.15813],[15.00083,51.14974],[14.99646,51.14365],[14.99079,51.14284],[14.99689,51.12205],[14.98229,51.11354],[14.97938,51.07742],[14.95529,51.04552],[14.92942,50.99744],[14.89252,50.94999],[14.89681,50.9422],[14.81664,50.88148],[14.82803,50.86966],[14.99852,50.86817],[15.01088,50.97984],[14.96419,50.99108],[15.02433,51.0242],[15.03895,51.0123],[15.06218,51.02269],[15.10152,51.01095],[15.11937,50.99021],[15.16744,51.01959],[15.1743,50.9833],[15.2361,50.99886],[15.27043,50.97724],[15.2773,50.8907],[15.36656,50.83956],[15.3803,50.77187],[15.43798,50.80833],[15.73186,50.73885],[15.81683,50.75666],[15.87331,50.67188],[15.97219,50.69799],[16.0175,50.63009],[15.98317,50.61528],[16.02437,50.60046],[16.10265,50.66405],[16.20839,50.63096],[16.23174,50.67101],[16.33611,50.66579],[16.44597,50.58041],[16.34572,50.49575],[16.31413,50.50274],[16.19526,50.43291],[16.21585,50.40627],[16.22821,50.41054],[16.28118,50.36891],[16.30289,50.38292],[16.36495,50.37679],[16.3622,50.34875],[16.39379,50.3207],[16.42674,50.32509],[16.56407,50.21009],[16.55446,50.16613],[16.63137,50.1142],[16.7014,50.09659],[16.8456,50.20834],[16.98018,50.24172],[17.00353,50.21449],[17.02825,50.23118],[16.99803,50.25753],[17.02138,50.27772],[16.99803,50.30316],[16.94448,50.31281],[16.90877,50.38642],[16.85933,50.41093],[16.89229,50.45117],[17.1224,50.39494],[17.14498,50.38117],[17.19579,50.38817],[17.19991,50.3654],[17.27681,50.32246],[17.34273,50.32947],[17.34548,50.2628],[17.3702,50.28123],[17.58889,50.27837],[17.67764,50.28977],[17.69292,50.32859],[17.74648,50.29966],[17.72176,50.25665],[17.76296,50.23382],[17.70528,50.18812],[17.59404,50.16437],[17.66683,50.10275],[17.6888,50.12037],[17.7506,50.07896],[17.77669,50.02253],[17.86886,49.97452],[18.00191,50.01723],[18.04585,50.01194],[18.04585,50.03311],[18.00396,50.04954],[18.03212,50.06574],[18.07898,50.04535],[18.10628,50.00223],[18.20241,49.99958],[18.21752,49.97309],[18.27107,49.96779],[18.27794,49.93863],[18.31914,49.91565],[18.33278,49.92415],[18.33562,49.94747],[18.41604,49.93498],[18.53423,49.89906],[18.54495,49.9079],[18.54299,49.92537],[18.57697,49.91565],[18.57045,49.87849],[18.60341,49.86256],[18.57183,49.83334],[18.61278,49.7618],[18.61368,49.75426],[18.62645,49.75002],[18.62943,49.74603],[18.62676,49.71983],[18.69817,49.70473],[18.72838,49.68163],[18.80479,49.6815],[18.84786,49.5446],[18.84521,49.51672],[18.94536,49.52143],[18.97283,49.49914],[18.9742,49.39557],[19.18019,49.41165],[19.25435,49.53391],[19.36009,49.53747],[19.37795,49.574],[19.45348,49.61583],[19.52626,49.57311],[19.53313,49.52856],[19.57845,49.46077],[19.64162,49.45184],[19.6375,49.40897],[19.72127,49.39288],[19.78581,49.41701],[19.82237,49.27806],[19.75286,49.20751],[19.86409,49.19316],[19.90529,49.23532],[19.98494,49.22904],[20.08238,49.1813],[20.13738,49.31685],[20.21977,49.35265],[20.31453,49.34817],[20.31728,49.39914],[20.39939,49.3896],[20.46422,49.41612],[20.5631,49.375],[20.61666,49.41791],[20.72274,49.41813],[20.77971,49.35383],[20.9229,49.29626],[20.98733,49.30774],[21.09799,49.37176],[21.041,49.41791],[21.12477,49.43666],[21.19756,49.4054],[21.27858,49.45988],[21.43376,49.41433],[21.62328,49.4447],[21.77983,49.35443],[21.82927,49.39467],[21.96385,49.3437],[22.04427,49.22136],[22.56155,49.08865],[22.89122,49.00725],[22.86336,49.10513],[22.72009,49.20288],[22.748,49.32759],[22.69444,49.49378],[22.64534,49.53094],[22.78304,49.65543],[22.80261,49.69098],[22.83179,49.69875],[22.99329,49.84249],[23.28221,50.0957],[23.67635,50.33385],[23.71382,50.38248],[23.79445,50.40481],[23.99563,50.41289],[24.03668,50.44507],[24.07048,50.5071],[24.0996,50.60752],[24.0595,50.71625],[23.95925,50.79271],[23.99254,50.83847],[24.0952,50.83262],[24.14524,50.86128],[24.04576,50.90196],[23.92217,51.00836],[23.90376,51.07697],[23.80678,51.18405],[23.63858,51.32182],[23.69905,51.40871],[23.62751,51.50512],[23.56236,51.53673],[23.57053,51.55938],[23.53198,51.74298],[23.62691,51.78208],[23.61523,51.92066],[23.68733,51.9906],[23.64066,52.07626],[23.61,52.11264],[23.54314,52.12148],[23.47859,52.18215],[23.20071,52.22848],[23.18196,52.28812],[23.34141,52.44845],[23.45112,52.53774],[23.58296,52.59868],[23.73615,52.6149],[23.93763,52.71332],[23.91805,52.94016],[23.94689,52.95919],[23.92184,53.02079],[23.87548,53.0831],[23.91393,53.16469],[23.85657,53.22923],[23.81995,53.24131],[23.62004,53.60942],[23.51284,53.95052],[23.48261,53.98855],[23.52702,54.04622],[23.49196,54.14764],[23.45223,54.17775],[23.42418,54.17911],[23.39525,54.21672],[23.3494,54.25155],[23.24656,54.25701],[23.15938,54.29894],[23.15526,54.31076],[23.13905,54.31567],[23.104,54.29794],[23.04323,54.31567],[23.05726,54.34565],[22.99649,54.35927],[23.00584,54.38514],[22.83756,54.40827],[22.79705,54.36264],[21.41123,54.32395],[20.63871,54.3706],[19.8038,54.44203],[19.64312,54.45423],[18.57853,55.25302]]]]}},{type:"Feature",properties:{iso1A2:"PM",iso1A3:"SPM",iso1N3:"666",wikidata:"Q34617",nameEn:"Saint Pierre and Miquelon",country:"FR",groups:["EU","Q1451600","021","003","019","UN"],callingCodes:["508"]},geometry:{type:"MultiPolygon",coordinates:[[[[-56.72993,46.65575],[-55.90758,46.6223],[-56.27503,47.39728],[-56.72993,46.65575]]]]}},{type:"Feature",properties:{iso1A2:"PN",iso1A3:"PCN",iso1N3:"612",wikidata:"Q35672",nameEn:"Pitcairn Islands",country:"GB",groups:["BOTS","061","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[-133.59543,-28.4709],[-122.0366,-24.55017],[-133.61511,-21.93325],[-133.59543,-28.4709]]]]}},{type:"Feature",properties:{iso1A2:"PR",iso1A3:"PRI",iso1N3:"630",wikidata:"Q1183",nameEn:"Puerto Rico",aliases:["US-PR"],country:"US",groups:["Q1352230","029","003","419","019","UN"],roadSpeedUnit:"mph",callingCodes:["1 787","1 939"]},geometry:{type:"MultiPolygon",coordinates:[[[[-65.27974,17.56928],[-65.02435,18.73231],[-67.99519,18.97186],[-68.23894,17.84663],[-65.27974,17.56928]]]]}},{type:"Feature",properties:{iso1A2:"PS",iso1A3:"PSE",iso1N3:"275",wikidata:"Q219060",nameEn:"Palestine"},geometry:null},{type:"Feature",properties:{iso1A2:"PT",iso1A3:"PRT",iso1N3:"620",wikidata:"Q45",nameEn:"Portugal"},geometry:null},{type:"Feature",properties:{iso1A2:"PW",iso1A3:"PLW",iso1N3:"585",wikidata:"Q695",nameEn:"Palau",groups:["057","009","UN"],roadSpeedUnit:"mph",callingCodes:["680"]},geometry:{type:"MultiPolygon",coordinates:[[[[128.97621,3.08804],[136.39296,1.54187],[136.04605,12.45908],[128.97621,3.08804]]]]}},{type:"Feature",properties:{iso1A2:"PY",iso1A3:"PRY",iso1N3:"600",wikidata:"Q733",nameEn:"Paraguay",groups:["005","419","019","UN"],callingCodes:["595"]},geometry:{type:"MultiPolygon",coordinates:[[[[-58.16225,-20.16193],[-58.23216,-19.80058],[-59.06965,-19.29148],[-60.00638,-19.2981],[-61.73723,-19.63958],[-61.93912,-20.10053],[-62.26883,-20.55311],[-62.2757,-21.06657],[-62.64455,-22.25091],[-62.51761,-22.37684],[-62.22768,-22.55807],[-61.9756,-23.0507],[-61.0782,-23.62932],[-60.99754,-23.80934],[-60.28163,-24.04436],[-60.03367,-24.00701],[-59.45482,-24.34787],[-59.33886,-24.49935],[-58.33055,-24.97099],[-58.25492,-24.92528],[-57.80821,-25.13863],[-57.57431,-25.47269],[-57.87176,-25.93604],[-58.1188,-26.16704],[-58.3198,-26.83443],[-58.65321,-27.14028],[-58.59549,-27.29973],[-58.04205,-27.2387],[-56.85337,-27.5165],[-56.18313,-27.29851],[-55.89195,-27.3467],[-55.74475,-27.44485],[-55.59094,-27.32444],[-55.62322,-27.1941],[-55.39611,-26.97679],[-55.25243,-26.93808],[-55.16948,-26.96068],[-55.06351,-26.80195],[-55.00584,-26.78754],[-54.80868,-26.55669],[-54.70732,-26.45099],[-54.69333,-26.37705],[-54.67359,-25.98607],[-54.60664,-25.9691],[-54.62063,-25.91213],[-54.59398,-25.59224],[-54.59509,-25.53696],[-54.60196,-25.48397],[-54.62033,-25.46026],[-54.4423,-25.13381],[-54.28207,-24.07305],[-54.32807,-24.01865],[-54.6238,-23.83078],[-55.02691,-23.97317],[-55.0518,-23.98666],[-55.12292,-23.99669],[-55.41784,-23.9657],[-55.44117,-23.9185],[-55.43585,-23.87157],[-55.5555,-23.28237],[-55.52288,-23.2595],[-55.5446,-23.22811],[-55.63849,-22.95122],[-55.62493,-22.62765],[-55.68742,-22.58407],[-55.6986,-22.56268],[-55.72366,-22.5519],[-55.741,-22.52018],[-55.74941,-22.46436],[-55.8331,-22.29008],[-56.23206,-22.25347],[-56.45893,-22.08072],[-56.5212,-22.11556],[-56.6508,-22.28387],[-57.98625,-22.09157],[-57.94642,-21.73799],[-57.88239,-21.6868],[-57.93492,-21.65505],[-57.84536,-20.93155],[-58.16225,-20.16193]]]]}},{type:"Feature",properties:{iso1A2:"QA",iso1A3:"QAT",iso1N3:"634",wikidata:"Q846",nameEn:"Qatar",groups:["145","142","UN"],callingCodes:["974"]},geometry:{type:"MultiPolygon",coordinates:[[[[50.92992,24.54396],[51.09638,24.46907],[51.29972,24.50747],[51.39468,24.62785],[51.58834,24.66608],[51.83108,24.71675],[51.83682,26.70231],[50.93865,26.30758],[50.81266,25.88946],[50.86149,25.6965],[50.7801,25.595],[50.80824,25.54641],[50.57069,25.57887],[50.8133,24.74049],[50.92992,24.54396]]]]}},{type:"Feature",properties:{iso1A2:"RE",iso1A3:"REU",iso1N3:"638",wikidata:"Q17070",nameEn:"R\xE9union",country:"FR",groups:["Q3320166","EU","014","202","002","UN"],callingCodes:["262"]},geometry:{type:"MultiPolygon",coordinates:[[[[53.37984,-21.23941],[56.73473,-21.9174],[56.62373,-20.2711],[53.37984,-21.23941]]]]}},{type:"Feature",properties:{iso1A2:"RO",iso1A3:"ROU",iso1N3:"642",wikidata:"Q218",nameEn:"Romania",groups:["EU","151","150","UN"],callingCodes:["40"]},geometry:{type:"MultiPolygon",coordinates:[[[[27.15622,47.98538],[27.02985,48.09083],[27.04118,48.12522],[26.96119,48.13003],[26.98042,48.15752],[26.94265,48.1969],[26.87708,48.19919],[26.81161,48.25049],[26.62823,48.25804],[26.55202,48.22445],[26.33504,48.18418],[26.17711,47.99246],[26.05901,47.9897],[25.77723,47.93919],[25.63878,47.94924],[25.23778,47.89403],[25.11144,47.75203],[24.88896,47.7234],[24.81893,47.82031],[24.70632,47.84428],[24.61994,47.95062],[24.43578,47.97131],[24.34926,47.9244],[24.22566,47.90231],[24.11281,47.91487],[24.06466,47.95317],[24.02999,47.95087],[24.00801,47.968],[23.98553,47.96076],[23.96337,47.96672],[23.94192,47.94868],[23.89352,47.94512],[23.8602,47.9329],[23.80904,47.98142],[23.75188,47.99705],[23.66262,47.98786],[23.63894,48.00293],[23.5653,48.00499],[23.52803,48.01818],[23.4979,47.96858],[23.33577,48.0237],[23.27397,48.08245],[23.15999,48.12188],[23.1133,48.08061],[23.08858,48.00716],[23.0158,47.99338],[22.92241,48.02002],[22.94301,47.96672],[22.89849,47.95851],[22.77991,47.87211],[22.76617,47.8417],[22.67247,47.7871],[22.46559,47.76583],[22.41979,47.7391],[22.31816,47.76126],[22.00917,47.50492],[22.03389,47.42508],[22.01055,47.37767],[21.94463,47.38046],[21.78395,47.11104],[21.648,47.03902],[21.68645,46.99595],[21.59581,46.91628],[21.59307,46.86935],[21.52028,46.84118],[21.48935,46.7577],[21.5151,46.72147],[21.43926,46.65109],[21.33214,46.63035],[21.26929,46.4993],[21.28061,46.44941],[21.16872,46.30118],[21.06572,46.24897],[20.86797,46.28884],[20.74574,46.25467],[20.76085,46.21002],[20.63863,46.12728],[20.49718,46.18721],[20.45377,46.14405],[20.35573,46.16629],[20.28324,46.1438],[20.26068,46.12332],[20.35862,45.99356],[20.54818,45.89939],[20.65645,45.82801],[20.70069,45.7493],[20.77416,45.75601],[20.78446,45.78522],[20.82364,45.77738],[20.80361,45.65875],[20.76798,45.60969],[20.83321,45.53567],[20.77217,45.49788],[20.86026,45.47295],[20.87948,45.42743],[21.09894,45.30144],[21.17612,45.32566],[21.20392,45.2677],[21.29398,45.24148],[21.48278,45.19557],[21.51299,45.15345],[21.4505,45.04294],[21.35855,45.01941],[21.54938,44.9327],[21.56328,44.89502],[21.48202,44.87199],[21.44013,44.87613],[21.35643,44.86364],[21.38802,44.78133],[21.55007,44.77304],[21.60019,44.75208],[21.61942,44.67059],[21.67504,44.67107],[21.71692,44.65349],[21.7795,44.66165],[21.99364,44.63395],[22.08016,44.49844],[22.13234,44.47444],[22.18315,44.48179],[22.30844,44.6619],[22.45301,44.7194],[22.61917,44.61489],[22.69196,44.61587],[22.76749,44.54446],[22.70981,44.51852],[22.61368,44.55719],[22.56493,44.53419],[22.54021,44.47836],[22.45436,44.47258],[22.56012,44.30712],[22.68166,44.28206],[22.67173,44.21564],[23.04988,44.07694],[23.01674,44.01946],[22.87873,43.9844],[22.83753,43.88055],[22.85314,43.84452],[23.05288,43.79494],[23.26772,43.84843],[23.4507,43.84936],[23.61687,43.79289],[23.73978,43.80627],[24.18149,43.68218],[24.35364,43.70211],[24.50264,43.76314],[24.62281,43.74082],[24.73542,43.68523],[24.96682,43.72693],[25.10718,43.6831],[25.17144,43.70261],[25.39528,43.61866],[25.72792,43.69263],[25.94911,43.85745],[26.05584,43.90925],[26.10115,43.96908],[26.38764,44.04356],[26.62712,44.05698],[26.95141,44.13555],[27.26845,44.12602],[27.39757,44.0141],[27.60834,44.01206],[27.64542,44.04958],[27.73468,43.95326],[27.92008,44.00761],[27.99558,43.84193],[28.23293,43.76],[29.24336,43.70874],[30.04414,45.08461],[29.69272,45.19227],[29.65428,45.25629],[29.68175,45.26885],[29.59798,45.38857],[29.42632,45.44545],[29.24779,45.43388],[28.96077,45.33164],[28.94292,45.28045],[28.81383,45.3384],[28.78911,45.24179],[28.71358,45.22631],[28.5735,45.24759],[28.34554,45.32102],[28.28504,45.43907],[28.21139,45.46895],[28.18741,45.47358],[28.08927,45.6051],[28.16568,45.6421],[28.13111,45.92819],[28.08612,46.01105],[28.13684,46.18099],[28.10937,46.22852],[28.19864,46.31869],[28.18902,46.35283],[28.25769,46.43334],[28.22281,46.50481],[28.24808,46.64305],[28.12173,46.82283],[28.09095,46.97621],[27.81892,47.1381],[27.73172,47.29248],[27.68706,47.28962],[27.60263,47.32507],[27.55731,47.46637],[27.47942,47.48113],[27.3979,47.59473],[27.32202,47.64009],[27.25519,47.71366],[27.29069,47.73722],[27.1618,47.92391],[27.15622,47.98538]]]]}},{type:"Feature",properties:{iso1A2:"RS",iso1A3:"SRB",iso1N3:"688",wikidata:"Q403",nameEn:"Serbia",groups:["039","150","UN"],callingCodes:["381"]},geometry:{type:"MultiPolygon",coordinates:[[[[19.66007,46.19005],[19.56113,46.16824],[19.52473,46.1171],[19.28826,45.99694],[19.14543,45.9998],[19.10388,46.04015],[19.0791,45.96458],[19.01284,45.96529],[18.99712,45.93537],[18.81394,45.91329],[18.85783,45.85493],[18.90305,45.71863],[18.96691,45.66731],[18.88776,45.57253],[18.94562,45.53712],[19.07471,45.53086],[19.08364,45.48804],[18.99918,45.49333],[18.97446,45.37528],[19.10774,45.29547],[19.28208,45.23813],[19.41941,45.23475],[19.43589,45.17137],[19.19144,45.17863],[19.14063,45.12972],[19.07952,45.14668],[19.1011,45.01191],[19.05205,44.97692],[19.15573,44.95409],[19.06853,44.89915],[19.02871,44.92541],[18.98957,44.90645],[19.01994,44.85493],[19.18183,44.92055],[19.36722,44.88164],[19.32543,44.74058],[19.26388,44.65412],[19.16699,44.52197],[19.13369,44.52521],[19.12278,44.50132],[19.14837,44.45253],[19.14681,44.41463],[19.11785,44.40313],[19.10749,44.39421],[19.10704,44.38249],[19.10365,44.37795],[19.10298,44.36924],[19.11865,44.36712],[19.1083,44.3558],[19.11547,44.34218],[19.13556,44.338],[19.13332,44.31492],[19.16741,44.28648],[19.18328,44.28383],[19.20508,44.2917],[19.23306,44.26097],[19.26945,44.26957],[19.32464,44.27185],[19.34773,44.23244],[19.3588,44.18353],[19.40927,44.16722],[19.43905,44.13088],[19.47338,44.15034],[19.48386,44.14332],[19.47321,44.1193],[19.51167,44.08158],[19.55999,44.06894],[19.57467,44.04716],[19.61991,44.05254],[19.61836,44.01464],[19.56498,43.99922],[19.52515,43.95573],[19.38439,43.96611],[19.24363,44.01502],[19.23465,43.98764],[19.3986,43.79668],[19.5176,43.71403],[19.50455,43.58385],[19.42696,43.57987],[19.41941,43.54056],[19.36653,43.60921],[19.33426,43.58833],[19.2553,43.5938],[19.24774,43.53061],[19.22807,43.5264],[19.22229,43.47926],[19.44315,43.38846],[19.48171,43.32644],[19.52962,43.31623],[19.54598,43.25158],[19.62661,43.2286],[19.64063,43.19027],[19.76918,43.16044],[19.79255,43.11951],[19.92576,43.08539],[19.96549,43.11098],[19.98887,43.0538],[20.04729,43.02732],[20.05431,42.99571],[20.12325,42.96237],[20.14896,42.99058],[20.16415,42.97177],[20.34528,42.90676],[20.35692,42.8335],[20.40594,42.84853],[20.43734,42.83157],[20.53484,42.8885],[20.48692,42.93208],[20.59929,43.01067],[20.64557,43.00826],[20.69515,43.09641],[20.59929,43.20492],[20.68688,43.21335],[20.73811,43.25068],[20.82145,43.26769],[20.88685,43.21697],[20.83727,43.17842],[20.96287,43.12416],[21.00749,43.13984],[21.05378,43.10707],[21.08952,43.13471],[21.14465,43.11089],[21.16734,42.99694],[21.2041,43.02277],[21.23877,43.00848],[21.23534,42.95523],[21.2719,42.8994],[21.32974,42.90424],[21.36941,42.87397],[21.44047,42.87276],[21.39045,42.74888],[21.47498,42.74695],[21.59154,42.72643],[21.58755,42.70418],[21.6626,42.67813],[21.75025,42.70125],[21.79413,42.65923],[21.75672,42.62695],[21.7327,42.55041],[21.70522,42.54176],[21.7035,42.51899],[21.62556,42.45106],[21.64209,42.41081],[21.62887,42.37664],[21.59029,42.38042],[21.57021,42.3647],[21.53467,42.36809],[21.5264,42.33634],[21.56772,42.30946],[21.58992,42.25915],[21.70111,42.23789],[21.77176,42.2648],[21.84654,42.3247],[21.91595,42.30392],[21.94405,42.34669],[22.02908,42.29848],[22.16384,42.32103],[22.29605,42.37477],[22.29275,42.34913],[22.34773,42.31725],[22.45919,42.33822],[22.47498,42.3915],[22.51961,42.3991],[22.55669,42.50144],[22.43983,42.56851],[22.4997,42.74144],[22.43309,42.82057],[22.54302,42.87774],[22.74826,42.88701],[22.78397,42.98253],[22.89521,43.03625],[22.98104,43.11199],[23.00806,43.19279],[22.89727,43.22417],[22.82036,43.33665],[22.53397,43.47225],[22.47582,43.6558],[22.41043,43.69566],[22.35558,43.81281],[22.41449,44.00514],[22.61688,44.06534],[22.61711,44.16938],[22.67173,44.21564],[22.68166,44.28206],[22.56012,44.30712],[22.45436,44.47258],[22.54021,44.47836],[22.56493,44.53419],[22.61368,44.55719],[22.70981,44.51852],[22.76749,44.54446],[22.69196,44.61587],[22.61917,44.61489],[22.45301,44.7194],[22.30844,44.6619],[22.18315,44.48179],[22.13234,44.47444],[22.08016,44.49844],[21.99364,44.63395],[21.7795,44.66165],[21.71692,44.65349],[21.67504,44.67107],[21.61942,44.67059],[21.60019,44.75208],[21.55007,44.77304],[21.38802,44.78133],[21.35643,44.86364],[21.44013,44.87613],[21.48202,44.87199],[21.56328,44.89502],[21.54938,44.9327],[21.35855,45.01941],[21.4505,45.04294],[21.51299,45.15345],[21.48278,45.19557],[21.29398,45.24148],[21.20392,45.2677],[21.17612,45.32566],[21.09894,45.30144],[20.87948,45.42743],[20.86026,45.47295],[20.77217,45.49788],[20.83321,45.53567],[20.76798,45.60969],[20.80361,45.65875],[20.82364,45.77738],[20.78446,45.78522],[20.77416,45.75601],[20.70069,45.7493],[20.65645,45.82801],[20.54818,45.89939],[20.35862,45.99356],[20.26068,46.12332],[20.09713,46.17315],[20.03533,46.14509],[20.01816,46.17696],[19.93508,46.17553],[19.81491,46.1313],[19.66007,46.19005]]]]}},{type:"Feature",properties:{iso1A2:"RU",iso1A3:"RUS",iso1N3:"643",wikidata:"Q159",nameEn:"Russia"},geometry:null},{type:"Feature",properties:{iso1A2:"RW",iso1A3:"RWA",iso1N3:"646",wikidata:"Q1037",nameEn:"Rwanda",groups:["014","202","002","UN"],callingCodes:["250"]},geometry:{type:"MultiPolygon",coordinates:[[[[30.47194,-1.0555],[30.35212,-1.06896],[30.16369,-1.34303],[29.912,-1.48269],[29.82657,-1.31187],[29.59061,-1.39016],[29.53062,-1.40499],[29.45038,-1.5054],[29.36322,-1.50887],[29.24323,-1.66826],[29.24458,-1.69663],[29.11847,-1.90576],[29.17562,-2.12278],[29.105,-2.27043],[29.00051,-2.29001],[28.95642,-2.37321],[28.89601,-2.37321],[28.86826,-2.41888],[28.86846,-2.44866],[28.89132,-2.47557],[28.89342,-2.49017],[28.88846,-2.50493],[28.87497,-2.50887],[28.86209,-2.5231],[28.86193,-2.53185],[28.87943,-2.55165],[28.89288,-2.55848],[28.90226,-2.62385],[28.89793,-2.66111],[28.94346,-2.69124],[29.00357,-2.70596],[29.04081,-2.7416],[29.0562,-2.58632],[29.32234,-2.6483],[29.36805,-2.82933],[29.88237,-2.75105],[29.95911,-2.33348],[30.14034,-2.43626],[30.42933,-2.31064],[30.54501,-2.41404],[30.83915,-2.35795],[30.89303,-2.08223],[30.80802,-1.91477],[30.84079,-1.64652],[30.71974,-1.43244],[30.57123,-1.33264],[30.50889,-1.16412],[30.45116,-1.10641],[30.47194,-1.0555]]]]}},{type:"Feature",properties:{iso1A2:"SA",iso1A3:"SAU",iso1N3:"682",wikidata:"Q851",nameEn:"Saudi Arabia",groups:["145","142","UN"],callingCodes:["966"]},geometry:{type:"MultiPolygon",coordinates:[[[[40.01521,32.05667],[39.29903,32.23259],[38.99233,31.99721],[36.99791,31.50081],[37.99354,30.49998],[37.66395,30.33245],[37.4971,29.99949],[36.75083,29.86903],[36.50005,29.49696],[36.07081,29.18469],[34.8812,29.36878],[34.4454,27.91479],[37.8565,22.00903],[39.63762,18.37348],[40.99158,15.81743],[42.15205,16.40211],[42.76801,16.40371],[42.94625,16.39721],[42.94351,16.49467],[42.97215,16.51093],[43.11601,16.53166],[43.15274,16.67248],[43.22066,16.65179],[43.21325,16.74416],[43.25857,16.75304],[43.26303,16.79479],[43.24801,16.80613],[43.22956,16.80613],[43.22012,16.83932],[43.18338,16.84852],[43.1398,16.90696],[43.19328,16.94703],[43.1813,16.98438],[43.18233,17.02673],[43.23967,17.03428],[43.17787,17.14717],[43.20156,17.25901],[43.32653,17.31179],[43.22533,17.38343],[43.29185,17.53224],[43.43005,17.56148],[43.70631,17.35762],[44.50126,17.47475],[46.31018,17.20464],[46.76494,17.29151],[47.00571,16.94765],[47.48245,17.10808],[47.58351,17.50366],[48.19996,18.20584],[49.04884,18.59899],[52.00311,19.00083],[54.99756,20.00083],[55.66469,21.99658],[55.2137,22.71065],[55.13599,22.63334],[52.56622,22.94341],[51.59617,24.12041],[51.58871,24.27256],[51.41644,24.39615],[51.58834,24.66608],[51.39468,24.62785],[51.29972,24.50747],[51.09638,24.46907],[50.92992,24.54396],[50.8133,24.74049],[50.57069,25.57887],[50.302,25.87592],[50.26923,26.08243],[50.38162,26.53976],[50.71771,26.73086],[50.37726,27.89227],[49.98877,27.87827],[49.00421,28.81495],[48.42991,28.53628],[47.70561,28.5221],[47.59863,28.66798],[47.58376,28.83382],[47.46202,29.0014],[46.5527,29.10283],[46.42415,29.05947],[44.72255,29.19736],[42.97796,30.48295],[42.97601,30.72204],[40.01521,32.05667]]]]}},{type:"Feature",properties:{iso1A2:"SB",iso1A3:"SLB",iso1N3:"090",wikidata:"Q685",nameEn:"Solomon Islands",groups:["054","009","UN"],driveSide:"left",callingCodes:["677"]},geometry:{type:"MultiPolygon",coordinates:[[[[172.71443,-12.01327],[160.43769,-4.17974],[156.03296,-6.55528],[156.03993,-6.65703],[155.92557,-6.84664],[155.69784,-6.92661],[155.60735,-6.92266],[154.74815,-7.33315],[156.73836,-14.50464],[172.71443,-12.01327]]]]}},{type:"Feature",properties:{iso1A2:"SC",iso1A3:"SYC",iso1N3:"690",wikidata:"Q1042",nameEn:"Seychelles",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["248"]},geometry:{type:"MultiPolygon",coordinates:[[[[43.75112,-10.38913],[54.83239,-10.93575],[66.3222,5.65313],[43.75112,-10.38913]]]]}},{type:"Feature",properties:{iso1A2:"SD",iso1A3:"SDN",iso1N3:"729",wikidata:"Q1049",nameEn:"Sudan",groups:["015","002","UN"],callingCodes:["249"]},geometry:{type:"MultiPolygon",coordinates:[[[[37.8565,22.00903],[34.0765,22.00501],[33.99686,21.76784],[33.57251,21.72406],[33.17563,22.00405],[24.99885,21.99535],[24.99794,19.99661],[23.99715,20.00038],[23.99539,19.49944],[23.99997,15.69575],[23.62785,15.7804],[23.38812,15.69649],[23.10792,15.71297],[22.93201,15.55107],[22.92579,15.47007],[22.99584,15.40105],[22.99584,15.22989],[22.66115,14.86308],[22.70474,14.69149],[22.38562,14.58907],[22.44944,14.24986],[22.55997,14.23024],[22.5553,14.11704],[22.22995,13.96754],[22.08674,13.77863],[22.29689,13.3731],[22.1599,13.19281],[22.02914,13.13976],[21.94819,13.05637],[21.81432,12.81362],[21.89371,12.68001],[21.98711,12.63292],[22.15679,12.66634],[22.22684,12.74682],[22.46345,12.61925],[22.38873,12.45514],[22.50548,12.16769],[22.48369,12.02766],[22.64092,12.07485],[22.54907,11.64372],[22.7997,11.40424],[22.93124,11.41645],[22.97249,11.21955],[22.87758,10.91915],[23.02221,10.69235],[23.3128,10.45214],[23.67164,9.86923],[23.69155,9.67566],[24.09319,9.66572],[24.12744,9.73784],[24.49389,9.79962],[24.84653,9.80643],[24.97739,9.9081],[25.05688,10.06776],[25.0918,10.33718],[25.78141,10.42599],[25.93163,10.38159],[25.93241,10.17941],[26.21338,9.91545],[26.35815,9.57946],[26.70685,9.48735],[27.14427,9.62858],[27.90704,9.61323],[28.99983,9.67155],[29.06988,9.74826],[29.53844,9.75133],[29.54,10.07949],[29.94629,10.29245],[30.00389,10.28633],[30.53005,9.95992],[30.82893,9.71451],[30.84605,9.7498],[31.28504,9.75287],[31.77539,10.28939],[31.99177,10.65065],[32.46967,11.04662],[32.39358,11.18207],[32.39578,11.70208],[32.10079,11.95203],[32.73921,11.95203],[32.73921,12.22757],[33.25876,12.22111],[33.13988,11.43248],[33.26977,10.83632],[33.24645,10.77913],[33.52294,10.64382],[33.66604,10.44254],[33.80913,10.32994],[33.90159,10.17179],[33.96984,10.15446],[33.99185,9.99623],[33.96323,9.80972],[33.9082,9.762],[33.87958,9.49937],[34.10229,9.50238],[34.08717,9.55243],[34.13186,9.7492],[34.20484,9.9033],[34.22718,10.02506],[34.32102,10.11599],[34.34783,10.23914],[34.2823,10.53508],[34.4372,10.781],[34.59062,10.89072],[34.77383,10.74588],[34.77532,10.69027],[34.86618,10.74588],[34.86916,10.78832],[34.97491,10.86147],[34.97789,10.91559],[34.93172,10.95946],[35.01215,11.19626],[34.95704,11.24448],[35.09556,11.56278],[35.05832,11.71158],[35.11492,11.85156],[35.24302,11.91132],[35.70476,12.67101],[36.01458,12.72478],[36.14268,12.70879],[36.16651,12.88019],[36.13374,12.92665],[36.24545,13.36759],[36.38993,13.56459],[36.48824,13.83954],[36.44653,13.95666],[36.54376,14.25597],[36.44337,15.14963],[36.54276,15.23478],[36.69761,15.75323],[36.76371,15.80831],[36.92193,16.23451],[36.99777,17.07172],[37.42694,17.04041],[37.50967,17.32199],[38.13362,17.53906],[38.37133,17.66269],[38.45916,17.87167],[38.57727,17.98125],[39.63762,18.37348],[37.8565,22.00903]]]]}},{type:"Feature",properties:{iso1A2:"SE",iso1A3:"SWE",iso1N3:"752",wikidata:"Q34",nameEn:"Sweden",groups:["EU","154","150","UN"],callingCodes:["46"]},geometry:{type:"MultiPolygon",coordinates:[[[[24.15791,65.85385],[23.90497,66.15802],[23.71339,66.21299],[23.64982,66.30603],[23.67591,66.3862],[23.63776,66.43568],[23.85959,66.56434],[23.89488,66.772],[23.98059,66.79585],[23.98563,66.84149],[23.56214,67.17038],[23.58735,67.20752],[23.54701,67.25435],[23.75372,67.29914],[23.75372,67.43688],[23.39577,67.46974],[23.54701,67.59306],[23.45627,67.85297],[23.65793,67.9497],[23.40081,68.05545],[23.26469,68.15134],[23.15377,68.14759],[23.10336,68.26551],[22.73028,68.40881],[22.00429,68.50692],[21.03001,68.88969],[20.90649,68.89696],[20.85104,68.93142],[20.91658,68.96764],[20.78802,69.03087],[20.55258,69.06069],[20.0695,69.04469],[20.28444,68.93283],[20.33435,68.80174],[20.22027,68.67246],[19.95647,68.55546],[20.22027,68.48759],[19.93508,68.35911],[18.97255,68.52416],[18.63032,68.50849],[18.39503,68.58672],[18.1241,68.53721],[18.13836,68.20874],[17.90787,67.96537],[17.30416,68.11591],[16.7409,67.91037],[16.38441,67.52923],[16.12774,67.52106],[16.09922,67.4364],[16.39154,67.21653],[16.35589,67.06419],[15.37197,66.48217],[15.49318,66.28509],[15.05113,66.15572],[14.53778,66.12399],[14.50926,65.31786],[13.64276,64.58402],[14.11117,64.46674],[14.16051,64.18725],[13.98222,64.00953],[13.23411,64.09087],[12.74105,64.02171],[12.14928,63.59373],[12.19919,63.47935],[11.98529,63.27487],[12.19919,63.00104],[12.07085,62.6297],[12.29187,62.25699],[12.14746,61.7147],[12.40595,61.57226],[12.57707,61.56547],[12.86939,61.35427],[12.69115,61.06584],[12.2277,61.02442],[12.59133,60.50559],[12.52003,60.13846],[12.36317,59.99259],[12.15641,59.8926],[11.87121,59.86039],[11.92112,59.69531],[11.69297,59.59442],[11.8213,59.24985],[11.65732,58.90177],[11.45199,58.89604],[11.4601,58.99022],[11.34459,59.11672],[11.15367,59.07862],[11.08911,58.98745],[10.64958,58.89391],[10.40861,58.38489],[12.16597,56.60205],[12.07466,56.29488],[12.65312,56.04345],[12.6372,55.91371],[12.88472,55.63369],[12.60345,55.42675],[12.84405,55.13257],[14.28399,55.1553],[14.89259,55.5623],[15.79951,55.54655],[19.64795,57.06466],[19.84909,57.57876],[20.5104,59.15546],[19.08191,60.19152],[19.23413,60.61414],[20.15877,63.06556],[24.14112,65.39731],[24.15107,65.81427],[24.14798,65.83466],[24.15791,65.85385]]]]}},{type:"Feature",properties:{iso1A2:"SG",iso1A3:"SGP",iso1N3:"702",wikidata:"Q334",nameEn:"Singapore",groups:["035","142","UN"],driveSide:"left",callingCodes:["65"]},geometry:{type:"MultiPolygon",coordinates:[[[[104.00131,1.42405],[103.93384,1.42926],[103.89565,1.42841],[103.86383,1.46288],[103.81181,1.47953],[103.76395,1.45183],[103.74161,1.4502],[103.7219,1.46108],[103.67468,1.43166],[103.62738,1.35255],[103.56591,1.19719],[103.66049,1.18825],[103.74084,1.12902],[104.03085,1.26954],[104.12282,1.27714],[104.08072,1.35998],[104.09162,1.39694],[104.08871,1.42015],[104.07348,1.43322],[104.04622,1.44691],[104.02277,1.4438],[104.00131,1.42405]]]]}},{type:"Feature",properties:{iso1A2:"SH",iso1A3:"SHN",iso1N3:"654",wikidata:"Q192184",nameEn:"Saint Helena, Ascension and Tristan da Cunha",country:"GB"},geometry:null},{type:"Feature",properties:{iso1A2:"SI",iso1A3:"SVN",iso1N3:"705",wikidata:"Q215",nameEn:"Slovenia",groups:["EU","039","150","UN"],callingCodes:["386"]},geometry:{type:"MultiPolygon",coordinates:[[[[16.50139,46.56684],[16.39217,46.63673],[16.38594,46.6549],[16.41863,46.66238],[16.42641,46.69228],[16.37816,46.69975],[16.30966,46.7787],[16.31303,46.79838],[16.3408,46.80641],[16.34547,46.83836],[16.2941,46.87137],[16.2365,46.87775],[16.21892,46.86961],[16.15711,46.85434],[16.14365,46.8547],[16.10983,46.867],[16.05786,46.83927],[15.99054,46.82772],[15.99126,46.78199],[15.98432,46.74991],[15.99769,46.7266],[16.02808,46.71094],[16.04347,46.68694],[16.04036,46.6549],[15.99988,46.67947],[15.98512,46.68463],[15.94864,46.68769],[15.87691,46.7211],[15.8162,46.71897],[15.78518,46.70712],[15.76771,46.69863],[15.73823,46.70011],[15.72279,46.69548],[15.69523,46.69823],[15.67411,46.70735],[15.6543,46.70616],[15.6543,46.69228],[15.6365,46.6894],[15.63255,46.68069],[15.62317,46.67947],[15.59826,46.68908],[15.54533,46.66985],[15.55333,46.64988],[15.54431,46.6312],[15.46906,46.61321],[15.45514,46.63697],[15.41235,46.65556],[15.23711,46.63994],[15.14215,46.66131],[15.01451,46.641],[14.98024,46.6009],[14.96002,46.63459],[14.92283,46.60848],[14.87129,46.61],[14.86419,46.59411],[14.83549,46.56614],[14.81836,46.51046],[14.72185,46.49974],[14.66892,46.44936],[14.5942,46.43434],[14.56463,46.37208],[14.52176,46.42617],[14.45877,46.41717],[14.42608,46.44614],[14.314,46.43327],[14.28326,46.44315],[14.15989,46.43327],[14.12097,46.47724],[14.04002,46.49117],[14.00422,46.48474],[13.89837,46.52331],[13.7148,46.5222],[13.68684,46.43881],[13.59777,46.44137],[13.5763,46.42613],[13.5763,46.40915],[13.47019,46.3621],[13.43418,46.35992],[13.44808,46.33507],[13.37671,46.29668],[13.42218,46.20758],[13.47587,46.22725],[13.56114,46.2054],[13.56682,46.18703],[13.64451,46.18966],[13.66472,46.17392],[13.64053,46.13587],[13.57072,46.09022],[13.50104,46.05986],[13.49568,46.04839],[13.50998,46.04498],[13.49702,46.01832],[13.47474,46.00546],[13.50104,45.98078],[13.52963,45.96588],[13.56759,45.96991],[13.58903,45.99009],[13.62074,45.98388],[13.63458,45.98947],[13.64307,45.98326],[13.6329,45.94894],[13.63815,45.93607],[13.61931,45.91782],[13.60857,45.89907],[13.59565,45.89446],[13.58644,45.88173],[13.57563,45.8425],[13.58858,45.83503],[13.59784,45.8072],[13.66986,45.79955],[13.8235,45.7176],[13.83332,45.70855],[13.83422,45.68703],[13.87933,45.65207],[13.9191,45.6322],[13.8695,45.60835],[13.86771,45.59898],[13.84106,45.58185],[13.78445,45.5825],[13.74587,45.59811],[13.7198,45.59352],[13.6076,45.64761],[13.45644,45.59464],[13.56979,45.4895],[13.62902,45.45898],[13.67398,45.4436],[13.7785,45.46787],[13.81742,45.43729],[13.88124,45.42637],[13.90771,45.45149],[13.97309,45.45258],[13.99488,45.47551],[13.96063,45.50825],[14.00578,45.52352],[14.07116,45.48752],[14.20348,45.46896],[14.22371,45.50388],[14.24239,45.50607],[14.26611,45.48239],[14.27681,45.4902],[14.32487,45.47142],[14.36693,45.48642],[14.49769,45.54424],[14.5008,45.60852],[14.53816,45.6205],[14.57397,45.67165],[14.60977,45.66403],[14.59576,45.62812],[14.69694,45.57366],[14.68605,45.53006],[14.71718,45.53442],[14.80124,45.49515],[14.81992,45.45913],[14.90554,45.47769],[14.92266,45.52788],[15.02385,45.48533],[15.05187,45.49079],[15.16862,45.42309],[15.27758,45.46678],[15.33051,45.45258],[15.38188,45.48752],[15.30249,45.53224],[15.29837,45.5841],[15.27747,45.60504],[15.31027,45.6303],[15.34695,45.63382],[15.34214,45.64702],[15.38952,45.63682],[15.4057,45.64727],[15.34919,45.71623],[15.30872,45.69014],[15.25423,45.72275],[15.40836,45.79491],[15.47531,45.79802],[15.47325,45.8253],[15.52234,45.82195],[15.57952,45.84953],[15.64185,45.82915],[15.66662,45.84085],[15.70411,45.8465],[15.68232,45.86819],[15.68383,45.88867],[15.67967,45.90455],[15.70636,45.92116],[15.70327,46.00015],[15.71246,46.01196],[15.72977,46.04682],[15.62317,46.09103],[15.6083,46.11992],[15.59909,46.14761],[15.64904,46.19229],[15.6434,46.21396],[15.67395,46.22478],[15.75436,46.21969],[15.75479,46.20336],[15.78817,46.21719],[15.79284,46.25811],[15.97965,46.30652],[16.07616,46.3463],[16.07314,46.36458],[16.05065,46.3833],[16.05281,46.39141],[16.14859,46.40547],[16.18824,46.38282],[16.30233,46.37837],[16.30162,46.40437],[16.27329,46.41467],[16.27398,46.42875],[16.25124,46.48067],[16.23961,46.49653],[16.26759,46.50566],[16.26733,46.51505],[16.29793,46.5121],[16.37193,46.55008],[16.38771,46.53608],[16.44036,46.5171],[16.5007,46.49644],[16.52604,46.47831],[16.59527,46.47524],[16.52604,46.5051],[16.52885,46.53303],[16.50139,46.56684]]]]}},{type:"Feature",properties:{iso1A2:"SJ",iso1A3:"SJM",iso1N3:"744",wikidata:"Q842829",nameEn:"Svalbard and Jan Mayen",country:"NO"},geometry:null},{type:"Feature",properties:{iso1A2:"SK",iso1A3:"SVK",iso1N3:"703",wikidata:"Q214",nameEn:"Slovakia",groups:["EU","151","150","UN"],callingCodes:["421"]},geometry:{type:"MultiPolygon",coordinates:[[[[19.82237,49.27806],[19.78581,49.41701],[19.72127,49.39288],[19.6375,49.40897],[19.64162,49.45184],[19.57845,49.46077],[19.53313,49.52856],[19.52626,49.57311],[19.45348,49.61583],[19.37795,49.574],[19.36009,49.53747],[19.25435,49.53391],[19.18019,49.41165],[18.9742,49.39557],[18.97283,49.49914],[18.94536,49.52143],[18.84521,49.51672],[18.74761,49.492],[18.67757,49.50895],[18.6144,49.49824],[18.57183,49.51162],[18.53063,49.49022],[18.54848,49.47059],[18.44686,49.39467],[18.4084,49.40003],[18.4139,49.36517],[18.36446,49.3267],[18.18456,49.28909],[18.15022,49.24518],[18.1104,49.08624],[18.06885,49.03157],[17.91814,49.01784],[17.87831,48.92679],[17.77944,48.92318],[17.73126,48.87885],[17.7094,48.86721],[17.5295,48.81117],[17.45671,48.85004],[17.3853,48.80936],[17.29054,48.85546],[17.19355,48.87602],[17.11202,48.82925],[17.00215,48.70887],[16.93955,48.60371],[16.94611,48.53614],[16.85204,48.44968],[16.8497,48.38321],[16.83588,48.3844],[16.83317,48.38138],[16.84243,48.35258],[16.90903,48.32519],[16.89461,48.31332],[16.97701,48.17385],[17.02919,48.13996],[17.05735,48.14179],[17.09168,48.09366],[17.07039,48.0317],[17.16001,48.00636],[17.23699,48.02094],[17.71215,47.7548],[18.02938,47.75665],[18.29305,47.73541],[18.56496,47.76588],[18.66521,47.76772],[18.74074,47.8157],[18.8506,47.82308],[18.76821,47.87469],[18.76134,47.97499],[18.82176,48.04206],[19.01952,48.07052],[19.23924,48.0595],[19.28182,48.08336],[19.47957,48.09437],[19.52489,48.19791],[19.63338,48.25006],[19.92452,48.1283],[20.24312,48.2784],[20.29943,48.26104],[20.5215,48.53336],[20.83248,48.5824],[21.11516,48.49546],[21.44063,48.58456],[21.6068,48.50365],[21.67134,48.3989],[21.72525,48.34628],[21.8279,48.33321],[21.83339,48.36242],[22.14689,48.4005],[22.16023,48.56548],[22.21379,48.6218],[22.34151,48.68893],[22.42934,48.92857],[22.48296,48.99172],[22.54338,49.01424],[22.56155,49.08865],[22.04427,49.22136],[21.96385,49.3437],[21.82927,49.39467],[21.77983,49.35443],[21.62328,49.4447],[21.43376,49.41433],[21.27858,49.45988],[21.19756,49.4054],[21.12477,49.43666],[21.041,49.41791],[21.09799,49.37176],[20.98733,49.30774],[20.9229,49.29626],[20.77971,49.35383],[20.72274,49.41813],[20.61666,49.41791],[20.5631,49.375],[20.46422,49.41612],[20.39939,49.3896],[20.31728,49.39914],[20.31453,49.34817],[20.21977,49.35265],[20.13738,49.31685],[20.08238,49.1813],[19.98494,49.22904],[19.90529,49.23532],[19.86409,49.19316],[19.75286,49.20751],[19.82237,49.27806]]]]}},{type:"Feature",properties:{iso1A2:"SL",iso1A3:"SLE",iso1N3:"694",wikidata:"Q1044",nameEn:"Sierra Leone",groups:["011","202","002","UN"],callingCodes:["232"]},geometry:{type:"MultiPolygon",coordinates:[[[[-10.27575,8.48711],[-10.37257,8.48941],[-10.54891,8.31174],[-10.63934,8.35326],[-10.70565,8.29235],[-10.61422,8.5314],[-10.47707,8.67669],[-10.56197,8.81225],[-10.5783,9.06386],[-10.74484,9.07998],[-10.6534,9.29919],[-11.2118,10.00098],[-11.89624,9.99763],[-11.91023,9.93927],[-12.12634,9.87203],[-12.24262,9.92386],[-12.47254,9.86834],[-12.76788,9.3133],[-12.94095,9.26335],[-13.08953,9.0409],[-13.18586,9.0925],[-13.29911,9.04245],[-14.36218,8.64107],[-12.15048,6.15992],[-11.50429,6.92704],[-11.4027,6.97746],[-11.29417,7.21576],[-10.60422,7.7739],[-10.60492,8.04072],[-10.57523,8.04829],[-10.51554,8.1393],[-10.45023,8.15627],[-10.35227,8.15223],[-10.29839,8.21283],[-10.31635,8.28554],[-10.30084,8.30008],[-10.27575,8.48711]]]]}},{type:"Feature",properties:{iso1A2:"SM",iso1A3:"SMR",iso1N3:"674",wikidata:"Q238",nameEn:"San Marino",groups:["039","150","UN"],callingCodes:["378"]},geometry:{type:"MultiPolygon",coordinates:[[[[12.45648,43.89369],[12.48771,43.89706],[12.49429,43.90973],[12.49247,43.91774],[12.49724,43.92248],[12.50269,43.92363],[12.50496,43.93017],[12.51553,43.94096],[12.51427,43.94897],[12.50655,43.95796],[12.50875,43.96198],[12.50622,43.97131],[12.51109,43.97201],[12.51064,43.98165],[12.5154,43.98508],[12.51463,43.99122],[12.50678,43.99113],[12.49406,43.98492],[12.47853,43.98052],[12.46205,43.97463],[12.44684,43.96597],[12.43662,43.95698],[12.42005,43.9578],[12.41414,43.95273],[12.40415,43.95485],[12.40506,43.94325],[12.41165,43.93769],[12.41551,43.92984],[12.40733,43.92379],[12.41233,43.90956],[12.40935,43.9024],[12.41641,43.89991],[12.44184,43.90498],[12.45648,43.89369]]]]}},{type:"Feature",properties:{iso1A2:"SN",iso1A3:"SEN",iso1N3:"686",wikidata:"Q1041",nameEn:"Senegal",groups:["011","202","002","UN"],callingCodes:["221"]},geometry:{type:"MultiPolygon",coordinates:[[[[-14.32144,16.61495],[-15.00557,16.64997],[-15.6509,16.50315],[-16.27016,16.51565],[-16.4429,16.20605],[-16.44814,16.09753],[-16.48967,16.0496],[-16.50854,16.09032],[-17.15288,16.07139],[-18.35085,14.63444],[-17.43598,13.59273],[-15.47902,13.58758],[-15.36504,13.79313],[-14.93719,13.80173],[-14.34721,13.46578],[-13.8955,13.59126],[-13.79409,13.34472],[-14.36795,13.23033],[-15.14917,13.57989],[-15.26908,13.37768],[-15.80478,13.34832],[-15.80355,13.16729],[-16.69343,13.16791],[-16.74676,13.06025],[-17.43966,13.04579],[-17.4623,11.92379],[-16.70562,12.34803],[-16.38191,12.36449],[-16.20591,12.46157],[-15.67302,12.42974],[-15.17582,12.6847],[-13.70523,12.68013],[-13.05296,12.64003],[-13.06603,12.49342],[-12.87336,12.51892],[-12.35415,12.32758],[-11.91331,12.42008],[-11.46267,12.44559],[-11.37536,12.40788],[-11.39935,12.97808],[-11.63025,13.39174],[-11.83345,13.33333],[-12.06897,13.71049],[-11.93043,13.84505],[-12.23936,14.76324],[-13.11029,15.52116],[-13.43135,16.09022],[-13.80075,16.13961],[-14.32144,16.61495]]]]}},{type:"Feature",properties:{iso1A2:"SO",iso1A3:"SOM",iso1N3:"706",wikidata:"Q1045",nameEn:"Somalia",groups:["014","202","002","UN"],callingCodes:["252"]},geometry:{type:"MultiPolygon",coordinates:[[[[51.12877,12.56479],[43.90659,12.3823],[42.95776,10.98533],[42.69452,10.62672],[42.87643,10.18441],[43.0937,9.90579],[43.23518,9.84605],[43.32613,9.59205],[44.19222,8.93028],[46.99339,7.9989],[47.92477,8.00111],[47.97917,8.00124],[44.98104,4.91821],[44.02436,4.9451],[43.40263,4.79289],[43.04177,4.57923],[42.97746,4.44032],[42.84526,4.28357],[42.55853,4.20518],[42.07619,4.17667],[41.89488,3.97375],[41.31368,3.14314],[40.98767,2.82959],[41.00099,-.83068],[41.56,-1.59812],[41.56362,-1.66375],[41.75542,-1.85308],[57.49095,8.14549],[51.12877,12.56479]]]]}},{type:"Feature",properties:{iso1A2:"SR",iso1A3:"SUR",iso1N3:"740",wikidata:"Q730",nameEn:"Suriname",groups:["005","419","019","UN"],driveSide:"left",callingCodes:["597"]},geometry:{type:"MultiPolygon",coordinates:[[[[-54.26916,5.26909],[-54.01877,5.52789],[-54.01074,5.68785],[-53.7094,6.2264],[-56.84822,6.73257],[-57.31629,5.33714],[-57.22536,5.15605],[-57.37442,5.0208],[-57.8699,4.89394],[-58.0307,3.95513],[-57.35891,3.32121],[-56.70519,2.02964],[-56.55439,2.02003],[-56.47045,1.95135],[-55.99278,1.83137],[-55.89863,1.89861],[-55.92159,2.05236],[-56.13054,2.27723],[-55.96292,2.53188],[-55.71493,2.40342],[-55.01919,2.564],[-54.6084,2.32856],[-54.42864,2.42442],[-54.28534,2.67798],[-53.9849,3.58697],[-53.98914,3.627],[-54.05128,3.63557],[-54.19367,3.84387],[-54.38444,4.13222],[-54.4717,4.91964],[-54.26916,5.26909]]]]}},{type:"Feature",properties:{iso1A2:"SS",iso1A3:"SSD",iso1N3:"728",wikidata:"Q958",nameEn:"South Sudan",groups:["014","202","002","UN"],callingCodes:["211"]},geometry:{type:"MultiPolygon",coordinates:[[[[34.10229,9.50238],[33.87958,9.49937],[33.9082,9.762],[33.96323,9.80972],[33.99185,9.99623],[33.96984,10.15446],[33.90159,10.17179],[33.80913,10.32994],[33.66604,10.44254],[33.52294,10.64382],[33.24645,10.77913],[33.26977,10.83632],[33.13988,11.43248],[33.25876,12.22111],[32.73921,12.22757],[32.73921,11.95203],[32.10079,11.95203],[32.39578,11.70208],[32.39358,11.18207],[32.46967,11.04662],[31.99177,10.65065],[31.77539,10.28939],[31.28504,9.75287],[30.84605,9.7498],[30.82893,9.71451],[30.53005,9.95992],[30.00389,10.28633],[29.94629,10.29245],[29.54,10.07949],[29.53844,9.75133],[29.06988,9.74826],[28.99983,9.67155],[27.90704,9.61323],[27.14427,9.62858],[26.70685,9.48735],[26.35815,9.57946],[26.21338,9.91545],[25.93241,10.17941],[25.93163,10.38159],[25.78141,10.42599],[25.0918,10.33718],[25.05688,10.06776],[24.97739,9.9081],[24.84653,9.80643],[24.49389,9.79962],[24.12744,9.73784],[24.09319,9.66572],[23.69155,9.67566],[23.62179,9.53823],[23.64981,9.44303],[23.64358,9.28637],[23.56263,9.19418],[23.4848,9.16959],[23.44744,8.99128],[23.59065,8.99743],[23.51905,8.71749],[24.25691,8.69288],[24.13238,8.36959],[24.35965,8.26177],[24.85156,8.16933],[24.98855,7.96588],[25.25319,7.8487],[25.29214,7.66675],[25.20649,7.61115],[25.20337,7.50312],[25.35281,7.42595],[25.37461,7.33024],[25.90076,7.09549],[26.38022,6.63493],[26.32729,6.36272],[26.58259,6.1987],[26.51721,6.09655],[27.22705,5.71254],[27.22705,5.62889],[27.28621,5.56382],[27.23017,5.37167],[27.26886,5.25876],[27.44012,5.07349],[27.56656,4.89375],[27.65462,4.89375],[27.76469,4.79284],[27.79551,4.59976],[28.20719,4.35614],[28.6651,4.42638],[28.8126,4.48784],[29.03054,4.48784],[29.22207,4.34297],[29.43341,4.50101],[29.49726,4.7007],[29.82087,4.56246],[29.79666,4.37809],[30.06964,4.13221],[30.1621,4.10586],[30.22374,3.93896],[30.27658,3.95653],[30.47691,3.83353],[30.55396,3.84451],[30.57378,3.74567],[30.56277,3.62703],[30.78512,3.67097],[30.80713,3.60506],[30.85997,3.5743],[30.85153,3.48867],[30.97601,3.693],[31.16666,3.79853],[31.29476,3.8015],[31.50478,3.67814],[31.50776,3.63652],[31.72075,3.74354],[31.81459,3.82083],[31.86821,3.78664],[31.96205,3.6499],[31.95907,3.57408],[32.05187,3.589],[32.08491,3.56287],[32.08866,3.53543],[32.19888,3.50867],[32.20782,3.6053],[32.41337,3.748],[32.72021,3.77327],[32.89746,3.81339],[33.02852,3.89296],[33.18356,3.77812],[33.51264,3.75068],[33.9873,4.23316],[34.47601,4.72162],[35.34151,5.02364],[35.30992,4.90402],[35.47843,4.91872],[35.42366,4.76969],[35.51424,4.61643],[35.9419,4.61933],[35.82118,4.77382],[35.81968,5.10757],[35.8576,5.33413],[35.50792,5.42431],[35.29938,5.34042],[35.31188,5.50106],[35.13058,5.62118],[35.12611,5.68937],[35.00546,5.89387],[34.96227,6.26415],[35.01738,6.46991],[34.87736,6.60161],[34.77459,6.5957],[34.65096,6.72589],[34.53776,6.74808],[34.53925,6.82794],[34.47669,6.91076],[34.35753,6.91963],[34.19369,7.04382],[34.19369,7.12807],[34.01495,7.25664],[34.03878,7.27437],[34.02984,7.36449],[33.87642,7.5491],[33.71407,7.65983],[33.44745,7.7543],[33.32531,7.71297],[33.24637,7.77939],[33.04944,7.78989],[33.0006,7.90333],[33.08401,8.05822],[33.18083,8.13047],[33.1853,8.29264],[33.19721,8.40317],[33.3119,8.45474],[33.54575,8.47094],[33.66938,8.44442],[33.71407,8.3678],[33.87195,8.41938],[33.89579,8.4842],[34.01346,8.50041],[34.14453,8.60204],[34.14304,9.04654],[34.10229,9.50238]]]]}},{type:"Feature",properties:{iso1A2:"ST",iso1A3:"STP",iso1N3:"678",wikidata:"Q1039",nameEn:"S\xE3o Tom\xE9 and Principe",groups:["017","202","002","UN"],callingCodes:["239"]},geometry:{type:"MultiPolygon",coordinates:[[[[4.34149,1.91417],[6.6507,-.28606],[7.9035,1.92304],[4.34149,1.91417]]]]}},{type:"Feature",properties:{iso1A2:"SV",iso1A3:"SLV",iso1N3:"222",wikidata:"Q792",nameEn:"El Salvador",groups:["013","003","419","019","UN"],callingCodes:["503"]},geometry:{type:"MultiPolygon",coordinates:[[[[-89.34776,14.43013],[-89.39028,14.44561],[-89.57441,14.41637],[-89.58814,14.33165],[-89.50614,14.26084],[-89.52397,14.22628],[-89.61844,14.21937],[-89.70756,14.1537],[-89.75569,14.07073],[-89.73251,14.04133],[-89.76103,14.02923],[-89.81807,14.07073],[-89.88937,14.0396],[-90.10505,13.85104],[-90.11344,13.73679],[-90.55276,12.8866],[-88.11443,12.63306],[-87.7346,13.13228],[-87.55124,13.12523],[-87.69751,13.25228],[-87.73714,13.32715],[-87.80177,13.35689],[-87.84675,13.41078],[-87.83467,13.44655],[-87.77354,13.45767],[-87.73841,13.44169],[-87.72115,13.46083],[-87.71657,13.50577],[-87.78148,13.52906],[-87.73106,13.75443],[-87.68821,13.80829],[-87.7966,13.91353],[-88.00331,13.86948],[-88.07641,13.98447],[-88.23018,13.99915],[-88.25791,13.91108],[-88.48982,13.86458],[-88.49738,13.97224],[-88.70661,14.04317],[-88.73182,14.10919],[-88.815,14.11652],[-88.85785,14.17763],[-88.94608,14.20207],[-89.04187,14.33644],[-89.34776,14.43013]]]]}},{type:"Feature",properties:{iso1A2:"SX",iso1A3:"SXM",iso1N3:"534",wikidata:"Q26273",nameEn:"Sint Maarten",aliases:["NL-SX"],country:"NL",groups:["Q1451600","029","003","419","019","UN"],callingCodes:["1 721"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.33064,17.9615],[-63.1055,17.86651],[-62.93924,18.02904],[-63.02323,18.05757],[-63.04039,18.05619],[-63.0579,18.06614],[-63.07759,18.04943],[-63.09686,18.04608],[-63.11042,18.05339],[-63.13502,18.05445],[-63.33064,17.9615]]]]}},{type:"Feature",properties:{iso1A2:"SY",iso1A3:"SYR",iso1N3:"760",wikidata:"Q858",nameEn:"Syria",groups:["145","142","UN"],callingCodes:["963"]},geometry:{type:"MultiPolygon",coordinates:[[[[42.23683,37.2863],[42.21548,37.28026],[42.20454,37.28715],[42.22381,37.30238],[42.22257,37.31395],[42.2112,37.32491],[42.19301,37.31323],[42.18225,37.28569],[42.00894,37.17209],[41.515,37.08084],[41.21937,37.07665],[40.90856,37.13147],[40.69136,37.0996],[39.81589,36.75538],[39.21538,36.66834],[39.03217,36.70911],[38.74042,36.70629],[38.55908,36.84429],[38.38859,36.90064],[38.21064,36.91842],[37.81974,36.76055],[37.68048,36.75065],[37.49103,36.66904],[37.47253,36.63243],[37.21988,36.6736],[37.16177,36.66069],[37.10894,36.6704],[37.08279,36.63495],[37.02088,36.66422],[37.01647,36.69512],[37.04619,36.71101],[37.04399,36.73483],[36.99886,36.74012],[36.99557,36.75997],[36.66727,36.82901],[36.61581,36.74629],[36.62681,36.71189],[36.57398,36.65186],[36.58829,36.58295],[36.54206,36.49539],[36.6081,36.33772],[36.65653,36.33861],[36.68672,36.23677],[36.6125,36.22592],[36.50463,36.2419],[36.4617,36.20461],[36.39206,36.22088],[36.37474,36.01163],[36.33956,35.98687],[36.30099,36.00985],[36.28338,36.00273],[36.29769,35.96086],[36.27678,35.94839],[36.25366,35.96264],[36.19973,35.95195],[36.17441,35.92076],[36.1623,35.80925],[36.14029,35.81015],[36.13919,35.83692],[36.11827,35.85923],[35.99829,35.88242],[36.01844,35.92403],[36.00514,35.94113],[35.98499,35.94107],[35.931,35.92109],[35.51152,36.10954],[35.48515,34.70851],[35.97386,34.63322],[35.98718,34.64977],[36.29165,34.62991],[36.32399,34.69334],[36.35135,34.68516],[36.35384,34.65447],[36.42941,34.62505],[36.46003,34.6378],[36.45299,34.59438],[36.41429,34.61175],[36.39846,34.55672],[36.3369,34.52629],[36.34745,34.5002],[36.4442,34.50165],[36.46179,34.46541],[36.55853,34.41609],[36.53039,34.3798],[36.56556,34.31881],[36.60778,34.31009],[36.58667,34.27667],[36.59195,34.2316],[36.62537,34.20251],[36.5128,34.09916],[36.50576,34.05982],[36.41078,34.05253],[36.28589,33.91981],[36.38263,33.86579],[36.3967,33.83365],[36.14517,33.85118],[36.06778,33.82927],[35.9341,33.6596],[36.05723,33.57904],[35.94465,33.52774],[35.94816,33.47886],[35.88668,33.43183],[35.82577,33.40479],[35.81324,33.36354],[35.77477,33.33609],[35.813,33.3172],[35.77513,33.27342],[35.81295,33.24841],[35.81647,33.2028],[35.83846,33.19397],[35.84285,33.16673],[35.81911,33.1336],[35.81911,33.11077],[35.84802,33.1031],[35.87188,32.98028],[35.89298,32.9456],[35.87012,32.91976],[35.84021,32.8725],[35.83758,32.82817],[35.78745,32.77938],[35.75983,32.74803],[35.88405,32.71321],[35.93307,32.71966],[35.96633,32.66237],[36.02239,32.65911],[36.08074,32.51463],[36.20379,32.52751],[36.20875,32.49529],[36.23948,32.50108],[36.40959,32.37908],[36.83946,32.31293],[38.79171,33.37328],[40.64314,34.31604],[40.97676,34.39788],[41.12388,34.65742],[41.2345,34.80049],[41.21654,35.1508],[41.26569,35.42708],[41.38184,35.62502],[41.37027,35.84095],[41.2564,36.06012],[41.28864,36.35368],[41.40058,36.52502],[41.81736,36.58782],[42.36697,37.0627],[42.35724,37.10998],[42.32313,37.17814],[42.34735,37.22548],[42.2824,37.2798],[42.26039,37.27017],[42.23683,37.2863]]]]}},{type:"Feature",properties:{iso1A2:"SZ",iso1A3:"SWZ",iso1N3:"748",wikidata:"Q1050",nameEn:"Eswatini",aliases:["Swaziland"],groups:["018","202","002","UN"],driveSide:"left",callingCodes:["268"]},geometry:{type:"MultiPolygon",coordinates:[[[[31.86881,-25.99973],[31.4175,-25.71886],[31.31237,-25.7431],[31.13073,-25.91558],[30.95819,-26.26303],[30.78927,-26.48271],[30.81101,-26.84722],[30.88826,-26.79622],[30.97757,-26.92706],[30.96088,-27.0245],[31.15027,-27.20151],[31.49834,-27.31549],[31.97592,-27.31675],[31.97463,-27.11057],[32.00893,-26.8096],[32.09664,-26.80721],[32.13315,-26.84345],[32.13409,-26.5317],[32.07352,-26.40185],[32.10435,-26.15656],[32.08599,-26.00978],[32.00916,-25.999],[31.974,-25.95387],[31.86881,-25.99973]]]]}},{type:"Feature",properties:{iso1A2:"TA",iso1A3:"TAA",wikidata:"Q220982",nameEn:"Tristan da Cunha",aliases:["SH-TA"],country:"GB",groups:["SH","BOTS","011","202","002","UN"],isoStatus:"excRes",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["290 8","44 20"]},geometry:{type:"MultiPolygon",coordinates:[[[[-13.38232,-34.07258],[-16.67337,-41.9188],[-5.88482,-41.4829],[-13.38232,-34.07258]]]]}},{type:"Feature",properties:{iso1A2:"TC",iso1A3:"TCA",iso1N3:"796",wikidata:"Q18221",nameEn:"Turks and Caicos Islands",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 649"]},geometry:{type:"MultiPolygon",coordinates:[[[[-71.70065,25.7637],[-72.98446,20.4801],[-69.80718,21.35956],[-71.70065,25.7637]]]]}},{type:"Feature",properties:{iso1A2:"TD",iso1A3:"TCD",iso1N3:"148",wikidata:"Q657",nameEn:"Chad",groups:["017","202","002","UN"],callingCodes:["235"]},geometry:{type:"MultiPolygon",coordinates:[[[[23.99539,19.49944],[15.99566,23.49639],[14.99751,23.00539],[15.19692,21.99339],[15.20213,21.49365],[15.28332,21.44557],[15.62515,20.95395],[15.57248,20.92138],[15.55382,20.86507],[15.56004,20.79488],[15.59841,20.74039],[15.6721,20.70069],[15.99632,20.35364],[15.75098,19.93002],[15.6032,18.77402],[15.50373,16.89649],[14.37425,15.72591],[13.86301,15.04043],[13.78991,14.87519],[13.809,14.72915],[13.67878,14.64013],[13.68573,14.55276],[13.48259,14.46704],[13.47559,14.40881],[13.6302,13.71094],[14.08251,13.0797],[14.46881,13.08259],[14.56101,12.91036],[14.55058,12.78256],[14.83314,12.62963],[14.90827,12.3269],[14.89019,12.16593],[14.96952,12.0925],[15.00146,12.1223],[15.0349,12.10698],[15.05786,12.0608],[15.04808,11.8731],[15.11579,11.79313],[15.06595,11.71126],[15.13149,11.5537],[15.0585,11.40481],[15.10021,11.04101],[15.04957,11.02347],[15.09127,10.87431],[15.06737,10.80921],[15.15532,10.62846],[15.14936,10.53915],[15.23724,10.47764],[15.30874,10.31063],[15.50535,10.1098],[15.68761,9.99344],[15.41408,9.92876],[15.24618,9.99246],[15.14043,9.99246],[15.05999,9.94845],[14.95722,9.97926],[14.80082,9.93818],[14.4673,10.00264],[14.20411,10.00055],[14.1317,9.82413],[14.01793,9.73169],[13.97544,9.6365],[14.37094,9.2954],[14.35707,9.19611],[14.83566,8.80557],[15.09484,8.65982],[15.20426,8.50892],[15.50743,7.79302],[15.59272,7.7696],[15.56964,7.58936],[15.49743,7.52179],[15.73118,7.52006],[15.79942,7.44149],[16.40703,7.68809],[16.41583,7.77971],[16.58315,7.88657],[16.59415,7.76444],[16.658,7.75353],[16.6668,7.67281],[16.8143,7.53971],[17.67288,7.98905],[17.93926,7.95853],[18.02731,8.01085],[18.6085,8.05009],[18.64153,8.08714],[18.62612,8.14163],[18.67455,8.22226],[18.79783,8.25929],[19.11044,8.68172],[18.86388,8.87971],[19.06421,9.00367],[20.36748,9.11019],[20.82979,9.44696],[21.26348,9.97642],[21.34934,9.95907],[21.52766,10.2105],[21.63553,10.217],[21.71479,10.29932],[21.72139,10.64136],[22.45889,11.00246],[22.87758,10.91915],[22.97249,11.21955],[22.93124,11.41645],[22.7997,11.40424],[22.54907,11.64372],[22.64092,12.07485],[22.48369,12.02766],[22.50548,12.16769],[22.38873,12.45514],[22.46345,12.61925],[22.22684,12.74682],[22.15679,12.66634],[21.98711,12.63292],[21.89371,12.68001],[21.81432,12.81362],[21.94819,13.05637],[22.02914,13.13976],[22.1599,13.19281],[22.29689,13.3731],[22.08674,13.77863],[22.22995,13.96754],[22.5553,14.11704],[22.55997,14.23024],[22.44944,14.24986],[22.38562,14.58907],[22.70474,14.69149],[22.66115,14.86308],[22.99584,15.22989],[22.99584,15.40105],[22.92579,15.47007],[22.93201,15.55107],[23.10792,15.71297],[23.38812,15.69649],[23.62785,15.7804],[23.99997,15.69575],[23.99539,19.49944]]]]}},{type:"Feature",properties:{iso1A2:"TF",iso1A3:"ATF",iso1N3:"260",wikidata:"Q129003",nameEn:"French Southern Territories",country:"FR",groups:["EU","UN"]},geometry:null},{type:"Feature",properties:{iso1A2:"TG",iso1A3:"TGO",iso1N3:"768",wikidata:"Q945",nameEn:"Togo",groups:["011","202","002","UN"],callingCodes:["228"]},geometry:{type:"MultiPolygon",coordinates:[[[[.50388,11.01011],[-.13493,11.14075],[-.14462,11.10811],[-.05733,11.08628],[-.0275,11.11202],[-.00514,11.10763],[.00342,11.08317],[.02395,11.06229],[.03355,10.9807],[-.0063,10.96417],[-.00908,10.91644],[-.02685,10.8783],[-.0228,10.81916],[-.07183,10.76794],[-.07327,10.71845],[-.09141,10.7147],[-.05945,10.63458],[.12886,10.53149],[.18846,10.4096],[.29453,10.41546],[.33028,10.30408],[.39584,10.31112],[.35293,10.09412],[.41371,10.06361],[.41252,10.02018],[.36366,10.03309],[.32075,9.72781],[.34816,9.71607],[.34816,9.66907],[.32313,9.6491],[.28261,9.69022],[.26712,9.66437],[.29334,9.59387],[.36008,9.6256],[.38153,9.58682],[.23851,9.57389],[.2409,9.52335],[.30406,9.521],[.31241,9.50337],[.2254,9.47869],[.25758,9.42696],[.33148,9.44812],[.36485,9.49749],[.49118,9.48339],[.56388,9.40697],[.45424,9.04581],[.52455,8.87746],[.37319,8.75262],[.47211,8.59945],[.64731,8.48866],[.73432,8.29529],[.63897,8.25873],[.5913,8.19622],[.61156,8.18324],[.6056,8.13959],[.58891,8.12779],[.62943,7.85751],[.58295,7.62368],[.51979,7.58706],[.52455,7.45354],[.57223,7.39326],[.62943,7.41099],[.65327,7.31643],[.59606,7.01252],[.52217,6.9723],[.52098,6.94391],[.56508,6.92971],[.52853,6.82921],[.57406,6.80348],[.58176,6.76049],[.6497,6.73682],[.63659,6.63857],[.74862,6.56517],[.71048,6.53083],[.89283,6.33779],[.99652,6.33779],[1.03108,6.24064],[1.05969,6.22998],[1.09187,6.17074],[1.19966,6.17069],[1.19771,6.11522],[1.27574,5.93551],[1.67336,6.02702],[1.62913,6.24075],[1.79826,6.28221],[1.76906,6.43189],[1.58105,6.68619],[1.61812,6.74843],[1.55877,6.99737],[1.64249,6.99562],[1.61838,9.0527],[1.5649,9.16941],[1.41746,9.3226],[1.33675,9.54765],[1.36624,9.5951],[1.35507,9.99525],[.77666,10.37665],[.80358,10.71459],[.8804,10.803],[.91245,10.99597],[.66104,10.99964],[.4958,10.93269],[.50521,10.98035],[.48852,10.98561],[.50388,11.01011]]]]}},{type:"Feature",properties:{iso1A2:"TH",iso1A3:"THA",iso1N3:"764",wikidata:"Q869",nameEn:"Thailand",groups:["035","142","UN"],driveSide:"left",callingCodes:["66"]},geometry:{type:"MultiPolygon",coordinates:[[[[100.08404,20.36626],[99.95721,20.46301],[99.91616,20.44986],[99.90499,20.4487],[99.89692,20.44789],[99.89301,20.44311],[99.89168,20.44548],[99.88451,20.44596],[99.88211,20.44488],[99.86383,20.44371],[99.81096,20.33687],[99.68255,20.32077],[99.46008,20.39673],[99.46077,20.36198],[99.5569,20.20676],[99.52943,20.14811],[99.416,20.08614],[99.20328,20.12877],[99.0735,20.10298],[98.98679,19.7419],[98.83661,19.80931],[98.56065,19.67807],[98.51182,19.71303],[98.24884,19.67876],[98.13829,19.78541],[98.03314,19.80941],[98.04364,19.65755],[97.84715,19.55782],[97.88423,19.5041],[97.78769,19.39429],[97.84186,19.29526],[97.78606,19.26769],[97.84024,19.22217],[97.83479,19.09972],[97.73797,19.04261],[97.73654,18.9812],[97.66487,18.9371],[97.73836,18.88478],[97.76752,18.58097],[97.5258,18.4939],[97.36444,18.57138],[97.34522,18.54596],[97.50383,18.26844],[97.56219,18.33885],[97.64116,18.29778],[97.60841,18.23846],[97.73723,17.97912],[97.66794,17.88005],[97.76407,17.71595],[97.91829,17.54504],[98.11185,17.36829],[98.10439,17.33847],[98.34566,17.04822],[98.39441,17.06266],[98.52624,16.89979],[98.49603,16.8446],[98.53833,16.81934],[98.46994,16.73613],[98.50253,16.7139],[98.49713,16.69022],[98.51043,16.70107],[98.51579,16.69433],[98.51472,16.68521],[98.51833,16.676],[98.51113,16.64503],[98.5695,16.62826],[98.57912,16.55983],[98.63817,16.47424],[98.68074,16.27068],[98.84485,16.42354],[98.92656,16.36425],[98.8376,16.11706],[98.69585,16.13353],[98.57019,16.04578],[98.59853,15.87197],[98.541,15.65406],[98.58598,15.46821],[98.56027,15.33471],[98.4866,15.39154],[98.39351,15.34177],[98.41906,15.27103],[98.40522,15.25268],[98.30446,15.30667],[98.22,15.21327],[98.18821,15.13125],[98.24874,14.83013],[98.56762,14.37701],[98.97356,14.04868],[99.16695,13.72621],[99.20617,13.20575],[99.12225,13.19847],[99.10646,13.05804],[99.18748,12.9898],[99.18905,12.84799],[99.29254,12.68921],[99.409,12.60603],[99.47519,12.1353],[99.56445,12.14805],[99.53424,12.02317],[99.64891,11.82699],[99.64108,11.78948],[99.5672,11.62732],[99.47598,11.62434],[99.39485,11.3925],[99.31573,11.32081],[99.32756,11.28545],[99.06938,10.94857],[99.02337,10.97217],[98.99701,10.92962],[99.0069,10.85485],[98.86819,10.78336],[98.78511,10.68351],[98.77275,10.62548],[98.81944,10.52761],[98.7391,10.31488],[98.55174,9.92804],[98.52291,9.92389],[98.47298,9.95782],[98.33094,9.91973],[98.12555,9.44056],[97.63455,9.60854],[97.19814,8.18901],[99.31854,5.99868],[99.50117,6.44501],[99.91873,6.50233],[100.0756,6.4045],[100.12,6.42105],[100.19511,6.72559],[100.29651,6.68439],[100.30828,6.66462],[100.31618,6.66781],[100.31884,6.66423],[100.32671,6.66526],[100.32607,6.65933],[100.31929,6.65413],[100.35413,6.54932],[100.41152,6.52299],[100.41791,6.5189],[100.42351,6.51762],[100.43027,6.52389],[100.66986,6.45086],[100.74361,6.50811],[100.74822,6.46231],[100.81045,6.45086],[100.85884,6.24929],[101.10313,6.25617],[101.12618,6.19431],[101.06165,6.14161],[101.12388,6.11411],[101.087,5.9193],[101.02708,5.91013],[100.98815,5.79464],[101.14062,5.61613],[101.25755,5.71065],[101.25524,5.78633],[101.58019,5.93534],[101.69773,5.75881],[101.75074,5.79091],[101.80144,5.74505],[101.89188,5.8386],[101.91776,5.84269],[101.92819,5.85511],[101.94712,5.98421],[101.9714,6.00575],[101.97114,6.01992],[101.99209,6.04075],[102.01835,6.05407],[102.09182,6.14161],[102.07732,6.193],[102.08127,6.22679],[102.09086,6.23546],[102.46318,7.22462],[102.47649,9.66162],[102.52395,11.25257],[102.91449,11.65512],[102.90973,11.75613],[102.83957,11.8519],[102.78427,11.98746],[102.77026,12.06815],[102.70176,12.1686],[102.73134,12.37091],[102.78116,12.40284],[102.7796,12.43781],[102.57567,12.65358],[102.51963,12.66117],[102.4994,12.71736],[102.53053,12.77506],[102.49335,12.92711],[102.48694,12.97537],[102.52275,12.99813],[102.46011,13.08057],[102.43422,13.09061],[102.36146,13.26006],[102.36001,13.31142],[102.34611,13.35618],[102.35692,13.38274],[102.35563,13.47307],[102.361,13.50551],[102.33828,13.55613],[102.36859,13.57488],[102.44601,13.5637],[102.5358,13.56933],[102.57573,13.60461],[102.62483,13.60883],[102.58635,13.6286],[102.5481,13.6589],[102.56848,13.69366],[102.72727,13.77806],[102.77864,13.93374],[102.91251,14.01531],[102.93275,14.19044],[103.16469,14.33075],[103.39353,14.35639],[103.53518,14.42575],[103.71109,14.4348],[103.70175,14.38052],[103.93836,14.3398],[104.27616,14.39861],[104.55014,14.36091],[104.69335,14.42726],[104.97667,14.38806],[105.02804,14.23722],[105.08408,14.20402],[105.14012,14.23873],[105.17748,14.34432],[105.20894,14.34967],[105.43783,14.43865],[105.53864,14.55731],[105.5121,14.80802],[105.61162,15.00037],[105.46661,15.13132],[105.58043,15.32724],[105.50662,15.32054],[105.4692,15.33709],[105.47635,15.3796],[105.58191,15.41031],[105.60446,15.53301],[105.61756,15.68792],[105.46573,15.74742],[105.42285,15.76971],[105.37959,15.84074],[105.34115,15.92737],[105.38508,15.987],[105.42001,16.00657],[105.06204,16.09792],[105.00262,16.25627],[104.88057,16.37311],[104.73349,16.565],[104.76099,16.69302],[104.7397,16.81005],[104.76442,16.84752],[104.7373,16.91125],[104.73712,17.01404],[104.80716,17.19025],[104.80061,17.39367],[104.69867,17.53038],[104.45404,17.66788],[104.35432,17.82871],[104.2757,17.86139],[104.21776,17.99335],[104.10927,18.10826],[104.06533,18.21656],[103.97725,18.33631],[103.93916,18.33914],[103.85642,18.28666],[103.82449,18.33979],[103.699,18.34125],[103.60957,18.40528],[103.47773,18.42841],[103.41044,18.4486],[103.30977,18.4341],[103.24779,18.37807],[103.23818,18.34875],[103.29757,18.30475],[103.17093,18.2618],[103.14994,18.23172],[103.1493,18.17799],[103.07343,18.12351],[103.07823,18.03833],[103.0566,18.00144],[103.01998,17.97095],[102.9912,17.9949],[102.95812,18.0054],[102.86323,17.97531],[102.81988,17.94233],[102.79044,17.93612],[102.75954,17.89561],[102.68538,17.86653],[102.67543,17.84529],[102.69946,17.81686],[102.68194,17.80151],[102.59485,17.83537],[102.5896,17.84889],[102.61432,17.92273],[102.60971,17.95411],[102.59234,17.96127],[102.45523,17.97106],[102.11359,18.21532],[101.88485,18.02474],[101.78087,18.07559],[101.72294,17.92867],[101.44667,17.7392],[101.15108,17.47586],[100.96541,17.57926],[101.02185,17.87637],[101.1793,18.0544],[101.19118,18.2125],[101.15108,18.25624],[101.18227,18.34367],[101.06047,18.43247],[101.27585,18.68875],[101.22832,18.73377],[101.25803,18.89545],[101.35606,19.04716],[101.261,19.12717],[101.24911,19.33334],[101.20604,19.35296],[101.21347,19.46223],[101.26991,19.48324],[101.26545,19.59242],[101.08928,19.59748],[100.90302,19.61901],[100.77231,19.48324],[100.64606,19.55884],[100.58219,19.49164],[100.49604,19.53504],[100.398,19.75047],[100.5094,19.87904],[100.58808,20.15791],[100.55218,20.17741],[100.51052,20.14928],[100.47567,20.19133],[100.4537,20.19971],[100.44992,20.23644],[100.41473,20.25625],[100.37439,20.35156],[100.33383,20.4028],[100.25769,20.3992],[100.22076,20.31598],[100.16668,20.2986],[100.1712,20.24324],[100.11785,20.24787],[100.09337,20.26293],[100.09999,20.31614],[100.08404,20.36626]]]]}},{type:"Feature",properties:{iso1A2:"TJ",iso1A3:"TJK",iso1N3:"762",wikidata:"Q863",nameEn:"Tajikistan",groups:["143","142","UN"],callingCodes:["992"]},geometry:{type:"MultiPolygon",coordinates:[[[[70.45251,41.04438],[70.38028,41.02014],[70.36655,40.90296],[69.69434,40.62615],[69.59441,40.70181],[69.53021,40.77621],[69.38327,40.7918],[69.32834,40.70233],[69.3455,40.57988],[69.2643,40.57506],[69.21063,40.54469],[69.27066,40.49274],[69.28525,40.41894],[69.30774,40.36102],[69.33794,40.34819],[69.32833,40.29794],[69.30808,40.2821],[69.24817,40.30357],[69.25229,40.26362],[69.30104,40.24502],[69.30448,40.18774],[69.2074,40.21488],[69.15659,40.2162],[69.04544,40.22904],[68.85832,40.20885],[68.84357,40.18604],[68.79276,40.17555],[68.77902,40.20492],[68.5332,40.14826],[68.52771,40.11676],[68.62796,40.07789],[69.01523,40.15771],[69.01935,40.11466],[68.96579,40.06949],[68.84906,40.04952],[68.93695,39.91167],[68.88889,39.87163],[68.63071,39.85265],[68.61972,39.68905],[68.54166,39.53929],[68.12053,39.56317],[67.70992,39.66156],[67.62889,39.60234],[67.44899,39.57799],[67.46547,39.53564],[67.39681,39.52505],[67.46822,39.46146],[67.45998,39.315],[67.36522,39.31287],[67.33226,39.23739],[67.67833,39.14479],[67.68915,39.00775],[68.09704,39.02589],[68.19743,38.85985],[68.06948,38.82115],[68.12877,38.73677],[68.05598,38.71641],[68.0807,38.64136],[68.05873,38.56087],[68.11366,38.47169],[68.06274,38.39435],[68.13289,38.40822],[68.40343,38.19484],[68.27159,37.91477],[68.12635,37.93],[67.81566,37.43107],[67.8474,37.31594],[67.78329,37.1834],[67.7803,37.08978],[67.87917,37.0591],[68.02194,36.91923],[68.18542,37.02074],[68.27605,37.00977],[68.29253,37.10621],[68.41201,37.10402],[68.41888,37.13906],[68.61851,37.19815],[68.6798,37.27906],[68.81438,37.23862],[68.80889,37.32494],[68.91189,37.26704],[68.88168,37.33368],[68.96407,37.32603],[69.03274,37.25174],[69.25152,37.09426],[69.39529,37.16752],[69.45022,37.23315],[69.36645,37.40462],[69.44954,37.4869],[69.51888,37.5844],[69.80041,37.5746],[69.84435,37.60616],[69.93362,37.61378],[69.95971,37.5659],[70.15015,37.52519],[70.28243,37.66706],[70.27694,37.81258],[70.1863,37.84296],[70.17206,37.93276],[70.4898,38.12546],[70.54673,38.24541],[70.60407,38.28046],[70.61526,38.34774],[70.64966,38.34999],[70.69189,38.37031],[70.6761,38.39144],[70.67438,38.40597],[70.69807,38.41861],[70.72485,38.4131],[70.75455,38.4252],[70.77132,38.45548],[70.78581,38.45502],[70.78702,38.45031],[70.79766,38.44944],[70.80521,38.44447],[70.81697,38.44507],[70.82538,38.45394],[70.84376,38.44688],[70.88719,38.46826],[70.92728,38.43021],[70.98693,38.48862],[71.03545,38.44779],[71.0556,38.40176],[71.09542,38.42517],[71.10592,38.42077],[71.10957,38.40671],[71.1451,38.40106],[71.21291,38.32797],[71.33114,38.30339],[71.33869,38.27335],[71.37803,38.25641],[71.36444,38.15358],[71.29878,38.04429],[71.28922,38.01272],[71.27622,37.99946],[71.27278,37.96496],[71.24969,37.93031],[71.2809,37.91995],[71.296,37.93403],[71.32871,37.88564],[71.51565,37.95349],[71.58843,37.92425],[71.59255,37.79956],[71.55752,37.78677],[71.54324,37.77104],[71.53053,37.76534],[71.55234,37.73209],[71.54186,37.69691],[71.51972,37.61945],[71.5065,37.60912],[71.49693,37.53527],[71.50616,37.50733],[71.5256,37.47971],[71.49612,37.4279],[71.47685,37.40281],[71.4862,37.33405],[71.49821,37.31975],[71.50674,37.31502],[71.48536,37.26017],[71.4824,37.24921],[71.48339,37.23937],[71.47386,37.2269],[71.4555,37.21418],[71.4494,37.18137],[71.44127,37.11856],[71.43097,37.05855],[71.45578,37.03094],[71.46923,36.99925],[71.48481,36.93218],[71.51502,36.89128],[71.57195,36.74943],[71.67083,36.67346],[71.83229,36.68084],[72.31676,36.98115],[72.54095,37.00007],[72.66381,37.02014],[72.79693,37.22222],[73.06884,37.31729],[73.29633,37.46495],[73.77197,37.4417],[73.76647,37.33913],[73.61129,37.27469],[73.64974,37.23643],[73.82552,37.22659],[73.8564,37.26158],[74.20308,37.34208],[74.23339,37.41116],[74.41055,37.3948],[74.56161,37.37734],[74.68383,37.3948],[74.8294,37.3435],[74.88887,37.23275],[75.12328,37.31839],[75.09719,37.37297],[75.15899,37.41443],[75.06011,37.52779],[74.94338,37.55501],[74.8912,37.67576],[75.00935,37.77486],[74.92416,37.83428],[74.9063,38.03033],[74.82665,38.07359],[74.80331,38.19889],[74.69894,38.22155],[74.69619,38.42947],[74.51217,38.47034],[74.17022,38.65504],[73.97933,38.52945],[73.79806,38.61106],[73.80656,38.66449],[73.7033,38.84782],[73.7445,38.93867],[73.82964,38.91517],[73.81728,39.04007],[73.75823,39.023],[73.60638,39.24534],[73.54572,39.27567],[73.55396,39.3543],[73.5004,39.38402],[73.59241,39.40843],[73.59831,39.46425],[73.45096,39.46677],[73.31912,39.38615],[73.18454,39.35536],[72.85934,39.35116],[72.62027,39.39696],[72.33173,39.33093],[72.23834,39.17248],[72.17242,39.2661],[72.09689,39.26823],[72.04059,39.36704],[71.90601,39.27674],[71.79202,39.27355],[71.7522,39.32031],[71.80164,39.40631],[71.76816,39.45456],[71.62688,39.44056],[71.5517,39.45722],[71.55856,39.57588],[71.49814,39.61397],[71.08752,39.50704],[71.06418,39.41586],[70.7854,39.38933],[70.64087,39.58792],[70.44757,39.60128],[70.2869,39.53141],[70.11111,39.58223],[69.87491,39.53882],[69.68677,39.59281],[69.3594,39.52516],[69.26938,39.8127],[69.35649,40.01994],[69.43134,39.98431],[69.43557,39.92877],[69.53615,39.93991],[69.5057,40.03277],[69.53855,40.0887],[69.53794,40.11833],[69.55555,40.12296],[69.57615,40.10524],[69.64704,40.12165],[69.67001,40.10639],[70.01283,40.23288],[70.58297,40.00891],[70.57384,39.99394],[70.47557,39.93216],[70.55033,39.96619],[70.58912,39.95211],[70.65946,39.9878],[70.65827,40.0981],[70.7928,40.12797],[70.80495,40.16813],[70.9818,40.22392],[70.8607,40.217],[70.62342,40.17396],[70.56394,40.26421],[70.57149,40.3442],[70.37511,40.38605],[70.32626,40.45174],[70.49871,40.52503],[70.80009,40.72825],[70.45251,41.04438]]],[[[70.68112,40.90612],[70.6158,40.97661],[70.56077,41.00642],[70.54223,40.98787],[70.57501,40.98941],[70.6721,40.90555],[70.68112,40.90612]]],[[[70.74189,39.86319],[70.53651,39.89155],[70.52631,39.86989],[70.54998,39.85137],[70.59667,39.83542],[70.63105,39.77923],[70.74189,39.86319]]]]}},{type:"Feature",properties:{iso1A2:"TK",iso1A3:"TKL",iso1N3:"772",wikidata:"Q36823",nameEn:"Tokelau",country:"NZ",groups:["061","009","UN"],driveSide:"left",callingCodes:["690"]},geometry:{type:"MultiPolygon",coordinates:[[[[-168.251,-9.44289],[-174.18635,-7.80441],[-174.17993,-10.13616],[-168.251,-9.44289]]]]}},{type:"Feature",properties:{iso1A2:"TL",iso1A3:"TLS",iso1N3:"626",wikidata:"Q574",nameEn:"East Timor",aliases:["Timor-Leste","TP"],groups:["035","142","UN"],driveSide:"left",callingCodes:["670"]},geometry:{type:"MultiPolygon",coordinates:[[[[124.46701,-9.13002],[124.94011,-8.85617],[124.97742,-9.08128],[125.11764,-8.96359],[125.18632,-9.03142],[125.18907,-9.16434],[125.09434,-9.19669],[125.04044,-9.17093],[124.97892,-9.19281],[125.09025,-9.46406],[125.68138,-9.85176],[127.55165,-9.05052],[127.42116,-8.22471],[125.87691,-8.31789],[125.58506,-7.95311],[124.92337,-8.75859],[124.33472,-9.11416],[124.04628,-9.22671],[124.04286,-9.34243],[124.10539,-9.41206],[124.14517,-9.42324],[124.21247,-9.36904],[124.28115,-9.42189],[124.28115,-9.50453],[124.3535,-9.48493],[124.35258,-9.43002],[124.38554,-9.3582],[124.45971,-9.30263],[124.46701,-9.13002]]]]}},{type:"Feature",properties:{iso1A2:"TM",iso1A3:"TKM",iso1N3:"795",wikidata:"Q874",nameEn:"Turkmenistan",groups:["143","142","UN"],callingCodes:["993"]},geometry:{type:"MultiPolygon",coordinates:[[[[60.5078,41.21694],[60.06581,41.4363],[60.18117,41.60082],[60.06032,41.76287],[60.08504,41.80997],[60.33223,41.75058],[59.95046,41.97966],[60.0356,42.01028],[60.04659,42.08982],[59.96419,42.1428],[60.00539,42.212],[59.94633,42.27655],[59.4341,42.29738],[59.2955,42.37064],[59.17317,42.52248],[58.93422,42.5407],[58.6266,42.79314],[58.57991,42.64988],[58.27504,42.69632],[58.14321,42.62159],[58.29427,42.56497],[58.51674,42.30348],[58.40688,42.29535],[58.3492,42.43335],[57.99214,42.50021],[57.90975,42.4374],[57.92897,42.24047],[57.84932,42.18555],[57.6296,42.16519],[57.30275,42.14076],[57.03633,41.92043],[56.96218,41.80383],[57.03359,41.41777],[57.13796,41.36625],[57.03423,41.25435],[56.00314,41.32584],[55.45471,41.25609],[54.95182,41.92424],[54.20635,42.38477],[52.97575,42.1308],[52.47884,41.78034],[52.26048,41.69249],[51.7708,40.29239],[53.89734,37.3464],[54.24565,37.32047],[54.36211,37.34912],[54.58664,37.45809],[54.67247,37.43532],[54.77822,37.51597],[54.81804,37.61285],[54.77684,37.62264],[54.851,37.75739],[55.13412,37.94705],[55.44152,38.08564],[55.76561,38.12238],[55.97847,38.08024],[56.33278,38.08132],[56.32454,38.18502],[56.43303,38.26054],[56.62255,38.24005],[56.73928,38.27887],[57.03453,38.18717],[57.21169,38.28965],[57.37236,38.09321],[57.35042,37.98546],[57.79534,37.89299],[58.21399,37.77281],[58.22999,37.6856],[58.39959,37.63134],[58.47786,37.6433],[58.5479,37.70526],[58.6921,37.64548],[58.9338,37.67374],[59.22905,37.51161],[59.33507,37.53146],[59.39797,37.47892],[59.39385,37.34257],[59.55178,37.13594],[59.74678,37.12499],[60.00768,37.04102],[60.34767,36.63214],[61.14516,36.64644],[61.18187,36.55348],[61.1393,36.38782],[61.22719,36.12759],[61.12007,35.95992],[61.22444,35.92879],[61.26152,35.80749],[61.22719,35.67038],[61.27371,35.61482],[61.58742,35.43803],[61.77693,35.41341],[61.97743,35.4604],[62.05709,35.43803],[62.15871,35.33278],[62.29191,35.25964],[62.29878,35.13312],[62.48006,35.28796],[62.62288,35.22067],[62.74098,35.25432],[62.90853,35.37086],[63.0898,35.43131],[63.12276,35.53196],[63.10079,35.63024],[63.23262,35.67487],[63.10318,35.81782],[63.12276,35.86208],[63.29579,35.85985],[63.53475,35.90881],[63.56496,35.95106],[63.98519,36.03773],[64.05385,36.10433],[64.43288,36.24401],[64.57295,36.34362],[64.62514,36.44311],[64.61141,36.6351],[64.97945,37.21913],[65.51778,37.23881],[65.64263,37.34388],[65.64137,37.45061],[65.72274,37.55438],[66.30993,37.32409],[66.55743,37.35409],[66.52303,37.39827],[66.65761,37.45497],[66.52852,37.58568],[66.53676,37.80084],[66.67684,37.96776],[66.56697,38.0435],[66.41042,38.02403],[66.24013,38.16238],[65.83913,38.25733],[65.55873,38.29052],[64.32576,38.98691],[64.19086,38.95561],[63.70778,39.22349],[63.6913,39.27666],[62.43337,39.98528],[62.34273,40.43206],[62.11751,40.58242],[61.87856,41.12257],[61.4446,41.29407],[61.39732,41.19873],[61.33199,41.14946],[61.22212,41.14946],[61.03261,41.25691],[60.5078,41.21694]]]]}},{type:"Feature",properties:{iso1A2:"TN",iso1A3:"TUN",iso1N3:"788",wikidata:"Q948",nameEn:"Tunisia",groups:["015","002","UN"],callingCodes:["216"]},geometry:{type:"MultiPolygon",coordinates:[[[[11.2718,37.6713],[7.89009,38.19924],[8.59123,37.14286],[8.64044,36.9401],[8.62972,36.86499],[8.67706,36.8364],[8.57613,36.78062],[8.46537,36.7706],[8.47609,36.66607],[8.16167,36.48817],[8.18936,36.44939],[8.40731,36.42208],[8.2626,35.91733],[8.26472,35.73669],[8.35371,35.66373],[8.36086,35.47774],[8.30329,35.29884],[8.47318,35.23376],[8.3555,35.10007],[8.30727,34.95378],[8.25189,34.92009],[8.29655,34.72798],[8.20482,34.57575],[7.86264,34.3987],[7.81242,34.21841],[7.74207,34.16492],[7.66174,34.20167],[7.52851,34.06493],[7.54088,33.7726],[7.73687,33.42114],[7.83028,33.18851],[8.11433,33.10175],[8.1179,33.05086],[8.31895,32.83483],[8.35999,32.50101],[9.07483,32.07865],[9.55544,30.23971],[9.76848,30.34366],[9.88152,30.34074],[10.29516,30.90337],[10.12239,31.42098],[10.31364,31.72648],[10.48497,31.72956],[10.62788,31.96629],[10.7315,31.97235],[11.04234,32.2145],[11.53898,32.4138],[11.57828,32.48013],[11.46037,32.6307],[11.51549,33.09826],[11.55852,33.1409],[11.58941,33.36891],[11.2718,37.6713]]]]}},{type:"Feature",properties:{iso1A2:"TO",iso1A3:"TON",iso1N3:"776",wikidata:"Q678",nameEn:"Tonga",groups:["061","009","UN"],driveSide:"left",callingCodes:["676"]},geometry:{type:"MultiPolygon",coordinates:[[[[-176.74538,-22.89767],[-180,-22.90585],[-180,-24.21376],[-173.10761,-24.19665],[-173.13438,-14.94228],[-176.76826,-14.95183],[-176.74538,-22.89767]]]]}},{type:"Feature",properties:{iso1A2:"TR",iso1A3:"TUR",iso1N3:"792",wikidata:"Q43",nameEn:"Turkey",groups:["145","142","UN"],callingCodes:["90"]},geometry:{type:"MultiPolygon",coordinates:[[[[41.54366,41.52185],[40.89217,41.72528],[34.8305,42.4581],[28.32297,41.98371],[28.02971,41.98066],[27.91479,41.97902],[27.83492,41.99709],[27.81235,41.94803],[27.69949,41.97515],[27.55191,41.90928],[27.52379,41.93756],[27.45478,41.96591],[27.27411,42.10409],[27.22376,42.10152],[27.19251,42.06028],[27.08486,42.08735],[27.03277,42.0809],[26.95638,42.00741],[26.79143,41.97386],[26.62996,41.97644],[26.56051,41.92995],[26.57961,41.90024],[26.53968,41.82653],[26.36952,41.82265],[26.33589,41.76802],[26.32952,41.73637],[26.35957,41.71149],[26.47958,41.67037],[26.5209,41.62592],[26.59196,41.60491],[26.59742,41.48058],[26.61767,41.42281],[26.62997,41.34613],[26.5837,41.32131],[26.5209,41.33993],[26.39861,41.25053],[26.32259,41.24929],[26.31928,41.07386],[26.3606,41.02027],[26.33297,40.98388],[26.35894,40.94292],[26.32259,40.94042],[26.28623,40.93005],[26.29441,40.89119],[26.26169,40.9168],[26.20856,40.86048],[26.21351,40.83298],[26.15685,40.80709],[26.12854,40.77339],[26.12495,40.74283],[26.08638,40.73214],[26.0754,40.72772],[26.03489,40.73051],[25.94795,40.72797],[26.04292,40.3958],[25.61285,40.17161],[25.94257,39.39358],[26.43357,39.43096],[26.70773,39.0312],[26.61814,38.81372],[26.21136,38.65436],[26.32173,38.48731],[26.24183,38.44695],[26.21136,38.17558],[27.05537,37.9131],[27.16428,37.72343],[26.99377,37.69034],[26.95583,37.64989],[27.14757,37.32],[27.20312,36.94571],[27.45627,36.9008],[27.24613,36.71622],[27.46117,36.53789],[27.89482,36.69898],[27.95037,36.46155],[28.23708,36.56812],[29.30783,36.01033],[29.48192,36.18377],[29.61002,36.1731],[29.61805,36.14179],[29.69611,36.10365],[29.73302,35.92555],[32.82353,35.70297],[35.51152,36.10954],[35.931,35.92109],[35.98499,35.94107],[36.00514,35.94113],[36.01844,35.92403],[35.99829,35.88242],[36.11827,35.85923],[36.13919,35.83692],[36.14029,35.81015],[36.1623,35.80925],[36.17441,35.92076],[36.19973,35.95195],[36.25366,35.96264],[36.27678,35.94839],[36.29769,35.96086],[36.28338,36.00273],[36.30099,36.00985],[36.33956,35.98687],[36.37474,36.01163],[36.39206,36.22088],[36.4617,36.20461],[36.50463,36.2419],[36.6125,36.22592],[36.68672,36.23677],[36.65653,36.33861],[36.6081,36.33772],[36.54206,36.49539],[36.58829,36.58295],[36.57398,36.65186],[36.62681,36.71189],[36.61581,36.74629],[36.66727,36.82901],[36.99557,36.75997],[36.99886,36.74012],[37.04399,36.73483],[37.04619,36.71101],[37.01647,36.69512],[37.02088,36.66422],[37.08279,36.63495],[37.10894,36.6704],[37.16177,36.66069],[37.21988,36.6736],[37.47253,36.63243],[37.49103,36.66904],[37.68048,36.75065],[37.81974,36.76055],[38.21064,36.91842],[38.38859,36.90064],[38.55908,36.84429],[38.74042,36.70629],[39.03217,36.70911],[39.21538,36.66834],[39.81589,36.75538],[40.69136,37.0996],[40.90856,37.13147],[41.21937,37.07665],[41.515,37.08084],[42.00894,37.17209],[42.18225,37.28569],[42.19301,37.31323],[42.2112,37.32491],[42.22257,37.31395],[42.22381,37.30238],[42.20454,37.28715],[42.21548,37.28026],[42.23683,37.2863],[42.26039,37.27017],[42.2824,37.2798],[42.34735,37.22548],[42.32313,37.17814],[42.35724,37.10998],[42.56725,37.14878],[42.78887,37.38615],[42.93705,37.32015],[43.11403,37.37436],[43.30083,37.30629],[43.33508,37.33105],[43.50787,37.24436],[43.56702,37.25675],[43.63085,37.21957],[43.7009,37.23692],[43.8052,37.22825],[43.82699,37.19477],[43.84878,37.22205],[43.90949,37.22453],[44.02002,37.33229],[44.13521,37.32486],[44.2613,37.25055],[44.27998,37.16501],[44.22239,37.15756],[44.18503,37.09551],[44.25975,36.98119],[44.30645,36.97373],[44.35937,37.02843],[44.35315,37.04955],[44.38117,37.05825],[44.42631,37.05825],[44.63179,37.19229],[44.76698,37.16162],[44.78319,37.1431],[44.7868,37.16644],[44.75986,37.21549],[44.81021,37.2915],[44.58449,37.45018],[44.61401,37.60165],[44.56887,37.6429],[44.62096,37.71985],[44.55498,37.783],[44.45948,37.77065],[44.3883,37.85433],[44.22509,37.88859],[44.42476,38.25763],[44.50115,38.33939],[44.44386,38.38295],[44.38309,38.36117],[44.3119,38.37887],[44.3207,38.49799],[44.32058,38.62752],[44.28065,38.6465],[44.26155,38.71427],[44.30322,38.81581],[44.18863,38.93881],[44.20946,39.13975],[44.1043,39.19842],[44.03667,39.39223],[44.22452,39.4169],[44.29818,39.378],[44.37921,39.4131],[44.42832,39.4131],[44.41849,39.56659],[44.48111,39.61579],[44.47298,39.68788],[44.6137,39.78393],[44.65422,39.72163],[44.71806,39.71124],[44.81043,39.62677],[44.80977,39.65768],[44.75779,39.7148],[44.61845,39.8281],[44.46635,39.97733],[44.26973,40.04866],[44.1778,40.02845],[44.1057,40.03555],[43.92307,40.01787],[43.65688,40.11199],[43.65221,40.14889],[43.71136,40.16673],[43.59928,40.34019],[43.60862,40.43267],[43.54791,40.47413],[43.63664,40.54159],[43.7425,40.66805],[43.74872,40.7365],[43.67712,40.84846],[43.67712,40.93084],[43.58683,40.98961],[43.47319,41.02251],[43.44984,41.0988],[43.4717,41.12611],[43.44973,41.17666],[43.36118,41.2028],[43.23096,41.17536],[43.1945,41.25242],[43.13373,41.25503],[43.21707,41.30331],[43.02956,41.37891],[42.8785,41.50516],[42.84899,41.47265],[42.78995,41.50126],[42.84471,41.58912],[42.72794,41.59714],[42.59202,41.58183],[42.51772,41.43606],[42.26387,41.49346],[41.95134,41.52466],[41.81939,41.43621],[41.7124,41.47417],[41.7148,41.4932],[41.54366,41.52185]]]]}},{type:"Feature",properties:{iso1A2:"TT",iso1A3:"TTO",iso1N3:"780",wikidata:"Q754",nameEn:"Trinidad and Tobago",groups:["029","003","419","019","UN"],driveSide:"left",callingCodes:["1 868"]},geometry:{type:"MultiPolygon",coordinates:[[[[-61.62505,11.18974],[-62.08693,10.04435],[-60.89962,9.81445],[-60.07172,11.77667],[-61.62505,11.18974]]]]}},{type:"Feature",properties:{iso1A2:"TV",iso1A3:"TUV",iso1N3:"798",wikidata:"Q672",nameEn:"Tuvalu",groups:["061","009","UN"],driveSide:"left",callingCodes:["688"]},geometry:{type:"MultiPolygon",coordinates:[[[[174,-5],[174,-11.5],[179.99999,-11.5],[179.99999,-5],[174,-5]]]]}},{type:"Feature",properties:{iso1A2:"TW",iso1A3:"TWN",iso1N3:"158",wikidata:"Q865",nameEn:"Taiwan",aliases:["RC"],groups:["030","142"],callingCodes:["886"]},geometry:{type:"MultiPolygon",coordinates:[[[[121.8109,21.77688],[122.26612,25.98197],[120.5128,26.536],[120.0693,26.3959],[119.78816,26.2348],[119.98511,25.37624],[119.42295,25.0886],[118.6333,24.46259],[118.42453,24.54644],[118.35291,24.51645],[118.28244,24.51231],[118.11703,24.39734],[120.69238,21.52331],[121.8109,21.77688]]]]}},{type:"Feature",properties:{iso1A2:"TZ",iso1A3:"TZA",iso1N3:"834",wikidata:"Q924",nameEn:"Tanzania",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["255"]},geometry:{type:"MultiPolygon",coordinates:[[[[30.80408,-.99911],[30.76635,-.9852],[30.70631,-1.01175],[30.64166,-1.06601],[30.47194,-1.0555],[30.45116,-1.10641],[30.50889,-1.16412],[30.57123,-1.33264],[30.71974,-1.43244],[30.84079,-1.64652],[30.80802,-1.91477],[30.89303,-2.08223],[30.83915,-2.35795],[30.54501,-2.41404],[30.41789,-2.66266],[30.52747,-2.65841],[30.40662,-2.86151],[30.4987,-2.9573],[30.57926,-2.89791],[30.6675,-2.98987],[30.83823,-2.97837],[30.84165,-3.25152],[30.45915,-3.56532],[30.22042,-4.01738],[30.03323,-4.26631],[29.88172,-4.35743],[29.82885,-4.36153],[29.77289,-4.41733],[29.75109,-4.45836],[29.63827,-4.44681],[29.43673,-4.44845],[29.52552,-6.2731],[30.2567,-7.14121],[30.79243,-8.27382],[31.00796,-8.58615],[31.37533,-8.60769],[31.57147,-8.70619],[31.57147,-8.81388],[31.71158,-8.91386],[31.81587,-8.88618],[31.94663,-8.93846],[31.94196,-9.02303],[31.98866,-9.07069],[32.08206,-9.04609],[32.16146,-9.05993],[32.25486,-9.13371],[32.43543,-9.11988],[32.49147,-9.14754],[32.53661,-9.24281],[32.75611,-9.28583],[32.76233,-9.31963],[32.95389,-9.40138],[32.99397,-9.36712],[33.14925,-9.49322],[33.31581,-9.48554],[33.48052,-9.62442],[33.76677,-9.58516],[33.93298,-9.71647],[33.9638,-9.62206],[33.95829,-9.54066],[34.03865,-9.49398],[34.54499,-10.0678],[34.51911,-10.12279],[34.57581,-10.56271],[34.65946,-10.6828],[34.67047,-10.93796],[34.61161,-11.01611],[34.63305,-11.11731],[34.79375,-11.32245],[34.91153,-11.39799],[34.96296,-11.57354],[35.63599,-11.55927],[35.82767,-11.41081],[36.19094,-11.57593],[36.19094,-11.70008],[36.62068,-11.72884],[36.80309,-11.56836],[37.3936,-11.68949],[37.76614,-11.53352],[37.8388,-11.3123],[37.93618,-11.26228],[38.21598,-11.27289],[38.47258,-11.4199],[38.88996,-11.16978],[39.24395,-11.17433],[39.58249,-10.96043],[40.00295,-10.80255],[40.44265,-10.4618],[40.74206,-10.25691],[40.14328,-4.64201],[39.62121,-4.68136],[39.44306,-4.93877],[39.21631,-4.67835],[37.81321,-3.69179],[37.75036,-3.54243],[37.63099,-3.50723],[37.5903,-3.42735],[37.71745,-3.304],[37.67199,-3.06222],[34.0824,-1.02264],[34.03084,-1.05101],[34.02286,-1.00779],[33.93107,-.99298],[30.80408,-.99911]]]]}},{type:"Feature",properties:{iso1A2:"UA",iso1A3:"UKR",iso1N3:"804",wikidata:"Q212",nameEn:"Ukraine",groups:["151","150","UN"],callingCodes:["380"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.57318,46.10317],[33.61467,46.13561],[33.63854,46.14147],[33.61517,46.22615],[33.646,46.23028],[33.74047,46.18555],[33.79715,46.20482],[33.85234,46.19863],[33.91549,46.15938],[34.05272,46.10838],[34.07311,46.11769],[34.12929,46.10494],[34.181,46.06804],[34.25111,46.0532],[34.33912,46.06114],[34.41221,46.00245],[34.44155,45.95995],[34.48729,45.94267],[34.52011,45.95097],[34.55889,45.99347],[34.60861,45.99347],[34.66679,45.97136],[34.75479,45.90705],[34.80153,45.90047],[34.79905,45.81009],[34.96015,45.75634],[35.23066,45.79231],[37.62608,46.82615],[38.12112,46.86078],[38.3384,46.98085],[38.22955,47.12069],[38.23049,47.2324],[38.32112,47.2585],[38.33074,47.30508],[38.22225,47.30788],[38.28954,47.39255],[38.28679,47.53552],[38.35062,47.61631],[38.76379,47.69346],[38.79628,47.81109],[38.87979,47.87719],[39.73935,47.82876],[39.82213,47.96396],[39.77544,48.04206],[39.88256,48.04482],[39.83724,48.06501],[39.94847,48.22811],[40.00752,48.22445],[39.99241,48.31768],[39.97325,48.31399],[39.9693,48.29904],[39.95248,48.29972],[39.91465,48.26743],[39.90041,48.3049],[39.84273,48.30947],[39.84136,48.33321],[39.94847,48.35055],[39.88794,48.44226],[39.86196,48.46633],[39.84548,48.57821],[39.79764,48.58668],[39.67226,48.59368],[39.71765,48.68673],[39.73104,48.7325],[39.79466,48.83739],[39.97182,48.79398],[40.08168,48.87443],[40.03636,48.91957],[39.98967,48.86901],[39.78368,48.91596],[39.74874,48.98675],[39.72649,48.9754],[39.71353,48.98959],[39.6683,48.99454],[39.6836,49.05121],[39.93437,49.05709],[40.01988,49.1761],[40.22176,49.25683],[40.18331,49.34996],[40.14912,49.37681],[40.1141,49.38798],[40.03087,49.45452],[40.03636,49.52321],[40.16683,49.56865],[40.13249,49.61672],[39.84548,49.56064],[39.65047,49.61761],[39.59142,49.73758],[39.44496,49.76067],[39.27968,49.75976],[39.1808,49.88911],[38.9391,49.79524],[38.90477,49.86787],[38.73311,49.90238],[38.68677,50.00904],[38.65688,49.97176],[38.35408,50.00664],[38.32524,50.08866],[38.18517,50.08161],[38.21675,49.98104],[38.02999,49.90592],[38.02999,49.94482],[37.90776,50.04194],[37.79515,50.08425],[37.75807,50.07896],[37.61113,50.21976],[37.62879,50.24481],[37.62486,50.29966],[37.47243,50.36277],[37.48204,50.46079],[37.08468,50.34935],[36.91762,50.34963],[36.69377,50.26982],[36.64571,50.218],[36.56655,50.2413],[36.58371,50.28563],[36.47817,50.31457],[36.30101,50.29088],[36.20763,50.3943],[36.06893,50.45205],[35.8926,50.43829],[35.80388,50.41356],[35.73659,50.35489],[35.61711,50.35707],[35.58003,50.45117],[35.47463,50.49247],[35.39464,50.64751],[35.48116,50.66405],[35.47704,50.77274],[35.41367,50.80227],[35.39307,50.92145],[35.32598,50.94524],[35.40837,51.04119],[35.31774,51.08434],[35.20375,51.04723],[35.12685,51.16191],[35.14058,51.23162],[34.97304,51.2342],[34.82472,51.17483],[34.6874,51.18],[34.6613,51.25053],[34.38802,51.2746],[34.31661,51.23936],[34.23009,51.26429],[34.33446,51.363],[34.22048,51.4187],[34.30562,51.5205],[34.17599,51.63253],[34.07765,51.67065],[34.42922,51.72852],[34.41136,51.82793],[34.09413,52.00835],[34.11199,52.14087],[34.05239,52.20132],[33.78789,52.37204],[33.55718,52.30324],[33.48027,52.31499],[33.51323,52.35779],[33.18913,52.3754],[32.89937,52.2461],[32.85405,52.27888],[32.69475,52.25535],[32.54781,52.32423],[32.3528,52.32842],[32.38988,52.24946],[32.33083,52.23685],[32.34044,52.1434],[32.2777,52.10266],[32.23331,52.08085],[32.08813,52.03319],[31.92159,52.05144],[31.96141,52.08015],[31.85018,52.11305],[31.81722,52.09955],[31.7822,52.11406],[31.38326,52.12991],[31.25142,52.04131],[31.13332,52.1004],[30.95589,52.07775],[30.90897,52.00699],[30.76443,51.89739],[30.68804,51.82806],[30.51946,51.59649],[30.64992,51.35014],[30.56203,51.25655],[30.36153,51.33984],[30.34642,51.42555],[30.17888,51.51025],[29.77376,51.4461],[29.7408,51.53417],[29.54372,51.48372],[29.49773,51.39814],[29.42357,51.4187],[29.32881,51.37843],[29.25191,51.49828],[29.25603,51.57089],[29.20659,51.56918],[29.16402,51.64679],[29.1187,51.65872],[28.99098,51.56833],[28.95528,51.59222],[28.81795,51.55552],[28.76027,51.48802],[28.78224,51.45294],[28.75615,51.41442],[28.73143,51.46236],[28.69161,51.44695],[28.64429,51.5664],[28.47051,51.59734],[28.37592,51.54505],[28.23452,51.66988],[28.10658,51.57857],[27.95827,51.56065],[27.91844,51.61952],[27.85253,51.62293],[27.76052,51.47604],[27.67125,51.50854],[27.71932,51.60672],[27.55727,51.63486],[27.51058,51.5854],[27.47212,51.61184],[27.24828,51.60161],[27.26613,51.65957],[27.20948,51.66713],[27.20602,51.77291],[26.99422,51.76933],[26.9489,51.73788],[26.80043,51.75777],[26.69759,51.82284],[26.46962,51.80501],[26.39367,51.87315],[26.19084,51.86781],[26.00408,51.92967],[25.83217,51.92587],[25.80574,51.94556],[25.73673,51.91973],[25.46163,51.92205],[25.20228,51.97143],[24.98784,51.91273],[24.37123,51.88222],[24.29021,51.80841],[24.3163,51.75063],[24.13075,51.66979],[23.99907,51.58369],[23.8741,51.59734],[23.91118,51.63316],[23.7766,51.66809],[23.60906,51.62122],[23.6736,51.50255],[23.62751,51.50512],[23.69905,51.40871],[23.63858,51.32182],[23.80678,51.18405],[23.90376,51.07697],[23.92217,51.00836],[24.04576,50.90196],[24.14524,50.86128],[24.0952,50.83262],[23.99254,50.83847],[23.95925,50.79271],[24.0595,50.71625],[24.0996,50.60752],[24.07048,50.5071],[24.03668,50.44507],[23.99563,50.41289],[23.79445,50.40481],[23.71382,50.38248],[23.67635,50.33385],[23.28221,50.0957],[22.99329,49.84249],[22.83179,49.69875],[22.80261,49.69098],[22.78304,49.65543],[22.64534,49.53094],[22.69444,49.49378],[22.748,49.32759],[22.72009,49.20288],[22.86336,49.10513],[22.89122,49.00725],[22.56155,49.08865],[22.54338,49.01424],[22.48296,48.99172],[22.42934,48.92857],[22.34151,48.68893],[22.21379,48.6218],[22.16023,48.56548],[22.14689,48.4005],[22.2083,48.42534],[22.38133,48.23726],[22.49806,48.25189],[22.59007,48.15121],[22.58733,48.10813],[22.66835,48.09162],[22.73427,48.12005],[22.81804,48.11363],[22.87847,48.04665],[22.84276,47.98602],[22.89849,47.95851],[22.94301,47.96672],[22.92241,48.02002],[23.0158,47.99338],[23.08858,48.00716],[23.1133,48.08061],[23.15999,48.12188],[23.27397,48.08245],[23.33577,48.0237],[23.4979,47.96858],[23.52803,48.01818],[23.5653,48.00499],[23.63894,48.00293],[23.66262,47.98786],[23.75188,47.99705],[23.80904,47.98142],[23.8602,47.9329],[23.89352,47.94512],[23.94192,47.94868],[23.96337,47.96672],[23.98553,47.96076],[24.00801,47.968],[24.02999,47.95087],[24.06466,47.95317],[24.11281,47.91487],[24.22566,47.90231],[24.34926,47.9244],[24.43578,47.97131],[24.61994,47.95062],[24.70632,47.84428],[24.81893,47.82031],[24.88896,47.7234],[25.11144,47.75203],[25.23778,47.89403],[25.63878,47.94924],[25.77723,47.93919],[26.05901,47.9897],[26.17711,47.99246],[26.33504,48.18418],[26.55202,48.22445],[26.62823,48.25804],[26.6839,48.35828],[26.79239,48.29071],[26.82809,48.31629],[26.71274,48.40388],[26.85556,48.41095],[26.93384,48.36558],[27.03821,48.37653],[27.0231,48.42485],[27.08078,48.43214],[27.13434,48.37288],[27.27855,48.37534],[27.32159,48.4434],[27.37604,48.44398],[27.37741,48.41026],[27.44333,48.41209],[27.46942,48.454],[27.5889,48.49224],[27.59027,48.46311],[27.6658,48.44034],[27.74422,48.45926],[27.79225,48.44244],[27.81902,48.41874],[27.87533,48.4037],[27.88391,48.36699],[27.95883,48.32368],[28.04527,48.32661],[28.09873,48.3124],[28.07504,48.23494],[28.17666,48.25963],[28.19314,48.20749],[28.2856,48.23202],[28.32508,48.23384],[28.35519,48.24957],[28.36996,48.20543],[28.34912,48.1787],[28.30586,48.1597],[28.30609,48.14018],[28.34009,48.13147],[28.38712,48.17567],[28.43701,48.15832],[28.42454,48.12047],[28.48428,48.0737],[28.53921,48.17453],[28.69896,48.13106],[28.85232,48.12506],[28.8414,48.03392],[28.9306,47.96255],[29.1723,47.99013],[29.19839,47.89261],[29.27804,47.88893],[29.20663,47.80367],[29.27255,47.79953],[29.22242,47.73607],[29.22414,47.60012],[29.11743,47.55001],[29.18603,47.43387],[29.3261,47.44664],[29.39889,47.30179],[29.47854,47.30366],[29.48678,47.36043],[29.5733,47.36508],[29.59665,47.25521],[29.54996,47.24962],[29.57696,47.13581],[29.49732,47.12878],[29.53044,47.07851],[29.61038,47.09932],[29.62137,47.05069],[29.57056,46.94766],[29.72986,46.92234],[29.75458,46.8604],[29.87405,46.88199],[29.98814,46.82358],[29.94522,46.80055],[29.9743,46.75325],[29.94409,46.56002],[29.88916,46.54302],[30.02511,46.45132],[30.16794,46.40967],[30.09103,46.38694],[29.94114,46.40114],[29.88329,46.35851],[29.74496,46.45605],[29.66359,46.4215],[29.6763,46.36041],[29.5939,46.35472],[29.49914,46.45889],[29.35357,46.49505],[29.24886,46.37912],[29.23547,46.55435],[29.02409,46.49582],[29.01241,46.46177],[28.9306,46.45699],[29.004,46.31495],[28.98478,46.31803],[28.94953,46.25852],[29.06656,46.19716],[28.94643,46.09176],[29.00613,46.04962],[28.98004,46.00385],[28.74383,45.96664],[28.78503,45.83475],[28.69852,45.81753],[28.70401,45.78019],[28.52823,45.73803],[28.47879,45.66994],[28.51587,45.6613],[28.54196,45.58062],[28.49252,45.56716],[28.51449,45.49982],[28.43072,45.48538],[28.41836,45.51715],[28.30201,45.54744],[28.21139,45.46895],[28.28504,45.43907],[28.34554,45.32102],[28.5735,45.24759],[28.71358,45.22631],[28.78911,45.24179],[28.81383,45.3384],[28.94292,45.28045],[28.96077,45.33164],[29.24779,45.43388],[29.42632,45.44545],[29.59798,45.38857],[29.68175,45.26885],[29.65428,45.25629],[29.69272,45.19227],[30.04414,45.08461],[31.62627,45.50633],[33.54017,46.0123],[33.59087,46.06013],[33.57318,46.10317]]]]}},{type:"Feature",properties:{iso1A2:"UG",iso1A3:"UGA",iso1N3:"800",wikidata:"Q1036",nameEn:"Uganda",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["256"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.93107,-.99298],[33.9264,-.54188],[33.98449,-.13079],[33.90936,.10581],[34.10067,.36372],[34.08727,.44713],[34.11408,.48884],[34.13493,.58118],[34.20196,.62289],[34.27345,.63182],[34.31516,.75693],[34.40041,.80266],[34.43349,.85254],[34.52369,1.10692],[34.57427,1.09868],[34.58029,1.14712],[34.67562,1.21265],[34.80223,1.22754],[34.82606,1.26626],[34.82606,1.30944],[34.7918,1.36752],[34.87819,1.5596],[34.92734,1.56109],[34.9899,1.6668],[34.98692,1.97348],[34.90947,2.42447],[34.95267,2.47209],[34.77244,2.70272],[34.78137,2.76223],[34.73967,2.85447],[34.65774,2.8753],[34.60114,2.93034],[34.56242,3.11478],[34.45815,3.18319],[34.40006,3.37949],[34.41794,3.44342],[34.39112,3.48802],[34.44922,3.51627],[34.45815,3.67385],[34.15429,3.80464],[34.06046,4.15235],[33.9873,4.23316],[33.51264,3.75068],[33.18356,3.77812],[33.02852,3.89296],[32.89746,3.81339],[32.72021,3.77327],[32.41337,3.748],[32.20782,3.6053],[32.19888,3.50867],[32.08866,3.53543],[32.08491,3.56287],[32.05187,3.589],[31.95907,3.57408],[31.96205,3.6499],[31.86821,3.78664],[31.81459,3.82083],[31.72075,3.74354],[31.50776,3.63652],[31.50478,3.67814],[31.29476,3.8015],[31.16666,3.79853],[30.97601,3.693],[30.85153,3.48867],[30.94081,3.50847],[30.93486,3.40737],[30.84251,3.26908],[30.77101,3.04897],[30.8574,2.9508],[30.8857,2.83923],[30.75612,2.5863],[30.74271,2.43601],[30.83059,2.42559],[30.91102,2.33332],[30.96911,2.41071],[31.06593,2.35862],[31.07934,2.30207],[31.12104,2.27676],[31.1985,2.29462],[31.20148,2.2217],[31.28042,2.17853],[31.30127,2.11006],[30.48503,1.21675],[30.24671,1.14974],[30.22139,.99635],[30.1484,.89805],[29.98307,.84295],[29.95477,.64486],[29.97413,.52124],[29.87284,.39166],[29.81922,.16824],[29.77454,.16675],[29.7224,.07291],[29.72687,-.08051],[29.65091,-.46777],[29.67474,-.47969],[29.67176,-.55714],[29.62708,-.71055],[29.63006,-.8997],[29.58388,-.89821],[29.59061,-1.39016],[29.82657,-1.31187],[29.912,-1.48269],[30.16369,-1.34303],[30.35212,-1.06896],[30.47194,-1.0555],[30.64166,-1.06601],[30.70631,-1.01175],[30.76635,-.9852],[30.80408,-.99911],[33.93107,-.99298]]]]}},{type:"Feature",properties:{iso1A2:"UM",iso1A3:"UMI",iso1N3:"581",wikidata:"Q16645",nameEn:"United States Minor Outlying Islands",country:"US"},geometry:null},{type:"Feature",properties:{iso1A2:"UN",wikidata:"Q1065",nameEn:"United Nations",level:"unitedNations",isoStatus:"excRes"},geometry:null},{type:"Feature",properties:{iso1A2:"US",iso1A3:"USA",iso1N3:"840",wikidata:"Q30",nameEn:"United States of America"},geometry:null},{type:"Feature",properties:{iso1A2:"UY",iso1A3:"URY",iso1N3:"858",wikidata:"Q77",nameEn:"Uruguay",groups:["005","419","019","UN"],callingCodes:["598"]},geometry:{type:"MultiPolygon",coordinates:[[[[-57.65132,-30.19229],[-57.61478,-30.25165],[-57.64859,-30.35095],[-57.89115,-30.49572],[-57.8024,-30.77193],[-57.89476,-30.95994],[-57.86729,-31.06352],[-57.9908,-31.34924],[-57.98127,-31.3872],[-58.07569,-31.44916],[-58.0023,-31.53084],[-58.00076,-31.65016],[-58.20252,-31.86966],[-58.10036,-32.25338],[-58.22362,-32.52416],[-58.1224,-32.98842],[-58.40475,-33.11777],[-58.44442,-33.84033],[-58.34425,-34.15035],[-57.83001,-34.69099],[-54.78916,-36.21945],[-52.83257,-34.01481],[-53.37138,-33.74313],[-53.39593,-33.75169],[-53.44031,-33.69344],[-53.52794,-33.68908],[-53.53459,-33.16843],[-53.1111,-32.71147],[-53.37671,-32.57005],[-53.39572,-32.58596],[-53.76024,-32.0751],[-54.17384,-31.86168],[-55.50821,-30.91349],[-55.50841,-30.9027],[-55.51862,-30.89828],[-55.52712,-30.89997],[-55.53276,-30.90218],[-55.53431,-30.89714],[-55.54572,-30.89051],[-55.55218,-30.88193],[-55.55373,-30.8732],[-55.5634,-30.8686],[-55.58866,-30.84117],[-55.87388,-31.05053],[-56.4619,-30.38457],[-56.4795,-30.3899],[-56.49267,-30.39471],[-56.90236,-30.02578],[-57.22502,-30.26121],[-57.65132,-30.19229]]]]}},{type:"Feature",properties:{iso1A2:"UZ",iso1A3:"UZB",iso1N3:"860",wikidata:"Q265",nameEn:"Uzbekistan",groups:["143","142","UN"],callingCodes:["998"]},geometry:{type:"MultiPolygon",coordinates:[[[[65.85194,42.85481],[65.53277,43.31856],[65.18666,43.48835],[64.96464,43.74748],[64.53885,43.56941],[63.34656,43.64003],[62.01711,43.51008],[61.01475,44.41383],[58.59711,45.58671],[55.97842,44.99622],[55.97832,44.99622],[55.97822,44.99617],[55.97811,44.99617],[55.97801,44.99612],[55.97801,44.99607],[55.97791,44.99607],[55.9778,44.99607],[55.9777,44.99601],[55.9777,44.99596],[55.9776,44.99591],[55.97749,44.99591],[55.97739,44.99591],[55.97739,44.99586],[55.97729,44.99586],[55.97718,44.99581],[55.97708,44.99576],[55.97698,44.9957],[55.97698,44.99565],[55.97687,44.9956],[55.97677,44.9956],[55.97677,44.99555],[55.97677,44.9955],[55.97667,44.99545],[55.97656,44.99539],[55.97646,44.99534],[55.97646,44.99529],[55.97636,44.99524],[55.97636,44.99519],[55.97625,44.99514],[55.97615,44.99508],[55.97615,44.99503],[55.97615,44.99498],[55.97615,44.99493],[55.97615,44.99483],[55.97615,44.99477],[55.97605,44.99477],[55.97605,44.99467],[55.97605,44.99462],[55.97605,44.99457],[55.97605,44.99452],[55.97594,44.99446],[55.97584,44.99441],[55.97584,44.99436],[55.97584,44.99431],[55.97584,44.99426],[55.97584,44.99421],[55.97584,44.99415],[55.97584,44.99405],[55.97584,44.994],[55.97584,44.9939],[55.97584,44.99384],[55.97584,44.99374],[55.97584,44.99369],[55.97584,44.99359],[55.97584,44.99353],[55.97584,44.99348],[55.97584,44.99343],[55.97584,44.99338],[55.97584,44.99328],[55.97584,44.99322],[56.00314,41.32584],[57.03423,41.25435],[57.13796,41.36625],[57.03359,41.41777],[56.96218,41.80383],[57.03633,41.92043],[57.30275,42.14076],[57.6296,42.16519],[57.84932,42.18555],[57.92897,42.24047],[57.90975,42.4374],[57.99214,42.50021],[58.3492,42.43335],[58.40688,42.29535],[58.51674,42.30348],[58.29427,42.56497],[58.14321,42.62159],[58.27504,42.69632],[58.57991,42.64988],[58.6266,42.79314],[58.93422,42.5407],[59.17317,42.52248],[59.2955,42.37064],[59.4341,42.29738],[59.94633,42.27655],[60.00539,42.212],[59.96419,42.1428],[60.04659,42.08982],[60.0356,42.01028],[59.95046,41.97966],[60.33223,41.75058],[60.08504,41.80997],[60.06032,41.76287],[60.18117,41.60082],[60.06581,41.4363],[60.5078,41.21694],[61.03261,41.25691],[61.22212,41.14946],[61.33199,41.14946],[61.39732,41.19873],[61.4446,41.29407],[61.87856,41.12257],[62.11751,40.58242],[62.34273,40.43206],[62.43337,39.98528],[63.6913,39.27666],[63.70778,39.22349],[64.19086,38.95561],[64.32576,38.98691],[65.55873,38.29052],[65.83913,38.25733],[66.24013,38.16238],[66.41042,38.02403],[66.56697,38.0435],[66.67684,37.96776],[66.53676,37.80084],[66.52852,37.58568],[66.65761,37.45497],[66.52303,37.39827],[66.55743,37.35409],[66.64699,37.32958],[66.95598,37.40162],[67.08232,37.35469],[67.13039,37.27168],[67.2224,37.24545],[67.2581,37.17216],[67.51868,37.26102],[67.78329,37.1834],[67.8474,37.31594],[67.81566,37.43107],[68.12635,37.93],[68.27159,37.91477],[68.40343,38.19484],[68.13289,38.40822],[68.06274,38.39435],[68.11366,38.47169],[68.05873,38.56087],[68.0807,38.64136],[68.05598,38.71641],[68.12877,38.73677],[68.06948,38.82115],[68.19743,38.85985],[68.09704,39.02589],[67.68915,39.00775],[67.67833,39.14479],[67.33226,39.23739],[67.36522,39.31287],[67.45998,39.315],[67.46822,39.46146],[67.39681,39.52505],[67.46547,39.53564],[67.44899,39.57799],[67.62889,39.60234],[67.70992,39.66156],[68.12053,39.56317],[68.54166,39.53929],[68.61972,39.68905],[68.63071,39.85265],[68.88889,39.87163],[68.93695,39.91167],[68.84906,40.04952],[68.96579,40.06949],[69.01935,40.11466],[69.01523,40.15771],[68.62796,40.07789],[68.52771,40.11676],[68.5332,40.14826],[68.77902,40.20492],[68.79276,40.17555],[68.84357,40.18604],[68.85832,40.20885],[69.04544,40.22904],[69.15659,40.2162],[69.2074,40.21488],[69.30448,40.18774],[69.30104,40.24502],[69.25229,40.26362],[69.24817,40.30357],[69.30808,40.2821],[69.32833,40.29794],[69.33794,40.34819],[69.30774,40.36102],[69.28525,40.41894],[69.27066,40.49274],[69.21063,40.54469],[69.2643,40.57506],[69.3455,40.57988],[69.32834,40.70233],[69.38327,40.7918],[69.53021,40.77621],[69.59441,40.70181],[69.69434,40.62615],[70.36655,40.90296],[70.38028,41.02014],[70.45251,41.04438],[70.80009,40.72825],[70.49871,40.52503],[70.32626,40.45174],[70.37511,40.38605],[70.57149,40.3442],[70.56394,40.26421],[70.62342,40.17396],[70.8607,40.217],[70.9818,40.22392],[70.95789,40.28761],[71.05901,40.28765],[71.13042,40.34106],[71.36663,40.31593],[71.4246,40.28619],[71.51215,40.26943],[71.51549,40.22986],[71.61725,40.20615],[71.61931,40.26775],[71.68386,40.26984],[71.70569,40.20391],[71.69621,40.18492],[71.71719,40.17886],[71.73054,40.14818],[71.82646,40.21872],[71.85002,40.25647],[72.05464,40.27586],[71.96401,40.31907],[72.18648,40.49893],[72.24368,40.46091],[72.40346,40.4007],[72.44191,40.48222],[72.41513,40.50856],[72.38384,40.51535],[72.41714,40.55736],[72.34406,40.60144],[72.40517,40.61917],[72.47795,40.5532],[72.66713,40.5219],[72.66713,40.59076],[72.69579,40.59778],[72.73995,40.58409],[72.74768,40.58051],[72.74862,40.57131],[72.75982,40.57273],[72.74894,40.59592],[72.74866,40.60873],[72.80137,40.67856],[72.84754,40.67229],[72.85372,40.7116],[72.8722,40.71111],[72.93296,40.73089],[72.99133,40.76457],[73.0612,40.76678],[73.13412,40.79122],[73.13267,40.83512],[73.01869,40.84681],[72.94454,40.8094],[72.84291,40.85512],[72.68157,40.84942],[72.59136,40.86947],[72.55109,40.96046],[72.48742,40.97136],[72.45206,41.03018],[72.38511,41.02785],[72.36138,41.04384],[72.34757,41.06104],[72.34026,41.04539],[72.324,41.03381],[72.18339,40.99571],[72.17594,41.02377],[72.21061,41.05607],[72.1792,41.10621],[72.14864,41.13363],[72.17594,41.15522],[72.16433,41.16483],[72.10745,41.15483],[72.07249,41.11739],[71.85964,41.19081],[71.91457,41.2982],[71.83914,41.3546],[71.76625,41.4466],[71.71132,41.43012],[71.73054,41.54713],[71.65914,41.49599],[71.6787,41.42111],[71.57227,41.29175],[71.46688,41.31883],[71.43814,41.19644],[71.46148,41.13958],[71.40198,41.09436],[71.34877,41.16807],[71.27187,41.11015],[71.25813,41.18796],[71.11806,41.15359],[71.02193,41.19494],[70.9615,41.16393],[70.86263,41.23833],[70.77885,41.24813],[70.78572,41.36419],[70.67586,41.47953],[70.48909,41.40335],[70.17682,41.5455],[70.69777,41.92554],[71.28719,42.18033],[71.13263,42.28356],[70.94483,42.26238],[69.49545,41.545],[69.45751,41.56863],[69.39485,41.51518],[69.45081,41.46246],[69.37468,41.46555],[69.35554,41.47211],[69.29778,41.43673],[69.25059,41.46693],[69.23332,41.45847],[69.22671,41.46298],[69.20439,41.45391],[69.18528,41.45175],[69.17701,41.43769],[69.15137,41.43078],[69.05006,41.36183],[69.01308,41.22804],[68.7217,41.05025],[68.73945,40.96989],[68.65662,40.93861],[68.62221,41.03019],[68.49983,40.99669],[68.58444,40.91447],[68.63,40.59358],[68.49983,40.56437],[67.96736,40.83798],[68.1271,41.0324],[68.08273,41.08148],[67.98511,41.02794],[67.9644,41.14611],[66.69129,41.1311],[66.53302,41.87388],[66.00546,41.94455],[66.09482,42.93426],[65.85194,42.85481]],[[70.68112,40.90612],[70.6721,40.90555],[70.57501,40.98941],[70.54223,40.98787],[70.56077,41.00642],[70.6158,40.97661],[70.68112,40.90612]]],[[[71.21139,40.03369],[71.12218,40.03052],[71.06305,40.1771],[71.00236,40.18154],[71.01035,40.05481],[71.11037,40.01984],[71.11668,39.99291],[71.09063,39.99],[71.10501,39.95568],[71.04979,39.89808],[71.10531,39.91354],[71.16101,39.88423],[71.23067,39.93581],[71.1427,39.95026],[71.21139,40.03369]]],[[[71.86463,39.98598],[71.78838,40.01404],[71.71511,39.96348],[71.7504,39.93701],[71.84316,39.95582],[71.86463,39.98598]]]]}},{type:"Feature",properties:{iso1A2:"VA",iso1A3:"VAT",iso1N3:"336",wikidata:"Q237",nameEn:"Vatican City",aliases:["Holy See"],groups:["039","150"],callingCodes:["379","39 06"]},geometry:{type:"MultiPolygon",coordinates:[[[[12.45181,41.90056],[12.45446,41.90028],[12.45435,41.90143],[12.45626,41.90172],[12.45691,41.90125],[12.4577,41.90115],[12.45834,41.90174],[12.45826,41.90281],[12.45755,41.9033],[12.45762,41.9058],[12.45561,41.90629],[12.45543,41.90738],[12.45091,41.90625],[12.44984,41.90545],[12.44815,41.90326],[12.44582,41.90194],[12.44834,41.90095],[12.45181,41.90056]]]]}},{type:"Feature",properties:{iso1A2:"VC",iso1A3:"VCT",iso1N3:"670",wikidata:"Q757",nameEn:"St. Vincent and the Grenadines",aliases:["WV"],groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 784"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.64026,12.69984],[-59.94058,12.34011],[-61.69315,14.26451],[-62.64026,12.69984]]]]}},{type:"Feature",properties:{iso1A2:"VE",iso1A3:"VEN",iso1N3:"862",wikidata:"Q717",nameEn:"Venezuela",aliases:["YV"],groups:["005","419","019","UN"],callingCodes:["58"]},geometry:{type:"MultiPolygon",coordinates:[[[[-71.22331,13.01387],[-70.92579,11.96275],[-71.3275,11.85],[-71.9675,11.65536],[-72.24983,11.14138],[-72.4767,11.1117],[-72.88002,10.44309],[-72.98085,9.85253],[-73.36905,9.16636],[-73.02119,9.27584],[-72.94052,9.10663],[-72.77415,9.10165],[-72.65474,8.61428],[-72.4042,8.36513],[-72.36987,8.19976],[-72.35163,8.01163],[-72.39137,8.03534],[-72.47213,7.96106],[-72.48801,7.94329],[-72.48183,7.92909],[-72.47042,7.92306],[-72.45806,7.91141],[-72.46183,7.90682],[-72.44454,7.86031],[-72.46763,7.79518],[-72.47827,7.65604],[-72.45321,7.57232],[-72.47415,7.48928],[-72.43132,7.40034],[-72.19437,7.37034],[-72.04895,7.03837],[-71.82441,7.04314],[-71.44118,7.02116],[-71.42212,7.03854],[-71.37234,7.01588],[-71.03941,6.98163],[-70.7596,7.09799],[-70.10716,6.96516],[-69.41843,6.1072],[-67.60654,6.2891],[-67.4625,6.20625],[-67.43513,5.98835],[-67.58558,5.84537],[-67.63914,5.64963],[-67.59141,5.5369],[-67.83341,5.31104],[-67.85358,4.53249],[-67.62671,3.74303],[-67.50067,3.75812],[-67.30945,3.38393],[-67.85862,2.86727],[-67.85862,2.79173],[-67.65696,2.81691],[-67.21967,2.35778],[-66.85795,1.22998],[-66.28507,.74585],[-65.6727,1.01353],[-65.50158,.92086],[-65.57288,.62856],[-65.11657,1.12046],[-64.38932,1.5125],[-64.34654,1.35569],[-64.08274,1.64792],[-64.06135,1.94722],[-63.39827,2.16098],[-63.39114,2.4317],[-64.0257,2.48156],[-64.02908,2.79797],[-64.48379,3.7879],[-64.84028,4.24665],[-64.72977,4.28931],[-64.57648,4.12576],[-64.14512,4.12932],[-63.99183,3.90172],[-63.86082,3.94796],[-63.70218,3.91417],[-63.67099,4.01731],[-63.50611,3.83592],[-63.42233,3.89995],[-63.4464,3.9693],[-63.21111,3.96219],[-62.98296,3.59935],[-62.7655,3.73099],[-62.74411,4.03331],[-62.57656,4.04754],[-62.44822,4.18621],[-62.13094,4.08309],[-61.54629,4.2822],[-61.48569,4.43149],[-61.29675,4.44216],[-61.31457,4.54167],[-61.15703,4.49839],[-60.98303,4.54167],[-60.86539,4.70512],[-60.5802,4.94312],[-60.73204,5.20931],[-61.4041,5.95304],[-61.15058,6.19558],[-61.20762,6.58174],[-61.13632,6.70922],[-60.54873,6.8631],[-60.39419,6.94847],[-60.28074,7.1162],[-60.44116,7.20817],[-60.54098,7.14804],[-60.63367,7.25061],[-60.59802,7.33194],[-60.71923,7.55817],[-60.64793,7.56877],[-60.51959,7.83373],[-60.38056,7.8302],[-60.02407,8.04557],[-59.97059,8.20791],[-59.83156,8.23261],[-59.80661,8.28906],[-59.85562,8.35213],[-59.98508,8.53046],[-59.54058,8.6862],[-60.89962,9.81445],[-62.08693,10.04435],[-61.62505,11.18974],[-63.73917,11.92623],[-63.19938,16.44103],[-67.89186,12.4116],[-68.01417,11.77722],[-68.33524,11.78151],[-68.99639,11.79035],[-71.22331,13.01387]]]]}},{type:"Feature",properties:{iso1A2:"VG",iso1A3:"VGB",iso1N3:"092",wikidata:"Q25305",nameEn:"British Virgin Islands",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 284"]},geometry:{type:"MultiPolygon",coordinates:[[[[-64.47127,17.55688],[-63.88746,19.15706],[-65.02435,18.73231],[-64.86027,18.39056],[-64.64673,18.36549],[-64.47127,17.55688]]]]}},{type:"Feature",properties:{iso1A2:"VI",iso1A3:"VIR",iso1N3:"850",wikidata:"Q11703",nameEn:"United States Virgin Islands",aliases:["US-VI"],country:"US",groups:["Q1352230","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 340"]},geometry:{type:"MultiPolygon",coordinates:[[[[-65.02435,18.73231],[-65.27974,17.56928],[-64.47127,17.55688],[-64.64673,18.36549],[-64.86027,18.39056],[-65.02435,18.73231]]]]}},{type:"Feature",properties:{iso1A2:"VN",iso1A3:"VNM",iso1N3:"704",wikidata:"Q881",nameEn:"Vietnam",groups:["035","142","UN"],callingCodes:["84"]},geometry:{type:"MultiPolygon",coordinates:[[[[108.10003,21.47338],[108.0569,21.53604],[108.02926,21.54997],[107.97932,21.54503],[107.97383,21.53961],[107.97074,21.54072],[107.96774,21.53601],[107.95232,21.5388],[107.92652,21.58906],[107.90006,21.5905],[107.86114,21.65128],[107.80355,21.66141],[107.66967,21.60787],[107.56537,21.61945],[107.54047,21.5934],[107.49065,21.59774],[107.49532,21.62958],[107.47197,21.6672],[107.41593,21.64839],[107.38636,21.59774],[107.35989,21.60063],[107.35834,21.6672],[107.29296,21.74674],[107.24625,21.7077],[107.20734,21.71493],[107.10771,21.79879],[107.02615,21.81981],[107.00964,21.85948],[107.06101,21.88982],[107.05634,21.92303],[106.99252,21.95191],[106.97228,21.92592],[106.92714,21.93459],[106.9178,21.97357],[106.81038,21.97934],[106.74345,22.00965],[106.72551,21.97923],[106.69276,21.96013],[106.68274,21.99811],[106.70142,22.02409],[106.6983,22.15102],[106.67495,22.1885],[106.69986,22.22309],[106.6516,22.33977],[106.55976,22.34841],[106.57221,22.37],[106.55665,22.46498],[106.58395,22.474],[106.61269,22.60301],[106.65316,22.5757],[106.71698,22.58432],[106.72321,22.63606],[106.76293,22.73491],[106.82404,22.7881],[106.83685,22.8098],[106.81271,22.8226],[106.78422,22.81532],[106.71128,22.85982],[106.71387,22.88296],[106.6734,22.89587],[106.6516,22.86862],[106.60179,22.92884],[106.55976,22.92311],[106.51306,22.94891],[106.49749,22.91164],[106.34961,22.86718],[106.27022,22.87722],[106.19705,22.98475],[106.00179,22.99049],[105.99568,22.94178],[105.90119,22.94168],[105.8726,22.92756],[105.72382,23.06641],[105.57594,23.075],[105.56037,23.16806],[105.49966,23.20669],[105.42805,23.30824],[105.40782,23.28107],[105.32376,23.39684],[105.22569,23.27249],[105.17276,23.28679],[105.11672,23.25247],[105.07002,23.26248],[104.98712,23.19176],[104.96532,23.20463],[104.9486,23.17235],[104.91435,23.18666],[104.87992,23.17141],[104.87382,23.12854],[104.79478,23.12934],[104.8334,23.01484],[104.86765,22.95178],[104.84942,22.93631],[104.77114,22.90017],[104.72755,22.81984],[104.65283,22.83419],[104.60457,22.81841],[104.58122,22.85571],[104.47225,22.75813],[104.35593,22.69353],[104.25683,22.76534],[104.27084,22.8457],[104.11384,22.80363],[104.03734,22.72945],[104.01088,22.51823],[103.99247,22.51958],[103.97384,22.50634],[103.96783,22.51173],[103.96352,22.50584],[103.95191,22.5134],[103.94513,22.52553],[103.93286,22.52703],[103.87904,22.56683],[103.64506,22.79979],[103.56255,22.69499],[103.57812,22.65764],[103.52675,22.59155],[103.43646,22.70648],[103.43179,22.75816],[103.32282,22.8127],[103.28079,22.68063],[103.18895,22.64471],[103.15782,22.59873],[103.17961,22.55705],[103.07843,22.50097],[103.0722,22.44775],[102.9321,22.48659],[102.8636,22.60735],[102.60675,22.73376],[102.57095,22.7036],[102.51802,22.77969],[102.46665,22.77108],[102.42618,22.69212],[102.38415,22.67919],[102.41061,22.64184],[102.25339,22.4607],[102.26428,22.41321],[102.16621,22.43336],[102.14099,22.40092],[102.18712,22.30403],[102.51734,22.02676],[102.49092,21.99002],[102.62301,21.91447],[102.67145,21.65894],[102.74189,21.66713],[102.82115,21.73667],[102.81894,21.83888],[102.85637,21.84501],[102.86077,21.71213],[102.97965,21.74076],[102.98846,21.58936],[102.86297,21.4255],[102.94223,21.46034],[102.88939,21.3107],[102.80794,21.25736],[102.89825,21.24707],[102.97745,21.05821],[103.03469,21.05821],[103.12055,20.89994],[103.21497,20.89832],[103.38032,20.79501],[103.45737,20.82382],[103.68633,20.66324],[103.73478,20.6669],[103.82282,20.8732],[103.98024,20.91531],[104.11121,20.96779],[104.27412,20.91433],[104.63957,20.6653],[104.38199,20.47155],[104.40621,20.3849],[104.47886,20.37459],[104.66158,20.47774],[104.72102,20.40554],[104.62195,20.36633],[104.61315,20.24452],[104.86852,20.14121],[104.91695,20.15567],[104.9874,20.09573],[104.8465,19.91783],[104.8355,19.80395],[104.68359,19.72729],[104.64837,19.62365],[104.53169,19.61743],[104.41281,19.70035],[104.23229,19.70242],[104.06498,19.66926],[104.05617,19.61743],[104.10832,19.51575],[104.06058,19.43484],[103.87125,19.31854],[104.5361,18.97747],[104.64617,18.85668],[105.12829,18.70453],[105.19654,18.64196],[105.1327,18.58355],[105.10408,18.43533],[105.15942,18.38691],[105.38366,18.15315],[105.46292,18.22008],[105.64784,17.96687],[105.60381,17.89356],[105.76612,17.67147],[105.85744,17.63221],[106.09019,17.36399],[106.18991,17.28227],[106.24444,17.24714],[106.29287,17.3018],[106.31929,17.20509],[106.43597,17.01362],[106.50862,16.9673],[106.55045,17.0031],[106.54824,16.92729],[106.51963,16.92097],[106.52183,16.87884],[106.55265,16.86831],[106.55485,16.68704],[106.59013,16.62259],[106.58267,16.6012],[106.61477,16.60713],[106.66052,16.56892],[106.65832,16.47816],[106.74418,16.41904],[106.84104,16.55415],[106.88727,16.52671],[106.88067,16.43594],[106.96638,16.34938],[106.97385,16.30204],[107.02597,16.31132],[107.09091,16.3092],[107.15035,16.26271],[107.14595,16.17816],[107.25822,16.13587],[107.33968,16.05549],[107.44975,16.08511],[107.46296,16.01106],[107.39471,15.88829],[107.34188,15.89464],[107.21419,15.83747],[107.21859,15.74638],[107.27143,15.71459],[107.27583,15.62769],[107.34408,15.62345],[107.3815,15.49832],[107.50699,15.48771],[107.53341,15.40496],[107.62367,15.42193],[107.60605,15.37524],[107.62587,15.2266],[107.58844,15.20111],[107.61926,15.13949],[107.61486,15.0566],[107.46516,15.00982],[107.48277,14.93751],[107.59285,14.87795],[107.51579,14.79282],[107.54361,14.69092],[107.55371,14.628],[107.52102,14.59034],[107.52569,14.54665],[107.48521,14.40346],[107.44941,14.41552],[107.39493,14.32655],[107.40427,14.24509],[107.33577,14.11832],[107.37158,14.07906],[107.35757,14.02319],[107.38247,13.99147],[107.44318,13.99751],[107.46498,13.91593],[107.45252,13.78897],[107.53503,13.73908],[107.61909,13.52577],[107.62843,13.3668],[107.49144,13.01215],[107.49611,12.88926],[107.55993,12.7982],[107.5755,12.52177],[107.55059,12.36824],[107.4463,12.29373],[107.42917,12.24657],[107.34511,12.33327],[107.15831,12.27547],[106.99953,12.08983],[106.92325,12.06548],[106.79405,12.0807],[106.70687,11.96956],[106.4111,11.97413],[106.4687,11.86751],[106.44068,11.86294],[106.44535,11.8279],[106.41577,11.76999],[106.45158,11.68616],[106.44691,11.66787],[106.37219,11.69836],[106.30525,11.67549],[106.26478,11.72122],[106.18539,11.75171],[106.13158,11.73283],[106.06708,11.77761],[106.02038,11.77457],[106.00792,11.7197],[105.95188,11.63738],[105.88962,11.67854],[105.8507,11.66635],[105.80867,11.60536],[105.81645,11.56876],[105.87328,11.55953],[105.88962,11.43605],[105.86782,11.28343],[106.10444,11.07879],[106.1527,11.10476],[106.1757,11.07301],[106.20095,10.97795],[106.14301,10.98176],[106.18539,10.79451],[106.06708,10.8098],[105.94535,10.9168],[105.93403,10.83853],[105.84603,10.85873],[105.86376,10.89839],[105.77751,11.03671],[105.50045,10.94586],[105.42884,10.96878],[105.34011,10.86179],[105.11449,10.96332],[105.08326,10.95656],[105.02722,10.89236],[105.09571,10.72722],[104.95094,10.64003],[104.87933,10.52833],[104.59018,10.53073],[104.49869,10.4057],[104.47963,10.43046],[104.43778,10.42386],[103.99198,10.48391],[102.47649,9.66162],[104.81582,8.03101],[109.55486,8.10026],[111.60491,13.57105],[108.00365,17.98159],[108.10003,21.47338]]]]}},{type:"Feature",properties:{iso1A2:"VU",iso1A3:"VUT",iso1N3:"548",wikidata:"Q686",nameEn:"Vanuatu",groups:["054","009","UN"],callingCodes:["678"]},geometry:{type:"MultiPolygon",coordinates:[[[[156.73836,-14.50464],[174.245,-23.1974],[172.71443,-12.01327],[156.73836,-14.50464]]]]}},{type:"Feature",properties:{iso1A2:"WF",iso1A3:"WLF",iso1N3:"876",wikidata:"Q35555",nameEn:"Wallis and Futuna",country:"FR",groups:["EU","Q1451600","061","009","UN"],callingCodes:["681"]},geometry:{type:"MultiPolygon",coordinates:[[[[-178.66551,-14.32452],[-176.76826,-14.95183],[-175.59809,-12.61507],[-178.66551,-14.32452]]]]}},{type:"Feature",properties:{iso1A2:"WS",iso1A3:"WSM",iso1N3:"882",wikidata:"Q683",nameEn:"Samoa",groups:["061","009","UN"],driveSide:"left",callingCodes:["685"]},geometry:{type:"MultiPolygon",coordinates:[[[[-173.74402,-14.26669],[-170.99605,-15.1275],[-171.39864,-10.21587],[-173.74402,-14.26669]]]]}},{type:"Feature",properties:{iso1A2:"XK",iso1A3:"XKX",wikidata:"Q1246",nameEn:"Kosovo",aliases:["KV"],groups:["039","150"],isoStatus:"usrAssn",callingCodes:["383"]},geometry:{type:"MultiPolygon",coordinates:[[[[21.39045,42.74888],[21.44047,42.87276],[21.36941,42.87397],[21.32974,42.90424],[21.2719,42.8994],[21.23534,42.95523],[21.23877,43.00848],[21.2041,43.02277],[21.16734,42.99694],[21.14465,43.11089],[21.08952,43.13471],[21.05378,43.10707],[21.00749,43.13984],[20.96287,43.12416],[20.83727,43.17842],[20.88685,43.21697],[20.82145,43.26769],[20.73811,43.25068],[20.68688,43.21335],[20.59929,43.20492],[20.69515,43.09641],[20.64557,43.00826],[20.59929,43.01067],[20.48692,42.93208],[20.53484,42.8885],[20.43734,42.83157],[20.40594,42.84853],[20.35692,42.8335],[20.27869,42.81945],[20.2539,42.76245],[20.04898,42.77701],[20.02088,42.74789],[20.02915,42.71147],[20.0969,42.65559],[20.07761,42.55582],[20.17127,42.50469],[20.21797,42.41237],[20.24399,42.32168],[20.34479,42.32656],[20.3819,42.3029],[20.48857,42.25444],[20.56955,42.12097],[20.55633,42.08173],[20.59434,42.03879],[20.63069,41.94913],[20.57946,41.91593],[20.59524,41.8818],[20.68523,41.85318],[20.76786,41.91839],[20.75464,42.05229],[21.11491,42.20794],[21.16614,42.19815],[21.22728,42.08909],[21.31983,42.10993],[21.29913,42.13954],[21.30496,42.1418],[21.38428,42.24465],[21.43882,42.23609],[21.43882,42.2789],[21.50823,42.27156],[21.52145,42.24465],[21.58992,42.25915],[21.56772,42.30946],[21.5264,42.33634],[21.53467,42.36809],[21.57021,42.3647],[21.59029,42.38042],[21.62887,42.37664],[21.64209,42.41081],[21.62556,42.45106],[21.7035,42.51899],[21.70522,42.54176],[21.7327,42.55041],[21.75672,42.62695],[21.79413,42.65923],[21.75025,42.70125],[21.6626,42.67813],[21.58755,42.70418],[21.59154,42.72643],[21.47498,42.74695],[21.39045,42.74888]]]]}},{type:"Feature",properties:{iso1A2:"YE",iso1A3:"YEM",iso1N3:"887",wikidata:"Q805",nameEn:"Yemen",groups:["145","142","UN"],callingCodes:["967"]},geometry:{type:"MultiPolygon",coordinates:[[[[57.49095,8.14549],[52.81185,17.28568],[52.74267,17.29519],[52.78009,17.35124],[52.00311,19.00083],[49.04884,18.59899],[48.19996,18.20584],[47.58351,17.50366],[47.48245,17.10808],[47.00571,16.94765],[46.76494,17.29151],[46.31018,17.20464],[44.50126,17.47475],[43.70631,17.35762],[43.43005,17.56148],[43.29185,17.53224],[43.22533,17.38343],[43.32653,17.31179],[43.20156,17.25901],[43.17787,17.14717],[43.23967,17.03428],[43.18233,17.02673],[43.1813,16.98438],[43.19328,16.94703],[43.1398,16.90696],[43.18338,16.84852],[43.22012,16.83932],[43.22956,16.80613],[43.24801,16.80613],[43.26303,16.79479],[43.25857,16.75304],[43.21325,16.74416],[43.22066,16.65179],[43.15274,16.67248],[43.11601,16.53166],[42.97215,16.51093],[42.94351,16.49467],[42.94625,16.39721],[42.76801,16.40371],[42.15205,16.40211],[40.99158,15.81743],[43.29075,12.79154],[43.32909,12.59711],[43.90659,12.3823],[51.12877,12.56479],[57.49095,8.14549]]]]}},{type:"Feature",properties:{iso1A2:"YT",iso1A3:"MYT",iso1N3:"175",wikidata:"Q17063",nameEn:"Mayotte",country:"FR",groups:["Q3320166","EU","014","202","002","UN"],callingCodes:["262"]},geometry:{type:"MultiPolygon",coordinates:[[[[43.28731,-13.97126],[45.54824,-13.22353],[45.4971,-11.75965],[43.28731,-13.97126]]]]}},{type:"Feature",properties:{iso1A2:"ZA",iso1A3:"ZAF",iso1N3:"710",wikidata:"Q258",nameEn:"South Africa",groups:["018","202","002","UN"],driveSide:"left",callingCodes:["27"]},geometry:{type:"MultiPolygon",coordinates:[[[[31.30611,-22.422],[31.16344,-22.32599],[31.08932,-22.34884],[30.86696,-22.28907],[30.6294,-22.32599],[30.48686,-22.31368],[30.38614,-22.34533],[30.28351,-22.35587],[30.2265,-22.2961],[30.13147,-22.30841],[29.92242,-22.19408],[29.76848,-22.14128],[29.64609,-22.12917],[29.37703,-22.19581],[29.21955,-22.17771],[29.18974,-22.18599],[29.15268,-22.21399],[29.10881,-22.21202],[29.0151,-22.22907],[28.91889,-22.44299],[28.63287,-22.55887],[28.34874,-22.5694],[28.04562,-22.8394],[28.04752,-22.90243],[27.93729,-22.96194],[27.93539,-23.04941],[27.74154,-23.2137],[27.6066,-23.21894],[27.52393,-23.37952],[27.33768,-23.40917],[26.99749,-23.65486],[26.84165,-24.24885],[26.51667,-24.47219],[26.46346,-24.60358],[26.39409,-24.63468],[25.8515,-24.75727],[25.84295,-24.78661],[25.88571,-24.87802],[25.72702,-25.25503],[25.69661,-25.29284],[25.6643,-25.4491],[25.58543,-25.6343],[25.33076,-25.76616],[25.12266,-25.75931],[25.01718,-25.72507],[24.8946,-25.80723],[24.67319,-25.81749],[24.44703,-25.73021],[24.36531,-25.773],[24.18287,-25.62916],[23.9244,-25.64286],[23.47588,-25.29971],[23.03497,-25.29971],[22.86012,-25.50572],[22.70808,-25.99186],[22.56365,-26.19668],[22.41921,-26.23078],[22.21206,-26.3773],[22.06192,-26.61882],[21.90703,-26.66808],[21.83291,-26.65959],[21.77114,-26.69015],[21.7854,-26.79199],[21.69322,-26.86152],[21.37869,-26.82083],[21.13353,-26.86661],[20.87031,-26.80047],[20.68596,-26.9039],[20.63275,-26.78181],[20.61754,-26.4692],[20.86081,-26.14892],[20.64795,-25.47827],[20.29826,-24.94869],[20.03678,-24.81004],[20.02809,-24.78725],[19.99817,-24.76768],[19.99882,-28.42622],[18.99885,-28.89165],[17.4579,-28.68718],[17.15405,-28.08573],[16.90446,-28.057],[16.59922,-28.53246],[16.46592,-28.57126],[16.45332,-28.63117],[12.51595,-32.27486],[38.88176,-48.03306],[34.51034,-26.91792],[32.35222,-26.86027],[32.29584,-26.852],[32.22302,-26.84136],[32.19409,-26.84032],[32.13315,-26.84345],[32.09664,-26.80721],[32.00893,-26.8096],[31.97463,-27.11057],[31.97592,-27.31675],[31.49834,-27.31549],[31.15027,-27.20151],[30.96088,-27.0245],[30.97757,-26.92706],[30.88826,-26.79622],[30.81101,-26.84722],[30.78927,-26.48271],[30.95819,-26.26303],[31.13073,-25.91558],[31.31237,-25.7431],[31.4175,-25.71886],[31.86881,-25.99973],[31.974,-25.95387],[31.92649,-25.84216],[32.00631,-25.65044],[31.97875,-25.46356],[32.01676,-25.38117],[32.03196,-25.10785],[31.9835,-24.29983],[31.90368,-24.18892],[31.87707,-23.95293],[31.77445,-23.90082],[31.70223,-23.72695],[31.67942,-23.60858],[31.56539,-23.47268],[31.55779,-23.176],[31.30611,-22.422]],[[29.33204,-29.45598],[29.28545,-29.58456],[29.12553,-29.76266],[29.16548,-29.91706],[28.9338,-30.05072],[28.80222,-30.10579],[28.68627,-30.12885],[28.399,-30.1592],[28.2319,-30.28476],[28.12073,-30.68072],[27.74814,-30.60635],[27.69467,-30.55862],[27.67819,-30.53437],[27.6521,-30.51707],[27.62137,-30.50509],[27.56781,-30.44562],[27.56901,-30.42504],[27.45452,-30.32239],[27.38108,-30.33456],[27.36649,-30.27246],[27.37293,-30.19401],[27.40778,-30.14577],[27.32555,-30.14785],[27.29603,-30.05473],[27.22719,-30.00718],[27.09489,-29.72796],[27.01016,-29.65439],[27.33464,-29.48161],[27.4358,-29.33465],[27.47254,-29.31968],[27.45125,-29.29708],[27.48679,-29.29349],[27.54258,-29.25575],[27.5158,-29.2261],[27.55974,-29.18954],[27.75458,-28.89839],[27.8907,-28.91612],[27.88933,-28.88156],[27.9392,-28.84864],[27.98675,-28.8787],[28.02503,-28.85991],[28.1317,-28.7293],[28.2348,-28.69471],[28.30518,-28.69531],[28.40612,-28.6215],[28.65091,-28.57025],[28.68043,-28.58744],[29.40524,-29.21246],[29.44883,-29.3772],[29.33204,-29.45598]]]]}},{type:"Feature",properties:{iso1A2:"ZM",iso1A3:"ZMB",iso1N3:"894",wikidata:"Q953",nameEn:"Zambia",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["260"]},geometry:{type:"MultiPolygon",coordinates:[[[[32.95389,-9.40138],[32.76233,-9.31963],[32.75611,-9.28583],[32.53661,-9.24281],[32.49147,-9.14754],[32.43543,-9.11988],[32.25486,-9.13371],[32.16146,-9.05993],[32.08206,-9.04609],[31.98866,-9.07069],[31.94196,-9.02303],[31.94663,-8.93846],[31.81587,-8.88618],[31.71158,-8.91386],[31.57147,-8.81388],[31.57147,-8.70619],[31.37533,-8.60769],[31.00796,-8.58615],[30.79243,-8.27382],[28.88917,-8.4831],[28.9711,-8.66935],[28.38526,-9.23393],[28.36562,-9.30091],[28.52636,-9.35379],[28.51627,-9.44726],[28.56208,-9.49122],[28.68532,-9.78],[28.62795,-9.92942],[28.65032,-10.65133],[28.37241,-11.57848],[28.48357,-11.87532],[29.18592,-12.37921],[29.4992,-12.43843],[29.48404,-12.23604],[29.8139,-12.14898],[29.81551,-13.44683],[29.65078,-13.41844],[29.60531,-13.21685],[29.01918,-13.41353],[28.33199,-12.41375],[27.59932,-12.22123],[27.21025,-11.76157],[27.22541,-11.60323],[27.04351,-11.61312],[26.88687,-12.01868],[26.01777,-11.91488],[25.33058,-11.65767],[25.34069,-11.19707],[24.42612,-11.44975],[24.34528,-11.06816],[24.00027,-10.89356],[24.02603,-11.15368],[23.98804,-12.13149],[24.06672,-12.29058],[23.90937,-12.844],[24.03339,-12.99091],[21.97988,-13.00148],[22.00323,-16.18028],[22.17217,-16.50269],[23.20038,-17.47563],[23.47474,-17.62877],[24.23619,-17.47489],[24.32811,-17.49082],[24.38712,-17.46818],[24.5621,-17.52963],[24.70864,-17.49501],[25.00198,-17.58221],[25.26433,-17.79571],[25.51646,-17.86232],[25.6827,-17.81987],[25.85738,-17.91403],[25.85892,-17.97726],[26.08925,-17.98168],[26.0908,-17.93021],[26.21601,-17.88608],[26.55918,-17.99638],[26.68403,-18.07411],[26.74314,-18.0199],[26.89926,-17.98756],[27.14196,-17.81398],[27.30736,-17.60487],[27.61377,-17.34378],[27.62795,-17.24365],[27.83141,-16.96274],[28.73725,-16.5528],[28.76199,-16.51575],[28.81454,-16.48611],[28.8501,-16.04537],[28.9243,-15.93987],[29.01298,-15.93805],[29.21955,-15.76589],[29.4437,-15.68702],[29.8317,-15.6126],[30.35574,-15.6513],[30.41902,-15.62269],[30.22098,-14.99447],[33.24249,-14.00019],[33.16749,-13.93992],[33.07568,-13.98447],[33.02977,-14.05022],[32.99042,-13.95689],[32.88985,-13.82956],[32.79015,-13.80755],[32.76962,-13.77224],[32.84528,-13.71576],[32.7828,-13.64805],[32.68654,-13.64268],[32.66468,-13.60019],[32.68436,-13.55769],[32.73683,-13.57682],[32.84176,-13.52794],[32.86113,-13.47292],[33.0078,-13.19492],[32.98289,-13.12671],[33.02181,-12.88707],[32.96733,-12.88251],[32.94397,-12.76868],[33.05917,-12.59554],[33.18837,-12.61377],[33.28177,-12.54692],[33.37517,-12.54085],[33.54485,-12.35996],[33.47636,-12.32498],[33.3705,-12.34931],[33.25998,-12.14242],[33.33937,-11.91252],[33.32692,-11.59248],[33.24252,-11.59302],[33.23663,-11.40637],[33.29267,-11.43536],[33.29267,-11.3789],[33.39697,-11.15296],[33.25998,-10.88862],[33.28022,-10.84428],[33.47636,-10.78465],[33.70675,-10.56896],[33.54797,-10.36077],[33.53863,-10.20148],[33.31297,-10.05133],[33.37902,-9.9104],[33.36581,-9.81063],[33.31517,-9.82364],[33.2095,-9.61099],[33.12144,-9.58929],[33.10163,-9.66525],[33.05485,-9.61316],[33.00256,-9.63053],[33.00476,-9.5133],[32.95389,-9.40138]]]]}},{type:"Feature",properties:{iso1A2:"ZW",iso1A3:"ZWE",iso1N3:"716",wikidata:"Q954",nameEn:"Zimbabwe",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["263"]},geometry:{type:"MultiPolygon",coordinates:[[[[30.41902,-15.62269],[30.35574,-15.6513],[29.8317,-15.6126],[29.4437,-15.68702],[29.21955,-15.76589],[29.01298,-15.93805],[28.9243,-15.93987],[28.8501,-16.04537],[28.81454,-16.48611],[28.76199,-16.51575],[28.73725,-16.5528],[27.83141,-16.96274],[27.62795,-17.24365],[27.61377,-17.34378],[27.30736,-17.60487],[27.14196,-17.81398],[26.89926,-17.98756],[26.74314,-18.0199],[26.68403,-18.07411],[26.55918,-17.99638],[26.21601,-17.88608],[26.0908,-17.93021],[26.08925,-17.98168],[25.85892,-17.97726],[25.85738,-17.91403],[25.6827,-17.81987],[25.51646,-17.86232],[25.26433,-17.79571],[25.23909,-17.90832],[25.31799,-18.07091],[25.39972,-18.12691],[25.53465,-18.39041],[25.68859,-18.56165],[25.79217,-18.6355],[25.82353,-18.82808],[25.94326,-18.90362],[25.99837,-19.02943],[25.96226,-19.08152],[26.17227,-19.53709],[26.72246,-19.92707],[27.21278,-20.08244],[27.29831,-20.28935],[27.28865,-20.49873],[27.69361,-20.48531],[27.72972,-20.51735],[27.69171,-21.08409],[27.91407,-21.31621],[28.01669,-21.57624],[28.29416,-21.59037],[28.49942,-21.66634],[28.58114,-21.63455],[29.07763,-21.81877],[29.04023,-21.85864],[29.02191,-21.90647],[29.02191,-21.95665],[29.04108,-22.00563],[29.08495,-22.04867],[29.14501,-22.07275],[29.1974,-22.07472],[29.24648,-22.05967],[29.3533,-22.18363],[29.37703,-22.19581],[29.64609,-22.12917],[29.76848,-22.14128],[29.92242,-22.19408],[30.13147,-22.30841],[30.2265,-22.2961],[30.28351,-22.35587],[30.38614,-22.34533],[30.48686,-22.31368],[30.6294,-22.32599],[30.86696,-22.28907],[31.08932,-22.34884],[31.16344,-22.32599],[31.30611,-22.422],[31.38336,-22.36919],[32.41234,-21.31246],[32.48236,-21.32873],[32.37115,-21.133],[32.51644,-20.91929],[32.48122,-20.63319],[32.55167,-20.56312],[32.66174,-20.56106],[32.85987,-20.27841],[32.85987,-20.16686],[32.93032,-20.03868],[33.01178,-20.02007],[33.06461,-19.77787],[32.95013,-19.67219],[32.84666,-19.68462],[32.84446,-19.48343],[32.78282,-19.47513],[32.77966,-19.36098],[32.85107,-19.29238],[32.87088,-19.09279],[32.84006,-19.0262],[32.72118,-19.02204],[32.69917,-18.94293],[32.73439,-18.92628],[32.70137,-18.84712],[32.82465,-18.77419],[32.9017,-18.7992],[32.95013,-18.69079],[32.88629,-18.58023],[32.88629,-18.51344],[33.02278,-18.4696],[33.03159,-18.35054],[32.94133,-17.99705],[33.0492,-17.60298],[32.98536,-17.55891],[32.96554,-17.48964],[33.0426,-17.3468],[33.00517,-17.30477],[32.96554,-17.11971],[32.84113,-16.92259],[32.91051,-16.89446],[32.97655,-16.70689],[32.78943,-16.70267],[32.69917,-16.66893],[32.71017,-16.59932],[32.42838,-16.4727],[32.28529,-16.43892],[32.02772,-16.43892],[31.91324,-16.41569],[31.90223,-16.34388],[31.67988,-16.19595],[31.42451,-16.15154],[31.30563,-16.01193],[31.13171,-15.98019],[30.97761,-16.05848],[30.91597,-15.99924],[30.42568,-15.9962],[30.41902,-15.62269]]]]}}]},mW=pW,qE={},sn={},gW=/(?=(?!^(and|the|of|el|la|de)$))(\b(and|the|of|el|la|de)\b)|[-_ .,'()&[\]/]/gi;function hF(t){let e=t||"";return e.charAt(0)==="."?e.toUpperCase():e.replace(gW,"").toUpperCase()}var Xu=["subterritory","territory","subcountryGroup","country","sharedLandform","intermediateRegion","subregion","region","subunion","union","unitedNations","world"];yW(mW);function yW(t){let e=["iso1A2","iso1A3","m49","wikidata","emojiFlag","ccTLD","nameEn"],i=[];for(let T of t.features){let A=T.properties;A.id=A.iso1A2||A.m49||A.wikidata,n(T),o(T),a(T),l(T),s(T),v(T),b(T),T.geometry&&i.push(T)}for(let T of t.features)T.properties.groups=T.properties.groups.map(A=>sn[A].properties.id),E(T);for(let T of t.features)d(T),m(T),g(T),_(T),u(T);for(let T of t.features)T.properties.groups.sort((A,M)=>Xu.indexOf(sn[A].properties.level)-Xu.indexOf(sn[M].properties.level)),T.properties.members&&T.properties.members.sort((A,M)=>{let k=Xu.indexOf(sn[A].properties.level)-Xu.indexOf(sn[M].properties.level);return k===0?t.features.indexOf(sn[A])-t.features.indexOf(sn[M]):k});qE=(0,uF.default)({type:"FeatureCollection",features:i});function s(T){let A=T.properties;A.groups||(A.groups=[]),T.geometry&&A.country&&A.groups.push(A.country),A.m49!=="001"&&A.groups.push("001")}function n(T){let A=T.properties;!A.m49&&A.iso1N3&&(A.m49=A.iso1N3)}function o(T){let A=T.properties;A.level!=="unitedNations"&&!A.ccTLD&&A.iso1A2&&(A.ccTLD="."+A.iso1A2.toLowerCase())}function a(T){let A=T.properties;!A.isoStatus&&A.iso1A2&&(A.isoStatus="official")}function l(T){let A=T.properties;A.level||(A.country?!A.iso1A2||A.isoStatus==="official"?A.level="territory":A.level="subterritory":A.level="country")}function u(T){let A=T.properties;if(T.geometry||!A.members)return;let M=Xu.indexOf(A.level),k=[];A.members.forEach((F,O)=>{let U=sn[F].properties.groups.filter($=>$!==T.properties.id&&M<Xu.indexOf(sn[$].properties.level));O===0?k=U:k=k.filter($=>U.indexOf($)!==-1)}),A.groups=A.groups.concat(k.filter(F=>A.groups.indexOf(F)===-1));for(let F of k){let O=sn[F];O.properties.members.indexOf(A.id)===-1&&O.properties.members.push(A.id)}}function d(T){let A=T.properties;if(T.geometry)A.roadSpeedUnit||(A.roadSpeedUnit="km/h");else if(A.members){let M=Array.from(new Set(A.members.map(k=>{let F=sn[k];if(F.geometry)return F.properties.roadSpeedUnit||"km/h"}).filter(Boolean)));M.length===1&&(A.roadSpeedUnit=M[0])}}function m(T){let A=T.properties;if(T.geometry)A.roadHeightUnit||(A.roadHeightUnit="m");else if(A.members){let M=Array.from(new Set(A.members.map(k=>{let F=sn[k];if(F.geometry)return F.properties.roadHeightUnit||"m"}).filter(Boolean)));M.length===1&&(A.roadHeightUnit=M[0])}}function g(T){let A=T.properties;if(T.geometry)A.driveSide||(A.driveSide="right");else if(A.members){let M=Array.from(new Set(A.members.map(k=>{let F=sn[k];if(F.geometry)return F.properties.driveSide||"right"}).filter(Boolean)));M.length===1&&(A.driveSide=M[0])}}function _(T){let A=T.properties;!T.geometry&&A.members&&(A.callingCodes=Array.from(new Set(A.members.reduce((M,k)=>{let F=sn[k];return F.geometry&&F.properties.callingCodes?M.concat(F.properties.callingCodes):M},[]))))}function v(T){if(!T.properties.iso1A2)return;let A=T.properties.iso1A2.replace(/./g,function(M){return String.fromCodePoint(M.charCodeAt(0)+127397)});T.properties.emojiFlag=A}function E(T){for(let A of T.properties.groups){let M=sn[A];M.properties.members||(M.properties.members=[]),M.properties.members.push(T.properties.id)}}function b(T){let A=[];for(let M of e){let k=T.properties[M];k&&A.push(k)}for(let M of T.properties.aliases||[])A.push(M);for(let M of A){let k=hF(M);sn[k]=T}}}function _W(t){return Array.isArray(t)?t:t.coordinates?t.coordinates:t.geometry.coordinates}function dF(t){let e=_W(t),i=qE(e);return i?sn[i.id]:null}function xW(t){let e=dF(t);if(!e)return null;let i=e.properties.country||e.properties.iso1A2;return sn[i]||null}var fF={level:void 0,maxLevel:void 0,withProp:void 0};function vW(t,e){let i=e.level||"country",r=e.maxLevel||"world",s=e.withProp,n=Xu.indexOf(i);if(n===-1)return null;let o=Xu.indexOf(r);if(o===-1||o<n)return null;if(i==="country"){let u=xW(t);if(u&&(!s||u.properties[s]))return u}return wW(t).find(u=>{let d=Xu.indexOf(u.properties.level);return(u.properties.level===i||d>n&&d<=o)&&(!s||u.properties[s])?u:!1})||null}function YE(t){let e;return typeof t=="number"?(e=t.toString(),e.length===1?e="00"+e:e.length===2&&(e="0"+e)):e=hF(t),sn[e]||null}function bW(t){return qE.bbox(t).map(e=>sn[e.id])}function pF(t){return typeof t=="object"?dF(t):YE(t)}function km(t,e=fF){return typeof t=="object"?vW(t,e):YE(t)}function nh(t,e=fF){e.withProp="iso1A2";let i=km(t,e);return i&&i.properties.iso1A2||null}function wW(t,e){let i;if(Array.isArray(t)&&t.length===4)i=bW(t);else{let s=pF(t);i=s?[s]:[]}if(!i.length)return[];let r;!e||typeof t=="object"?r=i.slice():r=[];for(let s of i){let n=s.properties;for(let o of n.groups){let a=sn[o];r.indexOf(a)===-1&&r.push(a)}}return r}function EW(t,e){let i=YE(t);if(!i)return[];let r=[];e||r.push(i);let s=i.properties;for(let n of s.members||[])r.push(sn[n]);return r}function mF(t){let e=EW(t,!1);if(e.length===0)return null;let i=[];for(let r of e)r.geometry?.type==="MultiPolygon"&&r.geometry.coordinates&&(i=i.concat(r.geometry.coordinates));return{type:"Feature",properties:e[0].properties,geometry:{type:"MultiPolygon",coordinates:i}}}function gF(t){let e=pF(t);return e&&e.properties.roadSpeedUnit||null}var Mm=Xi(JE(),1),XF=Xi(UF(),1),aT=Xi(nT(),1),WF=Xi(zF(),1),qF=Xi(HF(),1),qg=class{constructor(t){this._cache={},this._strict=!0,t&&t.type==="FeatureCollection"&&Array.isArray(t.features)&&t.features.forEach(i=>{i.properties=i.properties||{};let r=i.properties,s=i.id||r.id;if(!(!s||!/^\S+\.geojson$/i.test(s))){if(s=s.toLowerCase(),i.id=s,r.id=s,!r.area){let n=Mm.default.geometry(i.geometry)/1e6;r.area=Number(n.toFixed(2))}this._cache[s]=i}});let e=VF(km("Q2"));e.geometry={type:"Polygon",coordinates:[[[-180,-90],[180,-90],[180,90],[-180,90],[-180,-90]]]},e.id="Q2",e.properties.id="Q2",e.properties.area=Mm.default.geometry(e.geometry)/1e6,this._cache.Q2=e}validateLocation(t){if(Array.isArray(t)&&(t.length===2||t.length===3)){let e=t[0],i=t[1],r=t[2];if(Number.isFinite(e)&&e>=-180&&e<=180&&Number.isFinite(i)&&i>=-90&&i<=90&&(t.length===2||Number.isFinite(r)&&r>0)){let s="["+t.toString()+"]";return{type:"point",location:t,id:s}}}else if(typeof t=="string"&&/^\S+\.geojson$/i.test(t)){let e=t.toLowerCase();if(this._cache[e])return{type:"geojson",location:t,id:e}}else if(typeof t=="string"||typeof t=="number"){let e=km(t);if(e){let i=e.properties.wikidata;return{type:"countrycoder",location:t,id:i}}}if(this._strict)throw new Error(`validateLocation:  Invalid location: "${t}".`);return null}resolveLocation(t){let e=this.validateLocation(t);if(!e)return null;let i=e.id;if(this._cache[i])return Object.assign(e,{feature:this._cache[i]});if(e.type==="point"){let r=t[0],s=t[1],n=t[2]||25,o=10,a=3,l=Math.PI*n*n,u=this._cache[i]=(0,WF.default)({type:"Feature",id:i,properties:{id:i,area:Number(l.toFixed(2))},geometry:(0,XF.default)([r,s],n*1e3,o)},a);return Object.assign(e,{feature:u})}else if(e.type!=="geojson"){if(e.type==="countrycoder"){let r=VF(km(i)),s=r.properties;if(Array.isArray(s.members)){let n=mF(i);n.geometry.coordinates=Wg([n],"UNION").geometry.coordinates,r.geometry=n.geometry}if(!s.area){let n=Mm.default.geometry(r.geometry)/1e6;s.area=Number(n.toFixed(2))}return r.id=i,s.id=i,this._cache[i]=r,Object.assign(e,{feature:r})}}if(this._strict)throw new Error(`resolveLocation:  Couldn't resolve location "${t}".`);return null}validateLocationSet(t){t=t||{};let e=this.validateLocation.bind(this),i=(t.include||[]).map(e).filter(Boolean),r=(t.exclude||[]).map(e).filter(Boolean);if(!i.length){if(this._strict)throw new Error("validateLocationSet:  LocationSet includes nothing.");t.include=["Q2"],i=[{type:"countrycoder",location:"Q2",id:"Q2"}]}i.sort(jF);let s="+["+i.map(n=>n.id).join(",")+"]";return r.length&&(r.sort(jF),s+="-["+r.map(n=>n.id).join(",")+"]"),{type:"locationset",locationSet:t,id:s}}resolveLocationSet(t){t=t||{};let e=this.validateLocationSet(t);if(!e)return null;let i=e.id;if(this._cache[i])return Object.assign(e,{feature:this._cache[i]});let r=this.resolveLocation.bind(this),s=(t.include||[]).map(r).filter(Boolean),n=(t.exclude||[]).map(r).filter(Boolean);if(s.length===1&&n.length===0)return Object.assign(e,{feature:s[0].feature});let o=Wg(s.map(d=>d.feature),"UNION"),a=Wg(n.map(d=>d.feature),"UNION"),l=a?Wg([o,a],"DIFFERENCE"):o,u=Mm.default.geometry(l.geometry)/1e6;return l.id=i,l.properties={id:i,area:Number(u.toFixed(2))},this._cache[i]=l,Object.assign(e,{feature:l})}strict(t){return t===void 0?this._strict:(this._strict=t,this)}cache(){return this._cache}stringify(t,e){return(0,qF.default)(t,e)}};function Wg(t,e){if(!Array.isArray(t)||!t.length)return null;let i={UNION:aT.default.union,DIFFERENCE:aT.default.difference}[e],r=t.map(o=>o.geometry.coordinates),s=i.apply(null,r);return{type:"Feature",properties:{},geometry:{type:n(s),coordinates:s}};function n(o){return Array.isArray(o)&&Array.isArray(o[0])&&Array.isArray(o[0][0])&&Array.isArray(o[0][0][0])?"MultiPolygon":"Polygon"}}function VF(t){return JSON.parse(JSON.stringify(t))}function jF(t,e){let i={countrycoder:1,geojson:2,point:3},r=i[t.type],s=i[e.type];return r>s?1:r<s?-1:t.id.localeCompare(e.id)}var lT=Xi(Am(),1),YF=Xi(JE(),1);var Wu=new qg,Pm=class extends ui{constructor(e){super(e),this.id="locations",this.dependencies=new Set,this._wp=null,this._resolved=new Map,this._knownLocationSets=new Map,this._locationIncludedIn=new Map,this._locationExcludedIn=new Map,this._blocks=[{locationSet:{include:["Q7835","ua"]},text:"Editing has been blocked in this region per request of the OSM Ukrainian community.",url:"https://wiki.openstreetmap.org/wiki/Russian%E2%80%93Ukrainian_war"}];let i=this._blocks.map(s=>{this._resolveLocationSet(s);let n=this._resolved.get(s.locationSetID);return Object.assign(n.properties,s),n});this._wpblocks=(0,lT.default)({type:"FeatureCollection",features:i});let r={locationSet:{include:["Q2"]}};this._resolveLocationSet(r),this._rebuildIndex()}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}_validateLocationSet(e){if(!e.locationSetID)try{let i=e.locationSet;if(!i)throw new Error("object missing locationSet property");i.include||(i.include=["Q2"]);let r=Wu.validateLocationSet(i).id;if(e.locationSetID=r,this._knownLocationSets.has(r))return;let s=0;(i.include||[]).forEach(n=>{let o=Wu.validateLocation(n).id,a=this._resolved.get(o);a||(a=Wu.resolveLocation(n).feature,this._resolved.set(o,a)),s+=a.properties.area;let l=this._locationIncludedIn.get(o);l||(l=new Set,this._locationIncludedIn.set(o,l)),l.add(r)}),(i.exclude||[]).forEach(n=>{let o=Wu.validateLocation(n).id,a=this._resolved.get(o);a||(a=Wu.resolveLocation(n).feature,this._resolved.set(o,a)),s-=a.properties.area;let l=this._locationExcludedIn.get(o);l||(l=new Set,this._locationExcludedIn.set(o,l)),l.add(r)}),this._knownLocationSets.set(r,s)}catch{e.locationSet={include:["Q2"]},e.locationSetID="+[Q2]"}}_resolveLocationSet(e){if(this._validateLocationSet(e),!this._resolved.has(e.locationSetID))try{let i=Wu.resolveLocationSet(e.locationSet),r=i.id;if(e.locationSetID=r,!i.feature.geometry.coordinates.length||!i.feature.properties.area)throw new Error(`locationSet ${r} resolves to an empty feature.`);let s=JSON.parse(JSON.stringify(i.feature));s.id=r,s.properties.id=r,this._resolved.set(r,s)}catch{e.locationSet={include:["Q2"]},e.locationSetID="+[Q2]"}}_rebuildIndex(){this._wp=(0,lT.default)({features:[...this._resolved.values()]}),this.emit("locationchange")}mergeCustomGeoJSON(e){!e||e.type!=="FeatureCollection"||!Array.isArray(e.features)||e.features.forEach(i=>{i.properties=i.properties||{};let r=i.properties,s=i.id||r.id;if(!(!s||!/^\S+\.geojson$/i.test(s))){if(s=s.toLowerCase(),i.id=s,r.id=s,!r.area){let n=YF.default.geometry(i.geometry)/1e6;r.area=Number(n.toFixed(2))}Wu._cache[s]=i}})}mergeLocationSets(e){return Array.isArray(e)?(e.forEach(i=>this._validateLocationSet(i)),this._rebuildIndex(),Promise.resolve(e)):Promise.reject("nothing to do")}locationSetID(e){let i;try{i=Wu.validateLocationSet(e).id}catch{i="+[Q2]"}return i}feature(e="+[Q2]"){return this._resolved.get(e)||this._resolved.get("+[Q2]")}locationSetsAt(e){let i={},r=this._wp(e,!0)||[],s=this;return r.forEach(n=>{if(n.id[0]!=="+")return;let o=n.id,a=s._knownLocationSets.get(o);a&&(i[o]=a)}),r.forEach(n=>{if(n.id[0]==="+")return;let o=n.id;(s._locationIncludedIn.get(o)||[]).forEach(l=>{let u=s._knownLocationSets.get(l);u&&(i[l]=u)})}),r.forEach(n=>{if(n.id[0]==="+")return;let o=n.id;(s._locationExcludedIn.get(o)||[]).forEach(l=>{delete i[l]})}),i}blocksAt(e){return this._blocks.length?this._wpblocks(e,!0)||[]:[]}loco(){return Wu}wpblocks(){return this._wpblocks}};var Yg=class extends en.default{constructor(e){super(),this._enabled=!1,this.renderer=e,this.context=e.context,this.pointerOverRenderer=!1,this.modifierKeys=new Set,this.coord=[0,0],this._wheelDefault=Os().os==="mac"?"auto":"zoom",this._click=this._click.bind(this),this._keydown=this._keydown.bind(this),this._keyup=this._keyup.bind(this),this._pointercancel=this._pointercancel.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerout=this._pointerout.bind(this),this._pointerover=this._pointerover.bind(this),this._pointerup=this._pointerup.bind(this),this._wheel=this._wheel.bind(this),this.enable()}get enabled(){return this._enabled}enable(){if(this._enabled)return;this._enabled=!0,this.modifierKeys.clear(),window.addEventListener("keydown",this._keydown),window.addEventListener("keyup",this._keyup),this.renderer.supersurface.node().addEventListener("wheel",this._wheel,{passive:!1});let i=this.context.pixi.view;i.addEventListener("pointerover",this._pointerover),i.addEventListener("pointerout",this._pointerout);let r=this.context.pixi.stage;r.addEventListener("click",this._click),r.addEventListener("pointerdown",this._pointerdown),r.addEventListener("pointermove",this._pointermove),r.addEventListener("pointerup",this._pointerup),r.addEventListener("pointerupoutside",this._pointercancel),r.addEventListener("pointercancel",this._pointercancel)}disable(){if(!this._enabled)return;this._enabled=!1,this.modifierKeys.clear(),window.removeEventListener("keydown",this._keydown),window.removeEventListener("keyup",this._keyup),this.renderer.supersurface.node().removeEventListener("wheel",this._wheel);let i=this.context.pixi.view;i.removeEventListener("pointerover",this._pointerover),i.removeEventListener("pointerout",this._pointerout);let r=this.context.pixi.stage;r.removeEventListener("click",this._click),r.removeEventListener("pointerdown",this._pointerdown),r.removeEventListener("pointermove",this._pointermove),r.removeEventListener("pointerup",this._pointerup),r.removeEventListener("pointerupoutside",this._pointercancel),r.removeEventListener("pointercancel",this._pointercancel)}setCursor(e){this.renderer.stage.cursor=e,this.renderer.pixi.view.style.cursor=e}_observeModifierKeys(e){let i=this.modifierKeys,r=["Alt","Control","Meta","Shift"],s=!1;for(let n of r){let o=e.getModifierState(n),a=i.has(n);o&&!a?(i.add(n),s=!0):!o&&a&&(i.delete(n),s=!0)}s&&this.emit("modifierchange",i)}_keydown(e){this._observeModifierKeys(e),this.emit("keydown",e)}_keyup(e){this._observeModifierKeys(e),this.emit("keyup",e)}_pointerover(e){this._observeModifierKeys(e),this.pointerOverRenderer=!0,this.emit("pointerover",e)}_pointerout(e){this._observeModifierKeys(e),this.pointerOverRenderer=!1,this.emit("pointerout",e)}_pointerdown(e){this._observeModifierKeys(e),this.coord=[e.global.x,e.global.y],this.emit("pointerdown",e)}_pointermove(e){this._observeModifierKeys(e),this.coord=[e.global.x,e.global.y],this.emit("pointermove",e)}_pointerup(e){this._observeModifierKeys(e),this.coord=[e.global.x,e.global.y],this.emit("pointerup",e)}_pointercancel(e){this.emit("pointercancel",e)}_click(e){this.emit("click",e)}_wheel(e){e.preventDefault(),e.stopImmediatePropagation();let[i,r]=this._normalizeWheelDelta(e);this.coord=[e.offsetX,e.offsetY];let s=typeof r=="number"&&isFinite(r)&&Math.floor(r)===r,n=!s&&e.ctrlKey&&!this.modifierKeys.has("Control"),o="zoom",a=3;if(n)o="zoom",a=6;else if(e.shiftKey)o="zoom",a=3;else{let u=this.context.systems.storage.getItem("prefs.mouse_wheel.interaction")??this._wheelDefault;u==="pan"||u==="auto"&&(i||s)?(o="pan",a=1):(o="zoom",a=3)}e._gesture=o,e._normalizedDeltaX=i*a,e._normalizedDeltaY=r*a,this.emit("wheel",e)}_normalizeWheelDelta(e){let[i,r]=[e.deltaX,e.deltaY];r===0&&e.shiftKey&&([i,r]=[e.deltaY,e.deltaX]);let[s,n]=[Math.sign(i),Math.sign(r)],[o,a]=[Math.abs(i),Math.abs(r)],l=typeof a=="number"&&isFinite(o)&&Math.floor(o)===o,u=typeof a=="number"&&isFinite(a)&&Math.floor(a)===a,d=l?0:.001,m=u?0:.001;if(e.deltaMode!==WheelEvent.DOM_DELTA_PIXEL){let E;e.deltaMode===WheelEvent.DOM_DELTA_LINE?E=8:e.deltaMode===WheelEvent.DOM_DELTA_PAGE?E=24:E=1,o*=E,a*=E}let g=40,_=s*(Math.min(g,o)+d),v=n*(Math.min(g,a)+m);return[_,v]}};var NW=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,OW=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform float gamma;
uniform float contrast;
uniform float saturation;
uniform float brightness;
uniform float red;
uniform float green;
uniform float blue;
uniform float alpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (c.a > 0.0) {
        c.rgb /= c.a;

        vec3 rgb = pow(c.rgb, vec3(1. / gamma));
        rgb = mix(vec3(.5), mix(vec3(dot(vec3(.2125, .7154, .0721), rgb)), rgb, saturation), contrast);
        rgb.r *= red;
        rgb.g *= green;
        rgb.b *= blue;
        c.rgb = rgb * brightness;

        c.rgb *= c.a;
    }

    gl_FragColor = c * alpha;
}
`,Zg=class extends Wt{constructor(e){super(NW,OW),this.gamma=1,this.saturation=1,this.contrast=1,this.brightness=1,this.red=1,this.green=1,this.blue=1,this.alpha=1,Object.assign(this,e)}apply(e,i,r,s){this.uniforms.gamma=Math.max(this.gamma,1e-4),this.uniforms.saturation=this.saturation,this.uniforms.contrast=this.contrast,this.uniforms.brightness=this.brightness,this.uniforms.red=this.red,this.uniforms.green=this.green,this.uniforms.blue=this.blue,this.uniforms.alpha=this.alpha,e.applyFilter(this,i,r,s)}};var BW=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,UW=`
varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec2 uOffset;

void main(void)
{
    vec4 color = vec4(0.0);

    // Sample top left pixel
    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y));

    // Sample top right pixel
    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y));

    // Sample bottom right pixel
    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y));

    // Sample bottom left pixel
    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y));

    // Average
    color *= 0.25;

    gl_FragColor = color;
}`,zW=`
varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec2 uOffset;
uniform vec4 filterClamp;

void main(void)
{
    vec4 color = vec4(0.0);

    // Sample top left pixel
    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));

    // Sample top right pixel
    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));

    // Sample bottom right pixel
    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));

    // Sample bottom left pixel
    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));

    // Average
    color *= 0.25;

    gl_FragColor = color;
}
`,oh=class extends Wt{constructor(e=4,i=3,r=!1){super(BW,r?zW:UW),this._kernels=[],this._blur=4,this._quality=3,this.uniforms.uOffset=new Float32Array(2),this._pixelSize=new Jt,this.pixelSize=1,this._clamp=r,Array.isArray(e)?this.kernels=e:(this._blur=e,this.quality=i)}apply(e,i,r,s){let n=this._pixelSize.x/i._frame.width,o=this._pixelSize.y/i._frame.height,a;if(this._quality===1||this._blur===0)a=this._kernels[0]+.5,this.uniforms.uOffset[0]=a*n,this.uniforms.uOffset[1]=a*o,e.applyFilter(this,i,r,s);else{let l=e.getFilterTexture(),u=i,d=l,m,g=this._quality-1;for(let _=0;_<g;_++)a=this._kernels[_]+.5,this.uniforms.uOffset[0]=a*n,this.uniforms.uOffset[1]=a*o,e.applyFilter(this,u,d,1),m=u,u=d,d=m;a=this._kernels[g]+.5,this.uniforms.uOffset[0]=a*n,this.uniforms.uOffset[1]=a*o,e.applyFilter(this,u,r,s),e.returnFilterTexture(l)}}_updatePadding(){this.padding=Math.ceil(this._kernels.reduce((e,i)=>e+i+.5,0))}_generateKernels(){let e=this._blur,i=this._quality,r=[e];if(e>0){let s=e,n=e/i;for(let o=1;o<i;o++)s-=n,r.push(s)}this._kernels=r,this._updatePadding()}get kernels(){return this._kernels}set kernels(e){Array.isArray(e)&&e.length>0?(this._kernels=e,this._quality=e.length,this._blur=Math.max(...e)):(this._kernels=[0],this._quality=1)}get clamp(){return this._clamp}set pixelSize(e){typeof e=="number"?(this._pixelSize.x=e,this._pixelSize.y=e):Array.isArray(e)?(this._pixelSize.x=e[0],this._pixelSize.y=e[1]):e instanceof Jt?(this._pixelSize.x=e.x,this._pixelSize.y=e.y):(this._pixelSize.x=1,this._pixelSize.y=1)}get pixelSize(){return this._pixelSize}get quality(){return this._quality}set quality(e){this._quality=Math.max(1,Math.round(e)),this._generateKernels()}get blur(){return this._blur}set blur(e){this._blur=e,this._generateKernels()}};var ZF=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,GW=`
uniform sampler2D uSampler;
varying vec2 vTextureCoord;

uniform float threshold;

void main() {
    vec4 color = texture2D(uSampler, vTextureCoord);

    // A simple & fast algorithm for getting brightness.
    // It's inaccuracy , but good enought for this feature.
    float _max = max(max(color.r, color.g), color.b);
    float _min = min(min(color.r, color.g), color.b);
    float brightness = (_max + _min) * 0.5;

    if(brightness > threshold) {
        gl_FragColor = color;
    } else {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
    }
}
`,cT=class extends Wt{constructor(e=.5){super(ZF,GW),this.threshold=e}get threshold(){return this.uniforms.threshold}set threshold(e){this.uniforms.threshold=e}},$W=`uniform sampler2D uSampler;
varying vec2 vTextureCoord;

uniform sampler2D bloomTexture;
uniform float bloomScale;
uniform float brightness;

void main() {
    vec4 color = texture2D(uSampler, vTextureCoord);
    color.rgb *= brightness;
    vec4 bloomColor = vec4(texture2D(bloomTexture, vTextureCoord).rgb, 0.0);
    bloomColor.rgb *= bloomScale;
    gl_FragColor = color + bloomColor;
}
`,QF=class extends Wt{constructor(t){super(ZF,$W),this.bloomScale=1,this.brightness=1,this._resolution=ut.FILTER_RESOLUTION,typeof t=="number"&&(t={threshold:t});let e=Object.assign(QF.defaults,t);this.bloomScale=e.bloomScale,this.brightness=e.brightness;let{kernels:i,blur:r,quality:s,pixelSize:n,resolution:o}=e;this._extractFilter=new cT(e.threshold),this._extractFilter.resolution=o,this._blurFilter=i?new oh(i):new oh(r,s),this.pixelSize=n,this.resolution=o}apply(t,e,i,r,s){let n=t.getFilterTexture();this._extractFilter.apply(t,e,n,1,s);let o=t.getFilterTexture();this._blurFilter.apply(t,n,o,1),this.uniforms.bloomScale=this.bloomScale,this.uniforms.brightness=this.brightness,this.uniforms.bloomTexture=o,t.applyFilter(this,e,i,r),t.returnFilterTexture(o),t.returnFilterTexture(n)}get resolution(){return this._resolution}set resolution(t){this._resolution=t,this._extractFilter&&(this._extractFilter.resolution=t),this._blurFilter&&(this._blurFilter.resolution=t)}get threshold(){return this._extractFilter.threshold}set threshold(t){this._extractFilter.threshold=t}get kernels(){return this._blurFilter.kernels}set kernels(t){this._blurFilter.kernels=t}get blur(){return this._blurFilter.blur}set blur(t){this._blurFilter.blur=t}get quality(){return this._blurFilter.quality}set quality(t){this._blurFilter.quality=t}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(t){this._blurFilter.pixelSize=t}},HW=QF;HW.defaults={threshold:.5,bloomScale:1,brightness:1,kernels:null,blur:8,quality:4,pixelSize:1,resolution:ut.FILTER_RESOLUTION};var Ya=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(Ya||{}),uT=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS",t))(uT||{}),Qg=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(Qg||{}),Vi=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(Vi||{}),t4=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(t4||{}),ri=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(ri||{}),qu=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(qu||{}),mr=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(mr||{}),Kg=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(Kg||{}),Ml=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(Ml||{}),Rm=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(Rm||{}),lc=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(lc||{}),va=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(va||{}),ah=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(ah||{}),Jg=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(Jg||{}),ea=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(ea||{}),bn=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(bn||{});var Wr=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(Wr||{}),ba=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(ba||{});var hT={createCanvas:(t,e)=>{let i=document.createElement("canvas");return i.width=t,i.height=e,i},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>new DOMParser().parseFromString(t,"text/xml")};var Mi={ADAPTER:hT,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var VW=O1.default??O1,cc=VW(globalThis.navigator);Mi.RETINA_PREFIX=/@([0-9\.]+)x/;Mi.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Vd=Xi(lw(),1),ZW=Xi(fw(),1);var i4=Xi(yw(),1),dT={parse:i4.parse,format:i4.format,resolve:i4.resolve};var KF={};function br(t,e,i=3){if(KF[e])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${t}`):(r=r.split(`
`).splice(i).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${t}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${t}`),console.warn(r))),KF[e]=!0}var fT;function pT(){return typeof fT>"u"&&(fT=function(){let e={stencil:!0,failIfMajorPerformanceCaveat:Mi.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Mi.ADAPTER.getWebGLRenderingContext())return!1;let i=Mi.ADAPTER.createCanvas(),r=i.getContext("webgl",e)||i.getContext("experimental-webgl",e),s=!!r?.getContextAttributes()?.stencil;if(r){let n=r.getExtension("WEBGL_lose_context");n&&n.loseContext()}return r=null,s}catch{return!1}}()),fT}Xf([Wf]);var r4=class{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof r4)this._value=t._value,this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");this._value!==t&&(this.normalize(t),this._value=t)}}get value(){return this._value}toRgba(){let[t,e,i,r]=this._components;return{r:t,g:e,b:i,a:r}}toRgb(){let[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){let[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){let[e,i,r]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(r*255),t}toRgbArray(t){t=t??[];let[e,i,r]=this._components;return t[0]=e,t[1]=i,t[2]=r,t}toNumber(){return this._int}toLittleEndianNumber(){let t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){let[e,i,r,s]=r4.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=r,this._components[3]*=s,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t){if(t===1)return(t*255<<24)+this._int;if(t===0)return 0;let e=this._int>>16&255,i=this._int>>8&255,r=this._int&255;return e=e*t+.5|0,i=i*t+.5|0,r=r*t+.5|0,(t*255<<24)+(e<<16)+(i<<8)+r}toHex(){let t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){let e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(t){return this._components[3]=t,this}round(t){let[e,i,r]=this._components;return this._components.set([Math.min(255,e/t*t),Math.min(255,i/t*t),Math.min(255,r/t*t)]),this.refreshInt(),this._value=null,this}toArray(t){t=t??[];let[e,i,r,s]=this._components;return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}normalize(t){let e;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){let i=t;e=[(i>>16&255)/255,(i>>8&255)/255,(i&255)/255,1]}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4&&t.every(i=>i<=1&&i>=0)){let[i,r,s,n=1]=t;e=[i,r,s,n]}else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4){let[i,r,s,n=255]=t;e=[i/255,r/255,s/255,n/255]}else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){let r=r4.HEX_PATTERN.exec(t);r&&(t=`#${r[2]}`)}let i=jo(t);if(i.isValid()){let{r,g:s,b:n,a:o}=i.rgba;e=[r/255,s/255,n/255,o]}}if(e)this._components.set(e),this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){let[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}},wa=r4;wa.shared=new r4;wa.temp=new r4;wa.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;function jW(){let t=[],e=[];for(let r=0;r<32;r++)t[r]=r,e[r]=r;t[Vi.NORMAL_NPM]=Vi.NORMAL,t[Vi.ADD_NPM]=Vi.ADD,t[Vi.SCREEN_NPM]=Vi.SCREEN,e[Vi.NORMAL]=Vi.NORMAL_NPM,e[Vi.ADD]=Vi.ADD_NPM,e[Vi.SCREEN]=Vi.SCREEN_NPM;let i=[];return i.push(e),i.push(t),i}var mT=jW();function s4(t){if(t.BYTES_PER_ELEMENT===4)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(t.BYTES_PER_ELEMENT===2){if(t instanceof Uint16Array)return"Uint16Array"}else if(t.BYTES_PER_ELEMENT===1&&t instanceof Uint8Array)return"Uint8Array";return null}function Hd(t){return t+=t===0?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t+1}function ey(t){return!(t&t-1)&&!!t}function ty(t){let e=(t>65535?1:0)<<4;t>>>=e;let i=(t>255?1:0)<<3;return t>>>=i,e|=i,i=(t>15?1:0)<<2,t>>>=i,e|=i,i=(t>3?1:0)<<1,t>>>=i,e|=i,e|t>>1}function gT(t,e,i){let r=t.length,s;if(e>=r||i===0)return;i=e+i>r?r-e:i;let n=r-i;for(s=e;s<n;++s)t[s]=t[s+i];t.length=n}var XW=0;function Yu(){return++XW}var JF=class{constructor(t,e,i,r){this.left=t,this.top=e,this.right=i,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}},yT=JF;yT.EMPTY=new JF(0,0,0,0);var iy={},Za=Object.create(null),jc=Object.create(null);var ry;function _T(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location,ry||(ry=document.createElement("a")),ry.href=t;let i=dT.parse(ry.href),r=!i.port&&e.port===""||i.port===e.port;return i.hostname!==e.hostname||!r||i.protocol!==e.protocol?"anonymous":""}function sy(t,e=1){let i=Mi.RETINA_PREFIX?.exec(t);return i?parseFloat(i[1]):e}var bi=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(bi||{}),xT=t=>{if(typeof t=="function"||typeof t=="object"&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={...typeof t.extension!="object"?{type:t.extension}:t.extension,ref:t}}if(typeof t=="object")t={...t};else throw new Error("Invalid extension type");return typeof t.type=="string"&&(t.type=[t.type]),t},eL=(t,e)=>xT(t).priority??e,Di={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(xT).forEach(e=>{e.type.forEach(i=>this._removeHandlers[i]?.(e))}),this},add(...t){return t.map(xT).forEach(e=>{e.type.forEach(i=>{let r=this._addHandlers,s=this._queue;r[i]?r[i](e):(s[i]=s[i]||[],s[i].push(e))})}),this},handle(t,e,i){let r=this._addHandlers,s=this._removeHandlers;if(r[t]||s[t])throw new Error(`Extension type ${t} already has a handler`);r[t]=e,s[t]=i;let n=this._queue;return n[t]&&(n[t].forEach(o=>e(o)),delete n[t]),this},handleByMap(t,e){return this.handle(t,i=>{e[i.name]=i.ref},i=>{delete e[i.name]})},handleByList(t,e,i=-1){return this.handle(t,r=>{e.includes(r.ref)||(e.push(r.ref),e.sort((s,n)=>eL(n,i)-eL(s,i)))},r=>{let s=e.indexOf(r.ref);s!==-1&&e.splice(s,1)})}};var Dm=class{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}};var QW=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function KW(t){let e="";for(let i=0;i<t;++i)i>0&&(e+=`
else `),i<t-1&&(e+=`if(test == ${i}.0){}`);return e}function ny(t,e){if(t===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");let i=e.createShader(e.FRAGMENT_SHADER);for(;;){let r=QW.replace(/%forloop%/gi,KW(t));if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))t=t/2|0;else break}return t}var vT=0,bT=1,wT=2,ET=3,TT=4,ST=5,Zu=class t{constructor(){this.data=0,this.blendMode=Vi.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<vT)}set blend(e){!!(this.data&1<<vT)!==e&&(this.data^=1<<vT)}get offsets(){return!!(this.data&1<<bT)}set offsets(e){!!(this.data&1<<bT)!==e&&(this.data^=1<<bT)}get culling(){return!!(this.data&1<<wT)}set culling(e){!!(this.data&1<<wT)!==e&&(this.data^=1<<wT)}get depthTest(){return!!(this.data&1<<ET)}set depthTest(e){!!(this.data&1<<ET)!==e&&(this.data^=1<<ET)}get depthMask(){return!!(this.data&1<<ST)}set depthMask(e){!!(this.data&1<<ST)!==e&&(this.data^=1<<ST)}get clockwiseFrontFace(){return!!(this.data&1<<TT)}set clockwiseFrontFace(e){!!(this.data&1<<TT)!==e&&(this.data^=1<<TT)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==Vi.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){let e=new t;return e.depthTest=!1,e.blend=!0,e}};var n4=[];function o4(t,e){if(!t)return null;let i="";if(typeof t=="string"){let r=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);r&&(i=r[1].toLowerCase())}for(let r=n4.length-1;r>=0;--r){let s=n4[r];if(s.test&&s.test(t,i))return new s(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}var mn=class{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,i,r,s,n,o,a,l){if(arguments.length>8)throw new Error("max arguments reached");let{name:u,items:d}=this;this._aliasCount++;for(let m=0,g=d.length;m<g;m++)d[m][u](e,i,r,s,n,o,a,l);return d===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){let i=this.items.indexOf(e);return i!==-1&&(this.ensureNonAliasedItems(),this.items.splice(i,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}};Object.defineProperties(mn.prototype,{dispatch:{value:mn.prototype.emit},run:{value:mn.prototype.emit}});var Qa=class{constructor(e=0,i=0){this._width=e,this._height=i,this.destroyed=!1,this.internal=!1,this.onResize=new mn("setRealSize"),this.onUpdate=new mn("update"),this.onError=new mn("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,i){(e!==this._width||i!==this._height)&&(this._width=e,this._height=i,this.onResize.emit(e,i))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,i,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,i){return!1}};var Xc=class extends Qa{constructor(e,i){let{width:r,height:s}=i||{};if(!r||!s)throw new Error("BufferResource width or height invalid");super(r,s),this.data=e}upload(e,i,r){let s=e.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===va.UNPACK);let n=i.realWidth,o=i.realHeight;return r.width===n&&r.height===o?s.texSubImage2D(i.target,0,0,0,n,o,i.format,r.type,this.data):(r.width=n,r.height=o,s.texImage2D(i.target,0,r.internalFormat,n,o,0,i.format,r.type,this.data)),!0}dispose(){this.data=null}static test(e){return e instanceof Float32Array||e instanceof Uint8Array||e instanceof Uint32Array}};var JW={scaleMode:Ml.NEAREST,format:ri.RGBA,alphaMode:va.NPM},a4=class extends Vd.default{constructor(t=null,e=null){super(),e=Object.assign({},a4.defaultOptions,e);let{alphaMode:i,mipmap:r,anisotropicLevel:s,scaleMode:n,width:o,height:a,wrapMode:l,format:u,type:d,target:m,resolution:g,resourceOptions:_}=e;t&&!(t instanceof Qa)&&(t=o4(t,_),t.internal=!0),this.resolution=g||Mi.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=s,this._wrapMode=l,this._scaleMode=n,this.format=u,this.type=d,this.target=m,this.alphaMode=i,this.uid=Yu(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=ey(this.realWidth)&&ey(this.realHeight)}setResolution(t){let e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete jc[this.cacheId],delete Za[this.cacheId],this.cacheId=null),this.dispose(),a4.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,i=Mi.STRICT_TEXTURE_CACHE){let r=typeof t=="string",s=null;if(r)s=t;else{if(!t._pixiId){let o=e?.pixiIdPrefix||"pixiid";t._pixiId=`${o}_${Yu()}`}s=t._pixiId}let n=jc[s];if(r&&i&&!n)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return n||(n=new a4(t,e),n.cacheId=s,a4.addToCache(n,s)),n}static fromBuffer(t,e,i,r){t=t||new Float32Array(e*i*4);let s=new Xc(t,{width:e,height:i}),n=t instanceof Float32Array?mr.FLOAT:mr.UNSIGNED_BYTE;return new a4(s,Object.assign({},JW,r||{width:e,height:i,type:n}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),jc[e]&&jc[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),jc[e]=t)}static removeFromCache(t){if(typeof t=="string"){let e=jc[t];if(e){let i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete jc[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete jc[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}},_r=a4;_r.defaultOptions={mipmap:lc.POW2,anisotropicLevel:0,scaleMode:Ml.LINEAR,wrapMode:Rm.CLAMP,alphaMode:va.UNPACK,target:qu.TEXTURE_2D,format:ri.RGBA,type:mr.UNSIGNED_BYTE};_r._globalBatch=0;var Fm=class{constructor(){this.texArray=null,this.blend=0,this.type=t4.TRIANGLES,this.start=0,this.size=0,this.data=null}};var eq=0,wn=class t{constructor(e,i=!0,r=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=i,this.id=eq++,this.disposeRunner=new mn("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?ba.ELEMENT_ARRAY_BUFFER:ba.ARRAY_BUFFER}get index(){return this.type===ba.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new t(e)}};var l4=class t{constructor(e,i=0,r=!1,s=mr.FLOAT,n,o,a,l=1){this.buffer=e,this.size=i,this.normalized=r,this.type=s,this.stride=n,this.start=o,this.instance=a,this.divisor=l}destroy(){this.buffer=null}static from(e,i,r,s,n){return new t(e,i,r,s,n)}};var tq={Float32Array,Uint32Array,Int32Array,Uint8Array};function tL(t,e){let i=0,r=0,s={};for(let l=0;l<t.length;l++)r+=e[l],i+=t[l].length;let n=new ArrayBuffer(i*4),o=null,a=0;for(let l=0;l<t.length;l++){let u=e[l],d=t[l],m=s4(d);s[m]||(s[m]=new tq[m](n)),o=s[m];for(let g=0;g<d.length;g++){let _=(g/u|0)*r+a,v=g%u;o[_+v]=d[g]}a+=u}return new Float32Array(n)}var iL={5126:4,5123:2,5121:1},iq=0,rq={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},Qu=class t{constructor(e=[],i={}){this.buffers=e,this.indexBuffer=null,this.attributes=i,this.glVertexArrayObjects={},this.id=iq++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new mn("disposeGeometry"),this.refCount=0}addAttribute(e,i,r=0,s=!1,n,o,a,l=!1){if(!i)throw new Error("You must pass a buffer when creating an attribute");i instanceof wn||(i instanceof Array&&(i=new Float32Array(i)),i=new wn(i));let u=e.split("|");if(u.length>1){for(let m=0;m<u.length;m++)this.addAttribute(u[m],i,r,s,n);return this}let d=this.buffers.indexOf(i);return d===-1&&(this.buffers.push(i),d=this.buffers.length-1),this.attributes[e]=new l4(d,r,s,n,o,a,l),this.instanced=this.instanced||l,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof wn||(e instanceof Array&&(e=new Uint16Array(e)),e=new wn(e)),e.type=ba.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;let e=[],i=[],r=new wn,s;for(s in this.attributes){let n=this.attributes[s],o=this.buffers[n.buffer];e.push(o.data),i.push(n.size*iL[n.type]/4),n.buffer=0}for(r.data=tL(e,i),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(let e in this.attributes){let i=this.attributes[e];return this.buffers[i.buffer].data.length/(i.stride/4||i.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){let e=new t;for(let i=0;i<this.buffers.length;i++)e.buffers[i]=new wn(this.buffers[i].data.slice(0));for(let i in this.attributes){let r=this.attributes[i];e.attributes[i]=new l4(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=ba.ELEMENT_ARRAY_BUFFER),e}static merge(e){let i=new t,r=[],s=[],n=[],o;for(let a=0;a<e.length;a++){o=e[a];for(let l=0;l<o.buffers.length;l++)s[l]=s[l]||0,s[l]+=o.buffers[l].data.length,n[l]=0}for(let a=0;a<o.buffers.length;a++)r[a]=new rq[s4(o.buffers[a].data)](s[a]),i.buffers[a]=new wn(r[a]);for(let a=0;a<e.length;a++){o=e[a];for(let l=0;l<o.buffers.length;l++)r[l].set(o.buffers[l].data,n[l]),n[l]+=o.buffers[l].data.length}if(i.attributes=o.attributes,o.indexBuffer){i.indexBuffer=i.buffers[o.buffers.indexOf(o.indexBuffer)],i.indexBuffer.type=ba.ELEMENT_ARRAY_BUFFER;let a=0,l=0,u=0,d=0;for(let m=0;m<o.buffers.length;m++)if(o.buffers[m]!==o.indexBuffer){d=m;break}for(let m in o.attributes){let g=o.attributes[m];(g.buffer|0)===d&&(l+=g.size*iL[g.type]/4)}for(let m=0;m<e.length;m++){let g=e[m].indexBuffer.data;for(let _=0;_<g.length;_++)i.indexBuffer.data[_+u]+=a;a+=e[m].buffers[d].data.length/l,u+=g.length}}return i}};var Lm=class extends Qu{constructor(e=!1){super(),this._buffer=new wn(null,e,!1),this._indexBuffer=new wn(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,mr.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,mr.FLOAT).addAttribute("aColor",this._buffer,4,!0,mr.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,mr.FLOAT).addIndex(this._indexBuffer)}};var AT=Math.PI*2,sq=180/Math.PI,nq=Math.PI/180,lh=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(lh||{});var En=class t{constructor(e=0,i=0){this.x=0,this.y=0,this.x=e,this.y=i}clone(){return new t(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,i=e){return this.x=e,this.y=i,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}};var oy=[new En,new En,new En,new En],qr=class t{constructor(e=0,i=0,r=0,s=0){this.x=Number(e),this.y=Number(i),this.width=Number(r),this.height=Number(s),this.type=lh.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new t(0,0,0,0)}clone(){return new t(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,i){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&i>=this.y&&i<this.y+this.height}intersects(e,i){if(!i){let U=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=U)return!1;let q=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>q}let r=this.left,s=this.right,n=this.top,o=this.bottom;if(s<=r||o<=n)return!1;let a=oy[0].set(e.left,e.top),l=oy[1].set(e.left,e.bottom),u=oy[2].set(e.right,e.top),d=oy[3].set(e.right,e.bottom);if(u.x<=a.x||l.y<=a.y)return!1;let m=Math.sign(i.a*i.d-i.b*i.c);if(m===0||(i.apply(a,a),i.apply(l,l),i.apply(u,u),i.apply(d,d),Math.max(a.x,l.x,u.x,d.x)<=r||Math.min(a.x,l.x,u.x,d.x)>=s||Math.max(a.y,l.y,u.y,d.y)<=n||Math.min(a.y,l.y,u.y,d.y)>=o))return!1;let g=m*(l.y-a.y),_=m*(a.x-l.x),v=g*r+_*n,E=g*s+_*n,b=g*r+_*o,T=g*s+_*o;if(Math.max(v,E,b,T)<=g*a.x+_*a.y||Math.min(v,E,b,T)>=g*d.x+_*d.y)return!1;let A=m*(a.y-u.y),M=m*(u.x-a.x),k=A*r+M*n,F=A*s+M*n,O=A*r+M*o,B=A*s+M*o;return!(Math.max(k,F,O,B)<=A*a.x+M*a.y||Math.min(k,F,O,B)>=A*d.x+M*d.y)}pad(e=0,i=e){return this.x-=e,this.y-=i,this.width+=e*2,this.height+=i*2,this}fit(e){let i=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),s=Math.max(this.y,e.y),n=Math.min(this.y+this.height,e.y+e.height);return this.x=i,this.width=Math.max(r-i,0),this.y=s,this.height=Math.max(n-s,0),this}ceil(e=1,i=.001){let r=Math.ceil((this.x+this.width-i)*e)/e,s=Math.ceil((this.y+this.height-i)*e)/e;return this.x=Math.floor((this.x+i)*e)/e,this.y=Math.floor((this.y+i)*e)/e,this.width=r-this.x,this.height=s-this.y,this}enlarge(e){let i=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),s=Math.min(this.y,e.y),n=Math.max(this.y+this.height,e.y+e.height);return this.x=i,this.width=r-i,this.y=s,this.height=n-s,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}};var ps=class t{constructor(e=1,i=0,r=0,s=1,n=0,o=0){this.array=null,this.a=e,this.b=i,this.c=r,this.d=s,this.tx=n,this.ty=o}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,i,r,s,n,o){return this.a=e,this.b=i,this.c=r,this.d=s,this.tx=n,this.ty=o,this}toArray(e,i){this.array||(this.array=new Float32Array(9));let r=i||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(e,i){i=i||new En;let r=e.x,s=e.y;return i.x=this.a*r+this.c*s+this.tx,i.y=this.b*r+this.d*s+this.ty,i}applyInverse(e,i){i=i||new En;let r=1/(this.a*this.d+this.c*-this.b),s=e.x,n=e.y;return i.x=this.d*r*s+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,i.y=this.a*r*n+-this.b*r*s+(-this.ty*this.a+this.tx*this.b)*r,i}translate(e,i){return this.tx+=e,this.ty+=i,this}scale(e,i){return this.a*=e,this.d*=i,this.c*=e,this.b*=i,this.tx*=e,this.ty*=i,this}rotate(e){let i=Math.cos(e),r=Math.sin(e),s=this.a,n=this.c,o=this.tx;return this.a=s*i-this.b*r,this.b=s*r+this.b*i,this.c=n*i-this.d*r,this.d=n*r+this.d*i,this.tx=o*i-this.ty*r,this.ty=o*r+this.ty*i,this}append(e){let i=this.a,r=this.b,s=this.c,n=this.d;return this.a=e.a*i+e.b*s,this.b=e.a*r+e.b*n,this.c=e.c*i+e.d*s,this.d=e.c*r+e.d*n,this.tx=e.tx*i+e.ty*s+this.tx,this.ty=e.tx*r+e.ty*n+this.ty,this}setTransform(e,i,r,s,n,o,a,l,u){return this.a=Math.cos(a+u)*n,this.b=Math.sin(a+u)*n,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=e-(r*this.a+s*this.c),this.ty=i-(r*this.b+s*this.d),this}prepend(e){let i=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){let r=this.a,s=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=s*e.a+this.d*e.c,this.d=s*e.b+this.d*e.d}return this.tx=i*e.a+this.ty*e.c+e.tx,this.ty=i*e.b+this.ty*e.d+e.ty,this}decompose(e){let i=this.a,r=this.b,s=this.c,n=this.d,o=e.pivot,a=-Math.atan2(-s,n),l=Math.atan2(r,i),u=Math.abs(a+l);return u<1e-5||Math.abs(AT-u)<1e-5?(e.rotation=l,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=a,e.skew.y=l),e.scale.x=Math.sqrt(i*i+r*r),e.scale.y=Math.sqrt(s*s+n*n),e.position.x=this.tx+(o.x*i+o.y*s),e.position.y=this.ty+(o.x*r+o.y*n),e}invert(){let e=this.a,i=this.b,r=this.c,s=this.d,n=this.tx,o=e*s-i*r;return this.a=s/o,this.b=-i/o,this.c=-r/o,this.d=e/o,this.tx=(r*this.ty-s*n)/o,this.ty=-(e*this.ty-i*n)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){let e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new t}static get TEMP_MATRIX(){return new t}};var jd=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Xd=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Wd=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],qd=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],CT=[],rL=[],ay=Math.sign;function oq(){for(let t=0;t<16;t++){let e=[];CT.push(e);for(let i=0;i<16;i++){let r=ay(jd[t]*jd[i]+Wd[t]*Xd[i]),s=ay(Xd[t]*jd[i]+qd[t]*Xd[i]),n=ay(jd[t]*Wd[i]+Wd[t]*qd[i]),o=ay(Xd[t]*Wd[i]+qd[t]*qd[i]);for(let a=0;a<16;a++)if(jd[a]===r&&Xd[a]===s&&Wd[a]===n&&qd[a]===o){e.push(a);break}}}for(let t=0;t<16;t++){let e=new ps;e.set(jd[t],Xd[t],Wd[t],qd[t],0,0),rL.push(e)}}oq();var Es={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>jd[t],uY:t=>Xd[t],vX:t=>Wd[t],vY:t=>qd[t],inv:t=>t&8?t&15:-t&7,add:(t,e)=>CT[t][e],sub:(t,e)=>CT[t][Es.inv(e)],rotate180:t=>t^4,isVertical:t=>(t&3)===2,byDirection:(t,e)=>Math.abs(t)*2<=Math.abs(e)?e>=0?Es.S:Es.N:Math.abs(e)*2<=Math.abs(t)?t>0?Es.E:Es.W:e>0?t>0?Es.SE:Es.SW:t>0?Es.NE:Es.NW,matrixAppendRotationInv:(t,e,i=0,r=0)=>{let s=rL[Es.inv(e)];s.tx=i,s.ty=r,t.append(s)}};var ch=class t{constructor(e,i,r=0,s=0){this._x=r,this._y=s,this.cb=e,this.scope=i}clone(e=this.cb,i=this.scope){return new t(e,i,this._x,this._y)}set(e=0,i=e){return(this._x!==e||this._y!==i)&&(this._x=e,this._y=i,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}};var sL=class{constructor(){this.worldTransform=new ps,this.localTransform=new ps,this.position=new ch(this.onChange,this,0,0),this.scale=new ch(this.onChange,this,1,1),this.pivot=new ch(this.onChange,this,0,0),this.skew=new ch(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){let t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){let e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){let i=t.worldTransform,r=this.worldTransform;r.a=e.a*i.a+e.b*i.c,r.b=e.a*i.b+e.b*i.d,r.c=e.c*i.a+e.d*i.c,r.d=e.c*i.b+e.d*i.d,r.tx=e.tx*i.a+e.ty*i.c+i.tx,r.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}},ly=sL;ly.IDENTITY=new sL;var nL=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`;var oL=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function cy(t,e,i){let r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}function IT(t){let e=new Array(t);for(let i=0;i<e.length;i++)e[i]=!1;return e}function Nm(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return IT(2*e);case"bvec3":return IT(3*e);case"bvec4":return IT(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var Wc=[{test:t=>t.type==="float"&&t.size===1&&!t.isArray,code:t=>`
            if(uv["${t}"] !== ud["${t}"].value)
            {
                ud["${t}"].value = uv["${t}"]
                gl.uniform1f(ud["${t}"].location, uv["${t}"])
            }
            `},{test:(t,e)=>(t.type==="sampler2D"||t.type==="samplerCube"||t.type==="sampler2DArray")&&t.size===1&&!t.isArray&&(e==null||e.castToBaseTexture!==void 0),code:t=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${t}"], t);

            if(ud["${t}"].value !== t)
            {
                ud["${t}"].value = t;
                gl.uniform1i(ud["${t}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(t,e)=>t.type==="mat3"&&t.size===1&&!t.isArray&&e.a!==void 0,code:t=>`
            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));
            `,codeUbo:t=>`
                var ${t}_matrix = uv.${t}.toArray(true);

                data[offset] = ${t}_matrix[0];
                data[offset+1] = ${t}_matrix[1];
                data[offset+2] = ${t}_matrix[2];
        
                data[offset + 4] = ${t}_matrix[3];
                data[offset + 5] = ${t}_matrix[4];
                data[offset + 6] = ${t}_matrix[5];
        
                data[offset + 8] = ${t}_matrix[6];
                data[offset + 9] = ${t}_matrix[7];
                data[offset + 10] = ${t}_matrix[8];
            `},{test:(t,e)=>t.type==="vec2"&&t.size===1&&!t.isArray&&e.x!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${t}"].location, v.x, v.y);
                }`,codeUbo:t=>`
                v = uv.${t};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:t=>t.type==="vec2"&&t.size===1&&!t.isArray,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);
                }
            `},{test:(t,e)=>t.type==="vec4"&&t.size===1&&!t.isArray&&e.width!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:t=>`
                    v = uv.${t};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(t,e)=>t.type==="vec4"&&t.size===1&&!t.isArray&&e.red!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:t=>`
                    v = uv.${t};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(t,e)=>t.type==="vec3"&&t.size===1&&!t.isArray&&e.red!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)
                }`,codeUbo:t=>`
                    v = uv.${t};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:t=>t.type==="vec4"&&t.size===1&&!t.isArray,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])
                }`}];var aq={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},lq={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function kT(t,e){let i=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(let r in t.uniforms){let s=e[r];if(!s){t.uniforms[r]?.group&&(t.uniforms[r].ubo?i.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');
                    `):i.push(`
                        renderer.shader.syncUniformGroup(uv.${r}, syncData);
                    `));continue}let n=t.uniforms[r],o=!1;for(let a=0;a<Wc.length;a++)if(Wc[a].test(s,n)){i.push(Wc[a].code(r,n)),o=!0;break}if(!o){let l=(s.size===1&&!s.isArray?aq:lq)[s.type].replace("location",`ud["${r}"].location`);i.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${l};`)}}return new Function("ud","uv","renderer","syncData",i.join(`
`))}var aL={},uy=aL;function hy(){if(uy===aL||uy?.isContextLost()){let t=Mi.ADAPTER.createCanvas(),e;Mi.PREFER_ENV>=Ya.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),uy=e}return uy}var dy;function MT(){if(!dy){dy=ea.MEDIUM;let t=hy();t&&t.getShaderPrecisionFormat&&(dy=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision?ea.HIGH:ea.MEDIUM)}return dy}function lL(t,e){let i=t.getShaderSource(e).split(`
`).map((u,d)=>`${d}: ${u}`),r=t.getShaderInfoLog(e),s=r.split(`
`),n={},o=s.map(u=>parseFloat(u.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(u=>u&&!n[u]?(n[u]=!0,!0):!1),a=[""];o.forEach(u=>{i[u-1]=`%c${i[u-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});let l=i.join(`
`);a[0]=l,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function PT(t,e,i,r){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(i,t.COMPILE_STATUS)||lL(t,i),t.getShaderParameter(r,t.COMPILE_STATUS)||lL(t,r),console.error("PixiJS Error: Could not initialize shader."),t.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}var cq={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Om(t){return cq[t]}var fy=null,cL={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Bm(t,e){if(!fy){let i=Object.keys(cL);fy={};for(let r=0;r<i.length;++r){let s=i[r];fy[t[s]]=cL[s]}}return fy[e]}function py(t,e,i){if(t.substring(0,9)!=="precision"){let r=e;return e===ea.HIGH&&i!==ea.HIGH&&(r=ea.MEDIUM),`precision ${r} float;
${t}`}else if(i!==ea.HIGH&&t.substring(0,15)==="precision highp")return t.replace("precision highp","precision mediump");return t}var Um;function my(){if(typeof Um=="boolean")return Um;try{Um=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Um=!1}return Um}var uq=0,gy={},c4=class{constructor(t,e,i="pixi-shader",r={}){this.extra={},this.id=uq++,this.vertexSrc=t||c4.defaultVertexSrc,this.fragmentSrc=e||c4.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=r,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),gy[i]?(gy[i]++,i+=`-${gy[i]}`):gy[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=py(this.vertexSrc,c4.defaultVertexPrecision,ea.HIGH),this.fragmentSrc=py(this.fragmentSrc,c4.defaultFragmentPrecision,MT())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return oL}static get defaultFragmentSrc(){return nL}static from(t,e,i){let r=t+e,s=iy[r];return s||(iy[r]=s=new c4(t,e,i)),s}},Ea=c4;Ea.defaultVertexPrecision=ea.HIGH;Ea.defaultFragmentPrecision=cc.apple.device?ea.HIGH:ea.MEDIUM;var hq=0,Ka=class t{constructor(e,i,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=hq++,this.static=!!i,this.ubo=!!r,e instanceof wn?(this.buffer=e,this.buffer.type=ba.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new wn(new Float32Array(1)),this.buffer.type=ba.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,i,r){if(!this.ubo)this.uniforms[e]=new t(i,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(e,i,r){return new t(e,i,r)}static uboFrom(e,i){return new t(e,i??!0,!0)}};var Yd=class t{constructor(e,i){this.uniformBindCount=0,this.program=e,i?i instanceof Ka?this.uniformGroup=i:this.uniformGroup=new Ka(i):this.uniformGroup=new Ka({}),this.disposeRunner=new mn("disposeShader")}checkUniformExists(e,i){if(i.uniforms[e])return!0;for(let r in i.uniforms){let s=i.uniforms[r];if(s.group&&this.checkUniformExists(e,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,i,r){let s=Ea.from(e,i);return new t(s,r)}};var zm=class{constructor(e,i){if(this.vertexSrc=e,this.fragTemplate=i,this.programCache={},this.defaultGroupCache={},!i.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!i.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){let r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=n;this.defaultGroupCache[e]=Ka.from({uSamplers:r},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${e}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new Ea(this.vertexSrc,s)}let i={tint:new Float32Array([1,1,1,1]),translationMatrix:new ps,default:this.defaultGroupCache[e]};return new Yd(this.programCache[e],i)}generateSampleSrc(e){let i="";i+=`
`,i+=`
`;for(let r=0;r<e;r++)r>0&&(i+=`
else `),r<e-1&&(i+=`if(vTextureId < ${r}.5)`),i+=`
{`,i+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,i+=`
}`;return i+=`
`,i+=`
`,i}};var Gm=class{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}};function uL(){return!cc.apple.device}function hL(t){let e=!0,i=Mi.ADAPTER.getNavigator();if(cc.tablet||cc.phone){if(cc.apple.device){let r=i.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(e=!1)}if(cc.android.device){let r=i.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(e=!1)}}return e?t:4}var Zd=class{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}};var dL=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`;var fL=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;var uc=class extends Zd{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=Lm,this.vertexSize=6,this.state=Zu.for2d(),this.size=uc.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??hL(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??uL(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return br("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return fL}static get defaultFragmentTemplate(){return dL}setShaderGenerator({vertex:t=uc.defaultVertexSrc,fragment:e=uc.defaultFragmentTemplate}={}){this.shaderGenerator=new zm(t,e)}contextChange(){let t=this.renderer.gl;Mi.PREFER_ENV===Ya.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),uc.defaultMaxTextures),this.maxTextures=ny(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){let{_drawCallPool:t,_textureArrayPool:e}=uc,i=this.size/4,r=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new Fm);for(;e.length<r;)e.push(new Gm);for(let s=0;s<this.maxTextures;s++)this._tempBoundTextures[s]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){let{_bufferedTextures:t,maxTextures:e}=this,i=uc._textureArrayPool,r=this.renderer.batch,s=this._tempBoundTextures,n=this.renderer.textureGC.count,o=++_r._globalBatch,a=0,l=i[0],u=0;r.copyBoundTextures(s,e);for(let d=0;d<this._bufferSize;++d){let m=t[d];t[d]=null,m._batchEnabled!==o&&(l.count>=e&&(r.boundArray(l,s,o,e),this.buildDrawCalls(l,u,d),u=d,l=i[++a],++o),m._batchEnabled=o,m.touched=n,l.elements[l.count++]=m)}l.count>0&&(r.boundArray(l,s,o,e),this.buildDrawCalls(l,u,this._bufferSize),++a,++o);for(let d=0;d<s.length;d++)s[d]=null;_r._globalBatch=o}buildDrawCalls(t,e,i){let{_bufferedElements:r,_attributeBuffer:s,_indexBuffer:n,vertexSize:o}=this,a=uc._drawCallPool,l=this._dcIndex,u=this._aIndex,d=this._iIndex,m=a[l];m.start=this._iIndex,m.texArray=t;for(let g=e;g<i;++g){let _=r[g],v=_._texture.baseTexture,E=mT[v.alphaMode?1:0][_.blendMode];r[g]=null,e<g&&m.blend!==E&&(m.size=d-m.start,e=g,m=a[++l],m.texArray=t,m.start=d),this.packInterleavedGeometry(_,s,n,u,d),u+=_.vertexData.length/2*o,d+=_.indices.length,m.blend=E}e<i&&(m.size=d-m.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=d}bindAndClearTexArray(t){let e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){let{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:i}=this;uc.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){let t=this._dcIndex,{gl:e,state:i}=this.renderer,r=uc._drawCallPool,s=null;for(let n=0;n<t;n++){let{texArray:o,type:a,size:l,start:u,blend:d}=r[n];s!==o&&(s=o,this.bindAndClearTexArray(o)),this.state.blendMode=d,i.set(this.state),e.drawElements(a,l,e.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),uc.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){let e=Hd(Math.ceil(t/8)),i=ty(e),r=e*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._aBuffers[r];return s||(this._aBuffers[r]=s=new Dm(r*this.vertexSize*4)),s}getIndexBuffer(t){let e=Hd(Math.ceil(t/12)),i=ty(e),r=e*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._iBuffers[i];return s||(this._iBuffers[i]=s=new Uint16Array(r)),s}packInterleavedGeometry(t,e,i,r,s){let{uint32View:n,float32View:o}=e,a=r/this.vertexSize,l=t.uvs,u=t.indices,d=t.vertexData,m=t._texture.baseTexture._batchLocation,g=Math.min(t.worldAlpha,1),_=wa.shared.setValue(t._tintRGB).toPremultiplied(g);for(let v=0;v<d.length;v+=2)o[r++]=d[v],o[r++]=d[v+1],o[r++]=l[v],o[r++]=l[v+1],n[r++]=_,o[r++]=m;for(let v=0;v<u.length;v++)i[s++]=a+u[v]}},Ja=uc;Ja.defaultBatchSize=4096;Ja.extension={name:"batch",type:bi.RendererPlugin};Ja._drawCallPool=[];Ja._textureArrayPool=[];Di.add(Ja);var pL=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`;var mL=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var $m=class extends Yd{constructor(t,e,i){let r=Ea.from(t||$m.defaultVertexSrc,e||$m.defaultFragmentSrc);super(r,i),this.padding=0,this.resolution=$m.defaultResolution,this.multisample=$m.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Zu}apply(t,e,i,r,s){t.applyFilter(this,e,i,r)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return mL}static get defaultFragmentSrc(){return pL}},el=$m;el.defaultResolution=1;el.defaultMultisample=Wr.NONE;var Ku=class{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new wa(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;let{backgroundColor:i,background:r,backgroundAlpha:s}=e,n=r??i;n!==void 0&&(this.color=n),this.alpha=s}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}};Ku.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};Ku.extension={type:[bi.RendererSystem,bi.CanvasRendererSystem],name:"background"};Di.add(Ku);var u4=class{constructor(e){this.renderer=e,this.emptyRenderer=new Zd(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,i){let{boundTextures:r}=this.renderer.texture;for(let s=i-1;s>=0;--s)e[s]=r[s]||null,e[s]&&(e[s]._batchLocation=s)}boundArray(e,i,r,s){let{elements:n,ids:o,count:a}=e,l=0;for(let u=0;u<a;u++){let d=n[u],m=d._batchLocation;if(m>=0&&m<s&&i[m]===d){o[u]=m;continue}for(;l<s;){let g=i[l];if(g&&g._batchEnabled===r&&g._batchLocation===l){l++;continue}o[u]=l,d._batchLocation=l,i[l]=d;break}}}destroy(){this.renderer=null}};u4.extension={type:bi.RendererSystem,name:"batch"};Di.add(u4);var gL=0,Ju=class{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=gL++}init(e){if(e.context)this.initFromContext(e.context);else{let i=this.renderer.background.alpha<1,r=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:i,premultipliedAlpha:r,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=gL++,this.renderer.runners.contextChange.emit(e);let i=this.renderer.view;i.addEventListener!==void 0&&(i.addEventListener("webglcontextlost",this.handleContextLost,!1),i.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){let i=this.createContext(this.renderer.view,e);this.initFromContext(i)}createContext(e,i){let r;if(Mi.PREFER_ENV>=Ya.WEBGL2&&(r=e.getContext("webgl2",i)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=e.getContext("webgl",i)||e.getContext("experimental-webgl",i),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){let{gl:e}=this,i={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,i,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,i,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){let e=this.renderer.view;this.renderer=null,e.removeEventListener!==void 0&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){let i=e.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),i&&!i.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");let s=r||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}};Ju.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"};Ju.extension={type:bi.RendererSystem,name:"context"};Di.add(Ju);var yy=class extends Xc{upload(e,i,r){let s=e.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===va.UNPACK);let n=i.realWidth,o=i.realHeight;return r.width===n&&r.height===o?s.texSubImage2D(i.target,0,0,0,n,o,i.format,r.type,this.data):(r.width=n,r.height=o,s.texImage2D(i.target,0,r.internalFormat,n,o,0,i.format,r.type,this.data)),!0}};var uh=class{constructor(e,i){this.width=Math.round(e||100),this.height=Math.round(i||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new mn("disposeFramebuffer"),this.multisample=Wr.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,i){return this.colorTextures[e]=i||new _r(null,{scaleMode:Ml.NEAREST,resolution:1,mipmap:lc.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new _r(new yy(null,{width:this.width,height:this.height}),{scaleMode:Ml.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:lc.OFF,format:ri.DEPTH_COMPONENT,type:mr.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,i){if(e=Math.round(e),i=Math.round(i),!(e===this.width&&i===this.height)){this.width=e,this.height=i,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){let s=this.colorTextures[r],n=s.resolution;s.setSize(e/n,i/n)}if(this.depthTexture){let r=this.depthTexture.resolution;this.depthTexture.setSize(e/r,i/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}};var Qd=class extends _r{constructor(e={}){if(typeof e=="number"){let i=arguments[0],r=arguments[1],s=arguments[2],n=arguments[3];e={width:i,height:r,scaleMode:s,resolution:n}}e.width=e.width||100,e.height=e.height||100,e.multisample??(e.multisample=Wr.NONE),super(null,e),this.mipmap=lc.OFF,this.valid=!0,this._clear=new wa([0,0,0,0]),this.framebuffer=new uh(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(e,i){this.framebuffer.resize(e*this.resolution,i*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}};var io=class extends Qa{constructor(e){let i=e,r=i.naturalWidth||i.videoWidth||i.width,s=i.naturalHeight||i.videoHeight||i.height;super(r,s),this.source=e,this.noSubImage=!1}static crossOrigin(e,i,r){r===void 0&&!i.startsWith("data:")?e.crossOrigin=_T(i):r!==!1&&(e.crossOrigin=typeof r=="string"?r:"anonymous")}upload(e,i,r,s){let n=e.gl,o=i.realWidth,a=i.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1&&s.buffered.length===0)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===va.UNPACK),!this.noSubImage&&i.target===n.TEXTURE_2D&&r.width===o&&r.height===a?n.texSubImage2D(n.TEXTURE_2D,0,0,0,i.format,r.type,s):(r.width=o,r.height=a,n.texImage2D(i.target,0,r.internalFormat,i.format,r.type,s)),!0}update(){if(this.destroyed)return;let e=this.source,i=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;this.resize(i,r),super.update()}dispose(){this.source=null}};var hh=class extends io{constructor(e,i){if(i=i||{},typeof e=="string"){let r=new Image;io.crossOrigin(r,e,i.crossorigin),r.src=e,e=r}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(i.createBitmap??Mi.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,this.bitmap=null,this._load=null,i.autoLoad!==!1&&this.load()}load(e){return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise((i,r)=>{let s=this.source;this.url=s.src;let n=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.resize(s.width,s.height),this._load=null,this.createBitmap?i(this.process()):i(this))};s.complete&&s.src?n():(s.onload=n,s.onerror=o=>{r(o),this.onError.emit(o)})}),this._load)}process(){let e=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);let i=globalThis.createImageBitmap,r=!e.crossOrigin||e.crossOrigin==="anonymous";return this._process=fetch(e.src,{mode:r?"cors":"no-cors"}).then(s=>s.blob()).then(s=>i(s,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===va.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,i,r){if(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,i,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,i,r,this.bitmap),!this.preserveBitmap){let s=!0,n=i._glTextures;for(let o in n){let a=n[o];if(a!==r&&a.dirtyId!==i.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&(typeof e=="string"||e instanceof HTMLImageElement)}};var h4=class{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,i,r){let s=i.width,n=i.height;if(r){let o=e.width/2/s,a=e.height/2/n,l=e.x/s+o,u=e.y/n+a;r=Es.add(r,Es.NW),this.x0=l+o*Es.uX(r),this.y0=u+a*Es.uY(r),r=Es.add(r,2),this.x1=l+o*Es.uX(r),this.y1=u+a*Es.uY(r),r=Es.add(r,2),this.x2=l+o*Es.uX(r),this.y2=u+a*Es.uY(r),r=Es.add(r,2),this.x3=l+o*Es.uX(r),this.y3=u+a*Es.uY(r)}else this.x0=e.x/s,this.y0=e.y/n,this.x1=(e.x+e.width)/s,this.y1=e.y/n,this.x2=(e.x+e.width)/s,this.y2=(e.y+e.height)/n,this.x3=e.x/s,this.y3=(e.y+e.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}};var yL=new h4;function _y(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}var Hm=class t extends Vd.default{constructor(e,i,r,s,n,o,a){if(super(),this.noFrame=!1,i||(this.noFrame=!0,i=new qr(0,0,1,1)),e instanceof t&&(e=e.baseTexture),this.baseTexture=e,this._frame=i,this.trim=s,this.valid=!1,this._uvs=yL,this.uvMatrix=null,this.orig=r||i,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new En(o.x,o.y):new En(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=i:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){let{resource:i}=this.baseTexture;i?.url&&Za[i.url]&&t.removeFromCache(i.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,t.removeFromCache(this),this.textureCacheIds=null}clone(){let e=this._frame.clone(),i=this._frame===this.orig?e:this.orig.clone(),r=new t(this.baseTexture,!this.noFrame&&e,i,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=e),r}updateUvs(){this._uvs===yL&&(this._uvs=new h4),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,i={},r=Mi.STRICT_TEXTURE_CACHE){let s=typeof e=="string",n=null;if(s)n=e;else if(e instanceof _r){if(!e.cacheId){let a=i?.pixiIdPrefix||"pixiid";e.cacheId=`${a}-${Yu()}`,_r.addToCache(e,e.cacheId)}n=e.cacheId}else{if(!e._pixiId){let a=i?.pixiIdPrefix||"pixiid";e._pixiId=`${a}_${Yu()}`}n=e._pixiId}let o=Za[n];if(s&&r&&!o)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!o&&!(e instanceof _r)?(i.resolution||(i.resolution=sy(e)),o=new t(new _r(e,i)),o.baseTexture.cacheId=n,_r.addToCache(o.baseTexture,n),t.addToCache(o,n)):!o&&e instanceof _r&&(o=new t(e),t.addToCache(o,n)),o}static fromURL(e,i){let r=Object.assign({autoLoad:!1},i?.resourceOptions),s=t.from(e,Object.assign({resourceOptions:r},i),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then(()=>Promise.resolve(s))}static fromBuffer(e,i,r,s){return new t(_r.fromBuffer(e,i,r,s))}static fromLoader(e,i,r,s){let n=new _r(e,Object.assign({scaleMode:_r.defaultOptions.scaleMode,resolution:sy(i)},s)),{resource:o}=n;o instanceof hh&&(o.url=i);let a=new t(n);return r||(r=i),_r.addToCache(a.baseTexture,r),t.addToCache(a,r),r!==i&&(_r.addToCache(a.baseTexture,i),t.addToCache(a,i)),a.baseTexture.valid?Promise.resolve(a):new Promise(l=>{a.baseTexture.once("loaded",()=>l(a))})}static addToCache(e,i){i&&(e.textureCacheIds.includes(i)||e.textureCacheIds.push(i),Za[i]&&Za[i]!==e&&console.warn(`Texture added to the cache with an id [${i}] that already had an entry`),Za[i]=e)}static removeFromCache(e){if(typeof e=="string"){let i=Za[e];if(i){let r=i.textureCacheIds.indexOf(e);return r>-1&&i.textureCacheIds.splice(r,1),delete Za[e],i}}else if(e?.textureCacheIds){for(let i=0;i<e.textureCacheIds.length;++i)Za[e.textureCacheIds[i]]===e&&delete Za[e.textureCacheIds[i]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;let{x:i,y:r,width:s,height:n}=e,o=i+s>this.baseTexture.width,a=r+n>this.baseTexture.height;if(o||a){let l=o&&a?"and":"or",u=`X: ${i} + ${s} = ${i+s} > ${this.baseTexture.width}`,d=`Y: ${r} + ${n} = ${r+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${u} ${l} ${d}`)}this.valid=s&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return t._EMPTY||(t._EMPTY=new t(new _r),_y(t._EMPTY),_y(t._EMPTY.baseTexture)),t._EMPTY}static get WHITE(){if(!t._WHITE){let e=Mi.ADAPTER.createCanvas(16,16),i=e.getContext("2d");e.width=16,e.height=16,i.fillStyle="white",i.fillRect(0,0,16,16),t._WHITE=new t(_r.from(e)),_y(t._WHITE),_y(t._WHITE.baseTexture)}return t._WHITE}};var Kd=class t extends Hm{constructor(e,i){super(e,i),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,i,r=!0){let s=this.baseTexture.resolution,n=Math.round(e*s)/s,o=Math.round(i*s)/s;this.valid=n>0&&o>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=o,r&&this.baseTexture.resize(n,o),this.updateUvs()}setResolution(e){let{baseTexture:i}=this;i.resolution!==e&&(i.setResolution(e),this.resize(i.width,i.height,!1))}static create(e){return new t(new Qd(e))}};var d4=class{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,i,r=Wr.NONE){let s=new Qd(Object.assign({width:e,height:i,resolution:1,multisample:r},this.textureOptions));return new Kd(s)}getOptimalTexture(e,i,r=1,s=Wr.NONE){let n;e=Math.ceil(e*r-1e-6),i=Math.ceil(i*r-1e-6),!this.enableFullScreen||e!==this._pixelsWidth||i!==this._pixelsHeight?(e=Hd(e),i=Hd(i),n=((e&65535)<<16|i&65535)>>>0,s>1&&(n+=s*4294967296)):n=s>1?-s:-1,this.texturePool[n]||(this.texturePool[n]=[]);let o=this.texturePool[n].pop();return o||(o=this.createTexture(e,i,s)),o.filterPoolKey=n,o.setResolution(r),o}getFilterTexture(e,i,r){let s=this.getOptimalTexture(e.width,e.height,i||e.resolution,r||Wr.NONE);return s.filterFrame=e.filterFrame,s}returnTexture(e){let i=e.filterPoolKey;e.filterFrame=null,this.texturePool[i].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=e!==!1,e)for(let i in this.texturePool){let r=this.texturePool[i];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0)}this.texturePool={}}setScreenSize(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(let i in this.texturePool){if(!(Number(i)<0))continue;let r=this.texturePool[i];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0);this.texturePool[i]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}};d4.SCREEN_KEY=-1;var Vm=class extends Qu{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}};var jm=class extends Qu{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new wn(this.vertices),this.uvBuffer=new wn(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,i){let r=0,s=0;return this.uvs[0]=r,this.uvs[1]=s,this.uvs[2]=r+i.width/e.width,this.uvs[3]=s,this.uvs[4]=r+i.width/e.width,this.uvs[5]=s+i.height/e.height,this.uvs[6]=r,this.uvs[7]=s+i.height/e.height,r=i.x,s=i.y,this.vertices[0]=r,this.vertices[1]=s,this.vertices[2]=r+i.width,this.vertices[3]=s,this.vertices[4]=r+i.width,this.vertices[5]=s+i.height,this.vertices[6]=r,this.vertices[7]=s+i.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}};var Xm=class{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Wr.NONE,this.sourceFrame=new qr,this.destinationFrame=new qr,this.bindingSourceFrame=new qr,this.bindingDestinationFrame=new qr,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}};var xy=[new En,new En,new En,new En],RT=new ps,f4=class{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new d4,this.statePool=[],this.quad=new Vm,this.quadUv=new jm,this.tempRect=new qr,this.activeState={},this.globalUniforms=new Ka({outputFrame:new qr,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,i){let r=this.renderer,s=this.defaultFilterStack,n=this.statePool.pop()||new Xm,o=this.renderer.renderTexture,a=i[0].resolution,l=i[0].multisample,u=i[0].padding,d=i[0].autoFit,m=i[0].legacy??!0;for(let v=1;v<i.length;v++){let E=i[v];a=Math.min(a,E.resolution),l=Math.min(l,E.multisample),u=this.useMaxPadding?Math.max(u,E.padding):u+E.padding,d=d&&E.autoFit,m=m||(E.legacy??!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),s.push(n),n.resolution=a,n.multisample=l,n.legacy=m,n.target=e,n.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),n.sourceFrame.pad(u);let g=this.tempRect.copyFrom(o.sourceFrame);r.projection.transform&&this.transformAABB(RT.copyFrom(r.projection.transform).invert(),g),d?(n.sourceFrame.fit(g),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(g)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,o.current?o.current.resolution:r.resolution,o.sourceFrame,o.destinationFrame,r.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,a,l),n.filters=i,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;let _=this.tempRect;_.x=0,_.y=0,_.width=n.sourceFrame.width,_.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(o.sourceFrame),n.bindingDestinationFrame.copyFrom(o.destinationFrame),n.transform=r.projection.transform,r.projection.transform=null,o.bind(n.renderTexture,n.sourceFrame,_),r.framebuffer.clear(0,0,0,0)}pop(){let e=this.defaultFilterStack,i=e.pop(),r=i.filters;this.activeState=i;let s=this.globalUniforms.uniforms;s.outputFrame=i.sourceFrame,s.resolution=i.resolution;let n=s.inputSize,o=s.inputPixel,a=s.inputClamp;if(n[0]=i.destinationFrame.width,n[1]=i.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=Math.round(n[0]*i.resolution),o[1]=Math.round(n[1]*i.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=i.sourceFrame.width*n[2]-.5*o[2],a[3]=i.sourceFrame.height*n[3]-.5*o[3],i.legacy){let u=s.filterArea;u[0]=i.destinationFrame.width,u[1]=i.destinationFrame.height,u[2]=i.sourceFrame.x,u[3]=i.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();let l=e[e.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,i.renderTexture,l.renderTexture,ah.BLEND,i),this.returnFilterTexture(i.renderTexture);else{let u=i.renderTexture,d=this.getOptimalFilterTexture(u.width,u.height,i.resolution);d.filterFrame=u.filterFrame;let m=0;for(m=0;m<r.length-1;++m){m===1&&i.multisample>1&&(d=this.getOptimalFilterTexture(u.width,u.height,i.resolution),d.filterFrame=u.filterFrame),r[m].apply(this,u,d,ah.CLEAR,i);let g=u;u=d,d=g}r[m].apply(this,u,l.renderTexture,ah.BLEND,i),m>1&&i.multisample>1&&this.returnFilterTexture(i.renderTexture),this.returnFilterTexture(u),this.returnFilterTexture(d)}i.clear(),this.statePool.push(i)}bindAndClear(e,i=ah.CLEAR){let{renderTexture:r,state:s}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e?.filterFrame){let o=this.tempRect;o.x=0,o.y=0,o.width=e.filterFrame.width,o.height=e.filterFrame.height,r.bind(e,e.filterFrame,o)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);let n=s.stateId&1||this.forceClear;(i===ah.CLEAR||i===ah.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,i,r,s){let n=this.renderer;n.state.set(e.state),this.bindAndClear(r,s),e.uniforms.uSampler=i,e.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(i._frame,i.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(t4.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(t4.TRIANGLE_STRIP))}calculateSpriteMatrix(e,i){let{sourceFrame:r,destinationFrame:s}=this.activeState,{orig:n}=i._texture,o=e.set(s.width,0,0,s.height,r.x,r.y),a=i.worldTransform.copyTo(ps.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/n.width,1/n.height),o.translate(i.anchor.x,i.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,i,r=1,s=Wr.NONE){return this.texturePool.getOptimalTexture(e,i,r,s)}getFilterTexture(e,i,r){if(typeof e=="number"){let n=e;e=i,i=n}e=e||this.activeState.renderTexture;let s=this.texturePool.getOptimalTexture(e.width,e.height,i||e.resolution,r||Wr.NONE);return s.filterFrame=e.filterFrame,s}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,i){let r=xy[0],s=xy[1],n=xy[2],o=xy[3];r.set(i.left,i.top),s.set(i.left,i.bottom),n.set(i.right,i.top),o.set(i.right,i.bottom),e.apply(r,r),e.apply(s,s),e.apply(n,n),e.apply(o,o);let a=Math.min(r.x,s.x,n.x,o.x),l=Math.min(r.y,s.y,n.y,o.y),u=Math.max(r.x,s.x,n.x,o.x),d=Math.max(r.y,s.y,n.y,o.y);i.x=a,i.y=l,i.width=u-a,i.height=d-l}roundFrame(e,i,r,s,n){if(!(e.width<=0||e.height<=0||r.width<=0||r.height<=0)){if(n){let{a:o,b:a,c:l,d:u}=n;if((Math.abs(a)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(u)>1e-4))return}n=n?RT.copyFrom(n):RT.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.transformAABB(n,e),e.ceil(i),this.transformAABB(n.invert(),e)}}};f4.extension={type:bi.RendererSystem,name:"filter"};Di.add(f4);var Wm=class{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Wr.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}};var dq=new qr,p4=class{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new uh(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);let e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new qr,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let i=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;Mi.PREFER_ENV===Ya.WEBGL_LEGACY&&(i=null,r=null),i?e.drawBuffers=s=>i.drawBuffersWEBGL(s):(this.hasMRT=!1,e.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,i,r=0){let{gl:s}=this;if(e){let n=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(e.dirtyId++,e.dirtyFormat++,n.mipLevel=r),n.dirtyId!==e.dirtyId&&(n.dirtyId=e.dirtyId,n.dirtyFormat!==e.dirtyFormat?(n.dirtyFormat=e.dirtyFormat,n.dirtySize=e.dirtySize,this.updateFramebuffer(e,r)):n.dirtySize!==e.dirtySize&&(n.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let o=0;o<e.colorTextures.length;o++){let a=e.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),i){let o=i.width>>r,a=i.height>>r,l=o/i.width;this.setViewport(i.x*l,i.y*l,o,a)}else{let o=e.width>>r,a=e.height>>r;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),i?this.setViewport(i.x,i.y,i.width,i.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,i,r,s){let n=this.viewport;e=Math.round(e),i=Math.round(i),r=Math.round(r),s=Math.round(s),(n.width!==r||n.height!==s||n.x!==e||n.y!==i)&&(n.x=e,n.y=i,n.width=r,n.height=s,this.gl.viewport(e,i,r,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,i,r,s,n=Qg.COLOR|Qg.DEPTH){let{gl:o}=this;o.clearColor(e,i,r,s),o.clear(n)}initFramebuffer(e){let{gl:i}=this,r=new Wm(i.createFramebuffer());return r.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(e),e.disposeRunner.add(this),r}resizeFramebuffer(e){let{gl:i}=this,r=e.glFramebuffers[this.CONTEXT_UID];r.stencil&&(i.bindRenderbuffer(i.RENDERBUFFER,r.stencil),r.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.DEPTH24_STENCIL8,e.width,e.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e.width,e.height));let s=e.colorTextures,n=s.length;i.drawBuffers||(n=Math.min(n,1));for(let o=0;o<n;o++){let a=s[o],l=a.parentTextureArray||a;this.renderer.texture.bind(l,0),o===0&&r.msaaBuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,r.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,i){let{gl:r}=this,s=e.glFramebuffers[this.CONTEXT_UID],n=e.colorTextures,o=n.length;r.drawBuffers||(o=Math.min(o,1)),s.multisample>1&&this.canMultisampleFramebuffer(e)?s.msaaBuffer=s.msaaBuffer||r.createRenderbuffer():s.msaaBuffer&&(r.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));let a=[];for(let l=0;l<o;l++){let u=n[l],d=u.parentTextureArray||u;this.renderer.texture.bind(d,0),l===0&&s.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,s.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,d._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,s.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+l,u.target,d._glTextures[this.CONTEXT_UID].texture,i),a.push(r.COLOR_ATTACHMENT0+l))}if(a.length>1&&r.drawBuffers(a),e.depthTexture&&this.writeDepthTexture){let u=e.depthTexture;this.renderer.texture.bind(u,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,u._glTextures[this.CONTEXT_UID].texture,i)}(e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)?(s.stencil=s.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,s.stencil),s.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,r.DEPTH24_STENCIL8,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,s.stencil)):s.stencil&&(r.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){let{msaaSamples:i}=this,r=Wr.NONE;if(e<=1||i===null)return r;for(let s=0;s<i.length;s++)if(i[s]<=e){r=i[s];break}return r===1&&(r=Wr.NONE),r}blit(e,i,r){let{current:s,renderer:n,gl:o,CONTEXT_UID:a}=this;if(n.context.webGLVersion!==2||!s)return;let l=s.glFramebuffers[a];if(!l)return;if(!e){if(!l.msaaBuffer)return;let d=s.colorTextures[0];if(!d)return;l.blitFramebuffer||(l.blitFramebuffer=new uh(s.width,s.height),l.blitFramebuffer.addColorTexture(0,d)),e=l.blitFramebuffer,e.colorTextures[0]!==d&&(e.colorTextures[0]=d,e.dirtyId++,e.dirtyFormat++),(e.width!==s.width||e.height!==s.height)&&(e.width=s.width,e.height=s.height,e.dirtyId++,e.dirtySize++)}i||(i=dq,i.width=s.width,i.height=s.height),r||(r=i);let u=i.width===r.width&&i.height===r.height;this.bind(e),o.bindFramebuffer(o.READ_FRAMEBUFFER,l.framebuffer),o.blitFramebuffer(i.left,i.top,i.right,i.bottom,r.left,r.top,r.right,r.bottom,o.COLOR_BUFFER_BIT,u?o.NEAREST:o.LINEAR)}disposeFramebuffer(e,i){let r=e.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!r)return;delete e.glFramebuffers[this.CONTEXT_UID];let n=this.managedFramebuffers.indexOf(e);n>=0&&this.managedFramebuffers.splice(n,1),e.disposeRunner.remove(this),i||(s.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&s.deleteRenderbuffer(r.msaaBuffer),r.stencil&&s.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,i)}disposeAll(e){let i=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<i.length;r++)this.disposeFramebuffer(i[r],e)}forceStencil(){let e=this.current;if(!e)return;let i=e.glFramebuffers[this.CONTEXT_UID];if(!i||i.stencil)return;e.stencil=!0;let r=e.width,s=e.height,n=this.gl,o=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o),i.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,i.multisample,n.DEPTH24_STENCIL8,r,s):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,r,s),i.stencil=o,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new qr}destroy(){this.renderer=null}};p4.extension={type:bi.RendererSystem,name:"framebuffer"};Di.add(p4);var DT={5126:4,5123:2,5121:1},m4=class{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);let e=this.gl=this.renderer.gl,i=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,i.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;Mi.PREFER_ENV===Ya.WEBGL_LEGACY&&(r=null),r?(e.createVertexArray=()=>r.createVertexArrayOES(),e.bindVertexArray=s=>r.bindVertexArrayOES(s),e.deleteVertexArray=s=>r.deleteVertexArrayOES(s)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(i.webGLVersion!==2){let r=e.getExtension("ANGLE_instanced_arrays");r?(e.vertexAttribDivisor=(s,n)=>r.vertexAttribDivisorANGLE(s,n),e.drawElementsInstanced=(s,n,o,a,l)=>r.drawElementsInstancedANGLE(s,n,o,a,l),e.drawArraysInstanced=(s,n,o,a)=>r.drawArraysInstancedANGLE(s,n,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=i.webGLVersion===2||!!i.extensions.uint32ElementIndex}bind(e,i){i=i||this.renderer.shader.shader;let{gl:r}=this,s=e.glVertexArrayObjects[this.CONTEXT_UID],n=!1;s||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=s={},n=!0);let o=s[i.program.id]||this.initGeometryVao(e,i,n);this._activeGeometry=e,this._activeVao!==o&&(this._activeVao=o,this.hasVao?r.bindVertexArray(o):this.activateVao(e,i.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){let e=this._activeGeometry,i=this.renderer.buffer;for(let r=0;r<e.buffers.length;r++){let s=e.buffers[r];i.update(s)}}checkCompatibility(e,i){let r=e.attributes,s=i.attributeData;for(let n in s)if(!r[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(e,i){let r=e.attributes,s=i.attributeData,n=["g",e.id];for(let o in r)s[o]&&n.push(o,s[o].location);return n.join("-")}initGeometryVao(e,i,r=!0){let s=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,a=i.program;a.glPrograms[n]||this.renderer.shader.generateProgram(i),this.checkCompatibility(e,a);let l=this.getSignature(e,a),u=e.glVertexArrayObjects[this.CONTEXT_UID],d=u[l];if(d)return u[a.id]=d,d;let m=e.buffers,g=e.attributes,_={},v={};for(let E in m)_[E]=0,v[E]=0;for(let E in g)!g[E].size&&a.attributeData[E]?g[E].size=a.attributeData[E].size:g[E].size||console.warn(`PIXI Geometry attribute '${E}' size cannot be determined (likely the bound shader does not have the attribute)`),_[g[E].buffer]+=g[E].size*DT[g[E].type];for(let E in g){let b=g[E],T=b.size;b.stride===void 0&&(_[b.buffer]===T*DT[b.type]?b.stride=0:b.stride=_[b.buffer]),b.start===void 0&&(b.start=v[b.buffer],v[b.buffer]+=T*DT[b.type])}d=s.createVertexArray(),s.bindVertexArray(d);for(let E=0;E<m.length;E++){let b=m[E];o.bind(b),r&&b._glBuffers[n].refCount++}return this.activateVao(e,a),u[a.id]=d,u[l]=d,s.bindVertexArray(null),o.unbind(ba.ARRAY_BUFFER),d}disposeGeometry(e,i){if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];let r=e.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,n=e.buffers,o=this.renderer?.buffer;if(e.disposeRunner.remove(this),!!r){if(o)for(let a=0;a<n.length;a++){let l=n[a]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!i&&o.dispose(n[a],i))}if(!i){for(let a in r)if(a[0]==="g"){let l=r[a];this._activeVao===l&&this.unbind(),s.deleteVertexArray(l)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){let i=Object.keys(this.managedGeometries);for(let r=0;r<i.length;r++)this.disposeGeometry(this.managedGeometries[i[r]],e)}activateVao(e,i){let r=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,o=e.buffers,a=e.attributes;e.indexBuffer&&n.bind(e.indexBuffer);let l=null;for(let u in a){let d=a[u],m=o[d.buffer],g=m._glBuffers[s];if(i.attributeData[u]){l!==g&&(n.bind(m),l=g);let _=i.attributeData[u].location;if(r.enableVertexAttribArray(_),r.vertexAttribPointer(_,d.size,d.type||r.FLOAT,d.normalized,d.stride,d.start),d.instance)if(this.hasInstance)r.vertexAttribDivisor(_,d.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,i,r,s){let{gl:n}=this,o=this._activeGeometry;if(o.indexBuffer){let a=o.indexBuffer.data.BYTES_PER_ELEMENT,l=a===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(e,i||o.indexBuffer.data.length,l,(r||0)*a,s||1):n.drawElements(e,i||o.indexBuffer.data.length,l,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(e,r,i||o.getSize(),s||1):n.drawArrays(e,r,i||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}};m4.extension={type:bi.RendererSystem,name:"geometry"};Di.add(m4);var _L=new ps,qm=class{constructor(e,i){this._texture=e,this.mapCoord=new ps,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof i>"u"?.5:i,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,i){i===void 0&&(i=e);let r=this.mapCoord;for(let s=0;s<e.length;s+=2){let n=e[s],o=e[s+1];i[s]=n*r.a+o*r.c+r.tx,i[s+1]=n*r.b+o*r.d+r.ty}return i}update(e){let i=this._texture;if(!i||!i.valid||!e&&this._textureID===i._updateID)return!1;this._textureID=i._updateID,this._updateID++;let r=i._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);let s=i.orig,n=i.trim;n&&(_L.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(_L));let o=i.baseTexture,a=this.uClampFrame,l=this.clampMargin/o.resolution,u=this.clampOffset;return a[0]=(i._frame.x+l+u)/o.width,a[1]=(i._frame.y+l+u)/o.height,a[2]=(i._frame.x+i._frame.width-l+u)/o.width,a[3]=(i._frame.y+i._frame.height-l+u)/o.height,this.uClampOffset[0]=u/o.realWidth,this.uClampOffset[1]=u/o.realHeight,this.isSimple=i._frame.width===o.width&&i._frame.height===o.height&&i.rotate===0,!0}};var xL=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`;var vL=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;var Ym=class extends el{constructor(e,i,r){let s=null;typeof e!="string"&&i===void 0&&r===void 0&&(s=e,e=void 0,i=void 0,r=void 0),super(e||vL,i||xL,r),this.maskSprite=s,this.maskMatrix=new ps}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,i,r,s){let n=this._maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new qm(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,e.applyFilter(this,i,r,s))}};var Zm=class{constructor(e=null){this.type=bn.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=el.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=bn.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}};var g4=class{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,i){let r=i;if(!r.isMaskData){let n=this.maskDataPool.pop()||new Zm;n.pooled=!0,n.maskObject=i,r=n}let s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(s),r._colorMask=s?s._colorMask:15,r.autoDetect&&this.detect(r),r._target=e,r.type!==bn.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case bn.SCISSOR:this.renderer.scissor.push(r);break;case bn.STENCIL:this.renderer.stencil.push(r);break;case bn.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case bn.COLOR:this.pushColorMask(r);break;default:break}r.type===bn.SPRITE&&this.maskStack.push(r)}pop(e){let i=this.maskStack.pop();if(!(!i||i._target!==e)){if(i.enabled)switch(i.type){case bn.SCISSOR:this.renderer.scissor.pop(i);break;case bn.STENCIL:this.renderer.stencil.pop(i.maskObject);break;case bn.SPRITE:this.popSpriteMask(i);break;case bn.COLOR:this.popColorMask(i);break;default:break}if(i.reset(),i.pooled&&this.maskDataPool.push(i),this.maskStack.length!==0){let r=this.maskStack[this.maskStack.length-1];r.type===bn.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(e){let i=e.maskObject;i?i.isSprite?e.type=bn.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=bn.SCISSOR:e.type=bn.STENCIL:e.type=bn.COLOR}pushSpriteMask(e){let{maskObject:i}=e,r=e._target,s=e._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new Ym]));let n=this.renderer,o=n.renderTexture,a,l;if(o.current){let d=o.current;a=e.resolution||d.resolution,l=e.multisample??d.multisample}else a=e.resolution||n.resolution,l=e.multisample??n.multisample;s[0].resolution=a,s[0].multisample=l,s[0].maskSprite=i;let u=r.filterArea;r.filterArea=i.getBounds(!0),n.filter.push(r,s),r.filterArea=u,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){let i=e._colorMask,r=e._colorMask=i&e.colorMask;r!==i&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(e){let i=e._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==i&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}};g4.extension={type:bi.RendererSystem,name:"mask"};Di.add(g4);var y4=class{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){let{gl:i}=this.renderer,r=this.getStackLength();this.maskStack=e;let s=this.getStackLength();s!==r&&(s===0?i.disable(this.glConst):(i.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}};var bL=new ps,wL=[],vy=class extends y4{constructor(t){super(t),this.glConst=Mi.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){let t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;let e=t._scissorRect,{maskObject:i}=t,{renderer:r}=this,s=r.renderTexture,n=i.getBounds(!0,wL.pop()??new qr);this.roundFrameToPixels(n,s.current?s.current.resolution:r.resolution,s.sourceFrame,s.destinationFrame,r.projection.transform),e&&n.fit(e),t._scissorRectLocal=n}static isMatrixRotated(t){if(!t)return!1;let{a:e,b:i,c:r,d:s}=t;return(Math.abs(i)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(s)>1e-4)}testScissor(t){let{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||vy.isMatrixRotated(e.worldTransform)||vy.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);let i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,e,i,r,s){vy.isMatrixRotated(s)||(s=s?bL.copyFrom(s):bL.identity(),s.translate(-i.x,-i.y).scale(r.width/i.width,r.height/i.height).translate(r.x,r.y),this.renderer.filter.transformAABB(s,t),t.fit(r),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);let{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){let{gl:e}=this.renderer;t&&wL.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){let t=this.maskStack[this.maskStack.length-1]._scissorRect,e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}},by=vy;by.extension={type:bi.RendererSystem,name:"scissor"};Di.add(by);var _4=class extends y4{constructor(e){super(e),this.glConst=Mi.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){let e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){let i=e.maskObject,{gl:r}=this.renderer,s=e._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),e._stencilCounter++;let n=e._colorMask;n!==0&&(e._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,s,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),i.renderable=!0,i.render(this.renderer),this.renderer.batch.flush(),i.renderable=!1,n!==0&&(e._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(e){let i=this.renderer.gl;if(this.getStackLength()===0)i.disable(i.STENCIL_TEST);else{let r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=r?r._colorMask:15;s!==0&&(r._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilOp(i.KEEP,i.KEEP,i.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(r._colorMask=s,i.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){let e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}};_4.extension={type:bi.RendererSystem,name:"stencil"};Di.add(_4);var x4=class{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return br("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract}},prepare:{enumerable:!1,get(){return br("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare}},interaction:{enumerable:!1,get(){return br("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events}}})}init(){let e=this.rendererPlugins;for(let i in e)this.plugins[i]=new e[i](this.renderer)}destroy(){for(let e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}};x4.extension={type:[bi.RendererSystem,bi.CanvasRendererSystem],name:"_plugin"};Di.add(x4);var v4=class{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new ps,this.transform=null}update(e,i,r,s){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=i||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,s),this.transform&&this.projectionMatrix.append(this.transform);let n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(e,i,r,s){let n=this.projectionMatrix,o=s?-1:1;n.identity(),n.a=1/i.width*2,n.d=o*(1/i.height*2),n.tx=-1-i.x*n.a,n.ty=-o-i.y*n.d}setTransform(e){}destroy(){this.renderer=null}};v4.extension={type:bi.RendererSystem,name:"projection"};Di.add(v4);var fq=new ly,b4=class{constructor(e){this.renderer=e,this._tempMatrix=new ps}generateTexture(e,i){let{region:r,...s}=i||{},n=r||e.getLocalBounds(null,!0);n.width===0&&(n.width=1),n.height===0&&(n.height=1);let o=Kd.create({width:n.width,height:n.height,...s});this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;let a=e.transform;return e.transform=fq,this.renderer.render(e,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=a,o}destroy(){}};b4.extension={type:[bi.RendererSystem,bi.CanvasRendererSystem],name:"textureGenerator"};Di.add(b4);var Jd=new qr,Qm=new qr,w4=class{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new qr,this.destinationFrame=new qr,this.viewportFrame=new qr}bind(e=null,i,r){let s=this.renderer;this.current=e;let n,o,a;e?(n=e.baseTexture,a=n.resolution,i||(Jd.width=e.frame.width,Jd.height=e.frame.height,i=Jd),r||(Qm.x=e.frame.x,Qm.y=e.frame.y,Qm.width=i.width,Qm.height=i.height,r=Qm),o=n.framebuffer):(a=s.resolution,i||(Jd.width=s._view.screen.width,Jd.height=s._view.screen.height,i=Jd),r||(r=Jd,r.width=i.width,r.height=i.height));let l=this.viewportFrame;l.x=r.x*a,l.y=r.y*a,l.width=r.width*a,l.height=r.height*a,e||(l.y=s.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(o,l),this.renderer.projection.update(r,i,a,!o),e?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(i),this.destinationFrame.copyFrom(r)}clear(e,i){let r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=e?wa.shared.setValue(e):r,n=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=n.width!==o.width||n.height!==o.height;if(a){let{x:l,y:u,width:d,height:m}=this.viewportFrame;l=Math.round(l),u=Math.round(u),d=Math.round(d),m=Math.round(m),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,u,d,m)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,i),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}};w4.extension={type:bi.RendererSystem,name:"renderTexture"};Di.add(w4);var Km=class{constructor(e,i){this.program=e,this.uniformData=i,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}};function EL(t,e){let i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){let n=e.getActiveAttrib(t,s);if(n.name.startsWith("gl_"))continue;let o=Bm(e,n.type),a={type:o,name:n.name,size:Om(o),location:e.getAttribLocation(t,n.name)};i[n.name]=a}return i}function TL(t,e){let i={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<r;s++){let n=e.getActiveUniform(t,s),o=n.name.replace(/\[.*?\]$/,""),a=!!n.name.match(/\[.*?\]$/),l=Bm(e,n.type);i[o]={name:o,index:s,type:l,size:n.size,isArray:a,value:Nm(l,n.size)}}return i}function FT(t,e){let i=cy(t,t.VERTEX_SHADER,e.vertexSrc),r=cy(t,t.FRAGMENT_SHADER,e.fragmentSrc),s=t.createProgram();t.attachShader(s,i),t.attachShader(s,r);let n=e.extra?.transformFeedbackVaryings;if(n&&(typeof t.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):t.transformFeedbackVaryings(s,n.names,n.bufferMode==="separate"?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||PT(t,s,i,r),e.attributeData=EL(s,t),e.uniformData=TL(s,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){let l=Object.keys(e.attributeData);l.sort((u,d)=>u>d?1:-1);for(let u=0;u<l.length;u++)e.attributeData[l[u]].location=u,t.bindAttribLocation(s,u,l[u]);t.linkProgram(s)}t.deleteShader(i),t.deleteShader(r);let o={};for(let l in e.uniformData){let u=e.uniformData[l];o[l]={location:t.getUniformLocation(s,l),value:Nm(u.type,u.size)}}return new Km(s,o)}function pq(t,e,i,r,s){i.buffer.update(s)}var mq={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},SL={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function AL(t){let e=t.map(n=>({data:n,offset:0,dataLen:0,dirty:0})),i=0,r=0,s=0;for(let n=0;n<e.length;n++){let o=e[n];if(i=SL[o.data.type],o.data.size>1&&(i=Math.max(i,16)*o.data.size),o.dataLen=i,r%i!==0&&r<16){let a=r%i%16;r+=a,s+=a}r+i>16?(s=Math.ceil(s/16)*16,o.offset=s,s+=i,r=i):(o.offset=s,r+=i,s+=i)}return s=Math.ceil(s/16)*16,{uboElements:e,size:s}}function CL(t,e){let i=[];for(let r in t)e[r]&&i.push(e[r]);return i.sort((r,s)=>r.index-s.index),i}function LT(t,e){if(!t.autoManage)return{size:0,syncFunc:pq};let i=CL(t.uniforms,e),{uboElements:r,size:s}=AL(i),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<r.length;o++){let a=r[o],l=t.uniforms[a.data.name],u=a.data.name,d=!1;for(let m=0;m<Wc.length;m++){let g=Wc[m];if(g.codeUbo&&g.test(a.data,l)){n.push(`offset = ${a.offset/4};`,Wc[m].codeUbo(a.data.name,l)),d=!0;break}}if(!d)if(a.data.size>1){let m=Om(a.data.type),g=Math.max(SL[a.data.type]/16,1),_=m/g,v=(4-_%4)%4;n.push(`
                cv = ud.${u}.value;
                v = uv.${u};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*g}; i++)
                {
                    for(var j = 0; j < ${_}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${v};
                }

                `)}else{let m=mq[a.data.type];n.push(`
                cv = ud.${u}.value;
                v = uv.${u};
                offset = ${a.offset/4};
                ${m};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}var gq=0,wy={textureCount:0,uboCount:0},E4=class{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=gq++}systemCheck(){if(!my())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,i){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;let r=e.program,s=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==r&&(this.program=r,this.gl.useProgram(s.program)),i||(wy.textureCount=0,wy.uboCount=0,this.syncUniformGroup(e.uniformGroup,wy)),s}setUniforms(e){let i=this.shader.program,r=i.glPrograms[this.renderer.CONTEXT_UID];i.syncUniforms(r.uniformData,e,this.renderer)}syncUniformGroup(e,i){let r=this.getGlProgram();(!e.static||e.dirtyId!==r.uniformDirtyGroups[e.id])&&(r.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,r,i))}syncUniforms(e,i,r){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(i.uniformData,e.uniforms,this.renderer,r)}createSyncGroups(e){let i=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[i]||(this.cache[i]=kT(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[i],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,i){let r=this.getGlProgram();if(!e.static||e.dirtyId!==0||!r.uniformGroups[e.id]){e.dirtyId=0;let s=r.uniformGroups[e.id]||this.createSyncBufferGroup(e,r,i);e.buffer.update(),s(r.uniformData,e.uniforms,this.renderer,wy,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,r.uniformBufferBindings[i])}createSyncBufferGroup(e,i,r){let{gl:s}=this.renderer;this.renderer.buffer.bind(e.buffer);let n=this.gl.getUniformBlockIndex(i.program,r);i.uniformBufferBindings[r]=this.shader.uniformBindCount,s.uniformBlockBinding(i.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;let o=this.getSignature(e,this.shader.program.uniformData,"ubo"),a=this._uboCache[o];if(a||(a=this._uboCache[o]=LT(e,this.shader.program.uniformData)),e.autoManage){let l=new Float32Array(a.size/4);e.buffer.update(l)}return i.uniformGroups[e.id]=a.syncFunc,i.uniformGroups[e.id]}getSignature(e,i,r){let s=e.uniforms,n=[`${r}-`];for(let o in s)n.push(o),i[o]&&n.push(i[o].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){let i=this.gl,r=e.program,s=FT(i,r);return r.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}};E4.extension={type:bi.RendererSystem,name:"shader"};Di.add(E4);var e1=class{constructor(e){this.renderer=e}run(e){let{renderer:i}=this;i.runners.init.emit(i.options),e.hello&&console.log(`PixiJS 7.2.1 - ${i.rendererLogId} - https://pixijs.com`),i.resize(i.screen.width,i.screen.height)}destroy(){}};e1.defaultOptions={hello:!1};e1.extension={type:[bi.RendererSystem,bi.CanvasRendererSystem],name:"startup"};Di.add(e1);function IL(t,e=[]){return e[Vi.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.ADD]=[t.ONE,t.ONE],e[Vi.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.NONE]=[0,0],e[Vi.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[Vi.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Vi.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[Vi.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[Vi.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[Vi.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[Vi.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[Vi.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[Vi.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[Vi.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[Vi.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}var yq=0,_q=1,xq=2,vq=3,bq=4,wq=5,NT=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=Vi.NONE,this._blendEq=!1,this.map=[],this.map[yq]=this.setBlend,this.map[_q]=this.setOffset,this.map[xq]=this.setCullFace,this.map[vq]=this.setDepthTest,this.map[bq]=this.setFrontFace,this.map[wq]=this.setDepthMask,this.checks=[],this.defaultState=new Zu,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=IL(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)e&1&&this.map[i].call(this,!!(t.data&1<<i)),e=e>>1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(NT.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(NT.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;let e=this.blendModes[t],i=this.gl;e.length===2?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){let i=this.checks.indexOf(t);e&&i===-1?this.checks.push(t):!e&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}},Ey=NT;Ey.extension={type:bi.RendererSystem,name:"state"};Di.add(Ey);var T4=class extends Vd.default{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);let i=(e.priority??[]).filter(s=>e.systems[s]),r=[...i,...Object.keys(e.systems).filter(s=>!i.includes(s))];for(let s of r)this.addSystem(e.systems[s],s)}addRunners(...e){e.forEach(i=>{this.runners[i]=new mn(i)})}addSystem(e,i){let r=new e(this);if(this[i])throw new Error(`Whoops! The name "${i}" is already in use`);this[i]=r,this._systemsHash[i]=r;for(let s in this.runners)this.runners[s].add(r);return this}emitWithCustomOptions(e,i){let r=Object.keys(this._systemsHash);e.items.forEach(s=>{let n=r.find(o=>this._systemsHash[o]===s);s[e.name](i[n])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}};var Ty=class{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Ty.defaultMaxIdle,this.checkCountMax=Ty.defaultCheckCountMax,this.mode=Ty.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==Jg.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){let t=this.renderer.texture,e=t.managedTextures,i=!1;for(let r=0;r<e.length;r++){let s=e[r];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[r]=null,i=!0)}if(i){let r=0;for(let s=0;s<e.length;s++)e[s]!==null&&(e[r++]=e[s]);e.length=r}}unload(t){let e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let r=t.children.length-1;r>=0;r--)this.unload(t.children[r])}destroy(){this.renderer=null}},Ta=Ty;Ta.defaultMode=Jg.AUTO;Ta.defaultMaxIdle=60*60;Ta.defaultCheckCountMax=60*10;Ta.extension={type:bi.RendererSystem,name:"textureGC"};Di.add(Ta);var e0=class{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=mr.UNSIGNED_BYTE,this.internalFormat=ri.RGBA,this.samplerType=0}};function kL(t){let e;return"WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?e={[mr.UNSIGNED_BYTE]:{[ri.RGBA]:t.RGBA8,[ri.RGB]:t.RGB8,[ri.RG]:t.RG8,[ri.RED]:t.R8,[ri.RGBA_INTEGER]:t.RGBA8UI,[ri.RGB_INTEGER]:t.RGB8UI,[ri.RG_INTEGER]:t.RG8UI,[ri.RED_INTEGER]:t.R8UI,[ri.ALPHA]:t.ALPHA,[ri.LUMINANCE]:t.LUMINANCE,[ri.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[mr.BYTE]:{[ri.RGBA]:t.RGBA8_SNORM,[ri.RGB]:t.RGB8_SNORM,[ri.RG]:t.RG8_SNORM,[ri.RED]:t.R8_SNORM,[ri.RGBA_INTEGER]:t.RGBA8I,[ri.RGB_INTEGER]:t.RGB8I,[ri.RG_INTEGER]:t.RG8I,[ri.RED_INTEGER]:t.R8I},[mr.UNSIGNED_SHORT]:{[ri.RGBA_INTEGER]:t.RGBA16UI,[ri.RGB_INTEGER]:t.RGB16UI,[ri.RG_INTEGER]:t.RG16UI,[ri.RED_INTEGER]:t.R16UI,[ri.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[mr.SHORT]:{[ri.RGBA_INTEGER]:t.RGBA16I,[ri.RGB_INTEGER]:t.RGB16I,[ri.RG_INTEGER]:t.RG16I,[ri.RED_INTEGER]:t.R16I},[mr.UNSIGNED_INT]:{[ri.RGBA_INTEGER]:t.RGBA32UI,[ri.RGB_INTEGER]:t.RGB32UI,[ri.RG_INTEGER]:t.RG32UI,[ri.RED_INTEGER]:t.R32UI,[ri.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[mr.INT]:{[ri.RGBA_INTEGER]:t.RGBA32I,[ri.RGB_INTEGER]:t.RGB32I,[ri.RG_INTEGER]:t.RG32I,[ri.RED_INTEGER]:t.R32I},[mr.FLOAT]:{[ri.RGBA]:t.RGBA32F,[ri.RGB]:t.RGB32F,[ri.RG]:t.RG32F,[ri.RED]:t.R32F,[ri.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[mr.HALF_FLOAT]:{[ri.RGBA]:t.RGBA16F,[ri.RGB]:t.RGB16F,[ri.RG]:t.RG16F,[ri.RED]:t.R16F},[mr.UNSIGNED_SHORT_5_6_5]:{[ri.RGB]:t.RGB565},[mr.UNSIGNED_SHORT_4_4_4_4]:{[ri.RGBA]:t.RGBA4},[mr.UNSIGNED_SHORT_5_5_5_1]:{[ri.RGBA]:t.RGB5_A1},[mr.UNSIGNED_INT_2_10_10_10_REV]:{[ri.RGBA]:t.RGB10_A2,[ri.RGBA_INTEGER]:t.RGB10_A2UI},[mr.UNSIGNED_INT_10F_11F_11F_REV]:{[ri.RGB]:t.R11F_G11F_B10F},[mr.UNSIGNED_INT_5_9_9_9_REV]:{[ri.RGB]:t.RGB9_E5},[mr.UNSIGNED_INT_24_8]:{[ri.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[mr.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[ri.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:e={[mr.UNSIGNED_BYTE]:{[ri.RGBA]:t.RGBA,[ri.RGB]:t.RGB,[ri.ALPHA]:t.ALPHA,[ri.LUMINANCE]:t.LUMINANCE,[ri.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[mr.UNSIGNED_SHORT_5_6_5]:{[ri.RGB]:t.RGB},[mr.UNSIGNED_SHORT_4_4_4_4]:{[ri.RGBA]:t.RGBA},[mr.UNSIGNED_SHORT_5_5_5_1]:{[ri.RGBA]:t.RGBA}},e}var S4=class{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new _r,this.hasIntegerTextures=!1}contextChange(){let e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=kL(e);let i=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=i;for(let s=0;s<i;s++)this.boundTextures[s]=null;this.emptyTextures={};let r=new e0(e.createTexture());e.bindTexture(e.TEXTURE_2D,r.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=r,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new e0(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(e,i=0){let{gl:r}=this;if(e=e?.castToBaseTexture(),e?.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;let s=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[i]!==e&&(this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),r.bindTexture(e.target,s.texture)),s.dirtyId!==e.dirtyId?(this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),this.updateTexture(e)):s.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[i]=e}else this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[i]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){let{gl:i,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<r.length;s++)r[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<r.length;s++)r[s]===e&&(this.currentLocation!==s&&(i.activeTexture(i.TEXTURE0+s),this.currentLocation=s),i.bindTexture(e.target,this.emptyTextures[e.target].texture),r[s]=null)}ensureSamplerType(e){let{boundTextures:i,hasIntegerTextures:r,CONTEXT_UID:s}=this;if(r)for(let n=e-1;n>=0;--n){let o=i[n];o&&o._glTextures[s].samplerType!==Kg.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(e){let i=new e0(this.gl.createTexture());return i.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=i,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),i}initTextureType(e,i){i.internalFormat=this.internalFormats[e.type]?.[e.format]??e.format,this.webGLVersion===2&&e.type===mr.HALF_FLOAT?i.type=this.gl.HALF_FLOAT:i.type=e.type}updateTexture(e){let i=e._glTextures[this.CONTEXT_UID];if(!i)return;let r=this.renderer;if(this.initTextureType(e,i),e.resource?.upload(r,e,i))i.samplerType!==Kg.FLOAT&&(this.hasIntegerTextures=!0);else{let s=e.realWidth,n=e.realHeight,o=r.gl;(i.width!==s||i.height!==n||i.dirtyId<0)&&(i.width=s,i.height=n,o.texImage2D(e.target,0,i.internalFormat,s,n,0,e.format,i.type,null))}e.dirtyStyleId!==i.dirtyStyleId&&this.updateTextureStyle(e),i.dirtyId=e.dirtyId}destroyTexture(e,i){let{gl:r}=this;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),r.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!i)){let s=this.managedTextures.indexOf(e);s!==-1&&gT(this.managedTextures,s,1)}}updateTextureStyle(e){let i=e._glTextures[this.CONTEXT_UID];i&&((e.mipmap===lc.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?i.mipmap=!1:i.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?i.wrapMode=Rm.CLAMP:i.wrapMode=e.wrapMode,e.resource?.style(this.renderer,e,i)||this.setStyle(e,i),i.dirtyStyleId=e.dirtyStyleId)}setStyle(e,i){let r=this.gl;if(i.mipmap&&e.mipmap!==lc.ON_MANUAL&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,i.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,i.wrapMode),i.mipmap){r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===Ml.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);let s=this.renderer.context.extensions.anisotropicFiltering;if(s&&e.anisotropicLevel>0&&e.scaleMode===Ml.LINEAR){let n=Math.min(e.anisotropicLevel,r.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(e.target,s.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===Ml.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode===Ml.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}};S4.extension={type:bi.RendererSystem,name:"texture"};Di.add(S4);var A4=class{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){let{gl:i,CONTEXT_UID:r}=this,s=e._glTransformFeedbacks[r]||this.createGLTransformFeedback(e);i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,s)}unbind(){let{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,i){let{gl:r,renderer:s}=this;i&&s.shader.bind(i),r.beginTransformFeedback(e)}endTransformFeedback(){let{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){let{gl:i,renderer:r,CONTEXT_UID:s}=this,n=i.createTransformFeedback();e._glTransformFeedbacks[s]=n,i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,n);for(let o=0;o<e.buffers.length;o++){let a=e.buffers[o];a&&(r.buffer.update(a),a._glBuffers[s].refCount++,i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[s].buffer||null))}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),n}disposeTransformFeedback(e,i){let r=e._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this);let n=this.renderer.buffer;if(n)for(let o=0;o<e.buffers.length;o++){let a=e.buffers[o];if(!a)continue;let l=a._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!i&&n.dispose(a,i))}r&&(i||s.deleteTransformFeedback(r),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}};A4.extension={type:bi.RendererSystem,name:"transformFeedback"};Di.add(A4);var t1=class{constructor(e){this.renderer=e}init(e){this.screen=new qr(0,0,e.width,e.height),this.element=e.view||Mi.ADAPTER.createCanvas(),this.resolution=e.resolution||Mi.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,i){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(i*this.resolution);let r=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=r,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",r,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){e&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}};t1.defaultOptions={width:800,height:600,resolution:Mi.RESOLUTION,autoDensity:!1};t1.extension={type:[bi.RendererSystem,bi.CanvasRendererSystem],name:"_view"};Di.add(t1);Mi.PREFER_ENV=Ya.WEBGL2;Mi.STRICT_TEXTURE_CACHE=!1;Mi.RENDER_OPTIONS={...Ju.defaultOptions,...Ku.defaultOptions,...t1.defaultOptions,...e1.defaultOptions};Object.defineProperties(Mi,{WRAP_MODE:{get(){return _r.defaultOptions.wrapMode},set(t){br("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),_r.defaultOptions.wrapMode=t}},SCALE_MODE:{get(){return _r.defaultOptions.scaleMode},set(t){br("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),_r.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get(){return _r.defaultOptions.mipmap},set(t){br("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),_r.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get(){return _r.defaultOptions.anisotropicLevel},set(t){br("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),_r.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get(){return br("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),el.defaultResolution},set(t){el.defaultResolution=t}},FILTER_MULTISAMPLE:{get(){return br("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),el.defaultMultisample},set(t){el.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get(){return Ja.defaultMaxTextures},set(t){br("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Ja.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get(){return Ja.defaultBatchSize},set(t){br("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Ja.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get(){return Ja.canUploadSameBuffer},set(t){br("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Ja.canUploadSameBuffer=t}},GC_MODE:{get(){return Ta.defaultMode},set(t){br("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Ta.defaultMode=t}},GC_MAX_IDLE:{get(){return Ta.defaultMaxIdle},set(t){br("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Ta.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get(){return Ta.defaultCheckCountMax},set(t){br("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Ta.defaultCheckCountMax=t}},PRECISION_VERTEX:{get(){return Ea.defaultVertexPrecision},set(t){br("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Ea.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get(){return Ea.defaultFragmentPrecision},set(t){br("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Ea.defaultFragmentPrecision=t}}});var t0=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(t0||{});var C4=class{constructor(e,i=null,r=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=i,this.priority=r,this.once=s}match(e,i=null){return this.fn===e&&this.context===i}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));let i=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),i}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);let i=this.next;return this.next=e?null:i,this.previous=null,i}};var tl=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new C4(null,null,1/0),this.deltaMS=1/tl.targetFPMS,this.elapsedMS=1/tl.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=t0.NORMAL){return this._addListener(new C4(t,e,i))}addOnce(t,e,i=t0.NORMAL){return this._addListener(new C4(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){let s=t-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=t-s%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*tl.targetFPMS;let i=this._head,r=i.next;for(;r;)r=r.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){let e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,tl.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{let e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!tl._shared){let t=tl._shared=new tl;t.autoStart=!0,t._protected=!0}return tl._shared}static get system(){if(!tl._system){let t=tl._system=new tl;t.autoStart=!0,t._protected=!0}return tl._system}},ta=tl;ta.targetFPMS=.06;Object.defineProperties(Mi,{TARGET_FPMS:{get(){return ta.targetFPMS},set(t){br("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),ta.targetFPMS=t}}});var Jm=class{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(i){this._ticker&&this._ticker.remove(this.render,this),this._ticker=i,i&&i.add(this.render,this,t0.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?ta.shared:new ta,e.autoStart&&this.start()}static destroy(){if(this._ticker){let e=this._ticker;this.ticker=null,e.destroy()}}};Jm.extension=bi.Application;Di.add(Jm);var Eq=[];Di.handleByList(bi.Renderer,Eq);var e6=class{constructor(e){this.renderer=e}contextChange(e){let i;if(this.renderer.context.webGLVersion===1){let r=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),i=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,r)}else{let r=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),i=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,r)}i>=Wr.HIGH?this.multisample=Wr.HIGH:i>=Wr.MEDIUM?this.multisample=Wr.MEDIUM:i>=Wr.LOW?this.multisample=Wr.LOW:this.multisample=Wr.NONE}destroy(){}};e6.extension={type:bi.RendererSystem,name:"_multisample"};Di.add(e6);var Sy=class{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}};var t6=class{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){let{gl:i,CONTEXT_UID:r}=this,s=e._glBuffers[r]||this.createGLBuffer(e);i.bindBuffer(e.type,s.buffer)}unbind(e){let{gl:i}=this;i.bindBuffer(e,null)}bindBufferBase(e,i){let{gl:r,CONTEXT_UID:s}=this;if(this.boundBufferBases[i]!==e){let n=e._glBuffers[s]||this.createGLBuffer(e);this.boundBufferBases[i]=e,r.bindBufferBase(r.UNIFORM_BUFFER,i,n.buffer)}}bindBufferRange(e,i,r){let{gl:s,CONTEXT_UID:n}=this;r=r||0;let o=e._glBuffers[n]||this.createGLBuffer(e);s.bindBufferRange(s.UNIFORM_BUFFER,i||0,o.buffer,r*256,256)}update(e){let{gl:i,CONTEXT_UID:r}=this,s=e._glBuffers[r]||this.createGLBuffer(e);if(e._updateID!==s.updateID)if(s.updateID=e._updateID,i.bindBuffer(e.type,s.buffer),s.byteLength>=e.data.byteLength)i.bufferSubData(e.type,0,e.data);else{let n=e.static?i.STATIC_DRAW:i.DYNAMIC_DRAW;s.byteLength=e.data.byteLength,i.bufferData(e.type,e.data,n)}}dispose(e,i){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];let r=e._glBuffers[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this),r&&(i||s.deleteBuffer(r.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){let i=Object.keys(this.managedBuffers);for(let r=0;r<i.length;r++)this.dispose(this.managedBuffers[i[r]],e)}createGLBuffer(e){let{CONTEXT_UID:i,gl:r}=this;return e._glBuffers[i]=new Sy(r.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[i]}};t6.extension={type:bi.RendererSystem,name:"buffer"};Di.add(t6);var i6=class{constructor(e){this.renderer=e}render(e,i){let r=this.renderer,s,n,o,a;if(i&&(s=i.renderTexture,n=i.clear,o=i.transform,a=i.skipUpdateTransform),this.renderingToScreen=!s,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=o,!r.context.isLost){if(s||(this.lastObjectRendered=e),!a){let l=e.enableTempParent();e.updateTransform(),e.disableTempParent(l)}r.renderTexture.bind(s),r.batch.currentRenderer.start(),(n??r.background.clearBeforeRender)&&r.renderTexture.clear(),e.render(r),r.batch.currentRenderer.flush(),s&&(i.blit&&r.framebuffer.blit(),s.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}};i6.extension={type:bi.RendererSystem,name:"objectRenderer"};Di.add(i6);var OT=class extends T4{constructor(t){super(),this.type=uT.WEBGL,t=Object.assign({},Mi.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Ka({projectionMatrix:new ps},!0);let e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:OT.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(br("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=OT.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t?.forceCanvas?!1:pT()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return br("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return br("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return br("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return br("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){br("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return br("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){br("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return br("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}},i0=OT;i0.extension={type:bi.Renderer,priority:1};i0.__plugins={};i0.__systems={};Di.handleByMap(bi.RendererPlugin,i0.__plugins);Di.handleByMap(bi.RendererSystem,i0.__systems);Di.add(i0);var dh=class extends Qa{constructor(e,i){let{width:r,height:s}=i||{};super(r,s),this.items=[],this.itemDirtyIds=[];for(let n=0;n<e;n++){let o=new _r;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,i){for(let r=0;r<this.length;r++)e[r]&&(e[r].castToBaseTexture?this.addBaseTextureAt(e[r].castToBaseTexture(),r):e[r]instanceof Qa?this.addResourceAt(e[r],r):this.addResourceAt(o4(e[r],i),r))}dispose(){for(let e=0,i=this.length;e<i;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,i){if(!this.items[i])throw new Error(`Index ${i} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[i].setResource(e),this}bind(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let i=0;i<this.length;i++)this.items[i].parentTextureArray=e,this.items[i].on("update",e.update,e)}unbind(e){super.unbind(e);for(let i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",e.update,e)}load(){if(this._load)return this._load;let i=this.items.map(r=>r.resource).filter(r=>r).map(r=>r.load());return this._load=Promise.all(i).then(()=>{let{realWidth:r,realHeight:s}=this.items[0];return this.resize(r,s),Promise.resolve(this)}),this._load}};var I4=class extends dh{constructor(e,i){let{width:r,height:s}=i||{},n,o;Array.isArray(e)?(n=e,o=e.length):o=e,super(o,{width:r,height:s}),n&&this.initFromArray(n,i)}addBaseTextureAt(e,i){if(e.resource)this.addResourceAt(e.resource,i);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(e){super.bind(e),e.target=qu.TEXTURE_2D_ARRAY}upload(e,i,r){let{length:s,itemDirtyIds:n,items:o}=this,{gl:a}=e;r.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,s,0,i.format,r.type,null);for(let l=0;l<s;l++){let u=o[l];n[l]<u.dirtyId&&(n[l]=u.dirtyId,u.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,l,u.resource.width,u.resource.height,1,i.format,r.type,u.resource.source))}return!0}};var k4=class extends io{constructor(e){super(e)}static test(e){let{OffscreenCanvas:i}=globalThis;return i&&e instanceof i?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}};var r6=class extends dh{constructor(t,e){let{width:i,height:r,autoLoad:s,linkBaseTexture:n}=e||{};if(t&&t.length!==r6.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:r});for(let o=0;o<r6.SIDES;o++)this.items[o].target=qu.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=n!==!1,t&&this.initFromArray(t,e),s!==!1&&this.load()}bind(t){super.bind(t),t.target=qu.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=qu.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,i){let r=this.itemDirtyIds;for(let s=0;s<r6.SIDES;s++){let n=this.items[s];(r[s]<n.dirtyId||i.dirtyId<e.dirtyId)&&(n.valid&&n.resource?(n.resource.upload(t,n,i),r[s]=n.dirtyId):r[s]<-1&&(t.gl.texImage2D(n.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),r[s]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===r6.SIDES}},s6=r6;s6.SIDES=6;var M4=class t extends io{constructor(e,i){i=i||{};let r,s;typeof e=="string"?(r=t.EMPTY,s=e):(r=e,s=null),super(r),this.url=s,this.crossOrigin=i.crossOrigin??!0,this.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,this._load=null,i.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(e,i)=>{if(this.url===null){e(this);return}try{let r=await Mi.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;let s=await r.blob();if(this.destroyed)return;let n=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===va.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=n,this.update(),e(this)}catch(r){if(this.destroyed)return;i(r),this.onError.emit(r)}}),this._load)}upload(e,i,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),super.upload(e,i,r)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof e=="string"||e instanceof ImageBitmap)}static get EMPTY(){return t._EMPTY=t._EMPTY??Mi.ADAPTER.createCanvas(0,0),t._EMPTY}};var Ay=class extends io{constructor(t,e){e=e||{},super(Mi.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),t(this)},Ay.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){let t=new Image;io.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;let e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=e*this.scale,s=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/i*e,s=this._overrideHeight||this._overrideWidth/e*i),r=Math.round(r),s=Math.round(s);let n=this.source;n.width=r,n.height=s,n._pixiId=`canvas_${Yu()}`,n.getContext("2d").drawImage(t,0,0,e,i,0,0,r,s),this._resolve(),this._resolve=null}}static getSize(t){let e=Ay.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&Ay.SVG_XML.test(t)}},P4=Ay;P4.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;P4.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var BT=class extends io{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){let i=document.createElement("video");i.setAttribute("preload","auto"),i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline",""),typeof t=="string"&&(t=[t]);let r=t[0].src||t[0];io.crossOrigin(i,r,e.crossorigin);for(let s=0;s<t.length;++s){let n=document.createElement("source"),{src:o,mime:a}=t[s];o=o||t[s];let l=o.split("?").shift().toLowerCase(),u=l.slice(l.lastIndexOf(".")+1);a=a||BT.MIME_TYPES[u]||`video/${u}`,n.src=o,n.type=a,i.appendChild(n)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){let e=ta.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;let t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise(e=>{this.valid?e(this):(this._resolve=e,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)}_isSourcePlaying(){let t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(ta.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(ta.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){let t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);let e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._isConnectedToTicker&&(ta.shared.remove(this.update,this),this._isConnectedToTicker=!1);let t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(ta.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(ta.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t)}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||BT.TYPES.includes(e)}},R4=BT;R4.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];R4.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};n4.push(M4,hh,k4,R4,P4,Xc,s6,I4);var Tq=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Sq=`uniform float radius;
uniform float strength;
uniform vec2 center;
uniform sampler2D uSampler;
varying vec2 vTextureCoord;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec2 dimensions;

void main()
{
    vec2 coord = vTextureCoord * filterArea.xy;
    coord -= center * dimensions.xy;
    float distance = length(coord);
    if (distance < radius) {
        float percent = distance / radius;
        if (strength > 0.0) {
            coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);
        } else {
            coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);
        }
    }
    coord += center * dimensions.xy;
    coord /= filterArea.xy;
    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);
    vec4 color = texture2D(uSampler, clampedCoord);
    if (coord != clampedCoord) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    gl_FragColor = color;
}
`,ML=class extends Wt{constructor(t){super(Tq,Sq),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,ML.defaults,t)}apply(t,e,i,r){let{width:s,height:n}=e.filterFrame;this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,t.applyFilter(this,e,i,r)}get radius(){return this.uniforms.radius}set radius(t){this.uniforms.radius=t}get strength(){return this.uniforms.strength}set strength(t){this.uniforms.strength=t}get center(){return this.uniforms.center}set center(t){this.uniforms.center=t}},Aq=ML;Aq.defaults={center:[.5,.5],radius:100,strength:1};var Cq=`const float PI = 3.1415926538;
const float PI_2 = PI*2.;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;
uniform sampler2D uSampler;

const int TYPE_LINEAR = 0;
const int TYPE_RADIAL = 1;
const int TYPE_CONIC = 2;
const int MAX_STOPS = 32;

uniform int uNumStops;
uniform float uAlphas[3*MAX_STOPS];
uniform vec3 uColors[MAX_STOPS];
uniform float uOffsets[MAX_STOPS];
uniform int uType;
uniform float uAngle;
uniform float uAlpha;
uniform int uMaxColors;

struct ColorStop {
    float offset;
    vec3 color;
    float alpha;
};

mat2 rotate2d(float angle){
    return mat2(cos(angle), -sin(angle),
    sin(angle), cos(angle));
}

float projectLinearPosition(vec2 pos, float angle){
    vec2 center = vec2(0.5);
    vec2 result = pos - center;
    result = rotate2d(angle) * result;
    result = result + center;
    return clamp(result.x, 0., 1.);
}

float projectRadialPosition(vec2 pos) {
    float r = distance(vFilterCoord, vec2(0.5));
    return clamp(2.*r, 0., 1.);
}

float projectAnglePosition(vec2 pos, float angle) {
    vec2 center = pos - vec2(0.5);
    float polarAngle=atan(-center.y, center.x);
    return mod(polarAngle + angle, PI_2) / PI_2;
}

float projectPosition(vec2 pos, int type, float angle) {
    if (type == TYPE_LINEAR) {
        return projectLinearPosition(pos, angle);
    } else if (type == TYPE_RADIAL) {
        return projectRadialPosition(pos);
    } else if (type == TYPE_CONIC) {
        return projectAnglePosition(pos, angle);
    }

    return pos.y;
}

void main(void) {
    // current/original color
    vec4 currentColor = texture2D(uSampler, vTextureCoord);

    // skip calculations if gradient alpha is 0
    if (0.0 == uAlpha) {
        gl_FragColor = currentColor;
        return;
    }

    // project position
    float y = projectPosition(vFilterCoord, uType, radians(uAngle));

    // check gradient bounds
    float offsetMin = uOffsets[0];
    float offsetMax = 0.0;

    for (int i = 0; i < MAX_STOPS; i++) {
        if (i == uNumStops-1){ // last index
            offsetMax = uOffsets[i];
        }
    }

    if (y  < offsetMin || y > offsetMax) {
        gl_FragColor = currentColor;
        return;
    }

    // limit colors
    if (uMaxColors > 0) {
        float stepSize = 1./float(uMaxColors);
        float stepNumber = float(floor(y/stepSize));
        y = stepSize * (stepNumber + 0.5);// offset by 0.5 to use color from middle of segment
    }

    // find color stops
    ColorStop from;
    ColorStop to;

    for (int i = 0; i < MAX_STOPS; i++) {
        if (y >= uOffsets[i]) {
            from = ColorStop(uOffsets[i], uColors[i], uAlphas[i]);
            to = ColorStop(uOffsets[i+1], uColors[i+1], uAlphas[i+1]);
        }

        if (i == uNumStops-1){ // last index
            break;
        }
    }

    // mix colors from stops
    vec4 colorFrom = vec4(from.color * from.alpha, from.alpha);
    vec4 colorTo = vec4(to.color * to.alpha, to.alpha);

    float segmentHeight = to.offset - from.offset;
    float relativePos = y - from.offset;// position from 0 to [segmentHeight]
    float relativePercent = relativePos / segmentHeight;// position in percent between [from.offset] and [to.offset].

    float gradientAlpha = uAlpha * currentColor.a;
    vec4 gradientColor = mix(colorFrom, colorTo, relativePercent) * gradientAlpha;

    // mix resulting color with current color
    gl_FragColor = gradientColor + currentColor*(1.-gradientColor.a);
}
`,Iq=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform vec4 inputSize;
uniform vec4 outputFrame;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
    vFilterCoord = vTextureCoord * inputSize.xy / outputFrame.zw;
}
`,r0=r0||{};r0.stringify=function(){var t={"visit_linear-gradient":function(e){return t.visit_gradient(e)},"visit_repeating-linear-gradient":function(e){return t.visit_gradient(e)},"visit_radial-gradient":function(e){return t.visit_gradient(e)},"visit_repeating-radial-gradient":function(e){return t.visit_gradient(e)},visit_gradient:function(e){var i=t.visit(e.orientation);return i&&(i+=", "),e.type+"("+i+t.visit(e.colorStops)+")"},visit_shape:function(e){var i=e.value,r=t.visit(e.at),s=t.visit(e.style);return s&&(i+=" "+s),r&&(i+=" at "+r),i},"visit_default-radial":function(e){var i="",r=t.visit(e.at);return r&&(i+=r),i},"visit_extent-keyword":function(e){var i=e.value,r=t.visit(e.at);return r&&(i+=" at "+r),i},"visit_position-keyword":function(e){return e.value},visit_position:function(e){return t.visit(e.value.x)+" "+t.visit(e.value.y)},"visit_%":function(e){return e.value+"%"},visit_em:function(e){return e.value+"em"},visit_px:function(e){return e.value+"px"},visit_literal:function(e){return t.visit_color(e.value,e)},visit_hex:function(e){return t.visit_color("#"+e.value,e)},visit_rgb:function(e){return t.visit_color("rgb("+e.value.join(", ")+")",e)},visit_rgba:function(e){return t.visit_color("rgba("+e.value.join(", ")+")",e)},visit_color:function(e,i){var r=e,s=t.visit(i.length);return s&&(r+=" "+s),r},visit_angular:function(e){return e.value+"deg"},visit_directional:function(e){return"to "+e.value},visit_array:function(e){var i="",r=e.length;return e.forEach(function(s,n){i+=t.visit(s),n<r-1&&(i+=", ")}),i},visit:function(e){if(!e)return"";var i="";if(e instanceof Array)return t.visit_array(e,i);if(e.type){var r=t["visit_"+e.type];if(r)return r(e);throw Error("Missing visitor visit_"+e.type)}else throw Error("Invalid node.")}};return function(e){return t.visit(e)}}();var r0=r0||{};r0.parse=function(){var t={linearGradient:/^(\-(webkit|o|ms|moz)\-)?(linear\-gradient)/i,repeatingLinearGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-linear\-gradient)/i,radialGradient:/^(\-(webkit|o|ms|moz)\-)?(radial\-gradient)/i,repeatingRadialGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-radial\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/^\#([0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^rgb/i,rgbaColor:/^rgba/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/},e="";function i(le){var te=new Error(e+": "+le);throw te.source=e,te}function r(){var le=s();return e.length>0&&i("Invalid input not EOF"),le}function s(){return M(n)}function n(){return o("linear-gradient",t.linearGradient,l)||o("repeating-linear-gradient",t.repeatingLinearGradient,l)||o("radial-gradient",t.radialGradient,m)||o("repeating-radial-gradient",t.repeatingRadialGradient,m)}function o(le,te,ee){return a(te,function(oe){var ie=ee();return ie&&(ce(t.comma)||i("Missing comma before color stops")),{type:le,orientation:ie,colorStops:M(k)}})}function a(le,te){var ee=ce(le);if(ee){ce(t.startCall)||i("Missing (");var oe=te(ee);return ce(t.endCall)||i("Missing )"),oe}}function l(){return u()||d()}function u(){return X("directional",t.sideOrCorner,1)}function d(){return X("angular",t.angleValue,1)}function m(){var le,te=g(),ee;return te&&(le=[],le.push(te),ee=e,ce(t.comma)&&(te=g(),te?le.push(te):e=ee)),le}function g(){var le=_()||v();if(le)le.at=b();else{var te=E();if(te){le=te;var ee=b();ee&&(le.at=ee)}else{var oe=T();oe&&(le={type:"default-radial",at:oe})}}return le}function _(){var le=X("shape",/^(circle)/i,0);return le&&(le.style=Q()||E()),le}function v(){var le=X("shape",/^(ellipse)/i,0);return le&&(le.style=W()||E()),le}function E(){return X("extent-keyword",t.extentKeywords,1)}function b(){if(X("position",/^at/,0)){var le=T();return le||i("Missing positioning value"),le}}function T(){var le=A();if(le.x||le.y)return{type:"position",value:le}}function A(){return{x:W(),y:W()}}function M(le){var te=le(),ee=[];if(te)for(ee.push(te);ce(t.comma);)te=le(),te?ee.push(te):i("One extra comma");return ee}function k(){var le=F();return le||i("Expected color definition"),le.length=W(),le}function F(){return B()||$()||U()||O()}function O(){return X("literal",t.literalColor,0)}function B(){return X("hex",t.hexColor,1)}function U(){return a(t.rgbColor,function(){return{type:"rgb",value:M(q)}})}function $(){return a(t.rgbaColor,function(){return{type:"rgba",value:M(q)}})}function q(){return ce(t.number)[1]}function W(){return X("%",t.percentageValue,1)||Z()||Q()}function Z(){return X("position-keyword",t.positionKeywords,1)}function Q(){return X("px",t.pixelValue,1)||X("em",t.emValue,1)}function X(le,te,ee){var oe=ce(te);if(oe)return{type:le,value:oe[ee]}}function ce(le){var te,ee;return ee=/^[\n\r\t\s]+/.exec(e),ee&&de(ee[0].length),te=le.exec(e),te&&de(te[0].length),te}function de(le){e=e.substr(le)}return function(le){return e=le.toString(),r()}}();var kq=r0.parse;r0.stringify;var PL={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},RL={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Mq(t){var e,i=[],r=1,s;if(typeof t=="string")if(PL[t])i=PL[t].slice(),s="rgb";else if(t==="transparent")r=0,s="rgb",i=[0,0,0];else if(/^#[A-Fa-f0-9]+$/.test(t)){var n=t.slice(1),o=n.length,a=o<=4;r=1,a?(i=[parseInt(n[0]+n[0],16),parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16)],o===4&&(r=parseInt(n[3]+n[3],16)/255)):(i=[parseInt(n[0]+n[1],16),parseInt(n[2]+n[3],16),parseInt(n[4]+n[5],16)],o===8&&(r=parseInt(n[6]+n[7],16)/255)),i[0]||(i[0]=0),i[1]||(i[1]=0),i[2]||(i[2]=0),s="rgb"}else if(e=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(t)){var l=e[1],u=l==="rgb",n=l.replace(/a$/,"");s=n;var o=n==="cmyk"?4:n==="gray"?1:3;i=e[2].trim().split(/\s*[,\/]\s*|\s+/).map(function(g,_){if(/%$/.test(g))return _===o?parseFloat(g)/100:n==="rgb"?parseFloat(g)*255/100:parseFloat(g);if(n[_]==="h"){if(/deg$/.test(g))return parseFloat(g);if(RL[g]!==void 0)return RL[g]}return parseFloat(g)}),l===n&&i.push(1),r=u||i[o]===void 0?1:i[o],i=i.slice(0,o)}else t.length>10&&/[0-9](?:\s|\/)/.test(t)&&(i=t.match(/([0-9]+)/g).map(function(d){return parseFloat(d)}),s=t.match(/([a-z])/ig).join("").toLowerCase());else isNaN(t)?Array.isArray(t)||t.length?(i=[t[0],t[1],t[2]],s="rgb",r=t.length===4?t[3]:1):t instanceof Object&&(t.r!=null||t.red!=null||t.R!=null?(s="rgb",i=[t.r||t.red||t.R||0,t.g||t.green||t.G||0,t.b||t.blue||t.B||0]):(s="hsl",i=[t.h||t.hue||t.H||0,t.s||t.saturation||t.S||0,t.l||t.lightness||t.L||t.b||t.brightness]),r=t.a||t.alpha||t.opacity||1,t.opacity!=null&&(r/=100)):(s="rgb",i=[t>>>16,(t&65280)>>>8,t&255]);return{space:s,values:i,alpha:r}}var GT={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]},UT={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(t){var e=t[0]/360,i=t[1]/100,r=t[2]/100,s,n,o,a,l;if(i===0)return l=r*255,[l,l,l];r<.5?n=r*(1+i):n=r+i-r*i,s=2*r-n,a=[0,0,0];for(var u=0;u<3;u++)o=e+1/3*-(u-1),o<0?o++:o>1&&o--,6*o<1?l=s+(n-s)*6*o:2*o<1?l=n:3*o<2?l=s+(n-s)*(2/3-o)*6:l=s,a[u]=l*255;return a}};GT.hsl=function(t){var e=t[0]/255,i=t[1]/255,r=t[2]/255,s=Math.min(e,i,r),n=Math.max(e,i,r),o=n-s,a,l,u;return n===s?a=0:e===n?a=(i-r)/o:i===n?a=2+(r-e)/o:r===n&&(a=4+(e-i)/o),a=Math.min(a*60,360),a<0&&(a+=360),u=(s+n)/2,n===s?l=0:u<=.5?l=o/(n+s):l=o/(2-n-s),[a,l*100,u*100]};function Pq(t){Array.isArray(t)&&t.raw&&(t=String.raw(...arguments));var e,i=Mq(t);if(!i.space)return[];let r=i.space[0]==="h"?UT.min:GT.min,s=i.space[0]==="h"?UT.max:GT.max;return e=Array(3),e[0]=Math.min(Math.max(i.values[0],r[0]),s[0]),e[1]=Math.min(Math.max(i.values[1],r[1]),s[1]),e[2]=Math.min(Math.max(i.values[2],r[2]),s[2]),i.space[0]==="h"&&(e=UT.rgb(e)),e.push(Math.min(Math.max(i.alpha,0),1)),e}function NL(t){switch(typeof t){case"string":return Rq(t);case"number":return At.hex2rgb(t);default:return t}}function Rq(t){let e=Pq(t);if(!e)throw new Error(`Unable to parse color "${t}" as RGBA.`);return[e[0]/255,e[1]/255,e[2]/255,e[3]]}function Dq(t){let e=kq($q(t));if(e.length===0)throw new Error("Invalid CSS gradient.");if(e.length!==1)throw new Error("Unsupported CSS gradient (multiple gradients is not supported).");let i=e[0],r=Fq(i.type),s=Lq(i.colorStops),n=zq(i.orientation);return{type:r,stops:s,angle:n}}function Fq(t){let e={"linear-gradient":0,"radial-gradient":1};if(!(t in e))throw new Error(`Unsupported gradient type "${t}"`);return e[t]}function Lq(t){let e=Bq(t),i=[];for(let r=0;r<t.length;r++){let s=Nq(t[r]);i.push({offset:e[r],color:s.slice(0,3),alpha:s[3]})}return i}function Nq(t){return NL(Oq(t))}function Oq(t){switch(t.type){case"hex":return`#${t.value}`;case"literal":return t.value;default:return`${t.type}(${t.value.join(",")})`}}function Bq(t){let e=[];for(let s=0;s<t.length;s++){let n=t[s],o=-1;n.type==="literal"&&n.length&&"type"in n.length&&n.length.type==="%"&&"value"in n.length&&(o=parseFloat(n.length.value)/100),e.push(o)}let i=s=>{for(let n=s;n<e.length;n++)if(e[n]!==-1)return{indexDelta:n-s,offset:e[n]};return{indexDelta:e.length-1-s,offset:1}},r=0;for(let s=0;s<e.length;s++){let n=e[s];if(n!==-1)r=n;else if(s===0)e[s]=0;else if(s+1===e.length)e[s]=1;else{let o=i(s),a=(o.offset-r)/(1+o.indexDelta);for(let l=0;l<=o.indexDelta;l++)e[s+l]=r+(l+1)*a;s+=o.indexDelta,r=e[s]}}return e.map(Uq)}function Uq(t){return t.toString().length>6?parseFloat(t.toString().substring(0,6)):t}function zq(t){if(typeof t>"u")return 0;if("type"in t&&"value"in t)switch(t.type){case"angular":return parseFloat(t.value);case"directional":return Gq(t.value)}return 0}function Gq(t){let e={left:270,top:0,bottom:180,right:90,"left top":315,"top left":315,"left bottom":225,"bottom left":225,"right top":45,"top right":45,"right bottom":135,"bottom right":135};if(!(t in e))throw new Error(`Unsupported directional value "${t}"`);return e[t]}function $q(t){let e=t.replace(/\s{2,}/gu," ");return e=e.replace(/;/g,""),e=e.replace(/ ,/g,","),e=e.replace(/\( /g,"("),e=e.replace(/ \)/g,")"),e.trim()}var Hq=Object.defineProperty,Vq=Object.defineProperties,jq=Object.getOwnPropertyDescriptors,DL=Object.getOwnPropertySymbols,Xq=Object.prototype.hasOwnProperty,Wq=Object.prototype.propertyIsEnumerable,FL=(t,e,i)=>e in t?Hq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,zT=(t,e)=>{for(var i in e||(e={}))Xq.call(e,i)&&FL(t,i,e[i]);if(DL)for(var i of DL(e))Wq.call(e,i)&&FL(t,i,e[i]);return t},qq=(t,e)=>Vq(t,jq(e)),LL=90;function Yq(t){return[...t].sort((e,i)=>e.offset-i.offset)}var $T=class extends Wt{constructor(t){t&&"css"in t&&(t=qq(zT({},Dq(t.css||"")),{alpha:t.alpha,maxColors:t.maxColors}));let e=zT(zT({},$T.defaults),t);if(!e.stops||e.stops.length<2)throw new Error("ColorGradientFilter requires at least 2 color stops.");super(Iq,Cq),this._stops=[],this.autoFit=!1,Object.assign(this,e)}get stops(){return this._stops}set stops(t){let e=Yq(t),i=new Float32Array(e.length*3),r=0,s=1,n=2;for(let o=0;o<e.length;o++){let a=NL(e[o].color),l=o*3;i[l+r]=a[r],i[l+s]=a[s],i[l+n]=a[n]}this.uniforms.uColors=i,this.uniforms.uOffsets=e.map(o=>o.offset),this.uniforms.uAlphas=e.map(o=>o.alpha),this.uniforms.uNumStops=e.length,this._stops=e}set type(t){this.uniforms.uType=t}get type(){return this.uniforms.uType}set angle(t){this.uniforms.uAngle=t-LL}get angle(){return this.uniforms.uAngle+LL}set alpha(t){this.uniforms.uAlpha=t}get alpha(){return this.uniforms.uAlpha}set maxColors(t){this.uniforms.uMaxColors=t}get maxColors(){return this.uniforms.uMaxColors}},Cy=$T;Cy.LINEAR=0,Cy.RADIAL=1,Cy.CONIC=2,Cy.defaults={type:$T.LINEAR,stops:[{offset:0,color:16711680,alpha:1},{offset:1,color:255,alpha:1}],alpha:1,angle:90,maxColors:0};var Zq=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Qq=`precision mediump float;

varying mediump vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec2 texelSize;
uniform float matrix[9];

void main(void)
{
   vec4 c11 = texture2D(uSampler, vTextureCoord - texelSize); // top left
   vec4 c12 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - texelSize.y)); // top center
   vec4 c13 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y - texelSize.y)); // top right

   vec4 c21 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y)); // mid left
   vec4 c22 = texture2D(uSampler, vTextureCoord); // mid center
   vec4 c23 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y)); // mid right

   vec4 c31 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y + texelSize.y)); // bottom left
   vec4 c32 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + texelSize.y)); // bottom center
   vec4 c33 = texture2D(uSampler, vTextureCoord + texelSize); // bottom right

   gl_FragColor =
       c11 * matrix[0] + c12 * matrix[1] + c13 * matrix[2] +
       c21 * matrix[3] + c22 * matrix[4] + c23 * matrix[5] +
       c31 * matrix[6] + c32 * matrix[7] + c33 * matrix[8];

   gl_FragColor.a = c22.a;
}
`,Iy=class extends Wt{constructor(e,i=200,r=200){super(Zq,Qq),this.uniforms.texelSize=new Float32Array(2),this.uniforms.matrix=new Float32Array(9),e!==void 0&&(this.matrix=e),this.width=i,this.height=r}get matrix(){return this.uniforms.matrix}set matrix(e){e.forEach((i,r)=>{this.uniforms.matrix[r]=i})}get width(){return 1/this.uniforms.texelSize[0]}set width(e){this.uniforms.texelSize[0]=1/e}get height(){return 1/this.uniforms.texelSize[1]}set height(e){this.uniforms.texelSize[1]=1/e}};var Kq=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Jq=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec4 filterArea;
uniform vec2 dimensions;

const float SQRT_2 = 1.414213;

const float light = 1.0;

uniform float curvature;
uniform float lineWidth;
uniform float lineContrast;
uniform bool verticalLine;
uniform float noise;
uniform float noiseSize;

uniform float vignetting;
uniform float vignettingAlpha;
uniform float vignettingBlur;

uniform float seed;
uniform float time;

float rand(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main(void)
{
    vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;
    vec2 dir = vec2(vTextureCoord.xy * filterArea.xy / dimensions - vec2(0.5, 0.5));
    
    gl_FragColor = texture2D(uSampler, vTextureCoord);
    vec3 rgb = gl_FragColor.rgb;

    if (noise > 0.0 && noiseSize > 0.0)
    {
        pixelCoord.x = floor(pixelCoord.x / noiseSize);
        pixelCoord.y = floor(pixelCoord.y / noiseSize);
        float _noise = rand(pixelCoord * noiseSize * seed) - 0.5;
        rgb += _noise * noise;
    }

    if (lineWidth > 0.0)
    {
        float _c = curvature > 0. ? curvature : 1.;
        float k = curvature > 0. ?(length(dir * dir) * 0.25 * _c * _c + 0.935 * _c) : 1.;
        vec2 uv = dir * k;

        float v = (verticalLine ? uv.x * dimensions.x : uv.y * dimensions.y) * min(1.0, 2.0 / lineWidth ) / _c;
        float j = 1. + cos(v * 1.2 - time) * 0.5 * lineContrast;
        rgb *= j;
        float segment = verticalLine ? mod((dir.x + .5) * dimensions.x, 4.) : mod((dir.y + .5) * dimensions.y, 4.);
        rgb *= 0.99 + ceil(segment) * 0.015;
    }

    if (vignetting > 0.0)
    {
        float outter = SQRT_2 - vignetting * SQRT_2;
        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignettingBlur * SQRT_2), 0.0, 1.0);
        rgb *= darker + (1.0 - darker) * (1.0 - vignettingAlpha);
    }

    gl_FragColor.rgb = rgb;
}
`,OL=class extends Wt{constructor(t){super(Kq,Jq),this.time=0,this.seed=0,this.uniforms.dimensions=new Float32Array(2),Object.assign(this,OL.defaults,t)}apply(t,e,i,r){let{width:s,height:n}=e.filterFrame;this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,this.uniforms.seed=this.seed,this.uniforms.time=this.time,t.applyFilter(this,e,i,r)}set curvature(t){this.uniforms.curvature=t}get curvature(){return this.uniforms.curvature}set lineWidth(t){this.uniforms.lineWidth=t}get lineWidth(){return this.uniforms.lineWidth}set lineContrast(t){this.uniforms.lineContrast=t}get lineContrast(){return this.uniforms.lineContrast}set verticalLine(t){this.uniforms.verticalLine=t}get verticalLine(){return this.uniforms.verticalLine}set noise(t){this.uniforms.noise=t}get noise(){return this.uniforms.noise}set noiseSize(t){this.uniforms.noiseSize=t}get noiseSize(){return this.uniforms.noiseSize}set vignetting(t){this.uniforms.vignetting=t}get vignetting(){return this.uniforms.vignetting}set vignettingAlpha(t){this.uniforms.vignettingAlpha=t}get vignettingAlpha(){return this.uniforms.vignettingAlpha}set vignettingBlur(t){this.uniforms.vignettingBlur=t}get vignettingBlur(){return this.uniforms.vignettingBlur}},eY=OL;eY.defaults={curvature:1,lineWidth:1,lineContrast:.25,verticalLine:!1,noise:0,noiseSize:1,seed:0,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3,time:0};var tY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,iY=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float alpha;
uniform vec3 color;

uniform vec2 shift;
uniform vec4 inputSize;

void main(void){
    vec4 sample = texture2D(uSampler, vTextureCoord - shift * inputSize.zw);

    // Premultiply alpha
    sample.rgb = color.rgb * sample.a;

    // alpha user alpha
    sample *= alpha;

    gl_FragColor = sample;
}`,rY=Object.defineProperty,BL=Object.getOwnPropertySymbols,sY=Object.prototype.hasOwnProperty,nY=Object.prototype.propertyIsEnumerable,UL=(t,e,i)=>e in t?rY(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,zL=(t,e)=>{for(var i in e||(e={}))sY.call(e,i)&&UL(t,i,e[i]);if(BL)for(var i of BL(e))nY.call(e,i)&&UL(t,i,e[i]);return t},HT=class extends Wt{constructor(t){super(),this.angle=45,this._distance=5,this._resolution=ut.FILTER_RESOLUTION;let e=t?zL(zL({},HT.defaults),t):HT.defaults,{kernels:i,blur:r,quality:s,pixelSize:n,resolution:o}=e;this._offset=new Yo(this._updatePadding,this),this._tintFilter=new Wt(tY,iY),this._tintFilter.uniforms.color=new Float32Array(4),this._tintFilter.uniforms.shift=this._offset,this._tintFilter.resolution=o,this._blurFilter=i?new oh(i):new oh(r,s),this.pixelSize=n,this.resolution=o;let{shadowOnly:a,rotation:l,distance:u,offset:d,alpha:m,color:g}=e;this.shadowOnly=a,l!==void 0&&u!==void 0?(this.rotation=l,this.distance=u):this.offset=d,this.alpha=m,this.color=g}apply(t,e,i,r){let s=t.getFilterTexture();this._tintFilter.apply(t,e,s,1),this._blurFilter.apply(t,s,i,r),this.shadowOnly!==!0&&t.applyFilter(this,e,i,0),t.returnFilterTexture(s)}_updatePadding(){let t=Math.max(Math.abs(this._offset.x),Math.abs(this._offset.y));this.padding=t+this.blur*2}_updateShift(){this._tintFilter.uniforms.shift.set(this.distance*Math.cos(this.angle),this.distance*Math.sin(this.angle))}set offset(t){this._offset.copyFrom(t),this._updatePadding()}get offset(){return this._offset}get resolution(){return this._resolution}set resolution(t){this._resolution=t,this._tintFilter&&(this._tintFilter.resolution=t),this._blurFilter&&(this._blurFilter.resolution=t)}get distance(){return this._distance}set distance(t){At.deprecation("5.3.0","DropShadowFilter distance is deprecated, use offset"),this._distance=t,this._updatePadding(),this._updateShift()}get rotation(){return this.angle/Jl}set rotation(t){At.deprecation("5.3.0","DropShadowFilter rotation is deprecated, use offset"),this.angle=t*Jl,this._updateShift()}get alpha(){return this._tintFilter.uniforms.alpha}set alpha(t){this._tintFilter.uniforms.alpha=t}get color(){return At.rgb2hex(this._tintFilter.uniforms.color)}set color(t){At.hex2rgb(t,this._tintFilter.uniforms.color)}get kernels(){return this._blurFilter.kernels}set kernels(t){this._blurFilter.kernels=t}get blur(){return this._blurFilter.blur}set blur(t){this._blurFilter.blur=t,this._updatePadding()}get quality(){return this._blurFilter.quality}set quality(t){this._blurFilter.quality=t}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(t){this._blurFilter.pixelSize=t}},oY=HT;oY.defaults={offset:{x:4,y:4},color:0,alpha:.5,shadowOnly:!1,kernels:null,blur:2,quality:3,pixelSize:1,resolution:ut.FILTER_RESOLUTION};var aY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,lY=`// precision highp float;

varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec2 dimensions;
uniform float aspect;

uniform sampler2D displacementMap;
uniform float offset;
uniform float sinDir;
uniform float cosDir;
uniform int fillMode;

uniform float seed;
uniform vec2 red;
uniform vec2 green;
uniform vec2 blue;

const int TRANSPARENT = 0;
const int ORIGINAL = 1;
const int LOOP = 2;
const int CLAMP = 3;
const int MIRROR = 4;

void main(void)
{
    vec2 coord = (vTextureCoord * filterArea.xy) / dimensions;

    if (coord.x > 1.0 || coord.y > 1.0) {
        return;
    }

    float cx = coord.x - 0.5;
    float cy = (coord.y - 0.5) * aspect;
    float ny = (-sinDir * cx + cosDir * cy) / aspect + 0.5;

    // displacementMap: repeat
    // ny = ny > 1.0 ? ny - 1.0 : (ny < 0.0 ? 1.0 + ny : ny);

    // displacementMap: mirror
    ny = ny > 1.0 ? 2.0 - ny : (ny < 0.0 ? -ny : ny);

    vec4 dc = texture2D(displacementMap, vec2(0.5, ny));

    float displacement = (dc.r - dc.g) * (offset / filterArea.x);

    coord = vTextureCoord + vec2(cosDir * displacement, sinDir * displacement * aspect);

    if (fillMode == CLAMP) {
        coord = clamp(coord, filterClamp.xy, filterClamp.zw);
    } else {
        if( coord.x > filterClamp.z ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.x -= filterClamp.z;
            } else if (fillMode == MIRROR) {
                coord.x = filterClamp.z * 2.0 - coord.x;
            }
        } else if( coord.x < filterClamp.x ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.x += filterClamp.z;
            } else if (fillMode == MIRROR) {
                coord.x *= -filterClamp.z;
            }
        }

        if( coord.y > filterClamp.w ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.y -= filterClamp.w;
            } else if (fillMode == MIRROR) {
                coord.y = filterClamp.w * 2.0 - coord.y;
            }
        } else if( coord.y < filterClamp.y ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.y += filterClamp.w;
            } else if (fillMode == MIRROR) {
                coord.y *= -filterClamp.w;
            }
        }
    }

    gl_FragColor.r = texture2D(uSampler, coord + red * (1.0 - seed * 0.4) / filterArea.xy).r;
    gl_FragColor.g = texture2D(uSampler, coord + green * (1.0 - seed * 0.3) / filterArea.xy).g;
    gl_FragColor.b = texture2D(uSampler, coord + blue * (1.0 - seed * 0.2) / filterArea.xy).b;
    gl_FragColor.a = texture2D(uSampler, coord).a;
}
`,VT=class extends Wt{constructor(t){super(aY,lY),this.offset=100,this.fillMode=VT.TRANSPARENT,this.average=!1,this.seed=0,this.minSize=8,this.sampleSize=512,this._slices=0,this._offsets=new Float32Array(1),this._sizes=new Float32Array(1),this._direction=-1,this.uniforms.dimensions=new Float32Array(2),this._canvas=document.createElement("canvas"),this._canvas.width=4,this._canvas.height=this.sampleSize,this.texture=qt.from(this._canvas,{scaleMode:Qn.NEAREST}),Object.assign(this,VT.defaults,t)}apply(t,e,i,r){let{width:s,height:n}=e.filterFrame;this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,this.uniforms.aspect=n/s,this.uniforms.seed=this.seed,this.uniforms.offset=this.offset,this.uniforms.fillMode=this.fillMode,t.applyFilter(this,e,i,r)}_randomizeSizes(){let t=this._sizes,e=this._slices-1,i=this.sampleSize,r=Math.min(this.minSize/i,.9/this._slices);if(this.average){let s=this._slices,n=1;for(let o=0;o<e;o++){let a=n/(s-o),l=Math.max(a*(1-Math.random()*.6),r);t[o]=l,n-=l}t[e]=n}else{let s=1,n=Math.sqrt(1/this._slices);for(let o=0;o<e;o++){let a=Math.max(n*s*Math.random(),r);t[o]=a,s-=a}t[e]=s}this.shuffle()}shuffle(){let t=this._sizes,e=this._slices-1;for(let i=e;i>0;i--){let r=Math.random()*i>>0,s=t[i];t[i]=t[r],t[r]=s}}_randomizeOffsets(){for(let t=0;t<this._slices;t++)this._offsets[t]=Math.random()*(Math.random()<.5?-1:1)}refresh(){this._randomizeSizes(),this._randomizeOffsets(),this.redraw()}redraw(){let t=this.sampleSize,e=this.texture,i=this._canvas.getContext("2d");i.clearRect(0,0,8,t);let r,s=0;for(let n=0;n<this._slices;n++){r=Math.floor(this._offsets[n]*256);let o=this._sizes[n]*t,a=r>0?r:0,l=r<0?-r:0;i.fillStyle=`rgba(${a}, ${l}, 0, 1)`,i.fillRect(0,s>>0,t,o+1>>0),s+=o}e.baseTexture.update(),this.uniforms.displacementMap=e}set sizes(t){let e=Math.min(this._slices,t.length);for(let i=0;i<e;i++)this._sizes[i]=t[i]}get sizes(){return this._sizes}set offsets(t){let e=Math.min(this._slices,t.length);for(let i=0;i<e;i++)this._offsets[i]=t[i]}get offsets(){return this._offsets}get slices(){return this._slices}set slices(t){this._slices!==t&&(this._slices=t,this.uniforms.slices=t,this._sizes=this.uniforms.slicesWidth=new Float32Array(t),this._offsets=this.uniforms.slicesOffset=new Float32Array(t),this.refresh())}get direction(){return this._direction}set direction(t){if(this._direction===t)return;this._direction=t;let e=t*Jl;this.uniforms.sinDir=Math.sin(e),this.uniforms.cosDir=Math.cos(e)}get red(){return this.uniforms.red}set red(t){this.uniforms.red=t}get green(){return this.uniforms.green}set green(t){this.uniforms.green=t}get blue(){return this.uniforms.blue}set blue(t){this.uniforms.blue=t}destroy(){var t;(t=this.texture)==null||t.destroy(!0),this.texture=this._canvas=this.red=this.green=this.blue=this._sizes=this._offsets=null}},D4=VT;D4.defaults={slices:5,offset:100,direction:0,fillMode:0,average:!1,seed:0,red:[0,0],green:[0,0],blue:[0,0],minSize:8,sampleSize:512},D4.TRANSPARENT=0,D4.ORIGINAL=1,D4.LOOP=2,D4.CLAMP=3,D4.MIRROR=4;var cY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,uY=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

uniform float outerStrength;
uniform float innerStrength;

uniform vec4 glowColor;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform bool knockout;
uniform float alpha;

const float PI = 3.14159265358979323846264;

const float DIST = __DIST__;
const float ANGLE_STEP_SIZE = min(__ANGLE_STEP_SIZE__, PI * 2.0);
const float ANGLE_STEP_NUM = ceil(PI * 2.0 / ANGLE_STEP_SIZE);

const float MAX_TOTAL_ALPHA = ANGLE_STEP_NUM * DIST * (DIST + 1.0) / 2.0;

void main(void) {
    vec2 px = vec2(1.0 / filterArea.x, 1.0 / filterArea.y);

    float totalAlpha = 0.0;

    vec2 direction;
    vec2 displaced;
    vec4 curColor;

    for (float angle = 0.0; angle < PI * 2.0; angle += ANGLE_STEP_SIZE) {
       direction = vec2(cos(angle), sin(angle)) * px;

       for (float curDistance = 0.0; curDistance < DIST; curDistance++) {
           displaced = clamp(vTextureCoord + direction * 
                   (curDistance + 1.0), filterClamp.xy, filterClamp.zw);

           curColor = texture2D(uSampler, displaced);

           totalAlpha += (DIST - curDistance) * curColor.a;
       }
    }
    
    curColor = texture2D(uSampler, vTextureCoord);

    float alphaRatio = (totalAlpha / MAX_TOTAL_ALPHA);

    float innerGlowAlpha = (1.0 - alphaRatio) * innerStrength * curColor.a;
    float innerGlowStrength = min(1.0, innerGlowAlpha);
    
    vec4 innerColor = mix(curColor, glowColor, innerGlowStrength);

    float outerGlowAlpha = alphaRatio * outerStrength * (1. - curColor.a);
    float outerGlowStrength = min(1.0 - innerColor.a, outerGlowAlpha);

    if (knockout) {
      float resultAlpha = (outerGlowAlpha + innerGlowAlpha) * alpha;
      gl_FragColor = vec4(glowColor.rgb * resultAlpha, resultAlpha);
    }
    else {
      vec4 outerGlowColor = outerGlowStrength * glowColor.rgba * alpha;
      gl_FragColor = innerColor + outerGlowColor;
    }
}
`,GL=class extends Wt{constructor(t){let e=Object.assign({},GL.defaults,t),{outerStrength:i,innerStrength:r,color:s,knockout:n,quality:o,alpha:a}=e,l=Math.round(e.distance);super(cY,uY.replace(/__ANGLE_STEP_SIZE__/gi,`${(1/o/l).toFixed(7)}`).replace(/__DIST__/gi,`${l.toFixed(0)}.0`)),this.uniforms.glowColor=new Float32Array([0,0,0,1]),this.uniforms.alpha=1,Object.assign(this,{color:s,outerStrength:i,innerStrength:r,padding:l,knockout:n,alpha:a})}get color(){return At.rgb2hex(this.uniforms.glowColor)}set color(t){At.hex2rgb(t,this.uniforms.glowColor)}get outerStrength(){return this.uniforms.outerStrength}set outerStrength(t){this.uniforms.outerStrength=t}get innerStrength(){return this.uniforms.innerStrength}set innerStrength(t){this.uniforms.innerStrength=t}get knockout(){return this.uniforms.knockout}set knockout(t){this.uniforms.knockout=t}get alpha(){return this.uniforms.alpha}set alpha(t){this.uniforms.alpha=t}},qc=GL;qc.defaults={distance:10,outerStrength:4,innerStrength:0,color:16777215,quality:.1,knockout:!1,alpha:1};var hY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,dY=`vec3 mod289(vec3 x)
{
    return x - floor(x * (1.0 / 289.0)) * 289.0;
}
vec4 mod289(vec4 x)
{
    return x - floor(x * (1.0 / 289.0)) * 289.0;
}
vec4 permute(vec4 x)
{
    return mod289(((x * 34.0) + 1.0) * x);
}
vec4 taylorInvSqrt(vec4 r)
{
    return 1.79284291400159 - 0.85373472095314 * r;
}
vec3 fade(vec3 t)
{
    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);
}
// Classic Perlin noise, periodic variant
float pnoise(vec3 P, vec3 rep)
{
    vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period
    vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period
    Pi0 = mod289(Pi0);
    Pi1 = mod289(Pi1);
    vec3 Pf0 = fract(P); // Fractional part for interpolation
    vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
    vec4 iy = vec4(Pi0.yy, Pi1.yy);
    vec4 iz0 = Pi0.zzzz;
    vec4 iz1 = Pi1.zzzz;
    vec4 ixy = permute(permute(ix) + iy);
    vec4 ixy0 = permute(ixy + iz0);
    vec4 ixy1 = permute(ixy + iz1);
    vec4 gx0 = ixy0 * (1.0 / 7.0);
    vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
    gx0 = fract(gx0);
    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
    vec4 sz0 = step(gz0, vec4(0.0));
    gx0 -= sz0 * (step(0.0, gx0) - 0.5);
    gy0 -= sz0 * (step(0.0, gy0) - 0.5);
    vec4 gx1 = ixy1 * (1.0 / 7.0);
    vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
    gx1 = fract(gx1);
    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
    vec4 sz1 = step(gz1, vec4(0.0));
    gx1 -= sz1 * (step(0.0, gx1) - 0.5);
    gy1 -= sz1 * (step(0.0, gy1) - 0.5);
    vec3 g000 = vec3(gx0.x, gy0.x, gz0.x);
    vec3 g100 = vec3(gx0.y, gy0.y, gz0.y);
    vec3 g010 = vec3(gx0.z, gy0.z, gz0.z);
    vec3 g110 = vec3(gx0.w, gy0.w, gz0.w);
    vec3 g001 = vec3(gx1.x, gy1.x, gz1.x);
    vec3 g101 = vec3(gx1.y, gy1.y, gz1.y);
    vec3 g011 = vec3(gx1.z, gy1.z, gz1.z);
    vec3 g111 = vec3(gx1.w, gy1.w, gz1.w);
    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
    g000 *= norm0.x;
    g010 *= norm0.y;
    g100 *= norm0.z;
    g110 *= norm0.w;
    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
    g001 *= norm1.x;
    g011 *= norm1.y;
    g101 *= norm1.z;
    g111 *= norm1.w;
    float n000 = dot(g000, Pf0);
    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
    float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
    float n111 = dot(g111, Pf1);
    vec3 fade_xyz = fade(Pf0);
    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);
    return 2.2 * n_xyz;
}
float turb(vec3 P, vec3 rep, float lacunarity, float gain)
{
    float sum = 0.0;
    float sc = 1.0;
    float totalgain = 1.0;
    for (float i = 0.0; i < 6.0; i++)
    {
        sum += totalgain * pnoise(P * sc, rep);
        sc *= lacunarity;
        totalgain *= gain;
    }
    return abs(sum);
}
`,fY=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterArea;
uniform vec2 dimensions;

uniform vec2 light;
uniform bool parallel;
uniform float aspect;

uniform float gain;
uniform float lacunarity;
uniform float time;
uniform float alpha;

\${perlin}

void main(void) {
    vec2 coord = vTextureCoord * filterArea.xy / dimensions.xy;

    float d;

    if (parallel) {
        float _cos = light.x;
        float _sin = light.y;
        d = (_cos * coord.x) + (_sin * coord.y * aspect);
    } else {
        float dx = coord.x - light.x / dimensions.x;
        float dy = (coord.y - light.y / dimensions.y) * aspect;
        float dis = sqrt(dx * dx + dy * dy) + 0.00001;
        d = dy / dis;
    }

    vec3 dir = vec3(d, d, 0.0);

    float noise = turb(dir + vec3(time, 0.0, 62.1 + time) * 0.05, vec3(480.0, 320.0, 480.0), lacunarity, gain);
    noise = mix(noise, 0.0, 0.3);
    //fade vertically.
    vec4 mist = vec4(noise, noise, noise, 1.0) * (1.0 - coord.y);
    mist.a = 1.0;
    // apply user alpha
    mist *= alpha;

    gl_FragColor = texture2D(uSampler, vTextureCoord) + mist;

}
`,$L=class extends Wt{constructor(t){super(hY,fY.replace("${perlin}",dY)),this.parallel=!0,this.time=0,this._angle=0,this.uniforms.dimensions=new Float32Array(2);let e=Object.assign($L.defaults,t);this._angleLight=new Jt,this.angle=e.angle,this.gain=e.gain,this.lacunarity=e.lacunarity,this.alpha=e.alpha,this.parallel=e.parallel,this.center=e.center,this.time=e.time}apply(t,e,i,r){let{width:s,height:n}=e.filterFrame;this.uniforms.light=this.parallel?this._angleLight:this.center,this.uniforms.parallel=this.parallel,this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,this.uniforms.aspect=n/s,this.uniforms.time=this.time,this.uniforms.alpha=this.alpha,t.applyFilter(this,e,i,r)}get angle(){return this._angle}set angle(t){this._angle=t;let e=t*Jl;this._angleLight.x=Math.cos(e),this._angleLight.y=Math.sin(e)}get gain(){return this.uniforms.gain}set gain(t){this.uniforms.gain=t}get lacunarity(){return this.uniforms.lacunarity}set lacunarity(t){this.uniforms.lacunarity=t}get alpha(){return this.uniforms.alpha}set alpha(t){this.uniforms.alpha=t}},pY=$L;pY.defaults={angle:30,gain:.5,lacunarity:2.5,time:0,parallel:!0,center:[0,0],alpha:1};var mY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,gY=`precision mediump float;

varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float uHue;
uniform float uAlpha;
uniform bool uColorize;
uniform float uSaturation;
uniform float uLightness;

// https://en.wikipedia.org/wiki/Luma_(video)
const vec3 weight = vec3(0.299, 0.587, 0.114);

float getWeightedAverage(vec3 rgb) {
    return rgb.r * weight.r + rgb.g * weight.g + rgb.b * weight.b;
}

// https://gist.github.com/mairod/a75e7b44f68110e1576d77419d608786?permalink_comment_id=3195243#gistcomment-3195243
const vec3 k = vec3(0.57735, 0.57735, 0.57735);

vec3 hueShift(vec3 color, float angle) {
    float cosAngle = cos(angle);
    return vec3(
    color * cosAngle +
    cross(k, color) * sin(angle) +
    k * dot(k, color) * (1.0 - cosAngle)
    );
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    vec4 result = color;

    // colorize
    if (uColorize) {
        result.rgb = vec3(getWeightedAverage(result.rgb), 0., 0.);
    }

    // hue
    result.rgb = hueShift(result.rgb, uHue);

    // saturation
    // https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/huesaturation.js
    float average = (result.r + result.g + result.b) / 3.0;

    if (uSaturation > 0.) {
        result.rgb += (average - result.rgb) * (1. - 1. / (1.001 - uSaturation));
    } else {
        result.rgb -= (average - result.rgb) * uSaturation;
    }

    // lightness
    result.rgb = mix(result.rgb, vec3(ceil(uLightness)) * color.a, abs(uLightness));

    // alpha
    gl_FragColor = mix(color, result, uAlpha);
}
`,HL=class extends Wt{constructor(t){super(mY,gY),this._hue=0;let e=Object.assign({},HL.defaults,t);Object.assign(this,e)}get hue(){return this._hue}set hue(t){this._hue=t,this.uniforms.uHue=this._hue*(Math.PI/180)}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}get colorize(){return this.uniforms.uColorize}set colorize(t){this.uniforms.uColorize=t}get lightness(){return this.uniforms.uLightness}set lightness(t){this.uniforms.uLightness=t}get saturation(){return this.uniforms.uSaturation}set saturation(t){this.uniforms.uSaturation=t}},yY=HL;yY.defaults={hue:0,saturation:0,lightness:0,colorize:!1,alpha:1};var _Y=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,xY=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterArea;
uniform vec2 dimensions;

uniform float sepia;
uniform float noise;
uniform float noiseSize;
uniform float scratch;
uniform float scratchDensity;
uniform float scratchWidth;
uniform float vignetting;
uniform float vignettingAlpha;
uniform float vignettingBlur;
uniform float seed;

const float SQRT_2 = 1.414213;
const vec3 SEPIA_RGB = vec3(112.0 / 255.0, 66.0 / 255.0, 20.0 / 255.0);

float rand(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

vec3 Overlay(vec3 src, vec3 dst)
{
    // if (dst <= 0.5) then: 2 * src * dst
    // if (dst > 0.5) then: 1 - 2 * (1 - dst) * (1 - src)
    return vec3((dst.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)),
                (dst.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)),
                (dst.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)));
}


void main()
{
    gl_FragColor = texture2D(uSampler, vTextureCoord);
    vec3 color = gl_FragColor.rgb;

    if (sepia > 0.0)
    {
        float gray = (color.x + color.y + color.z) / 3.0;
        vec3 grayscale = vec3(gray);

        color = Overlay(SEPIA_RGB, grayscale);

        color = grayscale + sepia * (color - grayscale);
    }

    vec2 coord = vTextureCoord * filterArea.xy / dimensions.xy;

    if (vignetting > 0.0)
    {
        float outter = SQRT_2 - vignetting * SQRT_2;
        vec2 dir = vec2(vec2(0.5, 0.5) - coord);
        dir.y *= dimensions.y / dimensions.x;
        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignettingBlur * SQRT_2), 0.0, 1.0);
        color.rgb *= darker + (1.0 - darker) * (1.0 - vignettingAlpha);
    }

    if (scratchDensity > seed && scratch != 0.0)
    {
        float phase = seed * 256.0;
        float s = mod(floor(phase), 2.0);
        float dist = 1.0 / scratchDensity;
        float d = distance(coord, vec2(seed * dist, abs(s - seed * dist)));
        if (d < seed * 0.6 + 0.4)
        {
            highp float period = scratchDensity * 10.0;

            float xx = coord.x * period + phase;
            float aa = abs(mod(xx, 0.5) * 4.0);
            float bb = mod(floor(xx / 0.5), 2.0);
            float yy = (1.0 - bb) * aa + bb * (2.0 - aa);

            float kk = 2.0 * period;
            float dw = scratchWidth / dimensions.x * (0.75 + seed);
            float dh = dw * kk;

            float tine = (yy - (2.0 - dh));

            if (tine > 0.0) {
                float _sign = sign(scratch);

                tine = s * tine / period + scratch + 0.1;
                tine = clamp(tine + 1.0, 0.5 + _sign * 0.5, 1.5 + _sign * 0.5);

                color.rgb *= tine;
            }
        }
    }

    if (noise > 0.0 && noiseSize > 0.0)
    {
        vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;
        pixelCoord.x = floor(pixelCoord.x / noiseSize);
        pixelCoord.y = floor(pixelCoord.y / noiseSize);
        // vec2 d = pixelCoord * noiseSize * vec2(1024.0 + seed * 512.0, 1024.0 - seed * 512.0);
        // float _noise = snoise(d) * 0.5;
        float _noise = rand(pixelCoord * noiseSize * seed) - 0.5;
        color += _noise * noise;
    }

    gl_FragColor.rgb = color;
}
`,VL=class extends Wt{constructor(t,e=0){super(_Y,xY),this.seed=0,this.uniforms.dimensions=new Float32Array(2),typeof t=="number"?(this.seed=t,t=void 0):this.seed=e,Object.assign(this,VL.defaults,t)}apply(t,e,i,r){var s,n;this.uniforms.dimensions[0]=(s=e.filterFrame)==null?void 0:s.width,this.uniforms.dimensions[1]=(n=e.filterFrame)==null?void 0:n.height,this.uniforms.seed=this.seed,t.applyFilter(this,e,i,r)}set sepia(t){this.uniforms.sepia=t}get sepia(){return this.uniforms.sepia}set noise(t){this.uniforms.noise=t}get noise(){return this.uniforms.noise}set noiseSize(t){this.uniforms.noiseSize=t}get noiseSize(){return this.uniforms.noiseSize}set scratch(t){this.uniforms.scratch=t}get scratch(){return this.uniforms.scratch}set scratchDensity(t){this.uniforms.scratchDensity=t}get scratchDensity(){return this.uniforms.scratchDensity}set scratchWidth(t){this.uniforms.scratchWidth=t}get scratchWidth(){return this.uniforms.scratchWidth}set vignetting(t){this.uniforms.vignetting=t}get vignetting(){return this.uniforms.vignetting}set vignettingAlpha(t){this.uniforms.vignettingAlpha=t}get vignettingAlpha(){return this.uniforms.vignettingAlpha}set vignettingBlur(t){this.uniforms.vignettingBlur=t}get vignettingBlur(){return this.uniforms.vignettingBlur}},vY=VL;vY.defaults={sepia:.3,noise:.3,noiseSize:1,scratch:.5,scratchDensity:.3,scratchWidth:1,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3};var bY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,wY=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterClamp;

uniform float uAlpha;
uniform vec2 uThickness;
uniform vec4 uColor;
uniform bool uKnockout;

const float DOUBLE_PI = 2. * 3.14159265358979323846264;
const float ANGLE_STEP = \${angleStep};

float outlineMaxAlphaAtPos(vec2 pos) {
    if (uThickness.x == 0. || uThickness.y == 0.) {
        return 0.;
    }

    vec4 displacedColor;
    vec2 displacedPos;
    float maxAlpha = 0.;

    for (float angle = 0.; angle <= DOUBLE_PI; angle += ANGLE_STEP) {
        displacedPos.x = vTextureCoord.x + uThickness.x * cos(angle);
        displacedPos.y = vTextureCoord.y + uThickness.y * sin(angle);
        displacedColor = texture2D(uSampler, clamp(displacedPos, filterClamp.xy, filterClamp.zw));
        maxAlpha = max(maxAlpha, displacedColor.a);
    }

    return maxAlpha;
}

void main(void) {
    vec4 sourceColor = texture2D(uSampler, vTextureCoord);
    vec4 contentColor = sourceColor * float(!uKnockout);
    float outlineAlpha = uAlpha * outlineMaxAlphaAtPos(vTextureCoord.xy) * (1.-sourceColor.a);
    vec4 outlineColor = vec4(vec3(uColor) * outlineAlpha, outlineAlpha);
    gl_FragColor = contentColor + outlineColor;
}
`,ky=class extends Wt{constructor(t=1,e=0,i=.1,r=1,s=!1){super(bY,wY.replace(/\$\{angleStep\}/,ky.getAngleStep(i))),this._thickness=1,this._alpha=1,this._knockout=!1,this.uniforms.uThickness=new Float32Array([0,0]),this.uniforms.uColor=new Float32Array([0,0,0,1]),this.uniforms.uAlpha=r,this.uniforms.uKnockout=s,Object.assign(this,{thickness:t,color:e,quality:i,alpha:r,knockout:s})}static getAngleStep(t){let e=Math.max(t*ky.MAX_SAMPLES,ky.MIN_SAMPLES);return(Math.PI*2/e).toFixed(7)}apply(t,e,i,r){this.uniforms.uThickness[0]=this._thickness/e._frame.width,this.uniforms.uThickness[1]=this._thickness/e._frame.height,this.uniforms.uAlpha=this._alpha,this.uniforms.uKnockout=this._knockout,t.applyFilter(this,e,i,r)}get alpha(){return this._alpha}set alpha(t){this._alpha=t}get color(){return At.rgb2hex(this.uniforms.uColor)}set color(t){At.hex2rgb(t,this.uniforms.uColor)}get knockout(){return this._knockout}set knockout(t){this._knockout=t}get thickness(){return this._thickness}set thickness(t){this._thickness=t,this.padding=t}},jL=ky;jL.MIN_SAMPLES=1,jL.MAX_SAMPLES=100;var EY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,TY=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec2 dimensions;

uniform bool mirror;
uniform float boundary;
uniform vec2 amplitude;
uniform vec2 waveLength;
uniform vec2 alpha;
uniform float time;

float rand(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main(void)
{
    vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;
    vec2 coord = pixelCoord / dimensions;

    if (coord.y < boundary) {
        gl_FragColor = texture2D(uSampler, vTextureCoord);
        return;
    }

    float k = (coord.y - boundary) / (1. - boundary + 0.0001);
    float areaY = boundary * dimensions.y / filterArea.y;
    float v = areaY + areaY - vTextureCoord.y;
    float y = mirror ? v : vTextureCoord.y;

    float _amplitude = ((amplitude.y - amplitude.x) * k + amplitude.x ) / filterArea.x;
    float _waveLength = ((waveLength.y - waveLength.x) * k + waveLength.x) / filterArea.y;
    float _alpha = (alpha.y - alpha.x) * k + alpha.x;

    float x = vTextureCoord.x + cos(v * 6.28 / _waveLength - time) * _amplitude;
    x = clamp(x, filterClamp.x, filterClamp.z);

    vec4 color = texture2D(uSampler, vec2(x, y));

    gl_FragColor = color * _alpha;
}
`,XL=class extends Wt{constructor(t){super(EY,TY),this.time=0,this.uniforms.amplitude=new Float32Array(2),this.uniforms.waveLength=new Float32Array(2),this.uniforms.alpha=new Float32Array(2),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,XL.defaults,t)}apply(t,e,i,r){var s,n;this.uniforms.dimensions[0]=(s=e.filterFrame)==null?void 0:s.width,this.uniforms.dimensions[1]=(n=e.filterFrame)==null?void 0:n.height,this.uniforms.time=this.time,t.applyFilter(this,e,i,r)}set mirror(t){this.uniforms.mirror=t}get mirror(){return this.uniforms.mirror}set boundary(t){this.uniforms.boundary=t}get boundary(){return this.uniforms.boundary}set amplitude(t){this.uniforms.amplitude[0]=t[0],this.uniforms.amplitude[1]=t[1]}get amplitude(){return this.uniforms.amplitude}set waveLength(t){this.uniforms.waveLength[0]=t[0],this.uniforms.waveLength[1]=t[1]}get waveLength(){return this.uniforms.waveLength}set alpha(t){this.uniforms.alpha[0]=t[0],this.uniforms.alpha[1]=t[1]}get alpha(){return this.uniforms.alpha}},SY=XL;SY.defaults={mirror:!0,boundary:.5,amplitude:[0,20],waveLength:[30,100],alpha:[1,1],time:0};var AY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,CY=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterArea;
uniform vec4 filterClamp;

uniform vec2 center;

uniform float amplitude;
uniform float wavelength;
// uniform float power;
uniform float brightness;
uniform float speed;
uniform float radius;

uniform float time;

const float PI = 3.14159;

void main()
{
    float halfWavelength = wavelength * 0.5 / filterArea.x;
    float maxRadius = radius / filterArea.x;
    float currentRadius = time * speed / filterArea.x;

    float fade = 1.0;

    if (maxRadius > 0.0) {
        if (currentRadius > maxRadius) {
            gl_FragColor = texture2D(uSampler, vTextureCoord);
            return;
        }
        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);
    }

    vec2 dir = vec2(vTextureCoord - center / filterArea.xy);
    dir.y *= filterArea.y / filterArea.x;
    float dist = length(dir);

    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {
        gl_FragColor = texture2D(uSampler, vTextureCoord);
        return;
    }

    vec2 diffUV = normalize(dir);

    float diff = (dist - currentRadius) / halfWavelength;

    float p = 1.0 - pow(abs(diff), 2.0);

    // float powDiff = diff * pow(p, 2.0) * ( amplitude * fade );
    float powDiff = 1.25 * sin(diff * PI) * p * ( amplitude * fade );

    vec2 offset = diffUV * powDiff / filterArea.xy;

    // Do clamp :
    vec2 coord = vTextureCoord + offset;
    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);
    vec4 color = texture2D(uSampler, clampedCoord);
    if (coord != clampedCoord) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    // No clamp :
    // gl_FragColor = texture2D(uSampler, vTextureCoord + offset);

    color.rgb *= 1.0 + (brightness - 1.0) * p * fade;

    gl_FragColor = color;
}
`,WL=class extends Wt{constructor(t=[0,0],e,i=0){super(AY,CY),this.center=t,Object.assign(this,WL.defaults,e),this.time=i}apply(t,e,i,r){this.uniforms.time=this.time,t.applyFilter(this,e,i,r)}get center(){return this.uniforms.center}set center(t){this.uniforms.center=t}get amplitude(){return this.uniforms.amplitude}set amplitude(t){this.uniforms.amplitude=t}get wavelength(){return this.uniforms.wavelength}set wavelength(t){this.uniforms.wavelength=t}get brightness(){return this.uniforms.brightness}set brightness(t){this.uniforms.brightness=t}get speed(){return this.uniforms.speed}set speed(t){this.uniforms.speed=t}get radius(){return this.uniforms.radius}set radius(t){this.uniforms.radius=t}},IY=WL;IY.defaults={amplitude:30,wavelength:160,brightness:1,speed:500,radius:-1};var kY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,MY=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float blur;
uniform float gradientBlur;
uniform vec2 start;
uniform vec2 end;
uniform vec2 delta;
uniform vec2 texSize;

float random(vec3 scale, float seed)
{
    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
}

void main(void)
{
    vec4 color = vec4(0.0);
    float total = 0.0;

    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
    vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));
    float radius = smoothstep(0.0, 1.0, abs(dot(vTextureCoord * texSize - start, normal)) / gradientBlur) * blur;

    for (float t = -30.0; t <= 30.0; t++)
    {
        float percent = (t + offset - 0.5) / 30.0;
        float weight = 1.0 - abs(percent);
        vec4 sample = texture2D(uSampler, vTextureCoord + delta / texSize * percent * radius);
        sample.rgb *= sample.a;
        color += sample * weight;
        total += weight;
    }

    color /= total;
    color.rgb /= color.a + 0.00001;

    gl_FragColor = color;
}
`,My=class extends Wt{constructor(e){var i,r;super(kY,MY),this.uniforms.blur=e.blur,this.uniforms.gradientBlur=e.gradientBlur,this.uniforms.start=(i=e.start)!=null?i:new Jt(0,window.innerHeight/2),this.uniforms.end=(r=e.end)!=null?r:new Jt(600,window.innerHeight/2),this.uniforms.delta=new Jt(30,30),this.uniforms.texSize=new Jt(window.innerWidth,window.innerHeight),this.updateDelta()}updateDelta(){this.uniforms.delta.x=0,this.uniforms.delta.y=0}get blur(){return this.uniforms.blur}set blur(e){this.uniforms.blur=e}get gradientBlur(){return this.uniforms.gradientBlur}set gradientBlur(e){this.uniforms.gradientBlur=e}get start(){return this.uniforms.start}set start(e){this.uniforms.start=e,this.updateDelta()}get end(){return this.uniforms.end}set end(e){this.uniforms.end=e,this.updateDelta()}},jT=class extends My{updateDelta(){let e=this.uniforms.end.x-this.uniforms.start.x,i=this.uniforms.end.y-this.uniforms.start.y,r=Math.sqrt(e*e+i*i);this.uniforms.delta.x=e/r,this.uniforms.delta.y=i/r}},XT=class extends My{updateDelta(){let e=this.uniforms.end.x-this.uniforms.start.x,i=this.uniforms.end.y-this.uniforms.start.y,r=Math.sqrt(e*e+i*i);this.uniforms.delta.x=-i/r,this.uniforms.delta.y=e/r}},qL=class extends Wt{constructor(t,e,i,r){super(),typeof t=="number"&&(At.deprecation("5.3.0","TiltShiftFilter constructor arguments is deprecated, use options."),t={blur:t,gradientBlur:e,start:i,end:r}),t=Object.assign({},qL.defaults,t),this.tiltShiftXFilter=new jT(t),this.tiltShiftYFilter=new XT(t)}apply(t,e,i,r){let s=t.getFilterTexture();this.tiltShiftXFilter.apply(t,e,s,1),this.tiltShiftYFilter.apply(t,s,i,r),t.returnFilterTexture(s)}get blur(){return this.tiltShiftXFilter.blur}set blur(t){this.tiltShiftXFilter.blur=this.tiltShiftYFilter.blur=t}get gradientBlur(){return this.tiltShiftXFilter.gradientBlur}set gradientBlur(t){this.tiltShiftXFilter.gradientBlur=this.tiltShiftYFilter.gradientBlur=t}get start(){return this.tiltShiftXFilter.start}set start(t){this.tiltShiftXFilter.start=this.tiltShiftYFilter.start=t}get end(){return this.tiltShiftXFilter.end}set end(t){this.tiltShiftXFilter.end=this.tiltShiftYFilter.end=t}},PY=qL;PY.defaults={blur:100,gradientBlur:600,start:void 0,end:void 0};var RY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,DY=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform vec4 filterArea;

vec2 mapCoord( vec2 coord )
{
    coord *= filterArea.xy;
    coord += filterArea.zw;

    return coord;
}

vec2 unmapCoord( vec2 coord )
{
    coord -= filterArea.zw;
    coord /= filterArea.xy;

    return coord;
}

vec2 twist(vec2 coord)
{
    coord -= offset;

    float dist = length(coord);

    if (dist < radius)
    {
        float ratioDist = (radius - dist) / radius;
        float angleMod = ratioDist * ratioDist * angle;
        float s = sin(angleMod);
        float c = cos(angleMod);
        coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);
    }

    coord += offset;

    return coord;
}

void main(void)
{

    vec2 coord = mapCoord(vTextureCoord);

    coord = twist(coord);

    coord = unmapCoord(coord);

    gl_FragColor = texture2D(uSampler, coord );

}
`,YL=class extends Wt{constructor(t){super(RY,DY),Object.assign(this,YL.defaults,t)}get offset(){return this.uniforms.offset}set offset(t){this.uniforms.offset=t}get radius(){return this.uniforms.radius}set radius(t){this.uniforms.radius=t}get angle(){return this.uniforms.angle}set angle(t){this.uniforms.angle=t}},FY=YL;FY.defaults={radius:200,angle:4,padding:20,offset:new Jt};var LY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,NY=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterArea;

uniform vec2 uCenter;
uniform float uStrength;
uniform float uInnerRadius;
uniform float uRadius;

const float MAX_KERNEL_SIZE = \${maxKernelSize};

// author: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/
highp float rand(vec2 co, float seed) {
    const highp float a = 12.9898, b = 78.233, c = 43758.5453;
    highp float dt = dot(co + seed, vec2(a, b)), sn = mod(dt, 3.14159);
    return fract(sin(sn) * c + seed);
}

void main() {

    float minGradient = uInnerRadius * 0.3;
    float innerRadius = (uInnerRadius + minGradient * 0.5) / filterArea.x;

    float gradient = uRadius * 0.3;
    float radius = (uRadius - gradient * 0.5) / filterArea.x;

    float countLimit = MAX_KERNEL_SIZE;

    vec2 dir = vec2(uCenter.xy / filterArea.xy - vTextureCoord);
    float dist = length(vec2(dir.x, dir.y * filterArea.y / filterArea.x));

    float strength = uStrength;

    float delta = 0.0;
    float gap;
    if (dist < innerRadius) {
        delta = innerRadius - dist;
        gap = minGradient;
    } else if (radius >= 0.0 && dist > radius) { // radius < 0 means it's infinity
        delta = dist - radius;
        gap = gradient;
    }

    if (delta > 0.0) {
        float normalCount = gap / filterArea.x;
        delta = (normalCount - delta) / normalCount;
        countLimit *= delta;
        strength *= delta;
        if (countLimit < 1.0)
        {
            gl_FragColor = texture2D(uSampler, vTextureCoord);
            return;
        }
    }

    // randomize the lookup values to hide the fixed number of samples
    float offset = rand(vTextureCoord, 0.0);

    float total = 0.0;
    vec4 color = vec4(0.0);

    dir *= strength;

    for (float t = 0.0; t < MAX_KERNEL_SIZE; t++) {
        float percent = (t + offset) / MAX_KERNEL_SIZE;
        float weight = 4.0 * (percent - percent * percent);
        vec2 p = vTextureCoord + dir * percent;
        vec4 sample = texture2D(uSampler, p);

        // switch to pre-multiplied alpha to correctly blur transparent images
        // sample.rgb *= sample.a;

        color += sample * weight;
        total += weight;

        if (t > countLimit){
            break;
        }
    }

    color /= total;
    // switch back from pre-multiplied alpha
    // color.rgb /= color.a + 0.00001;

    gl_FragColor = color;
}
`,ZL=Object.getOwnPropertySymbols,OY=Object.prototype.hasOwnProperty,BY=Object.prototype.propertyIsEnumerable,UY=(t,e)=>{var i={};for(var r in t)OY.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(t!=null&&ZL)for(var r of ZL(t))e.indexOf(r)<0&&BY.call(t,r)&&(i[r]=t[r]);return i},QL=class extends Wt{constructor(t){let e=Object.assign(QL.defaults,t),{maxKernelSize:i}=e,r=UY(e,["maxKernelSize"]);super(LY,NY.replace("${maxKernelSize}",i.toFixed(1))),Object.assign(this,r)}get center(){return this.uniforms.uCenter}set center(t){this.uniforms.uCenter=t}get strength(){return this.uniforms.uStrength}set strength(t){this.uniforms.uStrength=t}get innerRadius(){return this.uniforms.uInnerRadius}set innerRadius(t){this.uniforms.uInnerRadius=t}get radius(){return this.uniforms.uRadius}set radius(t){(t<0||t===1/0)&&(t=-1),this.uniforms.uRadius=t}},zY=QL;zY.defaults={strength:.1,center:[0,0],innerRadius:0,radius:-1,maxKernelSize:32};function KL(t){return t instanceof Set?t:new Set(t!==void 0&&[].concat(t))}var Mr=class{constructor(e,i){this.scene=e,this.renderer=e.renderer,this.context=e.context,this.layerID=i,this._enabled=!1,this.features=new Map,this.retained=new Map,this._featureHasData=new Map,this._dataHasFeature=new Map,this._parentHasChildren=new Map,this._childHasParents=new Map,this._dataHasClass=new Map,this._classHasData=new Map}render(){}cull(e){for(let[i,r]of this.features){let s=this.retained.get(i);s!==e&&(r.visible=!1,e-s>20&&r.destroy())}}addFeature(e){this.features.set(e.id,e)}removeFeature(e){this.unbindData(e.id),this.retained.delete(e.id),this.features.delete(e.id)}retainFeature(e,i){e.lod>0&&(e.visible=!0),this.retained.set(e.id,i)}syncFeatureClasses(e){let i=e.id,r=this._featureHasData.get(i);if(!r)return;let s=this._dataHasClass.get(r)??new Set;e.selected=s.has("selected"),e.hovered=s.has("hovered"),e.drawing=s.has("drawing"),e.active=s.has("drawing"),e.highlighted=s.has("highlighted")}isDrawing(e){return this._dataHasClass.get(e)?.has("drawing")}isHovered(e){return this._dataHasClass.get(e)?.has("hovered")}bindData(e,i){this.unbindData(e);let r=this._dataHasFeature.get(i);r||(r=new Set,this._dataHasFeature.set(i,r)),r.add(e),this._featureHasData.set(e,i)}unbindData(e){let i=this._featureHasData.get(e);if(!i)return;let r=this._dataHasFeature.get(i);r&&(r.delete(e),r.size||(this._dataHasFeature.delete(i),this._parentHasChildren.delete(i),this._childHasParents.delete(i))),this._featureHasData.delete(e)}addChildData(e,i){let r=this._parentHasChildren.get(e);r||(r=new Set,this._parentHasChildren.set(e,r)),r.add(i);let s=this._childHasParents.get(i);s||(s=new Set,this._childHasParents.set(i,s)),s.add(e)}removeChildData(e,i){let r=this._parentHasChildren.get(e);r&&(r.delete(i),r.size||this._parentHasChildren.get(i)||this._parentHasChildren.delete(i));let s=this._childHasParents.get(i);s&&(s.delete(i),s.size||this._childHasParents.delete(i))}clearChildData(e){let i=this._parentHasChildren.get(e)??new Set;for(let r of i)this.removeChildData(e,r)}getSelfAndDescendants(e,i){i instanceof Set?i.add(e):i=new Set([e]);let r=this._parentHasChildren.get(e)??new Set;for(let s of r)i.has(s)||this.getSelfAndDescendants(s,i);return i}getSelfAndAncestors(e,i){i instanceof Set?i.add(e):i=new Set([e]);let r=this._childHasParents.get(e)??new Set;for(let s of r)i.has(s)||this.getSelfAndAncestors(s,i);return i}getSelfAndSiblings(e,i){i instanceof Set?i.add(e):i=new Set([e]);let r=this._childHasParents.get(e)??new Set;for(let s of r){let n=this._parentHasChildren.get(s)??new Set;for(let o of n)i.add(o)}return i}classData(e,i){let r=this._dataHasClass.get(e);r||(r=new Set,this._dataHasClass.set(e,r)),r.add(i);let s=this._classHasData.get(i);s||(s=new Set,this._classHasData.set(i,s)),s.add(e)}unclassData(e,i){let r=this._dataHasClass.get(e);r&&(r.delete(i),r.size||this._dataHasClass.delete(e));let s=this._classHasData.get(i);s&&(s.delete(e),s.size||this._classHasData.delete(i))}clearClass(e){let i=this._classHasData.get(e)??new Set;for(let r of i)this.unclassData(r,e)}dirtyLayer(){for(let e of this.features.values())e.dirty=!0}dirtyFeatures(e){for(let i of KL(e)){let r=this.features.get(i);r&&(r.dirty=!0)}}dirtyData(e){for(let i of KL(e)){let r=this._dataHasFeature.get(i);r&&this.dirtyFeatures(r)}}get id(){return this.layerID}get supported(){return!0}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,this.dirtyLayer())}};var JL=16776960,GY=[0,-.0125,0,-.0125,.5,-.0125,0,-.0125,0],F4=class extends Mr{constructor(e,i,r){super(e,i),this.enabled=!0,this.isMinimap=r;let s=this.scene.groups.get("background");s.eventMode="none",this.filters={brightness:1,contrast:1,saturation:1,sharpness:1},this._tileMaps=new Map,this._failed=new Set,this._tiler=new Ns}render(e,i){let r=this.context.systems.imagery,s=this.scene.groups.get("background"),n=new Map,o=r.baseLayerSource();o&&o.id!=="none"&&n.set(o.id,o);for(let u of r.overlayLayerSources())n.set(u.id,u);let a=0;for(let[u,d]of n){let m=this.getSourceContainer(u);m.zIndex=u==="mapbox_locator_overlay"?999:a++,!this.isMinimap&&d===o&&this.applyFilters(m);let g=this._tileMaps.get(u);g||(g=new Map,this._tileMaps.set(u,g));let _=window.performance.now();this.renderSource(_,i,d,m,g)}let l=new Set;for(let u of s.children){let d=u.name;n.has(d)||l.add(d)}for(let u of l)this.destroySource(u)}renderSource(e,i,r,s,n){let o=this.context,a=this.renderer.textures,l=o.services.osm;if(isNaN(i._x)||isNaN(i._y))return;let u=!1,d;this.isMinimap||(u=o.getDebug("tile"),d=this.scene.layers.get("map-ui").container.getChildByName("tile-debug"),d.visible=u);let m=r.tileSize||256,g=i.scale(),_=Ba(g,m),v=Uo(r.offset,Math.pow(2,_));s.position.set(v[0],v[1]);let E=new Map,b=Math.round(_),T=Math.max(0,b-5);r.overzoom||(b=T=Math.floor(_));let A=!1;for(let M=b;!A&&M>=T;M--){if(!r.validZoom(M))continue;let k=this._tiler.skipNullIsland(!!r.overlay).zoomRange(M).getTiles(this.isMinimap?i:o.projection),F=!1;for(let O of k.tiles){if(!this.isMinimap&&M>=10&&l&&r.id==="mapbox_locator_overlay"){let B=O.wgs84Extent.center();if(l.isDataLoaded(B))continue}O.url=r.url(O.xyz),!O.url||this._failed.has(O.url)?F=!0:E.set(O.id,O)}A=!F}for(let[M,k]of E){if(n.has(M))continue;let F=`${r.id}-${M}`,O=new Jr;O.name=F,O.anchor.set(0,1),O.zIndex=k.xyz[2],s.addChild(O),k.sprite=O,n.set(M,k);let B=new Image;B.crossOrigin="anonymous",B.src=k.url,k.image=B,k.loaded=!1,B.onload=()=>{if(this._failed.delete(k.url),!k.sprite||!k.image)return;let U=k.image.naturalWidth,$=k.image.naturalHeight;k.sprite.texture=a.allocate("tile",k.sprite.name,U,$,k.image),k.loaded=!0,k.image=null,o.systems.map.deferredRedraw()},B.onerror=()=>{k.image=null,this._failed.add(k.url),o.systems.map.deferredRedraw()}}for(let[M,k]of n){let F=!1;if(E.has(M)?(F=!0,k.timestamp=e):r.overlay||(F=e-k.timestamp<3e3),F){let[O,B]=i.project(k.wgs84Extent.min);k.sprite.position.set(O,B);let U=m*Math.pow(2,_-k.xyz[2]);if(k.sprite.width=U,k.sprite.height=U,u&&d&&!r.overlay){if(!k.debug){k.debug=new Gi,k.debug.name=`debug-${M}`,k.debug.eventMode="none",k.debug.sortableChildren=!1,d.addChild(k.debug);let $=new P2(M,{fontName:"debug"});$.name=`label-${M}`,$.tint=JL,$.position.set(2,2),k.debug.addChild($)}k.debug.position.set(O,B-U),k.debug.clear().lineStyle(2,JL).drawRect(0,0,U,U)}}else this.destroyTile(k),n.delete(M)}}destroyAll(){let e=this.scene.groups.get("background"),i=new Set;for(let r of e.children){let s=r.name;i.add(s)}for(let r of i)this.destroySource(r)}destroySource(e){let i=this._tileMaps.get(e);for(let[n,o]of i)this.destroyTile(o),i.delete(n);this._tileMaps.delete(e);let s=this.scene.groups.get("background").getChildByName(e);s&&s.destroy({children:!0})}destroyTile(e){let i=this.renderer.textures;e.sprite&&(e.sprite.texture=null,e.loaded&&i.free("tile",e.sprite.name),e.sprite.destroy({children:!0,texture:!1,baseTexture:!1})),e.debug&&e.debug.destroy({children:!0}),e.image=null,e.sprite=null,e.debug=null}getSourceContainer(e){let i=this.scene.groups.get("background"),r=i.getChildByName(e);return r||(r=new qi,r.name=e,r.eventMode="none",r.sortableChildren=!0,i.addChild(r)),r}applyFilters(e){let i=new Zg({brightness:this.filters.brightness,contrast:this.filters.contrast,saturation:this.filters.saturation});if(e.filters=[i],this.filters.sharpness>1){let r=GY.map((s,n)=>{if(n===4){let o=Qs(1,2)(this.filters.sharpness);return s*o}else return s});this.convolutionFilter=new Iy(r),e.filters.push(this.convolutionFilter)}else if(this.filters.sharpness<1){let r=Qs(1,8)(1-this.filters.sharpness);this.blurFilter=new O5.BlurFilter(r,4),e.filters.push(this.blurFilter)}}setBrightness(e){this.filters.brightness=e}setContrast(e){this.filters.contrast=e}setSaturation(e){this.filters.saturation=e}setSharpness(e){this.filters.sharpness=e}};var $Y={dash:[10,5],width:1,color:16777215,alpha:1,scale:1,useTexture:!1,alignment:.5},fh=class{constructor(t,e={}){this.cursor=new Jt,this.scale=1,this.graphics=t,e={...$Y,...e},this.dash=e.dash,this.dashSize=this.dash.reduce((i,r)=>i+r),this.useTexture=e.useTexture,this.options=e,this.setLineStyle()}setLineStyle(){let t=this.options;if(this.useTexture){let e=fh.getTexture(t,this.dashSize);this.graphics.lineTextureStyle({width:t.width*t.scale,color:t.color,alpha:t.alpha,texture:e,alignment:t.alignment}),this.activeTexture=e}else this.graphics.lineStyle({width:t.width*t.scale,color:t.color,alpha:t.alpha,cap:t.cap,join:t.join,alignment:t.alignment});this.scale=t.scale}static distance(t,e,i,r){return Math.sqrt(Math.pow(i-t,2)+Math.pow(r-e,2))}moveTo(t,e){return this.lineLength=0,this.cursor.set(t,e),this.start=new Jt(t,e),this.graphics.moveTo(this.cursor.x,this.cursor.y),this}lineTo(t,e,i){typeof this.lineLength===void 0&&this.moveTo(0,0);let[r,s]=[this.cursor.x,this.cursor.y],n=fh.distance(r,s,t,e);if(n<1)return this;let o=Math.atan2(e-s,t-r),a=Math.cos(o),l=Math.sin(o),u=i&&t===this.start.x&&e===this.start.y;if(this.useTexture)if(this.graphics.moveTo(r,s),this.adjustLineStyle(o),u&&this.dash.length%2===0){let d=Math.min(this.dash[this.dash.length-1],n);this.graphics.lineTo(t-a*d,e-l*d),this.graphics.closePath()}else this.graphics.lineTo(t,e);else{this.setLineStyle();let d=this.lineLength%(this.dashSize*this.scale),m=0,g=0,_=0;for(let E=0;E<this.dash.length;E++){let b=this.dash[E]*this.scale;if(d<_+b){m=E,g=d-_;break}else _+=b}let v=n;for(;v>1;){let E=this.dash[m]*this.scale-g,b=v>E?E:v;if(u&&fh.distance(r+a*b,s+l*b,this.start.x,this.start.y)<=b){if(m%2===0){let A=fh.distance(r,s,this.start.x,this.start.y)-this.dash[this.dash.length-1]*this.scale;r+=a*A,s+=l*A,this.graphics.lineTo(r,s),this.lineLength+=A,this.cursor.set(r,s)}break}r+=a*b,s+=l*b,m%2?this.graphics.moveTo(r,s):this.graphics.lineTo(r,s),this.lineLength+=b,this.cursor.set(r,s),v-=b,m++,m=m===this.dash.length?0:m,g=0}}return this}closePath(){this.lineTo(this.start.x,this.start.y,!0)}drawCircle(t,e,i,r=80,s){let n=Math.PI*2/r,o=0,a=new Jt(t+Math.cos(o)*i,e+Math.sin(o)*i);s?(s.apply(a,a),this.moveTo(a[0],a[1])):this.moveTo(a.x,a.y),o+=n;for(let l=1;l<r+1;l++){let u=l===r?[a.x,a.y]:[t+Math.cos(o)*i,e+Math.sin(o)*i];this.lineTo(u[0],u[1]),o+=n}return this}drawEllipse(t,e,i,r,s=80,n){let o=Math.PI*2/s,a,l=new Jt,u=0;for(let d=0;d<Math.PI*2;d+=o){let m=t-i*Math.sin(d),g=e-r*Math.cos(d);n&&(l.set(m,g),n.apply(l,l),m=l.x,g=l.y),d===0?(this.moveTo(m,g),a={x:m,y:g}):this.lineTo(m,g)}return this.lineTo(a.x,a.y,!0),this}drawPolygon(t,e){let i=new Jt;if(typeof t[0]=="number")if(e){i.set(t[0],t[1]),e.apply(i,i),this.moveTo(i.x,i.y);for(let r=2;r<t.length;r+=2)i.set(t[r],t[r+1]),e.apply(i,i),this.lineTo(i.x,i.y,r===t.length-2)}else{this.moveTo(t[0],t[1]);for(let r=2;r<t.length;r+=2)this.lineTo(t[r],t[r+1],r===t.length-2)}else if(e){let r=t[0];i.copyFrom(r),e.apply(i,i),this.moveTo(i.x,i.y);for(let s=1;s<t.length;s++){let n=t[s];i.copyFrom(n),e.apply(i,i),this.lineTo(i.x,i.y,s===t.length-1)}}else{let r=t[0];this.moveTo(r.x,r.y);for(let s=1;s<t.length;s++){let n=t[s];this.lineTo(n.x,n.y,s===t.length-1)}}return this}drawRect(t,e,i,r,s){if(s){let n=new Jt;n.set(t,e),s.apply(n,n),this.moveTo(n.x,n.y),n.set(t+i,e),s.apply(n,n),this.lineTo(n.x,n.y),n.set(t+i,e+r),s.apply(n,n),this.lineTo(n.x,n.y),n.set(t,e+r),s.apply(n,n),this.lineTo(n.x,n.y),n.set(t,e),s.apply(n,n),this.lineTo(n.x,n.y,!0)}else this.moveTo(t,e).lineTo(t+i,e).lineTo(t+i,e+r).lineTo(t,e+r).lineTo(t,e,!0);return this}adjustLineStyle(t){let e=this.graphics.line;e.matrix=new hr,t&&e.matrix.rotate(t),this.scale!==1&&e.matrix.scale(this.scale,this.scale);let i=-this.lineLength;e.matrix.translate(this.cursor.x+i*Math.cos(t),this.cursor.y+i*Math.sin(t)),this.graphics.lineStyle(e)}static getTexture(t,e){let i=t.dash.toString();if(fh.dashTextureCache[i])return fh.dashTextureCache[i];let r=document.createElement("canvas");r.width=e,r.height=Math.ceil(t.width);let s=r.getContext("2d");if(!s)return console.warn("Did not get context from canvas"),null;s.strokeStyle="white",s.globalAlpha=t.alpha,s.lineWidth=t.width;let n=0,o=t.width/2;s.moveTo(n,o);for(let l=0;l<t.dash.length;l+=2)n+=t.dash[l],s.lineTo(n,o),t.dash.length!==l+1&&(n+=t.dash[l+1],s.moveTo(n,o));s.stroke();let a=fh.dashTextureCache[i]=qt.from(r);return a.baseTexture.scaleMode=Qn.NEAREST,a}},Pl=fh;Pl.dashTextureCache={};var rN=Xi(iN(),1),Py=class{constructor(){this.type=null,this.dirty=!0,this.reset()}destroy(){this.reset()}reset(){this.origCoords=null,this.origExtent=null,this.origHull=null,this.origCentroid=null,this.origPoi=null,this.origSsr=null,this.coords=null,this.extent=null,this.hull=null,this.centroid=null,this.poi=null,this.ssr=null,this.outer=null,this.flatOuter=null,this.holes=null,this.flatHoles=null,this.width=0,this.height=0,this.lod=0}update(e){if(!this.dirty||!this.origCoords||!this.origExtent)return;if(this.dirty=!1,this.coords=null,this.extent=null,this.outer=null,this.flatOuter=null,this.holes=null,this.flatHoles=null,this.hull=null,this.centroid=null,this.poi=null,this.ssr=null,this.type==="point"){this.coords=e.project(this.origCoords),this.extent=new mt(this.coords),this.centroid=this.coords,this.width=0,this.height=0,this.lod=2;return}this.extent=new mt,this.extent.min=e.project([this.origExtent.min[0],this.origExtent.max[1]]),this.extent.max=e.project([this.origExtent.max[0],this.origExtent.min[1]]);let[i,r]=this.extent.min,[s,n]=this.extent.max;if(this.width=s-i,this.height=n-r,this.width<4&&this.height<4){this.lod=0;return}let o=this.type==="line"?[this.origCoords]:this.origCoords,a=new Array(o.length),l=new Array(o.length);for(let u=0;u<o.length;++u){let d=o[u];a[u]=new Array(d.length),l[u]=new Array(d.length*2);for(let m=0;m<d.length;++m){let g=e.project(d[m]);a[u][m]=g,l[u][m*2]=g[0],l[u][m*2+1]=g[1]}}if(this.type==="line"?(this.coords=a[0],this.outer=a[0],this.flatOuter=l[0],this.holes=null,this.flatHoles=null):(this.coords=a,this.outer=a[0],this.flatOuter=l[0],this.holes=a.slice(1),this.flatHoles=l.slice(1)),this.outer.length!==0)if(this.outer.length===1)this.centroid=this.outer[0],this.origCentroid=e.invert(this.centroid),this.poi=this.centroid,this.origPoi=this.origCentroid;else if(this.outer.length===2)this.centroid=pr(this.outer[0],this.outer[1],.5),this.origCentroid=e.invert(this.centroid),this.poi=this.centroid,this.origPoi=this.origCentroid;else{if(this.origHull){this.hull=new Array(this.origHull.length);for(let u=0;u<this.origHull.length;++u)this.hull[u]=e.project(this.origHull[u])}else if(this.hull=ql(this.outer),this.hull){this.origHull=new Array(this.hull.length);for(let u=0;u<this.origHull.length;++u)this.origHull[u]=e.invert(this.hull[u])}if(this.origCentroid?this.centroid=e.project(this.origCentroid):this.hull&&(this.hull.length===2?this.centroid=pr(this.hull[0],this.hull[1],.5):this.centroid=da(this.hull),this.origCentroid=e.invert(this.centroid)),this.origPoi?this.poi=e.project(this.origPoi):(this.poi=(0,rN.default)(this.coords),this.origPoi=e.invert(this.poi)),this.origSsr){this.ssr={angle:this.origSsr.angle,poly:new Array(this.origSsr.poly.length)};for(let u=0;u<this.origSsr.poly.length;++u)this.ssr.poly[u]=e.project(this.origSsr.poly[u])}else if(this.hull&&(this.ssr=Of(this.hull),this.ssr)){this.origSsr={angle:this.ssr.angle,poly:new Array(this.ssr.poly.length)};for(let u=0;u<this.ssr.poly.length;++u)this.origSsr.poly[u]=e.invert(this.ssr.poly[u])}}this.lod=2}setCoords(e){let i=this._inferType(e);if(!i)return;this.reset(),this.type=i,this.origCoords=e,this.origExtent=new mt;let r=this.origExtent;if(i==="point")r.min=e,r.max=e,this.origCentroid=e;else{let s=this.type==="line"?[this.origCoords]:this.origCoords;for(let n=0;n<s.length;++n){let o=s[n];for(let a=0;a<o.length;++a){let[l,u]=o[a];r.min=[Math.min(r.min[0],l),Math.min(r.min[1],u)],r.max=[Math.max(r.max[0],l),Math.max(r.max[1],u)]}}}this.dirty=!0}_inferType(e){let i=Array.isArray(e)&&e[0];if(typeof i=="number")return"point";let r=Array.isArray(i)&&i[0];return typeof r=="number"?"line":typeof(Array.isArray(r)&&r[0])=="number"?"polygon":null}};var mh=class{constructor(e,i){this.type="unknown",this.layer=e,this.scene=e.scene,this.renderer=e.renderer,this.context=e.context,this.featureID=i;let r=new qi;this.container=r,r.__feature__=this,r.name=i,r.sortableChildren=!1,r.visible=!0,this._allowInteraction=!0,this._active=!1,r.eventMode="static",this.v=-1,this.lod=2,this.halo=null,this.geometry=new Py,this._style=null,this._styleDirty=!0,this._label=null,this._labelDirty=!0,this._dataID=null,this._data=null,this._selected=!1,this._highlighted=!1,this._hovered=!1,this._drawing=!1,this.sceneBounds=new ei,this.layer.addFeature(this),this.scene.addFeature(this)}destroy(){this.layer.removeFeature(this),this.scene.removeFeature(this),this.container.filters=null,this.container.__feature__=null,this.container.destroy({children:!0}),this.container=null,this.layer=null,this.scene=null,this.renderer=null,this.context=null,this.halo&&(this.halo.destroy({children:!0}),this.halo=null),this.geometry.destroy(),this.geometry=null,this._style=null,this._label=null,this._dataID=null,this._data=null,this.sceneBounds=null}update(e,i){this.dirty&&(this.geometry.update(e,i),this._styleDirty=!1)}updateHalo(){}get id(){return this.featureID}get parentContainer(){return this.container.parent}set parentContainer(e){let i=this.container.parent;e&&e!==i?this.container.setParent(e):!e&&i&&i.removeChild(this.container)}get visible(){return this.container.visible}set visible(e){e!==this.container.visible&&(this.container.visible=e,this.updateHalo(),this._labelDirty=!0)}get allowInteraction(){return this._allowInteraction}set allowInteraction(e){e!==this._allowInteraction&&(this._allowInteraction=e,this.container&&(this.container.eventMode=this._allowInteraction&&!this._active?"static":"none"))}get active(){return this._active}set active(e){e!==this._active&&(this._active=e,this.container&&(this.container.eventMode=this._allowInteraction&&!this._active?"static":"none"))}get dirty(){return this.geometry.dirty||this._styleDirty}set dirty(e){this.geometry.dirty=e,this._styleDirty=e,this._labelDirty=e}get hovered(){return this._hovered}set hovered(e){e!==this._hovered&&(this._hovered=e,this._styleDirty=!0)}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._styleDirty=!0,this._labelDirty=!0)}get highlighted(){return this._highlighted}set highlighted(e){e!==this._highlighted&&(this._highlighted=e,this._styleDirty=!0,this._labelDirty=!0)}get drawing(){return this._drawing}set drawing(e){e!==this._drawing&&(this._drawing=e,this._styleDirty=!0)}get style(){return this._style}set style(e){this._style=e,this._styleDirty=!0}get label(){return this._label}set label(e){e!==this._label&&(this._label=e,this._labelDirty=!0)}get data(){return this._data}get dataID(){return this._dataID}setData(e,i){this._dataID=e,this._data=i,this.layer.bindData(this.id,e),this.dirty=!0}addChildData(e,i){this.layer.addChildData(e,i),this.dirty=!0}clearChildData(e){this.layer.clearChildData(e),this.dirty=!0}};function L4(t,e={}){let r=[t[0],t[1]],s=[t[t.length-2],t[t.length-1]],n=Wi(r,s,1e-4),o=new Jn(t);e.native=!1,o.closeStroke=!1;let a={shape:o,lineStyle:e},l={closePointEps:1e-4,indices:[],points:[],uvs:[]};cD.buildLine(a,l);let u=l.points,d=l.indices,m=new Map,g=[],_=[],v,E,b=0,T=0,A,M,k,F,O,B;for(let Z=0;Z<d.length;Z+=3){let Q=d[Z],X=d[Z+1],ce=d[Z+2],de=[u[Q*2],u[Q*2+1]],le=[u[X*2],u[X*2+1]],te=[u[ce*2],u[ce*2+1]];if(Z===0)m.set(Q,!0),m.set(X,!1),m.set(ce,!0),g.push(de),_.push(le),g.push(te),E=le,v=te,b=Hi(de,te);else{let ee=m.get(Q),oe=m.get(X),ie=m.get(ce);ee===void 0&&Wi(de,A,1e-4)&&(ee=m.get(F),m.set(Q,ee)),oe===void 0&&Wi(le,M,1e-4)&&(oe=m.get(O),m.set(X,oe)),ie===void 0&&Wi(te,k,1e-4)&&(ie=m.get(B),m.set(ce,ie));let ne,me,De;ee===void 0&&(ne=Q,me=de,De=!ie),oe===void 0&&(ne=X,me=le,De=!ee),ie===void 0&&(ne=ce,me=te,De=!oe),ne!==void 0&&(m.set(ne,De),De===!0?(g.push(me),b+=Hi(v,me),v=me):(_.push(me),T+=Hi(E,me),E=me))}A=de,M=le,k=te,F=Q,O=X,B=ce}let U={},$=g.length+_.length+1,q=new Array($*2),W=0;for(let Z=0;Z<g.length;++W,++Z)q[W*2]=g[Z][0],q[W*2+1]=g[Z][1];_.reverse();for(let Z=0;Z<_.length;++W,++Z)q[W*2]=_[Z][0],q[W*2+1]=_[Z][1];if(q[q.length-2]=q[0],q[q.length-1]=q[1],U.perimeter=q,n){let Z=new Array((g.length+1)*2);for(let X=0;X<g.length;++X)Z[X*2]=g[X][0],Z[X*2+1]=g[X][1];Z[Z.length-2]=g[0][0],Z[Z.length-1]=g[0][1];let Q=new Array((_.length+1)*2);for(let X=0;X<_.length;++X)Q[X*2]=_[X][0],Q[X*2+1]=_[X][1];Q[Q.length-2]=_[0][0],Q[Q.length-1]=_[0][1],b>T?(U.outer=Z,U.inner=Q):(U.outer=Q,U.inner=Z)}return U}function o6(t,e,i=!1,r=!1){let n=e,o,a=[];for(let l=0;l<t.length;l++){let u=t[l];if(o){let d=Hi(o,u)-n;if(d>=0){let m=fs(o,u),g=e*Math.cos(m),_=e*Math.sin(m),v=0,E=0;i&&(v=7*Math.cos(m+Math.PI/2),E=7*Math.sin(m+Math.PI/2));let b=[o[0]+n*Math.cos(m)+v,o[1]+n*Math.sin(m)+E],T=[o,b];for(r&&d>=e*100&&(e=Math.floor(d/100)),d-=e;d>=0;d-=e)b=Sr(b,[g,_]),T.push(b);T.push(u),a.push({coords:T.slice(1,-1),angle:m+(i?Math.PI/2:0)})}n=-d}o=u}return a}var Ry=32,Yc=class extends mh{constructor(e,i){super(e,i),this.type="polygon",this._ssrdata=null;let r=new Jr;r.name="lowRes",r.anchor.set(.5,.5),r.visible=!1,r.eventMode="static",this.lowRes=r;let s=new Gi;s.name="fill",s.eventMode="static",s.sortableChildren=!1,this.fill=s;let n=new Gi;n.name="stroke",n.eventMode="none",n.sortableChildren=!1,this.stroke=n;let o=new nc(null,new Tl(qt.WHITE));o.name="mask",o.eventMode="static",o.visible=!1,this.mask=o,this.container.addChild(r,s,n,o)}destroy(){super.destroy(),this.lowRes=null,this.fill=null,this.mask=null,this._ssrdata&&(delete this._ssrdata.ssr,delete this._ssrdata.origSsr,delete this._ssrdata.origAxis1,delete this._ssrdata.origAxis2,delete this._ssrdata.origCenter,delete this._ssrdata.shapeType,this._ssrdata=null),this._bufferdata&&(this._bufferdata=null)}update(e,i){if(!this.dirty)return;let r=this.context.systems.map.wireframeMode;if(this.geometry.dirty){if(this.geometry.update(e,i),this._ssrdata=null,this.geometry.ssr?.poly){let O=this.geometry.ssr.poly,B=[(O[0][0]+O[1][0])/2,(O[0][1]+O[1][1])/2],U=[(O[2][0]+O[3][0])/2,(O[2][1]+O[3][1])/2],$=[(O[3][0]+O[0][0])/2,(O[3][1]+O[0][1])/2],q=[(O[1][0]+O[2][0])/2,(O[1][1]+O[2][1])/2],W=[B,U],Z=[$,q],Q=[(B[0]+U[0])/2,(B[1]+U[1])/2],X=.1,ce,de,le,te;this.geometry.outer.forEach(oe=>{ce||(ce=Wi(oe,O[0],X)),de||(de=Wi(oe,O[1],X)),le||(le=Wi(oe,O[2],X)),te||(te=Wi(oe,O[3],X))});let ee=ce||de||le||te;this._ssrdata={ssr:this.geometry.ssr,origSsr:this.geometry.origSsr,origAxis1:W.map(oe=>e.invert(oe)),origAxis2:Z.map(oe=>e.invert(oe)),origCenter:e.invert(Q),shapeType:ee?"square":"circle"}}if(this._bufferdata=null,this.geometry.flatOuter){let O={alignment:.5,color:0,width:16,alpha:1,join:Br.BEVEL,cap:Oi.BUTT};this._bufferdata=L4(this.geometry.flatOuter,O)}}let[s,n]=this.geometry.extent.min,[o,a]=this.geometry.extent.max,[l,u]=[o-s,a-n];this.sceneBounds.x=s,this.sceneBounds.y=n,this.sceneBounds.width=l,this.sceneBounds.height=u;let d=this._style,m=this.renderer.textures,g=d.fill.color||11184810,_=d.fill.alpha||.3,v=d.fill.pattern,E=d.stroke.dash||null,b=v&&m.getPatternTexture(v)||qt.WHITE,T,M=this.context.systems.storage.getItem("area-fill")??"partial",k=!d.requireFill&&M==="partial",F=2*Ry+5;if((l<F||u<F)&&(k=!1),(l<Ry||u<Ry)&&(b=qt.WHITE),l<4&&u<4)this.lod=0,this.visible=!1,this.fill.visible=!1,this.stroke.visible=!1,this.mask.visible=!1,this.lowRes.visible=!1;else if(this._ssrdata&&l<20&&u<20){this.lod=1,this.visible=!0;let O=this._ssrdata;this.fill.visible=!1,this.stroke.visible=!1,this.mask.visible=!1,this.lowRes.visible=!0;let U=`lowres${r?"-unfilled":""}-${O.shapeType}`,[$,q]=e.project(O.origCenter),W=O.ssr.angle,Z=O.origAxis1.map(de=>e.project(de)),Q=O.origAxis2.map(de=>e.project(de)),X=Hi(Z[0],Z[1]),ce=Hi(Q[0],Q[1]);this.lowRes.texture=m.get(U)||qt.WHITE,this.lowRes.position.set($,q),this.lowRes.scale.set(X/10,ce/10),this.lowRes.rotation=W,this.lowRes.tint=g}else this.lod=2,this.visible=!0,this.fill.visible=!0,this.stroke.visible=!0,this.lowRes.visible=!1,T={outer:new Jn(this.geometry.flatOuter),holes:(this.geometry.flatHoles||[]).map(O=>new Jn(O))};if(T&&this.stroke.visible){let O=r?1:d.fill.width||2;if(!E)this.stroke.clear().lineStyle({alpha:1,width:O,color:g}).drawShape(T.outer),T.holes.forEach(B=>this.stroke.drawShape(B));else{let B={alpha:1,dash:E,width:O,color:g};this.stroke.clear();let U=new Pl(this.stroke,B),$=NE(T.outer.points);U.drawPolygon($),T.holes.forEach(q=>U.drawPolygon(NE(q.points)))}}if(r?(this.fill.visible=!1,this.fill.clear(),this._bufferdata&&(this.container.hitArea=new Jn(this._bufferdata.perimeter))):this.container.hitArea=null,T&&this.fill.visible)if(this.fill.clear().beginTextureFill({alpha:_,color:g,texture:b}).drawShape(T.outer),T.holes.length&&(this.fill.beginHole(),T.holes.forEach(O=>this.fill.drawShape(O)),this.fill.endHole()),this.fill.endFill(),k){let O=new Gi().clear().lineTextureStyle({alpha:1,alignment:0,color:0,cap:Oi.BUTT,join:Br.BEVEL,width:Ry,texture:qt.WHITE});O.drawShape(T.outer),T.holes.length&&T.holes.forEach(B=>O.drawShape(B)),O.geometry.updateBatches(!0),this.mask.geometry=new qo().addAttribute("aVertexPosition",O.geometry.points,2).addAttribute("aTextureCoord",O.geometry.uvs,2).addIndex(O.geometry.indices),this.mask.visible=!0,this.fill.mask=this.mask}else this.mask.visible=!1,this.fill.mask=null;this._styleDirty=!1,this.updateHalo()}updateHalo(){let e=this.context.systems.map.wireframeMode,i=this.visible&&this.hovered,r=this.visible&&this.selected,s=this.visible&&this.highlighted;if(i){if(!this.container.filters){let n=new qc({distance:15,outerStrength:3,color:16776960});n.resolution=2,this.container.filters=[n]}}else if(s){if(!this.container.filters){let n=new qc({distance:15,outerStrength:3,color:7377663});n.resolution=2,this.container.filters=[n]}}else this.container.filters&&(this.container.filters=null);if(r){this.halo||(this.halo=new Gi,this.halo.name=`${this.id}-halo`,this.scene.layers.get("map-ui").container.addChild(this.halo));let n={alpha:.9,dash:[6,3],width:2,color:16776960};this.halo.clear();let o=new Pl(this.halo,n);this._bufferdata&&(o.drawPolygon(this._bufferdata.outer),e&&o.drawPolygon(this._bufferdata.inner))}else this.halo&&(this.halo.destroy({children:!0}),this.halo=null)}get style(){return this._style}set style(e){this._style=Object.assign({},YY,e),this._styleDirty=!0}},YY={requireFill:!1,lineMarkerName:"",lineMarkerTint:0,labelTint:15658734,fill:{width:2,color:11184810,alpha:.3},casing:{width:5,color:4473924,alpha:1,cap:Oi.ROUND,join:Br.ROUND},stroke:{width:3,color:13421772,alpha:1,cap:Oi.ROUND,join:Br.ROUND}};var ZY=4,Dy=class extends Mr{constructor(e,i){super(e,i),this.enabled=!0,this._oldk=0}get enabled(){return!0}set enabled(e){this._enabled=!0}render(e,i,r){let s;if(r>=ZY){let a=this.context.systems.map.extent().rectangle();s=this.context.systems.locations.wpblocks().bbox(a),this.renderEditBlocks(e,i,r,s)}else s=[];let n=this.context.container().select(".main-content > .map-footer").selectAll(".api-status.blocks").data(s,a=>a.id);n.exit().remove();let o=n.enter().insert("div",".api-status").attr("class","api-status blocks error");o.append("span").attr("class","explanation-item").text(a=>a.text),o.append("a").attr("target","_blank").attr("href",a=>a.url).text("More Info")}renderEditBlocks(e,i,r,s){let n=this.context.systems.locations,o=this.scene.groups.get("blocks"),a={requireFill:!0,fill:{pattern:"construction",color:1,alpha:.7}};for(let l of s){let u=n.feature(l.locationSetID).geometry;if(!u)continue;let d=u.type==="Polygon"?[u.coordinates]:u.type==="MultiPolygon"?u.coordinates:[];for(let m=0;m<d.length;++m){let g=d[m],_=`${this.layerID}-${l.locationSetID}-${m}`,v=this.features.get(_);v||(v=new Yc(this,_),v.geometry.setCoords(g),v.style=a,v.parentContainer=o,v.container.cursor="not-allowed",v.setData(l.locationSetID,l)),this.syncFeatureClasses(v),v.update(i,r),this.retainFeature(v,e)}}}};var Vr=class extends mh{constructor(e,i){super(e,i),this.type="point",this._viewfieldCount=0,this._isCircular=!1;let r=new Jr;r.name="marker",r.eventMode="none",r.sortableChildren=!1,r.visible=!0,this.marker=r;let s=new Jr;s.name="icon",s.eventMode="none",s.sortableChildren=!1,s.visible=!1,this.icon=s,this.viewfields=null,this.container.addChild(r,s)}destroy(){super.destroy(),this.marker=null,this.icon=null,this.viewfields=null}update(e,i){if(!this.dirty)return;this.updateGeometry(e,i),this.updateStyle(i);let r=this.container.position;this.sceneBounds=this.container.getLocalBounds().clone(),this.sceneBounds.x+=r.x,this.sceneBounds.y+=r.y,this.updateHitArea(),this.updateHalo()}updateGeometry(e,i){if(!this.geometry.dirty)return;this.geometry.update(e,i);let[r,s]=this.geometry.coords;this.container.position.set(r,s);let n=-this.geometry.origCoords[1];this.container.zIndex=this._viewfieldCount>0?n+1e3:n}updateStyle(e){if(!this._styleDirty)return;let r=this.context.systems.map.wireframeMode,s=this.renderer.textures,n=this._style,o=["pin","boldPin","improveosm","osmose"].includes(n.markerName),a=this.marker,l=this.icon,u=this.geometry.origCoords[1];if(n.markerTexture||n.markerName?(a.alpha=n.markerAlpha??1,a.tint=n.markerTint,a.visible=!0):a.visible=!1,n.iconTexture||n.iconName){l.texture=n.iconTexture||s.get(n.iconName),l.anchor.set(n.anchor?.x||.5,n.anchor?.y||.5);let m=11;l.width=m,l.height=m,l.alpha=n.iconAlpha??1,l.tint=n.iconTint,l.visible=!0}else l.visible=!1;let d=n.viewfieldAngles||[];if(d.length>0){let m=n.viewfieldTexture||s.get(n.viewfieldName)||qt.WHITE;if(this.container.zIndex=-u+1e3,this.viewfields||(this.viewfields=new qi,this.viewfields.name="viewfields",this.viewfields.eventMode="none",this.viewfields.sortableChildren=!1,this.viewfields.visible=!0,this.container.addChildAt(this.viewfields,0)),this._viewfieldCount!==d.length){this.viewfields.removeChildren();for(let g=0;g<d.length;g++){let _=new Jr(m);_.eventMode="none",_.anchor.set(.5,.5),this.viewfields.addChild(_)}this._viewfieldCount=d.length}for(let g=0;g<d.length;g++){let _=this.viewfields.getChildAt(g);_.tint=n.viewfieldTint||3355443,_.angle=d[g]}}else this.viewfields&&(this.viewfields.destroy({children:!0}),this.viewfields=null,this.container.zIndex=-u,this._viewfieldCount=0);if(e<16)this.lod=0,this.visible=!1;else if(e<17||r){this.lod=1,this.visible=!0,this.container.scale.set(.8,.8),this.viewfields&&(this.viewfields.renderable=!1);let m=o?"largeCircle":n.markerName;this._isCircular=!n.markerTexture&&/(circle|midpoint)$/i.test(m),a.texture=n.markerTexture||s.get(m),a.anchor.set(.5,.5),l.position.set(0,0)}else{this.lod=2,this.visible=!0,this.container.scale.set(1,1),this.viewfields&&(this.viewfields.renderable=!0);let m=o&&d.length?"largeCircle":n.markerName;this._isCircular=!n.markerTexture&&/(circle|midpoint)$/i.test(m),a.texture=n.markerTexture||s.get(m),o&&!this._isCircular?(a.anchor.set(.5,1),l.position.set(0,-14)):(a.anchor.set(.5,.5),l.position.set(0,0))}this._styleDirty=a.texture===qt.EMPTY||l.texture===qt.EMPTY}updateHitArea(){if(!this.visible)return;if(this._drawing){this.container.hitArea=null;return}let e=20,i=this.marker.getLocalBounds().clone();if(this._isCircular){let r=i.width/2;r<e/2&&(r=e/2),r=r+2;let s=new H1(0,0,r);this.container.hitArea=s}else i.width<e&&i.pad((e-i.width)/2,0),i.height<e&&i.pad(0,(e-i.height)/2),i.pad(4),this.container.hitArea=i}updateHalo(){let e=this.visible&&this.hovered,i=this.visible&&this.selected&&!this.virtual,r=this.visible&&this.highlighted;if(e){if(!this.container.filters){let s=new qc({distance:15,outerStrength:3,color:16776960});s.resolution=2,this.container.filters=[s]}}else if(r){if(!this.container.filters){let s=new qc({distance:15,outerStrength:3,color:7377663});s.resolution=2,this.container.filters=[s]}}else this.container.filters&&(this.container.filters=null);if(i){this.halo||(this.halo=new Gi,this.halo.name=`${this.id}-halo`,this.scene.layers.get("map-ui").container.addChild(this.halo));let s={alpha:.9,dash:[6,3],width:2,color:16776960};this.halo.clear();let n=this.container.hitArea;n instanceof H1?new Pl(this.halo,s).drawCircle(n.x,n.y,n.radius,20):n instanceof ei&&new Pl(this.halo,s).drawRect(n.x,n.y,n.width,n.height),this.halo.position=this.container.position}else this.halo&&(this.halo.destroy({children:!0}),this.halo=null)}get style(){return this._style}set style(e){this._style=Object.assign({},QY,e),this._styleDirty=!0}},QY={iconAlpha:1,iconName:"",iconTint:1118481,labelTint:15658734,markerAlpha:1,markerName:"smallCircle",markerTint:16777215,viewfieldAngles:[],viewfieldName:"viewfield",viewfieldTint:16777215};var KY=12,Fy=class extends Mr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.improveOSM}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.improveOSM.startAsync()))}renderMarkers(e,i,r){let s=this.context.services.improveOSM;if(!s?.started)return;let n=this.scene.groups.get("qa"),o=s.getData();for(let a of o){let l=`${this.layerID}-${a.id}`,u=this.features.get(l);if(!u){let d={markerName:"improveosm",markerTint:s.getColor(a.itemType),iconName:a.icon};u=new Vr(this,l),u.geometry.setCoords(a.loc),u.style=d,u.parentContainer=n,u.setData(a.id,a)}this.syncFeatureClasses(u),u.update(i,r),u._isCircular||u.icon.position.set(0,-17),this.retainFeature(u,e)}}render(e,i,r){let s=this.context.services.improveOSM;!this.enabled||!s?.started||r<KY||(s.loadTiles(),this.renderMarkers(e,i,r))}};var JY=35,eZ=30,Sa=class extends mh{constructor(e,i){super(e,i),this.type="line",this._bufferdata=null;let r=new Gi;r.name="casing",r.eventMode="none",r.sortableChildren=!1,this.casing=r;let s=new Gi;s.name="stroke",s.eventMode="none",s.sortableChildren=!1,this.stroke=s,this.container.addChild(r,s)}destroy(){super.destroy(),this.casing=null,this.stroke=null,this._bufferdata&&(delete this._bufferdata.inner,delete this._bufferdata.outer,delete this._bufferdata.perimeter,this._bufferdata=null)}update(e,i){if(!this.dirty)return;let r=this.context.systems.map.wireframeMode,s=this.renderer.textures,n=this.container,o=this._style;if(this.geometry.dirty){this.geometry.update(e,i);let[l,u]=this.geometry.extent.min,[d,m]=this.geometry.extent.max,[g,_]=[d-l,m-u];this.sceneBounds.x=l,this.sceneBounds.y=u,this.sceneBounds.width=g,this.sceneBounds.height=_,this.updateHitArea()}if(this._styleDirty){let{width:l,height:u}=this.sceneBounds,d=!0;l<4&&u<4?(this.lod=0,this.visible=!1,this.stroke.renderable=!1,this.casing.renderable=!1,d=!1):(this.visible=!0,this.stroke.renderable=!0,i<16?(this.lod=1,this.casing.renderable=!1,d=!1):(this.lod=2,this.casing.renderable=!0,d=!0));let m=n.getChildByName("lineMarkers");if(d&&(o.lineMarkerTexture||o.lineMarkerName||o.sidedMarkerTexture||o.sidedMarkerName)){m||(m=new qi,m.name="lineMarkers",m.eventMode="none",m.sortableChildren=!1,m.roundPixels=!1,n.addChild(m));let g=o.lineMarkerTexture||s.get(o.lineMarkerName)||qt.WHITE,_=o.sidedMarkerTexture||s.get(o.sidedMarkerName)||qt.WHITE,v=o.sidedMarkerName==="sided",E=o.lineMarkerName==="oneway";m.removeChildren(),E&&o6(this.geometry.coords,JY,!1,!0).forEach(T=>{T.coords.forEach(([A,M])=>{let k=new Jr(g);k.eventMode="none",k.sortableChildren=!1,k.anchor.set(.5,.5),k.position.set(A,M),k.rotation=T.angle,k.tint=o.lineMarkerTint,m.addChild(k)})}),v&&o6(this.geometry.coords,eZ,!0,!0).forEach(T=>{T.coords.forEach(([A,M])=>{let k=new Jr(_);k.eventMode="none",k.sortableChildren=!1,k.anchor.set(.5,.5),k.position.set(A,M),k.rotation=T.angle,k.tint=o.stroke.color,m.addChild(k)})})}else m&&(n.removeChild(m),m.destroy({children:!0}));this._styleDirty=!1}this.casing.renderable&&a("casing",this.casing,this.geometry.coords,o,r),this.stroke.renderable&&a("stroke",this.stroke,this.geometry.coords,o,r),this.updateHalo();function a(l,u,d,m,g){let _=l==="casing"?3:2,v=m[l].width;i<16?v-=4:i<17&&(v-=2),v<_&&(v=_),g&&(v=1);let E=u.clear();m[l].alpha!==0&&(m[l].dash?E=new Pl(E,{dash:m[l].dash,color:m[l].color,width:v,alpha:m[l].alpha||1,join:m[l].join||Br.ROUND,cap:m[l].cap||Oi.ROUND}):E=E.lineStyle({color:m[l].color,width:v,alpha:m[l].alpha||1,join:m[l].join||Br.ROUND,cap:m[l].cap||Oi.ROUND}),d.forEach(([b,T],A)=>{A===0?E.moveTo(b,T):E.lineTo(b,T)}))}}updateHitArea(){if(!this.geometry.flatOuter){this.container.hitArea=null;return}let i={alignment:.5,color:0,width:Math.max(3,this._style.casing.width||0)+10,alpha:1,join:Br.BEVEL,cap:Oi.BUTT};this._bufferdata=L4(this.geometry.flatOuter,i),this.container.hitArea=new Jn(this._bufferdata.perimeter)}updateHalo(){let e=this.visible&&this.hovered,i=this.visible&&this.selected,r=this.visible&&this.highlighted;if(e){if(!this.container.filters){let s=new qc({distance:15,outerStrength:3,color:16776960});s.resolution=2,this.container.filters=[s]}}else if(r){if(!this.container.filters){let s=new qc({distance:15,outerStrength:3,color:7377663});s.resolution=2,this.container.filters=[s]}}else this.container.filters&&(this.container.filters=null);if(i){this.halo||(this.halo=new Gi,this.halo.name=`${this.id}-halo`,this.scene.layers.get("map-ui").container.addChild(this.halo));let s={alpha:.9,dash:[6,3],width:2,color:16776960};this.halo.clear();let n=new Pl(this.halo,s);this._bufferdata&&(this._bufferdata.outer&&this._bufferdata.inner?(n.drawPolygon(this._bufferdata.outer),n.drawPolygon(this._bufferdata.inner)):n.drawPolygon(this._bufferdata.perimeter))}else this.halo&&(this.halo.destroy({children:!0}),this.halo=null)}get style(){return this._style}set style(e){this._style=Object.assign({},tZ,e),this._styleDirty=!0}},tZ={lineMarkerName:"",lineMarkerTint:0,labelTint:15658734,fill:{width:2,color:11184810,alpha:.3},casing:{width:5,color:4473924,alpha:1,cap:Oi.ROUND,join:Br.ROUND},stroke:{width:3,color:13421772,alpha:1,cap:Oi.ROUND,join:Br.ROUND}};var iZ=12,YT=2147583,rZ={casing:{alpha:0},stroke:{alpha:.9,width:4,color:YT}},sZ={markerName:"mediumCircle",markerTint:YT,viewfieldName:"viewfield",viewfieldTint:YT},Ly=class extends Mr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.kartaview}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.kartaview.startAsync()))}filterImages(e){let i=this.context.systems.photos,r=i.fromDate,s=i.toDate,n=i.usernames;if(r){let o=new Date(r).getTime();e=e.filter(a=>new Date(a.captured_at).getTime()>=o)}if(s){let o=new Date(s).getTime();e=e.filter(a=>new Date(a.captured_at).getTime()<=o)}return n&&(e=e.filter(o=>n.indexOf(o.captured_by)!==-1)),e}filterSequences(e){let i=this.context.systems.photos,r=i.fromDate,s=i.toDate,n=i.usernames;if(r){let o=new Date(r).getTime();e=e.filter(a=>new Date(a.properties.captured_at).getTime()>=o)}if(s){let o=new Date(s).getTime();e=e.filter(a=>new Date(a.properties.captured_at).getTime()<=o)}return n&&(e=e.filter(o=>n.indexOf(o.properties.captured_by)!==-1)),e}renderMarkers(e,i,r){let s=this.context.services.kartaview;if(!s?.started)return;let n=this.scene.groups.get("streetview"),o=s.getImages(),a=s.getSequences(),l=this.filterSequences(a),u=this.filterImages(o);for(let d of l){let m=`${this.layerID}-sequence-${d.properties.id}`,g=d.properties.v||0,_=this.features.get(m);_||(_=new Sa(this,m),_.style=rZ,_.parentContainer=n,_.container.zIndex=-100),_.v!==g&&(_.v=g,_.geometry.setCoords(d.coordinates),_.setData(d.properties.id,d)),this.syncFeatureClasses(_),_.update(i,r),this.retainFeature(_,e)}for(let d of u){let m=`${this.layerID}-photo-${d.id}`,g=this.features.get(m);if(!g){let _=Object.assign({},sZ);Number.isFinite(d.ca)&&(_.viewfieldAngles=[d.ca]),d.isPano&&(_.viewfieldName="pano"),g=new Vr(this,m),g.geometry.setCoords(d.loc),g.style=_,g.parentContainer=n,g.setData(d.id,d),d.sequenceID&&g.addChildData(d.sequenceID,d.id)}this.syncFeatureClasses(g),g.update(i,r),this.retainFeature(g,e)}}render(e,i,r){let s=this.context.services.kartaview;!this.enabled||!s?.started||r<iZ||(s.loadTiles(),this.renderMarkers(e,i,r))}};var nZ=12,Ny=class extends Mr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.keepRight}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.keepRight.startAsync()))}renderMarkers(e,i,r){let s=this.context.services.keepRight;if(!s?.started)return;let n=this.scene.groups.get("qa"),o=s.getData();for(let a of o){let l=`${this.layerID}-${a.id}`,u=this.features.get(l);if(!u){let d={markerName:"keepright",markerTint:s.getColor(a.parentIssueType)};u=new Vr(this,l),u.geometry.setCoords(a.loc),u.style=d,u.parentContainer=n,u.setData(a.id,a)}this.syncFeatureClasses(u),u.update(i,r),this.retainFeature(u,e)}}render(e,i,r){let s=this.context.services.keepRight;!this.enabled||!s?.started||r<nZ||(s.loadTiles(),this.renderMarkers(e,i,r))}};var nN=Xi(kl(),1);var oZ=12,ZT={fill:3355443,fontFamily:"Arial, Helvetica, sans-serif",fontSize:11,fontWeight:600,lineJoin:"round",stroke:16777215,strokeThickness:2.7},sN={fill:3355443,fontFamily:"Arial, Helvetica, sans-serif",fontSize:11,fontStyle:"italic",fontWeight:600,lineJoin:"round",stroke:16777215,strokeThickness:2.7},Oy=class{constructor(e,i,r){this.id=e,this.type=i,this.options=r,this.displayObject=null}},By=class extends Mr{constructor(e,i){super(e,i),this.enabled=!0;let r=this.scene.groups.get("labels");r.eventMode="none";let s=new Y5(5e4);s.name="debug",s.eventMode="none",s.roundPixels=!1,s.sortableChildren=!1,this.debugContainer=s;let n=new qi;n.name="labels",n.eventMode="none",n.sortableChildren=!0,this.labelContainer=n,r.addChild(s,n),this._rbush=new nN.default,this._avoidBoxes=new Map,this._labelBoxes=new Map,this._labels=new Map,this._oldk=0,zs.from("label-normal",ZT,{chars:zs.ASCII,padding:0,resolution:2}),this._textStyleNormal=new kn(ZT),this._textStyleItalic=new kn(sN)}resetAll(){for(let e of this._labels.values())e.displayObject&&(e.displayObject.destroy({children:!0,texture:!1,baseTexture:!1}),e.displayObject=null);this._avoidBoxes.clear(),this._labelBoxes.clear(),this._labels.clear(),this._rbush.clear()}resetFeature(e){let i=new Set,r=new Set;(this._labelBoxes.get(e)||[]).forEach(s=>i.add(s)),(this._avoidBoxes.get(e)||[]).forEach(s=>i.add(s));for(let s of i.values())this._rbush.remove(s),s.labelID&&r.add(s.labelID);this._labelBoxes.delete(e),this._avoidBoxes.delete(e);for(let s of r.values()){let n=this._labels.get(s);n&&n.displayObject&&(n.displayObject.destroy({children:!0,texture:!1,baseTexture:!1}),n.displayObject=null),this._labels.delete(s)}}render(e,i,r){if(this.enabled&&r>=oZ){this.labelContainer.visible=!0,this.debugContainer.visible=this.context.getDebug("label");let s=i.scale();s!==this._oldk&&(this.resetAll(),this._oldk=s);for(let l of this.scene.features.values())l._labelDirty&&(this.resetFeature(l.id),l._labelDirty=!1);this.gatherAvoids();let n=[],o=[],a=[];for(let l of this.scene.features.values())l.label&&l.visible&&!this._labelBoxes.has(l.id)&&(l.type==="point"?n.push(l):l.type==="line"?o.push(l):l.type==="polygon"&&a.push(l));this.labelPoints(n),this.labelLines(o),this.labelPolygons(a),this.renderObjects(i)}else this.labelContainer.visible=!1,this.debugContainer.visible=!1}getLabelSprite(e,i="normal"){let r=`${e}-${i}`,s=this.renderer.textures,n=s.getTexture("text",r);if(!n){let a=0,l=e.match(/\p{M}/gu);l&&l.length>0&&(a=10),l&&l.length>20&&(a=50);let u;if(a){let b=Object.assign({},i==="normal"?ZT:sN,{padding:a});u=new kn(b)}else u=i==="normal"?this._textStyleNormal:this._textStyleItalic;let d=new Fd(e,u);d.resolution=2,d.updateText(!1);let[m,g]=[a*2,0],[_,v]=[d.canvas.width-a*4,d.canvas.height],E=d.context.getImageData(m,g,_,v);n=s.allocate("text",e,_,v,E),n.orig=d.texture.orig.clone(),n.orig.width=_/2,n.orig.height=v/2,d.destroy()}let o=new Jr(n);return o.name=e,o.anchor.set(.5,.5),o}gatherAvoids(){let e=this.context.getDebug("label"),i=l.bind(this),r=[],n=this.scene.layers.get("map-ui").container.getChildByName("selected");n&&r.push(n);let o=this.scene.groups.get("points");o&&r.push(o);let a=[];r.forEach(u=>u.children.forEach(i)),a.length&&this._rbush.load(a);function l(u){if(!u.visible||!u.renderable)return;let d=u.name;if(this._avoidBoxes.has(d))return;let m=this.scene.features.get(d),g=m&&m.sceneBounds;if(!g)return;let _=.01,v={type:"avoid",boxID:`${d}-avoid`,featureID:d,minX:g.x+_,minY:g.y+_,maxX:g.x+g.width-_,maxY:g.y+g.height-_};this._avoidBoxes.set(d,[v]),a.push(v);let E=this._rbush.search(v);for(let b of E)if(b.type==="label"){let T=this.scene.features.get(b.featureID);T&&(T._labelDirty=!0)}}}labelPoints(e){e.sort((i,r)=>r.geometry.origCoords[1]-i.geometry.origCoords[1]);for(let i of e){if(this._labelBoxes.has(i.id)||(this._labelBoxes.set(i.id,[]),!i.label))continue;let r;/^[\x20-\x7E]*$/.test(i.label)?(r=new P2(i.label,{fontName:"label-normal"}),r.updateText(),r.name=i.label,r.anchor.set(.5,1)):r=this.getLabelSprite(i.label,"normal"),this.placeTextLabel(i,r)}}labelLines(e){function i(r){let s=parseInt(r.container.parent.name,10);return isNaN(s)?999:s}e.sort((r,s)=>i(s)-i(r));for(let r of e){let s=r.id;if(this._labelBoxes.has(s)||(this._labelBoxes.set(s,[]),!r.label)||!r.geometry.coords||!r.container.visible||!r.container.renderable||r.geometry.width<40&&r.geometry.height<40)continue;let n=this.getLabelSprite(r.label,"normal");this.placeRopeLabel(r,n,r.geometry.coords)}}labelPolygons(e){for(let i of e){let r=i.id;if(this._labelBoxes.has(r)||(this._labelBoxes.set(r,[]),!i.label)||!i.geometry.flatOuter||!i.container.visible||!i.container.renderable||i.geometry.width<600&&i.geometry.height<600)continue;let s=this.getLabelSprite(i.label,"italic"),n={alignment:.5,color:0,width:24,alpha:1,join:Br.BEVEL,cap:Oi.BUTT},o=L4(i.geometry.flatOuter,n);if(!o.inner)continue;let a=new Array(o.inner.length/2);for(let l=0;l<o.inner.length/2;++l)a[l]=[o.inner[l*2],o.inner[l*2+1]];this.placeRopeLabel(i,s,a)}}placeTextLabel(e,i){if(!e||!e.sceneBounds)return;let r=e.container;if(!r.visible||!r.renderable)return;let s=e.id,n=e.sceneBounds.clone().pad(1,0),o=n.x,a=n.y,l=n.width,u=n.height,d=n.x+l,m=n.x+l*.5,g=n.y+u,_=e.type==="point"?n.y+u-14:n.y+u*.5,v=i.getLocalBounds().clone().pad(0,-1),E=5,b=10,T=v.width,A=v.height,M=T*.5,k=A*.5,F={t1:[m-b,a-k],t2:[m-E,a-k],t3:[m,a-k],t4:[m+E,a-k],t5:[m+b,a-k],b1:[m-b,g+k],b2:[m-E,g+k],b3:[m,g+k],b4:[m+E,g+k],b5:[m+b,g+k],r1:[d+M,_-b],r2:[d+M,_-E],r3:[d+M,_],r4:[d+M,_+E],r5:[d+M,_+b],l1:[o-M,_-b],l2:[o-M,_-E],l3:[o-M,_],l4:[o-M,_+E],l5:[o-M,_+b]},O;this.context.systems.l10n.isRTL()?O=["l3","l4","l2","b3","b2","b4","b1","b5","t3","t2","t4","t1","t5","r3","r4","r2","l5","l1","r5","r1"]:O=["r3","r4","r2","b3","b4","b2","b5","b1","l3","l4","l2","t3","t4","t2","t5","t1","r5","r1","l5","l1"];let U=null;for(let $=0;!U&&$<O.length;$++){let q=O[$],[W,Z]=F[q],Q=.01,X={type:"label",boxID:`${s}-${q}`,featureID:s,labelID:s,minX:W-M+Q,minY:Z-k+Q,maxX:W+M-Q,maxY:Z+k-Q};if(!this._rbush.collides(X)){let ce=new Oy(s,"text",{str:e.label,labelObj:i,x:W,y:Z,tint:e.style.labelTint||15658734});this._labels.set(s,ce),this._labelBoxes.get(s).push(X),this._rbush.insert(X),U=q}}}placeRopeLabel(e,i,r){if(!e||!i||!r||!e.container.visible||!e.container.renderable)return;let s=e.id,n=i.getLocalBounds(),o=n.width,a=n.height,l=Math.PI/8,u=a+4,d=u*.5,m=Math.ceil(o/u)+1,g=o/((m-1)*u),_=m+15,v=o6(r,u),E=[],b=[],T=[],A=null;function M(){let k=T.length>=m;k&&b.push(T),T.forEach(F=>{F.box.candidate=k,E.push(F.box)}),T=[]}v.forEach((k,F)=>{let O=k.angle;O<0&&(O+=Math.PI),k.coords.forEach((B,U)=>{let[$,q]=B,W=.01,Z={type:"label",boxID:`${s}-${F}-${U}`,featureID:s,minX:$-d+W,minY:q-d+W,maxX:$+d-W,maxY:q+d-W},Q=!1;if(A!==null){let X=Math.abs(O-A);Q=Math.min(2*Math.PI-X,X)>l}A=O,Q?(M(),Z.bendy=!0,E.push(Z)):this._rbush.collides(Z)?(M(),Z.collides=!0,E.push(Z)):(T.push({box:Z,coord:B,angle:O}),T.length===_&&M())})}),M(),b.forEach((k,F)=>{let O=Math.floor((k.length-m)/2),B=`${s}-rope-${F}`,U=[];for(let Q=O;Q<O+m;Q++){U.push(k[Q].coord);let X=k[Q].box;X.labelID=B,this._rbush.insert(X),this._labelBoxes.get(s).push(X)}if(!U.length)return;U[0][0]>U[U.length-1][0]&&U.reverse();let $=fs(U[0],U[U.length-1]),q=U.reduce((Q,X)=>Sr(Q,X),[0,0]),W=Uo(q,1/U.length);U=U.map(Q=>tr(Q,W)),U=Tu(U,-$,[0,0]),U=U.map(([Q,X])=>[Q*g,X]),U=Tu(U,$,[0,0]),U=U.map(Q=>Sr(Q,W));let Z=new Oy(B,"rope",{str:e.label,coords:U,labelObj:i,tint:e.style.labelTint||15658734});this._labels.set(B,Z)})}renderObjects(e){let i=this.context,r=i.getDebug("label"),s=i.pixi.screen,n=i.pixi.stage.position,o=new mt([s.x-n.x,s.y-n.y],[s.width-n.x,s.height-n.y]),a=new Set,l=this._rbush.search(o.bbox());for(let u of l)u.labelID&&a.add(u.labelID);for(let u of a.values()){let d=this._labels.get(u);if(!d)continue;let m=d.options;if(!d.displayObject){if(d.type==="text"){let g=m.labelObj;g.tint=m.tint||16777215,g.position.set(m.x,m.y),d.displayObject=g,this.labelContainer.addChild(g)}else if(d.type==="rope"){let g=m.labelObj,_=m.coords.map(([E,b])=>new Jt(E,b)),v=new q5(g.texture,_);v.name=u,v.autoUpdate=!1,v.sortableChildren=!1,v.tint=m.tint||16777215,d.displayObject=v,this.labelContainer.addChild(v)}}}}};var aZ=12,Uy=class extends Mr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.mapillary}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.mapillary.startAsync()))}filterDetections(e){let i=this.context.systems.photos,r=i.fromDate,s=i.toDate;if(r){let n=new Date(r).getTime();e=e.filter(o=>new Date(o.last_seen_at).getTime()>=n)}if(s){let n=new Date(s).getTime();e=e.filter(o=>new Date(o.first_seen_at).getTime()>=n)}return e}renderMarkers(e,i,r){let s=this.context.services.mapillary;if(!s?.started)return;let n=this.scene.groups.get("points"),o=s.getData("points");o=this.filterDetections(o);for(let a of o){let l=`${this.layerID}-${a.id}`,u=this.features.get(l);if(!u){let d={markerName:a.value};u=new Vr(this,l),u.geometry.setCoords(a.loc),u.style=d,u.parentContainer=n,u.setData(a.id,a)}this.syncFeatureClasses(u),u.update(i,r),this.retainFeature(u,e)}}render(e,i,r){let s=this.context.services.mapillary;this.enabled&&s?.started&&r>=aZ?(s.loadTiles("points"),s.showFeatureDetections(!0),this.renderMarkers(e,i,r)):s?.showFeatureDetections(!1)}};var lZ=12,QT=379747,cZ={casing:{alpha:0},stroke:{alpha:.9,width:4,color:QT}},uZ={markerName:"mediumCircle",markerTint:QT,viewfieldName:"viewfield",viewfieldTint:QT},zy=class extends Mr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.mapillary}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.mapillary.startAsync()))}filterImages(e){let i=this.context.systems.photos,r=i.fromDate,s=i.toDate,n=i.usernames,o=i.showsPhotoType("flat"),a=i.showsPhotoType("panoramic");if(!o&&!a)return[];if(a&&!o?e=e.filter(l=>l.isPano):!a&&o&&(e=e.filter(l=>!l.isPano)),r){let l=new Date(r).getTime();e=e.filter(u=>new Date(u.captured_at).getTime()>=l)}if(s){let l=new Date(s).getTime();e=e.filter(u=>new Date(u.captured_at).getTime()<=l)}return n&&(e=e.filter(l=>n.indexOf(l.captured_by)!==-1)),e}filterSequences(e){let i=this.context.systems.photos,r=i.fromDate,s=i.toDate,n=i.usernames,o=i.showsPhotoType("flat"),a=i.showsPhotoType("panoramic");if(!o&&!a)return[];if(a&&!o?e=e.filter(l=>l[0].properties.is_pano):!a&&o&&(e=e.filter(l=>!l[0].properties.is_pano)),r){let l=new Date(r).getTime();e=e.filter(u=>new Date(u[0].properties.captured_at).getTime()>=l)}if(s){let l=new Date(s).getTime();e=e.filter(u=>new Date(u[0].properties.captured_at).getTime()<=l)}return n&&(e=e.filter(l=>n.indexOf(l[0].properties.captured_by)!==-1)),e}renderMarkers(e,i,r){let s=this.context.services.mapillary;if(!s?.started)return;let n=this.scene.groups.get("streetview"),o=s.getSequences(),a=s.getData("images"),l=this.filterSequences(o),u=this.filterImages(a);for(let d of l)for(let m=0;m<d.length;++m){let g=d[m],_=g.properties.id,v=`${this.layerID}-sequence-${_}-${m}`,E=this.features.get(v);E||(E=new Sa(this,v),E.geometry.setCoords(g.geometry.coordinates),E.style=cZ,E.parentContainer=n,E.container.zIndex=-100,E.setData(_,g)),this.syncFeatureClasses(E),E.update(i,r),this.retainFeature(E,e)}for(let d of u){let m=`${this.layerID}-photo-${d.id}`,g=this.features.get(m);if(!g){let _=Object.assign({},uZ);Number.isFinite(d.ca)&&(_.viewfieldAngles=[d.ca]),d.isPano&&(_.viewfieldName="pano"),g=new Vr(this,m),g.geometry.setCoords(d.loc),g.style=_,g.parentContainer=n,g.setData(d.id,d),d.sequenceID&&g.addChildData(d.sequenceID,d.id)}this.syncFeatureClasses(g),g.update(i,r),this.retainFeature(g,e)}}render(e,i,r){let s=this.context.services.mapillary;!this.enabled||!s?.started||r<lZ||(s.loadTiles("images"),this.renderMarkers(e,i,r))}};var hZ=12,Gy=class extends Mr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.mapillary}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.mapillary.startAsync()))}filterDetections(e){let i=this.context.systems.photos,r=i.fromDate,s=i.toDate;if(r){let n=new Date(r).getTime();e=e.filter(o=>new Date(o.last_seen_at).getTime()>=n)}if(s){let n=new Date(s).getTime();e=e.filter(o=>new Date(o.first_seen_at).getTime()>=n)}return e}renderMarkers(e,i,r){let s=this.context.services.mapillary;if(!s?.started)return;let n=this.scene.groups.get("points"),o=s.getData("signs");o=this.filterDetections(o);for(let a of o){let l=`${this.layerID}-${a.id}`,u=this.features.get(l);if(!u){let d={markerName:a.value};u=new Vr(this,l),u.geometry.setCoords(a.loc),u.style=d,u.parentContainer=n,u.setData(a.id,a)}this.syncFeatureClasses(u),u.update(i,r),this.retainFeature(u,e)}}render(e,i,r){let s=this.context.services.mapillary;this.enabled&&s?.started&&r>=hZ?(s.loadTiles("signs"),s.showSignDetections(!0),this.renderMarkers(e,i,r)):s?.showSignDetections(!1)}};var cN=Xi(a6(),1);var l6={DEFAULT:{fill:{width:2,color:11184810,alpha:.3},casing:{width:5,color:4473924,alpha:1,cap:Oi.ROUND,join:Br.ROUND},stroke:{width:3,color:13421772,alpha:1,cap:Oi.ROUND,join:Br.ROUND}},red:{fill:{color:14708319,alpha:.3}},green:{fill:{color:9228383,alpha:.3}},blue:{fill:{color:7853278,alpha:.3}},yellow:{fill:{color:16777108,alpha:.25}},gold:{fill:{color:12893721,alpha:.3}},orange:{fill:{color:14059546,alpha:.3}},pink:{fill:{color:14918901,alpha:.3}},teal:{fill:{color:10084778,alpha:.3}},lightgreen:{fill:{color:12511295,alpha:.3}},tan:{fill:{color:16112826,alpha:.3}},darkgray:{fill:{color:9211020,alpha:.5}},lightgray:{fill:{color:11184810,alpha:.3}},motorway:{casing:{width:10,color:7354159},stroke:{width:8,color:13574273}},trunk:{casing:{width:10,color:7354159},stroke:{width:8,color:14495522}},primary:{casing:{width:10,color:7354159},stroke:{width:8,color:16357382}},secondary:{casing:{width:10,color:7354159},stroke:{width:8,color:15987474}},tertiary:{casing:{width:10,color:7354159},stroke:{width:8,color:16775603}},unclassified:{casing:{width:10,color:4473924},stroke:{width:8,color:14535850}},residential:{casing:{width:10,color:4473924},stroke:{width:8,color:16777215}},living_street:{casing:{width:7,color:16777215},stroke:{width:5,color:13421772}},service:{casing:{width:7,color:4473924},stroke:{width:5,color:16777215}},special_service:{casing:{width:7,color:4473924},stroke:{width:5,color:14535850}},track:{casing:{width:7,color:7630703},stroke:{width:5,color:12957087}},pedestrian:{casing:{width:7,color:16777215},stroke:{width:5,color:10061960,dash:[8,8],cap:Oi.BUTT}},path:{casing:{width:5,color:14535850},stroke:{width:3,color:10061960,dash:[6,6],cap:Oi.BUTT}},footway:{casing:{width:5,color:16777215},stroke:{width:3,color:10061960,dash:[6,6],cap:Oi.BUTT}},crossing_marked:{casing:{width:5,color:14535850},stroke:{width:3,color:4998212,dash:[6,3],cap:Oi.BUTT}},crossing_unmarked:{casing:{width:5,color:14535850},stroke:{width:3,color:7826026,dash:[6,4],cap:Oi.BUTT}},cycleway:{casing:{width:5,color:16777215},stroke:{width:3,color:5810669,dash:[6,6],cap:Oi.BUTT}},bridleway:{casing:{width:5,color:16777215},stroke:{width:3,color:14708063,dash:[6,6],cap:Oi.BUTT}},corridor:{casing:{width:5,color:16777215},stroke:{width:3,color:9228383,dash:[2,8],cap:Oi.ROUND}},steps:{casing:{width:5,color:16777215},stroke:{width:3,color:8507996,dash:[3,3],cap:Oi.BUTT}},river:{casing:{width:10,color:4473924},stroke:{width:8,color:7855581}},stream:{casing:{width:7,color:4473924},stroke:{width:5,color:7855581}},ridge:{stroke:{width:2,color:9228383}},runway:{casing:{width:10,color:0,cap:Oi.BUTT},stroke:{width:8,color:16777215,dash:[24,48],cap:Oi.BUTT}},taxiway:{casing:{width:7,color:4473924},stroke:{width:5,color:16776960}},railway:{casing:{width:7,color:5592405,cap:Oi.BUTT},stroke:{width:2,color:15658734,dash:[12,12],cap:Oi.BUTT}},ferry:{casing:{alpha:0},stroke:{width:3,color:5810669,dash:[12,8],cap:Oi.BUTT}},boundary:{casing:{width:6,color:8566270,cap:Oi.BUTT},stroke:{width:2,color:16777215,dash:[20,5,5,5],cap:Oi.BUTT}},boundary_park:{casing:{width:6,color:8566270,cap:Oi.BUTT},stroke:{width:2,color:11592344,dash:[20,5,5,5],cap:Oi.BUTT}},barrier:{casing:{alpha:0},stroke:{width:3,color:14540253,dash:[10,5,1,5],cap:Oi.ROUND}},barrier_wall:{casing:{alpha:0},stroke:{width:3,color:14540253,dash:[10,5,1,5],cap:Oi.ROUND}},barrier_hedge:{fill:{color:9228383,alpha:.3},casing:{alpha:0},stroke:{width:3,color:9228383,dash:[10,5,1,5],cap:Oi.ROUND}},tree_row:{casing:{width:7,color:4473924},stroke:{width:5,color:9228383}}},dZ={aeroway:{runway:"runway",taxiway:"taxiway"},amenity:{childcare:"yellow",college:"yellow",fountain:"blue",kindergarten:"yellow",parking:"darkgray",research_institute:"yellow",school:"yellow",university:"yellow"},building:{"*":"red"},barrier:{city_wall:"barrier_wall",hedge:"barrier_hedge",retaining_wall:"barrier_wall",wall:"barrier_wall","*":"barrier"},boundary:{protected_area:"boundary_park",national_park:"boundary_park","*":"boundary"},crossing:{marked:"crossing_marked",traffic_signals:"crossing_marked",uncontrolled:"crossing_marked",zebra:"crossing_marked","*":"crossing_unmarked"},golf:{green:"lightgreen"},highway:{bridleway:"bridleway",bus_guideway:"railway",busway:"special_service",corridor:"corridor",cycleway:"cycleway",footway:"footway",living_street:"living_street",living_street_link:"living_street",motorway:"motorway",motorway_link:"motorway",path:"path",pedestrian:"pedestrian",primary:"primary",primary_link:"primary",residential:"residential",residential_link:"residential",secondary:"secondary",secondary_link:"secondary",service:"service",service_link:"service",steps:"steps",tertiary:"tertiary",tertiary_link:"tertiary",track:"track",trunk:"trunk",trunk_link:"trunk",unclassified:"unclassified",unclassified_link:"unclassified"},landuse:{cemetery:"lightgreen",commercial:"orange",construction:"gold",farmland:"lightgreen",farmyard:"tan",flowerbed:"green",forest:"green",grass:"green",industrial:"pink",landfill:"orange",meadow:"lightgreen",military:"orange",orchard:"lightgreen",quarry:"darkgray",railway:"darkgray",recreation_ground:"green",residential:"gold",retail:"orange",village_green:"green",vineyard:"lightgreen"},leisure:{garden:"green",golf_course:"green",nature_reserve:"green",park:"green",pitch:"green",swimming_pool:"blue",track:"yellow"},man_made:{adit:"darkgray",breakwater:"barrier_wall",groyne:"barrier_wall"},military:{"*":"orange"},natural:{bare_rock:"darkgray",bay:"blue",beach:"yellow",cave_entrance:"darkgray",cliff:"darkgray",glacier:"lightgray",ridge:"ridge",rock:"darkgray",sand:"yellow",scree:"darkgray",scrub:"yellow",shingle:"darkgray",stone:"darkgray",tree_row:"tree_row",water:"blue",wetland:"teal","*":"green"},power:{plant:"pink"},railway:{platform:"footway","*":"railway"},route:{ferry:"ferry"},sport:{baseball:"yellow",basketball:"darkgray",beachvolleyball:"yellow",skateboard:"darkgray",softball:"yellow"},type:{waterway:"river"},waterway:{river:"river",dam:"DEFAULT",weir:"DEFAULT","*":"stream"},service:{alley:"special_service",driveway:"special_service","drive-through":"special_service",parking_aisle:"special_service","*":"special_service"}},fZ={amenity:{fountain:"water_standing",grave_yard:"cemetery"},golf:{green:"grass"},landuse:{cemetery:"cemetery",construction:"construction",farmland:"farmland",farmyard:"farmyard",forest:"forest",grass:"grass",grave_yard:"cemetery",landfill:"landfill",meadow:"grass",military:"construction",orchard:"orchard",quarry:"quarry",vineyard:"vineyard"},leaf_type:{broadleaved:"forest_broadleaved",leafless:"forest_leafless",needleleaved:"forest_needleleaved"},natural:{beach:"dots",grassland:"grass",sand:"dots",scrub:"bushes",water:"waves",wetland:"wetland",wood:"forest"},religion:{buddhist:"cemetery_buddhist",christian:"cemetery_christian",jewish:"cemetery_jewish",muslim:"cemetery_muslim"},surface:{grass:"grass"},water:{pond:"pond",reservoir:"lines"},wetland:{bog:"wetland_bog",marsh:"wetland_marsh",reedbed:"wetland_reedbed",swamp:"wetland_swamp"}},pZ={motorway:!0,motorway_link:!0,trunk:!0,trunk_link:!0,primary:!0,primary_link:!0,secondary:!0,secondary_link:!0,tertiary:!0,tertiary_link:!0,unclassified:!0,unclassified_link:!0,residential:!0,residential_link:!0,living_street:!0,living_street_link:!0,service:!0,service_link:!0,bus_guideway:!0,track:!0};function gh(t){let e=l6.DEFAULT,i=999;for(let[_,v]of Object.entries(t)){let E=dZ[_];if(!E||!v)continue;let b=Object.keys(E).length,T=E[v]||E["*"];if(T&&b<=i){if(!l6[T]){console.error(`invalid stylename: ${T}`);continue}if(e=l6[T],i=b,i===1)break}}let r={};for(let _ of["fill","casing","stroke"]){r[_]={};for(let v of["width","color","alpha","cap","dash"]){let E=e[_]&&e[_][v];if(E!==void 0){r[_][v]=E;continue}let b=l6.DEFAULT[_]&&l6.DEFAULT[_][v];b!==void 0&&(r[_][v]=b)}}let s=g(t,"bridge"),n=g(t,"building"),o=g(t,"cutting"),a=g(t,"embankment"),l=g(t,"highway"),u=g(t,"tracktype"),d=g(t,"tunnel"),m=g(t,"surface");if(l==="track"&&u!=="grade1"&&(m=m||"dirt"),(s||a||o)&&(r.casing.width+=7,r.casing.color=0,r.casing.cap=Oi.BUTT,(a||o)&&(r.casing.dash=[2,4])),d&&(r.stroke.alpha=.5),m&&pZ[l]&&!rd.surface[m]&&(s||(r.casing.color=13421772),r.casing.cap=Oi.BUTT,r.casing.dash=[4,4]),r.fill.pattern||n)return r;i=999;for(let _ in t){let v=t[_],E=fZ[_];if(!E||!v)continue;let b=Object.keys(E).length,T=E[v];if(T||(T=E["*"]),T&&b<=i&&(r.fill.pattern=T,i=b,i===1))break}return r;function g(_,v){return _[v]==="no"?void 0:_[v]}}var mZ=12,Hy=class extends Mr{constructor(e,i){super(e,i),this.enabled=!0;let r=this.scene.groups.get("basemap");this._resolved=new Map;let s=new qi;s.name=`${this.layerID}-areas`,s.sortableChildren=!0,this.areaContainer=s;let n=new qi;n.name=`${this.layerID}-lines`,n.sortableChildren=!0,this.lineContainer=n,r.addChild(s,n)}get supported(){return!!this.context.services.osm}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.osm.startAsync()))}render(e,i,r){let s=this.context.services.osm;if(!this.enabled||!s?.started||r<mZ)return;let n=this.context,o=n.graph(),a=n.systems.map;n.loadTiles(n.projection);let l=n.systems.edits.intersects(a.extent());l=n.systems.filters.filter(l,o);let u={polygons:new Map,lines:new Map,points:new Map,vertices:new Map};for(let b of l){let T=b.geometry(o);T==="point"?u.points.set(b.id,b):T==="vertex"?u.vertices.set(b.id,b):T==="line"?u.lines.set(b.id,b):T==="area"&&u.polygons.set(b.id,b)}this.renderPolygons(e,i,r,u),this.renderLines(e,i,r,u),this.renderPoints(e,i,r,u);let d=this._classHasData.get("selected")??new Set,m=this._classHasData.get("hovered")??new Set,g=this._classHasData.get("drawing")??new Set,_=new Set([...d,...m,...g]);for(let b of _){if(n.hasEntity(b)?.type==="node")continue;let A=this._dataHasFeature.get(b)??new Set,M=!1;for(let k of A){let F=this.features.get(k)?.geometry;if(!(!F||F.type==="point")&&F.width<25&&F.height<25){M=!0;break}}M&&_.delete(b)}let v=new Set(_);for(let b of _){let T=n.hasEntity(b);if(T?.type==="node")for(let A of o.parentWays(T))v.add(A.id)}let E={descendantIDs:new Set,siblingIDs:new Set};for(let b of v)this.getSelfAndDescendants(b,E.descendantIDs),this.getSelfAndSiblings(b,E.siblingIDs);this.renderVertices(e,i,r,u,E),n.mode?.id==="select-osm"&&this.renderMidpoints(e,i,r,u,E)}renderPolygons(e,i,r,s){let n=s.polygons,o=this.context,a=o.graph(),l=o.systems.l10n,u=o.systems.presets,d=this.scene.groups.get("points"),m=o.systems.filters.isEnabled("points");function g(_){return!_||_.isFallback()||/^(address|building|indoor|landuse|man_made|military|natural|playground)/.test(_.id)?!1:!!(/^(club|craft|emergency|healthcare|office|power|shop|telecom|tourism)/.test(_.id)||/^amenity\/(?!parking|shelter)/.test(_.id)||/^leisure\/(?!garden|firepit|picnic_table|pitch|swimming_pool)/.test(_.id))}for(let[_,v]of n){let E=v.v||0,b=this._resolved.get(_);b?.v!==E&&(b=null),b||(b=(0,cN.default)(v.asGeoJSON(a),!0),b.v=E,this._resolved.set(_,b));let T=b.type==="Polygon"?[b.coordinates]:b.type==="MultiPolygon"?b.coordinates:[];for(let A=0;A<T.length;++A){let M=T[A],k=`${this.layerID}-${_}-fill-${A}`,F=this.features.get(k);if(F&&F.type!=="polygon"&&(F.destroy(),F=null),F||(F=new Yc(this,k),F.parentContainer=this.areaContainer),F.v!==E){F.v=E,F.geometry.setCoords(M);let O=F.geometry.origExtent.area();F.container.zIndex=-O,F.setData(_,v),F.clearChildData(_),v.type==="relation"&&v.members.forEach(B=>F.addChildData(_,B.id)),v.type==="way"&&v.nodes.forEach(B=>F.addChildData(_,B))}if(this.syncFeatureClasses(F),F.dirty){let O=u.match(v,a),B=gh(v.tags);B.labelTint=B.fill.color??B.stroke.color??15658734,F.style=B;let U=l.displayPOIName(v.tags);F.label=U,m&&(U||g(O))?(F.poiFeatureID=`${this.layerID}-${_}-poi-${A}`,F.poiPreset=O):(F.poiFeatureID=null,F.poiPreset=null)}if(F.update(i,r),this.retainFeature(F,e),F.poiFeatureID&&F.poiPreset&&F.geometry.origPoi){let O=this.features.get(F.poiFeatureID);if(O||(O=new Vr(this,F.poiFeatureID),O.virtual=!0,O.parentContainer=d),O.v!==E&&(O.v=E,O.geometry.setCoords(F.geometry.origPoi),O.setData(_,v)),this.syncFeatureClasses(O),O.dirty){let B={iconName:F.poiPreset.icon,iconTint:1118481,markerName:"pin",markerTint:16777215};KT(v)&&(B.iconTint=4473924,B.labelTint=14540253,B.markerName="boldPin",B.markerTint=14540253),O.style=B,O.label=F.label}O.update(i,r),this.retainFeature(O,e)}}}}renderLines(e,i,r,s){let n=s.lines,o=this.context,a=o.graph(),l=o.systems.l10n,u=this.lineContainer;for(let[m,g]of n){let _=typeof g.layer=="function"?g.layer():0,v=d(_.toString()),E=yZ(g.tags),b=g.v||0,T=this._resolved.get(m);T?.v!==b&&(T=null),T||(T=g.asGeoJSON(a),T.v=b,T.type==="LineString"&&g.tags.oneway==="-1"&&T.coordinates.reverse(),this._resolved.set(m,T));let A=T.type==="LineString"?[[T.coordinates]]:T.type==="Polygon"?[T.coordinates]:T.type==="MultiPolygon"?T.coordinates:[];for(let M=0;M<A.length;++M){let k=A[M];for(let F=0;F<k.length;++F){let O=k[F],B=`${this.layerID}-${m}-${M}-${F}`,U=this.features.get(B);if(U&&U.type!=="line"&&(U.destroy(),U=null),U||(U=new Sa(this,B)),U.v!==b&&(U.v=b,U.geometry.setCoords(O),U.parentContainer=v,U.container.zIndex=E,U.setData(m,g),U.clearChildData(m),g.type==="relation"&&g.members.forEach($=>U.addChildData(m,$.id)),g.type==="way"&&g.nodes.forEach($=>U.addChildData(m,$))),this.syncFeatureClasses(U),U.dirty){let $=g.tags,q=g.geometry(a);if(!g.hasInterestingTags()){let Z=a.parentRelations(g).find(Q=>Q.isMultipolygon());Z&&($=Z.tags,q="area")}let W=gh($);q==="line"?(W.lineMarkerName=g.isOneWay()?"oneway":"",W.sidedMarkerName=g.isSided()?"sided":""):(W.casing.width=0,W.stroke.color=W.fill.color,W.stroke.width=2,W.stroke.alpha=1),U.style=W,U.label=l.displayName(g.tags)}U.update(i,r),this.retainFeature(U,e)}}}function d(m){let g=u.getChildByName(m);return g||(g=new qi,g.name=m.toString(),g.sortableChildren=!0,g.zIndex=m,u.addChild(g)),g}}renderVertices(e,i,r,s,n){let o=s.vertices,a=this.context,l=a.graph(),u=a.systems.l10n,d=a.systems.presets,g=this.scene.layers.get("map-ui").container.getChildByName("selected"),_=this.scene.groups.get("points");function v(b){return b.hasInterestingTags()||b.isEndpoint(l)||b.isIntersection(l)}function E(b){return n.descendantIDs.has(b)||n.siblingIDs.has(b)}for(let[b,T]of o){let A=null;if(r>=16&&v(T)&&(A=_),E(b)&&(A=g),!A)continue;let M=`${this.layerID}-${b}`,k=T.v||0,F=this.features.get(M);if(F&&F.type!=="point"&&(F.destroy(),F=null),F||(F=new Vr(this,M)),F.v!==k&&(F.v=k,F.geometry.setCoords(T.loc),F.setData(b,T)),this.syncFeatureClasses(F),F.parentContainer=A,F.dirty){let B=d.match(T,l)?.icon,U=T.directions(l,a.projection),$={iconName:B,iconTint:1118481,labelTint:15658734,markerName:"smallCircle",markerTint:16777215,viewfieldAngles:U,viewfieldName:"viewfieldDark",viewfieldTint:16777215};B?($.markerName="largeCircle",$.iconName=B):T.hasInterestingTags()&&($.markerName="taggedCircle"),KT(T)&&($.iconTint=4473924,$.labelTint=14540253,$.markerTint=14540253),l.isShared(T)&&($.iconTint=1118481,$.labelTint=12303291,$.markerTint=12303291),F.style=$,F.label=u.displayName(T.tags)}F.update(i,r),this.retainFeature(F,e)}}renderPoints(e,i,r,s){let n=s.points,o=this.context,a=o.graph(),l=o.systems.l10n,u=o.systems.presets,d=this.scene.groups.get("points");for(let[m,g]of n){let _=`${this.layerID}-${m}`,v=g.v||0,E=this.features.get(_);if(E&&E.type!=="point"&&(E.destroy(),E=null),E||(E=new Vr(this,_),E.parentContainer=d),E.v!==v&&(E.v=v,E.geometry.setCoords(g.loc),E.setData(m,g)),this.syncFeatureClasses(E),E.dirty){let b=u.match(g,a),T=b?.icon;T||(b=u.matchTags(g.tags,"vertex"),T=b?.icon);let A=g.directions(a,o.projection),M={iconName:T,iconTint:1118481,markerName:"pin",markerTint:16777215,viewfieldAngles:A,viewfieldName:"viewfieldDark",viewfieldTint:16777215};KT(g)&&(M.iconTint=4473924,M.labelTint=14540253,M.markerName="boldPin",M.markerTint=14540253),b.id==="address"&&(M.iconName="maki-circle-stroked",M.markerName="largeCircle"),E.style=M,E.label=l.displayName(g.tags)}E.update(i,r),this.retainFeature(E,e)}}renderMidpoints(e,i,r,s,n){let a=this.context.graph(),l=new Map([...s.lines,...s.polygons]),d=this.scene.layers.get("map-ui").container.getChildByName("selected"),m=new Map,g={markerName:"midpoint"};for(let[_,v]of l){if(!n.descendantIDs.has(_))continue;let E=a.childNodes(v);if(!E.length)continue;let b=E.map(T=>({id:T.id,point:i.project(T.loc)}));v.tags.oneway==="-1"&&b.reverse(),b.slice(0,-1).forEach((T,A)=>{let M=b[A],k=b[A+1],F=[M.id,k.id].sort().join("-");if(Hi(M.point,k.point)<40)return;let B=pr(M.point,k.point,.5),U=fs(M.point,k.point),$=i.invert(B),q={type:"midpoint",id:F,a:M,b:k,way:v,loc:$,rot:U};m.has(F)||m.set(F,q)})}for(let[_,v]of m){let E=`${this.layerID}-${_}`,b=this.features.get(E);b||(b=new Vr(this,E),b.style=g,b.parentContainer=d),b.v!==v.loc&&(b.v=v.loc,b.geometry.setCoords(v.loc),b.container.rotation=v.rot,b.setData(_,v),b.addChildData(v.way.id,_)),this.syncFeatureClasses(b),b.update(i,r),this.retainFeature(b,e)}}},gZ={motorway:0,motorway_link:-1,trunk:-2,trunk_link:-3,primary:-4,primary_link:-5,secondary:-6,tertiary:-7,unclassified:-8,residential:-9,service:-10,track:-11,footway:-12};function yZ(t){return gZ[t.highway]||0}function KT(t){return t.tags.wikidata||t.tags["flag:wikidata"]||t.tags["brand:wikidata"]||t.tags["network:wikidata"]||t.tags["operator:wikidata"]}var _Z=12,Vy=class extends Mr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.osm}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.osm.startAsync()))}renderMarkers(e,i,r){let s=this.context.services.osm;if(!s?.started)return;let n=this.scene.groups.get("qa"),o=s.notes(this.context.projection);for(let a of o){let l=`${this.layerID}-${a.id}`,u=this.features.get(l);if(!u){let d=16724736,m="rapid-icon-close";a.status==="closed"&&(d=5627136,m="rapid-icon-apply"),a.isNew()&&(d=16772608,m="rapid-icon-plus");let g={markerName:"osmnote",markerTint:d,iconName:m,anchor:{y:.65}};u=new Vr(this,l),u.geometry.setCoords(a.loc),u.style=g,u.parentContainer=n,u.setData(a.id,a)}this.syncFeatureClasses(u),u.update(i,r),this.retainFeature(u,e)}}render(e,i,r){let s=this.context.services.osm;!this.enabled||!s?.started||r<_Z||(s.loadNotes(this.context.projection),this.renderMarkers(e,i,r))}};var xZ=12,jy=class extends Mr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.osmose}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.osmose.startAsync()))}renderMarkers(e,i,r){let s=this.context.services.osmose;if(!s?.started)return;let n=this.scene.groups.get("qa"),o=s.getData();for(let a of o){let l=`${this.layerID}-${a.id}`,u=this.features.get(l);if(!u){let d={markerName:"osmose",markerTint:s.getColor(a.item),iconName:a.icon};u=new Vr(this,l),u.geometry.setCoords(a.loc),u.style=d,u.parentContainer=n,u.setData(a.id,a)}this.syncFeatureClasses(u),u.update(i,r),u._isCircular||u.icon.position.set(0,-17),this.retainFeature(u,e)}}render(e,i,r){let s=this.context.services.osmose;!this.enabled||!s?.started||r<xZ||(s.loadTiles(),this.renderMarkers(e,i,r))}};var uN=Xi(a6(),1);var vZ=12,Xy=class extends Mr{constructor(e,i){super(e,i),this.enabled=!0,this._resolved=new Map}get supported(){let e=this.context.services;return!!e.mapwithai||!!e.esri}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.mapwithai.startAsync(),this.context.services.esri.startAsync()))}render(e,i,r){let s=this.context.systems.rapid;if(!(!this.enabled||!s.datasets.size||r<vZ))for(let n of s.datasets.values())this.renderDataset(n,e,i,r)}renderDataset(e,i,r,s){let n=this.context,o=n.systems.rapid;if(!(e.added&&e.enabled))return;let l=n.services[e.service];if(!l?.started)return;let u=e.id+(e.conflated?"-conflated":""),d=l.graph(u);function m(M){return o.acceptedIDs.has(M.id)||o.acceptedIDs.has(M.__origid__)}let g={points:[],vertices:new Set,lines:[],polygons:[]};if(e.service==="mapwithai"){s>=15&&l.loadTiles(u);let M=l.getData(u).filter(k=>k.type==="way"&&!m(k));e.id==="fbRoads"||e.id==="rapid_intro_graph"?(g.lines=M.filter(k=>k.geometry(d)==="line"&&!!k.tags.highway),g.lines.forEach(k=>{let F=d.entity(k.first()),O=d.entity(k.last());g.vertices.add(F),g.vertices.add(O)})):g.polygons=M.filter(k=>k.geometry(d)==="area")}else if(e.service==="esri"){s>=14&&l.loadTiles(u);let M=l.getData(u);for(let k of M){if(m(k))continue;let F=k.geometry(d);F==="point"&&k.__fbid__?g.points.push(k):F==="line"?g.lines.push(k):F==="area"&&g.polygons.push(k)}}let _=this.scene.groups.get("points"),v=this.scene.groups.get("basemap"),E=`${this.layerID}-${e.id}-areas`,b=`${this.layerID}-${e.id}-lines`,T=v.getChildByName(E);T||(T=new qi,T.name=E,T.sortableChildren=!0,v.addChild(T));let A=v.getChildByName(b);A||(A=new qi,A.name=b,A.sortableChildren=!0,v.addChild(A)),this.renderPolygons(T,e,d,i,r,s,g),this.renderLines(A,e,d,i,r,s,g),this.renderPoints(_,e,d,i,r,s,g)}renderPolygons(e,i,r,s,n,o,a){let l=new fi(i.color),u=this.context.systems.l10n;for(let d of a.polygons){let m=this._resolved.get(d.id);m||(m=(0,uN.default)(d.asGeoJSON(r),!0),this._resolved.set(d.id,m));let g=m.type==="Polygon"?[m.coordinates]:m.type==="MultiPolygon"?m.coordinates:[];for(let _=0;_<g.length;++_){let v=g[_],E=`${this.layerID}-${i.id}-${d.id}-${_}`,b=this.features.get(E);if(!b){b=new Yc(this,E),b.geometry.setCoords(v);let T=b.geometry.origExtent.area();b.container.zIndex=-T,b.parentContainer=e,b.rapidFeature=!0,b.setData(d.id,d)}if(this.syncFeatureClasses(b),b.dirty){let T={labelTint:l,fill:{width:2,color:l,alpha:.3}};b.style=T,b.label=u.displayName(d.tags),b.update(n,o)}this.retainFeature(b,s)}}}renderLines(e,i,r,s,n,o,a){let l=new fi(i.color),u=this.context.systems.l10n;for(let d of a.lines){let m=`${this.layerID}-${i.id}-${d.id}`,g=this.features.get(m);if(!g){let v=d.asGeoJSON(r).coordinates;d.tags.oneway==="-1"&&v.reverse(),g=new Sa(this,m),g.geometry.setCoords(v),g.parentContainer=e,g.rapidFeature=!0,g.setData(d.id,d)}if(this.syncFeatureClasses(g),g.dirty){let _={labelTint:l,casing:{width:5,color:4473924},stroke:{width:3,color:l}};_.lineMarkerName=d.isOneWay()?"oneway":"",g.style=_,g.label=u.displayName(d.tags),g.update(n,o)}this.retainFeature(g,s)}}renderPoints(e,i,r,s,n,o,a){let l=new fi(i.color),u=this.context.systems.l10n,d={markerName:"largeCircle",markerTint:l,iconName:"maki-circle-stroked",labelTint:l},m={markerName:"smallCircle",markerTint:l,labelTint:l};for(let g of a.points){let _=`${this.layerID}-${i.id}-${g.id}`,v=this.features.get(_);if(v||(v=new Vr(this,_),v.geometry.setCoords(g.loc),v.parentContainer=e,v.rapidFeature=!0,v.setData(g.id,g)),this.syncFeatureClasses(v),v.dirty){v.style=d,v.label=u.displayName(g.tags);let E=g.tags["addr:housenumber"];!v.label&&E&&(v.label=E),v.update(n,o)}this.retainFeature(v,s)}for(let g of a.vertices){let _=`${this.layerID}-${g.id}`,v=this.features.get(_);if(v||(v=new Vr(this,_),v.geometry.setCoords(g.loc),v.parentContainer=e,v.rapidFeature=!0,v.allowInteraction=!1,v.setData(g.id,g)),this.syncFeatureClasses(v),v.dirty){v.style=m,v.label=u.displayName(g.tags);let E=g.tags["addr:housenumber"];!v.label&&E&&(v.label=E),v.update(n,o)}this.retainFeature(v,s)}}};var Wy=class extends Mr{constructor(e,i){super(e,i),this.enabled=!0;let r=new qi;r.name=i,r.sortableChildren=!0,this.container=r,this.scene.groups.get("ui").addChild(r),this._oldk=0,this._geolocationData=null,this._geolocationDirty=!1;let n=new qi;n.name="geolocation",n.eventMode="none",n.sortableChildren=!1,n.visible=!1,this.geolocationContainer=n;let o=new qi;o.name="tile-debug",o.eventMode="none",o.sortableChildren=!1,o.visible=!1,this.tileDebugContainer=o;let a=new qi;a.name="selected",a.sortableChildren=!0,a.visible=!0,this.selectedContainer=a,this._lassoPolygonData=null,this._lassoPolygonDirty=!1,this._lassoLineGraphics=new Gi,this._lassoFillGraphics=new Gi;let l=new qi;l.name="lasso",l.eventMode="none",l.sortableChildren=!1,l.visible=!0,l.addChild(this._lassoLineGraphics,this._lassoFillGraphics),this.lassoContainer=l,this.container.addChild(n,o,a,l)}get enabled(){return!0}set enabled(e){this._enabled=!0}get geolocationData(){return this._geolocationData}set geolocationData(e){this._geolocationData=e,this._geolocationDirty=!0}get lassoPolygonData(){return this._lassoPolygonData}set lassoPolygonData(e){this._lassoPolygonData=e,this._lassoPolygonDirty=!0}render(e,i){let r=i.scale();r!==this._oldk&&(this._geolocationDirty=!0,this._lassoPolygonDirty=!0,this._oldk=r),this._geolocationDirty&&this.renderGeolocation(e,i),this._lassoPolygonDirty&&this.renderLasso(e,i)}renderLasso(e,i){this._lassoPolygonDirty&&(this._lassoPolygonDirty=!1);let r={alpha:.7,dash:[6,3],width:1,color:16777215};if(!this._lassoPolygonData&&this._lassoLineGraphics.parent)this.lassoContainer.removeChildren();else if(this._lassoLineGraphics.parent||(this.lassoContainer.addChild(this._lassoLineGraphics),this.lassoContainer.addChild(this._lassoFillGraphics)),this._lassoLineGraphics.clear(),this._lassoFillGraphics.clear(),this._lassoPolygonData?.length>0){let s=this._lassoPolygonData.map(n=>i.project(n));new Pl(this._lassoLineGraphics,r).drawPolygon(s.flat()),this._lassoFillGraphics.beginFill(11184810,.5).drawPolygon(s.flat()).endFill()}}renderGeolocation(e,i){if(this._geolocationDirty)if(this._geolocationDirty=!1,this.geolocationContainer.removeChildren(),this.geolocationData&&this.geolocationData.coords){let r=this.geolocationData.coords,s=[r.longitude,r.latitude],[n,o]=i.project(s),a=Cn(r.accuracy,s[1]),l=[r.longitude+a,r.latitude],u=i.project(l)[0],d=Math.max(Math.abs(u-n),15),m=942335,g=new Gi().beginFill(m,.4).drawCircle(n,o,d).endFill();if(g.name="aura",this.geolocationContainer.addChild(g),r.heading!==null&&!isNaN(r.heading)){let v=this.renderer.textures,E=new Jr(v.get("viewfieldDark"));E.anchor.set(.5,1),E.angle=r.heading,E.name="heading",E.position.set(n,o),this.geolocationContainer.addChild(E)}let _=new Gi().lineStyle(1.5,16777215,1).beginFill(m,1).drawCircle(n,o,6.5).endFill();_.name="position",this.geolocationContainer.addChild(_),this.geolocationContainer.visible=!0}else this.geolocationContainer.visible=!1}};var bZ=12,JT=1048516,wZ={casing:{alpha:0},stroke:{alpha:.9,width:4,color:JT}},EZ={markerName:"mediumCircle",markerTint:JT,viewfieldName:"viewfield",viewfieldTint:JT},qy=class extends Mr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.streetside}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.streetside.startAsync()))}filterImages(e){let i=this.context.systems.photos,r=i.fromDate,s=i.toDate,n=i.usernames;if(r){let o=new Date(r).getTime();e=e.filter(a=>new Date(a.captured_at).getTime()>=o)}if(s){let o=new Date(s).getTime();e=e.filter(a=>new Date(a.captured_at).getTime()<=o)}return n&&(e=e.filter(o=>n.includes(o.captured_by))),e}filterSequences(e){let i=this.context.systems.photos,r=i.fromDate,s=i.toDate,n=i.usernames;if(r){let o=new Date(r).getTime();e=e.filter(a=>new Date(a.captured_at).getTime()>=o)}if(s){let o=new Date(s).getTime();e=e.filter(a=>new Date(a.captured_at).getTime()<=o)}return n&&(e=e.filter(o=>n.includes(o.captured_by))),e}renderMarkers(e,i,r){let s=this.context.services.streetside;if(!s?.started)return;let n=this.scene.groups.get("streetview"),o=s.getImages(),a=s.getSequences(),l=this.filterSequences(a),u=this.filterImages(o);for(let d of l){let m=d.id,g=`${this.layerID}-sequence-${m}`,_=d.v||0,v=this.features.get(g);v||(v=new Sa(this,g),v.style=wZ,v.parentContainer=n,v.container.zIndex=-100),v.v!==_&&(v.v=_,v.geometry.setCoords(d.coordinates),v.setData(m,d),v.clearChildData(m),d.bubbleIDs.forEach(E=>v.addChildData(m,E))),this.syncFeatureClasses(v),v.update(i,r),this.retainFeature(v,e)}for(let d of u){let m=d.id,g=`${this.layerID}-photo-${m}`,_=this.features.get(g);if(!_){let v=Object.assign({},EZ);Number.isFinite(d.ca)&&(v.viewfieldAngles=[d.ca]),d.isPano&&(v.viewfieldName="pano"),_=new Vr(this,g),_.geometry.setCoords(d.loc),_.style=v,_.parentContainer=n,_.setData(m,d)}this.syncFeatureClasses(_),_.update(i,r),this.retainFeature(_,e)}}render(e,i,r){let s=this.context.services.streetside;!this.enabled||!s?.started||r<bZ||(s.loadTiles(),this.renderMarkers(e,i,r))}};function vo(t,e){return Array.from(t.getElementsByTagName(e))}function Zy(t){return t[0]==="#"?t:`#${t}`}function TZ(t,e,i){return Array.from(t.getElementsByTagNameNS(i,e))}function ro(t){return t?.normalize(),t&&t.textContent||""}function ia(t,e,i){let r=t.getElementsByTagName(e),s=r.length?r[0]:null;return s&&i&&i(s),s}function Rl(t,e,i){let r={};if(!t)return r;let s=t.getElementsByTagName(e),n=s.length?s[0]:null;return n&&i?i(n,r):r}function n0(t,e,i){let r=ro(ia(t,e));return r&&i?i(r)||{}:{}}function hN(t,e,i){let r=parseFloat(ro(ia(t,e)));if(!isNaN(r))return r&&i?i(r)||{}:{}}function s0(t,e,i){let r=parseFloat(ro(ia(t,e)));if(!isNaN(r))return i&&i(r),r}function c6(t,e){let i={};for(let r of e)n0(t,r,s=>{i[r]=s});return i}function iS(t){return t?.nodeType===1}function dN(t){return Rl(t,"line",e=>Object.assign({},n0(e,"color",r=>({stroke:`#${r}`})),hN(e,"opacity",r=>({"stroke-opacity":r})),hN(e,"width",r=>({"stroke-width":r*96/25.4}))))}function fN(t){let e=[];if(t===null)return e;for(let i of Array.from(t.childNodes)){if(!iS(i))continue;let r=SZ(i.nodeName);if(r==="gpxtpx:TrackPointExtension")e=e.concat(fN(i));else{let s=ro(i);e.push([r,AZ(s)])}}return e}function SZ(t){return["heart","gpxtpx:hr","hr"].includes(t)?"heart":t}function AZ(t){let e=parseFloat(t);return isNaN(e)?t:e}function pN(t){let e=[parseFloat(t.getAttribute("lon")||""),parseFloat(t.getAttribute("lat")||"")];if(isNaN(e[0])||isNaN(e[1]))return null;s0(t,"ele",r=>{e.push(r)});let i=ia(t,"time");return{coordinates:e,time:i?ro(i):null,extendedValues:fN(ia(t,"extensions"))}}function rS(t){let e=c6(t,["name","cmt","desc","type","time","keywords"]),i=Array.from(t.getElementsByTagNameNS("http://www.garmin.com/xmlschemas/GpxExtensions/v3","*"));for(let s of i)s.parentNode?.parentNode===t&&(e[s.tagName.replace(":","_")]=ro(s));let r=vo(t,"link");return r.length&&(e.links=r.map(s=>Object.assign({href:s.getAttribute("href")},c6(s,["text","type"])))),e}function mN(t,e){let i=vo(t,e),r=[],s=[],n={};for(let o=0;o<i.length;o++){let a=pN(i[o]);if(a){r.push(a.coordinates),a.time&&s.push(a.time);for(let[l,u]of a.extendedValues){let d=l==="heart"?l:l.replace("gpxtpx:","")+"s";n[d]||(n[d]=Array(i.length).fill(null)),n[d][o]=u}}}if(!(r.length<2))return{line:r,times:s,extendedValues:n}}function CZ(t){let e=mN(t,"rtept");if(e)return{type:"Feature",properties:Object.assign({_gpxType:"rte"},rS(t),dN(ia(t,"extensions"))),geometry:{type:"LineString",coordinates:e.line}}}function IZ(t){let e=vo(t,"trkseg"),i=[],r=[],s=[];for(let a of e){let l=mN(a,"trkpt");l&&(s.push(l),l.times&&l.times.length&&r.push(l.times))}if(s.length===0)return null;let n=s.length>1,o=Object.assign({_gpxType:"trk"},rS(t),dN(ia(t,"extensions")),r.length?{coordinateProperties:{times:n?r:r[0]}}:{});for(let a of s){i.push(a.line),o.coordinateProperties||(o.coordinateProperties={});let l=o.coordinateProperties,u=Object.entries(a.extendedValues);for(let d=0;d<u.length;d++){let[m,g]=u[d];n?(l[m]||(l[m]=s.map(_=>new Array(_.line.length).fill(null))),l[m][d]=g):l[m]=g}}return{type:"Feature",properties:o,geometry:n?{type:"MultiLineString",coordinates:i}:{type:"LineString",coordinates:i[0]}}}function kZ(t){let e=Object.assign(rS(t),c6(t,["sym"])),i=pN(t);return i?{type:"Feature",properties:e,geometry:{type:"Point",coordinates:i.coordinates}}:null}function*MZ(t){for(let e of vo(t,"trk")){let i=IZ(e);i&&(yield i)}for(let e of vo(t,"rte")){let i=CZ(e);i&&(yield i)}for(let e of vo(t,"wpt")){let i=kZ(e);i&&(yield i)}}function Ky(t){return{type:"FeatureCollection",features:Array.from(MZ(t))}}function gN(t,e){let i={},r=e=="stroke"||e==="fill"?e:e+"-color";return t[0]==="#"&&(t=t.substring(1)),t.length===6||t.length===3?i[r]="#"+t:t.length===8&&(i[e+"-opacity"]=parseInt(t.substring(0,2),16)/255,i[r]="#"+t.substring(6,8)+t.substring(4,6)+t.substring(2,4)),i}function Qy(t,e,i){let r={};return s0(t,e,s=>{r[i]=s}),r}function sS(t,e){return Rl(t,"color",i=>gN(ro(i),e))}function yN(t){return Rl(t,"Icon",(e,i)=>(n0(e,"href",r=>{i.icon=r}),i))}function PZ(t){return Rl(t,"IconStyle",e=>Object.assign(sS(e,"icon"),Qy(e,"scale","icon-scale"),Qy(e,"heading","icon-heading"),Rl(e,"hotSpot",i=>{let r=parseFloat(i.getAttribute("x")||""),s=parseFloat(i.getAttribute("y")||""),n=i.getAttribute("xunits")||"",o=i.getAttribute("yunits")||"";return!isNaN(r)&&!isNaN(s)?{"icon-offset":[r,s],"icon-offset-units":[n,o]}:{}}),yN(e)))}function RZ(t){return Rl(t,"LabelStyle",e=>Object.assign(sS(e,"label"),Qy(e,"scale","label-scale")))}function DZ(t){return Rl(t,"LineStyle",e=>Object.assign(sS(e,"stroke"),Qy(e,"width","stroke-width")))}function FZ(t){return Rl(t,"PolyStyle",(e,i)=>Object.assign(i,Rl(e,"color",r=>gN(ro(r),"fill")),n0(e,"fill",r=>{if(r==="0")return{"fill-opacity":0}}),n0(e,"outline",r=>{if(r==="0")return{"stroke-opacity":0}})))}function nS(t){return Object.assign({},FZ(t),DZ(t),RZ(t),PZ(t))}var N4=t=>Number(t),eS={string:t=>t,int:N4,uint:N4,short:N4,ushort:N4,float:N4,double:N4,bool:t=>!!t};function _N(t,e){return Rl(t,"ExtendedData",(i,r)=>{for(let s of vo(i,"Data"))r[s.getAttribute("name")||""]=ro(ia(s,"value"));for(let s of vo(i,"SimpleData")){let n=s.getAttribute("name")||"",o=e[n]||eS.string;r[n]=o(ro(s))}return r})}function xN(t){let e=ia(t,"description");for(let i of Array.from(e?.childNodes||[]))if(i.nodeType===4)return{description:{"@type":"html",value:ro(i)}};return{}}function vN(t){return Rl(t,"TimeSpan",e=>({timespan:{begin:ro(ia(e,"begin")),end:ro(ia(e,"end"))}}))}function bN(t){return Rl(t,"TimeStamp",e=>({timestamp:ro(ia(e,"when"))}))}function wN(t,e){return n0(t,"styleUrl",i=>(i=Zy(i),e[i]?Object.assign({styleUrl:i},e[i]):{styleUrl:i}))}var LZ=/\s*/g,NZ=/^\s*|\s*$/g,OZ=/\s+/;function EN(t){return t.replace(LZ,"").split(",").map(parseFloat).filter(e=>!isNaN(e)).slice(0,3)}function tS(t){return t.replace(NZ,"").split(OZ).map(EN).filter(e=>e.length>=2)}function BZ(t){let e=vo(t,"coord");e.length===0&&(e=TZ(t,"coord","*"));let i=e.map(r=>ro(r).split(" ").map(parseFloat));return i.length===0?null:{geometry:i.length>2?{type:"LineString",coordinates:i}:{type:"Point",coordinates:i[0]},times:vo(t,"when").map(r=>ro(r))}}function TN(t){if(t.length===0)return t;let e=t[0],i=t[t.length-1],r=!0;for(let s=0;s<Math.max(e.length,i.length);s++)if(e[s]!==i[s]){r=!1;break}return r?t:t.concat([t[0]])}function Yy(t){return ro(ia(t,"coordinates"))}function SN(t){let e=[],i=[];for(let r=0;r<t.childNodes.length;r++){let s=t.childNodes.item(r);if(iS(s))switch(s.tagName){case"MultiGeometry":case"MultiTrack":case"gx:MultiTrack":{let n=SN(s);e=e.concat(n.geometries),i=i.concat(n.coordTimes);break}case"Point":{let n=EN(Yy(s));n.length>=2&&e.push({type:"Point",coordinates:n});break}case"LinearRing":case"LineString":{let n=tS(Yy(s));n.length>=2&&e.push({type:"LineString",coordinates:n});break}case"Polygon":{let n=[];for(let o of vo(s,"LinearRing")){let a=TN(tS(Yy(o)));a.length>=4&&n.push(a)}n.length&&e.push({type:"Polygon",coordinates:n});break}case"Track":case"gx:Track":{let n=BZ(s);if(!n)break;let{times:o,geometry:a}=n;e.push(a),o.length&&i.push(o);break}}}return{geometries:e,coordTimes:i}}function UZ(t){return t.length===0?null:t.length===1?t[0]:{type:"GeometryCollection",geometries:t}}function zZ(t,e,i,r){let{coordTimes:s,geometries:n}=SN(t),o=UZ(n);if(!o&&r.skipNullGeometry)return null;let a={type:"Feature",geometry:o,properties:Object.assign(c6(t,["name","address","visibility","open","phoneNumber","description"]),xN(t),wN(t,e),nS(t),_N(t,i),vN(t),bN(t),s.length?{coordinateProperties:{times:s.length===1?s[0]:s}}:{})};a.properties?.visibility!==void 0&&(a.properties.visibility=a.properties.visibility!=="0");let l=t.getAttribute("id");return l!==null&&l!==""&&(a.id=l),a}function GZ(t){return ia(t,"gx:LatLonQuad")?{geometry:{type:"Polygon",coordinates:[TN(tS(Yy(t)))]}}:VZ(t)}var $Z=Math.PI/180;function HZ(t,e,i){let r=[(t[0]+t[2])/2,(t[1]+t[3])/2];return[e[0].map(s=>{let n=s[1]-r[1],o=s[0]-r[0],a=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),l=Math.atan2(n,o)+i*$Z;return[r[0]+Math.cos(l)*a,r[1]+Math.sin(l)*a]})]}function VZ(t){let e=ia(t,"LatLonBox");if(e){let i=s0(e,"north"),r=s0(e,"west"),s=s0(e,"east"),n=s0(e,"south"),o=s0(e,"rotation");if(typeof i=="number"&&typeof n=="number"&&typeof r=="number"&&typeof s=="number"){let a=[r,n,s,i],l=[[[r,i],[s,i],[s,n],[r,n],[r,i]]];return typeof o=="number"&&(l=HZ(a,l,o)),{bbox:a,geometry:{type:"Polygon",coordinates:l}}}}return null}function jZ(t,e,i,r){let s=GZ(t),n=s?.geometry||null;if(!n&&r.skipNullGeometry)return null;let o={type:"Feature",geometry:n,properties:Object.assign({"@geometry-type":"groundoverlay"},c6(t,["name","address","visibility","open","phoneNumber","description"]),xN(t),wN(t,e),nS(t),yN(t),_N(t,i),vN(t),bN(t))};s?.bbox&&(o.bbox=s.bbox),o.properties?.visibility!==void 0&&(o.properties.visibility=o.properties.visibility!=="0");let a=t.getAttribute("id");return a!==null&&a!==""&&(o.id=a),o}function XZ(t){let e=t.getAttribute("id"),i=t.parentNode;return!e&&iS(i)&&i.localName==="CascadingStyle"&&(e=i.getAttribute("kml:id")||i.getAttribute("id")),Zy(e||"")}function WZ(t){let e={};for(let i of vo(t,"Style"))e[XZ(i)]=nS(i);for(let i of vo(t,"StyleMap")){let r=Zy(i.getAttribute("id")||"");n0(i,"styleUrl",s=>{s=Zy(s),e[s]&&(e[r]=e[s])})}return e}function qZ(t){let e={};for(let i of vo(t,"SimpleField"))e[i.getAttribute("name")||""]=eS[i.getAttribute("type")||""]||eS.string;return e}function*YZ(t,e={skipNullGeometry:!1}){let i=WZ(t),r=qZ(t);for(let s of vo(t,"Placemark")){let n=zZ(s,i,r,e);n&&(yield n)}for(let s of vo(t,"GroundOverlay")){let n=jZ(s,i,r,e);n&&(yield n)}}function AN(t,e={skipNullGeometry:!1}){return{type:"FeatureCollection",features:Array.from(YZ(t,e))}}var CN=Xi(a6(),1);var o0=65535,Jy=class extends Mr{constructor(e,i){super(e,i),this._dataUsed=null,this._fileList=null,this._template=null,this._url=null,this._geojson=null,this._geojsonExtent=null,this._fileReader=new FileReader,this._hashchange=this._hashchange.bind(this),this._updateHash=this._updateHash.bind(this),this._setFile=this._setFile.bind(this),this.setFileList=this.setFileList.bind(this);function r(s){s.stopPropagation(),s.preventDefault(),s.dataTransfer.dropEffect="copy"}this.context.container().attr("dropzone","copy").on("dragenter.draganddrop",r).on("dragexit.draganddrop",r).on("dragover.draganddrop",r).on("drop.draganddrop",s=>{s.stopPropagation(),s.preventDefault(),this.setFileList(s.dataTransfer.files)}),this.context.systems.urlhash.on("hashchange",this._hashchange),e.on("layerchange",this._updateHash)}render(e,i,r){if(!this.enabled||!this.hasData())return;let s=this.context.services.vectortile,n=[];this._template&&s?(r>=13&&s.loadTiles(this._template),n=s.getData(this._template).map(m=>m.geojson)):n=this._getFeatures(this._geojson);let o=n.filter(m=>m.geometry.type==="Polygon"||m.geometry.type==="MultiPolygon"),a=n.filter(m=>m.geometry.type==="LineString"||m.geometry.type==="MultiLineString"),l=n.filter(m=>m.geometry.type==="Point"||m.geometry.type==="MultiPoint");this.renderPolygons(e,i,r,o);let u=this.createGridLines(a),d={stroke:{width:.5,color:65535,alpha:.5,cap:Oi.ROUND}};this.renderLines(e,i,r,a),this.renderLines(e,i,r,u,d),this.renderPoints(e,i,r,l)}createGridLines(e){let i=this.context.systems.imagery.numGridSplits,r=[];if(this.context.systems.rapid.isTaskRectangular&&i>0){let s=e[0],n=s.geometry.coordinates.map(_=>_[0]),o=s.geometry.coordinates.map(_=>_[1]),a=Math.min(...n),l=Math.min(...o),u=Math.max(...n),d=Math.max(...o),m=(u-a)/i,g=(d-l)/i;for(let _=1;_<i;_++){let v=a+m*_,E=l+g*_;r.push({type:"Feature",geometry:{type:"LineString",coordinates:[[a,E],[u,E]]},id:i+"gridcol"+_}),r.push({type:"Feature",geometry:{type:"LineString",coordinates:[[v,l],[v,d]]},id:i+"gridrow"+_})}}return r}renderPolygons(e,i,r,s){let n=this.context.systems.l10n,o=this.scene.groups.get("basemap"),a={fill:{color:o0,alpha:.3},stroke:{width:2,color:o0,alpha:1,cap:Oi.ROUND},labelTint:o0};for(let l of s){let u=l.__featurehash__,d=l.v||0,m=l.geometry.type==="Polygon"?[l.geometry.coordinates]:l.geometry.type==="MultiPolygon"?l.geometry.coordinates:[];for(let g=0;g<m.length;++g){let _=m[g],v=`${this.layerID}-${u}-${g}`,E=this.features.get(v);E&&E.type!=="polygon"&&(E.destroy(),E=null),E||(E=new Yc(this,v),E.style=a,E.parentContainer=o),E.v!==d&&(E.v=d,E.geometry.setCoords(_),E.label=n.displayName(l.properties),E.setData(u,l)),this.syncFeatureClasses(E),E.update(i,r),this.retainFeature(E,e)}}}renderLines(e,i,r,s,n){let o=this.context.systems.l10n,a=this.scene.groups.get("basemap"),l=n||{stroke:{width:2,color:o0,alpha:1,cap:Oi.ROUND},labelTint:o0};for(let u of s){let d=u.__featurehash__,m=u.v||0,g=u.geometry.type==="LineString"?[u.geometry.coordinates]:u.geometry.type==="MultiLineString"?u.geometry.coordinates:[];for(let _=0;_<g.length;++_){let v=g[_],E=`${this.layerID}-${d}-${_}`,b=this.features.get(E);b&&b.type!=="line"&&(b.destroy(),b=null),b||(b=new Sa(this,E),b.style=l,b.parentContainer=a),b.v!==m&&(b.v=m,b.geometry.setCoords(v),b.label=o.displayName(u.properties),b.setData(d,u)),this.syncFeatureClasses(b),b.update(i,r),this.retainFeature(b,e)}}}renderPoints(e,i,r,s){let n=this.context.systems.l10n,o=this.scene.groups.get("points"),a={markerName:"largeCircle",markerTint:o0,iconName:"maki-circle-stroked",labelTint:o0};for(let l of s){let u=l.__featurehash__,d=l.v||0,m=l.geometry.type==="Point"?[l.geometry.coordinates]:l.geometry.type==="MultiPoint"?l.geometry.coordinates:[];for(let g=0;g<m.length;++g){let _=m[g],v=`${this.layerID}-${u}-${g}`,E=this.features.get(v);E&&E.type!=="point"&&(E.destroy(),E=null),E||(E=new Vr(this,v),E.style=a,E.parentContainer=o),E.v!==d&&(E.v=d,E.geometry.setCoords(_),E.label=n.displayName(l.properties),E.setData(u,l)),this.syncFeatureClasses(E),E.update(i,r),this.retainFeature(E,e)}}}hasData(){return!!(this._template||this._geojson)}getSrc(){return this._dataUsed}fitZoom(){let e=this._geojsonExtent;e&&this.context.systems.map.trimmedExtent(e)}getFileList(){return this._fileList}setFileList(e){if(this._fileList=e,this._dataUsed=null,this._geojson=null,this._geojsonExtent=null,this._template=null,this._url=null,this.scene.disableLayers(this.layerID),!e||!e.length)return;let i=e[0],r=this._getExtension(i.name);this._fileReader.onload=s=>{this._fileReader.onload=null,this._setFile(s.target.result,r)},this._fileReader.readAsText(i)}setUrl(e){if(this._url=e,this._dataUsed=null,this._fileList=null,this._geojson=null,this._geojsonExtent=null,this._template=null,this.scene.disableLayers(this.layerID),!e)return;let i=e.toLowerCase().split(/[?#]/)[0],r=i.includes("project")&&i.includes("task")&&i.includes("gpx"),s=r?".gpx":this._getExtension(i);s?fetch(e).then(Ai).then(n=>{this._setFile(n,s),r&&(this._dataUsed=null,this.context.systems.rapid.setTaskExtentByGpxData(n))}).catch(n=>console.error(n)):this._setUrlTemplate(e)}_setUrlTemplate(e){let i=this.context.services.osm;if(i){let r=i.imageryBlocklists??[],s=!1,n=0,o;for(o of r)if(s=o.test(e),n++,s)return;if(!n&&(o=/.*\.google(apis)?\..*\/(vt|kh)[\?\/].*([xyz]=.*){3}.*/,s=o.test(e),s))return}this._template=e,this._dataUsed="vectortile:"+e.split(/[?#]/)[0],this.scene.enableLayers(this.layerID)}_setFile(e,i){if(!e)return;let r;switch(i){case".gpx":r=Ky(e instanceof Document?e:s(e));break;case".kml":r=AN(e instanceof Document?e:s(e));break;case".geojson":case".json":r=e instanceof Object?e:JSON.parse(e);break}r=r||{},Object.keys(r).length&&(this._dataUsed=`${i} data file`,this._geojson=this._ensureIDs(r),(0,CN.default)(this._geojson),this._geojsonExtent=this._calcExtent(r),this.fitZoom(),this.scene.enableLayers(this.layerID));function s(n){return new DOMParser().parseFromString(n,"text/xml")}}_ensureIDs(e){if(!e)return null;for(let i of this._getFeatures(e))this._ensureFeatureID(i);return e}_ensureFeatureID(e){if(!e)return;let r=this.context.services.vectortile.getNextID();return e.id=r,e.__featurehash__=r,e}_getFeatures(e){return e?e.type==="FeatureCollection"?e.features:[e]:[]}_calcExtent(e){let i=new mt;if(!e)return i;for(let s of this._getFeatures(e)){let n=s.geometry;if(!n)continue;let o=n.type,a=n.coordinates,l=/^Multi/.test(o)?a:[a];if(/Polygon$/.test(o))for(let u of l){let d=u[0];for(let m of d)r(m)}else if(/LineString$/.test(o))for(let u of l)for(let d of u)r(d);else if(/Point$/.test(o))for(let u of l)r(u)}return i;function r(s){i.min=[Math.min(i.min[0],s[0]),Math.min(i.min[1],s[1])],i.max=[Math.max(i.max[0],s[0]),Math.max(i.max[1],s[1])]}}_getExtension(e){if(!e)return;let i=/\.(gpx|kml|(geo)?json)$/i,r=e.match(i);return r&&r.length&&r[0]}_hashchange(e,i){let r=e.get("data")||e.get("gpx"),s=i.get("data")||i.get("gpx");r!==s&&this.setUrl(r)}_updateHash(){let e=this.context.systems.urlhash;e.setParam("gpx",null),e.setParam("data",null),!(!this.enabled||typeof this._url!="string")&&(/gpx/i.test(this._url)?e.setParam("gpx",this._url):e.setParam("data",this._url))}};function O4(t){return t instanceof Set?t:new Set(t!==void 0&&[].concat(t))}var e_=class extends en.default{constructor(e){super(),this.renderer=e,this.context=e.context,this.groups=new Map,this.layers=new Map,this.features=new Map,["background","basemap","points","streetview","qa","labels","blocks","ui"].forEach((i,r)=>{let s=new qi;s.name=i,s.sortableChildren=!0,s.zIndex=r,this.renderer.stage.addChild(s),this.groups.set(i,s)}),[new F4(this,"background"),new Hy(this,"osm"),new Xy(this,"rapid"),new Uy(this,"mapillary-map-features"),new Gy(this,"mapillary-signs"),new Jy(this,"custom-data"),new Vy(this,"notes"),new Fy(this,"improveOSM"),new Ny(this,"keepRight"),new jy(this,"osmose"),new zy(this,"mapillary"),new Ly(this,"kartaview"),new qy(this,"streetside"),new By(this,"labels"),new Dy(this,"edit-blocks"),new Wy(this,"map-ui")].forEach(i=>this.layers.set(i.id,i))}render(e,i,r){for(let s of this.layers.values())s.render(e,i,r),s.cull(e)}enableLayers(e){for(let i of O4(e)){let r=this.layers.get(i);r&&(r.enabled=!0)}this.emit("layerchange")}disableLayers(e){for(let i of O4(e)){let r=this.layers.get(i);r&&(r.enabled=!1)}this.emit("layerchange")}toggleLayers(e){for(let i of O4(e)){let r=this.layers.get(i);r&&(r.enabled=!r.enabled)}this.emit("layerchange")}onlyLayers(e){let i=O4(e);for(let r of this.layers.values())r.enabled=i.has(r.id);this.emit("layerchange")}addFeature(e){this.features.set(e.id,e)}removeFeature(e){this.features.delete(e.id)}classData(e,i,r){this.layers.get(e)?.classData(i,r)}unclassData(e,i,r){this.layers.get(e)?.unclassData(e,i,r)}clearClass(e){for(let i of this.layers.values())i.clearClass(e)}dirtyScene(){for(let e of this.features.values())e.dirty=!0}dirtyLayers(e){for(let i of O4(e))this.layers.get(i)?.dirtyLayer()}dirtyFeatures(e){for(let i of O4(e)){let r=this.features.get(i);r&&(r.dirty=!0)}}dirtyData(e,i){this.layers.get(e)?.dirtyData(i)}};var ms=class{static makeArea(t,e,i){return t|e<<15|i<<30}static getOpenOffset(t){return t&32768-1}static getCloseOffset(t){return t>>15&32768-1}static getOrientation(t){return t>>30&1}static setOpenOffset(t,e){return ms.makeArea(e,ms.getCloseOffset(t),ms.getOrientation(t))}static setCloseOffset(t,e){return ms.makeArea(ms.getOpenOffset(e),e,ms.getOrientation(t))}},ZZ=class extends Wo{constructor(t,e){super(t,e),this.managedItems=[]}upload(t,e,i){let r=t.gl,s=e.realWidth,n=e.realHeight;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ks.UNPACK),(i.width!==s||i.height!==n)&&(i.width=s,i.height=n,r.texImage2D(e.target,0,e.format,s,n,0,e.format,e.type,void 0));let o=this.managedItems;for(let a=0,l=o.length;a<l;a++)this.uploadItem(t,e.target,e.format,e.type,o[a]);return!0}uploadItem(t,e,i,r,s){let n=t.gl,o=n instanceof WebGL2RenderingContext,a=s.frame,l=s.source;if(!o){if(l instanceof ImageData)l=l.data;else if(l instanceof HTMLCanvasElement){let u=l.getContext("2d"),[d,m]=[l.width,l.height];l=u.getImageData(0,0,d,m).data}else if(l instanceof HTMLImageElement){let[u,d]=[l.naturalWidth,l.naturalHeight],m=document.createElement("canvas");m.width=u,m.height=d;let g=m.getContext("2d");g.drawImage(l,0,0),l=g.getImageData(0,0,u,d).data}}n.texSubImage2D(e,0,a.x,a.y,a.width,a.height,i,r,l),s.updateId=s.dirtyId}};var IN=new ei,kN=class{constructor(t,e){this._width=t,this._height=e,this._root=[null,ms.makeArea(0,this._height,0),!1]}allocate(t,e,i){let r=this.findArea(t,e);if(!r)return null;i||(i=new ei),this.getFrame(r,i);let s=new ei(i.x,i.y,t,e),n=this.split(r,i,s);return i.copyFrom(s),i.__mem_area=n,i}free(t){let e=t.__mem_area;e[2]=!1,this.merge(e)}get width(){return this._width}get height(){return this._height}getAreaField(t){return t[1]}getFrame(t,e){e||(e=new ei);let i=this.getAreaField(t),r=this.getParent(t),s=ms.getOrientation(i),n=ms.getOpenOffset(i),o=ms.getCloseOffset(i),a=r?ms.getOpenOffset(r[1]):0,l=r?ms.getCloseOffset(r[1]):this._width;return s?(e.x=n,e.y=a,e.width=o-e.x,e.height=l-a):(e.x=a,e.y=n,e.width=l-e.x,e.height=o-e.y),e}getParent(t){return t[0]}hasChildren(t){return Array.isArray(t[2])&&t[2].length!==0}getChildren(t){if(!Array.isArray(t[2]))throw new Error("Children don't exist");return t[2]}addChild(t,...e){t[2]=Array.isArray(t[2])?t[2]:[],t[2].push(...e)}findArea(t,e){return this.findAreaRecursive(this._root,t,e)}findAreaRecursive(t,e,i){let r=this.getFrame(t,IN);if(r.width<e||r.height<i)return null;if(!this.hasChildren(t)){let a=r.width-e,l=r.height-i;return a<0||l<0||t[2]?null:t}let s=this.getChildren(t),n=null,o=1/0;for(let a=0,l=s.length;a<l;a++){let u=this.findAreaRecursive(s[a],e,i);if(!u)continue;let d=this.getFrame(u,IN),m=d.width-e,g=d.height-i;if(m<0||g<0)continue;if(!m&&!g)return u;let _=Math.min(m,g);o>_&&(n=u,o=_)}return n}splitOrientation(t,e){if(e.width===t.width&&e.height===t.height)return 2;if(e.width===t.width)return 1;if(e.height===t.height)return 0;let i=Math.abs((t.width-e.width)*t.height-e.width*(t.height-e.height)),r=Math.abs(t.width*(t.height-e.height)-(t.width-e.width)*e.height);return i>r?0:1}split(t,e,i,r=this.getParent(t)?this.splitOrientation(e,i):0){if(t[2]===!0)throw new Error("Cannot deallocate");return r===2?(t[2]=!0,t):this[r===0?"splitPrimaryHorizontal":"splitPrimaryVertical"](t,e,i)}splitPrimaryHorizontal(t,e,i){let r=this.getAreaField(t),s=ms.getOrientation(r),n=this.getParent(t);if(this.hasChildren(t))throw new Error("Can't split non-leaf node");let o=[t,ms.makeArea(e.left,e.x+i.width,1),[]],a=[t,ms.makeArea(e.x+i.width,e.right,1),!1];if(s===0)this.addChild(t,o,a);else{let l=this.getChildren(n).indexOf(t);o[0]=n,a[0]=n,this.getChildren(n).splice(l,1,o,a)}if(i.height!==e.height){let l=[o,ms.makeArea(e.top,e.y+i.height,0),!0],u=[o,ms.makeArea(e.y+i.height,e.bottom,0),!1];return this.addChild(o,l,u),l}else o[2]=!0;return o}splitPrimaryVertical(t,e,i){let r=this.getAreaField(t),s=ms.getOrientation(r),n=this.getParent(t);if(this.hasChildren(t))throw new Error("Can't split non-leaf node");let o=[t,ms.makeArea(e.top,e.y+i.height,0),[]],a=[t,ms.makeArea(e.y+i.height,e.bottom,0),!1];if(s===1)this.addChild(t,o,a);else{let l=this.getChildren(n).indexOf(t);o[0]=n,a[0]=n,this.getChildren(n).splice(l,1,o,a)}if(i.width!==e.height){let l=[o,ms.makeArea(e.left,e.x+i.width,1),!0],u=[o,ms.makeArea(e.x+i.width,e.right,1),!1];return this.addChild(o,l,u),l}else o[2]=!0;return o}merge(t){if(this.hasChildren(t))throw new Error("Cannot merge a non-leaf node");let e=this.getParent(t);if(!e)return;let i=this.getChildren(e),r=i.indexOf(t),s=i[r-1],n=i[r+1];n&&n[2]===!1&&(t[1]=ms.setCloseOffset(t[1],ms.getCloseOffset(n[1])),i.splice(r+1,1)),s&&s[2]===!1&&(t[1]=ms.setOpenOffset(t[1],ms.getOpenOffset(s[1])),i.splice(r-1,1)),i.length===1&&(e[2]=!1,this.merge(e))}printState(t){this.hasChildren(t)?this.getChildren(t).forEach(e=>this.printState(e)):console.log({...this.getFrame(t)},t[2])}},oS=new ei,QZ=class{constructor(t=2048,e=2048){this.slabWidth=t,this.slabHeight=e,this.textureSlabs=[]}get maxWidth(){return this.slabWidth-2*this.calculatePadding(this.slabWidth,this.slabHeight)}get maxHeight(){return this.slabHeight-2*this.calculatePadding(this.slabWidth,this.slabHeight)}allocate(t,e,i=this.calculatePadding(t,e)){if(t+2*i>this.slabWidth||e+2*i>this.slabHeight)return null;let r=this.textureSlabs;for(let n=0,o=r.length;n<o;n++){let a=r[n],l=this.issueTexture(a,t,e,i);if(l)return l}let s=this.createSlab();return this.textureSlabs.unshift(s),this.issueTexture(s,t,e,i)}free(t){let e=t.baseTexture,i=this.textureSlabs.find(s=>s.slab===e);if(!i)throw new Error("The texture cannot be freed because its base-texture is not pooled by this allocator. This is either a bug in TextureAllocator or you tried to free a texture that was never allocated by one.");let r=i.managedTextures.find(s=>s.texture===t);if(!r)throw new Error("The texture cannot be freed because it was not found in the managed list of issued textures on its slab. This may be because you duplicated this texture or a bug in TextureAllocator");i.managedArea.free(r.area),i.managedTextures.splice(i.managedTextures.indexOf(r),1)}calculatePadding(t,e){let i=Math.max(t,e);return i<64?2:i<128?4:i<1024?8:16}createSlab(){return{managedArea:new kN(this.slabWidth,this.slabHeight),managedTextures:[],slab:new li(null,{width:this.slabWidth,height:this.slabHeight})}}createTexture(t,e){return new qt(t,e)}issueTexture(t,e,i,r=0){let s=t.managedArea.allocate(e+2*r,i+2*r);if(!s)return null;oS.copyFrom(s),oS.pad(-r);let n=t.slab,o=this.createTexture(n,oS.clone());return t.managedTextures.push({area:s,texture:o}),o}},t_=class extends QZ{createSlab(){return{managedArea:new kN(this.slabWidth,this.slabHeight),managedTextures:[],slab:new li(new ZZ(this.slabWidth,this.slabHeight),{width:this.slabWidth,height:this.slabHeight})}}allocate(t,e,i,r){let s;typeof i=="number"?s=i:(s=this.calculatePadding(t,e),r=i);let n=super.allocate(t,e,s);if(r){let o=n.baseTexture.resource,a={frame:n.frame,source:r,dirtyId:r instanceof HTMLImageElement&&!r.complete?-1:0,updateId:-1,texture:n};o.managedItems.push(a),r instanceof HTMLImageElement&&!r.complete&&r.addEventListener("load",()=>{n.baseTexture.valid&&!n.baseTexture.destroyed&&o.managedItems.indexOf(a)>=0&&(a.dirtyId++,n.baseTexture.update())}),n.baseTexture.update()}return n}free(t){super.free(t);let e=t.baseTexture.resource,i=e.managedItems.find(r=>r.texture===t);i&&e.managedItems.splice(e.managedItems.indexOf(i),1)}};var i_=class{constructor(e){this.context=e,this.loaded=!1,this._atlas={symbol:new t_,text:new t_,tile:new t_},this._textureData=new Map,this._svgIcons=new Map;let i=["bushes","cemetery","cemetery_buddhist","cemetery_christian","cemetery_jewish","cemetery_muslim","construction","dots","farmland","farmyard","forest","forest_broadleaved","forest_leafless","forest_needleleaved","grass","landfill","lines","orchard","pond","quarry","vineyard","waves","wetland","wetland_bog","wetland_marsh","wetland_reedbed","wetland_swamp"],r={};for(let s of i)r[s]=e.asset(`img/pattern/${s}.png`);Q1.addBundle("patterns",r),Q1.loadBundle(["patterns"]).then(s=>{for(let[n,o]of Object.entries(s.patterns))this._textureData.set(n,{texture:o,refcount:1});this.loaded=!0}).catch(s=>console.error(s)),this._cacheGraphics()}get(e){return this.getTexture("symbol",e)}getTexture(e,i){let r=`${e}-${i}`,s=this._textureData.get(r);return s?s.texture:this._svgIcons.has(i)?(this.svgIconToTexture(i),qt.EMPTY):null}getPatternTexture(e){return this._textureData.get(e)?.texture}getDebugTexture(e){let i=this._atlas[e];if(!i)return null;let r=new ei(0,0,i.slabWidth,i.slabHeight),s=i.textureSlabs[0]?.slab;return s?new qt(s,r):null}allocate(e,i,r,s,n){let o=this._atlas[e];if(!o)return null;let a=`${e}-${i}`,l=this._textureData.get(a);if(l)return l.refcount++,l.texture;let u=e==="symbol"?1:0,d=o.allocate(r,s,u,n);if(!d)throw new Error(`Couldn't allocate texture ${a}`);if(e==="tile"){let m=d.frame.clone().pad(-.5);d.frame=m}return this._textureData.set(a,{texture:d,refcount:1}),d}free(e,i){let r=this._atlas[e];if(!r)return;let s=`${e}-${i}`,n=this._textureData.get(s);n&&(n.refcount--,n.refcount===0&&(r.free(n.texture),n.texture.destroy(!1),n.texture=null,this._textureData.delete(s)))}graphicToTexture(e,i,r){let s=this.context.pixi.renderer,n=s.generateTexture(i,r),o=n.baseTexture;if(o.format!==Bt.RGBA||o.type!==mi.UNSIGNED_BYTE)return;let a=o.framebuffer;if(!a)return n;let l=a.width,u=a.height,d=new Uint8Array(l*u*4),m=s.context.gl,_=a.glFramebuffers[1]?.framebuffer;if(!m||!_)return n;m.bindFramebuffer(m.FRAMEBUFFER,_),m.readPixels(0,0,l,u,o.format,o.type,d);let v=this.allocate("symbol",e,l,u,d);v.orig=n.orig.clone(),n.destroy(!0)}addSvgIcon(e,i){this._svgIcons.set(e,i)}svgIconToTexture(e){let i=this._svgIcons.get(e);if(!i)return;this._svgIcons.set(e,null);let r=32,s={autoLoad:!1,height:r,width:r},n=new ic(i,s);n.load().then(()=>{this.allocate("symbol",e,r,r,n.source),this._svgIcons.delete(e)})}_cacheGraphics(){let e={resolution:2},r={region:new ei(-13,0,26,52),resolution:3},s=new Gi().lineStyle(1,4473924).beginFill(16777215,.75).moveTo(-2,26).lineTo(2,26).lineTo(12,4).bezierCurveTo(12,0,-12,0,-12,4).closePath().endFill(),n=new Gi().lineStyle(1,13421772).beginFill(3355443,.75).moveTo(-2,26).lineTo(2,26).lineTo(12,4).bezierCurveTo(12,0,-12,0,-12,4).closePath().endFill(),o=new Gi().lineStyle(1,13421772).beginFill(16777215,0).moveTo(-2,26).lineTo(2,26).lineTo(12,4).bezierCurveTo(12,0,-12,0,-12,4).closePath().endFill();this.graphicToTexture("viewfield",s,r),this.graphicToTexture("viewfieldDark",n,r),this.graphicToTexture("viewfieldOutline",o,r);let a=new Gi().lineStyle(1,4473924).beginFill(16777215,.75).drawCircle(0,0,20).endFill(),l=new Gi().lineStyle(1,13421772).beginFill(3355443,.75).drawCircle(0,0,20).endFill(),u=new Gi().lineStyle(1,13421772).beginFill(16777215,0).drawCircle(0,0,20).endFill();this.graphicToTexture("pano",a,e),this.graphicToTexture("panoDark",l,e),this.graphicToTexture("panoOutline",u,e);let d=new Gi().lineStyle(1,4473924).beginFill(16777215,1).moveTo(0,0).bezierCurveTo(-2,-2,-8,-10,-8,-15).bezierCurveTo(-8,-19,-4,-23,0,-23).bezierCurveTo(4,-23,8,-19,8,-15).bezierCurveTo(8,-10,2,-2,0,0).closePath().endFill(),m=new Gi().lineStyle(1.5,6710886).beginFill(14540253,1).moveTo(0,0).bezierCurveTo(-2,-2,-8,-10,-8,-15).bezierCurveTo(-8,-19,-4,-23,0,-23).bezierCurveTo(4,-23,8,-19,8,-15).bezierCurveTo(8,-10,2,-2,0,0).closePath().endFill(),g=new Gi().lineStyle(1,4473924).beginFill(16777215,1).drawCircle(0,0,8).endFill(),_=new Gi().lineStyle(1,4473924).beginFill(16777215,1).drawCircle(0,0,6).endFill(),v=new Gi().lineStyle(1,4473924).beginFill(16777215,1).drawCircle(0,0,4.5).endFill(),E=new Gi().lineStyle(1,4473924).beginFill(16777215,1).drawCircle(0,0,4.5).beginFill(0,1).drawCircle(0,0,1.5).endFill();this.graphicToTexture("pin",d,e),this.graphicToTexture("boldPin",m,e),this.graphicToTexture("largeCircle",g,e),this.graphicToTexture("mediumCircle",_,e),this.graphicToTexture("smallCircle",v,e),this.graphicToTexture("taggedCircle",E,e);let b=new Gi().lineStyle(1,3355443).beginFill(16777215).moveTo(15,6.5).lineTo(10.8,6.5).bezierCurveTo(12.2,1.3,11.7,.8,11.2,.8).lineTo(6.2,.8).bezierCurveTo(5.8,.7,5.4,1,5.4,1.5).lineTo(4.2,10.2).bezierCurveTo(4.1,10.8,4.6,11.2,5,11.2).lineTo(9.3,11.2).lineTo(7.6,18.3).bezierCurveTo(7.5,18.8,8,19.3,8.5,19.3).bezierCurveTo(8.8,19.3,9.1,19.1,9.2,18.8).lineTo(15.6,7.8).bezierCurveTo(16,7.2,15.6,6.5,15,6.5).endFill().closePath(),T=new Gi().lineStyle(1,3355443).beginFill(16777215).drawPolygon([16,3,4,3,1,6,1,17,4,20,7,20,10,27,13,20,16,20,19,17.033,19,6]).endFill().closePath(),A=new Gi().lineStyle(1.5,3355443).beginFill(16777215,1).moveTo(17.5,0).lineTo(2.5,0).bezierCurveTo(1.13,0,0,1.12,0,2.5).lineTo(0,13.75).bezierCurveTo(0,15.12,1.12,16.25,2.5,16.25).lineTo(6.25,16.25).lineTo(6.25,19.53).bezierCurveTo(6.25,19.91,6.68,20.13,7,19.9).lineTo(11.87,16.25).lineTo(17.49,16.25).bezierCurveTo(18.86,16.25,20,15.12,20,13.75).lineTo(20,2.5).bezierCurveTo(20,1.13,18.87,0,17.5,0).closePath().endFill(),M=new Gi().lineStyle(1,3355443).beginFill(16777215).drawPolygon([16,3,4,3,1,6,1,17,4,20,7,20,10,27,13,20,16,20,19,17.033,19,6]).endFill().closePath();this.graphicToTexture("keepright",b,e),this.graphicToTexture("improveosm",T,e),this.graphicToTexture("osmnote",A,e),this.graphicToTexture("osmose",M,e);let k=new Gi().lineStyle(1,4473924).beginFill(16777215,1).drawPolygon([-3,4,7,0,-3,-4]).endFill(),F=new Gi().beginFill(16777215,1).drawPolygon([5,3,0,3,0,2,5,2,5,0,10,2.5,5,5]).endFill(),O=new Gi().beginFill(16777215,1).drawPolygon([0,5,5,0,0,-5]).endFill();this.graphicToTexture("midpoint",k,e),this.graphicToTexture("oneway",F,e),this.graphicToTexture("sided",O,e);let B=new Gi().lineStyle(1,16777215).beginFill(16777215,.6).drawRect(-5,-5,10,10).endFill(),U=new Gi().lineStyle(1,16777215).beginFill(16777215,.6).drawPolygon([-5,-5,5,-5,5,5,1,5,1,1,-5,1,-5,-5]).endFill(),$=new Gi().lineStyle(1,16777215).beginFill(16777215,.6).drawCircle(0,0,5).endFill();this.graphicToTexture("lowres-square",B,e),this.graphicToTexture("lowres-ell",U,e),this.graphicToTexture("lowres-circle",$,e);let q=new Gi().lineStyle(1,16777215).beginFill(0,0).drawRect(-5,-5,10,10).endFill(),W=new Gi().lineStyle(1,16777215).beginFill(0,0).drawPolygon([-5,-5,5,-5,5,5,1,5,1,1,-5,1,-5,-5]).endFill(),Z=new Gi().lineStyle(1,16777215).beginFill(0,0).drawCircle(0,0,5).endFill();this.graphicToTexture("lowres-unfilled-square",q,e),this.graphicToTexture("lowres-unfilled-ell",W,e),this.graphicToTexture("lowres-unfilled-circle",Z,e)}};var aS,KZ=250,r_=class extends en.default{constructor(e,i,r,s){super(),this.context=e,this.supersurface=i,this.surface=r,this.overlay=s,this._frame=0,this._timeToNextRender=0,this._appPending=!1,this._drawPending=!1,this.pixiProjection=new zo,this._transformDraw=null,this._isTransformed=!1,this._transformEase=null,this._tick=this._tick.bind(this),this._onHoverChange=this._onHoverChange.bind(this),this._onModeChange=this._onModeChange.bind(this),li.defaultOptions.mipmap=xn.OFF,ut.PREFER_ENV=$o.WEBGL2,this.pixi=new Sd({antialias:!0,autoDensity:!0,autoStart:!1,events:{move:!1,globalMove:!1,click:!0,wheel:!1},resizeTo:i.node(),resolution:window.devicePixelRatio,sharedLoader:!0,sharedTicker:!0,view:r.node()}),globalThis.__PIXI_APP__=this.pixi,e.pixi=this.pixi,zs.from("debug",{fill:16777215,fontSize:14,stroke:3355443,strokeThickness:2},{chars:zs.ASCII,padding:0,resolution:2});let n=this.pixi.ticker,o=n._head.next;n.remove(o.fn,o.context),n.add(this._tick,this),n.start();let a=this.pixi.stage;a.name="stage",a.sortableChildren=!0,a.eventMode="static",a.hitArea=new ei(-1e7,-1e7,2e7,2e7),this.stage=a,this.scene=new e_(this),this.events=new Yg(this),aS||(aS=new i_(e)),this.textures=aS,e.on("modechange",this._onModeChange),e.behaviors.hover.on("hoverchange",this._onHoverChange)}_onModeChange(e){this.scene.clearClass("selected");for(let[i,r]of this.context.selectedData()){let s=null;r instanceof Fr?s="notes":r instanceof vr&&r.service==="improveOSM"?s=r.service:r.__fbid__?s="rapid":r.__featurehash__?s="custom-data":e.id==="select-osm"&&(s="osm"),s&&this.scene.classData(s,i,"selected")}this.render()}_onHoverChange(e){let i=e.target,r=i?.layerID,s=i?.dataID,n=i?.data,o=this.context.mode?.id;o!=="select"&&o!=="select-osm"&&this.context.systems.ui.sidebar.hover(n?[n]:[]),this.scene.clearClass("hovered"),r&&s&&this.scene.classData(r,s,"hovered"),this.render()}_tick(){let e=this.pixi.ticker;if(this._drawPending){let i=this._frame,r=`draw-${i}-start`,s=`draw-${i}-end`;window.performance.mark(r),this._draw(),window.performance.mark(s),window.performance.measure(`draw-${i}`,r,s);return}if(this._tform(),this._appPending){if(this._timeToNextRender-=e.deltaMS,this._timeToNextRender>=0)return;{let i=this._frame,r=`app-${i}-start`,s=`app-${i}-end`;window.performance.mark(r),this._app(),window.performance.mark(s),window.performance.measure(`app-${i}`,r,s);return}}}deferredRender(){this._appPending=!0}render(){this._timeToNextRender=0,this._appPending=!0}setTransformAsync(e,i=0){let r=window.performance.now(),s=this.context.projection.transform(),n;if(this._transformEase&&(this.context.projection.transform(s),this._transformEase.resolve(s),this._transformEase=null),i>0){let o;n=new Promise(a=>{o=a}),this._transformEase={time0:r,time1:r+i,xform0:s,xform1:e,promise:n,resolve:o}}else this.context.projection.transform(e),n=Promise.resolve(e);return this._appPending=!0,n}resize(e,i){this.pixi.renderer.resize(e,i),this._appPending=!0}_tform(){if(this._drawPending)return;if(this._transformEase){let{time0:s,time1:n,xform0:o,xform1:a,resolve:l}=this._transformEase,[u,d,m]=[o.x,o.y,o.k],[g,_,v]=[a.x,a.y,a.k],E=window.performance.now(),b=Math.max(0,Math.min(1,(E-s)/(n-s))),T=u+(g-u)*b,A=d+(_-d)*b,M=m+(v-m)*b,k={x:T,y:A,k:M};this.context.projection.transform(k),b===1&&(l(k),this._transformEase=null),this._appPending=!0}let e=this.context.projection.transform(),i=this._transformDraw;if(!i)return;if(this._isTransformed||i.x!==e.x||i.y!==e.y||i.k!==e.k){let s=e.k/i.k,n=(e.x/s-i.x)*s,o=(e.y/s-i.y)*s;Sl(this.supersurface,n,o,s),Sl(this.overlay,-n,-o),this._isTransformed=!0,this.emit("move")}}_app(){if(!this.textures?.loaded)return;let e=this.context,i=this.pixiProjection,r=i.transform(),s=e.projection.transform(),n=e.systems.map.effectiveZoom(),o=[r.x,r.y],a=[s.x,s.y],l=Hi(o,a),u;r.k!==s.k||l>1e5?(u=[0,0],i.transform(s),this.scene.dirtyScene()):u=tr(o,a),this.pixi.stage.position.set(-u[0],-u[1]),this.scene.render(this._frame,i,n),this._appPending=!1,this._drawPending=!0}_draw(){this.pixi.render(),this._transformDraw=this.context.projection.transform(),this._timeToNextRender=KZ,this._isTransformed&&(Sl(this.supersurface,0,0),Sl(this.overlay,0,0),this._isTransformed=!1,this.emit("move")),this._drawPending=!1,this.emit("draw"),this._frame++}};var Ri=function(t){let e=Os();if(e.os==="mac")return t;if(e.os==="win"&&t==="\u2318\u21E7Z")return"Ctrl+Y";let i={"\u2318":"Ctrl","\u21E7":"Shift","\u2325":"Alt","\u232B":"Backspace","\u2326":"Delete"},r="";for(let s=0;s<t.length;s++)t[s]in i?r+=i[t[s]]+(s<t.length-1?"+":""):r+=t[s];return r};Ri.display=function(t,e){if(e.length!==1)return e;let i=t.t,s=Os().os==="mac";return{"\u2318":s?"\u2318 "+i("shortcuts.key.cmd"):i("shortcuts.key.ctrl"),"\u21E7":s?"\u21E7 "+i("shortcuts.key.shift"):i("shortcuts.key.shift"),"\u2325":s?"\u2325 "+i("shortcuts.key.option"):i("shortcuts.key.alt"),"\u2303":s?"\u2303 "+i("shortcuts.key.ctrl"):i("shortcuts.key.ctrl"),"\u232B":s?"\u232B "+i("shortcuts.key.delete"):i("shortcuts.key.backspace"),"\u2326":s?"\u2326 "+i("shortcuts.key.del"):i("shortcuts.key.del"),"\u2196":s?"\u2196 "+i("shortcuts.key.pgup"):i("shortcuts.key.pgup"),"\u2198":s?"\u2198 "+i("shortcuts.key.pgdn"):i("shortcuts.key.pgdn"),"\u21DE":s?"\u21DE "+i("shortcuts.key.home"):i("shortcuts.key.home"),"\u21DF":s?"\u21DF "+i("shortcuts.key.end"):i("shortcuts.key.end"),"\u21B5":s?"\u23CE "+i("shortcuts.key.return"):i("shortcuts.key.enter"),"\u238B":s?"\u238B "+i("shortcuts.key.esc"):i("shortcuts.key.esc"),"\u2630":s?"\u2630 "+i("shortcuts.key.menu"):i("shortcuts.key.menu")}[e]||e};function JZ(t,e){var i=e.getBoundingClientRect(),r=[i.width,i.height];return t.property("__dimensions__",r),r}function hc(t,e){if(!t||t.empty())return[0,0];var i=t.node(),r=t.property("__dimensions__");return!r||e?JZ(t,i):r}var u6=256,lS=2,s_=24,MN=In(lS,u6),PN=In(s_,u6);function Zc(t,e,i){return Math.max(e,Math.min(t,i))}var h6=class extends ui{constructor(e){super(e),this.id="map",this.dependencies=new Set(["edits","filters","imagery","photos","storage","l10n","urlhash"]),this.supersurface=ye(null),this.surface=ye(null),this.overlay=ye(null),this.redrawEnabled=!0,this.areaFillOptions=["wireframe","partial","full"],this._highlightEdits=!1,this._currFillMode="partial",this._toggleFillMode="partial",this._renderer=null,this._dimensions=[1,1],this._initPromise=null,this._hashchange=this._hashchange.bind(this),this._updateHash=this._updateHash.bind(this),this.render=this.render.bind(this),this.immediateRedraw=this.immediateRedraw.bind(this),this.deferredRedraw=this.deferredRedraw.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let n of this.dependencies)if(!this.context.systems[n])return Promise.reject(`Cannot init:  ${this.id} requires ${n}`);let e=this.context,i=e.systems.storage,r=e.systems.l10n;e.systems.urlhash.on("hashchange",this._hashchange);let s=Promise.all([i.initAsync(),r.initAsync()]);return this._initPromise=s.then(()=>{this._currFillMode=i.getItem("area-fill")||"partial",this._toggleFillMode=i.getItem("area-fill-toggle")||"partial";let n=r.t("area_fill.wireframe.key"),o=r.t("map_data.highlight_edits.key");e.keybinding().on(n,a=>{a.preventDefault(),a.stopPropagation(),this.wireframeMode=!this.wireframeMode}).on(Ri("\u2325"+n),a=>{a.preventDefault(),a.stopPropagation();let l=e.mode;l&&/^draw/.test(l.id)||(this.scene.toggleLayers("osm"),e.enter("browse"))}).on(o,a=>{a.preventDefault(),this.highlightEdits=!this.highlightEdits})})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}render(e){let i=this.context;e.on("contextmenu",d=>d.preventDefault()).on("wheel.map mousewheel.map",d=>d.preventDefault()),this.supersurface=e.append("div").attr("class","supersurface"),this.surface=this.supersurface.append("canvas").attr("class","surface"),this.overlay=this.supersurface.append("div").attr("class","overlay"),this._renderer||(this._renderer=new r_(i,this.supersurface,this.surface,this.overlay),this._renderer.on("move",()=>this.emit("move")).on("draw",()=>{this._updateHash(),this.emit("draw",{full:!0})})),this.dimensions=hc(e);let r=i.systems.edits,s=i.systems.filters,n=i.systems.imagery,o=i.systems.photos,a=this._renderer.scene,l=d=>{let m=i.mode?.id;m!=="browse"&&m!=="select"||d&&this.transformEase(d)};r.on("merge",d=>{d&&a.dirtyData("osm",d),this.deferredRedraw()}).on("change",d=>{if(d){let m=d.complete();for(let g of m.values())g&&(g.touch(),s.clearEntity(g))}this.immediateRedraw()}).on("undone",(d,m)=>l(m.transform)).on("redone",d=>l(d.transform)),s.on("filterchange",()=>{a.dirtyLayers("osm"),this.immediateRedraw()}),n.on("imagerychange",this.immediateRedraw),o.on("photochange",this.immediateRedraw),a.on("layerchange",this.immediateRedraw);let u=i.services.osm;u&&u.on("authchange",this.immediateRedraw)}_hashchange(e,i){let r=e.get("map"),s=i.get("map");if(!r||r!==s){let a,l,u,d;typeof r=="string"&&([a,l,u,d]=r.split("/",4).map(Number)),(isNaN(a)||!isFinite(a))&&(a=2),(isNaN(l)||!isFinite(l))&&(l=0),(isNaN(u)||!isFinite(u))&&(u=0),(isNaN(d)||!isFinite(d))&&(d=0),a=Zc(a,2,24),l=Zc(l,-90,90),u=Zc(u,-180,180),d=Zc(d,0,360),this.centerZoom([u,l],a)}let n=e.get("id"),o=i.get("id");if(n!==o&&typeof n=="string"){let a=n.split(",").map(u=>u.trim()).filter(Boolean),l=this.mode?.id;a.length&&l!=="save"&&this.selectEntityID(a[0])}}_updateHash(){let[e,i]=this.center(),r=this.zoom(),s=0,n=Math.max(0,Math.ceil(Math.log(r)/Math.LN2)),o=.1;if(isNaN(r)||!isFinite(r)||isNaN(i)||!isFinite(i)||isNaN(e)||!isFinite(e)||isNaN(s)||!isFinite(s))return;let a=r.toFixed(2),l=i.toFixed(n),u=e.toFixed(n),d=s.toFixed(1),m=`${a}/${l}/${u}`;Math.abs(s)>o&&(m+=`/${d}`),this.context.systems.urlhash.setParam("map",m)}deferredRedraw(){!this._renderer||!this.redrawEnabled||this._renderer.deferredRender()}immediateRedraw(){!this._renderer||!this.redrawEnabled||this._renderer.render()}get dimensions(){return this._dimensions}set dimensions(e){let[i,r]=e;this._dimensions=e,this.context.projection.dimensions([[0,0],[i,r]]),this._renderer.resize(i,r)}centerPoint(){return Uo(this._dimensions,.5)}centerLoc(){return this.context.projection.invert(this.centerPoint())}mouse(){return this._renderer.events.coord}mouseLoc(){let e=this.mouse()||this.centerPoint();return this.context.projection.invert(e)}transform(e,i){return e===void 0?this.context.projection.transform():(i===void 0&&(i=0),this._renderer.setTransformAsync(e,i),this)}setTransformAsync(e,i=0){return this._renderer.setTransformAsync(e,i)}centerZoom(e,i,r=0){let s=this.center(),n=this.zoom();if(e[0]===s[0]&&e[1]===s[1]&&i===n)return this;let o=Zc(In(i,u6),MN,PN),a=new zo;a.transform(this.context.projection.transform()),a.scale(o);let l=a.translate(),u=a.project(e),d=this.centerPoint(),m=tr(d,u);return l=Sr(l,m),this.transform({x:l[0],y:l[1],k:o},r)}setCenterZoomAsync(e,i,r=0){let s=this.center(),n=this.zoom();if(e[0]===s[0]&&e[1]===s[1]&&i===n)return new Promise.resolve(this.context.projection.transform());let o=Zc(In(i,u6),MN,PN),a=new zo;a.transform(this.context.projection.transform()),a.scale(o);let l=a.translate(),u=a.project(e),d=this.centerPoint(),m=tr(d,u);return l=Sr(l,m),this.setTransformAsync({x:l[0],y:l[1],k:o},r)}center(e,i){return e===void 0?this.context.projection.invert(this.centerPoint()):(i===void 0&&(i=0),e[0]=Zc(e[0]||0,-180,180),e[1]=Zc(e[1]||0,-90,90),this.centerZoom(e,this.zoom(),i))}zoom(e,i){return e===void 0?Math.max(0,Ba(this.context.projection.scale(),u6)):(i===void 0&&(i=0),e=Zc(e||0,lS,s_),this.centerZoom(this.center(),e,i))}pan(e,i=0){let r=this.context.projection.transform();return this.transform({x:r.x+e[0],y:r.y+e[1],k:r.k},i)}fitEntities(e,i=0){let r;if(Array.isArray(e)?r=Ar(e,this.context.graph()):r=e.extent(this.context.graph()),!isFinite(r.area()))return this;let s=Zc(this.trimmedExtentZoom(r),0,20);return this.centerZoom(r.center(),s,i)}selectEntityID(e,i){let r=i||!1,s=this.context,n=a=>{let l=s.selectedIDs();(s.mode?.id!=="select-osm"||!l.includes(e))&&s.enter("select-osm",{selectedIDs:[a.id]}),(a.extent(s.graph()).percentContainedIn(this.extent())<.8||r)&&this.fitEntities(a)},o=s.hasEntity(e);o?n(o):s.loadEntity(e,(a,l)=>{a||(o=l.data.find(u=>u.id===e),o&&n(o))})}_zoomIn(e){return this.centerZoom(this.center(),~~this.zoom()+e,250)}_zoomOut(e){return this.centerZoom(this.center(),~~this.zoom()-e,250)}zoomIn(){return this._zoomIn(1)}zoomInFurther(){return this._zoomIn(4)}canZoomIn(){return this.zoom()<s_}zoomOut(){return this._zoomOut(1)}zoomOutFurther(){return this._zoomOut(4)}canZoomOut(){return this.zoom()>lS}transformEase(e,i=250){return this.transform(e,i)}centerZoomEase(e,i,r=250){return this.centerZoom(e,i,r)}centerEase(e,i=250){return this.center(e,i)}zoomEase(e,i=250){return this.zoom(e,i)}fitEntitiesEase(e,i=250){return this.fitEntities(e,i)}effectiveZoom(){let e=this.center()[1],i=this.zoom(),r=Cn(1,e),s=Cn(1,0),n=Math.log(r/s)/Math.LN2;return Math.min(i+n,s_)}extent(e){return e===void 0?new mt(this.context.projection.invert([0,this._dimensions[1]]),this.context.projection.invert([this._dimensions[0],0])):this.centerZoom(e.center(),this.extentZoom(e))}trimmedExtent(e){return e===void 0?new mt(this.context.projection.invert([10,this._dimensions[1]-30-10]),this.context.projection.invert([this._dimensions[0]-10,71+10])):this.centerZoom(e.center(),this.trimmedExtentZoom(e))}extentZoom(e,i){let[r,s]=i||this._dimensions,n=this.context.projection.project([e.min[0],e.max[1]]),o=this.context.projection.project([e.max[0],e.min[1]]),a=(o[0]-n[0])/r,l=(o[1]-n[1])/s,u=Math.log(Math.abs(a))/Math.LN2,d=Math.log(Math.abs(l))/Math.LN2,m=Math.max(u,d),g=this.zoom(),_=Math.max(g,19);return isFinite(m)?g-m:_}trimmedExtentZoom(e){let s=tr(this._dimensions,[40,140]);return this.extentZoom(e,s)}get highlightEdits(){return this._highlightEdits}set highlightEdits(e){this._highlightEdits!==e&&(this._highlightEdits=e,this._renderer.scene.dirtyScene(),this.immediateRedraw(),this.emit("mapchange"))}get areaFillMode(){return this._currFillMode}set areaFillMode(e){let i=this.context.systems.storage,r=this._currFillMode;r!==e&&(r!=="wireframe"&&(this._toggleFillMode=r,i.setItem("area-fill-toggle",r)),this._currFillMode=e,i.setItem("area-fill",e),this._renderer.scene.dirtyScene(),this.immediateRedraw(),this.emit("mapchange"))}get wireframeMode(){return this._currFillMode==="wireframe"}set wireframeMode(e){e?this.areaFillMode!=="wireframe"&&(this.areaFillMode="wireframe"):this.areaFillMode=this._toggleFillMode}get scene(){return this._renderer.scene}get renderer(){return this._renderer}};var LN=Xi(DN(),1);var FN="#01d4fa",d6=class extends ui{constructor(e){super(e),this.id="map3d",this.autoStart=!1,this.dependencies=new Set(["map"]),this.containerID="3d-buildings",this.maplibre=null,this._startPromise=null,this.building3dlayerSpec=this.get3dBuildingLayerSpec("3D Buildings","osmbuildings"),this.roadStrokelayerSpec=this.getRoadStrokeLayerSpec("Roads","osmroads"),this.roadCasinglayerSpec=this.getRoadCasingLayerSpec("Roads","osmroads"),this.roadSelectedlayerSpec=this.getRoadSelectedLayerSpec("Roads","osmroads"),this.areaLayerSpec=this.getAreaLayerSpec("Areas","osmareas")}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._startPromise?this._startPromise:(this.maplibre=new LN.Map({container:this.containerID,pitch:30,style:{version:8,sources:{},layers:[{id:"Background",type:"background",layout:{visibility:"visible"},paint:{"background-color":"white"}}]}}),this._startPromise=new Promise(e=>{let i=this.context.systems.map,r=this.maplibre;r.on("load",()=>{r.setLight({anchor:"viewport",color:"#ff00ff",position:[1,200,30],intensity:.3}),r.jumpTo({zoom:i.zoom()-3,center:i.extent().center()}),r.addSource("osmareas",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r.addLayer(this.areaLayerSpec),r.addSource("osmroads",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r.addLayer(this.roadSelectedlayerSpec),r.addLayer(this.roadCasinglayerSpec),r.addLayer(this.roadStrokelayerSpec),r.addSource("osmbuildings",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r.addLayer(this.building3dlayerSpec),this._started=!0,e()})}))}resetAsync(){return Promise.resolve()}get3dBuildingLayerSpec(e,i){return{id:e,type:"fill-extrusion",source:i,layout:{},paint:{"fill-extrusion-color":["match",["get","selected"],"true",FN,"#e06e5f"],"fill-extrusion-height":["get","height"],"fill-extrusion-base":["get","min_height"],"fill-extrusion-opacity":.85}}}getAreaLayerSpec(e,i){return{id:e,type:"fill",source:i,layout:{},paint:{"fill-color":["get","fillcolor"],"fill-outline-color":["get","strokecolor"],"fill-opacity":.5}}}getRoadCasingLayerSpec(e,i){return{id:e+"-casing",type:"line",source:i,minzoom:4,layout:{"line-cap":"butt","line-join":"round",visibility:"visible"},paint:{"line-color":["get","casingColor"],"line-width":this.getLineWidthSpecification(6)}}}getRoadSelectedLayerSpec(e,i){return{id:e+"-selected",type:"line",source:i,minzoom:4,layout:{"line-cap":"butt","line-join":"round",visibility:"visible"},paint:{"line-color":FN,"line-opacity":["match",["get","selected"],"true",.75,0],"line-width":this.getLineWidthSpecification(12)}}}getRoadStrokeLayerSpec(e,i){return{id:e+"-stroke",type:"line",source:i,minzoom:4,layout:{"line-cap":"butt","line-join":"round",visibility:"visible"},paint:{"line-color":["get","strokeColor"],"line-opacity":["match",["get","highway"],"unclassified",.8,"service",.2,1],"line-width":this.getLineWidthSpecification(4)}}}getLineWidthSpecification(e){return["interpolate",["linear",2],["zoom"],5,.5,16,["match",["get","highway"],["motorway","trunk","primary"],e*2,["secondary","unclassified"],Math.floor(.75*e*2),["tertiary"],Math.floor(.75*e*2)-1,["minor","service","track","footway","pedestrian","cycleway"],e,e],20,["match",["get","highway"],["motorway","trunk","primary"],e*2.5,["secondary","unclassified"],e*2.5,["tertiary"],e*2.5,["minor","service","track","footway","pedestrian","cycleway"],e*2,e*2]]}};var f6=class extends ui{constructor(e){super(e),this.id="photos",this.dependencies=new Set(["map","urlhash"]),this._LAYERIDS=["streetside","mapillary","mapillary-map-features","mapillary-signs","kartaview"],this._PHOTOTYPES=["flat","panoramic"],this._DATEFILTERS=["fromDate","toDate"],this._shownPhotoTypes=new Set(this._PHOTOTYPES),this._fromDate=null,this._toDate=null,this._usernames=null,this._currLayerID=null,this._currPhotoID=null,this._initPromise=null,this._startPromise=null,this._hashchange=this._hashchange.bind(this),this._updateHash=this._updateHash.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let n of this.dependencies)if(!this.context.systems[n])return Promise.reject(`Cannot init:  ${this.id} requires ${n}`);let e=this.context,i=e.systems.map,r=e.systems.urlhash,s=Promise.all([i.initAsync(),r.initAsync()]);return this._initPromise=s.then(()=>r.on("hashchange",this._hashchange))}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context.systems.map,i=e.startAsync();return this._startPromise=i.then(()=>{e.scene.on("layerchange",this._updateHash),this._started=!0})}resetAsync(){return Promise.resolve()}_hashchange(e,i){let s=this.context.scene(),n=e.get("photo_overlay"),o=i.get("photo_overlay");if(n!==o){let _=new Set;typeof n=="string"&&(_=new Set(n.replace(/;/g,",").split(",")));for(let v of this._LAYERIDS){let E=s.layers.get(v);E&&(E.enabled=_.has(E.id))}}let a=e.get("photo_dates"),l=i.get("photo_dates");if(a!==l)if(typeof a=="string"){let _=/^(.*)[_](.*)$/g.exec(a.trim());this.setDateFilter("fromDate",_&&_.length>=2&&_[1]),this.setDateFilter("toDate",_&&_.length>=3&&_[2])}else this._toDate=this._fromDate=null;let u=e.get("photo_username"),d=i.get("photo_username");u!==d&&this.setUsernameFilter(u);let m=e.get("photo"),g=i.get("photo");if(m!==g&&typeof m=="string"){let[_,v]=m.split("/",2).filter(Boolean);_&&v?this.selectPhoto(_,v):this.selectPhoto()}}_updateHash(){let e=this.context.systems.urlhash,i=this.context.scene(),r=[];for(let o of this._LAYERIDS){let a=i.layers.get(o);a&&a.supported&&a.enabled&&r.push(o)}e.setParam("photo_overlay",r.length?r.join(","):null);let s;this._currLayerID&&this._currPhotoID&&(s=`${this._currLayerID}/${this._currPhotoID}`),e.setParam("photo",s);let n;(this._fromDate||this._toDate)&&(n=(this._fromDate||"")+"_"+(this._toDate||"")),e.setParam("photo_dates",n),e.setParam("photo_username",this._usernames?this._usernames.join(","):null)}get overlayLayerIDs(){return this._LAYERIDS}get allPhotoTypes(){return this._PHOTOTYPES}get dateFilters(){return this._DATEFILTERS}get fromDate(){return this._fromDate}get toDate(){return this._toDate}get usernames(){return this._usernames}selectPhoto(e=null,i=null){if(e===this._currLayerID&&i===this._currPhotoID)return;this._currLayerID=e,this._currPhotoID=i;let r=this.context,s=r.scene();if(s.clearClass("selected"),e&&i){let n=r.services[e];if(!n)return null;s.enableLayers(e),s.classData(e,i,"selected"),n.startAsync().then(()=>n.selectImageAsync(i)).then(()=>n.showViewer())}this._updateHash(),this.emit("photochange")}dateFilterValue(e){return e==="fromDate"?this._fromDate:e==="toDate"?this._toDate:null}setDateFilter(e,i){let r=i&&new Date(i);r&&!isNaN(r)?i=r.toISOString().slice(0,10):i=null;let s=!1;e==="fromDate"&&(this._fromDate=i,s=!0,this._fromDate&&this._toDate&&new Date(this._toDate)<new Date(this._fromDate)&&(this._toDate=this._fromDate)),e==="toDate"&&(this._toDate=i,s=!0,this._fromDate&&this._toDate&&new Date(this._toDate)<new Date(this._fromDate)&&(this._fromDate=this._toDate)),s&&(this._updateHash(),this.emit("photochange"))}setUsernameFilter(e){e&&typeof e=="string"&&(e=e.replace(/;/g,",").split(",")),e&&(e=e.map(i=>i.trim()).filter(Boolean),e.length||(e=null)),this._usernames=e,this._updateHash(),this.emit("photochange")}togglePhotoType(e){this._PHOTOTYPES.includes(e)&&(this._shownPhotoTypes.has(e)?this._shownPhotoTypes.delete(e):this._shownPhotoTypes.add(e),this.emit("photochange"))}_showsLayer(e){return this.context.scene().layers.get(e)?.enabled}shouldFilterByDate(){return this._showsLayer("mapillary")||this._showsLayer("kartaview")||this._showsLayer("streetside")}shouldFilterByPhotoType(){return this._showsLayer("mapillary")||this._showsLayer("streetside")&&this._showsLayer("kartaview")}shouldFilterByUsername(){return!this._showsLayer("mapillary")&&this._showsLayer("kartaview")&&!this._showsLayer("streetside")}showsPhotoType(e){return this.shouldFilterByPhotoType()?this._shownPhotoTypes.has(e):!0}showsFlat(){return this.showsPhotoType("flat")}showsPanoramic(){return this.showsPhotoType("panoramic")}};function a0(t,e){let i=Mt("change"),r=[],s=[],n=ye(null),o=ye(null),a=ye(null),l=ye(null),u,d,m=[],g,_=e.presetField.options;if(Array.isArray(_))for(let A of _)r.push(A==="undefined"?void 0:A),s.push(e.tHtml(`options.${A}`,{default:A}));else r=[void 0,"yes"],s=[t.tHtml("inspector.unknown"),t.tHtml("inspector.check.yes")],e.type!=="defaultCheck"&&(r.push("no"),s.push(t.tHtml("inspector.check.no")));function v(){if(d=e.id==="oneway_yes",e.id==="oneway"&&m.length){let A=t.entity(m[0]);for(let M in A.tags)if(M in I1&&A.tags[M]in I1[M]){d=!0,s[0]=t.tHtml("_tagging.presets.fields.oneway_yes.options.undefined");break}}}function E(){return t.container().select("div.inspector-hover").empty()?!(g==="yes"||d&&!g):!0}function b(A){let M=m.length&&t.hasEntity(m[0]);if(E()||!M)return A;let k=M.first(),F=M.isClosed()?M.nodes[M.nodes.length-2]:M.last(),B=k<F?"#rapid-icon-forward":"#rapid-icon-backward";return A.selectAll(".reverser-span").html(t.tHtml("inspector.check.reverser")).call(Ye(B,"inline")),A}let T=function(A){v(),a=A.selectAll(".form-field-input-wrap").data([0]);let M=a.enter().append("label").attr("class","form-field-input-wrap form-field-input-check");M.append("input").property("indeterminate",e.type!=="defaultCheck").attr("type","checkbox").attr("id",e.uid),M.append("span").html(s[0]).attr("class","value"),e.type==="onewayCheck"&&M.append("button").attr("class","reverser"+(E()?" hide":"")).append("span").attr("class","reverser-span"),a=a.merge(M),n=a.selectAll("input"),o=a.selectAll("span.value"),n.on("click",function(k){k.stopPropagation();let F=e.key,O={};Array.isArray(u[F])?r.indexOf("yes")!==-1?O[F]="yes":O[F]=r[0]:O[F]=r[(r.indexOf(g)+1)%r.length],(O[F]==="reversible"||O[F]==="alternating")&&(O[F]=r[0]),i.call("change",this,O)}),e.type==="onewayCheck"&&(l=a.selectAll(".reverser"),l.call(b).on("click",function(k){k.preventDefault(),k.stopPropagation(),m.length&&(t.perform(function(F){for(let O of m)F=pl(O)(F);return F},t.t("operations.reverse.annotation.line",{n:1})),t.systems.validator.validate(),ye(this).call(b))}))};return T.entityIDs=function(A){return arguments.length?(m=A,T):m},T.tags=function(A){u=A;let M=e.key;function k(B){return B!=="no"&&B!==""&&B!==void 0&&B!==null}function F(B){B===""&&(B=void 0);let U=r.indexOf(B);return U===-1?`"${B}"`:s[U]}v();let O=Array.isArray(A[M]);g=!O&&A[M]&&A[M].toLowerCase(),e.type==="onewayCheck"&&(g==="1"||g==="-1")&&(g="yes"),n.property("indeterminate",O||e.type!=="defaultCheck"&&!g).property("checked",k(g)),o.html(O?t.tHtml("inspector.multiple_values"):F(g)).classed("mixed",O),a.classed("set",!!g),e.type==="onewayCheck"&&l.classed("hide",E()).call(b)},T.focus=function(){n.node().focus()},$t(T,i,"on")}var n_;function gr(t,e){var i=Mt("accept","cancel"),r=t.container(),s=[],n=[],o={},a=null,l=!0,u=!1,d=!1,m=2,g=0,_,v,E=function(T,A){A(n.filter(function(M){var k=M.terms||[];return k.push(M.value),k.some(function(F){return F.toString().toLowerCase().indexOf(T.toLowerCase())!==-1})}))},b=function(T,A){if(!T||T.empty())return;T.classed("combobox-input",!0).on("focus.combo-input",F).on("blur.combo-input",O).on("keydown.combo-input",$).on("keyup.combo-input",q).on("input.combo-input",W).on("mousedown.combo-input",M).each(function(){var oe=this.parentNode,ie=this.nextSibling;ye(oe).selectAll(".combobox-caret").filter(function(ne){return ne===T.node()}).data([T.node()]).enter().insert("div",function(){return ie}).attr("class","combobox-caret").on("mousedown.combo-caret",function(ne){ne.preventDefault(),T.node().focus(),M(ne)}).on("mouseup.combo-caret",function(ne){ne.preventDefault(),k(ne)})});function M(oe){if(oe.button===0){g=+new Date;var ie=T.property("selectionStart"),ne=T.property("selectionEnd");if(ie!==ne){var me=ti(T);T.node().setSelectionRange(me.length,me.length);return}T.on("mouseup.combo-input",k)}}function k(oe){if(T.on("mouseup.combo-input",null),oe.button===0&&T.node()===document.activeElement){var ie=T.property("selectionStart"),ne=T.property("selectionEnd");if(ie===ne){var me=r.selectAll(".combobox");if(me.empty()||me.datum()!==T.node()){var De=g;window.setTimeout(function(){De===g&&ce("",function(){B(),le()})},250)}else U()}}}function F(){ce("")}function O(){n_=window.setTimeout(U,75)}function B(){U(),r.insert("div",":first-child").datum(T.node()).attr("class","combobox"+(e?" combobox-"+e:"")).style("position","absolute").style("display","block").style("left","0px").on("mousedown.combo-container",function(oe){oe.preventDefault()}),r.on("scroll.combo-scroll",le,!0)}function U(){n_&&(window.clearTimeout(n_),n_=void 0),r.selectAll(".combobox").remove(),r.on("scroll.combo-scroll",null)}function $(oe){var ie=!r.selectAll(".combobox").empty(),ne=T.node()?T.node().tagName.toLowerCase():"";switch(oe.keyCode){case 8:case 46:oe.stopPropagation(),a=null,le(),T.on("input.combo-input",function(){var me=T.property("selectionStart");T.node().setSelectionRange(me,me),T.on("input.combo-input",W)});break;case 9:te(oe);break;case 13:oe.preventDefault(),oe.stopPropagation();break;case 38:if(ne==="textarea"&&!ie)return;oe.preventDefault(),ne==="input"&&!ie&&B(),Z(-1);break;case 40:if(ne==="textarea"&&!ie)return;oe.preventDefault(),ne==="input"&&!ie&&B(),Z(1);break}}function q(oe){switch(oe.keyCode){case 27:ee();break;case 13:te(oe);break}}function W(){ce(X(),function(){a=null;var oe=T.property("value");if(s.length&&(T.property("selectionEnd")===oe.length&&(a=de()),a||(a=oe)),oe.length){var ie=r.selectAll(".combobox");ie.empty()&&B()}else U();le()})}function Z(oe){if(s.length){for(var ie=-1,ne=0;ne<s.length;ne++)if(a&&s[ne].value===a){ie=ne;break}ie=Math.max(Math.min(ie+oe,s.length-1),0),a=s[ie].value,T.property("value",a)}le(),Q()}function Q(){var oe=r.selectAll(".combobox");if(!oe.empty()){var ie=r.node().getBoundingClientRect(),ne=oe.node().getBoundingClientRect();if(ne.bottom>ie.bottom){var me=A?A.node():T.node();me.scrollIntoView({behavior:"instant",block:"center"}),le()}var De=oe.selectAll(".combobox-option.selected").node();De&&De.scrollIntoView({behavior:"smooth",block:"nearest"})}}function X(){var oe=T.property("value"),ie=T.property("selectionStart"),ne=T.property("selectionEnd");return ie&&ne&&(oe=oe.substring(0,ie)),oe}function ce(oe,ie){d=!1,E.call(T,oe,function(ne){d||(s=ne,ne.forEach(function(me){o[me.value]=me}),ie&&ie())})}function de(){if(l){var oe=u?X():X().toLowerCase();if(oe&&!(!isNaN(parseFloat(oe))&&isFinite(oe))){for(var ie=-1,ne=0;ne<s.length;ne++){var me=s[ne].value,De=u?me:me.toLowerCase();if(De===oe){ie=ne;break}else ie===-1&&De.indexOf(oe)===0&&(ie=ne)}if(ie!==-1){var He=s[ie].value;return T.property("value",He),T.node().setSelectionRange(oe.length,He.length),He}}}}function le(){if(s.length<m||document.activeElement!==T.node()){U();return}var oe=!r.selectAll(".combobox").empty();if(oe){var ie=r.selectAll(".combobox"),ne=ie.selectAll(".combobox-option").data(s,function(Je){return Je.value});ne.exit().remove(),ne.enter().append("a").attr("class",function(Je){return"combobox-option "+(Je.klass||"")}).attr("title",function(Je){return Je.title}).html(function(Je){return Je.display||Je.value}).on("mouseenter",_).on("mouseleave",v).merge(ne).classed("selected",function(Je){return Je.value===a}).on("click.combo-option",te).order();var me=A?A.node():T.node(),De=r.node().getBoundingClientRect(),He=me.getBoundingClientRect();ie.style("left",He.left+5-De.left+"px").style("width",He.width-10+"px").style("top",He.height+He.top-De.top+"px")}}function te(oe,ie){d=!0;var ne=T.node();ie&&(ti(T,ie.value),L2(T,"change"));var me=ti(T);ne.setSelectionRange(me.length,me.length),ie=o[me],i.call("accept",ne,ie,me),U()}function ee(){d=!0;var oe=T.node(),ie=ti(T),ne=T.property("selectionStart"),me=T.property("selectionEnd");ie=ie.slice(0,ne)+ie.slice(me),ti(T,ie),oe.setSelectionRange(ie.length,ie.length),i.call("cancel",oe),U()}};return b.canAutocomplete=function(T){return arguments.length?(l=T,b):l},b.caseSensitive=function(T){return arguments.length?(u=T,b):u},b.data=function(T){return arguments.length?(n=T,b):n},b.fetcher=function(T){return arguments.length?(E=T,b):E},b.minItems=function(T){return arguments.length?(m=T,b):m},b.itemsMouseEnter=function(T){return arguments.length?(_=T,b):_},b.itemsMouseLeave=function(T){return arguments.length?(v=T,b):v},$t(b,i,"on")}gr.off=function(t,e){t.on("focus.combo-input",null).on("blur.combo-input",null).on("keydown.combo-input",null).on("keyup.combo-input",null).on("input.combo-input",null).on("mousedown.combo-input",null).on("mouseup.combo-input",null),e.container().on("scroll.combo-scroll",null)};function il(t,e){let i=Mt("change"),r=e.presetField;var s=e.type==="multiCombo"||e.type==="manyCombo",n=e.type==="networkCombo",o=e.type==="semiCombo",a=r.options,l=e.type!=="manyCombo"&&r.autoSuggestions!==!1,u=e.type!=="manyCombo"&&r.customValues!==!1,d=r.snake_case||r.snake_case===void 0,m=gr(t,"combo-"+e.safeid).caseSensitive(r.caseSensitive).minItems(s||o?1:2),g=ye(null),_=ye(null),v=ye(null),E=[],b=[],T=[],A,M,k,F=[];t.systems.data.getDataAsync("deprecated").then(function(ie){F=ie}).catch(ie=>console.error(ie)),s&&e.key&&/[^:]$/.test(e.key)&&(e.key+=":");function B(ie){return ie.replace(/\s+/g,"_").toLowerCase()}function U(ie){return ie.split(";").map(ne=>ne.trim()).join(";")}function $(ie){ie=U(ie||"");var ne=E.find(function(me){return me.key&&U(me.value)===ie});return ne?ne.key:e.type==="typeCombo"&&!ie?"yes":(d?B(ie):ie)||void 0}function q(ie){return ie=ie||"",e.hasTextForStringID("options."+ie)?e.t(`options.${ie}`,{default:ie}):e.type==="typeCombo"&&ie.toLowerCase()==="yes"?"":ie}function W(ie,ne){return ie.filter(function(me){return!ne.some(function(De){return!De.isMixed&&me.value===De.value})})}function Z(ie,ne){u||ie.attr("readonly","readonly"),t.services.taginfo&&l?(ie.call(m.fetcher(X),ne),X("",ce)):(ie.call(m,ne),Q(ce))}function Q(ie){a&&(E=a.map(function(ne){return{key:ne,value:e.t(`options.${ne}`,{default:ne}),title:ne,display:e.tHtml(`options.${ne}`,{default:ne}),klass:e.hasTextForStringID(`options.${ne}`)?"":"raw-option"}}),m.data(W(E,b)),ie&&ie(E))}function X(ie,ne){let me=t.services.taginfo;if(!me){E=[],ne&&ne(E);return}var De=s?me.multikeys:me.values,He=(s?e.key:"")+ie,Je=n&&M&&M.indexOf(ie.toLowerCase())===0;Je&&(He=M+":");var ot={debounce:ie!=="",key:e.key,query:He};T.length&&(ot.geometry=t.graph().geometry(T[0])),De(ot,function(gt,vt){if(!gt){vt=vt.filter(function(Se){return e.type==="typeCombo"&&Se.value==="yes"?!1:!Se.count||Se.count>10});var ct=Dt.deprecatedTagValuesByKey(F)[e.key];ct&&(vt=vt.filter(function(Se){return ct.indexOf(Se.value)===-1})),Je&&(vt=vt.filter(function(Se){return Se.value.toLowerCase().indexOf(M+":")===0})),g.classed("empty-combobox",vt.length===0),E=vt.map(function(Se){var Qe=Se.value;s&&(Qe=Qe.replace(e.key,""));var xt=e.t(`options.${Qe}`,{default:Qe});return{key:Qe,value:xt,display:e.tHtml(`options.${Qe}`,{default:Qe}),title:Se.title||xt,klass:e.hasTextForStringID(`options.${Qe}`)?"":"raw-option"}}),E=W(E,b),ne&&ne(E)}})}function ce(ie){if(s||o)k=e.placeholder||t.t("inspector.add");else{var ne=ie.map(function(He){return He.value}).filter(function(He){return He.length<20}),me=ne.length>1?ne:ie.map(function(He){return He.key});k=e.placeholder||me.slice(0,3).join(", ")}/(|\.\.\.)$/.test(k)||(k+="\u2026");var De;!s&&!o&&A&&Array.isArray(A[e.key])?De=t.t("inspector.multiple_values"):De=k,g.selectAll("input").attr("placeholder",De)}function de(){var ie={},ne;if(s||o){ne=$(ti(v))||"",g.classed("active",!1),ti(v,"");var me=ne.split(";").filter(Boolean);if(!me.length)return;if(s)Ei(me).forEach(function(Je){var ot=(e.key||"")+Je;if(A){var gt=A[ot];if(typeof gt=="string"&&gt.toLowerCase()!=="no")return}ot=t.cleanTagKey(ot),e.keys.push(ot),ie[ot]="yes"});else if(o){var De=b.map(function(Je){return Je.key});De=De.concat(me),ie[e.key]=t.cleanTagValue(Ei(De).filter(Boolean).join(";"))}window.setTimeout(function(){v.node().focus()},10)}else{var He=ti(v);if(!He&&Array.isArray(A[e.key]))return;ne=t.cleanTagValue($(He)),ie[e.key]=ne||void 0}i.call("change",this,ie)}function le(){let ie=t.systems.rapid,ne=T?.length&&T[0];return ne&&ie.acceptedIDs.has(ne)}function te(ie,ne){ie.preventDefault(),ie.stopPropagation();let me=e.key;if(!(me==="source"&&le())){var De={};if(s)De[ne.key]=void 0;else if(o){var He=b.map(function(Je){return Je.key===ne.key?null:Je.key}).filter(Boolean);He=Ei(He),De[me]=He.length?He.join(";"):void 0}i.call("change",this,De)}}function ee(ie){g=ie.selectAll(".form-field-input-wrap").data([0]);var ne=s||o?"multicombo":"combo";if(g=g.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+ne).merge(g),s||o){g=g.selectAll(".chiplist").data([0]);var me="chiplist";(e.key==="destination"||e.key==="via")&&(me+=" full-line-chips"),g=g.enter().append("ul").attr("class",me).on("click",function(){window.setTimeout(function(){v.node().focus()},10)}).merge(g),_=g.selectAll(".input-wrap").data([0]),_=_.enter().append("li").attr("class","input-wrap").merge(_),v=_.selectAll("input").data([0])}else v=g.selectAll("input").data([0]);if(v=v.enter().append("input").attr("type","text").attr("id",e.uid).call(ki).call(Z,ie).merge(v),n){var De=e.entityExtent,He=De&&nh(De.center());M=He&&He.toLowerCase()}v.on("change",de).on("blur",de),v.on("keydown.field",function(Je){switch(Je.keyCode){case 13:v.node().blur(),Je.stopPropagation();break}}),(s||o)&&(m.on("accept",function(){v.node().blur(),v.node().focus()}),v.on("focus",function(){g.classed("active",!0)}))}ee.tags=function(ie){A=ie;let ne=e.key,me=e.keys;if(s||o){b=[];var De;if(s){for(var He in ie)if(!(ne&&He.indexOf(ne)!==0)&&!(!ne&&me.indexOf(He)===-1)){var Je=ie[He];if(!(!Je||typeof Je=="string"&&Je.toLowerCase()==="no")){var ot=ne?He.slice(ne.length):He;b.push({key:He,value:q(ot),isMixed:Array.isArray(Je)})}}ne?(me=b.map(function(Oe){return Oe.key}),De=t.maxCharsForTagKey-fb(ne)):De=t.maxCharsForTagKey}else if(o){var gt=[],vt;Array.isArray(ie[ne])?(ie[ne].forEach(function(Oe){var Ie=Ei((Oe||"").split(";")).filter(Boolean);gt=gt.concat(Ie),vt?vt=vt.filter(nt=>Ie.includes(nt)):vt=Ie}),gt=Ei(gt).filter(Boolean)):(gt=Ei((ie[ne]||"").split(";")).filter(Boolean),vt=gt),b=gt.map(function(Oe){return{key:Oe,value:q(Oe),isMixed:!vt.includes(Oe)}});var ct=fb(vt.join(";"));De=t.maxCharsForTagValue-ct,ct>0&&(De-=1)}De=Math.max(0,De);var Se=o&&!Array.isArray(ie[ne]),Qe=W(E,b);m.data(Qe);var xt=!u&&!Qe.length||De<=0;g.selectAll(".chiplist .input-wrap").style("display",xt?"none":null);var It=g.selectAll(".chip").data(b);It.exit().remove();var Gt=It.enter().insert("li",".input-wrap").attr("class","chip");Gt.append("span"),Gt.append("a"),It=It.merge(Gt).order().classed("raw-value",function(Oe){var Ie=Oe.key;return s&&(Ie=Ie.replace(ne,"")),!e.hasTextForStringID("options."+Ie)}).classed("draggable",Se).classed("mixed",function(Oe){return Oe.isMixed}).attr("title",function(Oe){return Oe.isMixed?t.t("inspector.unshared_value_tooltip"):null}),Se&&oe(It),It.select("span").html(Oe=>Oe.value),e.key==="source"&&le()||It.select("a").attr("href","#").on("click",te).attr("class","remove").text("\xD7")}else{var Ni=Array.isArray(ie[ne]),je=Ni&&ie[ne].map(function(Oe){return q(Oe)}).filter(Boolean),be=!Ni&&ie[ne]&&!(e.type==="typeCombo"&&ie[ne]==="yes"),ge=be&&!e.hasTextForStringID("options."+ie[ne]),xe=be&&!ge,Pe=!u||xe;ti(v,Ni?"":q(ie[ne])).classed("raw-value",ge).classed("known-value",xe).attr("readonly",Pe?"readonly":void 0).attr("title",Ni?je.join(`
`):void 0).attr("placeholder",Ni?t.t("inspector.multiple_values"):k||"").classed("mixed",Ni).on("keydown.deleteCapture",function(Oe){if(Pe&&xe&&(Oe.keyCode===zi.keyCodes["\u232B"]||Oe.keyCode===zi.keyCodes["\u2326"])){Oe.preventDefault(),Oe.stopPropagation();var Ie={};Ie[ne]=void 0,i.call("change",this,Ie)}})}};function oe(ie){let ne=e.key;var me,De;ie.call(P3().on("start",function(He){me={x:He.x,y:He.y},De=null}).on("drag",function(He){var Je=He.x-me.x,ot=He.y-me.y;if(!(!ye(this).classed("dragging")&&Math.sqrt(Math.pow(Je,2)+Math.pow(ot,2))<=5)){var gt=ie.nodes().indexOf(this);ye(this).classed("dragging",!0),De=null;var vt=null,ct=ye(this).node().offsetWidth;ne==="destination"||ne==="via"?g.selectAll(".chip").style("transform",function(Se,Qe){var xt=ye(this).node();return gt===Qe?"translate("+Je+"px, "+ot+"px)":Qe>gt&&He.y>xt.offsetTop?((De===null||Qe>De)&&(De=Qe),"translateY(-100%)"):Qe<gt&&He.y<xt.offsetTop+xt.offsetHeight?((De===null||Qe<De)&&(De=Qe),"translateY(100%)"):null}):g.selectAll(".chip").each(function(Se,Qe){var xt=ye(this).node();gt!==Qe&&He.x<xt.offsetLeft+xt.offsetWidth+5&&He.x>xt.offsetLeft&&He.y<xt.offsetTop+xt.offsetHeight&&He.y>xt.offsetTop&&(De=Qe,vt=xt.offsetTop)}).style("transform",function(Se,Qe){var xt=ye(this).node();if(gt===Qe)return"translate("+Je+"px, "+ot+"px)";if(xt.offsetTop===vt){if(Qe<gt&&Qe>=De)return"translateX("+ct+"px)";if(Qe>gt&&Qe<=De)return"translateX(-"+ct+"px)"}return null})}}).on("end",function(){if(ye(this).classed("dragging")){var He=ie.nodes().indexOf(this);if(ye(this).classed("dragging",!1),g.selectAll(".chip").style("transform",null),typeof De=="number"){var Je=b[He];b.splice(He,1),b.splice(De,0,Je);var ot={};b.length?ot[ne]=b.map(function(gt){return gt.key}).join(";"):ot[ne]=void 0,i.call("change",this,ot)}me=void 0,De=void 0}}))}return ee.focus=function(){v.node().focus()},ee.entityIDs=function(ie){return arguments.length?(T=ie||[],ee):T},$t(ee,i,"on")}function Aa(t,e){let i=t.systems.l10n,r=Mt("change"),s=ye(null),n=ye(null),o=[],a,l={};e.type==="tel"&&t.systems.data.getDataAsync("phone_formats").then(b=>{l=b,m()}).catch(b=>console.error(b));function u(){let b=["brand","network","operator","flag"].includes(e.id)&&o.length&&o.some(T=>{let A=t.graph().hasEntity(T);if(!A)return!1;if(A.tags.wikidata)return!0;let k=t.systems.presets.match(A,t.graph())?.suggestion,F=e.id;return k&&!!A.tags[F]&&!!A.tags[F+":wikidata"]});e.locked(b)}function d(E){let b=e.presetField;u();let T=e.locked(),A=E.selectAll(".form-field-input-wrap").data([0]);if(A=A.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(A),s=A.selectAll("input").data([0]),s=s.enter().append("input").attr("type",e.type==="identifier"||e.type==="roadheight"?"text":e.type).attr("id",e.uid).classed(e.type,!0).call(ki).merge(s),s.classed("disabled",!!T).attr("readonly",T||null).on("input",v(!0)).on("blur",v()).on("change",v()),e.type==="tel")m();else if(e.type==="number"){s.attr("type","text");let M=b.increment()??1,k=A.selectAll(".increment, .decrement").data(i.isRTL()?[M,-M]:[-M,M]);k.enter().append("button").attr("class",function(F){return`form-field-button ${F>0?"increment":"decrement"}`}).merge(k).on("click",function(F,O){F.preventDefault();let U=(s.node().value||"0").split(";");U=U.map($=>{let q=parseFloat($.trim(),10);return isFinite(q)?_(q+O):$.trim()}),s.node().value=U.join(";"),v()()})}else e.type==="identifier"&&b.urlFormat&&b.pattern?(s.attr("type","text"),n=A.selectAll(".foreign-id-permalink").data([0]),n.enter().append("button").call(Ye("#rapid-icon-out-link")).attr("class","form-field-button foreign-id-permalink").attr("title",function(){let M=/^https?:\/\/(.{1,}?)\//.exec(b.urlFormat);if(M.length>=2&&M[1]){let k=M[1];return i.t("icons.view_on",{domain:k})}return""}).on("click",function(M){M.preventDefault();let k=g();if(k){let F=b.urlFormat.replace(/{value}/,encodeURIComponent(k));window.open(F,"_blank")}}).merge(n)):e.type==="url"&&(s.attr("type","text"),n=A.selectAll(".foreign-id-permalink").data([0]),n.enter().append("button").call(Ye("#rapid-icon-out-link")).attr("class","form-field-button foreign-id-permalink").attr("title",()=>i.t("icons.visit_website")).on("click",function(M){M.preventDefault();let k=g();k&&window.open(k,"_blank")}).merge(n))}function m(){if(s.empty()||!Object.keys(l).length)return;let E=e.entityExtent,b=E&&nh(E.center()),T=b&&l[b.toLowerCase()];T&&s.attr("placeholder",T)}function g(){let E=e.presetField.pattern,b=ti(s).trim().split(";")[0];return e.type==="url"&&b?b:e.type==="identifier"&&E?b&&b.match(new RegExp(E)):null}function _(E){let b=e.presetField;return b.minValue!==void 0&&(E=Math.max(E,b.minValue)),b.maxValue!==void 0&&(E=Math.min(E,b.maxValue)),E}function v(E){return function(){let b=e.key,T={},A=ti(s);if(E||(A=t.cleanTagValue(A)),!(!A&&Array.isArray(a[b]))){if(!E){if(e.type==="number"&&A){let M=A.split(";");M=M.map(k=>{let F=parseFloat(k.trim(),10);return isFinite(F)?_(F):k.trim()}),A=M.join(";")}ti(s,A)}T[b]=A||void 0,r.call("change",this,T,E)}}}return d.entityIDs=function(E){return arguments.length?(o=E,d):o},d.tags=function(E){a=E;let b=e.key,T=Array.isArray(E[b]);if(ti(s,!T&&E[b]?E[b]:"").attr("title",T?E[b].filter(Boolean).join(`
`):void 0).attr("placeholder",T?i.t("inspector.multiple_values"):e.placeholder||i.t("inspector.unknown")).classed("mixed",T),n&&!n.empty()){let A=!g();n.classed("disabled",A)}},d.focus=function(){let E=s.node();E&&E.focus()},$t(d,r,"on")}function hS(t,e){let i=Mt("change"),r=ye(null),s;function n(l){let u=l.selectAll(".form-field-input-wrap").data([0]);u=u.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(u);let d=u.selectAll("ul").data([0]);d=d.enter().append("ul").attr("class","rows").merge(d),r=d.selectAll("li").data(e.keys);let m=r.enter().append("li").attr("class",g=>`labeled-input preset-access-${g}`);m.append("span").attr("class","label preset-label-access").attr("for",g=>`preset-input-access-${g}`).html(g=>e.tHtml(`types.${g}`)),m.append("div").attr("class","preset-input-access-wrap").append("input").attr("type","text").attr("class",g=>`preset-input-access preset-input-access-${g}`).call(ki).each((g,_,v)=>{ye(v[_]).call(gr(t,`access-${g}`).data(n.options(g)))}),r=r.merge(m),u.selectAll(".preset-input-access").on("change",o).on("blur",o)}function o(l,u){let d={},m=t.cleanTagValue(ti(ye(this)));!m&&typeof s[u]!="string"||(d[u]=m||void 0,i.call("change",this,d))}n.options=function(l){let u=["no","permissive","private","permit","destination"];return l!=="access"&&(u.unshift("yes"),u.push("designated"),l==="bicycle"&&u.push("dismount")),u.map(d=>({title:e.t(`options.${d}.description`),value:d}))};let a={footway:{foot:"designated",motor_vehicle:"no"},steps:{foot:"yes",motor_vehicle:"no",bicycle:"no",horse:"no"},pedestrian:{foot:"yes",motor_vehicle:"no"},cycleway:{motor_vehicle:"no",bicycle:"designated"},bridleway:{motor_vehicle:"no",horse:"designated"},path:{foot:"yes",motor_vehicle:"no",bicycle:"yes",horse:"yes"},motorway:{foot:"no",motor_vehicle:"yes",bicycle:"no",horse:"no"},trunk:{motor_vehicle:"yes"},primary:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},secondary:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},tertiary:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},residential:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},unclassified:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},service:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},motorway_link:{foot:"no",motor_vehicle:"yes",bicycle:"no",horse:"no"},trunk_link:{motor_vehicle:"yes"},primary_link:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},secondary_link:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},tertiary_link:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"}};return n.tags=function(l){s=l,ti(r.selectAll(".preset-input-access"),u=>typeof l[u]=="string"?l[u]:"").classed("mixed",u=>l[u]&&Array.isArray(l[u])).attr("title",u=>l[u]&&Array.isArray(l[u])&&l[u].filter(Boolean).join(`
`)).attr("placeholder",u=>{if(l[u]&&Array.isArray(l[u]))return t.t("inspector.multiple_values");if(u==="access")return"yes";if(l.access&&typeof l.access=="string")return l.access;if(l.highway)if(typeof l.highway=="string"){if(a[l.highway]&&a[l.highway][u])return a[l.highway][u]}else{let d=l.highway.filter(Boolean).map(m=>a[m]&&a[m][u]).filter(Boolean);if(d.length===l.highway.length&&new Set(d).size===1)return d[0]}return e.placeholder})},n.focus=function(){r.selectAll(".preset-input-access").node().focus()},$t(n,i,"on")}function dS(t,e){let i=Mt("change"),r=ye(null),s=ye(null),n=[],o,a,l=[{format:[["housenumber","street"],["city","postcode"]]}];t.systems.data.getDataAsync("address_formats").then(A=>{l=A,r.empty()||r.call(v)}).catch(A=>console.error(A));function d(){let A=e.entityExtent.center(),M=new mt(A).padByMeters(200),k=t.systems.edits.intersects(M).filter(F).map(O=>{let B=t.projection.project(A),U=Gs(t.graph().childNodes(O),B,t.projection);return{title:O.tags.name,value:O.tags.name,dist:U.distance}}).sort((O,B)=>O.dist-B.dist);return df(k,"value");function F(O){return O.tags.highway&&O.tags.name&&O.type==="way"}}function m(){let A=e.entityExtent.center(),M=new mt(A).padByMeters(200),k=t.systems.edits.intersects(M).filter(F).map(O=>({title:O.tags["addr:city"]||O.tags.name,value:O.tags["addr:city"]||O.tags.name,dist:fr(O.extent(t.graph()).center(),A)})).sort((O,B)=>O.dist-B.dist);return df(k,"value");function F(O){return!!(O.tags.name&&(O.tags.admin_level==="8"&&O.tags.boundary==="administrative"||O.tags.border_type==="city"||O.tags.place==="city"||O.tags.place==="town"||O.tags.place==="village")||O.tags["addr:city"])}}function g(A){let M=e.entityExtent.center(),k=new mt(M).padByMeters(200),F=t.systems.edits.intersects(k).filter(O).map(B=>({title:B.tags[A],value:B.tags[A],dist:fr(B.extent(t.graph()).center(),M)})).sort((B,U)=>B.dist-U.dist);return df(F,"value");function O(B){return!n.includes(B.id)&&B.tags[A]}}function _(){if(!a)return;let A;for(let U=0;U<l.length;U++){let $=l[U];if(!$.countryCodes)A=$;else if($.countryCodes.includes(a)){A=$;break}}let M=A.dropdowns||["city","county","country","district","hamlet","neighbourhood","place","postcode","province","quarter","state","street","subdistrict","suburb"],k=A.widths||{housenumber:1/3,street:2/3,city:2/3,state:1/4,postcode:1/3};function F(U){let $=U.reduce((q,W)=>q+(k[W]||.5),0);return U.map(q=>({id:q,width:(k[q]||.5)/$}))}let O=s.selectAll(".addr-row").data(A.format,U=>U.toString());O.exit().remove(),O.enter().append("div").attr("class","addr-row").selectAll("input").data(F).enter().append("input").property("type","text").call(b).attr("class",U=>`addr-${U.id}`).call(ki).each(B).style("width",U=>U.width*100+"%");function B(U){if(!M.includes(U.id))return;let $=U.id==="street"?d:U.id==="city"?m:g;ye(this).call(gr(t,`address-${U.id}`).minItems(1).caseSensitive(!0).fetcher(function(q,W){W($(`addr:${U.id}`))}))}s.selectAll("input").on("blur",E()).on("change",E()),s.selectAll("input:not(.combobox-input)").on("input",E(!0)),o&&T(o)}function v(A){r=A,s=A.selectAll(".form-field-input-wrap").data([0]),s=s.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(s);let M=e.entityExtent.center(),k;t.inIntro?k=t.t("intro.graph.countrycode"):k=nh(M),k&&(a=k.toLowerCase(),_())}function E(A){return function(){let M={};s.selectAll("input").each((k,F,O)=>{let B=O[F],U=e.key+":"+k.id,$=A?B.value:t.cleanTagValue(B.value);Array.isArray(o[U])&&!$||(M[U]=$||void 0)}),i.call("change",this,M,A)}}function b(A){return A.attr("placeholder",function(M){let k=e.key+":"+M.id;if(o&&Array.isArray(o[k]))return t.t("inspector.multiple_values");if(a){let F=M.id+"!"+a,O=e.hasTextForStringID("placeholders."+F)?F:M.id;return e.presetField.t(`placeholders.${O}`)}})}function T(A){ti(s.selectAll("input"),function(M){let k=e.key+":"+M.id,F=A[k];return typeof F=="string"?F:""}).attr("title",M=>{let k=e.key+":"+M.id,F=A[k];return F&&Array.isArray(F)&&F.filter(Boolean).join(`
`)}).classed("mixed",M=>{let k=e.key+":"+M.id;return Array.isArray(A[k])}).call(b)}return v.entityIDs=function(A){return arguments.length?(n=A,v):n},v.tags=function(A){o=A,T(A)},v.focus=function(){let A=s.selectAll("input").node();A&&A.focus()},$t(v,i,"on")}function fS(t,e){var i=Mt("change"),r=ye(null),s=ye(null),n;function o(l){function u(_){return _.replace(":","")}s=l.selectAll(".form-field-input-wrap").data([0]),s=s.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(s);var d=s.selectAll("ul").data([0]);d=d.enter().append("ul").attr("class","rows").merge(d);var m=["cycleway:left","cycleway:right"];r=d.selectAll("li").data(m);var g=r.enter().append("li").attr("class",function(_){return"labeled-input preset-cycleway-"+u(_)});g.append("span").attr("class","label preset-label-cycleway").attr("for",function(_){return"preset-input-cycleway-"+u(_)}).html(function(_){return e.tHtml("types."+_)}),g.append("div").attr("class","preset-input-cycleway-wrap").append("input").attr("type","text").attr("class",function(_){return"preset-input-cycleway preset-input-"+u(_)}).call(ki).each(function(_){ye(this).call(gr(t,"cycleway-"+u(_)).data(o.options(_)))}),r=r.merge(g),s.selectAll(".preset-input-cycleway").on("change",a).on("blur",a)}function a(l,u){var d=t.cleanTagValue(ti(ye(this)));if(!(!d&&(Array.isArray(n.cycleway)||Array.isArray(n[u])))){(d==="none"||d==="")&&(d=void 0);var m=u==="cycleway:left"?"cycleway:right":"cycleway:left",g=typeof n.cycleway=="string"?n.cycleway:n[m];g&&Array.isArray(g)&&(g=g[0]),(g==="none"||g==="")&&(g=void 0);var _={};d===g?_={cycleway:d,"cycleway:left":void 0,"cycleway:right":void 0}:(_={cycleway:void 0},_[u]=d,_[m]=g),i.call("change",this,_)}}return o.options=function(){return e.presetField.options.map(function(l){return{title:e.t(`options.${l}.description`),value:l}})},o.tags=function(l){n=l;var u=typeof l.cycleway=="string"&&l.cycleway;ti(r.selectAll(".preset-input-cycleway"),function(d){return u||(!l.cycleway&&typeof l[d]=="string"?l[d]:"")}).attr("title",function(d){if(Array.isArray(l.cycleway)||Array.isArray(l[d])){var m=[];return Array.isArray(l.cycleway)&&(m=m.concat(l.cycleway)),Array.isArray(l[d])&&(m=m.concat(l[d])),m.filter(Boolean).join(`
`)}return null}).attr("placeholder",function(d){return Array.isArray(l.cycleway)||Array.isArray(l[d])?t.t("inspector.multiple_values"):e.placeholder}).classed("mixed",function(d){return Array.isArray(l.cycleway)||Array.isArray(l[d])})},o.focus=function(){var l=s.selectAll("input").node();l&&l.focus()},$t(o,i,"on")}function o_(t,e){var i=Mt("change"),r=40,s=200,n=[];function o(a){var l=t.entity(n[0]).lanes();if(!t.container().select(".inspector-wrap.inspector-hidden").empty()||!a.node().parentNode){a.call(o.off);return}var u=a.selectAll(".form-field-input-wrap").data([0]);u=u.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(u);var d=u.selectAll(".surface").data([0]),m=hc(u),g=m[0]-l.lanes.length*r*1.5+r*.5;d=d.enter().append("svg").attr("width",m[0]).attr("height",300).attr("class","surface").merge(d);var _=d.selectAll(".lanes").data([0]);_=_.enter().append("g").attr("class","lanes").merge(_),_.attr("transform",function(){return"translate("+g/2+", 0)"});var v=_.selectAll(".lane").data(l.lanes);v.exit().remove();var E=v.enter().append("g").attr("class","lane");E.append("g").append("rect").attr("y",50).attr("width",r).attr("height",s),E.append("g").attr("class","forward").append("text").attr("y",40).attr("x",14).html("\u25B2"),E.append("g").attr("class","bothways").append("text").attr("y",40).attr("x",14).html("\u25B2\u25BC"),E.append("g").attr("class","backward").append("text").attr("y",40).attr("x",14).html("\u25BC"),v=v.merge(E),v.attr("transform",function(b){return"translate("+r*b.index*1.5+", 0)"}),v.select(".forward").style("visibility",function(b){return b.direction==="forward"?"visible":"hidden"}),v.select(".bothways").style("visibility",function(b){return b.direction==="bothways"?"visible":"hidden"}),v.select(".backward").style("visibility",function(b){return b.direction==="backward"?"visible":"hidden"})}return o.entityIDs=function(a){n=a},o.tags=function(){},o.focus=function(){},o.off=function(){},$t(o,i,"on")}o_.supportsMultiselection=!1;var eQ=0;function a_(t,e){var i=eQ++,r=ye(null),s=function(A){r=A,A.each(g)},n=es(!1),o=es("top"),a=es("center"),l=es(ye(null)),u,d=es(""),m=es(!0);s.displayType=function(A){return arguments.length?(d=es(A),s):d},s.hasArrow=function(A){return arguments.length?(m=es(A),s):m},s.placement=function(A){return arguments.length?(o=es(A),s):o},s.alignment=function(A){return arguments.length?(a=es(A),s):a},s.scrollContainer=function(A){return arguments.length?(l=es(A),s):l},s.content=function(A){return arguments.length?(u=A,s):u},s.isShown=function(){var A=r.select(".popover-"+i);return!A.empty()&&A.classed("in")},s.show=function(){r.each(_)},s.updateContent=function(){r.each(v)},s.hide=function(){r.each(b)},s.toggle=function(){r.each(T)},s.destroy=function(A,M){M=M||".popover-"+i,A.on("pointerenter.popover",null).on("pointerleave.popover",null).on("pointerup.popover",null).on("pointerdown.popover",null).on("click.popover",null).attr("title",function(){return this.getAttribute("data-original-title")||this.getAttribute("title")}).attr("data-original-title",null).selectAll(M).remove()},s.destroyAny=function(A){A.call(s.destroy,".popover")};function g(){var A=ye(this),M=n.apply(this,arguments),k=A.selectAll(".popover-"+i).data([0]),F=k.enter().append("div").attr("class","popover popover-"+i+" "+(e||"")).classed("arrowed",m.apply(this,arguments));F.append("div").attr("class","popover-arrow"),F.append("div").attr("class","popover-inner"),k=F.merge(k),M&&k.classed("fade",!0);var O=d.apply(this,arguments);if(O==="hover"){var B;A.on("pointerenter.popover",function(U){if(U.pointerType){if(U.pointerType!=="mouse"){B=U.timeStamp;return}else if(B&&U.timeStamp-B<1500)return}U.buttons===0&&_.apply(this,arguments)}).on("pointerleave.popover",function(){b.apply(this,arguments)}).on("focus.popover",function(){_.apply(this,arguments)}).on("blur.popover",function(){b.apply(this,arguments)})}else O==="clickFocus"&&(A.on("pointerdown.popover",function(U){U.preventDefault(),U.stopPropagation()}).on("pointerup.popover",function(U){U.preventDefault(),U.stopPropagation()}).on("click.popover",T),k.attr("tabindex",0).on("blur.popover",function(){A.each(function(){b.apply(this,arguments)})}))}function _(){var A=ye(this),M=A.selectAll(".popover-"+i);M.empty()&&(A.call(s.destroy),A.each(g),M=A.selectAll(".popover-"+i)),M.classed("in",!0);var k=d.apply(this,arguments);k==="clickFocus"&&(A.classed("active",!0),M.node().focus()),A.each(v)}function v(){var A=ye(this);u&&A.selectAll(".popover-"+i+" > .popover-inner").call(u.apply(this,arguments)),E.apply(this,arguments),E.apply(this,arguments),E.apply(this,arguments)}function E(){var A=ye(this),M=A.selectAll(".popover-"+i),k=l&&l.apply(this,arguments),F=k&&!k.empty()&&k.node(),O=F?F.scrollLeft:0,B=F?F.scrollTop:0,U=o.apply(this,arguments);M.classed("left",!1).classed("right",!1).classed("top",!1).classed("bottom",!1).classed(U,!0);var $=a.apply(this,arguments),q=.5;$==="leading"?q=0:$==="trailing"&&(q=1);var W=le(A.node()),Z=le(M.node()),Q;switch(U){case"top":Q={x:W.x+(W.w-Z.w)*q,y:W.y-Z.h};break;case"bottom":Q={x:W.x+(W.w-Z.w)*q,y:W.y+W.h};break;case"left":Q={x:W.x-Z.w,y:W.y+(W.h-Z.h)*q};break;case"right":Q={x:W.x+W.w,y:W.y+(W.h-Z.h)*q};break}if(Q){if(F&&(U==="top"||U==="bottom")){var X=Q.x;Q.x+Z.w>F.offsetWidth-10?Q.x=F.offsetWidth-10-Z.w:Q.x<10&&(Q.x=10);var ce=A.selectAll(".popover-"+i+" > .popover-arrow"),de=Math.min(Math.max(Z.w/2-(Q.x-X),10),Z.w-10);ce.style("left",~~de+"px")}M.style("left",~~Q.x+"px").style("top",~~Q.y+"px")}else M.style("left",null).style("top",null);function le(te){var ee=ye(te).style("position");return ee==="absolute"||ee==="static"?{x:te.offsetLeft-O,y:te.offsetTop-B,w:te.offsetWidth,h:te.offsetHeight}:{x:0,y:0,w:te.offsetWidth,h:te.offsetHeight}}}function b(){var A=ye(this);d.apply(this,arguments)==="clickFocus"&&A.classed("active",!1),A.selectAll(".popover-"+i).classed("in",!1)}function T(){ye(this).select(".popover-"+i).classed("in")?b.apply(this,arguments):_.apply(this,arguments)}return s}function Ft(t){var e=a_(t,"tooltip").displayType("hover"),i=function(){var n=this.getAttribute("data-original-title");return n||(n=this.getAttribute("title"),this.removeAttribute("title"),this.setAttribute("data-original-title",n),n)},r=es(null),s=es(null);return e.title=function(n){return arguments.length?(i=es(n),e):i},e.heading=function(n){return arguments.length?(r=es(n),e):r},e.keys=function(n){return arguments.length?(s=es(n),e):s},e.content(function(){var n=r.apply(this,arguments),o=i.apply(this,arguments),a=s.apply(this,arguments);return function(l){var u=l.selectAll(".tooltip-heading").data(n?[n]:[]);u.exit().remove(),u.enter().append("div").attr("class","tooltip-heading").merge(u).html(n);var d=l.selectAll(".tooltip-text").data(o?[o]:[]);d.exit().remove(),d.enter().append("div").attr("class","tooltip-text").merge(d).html(o);var m=l.selectAll(".keyhint-wrap").data(a&&a.length?[0]:[]);m.exit().remove();var g=m.enter().append("div").attr("class","keyhint-wrap");g.append("span").html(t.tHtml("tooltip_keyhint")),m=g.merge(m),m.selectAll("kbd.shortcut").data(a&&a.length?a:[]).enter().append("kbd").attr("class","shortcut").html(_=>_)}}),e}var B4=[];function pS(t,e){let i=t.systems.data,r=t.systems.l10n;var s=Mt("change","input"),n=t.services.wikipedia,o=ye(null),a=ye(null),l,u;i.getDataAsync("languages").then(T).catch(W=>console.error(W));var d={};i.getDataAsync("territory_languages").then(function(W){d=W}).catch(W=>console.error(W));var m=gr(t,"localized-lang").fetcher(U).minItems(0),g=ye(null),_=[],v=Ft(t).title(r.tHtml("translate.translate")).placement("left"),E,b=[];function T(W){if(B4.length===0){var Z={sr:"sr-Cyrl","sr-Cyrl":!1};for(var Q in W)if(Z[Q]!==!1){var X=Q;Z[Q]&&(X=Z[Q]),B4.push({localName:r.languageName(X,{localOnly:!0}),nativeName:W[X].nativeName,code:Q,label:r.languageName(X)})}}}function A(){var W=e.id==="name"&&b.length&&b.some(function(Z){var Q=t.graph().hasEntity(Z);if(!Q)return!1;if(Q.tags.wikidata||Q.tags["name:etymology:wikidata"])return!0;var X=t.systems.presets.match(Q,t.graph());if(X){var ce=X.suggestion,de=X.fields(),le=de.some(function(ne){return ne.id==="brand"}),te=de.some(function(ne){return ne.id==="operator"}),ee=X.addTags.name,oe=X.addTags["brand:wikidata"],ie=X.addTags["operator:wikidata"];return ce&&ee&&(oe&&!le||ie&&!te)}return!1});e.locked(W)}function M(W){var Z=_.map(function(le){return le.lang}),Q=new Set(Z.filter(Boolean));for(var X in W){var ce=X.match(/^(.*):([a-z]{2,3}(?:-[A-Z][a-z]{3})?(?:-[A-Z]{2})?)$/);if(ce&&ce[1]===e.key&&ce[2]){var de={lang:ce[2],value:W[X]};Q.has(de.lang)?(_[Z.indexOf(de.lang)].value=de.value,Q.delete(de.lang)):_.push(de)}}_.forEach(function(le){le.lang&&Q.has(le.lang)&&(le.value="")})}function k(W){g=W,A();var Z=e.locked(),Q=W.selectAll(".form-field-input-wrap").data([0]);Q=Q.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(Q),o=Q.selectAll(".localized-main").data([0]),o=o.enter().append("input").attr("type","text").attr("id",e.uid).attr("class","localized-main").call(ki).merge(o),o.classed("disabled",!!Z).attr("readonly",Z||null).on("input",de(!0)).on("blur",de()).on("change",de());var X=Q.selectAll(".localized-add").data([0]);X=X.enter().append("button").attr("class","localized-add form-field-button").call(Ye("#rapid-icon-plus")).merge(X),X.classed("disabled",!!Z).call(Z?v.destroy:v).on("click",ce),u&&!_.length&&M(u),a=W.selectAll(".localized-multilingual").data([0]),a=a.enter().append("div").attr("class","localized-multilingual").merge(a),a.call($),a.selectAll("button, input").classed("disabled",!!Z).attr("readonly",Z||null);function ce(le){if(le.preventDefault(),!e.locked()){var te=r.languageCode().toLowerCase(),ee=_.find(function(ie){return ie.lang===te}),oe=te.indexOf("en")>-1;(oe||ee)&&(te="",ee=_.find(function(ie){return ie.lang===te})),ee||(_.unshift({lang:te,value:""}),a.call($))}}function de(le){return function(te){if(e.locked()){te.preventDefault();return}var ee=ti(ye(this));if(le||(ee=t.cleanTagValue(ee)),!(!ee&&Array.isArray(u[e.key]))){var oe={};oe[e.key]=ee||void 0,s.call("change",this,oe,le)}}}}function F(W){return e.key+":"+W}function O(W,Z){var Q={},X=ti(ye(this)).toLowerCase(),ce=B4.find(function(te){return te.label.toLowerCase()===X||te.localName&&te.localName.toLowerCase()===X||te.nativeName&&te.nativeName.toLowerCase()===X});ce&&(X=ce.code),Z.lang&&Z.lang!==X&&(Q[F(Z.lang)]=void 0);var de=X&&t.cleanTagKey(F(X)),le=ti(ye(this.parentNode).selectAll(".localized-value"));de&&le?Q[de]=le:de&&E&&E[Z.lang]&&(Q[de]=E[Z.lang]),Z.lang=X,s.call("change",this,Q)}function B(W,Z){if(Z.lang){var Q=t.cleanTagValue(ti(ye(this)))||void 0;if(!(!Q&&Array.isArray(Z.value))){var X={};X[F(Z.lang)]=Q,Z.value=Q,s.call("change",this,X)}}}function U(W,Z){var Q=W.toLowerCase(),X=[r.localeCode(),r.languageCode()];l&&d[l]&&(X=X.concat(d[l]));var ce=[];X.forEach(function(de){var le=B4.find(function(te){return te.code===de});le&&ce.push(le)}),ce=Ei(ce.concat(B4)),Z(ce.filter(function(de){return de.label.toLowerCase().indexOf(Q)>=0||de.localName&&de.localName.toLowerCase().indexOf(Q)>=0||de.nativeName&&de.nativeName.toLowerCase().indexOf(Q)>=0||de.code.toLowerCase().indexOf(Q)>=0}).map(function(de){return{value:de.label}}))}function $(W){var Z=W.selectAll("div.entry").data(_,function(X){return X.lang});Z.exit().style("top","0").style("max-height","240px").transition().duration(200).style("opacity","0").style("max-height","0px").remove();var Q=Z.enter().append("div").attr("class","entry").each(function(X,ce){var de=ye(this),le=fl(ce),te=de.append("label").attr("class","field-label").attr("for",le),ee=te.append("span").attr("class","label-text");ee.append("span").attr("class","label-textvalue").html(r.tHtml("translate.localized_translation_label")),ee.append("span").attr("class","label-textannotation"),te.append("button").attr("class","remove-icon-multilingual").on("click",function(oe,ie){if(!e.locked()){oe.preventDefault(),_.splice(_.indexOf(ie),1);var ne=ie.lang&&F(ie.lang);if(ne&&ne in u){delete u[ne];var me={};me[ne]=void 0,s.call("change",this,me);return}$(W)}}).call(Ye("#rapid-operation-delete")),de.append("input").attr("class","localized-lang").attr("id",le).attr("type","text").attr("placeholder",r.t("translate.localized_translation_language")).on("blur",O).on("change",O).call(m),de.append("input").attr("type","text").attr("class","localized-value").on("blur",B).on("change",B)});Q.style("margin-top","0px").style("max-height","0px").style("opacity","0").transition().duration(200).style("margin-top","10px").style("max-height","240px").style("opacity","1").on("end",function(){ye(this).style("max-height","").style("overflow","visible")}),Z=Z.merge(Q),Z.order(),Z.classed("present",!0),ti(Z.select(".localized-lang"),function(X){var ce=B4.find(function(de){return de.code===X.lang});return ce?ce.label:X.lang}),ti(Z.select(".localized-value"),function(X){return typeof X.value=="string"?X.value:""}).attr("title",function(X){return Array.isArray(X.value)?X.value.filter(Boolean).join(`
`):null}).attr("placeholder",function(X){return Array.isArray(X.value)?r.t("inspector.multiple_values"):r.t("translate.localized_translation_name")}).classed("mixed",function(X){return Array.isArray(X.value)})}k.tags=function(W){if(u=W,typeof W.wikipedia=="string"&&!E){E={};var Z=W.wikipedia.match(/([^:]+):(.+)/);Z&&Z[0]&&Z[1]&&n.translations(Z[1],Z[2],function(X,ce){X||!ce||(E=ce)})}var Q=Array.isArray(W[e.key]);ti(o,typeof W[e.key]=="string"?W[e.key]:"").attr("title",Q?W[e.key].filter(Boolean).join(`
`):void 0).attr("placeholder",Q?r.t("inspector.multiple_values"):e.placeholder).classed("mixed",Q),M(W),g.call(k)},k.focus=function(){o.node().focus()},k.entityIDs=function(W){return arguments.length?(b=W,_=[],q(),k):b};function q(){var W=e.entityExtent,Z=W&&nh(W.center());l=Z&&Z.toLowerCase()}return $t(k,s,"on")}function mS(t,e){var i=Mt("change"),r=ye(null),s=ye(null),n,o,a=gr(t,"roadspeed"),l=gr(t,"roadspeed-unit").data(["km/h","mph"].map(_)),u=[20,30,40,50,60,70,80,90,100,110,120],d=[5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80];function m(E){var b=E.selectAll(".form-field-input-wrap").data([0]);b=b.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(b),s=b.selectAll("input.roadspeed-number").data([0]),s=s.enter().append("input").attr("type","text").attr("class","roadspeed-number").attr("id",e.uid).call(ki).call(a).merge(s),s.on("change",v).on("blur",v);var T=e.entityExtent.center();o=gF(T)==="mph",r=b.selectAll("input.roadspeed-unit").data([0]),r=r.enter().append("input").attr("type","text").attr("class","roadspeed-unit").call(l).merge(r),r.on("blur",A).on("change",A);function A(){o=ti(r)==="mph",ti(r,o?"mph":"km/h"),g(),v()}}function g(){a.data((o?d:u).map(_)),ti(r,o?"mph":"km/h")}function _(E){return{value:E.toString(),title:E.toString()}}function v(){var E={},b=ti(s).trim();let T=e.key;!b&&Array.isArray(n[T])||(b?isNaN(b)||!o?E[T]=t.cleanTagValue(b):E[T]=t.cleanTagValue(b+" mph"):E[T]=void 0,i.call("change",this,E))}return m.tags=function(E){n=E;let b=e.key;var T=E[b],A=Array.isArray(T);A||(T&&T.indexOf("mph")>=0?(T=parseInt(T,10).toString(),o=!0):T&&(o=!1)),g(),ti(s,typeof T=="string"?T:"").attr("title",A?T.filter(Boolean).join(`
`):null).attr("placeholder",A?t.t("inspector.multiple_values"):e.placeholder).classed("mixed",A)},m.focus=function(){s.node().focus()},$t(m,i,"on")}function Qc(t,e){let i=t.systems.l10n,r=t.services[e.qid?"wikidata":"osmwikibase"],s={},n=ye(null),o=ye(null),a,l;function u(){r&&(n.classed("tag-reference-loading",!0),r.getDocs(e,d))}function d(_,v){if(o.html(""),!v||!v.title){o.append("p").attr("class","tag-reference-description").html(i.tHtml("inspector.no_documentation_key")),m();return}v.imageURL?o.append("img").attr("class","tag-reference-wiki-image").attr("src",v.imageURL).on("load",()=>m()).on("error",function(){ye(this).remove(),m()}):m();let E;v.description?E=i.htmlForLocalizedText(v.description,v.descriptionLocaleCode):E=i.tHtml("inspector.no_documentation_key"),o.append("p").attr("class","tag-reference-description").html(E).append("a").attr("class","tag-reference-edit").attr("target","_blank").attr("title",i.t("inspector.edit_reference")).attr("href",v.editURL).call(Ye("#rapid-icon-edit","inline")),v.wiki&&o.append("a").attr("class","tag-reference-link").attr("target","_blank").attr("href",v.wiki.url).call(Ye("#rapid-icon-out-link","inline")).append("span").html(i.tHtml(v.wiki.text)),e.key==="comment"&&o.append("a").attr("class","tag-reference-comment-link").attr("target","_blank").call(Ye("#rapid-icon-out-link","inline")).attr("href",i.t("commit.about_changeset_comments_link")).append("span").html(i.tHtml("commit.about_changeset_comments"))}function m(){a=!0,n.classed("tag-reference-loading",!1),o.classed("expanded",!0).transition().duration(200).style("max-height","200px").style("opacity","1"),l=!0,n.selectAll("svg.icon use").each((_,v,E)=>{let b=ye(E[v]);b.attr("href")==="#rapid-icon-info"&&b.attr("href","#rapid-icon-info-filled")})}function g(){o.transition().duration(200).style("max-height","0px").style("opacity","0").on("end",()=>{o.classed("expanded",!1)}),l=!1,n.selectAll("svg.icon use").each((_,v,E)=>{let b=ye(E[v]);b.attr("href")==="#rapid-icon-info-filled"&&b.attr("href","#rapid-icon-info")})}return s.button=function(_,v,E){n=_.selectAll(".tag-reference-button").data([0]),n=n.enter().append("button").attr("class","tag-reference-button "+(v||"")).attr("title",i.t("icons.information")).call(Ye("#rapid-icon-"+(E||"inspect"))).merge(n),n.on("click",function(b){b.stopPropagation(),b.preventDefault(),this.blur(),l?g():a?m():u()})},s.body=function(_){let v=e.qid||e.key+"-"+(e.value||"");o=_.selectAll(".tag-reference-body").data([v],E=>E),o.exit().remove(),o=o.enter().append("div").attr("class","tag-reference-body").style("max-height","0").style("opacity","0").merge(o),l===!1&&g()},s.showing=function(_){return arguments.length?(l=_,s):l},s}var Ca=class{constructor(e,i,r=[],s={}){this.context=e,this.presetField=i,this.entityIDs=r,this.options=Object.assign({show:!0,wrap:!0,remove:!0,revert:!0,info:!0},s),this.id=i.id,this.type=i.type,this.title=i.title(),this.label=i.label(),this.terms=i.terms(),this.placeholder=i.placeholder(),this.default=i.default,this.key=i.key,this.keys=i.keys,this.t=i.t,this.tHtml=i.tHtml,this.hasTextForStringID=i.hasTextForStringID,this.uid=fl(`form-field-${i.safeid}`),this._show=this.options.show,this._internal=null,this._state="",this._tags={},this.entityExtent=null,r?.length&&(this.entityExtent=Ar(r,e.graph())),this._locked=!1,this._lockedTip=Ft(e).title(e.tHtml("inspector.lock.suggestion",{label:this.label})).placement("bottom"),this.dispatch=Mt("change","revert"),$t(this,this.dispatch,"on"),this.isAllowed=this.isAllowed.bind(this),this.isModified=this.isModified.bind(this),this.isShown=this.isShown.bind(this),this.remove=this.remove.bind(this),this.render=this.render.bind(this),this.revert=this.revert.bind(this),this.tagsContainFieldKey=this.tagsContainFieldKey.bind(this),this._show&&this._createField()}_createField(){this._internal||(this._internal=U4[this.type](this.context,this).on("change",(e,i)=>{this.dispatch.call("change",this,e,i)}),typeof this._internal.entityIDs=="function"&&this._internal.entityIDs(this.entityIDs))}isModified(){return this.entityIDs?.length?this.entityIDs.some(e=>{let i=this.context.graph(),r=i.base.entities.get(e),s=i.entity(e);return this.keys.some(n=>r?s.tags[n]!==r.tags[n]:s.tags[n])}):!1}tagsContainFieldKey(){return this.keys.some(e=>{if(this.type==="multiCombo"){for(let i in this._tags)if(i.indexOf(e)===0)return!0;return!1}else return this._tags[e]!==void 0})}revert(e){e.stopPropagation(),e.preventDefault(),!(!this.entityIDs?.length||this._locked)&&this.dispatch.call("revert",this,this.keys)}remove(e){if(e.stopPropagation(),e.preventDefault(),this._locked)return;let i={};this.keys.forEach(r=>i[r]=void 0),this.dispatch.call("change",this,i)}render(e){let i=this.context.systems.l10n,r=e.selectAll(".form-field").data([this]),s=r.enter().append("div").attr("class",`form-field form-field-${this.safeid}`).classed("nowrap",!this.options.wrap);if(this.options.wrap){let a=s.append("label").attr("class","field-label").attr("for",this.uid),l=a.append("span").attr("class","label-text");l.append("span").attr("class","label-textvalue").html(this.label),l.append("span").attr("class","label-textannotation"),this.options.remove&&a.append("button").attr("class","remove-icon").attr("title",i.t("icons.remove")).call(Ye("#rapid-operation-delete")),this.options.revert&&a.append("button").attr("class","modified-icon").attr("title",i.t("icons.undo")).call(Ye(i.isRTL()?"#rapid-icon-redo":"#rapid-icon-undo"))}r=r.merge(s),r.select(".field-label > .remove-icon").on("click",this.remove),r.select(".field-label > .modified-icon").on("click",this.revert),r.each((a,l,u)=>{let d=ye(u[l]);this._internal||this._createField();let m;if(this.options.wrap&&this.options.info){let g=this.key||"";this.type==="multiCombo"&&(g=g.replace(/:$/,"")),m=Qc(this.context,this.reference||{key:g}),this._state==="hover"&&m.showing(!1)}d.call(this._internal),m&&d.call(m.body).select(".field-label").call(m.button),this._internal.tags(this._tags)}),r.classed("locked",this._locked).classed("modified",this.isModified()).classed("present",this.tagsContainFieldKey());let o=r.selectAll(".field-label .label-textannotation").selectAll(".icon").data(this._locked?[0]:[]);o.exit().remove(),o.enter().append("svg").attr("class","icon").append("use").attr("xlink:href","#fas-lock"),r.call(this._locked?this._lockedTip:this._lockedTip.destroy)}state(e){return e===void 0?this._state:(this._state=e,this)}tags(e){return e===void 0?this._tags:(this._tags=e,this.tagsContainFieldKey()&&!this._show&&(this._show=!0,this._internal||this._createField()),this)}locked(e){return e===void 0?this._locked:(this._locked=e,this)}show(){if(this._show=!0,this._internal||this._createField(),this.default&&this.key&&this._tags[this.key]!==this.default){let e={};e[this.key]=this.default,this.dispatch.call("change",this,e)}}isShown(){return this._show}isAllowed(){let e=this.context,i=this.presetField,r=e.systems.locations;if(!this.entityIDs?.length)return!0;if(this.entityIDs.length>1&&U4[this.type].supportsMultiselection===!1||i.geometry&&!this.entityIDs.every(n=>i.matchGeometry(e.graph().geometry(n)))||this.entityExtent&&i.locationSetID&&!r.locationSetsAt(this.entityExtent.center())[i.locationSetID])return!1;let s=i.prerequisiteTag;return!(s&&!this.tagsContainFieldKey()&&!this.entityIDs.every(o=>{let a=e.graph().entity(o);if(s.key){let l=a.tags[s.key];if(!l)return!1;if(s.valueNot)return s.valueNot!==l;if(s.value)return s.value===l}else if(s.keyNot&&a.tags[s.keyNot])return!1;return!0}))}focus(){this._internal&&this._internal.focus()}};function p6(t,e){var i=Mt("change"),r=ye(null),s=ye(null),n=ye(null),o=ye(null),a=(e.presetField.options||e.keys).slice(),l,u,d={},m=[];function g(){var A=s.selectAll(".form-field-input-radio label.active input");return!A.empty()&&A.datum()}function _(A){A.classed("preset-radio",!0),s=A.selectAll(".form-field-input-wrap").data([0]);var M=s.enter().append("div").attr("class","form-field-input-wrap form-field-input-radio");M.append("span").attr("class","placeholder"),s=s.merge(M),r=s.selectAll(".placeholder"),n=s.selectAll("label").data(a),M=n.enter().append("label"),M.append("input").attr("type","radio").attr("name",e.id).attr("value",function(k){return e.t(`options.${k}`,{default:k})}).attr("checked",!1),M.append("span").html(function(k){return e.tHtml(`options.${k}`,{default:k})}),n=n.merge(M),o=n.selectAll("input").on("change",T)}function v(A,M){var k=g()||M.layer!==void 0,F=t.systems.presets,O=F.field(k),B=F.field("layer"),U=k==="bridge"||k==="tunnel"||M.layer!==void 0,$=A.selectAll(".structure-extras-wrap").data(k?[0]:[]);$.exit().remove(),$=$.enter().append("div").attr("class","structure-extras-wrap").merge($);var q=$.selectAll("ul").data([0]);q=q.enter().append("ul").attr("class","rows").merge(q),O?((!l||l.id!==k)&&(l=new Ca(t,O,m,{wrap:!1}).on("change",E)),l.tags(M)):l=null;var W=q.selectAll(".structure-type-item").data(l?[l]:[],function(ce){return ce.id});W.exit().remove();var Z=W.enter().insert("li",":first-child").attr("class","labeled-input structure-type-item");Z.append("span").attr("class","label structure-label-type").attr("for","preset-input-"+k).html(t.tHtml("inspector.radio.structure.type")),Z.append("div").attr("class","structure-input-type-wrap"),W=W.merge(Z),l&&W.selectAll(".structure-input-type-wrap").call(l.render),B&&U?(u||(u=new Ca(t,B,m,{wrap:!1}).on("change",b)),u.tags(M),e.keys=ss(e.keys,["layer"])):(u=null,e.keys=e.keys.filter(function(ce){return ce!=="layer"}));var Q=q.selectAll(".structure-layer-item").data(u?[u]:[]);Q.exit().remove();var X=Q.enter().append("li").attr("class","labeled-input structure-layer-item");X.append("span").attr("class","label structure-label-layer").attr("for","preset-input-layer").html(t.tHtml("inspector.radio.structure.layer")),X.append("div").attr("class","structure-input-layer-wrap"),Q=Q.merge(X),u&&Q.selectAll(".structure-input-layer-wrap").call(u.render)}function E(A,M){var k=g();if(k){var F=A[k];F!=="no"&&(d[k]=F),e.type==="structureRadio"&&((F==="no"||k!=="bridge"&&k!=="tunnel"||k==="tunnel"&&F==="building_passage")&&(A.layer=void 0),A.layer===void 0&&(k==="bridge"&&F!=="no"&&(A.layer="1"),k==="tunnel"&&F!=="no"&&F!=="building_passage"&&(A.layer="-1"))),i.call("change",this,A,M)}}function b(A,M){A.layer==="0"&&(A.layer=void 0),i.call("change",this,A,M)}function T(){var A={},M;e.key&&(A[e.key]=void 0),o.each(function(k){var F=ye(this).property("checked");if(F&&(M=k),e.key)F&&(A[e.key]=k);else{var O=d[M]||"yes";A[k]=F?O:void 0}}),e.type==="structureRadio"&&(M==="bridge"?A.layer="1":M==="tunnel"&&A.tunnel!=="building_passage"?A.layer="-1":A.layer=void 0),i.call("change",this,A)}return _.tags=function(A){o.property("checked",function(F){return e.key?A[e.key]===F:typeof A[F]=="string"&&A[F].toLowerCase()!=="no"});function M(F){return e.key?Array.isArray(A[e.key])&&A[e.key].includes(F):Array.isArray(A[F])}n.classed("active",function(F){return e.key?Array.isArray(A[e.key])&&A[e.key].includes(F)||A[e.key]===F:Array.isArray(A[F])||!!(A[F]&&A[F].toLowerCase()!=="no")}).classed("mixed",M).attr("title",function(F){return M(F)?t.t("inspector.unshared_value_tooltip"):null});var k=o.filter(function(){return this.checked});k.empty()?r.html(t.tHtml("inspector.none")):(r.html(k.attr("value")),d[k.datum()]=A[k.datum()]),e.type==="structureRadio"&&(A.waterway&&!d.tunnel&&(d.tunnel="culvert"),s.call(v,A))},_.focus=function(){o.node().focus()},_.entityIDs=function(A){return arguments.length?(m=A,d={},_):m},_.isAllowed=function(){return m.length===1},$t(_,i,"on")}function gS(t,e){let i=Mt("change"),r=ye(null),s;function n(a){let l=a.selectAll(".form-field-input-wrap").data([0]);l=l.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(l),r=l.selectAll("textarea").data([0]),r=r.enter().append("textarea").attr("id",e.uid).call(ki).on("input",o(!0)).on("blur",o()).on("change",o()).merge(r)}function o(a){return function(){let l=e.key,u=ti(r);if(a||(u=t.cleanTagValue(u)),!u&&Array.isArray(s[l]))return;let d={};d[l]=u||void 0,i.call("change",this,d,a)}}return n.tags=function(a){s=a;let l=e.key,u=Array.isArray(a[l]),d=u?t.t("inspector.multiple_values"):e.placeholder||t.t("inspector.unknown");ti(r,!u&&a[l]?a[l]:"").attr("title",u?a[l].filter(Boolean).join(`
`):void 0).attr("placeholder",d).classed("mixed",u)},n.focus=function(){r.node().focus()},$t(n,i,"on")}function yS(t,e){var i=t.services.wikidata,r=Mt("change"),s=ye(null),n=ye(null),o=null,a=null,l="",u=[],d=e.keys&&e.keys.find(function(A){return A.includes("wikipedia")}),m=e.key==="wikidata"?"name":e.key.split(":")[0],g=gr(t,"combo-"+e.safeid).caseSensitive(!0).minItems(1);function _(A){s=A;var M=A.selectAll(".form-field-input-wrap").data([0]);M=M.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(M);var k=M.selectAll("ul").data([0]);k=k.enter().append("ul").attr("class","rows").merge(k);var F=k.selectAll("li.wikidata-search").data([0]),O=F.enter().append("li").attr("class","wikidata-search");O.append("input").attr("type","text").attr("id",e.uid).style("flex","1").call(ki).on("focus",function(){var q=ye(this).node();q.setSelectionRange(0,q.value.length)}).on("blur",function(){b()}).call(g.fetcher(v)),g.on("accept",function(q){q&&(o=q.id,E())}).on("cancel",function(){b()}),O.append("button").attr("class","form-field-button wiki-link").attr("title",t.t("icons.view_on",{domain:"wikidata.org"})).call(Ye("#rapid-icon-out-link")).on("click",function(q){q.preventDefault(),l&&window.open(l,"_blank")}),F=F.merge(O),n=F.select("input");var B=["description","identifier"],U=k.selectAll("li.labeled-input").data(B),$=U.enter().append("li").attr("class",function(q){return"labeled-input preset-wikidata-"+q});$.append("span").attr("class","label").html(function(q){return t.tHtml("wikidata."+q)}),$.append("input").attr("type","text").call(ki).classed("disabled","true").attr("readonly","true"),$.append("button").attr("class","form-field-button").attr("title",t.t("icons.copy")).call(Ye("#rapid-operation-copy")).on("click",function(q){q.preventDefault(),ye(this.parentNode).select("input").node().select(),document.execCommand("copy")})}function v(A,M){if(!A&&m)for(var k in u){var F=t.hasEntity(u[k]);if(F.tags[m]){A=F.tags[m];break}}i.itemsForSearchQuery(A,function(O,B){if(!O){var U=B.map(function($){return{id:$.id,value:$.label+" ("+$.id+")",title:$.description,terms:$.aliases}});M&&M(U)}})}function E(){let A=e.key;var M={};M[A]=o,r.call("change",this,M);var k=t.graph(),F=u;i.entityByQID(o,function(O,B){if(!O&&t.graph()===k&&B.sitelinks){var U=i.languagesToQuery();["labels","descriptions"].forEach(function(te){if(B[te]){var ee=Object.keys(B[te]);if(ee.length!==0){var oe=ee[0];U.indexOf(oe)===-1&&U.push(oe)}}});var $;if(d){var q;for(var W in U){var Z=U[W],Q=Z.replace("-","_")+"wiki";if(B.sitelinks[Q]){q=!0,$=Z+":"+B.sitelinks[Q].title;break}}if(!q){var X=Object.keys(B.sitelinks).filter(function(te){return te.endsWith("wiki")});if(X.length===0)$=null;else{var ce=X[0].slice(0,-4).replace("_","-"),de=B.sitelinks[X[0]].title;$=ce+":"+de}}}if($&&($=t.cleanTagValue($)),!(typeof $>"u")){var le=F.map(function(te){var ee=t.hasEntity(te);if(!ee)return null;var oe=Object.assign({},ee.tags);if($===null){if(!oe[d])return null;delete oe[d]}else oe[d]=$;return Hr(te,oe)}).filter(Boolean);le.length&&t.overwrite(function(ee){return le.forEach(function(oe){ee=oe(ee)}),ee},t.systems.edits.undoAnnotation())}}})}function b(){var A="";a&&(A=T(a,"labels"),A.length===0&&(A=a.id.toString())),ti(n,A)}_.tags=function(A){let M=e.key;var k=Array.isArray(A[M]);if(n.attr("title",k?A[M].filter(Boolean).join(`
`):null).attr("placeholder",k?t.t("inspector.multiple_values"):"").classed("mixed",k),o=typeof A[M]=="string"&&A[M]||"",!/^Q[0-9]*$/.test(o)){F();return}l="https://wikidata.org/wiki/"+o,i.entityByQID(o,function(O,B){if(O){F();return}a=B,b();var U=T(B,"descriptions");s.select("button.wiki-link").classed("disabled",!1),s.select(".preset-wikidata-description").style("display",function(){return U.length>0?"flex":"none"}).select("input").attr("value",U),s.select(".preset-wikidata-identifier").style("display",function(){return B.id?"flex":"none"}).select("input").attr("value",B.id)});function F(){a=null,b(),s.select(".preset-wikidata-description").style("display","none"),s.select(".preset-wikidata-identifier").style("display","none"),s.select("button.wiki-link").classed("disabled",!0),o&&o!==""?l="https://wikidata.org/wiki/Special:Search?search="+o:l=""}};function T(A,M){if(!A[M])return"";var k=A[M],F=Object.keys(k);if(F.length===0)return"";var O=i.languagesToQuery();for(var B in O){var U=O[B],$=k[U];if($&&$.value&&$.value.length>0)return $.value}return k[F[0]].value}return _.entityIDs=function(A){return arguments.length?(u=A,_):u},_.focus=function(){n.node().focus()},$t(_,r,"on")}function l_(t,e){let i=Mt("change"),r=t.services.wikipedia,s=t.services.wikidata,n=ye(null),o=ye(null),a="",l,u,d=[];t.systems.data.getDataAsync("wmf_sitematrix").then(k=>{d=k,u&&M(u)}).catch(k=>console.error(k));let g=gr(t,"wikipedia-lang").fetcher((k,F)=>{let O=k.toLowerCase();F(d.filter(B=>B[0].toLowerCase().indexOf(O)>=0||B[1].toLowerCase().indexOf(O)>=0||B[2].toLowerCase().indexOf(O)>=0).map(B=>({value:B[1]})))}),_=gr(t,"wikipedia-title").fetcher((k,F)=>{if(!k){k="";for(let B in l){let U=t.hasEntity(l[B]);if(U.tags.name){k=U.tags.name;break}}}(k.length>7?r.search:r.suggestions)(b()[2],k,(B,U)=>{F(U.map($=>({value:$})))})});function v(k){let F=k.selectAll(".form-field-input-wrap").data([0]);F=F.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(F);let O=F.selectAll(".wiki-lang-container").data([0]);O=O.enter().append("div").attr("class","wiki-lang-container").merge(O),n=O.selectAll("input.wiki-lang").data([0]),n=n.enter().append("input").attr("type","text").attr("class","wiki-lang").attr("placeholder",t.t("translate.localized_translation_language")).call(ki).call(g).merge(n),n.on("blur",T).on("change",T);let B=F.selectAll(".wiki-title-container").data([0]);B=B.enter().append("div").attr("class","wiki-title-container").merge(B),o=B.selectAll("input.wiki-title").data([0]),o=o.enter().append("input").attr("type","text").attr("class","wiki-title").attr("id",e.uid).call(ki).call(_).merge(o),o.on("blur",function(){A(!0)}).on("change",function(){A(!1)});let U=B.selectAll(".wiki-link").data([0]);U=U.enter().append("button").attr("class","form-field-button wiki-link").attr("title",t.t("icons.view_on",{domain:"wikipedia.org"})).call(Ye("#rapid-icon-out-link")).merge(U),U.on("click",$=>{$.preventDefault(),a&&window.open(a,"_blank")})}function E(k){let F=t.systems.l10n.languageCode().toLowerCase();for(let O in d){let B=d[O];if(B[2]===F)return B}return k?["","",""]:["English","English","en"]}function b(k){let F=ti(n).toLowerCase();for(let O in d){let B=d[O];if(B[0].toLowerCase()===F||B[1].toLowerCase()===F||B[2]===F)return B}return E(k)}function T(){ti(n,b()[1]),A(!0)}function A(k){let F=ti(o),O=F.match(/https?:\/\/([-a-z]+)\.wikipedia\.org\/(?:wiki|\1-[-a-z]+)\/([^#]+)(?:#(.+))?/),B=O&&d.find(W=>O[1]===W[2]),U={};if(B){let W=B[1];if(F=decodeURIComponent(O[2]).replace(/_/g," "),O[3]){let Z;Z=decodeURIComponent(O[3]),F+="#"+Z.replace(/_/g," ")}F=F.slice(0,1).toUpperCase()+F.slice(1),ti(n,W),ti(o,F)}if(F?U.wikipedia=t.cleanTagValue(b()[2]+":"+F):U.wikipedia=void 0,i.call("change",this,U),k||!F||!b()[2])return;let $=t.graph(),q=l;s.itemsByTitle(b()[2],F,(W,Z)=>{if(W||!Z||!Object.keys(Z).length||t.graph()!==$)return;let Q=Object.keys(Z),X=Q&&Q.find(de=>de.match(/^Q\d+$/)),ce=q.map(de=>{let le=t.entity(de).tags,te=Object.assign({},le);return te.wikidata!==X?(te.wikidata=X,Hr(de,te)):null}).filter(Boolean);ce.length&&t.overwrite(function(le){return ce.forEach(function(te){le=te(le)}),le},t.systems.edits.undoAnnotation())})}v.tags=k=>{u=k,M(k)};function M(k){let F=e.key,O=typeof k[F]=="string"?k[F]:"",B=O.match(/([^:]+):([^#]+)(?:#(.+))?/),U=B&&B[1],$=B&&B[2],q=B&&B[3],W=U&&d.find(Z=>U===Z[2]);if(W){let Z=W[1];if(ti(n,Z),ti(o,$+(q?"#"+q:"")),q)try{q=encodeURIComponent(q.replace(/ /g,"_")).replace(/%/g,".")}catch{q=q.replace(/ /g,"_")}a="https://"+U+".wikipedia.org/wiki/"+$.replace(/ /g,"_")+(q?"#"+q:"")}else if(ti(o,O),O&&O!=="")ti(n,""),a=`https://${E()[2]}.wikipedia.org/w/index.php?fulltext=1&search=${O}`;else{let Z=b(!0);ti(n,Z[1]),a=""}}return v.entityIDs=k=>arguments.length?(l=k,v):l,v.focus=()=>{o.node().focus()},$t(v,i,"on")}l_.supportsMultiselection=!1;var U4={access:hS,address:dS,check:a0,combo:il,cycleway:fS,defaultCheck:a0,email:Aa,identifier:Aa,lanes:o_,localized:pS,roadspeed:mS,roadheight:Aa,manyCombo:il,multiCombo:il,networkCombo:il,number:Aa,onewayCheck:a0,radio:p6,semiCombo:il,structureRadio:p6,tel:Aa,text:Aa,textarea:gS,typeCombo:il,url:Aa,wikidata:yS,wikipedia:l_};var tQ=!0,iQ=30,rQ=6,m6=class extends ui{constructor(e){super(e),this.id="presets",this.dependencies=new Set(["data","l10n","locations","storage","urlhash"]),this.geometries=["point","vertex","line","area","relation"];let i=new Gc(e,"point",{name:"Point",tags:{},geometry:["point","vertex"],matchScore:.1}),r=new Gc(e,"line",{name:"Line",tags:{},geometry:["line"],matchScore:.1}),s=new Gc(e,"area",{name:"Area",tags:{area:"yes"},geometry:["area"],matchScore:.1}),n=new Gc(e,"relation",{name:"Relation",tags:{},geometry:["relation"],matchScore:.1});this.collection=new zc(e,[i,r,s,n]),this._defaults={point:[],vertex:[],line:[],area:[],relation:[]},this._presets={point:i,line:r,area:s,relation:n},this._fields={},this._categories={},this._universal=[],this._recentIDs=null,this.addablePresetIDs=null,this._geometryIndex={point:{},vertex:{},line:{},area:{},relation:{}},this._initPromise=null}initAsync(){if(this._initPromise)return this._initPromise;for(let s of this.dependencies)if(!this.context.systems[s])return Promise.reject(`Cannot init:  ${this.id} requires ${s}`);let e=this.context.systems.data,i=this.context.systems.urlhash,r=Promise.all([e.initAsync(),i.initAsync()]);return this._initPromise=r.then(()=>{let s=i.initialHashParams.get("presets");if(s){let n=s.split(",").map(o=>o.trim()).filter(Boolean);this.addablePresetIDs=new Set(n)}return Promise.all([e.getDataAsync("preset_categories"),e.getDataAsync("preset_defaults"),e.getDataAsync("preset_presets"),e.getDataAsync("preset_fields")])}).then(s=>{this.merge({categories:s[0],defaults:s[1],presets:s[2],fields:s[3]}),w9(this.areaKeys()),E9(this.pointTags()),T9(this.vertexTags())})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}merge(e){let i=[],r=this.context,s=r.systems.locations;if(e.fields)for(let[o,a]of Object.entries(e.fields))if(a){if(!U4[a.type]){tQ&&console.warn(`"${a.type}" type not supported for ${o}`);continue}let l=new W2(r,o,a,this._fields);l.locationSet&&i.push(l),this._fields[o]=l}else delete this._fields[o];if(e.presets)for(let[o,a]of Object.entries(e.presets)){let u=this._presets[o]?.isFallback();if(a){a.icon&&(a.icon=a.icon.replace(/^iD-/,"rapid-")),o==="address"&&(a.icon="maki-circle-stroked"),o==="natural/tree"&&(a.icon="maki-park"),/^highway\/crossing/.test(o)&&(a.icon="temaki-pedestrian"),/^highway\/footway\/crossing/.test(o)&&(a.icon="temaki-pedestrian"),a.icon==="roentgen-needleleaved_tree"&&(a.icon="maki-park-alt1");let d=new Gc(r,o,a,this._fields,this._presets);d.locationSet&&i.push(d),this._presets[o]=d}else u||delete this._presets[o]}if(e.categories)for(let[o,a]of Object.entries(e.categories))if(a){a.icon&&(a.icon=a.icon.replace(/^iD-/,"rapid-"));let l=new G2(r,o,a,this._presets);l.locationSet&&i.push(l),this._categories[o]=l}else delete this._categories[o];if(e.defaults)for(let[o,a]of Object.entries(e.defaults))Array.isArray(a)?this._defaults[o]=a.map(l=>this._presets[l]||this._categories[l]).filter(l=>l&&!l.isFallback()):this._defaults[o]=[];let n=Object.values(this._presets).concat(Object.values(this._categories));return this.collection=new zc(r,n),this._universal=Object.values(this._fields).filter(o=>o.universal),Object.values(this._presets).forEach(o=>o.resetFields()),this._geometryIndex={point:{},vertex:{},line:{},area:{},relation:{}},n.forEach(o=>{(o.geometry||[]).forEach(a=>{let l=this._geometryIndex[a];for(let u in o.tags){l[u]=l[u]||{};let d=o.tags[u];(l[u][d]=l[u][d]||[]).push(o)}})}),e.featureCollection&&Array.isArray(e.featureCollection.features)&&s.mergeCustomGeoJSON(e.featureCollection),i.length&&s.mergeLocationSets(i),this}item(e){return this.collection.item(e)}index(e){return this.collection.index(e)}fallback(e){return this.collection.fallback(e)}matchGeometry(e){return this.collection.matchGeometry(e)}matchAllGeometry(e){return this.collection.matchAllGeometry(e)}search(e,i,r){return this.collection.search(e,i,r)}match(e,i){return i.transient(e,"presetMatch",()=>{let r=e.geometry(i);r==="vertex"&&e.isOnAddressLine(i)&&(r="point");let s=e.extent(i);return this.matchTags(e.tags,r,s.center())})}matchTags(e,i,r){let s=this._geometryIndex[i],n=-1,o,a=[];for(let u in e){let d=[],m=s[u];if(!m)continue;let g=m[e[u]];g&&d.push(...g);let _=m["*"];if(_&&d.push(..._),d.length!==0)for(let v=0;v<d.length;v++){let E=d[v],b=E.matchScore(e);b!==-1&&(a.push({score:b,candidate:E}),b>n&&(n=b,o=E))}}let l=this.context.systems.locations;if(o&&o.locationSetID&&o.locationSetID!=="+[Q2]"&&Array.isArray(r)){let u=l.locationSetsAt(r);if(!u[o.locationSetID]){a.sort((d,m)=>d.score<m.score?1:-1);for(let d=0;d<a.length;d++){let m=a[d];if(!m.candidate.locationSetID||u[m.candidate.locationSetID]){o=m.candidate,n=m.score;break}}}}if(!o||o.isFallback()){for(let u in e)if(/^addr:/.test(u)&&s["addr:*"]&&s["addr:*"]["*"]){o=s["addr:*"]["*"][0];break}}return o||this.fallback(i)}allowsVertex(e,i){return e.type!=="node"?!1:Object.keys(e.tags).length===0?!0:i.transient(e,"vertexMatch",()=>{if(e.isOnAddressLine(i))return!0;let r=C1(e.tags);return r.vertex?!0:!r.point})}areaKeys(){let e=["barrier","highway","footway","railway","junction","type"],i={},r=Object.values(this._presets).filter(s=>!s.suggestion&&!s.replacement);for(let s of r){let n=Object.keys(s.tags)[0];n&&(e.includes(n)||s.geometry.includes("area")&&(i[n]=i[n]||{}))}for(let s of r)if(s.geometry.includes("line"))for(let[n,o]of Object.entries(s.addTags))n in i&&o!=="*"&&(i[n][o]=!0);return i}pointTags(){let e={},i=Object.values(this._presets).filter(r=>!r.suggestion&&!r.replacement&&r.searchable!==!1);for(let r of i){if(!r.geometry.includes("point"))continue;let s=Object.keys(r.tags)[0],n=Object.values(r.tags)[0];!s||!n||(e[s]=e[s]||{},e[s][n]=!0)}return e}vertexTags(){let e={},i=Object.values(this._presets).filter(r=>!r.suggestion&&!r.replacement&&r.searchable!==!1);for(let r of i){if(!r.geometry.includes("vertex"))continue;let s=Object.keys(r.tags)[0],n=Object.values(r.tags)[0];!s||!n||(e[s]=e[s]||{},e[s][n]=!0)}return e}field(e){return this._fields[e]}universal(){return this._universal}defaults(e,i=10,r=!0,s=null){let n=new Map;if(r)for(let l of this.getRecents())n.size<rQ&&l.matchGeometry(e)&&n.set(l.id,l);if(this.addablePresetIDs instanceof Set)for(let l of this.addablePresetIDs){let u=this.item(l);u?.matchGeometry(e)&&n.set(l,u)}else for(let l of this._defaults[e])l.matchGeometry(e)&&n.set(l.id,l);let o=this.fallback(e);o&&!n.has(o.id)&&n.set(o.id,o);let a=[...n.values()];if(Array.isArray(s)){let u=this.context.systems.locations.locationSetsAt(s);a=a.filter(d=>!d.locationSetID||u[d.locationSetID])}return new zc(this.context,a.slice(0,i-1))}getRecents(){let e=this._recentIDs;if(!e){let r=this.context.systems.storage;e=JSON.parse(r.getItem("preset_recents"))||[]}let i=e.map(r=>{let s=r?.id||r;return this._presets[s]}).filter(Boolean);return this._recentIDs||(this._recentIDs=i.map(r=>r.id)),i}setMostRecent(e){if(e.searchable===!1)return;this._recentIDs.unshift(e.id),this._recentIDs=Ei(this._recentIDs).slice(0,iQ),this.context.systems.storage.setItem("preset_recents",JSON.stringify(this._recentIDs))}};var NN="#da26d3",_S=["#ff0000","#ffa500","#ffd700","#00ff00","#00ffff","#1e90ff","#da26d3","#ffc0cb","#d3d3d3","#faf0e6"],g6=class extends ui{constructor(e){super(e),this.id="rapid",this.dependencies=new Set(["edits","l10n","urlhash"]),this.sources=new Set,this.acceptedIDs=new Set,this._datasets=new Map,this._taskExtent=null,this._isTaskBoundsRect=null,this._hadPoweruser=!1,this._initPromise=null,this._hashchange=this._hashchange.bind(this),this._onUndone=this._onUndone.bind(this),this._onChange=this._onChange.bind(this),this._onRestore=this._onRestore.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let a of this.dependencies)if(!this.context.systems[a])return Promise.reject(`Cannot init:  ${this.id} requires ${a}`);let e=this.context,i=e.systems.edits,r=e.systems.l10n,s=e.systems.map,n=e.systems.urlhash,o=Promise.all([i.initAsync(),s.initAsync(),r.initAsync(),n.initAsync()]);return this._initPromise=o.then(()=>{n.on("hashchange",this._hashchange),i.on("undone",this._onUndone).on("change",this._onChange).on("restore",this._onRestore),this._datasets.set("fbRoads",{id:"fbRoads",beta:!1,added:!0,enabled:!1,conflated:!0,service:"mapwithai",color:NN,label:r.t("rapid_feature_toggle.fbRoads.label"),license_markdown:r.t("rapid_feature_toggle.fbRoads.license_markdown")}),this._datasets.set("msBuildings",{id:"msBuildings",beta:!1,added:!0,enabled:!1,conflated:!0,service:"mapwithai",color:NN,label:r.t("rapid_feature_toggle.msBuildings.label"),license_markdown:r.t("rapid_feature_toggle.msBuildings.license_markdown")})})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this.sources=new Set,this.acceptedIDs=new Set,Promise.resolve()}get colors(){return _S}get datasets(){return this._datasets}get taskExtent(){return this._taskExtent}isTaskRectangular(){return!!this._taskExtent&&this._isTaskBoundsRect}get hadPoweruser(){return this._hadPoweruser}setTaskExtentByGpxData(e){let i=Ky(e),r=i.features.reduce((n,o)=>n+(o.geometry.type==="LineString"?1:0),0);if(i.type==="FeatureCollection"){let n,o,a,l;i.features.forEach(u=>{if(u.geometry.type==="Point"){let d=u.geometry.coordinates[0],m=u.geometry.coordinates[1];(n===void 0||m<n)&&(n=m),(o===void 0||d<o)&&(o=d),(a===void 0||m>a)&&(a=m),(l===void 0||d>l)&&(l=d)}else if(u.geometry.type==="LineString"&&r===1){let d=u.geometry.coordinates.map(E=>E[0]),m=u.geometry.coordinates.map(E=>E[1]),g=d.filter(s),_=m.filter(s),v=!0;g.forEach(E=>{u.geometry.coordinates.filter(T=>T[0]===E).map(T=>T[1]).filter(s).length!==2&&(v=!1)}),g.length===2&&_.length===2&&v?this._isTaskBoundsRect=!0:this._isTaskBoundsRect=!1}}),this._taskExtent=new mt([o,n],[l,a]),this.emit("taskchanged")}function s(n,o,a){return a.indexOf(n)===o}}_wasRapidEdit(e){return e?.type&&/^rapid/.test(e.type)}_onUndone(e,i){let r=i.annotation;this._wasRapidEdit(r)&&(this.acceptedIDs.delete(r.id),this.context.systems.map.immediateRedraw())}_onChange(){let e=this.context.systems.edits.peekAnnotation();this._wasRapidEdit(e)&&(this.acceptedIDs.add(e.id),this.context.systems.map.immediateRedraw())}_onRestore(){this.acceptedIDs=new Set,this.context.systems.edits.peekAllAnnotations().forEach(e=>{this._wasRapidEdit(e)&&(this.acceptedIDs.add(e.id),e.origid&&this.acceptedIDs.add(e.origid))}),this.context.systems.map.immediateRedraw()}_hashchange(e,i){e.get("poweruser")==="true"&&(this._hadPoweruser=!0);let r=new Set,s=e.get("datasets"),n=i.get("datasets");if(s!==n){typeof s=="string"&&(r=new Set(s.split(",")));for(let[a,l]of this._datasets)r.has(a)?(l.enabled=!0,r.delete(a)):l.enabled=!1}let o=this.context.services.esri;!o||!r.size||o.startAsync().then(()=>o.loadDatasetsAsync()).then(a=>{let l=this.context.systems.l10n;for(let u of r){let d=a[u];if(!d)continue;o.loadLayerAsync(d.id);let m=d.groupCategories.some(E=>E.toLowerCase()==="/categories/preview"),g=d.groupCategories.some(E=>E.toLowerCase()==="/categories/buildings"),_=this._datasets.size%_S.length,v={id:d.id,beta:m,added:!0,enabled:!0,conflated:!1,service:"esri",color:_S[_],label:d.title,license_markdown:l.t("rapid_feature_toggle.esri.license_markdown")};d.extent&&(v.extent=new mt(d.extent[0],d.extent[1])),g&&(v.conflated=!0,v.service="mapwithai"),this._datasets.set(d.id,v)}})}};var y6=class extends ui{constructor(e){super(e),this.id="storage",this.dependencies=new Set,this._storage=null;try{this._storage=window.localStorage}catch{this._mock=new Map,this._storage={hasItem:r=>this._mock.has(r),getItem:r=>this._mock.get(r),setItem:(r,s)=>this._mock.set(r,s),removeItem:r=>this._mock.delete(r),clear:()=>this._mock.clear()}}}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}hasItem(e){return!!this._storage.getItem(e)}getItem(e){return this._storage.getItem(e)}setItem(e,i){try{return this._storage.setItem(e,i),!0}catch{console.error("localStorage quota exceeded")}return!1}removeItem(e){this._storage.removeItem(e)}clear(){this._storage.clear()}};function c_(t){let e=t.services.osm;function i(n){!e||!e.authenticated()?r(n,null):e.userDetails((o,a)=>r(n,a))}function r(n,o){let a=n.select(".userInfo"),l=n.select(".loginLogout");if(!o)a.html("").classed("hide",!0);else{a.html("").classed("hide",!1);let u=a.append("a").attr("href",e.userURL(o.display_name)).attr("target","_blank");o.image_url?u.append("img").attr("class","icon pre-text user-icon").attr("src",o.image_url):u.call(Ye("#rapid-icon-avatar","pre-text light")),u.append("span").attr("class","label").html(o.display_name)}e?e.authenticated()?l.classed("hide",!1).select("a").text(t.t("logout")).on("click",u=>{u.preventDefault(),e.logout(),s()}):l.classed("hide",!1).select("a").text(t.t("login")).on("click",u=>{u.preventDefault(),e.authenticate()}):l.classed("hide",!0)}function s(){if(!e)return;let n=e.urlroot+"/logout?referer=%2Flogin",o=600,a=550,l=[["width",o],["height",a],["left",window.screen.width/2-o/2],["top",window.screen.height/2-a/2]].map(u=>u.join("=")).join(",");window.open(n,"_blank",l)}return function(n){e&&(n.append("li").attr("class","userInfo").classed("hide",!0),n.append("li").attr("class","loginLogout").classed("hide",!0).append("a").attr("href","#"),e.on("authchange",()=>i(n)),i(n))}}function sQ(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var l0=sQ;var nQ=typeof global=="object"&&global&&global.Object===Object&&global,ON=nQ;var oQ=typeof self=="object"&&self&&self.Object===Object&&self,aQ=ON||oQ||Function("return this")(),u_=aQ;var lQ=function(){return u_.Date.now()},h_=lQ;var cQ=/\s/;function uQ(t){for(var e=t.length;e--&&cQ.test(t.charAt(e)););return e}var BN=uQ;var hQ=/^\s+/;function dQ(t){return t&&t.slice(0,BN(t)+1).replace(hQ,"")}var UN=dQ;var fQ=u_.Symbol,z4=fQ;var zN=Object.prototype,pQ=zN.hasOwnProperty,mQ=zN.toString,_6=z4?z4.toStringTag:void 0;function gQ(t){var e=pQ.call(t,_6),i=t[_6];try{t[_6]=void 0;var r=!0}catch{}var s=mQ.call(t);return r&&(e?t[_6]=i:delete t[_6]),s}var GN=gQ;var yQ=Object.prototype,_Q=yQ.toString;function xQ(t){return _Q.call(t)}var $N=xQ;var vQ="[object Null]",bQ="[object Undefined]",HN=z4?z4.toStringTag:void 0;function wQ(t){return t==null?t===void 0?bQ:vQ:HN&&HN in Object(t)?GN(t):$N(t)}var VN=wQ;function EQ(t){return t!=null&&typeof t=="object"}var jN=EQ;var TQ="[object Symbol]";function SQ(t){return typeof t=="symbol"||jN(t)&&VN(t)==TQ}var XN=SQ;var WN=0/0,AQ=/^[-+]0x[0-9a-f]+$/i,CQ=/^0b[01]+$/i,IQ=/^0o[0-7]+$/i,kQ=parseInt;function MQ(t){if(typeof t=="number")return t;if(XN(t))return WN;if(l0(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=l0(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=UN(t);var i=CQ.test(t);return i||IQ.test(t)?kQ(t.slice(2),i?2:8):AQ.test(t)?WN:+t}var xS=MQ;var PQ="Expected a function",RQ=Math.max,DQ=Math.min;function FQ(t,e,i){var r,s,n,o,a,l,u=0,d=!1,m=!1,g=!0;if(typeof t!="function")throw new TypeError(PQ);e=xS(e)||0,l0(i)&&(d=!!i.leading,m="maxWait"in i,n=m?RQ(xS(i.maxWait)||0,e):n,g="trailing"in i?!!i.trailing:g);function _(O){var B=r,U=s;return r=s=void 0,u=O,o=t.apply(U,B),o}function v(O){return u=O,a=setTimeout(T,e),d?_(O):o}function E(O){var B=O-l,U=O-u,$=e-B;return m?DQ($,n-U):$}function b(O){var B=O-l,U=O-u;return l===void 0||B>=e||B<0||m&&U>=n}function T(){var O=h_();if(b(O))return A(O);a=setTimeout(T,E(O))}function A(O){return a=void 0,g&&r?_(O):(r=s=void 0,o)}function M(){a!==void 0&&clearTimeout(a),u=0,r=l=s=a=void 0}function k(){return a===void 0?o:A(h_())}function F(){var O=h_(),B=b(O);if(r=arguments,s=this,l=O,B){if(a===void 0)return v(l);if(m)return clearTimeout(a),a=setTimeout(T,e),_(l)}return a===void 0&&(a=setTimeout(T,e)),o}return F.cancel=M,F.flush=k,F}var Ur=FQ;var LQ="Expected a function";function NQ(t,e,i){var r=!0,s=!0;if(typeof t!="function")throw new TypeError(LQ);return l0(i)&&(r="leading"in i?!!i.leading:r,s="trailing"in i?!!i.trailing:s),Ur(t,e,{leading:r,maxWait:e,trailing:s})}var rl=NQ;function d_(t){let e=t.systems.imagery,i=ye(null);function r(n,o,a){let l=n.selectAll(`.${a}`).data([0]);l=l.enter().append("div").attr("class",a).merge(l);let u=l.selectAll(".attribution").data(o,m=>m.id);u.exit().remove(),u=u.enter().append("span").attr("class","attribution").each((m,g,_)=>{let v=ye(_[g]);if(m.terms_html){v.html(m.terms_html);return}m.terms_url&&(v=v.append("a").attr("href",m.terms_url).attr("target","_blank"));let E=t.t(`imagery.${m.idtx}.attribution.text`,{default:m.terms_text||m.id||m.name});m.icon&&!m.overlay&&v.append("img").attr("class","source-image").attr("src",m.icon),v.append("span").attr("class","attribution-text").html(E)}).merge(u);let d=u.selectAll(".copyright-notice").data(m=>{let g=m.copyrightNotices(t.systems.map.zoom(),t.systems.map.extent());return g?[g]:[]});d.exit().remove(),d=d.enter().append("span").attr("class","copyright-notice").merge(d),d.html(String)}function s(){let n=e.baseLayerSource();i.call(r,n?[n]:[],"base-layer-attribution");let o=t.systems.map.zoom(),a=e.overlayLayerSources()||[];i.call(r,a.filter(l=>l.validZoom(o)),"overlay-layer-attribution")}return function(n){i=n,e.on("imagerychange",s),t.systems.map.on("draw",rl(s,400,{leading:!1})),s()}}function G4(t){let e=gr(t,"more-fields").minItems(1),i=[],r="",s="",n="";function o(a){let l=i.filter(k=>k.isAllowed()),u=l.filter(k=>k.isShown()),d=l.filter(k=>!k.isShown()),m=a.selectAll(".form-fields-container").data([0]);m=m.enter().append("div").attr("class","form-fields-container "+(n||"")).merge(m);let g=m.selectAll(".wrap-form-field").data(u,k=>k.id+(k.entityIDs?k.entityIDs.join():""));g.exit().remove();let _=g.enter().append("div").attr("class",k=>`wrap-form-field wrap-form-field-${k.safeid}`);g=g.merge(_),g.order().each((k,F,O)=>{ye(O[F]).call(k.render)});let v=[],E=d.map(k=>{let F=k.title;v.push(F);let O=k.terms;return k.key&&O.push(k.key),k.keys&&(O=O.concat(k.keys)),{display:k.label,value:F,title:F,field:k,terms:O}}),b=v.slice(0,3).join(", ")+(v.length>3?"\u2026":""),T=a.selectAll(".more-fields").data(s==="hover"||E.length===0?[]:[0]);T.exit().remove();let A=T.enter().append("div").attr("class","more-fields").append("label");A.append("span").text(t.t("inspector.add_fields")),T=A.merge(T);let M=T.selectAll(".value").data([0]);M.exit().remove(),M=M.enter().append("input").attr("class","value").attr("type","text").attr("placeholder",b).call(ki).merge(M),M.call(ti,"").call(e.data(E).on("accept",k=>{if(!k)return;let F=k.field;F.show(),a.call(o),F.focus()})),r!==b&&(M.attr("placeholder",b),r=b)}return o.fieldsArr=function(a){return arguments.length?(i=a||[],o):i},o.state=function(a){return arguments.length?(s=a,o):s},o.klass=function(a){return arguments.length?(n=a,o):n},o}function f_(t){var e=Mt("change"),i=G4(t),r=gr(t,"comment").caseSensitive(!0),s,n,o;function a(u){l(u)}function l(u){var d=!1;if(!s){d=!0;var m=t.systems.presets;s=[new Ca(t,m.field("comment"),null,{show:!0,revert:!1}),new Ca(t,m.field("source"),null,{show:!1,revert:!1}),new Ca(t,m.field("hashtags"),null,{show:!1,revert:!1})],s.forEach(function(A){A.on("change",function(M,k){e.call("change",A,void 0,M,k)})})}if(s.forEach(function(A){A.tags(n)}),u.call(i.fieldsArr(s)),d){var g=u.select(".form-field-comment textarea"),_=g.node();_&&(_.focus(),_.select()),L2(g,"blur");var v=t.services.osm;v&&v.userChangesets(function(A,M){if(!A){var k=M.map(function(F){var O=F.tags.comment;return O?{title:O,value:O}:null}).filter(Boolean);g.call(r.data(df(k,"title")))}})}var E=n.comment.match(/google/i),b=u.select(".form-field-comment").selectAll(".comment-warning").data(E?[0]:[]);b.exit().transition().duration(200).style("opacity",0).remove();var T=b.enter().insert("div",".tag-reference-body").attr("class","field-warning comment-warning").style("opacity",0);T.append("a").attr("target","_blank").call(Ye("#rapid-icon-alert","inline")).attr("href",t.t("commit.google_warning_link")).append("span").text(t.t("commit.google_warning")),T.transition().duration(200).style("opacity",1)}return a.tags=function(u){return arguments.length?(n=u,a):n},a.changesetID=function(u){return arguments.length?(o===u||(o=u,s=null),a):o},$t(a,e,"on")}var ZN=Xi($2(),1);var Kc=new function(){var t="keyValue",e="keyAttributes",i="@",r=[],s=/^\s*$/,n=/^(?:true|false)$/i;function o(m){return s.test(m)?null:n.test(m)?m.toLowerCase()==="true":isFinite(m)?parseFloat(m):isFinite(Date.parse(m))?new Date(m):m}function a(){}a.prototype.toString=function(){return"null"},a.prototype.valueOf=function(){return null};function l(m){return m===null?new a:m instanceof Object?m:new m.constructor(m)}function u(m,g,_,v){var E=r.length,b=m.hasChildNodes(),T=m.hasAttributes(),A=!!(g&2),M,k,F=0,O="",B=A?{}:!0;if(b)for(var U,$=0;$<m.childNodes.length;$++)U=m.childNodes.item($),U.nodeType===4?O+=U.nodeValue:U.nodeType===3?O+=U.nodeValue.trim():U.nodeType===1&&!U.prefix&&r.push(U);var q=r.length,W=o(O);!A&&(b||T)&&(B=g===0?l(W):{});for(var Z=E;Z<q;Z++)M=r[Z].nodeName.toLowerCase(),k=u(r[Z],g,_,v),B.hasOwnProperty(M)?(B[M].constructor!==Array&&(B[M]=[B[M]]),B[M].push(k)):(B[M]=k,F++);if(T){for(var Q=m.attributes.length,X=v?"":i,ce=v?{}:B,de,le=0;le<Q;F++,le++)de=m.attributes.item(le),ce[X+de.name.toLowerCase()]=o(de.value.trim());v&&(_&&Object.freeze(ce),B[e]=ce,F-=Q-1)}return g===3||(g===2||g===1&&F>0)&&O?B[t]=W:!A&&F===0&&O&&(B=W),_&&(A||F>0)&&Object.freeze(B),r.length=E,B}function d(m,g,_){var v,E;_ instanceof String||_ instanceof Number||_ instanceof Boolean?g.appendChild(m.createTextNode(_.toString())):_.constructor===Date&&g.appendChild(m.createTextNode(_.toGMTString()));for(var b in _)if(v=_[b],!(isFinite(b)||v instanceof Function))if(b===t)v!==null&&v!==!0&&g.appendChild(m.createTextNode(v.constructor===Date?v.toGMTString():String(v)));else if(b===e)for(var T in v)g.setAttribute(T,v[T]);else if(b.charAt(0)===i)g.setAttribute(b.slice(1),v);else if(v.constructor===Array)for(var A=0;A<v.length;A++)E=m.createElement(b),d(m,E,v[A]),g.appendChild(E);else E=m.createElement(b),v instanceof Object?d(m,E,v):v!==null&&v!==!0&&E.appendChild(m.createTextNode(v.toString())),g.appendChild(E)}this.build=function(m,g,_,v){var E=arguments.length>1&&typeof g=="number"?g&3:1;return u(m,E,_||!1,arguments.length>3?v:E===3)},this.unbuild=function(m){var g=document.implementation.createDocument("","",null);return d(g,g,m),g},this.stringify=function(m){return new XMLSerializer().serializeToString(Kc.unbuild(m))}};function $4(t,e){return function(i){i.style("opacity",t?0:1).classed("hide",!1).transition().style("opacity",t?1:0).on("end",function(){ye(this).classed("hide",!t).style("opacity",null),e&&e.apply(this)})}}function c0(t,e){let i=t.systems.l10n,r=t.systems.storage,s=Mt("toggled"),n=!0,o=!0,a,l=es(""),u=function(){},d=function(g){o&&(n=(r.getItem(`disclosure.${e}.expanded`)||"true")==="true"),a!==void 0&&(n=a);let _=g.selectAll(`.hide-toggle-${e}`).data([0]),v=_.enter().append("a").attr("href","#").attr("class",`hide-toggle hide-toggle-${e}`).call(Ye("","pre-text hide-toggle-icon"));v.append("span").attr("class","hide-toggle-text"),_=v.merge(_),_.on("click",A).classed("expanded",n),_.selectAll(".hide-toggle-text").html(l());let E=i.isRTL(),b=n?"down":E?"backward":"forward";_.selectAll(".hide-toggle-icon > use").attr("xlink:href",`#rapid-icon-${b}`);let T=g.selectAll(".disclosure-wrap").data([0]);T=T.enter().append("div").attr("class",`disclosure-wrap disclosure-wrap-${e}`).merge(T).classed("hide",!n),n&&T.call(u);function A(M){M.preventDefault(),n=!n,o&&a===void 0&&r.setItem(`disclosure.${e}.expanded`,n),a=void 0,_.classed("expanded",n);let k=n?"down":E?"backward":"forward";_.selectAll(".hide-toggle-icon > use").attr("xlink:href",`#rapid-icon-${k}`),T.call($4(n)),n&&T.call(u),s.call("toggled",this,n)}};return d.expanded=m=>arguments.length?(n=m,d):n,d.checkPreference=m=>arguments.length?(o=m,d):o,d.expandOverride=m=>arguments.length?(a=m,d):a,d.label=m=>arguments.length?(l=es(m),d):l,d.content=m=>arguments.length?(u=m,d):u,$t(d,s,"on")}function Ji(t,e){let i=es(""),r=ye(null),s,n,o,a,l,u,d={id:e};d.selection=function(){return r},d.classes=function(g){return arguments.length?(i=es(g),d):i},d.label=function(g){return arguments.length?(a=es(g),d):a},d.shouldDisplay=function(g){return arguments.length?(s=es(g),d):s},d.content=function(g){return arguments.length?(n=g,d):n},d.disclosureContent=function(g){return arguments.length?(l=g,d):l},d.disclosureExpandOverride=function(g){return arguments.length?(u=g,d):u},d.render=function(_){r=_.selectAll(`.section-${e}`).data([0]),r=r.enter().append("div").attr("class",`section section-${e} `+(i&&i()||"")).merge(r),r.call(m)},d.reRender=function(){r.call(m)};function m(g){if(typeof s=="function"){let _=s();if(g.classed("hide",!_),!_){g.html("");return}}l?(o||(o=c0(t,e.replace(/-/g,"_")).label(a||"").content(l)),o.expandOverride(u),g.call(o)):n&&g.call(n)}return d}function p_(t){let e=t.systems.l10n,i=Os(),r={};t.systems.data.getDataAsync("discarded").then(a=>r=a).catch(()=>{});let n=Ji(t,"changes-list").label(()=>{let l=t.systems.edits.difference().summary();return e.t("inspector.title_count",{title:e.tHtml("commit.changes"),count:l.size})}).disclosureContent(o);function o(a){let l=t.systems.edits,u=[...l.difference().summary().values()],d=a.selectAll(".commit-section").data([0]),m=d.enter().append("div").attr("class","commit-section");m.append("ul").attr("class","changeset-list"),d=m.merge(d);let g=d.select("ul").selectAll("li").data(u),_=g.enter().append("li").attr("class","change-item"),v=_.append("button").on("mouseover",F).on("mouseout",O).on("click",B);v.each((U,$,q)=>{let W=U.entity.geometry(U.graph);ye(q[$]).call(Ye(`#rapid-icon-${W}`,`pre-text ${U.changeType}`))}),v.append("span").attr("class","change-type").html(U=>e.tHtml(`commit.${U.changeType}`)+" "),v.append("strong").attr("class","entity-type").html(U=>{let $=t.systems.presets.match(U.entity,U.graph);return $&&$.name()||e.displayType(U.entity.id)}),v.append("span").attr("class","entity-name").html(U=>{let $=e.displayName(U.entity.tags),q="";return $!==""&&(q+=":"),q+=" "+$}),g=_.merge(g);let E=new Jo().update({id:void 0}),b=l.changes(Vu(l.difference(),r));delete E.id;let T=Kc.stringify(E.osmChangeJXON(b)),A=new Blob([T],{type:"text/xml;charset=utf-8;"}),M="changes.osc",k=d.selectAll(".download-changes").data([0]).enter().append("a").attr("class","download-changes");i.download?k.attr("href",window.URL.createObjectURL(A)).attr("download",M):k.attr("target","_blank").on("click.download",()=>navigator.msSaveBlob(A,M)),k.call(Ye("#rapid-icon-load","inline")).append("span").html(e.tHtml("commit.download_changes"));function F(U){U.entity&&t.surface().selectAll(Jh([U.entity.id],t.graph())).classed("hover",!0)}function O(){t.surface().selectAll(".hover").classed("hover",!1)}function B(U,$){if($.changeType!=="deleted"){let q=$.entity;t.systems.map.fitEntitiesEase(q),t.surface().selectAll(Jh([q.id],t.graph())).classed("hover",!0)}}}return n}function m_(t){function e(i){let r=t.systems.validator.getIssuesBySeverity({what:"edited",where:"all",includeDisabledRules:!0});for(let s in r){let n=r[s];s!=="error"&&(n=n.filter(_=>_.type!=="help_request"));let o=`${s}-section`,a=`${s}-item`,l=i.selectAll("."+o).data(n.length?[0]:[]);l.exit().remove();let u=l.enter().append("div").attr("class","modal-section "+o+" fillL2");u.append("h3").html(s==="warning"?t.tHtml("commit.warnings"):t.tHtml("commit.errors")),u.append("ul").attr("class","changeset-list"),l=u.merge(l);let d=l.select("ul").selectAll("li").data(n,_=>_.key);d.exit().remove();let m=d.enter().append("li").attr("class",a),g=m.append("button").on("mouseover",(_,v)=>{v.entityIds&&t.surface().selectAll(Jh(v.entityIds,t.graph())).classed("hover",!0)}).on("mouseout",()=>{t.surface().selectAll(".hover").classed("hover",!1)}).on("click",(_,v)=>{t.systems.validator.focusIssue(v)});g.call(Ye("#rapid-icon-alert","pre-text")),g.append("strong").attr("class","issue-message"),g.filter(_=>_.tooltip).call(Ft(t).title(_=>_.tooltip).placement("top")),d=m.merge(d),d.selectAll(".issue-message").html(_=>_.message(t))}}return e}function yh(t,e){let i=t.systems.l10n,r=t.systems.storage,s=t.services.taginfo,n=Mt("change"),o=[{id:"list",icon:"#fas-th-list"},{id:"text",icon:"#fas-i-cursor"}],a=Ji(t,e).classes("raw-tag-editor").label(()=>{let te=Object.keys(b).filter(Boolean).length;return i.t("inspector.title_count",{title:i.tHtml("inspector.tags"),count:te})}).disclosureContent(A),l=r.getItem("raw-tag-editor-view")||"list",u=[],d=[],m=!1,g=!1,_=null,v,E,b,T;function A(te){d=d.filter(Qe=>b[Qe]!==void 0);let ee=Object.keys(b).sort(),oe=_n(ee,d);for(let Qe in oe)d.push(oe[Qe]);let ie=d.map((Qe,xt)=>({index:xt,key:Qe,value:b[Qe]}));(!ie.length||g)&&(g=!1,ie.push({index:ie.length,key:"",value:""})),te.selectAll(".raw-tag-options").data([0]).enter().insert("div",":first-child").attr("class","raw-tag-options").selectAll(".raw-tag-option").data(o,Qe=>Qe.id).enter().append("button").attr("class",Qe=>`raw-tag-option raw-tag-option-${Qe.id}`+(l===Qe.id?" selected":"")).attr("title",Qe=>i.t(`icons.${Qe.id}`)).on("click",function(Qe,xt){l=xt.id,r.setItem("raw-tag-editor-view",xt.id),te.selectAll(".raw-tag-option").classed("selected",It=>It===xt),te.selectAll(".tag-text").classed("hide",xt.id!=="text").each(F),te.selectAll(".tag-list, .add-row").classed("hide",xt.id!=="list")}).each((Qe,xt,It)=>{ye(It[xt]).call(Ye(Qe.icon))});let He=U(ie),Je=te.selectAll(".tag-text").data([0]);Je=Je.enter().append("textarea").attr("class","tag-text"+(l!=="text"?" hide":"")).call(ki).attr("placeholder",i.t("inspector.key_value")).attr("spellcheck","false").merge(Je),Je.call(ti,He).each(F).on("input",F).on("focus",de).on("blur",$).on("change",$);let ot=te.selectAll(".tag-list").data([0]);ot=ot.enter().append("ul").attr("class","tag-list"+(l!=="list"?" hide":"")).merge(ot);let gt=te.selectAll(".add-row").data([0]).enter().append("div").attr("class","add-row"+(l!=="list"?" hide":""));gt.append("button").attr("class","add-tag").call(Ye("#rapid-icon-plus","light")).on("click",ce),gt.append("div").attr("class","space-value"),gt.append("div").attr("class","space-buttons");let vt=ot.selectAll(".tag-row").data(ie,Qe=>Qe.key);vt.exit().each((Qe,xt,It)=>{ye(It[xt]).selectAll("input.key, input.value").call(gr.off,t)}).remove();let ct=vt.enter().append("li").attr("class","tag-row").classed("readonly",M),Se=ct.append("div").attr("class","inner-wrap");Se.append("div").attr("class","key-wrap").append("input").property("type","text").attr("class","key").call(ki).on("focus",de).on("blur",Z).on("change",Z),Se.append("div").attr("class","value-wrap").append("input").property("type","text").attr("class","value").call(ki).on("focus",de).on("blur",Q).on("change",Q).on("keydown.push-more",q),Se.append("button").attr("class","form-field-button remove").attr("title",i.t("icons.remove")).call(Ye("#rapid-operation-delete")),vt=vt.merge(ct).sort((Qe,xt)=>Qe.index-xt.index),vt.each((Qe,xt,It)=>{let Gt=ye(It[xt]);Gt.select("input.key"),Gt.select("input.value"),T&&s&&v!=="hover"&&W(Gt);let Ni={key:Qe.key};k(Qe)||(Ni.value=Qe.value);let je=Qc(t,Ni);v==="hover"&&je.showing(!1),Gt.select(".inner-wrap").call(je.button),Gt.call(je.body),Gt.select("button.remove")}),vt.selectAll("input.key").attr("title",Qe=>Qe.key).attr("readonly",Qe=>M(Qe)||k(Qe)||null).call(ti,Qe=>Qe.key),vt.selectAll("input.value").classed("mixed",k).attr("title",Qe=>k(Qe)?Qe.value.filter(Boolean).join(`
`):Qe.value).attr("readonly",Qe=>M(Qe)||null).attr("placeholder",Qe=>k(Qe)?i.t("inspector.multiple_values"):null).call(ti,Qe=>k(Qe)?"":Qe.value),vt.selectAll("button.remove").on(("PointerEvent"in window?"pointer":"mouse")+"down",X)}function M(te){for(let ee of u)if(ee.test(te.key))return!0;return!1}function k(te){return Array.isArray(te.value)}function F(){if(l!=="text")return;let te=ye(this),ee=te.node().value.match(/\n/g),oe=2+Number(ee&&ee.length),ie=20;te.style("height",oe*ie+"px")}function O(te){return JSON.stringify(te).slice(1,-1)}function B(te){let ee="",oe="";return(te.length<1||te.charAt(0)!=='"')&&(ee='"'),(te.length<2||te.charAt(te.length-1)!=='"'||te.charAt(te.length-1)==='"'&&te.charAt(te.length-2)==="\\")&&(oe='"'),JSON.parse(ee+te+oe)}function U(te){let ee=te.filter(oe=>oe.key&&oe.key.trim()!=="").map(oe=>{let ie=oe.value;typeof ie!="string"&&(ie="*");let ne=ie?O(ie):"";return O(oe.key)+"="+ne}).join(`
`);return v!=="hover"&&ee.length?ee+`
`:ee}function $(){let te=this.value.trim(),ee={};te.split(`
`).forEach(ie=>{let ne=ie.match(/^\s*([^=]+)=(.*)$/);if(ne!==null){let me=t.cleanTagKey(B(ne[1].trim())),De=t.cleanTagValue(B(ne[2].trim()));ee[me]=De}});let oe=ff(b,ee);if(oe.length){if(_=_||{},oe.forEach(function(ie){M({key:ie.key})||ie.newVal==="*"&&typeof ie.oldVal!="string"||(ie.type==="-"?_[ie.key]=void 0:ie.type==="+"&&(_[ie.key]=ie.newVal||""))}),Object.keys(_).length===0){_=null;return}le()}}function q(te){te.keyCode===9&&!te.shiftKey&&a.selection().selectAll(".tag-list li:last-child input.value").node()===this&&ti(ye(this))&&ce()}function W(te){let ee=te.datum(),oe=te.select("input.key"),ie=te.select("input.value");if(M(ee))return;if(k(ee)){ie.call(gr(t,"tag-value").minItems(1).fetcher(function(De,He){let Je=ti(oe);if(!b[Je])return;let ot=b[Je].filter(Boolean).map(gt=>({value:gt,title:gt}));He(ot)}));return}let ne=t.graph().geometry(T[0]);oe.call(gr(t,"tag-key").fetcher(function(De,He){s.keys({debounce:!0,geometry:ne,query:De},function(Je,ot){if(!Je){let gt=ot.filter(vt=>b[vt.value]===void 0);He(me(De,gt))}})})),ie.call(gr(t,"tag-value").fetcher(function(De,He){s.values({debounce:!0,key:ti(oe),geometry:ne,query:De},function(Je,ot){Je||He(me(De,ot))})}));function me(De,He){let Je=[],ot=[];for(let gt of He)gt.value.substring(0,De.length)===De?Je.push(gt):ot.push(gt);return Je.concat(ot)}}function Z(te,ee){if(ye(this).attr("readonly"))return;let oe=ee.key;if(_&&_.hasOwnProperty(oe)&&_[oe]===void 0)return;let ie=t.cleanTagKey(this.value.trim());if(M({key:ie})){this.value=oe;return}if(ie&&ie!==oe&&b[ie]!==void 0){this.value=oe,a.selection().selectAll(".tag-list input.value").each((Je,ot,gt)=>{if(Je.key===ie){let vt=gt[ot];vt.focus(),vt.select()}});return}let ne=this.parentNode.parentNode,me=ye(ne).selectAll("input.value"),De=t.cleanTagValue(ti(me));_=_||{},oe&&(_[oe]=void 0),_[ie]=De;let He=d.indexOf(oe);He!==-1&&(d[He]=ie),ee.key=ie,ee.value=De,this.value=ie,ti(me,De),le()}function Q(te,ee){M(ee)||k(ee)&&!this.value||_&&_.hasOwnProperty(ee.key)&&_[ee.key]===void 0||(_=_||{},_[ee.key]=t.cleanTagValue(this.value),le())}function X(te,ee){M(ee)||(ee.key===""?(g=!1,a.reRender()):(d=d.filter(oe=>oe!==ee.key),_=_||{},_[ee.key]=void 0,le()))}function ce(){window.setTimeout(function(){g=!0,a.reRender(),a.selection().selectAll(".tag-list li:last-child input.key").node().focus()},20)}function de(){m=!0}function le(){let te=T;window.setTimeout(function(){_&&(n.call("change",this,te,_),_=null)},10)}return a.state=function(te){return arguments.length?(v!==te&&(m=!1,d=[],v=te),a):v},a.presets=function(te){return arguments.length?(E=te,E&&E.length&&E[0].isFallback()||m?a.disclosureExpandOverride(!0):a.disclosureExpandOverride(void 0),a):E},a.tags=function(te){return arguments.length?(b=te,a):b},a.entityIDs=function(te){return arguments.length?((!T||!te||!Gn(T,te))&&(m=!1,d=[],T=te),a):T},a.readOnlyTags=function(te){return arguments.length?(u=te,a):u},$t(a,n,"on")}var qN=[/^changesets_count$/,/^created_by$/,/^ideditor:/,/^imagery_used$/,/^host$/,/^locale$/,/^rapid:poweruser$/,/^warnings:/,/^resolved:/,/^closed:note$/,/^closed:keepright$/,/^closed:improveosm:/,/^closed:osmose:/],YN=/(#[^\u2000-\u206F\u2E00-\u2E7F\s\\'!"#$%()*,.\/:;<=>?@\[\]^`{|}~]+)/g;function g_(t){let e=t.systems.rapid,i=t.systems.storage,r=t.systems.uploader,s=Mt("cancel"),n,o,a=f_(t).on("change",b),l=yh(t,"changeset-tag-editor").on("change",b).readOnlyTags(qN),u=p_(t),d=m_(t);function m(k){o=k,r.changeset||g(),_(),k.call(v)}function g(){let k=t.systems.l10n.localeCode(),F=+i.getItem("commentDate")||0,O=Date.now(),B=2*86400*1e3;(F>O||O-F>B)&&(i.removeItem("comment"),i.removeItem("hashtags"),i.removeItem("source"));let U=t.systems.urlhash,$=U.initialHashParams.get("comment"),q=U.initialHashParams.get("source"),W=U.initialHashParams.get("hashtags");$&&(i.setItem("comment",$),i.setItem("commentDate",Date.now())),q&&(i.setItem("source",q),i.setItem("commentDate",Date.now())),W&&(i.setItem("hashtags",W),i.setItem("commentDate",Date.now()));let Z=Os(),Q={comment:i.getItem("comment")||"",created_by:t.cleanTagValue("Rapid "+t.version),host:t.cleanTagValue(Z.host),locale:t.cleanTagValue(k)};T(Q,!0);let X=i.getItem("hashtags");X&&(Q.hashtags=X);let ce=i.getItem("source");ce&&(Q.source=ce),r.changeset=new Jo({tags:Q})}function _(){let k=t.services.osm;if(!k)return;let F=Object.assign({},r.changeset.tags),O=new Set((F.source||"").split(";"));e.hadPoweruser?F["rapid:poweruser"]="true":delete F["rapid:poweruser"];let B=new Set(t.systems.edits.photosUsed());["streetside","mapillary","mapillary-map-features","mapillary-signs","kartaview"].forEach(function(ie){O.delete(ie)}),B.size?(O.add("streetlevel imagery"),B.forEach(function(ie){O.add(ie)})):O.delete("streetlevel imagery");let $=e.sources;["mapwithai","esri"].forEach(function(ie){O.delete(ie)}),$.forEach(function(ie){O.add(ie)});let W=t.cleanTagValue(Array.from(O).filter(Boolean).join(";"));W?F.source=W:delete F.source;let Z=new Set(t.systems.edits.imageryUsed()),Q=t.cleanTagValue(Array.from(Z).filter(Boolean).join(";"));F.imagery_used=Q||"None";let X=k.getClosedIDs();X.length&&(F["closed:note"]=t.cleanTagValue(X.join(";")));let ce=t.services.keepRight;if(ce){let ie=ce.getClosedIDs();ie.length&&(F["closed:keepright"]=t.cleanTagValue(ie.join(";")))}let de=t.services.improveOSM;if(de){let ie=de.getClosedCounts();for(let ne in ie)F[`closed:improveosm:${ne}`]=t.cleanTagValue(ie[ne].toString())}let le=t.services.osmose;if(le){let ie=le.getClosedCounts();for(let ne in ie)F[`closed:osmose:${ne}`]=t.cleanTagValue(ie[ne].toString())}for(let ie in F)ie.match(/(^warnings:)|(^resolved:)/)&&delete F[ie];function te(ie,ne){let me=ds(ie,"type");for(let De in me){let He=me[De];if(He[0].subtype){let Je=ds(He,"subtype");for(let ot in Je){let gt=Je[ot];F[ne+":"+De+":"+ot]=t.cleanTagValue(gt.length.toString())}}else F[ne+":"+De]=t.cleanTagValue(He.length.toString())}}let ee=t.systems.validator.getIssuesBySeverity({what:"edited",where:"all",includeIgnored:!0,includeDisabledRules:!0}).warning.filter(ie=>ie.type!=="help_request");te(ee,"warnings");let oe=t.systems.validator.getResolvedIssues();te(oe,"resolved"),r.changeset=r.changeset.update({tags:F})}function v(k){let F=t.services.osm;if(!F)return;let B=k.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");B.append("div").append("h3").html(t.tHtml("commit.title")),B.append("button").attr("class","close").on("click",function(){s.call("cancel",this)}).call(Ye("#rapid-icon-close"));let U=k.selectAll(".body").data([0]);U=U.enter().append("div").attr("class","body").merge(U);let $=U.selectAll(".changeset-editor").data([0]);$=$.enter().append("div").attr("class","modal-section changeset-editor").merge($),$.call(a.changesetID(r.changeset.id).tags(r.changeset.tags)),U.call(d);let q=U.selectAll(".save-section").data([0]);q=q.enter().append("div").attr("class","modal-section save-section fillL").merge(q);let W=q.selectAll(".commit-info").data([0]);W.enter().size()&&(n=null),W=W.enter().append("p").attr("class","commit-info").html(t.tHtml("commit.upload_explanation")).merge(W),F.userDetails(function(De,He){if(De||n===He)return;n=He;let Je=ye(document.createElement("div"));He.image_url&&Je.append("img").attr("src",He.image_url).attr("class","icon pre-text user-icon"),Je.append("a").attr("class","user-info").html(He.display_name).attr("href",F.userURL(He.display_name)).attr("target","_blank"),W.html(t.tHtml("commit.upload_explanation_with_user",{user:Je.html()}))});let Z=q.selectAll(".request-review").data([0]),Q=Z.enter().append("div").attr("class","request-review"),X=fl("commit-input-request-review"),ce=Q.append("label").attr("for",X);ce.empty()||ce.call(Ft(t).title(t.tHtml("commit.request_review_info")).placement("top")),ce.append("input").attr("type","checkbox").attr("id",X),ce.append("span").html(t.tHtml("commit.request_review")),Z=Z.merge(Q);let de=Z.selectAll("input").property("checked",A(r.changeset.tags)).on("change",me),le=q.selectAll(".buttons").data([0]),te=le.enter().append("div").attr("class","buttons fillL");te.append("button").attr("class","secondary-action button cancel-button").append("span").attr("class","label").html(t.tHtml("commit.cancel")),te.append("button").attr("class","action button save-button").append("span").attr("class","label").html(t.tHtml("commit.save"));let oe=E();le=le.merge(te),le.selectAll(".cancel-button").on("click.cancel",function(){s.call("cancel",this)}),le.selectAll(".save-button").classed("disabled",oe!==null).on("click.save",function(){if(!ye(this).classed("disabled")){this.blur();for(let De in r.changeset.tags)De||delete r.changeset.tags[De];r.save()}}),Ft(t).destroyAny(le.selectAll(".save-button")),oe&&le.selectAll(".save-button").call(Ft(t).title(oe).placement("top"));let ie=U.selectAll(".tag-section.raw-tag-editor").data([0]);ie=ie.enter().append("div").attr("class","modal-section tag-section raw-tag-editor").merge(ie),ie.call(l.tags(Object.assign({},r.changeset.tags)).render);let ne=U.selectAll(".commit-changes-section").data([0]);ne=ne.enter().append("div").attr("class","modal-section commit-changes-section").merge(ne),ne.call(u.render);function me(){let De=de.property("checked");M({review_requested:De?"yes":void 0}),ie.call(l.tags(Object.assign({},r.changeset.tags)).render)}}function E(){let k=t.systems.validator.getIssuesBySeverity({what:"edited",where:"all"}).error;return k.length?t.t("commit.outstanding_errors_message",{count:k.length}):(r.changeset?.tags?.comment??"").trim().length?null:t.t("commit.comment_needed_message")}function b(k,F,O){F.hasOwnProperty("comment")&&(F.comment===void 0&&(F.comment=""),O||(i.setItem("comment",F.comment),i.setItem("commentDate",Date.now()))),F.hasOwnProperty("source")&&(F.source===void 0?i.removeItem("source"):O||(i.setItem("source",F.source),i.setItem("commentDate",Date.now()))),M(F,O),o&&o.call(v)}function T(k,F){let O=U();O.length&&i.removeItem("hashtags"),(!O.length||!F)&&(O=O.concat($()));let B=new Set;return O.filter(q=>{let W=q.toLowerCase();return B.has(W)?!1:(B.add(W),!0)});function U(){return(k.comment||"").replace(/http\S*/g,"").match(YN)||[]}function $(){return(k.hashtags||"").split(/[,;\s]+/).map(function(W){W[0]!=="#"&&(W="#"+W);let Z=W.match(YN);return Z&&Z[0]}).filter(Boolean)||[]}}function A(k){let F=k.review_requested;return F===void 0?!1:(F=F.trim().toLowerCase(),!(F===""||F==="no"))}function M(k,F){let O=Object.assign({},r.changeset.tags);if(Object.keys(k).forEach(function(B){let U=k[B];B=t.cleanTagKey(B),qN.indexOf(B)===-1&&(U===void 0?delete O[B]:F?O[B]=U:O[B]=t.cleanTagValue(U))}),!F){let B=k.hasOwnProperty("comment")&&k.comment!=="",U=T(O,B);U.length?(O.hashtags=t.cleanTagValue(U.join(";")),i.setItem("hashtags",O.hashtags)):(delete O.hashtags,i.removeItem("hashtags"))}if(n&&n.changesets_count!==void 0){let B=parseInt(n.changesets_count,10)+1;if(O.changesets_count=String(B),B<=100){let U;U=i.getItem("walkthrough_completed"),U&&(O["ideditor:walkthrough_completed"]=U),U=i.getItem("walkthrough_progress"),U&&(O["ideditor:walkthrough_progress"]=U),U=i.getItem("walkthrough_started"),U&&(O["ideditor:walkthrough_started"]=U)}}else delete O.changesets_count;(0,ZN.default)(r.changeset.tags,O)||(r.changeset=r.changeset.update({tags:O}))}return $t(m,s,"on")}function _h(t,e){let i=ws(e);i.select(".modal").classed("modal-alert",!0);let r=i.select(".content");r.append("div").attr("class","modal-section header"),r.append("div").attr("class","modal-section message-text");let s=r.append("div").attr("class","modal-section buttons cf");return i.okButton=function(){return s.append("button").attr("class","button ok-button action").on("click.confirm",()=>i.remove()).text(t.t("confirm.okay")).node().focus(),i},i}function y_(t){var e=Mt("cancel","save"),i=zi("conflicts"),r,s,n;function o(){ye(document).call(i.on("\u238B",u,!0))}function a(){ye(document).call(i.unbind)}function l(){a(),e.call("save")}function u(){a(),e.call("cancel")}function d(E){o();var b=E.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");b.append("button").attr("class","fr").on("click",u).call(Ye("#rapid-icon-close")),b.append("h3").html(t.tHtml("save.conflict.header"));var T=E.selectAll(".body").data([0]).enter().append("div").attr("class","body fillL"),A=T.append("div").attr("class","conflicts-help").html(t.tHtml("save.conflict.help")),M=Os(),k=new Jo;delete k.id;var F=Kc.stringify(k.osmChangeJXON(r)),O=new Blob([F],{type:"text/xml;charset=utf-8;"}),B="changes.osc",U=A.selectAll(".download-changes").append("a").attr("class","download-changes");M.download?U.attr("href",window.URL.createObjectURL(O)).attr("download",B):U.attr("target","_blank").on("click.download",function(){navigator.msSaveBlob(O,B)}),U.call(Ye("#rapid-icon-load","inline")).append("span").html(t.tHtml("save.conflict.download_changes")),T.append("div").attr("class","conflict-container fillL3").call(m,0),T.append("div").attr("class","conflicts-done").attr("opacity",0).style("display","none").html(t.tHtml("save.conflict.done"));var $=T.append("div").attr("class","buttons col12 joined conflicts-buttons");$.append("button").attr("disabled",s.length>1).attr("class","action conflicts-button col6").html(t.tHtml("save.title")).on("click.try_again",l),$.append("button").attr("class","secondary-action conflicts-button col6").html(t.tHtml("confirm.cancel")).on("click.cancel",u)}function m(E,b){b=F2(b,s.length),n=b;var T=ye(E.node().parentNode);b===s.length-1&&window.setTimeout(function(){T.select(".conflicts-button").attr("disabled",null),T.select(".conflicts-done").transition().attr("opacity",1).style("display","block")},250);var A=E.selectAll(".conflict").data([s[b]]);A.exit().remove();var M=A.enter().append("div").attr("class","conflict");M.append("h4").attr("class","conflict-count").html(t.tHtml("save.conflict.count",{num:b+1,total:s.length})),M.append("a").attr("class","conflict-description").attr("href","#").html(function(F){return F.name}).on("click",function(F,O){F.preventDefault(),v(O.id)});var k=M.append("div").attr("class","conflict-detail-container");k.append("ul").attr("class","conflict-detail-list").selectAll("li").data(function(F){return F.details||[]}).enter().append("li").attr("class","conflict-detail-item").html(function(F){return F}),k.append("div").attr("class","conflict-choices").call(g),k.append("div").attr("class","conflict-nav-buttons joined cf").selectAll("button").data(["previous","next"]).enter().append("button").html(function(F){return t.tHtml("save.conflict."+F)}).attr("class","conflict-nav-button action col6").attr("disabled",function(F,O){return O===0&&b===0||O===1&&b===s.length-1||null}).on("click",function(F,O){F.preventDefault();var B=T.selectAll(".conflict-container"),U=O==="previous"?-1:1;B.selectAll(".conflict").remove(),B.call(m,b+U)})}function g(E){var b=E.append("ul").attr("class","layer-list").selectAll("li").data(function(M){return M.choices||[]}),T=b.enter().append("li").attr("class","layer"),A=T.append("label");A.append("input").attr("type","radio").attr("name",function(M){return M.id}).on("change",function(M,k){var F=this.parentNode.parentNode.parentNode;F.__data__.chosen=k.id,_(M,F,k)}),A.append("span").html(function(M){return M.text}),T.merge(b).each(function(M){var k=this.parentNode;k.__data__.chosen===M.id&&_(null,k,M)})}function _(E,b,T){E&&E.preventDefault(),ye(b).selectAll("li").classed("active",function(k){return k===T}).selectAll("input").property("checked",function(k){return k===T});var A=new mt,M;M=t.graph().hasEntity(T.id),M&&(A=A.extend(M.extent(t.graph()))),T.action(),M=t.graph().hasEntity(T.id),M&&(A=A.extend(M.extent(t.graph()))),v(T.id,A)}function v(E,b){t.surface().selectAll(".hover").classed("hover",!1);var T=t.graph().hasEntity(E);T&&(b?t.systems.map.trimmedExtent(b):t.systems.map.fitEntitiesEase(T),t.surface().selectAll(Jh([T.id],t.graph())).classed("hover",!0))}return d.conflictList=function(E){return arguments.length?(s=E,d):s},d.origChanges=function(E){return arguments.length?(r=E,d):r},d.shownEntityIds=function(){return s&&typeof n=="number"?[s[n].id]:[]},$t(d,e,"on")}function __(t){var e=t.services.osm,i=Ur(function(){o()},1e3),r=4,s=!1,n=ye(null);function o(){if(!e)return;let a={};t.systems.edits.intersects(t.systems.map.extent()).forEach(function(v){v&&v.user&&(a[v.user]=!0)});let u=Object.keys(a),d=u.slice(0,u.length>r?r-1:r);n.html("").call(Ye("#rapid-icon-nearby","pre-text light"));var m=ye(document.createElement("span"));if(m.selectAll().data(d).enter().append("a").attr("class","user-link").attr("href",function(v){return e.userURL(v)}).attr("target","_blank").html(String),u.length>r){var g=ye(document.createElement("span")),_=u.length-r+1;g.append("a").attr("target","_blank").attr("href",function(){return e.changesetsURL(t.systems.map.center(),t.systems.map.zoom())}).html(_),n.append("span").html(t.tHtml("contributors.truncated_list",{n:_,users:m.html(),count:g.html()}))}else n.append("span").html(t.tHtml("contributors.list",{users:m.html()}));u.length?s&&n.transition().style("opacity",1):(s=!0,n.transition().style("opacity",0))}return function(a){e&&(n=a,o(),e.on("loaded.contributors",i),t.systems.map.on("draw",i))}}function x_(t){let e;function i(r){let s=r.selectAll(".data-header").data(e?[e]:[],a=>a.__featurehash__);s.exit().remove();let n=s.enter().append("div").attr("class","data-header");n.append("div").attr("class","data-header-icon").append("div").attr("class","preset-icon-28").call(Ye("#rapid-icon-data")),n.append("div").attr("class","data-header-label").html(t.tHtml("map_data.layers.custom.title"))}return i.datum=function(r){return arguments.length?(e=r,this):e},i}function H4(t){let e=x_(t),i=yh(t,"custom-data-tag-editor").readOnlyTags([/./]),r;function s(n){let a=n.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");a.append("button").attr("class","close").on("click",()=>t.enter("browse")).call(Ye("#rapid-icon-close")),a.append("h3").html(t.tHtml("map_data.title"));let l=n.selectAll(".body").data([0]);l=l.enter().append("div").attr("class","body").merge(l);let u=l.selectAll(".data-editor").data([0]);u.enter().append("div").attr("class","modal-section data-editor").merge(u).call(e.datum(r));let d=l.selectAll(".data-tag-editor").data([0]);d.enter().append("div").attr("class","data-tag-editor").merge(d).call(i.tags(r&&r.properties||{}).state("hover").render).selectAll("textarea.tag-text").attr("readonly",!0).classed("readonly",!0)}return s.datum=function(n){return arguments.length?(r=n,this):r},s}var V4=class{constructor(e){this.context=e,this.parent=ye(null),this.spritesheetIDs=["rapid","maki","temaki","fa","roentgen","community","mapillary-object","mapillary"],this.render=this.render.bind(this),this._spritesheetLoaded=this._spritesheetLoaded.bind(this)}render(e){let i=this.context;this.parent=e;let r=e.selectAll("defs").data([0]),s=r.enter().append("defs");r.merge(s).selectAll(".spritesheet").data(this.spritesheetIDs,n=>n).enter().append("g").attr("class",n=>`spritesheet spritesheet-${n}`).each((n,o,a)=>{let l=ye(a[o]),u=i.asset(`img/${n}-sprite.svg`);fetch(u).then(Ai).then(d=>l.call(this._spritesheetLoaded,n,d)).catch(d=>console.error(d))})}_spritesheetLoaded(e,i,r){let s=e.node(),n=r.documentElement;n.setAttribute("id",i),s.appendChild(n),["maki","temaki","fa","roentgen","community"].includes(i)&&e.selectAll("path").attr("fill","currentColor");let o=this.context.systems.map.renderer?.textures;if(!o)throw new Error(`TextureManager not ready to pack icons for ${i}`);e.selectAll("symbol").each((a,l,u)=>{let d=u[l],m=d.getAttribute("id"),g=d.getAttribute("viewBox"),_=32,E=`<svg xmlns="http://www.w3.org/2000/svg" height="${_}" width="${_}" color="#fff" viewBox="${g}">${d.innerHTML}</svg>`;o.addSvgIcon(m,E)})}};function v_(t){let e=Mt("toggled"),i=85,r=45,s=35,n=10,o=4,a=210,l=ye(null),u=[],d=[0,0],m=0,g="",_=!1,v,E,b=[],T=function(M){g===void 0&&(g="rightclick");let k=g.includes("touch")||g.includes("pen"),F=u.filter(Q=>!k||!Q.mouseOnly);if(!F.length)return;b=[],_=k;let O=!0,B=O?32:34;O?E=52+Math.min(120,6*Math.max.apply(Math,F.map(function(Q){return Q.title.length}))):E=44,v=o*2+F.length*B,m=t.projection.scale(),l=M.append("div").attr("class","edit-menu").classed("touch-menu",k).style("padding",o+"px 0");let U=l.selectAll(".edit-menu-item").data(F),$=U.enter().append("button").attr("class",Q=>`edit-menu-item edit-menu-item-${Q.id}`).style("height",`${B}px`).on("click",Z).on("pointerup",W).on("pointerdown mousedown",function(Q){Q.stopPropagation()}).on("mouseenter.highlight",function(Q,X){!X.relatedEntityIds||ye(this).classed("disabled")||Yi(X.relatedEntityIds(),!0,t)}).on("mouseleave.highlight",function(Q,X){X.relatedEntityIds&&Yi(X.relatedEntityIds(),!1,t)});$.each((Q,X,ce)=>{let de=Ft(t).heading(Q.title).title(Q.tooltip()).keys([Q.keys[0]]);b.push(de),ye(ce[X]).call(de).append("div").attr("class","icon-wrap").call(Ye(`#rapid-operation-${Q.id}`,"operation"))}),O&&$.append("span").attr("class","label").html(Q=>Q.title),$.merge(U).classed("disabled",Q=>Q.disabled()),A(),t.systems.map.on("move",A);let q;function W(Q){q=Q.pointerType}function Z(Q,X){Q.stopPropagation(),X.relatedEntityIds&&Yi(X.relatedEntityIds(),!1,t),X.disabled()?(q==="touch"||q==="pen")&&t.systems.ui.flash.duration(4e3).iconName(`#rapid-operation-${X.id}`).iconClass("operation disabled").label(X.tooltip)():((q==="touch"||q==="pen")&&t.systems.ui.flash.duration(2e3).iconName(`#rapid-operation-${X.id}`).iconClass("operation").label(X.annotation()||X.title)(),X(),T.close()),q=null}e.call("toggled",this,!0)};function A(){if(!l||l.empty())return;if(m!==t.projection.scale()){T.close();return}let M=t.projection.project(d),k=t.surfaceRect();if(M[0]<0||M[0]>k.width||M[1]<0||M[1]>k.height){T.close();return}let F=q(k),O=[0,0];O[0]=F?-1*(n+E):n,_?M[1]-v<i?O[1]=-M[1]+i:O[1]=-v:M[1]+v>k.height-r?O[1]=-M[1]-v+k.height-r:O[1]=0;let[B,U]=Sr(M,O);l.style("left",`${B}px`).style("top",`${U}px`);let $=W(k,F);b.forEach(Z=>Z.placement($));function q(Z){return t.systems.l10n.isRTL()?!(M[0]-n-E<s):M[0]+n+E>Z.width-s}function W(Z,Q){return t.systems.l10n.isRTL()?!Q||M[0]-n-E-a<s?"right":"left":Q||M[0]+n+E+a>Z.width-s?"left":"right"}}return T.close=function(){t.systems.map.off("move",A),l.remove(),b=[],e.call("toggled",this,!1)},T.anchorLoc=function(M){return arguments.length?(d=M,T):d},T.triggerType=function(M){return arguments.length?(g=M,T):g},T.operations=function(M){return arguments.length?(u=M,T):u},$t(T,e,"on")}var wS=Xi($2(),1);function b_(t){let e=t.systems.validator,i=t.systems.storage,s=(i.getItem("entity-issues.reference.expanded")||"true")==="true",n=[],o=[],a,l=Ji(t,"entity-issues").shouldDisplay(()=>o.length).label(()=>t.t("inspector.title_count",{title:t.tHtml("issues.list_title"),count:o.length})).disclosureContent(m);function u(){o=e.getSharedEntityIssues(n,{includeDisabledRules:!0})}function d(v){a=v,l.selection().selectAll(".issue-container").classed("active",E=>E.id===a)}function m(v){v.classed("grouped-items-area",!0),a=o.length?o[0].id:null;let E=v.selectAll(".issue-container").data(o,$=>$.key);E.exit().remove();let b=E.enter().append("div").attr("class","issue-container"),T=b.append("div").attr("class",$=>`issue severity-${$.severity}`).on("mouseover.highlight",function($,q){let W=q.entityIds.filter(Z=>!n.includes(Z));Yi(W,!0,t)}).on("mouseout.highlight",function($,q){let W=q.entityIds.filter(Z=>!n.includes(Z));Yi(W,!1,t)}),A=T.append("div").attr("class","issue-label"),M=A.append("button").attr("class","issue-text").on("click",function($,q){d(q.id);let W=q.extent(t.graph());if(W){let Z=Math.max(t.systems.map.zoom(),19);t.systems.map.centerZoomEase(W.center(),Z)}});M.each(($,q,W)=>{let Z=$.severity==="warning"?"alert":"error";ye(W[q]).call(Ye(`#rapid-icon-${Z}`,"issue-icon"))}),M.append("span").attr("class","issue-message"),A.append("button").attr("class","issue-info-button").attr("title",t.t("icons.information")).call(Ye("#rapid-icon-inspect")).on("click",function($){$.stopPropagation(),$.preventDefault(),this.blur();let W=ye(this.parentNode.parentNode.parentNode).selectAll(".issue-info"),Z=W.classed("expanded");s=!Z,i.setItem("entity-issues.reference.expanded",s),Z?W.transition().duration(200).style("max-height","0px").style("opacity","0").on("end",()=>W.classed("expanded",!1)):W.classed("expanded",!0).transition().duration(200).style("max-height","200px").style("opacity","1").on("end",()=>W.style("max-height",null))}),T.append("ul").attr("class","issue-fix-list"),b.append("div").attr("class","issue-info"+(s?" expanded":"")).style("max-height",s?null:"0").style("opacity",s?"1":"0").each(($,q,W)=>{let Z=ye(W[q]);typeof $.reference=="function"?Z.call($.reference):Z.html(t.tHtml("inspector.no_documentation_key"))}),E=E.merge(b).classed("active",$=>$.id===a),E.selectAll(".issue-message").html($=>$.message(t));let O=E.selectAll(".issue-fix-list").selectAll(".issue-fix-item").data($=>$.fixes?$.fixes():[],$=>$.id);O.exit().remove();let B=O.enter().append("li").attr("class","issue-fix-item"),U=B.append("button").on("click",function($,q){ye(this).attr("disabled")||!q.onClick||q.issue.dateLastRanFix&&new Date-q.issue.dateLastRanFix<1e3||(q.issue.dateLastRanFix=new Date,Yi(q.issue.entityIds.concat(q.entityIds),!1,t),new Promise(function(W,Z){q.onClick(t,W,Z),q.onClick.length<=1&&W()}).then(()=>e.validate()))}).on("mouseover.highlight",function($,q){Yi(q.issue.entityIds,!0,t)}).on("mouseout.highlight",function($,q){Yi(q.issue.entityIds,!1,t)});U.each(($,q,W)=>{let Z=$.icon??"rapid-icon-wrench";ye(W[q]).call(Ye(`#${Z}`,"fix-icon"))}),U.append("span").attr("class","fix-message").html($=>$.title),B.merge(O).selectAll("button").classed("actionable",$=>typeof $.onClick=="function").attr("disabled",$=>typeof $.onClick=="function"?null:"true").attr("title",$=>$.disabledReason??null)}let g=()=>{u(),l.reRender()},_=v=>{d(v.id)};return e.on("validated",g),e.on("focusedIssue",_),l.entityIDs=function(v){return v===void 0?n:((!n||!v||!Gn(n,v))&&(n=v,a=null,u()),l)},l}function u0(t){let e,i;function r(v,E){return v.icon?v.icon:E==="line"?"rapid-other-line":E==="vertex"?v.isFallback()?"":"temaki-vertex":"maki-marker-stroked"}function s(v,E){let T=new fi(E.fill.color).toHex(),A=E.fill.alpha,M="M9.5,7.5 L25.5,7.5 L28.5,12.5 L49.5,12.5 C51.709139,12.5 53.5,14.290861 53.5,16.5 L53.5,43.5 C53.5,45.709139 51.709139,47.5 49.5,47.5 L10.5,47.5 C8.290861,47.5 6.5,45.709139 6.5,43.5 L6.5,12.5 L9.5,7.5 Z";v.append("svg").attr("class","preset-icon-category-border").attr("width","60px").attr("height","60px").attr("viewBox","0 0 60 60").append("path").attr("fill",T).attr("fill-opacity",A).attr("stroke",T).attr("d",M)}function n(v){let b="M 0,0 C -2,-2 -8,-10 -8,-15 C -8,-19 -4,-23 0,-23 C 4,-23 8,-19 8,-15 C 8,-10 2,-2 0,0 Z";v.append("svg").attr("class","preset-icon-point-border").attr("width","60px").attr("height","60px").attr("viewBox","-10 -27 20 30").append("path").attr("d",b)}function o(v){v.append("svg").attr("class","preset-icon-vertex-border").attr("width","60px").attr("height","60px").attr("viewBox","0 0 60 60").append("circle").attr("cx",30).attr("cy",30).attr("r",40/2)}function a(v,E){let F=new fi(E.fill.color).toHex(),O=E.fill.alpha,B=v.append("svg").attr("class","preset-icon-area-border").attr("width","60px").attr("height","60px").attr("viewBox","0 0 60 60");B.append("path").attr("fill",F).attr("fill-opacity",O).attr("stroke",F).attr("d","M10 10 L10 50 L50 50 L50 10 Z");let U=2.5;[[10,10],[10,50],[50,50],[50,10]].forEach(([q,W])=>{B.append("circle").attr("class","vertex").attr("cx",q).attr("cy",W).attr("r",U)});let $=1.25;[[10,30],[50,30],[30,10],[30,50]].forEach(([q,W])=>{B.append("circle").attr("class","midpoint").attr("cx",q).attr("cy",W).attr("r",$)})}function l(v,E){let T=Math.round(43.199999999999996),A=Math.round(60*.6),M=(60-A)/2,k=M+A,F=new fi(E.casing.color).toHex(),O=new fi(E.stroke.color).toHex(),B=E.stroke.dash,U=Array.isArray(B),$=v.append("svg").attr("class","preset-icon-line").attr("width","60px").attr("height","60px").attr("viewBox","0 0 60 60");$.append("path").attr("class","casing").attr("stroke",F).attr("stroke-opacity",U?1:.5).attr("d",`M${M} ${T} L${k} ${T}`),$.append("path").attr("class","stroke").attr("stroke",O).attr("stroke-dasharray",U?B.map(W=>W*.75).join(" "):null).attr("d",`M${M} ${T} L${k} ${T}`);let q=3;[[M-1,T],[k+1,T]].forEach(([W,Z])=>{$.append("circle").attr("class","vertex").attr("cx",W).attr("cy",Z).attr("r",q)})}function u(v){v.append("div").attr("class","preset-icon-route").call(Ye("#rapid-route","rapid-icon lowered"))}function d(v,E,b,T){v.append("div").attr("class","preset-icon").call(Ye(`#${E}`,b.join(" "))),v.selectAll(".preset-icon svg.icon").attr("color",T)}function m(v,E){v.selectAll("img.image-icon").data([E]).enter().append("img").attr("class","image-icon").attr("src",E).on("load",()=>v.classed("showing-img",!0)).on("error",()=>v.classed("showing-img",!1))}function g(v){let E=v.selectAll(".preset-icon-container").data([0]);E=E.enter().append("div").attr("class","preset-icon-container").merge(E).html("");let b=e,T=i;if(!b||!T)return;let A=typeof b.setTags=="function",M=!A,k=A?b.setTags({},T):{};for(let X in k)k[X]==="*"&&(k[X]="yes");T==="relation"&&(k.type==="route"||k.type==="waterway")&&(T="route");let B=(t.systems.storage.getItem("preferences.privacy.thirdpartyicons")??"true")==="true"&&b.imageURL,U=r(b,T),$=A&&T==="vertex",q=A&&T==="line",W=A&&T==="area",Z=A&&T==="route"&&b.id!=="type/route",Q=gh(k);if(E.classed("showing-img",!!B),M&&s(E,Q),$&&o(E),W&&a(E,Q),q&&l(E,Q),Z&&u(E),U){let X=q||Z,ce=M||q||Z,de=/^rapid-/.test(U),le=[];de&&le.push("rapid-icon"),ce&&le.push("shrunk"),X&&le.push("raised");let te="#333";(q||Z)&&de&&(te=new fi(Q.stroke.color).toHex()),d(E,U,le,te)}B&&m(E,B)}_.preset=function(v){return arguments.length?(e=v,_):e},_.geometry=function(v){return arguments.length?(i=v,_):i};function _(v){v.call(g)}return _}function w_(t){let e=Mt("choose"),i=[],r=[],s,n=Ji(t,"feature-type").label(t.tHtml("inspector.feature_type")).disclosureContent(o);function o(l){l.classed("preset-list-item",!0),l.classed("mixed-types",r.length>1);let u=l.selectAll(".preset-list-button-wrap").data([0]).enter().append("div").attr("class","preset-list-button-wrap"),d=u.append("button").attr("class","preset-list-button preset-reset").call(Ft(t).title(t.tHtml("inspector.back_tooltip")).placement("bottom"));d.append("div").attr("class","preset-icon-container"),d.append("div").attr("class","label").append("div").attr("class","label-inner"),u.append("div").attr("class","accessory-buttons");let m=l.selectAll(".tag-reference-body-wrap").data([0]);m=m.enter().append("div").attr("class","tag-reference-body-wrap").merge(m),s&&(l.selectAll(".preset-list-button-wrap .accessory-buttons").style("display",r.length===1?null:"none").call(s.button),m.style("display",r.length===1?null:"none").call(s.body)),l.selectAll(".preset-reset").on("click",function(){e.call("choose",this,r)}).on("pointerdown pointerup mousedown mouseup",function(b){b.preventDefault(),b.stopPropagation()});let g=a();l.select(".preset-list-item button").call(u0(t).geometry(r.length===1?g.length===1&&g[0]:null).preset(r.length===1?r[0]:t.systems.presets.item("point")));let _=r.length===1?[r[0].nameLabel(),r[0].subtitleLabel()].filter(Boolean):[t.t("inspector.multiple_types")],E=l.select(".label-inner").selectAll(".namepart").data(_,b=>b);E.exit().remove(),E.enter().append("div").attr("class","namepart").html(b=>b)}n.entityIDs=function(l){return arguments.length?(i=l,n):i},n.presets=function(l){return arguments.length?(Gn(l,r)||(r=l,r.length===1&&(s=Qc(t,r[0].reference()).showing(!1))),n):r};function a(){let l={};for(let u of i){let d=t.graph().geometry(u);l[d]||(l[d]=0),l[d]+=1}return Object.keys(l).sort((u,d)=>l[d]-l[u])}return $t(n,e,"on")}function E_(t){let e=Ji(t,"preset-fields").label(t.tHtml("inspector.fields")).disclosureContent(u),i=Mt("change","revert"),r=G4(t),s,n,o=[],a,l;function u(d){if(!n){let m=t.graph(),g=t.systems.presets,_=Object.keys(l.reduce((O,B)=>(O[m.entity(B).geometry(m)]=!0,O),{})),v=[],E=[],b;for(let O of o){let B=O.fields(),U=O.moreFields();v=ss(v,B),E=ss(E,U),b?b=b.filter($=>B.includes($)||U.includes($)):b=ss(B,U)}let T=v.filter(O=>b.includes(O)),A=E.filter(O=>b.includes(O));n=[];for(let O of T)O.matchAllGeometry(_)&&n.push(new Ca(t,O,l));let M=t.systems.l10n.localeCode(),k=ss(A,g.universal());k.sort((O,B)=>O.label().localeCompare(B.label(),M));for(let O of k)!T.includes(O)&&O.matchAllGeometry(_)&&n.push(new Ca(t,O,l,{show:!1}));let F=l.slice();for(let O of n)O.on("change",(B,U)=>{i.call("change",O,F,B,U)}),O.on("revert",B=>{i.call("revert",O,B)})}for(let m of n)m.state(s).tags(a);d.call(r.fieldsArr(n).state(s).klass("grouped-items-area")),d.selectAll(".wrap-form-field input").on("keydown",function(m){m.keyCode===13&&t.container().select(".combobox").empty()&&t.enter("browse")})}return e.presets=function(d){return arguments.length?((!o||!d||!Gn(o,d))&&(o=d,n=null),e):o},e.state=function(d){return arguments.length?(s=d,e):s},e.tags=function(d){return arguments.length?(a=d,e):a},e.entityIDs=function(d){return arguments.length?((!d||!l||!Gn(l,d))&&(l=d,n=null),e):l},$t(e,i,"on")}var vS=1e3;function T_(t){let e=t.systems.l10n;var i=Ji(t,"raw-member-editor").shouldDisplay(function(){if(!s||s.length!==1)return!1;var m=t.hasEntity(s[0]);return m&&m.type==="relation"}).label(function(){var m=t.hasEntity(s[0]);if(!m)return"";var g=m.members.length>vS?">":"",_=g+m.members.slice(0,vS).length;return e.t("inspector.title_count",{title:e.tHtml("inspector.members"),count:_})}).disclosureContent(d),r=t.services.taginfo,s;function n(m,g){m.preventDefault(),ye(this.parentNode).classed("tag-reference-loading",!0),t.loadEntity(g.id,function(){i.reRender()})}function o(m,g){m.preventDefault();var _=t.entity(g.id);t.systems.map.fitEntitiesEase(_),Yi([g.id],!0,t)}function a(m,g){m.preventDefault(),Yi([g.id],!1,t);var _=t.entity(g.id),v=t.systems.map.extent();_.intersects(v,t.graph())||t.systems.map.fitEntitiesEase(_),t.enter("select-osm",{selectedIDs:[g.id]})}function l(m,g){var _=g.role,v=t.cleanRelationRole(ye(this).property("value"));if(_!==v){var E={id:g.id,type:g.type,role:v};t.perform(ih(g.relation.id,E,g.index),e.t("operations.change_role.annotation",{n:1})),t.systems.validator.validate()}}function u(m,g){Yi([g.id],!1,t),t.perform(rh(g.relation.id,g.index),e.t("operations.delete_member.annotation",{n:1})),t.hasEntity(g.relation.id)?t.systems.validator.validate():t.enter("browse")}function d(m){var g=s[0],_=[],v=t.entity(g);v.members.slice(0,vS).forEach(function(B,U){_.push({index:U,id:B.id,type:B.type,role:B.role,relation:v,member:t.hasEntity(B.id),uid:fl(g+"-member-"+U)})});var E=m.selectAll(".member-list").data([0]);E=E.enter().append("ul").attr("class","member-list").merge(E);var b=E.selectAll("li").data(_,function(B){return Dt.key(B.relation)+","+B.index+","+(B.member?Dt.key(B.member):"incomplete")});b.exit().each(O).remove();var T=b.enter().append("li").attr("class","member-row form-field").classed("member-incomplete",function(B){return!B.member});T.each(function(B){var U=ye(this),$=U.append("label").attr("class","field-label").attr("for",B.uid);if(B.member){U.on("mouseover",function(){Yi([B.id],!0,t)}).on("mouseout",function(){Yi([B.id],!1,t)});var q=$.append("span").attr("class","label-text").append("a").attr("href","#").on("click",a);q.append("span").attr("class","member-entity-type").html(function(Z){var Q=t.systems.presets.match(Z.member,t.graph());return Q&&Q.name()||e.displayType(Z.member.id)}),q.append("span").attr("class","member-entity-name").html(Z=>Z.member?e.displayName(Z.member.tags):""),$.append("button").attr("title",e.t("icons.remove")).attr("class","remove member-delete").call(Ye("#rapid-operation-delete")),$.append("button").attr("class","member-zoom").attr("title",e.t("icons.zoom_to")).call(Ye("#rapid-icon-framed-dot","monochrome")).on("click",o)}else{var W=$.append("span").attr("class","label-text");W.append("span").attr("class","member-entity-type").html(e.tHtml("inspector."+B.type,{id:B.id})),W.append("span").attr("class","member-entity-name").html(e.tHtml("inspector.incomplete",{id:B.id})),$.append("button").attr("class","member-download").attr("title",e.t("icons.download")).call(Ye("#rapid-icon-load")).on("click",n)}});var A=T.append("div").attr("class","form-field-input-wrap form-field-input-member");A.append("input").attr("class","member-role").attr("id",B=>B.uid).property("type","text").attr("placeholder",e.t("inspector.role")).call(ki),r&&A.each(F),b=b.merge(T).order(),b.select("input.member-role").property("value",B=>B.role).on("blur",l).on("change",l),b.select("button.member-delete").on("click",u);var M,k;b.call(P3().on("start",function(B){M={x:B.x,y:B.y},k=null}).on("drag",function(B){var U=B.x-M.x,$=B.y-M.y;if(!(!ye(this).classed("dragging")&&Math.sqrt(Math.pow(U,2)+Math.pow($,2))<=5)){var q=b.nodes().indexOf(this);ye(this).classed("dragging",!0),k=null,m.selectAll("li.member-row").style("transform",function(W,Z){var Q=ye(this).node();return q===Z?"translate("+U+"px, "+$+"px)":Z>q&&B.y>Q.offsetTop?((k===null||Z>k)&&(k=Z),"translateY(-100%)"):Z<q&&B.y<Q.offsetTop+Q.offsetHeight?((k===null||Z<k)&&(k=Z),"translateY(100%)"):null})}}).on("end",function(B,U){if(ye(this).classed("dragging")){var $=b.nodes().indexOf(this);ye(this).classed("dragging",!1),m.selectAll("li.member-row").style("transform",null),k!==null&&(t.perform(Mg(U.relation.id,$,k),e.t("operations.reorder_members.annotation")),t.systems.validator.validate())}}));function F(B){var U=ye(this),$=U.selectAll("input.member-role"),q=$.property("value");function W(Z,Q){for(var X=[],ce=[],de=0;de<Q.length;de++)Q[de].value.substring(0,Z.length)===Z?X.push(Q[de]):ce.push(Q[de]);return X.concat(ce)}$.call(gr(t,"member-role").fetcher(function(Z,Q){var X;B.member?X=t.graph().geometry(B.member.id):B.type==="relation"?X="relation":B.type==="way"?X="line":X="point";var ce=v.tags.type;r.roles({debounce:!0,rtype:ce||"",geometry:X,query:Z},function(de,le){de||Q(W(Z,le))})}).on("cancel",function(){$.property("value",q)}))}function O(){var B=ye(this);B.selectAll("input.member-role").call(gr.off,t)}}return i.entityIDs=function(m){return arguments.length?(s=m,i):s},i}function QN(t,e){return function(i){e.sort((s,n)=>n-s);for(var r in e)i=rh(t,e[r])(i);return i}}var bS=1e3;function S_(t){let e=t.systems.l10n;var i=t.systems.presets,r=Ji(t,"raw-membership-editor").shouldDisplay(function(){return a&&a.length}).label(function(){var A=u(),M=A.length>bS?">":"",k=M+A.slice(0,bS).length;return e.t("inspector.title_count",{title:e.tHtml("inspector.relations"),count:k})}).disclosureContent(T),s=t.services.taginfo,n=gr(t,"parent-relation").minItems(1).fetcher(b).itemsMouseEnter(function(A,M){M.relation&&Yi([M.relation.id],!0,t)}).itemsMouseLeave(function(A,M){M.relation&&Yi([M.relation.id],!1,t)}),o=!1,a=[],l;function u(){for(var A=[],M=0;M<a.length;M++){var k=t.graph().hasEntity(a[M]);if(k&&(M===0?A=t.graph().parentRelations(k):A=Yn(A,t.graph().parentRelations(k)),!A.length))break}return A}function d(){var A=[],M=u().slice(0,bS),k=a.length>1,F,O,B,U,$,q;for(F=0;F<M.length;F++){for(O=M[F],B={relation:O,members:[],hash:Dt.key(O)},U=0;U<O.members.length;U++)$=O.members[U],a.indexOf($.id)!==-1&&(q=Object.assign({},$,{index:U}),B.members.push(q),B.hash+=","+U.toString(),k||(A.push(B),B={relation:O,members:[],hash:Dt.key(O)}));B.members.length&&A.push(B)}return A.forEach(function(W){W.uid=fl("membership-"+W.relation.id);var Z=[];W.members.forEach(function(Q){Z.indexOf(Q.role)===-1&&Z.push(Q.role)}),W.role=Z.length===1?Z[0]:Z}),A}function m(A,M){A.preventDefault(),Yi([M.relation.id],!1,t),t.enter("select-osm",{selectedIDs:[M.relation.id]})}function g(A,M){A.preventDefault();var k=t.entity(M.relation.id);t.systems.map.fitEntitiesEase(k),Yi([M.relation.id],!0,t)}function _(A,M){if(M!==0&&!o){var k=t.cleanRelationRole(ye(this).property("value"));if(!(!k.trim()&&typeof M.role!="string")){var F=M.members.filter(function(O){return O.role!==k});F.length&&(o=!0,t.perform(function(B){return F.forEach(function(U){var $=Object.assign({},U,{role:k});delete $.index,B=ih(M.relation.id,$,U.index)(B)}),B},e.t("operations.change_role.annotation",{n:F.length})),t.systems.validator.validate()),o=!1}}}function v(A,M){this.blur(),l=!1;function k(O,B,U){return function($){for(var q in B){var W={id:B[q],type:$.entity(B[q]).type,role:U};$=Bd(O,W)($)}return $}}if(A.relation)t.perform(k(A.relation.id,a,M),e.t("operations.add_member.annotation",{n:a.length})),t.systems.validator.validate();else{var F=Cs();t.perform(Or(F),k(F.id,a,M),e.t("operations.add.annotation.relation")),t.enter("select-osm",{selectedIDs:[F.id],newFeature:!0})}}function E(A,M){if(this.blur(),M!==0){Yi([M.relation.id],!1,t);var k=M.members.map(function(F){return F.index});t.perform(QN(M.relation.id,k),e.t("operations.delete_member.annotation",{n:a.length})),t.systems.validator.validate()}}function b(A,M){var k={relation:null,value:e.t("inspector.new_relation"),display:e.tHtml("inspector.new_relation")},F=a[0],O=[],B=t.graph();function U(W){var Z=i.match(W,B),Q=Z&&Z.name()||e.t("inspector.relation"),X=e.displayName(W.tags)||"";return Q+" "+X}var $=A&&t.hasEntity(A.toLowerCase());if($&&$.type==="relation"&&$.id!==F)O.push({relation:$,value:U($)+" "+$.id});else{t.systems.edits.intersects(t.systems.map.extent()).forEach(function(W){if(!(W.type!=="relation"||W.id===F)){var Z=U(W);A&&(Z+" "+W.id).toLowerCase().indexOf(A.toLowerCase())===-1||O.push({relation:W,value:Z})}}),O.sort(function(W,Z){return Cs.creationOrder(W.relation,Z.relation)});var q=Object.values(ds(O,"value")).filter(function(W){return W.length>1});q.forEach(function(W){W.forEach(function(Z){Z.value+=" "+Z.relation.id})})}O.forEach(function(W){W.title=W.value}),O.unshift(k),M(O)}function T(A){var M=d(),k=A.selectAll(".member-list").data([0]);k=k.enter().append("ul").attr("class","member-list").merge(k);var F=k.selectAll("li.member-row-normal").data(M,function(ie){return ie.hash});F.exit().each(oe).remove();var O=F.enter().append("li").attr("class","member-row member-row-normal form-field");O.on("mouseover",function(ie,ne){Yi([ne.relation.id],!0,t)}).on("mouseout",function(ie,ne){Yi([ne.relation.id],!1,t)});var B=O.append("label").attr("class","field-label").attr("for",function(ie){return ie.uid}),U=B.append("span").attr("class","label-text").append("a").attr("href","#").on("click",m);U.append("span").attr("class","member-entity-type").html(function(ie){var ne=i.match(ie.relation,t.graph());return ne&&ne.name()||e.t("inspector.relation")}),U.append("span").attr("class","member-entity-name").html(function(ie){let ne=i.match(ie.relation,t.graph());return e.displayName(ie.relation.tags,ne.suggestion)}),B.append("button").attr("class","remove member-delete").call(Ye("#rapid-operation-delete")).on("click",E),B.append("button").attr("class","member-zoom").attr("title",e.t("icons.zoom_to")).call(Ye("#rapid-icon-framed-dot","monochrome")).on("click",g);var $=O.append("div").attr("class","form-field-input-wrap form-field-input-member");$.append("input").attr("class","member-role").attr("id",function(ie){return ie.uid}).property("type","text").property("value",function(ie){return typeof ie.role=="string"?ie.role:""}).attr("title",function(ie){return Array.isArray(ie.role)?ie.role.filter(Boolean).join(`
`):ie.role}).attr("placeholder",function(ie){return Array.isArray(ie.role)?e.t("inspector.multiple_roles"):e.t("inspector.role")}).classed("mixed",function(ie){return Array.isArray(ie.role)}).call(ki).on("blur",_).on("change",_),s&&$.each(ee);var q=k.selectAll(".member-row-new").data(l?[0]:[]);q.exit().remove();var W=q.enter().append("li").attr("class","member-row member-row-new form-field"),Z=W.append("label").attr("class","field-label");Z.append("input").attr("placeholder",e.t("inspector.choose_relation")).attr("type","text").attr("class","member-entity-input").call(ki),Z.append("button").attr("class","remove member-delete").call(Ye("#rapid-operation-delete")).on("click",function(){k.selectAll(".member-row-new").remove()});var Q=W.append("div").attr("class","form-field-input-wrap form-field-input-member");Q.append("input").attr("class","member-role").property("type","text").attr("placeholder",e.t("inspector.role")).call(ki),q=q.merge(W),q.selectAll(".member-entity-input").on("blur",te).call(n.on("accept",le).on("cancel",te));var X=A.selectAll(".add-row").data([0]),ce=X.enter().append("div").attr("class","add-row"),de=ce.append("button").attr("class","add-relation");de.call(Ye("#rapid-icon-plus","light")),de.call(Ft(t).title(e.tHtml("inspector.add_to_relation")).placement(e.isRTL()?"left":"right")),ce.append("div").attr("class","space-value"),ce.append("div").attr("class","space-buttons"),X=X.merge(ce),X.select(".add-relation").on("click",function(){l=!0,r.reRender(),k.selectAll(".member-entity-input").node().focus()});function le(ie){if(!ie){te();return}ie.relation&&Yi([ie.relation.id],!1,t);var ne=t.cleanRelationRole(k.selectAll(".member-row-new .member-role").property("value"));v(ie,ne)}function te(){var ie=q.selectAll(".member-entity-input");ie.property("value",""),t.surface().selectAll(".highlighted").classed("highlighted",!1)}function ee(ie){var ne=ye(this),me=ne.selectAll("input.member-role"),De=me.property("value");function He(Je,ot){for(var gt=[],vt=[],ct=0;ct<ot.length;ct++)ot[ct].value.substring(0,Je.length)===Je?gt.push(ot[ct]):vt.push(ot[ct]);return gt.concat(vt)}me.call(gr(t,"member-role").fetcher(function(Je,ot){var gt=ie.relation.tags.type;s.roles({debounce:!0,rtype:gt||"",geometry:t.graph().geometry(a[0]),query:Je},function(vt,ct){vt||ot(He(Je,ct))})}).on("cancel",function(){me.property("value",De)}))}function oe(){var ie=ye(this);ie.selectAll("input.member-role").call(gr.off,t)}}return r.entityIDs=function(A){return arguments.length?(a=A,l=!1,r):a},r}function A_(t){let e=t.systems.l10n,i=[],r=Ji(t,"selected-features").shouldDisplay(s).label(n).disclosureContent(l);r.entityIDs=function(u){return arguments.length?(i=u,r):i};function s(){return i.length>1}function n(){return e.t("inspector.title_count",{title:e.tHtml("inspector.features"),count:i.length})}function o(u,d){t.enter("select-osm",{selectedIDs:[d.id]})}function a(u,d){let m=i.slice(),g=m.indexOf(d.id);g>-1&&(m.splice(g,1),t.enter("select-osm",{selectedIDs:m}))}function l(u){let d=u.selectAll(".feature-list").data([0]);d=d.enter().append("ul").attr("class","feature-list").merge(d);let m=i.map(E=>t.hasEntity(E)).filter(Boolean),g=d.selectAll(".feature-list-item").data(m,Dt.key);g.exit().remove();let _=g.enter().append("li").attr("class","feature-list-item").each((E,b,T)=>{ye(T[b]).on("mouseover",()=>Yi([E.id],!0,t)).on("mouseout",()=>Yi([E.id],!1,t))}),v=_.append("button").attr("class","label").on("click",o);v.append("span").attr("class","entity-geom-icon").call(Ye("","pre-text")),v.append("span").attr("class","entity-type"),v.append("span").attr("class","entity-name"),_.append("button").attr("class","close").attr("title",e.t("icons.deselect")).on("click",a).call(Ye("#rapid-icon-close")),g=g.merge(_),g.selectAll(".entity-geom-icon use").attr("href",(E,b,T)=>"#rapid-icon-"+ye(T[b])._groups[0][0].parentNode.parentNode.__data__.geometry(t.graph())),g.selectAll(".entity-type").html(E=>t.systems.presets.match(E,t.graph()).name()),g.selectAll(".entity-name").html(E=>{let b=t.entity(E.id);return e.displayName(b.tags)})}return t.systems.edits.on("change",u=>{u&&r.reRender()}),r}function C_(t){let e=Mt("choose"),i=[A_(t),w_(t).on("choose",function(T){e.call("choose",this,T)}),b_(t),E_(t).on("change",_).on("revert",v),yh(t,"raw-tag-editor").on("change",_),T_(t),S_(t)],r=null,s="select",n=!1,o=!1,a,l=[],u=[],d;t.systems.edits.on("change",g);function m(T){r=T;let A=b(l,t.graph()),M=t.systems.l10n.isRTL(),k=T.selectAll(".header").data([0]),F=k.enter().append("div").attr("class","header fillL");F.append("button").attr("class","preset-reset preset-choose").call(Ye(M?"#rapid-icon-forward":"#rapid-icon-backward")),F.append("button").attr("class","close").on("click",()=>t.enter("browse")).call(Ye(o?"#rapid-icon-apply":"#rapid-icon-close")),F.append("h3"),k=k.merge(F),k.selectAll("h3").html(l.length===1?t.tHtml("inspector.edit"):t.tHtml("rapid_multiselect")),k.selectAll(".preset-reset").on("click",function(){e.call("choose",this,u)});let O=T.selectAll(".inspector-body").data([0]),B=O.enter().append("div").attr("class","entity-editor inspector-body");O=O.merge(B);for(let U of i)U.entityIDs&&U.entityIDs(l),U.presets&&U.presets(u),U.tags&&U.tags(A),U.state&&U.state(s),O.call(U.render)}m.modified=function(T){return arguments.length?(o=T,m):o},m.state=function(T){return arguments.length?(s=T,m):s},m.entityIDs=function(T){return arguments.length?(a=t.graph(),n=!1,T&&l&&Gn(l,T)?m:(l=T,E(!0),m.modified(!1))):l},m.newFeature=function(T){return arguments.length?(d=T,m):d},m.presets=function(T){return arguments.length?(Gn(T,u)||(u=T),m):u};function g(T){if(!r||r.selectAll(".entity-editor").empty()||s==="hide"||!(!T||T.didChange.properties||T.didChange.addition||T.didChange.deletion)||(l=l.filter(t.hasEntity),!l.length))return;let M=u.length===1&&u[0];E();let k=u.length===1&&u[0],F=t.graph();m.modified(a!==F),r.call(m),M!==k&&t.container().selectAll(".entity-editor button.preset-reset .label").style("background-color","#fff").transition().duration(750).style("background-color",null)}function _(T,A,M){let k=[];for(let F of T){let O=t.hasEntity(F);if(!O)continue;let B=Object.assign({},O.tags);for(let[U,$]of Object.entries(A)){if(!U)continue;let q=O.tags.source;O.__fbid__&&U==="source"&&(q==="digitalglobe"||q==="maxar")||($!==void 0||B.hasOwnProperty(U))&&(B[U]=$)}M||(B=db(B)),(0,wS.default)(O.tags,B)||k.push(Hr(F,B))}if(k.length){let F=B=>{for(let U of k)B=U(B);return B},O=t.t("operations.change_tags.annotation");n?t.overwrite(F,O):(t.perform(F,O),n=!!M)}M||t.systems.validator.validate()}function v(T){let A=[];for(let M of l){let k=t.entity(M),F=Object.assign({},k.tags),O=t.graph().base.entities.get(M),B={};for(let U of T)B[U]=O?.tags[U]??void 0;for(let[U,$]of Object.entries(B))U&&($!==void 0||F.hasOwnProperty(U))&&(F[U]=$);F=db(F),(0,wS.default)(k.tags,F)||A.push(Hr(M,F))}if(A.length){let M=F=>{for(let O of A)F=O(F);return F},k=t.t("operations.change_tags.annotation");n?t.overwrite(M,k):(t.perform(M,k),n=!1)}t.systems.validator.validate()}function E(T){let A=t.systems.presets,M=t.graph(),k={};for(let O of l){let B=M.hasEntity(O);if(!B)return;let U=A.match(B,M);k[U.id]=(k[U.id]||0)+1}let F=Object.keys(k).sort((O,B)=>k[B]-k[O]).map(O=>A.item(O));!T&&u.length===1&&!u[0].isFallback()&&Object.keys(u[0].addTags||{}).length===0&&F.length===1&&F[0].isFallback()||m.presets(F)}function b(T,A){var M={},k={},F=new Set,O=T.map(function(U){return A.hasEntity(U)}).filter(Boolean);O.forEach(function(U){var $=Object.keys(U.tags).filter(Boolean);$.forEach(function(q){F.add(q)})}),O.forEach(function(U){F.forEach(function($){var q=U.tags[$];M.hasOwnProperty($)?Array.isArray(M[$])?M[$].indexOf(q)===-1&&M[$].push(q):M[$]!==q&&(M[$]=[M[$],q]):M[$]=q;var W=$+"="+q;k[W]||(k[W]=0),k[W]+=1})});for(var B in M)Array.isArray(M[B])&&(M[B]=M[B].sort(function(U,$){var q=q,W=k[q+"="+$],Z=k[q+"="+U];return W!==Z?W-Z:$&&U?U.localeCompare($):U?1:-1}));return M}return $t(m,e,"on")}function KN(t){let e=t.systems.filters;function i(r){let s=e.stats(),n=e.hidden(),o=0,a=Array.from(n).map(l=>s[l]?(o+=s[l],t.t("inspector.title_count",{title:t.tHtml(`feature.${l}.description`),count:s[l]})):null).filter(Boolean);if(r.html(""),a.length){let l=Ft(t).placement("top").title(()=>a.join("<br/>"));r.append("a").attr("class","chip").attr("href","#").html(t.tHtml("feature_info.hidden_warning",{count:o})).call(l).on("click",u=>{l.hide(),u.preventDefault(),t.systems.ui.togglePanes(t.container().select(".map-panes .map-data-pane"))})}r.classed("hide",!a.length)}return function(r){i(r),e.on("filterchange",()=>i(r))}}var tO=Xi(eO(),1);function I_(t){let e=t.services.nominatim,i=t.systems.presets,r=t.systems.l10n,s=t.systems.map,n;function o(a){a.append("div").attr("class","header fillL").append("h3").html(r.tHtml("inspector.feature_list"));let u=a.append("div").attr("class","search-header");u.call(Ye("#rapid-icon-search","pre-text"));let d=u.append("input").attr("placeholder",r.t("inspector.search")).attr("type","search").call(ki).on("keypress",E).on("keydown",v).on("input",b),g=a.append("div").attr("class","inspector-body").append("div").attr("class","feature-list");t.on("modechange",T),t.keybinding().on(Ri("\u2318F"),_);function _(U){t.mode?.id==="browse"&&(U.preventDefault(),d.node().focus())}function v(U){U.keyCode===27&&d.node().blur()}function E(U){let $=d.property("value"),q=g.selectAll(".feature-list-item");U.keyCode===13&&$.length&&q.size()&&O(U,q.datum())}function b(){n=void 0,M()}function T(){d.property("value",""),M()}function A(){let U=t.graph(),$=s.centerLoc(),q=d.property("value").toLowerCase(),W=[];if(!q)return W;let Z=tO.pair(q.toUpperCase())||q.match(/^(-?\d+\.?\d*)\s+(-?\d+\.?\d*)$/);if(Z){let te=[parseFloat(Z[0]),parseFloat(Z[1])];W.push({id:-1,geometry:"point",type:r.t("inspector.location"),name:r.dmsCoordinatePair([te[1],te[0]]),location:te})}let Q=!Z&&q.match(/(?:^|\W)(node|way|relation|[nwr])\W?0*([1-9]\d*)(?:\W|$)/i);if(Q){let te=Q[1].charAt(0),ee=Q[2];W.push({id:te+ee,geometry:te==="n"?"point":te==="w"?"line":"relation",type:r.displayType(te),name:ee})}let X=U.base.entities,ce=U.local.entities,de=new Set([...X.keys(),...ce.keys()]),le=[];for(let te of de){if(ce.has(te)&&ce.get(te)===void 0)continue;let ee=U.hasEntity(te);if(!ee)continue;let oe=r.displayName(ee.tags)||"";if(oe.toLowerCase().indexOf(q)<0)continue;let ie=i.match(ee,U),ne=ie&&ie.name()||r.displayType(ee.id),me=ee.extent(U),De=me?fr($,me.center()):0;if(le.push({id:ee.id,entity:ee,geometry:ee.geometry(U),type:ne,name:oe,distance:De}),le.length>100)break}le=le.sort((te,ee)=>te.distance-ee.distance),W=W.concat(le);for(let te of n||[]){if(!te.osm_type||!te.osm_id)continue;let ee=Dt.id.fromOSM(te.osm_type,te.osm_id),oe={};oe[te.class]=te.type;let ie={id:ee,type:te.osm_type,tags:oe};te.osm_type==="way"&&(ie.nodes=["a","a"]);let ne=Dt(ie),me=new vn([ne]),De=i.match(ne,me),He=De&&De.name()||r.displayType(ee);W.push({id:ne.id,geometry:ne.geometry(me),type:He,name:te.display_name,extent:new mt([parseFloat(te.boundingbox[3]),parseFloat(te.boundingbox[0])],[parseFloat(te.boundingbox[2]),parseFloat(te.boundingbox[1])])})}return q.match(/^[0-9]+$/)&&(W.push({id:"n"+q,geometry:"point",type:r.t("inspector.node"),name:q}),W.push({id:"w"+q,geometry:"line",type:r.t("inspector.way"),name:q}),W.push({id:"r"+q,geometry:"relation",type:r.t("inspector.relation"),name:q})),W}function M(){let U=d.property("value"),$=A();g.classed("filtered",U.length),g.selectAll(".no-results-item").data([0]).enter().append("button").property("disabled",!0).attr("class","no-results-item").call(Ye("#rapid-icon-alert","pre-text")).append("span").attr("class","entity-name"),g.selectAll(".no-results-item .entity-name").html(r.tHtml("geocoder.no_results_worldwide")),e&&g.selectAll(".geocode-item").data([0]).enter().append("button").attr("class","geocode-item secondary-action").on("click",B).append("div").attr("class","label").append("span").attr("class","entity-name").html(r.tHtml("geocoder.search")),g.selectAll(".no-results-item").style("display",U.length&&!$.length?"block":"none"),g.selectAll(".geocode-item").style("display",U&&n===void 0?"block":"none"),g.selectAll(".feature-list-item").data([-1]).remove();let W=g.selectAll(".feature-list-item").data($,X=>X.id),Z=W.enter().insert("button",".geocode-item").attr("class","feature-list-item").on("mouseover",k).on("mouseout",F).on("click",O),Q=Z.append("div").attr("class","label");Q.each((X,ce,de)=>{ye(de[ce]).call(Ye(`#rapid-icon-${X.geometry}`,"pre-text"))}),Q.append("span").attr("class","entity-type").html(X=>X.type),Q.append("span").attr("class","entity-name").html(X=>X.name),Z.style("opacity",0).transition().style("opacity",1),W.order(),W.exit().remove()}function k(U,$){!$.id||$.id===-1||Yi([$.id],!0,t)}function F(U,$){!$.id||$.id===-1||Yi([$.id],!1,t)}function O(U,$){U.preventDefault(),$.location?s.centerZoomEase([$.location[1],$.location[0]],19):$.id!==-1&&(Yi([$.id],!1,t),s.selectEntityID($.id,!0))}function B(){e.search(d.property("value"),(U,$)=>{n=$||[],M()})}}return o}function X4(t){var e,i=2e3,r="#rapid-icon-no",s="disabled",n="";function o(){e&&e.stop(),t.container().select(".main-footer-wrap").classed("footer-hide",!0).classed("footer-show",!1),t.container().select(".flash-wrap").classed("footer-hide",!1).classed("footer-show",!0);var a=t.container().select(".flash-wrap").selectAll(".flash-content").data([0]),l=a.enter().append("div").attr("class","flash-content"),u=l.append("svg").attr("class","flash-icon icon").append("g").attr("transform","translate(10,10)");return u.append("circle").attr("r",9),u.append("use").attr("transform","translate(-7,-7)").attr("width","14").attr("height","14"),l.append("div").attr("class","flash-text"),a=a.merge(l),a.selectAll(".flash-icon").attr("class","icon flash-icon "+(s||"")),a.selectAll(".flash-icon use").attr("xlink:href",r),a.selectAll(".flash-text").attr("class","flash-text").html(n),e=Mf(function(){e=null,t.container().select(".main-footer-wrap").classed("footer-hide",!1).classed("footer-show",!0),t.container().select(".flash-wrap").classed("footer-hide",!0).classed("footer-show",!1)},i),a}return o.duration=function(a){return arguments.length?(i=a,o):i},o.label=function(a){return arguments.length?(n=a,o):n},o.iconName=function(a){return arguments.length?(r=a,o):r},o.iconClass=function(a){return arguments.length?(s=a,o):s},o}function k_(t){var e=t.container().node();function i(){if(e.requestFullscreen)return e.requestFullscreen;if(e.msRequestFullscreen)return e.msRequestFullscreen;if(e.mozRequestFullScreen)return e.mozRequestFullScreen;if(e.webkitRequestFullscreen)return e.webkitRequestFullscreen}function r(){if(document.exitFullscreen)return document.exitFullscreen;if(document.msExitFullscreen)return document.msExitFullscreen;if(document.mozCancelFullScreen)return document.mozCancelFullScreen;if(document.webkitExitFullscreen)return document.webkitExitFullscreen}function s(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function n(){return!!i()}function o(a){a.preventDefault(),s()?r().apply(document):i().apply(e)}return function(){if(n()){var a=Os(),l=a.os==="mac"?[Ri("\u2303\u2318F"),"f11"]:["f11"];t.keybinding().on(l,o)}}}var GQ=1e4,$Q=2e3,iO={enableHighAccuracy:!1,timeout:6e3};function M_(t){let e=Vc(t).message(t.tHtml("geolocate.locating")).blocking(!0),i=t.scene().layers.get("map-ui"),r=!1,s,n=ye(null);function o(){t.inIntro||(r?(r=!1,i.geolocationData=null,t.systems.map.deferredRedraw(),u()):(r=!0,n.classed("active",!0),t.enter("browse"),s=window.setTimeout(l,GQ),t.container().call(e),navigator.geolocation.getCurrentPosition(a,l,iO)))}function a(d){if(r){let m=d.coords,g=new mt([m.longitude,m.latitude]).padByMeters(m.accuracy);if(i.geolocationData=d,t.systems.map.deferredRedraw(),s){window.clearTimeout(s),s=void 0;let _=t.systems.map;_.centerZoomEase(g.center(),Math.min(20,_.extentZoom(g)))}window.setTimeout(()=>{navigator.geolocation.getCurrentPosition(a,l,iO)},$Q)}u()}function l(){r&&t.systems.ui.flash.label(t.tHtml("geolocate.location_unavailable")).iconName("#rapid-icon-geolocate")(),r=!1,i.geolocationData=null,t.systems.map.deferredRedraw(),u()}function u(){s&&(window.clearTimeout(s),s=void 0),e.close(),n.classed("active",r)}return function(d){if(!navigator.geolocation||!navigator.geolocation.getCurrentPosition)return;let m=t.systems.l10n.isRTL();n=d.append("button").on("click",o).call(Ye("#rapid-icon-geolocate","light")).call(Ft(t).placement(m?"right":"left").title(t.tHtml("geolocate.title")))}}function P_(t){let e;function i(s){let n=t.services.improveOSM;if(!n)return;let o=s.selectAll(".comments-container").data([0]);o=o.enter().append("div").attr("class","comments-container").merge(o),n.getCommentsAsync(e).then(a=>{if(!a.comments)return;let l=o.selectAll(".comment").data(a.comments).enter().append("div").attr("class","comment");l.append("div").attr("class","comment-avatar").call(Ye("#rapid-icon-avatar","comment-avatar-icon"));let u=l.append("div").attr("class","comment-main"),d=u.append("div").attr("class","comment-metadata");d.append("div").attr("class","comment-author").each(function(m){let g=t.services.osm,_=ye(this);g&&m.username&&(_=_.append("a").attr("class","comment-author-link").attr("href",g.userURL(m.username)).attr("target","_blank")),_.html(v=>v.username)}),d.append("div").attr("class","comment-date").html(m=>t.tHtml("note.status.commented",{when:r(m.timestamp)})),u.append("div").attr("class","comment-text").append("p").html(m=>m.text)}).catch(a=>console.log(a))}function r(s){if(!s)return null;let n={day:"numeric",month:"short",year:"numeric"},o=new Date(s*1e3);if(isNaN(o.getTime()))return null;let a=t.systems.l10n.localeCode();return o.toLocaleDateString(a,n)}return i.issue=function(s){return arguments.length?(e=s,i):e},i}function R_(t){let e=t.systems.filters,i=t.systems.l10n,r=t.systems.map,s=t.systems.presets,n;function o(l){if(l.desc)return l.desc;let u=l.issueKey;return l.replacements=l.replacements||{},l.replacements.default=i.tHtml("inspector.unknown"),i.tHtml(`QA.improveOSM.error_types.${u}.description`,l.replacements)}function a(l){let u=l.selectAll(".error-details").data(n?[n]:[],_=>`${_.id}-${_.status||0}`);u.exit().remove();let m=u.enter().append("div").attr("class","error-details qa-details-container").append("div").attr("class","qa-details-subsection");m.append("h4").html(i.tHtml("QA.keepRight.detail_description")),m.append("div").attr("class","qa-details-description-text").html(o);let g=[];m.selectAll(".error_entity_link, .error_object_link").attr("href","#").each((_,v,E)=>{let b=E[v],T=ye(b),A=T.classed("error_object_link"),M=A?n.objectType.charAt(0)+n.objectId:b.textContent,k=t.hasEntity(M);if(g.push(M),T.on("mouseenter",()=>{Yi([M],!0,t)}).on("mouseleave",()=>{Yi([M],!1,t)}).on("click",F=>{F.preventDefault(),Yi([M],!1,t),r.scene.enableLayers("osm"),r.centerZoom(n.loc,20),r.selectEntityID(M)}),k){let F=i.displayName(k.tags);if(!F&&!A){let O=s.match(k,t.graph());F=O&&!O.isFallback()&&O.name()}F&&(b.innerText=F)}}),e.forceVisible(g),r.immediateRedraw()}return a.issue=function(l){return arguments.length?(n=l,a):n},a}function D_(t){let e;function i(s){let n=s.issueKey;return s.replacements=s.replacements||{},s.replacements.default=t.tHtml("inspector.unknown"),t.tHtml(`QA.improveOSM.error_types.${n}.title`,s.replacements)}function r(s){let n=16777215,o=t.services.improveOSM;o&&(n=o.getColor(e?.itemType));let a=s.selectAll(".qa-header").data(e?[e]:[],d=>`${d.id}-${d.status||0}`);a.exit().remove();let l=a.enter().append("div").attr("class","qa-header"),u=l.append("div").attr("class","qa-header-icon").append("svg").attr("width","20px").attr("height","27px").attr("viewbox","0 0 20 27").attr("class",d=>`qaItem ${d.service}`);u.append("polygon").attr("fill",new fi(n).toHex()).attr("stroke","#333").attr("points","16,3 4,3 1,6 1,17 4,20 7,20 10,27 13,20 16,20 19,17.033 19,6"),u.append("use").attr("class","icon-annotation").attr("width","13px").attr("height","13px").attr("transform","translate(3.5, 5)").attr("xlink:href",d=>d.icon?`#${d.icon}`:""),l.append("div").attr("class","qa-header-label").html(i)}return r.issue=function(s){return arguments.length?(e=s,r):e},r}function W4(t){let e=t.services.improveOSM,i=Mt("change"),r=R_(t),s=P_(t),n=D_(t),o;function a(d){let m=d.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");m.append("button").attr("class","close").on("click",()=>t.enter("browse")).call(Ye("#rapid-icon-close")),m.append("h3").html(t.tHtml("QA.improveOSM.title"));let g=d.selectAll(".body").data([0]);g=g.enter().append("div").attr("class","body").merge(g);let _=g.selectAll(".qa-editor").data([0]);_.enter().append("div").attr("class","modal-section qa-editor").merge(_).call(n.issue(o)).call(r.issue(o)).call(s.issue(o)).call(l)}function l(d){let m=o?.id,g=m&&t.selectedData().has(m),_=o&&(g||o.newComment||o.comment),v=d.selectAll(".qa-save").data(_?[o]:[],T=>`${T.id}-${T.status||0}`);v.exit().remove();let E=v.enter().append("div").attr("class","qa-save save-section cf");E.append("h4").attr("class",".qa-save-header").html(t.tHtml("note.newComment")),E.append("textarea").attr("class","new-comment-input").attr("placeholder",t.t("QA.keepRight.comment_placeholder")).attr("maxlength",1e3).property("value",T=>T.newComment).call(ki).on("input",b).on("blur",b),v=E.merge(v).call(u);function b(){let A=ye(this).property("value").trim();A===""&&(A=void 0),o=o.update({newComment:A}),e&&e.replaceItem(o),v.call(u)}}function u(d){let m=o?.id,g=m&&t.selectedData().has(m),_=d.selectAll(".buttons").data(g?[o]:[],E=>E.status+E.id);_.exit().remove();let v=_.enter().append("div").attr("class","buttons");v.append("button").attr("class","button comment-button action").html(t.tHtml("QA.keepRight.save_comment")),v.append("button").attr("class","button close-button action"),v.append("button").attr("class","button ignore-button action"),_=_.merge(v),_.select(".comment-button").attr("disabled",E=>E.newComment?null:!0).on("click.comment",function(E,b){this.blur(),e&&e.postUpdate(b,(T,A)=>i.call("change",A))}),_.select(".close-button").html(E=>{let b=E.newComment?"_comment":"";return t.tHtml(`QA.keepRight.close${b}`)}).on("click.close",function(E,b){this.blur(),e&&(b.newStatus="SOLVED",e.postUpdate(b,(T,A)=>i.call("change",A)))}),_.select(".ignore-button").html(E=>{let b=E.newComment?"_comment":"";return t.tHtml(`QA.keepRight.ignore${b}`)}).on("click.ignore",function(E,b){this.blur(),e&&(b.newStatus="INVALID",e.postUpdate(b,(T,A)=>i.call("change",A)))})}return a.error=function(d){return arguments.length?(o=d,a):o},$t(a,i,"on")}function pi(t,e){return`<svg class="${"icon"+(e?` ${e}`:"")}"><use xlink:href="${t}"></use></svg>`}function $s(t){t.stopPropagation(),t.preventDefault()}var F_;function lt(t,e,i){let r=t.systems.l10n,s=r.isRTL();F_||(F_={point_icon:pi("#rapid-icon-point","inline"),line_icon:pi("#rapid-icon-line","inline"),area_icon:pi("#rapid-icon-area","inline"),note_icon:pi("#rapid-icon-note","inline add-note"),plus:pi("#rapid-icon-plus","inline"),minus:pi("#rapid-icon-minus","inline"),layers_icon:pi("#rapid-icon-layers","inline"),data_icon:pi("#rapid-icon-data","inline"),inspect:pi("#rapid-icon-inspect","inline"),help_icon:pi("#rapid-icon-help","inline"),undo_icon:pi(s?"#rapid-icon-redo":"#rapid-icon-undo","inline"),redo_icon:pi(s?"#rapid-icon-undo":"#rapid-icon-redo","inline"),save_icon:pi("#rapid-icon-save","inline"),circularize_icon:pi("#rapid-operation-circularize","inline operation"),continue_icon:pi("#rapid-operation-continue","inline operation"),copy_icon:pi("#rapid-operation-copy","inline operation"),delete_icon:pi("#rapid-operation-delete","inline operation"),disconnect_icon:pi("#rapid-operation-disconnect","inline operation"),downgrade_icon:pi("#rapid-operation-downgrade","inline operation"),extract_icon:pi("#rapid-operation-extract","inline operation"),merge_icon:pi("#rapid-operation-merge","inline operation"),move_icon:pi("#rapid-operation-move","inline operation"),orthogonalize_icon:pi("#rapid-operation-orthogonalize","inline operation"),paste_icon:pi("#rapid-operation-paste","inline operation"),reflect_long_icon:pi("#rapid-operation-reflect-long","inline operation"),reflect_short_icon:pi("#rapid-operation-reflect-short","inline operation"),reverse_icon:pi("#rapid-operation-reverse","inline operation"),rotate_icon:pi("#rapid-operation-rotate","inline operation"),split_icon:pi("#rapid-operation-split","inline operation"),straighten_icon:pi("#rapid-operation-straighten","inline operation"),leftclick:pi("#rapid-walkthrough-mouse-left","inline operation"),rightclick:pi("#rapid-walkthrough-mouse-right","inline operation"),mousewheel_icon:pi("#rapid-walkthrough-mousewheel","inline operation"),tap_icon:pi("#rapid-walkthrough-tap","inline operation"),doubletap_icon:pi("#rapid-walkthrough-doubletap","inline operation"),longpress_icon:pi("#rapid-walkthrough-longpress","inline operation"),touchdrag_icon:pi("#rapid-walkthrough-touchdrag","inline operation"),pinch_icon:pi("#rapid-walkthrough-pinch-apart","inline operation"),shift:Ri.display(t,"\u21E7"),alt:Ri.display(t,"\u2325"),return:Ri.display(t,"\u21B5"),esc:r.tHtml("shortcuts.key.esc"),space:r.tHtml("shortcuts.key.space"),add_note_key:r.tHtml("modes.add_note.key"),help_key:r.tHtml("help.key"),shortcuts_key:r.tHtml("shortcuts.toggle.key"),save:r.tHtml("save.title"),undo:r.tHtml("undo.title"),redo:r.tHtml("redo.title"),upload:r.tHtml("commit.save"),point:r.tHtml("modes.add_point.title"),line:r.tHtml("modes.add_line.title"),area:r.tHtml("modes.add_area.title"),note:r.tHtml("modes.add_note.label"),circularize:r.tHtml("operations.circularize.title"),continue:r.tHtml("operations.continue.title"),copy:r.tHtml("operations.copy.title"),delete:r.tHtml("operations.delete.title"),disconnect:r.tHtml("operations.disconnect.title"),downgrade:r.tHtml("operations.downgrade.title"),extract:r.tHtml("operations.extract.title"),merge:r.tHtml("operations.merge.title"),move:r.tHtml("operations.move.title"),orthogonalize:r.tHtml("operations.orthogonalize.title"),paste:r.tHtml("operations.paste.title"),reflect_long:r.tHtml("operations.reflect.title.long"),reflect_short:r.tHtml("operations.reflect.title.short"),reverse:r.tHtml("operations.reverse.title"),rotate:r.tHtml("operations.rotate.title"),split:r.tHtml("operations.split.title"),straighten:r.tHtml("operations.straighten.title"),map_data:r.tHtml("map_data.title"),osm_notes:r.tHtml("map_data.layers.notes.title"),fields:r.tHtml("inspector.fields"),tags:r.tHtml("inspector.tags"),relations:r.tHtml("inspector.relations"),new_relation:r.tHtml("inspector.new_relation"),turn_restrictions:r.tHtml("_tagging.presets.fields.restrictions.label"),background_settings:r.tHtml("background.description"),imagery_offset:r.tHtml("background.fix_misalignment"),start_the_walkthrough:r.tHtml("splash.walkthrough"),help:r.tHtml("help.title"),ok:r.tHtml("intro.ok")});let n;return i?n=Object.assign(i,F_):n=F_,r.tHtml(e,n).replace(/\`(.*?)\`/g,"<kbd>$1</kbd>")}function rO(t){return t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}var sO={};function nO(t,e,i){if(t.systems.l10n.t(e,{default:void 0})===void 0){if(sO.hasOwnProperty(e))return;sO[e]=i;let s=`${e}: ${i}`;typeof console<"u"&&console.log(s)}}function SS(t,e){let i=t.systems.l10n,r,s=e.tags&&e.tags.name;s&&(r="intro.graph.name."+rO(s),e.tags.name=i.t(r,{default:s}),nO(t,r,s));let n=e.tags&&e.tags["addr:street"];if(n){r="intro.graph.name."+rO(n),e.tags["addr:street"]=i.t(r,{default:n}),nO(t,r,n);let o=["block_number","city","county","district","hamlet","neighbourhood","postcode","province","quarter","state","subdistrict","suburb"];for(let a of o){let l=`intro.graph.${a}`,u=`addr:${a}`,d=e.tags&&e.tags[u],m=i.t(l,{default:d});m&&(m.match(/^<.*>$/)!==null?delete e.tags[u]:e.tags[u]=m)}}return e}function oO(t){let i=Math.cos(75*Math.PI/180),r=Math.cos(15*Math.PI/180);for(let s=0;s<t.length;s++){let n=t[(s-1+t.length)%t.length],o=t[s],a=t[(s+1)%t.length],l=x8(n,a,o),u=Math.abs(l);if(u>i&&u<r)return!1}return!0}function gn(t,e){let i=fr(t,e);return i<1e-4?0:i<200?500:1e3}function Pr(t=300){return new Promise(e=>window.setTimeout(e,t))}function Mn(t){t.select(".inspector-wrap .entity-editor-pane").classed("hide",!1),t.select(".inspector-wrap .preset-list-pane").classed("hide",!0),t.select(".inspector-wrap .panewrap").style("right","0%")}function Dl(t){t.select(".inspector-wrap .entity-editor-pane").classed("hide",!0),t.select(".inspector-wrap .preset-list-pane").classed("hide",!1),t.select(".inspector-wrap .panewrap").style("right","-100%")}function xh(t,e,i){return Math.max(e,Math.min(t,i))}var L_=class{constructor(e){this.context=e,this._enabled=!1,this._revealOptions=null,this._containerRect=null,this._mapRect=null,this._revealRect=null,this._darknessDirty=!0,this._tooltipDirty=!0,this._inTransition=!1,this._curtain=ye(null),this._tooltip=ye(null),this.enable=this.enable.bind(this),this.disable=this.disable.bind(this),this.redraw=this.redraw.bind(this),this.resize=this.resize.bind(this)}enable(e){this._enabled||(this._enabled=!0,this._revealOptions=null,this._containerRect=null,this._mapRect=null,this._revealRect=null,this._darknessDirty=!0,this._tooltipDirty=!0,this._inTransition=!1,this._curtain=e.append("svg").attr("class","curtain").style("top",0).style("left",0),this._tooltip=e.append("div").attr("class","tooltip"),this._tooltip.append("div").attr("class","popover-arrow"),this._tooltip.append("div").attr("class","popover-inner"),ye(window).on("resize.curtain",this.resize),this.context.systems.map.on("move",this.redraw),this.resize())}disable(){this._enabled&&(this._enabled=!1,this._curtain.remove(),this._curtain=ye(null),this._tooltip.remove(),this._tooltip=ye(null),this._revealOptions=null,this._containerRect=null,this._mapRect=null,this._revealRect=null,ye(window).on("resize.curtain",null),this.context.systems.map.off("move",this.redraw))}resize(){let e=this.context.container().node();this._containerRect=this._copyRect(e.getBoundingClientRect());let i=this.context.container().select(".main-map").node();this._mapRect=this._copyRect(i.getBoundingClientRect());let[r,s]=[this._containerRect.width,this._containerRect.height];this._curtain.attr("width",r).attr("height",s),this._revealRect=null,this._darknessDirty=!0,this._curtain.selectAll("path").interrupt(),this._inTransition=!1,this.redraw()}hide(){this.reveal({duration:0})}reveal(e={}){return this._revealOptions=Object.assign({},e,{duration:250}),this._revealRect=null,this._darknessDirty=!0,this._tooltipDirty=!0,this.redrawDarkness(this._revealOptions.duration),this.redrawTooltip(),this._tooltip}redraw(){this._inTransition||(this.redrawDarkness(),this.redrawTooltip())}redrawDarkness(e=0){if(!this._darknessDirty)return;let i=this._containerRect,r=this._mapRect;if(!i||!r)return;let s=this._revealOptions,n=s?.revealPadding??0,o,a;if(s){if(s.revealExtent instanceof mt){let v=this.context.projection,E=v.project([s.revealExtent.min[0],s.revealExtent.max[1]]),b=v.project([s.revealExtent.max[0],s.revealExtent.min[1]]);E=Sr(E,[r.left,r.top]),b=Sr(b,[r.left,r.top]),a=r,o={left:E[0],top:E[1],right:b[0],bottom:b[1],width:b[0]-E[0],height:b[1]-E[1]}}else s.revealSelector&&!s.revealNode&&(s.revealNode=ye(s.revealSelector).node()),s.revealNode instanceof Element&&(a=i,o=this._copyRect(s.revealNode.getBoundingClientRect()));o&&(o.left=xh(o.left-n,a.left,a.right),o.top=xh(o.top-n,a.top,a.bottom),o.right=xh(o.right+n,a.left,a.right),o.bottom=xh(o.bottom+n,a.top,a.bottom),o.width=o.right-o.left,o.height=o.bottom-o.top,this._revealRect=o)}let l=i,u=o,d=`M${l.left},${l.top} L${l.left},${l.bottom} L${l.right},${l.bottom}, L${l.right},${l.top} Z`;u&&(d+=` M${u.left},${u.top} L${u.left},${u.bottom} L${u.right},${u.bottom}, L${u.right},${u.top} Z`);let m=this._curtain.selectAll("path").data([0]).interrupt(),g=m.enter().append("path").attr("x",0).attr("y",0).attr("class","curtain-darkness"),_=m.merge(g);e>0?(this._inTransition=!0,_=_.transition().duration(e).ease(j3).on("end interrupt",()=>this._inTransition=!1)):this._inTransition=!1,_.attr("d",d),this._darknessDirty=s?.revealExtent}redrawTooltip(){let e=this._containerRect;if(!e)return;let i=this._revealOptions,r;i&&(i.tipSelector&&!i.tipNode&&(i.tipNode=ye(i.tipSelector).node()),i.tipNode instanceof Element&&(r=this._copyRect(i.tipNode.getBoundingClientRect())),!r&&this._revealRect&&(r=this._copyRect(this._revealRect)));let s=i?.tipHtml;if(r&&s){let n="curtain-tooltip popover tooltip arrowed in "+(i.tooltipClass||"");this._tooltipDirty&&(s.indexOf("**")!==-1&&(s.indexOf("<span")===0?s=s.replace(/^(<span.*?>)(.+?)(\*\*)/,"$1<span>$2</span>$3"):s=s.replace(/^(.+?)(\*\*)/,"<span>$1</span>$2"),s=s.replace(/\*\*(.*?)\*\*/g,'<span class="instruction">$1</span>')),s=s.replace(/\*(.*?)\*/g,"<em>$1</em>"),s=s.replace(/\{br\}/g,"<br/><br/>"),i.buttonText&&i.buttonCallback&&(s+=`<div class="button-section"><button href="#" class="button action">${i.buttonText}</button></div>`),this._tooltip.attr("class",n).selectAll(".popover-inner").html(s),i.buttonText&&i.buttonCallback&&this._tooltip.selectAll("button.action").on("click",g=>{g.preventDefault(),i.buttonCallback()}),this._tooltipDirty=!1);let o=5,a=this._copyRect(this._tooltip.node().getBoundingClientRect()),l,u,d;r.left=xh(r.left,e.left,e.right),r.top=xh(r.top,e.top,e.bottom),r.right=xh(r.right,e.left,e.right),r.bottom=xh(r.bottom,e.top,e.bottom),r.width=r.right-r.left,r.height=r.bottom-r.top,r.bottom<100?(l="bottom",u=r.left+r.width/2-a.width/2,d=r.bottom):r.top>e.height-140?(l="top",u=r.left+r.width/2-a.width/2,d=r.top-a.height):(d=r.top+r.height/2-a.height/2,this.context.systems.l10n.textDirection()==="rtl"?r.left-a.width-o<70?(l="right",u=r.right+o):(l="left",u=r.left-a.width-o):r.right+o+a.width>e.width-70?(l="left",u=r.left-a.width-o):(l="right",u=r.right+o)),this._tooltip.style("left",`${u}px`).style("top",`${d}px`).attr("class",n+" "+l);let m=0;(l==="left"||l==="right")&&(d<60?m=60-d:d+a.height>e.height-100&&(m=e.height-d-a.height-100)),this._tooltip.selectAll(".popover-inner").style("top",`${m}px`)}else this._tooltip.classed("in",!1).call($4(!1)),this._tooltipDirty=!1}_copyRect(e){return{left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height}}};function aO(t,e){let i=Mt("done"),r={title:"intro.welcome.title"},s=new mt([-85.63654,41.9429],[-85.63632,41.94307]),n=!1,o=null;function a(g){return n?Promise.reject():typeof g!="function"?Promise.resolve():g().then(_=>a(_)).catch(_=>(_ instanceof Error&&console.error(_),a(g)))}function l(){return t.systems.map.setCenterZoomAsync(s.center(),19).then(()=>new Promise((g,_)=>{o=_,e.reveal({revealSelector:".intro-nav-wrap .chapter-welcome",tipHtml:lt(t,"intro.welcome.welcome"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>g(u)})}))}function u(){return new Promise((g,_)=>{o=_,e.reveal({revealSelector:".intro-nav-wrap .chapter-welcome",tipHtml:lt(t,"intro.welcome.practice"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>g(d)})})}function d(){return new Promise((g,_)=>{o=_,e.reveal({revealSelector:".intro-nav-wrap .chapter-welcome",tipHtml:lt(t,"intro.welcome.words"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>g(m)})})}function m(){return i.call("done"),e.reveal({revealSelector:".intro-nav-wrap .chapter-navigation",tipHtml:lt(t,"intro.welcome.chapters",{next:t.t("intro.navigation.title")})}),Promise.resolve()}return r.enter=()=>{n=!1,o=null,a(l).catch(g=>{g instanceof Error&&console.error(g)})},r.exit=()=>{n=!0,o&&(o(),o=null)},r.restart=()=>{r.exit(),r.enter()},$t(r,i,"on")}function lO(t,e){let i=Mt("done"),r={title:"intro.navigation.title"},s=t.container(),n=t.systems.edits,o=t.systems.map,a=t.systems.presets,l="n2061",u=new mt([-85.63654,41.9429],[-85.63632,41.94307]),d="w397",m=new mt([-85.63588,41.94155],[-85.63574,41.94278]),g=a.field("oneway"),_=a.field("maxspeed"),v=!1,E=null,b=null,T=null;function A(){if(!t.hasEntity(l)||t.mode?.id!=="select-osm")return!1;let ne=t.selectedIDs();return ne.length===1&&ne[0]===l}function M(){return t.hasEntity(d)}function k(){if(!t.hasEntity(d)||t.mode?.id!=="select-osm")return!1;let ne=t.selectedIDs();return ne.length===1&&ne[0]===d}function F(ne){return v?Promise.reject():typeof ne!="function"?Promise.resolve():ne().then(me=>F(me)).catch(me=>(me instanceof Error&&console.error(me),F(ne)))}function O(){t.enter("browse"),n.resetToCheckpoint("initial");let ne=u.center(),me=gn(ne,o.center());return me>0&&e.hide(),o.setCenterZoomAsync(ne,19,me).then(()=>new Promise((De,He)=>{E=He;let Je=o.center(),ot=t.lastPointerType==="mouse"?"drag":"drag_touch",gt=lt(t,"intro.navigation.map_info")+"{br}"+lt(t,`intro.navigation.${ot}`);b=()=>{Wi(Je,o.center())||De(B)},e.reveal({revealSelector:".main-map",tipHtml:gt})})).finally(()=>{b=null}).then(De=>Pr(2e3).then(De))}function B(){return new Promise((ne,me)=>{E=me;let De=o.zoom(),He=t.lastPointerType==="mouse"?"zoom":"zoom_touch",Je=lt(t,`intro.navigation.${He}`);b=()=>{De!==o.zoom()&&ne(U)},e.reveal({revealSelector:".main-map",tipHtml:Je})}).finally(()=>{b=null}).then(ne=>Pr(2e3).then(ne))}function U(){return new Promise((ne,me)=>{E=me,e.reveal({revealSelector:".main-map",tipHtml:lt(t,"intro.navigation.features"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>ne($)})})}function $(){return new Promise((ne,me)=>{E=me,e.reveal({revealSelector:".main-map",tipHtml:lt(t,"intro.navigation.points_lines_areas"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>ne(q)})})}function q(){return new Promise((ne,me)=>{E=me,e.reveal({revealSelector:".main-map",tipHtml:lt(t,"intro.navigation.nodes_ways"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>ne(W)})})}function W(){t.enter("browse"),n.resetToCheckpoint("initial");let ne=u.center(),me=gn(ne,o.center());return me>0&&e.hide(),o.setCenterZoomAsync(ne,19,me).then(()=>new Promise((De,He)=>{E=He,T=()=>De(Z);let Je=t.lastPointerType==="mouse"?"click_townhall":"tap_townhall";e.reveal({revealExtent:u,tipHtml:lt(t,`intro.navigation.${Je}`)})})).finally(()=>{T=null})}function Z(){return A()?new Promise((ne,me)=>{E=me,T=me,e.reveal({revealExtent:u,tipHtml:lt(t,"intro.navigation.selected_townhall"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>ne(Q)})}).finally(()=>{T=null}):Promise.resolve(W)}function Q(){return A()?new Promise((ne,me)=>{E=me,T=me,Mn(s),s.select(".inspector-wrap").on("wheel.intro",$s),e.reveal({revealSelector:".entity-editor-pane",tipHtml:lt(t,"intro.navigation.editor_townhall"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>ne(X)})}).finally(()=>{T=null,s.select(".inspector-wrap").on("wheel.intro",null)}):Promise.resolve(W)}function X(){return A()?new Promise((ne,me)=>{E=me,T=me,Mn(s),s.select(".inspector-wrap").on("wheel.intro",$s);let De=t.entity(t.selectedIDs()[0]),He=a.match(De,t.graph());e.reveal({revealSelector:".entity-editor-pane .section-feature-type",revealPadding:5,tipHtml:lt(t,"intro.navigation.preset_townhall",{preset:He.name()}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>ne(ce)})}).finally(()=>{T=null,s.select(".inspector-wrap").on("wheel.intro",null)}):Promise.resolve(W)}function ce(){return A()?new Promise((ne,me)=>{E=me,T=me,Mn(s),s.select(".inspector-wrap").on("wheel.intro",$s),e.reveal({revealSelector:".entity-editor-pane .section-preset-fields",revealPadding:5,tipHtml:lt(t,"intro.navigation.fields_townhall"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>ne(de)})}).finally(()=>{T=null,s.select(".inspector-wrap").on("wheel.intro",null)}):Promise.resolve(W)}function de(){return A()?new Promise((ne,me)=>{E=me,T=()=>ne(le),Mn(s);let He=ye(".entity-editor-pane button.close svg use").attr("href")||"#rapid-icon-close";e.reveal({revealSelector:".entity-editor-pane",tipSelector:".entity-editor-pane button.close",tipHtml:lt(t,"intro.navigation.close_townhall",{button:pi(He,"inline")})})}).finally(()=>{T=null}):Promise.resolve(W)}function le(){t.enter("browse"),n.resetToCheckpoint("initial");let ne=m.center(),me=gn(ne,o.center());return me>0&&e.hide(),o.setCenterZoomAsync(ne,19,me).then(()=>new Promise((De,He)=>{E=He,e.reveal({revealSelector:".search-header input",tipHtml:lt(t,"intro.navigation.search_street",{name:t.t("intro.graph.name.spring-street")})}),s.select(".search-header input").on("keyup.intro",()=>De(te))})).finally(()=>{s.select(".search-header input").on("keyup.intro",null)})}function te(){return M()?new Promise((ne,me)=>{E=me,T=()=>ne(ee),s.select(".search-header input").on("keyup.intro",()=>{let De=s.select(".feature-list-item:nth-child(0n+2)"),He=De.select(".entity-name"),Je=t.t("intro.graph.name.spring-street");!He.empty()&&He.html()===Je&&(e.reveal({revealNode:De.node(),revealPadding:5,tipHtml:lt(t,"intro.navigation.choose_street",{name:Je})}),s.select(".search-header input").on("keydown.intro",$s,!0).on("keyup.intro",null))})}).finally(()=>{T=null,s.select(".search-header input").on("keydown.intro",null).on("keyup.intro",null)}):Promise.resolve(le)}function ee(){let ne=m.center();return o.setCenterZoomAsync(ne,19,0).then(()=>new Promise((me,De)=>{if(E=De,T=De,!k()){me(le);return}e.reveal({revealExtent:m,revealPadding:40,tipHtml:lt(t,"intro.navigation.selected_street",{name:t.t("intro.graph.name.spring-street")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>me(oe)})})).finally(()=>{T=null})}function oe(){return k()?new Promise((ne,me)=>{E=me,T=()=>ne(ie),Mn(s);let He=ye(".entity-editor-pane button.close svg use").attr("href")||"#rapid-icon-close",Je=lt(t,"intro.navigation.street_different_fields")+"{br}"+lt(t,"intro.navigation.editor_street",{button:pi(He,"inline"),field1:g.label(),field2:_.label()});e.reveal({revealSelector:".entity-editor-pane",tipHtml:Je})}).finally(()=>{T=null}):Promise.resolve(le)}function ie(){return i.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-point",tipHtml:lt(t,"intro.navigation.play",{next:t.t("intro.points.title")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{v=!1,E=null,b=null,T=null,t.on("modechange",me),o.on("move",ne),F(O).catch(De=>{De instanceof Error&&console.error(De)}).finally(()=>{t.off("modechange",me),o.off("move",ne)});function ne(){typeof b=="function"&&b()}function me(De){typeof T=="function"&&T(De)}},r.exit=()=>{v=!0,E&&(E(),E=null)},r.restart=()=>{r.exit(),r.enter()},$t(r,i,"on")}function cO(t,e){let i=Mt("done"),r={title:"intro.points.title"},s=t.systems.ui.editMenu,n=t.container(),o=t.systems.edits,a=t.systems.map,l=t.systems.presets,u=new mt([-85.63261,41.94391],[-85.63222,41.94419]),d=l.item("amenity/cafe"),m=!1,g=null,_=null,v=null,E=null;function b(){return E&&t.hasEntity(E)}function T(){if(t.mode?.id!=="select-osm")return!1;let le=t.selectedIDs();return le.length===1&&le[0]===E}function A(le){return m?Promise.reject():typeof le!="function"?Promise.resolve():le().then(te=>A(te)).catch(te=>(te instanceof Error&&console.error(te),A(le)))}function M(){t.enter("browse"),o.resetToCheckpoint("initial"),E=null;let le=u.center(),te=gn(le,a.center());return te>0&&e.hide(),a.setCenterZoomAsync(le,20,te).then(()=>new Promise((ee,oe)=>{g=oe,_=()=>ee(k),e.reveal({revealSelector:"button.add-point",tipHtml:lt(t,"intro.points.points_info")+"{br}"+lt(t,"intro.points.add_point")}).selectAll(".popover-inner").insert("svg","span").attr("class","tooltip-illustration").append("use").attr("xlink:href","#rapid-graphic-points")})).finally(()=>{_=null})}function k(){return t.mode?.id!=="add-point"?Promise.resolve(M):(E=null,new Promise((le,te)=>{g=te,_=()=>le(F),v=oe=>{if(!oe)return;let ie=oe.created();ie.length===1&&(E=ie[0].id)};let ee=t.lastPointerType==="mouse"?"place_point":"place_point_touch";e.reveal({revealExtent:u,tipHtml:lt(t,`intro.points.${ee}`)})}).finally(()=>{_=null,v=null}))}function F(){return Pr().then(()=>new Promise((le,te)=>{if(g=te,!b()){le(M);return}T()||t.enter("select-osm",{selectedIDs:[E]}),_=te,v=oe=>{if(!oe)return;let ie=oe.modified();ie.length===1&&(l.match(ie[0],t.graph())===d?le(O):te())},n.select(".inspector-wrap").on("wheel.intro",$s),Dl(n),e.reveal({revealSelector:".preset-search-input",tipHtml:lt(t,"intro.points.search_cafe",{preset:d.name()})}),n.select(".preset-search-input").on("keydown.intro",null).on("keyup.intro",ee);function ee(){let oe=n.select(".preset-list-item:first-child");oe.classed("preset-amenity-cafe")&&(e.reveal({revealNode:oe.select(".preset-list-button").node(),revealPadding:5,tipHtml:lt(t,"intro.points.choose_cafe",{preset:d.name()})}),n.select(".preset-search-input").on("keydown.intro",$s,!0).on("keyup.intro",null))}})).finally(()=>{_=null,v=null,n.select(".inspector-wrap").on("wheel.intro",null),n.select(".preset-search-input").on("keydown.intro keyup.intro",null)})}function O(){return Pr().then(()=>new Promise((le,te)=>{if(g=te,!b()){le(M);return}T()||t.enter("select-osm",{selectedIDs:[E]}),_=()=>le(B),Mn(n),e.reveal({revealSelector:".entity-editor-pane",tipHtml:lt(t,"intro.points.feature_editor"),tipClass:"intro-points-describe",buttonText:t.tHtml("intro.ok"),buttonCallback:()=>le(B)})})).finally(()=>{_=null})}function B(){return Pr().then(()=>new Promise((le,te)=>{if(g=te,!b()){le(M);return}T()||t.enter("select-osm",{selectedIDs:[E]}),_=()=>le($),v=()=>le(U),Mn(n),t.hasEntity(E).tags.name?e.reveal({revealSelector:".entity-editor-pane",tipHtml:lt(t,"intro.points.fields_info"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>le(U)}).select(".instruction").style("display","none"):e.reveal({revealSelector:".entity-editor-pane",tipHtml:lt(t,"intro.points.fields_info")+"{br}"+lt(t,"intro.points.add_name"),tipClass:"intro-points-describe"})})).finally(()=>{_=null,v=null})}function U(){return b()?(T()||t.enter("select-osm",{selectedIDs:[E]}),new Promise((le,te)=>{g=te,_=()=>le($),Mn(n);let oe=ye(".entity-editor-pane button.close svg use").attr("href")||"#rapid-icon-close";e.reveal({revealSelector:".entity-editor-pane",tipHtml:lt(t,"intro.points.add_close",{button:pi(oe,"inline")})})}).finally(()=>{_=null})):Promise.resolve(M)}function $(){if(!b())return Promise.resolve(M);let le=t.entity(E),te=l.match(le,t.graph());return t.replace(ja(E,te,d)),o.setCheckpoint("hasPoint"),Promise.resolve(q)}function q(){t.enter("browse"),o.resetToCheckpoint("hasPoint");let le=u.center(),te=gn(le,a.center());return te>0&&e.hide(),a.setCenterZoomAsync(le,20,te).then(()=>new Promise((ee,oe)=>{g=oe,_=()=>ee(W),e.reveal({revealExtent:u,tipHtml:lt(t,"intro.points.reselect")})})).finally(()=>{_=null})}function W(){return Pr().then(()=>new Promise((le,te)=>{if(g=te,!b()||!T()){le(q);return}_=te,v=()=>le(Z),Mn(n),e.reveal({revealSelector:".entity-editor-pane",tipHtml:lt(t,"intro.points.update"),tipClass:"intro-points-describe"})})).finally(()=>{_=null,v=null})}function Z(){return!b()||!T()?Promise.resolve(q):new Promise((le,te)=>{g=te,_=()=>le(Q),Mn(n),e.reveal({revealSelector:".entity-editor-pane",tipHtml:lt(t,"intro.points.update_close",{button:pi("#rapid-icon-close","inline")})})}).finally(()=>{_=null})}function Q(){return b()?(["browse","select-osm"].includes(t.mode?.id)||t.enter("browse"),new Promise((le,te)=>{g=te,v=te;let ee=t.lastPointerType==="mouse"?"rightclick":"edit_menu_touch";e.reveal({revealExtent:u,tipHtml:lt(t,`intro.points.${ee}`)}),s.on("toggled.intro",oe=>{oe&&le(X)})}).finally(()=>{v=null,s.on("toggled.intro",null)})):Promise.resolve(q)}function X(){return n.select(".edit-menu-item-delete").node()?Pr().then(()=>new Promise((te,ee)=>{if(g=ee,_=()=>{b()&&ee()},v=oe=>{if(!oe)return;let ie=oe.deleted();ie.length===1&&ie[0].id===E&&te(ce)},!b()||!T()){te(Q);return}e.reveal({revealSelector:".edit-menu",revealPadding:50,tipHtml:lt(t,"intro.points.delete")})})).finally(()=>{_=null,v=null}):Promise.resolve(Q)}function ce(){return new Promise((le,te)=>{g=te,v=()=>le(de),e.reveal({revealSelector:".top-toolbar button.undo-button",tipHtml:lt(t,"intro.points.undo")})}).finally(()=>{v=null})}function de(){return i.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-area",tipHtml:lt(t,"intro.points.play",{next:t.t("intro.areas.title")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{m=!1,g=null,_=null,v=null,t.on("modechange",le),o.on("change",te),A(M).catch(ee=>{ee instanceof Error&&console.error(ee)}).finally(()=>{t.off("modechange",le),o.off("change",te)});function le(ee){typeof _=="function"&&_(ee)}function te(ee){typeof v=="function"&&v(ee)}},r.exit=()=>{m=!0,g&&(g(),g=null)},r.restart=()=>{r.exit(),r.enter()},$t(r,i,"on")}function uO(t,e){let i=Mt("done"),r={title:"intro.areas.title"},s=t.container(),n=t.systems.edits,o=t.systems.map,a=t.systems.presets,l=new mt([-85.63575,41.94137],[-85.63526,41.9418]),u=a.item("leisure/playground"),d=a.field("name"),m=a.field("description"),g=!1,_=null,v=null,E=null,b=null;function T(){return b&&t.hasEntity(b)}function A(){if(t.mode?.id!=="select-osm")return!1;let X=t.selectedIDs();return X.length===1&&X[0]===b}function M(X){return g?Promise.reject():typeof X!="function"?Promise.resolve():X().then(ce=>M(ce)).catch(ce=>(ce instanceof Error&&console.error(ce),M(X)))}function k(){t.enter("browse"),n.resetToCheckpoint("initial"),b=null;let X=l.center(),ce=gn(X,o.center());return ce>0&&e.hide(),o.setCenterZoomAsync(X,19.5,ce).then(()=>new Promise((de,le)=>{_=le,v=()=>de(F),e.reveal({revealSelector:"button.draw-area",tipHtml:lt(t,"intro.areas.add_playground")}).selectAll(".popover-inner").insert("svg","span").attr("class","tooltip-illustration").append("use").attr("xlink:href","#rapid-graphic-areas")})).finally(()=>{v=null})}function F(){return t.mode?.id!=="draw-area"?Promise.resolve(k):(b=null,new Promise((X,ce)=>{_=ce,v=ce,E=te=>{if(te)for(let ee of te.created())ee.type==="way"&&(b=ee.id,X(O))};let de=t.lastPointerType==="mouse"?"click":"tap",le=lt(t,"intro.areas.start_playground")+lt(t,`intro.areas.starting_node_${de}`);e.reveal({revealExtent:l,tipHtml:le})}).finally(()=>{v=null,E=null}))}function O(){return!T()||t.mode?.id!=="draw-area"?Promise.resolve(k):new Promise((X,ce)=>{_=ce,v=ce,E=de=>{if(de)for(let le of de.modified())le.id===b&&le.nodes.length>5&&X(B)},e.reveal({revealExtent:l,tipHtml:lt(t,"intro.areas.continue_playground")})}).finally(()=>{v=null,E=null})}function B(){return!T()||t.mode?.id!=="draw-area"?Promise.resolve(k):new Promise((X,ce)=>{_=ce,v=()=>X(U);let de=t.lastPointerType==="mouse"?"click":"tap",le=lt(t,`intro.areas.finish_area_${de}`)+lt(t,"intro.areas.finish_playground");e.reveal({revealExtent:l,tipHtml:le})}).finally(()=>{v=null})}function U(){return Pr().then(()=>new Promise((X,ce)=>{if(_=ce,!T()){X(k);return}A()||t.enter("select-osm",{selectedIDs:[b]}),v=ce,E=le=>{if(!le)return;let te=le.modified();te.length===1&&(a.match(te[0],t.graph())===u?X($):ce())},Dl(s),s.select(".inspector-wrap").on("wheel.intro",$s),e.reveal({revealSelector:".preset-search-input",tipHtml:lt(t,"intro.areas.search_playground",{preset:u.name()})}),s.select(".preset-search-input").on("keydown.intro",null).on("keyup.intro",de);function de(){let le=s.select(".preset-list-item:first-child");le.classed("preset-leisure-playground")&&(e.reveal({revealNode:le.select(".preset-list-button").node(),revealPadding:5,tipHtml:lt(t,"intro.areas.search_playground",{preset:u.name()})}),s.select(".preset-search-input").on("keydown.intro",$s,!0).on("keyup.intro",null))}})).finally(()=>{v=null,E=null,s.select(".inspector-wrap").on("wheel.intro",null),s.select(".preset-search-input").on("keydown.intro keyup.intro",null)})}function $(){return Pr().then(()=>new Promise((X,ce)=>{if(_=ce,!T()){X(k);return}if(A()||t.enter("select-osm",{selectedIDs:[b]}),!s.select(".form-field-description").empty()){X(W);return}if(t.entity(b).tags.description){X(Q);return}v=ce,Mn(s),s.select(".inspector-wrap").on("wheel.intro",$s);let le=s.select(".more-fields").node().getBoundingClientRect();if(le.top>300){let te=s.select(".entity-editor-pane .inspector-body"),ee=te.node().scrollTop,oe=ee+(le.top-300);te.transition().duration(250).tween("scroll.inspector",()=>{let ie=this,ne=Qs(ee,oe);return function(me){ie.scrollTop=ne(me)}})}window.setTimeout(()=>{e.reveal({revealSelector:".more-fields .combobox-input",revealPadding:5,tipHtml:lt(t,"intro.areas.add_field",{name:d.label(),description:m.label()})}),s.select(".more-fields .combobox-input").on("click.intro",()=>{let te=window.setInterval(()=>{s.select("div.combobox").empty()||(window.clearInterval(te),X(q))},300)})},300)})).finally(()=>{v=null,s.select(".inspector-wrap").on("wheel.intro",null),s.select(".more-fields .combobox-input").on("click.intro",null)})}function q(){if(!T())return Promise.resolve(k);if(!A())return Promise.resolve(U);if(!s.select(".form-field-description").empty())return Promise.resolve(W);if(s.select("div.combobox").empty())return Promise.resolve($);let X;return new Promise((ce,de)=>{_=de,v=de,X=window.setInterval(()=>{s.select("div.combobox").empty()&&(window.clearInterval(X),window.setTimeout(()=>{s.select(".form-field-description").empty()?ce(Z):ce(W)},300))},300),Mn(s),e.reveal({revealSelector:"div.combobox",revealPadding:5,tipHtml:lt(t,"intro.areas.choose_field",{field:m.label()})})}).finally(()=>{v=null,X&&window.clearInterval(X)})}function W(){return T()?A()?s.select(".form-field-description").empty()?Promise.resolve(Z):new Promise((X,ce)=>{_=ce,v=()=>X(Q),Mn(s),e.reveal({revealSelector:".entity-editor-pane",tipHtml:lt(t,"intro.areas.describe_playground",{button:pi("#rapid-icon-close","inline")})})}).finally(()=>{v=null}):Promise.resolve(U):Promise.resolve(k)}function Z(){return T()?A()?new Promise((X,ce)=>{_=ce,v=ce,Mn(s),e.reveal({revealSelector:".entity-editor-pane",tipHtml:lt(t,"intro.areas.retry_add_field",{field:m.label()}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>X($)})}).finally(()=>{v=null}):Promise.resolve(U):Promise.resolve(k)}function Q(){return i.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-line",tipHtml:lt(t,"intro.areas.play",{next:t.t("intro.lines.title")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{g=!1,_=null,v=null,E=null,t.on("modechange",X),n.on("change",ce),M(k).catch(de=>{de instanceof Error&&console.error(de)}).finally(()=>{t.off("modechange",X),n.off("change",ce)});function X(de){typeof v=="function"&&v(de)}function ce(de){typeof E=="function"&&E(de)}},r.exit=()=>{g=!0,_&&(_(),_=null)},r.restart=()=>{r.exit(),r.enter()},$t(r,i,"on")}function hO(t,e){let i=Mt("done"),r={title:"intro.lines.title"},s=t.systems.ui.editMenu,n=t.container(),o=t.behaviors.drag,a=t.systems.edits,l=t.systems.map,u=t.systems.presets,d="w646",m=new mt([-85.63016,41.95749],[-85.62937,41.95843]),g=new mt([-85.63044,41.95686],[-85.629,41.95843]),_=[-85.629745,41.95742],v=u.item("category-road_minor"),E=u.item("highway/residential"),b="w525",T="n2862",A=new mt([-85.62457,41.95381],[-85.62326,41.9548]),M=[-85.6239,41.95397],k=[-85.62387,41.95467],F=[-85.62386,41.9543],O="w522",B="w1",U="n3550",$=new mt([-85.62304,41.95084],[-85.62087,41.95336]),q=t.entity(U).loc,W=!1,Z=null,Q=null,X=null,ce=null,de=null,le=null;function te(){return le&&t.hasEntity(le)}function ee(){if(t.mode?.id!=="select-osm")return!1;let Ke=t.selectedIDs();return Ke.length===1&&Ke[0]===le}function oe(){let Ke=le&&t.hasEntity(le),dt=d&&t.hasEntity(d);if(!Ke||!dt)return!1;let Lt=t.graph();return Lt.childNodes(Ke).some(Kt=>Lt.parentWays(Kt).some(Fi=>Fi.id===d))}function ie(){return t.hasEntity(b)&&t.hasEntity(T)}function ne(){if(t.mode?.id!=="select-osm")return!1;let Ke=t.selectedIDs();return Ke.length===1&&Ke[0]===b}function me(){return t.hasEntity(O)&&t.hasEntity(B)&&t.hasEntity(U)}function De(){return de&&t.hasEntity(de)}function He(){if(t.mode?.id!=="select-osm")return!1;let Ke=t.selectedIDs();return Ke.length===1&&Ke[0]===U}function Je(Ke){return W?Promise.reject():typeof Ke!="function"?Promise.resolve():Ke().then(dt=>Je(dt)).catch(dt=>(dt instanceof Error&&console.error(dt),Je(Ke)))}function ot(){t.enter("browse"),a.resetToCheckpoint("initial"),le=null;let Ke=m.center(),dt=gn(Ke,l.center());return dt>0&&e.hide(),l.setCenterZoomAsync(Ke,18.5,dt).then(()=>new Promise((Lt,Yt)=>{Z=Yt,X=()=>Lt(gt),e.reveal({revealSelector:"button.draw-line",tipHtml:lt(t,"intro.lines.add_line")}).selectAll(".popover-inner").insert("svg","span").attr("class","tooltip-illustration").append("use").attr("xlink:href","#rapid-graphic-lines")})).finally(()=>{X=null})}function gt(){return t.mode?.id!=="draw-line"?Promise.resolve(ot):(le=null,new Promise((Ke,dt)=>{Z=dt,X=dt,ce=Kt=>{if(Kt)for(let Fi of Kt.created())Fi.type==="way"&&(le=Fi.id,Ke(vt))};let Lt=t.lastPointerType==="mouse"?"start_line":"start_line_tap",Yt=lt(t,"intro.lines.missing_road")+"{br}"+lt(t,"intro.lines.line_draw_info")+lt(t,`intro.lines.${Lt}`);e.reveal({revealExtent:m,tipHtml:Yt})}).finally(()=>{X=null,ce=null}))}function vt(){let Ke=g.center(),dt=gn(Ke,l.center());return l.setCenterZoomAsync(Ke,18.5,dt).then(()=>new Promise((Lt,Yt)=>{if(Z=Yt,!te()||t.mode?.id!=="draw-line"){Lt(ot);return}X=()=>Lt(ct),ce=()=>{oe()&&Lt(Se)},e.reveal({revealExtent:g,tipHtml:lt(t,"intro.lines.intersect",{name:t.t("intro.graph.name.flower-street")})})})).finally(()=>{X=null,ce=null})}function ct(){return new Promise((Ke,dt)=>{Z=dt,e.reveal({revealExtent:new mt(_).padByMeters(15),tipHtml:lt(t,"intro.lines.retry_intersect",{name:t.t("intro.graph.name.flower-street")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>Ke(ot)})})}function Se(){let Ke=g.center(),dt=gn(Ke,l.center());return l.setCenterZoomAsync(Ke,18.5,dt).then(()=>new Promise((Lt,Yt)=>{if(Z=Yt,!te()||t.mode?.id!=="draw-line"){Lt(ot);return}X=()=>Lt(Qe);let Kt=t.lastPointerType==="mouse"?"click":"tap",Fi=lt(t,"intro.lines.continue_line")+"{br}"+lt(t,`intro.lines.finish_line_${Kt}`)+lt(t,"intro.lines.finish_road");e.reveal({revealSelector:".main-map",tipHtml:Fi})})).finally(()=>{X=null})}function Qe(){let Ke;return Pr().then(()=>new Promise((dt,Lt)=>{if(Z=Lt,!te()){dt(ot);return}if(ee()||t.enter("select-osm",{selectedIDs:[le]}),X=Lt,Dl(n),n.select(".inspector-wrap").on("wheel.intro",$s),Ke=n.select(".preset-category-road_minor .preset-list-button"),Ke.empty()){Lt(new Error("no minor roads category?"));return}if(Ke.classed("expanded")){dt(xt);return}e.reveal({revealNode:Ke.node(),revealPadding:5,tipHtml:lt(t,"intro.lines.choose_category_road",{category:v.name()})}),Ke.on("click.intro",()=>dt(xt))})).finally(()=>{X=null,Ke&&Ke.on("click.intro",null),n.select(".inspector-wrap").on("wheel.intro",null)})}function xt(){return Pr().then(()=>new Promise((Ke,dt)=>{if(Z=dt,!te()){Ke(ot);return}ee()||t.enter("select-osm",{selectedIDs:[le]}),Dl(n),n.select(".inspector-wrap").on("wheel.intro",$s);let Lt=n.select(".preset-category-road_minor .preset-list-button");if(Lt.empty()){dt(new Error("no minor roads category?"));return}if(!Lt.classed("expanded")){Ke(Qe);return}let Yt=n.select(".preset-category-road_minor .subgrid");if(Yt.empty()){dt(new Error("no minor roads presets?"));return}X=dt,ce=Kt=>{if(!Kt)return;let Fi=Kt.modified();Fi.length===1&&(u.match(Fi[0],t.graph())===E?Ke(Gt):Ke(It))},e.reveal({revealNode:Yt.node(),revealPadding:5,tipSelector:".preset-highway-residential .preset-list-button",tipHtml:lt(t,"intro.lines.choose_preset_residential",{preset:E.name()})})})).finally(()=>{X=null,ce=null,n.select(".inspector-wrap").on("wheel.intro",null)})}function It(){return Pr().then(()=>new Promise((Ke,dt)=>{if(Z=dt,!te()){Ke(ot);return}ee()||t.enter("select-osm",{selectedIDs:[le]}),Dl(n),n.select(".inspector-wrap").on("wheel.intro",$s);let Lt=n.select(".preset-category-road_minor .preset-list-button");if(Lt.empty()){dt(new Error("no minor roads category?"));return}if(!Lt.classed("expanded")){Ke(Qe);return}let Yt=n.select(".preset-highway-residential .preset-list-button");if(Yt.empty()){dt(new Error("no residential road preset?"));return}X=dt,ce=Kt=>{if(!Kt)return;let Fi=Kt.modified();Fi.length===1&&(u.match(Fi[0],t.graph())===E?Ke(Gt):Ke(Qe))},e.reveal({revealNode:Yt.node(),revealPadding:5,tipHtml:lt(t,"intro.lines.retry_preset_residential",{preset:E.name()})})})).finally(()=>{X=null,ce=null,n.select(".inspector-wrap").on("wheel.intro",null)})}function Gt(){return Pr().then(()=>new Promise((Ke,dt)=>{if(Z=dt,!te()){Ke(ot);return}ee()||t.enter("select-osm",{selectedIDs:[le]}),X=()=>Ke(Ni),Mn(n),e.reveal({revealSelector:".entity-editor-pane",tipHtml:lt(t,"intro.lines.name_road",{button:pi("#rapid-icon-close","inline")}),tooltipClass:"intro-lines-name_road"})})).finally(()=>{X=null})}function Ni(){return te()?(a.setCheckpoint("doneAddLine"),new Promise((Ke,dt)=>{Z=dt,e.reveal({revealSelector:".main-map",tipHtml:lt(t,"intro.lines.did_name_road"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>Ke(je)})})):Promise.resolve(ot)}function je(){t.enter("browse"),a.resetToCheckpoint("doneAddLine"),ie()||a.resetToCheckpoint("initial");let Ke=A.center(),dt=gn(Ke,l.center());return dt>0&&e.hide(),l.setCenterZoomAsync(Ke,19,dt).then(()=>new Promise((Lt,Yt)=>{Z=Yt,e.reveal({revealExtent:A,tipHtml:lt(t,"intro.lines.update_line"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>Lt(be)})}))}function be(){return t.enter("browse"),ie()?new Promise((Ke,dt)=>{Z=dt,X=Yt=>{["browse","select-osm"].includes(Yt.id)||dt()},ce=Yt=>{Yt&&Yt.created().length===1?Ke(ge):dt()};let Lt=t.lastPointerType==="mouse"?"":"_touch";e.reveal({revealExtent:new mt(M).padByMeters(15),tipHtml:lt(t,`intro.lines.add_node${Lt}`)})}).finally(()=>{X=null,ce=null}):Promise.resolve(je)}function ge(){if(!ie())return Promise.resolve(je);let Ke;return new Promise((dt,Lt)=>{Z=Lt;let Yt=t.lastPointerType==="mouse"?"":"_touch",Kt=lt(t,`intro.lines.start_drag_endpoint${Yt}`)+lt(t,"intro.lines.drag_to_intersection");e.reveal({revealExtent:new mt(k).padByMeters(20),tipHtml:Kt}),Ke=()=>{if(!ie())Lt();else{let Fi=t.entity(T);fr(Fi.loc,k)<=4&&dt(xe)}},o.on("move",Ke)}).finally(()=>{Ke&&o.off("move",Ke)})}function xe(){if(!ie())return Promise.resolve(je);let Ke;return new Promise((dt,Lt)=>{Z=Lt,X=()=>dt(Pe);let Yt=t.lastPointerType==="mouse"?"":"_touch",Kt=lt(t,"intro.lines.spot_looks_good")+lt(t,`intro.lines.finish_drag_endpoint${Yt}`);e.reveal({revealExtent:new mt(k).padByMeters(20),tipHtml:Kt}),Ke=()=>{if(!ie())Lt();else{let Fi=t.entity(T);fr(Fi.loc,k)>4&&dt(ge)}},o.on("move",Ke)}).finally(()=>{X=null,Ke&&o.off("move",Ke)})}function Pe(){return ie()?(ne()||t.enter("select-osm",{selectedIDs:[b]}),new Promise((Ke,dt)=>{Z=dt,X=dt,ce=Lt=>{Lt&&Lt.created().length===1&&Ke(Oe)},e.reveal({revealExtent:new mt(F).padByMeters(20),tipHtml:lt(t,"intro.lines.start_drag_midpoint")})}).finally(()=>{X=null,ce=null})):Promise.resolve(je)}function Oe(){return ie()?new Promise((Ke,dt)=>{Z=dt,e.reveal({revealExtent:A,tipHtml:lt(t,"intro.lines.continue_drag_midpoint"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>{a.setCheckpoint("doneUpdateLine"),Ke(Ie)}})}):Promise.resolve(je)}function Ie(){t.enter("browse"),a.resetToCheckpoint("doneUpdateLine"),me()||a.resetToCheckpoint("initial");let Ke=$.center(),dt=gn(Ke,l.center());return dt>0&&e.hide(),l.setCenterZoomAsync(Ke,18,dt).then(()=>new Promise((Lt,Yt)=>{Z=Yt,e.reveal({revealExtent:$,tipHtml:lt(t,"intro.lines.delete_lines",{street:t.t("intro.graph.name.12th-avenue")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>Lt(nt)})}))}function nt(){return t.enter("browse"),a.resetToCheckpoint("doneUpdateLine"),me()||a.resetToCheckpoint("initial"),de=null,new Promise((Ke,dt)=>{Z=dt,ce=dt;let Lt=t.lastPointerType==="mouse"?"rightclick_intersection":"edit_menu_intersection_touch",Yt=lt(t,"intro.lines.split_street",{street1:t.t("intro.graph.name.11th-avenue"),street2:t.t("intro.graph.name.washington-street")})+lt(t,`intro.lines.${Lt}`);e.reveal({revealExtent:new mt(q).padByMeters(10),tipHtml:Yt}),s.on("toggled.intro",Kt=>{Kt&&Ke(ht)})}).finally(()=>{ce=null,s.on("toggled.intro",null)})}function ht(){return n.select(".edit-menu-item-split").node()?(de=null,Pr().then(()=>new Promise((dt,Lt)=>{if(Z=Lt,!me()){dt(Ie);return}He()||t.enter("select-osm",{selectedIDs:[U]});let Yt=(Kt=0)=>{let Fi=n.select(".edit-menu").node();Fi?e.reveal({duration:Kt,revealNode:Fi,revealPadding:50,tipHtml:lt(t,"intro.lines.split_intersection",{street:t.t("intro.graph.name.washington-street")})}):Lt()};X=Lt,ce=Kt=>{Q=null,ce=null,Kt&&Kt.created()?(de=Kt.created()[0].id,dt()):Lt()},Q=Yt,Yt(250)})).then(Pr).then(()=>a.undoAnnotation()===t.t("operations.split.annotation.line",{n:1})?hi:Ht).finally(()=>{X=null,ce=null,Q=null})):Promise.resolve(nt)}function Ht(){return t.enter("browse"),new Promise((Ke,dt)=>{Z=dt,e.reveal({revealExtent:$,tipHtml:lt(t,"intro.lines.retry_split"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>Ke(nt)})})}function hi(){return me()?De()?new Promise((Ke,dt)=>{Z=dt,X=()=>Ke(at),ce=dt;let Yt="intro.lines.did_split_"+(t.selectedIDs().length>1?"multi":"single"),Kt=t.t("intro.graph.name.washington-street");e.reveal({revealExtent:$,tipHtml:lt(t,Yt,{street1:Kt,street2:Kt})})}).finally(()=>{X=null,ce=null}):Promise.resolve(nt):Promise.resolve(Ie)}function at(){if(!me())return Promise.resolve(Ie);if(!De())return Promise.resolve(nt);let Ke=t.selectedIDs(),dt=Ke.indexOf(de)!==-1,Lt=Ke.indexOf(B)!==-1;if(dt&&Lt)return Promise.resolve(Ot);if(!dt&&!Lt)return Promise.resolve(hi);let Yt,Kt;dt?(Yt=t.t("intro.graph.name.washington-street"),Kt=t.t("intro.graph.name.12th-avenue")):(Yt=t.t("intro.graph.name.12th-avenue"),Kt=t.t("intro.graph.name.washington-street"));let Fi=t.lastPointerType==="mouse"?"click":"touch",Ir=lt(t,"intro.lines.multi_select",{selected:Yt,other1:Kt})+" "+lt(t,`intro.lines.add_to_selection_${Fi}`,{selected:Yt,other2:Kt});return e.reveal({revealExtent:$,tipHtml:Ir}),new Promise((Qi,ys)=>{Z=ys,X=ys,ce=ys}).finally(()=>{X=null,ce=null})}function Ot(){if(!me())return Promise.resolve(Ie);if(!De())return Promise.resolve(nt);let Ke=t.selectedIDs(),dt=Ke.indexOf(de)!==-1,Lt=Ke.indexOf(B)!==-1;return!dt||!Lt?Promise.resolve(at):new Promise((Yt,Kt)=>{Z=Kt,X=Kt,ce=Kt;let Fi=t.lastPointerType==="mouse"?"rightclick":"edit_menu_touch",Ir=lt(t,"intro.lines.multi_select_success")+lt(t,`intro.lines.multi_${Fi}`);e.reveal({revealExtent:$,tipHtml:Ir}),s.on("toggled.intro",Qi=>{Qi&&Yt(Pt)})}).finally(()=>{X=null,ce=null,s.on("toggled.intro",null)})}function Pt(){return n.select(".edit-menu-item-delete").node()?Pr().then(()=>new Promise((dt,Lt)=>{if(Z=Lt,!me()){dt(Ie);return}if(!De()){dt(nt);return}let Yt=t.selectedIDs(),Kt=Yt.indexOf(de)!==-1,Fi=Yt.indexOf(B)!==-1;if(!Kt||!Fi){dt(at);return}let Ir=(Qi=0)=>{let ys=n.select(".edit-menu").node();ys?e.reveal({duration:Qi,revealNode:ys,revealPadding:50,tipHtml:lt(t,"intro.lines.multi_delete")}):Lt()};X=Qi=>{Qi.id==="browse"&&!t.hasEntity(de)&&!t.hasEntity(B)?dt(ji):dt(at)},ce=()=>{ce=null,X=null,!t.hasEntity(de)&&!t.hasEntity(B)?dt(ji):dt(Zi)},Q=Ir,Ir(250)})).finally(()=>{X=null,ce=null,Q=null}):Promise.resolve(at)}function Zi(){return t.enter("browse"),new Promise((Ke,dt)=>{Z=dt,e.reveal({revealExtent:$,tipHtml:lt(t,"intro.lines.retry_delete"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>Ke(at)})})}function ji(){return i.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-building",tipHtml:lt(t,"intro.lines.play",{next:t.t("intro.buildings.title")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{W=!1,Z=null,Q=null,X=null,ce=null,t.on("modechange",dt),l.on("move",Ke),a.on("change",Lt),Je(ot).catch(Yt=>{Yt instanceof Error&&console.error(Yt)}).finally(()=>{t.off("modechange",dt),l.off("move",Ke),a.off("change",Lt)});function Ke(){typeof Q=="function"&&Q()}function dt(Yt){typeof X=="function"&&X(Yt)}function Lt(Yt){typeof ce=="function"&&ce(Yt)}},r.exit=()=>{W=!0,Z&&(Z(),Z=null)},r.restart=()=>{r.exit(),r.enter()},$t(r,i,"on")}function dO(t,e){let i=Mt("done"),r={title:"intro.buildings.title"},s=t.systems.ui.editMenu,n=t.container(),o=t.systems.edits,a=t.systems.map,l=t.systems.presets,u=new mt([-85.62836,41.95622],[-85.62791,41.95654]),d=new mt([-85.62766,41.95324],[-85.62695,41.95372]),m=l.item("category-building"),g=l.item("building/house"),_=l.item("man_made/storage_tank"),v=!1,E=null,b=null,T=null,A=null,M=null,k=null;function F(){return M&&t.hasEntity(M)}function O(){if(t.mode?.id!=="select-osm")return!1;let ct=t.selectedIDs();return ct.length===1&&ct[0]===M}function B(){return k&&t.hasEntity(k)}function U(){if(t.mode?.id!=="select-osm")return!1;let ct=t.selectedIDs();return ct.length===1&&ct[0]===k}function $(ct){return v?Promise.reject():typeof ct!="function"?Promise.resolve():ct().then(Se=>$(Se)).catch(Se=>(Se instanceof Error&&console.error(Se),$(ct)))}function q(){t.enter("browse"),o.resetToCheckpoint("initial"),M=null;let ct=u.center(),Se=gn(ct,a.center());return Se>0&&e.hide(),a.setCenterZoomAsync(ct,19,Se).then(()=>new Promise((Qe,xt)=>{E=xt,T=()=>Qe(W),e.reveal({revealSelector:"button.draw-area",tipHtml:lt(t,"intro.buildings.add_building")}).selectAll(".popover-inner").insert("svg","span").attr("class","tooltip-illustration").append("use").attr("xlink:href","#rapid-graphic-buildings")})).finally(()=>{T=null})}function W(){return M=null,a.setCenterZoomAsync(u.center(),20,200).then(()=>new Promise((ct,Se)=>{if(E=Se,t.mode?.id!=="draw-area"){ct(q);return}T=Se,A=It=>{if(It)for(let Gt of It.created())Gt.type==="way"&&(M=Gt.id,ct(Z))};let Qe=t.lastPointerType==="mouse"?"click":"tap",xt=lt(t,"intro.buildings.start_building")+lt(t,`intro.buildings.building_corner_${Qe}`);e.reveal({revealExtent:u,tipHtml:xt})})).finally(()=>{T=null,A=null})}function Z(){return!F()||t.mode?.id!=="draw-area"?Promise.resolve(q):new Promise((ct,Se)=>{E=Se,T=()=>{if(F()&&O()){let It=t.graph(),Gt=t.entity(M),Ni=It.childNodes(Gt),je=Ei(Ni).map(be=>t.projection.project(be.loc));oO(je)?ct(X):ct(Q)}else Se()};let Qe=t.lastPointerType==="mouse"?"click":"tap",xt=lt(t,"intro.buildings.continue_building")+"{br}"+lt(t,`intro.areas.finish_area_${Qe}`)+lt(t,"intro.buildings.finish_building");e.reveal({revealExtent:u,tipHtml:xt})}).finally(()=>{T=null})}function Q(){return new Promise((ct,Se)=>{E=Se,e.reveal({revealExtent:u,tipHtml:lt(t,"intro.buildings.retry_building"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>ct(q)})})}function X(){return Pr().then(()=>new Promise((ct,Se)=>{if(E=Se,!F()){ct(q);return}O()||t.enter("select-osm",{selectedIDs:[M]}),T=Se,Dl(n),n.select(".inspector-wrap").on("wheel.intro",$s);let Qe=n.select(".preset-category-building .preset-list-button");e.reveal({revealNode:Qe.node(),revealPadding:5,tipHtml:lt(t,"intro.buildings.choose_category_building",{category:m.name()})}),Qe.on("click.intro",()=>ct(ce))})).finally(()=>{T=null,n.select(".inspector-wrap").on("wheel.intro",null),n.select(".preset-list-button").on("click.intro",null)})}function ce(){return Pr().then(()=>new Promise((ct,Se)=>{if(E=Se,!F()){ct(q);return}O()||t.enter("select-osm",{selectedIDs:[M]}),T=Se,A=xt=>{if(!xt)return;let It=xt.modified();It.length===1&&(l.match(It[0],t.graph())===g?ct(de):ct(X))},Dl(n),n.select(".inspector-wrap").on("wheel.intro",$s);let Qe=n.select(".preset-building-house .preset-list-button");e.reveal({revealNode:Qe.node(),revealPadding:5,tipHtml:lt(t,"intro.buildings.choose_preset_house",{preset:g.name()})})})).finally(()=>{T=null,A=null,n.select(".inspector-wrap").on("wheel.intro",null),n.select(".preset-list-button").on("click.intro",null)})}function de(){if(!F())return Promise.resolve(q);let ct=t.entity(M),Se=l.match(ct,t.graph());return t.replace(ja(M,Se,g)),o.setCheckpoint("hasHouse"),Promise.resolve(le)}function le(){["browse","select-osm"].includes(t.mode?.id)||t.enter("browse"),o.resetToCheckpoint("hasHouse");let ct=Math.max(a.zoom(),20);return a.setCenterZoomAsync(u.center(),ct,100).then(()=>new Promise((Se,Qe)=>{E=Qe,A=Qe;let xt=t.lastPointerType==="mouse"?"rightclick_building":"edit_menu_building_touch";e.reveal({revealExtent:u,tipHtml:lt(t,`intro.buildings.${xt}`)}),s.on("toggled.intro",It=>{It&&Se(te)})})).finally(()=>{A=null,s.on("toggled.intro",null)})}function te(){return n.select(".edit-menu-item-orthogonalize").node()?Pr().then(()=>new Promise((Se,Qe)=>{if(E=Qe,!F()||!O()){Se(le);return}let xt=(It=0)=>{let Gt=n.select(".edit-menu").node();Gt?e.reveal({duration:It,revealNode:Gt,revealPadding:50,tipHtml:lt(t,"intro.buildings.square_building")}):Qe()};T=Qe,A=()=>{A=null,b=null,e.reveal({revealExtent:u}),Se()},b=xt,xt(250)})).then(Pr).then(()=>o.undoAnnotation()===t.t("operations.orthogonalize.annotation.feature",{n:1})?oe:ee).finally(()=>{b=null,T=null,A=null}):Promise.resolve(le)}function ee(){return t.enter("browse"),new Promise((ct,Se)=>{E=Se,e.reveal({revealExtent:u,tipHtml:lt(t,"intro.buildings.retry_square"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>ct(le)})})}function oe(){return o.setCheckpoint("doneSquare"),new Promise((ct,Se)=>{E=Se,e.reveal({revealExtent:u,tipHtml:lt(t,"intro.buildings.done_square"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>ct(ie)})})}function ie(){t.enter("browse"),o.resetToCheckpoint("doneSquare"),k=null;let ct=d.center(),Se=gn(ct,a.center());return Se>0&&e.hide(),a.setCenterZoomAsync(ct,19.5,Se).then(()=>new Promise((Qe,xt)=>{E=xt,T=()=>Qe(ne),e.reveal({revealSelector:"button.draw-area",tipHtml:lt(t,"intro.buildings.add_tank")})})).finally(()=>{T=null})}function ne(){return t.mode?.id!=="draw-area"?Promise.resolve(ie):(k=null,new Promise((ct,Se)=>{E=Se,T=Se,A=It=>{if(It)for(let Gt of It.created())Gt.type==="way"&&(k=Gt.id,ct(me))};let Qe=t.lastPointerType==="mouse"?"click":"tap",xt=lt(t,"intro.buildings.start_tank")+lt(t,`intro.buildings.tank_edge_${Qe}`);e.reveal({revealExtent:d,tipHtml:xt})}).finally(()=>{T=null,A=null}))}function me(){return t.mode?.id!=="draw-area"?Promise.resolve(ie):new Promise((ct,Se)=>{E=Se,T=()=>{B()&&U()?ct(De):Se()};let Qe=t.lastPointerType==="mouse"?"click":"tap",xt=lt(t,"intro.buildings.continue_tank")+"{br}"+lt(t,`intro.areas.finish_area_${Qe}`)+lt(t,"intro.buildings.finish_tank");e.reveal({revealExtent:d,tipHtml:xt})}).finally(()=>{T=null})}function De(){return Pr().then(()=>new Promise((ct,Se)=>{if(E=Se,!B()){ct(ie);return}U()||t.enter("select-osm",{selectedIDs:[k]}),T=Se,A=xt=>{if(!xt)return;let It=xt.modified();It.length===1&&(l.match(It[0],t.graph())===_?ct(He):Se())},n.select(".inspector-wrap").on("wheel.intro",$s),Dl(n),e.reveal({revealSelector:".preset-search-input",tipHtml:lt(t,"intro.buildings.search_tank",{preset:_.name()})}),n.select(".preset-search-input").on("keydown.intro",null).on("keyup.intro",Qe);function Qe(){let xt=n.select(".preset-list-item:first-child");xt.classed("preset-man_made-storage_tank")&&(e.reveal({revealNode:xt.select(".preset-list-button").node(),revealPadding:5,tipHtml:lt(t,"intro.buildings.choose_tank",{preset:_.name()})}),n.select(".preset-search-input").on("keydown.intro",$s,!0).on("keyup.intro",null))}})).finally(()=>{T=null,A=null,n.select(".inspector-wrap").on("wheel.intro",null),n.select(".preset-search-input").on("keydown.intro keyup.intro",null)})}function He(){if(!B())return Promise.resolve(ie);let ct=t.entity(k),Se=l.match(ct,t.graph());return t.replace(ja(k,Se,_)),o.setCheckpoint("hasTank"),Promise.resolve(Je)}function Je(){return["browse","select-osm"].includes(t.mode?.id)||t.enter("browse"),o.resetToCheckpoint("hasTank"),new Promise((ct,Se)=>{E=Se,A=Se;let Qe=t.lastPointerType==="mouse"?"rightclick_tank":"edit_menu_tank_touch";e.reveal({revealExtent:d,tipHtml:lt(t,`intro.buildings.${Qe}`)}),s.on("toggled.intro",xt=>{xt&&ct(ot)})}).finally(()=>{A=null,s.on("toggled.intro",null)})}function ot(){return n.select(".edit-menu-item-circularize").node()?Pr().then(()=>new Promise((Se,Qe)=>{if(E=Qe,!B()||!U()){Se(Je);return}T=Qe;let xt=(It=0)=>{let Gt=n.select(".edit-menu").node();Gt?e.reveal({duration:It,revealNode:Gt,revealPadding:50,tipHtml:lt(t,"intro.buildings.circle_tank")}):Qe()};A=()=>{b=null,A=null,e.reveal({revealExtent:d}),Se()},b=xt,xt(250)})).then(Pr).then(()=>o.undoAnnotation()===t.t("operations.circularize.annotation.feature",{n:1})?vt:gt).finally(()=>{b=null,T=null,A=null}):Promise.resolve(Je)}function gt(){return t.enter("browse"),new Promise((ct,Se)=>{E=Se,e.reveal({revealExtent:d,tipHtml:lt(t,"intro.buildings.retry_circle"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>ct(Je)})})}function vt(){return i.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-rapid",tipHtml:lt(t,"intro.buildings.play",{next:t.t("intro.rapid.title")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{v=!1,E=null,b=null,T=null,A=null,t.on("modechange",Se),a.on("move",ct),o.on("change",Qe),$(q).catch(xt=>{xt instanceof Error&&console.error(xt)}).finally(()=>{t.off("modechange",Se),a.off("move",ct),o.off("change",Qe)});function ct(){typeof b=="function"&&b()}function Se(xt){typeof T=="function"&&T(xt)}function Qe(xt){typeof A=="function"&&A(xt)}},r.exit=()=>{v=!0,E&&(E(),E=null)},r.restart=()=>{r.exit(),r.enter()},$t(r,i,"on")}function fO(t,e){let i=Mt("done","startEditing"),r={title:"intro.startediting.title"},s=t.container(),n=!1,o=null;function a(g){return n?Promise.reject():typeof g!="function"?Promise.resolve():g().then(_=>a(_)).catch(_=>(_ instanceof Error&&console.error(_),a(g)))}function l(){return new Promise((g,_)=>{o=_,e.reveal({revealSelector:".map-control.help-control",tipHtml:lt(t,"intro.startediting.help"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>g(u)})})}function u(){return new Promise((g,_)=>{o=_,e.reveal({revealSelector:".map-control.help-control",tipHtml:lt(t,"intro.startediting.shortcuts"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>g(d)})})}function d(){return s.selectAll(".shaded").remove(),new Promise((g,_)=>{o=_,e.reveal({revealSelector:".top-toolbar button.save",tipHtml:lt(t,"intro.startediting.save"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>g(m)})})}function m(){s.selectAll(".shaded").remove();let g=ws(s);return g.select(".modal").attr("class","modal-splash modal"),g.selectAll(".close").remove(),new Promise((_,v)=>{o=v,i.call("startEditing");let E=g.select(".content").attr("class","fillL").append("button").attr("class","modal-section huge-modal-button").on("click",_);E.append("svg").attr("class","illustration").append("use").attr("xlink:href","#rapid-logo-walkthrough"),E.append("h2").html(t.tHtml("intro.startediting.start"))}).finally(()=>{g.remove()})}return r.enter=()=>{n=!1,o=null,a(l).catch(g=>{g instanceof Error&&console.error(g)})},r.exit=()=>{s.selectAll(".shaded").remove(),n=!0,o&&(o(),o=null)},$t(r,i,"on")}function pO(t,e){let i=Mt("done"),r={title:"intro.rapid.title"},s=t.systems.edits,n=t.systems.map,o="w-516",a=new mt([-85.62991,41.95568],[-85.627,41.95638]),l=!1,u=null,d=null;function m(){if(!["select","select-osm"].includes(t.mode?.id))return!1;let W=t.selectedIDs();return W.length===1&&W[0]===o}function g(){return t.hasEntity(o)}function _(W){return l?Promise.reject():typeof W!="function"?Promise.resolve():W().then(Z=>_(Z)).catch(Z=>(Z instanceof Error&&console.error(Z),_(W)))}function v(){t.enter("browse"),s.resetToCheckpoint("initial");let W=a.center(),Z=gn(W,n.center());return Z>0&&e.hide(),n.setCenterZoomAsync(W,18.5,Z).then(()=>new Promise((Q,X)=>{u=X,e.reveal({revealSelector:".intro-nav-wrap .chapter-rapid",tipHtml:lt(t,"intro.rapid.start",{rapid:pi("#rapid-logo-rapid-wordmark","pre-text rapid")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>Q(E)})}))}function E(){return new Promise((W,Z)=>{u=Z,e.reveal({revealSelector:"button.rapid-features",tipHtml:lt(t,"intro.rapid.ai_roads",{rapid:pi("#rapid-logo-rapid-wordmark","pre-text rapid")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>W(b)})})}function b(){return t.enter("browse"),s.resetToCheckpoint("initial"),t.scene().enableLayers("rapid"),t.systems.ui.togglePanes(),new Promise((W,Z)=>{u=Z,d=()=>W(T),ye(".inspector-wrap").on("wheel.intro",$s),e.reveal({revealExtent:a,tipHtml:lt(t,"intro.rapid.select_road")})}).finally(()=>{d=null,ye(".inspector-wrap").on("wheel.intro",null)})}function T(){return Pr().then(()=>new Promise((W,Z)=>{if(u=Z,!m()){W();return}d=W,e.reveal({revealSelector:".rapid-inspector-choice-accept",tipHtml:lt(t,"intro.rapid.add_road")})})).then(()=>s.undoAnnotation()?.type==="rapid_accept_feature"?A:b).finally(()=>{d=null})}function A(){return Pr().then(()=>new Promise((W,Z)=>{if(u=Z,!g()){W(b);return}m()||t.enter("select-osm",{selectedIDs:[o]}),d=Z,e.reveal({revealExtent:a,tipHtml:lt(t,"intro.rapid.add_road_not_saved_yet",{rapid:pi("#rapid-logo-rapid-wordmark","pre-text rapid")}),buttonText:t.t("intro.ok"),buttonCallback:()=>W(M)})})).finally(()=>{d=null})}function M(){if(!g())return Promise.resolve(b);m()||t.enter("select-osm",{selectedIDs:[o]});let W=ye("div.map-control.issues-control > button");return new Promise((Z,Q)=>{u=Q,d=Q,e.reveal({revealNode:W.node(),tipHtml:lt(t,"intro.rapid.open_issues")}),W.on("click.intro",()=>Z(k))}).finally(()=>{d=null,W.on("click.intro",null)})}function k(){return Pr().then(()=>new Promise((W,Z)=>{if(u=Z,!g()){W(b);return}m()||t.enter("select-osm",{selectedIDs:[o]});let Q=ye("li.issue.severity-warning");e.reveal({revealNode:Q.node(),revealPadding:5,tipHtml:lt(t,"intro.rapid.new_lints"),buttonText:t.t("intro.ok"),buttonCallback:()=>W(F)})}))}function F(){if(!g())return Promise.resolve(b);m()||t.enter("select-osm",{selectedIDs:[o]});let W=ye(".top-toolbar button.undo-button");return new Promise((Z,Q)=>{u=Q,e.reveal({revealNode:W.node(),tipHtml:lt(t,"intro.rapid.undo_road_add",{button:pi("#rapid-icon-undo","pre-text")})}),W.on("click.intro",()=>Z(O))}).finally(()=>{W.on("click.intro",null)})}function O(){return g()?Promise.resolve(b):(t.systems.ui.togglePanes(),new Promise((W,Z)=>{u=Z,e.reveal({revealExtent:a,tipHtml:lt(t,"intro.rapid.undo_road_add_aftermath"),buttonText:t.t("intro.ok"),buttonCallback:()=>W(B)})}))}function B(){t.enter("browse"),s.resetToCheckpoint("initial");let W=a.center(),Z=gn(W,n.center());return Z>0&&e.hide(),n.setCenterZoomAsync(W,18.5,Z).then(()=>new Promise((Q,X)=>{u=X,d=()=>{t.selectedIDs().includes(o)&&Q(U)},e.reveal({revealExtent:a,tipHtml:lt(t,"intro.rapid.select_road_again")})})).finally(()=>{d=null})}function U(){return Pr().then(()=>new Promise((W,Z)=>{if(u=Z,!m()){W();return}d=W,e.reveal({revealSelector:".rapid-inspector-choice-ignore",tipHtml:lt(t,"intro.rapid.ignore_road")})})).then(()=>s.undoAnnotation()?.type==="rapid_ignore_feature"?$:B).finally(()=>{d=null})}function $(){return new Promise((W,Z)=>{u=Z,e.reveal({revealSelector:".map-control.help-control",tipHtml:lt(t,"intro.rapid.help",{rapid:pi("#rapid-logo-rapid-wordmark","pre-text rapid"),button:pi("#rapid-icon-help","pre-text"),key:t.t("help.key")}),buttonText:t.t("intro.ok"),buttonCallback:()=>W(q)})})}function q(){return i.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-startEditing",tipHtml:lt(t,"intro.rapid.done",{next:t.t("intro.startediting.title")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{t.scene().enableLayers("rapid"),l=!1,u=null,d=null,t.on("modechange",W),_(v).catch(Z=>{Z instanceof Error&&console.error(Z)}).finally(()=>{t.off("modechange",W)});function W(Z){typeof d=="function"&&d(Z)}},r.exit=()=>{t.scene().disableLayers("rapid"),l=!0,u&&(u(),u=null)},r.restart=()=>{r.exit(),r.enter()},$t(r,i,"on")}var HQ="EsriWorldImageryClarity",VQ={welcome:aO,navigation:lO,point:cO,area:uO,line:hO,building:dO,rapid:pO,startEditing:fO},x6=["welcome","navigation","point","area","line","building","rapid","startEditing"];function dc(t,e){let i={},r={},s;function n(a){let l=t.systems.data;Promise.all([l.getDataAsync("intro_rapid_graph"),l.getDataAsync("intro_graph")]).then(u=>{let d=u[0],m=u[1];for(let[g,_]of Object.entries(d))r[g]||(r[g]=Dt(SS(t,_)));for(let[g,_]of Object.entries(m))i[g]||(i[g]=Dt(SS(t,_)));a.call(o)})}function o(a){let l=t.systems.edits,u=t.systems.imagery,d=t.systems.l10n,m=t.services.mapwithai,g=t.services.osm,_=t.systems.storage,v=t.systems.rapid,E=t.systems.urlhash;E.disable(),t.inIntro=!0,t.enter("browse");let b={hash:window.location.hash,transform:t.systems.map.transform(),brightness:u.brightness,baseLayer:u.baseLayerSource(),overlayLayers:u.overlayLayerSources(),layersEnabled:new Set,datasetsEnabled:new Set,edits:l.toJSON()};for(let[q,W]of t.scene().layers)W.enabled&&b.layersEnabled.add(q);t.scene().onlyLayers(["background","osm","labels"]),t.systems.ui.sidebar.expand(),t.container().selectAll("button.sidebar-toggle").classed("disabled",!0),g&&g.toggle(!1),l.reset(),l.merge(Object.values(i)),l.setCheckpoint("initial");let T=u.getSource(HQ)||u.getSource("Bing");u.baseLayerSource(T),b.overlayLayers.forEach(q=>u.toggleOverlayLayer(q)),u.brightness=1;for(let[q,W]of v.datasets)W.enabled&&(b.datasetsEnabled.add(q),W.enabled=!1);v.datasets.set("rapid_intro_graph",{id:"rapid_intro_graph",beta:!1,added:!0,enabled:!0,conflated:!1,service:"mapwithai",color:"#da26d3",label:"Rapid Walkthrough"}),m&&(m.toggle(!1),m.merge("rapid_intro_graph",Object.values(r)));let A=new L_(t);a.call(A.enable),_.setItem("walkthrough_started","yes");let k=(_.getItem("walkthrough_progress")||"").split(";").filter(Boolean),F=x6.map((q,W)=>{let Z=VQ[q](t,A).on("done",()=>{if(U.filter(Q=>Q.title===Z.title).classed("finished",!0),W<x6.length-1){let Q=x6[W+1];t.container().select(`button.chapter-${Q}`).classed("next",!0)}k.push(q),_.setItem("walkthrough_progress",Ei(k).join(";"))});return Z});F[F.length-1].on("startEditing",()=>{k.push("startEditing"),_.setItem("walkthrough_progress",Ei(k).join(";")),_n(x6,k).length||_.setItem("walkthrough_completed","yes");for(let[W,Z]of v.datasets)Z.enabled=b.datasetsEnabled.has(W);v.datasets.delete("rapid_intro_graph"),A.disable(),O.remove(),t.container().selectAll("button.sidebar-toggle").classed("disabled",!1);for(let[W,Z]of t.scene().layers)Z.enabled=b.layersEnabled.has(W);u.baseLayerSource(b.baseLayer),b.overlayLayers.forEach(W=>u.toggleOverlayLayer(W)),u.brightness=b.brightness,t.systems.map.transform(b.transform),window.location.replace(b.hash),t.resetAsync().then(()=>{b.edits&&l.fromJSON(b.edits,!0),g&&g.toggle(!0),m&&m.toggle(!0),t.inIntro=!1,E.enable()})});let O=a.append("div").attr("class","intro-nav-wrap fillD");O.append("svg").attr("class","intro-nav-wrap-logo").append("use").attr("xlink:href","#rapid-logo-walkthrough");let U=O.append("div").attr("class","joined").selectAll("button.chapter").data(F).enter().append("button").attr("class",(q,W)=>`chapter chapter-${x6[W]}`).on("click",$);U.append("span").html(q=>d.tHtml(q.title)),U.append("span").attr("class","status").call(Ye(d.isRTL()?"#rapid-icon-backward":"#rapid-icon-forward","inline")),$(null,F[e?6:0]);function $(q,W){s&&s.exit(),t.enter("browse"),s=W,s.enter(),U.classed("next",!1).classed("active",Z=>Z.title===s.title)}}return n}var Jc=class{constructor(e){this.context=e,this._enabled=!1}enable(){this._enabled=!0}disable(){this._enabled=!1}get enabled(){return this._enabled}};var mO=["zoom","vintage","source","description","resolution","accuracy"],v6=class extends Jc{constructor(e){super(e),this.id="background",this.label=e.tHtml("info_panels.background.title"),this.key=e.t("info_panels.background.key"),this._selection=ye(null),this._currSourceID=null,this._metadata={},this.render=this.render.bind(this),this.updateMetadata=this.updateMetadata.bind(this),this._deferredRender=Ur(this.render,250),this._deferredUpdateMetadata=Ur(this.updateMetadata,250)}enable(e){this._enabled||(this._enabled=!0,this._selection=e,this._currSourceID=null,this._metadata={},this.context.systems.map.on("draw",this._deferredRender).on("move",this._deferredUpdateMetadata))}disable(){this._enabled&&(this._deferredRender.cancel(),this._deferredUpdateMetadata.cancel(),this._selection.html(""),this._enabled=!1,this._selection=ye(null),this._currSourceID=null,this._metadata={},this.context.systems.map.off("draw",this._deferredRender).off("move",this._deferredUpdateMetadata))}render(){if(!this._enabled)return;let e=this.context,i=this._selection,s=e.systems.imagery.baseLayerSource();if(!s)return;this._currSourceID!==s.id&&(this._currSourceID=s.id,this._metadata={}),i.html("");let n=i.append("ul").attr("class","background-info");n.append("li").html(s.label),mO.forEach(a=>{n.append("li").attr("class",`background-info-list-${a}`).classed("hide",!this._metadata[a]).html(e.tHtml(`info_panels.background.${a}`)+":").append("span").attr("class",`background-info-span-${a}`).text(this._metadata[a])}),this._deferredUpdateMetadata();let o=e.getDebug("tile")?"hide_tiles":"show_tiles";i.append("a").html(e.tHtml(`info_panels.background.${o}`)).attr("href","#").attr("class","button button-toggle-tiles").on("click",a=>{a.preventDefault(),e.setDebug("tile",!e.getDebug("tile")),this.render()})}updateMetadata(){if(!this._enabled)return;let e=this.context,i=this._selection,s=e.systems.imagery.baseLayerSource();if(!s)return;this._currSourceID!==s.id&&(this._currSourceID=s.id,this._metadata={});let n=e.systems.map.center(),o=new mt(n),l=e.scene().layers.get("background")?._tileMaps.get(s.id),u,d;if(l){for(let g of l.values())if(g.loaded&&g.wgs84Extent.contains(o)){u=g.xyz,d=g.xyz[2];break}}let m=d||Math.floor(e.systems.map.zoom());this._metadata.zoom=String(m),i.selectAll(".background-info-list-zoom").classed("hide",!1).selectAll(".background-info-span-zoom").text(this._metadata.zoom),u&&s.getMetadata(n,u,(g,_)=>{if(g||this._currSourceID!==s.id)return;let v=_.vintage;this._metadata.vintage=v&&v.range||e.t("info_panels.background.unknown"),i.selectAll(".background-info-list-vintage").classed("hide",!1).selectAll(".background-info-span-vintage").text(this._metadata.vintage),mO.forEach(E=>{if(E==="zoom"||E==="vintage")return;let b=_[E];this._metadata[E]=b,i.selectAll(`.background-info-list-${E}`).classed("hide",!b).selectAll(`.background-info-span-${E}`).text(b)})})}};var b6=class extends Jc{constructor(e){super(e),this.id="history",this.label=e.tHtml("info_panels.history.title"),this.key=e.t("info_panels.history.key"),this._selection=ye(null),this.render=this.render.bind(this),this.renderEntity=this.renderEntity.bind(this),this.renderNote=this.renderNote.bind(this),this.renderUser=this.renderUser.bind(this),this.renderChangeset=this.renderChangeset.bind(this),this.displayTimestamp=this.displayTimestamp.bind(this)}enable(e){this._enabled||(this._enabled=!0,this._selection=e,this.context.systems.map.on("draw",this.render),this.context.on("modechange",this.render))}disable(){this._enabled&&(this._selection.html(""),this._enabled=!1,this._selection=ye(null),this.context.systems.map.off("draw",this.render),this.context.off("modechange",this.render))}render(){if(!this._enabled)return;let e=this.context,i=this._selection;i.html("");let r,s,n;r=e.selectedIDs().filter(a=>e.hasEntity(a)),r.length&&(n=e.entity(r[0]));let o=r.length===1?r[0]:null;i.append("h4").attr("class","history-heading").html(o||e.tHtml("info_panels.selected",{n:r.length})),o&&(n?i.call(this.renderEntity,n):s&&i.call(this.renderNote,s))}renderNote(e,i){let r=this.context,s=r.services.osm;if(!i||i.isNew()){e.append("div").html(r.tHtml("info_panels.history.note_no_history"));return}let n=e.append("ul");n.append("li").html(r.tHtml("info_panels.history.note_comments")+":").append("span").html(i.comments.length),i.comments.length&&(n.append("li").html(r.tHtml("info_panels.history.note_created_date")+":").append("span").text(this.displayTimestamp(i.comments[0].date)),n.append("li").html(r.tHtml("info_panels.history.note_created_user")+":").call(this.renderUser,i.comments[0].user)),s&&e.append("a").attr("class","view-history-on-osm").attr("target","_blank").attr("href",s.noteURL(i)).call(Ye("#rapid-icon-out-link","inline")).append("span").html(r.tHtml("info_panels.history.note_link_text"))}renderEntity(e,i){let r=this.context,s=r.services.osm;if(!i||i.isNew()){e.append("div").html(r.tHtml("info_panels.history.no_history"));return}let n=e.append("div").attr("class","links");s&&n.append("a").attr("class","view-history-on-osm").attr("href",s.historyURL(i)).attr("target","_blank").attr("title",r.t("info_panels.history.link_text")).text("OSM"),n.append("a").attr("class","pewu-history-viewer-link").attr("href","https://pewu.github.io/osm-history/#/"+i.type+"/"+i.osmId()).attr("target","_blank").attr("tabindex",-1).text("PeWu");let o=e.append("ul");o.append("li").html(r.tHtml("info_panels.history.version")+":").append("span").text(i.version),o.append("li").html(r.tHtml("info_panels.history.last_edit")+":").append("span").text(this.displayTimestamp(i.timestamp)),o.append("li").html(r.tHtml("info_panels.history.edited_by")+":").call(this.renderUser,i.user),o.append("li").html(r.tHtml("info_panels.history.changeset")+":").call(this.renderChangeset,i.changeset)}displayTimestamp(e){let i=this.context;if(!e)return i.t("info_panels.history.unknown");let r={day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},s=new Date(e);if(isNaN(s.getTime()))return i.t("info_panels.history.unknown");let n=i.systems.l10n.localeCode();return s.toLocaleString(n,r)}renderUser(e,i){let r=this.context,s=r.services.osm;if(!i){e.append("span").html(r.tHtml("info_panels.history.unknown"));return}e.append("span").attr("class","user-name").html(i);let n=e.append("div").attr("class","links");s&&n.append("a").attr("class","user-osm-link").attr("href",s.userURL(i)).attr("target","_blank").text("OSM"),n.append("a").attr("class","user-hdyc-link").attr("href",`https://hdyc.neis-one.org/?${i}`).attr("target","_blank").attr("tabindex",-1).text("HDYC")}renderChangeset(e,i){let r=this.context,s=r.services.osm;if(!i){e.append("span").html(r.tHtml("info_panels.history.unknown"));return}e.append("span").attr("class","changeset-id").text(i);let n=e.append("div").attr("class","links");s&&n.append("a").attr("class","changeset-osm-link").attr("href",s.changesetURL(i)).attr("target","_blank").text("OSM"),n.append("a").attr("class","changeset-osmcha-link").attr("href",`https://osmcha.org/changesets/${i}`).attr("target","_blank").text("OSMCha"),n.append("a").attr("class","changeset-achavi-link").attr("href",`https://overpass-api.de/achavi/?changeset=${i}`).attr("target","_blank").text("Achavi")}};var w6=class extends Jc{constructor(e){super(e),this.id="location",this.label=e.tHtml("info_panels.location.title"),this.key=e.t("info_panels.location.key"),this._selection=ye(null),this._currLocation=null,this.render=this.render.bind(this),this.updateLocation=this.updateLocation.bind(this),this._deferredUpdateLocation=Ur(this.updateLocation,1e3)}enable(e){this._enabled||(this._enabled=!0,this._selection=e,this._currLocation=null,this.context.surface().on("pointermove.info-location",this.render))}disable(){this._enabled&&(this._deferredUpdateLocation.cancel(),this._selection.html(""),this._enabled=!1,this._selection=ye(null),this._currLocation=null,this.context.surface().on("pointermove.info-location",null))}render(){if(!this._enabled)return;let e=this.context,i=this._selection,r=e.systems.l10n;i.html("");let s=i.append("ul"),n=e.systems.map.mouseLoc();n.some(isNaN)&&(n=e.systems.map.center()),s.append("li").text(r.dmsCoordinatePair(n)).append("li").text(r.decimalCoordinatePair(n)),i.append("div").attr("class","location-info").text(this._currLocation||" "),this._deferredUpdateLocation(n)}updateLocation(e){if(!this._enabled)return;let i=this._selection,r=this.context,s=r.services.nominatim;s?s.reverse(e,(n,o)=>{this._currLocation=o?o.display_name:r.t("info_panels.location.unknown_location"),i.selectAll(".location-info").text(this._currLocation)}):(this._currLocation=r.t("info_panels.location.unknown_location"),i.selectAll(".location-info").text(this._currLocation))}};function jQ(t){return t*63710071809e-4}function XQ(t){return t/(4*Math.PI)*510065621724e3}function WQ(t){if(t.type==="LineString")return t;let e={type:"LineString",coordinates:[]};return t.type==="Polygon"?e.coordinates=t.coordinates[0]:t.type==="MultiPolygon"&&(e.coordinates=t.coordinates[0][0]),e}var E6=class extends Jc{constructor(e){super(e),this.id="measurement",this.label=e.tHtml("info_panels.measurement.title"),this.key=e.t("info_panels.measurement.key"),this._selection=ye(null),this._isImperial=!e.systems.l10n.usesMetric(),this.render=this.render.bind(this)}enable(e){this._enabled||(this._enabled=!0,this._selection=e,this.context.systems.map.on("draw",this.render),this.context.on("modechange",this.render))}disable(){this._enabled&&(this._selection.html(""),this._enabled=!1,this._selection=ye(null),this.context.systems.map.off("draw",this.render),this.context.off("modechange",this.render))}render(){if(!this._enabled)return;let e=this._selection,i=this.context,r=i.graph(),s=i.systems.l10n,n=s.localeCode();e.html("");let o,a,l,u,d,m,g,_=0,v=0,E,b=i.selectedIDs(),T=i.selectedData(),[A]=T.values();if(T.size===1&&A instanceof Fr){let F=A;o=s.t("note.note")+" "+F.id,l=F.loc,m="note"}else{let F=b.map(O=>i.hasEntity(O)).filter(Boolean);if(F.length===1?o=F[0].id:o=s.t("info_panels.selected",{n:F.length}),F.length>0){let O=new mt;F.forEach(B=>{let U=B.extent(r),$=B.asGeoJSON(r);O=O.extend(U),m=B.geometry(r),(m==="line"||m==="area")&&(d=B.type==="relation"||B.isClosed()&&!B.isDegenerate(),_+=jQ(Db(WQ($))),u=Mb($),(!u||!isFinite(u[0])||!isFinite(u[1]))&&(u=U.center()),d&&(v+=XQ(B.area(r))))}),F.length>1&&(m=null,d=null,u=null),F.length===2&&F[0].type==="node"&&F[1].type==="node"&&(E=fr(F[0].loc,F[1].loc)),F.length===1&&F[0].type==="node"?l=F[0].loc:g=ns(b,i.graph()).length,!l&&!u&&(a=O.center())}}o&&e.append("h4").attr("class","measurement-heading").text(o);let M=e.append("ul"),k;if(m&&M.append("li").html(s.tHtml("info_panels.measurement.geometry")+":").append("span").text(d?s.t("info_panels.measurement.closed_"+m):s.t("geometry."+m)),g&&M.append("li").html(s.tHtml("info_panels.measurement.node_count")+":").append("span").text(g.toLocaleString(n)),v&&M.append("li").html(s.tHtml("info_panels.measurement.area")+":").append("span").text(s.displayArea(v,this._isImperial)),_&&M.append("li").html(s.tHtml("info_panels.measurement."+(d?"perimeter":"length"))+":").append("span").text(s.displayLength(_,this._isImperial)),typeof E=="number"&&M.append("li").html(s.tHtml("info_panels.measurement.distance")+":").append("span").text(s.displayLength(E,this._isImperial)),l&&(k=M.append("li").html(s.tHtml("info_panels.measurement.location")+":"),k.append("span").text(s.dmsCoordinatePair(l)),k.append("span").text(s.decimalCoordinatePair(l))),u&&(k=M.append("li").html(s.tHtml("info_panels.measurement.centroid")+":"),k.append("span").text(s.dmsCoordinatePair(u)),k.append("span").text(s.decimalCoordinatePair(u))),a&&(k=M.append("li").html(s.tHtml("info_panels.measurement.center")+":"),k.append("span").text(s.dmsCoordinatePair(a)),k.append("span").text(s.decimalCoordinatePair(a))),_||v||typeof E=="number"){let F=this._isImperial?"imperial":"metric";e.append("a").html(s.tHtml(`info_panels.measurement.${F}`)).attr("href","#").attr("class","button button-toggle-units").on("click",O=>{O.preventDefault(),this._isImperial=!this._isImperial,this.render()})}}};function N_(t){let e={background:new v6(t),history:new b6(t),location:new w6(t),measurement:new E6(t)},i=Object.keys(e),r=new Set,s=new Set;function n(o){function a(){let u=l.selectAll(".panel-container").data(Array.from(r),g=>g);u.exit().style("opacity",1).transition().duration(200).style("opacity",0).on("end",(g,_,v)=>{let E=ye(v[_]);e[g].disable(),E.remove()});let d=u.enter().append("div").attr("class",g=>`fillD2 panel-container panel-container-${g}`);d.style("opacity",0).transition().duration(200).style("opacity",1);let m=d.append("div").attr("class","panel-title fillD2");m.append("h3").html(g=>e[g].label),m.append("button").attr("class","close").on("click",(g,_)=>{g.stopImmediatePropagation(),g.preventDefault(),n.toggle(_)}).call(Ye("#rapid-icon-close")),d.append("div").attr("class",g=>`panel-content panel-content-${g}`).each((g,_,v)=>{let E=ye(v[_]);e[g].enable(E)}),l.selectAll(".panel-content").each(g=>e[g].render())}n.toggle=function(u){u?r.has(u)?(r.delete(u),s.size>1&&s.delete(u)):(r.add(u),s.add(u)):r.size?r.clear():(s.size||s.add("measurement"),r=new Set(s)),i.forEach(d=>{t.container().selectAll(`.${d}-panel-toggle-item`).classed("active",r.has(d)).select("input").property("checked",r.has(d))}),a()};let l=o.selectAll(".info-panels").data([0]);l=l.enter().append("div").attr("class","info-panels").merge(l),a(),t.keybinding().on(Ri("\u2318"+t.t("info_panels.key")),u=>{u.stopImmediatePropagation(),u.preventDefault(),n.toggle()}),i.forEach(u=>{let d=t.t(`info_panels.${u}.key`,{default:null});d&&t.keybinding().on(Ri("\u2318\u21E7"+d),m=>{m.stopImmediatePropagation(),m.preventDefault(),n.toggle(u)})})}return n}function ra(t,e){let i=e.length===1?"single":"multiple",r=e.map(d=>t.hasEntity(d)).filter(Boolean),s=r.every(d=>d.isNew()),n=Hu(e),a=ns(e,t.graph()).map(d=>d.loc),l=Ar(r,t.graph()),u=function(){let d,m;if(r.length===1){let g=r[0],_=g.geometry(t.graph()),E=t.graph().parentWays(g)[0];if(_==="vertex"){let b=E.nodes,T=b.indexOf(g.id);if(T===0)T++;else if(T===b.length-1)T--;else{let A=fr(g.loc,t.entity(b[T-1]).loc),M=fr(g.loc,t.entity(b[T+1]).loc);T=A<M?T-1:T+1}d=t.entity(b[T]),m=d.loc}}t.perform(n,u.annotation()),t.systems.validator.validate(),d&&m?(t.systems.map.centerEase(m),t.enter("select-osm",{selectedIDs:[d.id]})):t.enter("browse")};return u.available=function(){return!0},u.disabled=function(){if(!s&&d())return"too_large";if(!s&&m())return"not_downloaded";if(e.some(t.hasHiddenConnections))return"connected_to_hidden";if(e.some(v))return"part_of_relation";if(e.some(_))return"incomplete_relation";if(e.some(g))return"has_wikidata_tag";return!1;function d(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&l.percentContainedIn(t.systems.map.extent())<.8}function m(){if(t.inIntro)return!1;let E=t.services.osm;if(E){let b=a.filter(T=>!E.isDataLoaded(T));if(b.length)return b.forEach(T=>t.loadTileAtLoc(T)),!0}return!1}function g(E){let b=t.entity(E);return b.tags.wikidata&&b.tags.wikidata.trim().length>0}function _(E){let b=t.entity(E);return b.type==="relation"&&!b.isComplete(t.graph())}function v(E){let b=t.entity(E);if(b.type!=="way")return!1;let T=t.graph().parentRelations(b);for(let A=0;A<T.length;A++){let M=T[A],k=M.tags.type,F=M.memberById(E).role||"outer";if(k==="route"||k==="boundary"||k==="multipolygon"&&F==="outer")return!0}return!1}},u.tooltip=function(){let d=u.disabled();return d?t.t(`operations.delete.${d}.${i}`):t.t(`operations.delete.description.${i}`)},u.annotation=function(){return e.length===1?t.t("operations.delete.annotation."+t.graph().geometry(e[0])):t.t("operations.delete.annotation.feature",{n:e.length})},u.id="delete",u.keys=[Ri("\u2318\u232B"),Ri("\u2318\u2326"),Ri("\u2326")],u.title=t.t("operations.delete.title"),u.behavior=new Er(t,u),u}function O_(t){var e=t.systems.l10n,i=t.systems.filters,r=t.systems.presets,s=Mt("cancel","choose"),n,o,a,l=!1;function u(b){if(!n)return;var T=r.matchAllGeometry(E());let A=e.isRTL();b.html("");var M=b.append("div").attr("class","header fillL"),k=M.append("h3").html(e.tHtml("inspector.choose"));M.append("button").attr("class","preset-choose").on("click",function(){s.call("cancel",this)}).call(Ye(A?"#rapid-icon-backward":"#rapid-icon-forward"));var F=b.append("div").attr("class","search-header");F.call(Ye("#rapid-icon-search","pre-text"));var O=F.append("input").attr("class","preset-search-input").attr("placeholder",e.t("inspector.search")).attr("type","search").call(ki).on("keydown",$).on("keypress",W).on("input",Ur(Z));l&&(O.node().focus(),setTimeout(function(){O.node().focus()},0));var B=b.append("div").attr("class","inspector-body"),U=B.append("div").attr("class","preset-list").call(d,r.defaults(E()[0],36,!t.inIntro,o));i.on("filterchange",v);function $(Q){O.property("value").length===0&&(Q.keyCode===zi.keyCodes["\u232B"]||Q.keyCode===zi.keyCodes["\u2326"])?(Q.preventDefault(),Q.stopPropagation(),ra(t,n)()):O.property("value").length===0&&(Q.ctrlKey||Q.metaKey)&&Q.keyCode===zi.keyCodes.z?(Q.preventDefault(),Q.stopPropagation(),t.undo()):!Q.ctrlKey&&!Q.metaKey&&(ye(this).on("keydown",q),q.call(this,Q))}function q(Q){if(Q.keyCode===zi.keyCodes["\u2193"]&&O.node().selectionStart===O.property("value").length){Q.preventDefault(),Q.stopPropagation();var X=U.selectAll(".preset-list-button");X.empty()||X.nodes()[0].focus()}}function W(Q){var X=O.property("value");Q.keyCode===13&&X.length&&U.selectAll(".preset-list-item:first-child").each(function(ce){ce.choose.call(this)})}function Z(){var Q=O.property("value");U.classed("filtered",Q.length);var X,ce;Q.length?(X=T.search(Q,E()[0],o),ce=e.t("inspector.results",{n:X.array.length,search:Q})):(X=r.defaults(E()[0],36,!t.inIntro,o),ce=e.t("inspector.choose")),U.call(d,X),k.html(ce)}}function d(b,T){T=T.matchAllGeometry(E());let A=[];for(let k of T.array)k&&(k.members?A.push(g(k)):A.push(_(k)));let M=b.selectAll(".preset-list-item").data(A,k=>k.preset.id);M.order(),M.exit().remove(),M.enter().append("div").attr("class",function(k){return"preset-list-item preset-"+k.preset.id.replace("/","-")}).classed("current",function(k){return a.indexOf(k.preset)!==-1}).each(function(k){ye(this).call(k)}).style("opacity",0).transition().style("opacity",1),v()}function m(b){var T=ye(this.closest(".preset-list-item")),A=ye(T.node().parentNode.closest(".preset-list-item"));let M=e.isRTL();if(b.keyCode===zi.keyCodes["\u2193"]){b.preventDefault(),b.stopPropagation();var k=ye(T.node().nextElementSibling);k.empty()?A.empty()||(k=ye(A.node().nextElementSibling)):ye(this).classed("expanded")&&(k=T.select(".subgrid .preset-list-item:first-child")),k.empty()||k.select(".preset-list-button").node().focus()}else if(b.keyCode===zi.keyCodes["\u2191"]){b.preventDefault(),b.stopPropagation();var F=ye(T.node().previousElementSibling);if(F.empty()?A.empty()||(F=A):F.select(".preset-list-button").classed("expanded")&&(F=F.select(".subgrid .preset-list-item:last-child")),!F.empty())F.select(".preset-list-button").node().focus();else{var O=ye(this.closest(".preset-list-pane")).select(".preset-search-input");O.node().focus()}}else b.keyCode===zi.keyCodes[M?"\u2192":"\u2190"]?(b.preventDefault(),b.stopPropagation(),A.empty()||A.select(".preset-list-button").node().focus()):b.keyCode===zi.keyCodes[M?"\u2190":"\u2192"]&&(b.preventDefault(),b.stopPropagation(),T.datum().choose.call(ye(this).node()))}function g(b){var T,A,M=!1;function k(F){let O=e.isRTL();var B=F.append("div").attr("class","preset-list-button-wrap category");function U(){var Z=ye(this).classed("expanded"),Q=Z?O?"#rapid-icon-backward":"#rapid-icon-forward":"#rapid-icon-down";ye(this).classed("expanded",!Z),ye(this).selectAll("div.label-inner svg.icon use").attr("href",Q),k.choose()}var $=E(),q=B.append("button").attr("class","preset-list-button").classed("expanded",!1).call(u0(t).geometry($.length===1&&$[0]).preset(b)).on("click",U).on("keydown",function(Z){Z.keyCode===zi.keyCodes[O?"\u2190":"\u2192"]?(Z.preventDefault(),Z.stopPropagation(),ye(this).classed("expanded")||U.call(this,Z)):Z.keyCode===zi.keyCodes[O?"\u2192":"\u2190"]?(Z.preventDefault(),Z.stopPropagation(),ye(this).classed("expanded")&&U.call(this,Z)):m.call(this,Z)}),W=q.append("div").attr("class","label").append("div").attr("class","label-inner");W.append("div").attr("class","namepart").call(Ye(O?"#rapid-icon-backward":"#rapid-icon-forward","inline")).append("span").html(function(){return b.nameLabel()+"&hellip;"}),T=F.append("div").attr("class","subgrid").style("max-height","0px").style("opacity",0),T.append("div").attr("class","arrow"),A=T.append("div").attr("class","preset-list fillL3")}return k.choose=function(){if(!(!T||!A))if(M)M=!1,T.transition().duration(200).style("opacity","0").style("max-height","0px").style("padding-bottom","0px");else{M=!0;var F=b.members.matchAllGeometry(E());A.call(d,F),T.transition().duration(200).style("opacity","1").style("max-height",200+F.array.length*190+"px").style("padding-bottom","10px")}},k.preset=b,k}function _(b){function T(A){var M=A.append("div").attr("class","preset-list-button-wrap"),k=E(),F=M.append("button").attr("class","preset-list-button").call(u0(t).geometry(k.length===1&&k[0]).preset(b)).on("click",T.choose).on("keydown",m),O=F.append("div").attr("class","label").append("div").attr("class","label-inner"),B=[b.nameLabel(),b.subtitleLabel()].filter(Boolean);O.selectAll(".namepart").data(B).enter().append("div").attr("class","namepart").html(function(U){return U}),M.call(T.reference.button),A.call(T.reference.body)}return T.choose=function(){ye(this).classed("disabled")||(t.inIntro||r.setMostRecent(b),t.perform(function(A){for(var M in n){var k=n[M],F=r.match(A.entity(k),A);A=ja(k,F,b)(A)}return A},e.t("operations.change_tags.annotation")),t.systems.validator.validate(),s.call("choose",this,b))},T.help=function(A){A.stopPropagation(),T.reference.toggle()},T.preset=b,T.reference=Qc(t,b.reference()),T}function v(){if(n.every(t.hasEntity)){var b=E(),T=t.container().selectAll(".preset-list .preset-list-button");T.call(Ft(t).destroyAny),T.each(function(A,M){let k;for(var F in b)if(k=i.isHiddenPreset(A.preset,b[F]),k)break;var O=!t.inIntro&&!!k&&(a.length!==1||A.preset!==a[0]);ye(this).classed("disabled",O),O&&ye(this).call(Ft(t).title(e.tHtml("inspector.hidden_preset.manual",{features:e.tHtml("feature."+k+".description")})).placement(M<2?"bottom":"top"))})}}u.autofocus=function(b){return arguments.length?(l=b,u):l},u.entityIDs=function(b){if(!arguments.length)return n;if(n=b,o=null,n&&n.length){o=Ar(n,t.graph()).center();var T=n.map(function(A){return r.match(t.entity(A),t.graph())});u.presets(T)}return u},u.presets=function(b){return arguments.length?(a=b,u):a};function E(){var b={};for(var T in n){var A=n[T],M=t.entity(A),k=M.geometry(t.graph());k==="vertex"&&M.isOnAddressLine(t.graph())&&(k="point"),b[k]||(b[k]=0),b[k]+=1}return Object.keys(b).sort(function(F,O){return b[O]-b[F]})}return $t(u,s,"on")}function q4(t){let e=t.services.osm,i;function r(s){let n;e&&i instanceof Dt&&!i.isNew()?n=e.entityURL(i):e&&i instanceof Fr&&!i.isNew()&&(n=e.noteURL(i));let o=s.selectAll(".view-on-osm").data(n?[n]:[],l=>l);o.exit().remove(),o.enter().append("a").attr("class","view-on-osm").attr("target","_blank").attr("href",l=>l).call(Ye("#rapid-icon-out-link","inline")).append("span").text(t.t("inspector.view_on_osm"))}return r.what=function(s){return arguments.length?(i=s,r):i},r}function B_(t){var e=O_(t),i=C_(t),r=ye(null),s=ye(null),n=ye(null),o="select",a,l=!1;function u(d){e.entityIDs(a).autofocus(l).on("choose",u.setPreset).on("cancel",function(){u.setPreset()}),i.state(o).entityIDs(a).on("choose",u.showList),r=d.selectAll(".panewrap").data([0]);var m=r.enter().append("div").attr("class","panewrap");m.append("div").attr("class","preset-list-pane pane"),m.append("div").attr("class","entity-editor-pane pane"),r=r.merge(m),s=r.selectAll(".preset-list-pane"),n=r.selectAll(".entity-editor-pane");function g(){if(o!=="select"||a.length!==1)return!1;var v=a[0],E=t.hasEntity(v);return!E||E.hasNonGeometryTags()?!1:l?!0:!(E.geometry(t.graph())!=="vertex"||t.graph().parentRelations(E).length||t.systems.validator.getEntityIssues(v).length||E.isHighwayIntersection(t.graph()))}g()?(r.style("right","-100%"),n.classed("hide",!0),s.classed("hide",!1).call(e)):(r.style("right","0%"),s.classed("hide",!0),n.classed("hide",!1).call(i));var _=d.selectAll(".footer").data([0]);_=_.enter().append("div").attr("class","footer").merge(_),_.call(q4(t).what(t.hasEntity(a.length===1&&a[0])))}return u.showList=function(d){s.classed("hide",!1),r.transition().styleTween("right",function(){return D1("0%","-100%")}).on("end",function(){n.classed("hide",!0)}),d&&e.presets(d),s.call(e.autofocus(!0))},u.setPreset=function(d){d&&d.id==="type/multipolygon"?s.call(e.autofocus(!0)):(n.classed("hide",!1),r.transition().styleTween("right",function(){return D1("-100%","0%")}).on("end",function(){s.classed("hide",!0)}),d&&i.presets([d]),n.call(i))},u.state=function(d){return arguments.length?(o=d,i.state(o),t.container().selectAll(".field-help-body").remove(),u):o},u.entityIDs=function(d){return arguments.length?(a=d,u):a},u.newFeature=function(d){return arguments.length?(l=d,u):l},u}function U_(t){let e=t.systems.validator,i=t.systems.storage,r={id:"warnings",count:0,iconID:"rapid-icon-alert",descriptionID:"issues.warnings_and_errors"},s={id:"resolved",count:0,iconID:"rapid-icon-apply",descriptionID:"issues.user_resolved_issues"};function n(o){let a=[],l=e.getIssues({what:i.getItem("validate-what")??"edited",where:i.getItem("validate-where")??"all"});if(l.length&&(r.count=l.length,a.push(r)),i.getItem("validate-what")==="all"){let m=e.getResolvedIssues();m.length&&(s.count=m.length,a.push(s))}let u=o.selectAll(".chip").data(a,m=>m.id);u.exit().remove();let d=u.enter().append("a").attr("class",m=>`chip ${m.id}-count`).attr("href","#").each((m,g,_)=>{let v=ye(_[g]),E=Ft(t).placement("top").title(t.tHtml(m.descriptionID));v.call(E).on("click",b=>{b.preventDefault(),E.hide(),t.systems.ui.togglePanes(t.container().select(".map-panes .issues-pane"))}),v.call(Ye(`#${m.iconID}`))});d.append("span").attr("class","count"),d.merge(u).selectAll("span.count").text(m=>m.count.toString())}return function(a){n(a),e.on("validated",()=>n(a))}}function z_(t){let e=t.systems.filters,i=t.systems.l10n,r=t.systems.map,s=t.systems.presets,n;function o(l){let{itemType:u,parentIssueType:d}=l,m=i.tHtml("inspector.unknown"),g=l.replacements||{};g.default=m;let _=i.tHtml(`QA.keepRight.errorTypes.${u}.description`,g);return _===m&&(_=i.tHtml(`QA.keepRight.errorTypes.${d}.description`,g)),_}function a(l){let u=l.selectAll(".error-details").data(n?[n]:[],_=>`${_.id}-${_.status||0}`);u.exit().remove();let m=u.enter().append("div").attr("class","error-details qa-details-container").append("div").attr("class","qa-details-subsection");m.append("h4").html(i.tHtml("QA.keepRight.detail_description")),m.append("div").attr("class","qa-details-description-text").html(o);let g=[];m.selectAll(".error_entity_link, .error_object_link").attr("href","#").each((_,v,E)=>{let b=E[v],T=ye(b),A=T.classed("error_object_link"),M=A?n.objectType.charAt(0)+n.objectId:b.textContent,k=t.hasEntity(M);if(g.push(M),T.on("mouseenter",()=>{Yi([M],!0,t)}).on("mouseleave",()=>{Yi([M],!1,t)}).on("click",F=>{F.preventDefault(),Yi([M],!1,t),r.scene.enableLayers("osm"),r.centerZoomEase(n.loc,20),r.selectEntityID(M)}),k){let F=i.displayName(k.tags);if(!F&&!A){let O=s.match(k,t.graph());F=O&&!O.isFallback()&&O.name()}F&&(b.innerText=F)}}),e.forceVisible(g),r.immediateRedraw()}return a.issue=function(l){return arguments.length?(n=l,a):n},a}function G_(t){let e;function i(s){let n=t.tHtml("inspector.unknown"),o=s.replacements||{};o.default=n;let a=t.tHtml(`QA.keepRight.errorTypes.${s.itemType}.title`,o);return a===n&&(a=t.tHtml(`QA.keepRight.errorTypes.${s.parentIssueType}.title`,o)),a}function r(s){let n=16777215,o=t.services.keepRight;o&&(n=o.getColor(e?.parentIssueType));let a=s.selectAll(".qa-header").data(e?[e]:[],u=>`${u.id}-${u.status||0}`);a.exit().remove();let l=a.enter().append("div").attr("class","qa-header");l.append("div").attr("class","qa-header-icon").append("div").attr("class",u=>`qaItem ${u.service}`).call(Ye("#rapid-icon-bolt")),l.append("div").attr("class","qa-header-label").html(i),l.selectAll(".qaItem svg.icon").attr("stroke","#333").attr("stroke-width","1.3px").attr("color",new fi(n).toHex())}return r.issue=function(s){return arguments.length?(e=s,r):e},r}function $_(t){let e=t.services.keepRight,i;function r(s){let n;e&&i instanceof vr&&(n=e.issueURL(i));let o=s.selectAll(".view-on-keepRight").data(n?[n]:[],l=>l);o.exit().remove(),o.enter().append("a").attr("class","view-on-keepRight").attr("target","_blank").attr("rel","noopener").attr("href",l=>l).call(Ye("#rapid-icon-out-link","inline")).append("span").text(t.t("inspector.view_on_keepRight"))}return r.what=function(s){return arguments.length?(i=s,r):i},r}function Y4(t){let e=t.services.keepRight,i=Mt("change"),r=z_(t),s=G_(t),n;function o(u){let d=u.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");d.append("button").attr("class","close").on("click",()=>t.enter("browse")).call(Ye("#rapid-icon-close")),d.append("h3").html(t.tHtml("QA.keepRight.title"));let m=u.selectAll(".body").data([0]);m=m.enter().append("div").attr("class","body").merge(m);let g=m.selectAll(".qa-editor").data([0]);g.enter().append("div").attr("class","modal-section qa-editor").merge(g).call(s.issue(n)).call(r.issue(n)).call(a);let _=u.selectAll(".footer").data([0]);_.enter().append("div").attr("class","footer").merge(_).call($_(t).what(n))}function a(u){let d=n?.id,m=d&&t.selectedData().has(d),g=n&&(m||n.newComment||n.comment),_=u.selectAll(".qa-save").data(g?[n]:[],b=>`${b.id}-${b.status||0}`);_.exit().remove();let v=_.enter().append("div").attr("class","qa-save save-section cf");v.append("h4").attr("class",".qa-save-header").html(t.tHtml("QA.keepRight.comment")),v.append("textarea").attr("class","new-comment-input").attr("placeholder",t.t("QA.keepRight.comment_placeholder")).attr("maxlength",1e3).property("value",b=>b.newComment||b.comment).call(ki).on("input",E).on("blur",E),_=v.merge(_).call(l);function E(){let T=ye(this).property("value").trim();T===n.comment&&(T=void 0),n=n.update({newComment:T}),e&&e.replaceItem(n),_.call(l)}}function l(u){let d=n?.id,m=d&&t.selectedData().has(d),g=u.selectAll(".buttons").data(m?[n]:[],v=>v.status+v.id);g.exit().remove();let _=g.enter().append("div").attr("class","buttons");_.append("button").attr("class","button comment-button action").html(t.tHtml("QA.keepRight.save_comment")),_.append("button").attr("class","button close-button action"),_.append("button").attr("class","button ignore-button action"),g=g.merge(_),g.select(".comment-button").attr("disabled",v=>v.newComment?null:!0).on("click.comment",function(v,E){this.blur(),e&&e.postUpdate(E,(b,T)=>i.call("change",T))}),g.select(".close-button").html(v=>{let E=v.newComment?"_comment":"";return t.tHtml(`QA.keepRight.close${E}`)}).on("click.close",function(v,E){this.blur(),e&&(E.newStatus="ignore_t",e.postUpdate(E,(b,T)=>i.call("change",T)))}),g.select(".ignore-button").html(v=>{let E=v.newComment?"_comment":"";return t.tHtml(`QA.keepRight.ignore${E}`)}).on("click.ignore",function(v,E){this.blur(),e&&(E.newStatus="ignore",e.postUpdate(E,(b,T)=>i.call("change",T)))})}return o.error=function(u){return arguments.length?(n=u,o):n},$t(o,i,"on")}function h0(t){function e(i){let r=ye(null),s=!0;function n(){s||(o(),a())}function o(){let _=t.systems.map.extent(),v=_.center();_.padByMeters(100),t.systems.map3d.maplibre.jumpTo({center:v,bearing:0,zoom:t.systems.map.zoom()-3})}function a(){let _=t.systems.map,E=t.systems.edits.intersects(_.extent()).filter(M=>!M.id.startsWith("r")),b=E.filter(M=>Object.keys(M.tags).filter(F=>F.startsWith("building")).length>0),T=E.filter(M=>Object.keys(M.tags).filter(F=>F.startsWith("highway")).length>0),A=E.filter(M=>Object.keys(M.tags).filter(F=>F.startsWith("landuse")||F.startsWith("leisure")||F.startsWith("natural")||F.startsWith("area")).length>0);d(T),l(b),u(A)}function l(_){let v=[],E=t.selectedIDs(),b=t.graph();for(let M of _){let k=M.asGeoJSON(b);if(k.type!=="Polygon"&&k.type!=="MultiPolygon")continue;if(!M.tags["building:part"]&&_.length<250){let O=!1;for(let B of M.nodes){let U=b.parentWays(b.hasEntity(B));for(let $ of U)if($.tags["building:part"]&&Nf(M.nodes.map(q=>b.hasEntity(q).loc),$.nodes.map(q=>b.hasEntity(q).loc))){O=!0;break}}if(O)continue}let F={type:"Feature",properties:{extrude:!0,selected:E.includes(M.id).toString(),min_height:M.tags.min_height?parseFloat(M.tags.min_height):0,height:parseFloat(M.tags.height||M.tags["building:levels"]*3||0)},geometry:k};v.push(F)}let A=t.systems.map3d.maplibre?.getSource("osmbuildings");A&&A.setData({type:"FeatureCollection",features:v})}function u(_){let v=[],E=t.selectedIDs();for(let A of _){let M=A.asGeoJSON(t.graph());if(M.type!=="Polygon"&&M.type!=="MultiPolygon")continue;let k=gh(A.tags),F=new fi(k.fill.color).toHex(),O=new fi(k.stroke.color).toHex(),B={type:"Feature",properties:{selected:E.includes(A.id).toString(),fillcolor:F,strokecolor:O},geometry:M};v.push(B)}let T=t.systems.map3d.maplibre?.getSource("osmareas");T&&T.setData({type:"FeatureCollection",features:v})}function d(_){let v=[],E=t.selectedIDs();for(let A of _){let M=A.asGeoJSON(t.graph());if(M.type!=="LineString")continue;let k=gh(A.tags),F=new fi(k.casing.color).toHex(),O=new fi(k.stroke.color).toHex(),B={type:"Feature",properties:{selected:E.includes(A.id).toString(),highway:A.tags.highway,casingColor:F,strokeColor:O},geometry:M};v.push(B)}let T=t.systems.map3d.maplibre?.getSource("osmroads");T&&T.setData({type:"FeatureCollection",features:v})}function m(_){_&&_.preventDefault(),s=!s,t.container().select(".three-d-map-toggle-item").classed("active",!s).select("input").property("checked",!s),s?r.style("display","block").style("opacity","1").transition().duration(200).style("opacity","0").on("end",()=>i.selectAll(".three-d-map").style("display","none")):r.style("display","block").style("opacity","0").transition().duration(200).style("opacity","1").on("end",()=>n())}h0.toggle=m,r=i.selectAll(".three-d-map").data([0]),r=r.enter().append("div").attr("class","three-d-map").attr("id","3d-buildings").style("display",s?"none":"block").merge(r),t.systems.map3d.startAsync(),t.systems.map.on("draw",()=>n()),t.systems.map.on("move",()=>n()),t.keybinding().on([Ri("\u2318"+t.t("background.3dmap.key"))],m),n()}return e}function d0(t){function e(i){let r=new zo,s=Df().scaleExtent([In(.5),In(24)]).on("start",M).on("zoom",k).on("end",F),n=ye(null),o=ye(null),a=!0,l=!1,u=!1,d=null,m=6,g,_,v,E,b=null,T=null;function A(){a||(O(),B())}function M(){u||(v=E=r.transform(),d=null)}function k(Z){if(u)return;let Q=Z.transform.x,X=Z.transform.y,ce=Z.transform.k,de=ce!==v.k,le=Q!==v.x||X!==v.y;if(!de&&!le)return;d||(d=de?"zoom":"pan");let te=r.transform(),ee,oe,ie;d==="zoom"?(ie=ce/te.k,ee=(_[0]/ie-_[0])*ie,oe=(_[1]/ie-_[1])*ie):(ce=te.k,ie=1,ee=Q-te.x,oe=X-te.y),d==="pan"?(b.stage.x+=ee,b.stage.y+=oe):Sl(o,0,0,ie),l=!0,E=yl.translate(Q,X).scale(ce);let ne=Ba(t.projection.scale()),me=Ba(ce);m=ne-me,A()}function F(){u||d==="pan"&&(O(),d=null,t.systems.map.center(r.invert(_)))}function O(){let Z=t.systems.map.center(),Q=t.projection.transform(),X=Ba(Q.k),ce=Math.max(X-m,.5),de=In(ce);r.translate([Q.x,Q.y]).scale(de);let le=r.project(Z),te=d==="pan"?tr([E.x,E.y],[v.x,v.y]):[0,0],ee=_[0]-le[0]+Q.x+te[0],oe=_[1]-le[1]+Q.y+te[1];r.translate([ee,oe]).dimensions([[0,0],g]),E=r.transform(),l&&(b.stage.x=0,b.stage.y=0,Sl(o,0,0),l=!1),s.scaleExtent([In(.5),In(X-3)]),u=!0,n.call(s.transform,E),u=!1}function B(){let Z=t.systems.map.extent().bbox(),Q=r.project([Z.minX,Z.maxY]),X=r.project([Z.maxX,Z.minY]),ce=Math.abs(X[0]-Q[0]),de=Math.abs(X[1]-Q[1]),le=b.stage,te=le.getChildByName("bbox");te||(te=new Gi,te.name="bbox",te.eventMode="none",le.addChild(te)),te.clear().lineStyle(2,16776960).drawRect(Q[0],Q[1],ce,de)}function U(Z){Z&&Z.preventDefault(),a=!a,t.container().select(".minimap-toggle-item").classed("active",!a).select("input").property("checked",!a),a?n.style("display","block").style("opacity","1").transition().duration(200).style("opacity","0").on("end",()=>{i.selectAll(".map-in-map").style("display","none"),$()}):(A(),n.style("display","block").style("opacity","0").transition().duration(200).style("opacity","1"))}function $(){let Z=b.stage,Q=Z.getChildByName("bbox");Q&&Z.removeChild(Q),T&&T.destroyAll()}function q(){if(a)return;window.performance.mark("minimap-start");let Z=0;T.render(Z,r),b.render(),window.performance.mark("minimap-end"),window.performance.measure("minimap","minimap-start","minimap-end")}d0.toggle=U,n=i.selectAll(".map-in-map").data([0]);let W=n.enter().append("div").attr("class","map-in-map").style("display",a?"none":"block").call(s).on("dblclick.zoom",null);if(!b){b=new Sd({antialias:!0,autoDensity:!0,autoStart:!1,events:{move:!1,globalMove:!1,click:!0,wheel:!1},resolution:window.devicePixelRatio,sharedLoader:!0,sharedTicker:!1});let[Z,Q]=[200,150];b.renderer.resize(Z,Q);let X=b.ticker;X.maxFPS=10;let ce=X._head.next;X.remove(ce.fn,ce.context),X.add(q,this),X.start();let de=b.stage;de.name="minimap-stage",de.eventMode="none",de.sortableChildren=!1;let le=t.systems.map.renderer,te={context:t,pixi:b,stage:de,textures:le.textures},ee={context:t,renderer:te,groups:new Map,layers:new Map,features:new Map},oe=new qi;oe.name="background",de.addChild(oe),ee.groups.set("background",oe),T=new F4(ee,"minimap-background",!0),ee.layers.set(T.id,T),g=[Z,Q],_=Uo(g,.5),t.systems.map.on("draw",()=>A())}W.each((Z,Q,X)=>{X[Q].appendChild(b.view)}),n=W.merge(n),o=ye(b.view),A(),t.keybinding().on(t.t("background.minimap.key"),U)}return e}function H_(t){let e;function i(n){if(e.isNew())return;let o=n.selectAll(".comments-container").data([0]);o=o.enter().append("div").attr("class","comments-container").merge(o);let a=o.selectAll(".comment").data(e.comments).enter().append("div").attr("class","comment");a.append("div").attr("class",d=>`comment-avatar user-${d.uid}`).call(Ye("#rapid-icon-avatar","comment-avatar-icon"));let l=a.append("div").attr("class","comment-main"),u=l.append("div").attr("class","comment-metadata");u.append("div").attr("class","comment-author").each((d,m,g)=>{let _=ye(g[m]),v=t.services.osm;v&&d.user&&(_=_.append("a").attr("class","comment-author-link").attr("href",v.userURL(d.user)).attr("target","_blank")),_.html(E=>E.user||t.tHtml("note.anonymous"))}),u.append("div").attr("class","comment-date").html(d=>t.t(`note.status.${d.action}`,{when:s(d.date)})),l.append("div").attr("class","comment-text").html(d=>d.html).selectAll("a").attr("rel","noopener nofollow").attr("target","_blank"),o.call(r)}function r(n){let a=t.systems.storage.getItem("preferences.privacy.thirdpartyicons")??"true",l=t.services.osm;if(a!=="true"||!l)return;let u=new Set;for(let d of e.comments)d.uid&&u.add(d.uid);for(let d of u)l.loadUser(d,(m,g)=>{!g||!g.image_url||n.selectAll(`.comment-avatar.user-${d}`).html("").append("img").attr("class","icon comment-avatar-icon").attr("src",g.image_url).attr("alt",g.display_name)})}function s(n){if(!n)return null;let o={day:"numeric",month:"short",year:"numeric"};n=n.replace(/-/g,"/");let a=new Date(n);if(isNaN(a.getTime()))return null;let l=t.systems.l10n.localeCode();return a.toLocaleDateString(l,o)}return i.note=function(n){return arguments.length?(e=n,i):e},i}function V_(t){let e;function i(r){let s=r.selectAll(".note-header").data(e?[e]:[],a=>a.status+a.id);s.exit().remove();let n=s.enter().append("div").attr("class","note-header"),o=n.append("div").attr("class",a=>`note-header-icon ${a.status}`).classed("new",a=>a.id<0);o.append("div").attr("class","preset-icon-28").call(Ye("#rapid-icon-note","note-fill")),o.each(a=>{let l;a.id<0?l="#rapid-icon-plus":a.status==="open"?l="#rapid-icon-close":l="#rapid-icon-apply",o.append("div").attr("class","note-icon-annotation").call(Ye(l,"icon-annotation"))}),n.append("div").attr("class","note-header-label").text(a=>e.isNew()?t.t("note.new"):t.t("note.note")+" "+a.id+" "+(a.status==="closed"?t.t("note.closed"):""))}return i.note=function(r){return arguments.length?(e=r,i):e},i}function j_(t){let e;function i(r){let s,n=t.services.osm;n&&e instanceof Fr&&!e.isNew()&&(s=n.noteReportURL(e));let o=r.selectAll(".note-report").data(s?[s]:[]);o.exit().remove(),o.enter().append("a").attr("class","note-report").attr("target","_blank").attr("href",l=>l).call(Ye("#rapid-icon-out-link","inline")).append("span").text(t.t("note.report"))}return i.note=function(r){return arguments.length?(e=r,i):e},i}function Z4(t){var e=Mt("change"),i=H_(t),r=V_(t),s,n;function o(v){var E=v.selectAll(".header").data([0]),b=E.enter().append("div").attr("class","header fillL");b.append("button").attr("class","close").on("click",function(){t.enter("browse")}).call(Ye("#rapid-icon-close")),b.append("h3").html(t.tHtml("note.title"));var T=v.selectAll(".body").data([0]);T=T.enter().append("div").attr("class","body").merge(T);var A=T.selectAll(".note-editor").data([0]);A.enter().append("div").attr("class","modal-section note-editor").merge(A).call(r.note(s)).call(i.note(s)).call(a);var M=v.selectAll(".footer").data([0]);M.enter().append("div").attr("class","footer").merge(M).call(q4(t).what(s)).call(j_(t).note(s));var k=t.services.osm;k&&k.on("authchange",function(){v.call(o)})}function a(v){var E=s&&s.id===t.selectedIDs()[0],b=v.selectAll(".note-save").data(E?[s]:[],function(F){return F.status+F.id});b.exit().remove();var T=b.enter().append("div").attr("class","note-save save-section cf");T.append("h4").attr("class",".note-save-header").html(function(){return s.isNew()?t.t("note.newDescription"):t.t("note.newComment")});var A=T.append("textarea").attr("class","new-comment-input").attr("placeholder",t.t("note.inputPlaceholder")).attr("maxlength",1e3).property("value",function(F){return F.newComment}).call(ki).on("keydown.note-input",M).on("input.note-input",k).on("blur.note-input",k);!A.empty()&&n&&A.node().focus(),b=T.merge(b).call(l).call(u);function M(F){if(F.keyCode===13&&F.metaKey){var O=t.services.osm;if(O){var B=O.authenticated();B&&s.newComment&&(F.preventDefault(),ye(this).on("keydown.note-input",null),window.setTimeout(function(){s.isNew()?(b.selectAll(".save-button").node().focus(),m(s)):(b.selectAll(".comment-button").node().focus(),_(s))},10))}}}function k(){var F=ye(this),O=F.property("value").trim()||void 0;s=s.update({newComment:O});var B=t.services.osm;B&&B.replaceNote(s),b.call(u)}}function l(v){var E=v.selectAll(".detail-section").data([0]);E=E.enter().append("div").attr("class","detail-section").merge(E);var b=t.services.osm;if(b){var T=b.authenticated(),A=E.selectAll(".auth-warning").data(T?[]:[0]);A.exit().transition().duration(200).style("opacity",0).remove();var M=A.enter().insert("div",".tag-reference-body").attr("class","field-warning auth-warning").style("opacity",0);M.call(Ye("#rapid-icon-alert","inline")),M.append("span").html(t.tHtml("note.login")),M.append("a").attr("target","_blank").call(Ye("#rapid-icon-out-link","inline")).append("span").html(t.tHtml("login")).on("click.note-login",function(F){F.preventDefault(),b.authenticate()}),M.transition().duration(200).style("opacity",1);var k=E.selectAll(".note-save-prose").data(T?[0]:[]);k.exit().remove(),k=k.enter().append("p").attr("class","note-save-prose").html(t.tHtml("note.upload_explanation")).merge(k),b.userDetails(function(F,O){if(!F){var B=ye(document.createElement("div"));O.image_url&&B.append("img").attr("src",O.image_url).attr("class","icon pre-text user-icon"),B.append("a").attr("class","user-info").html(O.display_name).attr("href",b.userURL(O.display_name)).attr("target","_blank"),k.html(t.tHtml("note.upload_explanation_with_user",{user:B.html()}))}})}}function u(v){var E=t.services.osm,b=E&&E.authenticated(),T=s&&s.id===t.selectedIDs()[0],A=v.selectAll(".buttons").data(T?[s]:[],function(F){return F.status+F.id});A.exit().remove();var M=A.enter().append("div").attr("class","buttons");s.isNew()?(M.append("button").attr("class","button cancel-button secondary-action").html(t.tHtml("confirm.cancel")),M.append("button").attr("class","button save-button action").html(t.tHtml("note.save"))):(M.append("button").attr("class","button status-button action"),M.append("button").attr("class","button comment-button action").html(t.tHtml("note.comment"))),A=A.merge(M),A.select(".cancel-button").on("click.cancel",d),A.select(".save-button").attr("disabled",k).on("click.save",m),A.select(".status-button").attr("disabled",b?null:!0).html(function(F){var O=F.status==="open"?"close":"open",B=F.newComment?"_comment":"";return t.t("note."+O+B)}).on("click.status",g),A.select(".comment-button").attr("disabled",k).on("click.comment",_);function k(F){return b&&F.status==="open"&&F.newComment?null:!0}}function d(v,E){this.blur();var b=t.services.osm;b&&b.removeNote(E),t.enter("browse"),e.call("change")}function m(v,E){this.blur();var b=t.services.osm;b&&b.postNoteCreate(E,function(T,A){e.call("change",A)})}function g(v,E){this.blur();var b=t.services.osm;if(b){var T=E.status==="open"?"closed":"open";b.postNoteUpdate(E,T,function(A,M){e.call("change",M)})}}function _(v,E){this.blur();var b=t.services.osm;b&&b.postNoteUpdate(E,E.status,function(T,A){e.call("change",A)})}return o.note=function(v){return arguments.length?(s=v,o):s},o.newNote=function(v){return arguments.length?(n=v,o):n},$t(o,e,"on")}function X_(t){let e=t.systems.filters,i=t.systems.l10n,r=t.systems.map,s=t.services.osmose,n=t.systems.presets,o;function a(u,d){if(!s||!u)return"";let m=s.getStrings(u.itemType);return d in m?m[d]:""}function l(u){let d=u.selectAll(".error-details").data(o?[o]:[],v=>`${v.id}-${v.status||0}`);d.exit().remove();let m=d.enter().append("div").attr("class","error-details qa-details-container");if(a(o,"detail")){let v=m.append("div").attr("class","qa-details-subsection");v.append("h4").html(i.tHtml("QA.keepRight.detail_description")),v.append("p").attr("class","qa-details-description-text").html(E=>a(E,"detail")).selectAll("a").attr("rel","noopener").attr("target","_blank")}let g=m.append("div").attr("class","qa-details-subsection"),_=m.append("div").attr("class","qa-details-subsection");if(a(o,"fix")){let v=m.append("div").attr("class","qa-details-subsection");v.append("h4").html(i.tHtml("QA.osmose.fix_title")),v.append("p").html(E=>a(E,"fix")).selectAll("a").attr("rel","noopener").attr("target","_blank")}if(a(o,"trap")){let v=m.append("div").attr("class","qa-details-subsection");v.append("h4").html(i.tHtml("QA.osmose.trap_title")),v.append("p").html(E=>a(E,"trap")).selectAll("a").attr("rel","noopener").attr("target","_blank")}s&&s.loadIssueDetailAsync(o).then(v=>{o.id===v.id&&(!v.elems||v.elems.length===0||(v.detail&&(g.append("h4").html(i.tHtml("QA.osmose.detail_title")),g.append("p").html(E=>E.detail).selectAll("a").attr("rel","noopener").attr("target","_blank")),_.append("h4").html(i.tHtml("QA.osmose.elems_title")),_.append("ul").selectAll("li").data(v.elems).enter().append("li").append("a").attr("href","#").attr("class","error_entity_link").html(E=>E).each((E,b,T)=>{let A=T[b],M=ye(A),k=A.textContent,F=t.hasEntity(k);if(M.on("mouseenter",()=>{Yi([k],!0,t)}).on("mouseleave",()=>{Yi([k],!1,t)}).on("click",O=>{O.preventDefault(),Yi([k],!1,t),r.scene.enableLayers("osm"),r.centerZoom(E.loc,20),r.selectEntityID(k)}),F){let O=i.displayName(F.tags);if(!O){let B=n.match(F,t.graph());O=B&&!B.isFallback()&&B.name()}O&&(A.innerText=O)}}),e.forceVisible(v.elems),r.immediateRedraw()))}).catch(v=>console.error(v))}return l.issue=function(u){return arguments.length?(o=u,l):o},l}function W_(t){let e=t.services.osmose,i;function r(n){let o=t.t("inspector.unknown");if(!e||!n)return o;let a=e.getStrings(n.itemType);return"title"in a?a.title:o}function s(n){let o=16777215;e&&(o=e.getColor(i?.item));let a=n.selectAll(".qa-header").data(i?[i]:[],d=>`${d.id}-${d.status||0}`);a.exit().remove();let l=a.enter().append("div").attr("class","qa-header"),u=l.append("div").attr("class","qa-header-icon").append("svg").attr("width","20px").attr("height","27px").attr("viewbox","0 0 20 27").attr("class",d=>`qaItem ${d.service}`);u.append("polygon").attr("fill",new fi(o).toHex()).attr("stroke","#333").attr("points","16,3 4,3 1,6 1,17 4,20 7,20 10,27 13,20 16,20 19,17.033 19,6"),u.append("use").attr("class","icon-annotation").attr("width","13px").attr("height","13px").attr("transform","translate(3.5, 5)").attr("xlink:href",d=>d.icon?`#${d.icon}`:""),l.append("div").attr("class","qa-header-label").html(r)}return s.issue=function(n){return arguments.length?(i=n,s):i},s}function q_(t){let e=t.services.osmose,i;function r(s){let n;e&&i instanceof vr&&(n=e.itemURL(i));let o=s.selectAll(".view-on-osmose").data(n?[n]:[],l=>l);o.exit().remove(),o.enter().append("a").attr("class","view-on-osmose").attr("target","_blank").attr("rel","noopener").attr("href",l=>l).call(Ye("#rapid-icon-out-link","inline")).append("span").text(t.t("inspector.view_on_osmose"))}return r.what=function(s){return arguments.length?(i=s,r):i},r}function Q4(t){let e=t.services.osmose,i=Mt("change"),r=X_(t),s=W_(t),n;function o(u){let m=u.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");m.append("button").attr("class","close").on("click",()=>t.enter("browse")).call(Ye("#rapid-icon-close")),m.append("h3").html(t.tHtml("QA.osmose.title"));let g=u.selectAll(".body").data([0]);g=g.enter().append("div").attr("class","body").merge(g);let _=g.selectAll(".qa-editor").data([0]);_.enter().append("div").attr("class","modal-section qa-editor").merge(_).call(s.issue(n)).call(r.issue(n)).call(a);let v=u.selectAll(".footer").data([0]);v.enter().append("div").attr("class","footer").merge(v).call(q_(t).what(n))}function a(u){let d=n?.id,m=d&&t.selectedData().has(d),g=n&&m,_=u.selectAll(".qa-save").data(g?[n]:[],E=>`${E.id}-${E.status||0}`);_.exit().remove(),_=_.enter().append("div").attr("class","qa-save save-section cf").merge(_).call(l)}function l(u){let d=n?.id,m=d&&t.selectedData().has(d),g=u.selectAll(".buttons").data(m?[n]:[],v=>v.status+v.id);g.exit().remove();let _=g.enter().append("div").attr("class","buttons");_.append("button").attr("class","button close-button action"),_.append("button").attr("class","button ignore-button action"),g=g.merge(_),g.select(".close-button").html(t.tHtml("QA.keepRight.close")).on("click.close",function(v,E){this.blur(),e&&(E.newStatus="done",e.postUpdate(E,(b,T)=>i.call("change",T)))}),g.select(".ignore-button").html(t.tHtml("QA.keepRight.ignore")).on("click.ignore",function(v,E){this.blur(),e&&(E.newStatus="false",e.postUpdate(E,(b,T)=>i.call("change",T)))})}return o.error=function(u){return arguments.length?(n=u,o):n},$t(o,i,"on")}function Fl(t,e){let i,r="",s="",n="",o,a=ye(null),l,u={id:e};u.label=function(m){return arguments.length?(r=m,u):r},u.key=function(m){return arguments.length?(i=m,u):i},u.description=function(m){return arguments.length?(s=m,u):s},u.iconName=function(m){return arguments.length?(n=m,u):n},u.sections=function(m){return arguments.length?(o=m,u):o},u.selection=function(){return a};function d(){t.systems.ui.togglePanes()}return u.togglePane=function(m){m&&m.preventDefault(),l.hide();let g=!a.classed("shown");t.systems.ui.togglePanes(g?a:void 0),u.id==="issues"&&g&&t.systems.validator.validate()},u.renderToggleButton=function(m){if(!l){let g=t.systems.l10n.isRTL();l=Ft(t).placement(g?"right":"left").title(s).keys([i])}m.append("button").on("click",u.togglePane).call(Ye(`#${n}`,"light")).call(l)},u.renderContent=function(m){if(o)for(let g of o)m.call(g.render)},u.renderPane=function(m){a=m.append("div").attr("class",`fillL map-pane hide ${e}-pane`).attr("pane",e);let g=a.append("div").attr("class","pane-heading");g.append("h2").html(r),g.append("button").on("click",d).call(Ye("#rapid-icon-close")),a.append("div").attr("class","pane-content").call(u.renderContent),i&&t.keybinding().on(i,u.togglePane)},u}function Y_(t){let e=Mt("resize");function i(r){r.append("button").attr("class","thumb-hide").on("click",()=>{for(let o of["mapillary","kartaview","streetside"])t.services[o]?.hideViewer()}).append("div").call(Ye("#rapid-icon-close"));function s(o){o.preventDefault()}r.append("button").attr("class","resize-handle-xy").on("touchstart touchdown touchend",s).on("pointerdown",n(r,"resize",{resizeOnX:!0,resizeOnY:!0})),r.append("button").attr("class","resize-handle-x").on("touchstart touchdown touchend",s).on("pointerdown",n(r,"resize",{resizeOnX:!0})),r.append("button").attr("class","resize-handle-y").on("touchstart touchdown touchend",s).on("pointerdown",n(r,"resize",{resizeOnY:!0}));function n(o,a,l){let u=!!l.resizeOnX,d=!!l.resizeOnY,m=l.minHeight||240,g=l.minWidth||320,_,v,E,b,T;function A(F){if(_!==(F.pointerId||"mouse"))return;F.preventDefault(),F.stopPropagation();let O=t.systems.map.dimensions;if(u){let B=O[0],U=M(b+F.clientX-v,g,B);o.style("width",U+"px")}if(d){let B=O[1]-90,U=M(T+E-F.clientY,m,B);o.style("height",U+"px")}e.call(a,o,hc(o,!0))}function M(F,O,B){return Math.max(O,Math.min(F,B))}function k(F){_===(F.pointerId||"mouse")&&(F.preventDefault(),F.stopPropagation(),ye(window).on("."+a,null))}return function(O){O.preventDefault(),O.stopPropagation(),_=O.pointerId||"mouse",v=O.clientX,E=O.clientY;let B=o.node().getBoundingClientRect();b=B.width,T=B.height,ye(window).on("pointermove."+a,A,!1).on("pointerup."+a,k,!1).on("pointercancel."+a,k,!1)}}}return i.onMapResize=function(){let r=t.container().select(".photoviewer"),s=t.container().select(".main-content"),n=hc(s,!0),o=hc(r,!0);if(o[0]>n[0]||o[1]>n[1]-90){let a=[Math.min(o[0],n[0]),Math.min(o[1],n[1]-90)];r.style("width",a[0]+"px").style("height",a[1]+"px"),e.call("resize",r,a)}},$t(i,e,"on")}function Z_(t,e){let i=Mt("change","done"),r=()=>{};function s(u){let d=t.container().selectAll(".shaded");d.empty()||(d.selectAll(".colorpicker-popup").size()?r():l(d,u.currentTarget))}function n(u){let d=u.target,m=d&&d.className||"";/colorpicker/i.test(m)||(u.stopPropagation(),u.preventDefault(),r())}function o(u){let d=u.length<6,m=parseInt(d?u[1]+u[1]:u[1]+u[2],16),g=parseInt(d?u[2]+u[2]:u[3]+u[4],16),_=parseInt(d?u[3]+u[3]:u[5]+u[6],16);return(m*299+g*587+_*114)/1e3}function a(u){let d=u.selectAll(".rapid-colorpicker").data(g=>[g],g=>g.id),m=d.enter().append("div").attr("class","rapid-colorpicker").on("click",s);m.append("div").attr("class","rapid-colorpicker-fill").call(Ye("#fas-palette")),d.merge(m).selectAll(".rapid-colorpicker-fill").style("background",g=>g.color).select(".icon").style("color",g=>o(g.color)>140.5?"#333":"#fff")}function l(u,d){let m=t.systems.l10n.isRTL(),g=d.__data__,_=d.getBoundingClientRect(),v=180,E=_.bottom+15,b=m?_.right-.3333*v:_.left-.6666*v,T=m?.3333*v-_.width+10:.6666*v+10,A=e.close;e.close=()=>{},r=()=>{k.transition().duration(200).style("opacity",0).remove(),e.close=A;let $=zi("modal");$.on(["\u232B","\u238B"],A),ye(document).call($),ye(document).on("click.colorpicker",null),r=()=>{},i.call("done")};let M=zi("modal");M.on(["\u232B","\u238B"],r),ye(document).call(M),ye(document).on("click.colorpicker",n);let k=u.append("div").attr("class","colorpicker-popup").style("opacity",0).style("width",v+"px").style("top",E+"px").style("left",b+"px");k.append("div").attr("class","colorpicker-arrow").style("left",T+"px");let O=k.append("div").attr("class","colorpicker-content").selectAll(".colorpicker-colors").data([0]);O=O.enter().append("div").attr("class","colorpicker-colors").merge(O);let B=O.selectAll(".colorpicker-option").data(t.systems.rapid.colors),U=B.enter().append("div").attr("class","colorpicker-option").style("color",$=>$).on("click",($,q)=>{i.call("change",this,g.id,q),B.classed("selected",W=>W===q)});U.append("div").attr("class","colorpicker-option-fill"),B=B.merge(U),B.classed("selected",$=>$===g.color),k.transition().style("opacity",1)}return $t(a,i,"on")}function Q_(t){return function(i){let r=t.systems.storage;if(r.getItem("sawRapidSplash"))return;r.setItem("sawRapidSplash",!0);let s=ws(i);s.select(".modal").attr("class","modal rapid-modal modal-splash");let n=s.select(".content");n.append("div").attr("class","modal-section").append("h3").text(t.t("rapid_splash.welcome")),n.append("div").attr("class","modal-section").append("p").html(t.t("rapid_splash.text",{rapidicon:pi("#rapid-logo-rapid-wordmark","logo-rapid"),walkthrough:pi("#rapid-logo-walkthrough","logo-walkthrough"),edit:pi("#rapid-logo-features","logo-features")}));let o=n.append("div").attr("class","modal-actions"),a=o.append("button").attr("class","walkthrough").on("click",()=>{t.container().call(dc(t,!1)),s.close()});a.append("svg").attr("class","logo logo-features").append("use").attr("xlink:href","#rapid-logo-walkthrough"),a.append("div").text(t.t("rapid_splash.walkthrough"));let l=o.append("button").attr("class","rapid-walkthrough").on("click",()=>{t.container().call(dc(t,!0)),s.close()});l.append("svg").attr("class","logo logo-rapid").append("use").attr("xlink:href","#rapid-logo-rapid-wordmark"),l.append("div").text(t.t("rapid_splash.skip_to_rapid"));let u=o.append("button").attr("class","start-editing").on("click",()=>{s.close()});u.append("svg").attr("class","logo logo-features").append("use").attr("xlink:href","#rapid-logo-features"),u.append("div").text(t.t("rapid_splash.start")),s.select("button.close").attr("class","hide")}}function K_(t){return function(e){let i=ws(e);i.select(".modal").attr("class","modal rapid-modal");let r=i.select(".content");r.append("div").attr("class","modal-section").append("h3").html(t.t("rapid_first_edit.nice",{rapidicon:pi("#rapid-logo-rapid-wordmark","logo-rapid")})),r.append("div").attr("class","modal-section").append("p").text(t.t("rapid_first_edit.text"));let s=r.append("div").attr("class","modal-actions");s.append("button").attr("class","rapid-explore").on("click",()=>{i.close()}).append("div").text(t.t("rapid_first_edit.exploring")),s.append("button").attr("class","rapid-login-to-osm").on("click",()=>{i.close();let a=t.services.osm;a&&a.authenticate(()=>t.container().call(Q_(t)))}).append("div").text(t.t("rapid_first_edit.login_with_osm")),i.select("button.close").attr("class","hide")}}var AS=50;function K4(t,e){let i=t.systems.rapid,r=t.systems.urlhash,s;function n(){return r.initialHashParams.has("gpx")||r.getParam("poweruser")==="true"?!1:t.systems.edits.peekAllAnnotations().filter(T=>T.type==="rapid_accept_feature").length>=AS}function o(){if(!s)return;if(n()){X4(t).duration(5e3).label(t.t("rapid_feature_inspector.option_accept.disabled_flash",{n:AS}))();return}let _={type:"rapid_accept_feature",description:t.t("rapid_feature_inspector.option_accept.annotation"),id:s.id,origid:s.__origid__},E=t.services[s.__service__].graph(s.__datasetid__),b=s.tags&&s.tags.source;if(b&&(_.source=b),t.perform(Og(s.id,E),_),t.enter("select-osm",{selectedIDs:[s.id]}),t.inIntro||(i.sources.add("mapwithai"),b&&/^esri/.test(b)&&i.sources.add("esri"),window.sessionStorage.getItem("acknowledgedLogin")==="true"))return;window.sessionStorage.setItem("acknowledgedLogin","true"),t.services.osm.authenticated()||t.container().call(K_(t))}function a(){if(!s)return;let _={type:"rapid_ignore_feature",description:t.t("rapid_feature_inspector.option_ignore.annotation"),id:s.id,origid:s.__origid__};t.perform(as(),_),t.enter("browse")}function l(_){let v=_.length<6,E=parseInt(v?_[1]+_[1]:_[1]+_[2],16),b=parseInt(v?_[2]+_[2]:_[3]+_[4],16),T=parseInt(v?_[3]+_[3]:_[5]+_[6],16);return(E*299+b*587+T*114)/1e3}function u(_){if(!s)return;let v=s.__datasetid__.replace("-conflated",""),E=i.datasets.get(v),b=E.color,T=_.selectAll(".feature-info").data([b]),A=T.enter().append("div").attr("class","feature-info");A.append("div").attr("class","dataset-label").text(E.label||E.id),E.beta&&A.append("div").attr("class","dataset-beta beta").attr("title",t.t("rapid_poweruser_features.beta")),T=T.merge(A).style("background",M=>M).style("color",M=>l(M)>140.5?"#333":"#fff")}function d(_){let v=s&&s.tags;if(!v)return;let b=_.selectAll(".tag-info").data([0]).enter().append("div").attr("class","tag-info").append("div").attr("class","tag-bag");b.append("div").attr("class","tag-heading").text(t.t("rapid_feature_inspector.tags")),Object.keys(v).map(A=>({key:A,value:v[A]})).forEach(A=>{let M=b.append("div").attr("class","tag-entry");M.append("div").attr("class","tag-key").text(A.key),M.append("div").attr("class","tag-value").text(A.value)})}function m(_){let v=_.selectAll(".rapid-inspector").data([0]),E=v.enter().append("div").attr("class","rapid-inspector");v=v.merge(E);let b=v.selectAll(".header").data([0]).enter().append("div").attr("class","header");b.append("h3").append("svg").attr("class","logo-rapid").append("use").attr("xlink:href","#rapid-logo-rapid-wordmark"),b.append("button").attr("class","fr rapid-inspector-close").on("click",()=>{t.enter("browse")}).call(Ye("#rapid-icon-close"));let T=v.selectAll(".body").data([0]),A=T.enter().append("div").attr("class","body");T=T.merge(A).call(u).call(d);let M=[{key:"accept",iconName:"#rapid-icon-rapid-plus-circle",label:t.t("rapid_feature_inspector.option_accept.label"),description:t.t("rapid_feature_inspector.option_accept.description"),onClick:o},{key:"ignore",iconName:"#rapid-icon-rapid-minus-circle",label:t.t("rapid_feature_inspector.option_ignore.label"),description:t.t("rapid_feature_inspector.option_ignore.description"),onClick:a}],F=T.selectAll(".rapid-inspector-choices").data([0]).enter().append("div").attr("class","rapid-inspector-choices");F.append("p").text(t.t("rapid_feature_inspector.prompt")),F.selectAll(".rapid-inspector-choice").data(M,O=>O.key).enter().append("div").attr("class",O=>`rapid-inspector-choice rapid-inspector-choice-${O.key}`).each(g)}function g(_,v,E){let b=ye(E[v]),T=_.key==="accept"&&n()?"secondary disabled":"",A=b.append("div").attr("class",`choice-wrap choice-wrap-${_.key}`),M=b.append("div").attr("class","tag-reference-body");M.text(_.description);let k=_.onClick,F=A.append("button").attr("class",`choice-button choice-button-${_.key} ${T}`).on("click",k),O,B;_.key==="accept"?n()?(O=t.t("rapid_feature_inspector.option_accept.disabled",{n:AS}),B=[]):(O=t.t("rapid_feature_inspector.option_accept.tooltip"),B=[t.t("rapid_feature_inspector.option_accept.key")]):_.key==="ignore"&&(O=t.t("rapid_feature_inspector.option_ignore.tooltip"),B=[t.t("rapid_feature_inspector.option_ignore.key")]),O&&B&&(F=F.call(Ft(t).placement("bottom").title(O).keys(B))),F.append("svg").attr("class","choice-icon icon").append("use").attr("xlink:href",_.iconName),F.append("div").attr("class","choice-label").text(_.label),A.append("button").attr("class",`tag-reference-button ${T}`).attr("title","info").attr("tabindex","-1").on("click",()=>{M.classed("expanded",!M.classed("expanded"))}).call(Ye("#rapid-icon-inspect"))}return m.datum=function(_){return arguments.length?(s=_,this):s},e&&e().on(t.t("rapid_feature_inspector.option_accept.key"),o).on(t.t("rapid_feature_inspector.option_ignore.key"),a),m}function IS(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!1,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!1,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}var p0=IS();function bO(t){p0=t}var wO=/[&<>"']/,qQ=new RegExp(wO.source,"g"),EO=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,YQ=new RegExp(EO.source,"g"),ZQ={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},gO=t=>ZQ[t];function bo(t,e){if(e){if(wO.test(t))return t.replace(qQ,gO)}else if(EO.test(t))return t.replace(YQ,gO);return t}var QQ=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function TO(t){return t.replace(QQ,(e,i)=>(i=i.toLowerCase(),i==="colon"?":":i.charAt(0)==="#"?i.charAt(1)==="x"?String.fromCharCode(parseInt(i.substring(2),16)):String.fromCharCode(+i.substring(1)):""))}var KQ=/(^|[^\[])\^/g;function jr(t,e){t=typeof t=="string"?t:t.source,e=e||"";let i={replace:(r,s)=>(s=typeof s=="object"&&"source"in s?s.source:s,s=s.replace(KQ,"$1"),t=t.replace(r,s),i),getRegex:()=>new RegExp(t,e)};return i}var JQ=/[^\w:]/g,eK=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function yO(t,e,i){if(t){let r;try{r=decodeURIComponent(TO(i)).replace(JQ,"").toLowerCase()}catch{return null}if(r.indexOf("javascript:")===0||r.indexOf("vbscript:")===0||r.indexOf("data:")===0)return null}e&&!eK.test(i)&&(i=sK(e,i));try{i=encodeURI(i).replace(/%25/g,"%")}catch{return null}return i}var J_={},tK=/^[^:]+:\/*[^/]*$/,iK=/^([^:]+:)[\s\S]*$/,rK=/^([^:]+:\/*[^/]*)[\s\S]*$/;function sK(t,e){J_[" "+t]||(tK.test(t)?J_[" "+t]=t+"/":J_[" "+t]=ex(t,"/",!0)),t=J_[" "+t];let i=t.indexOf(":")===-1;return e.substring(0,2)==="//"?i?e:t.replace(iK,"$1")+e:e.charAt(0)==="/"?i?e:t.replace(rK,"$1")+e:t+e}var tx={exec:()=>null};function _O(t,e){let i=t.replace(/\|/g,(n,o,a)=>{let l=!1,u=o;for(;--u>=0&&a[u]==="\\";)l=!l;return l?"|":" |"}),r=i.split(/ \|/),s=0;if(r[0].trim()||r.shift(),r.length>0&&!r[r.length-1].trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;s<r.length;s++)r[s]=r[s].trim().replace(/\\\|/g,"|");return r}function ex(t,e,i){let r=t.length;if(r===0)return"";let s=0;for(;s<r;){let n=t.charAt(r-s-1);if(n===e&&!i)s++;else if(n!==e&&i)s++;else break}return t.slice(0,r-s)}function nK(t,e){if(t.indexOf(e[1])===-1)return-1;let i=0;for(let r=0;r<t.length;r++)if(t[r]==="\\")r++;else if(t[r]===e[0])i++;else if(t[r]===e[1]&&(i--,i<0))return r;return-1}function oK(t,e){!t||t.silent||(e&&console.warn("marked(): callback is deprecated since version 5.0.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/using_pro#async"),(t.sanitize||t.sanitizer)&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options"),(t.highlight||t.langPrefix!=="language-")&&console.warn("marked(): highlight and langPrefix parameters are deprecated since version 5.0.0, should not be used and will be removed in the future. Instead use https://www.npmjs.com/package/marked-highlight."),t.mangle&&console.warn("marked(): mangle parameter is enabled by default, but is deprecated since version 5.0.0, and will be removed in the future. To clear this warning, install https://www.npmjs.com/package/marked-mangle, or disable by setting `{mangle: false}`."),t.baseUrl&&console.warn("marked(): baseUrl parameter is deprecated since version 5.0.0, should not be used and will be removed in the future. Instead use https://www.npmjs.com/package/marked-base-url."),t.smartypants&&console.warn("marked(): smartypants parameter is deprecated since version 5.0.0, should not be used and will be removed in the future. Instead use https://www.npmjs.com/package/marked-smartypants."),t.xhtml&&console.warn("marked(): xhtml parameter is deprecated since version 5.0.0, should not be used and will be removed in the future. Instead use https://www.npmjs.com/package/marked-xhtml."),(t.headerIds||t.headerPrefix)&&console.warn("marked(): headerIds and headerPrefix parameters enabled by default, but are deprecated since version 5.0.0, and will be removed in the future. To clear this warning, install  https://www.npmjs.com/package/marked-gfm-heading-id, or disable by setting `{headerIds: false}`."))}function xO(t,e,i,r){let s=e.href,n=e.title?bo(e.title):null,o=t[1].replace(/\\([\[\]])/g,"$1");if(t[0].charAt(0)!=="!"){r.state.inLink=!0;let a={type:"link",raw:i,href:s,title:n,text:o,tokens:r.inlineTokens(o)};return r.state.inLink=!1,a}return{type:"image",raw:i,href:s,title:n,text:bo(o)}}function aK(t,e){let i=t.match(/^(\s+)(?:```)/);if(i===null)return e;let r=i[1];return e.split(`
`).map(s=>{let n=s.match(/^\s+/);if(n===null)return s;let[o]=n;return o.length>=r.length?s.slice(r.length):s}).join(`
`)}var ep=class{options;rules;lexer;constructor(e){this.options=e||p0}space(e){let i=this.rules.block.newline.exec(e);if(i&&i[0].length>0)return{type:"space",raw:i[0]}}code(e){let i=this.rules.block.code.exec(e);if(i){let r=i[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:i[0],codeBlockStyle:"indented",text:this.options.pedantic?r:ex(r,`
`)}}}fences(e){let i=this.rules.block.fences.exec(e);if(i){let r=i[0],s=aK(r,i[3]||"");return{type:"code",raw:r,lang:i[2]?i[2].trim().replace(this.rules.inline._escapes,"$1"):i[2],text:s}}}heading(e){let i=this.rules.block.heading.exec(e);if(i){let r=i[2].trim();if(/#$/.test(r)){let s=ex(r,"#");(this.options.pedantic||!s||/ $/.test(s))&&(r=s.trim())}return{type:"heading",raw:i[0],depth:i[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(e){let i=this.rules.block.hr.exec(e);if(i)return{type:"hr",raw:i[0]}}blockquote(e){let i=this.rules.block.blockquote.exec(e);if(i){let r=i[0].replace(/^ *>[ \t]?/gm,""),s=this.lexer.state.top;this.lexer.state.top=!0;let n=this.lexer.blockTokens(r);return this.lexer.state.top=s,{type:"blockquote",raw:i[0],tokens:n,text:r}}}list(e){let i=this.rules.block.list.exec(e);if(i){let r=i[1].trim(),s=r.length>1,n={type:"list",raw:"",ordered:s,start:s?+r.slice(0,-1):"",loose:!1,items:[]};r=s?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=s?r:"[*+-]");let o=new RegExp(`^( {0,3}${r})((?:[	 ][^\\n]*)?(?:\\n|$))`),a="",l="",u=!1;for(;e;){let d=!1;if(!(i=o.exec(e))||this.rules.block.hr.test(e))break;a=i[0],e=e.substring(a.length);let m=i[2].split(`
`,1)[0].replace(/^\t+/,T=>" ".repeat(3*T.length)),g=e.split(`
`,1)[0],_=0;this.options.pedantic?(_=2,l=m.trimLeft()):(_=i[2].search(/[^ ]/),_=_>4?1:_,l=m.slice(_),_+=i[1].length);let v=!1;if(!m&&/^ *$/.test(g)&&(a+=g+`
`,e=e.substring(g.length+1),d=!0),!d){let T=new RegExp(`^ {0,${Math.min(3,_-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),A=new RegExp(`^ {0,${Math.min(3,_-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),M=new RegExp(`^ {0,${Math.min(3,_-1)}}(?:\`\`\`|~~~)`),k=new RegExp(`^ {0,${Math.min(3,_-1)}}#`);for(;e;){let F=e.split(`
`,1)[0];if(g=F,this.options.pedantic&&(g=g.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),M.test(g)||k.test(g)||T.test(g)||A.test(e))break;if(g.search(/[^ ]/)>=_||!g.trim())l+=`
`+g.slice(_);else{if(v||m.search(/[^ ]/)>=4||M.test(m)||k.test(m)||A.test(m))break;l+=`
`+g}!v&&!g.trim()&&(v=!0),a+=F+`
`,e=e.substring(F.length+1),m=g.slice(_)}}n.loose||(u?n.loose=!0:/\n *\n *$/.test(a)&&(u=!0));let E=null,b;this.options.gfm&&(E=/^\[[ xX]\] /.exec(l),E&&(b=E[0]!=="[ ] ",l=l.replace(/^\[[ xX]\] +/,""))),n.items.push({type:"list_item",raw:a,task:!!E,checked:b,loose:!1,text:l,tokens:[]}),n.raw+=a}n.items[n.items.length-1].raw=a.trimRight(),n.items[n.items.length-1].text=l.trimRight(),n.raw=n.raw.trimRight();for(let d=0;d<n.items.length;d++)if(this.lexer.state.top=!1,n.items[d].tokens=this.lexer.blockTokens(n.items[d].text,[]),!n.loose){let m=n.items[d].tokens.filter(_=>_.type==="space"),g=m.length>0&&m.some(_=>/\n.*\n/.test(_.raw));n.loose=g}if(n.loose)for(let d=0;d<n.items.length;d++)n.items[d].loose=!0;return n}}html(e){let i=this.rules.block.html.exec(e);if(i){let r={type:"html",block:!0,raw:i[0],pre:!this.options.sanitizer&&(i[1]==="pre"||i[1]==="script"||i[1]==="style"),text:i[0]};if(this.options.sanitize){let s=this.options.sanitizer?this.options.sanitizer(i[0]):bo(i[0]),n=r;n.type="paragraph",n.text=s,n.tokens=this.lexer.inline(s)}return r}}def(e){let i=this.rules.block.def.exec(e);if(i){let r=i[1].toLowerCase().replace(/\s+/g," "),s=i[2]?i[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",n=i[3]?i[3].substring(1,i[3].length-1).replace(this.rules.inline._escapes,"$1"):i[3];return{type:"def",tag:r,raw:i[0],href:s,title:n}}}table(e){let i=this.rules.block.table.exec(e);if(i){let r={type:"table",raw:i[0],header:_O(i[1]).map(s=>({text:s,tokens:[]})),align:i[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:i[3]&&i[3].trim()?i[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(r.header.length===r.align.length){let s=r.align.length,n,o,a,l;for(n=0;n<s;n++){let u=r.align[n];u&&(/^ *-+: *$/.test(u)?r.align[n]="right":/^ *:-+: *$/.test(u)?r.align[n]="center":/^ *:-+ *$/.test(u)?r.align[n]="left":r.align[n]=null)}for(s=r.rows.length,n=0;n<s;n++)r.rows[n]=_O(r.rows[n],r.header.length).map(u=>({text:u,tokens:[]}));for(s=r.header.length,o=0;o<s;o++)r.header[o].tokens=this.lexer.inline(r.header[o].text);for(s=r.rows.length,o=0;o<s;o++)for(l=r.rows[o],a=0;a<l.length;a++)l[a].tokens=this.lexer.inline(l[a].text);return r}}}lheading(e){let i=this.rules.block.lheading.exec(e);if(i)return{type:"heading",raw:i[0],depth:i[2].charAt(0)==="="?1:2,text:i[1],tokens:this.lexer.inline(i[1])}}paragraph(e){let i=this.rules.block.paragraph.exec(e);if(i){let r=i[1].charAt(i[1].length-1)===`
`?i[1].slice(0,-1):i[1];return{type:"paragraph",raw:i[0],text:r,tokens:this.lexer.inline(r)}}}text(e){let i=this.rules.block.text.exec(e);if(i)return{type:"text",raw:i[0],text:i[0],tokens:this.lexer.inline(i[0])}}escape(e){let i=this.rules.inline.escape.exec(e);if(i)return{type:"escape",raw:i[0],text:bo(i[1])}}tag(e){let i=this.rules.inline.tag.exec(e);if(i)return!this.lexer.state.inLink&&/^<a /i.test(i[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(i[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(i[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(i[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:i[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(i[0]):bo(i[0]):i[0]}}link(e){let i=this.rules.inline.link.exec(e);if(i){let r=i[2].trim();if(!this.options.pedantic&&/^</.test(r)){if(!/>$/.test(r))return;let o=ex(r.slice(0,-1),"\\");if((r.length-o.length)%2===0)return}else{let o=nK(i[2],"()");if(o>-1){let l=(i[0].indexOf("!")===0?5:4)+i[1].length+o;i[2]=i[2].substring(0,o),i[0]=i[0].substring(0,l).trim(),i[3]=""}}let s=i[2],n="";if(this.options.pedantic){let o=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(s);o&&(s=o[1],n=o[3])}else n=i[3]?i[3].slice(1,-1):"";return s=s.trim(),/^</.test(s)&&(this.options.pedantic&&!/>$/.test(r)?s=s.slice(1):s=s.slice(1,-1)),xO(i,{href:s&&s.replace(this.rules.inline._escapes,"$1"),title:n&&n.replace(this.rules.inline._escapes,"$1")},i[0],this.lexer)}}reflink(e,i){let r;if((r=this.rules.inline.reflink.exec(e))||(r=this.rules.inline.nolink.exec(e))){let s=(r[2]||r[1]).replace(/\s+/g," ");if(s=i[s.toLowerCase()],!s){let n=r[0].charAt(0);return{type:"text",raw:n,text:n}}return xO(r,s,r[0],this.lexer)}}emStrong(e,i,r=""){let s=this.rules.inline.emStrong.lDelim.exec(e);if(!s||s[3]&&r.match(/[\p{L}\p{N}]/u))return;if(!(s[1]||s[2]||"")||!r||this.rules.inline.punctuation.exec(r)){let o=[...s[0]].length-1,a,l,u=o,d=0,m=s[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(m.lastIndex=0,i=i.slice(-1*e.length+o);(s=m.exec(i))!=null;){if(a=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!a)continue;if(l=[...a].length,s[3]||s[4]){u+=l;continue}else if((s[5]||s[6])&&o%3&&!((o+l)%3)){d+=l;continue}if(u-=l,u>0)continue;l=Math.min(l,l+u+d);let g=[...e].slice(0,o+s.index+l+1).join("");if(Math.min(o,l)%2){let v=g.slice(1,-1);return{type:"em",raw:g,text:v,tokens:this.lexer.inlineTokens(v)}}let _=g.slice(2,-2);return{type:"strong",raw:g,text:_,tokens:this.lexer.inlineTokens(_)}}}}codespan(e){let i=this.rules.inline.code.exec(e);if(i){let r=i[2].replace(/\n/g," "),s=/[^ ]/.test(r),n=/^ /.test(r)&&/ $/.test(r);return s&&n&&(r=r.substring(1,r.length-1)),r=bo(r,!0),{type:"codespan",raw:i[0],text:r}}}br(e){let i=this.rules.inline.br.exec(e);if(i)return{type:"br",raw:i[0]}}del(e){let i=this.rules.inline.del.exec(e);if(i)return{type:"del",raw:i[0],text:i[2],tokens:this.lexer.inlineTokens(i[2])}}autolink(e,i){let r=this.rules.inline.autolink.exec(e);if(r){let s,n;return r[2]==="@"?(s=bo(this.options.mangle?i(r[1]):r[1]),n="mailto:"+s):(s=bo(r[1]),n=s),{type:"link",raw:r[0],text:s,href:n,tokens:[{type:"text",raw:s,text:s}]}}}url(e,i){let r;if(r=this.rules.inline.url.exec(e)){let s,n;if(r[2]==="@")s=bo(this.options.mangle?i(r[0]):r[0]),n="mailto:"+s;else{let o;do o=r[0],r[0]=this.rules.inline._backpedal.exec(r[0])[0];while(o!==r[0]);s=bo(r[0]),r[1]==="www."?n="http://"+r[0]:n=r[0]}return{type:"link",raw:r[0],text:s,href:n,tokens:[{type:"text",raw:s,text:s}]}}}inlineText(e,i){let r=this.rules.inline.text.exec(e);if(r){let s;return this.lexer.state.inRawBlock?s=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):bo(r[0]):r[0]:s=bo(this.options.smartypants?i(r[0]):r[0]),{type:"text",raw:r[0],text:s}}}},Li={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:tx,lheading:/^((?:(?!^bull ).|\n(?!\n|bull ))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};Li._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;Li._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;Li.def=jr(Li.def).replace("label",Li._label).replace("title",Li._title).getRegex();Li.bullet=/(?:[*+-]|\d{1,9}[.)])/;Li.listItemStart=jr(/^( *)(bull) */).replace("bull",Li.bullet).getRegex();Li.list=jr(Li.list).replace(/bull/g,Li.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+Li.def.source+")").getRegex();Li._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";Li._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;Li.html=jr(Li.html,"i").replace("comment",Li._comment).replace("tag",Li._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();Li.lheading=jr(Li.lheading).replace(/bull/g,Li.bullet).getRegex();Li.paragraph=jr(Li._paragraph).replace("hr",Li.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Li._tag).getRegex();Li.blockquote=jr(Li.blockquote).replace("paragraph",Li.paragraph).getRegex();Li.normal={...Li};Li.gfm={...Li.normal,table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"};Li.gfm.table=jr(Li.gfm.table).replace("hr",Li.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Li._tag).getRegex();Li.gfm.paragraph=jr(Li._paragraph).replace("hr",Li.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",Li.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Li._tag).getRegex();Li.pedantic={...Li.normal,html:jr(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Li._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:tx,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:jr(Li.normal._paragraph).replace("hr",Li.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Li.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()};var si={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:tx,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,rDelimAst:/^[^_*]*?__[^_*]*?\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\*)[punct](\*+)(?=[\s]|$)|[^punct\s](\*+)(?!\*)(?=[punct\s]|$)|(?!\*)[punct\s](\*+)(?=[^punct\s])|[\s](\*+)(?!\*)(?=[punct])|(?!\*)[punct](\*+)(?!\*)(?=[punct])|[^punct\s](\*+)(?=[^punct\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?_[^_*]*?(?=\*\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\s]|$)|[^punct\s](_+)(?!_)(?=[punct\s]|$)|(?!_)[punct\s](_+)(?=[^punct\s])|[\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:tx,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^((?![*_])[\spunctuation])/};si._punctuation="\\p{P}$+<=>`^|~";si.punctuation=jr(si.punctuation,"u").replace(/punctuation/g,si._punctuation).getRegex();si.blockSkip=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g;si.anyPunctuation=/\\[punct]/g;si._escapes=/\\([punct])/g;si._comment=jr(Li._comment).replace("(?:-->|$)","-->").getRegex();si.emStrong.lDelim=jr(si.emStrong.lDelim,"u").replace(/punct/g,si._punctuation).getRegex();si.emStrong.rDelimAst=jr(si.emStrong.rDelimAst,"gu").replace(/punct/g,si._punctuation).getRegex();si.emStrong.rDelimUnd=jr(si.emStrong.rDelimUnd,"gu").replace(/punct/g,si._punctuation).getRegex();si.anyPunctuation=jr(si.anyPunctuation,"gu").replace(/punct/g,si._punctuation).getRegex();si._escapes=jr(si._escapes,"gu").replace(/punct/g,si._punctuation).getRegex();si._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;si._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;si.autolink=jr(si.autolink).replace("scheme",si._scheme).replace("email",si._email).getRegex();si._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;si.tag=jr(si.tag).replace("comment",si._comment).replace("attribute",si._attribute).getRegex();si._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;si._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;si._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;si.link=jr(si.link).replace("label",si._label).replace("href",si._href).replace("title",si._title).getRegex();si.reflink=jr(si.reflink).replace("label",si._label).replace("ref",Li._label).getRegex();si.nolink=jr(si.nolink).replace("ref",Li._label).getRegex();si.reflinkSearch=jr(si.reflinkSearch,"g").replace("reflink",si.reflink).replace("nolink",si.nolink).getRegex();si.normal={...si};si.pedantic={...si.normal,strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:jr(/^!?\[(label)\]\((.*?)\)/).replace("label",si._label).getRegex(),reflink:jr(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",si._label).getRegex()};si.gfm={...si.normal,escape:jr(si.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/};si.gfm.url=jr(si.gfm.url,"i").replace("email",si.gfm._extended_email).getRegex();si.breaks={...si.gfm,br:jr(si.br).replace("{2,}","*").getRegex(),text:jr(si.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()};function lK(t){return t.replace(/---/g,"\u2014").replace(/--/g,"\u2013").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1\u2018").replace(/'/g,"\u2019").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1\u201C").replace(/"/g,"\u201D").replace(/\.{3}/g,"\u2026")}function vO(t){let e="";for(let i=0;i<t.length;i++){let r=Math.random()>.5?"x"+t.charCodeAt(i).toString(16):t.charCodeAt(i).toString();e+="&#"+r+";"}return e}var i1=class t{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||p0,this.options.tokenizer=this.options.tokenizer||new ep,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let i={block:Li.normal,inline:si.normal};this.options.pedantic?(i.block=Li.pedantic,i.inline=si.pedantic):this.options.gfm&&(i.block=Li.gfm,this.options.breaks?i.inline=si.breaks:i.inline=si.gfm),this.tokenizer.rules=i}static get rules(){return{block:Li,inline:si}}static lex(e,i){return new t(i).lex(e)}static lexInline(e,i){return new t(i).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);let i;for(;i=this.inlineQueue.shift();)this.inlineTokens(i.src,i.tokens);return this.tokens}blockTokens(e,i=[]){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(a,l,u)=>l+"    ".repeat(u.length));let r,s,n,o;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(a=>(r=a.call({lexer:this},e,i))?(e=e.substring(r.raw.length),i.push(r),!0):!1))){if(r=this.tokenizer.space(e)){e=e.substring(r.raw.length),r.raw.length===1&&i.length>0?i[i.length-1].raw+=`
`:i.push(r);continue}if(r=this.tokenizer.code(e)){e=e.substring(r.raw.length),s=i[i.length-1],s&&(s.type==="paragraph"||s.type==="text")?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue[this.inlineQueue.length-1].src=s.text):i.push(r);continue}if(r=this.tokenizer.fences(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.heading(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.hr(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.blockquote(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.list(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.html(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.def(e)){e=e.substring(r.raw.length),s=i[i.length-1],s&&(s.type==="paragraph"||s.type==="text")?(s.raw+=`
`+r.raw,s.text+=`
`+r.raw,this.inlineQueue[this.inlineQueue.length-1].src=s.text):this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title});continue}if(r=this.tokenizer.table(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.lheading(e)){e=e.substring(r.raw.length),i.push(r);continue}if(n=e,this.options.extensions&&this.options.extensions.startBlock){let a=1/0,l=e.slice(1),u;this.options.extensions.startBlock.forEach(d=>{u=d.call({lexer:this},l),typeof u=="number"&&u>=0&&(a=Math.min(a,u))}),a<1/0&&a>=0&&(n=e.substring(0,a+1))}if(this.state.top&&(r=this.tokenizer.paragraph(n))){s=i[i.length-1],o&&s.type==="paragraph"?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):i.push(r),o=n.length!==e.length,e=e.substring(r.raw.length);continue}if(r=this.tokenizer.text(e)){e=e.substring(r.raw.length),s=i[i.length-1],s&&s.type==="text"?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):i.push(r);continue}if(e){let a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,i}inline(e,i=[]){return this.inlineQueue.push({src:e,tokens:i}),i}inlineTokens(e,i=[]){let r,s,n,o=e,a,l,u;if(this.tokens.links){let d=Object.keys(this.tokens.links);if(d.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(o))!=null;)d.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.blockSkip.exec(o))!=null;)o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(o))!=null;)o=o.slice(0,a.index)+"++"+o.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(l||(u=""),l=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(d=>(r=d.call({lexer:this},e,i))?(e=e.substring(r.raw.length),i.push(r),!0):!1))){if(r=this.tokenizer.escape(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.tag(e)){e=e.substring(r.raw.length),s=i[i.length-1],s&&r.type==="text"&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):i.push(r);continue}if(r=this.tokenizer.link(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(r.raw.length),s=i[i.length-1],s&&r.type==="text"&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):i.push(r);continue}if(r=this.tokenizer.emStrong(e,o,u)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.codespan(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.br(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.del(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.autolink(e,vO)){e=e.substring(r.raw.length),i.push(r);continue}if(!this.state.inLink&&(r=this.tokenizer.url(e,vO))){e=e.substring(r.raw.length),i.push(r);continue}if(n=e,this.options.extensions&&this.options.extensions.startInline){let d=1/0,m=e.slice(1),g;this.options.extensions.startInline.forEach(_=>{g=_.call({lexer:this},m),typeof g=="number"&&g>=0&&(d=Math.min(d,g))}),d<1/0&&d>=0&&(n=e.substring(0,d+1))}if(r=this.tokenizer.inlineText(n,lK)){e=e.substring(r.raw.length),r.raw.slice(-1)!=="_"&&(u=r.raw.slice(-1)),l=!0,s=i[i.length-1],s&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):i.push(r);continue}if(e){let d="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(d);break}else throw new Error(d)}}return i}},tp=class{options;constructor(e){this.options=e||p0}code(e,i,r){let s=(i||"").match(/^\S*/)?.[0];if(this.options.highlight){let n=this.options.highlight(e,s);n!=null&&n!==e&&(r=!0,e=n)}return e=e.replace(/\n$/,"")+`
`,s?'<pre><code class="'+this.options.langPrefix+bo(s)+'">'+(r?e:bo(e,!0))+`</code></pre>
`:"<pre><code>"+(r?e:bo(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e,i){return e}heading(e,i,r,s){if(this.options.headerIds){let n=this.options.headerPrefix+s.slug(r);return`<h${i} id="${n}">${e}</h${i}>
`}return`<h${i}>${e}</h${i}>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(e,i,r){let s=i?"ol":"ul",n=i&&r!==1?' start="'+r+'"':"";return"<"+s+n+`>
`+e+"</"+s+`>
`}listitem(e,i,r){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(e){return`<p>${e}</p>
`}table(e,i){return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+i+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,i){let r=i.header?"th":"td";return(i.align?`<${r} align="${i.align}">`:`<${r}>`)+e+`</${r}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(e){return`<del>${e}</del>`}link(e,i,r){let s=yO(this.options.sanitize,this.options.baseUrl,e);if(s===null)return r;e=s;let n='<a href="'+e+'"';return i&&(n+=' title="'+i+'"'),n+=">"+r+"</a>",n}image(e,i,r){let s=yO(this.options.sanitize,this.options.baseUrl,e);if(s===null)return r;e=s;let n=`<img src="${e}" alt="${r}"`;return i&&(n+=` title="${i}"`),n+=this.options.xhtml?"/>":">",n}text(e){return e}},T6=class{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,i,r){return""+r}image(e,i,r){return""+r}br(){return""}},S6=class{seen;constructor(){this.seen={}}serialize(e){return e.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(e,i){let r=e,s=0;if(this.seen.hasOwnProperty(r)){s=this.seen[e];do s++,r=e+"-"+s;while(this.seen.hasOwnProperty(r))}return i||(this.seen[e]=s,this.seen[r]=0),r}slug(e,i={}){let r=this.serialize(e);return this.getNextSafeSlug(r,i.dryrun)}},r1=class t{options;renderer;textRenderer;slugger;constructor(e){this.options=e||p0,this.options.renderer=this.options.renderer||new tp,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new T6,this.slugger=new S6}static parse(e,i){return new t(i).parse(e)}static parseInline(e,i){return new t(i).parseInline(e)}parse(e,i=!0){let r="";for(let s=0;s<e.length;s++){let n=e[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[n.type]){let o=n,a=this.options.extensions.renderers[o.type].call({parser:this},o);if(a!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(o.type)){r+=a||"";continue}}switch(n.type){case"space":continue;case"hr":{r+=this.renderer.hr();continue}case"heading":{let o=n;r+=this.renderer.heading(this.parseInline(o.tokens),o.depth,TO(this.parseInline(o.tokens,this.textRenderer)),this.slugger);continue}case"code":{let o=n;r+=this.renderer.code(o.text,o.lang,!!o.escaped);continue}case"table":{let o=n,a="",l="";for(let d=0;d<o.header.length;d++)l+=this.renderer.tablecell(this.parseInline(o.header[d].tokens),{header:!0,align:o.align[d]});a+=this.renderer.tablerow(l);let u="";for(let d=0;d<o.rows.length;d++){let m=o.rows[d];l="";for(let g=0;g<m.length;g++)l+=this.renderer.tablecell(this.parseInline(m[g].tokens),{header:!1,align:o.align[g]});u+=this.renderer.tablerow(l)}r+=this.renderer.table(a,u);continue}case"blockquote":{let o=n,a=this.parse(o.tokens);r+=this.renderer.blockquote(a);continue}case"list":{let o=n,a=o.ordered,l=o.start,u=o.loose,d="";for(let m=0;m<o.items.length;m++){let g=o.items[m],_=g.checked,v=g.task,E="";if(g.task){let b=this.renderer.checkbox(!!_);u?g.tokens.length>0&&g.tokens[0].type==="paragraph"?(g.tokens[0].text=b+" "+g.tokens[0].text,g.tokens[0].tokens&&g.tokens[0].tokens.length>0&&g.tokens[0].tokens[0].type==="text"&&(g.tokens[0].tokens[0].text=b+" "+g.tokens[0].tokens[0].text)):g.tokens.unshift({type:"text",text:b}):E+=b}E+=this.parse(g.tokens,u),d+=this.renderer.listitem(E,v,!!_)}r+=this.renderer.list(d,a,l);continue}case"html":{let o=n;r+=this.renderer.html(o.text,o.block);continue}case"paragraph":{let o=n;r+=this.renderer.paragraph(this.parseInline(o.tokens));continue}case"text":{let o=n,a=o.tokens?this.parseInline(o.tokens):o.text;for(;s+1<e.length&&e[s+1].type==="text";)o=e[++s],a+=`
`+(o.tokens?this.parseInline(o.tokens):o.text);r+=i?this.renderer.paragraph(a):a;continue}default:{let o='Token with "'+n.type+'" type was not found.';if(this.options.silent)return console.error(o),"";throw new Error(o)}}}return r}parseInline(e,i){i=i||this.renderer;let r="";for(let s=0;s<e.length;s++){let n=e[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[n.type]){let o=this.options.extensions.renderers[n.type].call({parser:this},n);if(o!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(n.type)){r+=o||"";continue}}switch(n.type){case"escape":{let o=n;r+=i.text(o.text);break}case"html":{let o=n;r+=i.html(o.text);break}case"link":{let o=n;r+=i.link(o.href,o.title,this.parseInline(o.tokens,i));break}case"image":{let o=n;r+=i.image(o.href,o.title,o.text);break}case"strong":{let o=n;r+=i.strong(this.parseInline(o.tokens,i));break}case"em":{let o=n;r+=i.em(this.parseInline(o.tokens,i));break}case"codespan":{let o=n;r+=i.codespan(o.text);break}case"br":{r+=i.br();break}case"del":{let o=n;r+=i.del(this.parseInline(o.tokens,i));break}case"text":{let o=n;r+=i.text(o.text);break}default:{let o='Token with "'+n.type+'" type was not found.';if(this.options.silent)return console.error(o),"";throw new Error(o)}}}return r}},J4=class{options;constructor(e){this.options=e||p0}static passThroughHooks=new Set(["preprocess","postprocess"]);preprocess(e){return e}postprocess(e){return e}},CS=class{defaults=IS();options=this.setOptions;parse=this.#e(i1.lex,r1.parse);parseInline=this.#e(i1.lexInline,r1.parseInline);Parser=r1;parser=r1.parse;Renderer=tp;TextRenderer=T6;Lexer=i1;lexer=i1.lex;Tokenizer=ep;Slugger=S6;Hooks=J4;constructor(...e){this.use(...e)}walkTokens(e,i){let r=[];for(let s of e)switch(r=r.concat(i.call(this,s)),s.type){case"table":{let n=s;for(let o of n.header)r=r.concat(this.walkTokens(o.tokens,i));for(let o of n.rows)for(let a of o)r=r.concat(this.walkTokens(a.tokens,i));break}case"list":{let n=s;r=r.concat(this.walkTokens(n.items,i));break}default:{let n=s;this.defaults.extensions?.childTokens?.[n.type]?this.defaults.extensions.childTokens[n.type].forEach(o=>{r=r.concat(this.walkTokens(n[o],i))}):n.tokens&&(r=r.concat(this.walkTokens(n.tokens,i)))}}return r}use(...e){let i=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(r=>{let s={...r};if(s.async=this.defaults.async||s.async||!1,r.extensions&&(r.extensions.forEach(n=>{if(!n.name)throw new Error("extension name required");if("renderer"in n){let o=i.renderers[n.name];o?i.renderers[n.name]=function(...a){let l=n.renderer.apply(this,a);return l===!1&&(l=o.apply(this,a)),l}:i.renderers[n.name]=n.renderer}if("tokenizer"in n){if(!n.level||n.level!=="block"&&n.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=i[n.level];o?o.unshift(n.tokenizer):i[n.level]=[n.tokenizer],n.start&&(n.level==="block"?i.startBlock?i.startBlock.push(n.start):i.startBlock=[n.start]:n.level==="inline"&&(i.startInline?i.startInline.push(n.start):i.startInline=[n.start]))}"childTokens"in n&&n.childTokens&&(i.childTokens[n.name]=n.childTokens)}),s.extensions=i),r.renderer){let n=this.defaults.renderer||new tp(this.defaults);for(let o in r.renderer){let a=r.renderer[o],l=o,u=n[l];n[l]=(...d)=>{let m=a.apply(n,d);return m===!1&&(m=u.apply(n,d)),m||""}}s.renderer=n}if(r.tokenizer){let n=this.defaults.tokenizer||new ep(this.defaults);for(let o in r.tokenizer){let a=r.tokenizer[o],l=o,u=n[l];n[l]=(...d)=>{let m=a.apply(n,d);return m===!1&&(m=u.apply(n,d)),m}}s.tokenizer=n}if(r.hooks){let n=this.defaults.hooks||new J4;for(let o in r.hooks){let a=r.hooks[o],l=o,u=n[l];J4.passThroughHooks.has(o)?n[l]=d=>{if(this.defaults.async)return Promise.resolve(a.call(n,d)).then(g=>u.call(n,g));let m=a.call(n,d);return u.call(n,m)}:n[l]=(...d)=>{let m=a.apply(n,d);return m===!1&&(m=u.apply(n,d)),m}}s.hooks=n}if(r.walkTokens){let n=this.defaults.walkTokens,o=r.walkTokens;s.walkTokens=function(a){let l=[];return l.push(o.call(this,a)),n&&(l=l.concat(n.call(this,a))),l}}this.defaults={...this.defaults,...s}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}#e(e,i){return(r,s,n)=>{typeof s=="function"&&(n=s,s=null);let o={...s},a={...this.defaults,...o};this.defaults.async===!0&&o.async===!1&&(a.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),a.async=!0);let l=this.#t(!!a.silent,!!a.async,n);if(typeof r>"u"||r===null)return l(new Error("marked(): input parameter is undefined or null"));if(typeof r!="string")return l(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(r)+", string expected"));if(oK(a,n),a.hooks&&(a.hooks.options=a),n){let u=n,d=a.highlight,m;try{a.hooks&&(r=a.hooks.preprocess(r)),m=e(r,a)}catch(v){return l(v)}let g=v=>{let E;if(!v)try{a.walkTokens&&this.walkTokens(m,a.walkTokens),E=i(m,a),a.hooks&&(E=a.hooks.postprocess(E))}catch(b){v=b}return a.highlight=d,v?l(v):u(null,E)};if(!d||d.length<3||(delete a.highlight,!m.length))return g();let _=0;this.walkTokens(m,v=>{v.type==="code"&&(_++,setTimeout(()=>{d(v.text,v.lang,(E,b)=>{if(E)return g(E);b!=null&&b!==v.text&&(v.text=b,v.escaped=!0),_--,_===0&&g()})},0))}),_===0&&g();return}if(a.async)return Promise.resolve(a.hooks?a.hooks.preprocess(r):r).then(u=>e(u,a)).then(u=>a.walkTokens?Promise.all(this.walkTokens(u,a.walkTokens)).then(()=>u):u).then(u=>i(u,a)).then(u=>a.hooks?a.hooks.postprocess(u):u).catch(l);try{a.hooks&&(r=a.hooks.preprocess(r));let u=e(r,a);a.walkTokens&&this.walkTokens(u,a.walkTokens);let d=i(u,a);return a.hooks&&(d=a.hooks.postprocess(d)),d}catch(u){return l(u)}}}#t(e,i,r){return s=>{if(s.message+=`
Please report this to https://github.com/markedjs/marked.`,e){let n="<p>An error occurred:</p><pre>"+bo(s.message+"",!0)+"</pre>";if(i)return Promise.resolve(n);if(r){r(null,n);return}return n}if(i)return Promise.reject(s);if(r){r(s);return}throw s}}},f0=new CS;function Ki(t,e,i){return f0.parse(t,e,i)}Ki.options=Ki.setOptions=function(t){return f0.setOptions(t),Ki.defaults=f0.defaults,bO(Ki.defaults),Ki};Ki.getDefaults=IS;Ki.defaults=p0;Ki.use=function(...t){return f0.use(...t),Ki.defaults=f0.defaults,bO(Ki.defaults),Ki};Ki.walkTokens=function(t,e){return f0.walkTokens(t,e)};Ki.parseInline=f0.parseInline;Ki.Parser=r1;Ki.parser=r1.parse;Ki.Renderer=tp;Ki.TextRenderer=T6;Ki.Lexer=i1;Ki.lexer=i1.lex;Ki.Tokenizer=ep;Ki.Slugger=S6;Ki.Hooks=J4;Ki.parse=Ki;var Jnt=Ki.options,eot=Ki.setOptions,tot=Ki.use,iot=Ki.walkTokens,rot=Ki.parseInline;var sot=r1.parse,not=i1.lex;function ix(t,e){let i=t.systems.rapid,r=Mt("done"),s=gr(t,"dataset-categories"),n=100,o=ye(null),a,l,u,d=()=>!0;function m(){let M=t.container().selectAll(".shaded");if(M.empty()||M.selectAll(".modal-view-manage").size())return;let k=e.close;e.close=()=>{},d=()=>{a=null,l=null,B.transition().duration(200).style("top","0px").on("end",()=>O.remove()),e.close=k;let U=zi("modal");U.on(["\u232B","\u238B"],k),ye(document).call(U),r.call("done")};let F=zi("modal");F.on(["\u232B","\u238B"],d),ye(document).call(F);let O=M.append("div").attr("class","view-manage-wrap"),B=O.append("div").attr("class","modal rapid-modal modal-view-manage").style("opacity",0);B.append("button").attr("class","close").on("click",d).call(Ye("#rapid-icon-close")),o=B.append("div").attr("class","rapid-stack content"),o.call(g),o.selectAll(".ok-button").node().focus(),B.transition().style("opacity",1)}function g(M){let k=M.selectAll(".rapid-view-manage-header").data([0]).enter().append("div").attr("class","modal-section rapid-view-manage-header"),F=k.append("div");F.append("div").attr("class","rapid-view-manage-header-icon").call(Ye("#rapid-icon-data","icon-30")),F.append("div").attr("class","rapid-view-manage-header-text").text(t.t("rapid_feature_toggle.esri.title"));let O=k.append("div");O.append("div").attr("class","rapid-view-manage-header-about").html(Ki.parse(t.t("rapid_feature_toggle.esri.about"))),O.selectAll("a").attr("target","_blank");let B=M.selectAll(".rapid-view-manage-filter").data([0]).enter().append("div").attr("class","modal-section rapid-view-manage-filter"),U=B.append("div").attr("class","rapid-view-manage-filter-search-wrap");U.call(Ye("#fas-filter","inline")),U.append("input").attr("class","rapid-view-manage-filter-search").attr("placeholder",t.t("rapid_feature_toggle.esri.filter_datasets")).call(ki).on("input",Q=>{let X=Q.currentTarget;a=(X&&X.value||"").trim().toLowerCase(),q.call(_)}),B.append("div").attr("class","rapid-view-manage-filter-type-wrap").append("input").attr("class","rapid-view-manage-filter-type").attr("placeholder",t.t("rapid_feature_toggle.esri.any_type")).call(ki).call(s).on("blur change",Q=>{let X=Q.currentTarget,ce=X&&X.value||"";s.data().some(le=>le.value===ce)?l=ce:(Q.currentTarget.value="",l=null),q.call(_)}),B.append("div").attr("class","rapid-view-manage-filter-clear").append("a").attr("href","#").text(t.t("rapid_feature_toggle.esri.clear_filters")).on("click",Q=>{Q.preventDefault(),Q.currentTarget.blur(),M.selectAll("input").property("value",""),a=null,l=null,q.call(_)}),B.append("div").attr("class","rapid-view-manage-filter-results");let q=M.selectAll(".rapid-view-manage-datasets-section").data([0]),W=q.enter().append("div").attr("class","modal-section rapid-view-manage-datasets-section");W.append("div").attr("class","rapid-view-manage-datasets-status"),W.append("div").attr("class","rapid-view-manage-datasets"),q=q.merge(W).call(_),M.selectAll(".modal-section.buttons").data([0]).enter().append("div").attr("class","modal-section buttons").append("button").attr("class","button ok-button action").on("click",d).text(t.t("confirm.okay"))}function _(M){let k=M.selectAll(".rapid-view-manage-datasets-status"),F=M.selectAll(".rapid-view-manage-datasets"),B=t.systems.storage.getItem("rapid-internal-feature.previewDatasets")==="true",U=t.services.esri;if(!U||Array.isArray(u)&&!u.length){F.classed("hide",!0),k.classed("hide",!1).text(t.t("rapid_feature_toggle.esri.no_datasets"));return}if(!u){F.classed("hide",!0),k.classed("hide",!1).text(t.t("rapid_feature_toggle.esri.fetching_datasets")),k.append("br"),k.append("img").attr("class","rapid-view-manage-datasets-spinner").attr("src",t.asset("img/loader-black.gif")),U.startAsync().then(()=>U.loadDatasetsAsync()).then(le=>{let te=new Set;Object.values(le).forEach(oe=>{oe.groupCategories.forEach(ie=>{te.add(ie.toLowerCase().replace("/categories/",""))})}),B||te.delete("preview");let ee=Array.from(te).sort().map(oe=>{let ie={title:oe,value:oe};return oe==="preview"&&(ie.display=`${oe} <span class="rapid-view-manage-dataset-beta beta"></span>`),ie});return s.data(ee),u=Object.values(le).filter(oe=>B||!oe.groupCategories.some(ie=>ie.toLowerCase()==="/categories/preview")),u}).then(()=>o.call(g));return}F.classed("hide",!1),k.classed("hide",!0);let $=0;u.forEach(le=>{let te=(le.title||"").toLowerCase(),ee=(le.snippet||"").toLowerCase();if(b(le)){le.filtered=!1,++$;return}if(a&&te.indexOf(a)===-1&&ee.indexOf(a)===-1){le.filtered=!0;return}if(l&&!le.groupCategories.some(oe=>oe.toLowerCase()===`/categories/${l}`)){le.filtered=!0;return}le.filtered=++$>n});let q=F.selectAll(".rapid-view-manage-dataset").data(u,le=>le.id);q.exit().remove();let W=q.enter().append("div").attr("class","rapid-view-manage-dataset"),Z=W.append("div").attr("class","rapid-view-manage-dataset-label");Z.append("div").attr("class","rapid-view-manage-dataset-name"),Z.append("div").attr("class","rapid-view-manage-dataset-license").append("a").attr("class","rapid-view-manage-dataset-link").attr("target","_blank").attr("href",le=>le.itemURL).text(t.t("rapid_feature_toggle.esri.more_info")).call(Ye("#rapid-icon-out-link","inline"));let Q=Z.selectAll(".rapid-view-manage-dataset-featured").data(le=>le.groupCategories.filter(te=>te.toLowerCase()==="/categories/featured")).enter().append("div").attr("class","rapid-view-manage-dataset-featured");Q.append("span").text("\u2B50"),Q.append("span").text(t.t("rapid_feature_toggle.esri.featured")),Z.selectAll(".rapid-view-manage-dataset-beta").data(le=>le.groupCategories.filter(te=>te.toLowerCase()==="/categories/preview")).enter().append("div").attr("class","rapid-view-manage-dataset-beta beta").attr("title",t.t("rapid_poweruser_features.beta")),Z.append("div").attr("class","rapid-view-manage-dataset-snippet"),Z.append("button").attr("class","rapid-view-manage-dataset-action").on("click",E),W.append("div").attr("class","rapid-view-manage-dataset-thumb").append("img").attr("class","rapid-view-manage-dataset-thumbnail").attr("src",le=>`https://openstreetmap.maps.arcgis.com/sharing/rest/content/items/${le.id}/info/${le.thumbnail}?w=400`),q=q.merge(W).sort(v).classed("hide",le=>le.filtered),q.selectAll(".rapid-view-manage-dataset-name").html(le=>T(a,le.title)),q.selectAll(".rapid-view-manage-dataset-snippet").html(le=>T(a,le.snippet)),q.selectAll(".rapid-view-manage-dataset-action").classed("secondary",le=>b(le)).text(le=>b(le)?t.t("rapid_feature_toggle.esri.remove"):t.t("rapid_feature_toggle.esri.add_to_map"));let ce=u.filter(le=>!le.filtered).length,de=$>n&&ce===n?">":"";o.selectAll(".rapid-view-manage-filter-results").text(t.t("rapid_feature_toggle.esri.datasets_found",{num:`${de}${ce}`}))}function v(M,k){let F=b(M),O=b(k),B=M.groupCategories.some($=>$.toLowerCase()==="/categories/featured"),U=k.groupCategories.some($=>$.toLowerCase()==="/categories/featured");return F&&!O?-1:O&&!F?1:B&&!U?-1:U&&!B?1:M.title.localeCompare(k.title)}function E(M,k){let F=i.datasets,O=F.get(k.id);if(O)O.added=!O.added;else{let $=t.services.esri;$&&$.loadLayerAsync(k.id);let q=k.groupCategories.some(ce=>ce.toLowerCase()==="/categories/preview"),W=k.groupCategories.some(ce=>ce.toLowerCase()==="/categories/buildings"),Z=i.colors,Q=F.size%Z.length,X={id:k.id,beta:q,added:!0,enabled:!0,conflated:!1,service:"esri",color:Z[Q],label:k.title,license_markdown:t.t("rapid_feature_toggle.esri.license_markdown")};if(k.extent&&(X.extent=new mt(k.extent[0],k.extent[1])),W){X.conflated=!0,X.service="mapwithai";let ce=F.get("msBuildings");ce&&(ce.enabled=!1)}F.set(k.id,X)}let B=t.systems.urlhash,U=[...i.datasets.values()].filter($=>$.added&&$.enabled).map($=>$.id).join(",");B.setParam("datasets",U.length?U:null),o.call(g),t.enter("browse"),t.systems.map.immediateRedraw()}function b(M){return i.datasets.get(M.id)?.added}function T(M,k){let F=k;if(M){let O=new RegExp("("+A(M)+")","gi");F=F.replace(O,"<mark>$1</mark>")}return F}function A(M){return M.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}return $t(m,r,"on")}function rx(t,e,i){let r=t.systems.l10n,s=t.systems.rapid,n=ye(null),o=ye(null),a,l;function u(b){return s.datasets.get(b.id)?.enabled}function d(b,T){let A=s.datasets.get(T.id);if(A){A.enabled=!A.enabled;let M=t.systems.urlhash,k=[...s.datasets.values()].filter(F=>F.added&&F.enabled).map(F=>F.id).join(",");M.setParam("datasets",k.length?k:null),t.scene().dirtyLayers("rapid"),t.enter("browse")}}function m(b,T){let A=s.datasets.get(b);if(A){A.color=T,t.scene().dirtyLayers("rapid"),t.systems.map.immediateRedraw(),o.call(v);let M=t.mode;if(M?.id==="select"){let k=new Map(M.selectedData);t.enter("select",{selection:k})}}}function g(){t.scene().toggleLayers("rapid"),o.call(v)}function _(b){b.shiftKey&&b.key===r.t("map_data.layers.ai-features.key")&&g()}return function(T){n=ws(T),n.select(".modal").attr("class","modal rapid-modal"),a=ix(t,n).on("done",()=>o.call(v)),l=Z_(t,n).on("change",m),o=n.select(".content").append("div").attr("class","rapid-stack").on("keypress",_),o.call(v),o.selectAll(".ok-button").node().focus(),i.on("ai_feature_toggle",()=>o.call(v))};function v(b){let T=t.scene().layers.get("rapid");if(!T)return;let A=b.selectAll(".rapid-toggle-all").data([0]),M=A.enter().append("div").attr("class","modal-section rapid-checkbox rapid-toggle-all"),k=M.append("div").attr("class","rapid-feature-label-container");k.append("div").attr("class","rapid-feature-label").html(r.t("rapid_feature_toggle.toggle_all",{rapidicon:pi("#rapid-logo-rapid-wordmark","logo-rapid")})),k.append("span").attr("class","rapid-feature-hotkey").html("("+e+")");let F=M.append("div").attr("class","rapid-checkbox-inputs").append("label").attr("class","rapid-checkbox-label");F.append("input").attr("type","checkbox").attr("class","rapid-feature-checkbox").on("click",g),F.append("div").attr("class","rapid-checkbox-custom"),A=A.merge(M),A.selectAll(".rapid-feature-checkbox").property("checked",T.enabled);let O=b.selectAll(".rapid-datasets-container").data([0]),B=O.enter().append("div").attr("class","rapid-datasets-container");O.merge(B).call(E);let U=b.selectAll(".rapid-manage-datasets").data([0]).enter().append("div").attr("class","modal-section rapid-checkbox rapid-manage-datasets").on("click",()=>t.container().call(a));U.append("div").attr("class","rapid-feature-label-container").append("div").attr("class","rapid-feature-label").text(r.t("rapid_feature_toggle.view_manage_datasets")),U.append("div").attr("class","rapid-checkbox-inputs").append("div").attr("class","rapid-checkbox-label").call(Ye(r.isRTL()?"#rapid-icon-backward":"#rapid-icon-forward","icon-30")),b.selectAll(".modal-section.buttons").data([0]).enter().append("div").attr("class","modal-section buttons").append("button").attr("class","button ok-button action").on("click",()=>n.remove()).text(r.t("confirm.okay"))}function E(b){let A=t.systems.storage.getItem("rapid-internal-feature.previewDatasets")==="true",M=[...s.datasets.values()].filter($=>$.added&&(A||!$.beta)),k=t.scene().layers.get("rapid");if(!k)return;let F=b.selectAll(".rapid-checkbox-dataset").data(M,$=>$.id);F.exit().remove();let O=F.enter().append("div").attr("class","modal-section rapid-checkbox rapid-checkbox-dataset");O.append("div").attr("class","rapid-feature").each(($,q,W)=>{let Z=ye(W[q]),Q=Z.append("div").attr("class","rapid-feature-label-container");Q.append("div").attr("class","rapid-feature-label").text($.label||$.id),$.beta&&Q.append("div").attr("class","rapid-feature-label-beta beta").attr("title",r.t("rapid_poweruser_features.beta")),$.description&&(Q.append("div").attr("class","rapid-feature-label-divider"),Q.append("div").attr("class","rapid-feature-description").text($.description)),$.license_markdown&&(Q.append("div").attr("class","rapid-feature-label-divider"),Q.append("div").attr("class","rapid-feature-license").html(Ki.parse($.license_markdown)),Q.select("p a").attr("target","_blank")),Z.append("div").attr("class","rapid-feature-extent-container").each((X,ce,de)=>{let le=ye(de[ce]);X.extent&&X.extent.area()<1e4?le.append("a").attr("href","#").text(r.t("rapid_feature_toggle.center_map")).on("click",te=>{te.preventDefault(),t.systems.map.extent(X.extent)}):le.text(r.t("rapid_feature_toggle.worldwide"))})});let B=O.append("div").attr("class","rapid-checkbox-inputs");B.append("label").attr("class","rapid-colorpicker-label");let U=B.append("label").attr("class","rapid-checkbox-label");U.append("input").attr("type","checkbox").attr("class","rapid-feature-checkbox").on("click",d),U.append("div").attr("class","rapid-checkbox-custom"),F=F.merge(O).classed("disabled",!k.enabled),F.selectAll(".rapid-colorpicker-label").attr("disabled",k.enabled?null:!0).call(l),F.selectAll(".rapid-checkbox-label").classed("disabled",!k.enabled),F.selectAll(".rapid-feature-checkbox").property("checked",u).attr("disabled",k.enabled?null:!0)}}function sx(t){let e=t.systems.rapid,i=t.systems.storage,r=t.systems.urlhash,s=["previewDatasets","tagnosticRoadCombine","tagSources","showAutoFix","allowLargeEdits"],n=ye(null),o=ye(null);t.systems.urlhash.on("hashchange",a);function a(g,_){let v=!0;if(g&&_&&(v=g.get("poweruser")!==_.get("poweruser")),!v)return;if(r.getParam("poweruser")==="true")for(let b of s){let T=i.getItem(`rapid-internal-feature.was.${b}`);T&&(i.setItem(`rapid-internal-feature.${b}`,T),i.removeItem(`rapid-internal-feature.was.${b}`))}else for(let b of s){let T=i.getItem(`rapid-internal-feature.${b}`);T&&(i.setItem(`rapid-internal-feature.was.${b}`,T),i.removeItem(`rapid-internal-feature.${b}`))}}function l(g){return i.getItem(`rapid-internal-feature.${g}`)==="true"}function u(g,_){let v=i.getItem(`rapid-internal-feature.${_}`)==="true";if(v=!v,i.setItem(`rapid-internal-feature.${_}`,v),_==="previewDatasets"&&!v){for(let E of e.datasets.values())E.beta&&(E.added=!1,E.enabled=!1);t.enter("browse"),t.systems.map.immediateRedraw()}}return g=>{a(),n=ws(g),n.select(".modal").attr("class","modal rapid-modal"),o=n.select(".content").append("div").attr("class","rapid-stack poweruser"),o.call(d),o.selectAll(".ok-button").node().focus()};function d(g){let _=g.selectAll(".modal-section-heading").data([0]).enter().append("div").attr("class","modal-section-heading");_.append("h3").attr("class","modal-heading").html(t.t("rapid_poweruser_features.heading.label")),_.append("div").attr("class","modal-heading-desc").text(t.t("rapid_poweruser_features.heading.description")).append("span").attr("class","smile").text("\u{1F60E}");let v=g.selectAll(".rapid-features-container").data([0]),E=v.enter().append("div").attr("class","rapid-features-container");v.merge(E).call(m),g.selectAll(".modal-section.buttons").data([0]).enter().append("div").attr("class","modal-section buttons").append("button").attr("class","button ok-button action").on("click",()=>n.remove()).text(t.t("confirm.okay"))}function m(g){let _=g.selectAll(".rapid-checkbox-feature").data(s,T=>T),v=_.enter().append("div").attr("class","modal-section rapid-checkbox rapid-checkbox-feature");v.append("div").attr("class","rapid-feature").each((T,A,M)=>{let k=ye(M[A]);k.append("div").attr("class","rapid-feature-label").text(F=>t.t(`rapid_poweruser_features.${F}.label`)),k.append("div").attr("class","rapid-feature-description").text(F=>t.t(`rapid_poweruser_features.${F}.description`))});let b=v.append("div").attr("class","rapid-checkbox-inputs").append("label").attr("class","rapid-checkbox-label");b.append("input").attr("type","checkbox").attr("class","rapid-feature-checkbox").on("click",u),b.append("div").attr("class","rapid-checkbox-custom"),_=_.merge(v),_.selectAll(".rapid-feature-checkbox").property("checked",l)}}function nx(t){return function(e){e.append("a").attr("href","https://mapwith.ai/doc/license/MapWithAILicense.pdf").attr("target","_blank").text(t.t("rapid_feature_license"))}}function ox(t){let i=!1;return function(s){let n=t.systems.storage;if((parseInt(n.getItem("sawWhatsNewVersion"),10)||0)===20230823)return;let a=ws(s);a.select(".modal").attr("class","modal rapid-modal modal-splash modal-whatsnew");let l=a.select(".content");l.append("div").attr("class","modal-section").append("h2").html(t.t("rapid_whats_new.welcome",{rapidicon:pi("#rapid-logo-rapid-wordmark","pre-text rapid")}));let u=l.append("div").attr("class","modal-section body").html(Ki.parse(t.t("rapid_whats_new.text",{rapidicon:pi("#rapid-logo-rapid-wordmark","pre-text rapid"),bugicon:pi("#rapid-icon-bug","bugnub")})));u.append("div").attr("class","whatsnew-images").append("img").attr("class","whatsnew-image").attr("src",t.asset("img/rapid-v21-splash.jpg")),u.selectAll("p a").attr("target","_blank");let g=l.append("div").attr("class","modal-section rapid-checkbox dontshow").attr("id","dontshowagain").append("label").attr("class","rapid-checkbox-label dontshow");g.append("span").attr("class","rapid-checkbox-text").text(t.t("rapid_whats_new.dontshowagain")),g.append("input").attr("type","checkbox").attr("class","rapid-feature-checkbox").property("checked",i).on("click",E=>{i=E.target.checked}),g.append("div").attr("class","rapid-checkbox-custom"),l.append("div").attr("class","modal-actions").append("button").attr("class","whats-new-okay").append("div").text(t.t("rapid_whats_new.ok")).on("click",()=>{i&&n.setItem("sawWhatsNewVersion",20230823),a.close()})}}function ax(t){return function(e){if(!t.systems.edits.hasRestorableChanges())return;let i=ws(e,!0);i.select(".modal").attr("class","modal fillL");let r=i.select(".content");r.append("div").attr("class","modal-section").append("h3").text(t.t("restore.heading")),r.append("div").attr("class","modal-section").append("p").text(t.t("restore.description"));let s=r.append("div").attr("class","modal-actions"),n=s.append("button").attr("class","restore").on("click",()=>{t.systems.edits.restore(),i.remove()});n.append("svg").attr("class","logo logo-restore").append("use").attr("xlink:href","#rapid-logo-restore"),n.append("div").text(t.t("restore.restore"));let o=s.append("button").attr("class","reset").on("click",()=>{t.systems.edits.clearSaved(),i.remove()});o.append("svg").attr("class","logo logo-reset").append("use").attr("xlink:href","#rapid-logo-reset"),o.append("div").text(t.t("restore.reset")),n.node().focus()}}function lx(t){let e=t.projection,i=180,r=8,s=t.systems.l10n,n=!s.usesMetric();function o(l,u){let d=(u[1]+l[1])/2,m=n?3.28084:1,g=Y3(u[0]-l[0],d)*m,_={dist:0,px:0,text:""},v;n?v=[528e4,528e3,52800,5280,500,50,5,1]:v=[5e6,5e5,5e4,5e3,500,50,5,1];for(let b=0;b<v.length;b++){let T=v[b];if(g>=T){_.dist=Math.floor(g/T)*T;break}else _.dist=+g.toFixed(2)}let E=Cn(_.dist/m,d);return _.px=Math.round(e.project([l[0]+E,l[1]])[0]),_.text=s.displayLength(_.dist/m,n),_}function a(l){let u=t.systems.map.dimensions,d=e.invert([0,u[1]]),m=e.invert([i,u[1]]),g=o(d,m),_=s.isRTL();l.select(".scale-path").attr("d","M0.5,0.5v"+r+"h"+g.px+"v-"+r),l.select(".scale-text").style(_?"right":"left",g.px+16+"px").html(g.text)}return function(l){function u(){n=!n,l.call(a)}l.append("svg").attr("class","scale").on("click",u).append("g").attr("transform","translate(10,11)").append("path").attr("class","scale-path"),l.append("div").attr("class","scale-text"),t.systems.map.on("draw",()=>{window.requestIdleCallback(()=>a(l))})}}function cx(t){var e=Os(),i=0,r,s=ye(null),n;function o(l){l.select(".modal").classed("modal-shortcuts",!0);var u=l.select(".content");u.append("div").attr("class","modal-section").append("h3").html(t.tHtml("shortcuts.title")),t.systems.data.getDataAsync("shortcuts").then(m=>{n=m,u.call(a)}).catch(m=>console.error(m))}function a(l){if(n){var u=l.selectAll(".wrapper").data([0]),d=u.enter().append("div").attr("class","wrapper modal-section"),m=d.append("div").attr("class","tabs-bar"),g=d.append("div").attr("class","shortcuts-list");u=u.merge(d);var _=m.selectAll(".tab").data(n),v=_.enter().append("a").attr("class","tab").attr("href","#").on("click",function(B,U){B.preventDefault();var $=n.indexOf(U);i=$,a(l)});v.append("span").html(function(B){return t.tHtml(B.text)}),u.selectAll(".tab").classed("active",function(B,U){return U===i});var E=g.selectAll(".shortcut-tab").data(n),b=E.enter().append("div").attr("class",function(B){return"shortcut-tab shortcut-tab-"+B.tab}),T=b.selectAll(".shortcut-column").data(function(B){return B.columns}).enter().append("table").attr("class","shortcut-column"),A=T.selectAll(".shortcut-row").data(function(B){return B.rows}).enter().append("tr").attr("class","shortcut-row"),M=A.filter(function(B){return!B.shortcuts});M.append("td"),M.append("td").attr("class","shortcut-section").append("h3").html(function(B){return t.tHtml(B.text)});var k=A.filter(function(B){return B.shortcuts}),F=k.append("td").attr("class","shortcut-keys"),O=F.filter(function(B){return B.modifiers});O.selectAll("kbd.modifier").data(function(B){return e.os==="win"&&B.text==="shortcuts.editing.commands.redo"?["\u2318"]:e.os!=="mac"&&B.text==="shortcuts.browsing.display_options.fullscreen"?[]:B.modifiers}).enter().each(function(){var B=ye(this);B.append("kbd").attr("class","modifier").html(function(U){return Ri.display(t,U)}),B.append("span").html("+")}),F.selectAll("kbd.shortcut").data(function(B){var U=B.shortcuts;return e.os==="win"&&B.text==="shortcuts.editing.commands.redo"?U=["Y"]:e.os!=="mac"&&B.text==="shortcuts.browsing.display_options.fullscreen"&&(U=["F11"]),U=U.map($=>Ri.display(t,$.indexOf(".")!==-1?t.t($):$)),Ei(U).map(function($){return{shortcut:$,separator:B.separator,suffix:B.suffix,rapid:B.rapid}})}).enter().each(function(B,U,$){var q=ye(this),W=B.shortcut.toLowerCase().match(/(.*).click/);W&&W[1]?q.call(Ye("#rapid-walkthrough-mouse-"+W[1],"operation")):B.shortcut.toLowerCase()==="long-press"?q.call(Ye("#rapid-walkthrough-longpress","longpress operation")):B.shortcut.toLowerCase()==="tap"?q.call(Ye("#rapid-walkthrough-tap","tap operation")):q.append("kbd").attr("class","shortcut").html(function(Z){return Z.shortcut}),U<$.length-1?q.append("span").html(B.separator||"\xA0"+t.tHtml("shortcuts.or")+"\xA0"):U===$.length-1&&B.suffix&&q.append("span").html(B.suffix),B.rapid&&q.append("svg").lower().attr("class","icon logo-rapid").append("use").attr("xlink:href","#rapid-logo-rapid").attr("class","#rapid-logo-rapid")}),F.filter(function(B){return B.gesture}).each(function(){var B=ye(this);B.append("span").html("+"),B.append("span").attr("class","gesture").html(function(U){return t.tHtml(U.gesture)})}),k.append("td").attr("class","shortcut-desc").html(function(B){return B.text?t.tHtml(B.text):"\xA0"}),u.selectAll(".shortcut-tab").style("display",function(B,U){return U===i?"flex":"none"})}}return function(l,u){s=l,u?(r=ws(l),r.call(o)):t.keybinding().on([t.t("shortcuts.toggle.key"),"?"],function(){t.container().selectAll(".modal-shortcuts").size()?r&&(r.close(),r=null):(r=ws(s),r.call(o))})}}function ux(t){var e=B_(t),i=K4(t),r=H4(t),s=Z4(t),n=W4(t),o=Y4(t),a=Q4(t),l,u=!1,d=!1,m=!1,g=!1;function _(v){var E=t.container(),b=240,T,A,M;v.style("min-width",b+"px").style("max-width","400px").style("width","33.3333%");var k=v.append("div").attr("class","sidebar-resizer").on("pointerdown.sidebar-resizer",U),F,O,B;function U(ce){if(!F&&!("button"in ce&&ce.button!==0)){F=ce.pointerId||"mouse",O=ce.clientX,B=om(E.node()),M=om(k.node())(ce)[0]-1,T=v.node().getBoundingClientRect().width,A=E.node().getBoundingClientRect().width;var de=T/A*100;v.style("width",de+"%").style("max-width","85%"),k.classed("dragging",!0),ye(window).on("touchmove.sidebar-resizer",function(le){le.preventDefault()},{passive:!1}).on("pointermove.sidebar-resizer",$).on("pointerup.sidebar-resizer pointercancel.sidebar-resizer",q)}}function $(ce){if(F===(ce.pointerId||"mouse")){ce.preventDefault();var de=ce.clientX-O;O=ce.clientX;var le=t.systems.l10n.isRTL(),te=le?0:1,ee=le?"margin-right":"margin-left",oe=B(ce)[0]-M;T=le?A-oe:oe;var ie=v.classed("collapsed"),ne=T<b;if(v.classed("collapsed",ne),ne)ie||(v.style(ee,"-400px").style("width","400px"),t.systems.ui.resize([(T-de)*te,0]));else{var me=T/A*100;v.style(ee,null).style("width",me+"%"),ie?t.systems.ui.resize([-T*te,0]):t.systems.ui.resize([-de*te,0])}}}function q(ce){F===(ce.pointerId||"mouse")&&(F=null,k.classed("dragging",!1),ye(window).on("touchmove.sidebar-resizer",null).on("pointermove.sidebar-resizer",null).on("pointerup.sidebar-resizer pointercancel.sidebar-resizer",null))}var W=v.append("div").attr("class","feature-list-pane").call(I_(t)),Z=v.append("div").attr("class","inspector-hidden inspector-wrap"),Q=function(ce){if(t.container().selectAll(".feature-list-item button").classed("hover",!1),t.selectedIDs().length>1&&ce&&ce.length){var de=t.container().selectAll(".feature-list-item button").filter(function(le){return ce.indexOf(le)!==-1});de.empty()||de.classed("hover",!0)}};_.hoverModeSelect=rl(Q,200);function X(ce){var de=ce&&ce.length&&ce[0];if(de&&de.__featurehash__)d=!0,_.show(r.datum(de)),v.selectAll(".sidebar-component").classed("inspector-hover",!0);else if(de&&de.__fbid__)u=!0,_.show(i.datum(de)),v.selectAll(".sidebar-component").classed("inspector-hover",!0).classed("rapid-inspector-fadein",!0);else if(de instanceof Fr){if(t.mode?.id==="drag-note")return;m=!0;var le=t.services.osm;le&&(de=le.getNote(de.id)),_.show(s.note(de)),v.selectAll(".sidebar-component").classed("inspector-hover",!0)}else if(de instanceof vr){g=!0;var te=t.services[de.service];te&&(de=te.getError(de.id));var ee;de.service==="keepRight"?ee=o:de.service==="osmose"?ee=a:ee=n,t.container().selectAll(".qaItem."+de.service).classed("hover",function(oe){return oe.id===de.id}),_.show(ee.error(de)),v.selectAll(".sidebar-component").classed("inspector-hover",!0)}else!l&&de instanceof Dt&&t.hasEntity(de)?(W.classed("inspector-hidden",!0),Z.classed("inspector-hidden",!1).classed("inspector-hover",!0),(!e.entityIDs()||!Gn(e.entityIDs(),[de.id])||e.state()!=="hover")&&(e.state("hover").entityIDs([de.id]).newFeature(!1),Z.call(e))):l?(u||d||m||g)&&(u=!1,m=!1,d=!1,g=!1,t.container().selectAll(".layer-ai-features .hover").classed("hover",!1),t.container().selectAll(".note").classed("hover",!1),t.container().selectAll(".qaItem").classed("hover",!1),_.hide()):(W.classed("inspector-hidden",!1),Z.classed("inspector-hidden",!0),e.state("hide"))}_.hover=rl(X,200),_.intersects=function(ce){var de=v.node().getBoundingClientRect();return ce.intersects(new mt(t.projection.invert([0,de.height]),t.projection.invert([de.width,0])))},_.select=function(ce,de){if(_.hide(),ce&&ce.length){var le=ce.length===1&&t.entity(ce[0]);if(le&&de&&v.classed("collapsed")){var te=le.extent(t.graph());_.expand(_.intersects(te))}W.classed("inspector-hidden",!0),Z.classed("inspector-hidden",!1).classed("inspector-hover",!1),e.state("select").entityIDs(ce).newFeature(de),Z.call(e)}else e.state("hide")},_.showPresetList=function(){e.showList()},_.show=function(ce,de){W.classed("inspector-hidden",!0),Z.classed("inspector-hidden",!0),l&&l.remove(),l=v.append("div").attr("class","sidebar-component").call(ce,de)},_.hide=function(){W.classed("inspector-hidden",!1),Z.classed("inspector-hidden",!0),l&&l.remove(),l=null},_.expand=function(ce){v.classed("collapsed")&&_.toggle(ce)},_.collapse=function(ce){v.classed("collapsed")||_.toggle(ce)},_.toggle=function(ce){if(!t.inIntro){var de=v.classed("collapsed"),le=!de,te=t.systems.l10n.isRTL(),ee=te?0:1,oe=te?"margin-right":"margin-left";T=v.node().getBoundingClientRect().width,v.style("width",T+"px");var ie,ne,me;le?(ie=me=0,ne=-T):(ie=me=-T,ne=0),le||v.classed("collapsed",le),v.transition().style(oe,ne+"px").tween("panner",function(){var De=Qs(ie,ne);return function(He){var Je=me-Math.round(De(He));me=me-Je,t.systems.ui.resize(ce?void 0:[Je*ee,0])}}).on("end",function(){le&&v.classed("collapsed",le);let De=t.pixi.view.parentNode;if(t.pixi.resize(De.clientWidth,De.clientHeight),!le){var He=E.node().getBoundingClientRect().width,Je=T/He*100;v.style(oe,null).style("width",Je+"%")}})}},k.on("dblclick",function(ce){ce.preventDefault(),ce.sourceEvent&&ce.sourceEvent.preventDefault(),_.toggle()})}return _.showPresetList=function(){},_.hover=function(){},_.hover.cancel=function(){},_.intersects=function(){},_.select=function(){},_.show=function(){},_.hide=function(){},_.expand=function(){},_.collapse=function(){},_.toggle=function(){},_}function hx(t){let e;function i(s){s.preventDefault();let n=t.services.osm;if(!n||t.inIntro||t.mode?.id==="save"||t.systems.edits.hasChanges()&&!window.confirm(t.t("source_switch.lose_changes")))return;let o=ye(this).classed("live");o=!o,t.enter("browse"),t.systems.edits.clearSaved(),t.resetAsync().then(()=>(ye(this).html(o?t.tHtml("source_switch.live"):t.tHtml("source_switch.dev")).classed("live",o).classed("chip",o),n.switchAsync(o?e[0]:e[1])))}let r=function(s){s.append("a").attr("href","#").html(t.tHtml("source_switch.live")).attr("class","live chip").on("click",i)};return r.keys=function(s){return arguments.length?(e=s,r):e},r}function dx(t){var e=t.services.osm;return function(i){var r=i.append("img").attr("src",t.asset("img/loader-black.gif")).style("opacity",0);e&&e.on("loading.spinner",function(){r.transition().style("opacity",1)}).on("loaded.spinner",function(){r.transition().style("opacity",0)})}}function SO(t){return e=>{let i=t.systems.storage;if(t.systems.edits.hasRestorableChanges())return;let r="",s=i("sawPrivacyVersion"),n=!i("sawSplash");if(s!==t.privacyVersion&&(r=t.t("splash.privacy_update"),n=!0),!n)return;i.setItem("sawSplash",!0),i.setItem("sawPrivacyVersion",t.privacyVersion),t.systems.data.getDataAsync("intro_graph");let a=ws(e);a.select(".modal").attr("class","modal-splash modal");let l=a.select(".content").append("div").attr("class","fillL");l.append("div").attr("class","modal-section").append("h3").text(t.t("splash.welcome"));let u=l.append("div").attr("class","modal-section");u.append("p").html(t.tHtml("splash.text",{version:t.version,website:'<a target="_blank" href="https://github.com/openstreetmap/iD/blob/develop/CHANGELOG.md#whats-new">changelog</a>',github:'<a target="_blank" href="https://github.com/openstreetmap/iD/issues">github.com</a>'})),u.append("p").html(t.tHtml("splash.privacy",{updateMessage:r,privacyLink:'<a target="_blank" href="https://github.com/openstreetmap/iD/blob/release/PRIVACY.md">'+t.t("splash.privacy_policy")+"</a>"}));let d=l.append("div").attr("class","modal-actions"),m=d.append("button").attr("class","walkthrough").on("click",()=>{t.container().call(dc(t)),a.close()});m.append("svg").attr("class","logo logo-walkthrough").append("use").attr("xlink:href","#rapid-logo-walkthrough"),m.append("div").html(t.tHtml("splash.walkthrough"));let g=d.append("button").attr("class","start-editing").on("click",a.close);g.append("svg").attr("class","logo logo-features").append("use").attr("xlink:href","#rapid-logo-features"),g.append("div").html(t.tHtml("splash.start")),a.select("button.close").attr("class","hide")}}function fx(t){let e=t.services.osm;return function(i){if(!e)return;function r(s,n){if(i.html(""),s){if(n==="connectionSwitched")return;if(n==="rateLimited")i.html(t.tHtml("osm_api_status.message.rateLimit")).append("a").attr("href","#").attr("class","api-status-login").attr("target","_blank").call(Ye("#rapid-icon-out-link","inline")).append("span").html(t.tHtml("login")).on("click.login",o=>{o.preventDefault(),e.authenticate()});else{let o=rl(()=>{t.loadTiles(t.projection),e.reloadApiStatus()},2e3);i.html(t.tHtml("osm_api_status.message.error")+" ").append("a").attr("href","#").html(t.tHtml("osm_api_status.retry")).on("click.retry",a=>{a.preventDefault(),o()})}}else n==="readonly"?i.html(t.tHtml("osm_api_status.message.readonly")):n==="offline"&&i.html(t.tHtml("osm_api_status.message.offline"));i.attr("class","api-status "+(s?"error":n))}e.on("apiStatusChange.uiStatus",r),t.systems.edits.on("storage_error",()=>{i.html(t.tHtml("osm_api_status.message.local_storage_full")),i.attr("class","api-status error")}),window.setInterval(()=>{e.reloadApiStatus()},9e4),e.reloadApiStatus()}}var AO=Xi(_9(),1);function kS(t){return typeof t!="string"?"":AO.default.remove(t.replace(/&/g,"and").replace(/(|i)/ig,"i").replace(/[\s\-=_!"#%'*{},.\/:;?\(\)\[\]@\\$\^*+<>~`\u00a1\u00a7\u00b6\u00b7\u00bf\u037e\u0387\u055a-\u055f\u0589\u05c0\u05c3\u05c6\u05f3\u05f4\u0609\u060a\u060c\u060d\u061b\u061e\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0830-\u083e\u085e\u0964\u0965\u0970\u0af0\u0df4\u0e4f\u0e5a\u0e5b\u0f04-\u0f12\u0f14\u0f85\u0fd0-\u0fd4\u0fd9\u0fda\u104a-\u104f\u10fb\u1360-\u1368\u166d\u166e\u16eb-\u16ed\u1735\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u1805\u1807-\u180a\u1944\u1945\u1a1e\u1a1f\u1aa0-\u1aa6\u1aa8-\u1aad\u1b5a-\u1b60\u1bfc-\u1bff\u1c3b-\u1c3f\u1c7e\u1c7f\u1cc0-\u1cc7\u1cd3\u2000-\u206f\u2cf9-\u2cfc\u2cfe\u2cff\u2d70\u2e00-\u2e7f\u3001-\u3003\u303d\u30fb\ua4fe\ua4ff\ua60d-\ua60f\ua673\ua67e\ua6f2-\ua6f7\ua874-\ua877\ua8ce\ua8cf\ua8f8-\ua8fa\ua92e\ua92f\ua95f\ua9c1-\ua9cd\ua9de\ua9df\uaa5c-\uaa5f\uaade\uaadf\uaaf0\uaaf1\uabeb\ufe10-\ufe16\ufe19\ufe30\ufe45\ufe46\ufe49-\ufe4c\ufe50-\ufe52\ufe54-\ufe57\ufe5f-\ufe61\ufe68\ufe6a\ufe6b\ufeff\uff01-\uff03\uff05-\uff07\uff0a\uff0c\uff0e\uff0f\uff1a\uff1b\uff1f\uff20\uff3c\uff61\uff64\uff65]+/g,"").toLowerCase())}function MS(t,e,i){let r=Object.assign({},t.strings),s=Object.assign({},e[t.type]),n=new RegExp(/(\{\w+\})/,"gi");if(i){if(r.community){let d=kS(r.community);r.community=i(`_communities.${d}`)}["name","description","extendedDescription"].forEach(d=>{s[d]&&(s[d]=i(`_defaults.${t.type}.${d}`)),r[d]&&(r[d]=i(`${t.id}.${d}`))})}let o={account:t.account,community:r.community,signupUrl:r.signupUrl,url:r.url};o.signupUrl||(o.signupUrl=l(r.signupUrl||s.signupUrl)),o.url||(o.url=l(r.url||s.url));let a={name:l(r.name||s.name),url:l(r.url||s.url),signupUrl:l(r.signupUrl||s.signupUrl),description:l(r.description||s.description),extendedDescription:l(r.extendedDescription||s.extendedDescription)};return a.nameHTML=u(a.url,a.name),a.urlHTML=u(a.url),a.signupUrlHTML=u(a.signupUrl),a.descriptionHTML=l(r.description||s.description,!0),a.extendedDescriptionHTML=l(r.extendedDescription||s.extendedDescription,!0),a;function l(d,m){if(!d)return;let g=d;for(let v in o){let E=`{${v}}`,b=new RegExp(E,"g");if(b.test(g)){let T=o[v];if(T)m&&(v==="signupUrl"||v==="url")&&(T=u(T)),g=g.replace(b,T);else throw new Error(`Cannot resolve token: ${E}`)}}let _=g.match(n);if(_)throw new Error(`Cannot resolve tokens: ${_}`);return m&&t.type==="reddit"&&(g=g.replace(/(\/r\/\w+\/*)/i,v=>u(a.url,v))),g}function u(d,m){if(d)return m=m||d,`<a target="_blank" href="${d}">${m}</a>`}}var ip=null;function px(t){let i=Mt("cancel"),r,s;n();function n(){let d=t.systems.data;return Promise.all([d.getDataAsync("oci_features"),d.getDataAsync("oci_resources"),d.getDataAsync("oci_defaults")]).then(m=>{if(ip)return ip;let g=t.systems.locations;m[0]&&Array.isArray(m[0].features)&&g.mergeCustomGeoJSON(m[0]);let _=Object.values(m[1].resources);return _.length?g.mergeLocationSets(_).then(()=>(ip={resources:_,defaults:m[2].defaults},ip)):(ip={resources:[],defaults:m[2].defaults},ip)})}function o(d){if(!d)return;let m=d.trim();if(!m)return;/Z$/.test(m)||(m+="Z");let g=new Date(m);return new Date(g.toUTCString().slice(0,25))}function a(d){let m=d.append("div").attr("class","header fillL");m.append("h3").html(t.tHtml("success.just_edited")),m.append("button").attr("class","close").on("click",()=>i.call("cancel")).call(Ye("#rapid-icon-close"));let g=d.append("div").attr("class","body save-success fillL"),_=g.append("div").attr("class","save-summary");_.append("h3").html(t.tHtml("success.thank_you"+(s?"_location":""),{where:s})),_.append("p").html(t.tHtml("success.help_html")).append("a").attr("class","link-out").attr("target","_blank").attr("href",t.t("success.help_link_url")).call(Ye("#rapid-icon-out-link","inline")).append("span").html(t.tHtml("success.help_link_text"));let v=t.services.osm;if(!v)return;let E=v.changesetURL(r.id),T=_.append("table").attr("class","summary-table").append("tr").attr("class","summary-row");T.append("td").attr("class","cell-icon summary-icon").append("a").attr("target","_blank").attr("href",E).append("svg").attr("class","logo-small").append("use").attr("xlink:href","#rapid-logo-osm");let A=T.append("td").attr("class","cell-detail summary-detail");A.append("a").attr("class","cell-detail summary-view-on-osm").attr("target","_blank").attr("href",E).html(t.tHtml("success.view_on_osm")),A.append("div").html(t.tHtml("success.changeset_id",{changeset_id:`<a href="${E}" target="_blank">${r.id}</a>`})),n().then(M=>{let k=t.systems.map.center(),O=t.systems.locations.locationSetsAt(k),B=[];M.resources.forEach(U=>{let $=O[U.locationSetID];if(!$)return;let q=W=>t.tHtml(`community.${W}`);U.resolved=MS(U,M.defaults,q),B.push({area:$,order:U.order||0,resource:U})}),B.sort((U,$)=>U.area-$.area||$.order-U.order),g.call(l,B.map(U=>U.resource))})}function l(d,m){let g=d.append("div").attr("class","save-communityLinks");g.append("h3").html(t.tHtml("success.like_osm"));let E=g.append("table").attr("class","community-table").selectAll(".community-row").data(m).enter().append("tr").attr("class","community-row");E.append("td").attr("class","cell-icon community-icon").append("a").attr("target","_blank").attr("href",T=>T.resolved.url).append("svg").attr("class","logo-small").append("use").attr("xlink:href",T=>`#community-${T.type}`),E.append("td").attr("class","cell-detail community-detail").each(u),g.append("div").attr("class","community-missing").html(t.tHtml("success.missing")).append("a").attr("class","link-out").attr("target","_blank").call(Ye("#rapid-icon-out-link","inline")).attr("href","https://github.com/osmlab/osm-community-index/issues").append("span").html(t.tHtml("success.tell_us"))}function u(d){let m=ye(this),g=d.id;m.append("div").attr("class","community-name").html(d.resolved.nameHTML),m.append("div").attr("class","community-description").html(d.resolved.descriptionHTML),(d.resolved.extendedDescriptionHTML||d.languageCodes&&d.languageCodes.length)&&m.append("div").call(c0(t,`community-more-${d.id}`).expanded(!1).checkPreference(!1).label(t.tHtml("success.more")).content(v));let _=(d.events||[]).map(b=>(b.date=o(b.when),b)).filter(b=>{let T=b.date.getTime(),A=new Date().setHours(0,0,0,0);return!isNaN(T)&&T>=A}).sort((b,T)=>b.date<T.date?-1:b.date>T.date?1:0).slice(0,2);_.length&&m.append("div").call(c0(t,`community-events-${d.id}`).expanded(!1).checkPreference(!1).label(t.tHtml("success.events")).content(E)).select(".hide-toggle").append("span").attr("class","badge-text").html(_.length);function v(b){let A=b.selectAll(".community-more").data([0]).enter().append("div").attr("class","community-more");if(d.resolved.extendedDescriptionHTML&&A.append("div").attr("class","community-extended-description").html(d.resolved.extendedDescriptionHTML),d.languageCodes&&d.languageCodes.length){let M=d.languageCodes.map(k=>t.systems.l10n.languageName(k)).join(", ");A.append("div").attr("class","community-languages").html(t.tHtml("success.languages",{languages:M}))}}function E(b){let M=b.append("div").attr("class","community-events").selectAll(".community-event").data(_).enter().append("div").attr("class","community-event");M.append("div").attr("class","community-event-name").append("a").attr("target","_blank").attr("href",k=>k.url).html(k=>{let F=k.name;return k.i18n&&k.id&&(F=t.t(`community.${g}.events.${k.id}.name`,{default:F})),F}),M.append("div").attr("class","community-event-when").html(k=>{let F={weekday:"short",day:"numeric",month:"short",year:"numeric"};(k.date.getHours()||k.date.getMinutes())&&(F.hour="numeric",F.minute="numeric");let O=t.systems.l10n.localeCode();return k.date.toLocaleString(O,F)}),M.append("div").attr("class","community-event-where").html(k=>{let F=k.where;return k.i18n&&k.id&&(F=t.t(`community.${g}.events.${k.id}.where`,{default:F})),F}),M.append("div").attr("class","community-event-description").html(k=>{let F=k.description;return k.i18n&&k.id&&(F=t.t(`community.${g}.events.${k.id}.description`,{default:F})),F})}}return a.changeset=function(d){return arguments.length?(r=d,a):r},a.location=function(d){return arguments.length?(s=d,a):s},$t(a,i,"on")}function CO(t){let e={id:"download_osc",label:t.t("download_osc.title")},i=null,r=null,s=0;function n(){return s===0}function o(d){d.preventDefault();let m=t.systems.edits;if(!t.inIntro&&m.hasChanges()){let g=m.changes(Vu(m.difference())),_=new Jo,v=Kc.stringify(_.osmChangeJXON(g));u(v,"change.osc")}}function a(){if(!r)return;let d=t.systems.edits.difference().summary().size;d!==s&&(s=d,r&&r.title(t.t(s>0?"download_osc.help":"download_osc.no_changes")),l())}function l(){i&&i.classed("disabled",n())}function u(d,m){let g=document.createElement("a");g.style.display="none",document.body.appendChild(g),g.href=window.URL.createObjectURL(new Blob([d])),g.setAttribute("download",m),g.click(),window.URL.revokeObjectURL(g.href),document.body.removeChild(g)}return e.install=function(d){i&&r||(r=Ft(t).placement("bottom").title(t.t("download_osc.no_changes")),i=d.append("button").attr("class","downloadOsc disabled bar-button").on("click",o).call(r),i.call(Ye("#rapid-icon-download-osc")),a(),t.systems.edits.on("change",a),t.on("modechange",l))},e.uninstall=function(){!i&&!r||(t.systems.edits.off("change",a),t.off("modechange",l),i=null,r=null)},e}function IO(t){let e=t.systems.presets,i,r,s={id:"draw_modes",label:t.tHtml("toolbar.add_feature")},n=[{id:"add-point",title:t.tHtml("modes.add_point.title"),button:"point",description:t.tHtml("modes.add_point.description"),preset:e.item("point"),key:"1"},{id:"draw-line",title:t.tHtml("modes.add_line.title"),button:"line",description:t.tHtml("modes.add_line.description"),preset:e.item("line"),key:"2"},{id:"draw-area",title:t.tHtml("modes.add_area.title"),button:"area",description:t.tHtml("modes.add_area.description"),preset:e.item("area"),key:"3"}];function o(){if(!r)return;let a=r.selectAll("button.add-button").data(n,u=>u.id);a.exit().remove();let l=a.enter().append("button").attr("class",u=>`${u.id} add-button bar-button`).on("click.mode-buttons",(u,d)=>{if(!t.editable()||d.id==="add-area")return;let m=t.mode?.id;/^draw/.test(m)||(d.id===m?t.enter("browse"):t.enter(d.id))}).call(Ft(t).placement("bottom").title(u=>u.description).keys(u=>[u.key]).scrollContainer(t.container().select(".top-toolbar")));l.each((u,d,m)=>{ye(m[d]).call(Ye(`#rapid-icon-${u.button}`))}),l.append("span").attr("class","label").html(u=>u.title),(a.enter().size()||a.exit().size())&&t.systems.ui.checkOverflow(".top-toolbar",!0),a=a.merge(l).classed("disabled",()=>!t.editable()).classed("active",u=>t.mode?.id===u.id)}return s.install=function(a){r=a.append("div").attr("class","joined").style("display","flex"),i=Ur(o,500,{leading:!0,trailing:!0}),n.forEach(l=>{t.keybinding().on(l.key,()=>{t.editable()&&(l.id===t.mode?.id?t.enter("browse"):t.enter(l.id))})}),t.systems.map.on("draw",i),t.on("modechange",o),o()},s.uninstall=function(){n.forEach(a=>{t.keybinding().off(a.key)}),i.cancel(),t.systems.map.off("draw",i),t.off("modechange",o),r=null},s}function kO(t){let e={id:"notes",label:t.tHtml("modes.add_note.label")},i={id:"add-note",title:t.tHtml("modes.add_note.title"),button:"note",description:t.tHtml("modes.add_note.description"),key:t.t("modes.add_note.key")};function r(){return t.scene().layers.get("notes")?.enabled}function s(){return t.mode?.id!=="save"}let n,o;function a(){if(!o)return;let l=r()?[i]:[],u=o.selectAll("button.add-button").data(l,m=>m.id);u.exit().remove();let d=u.enter().append("button").attr("class",m=>`${m.id} add-button bar-button`).on("click.notes",(m,g)=>{if(s()){var _=t.mode?.id;/^draw/.test(_)||(g.id===_?t.enter("browse"):t.enter(g.id))}}).call(Ft(t).placement("bottom").title(m=>m.description).keys(m=>[m.key]).scrollContainer(t.container().select(".top-toolbar")));d.each((m,g,_)=>{ye(_[g]).call(Ye(m.icon||`#rapid-icon-${m.button}`))}),(u.enter().size()||u.exit().size())&&t.systems.ui.checkOverflow(".top-toolbar",!0),u=u.merge(d).classed("disabled",()=>!r()).classed("active",m=>t.mode?.id===m.id)}return e.install=function(l){o=l,n=Ur(a,500,{leading:!0,trailing:!0}),t.keybinding().on(i.key,()=>{s()&&(i.id===t.mode?.id?t.enter("browse"):t.enter(i.id))}),t.systems.map.on("draw",n),t.on("modechange",a),a()},e.uninstall=function(){n.cancel(),t.keybinding().off(i.key),t.off("modechange",a),t.systems.map.off("draw",n),o=null},e}function MO(t){let e={id:"save",label:t.tHtml("save.title")},i=Ri("\u2318S"),r=0,s=null,n=null;function o(){return t.mode?.id==="save"}function a(){return r===0||t.inIntro||o()}function l(g){g.preventDefault(),!t.inIntro&&!o()&&t.systems.edits.hasChanges()&&t.enter("save")}function u(){let g;return r===0?null:r<=50?(g=r/50,Cc("#fff","#ff8")(g)):(g=Math.min((r-50)/50,1),Cc("#ff8","#f88")(g))}function d(){if(!s||!n)return;let g=t.systems.edits.difference().summary().size;g!==r&&(r=g,n&&n.title(t.tHtml(r>0?"save.help":"save.no_changes")).keys([i]),s.classed("disabled",a()).style("background",u(r)),s.select("span.count").html(r))}function m(){!s||!n||(s.classed("disabled",a()),o()&&s.call(n.hide))}return e.install=function(g){s&&n||(n=Ft(t).placement("bottom").title(t.tHtml("save.no_changes")).keys([i]).scrollContainer(t.container().select(".top-toolbar")),s=g.append("button").attr("class","save disabled bar-button").on("click",_=>{l(_)}).call(n),s.call(Ye("#rapid-icon-save")),s.append("span").attr("class","count").attr("aria-hidden","true").html("0"),d(),t.keybinding().on(i,l,!0),t.systems.edits.on("change",d),t.systems.edits.on("reset",d),t.on("modechange",m))},e.uninstall=function(){!s&&!n||(t.keybinding().off(i,!0),t.systems.edits.off("change",d),t.systems.edits.off("reset",d),t.off("modechange",m),s=null,n=null)},e}function PO(t){let e=t.systems.l10n,i={id:"sidebar_toggle",label:e.tHtml("toolbar.inspect")};return i.install=function(r){r.append("button").attr("class","bar-button").on("click",()=>t.systems.ui.sidebar.toggle()).call(Ft(t).placement("bottom").title(e.tHtml("sidebar.tooltip")).keys([e.t("sidebar.key")]).scrollContainer(t.container().select(".top-toolbar"))).call(Ye("#rapid-icon-sidebar-"+(e.isRTL()?"right":"left")))},i}function RO(t){let e=t.systems.l10n,i=e.isRTL(),r=null,s=null,n,o={id:"undo_redo",label:e.tHtml("toolbar.undo_redo")},a=[{id:"undo",key:Ri("\u2318Z"),action:()=>t.undo(),annotation:()=>t.systems.edits.undoAnnotation(),icon:i?"redo":"undo"},{id:"redo",key:Ri("\u2318\u21E7Z"),action:()=>t.redo(),annotation:()=>t.systems.edits.redoAnnotation(),icon:i?"undo":"redo"}];function l(d){d&&u()}function u(){!r||!s||r.classed("disabled",d=>!t.editable()||!d.annotation()).each((d,m,g)=>{let _=ye(g[m]);_.select(".tooltip.in").empty()||_.call(s.updateContent)})}return o.install=function(d){if(!(r&&s)){s=Ft(t).placement("bottom").title(m=>{let g=m.annotation();return g&&g.description&&(g=g.description),g?e.t(`${m.id}.tooltip`,{action:g}):e.t(`${m.id}.nothing`)}).keys(m=>[m.key]).scrollContainer(t.container().select(".top-toolbar")),r=d.selectAll("button").data(a).enter().append("button").attr("class",m=>`disabled ${m.id}-button bar-button`).on("click",(m,g)=>{m.preventDefault();let _=g.annotation();t.editable()&&_&&g.action()}).call(s),r.each((m,g,_)=>{ye(_[g]).call(Ye(`#rapid-icon-${m.icon}`))}),n=Ur(u,500,{leading:!0,trailing:!0});for(let m of a)t.keybinding().on(m.key,g=>{g.preventDefault(),t.editable()&&m.action()});t.systems.map.on("draw",n),t.systems.edits.on("change",l),t.on("modechange",u)}},o.uninstall=function(){if(!(!r&&!s)){for(let d of a)t.keybinding().off(d.key);n.cancel(),t.systems.map.off("draw",n),t.systems.edits.off("change",l),t.off("modechange",u),s=null,r=null}},o}function DO(t){let e=t.systems.map,i=t.systems.urlhash,r=Mt("ai_feature_toggle"),s="\u21E7"+t.t("map_data.layers.ai-features.key"),n=rx(t,Ri(s),r),o=sx(t),a,l={id:"rapid_features",label:t.t("toolbar.rapid_features")};function u(){return t.scene?e.scene.layers.get("rapid")?.enabled:!1}function d(){e.scene.toggleLayers("rapid"),r.call("ai_feature_toggle")}function m(){t.container().call(n)}function g(){t.container().call(o)}function _(){if(!a)return;let v=i.getParam("poweruser")==="true";a.attr("class",v?"joined":null);let E=a.selectAll(".rapid-features").data([0]),b=E.enter().append("button").attr("class","bar-button rapid-features").attr("tabindex",-1).on("click",m).call(Ft(t).placement("bottom").title(t.t("shortcuts.browsing.display_options.rapid_features_data")).keys(s));b.append("svg").attr("class","logo-rapid").append("use").attr("xlink:href","#rapid-logo-rapid-wordmark"),E.merge(b).classed("layer-off",!u());let T=a.selectAll(".rapid-poweruser-features").data(v?[0]:[]);T.exit().remove(),T.enter().append("button").attr("class","bar-button rapid-poweruser-features").attr("tabindex",-1).on("click",g).call(Ft(t).placement("bottom").title(t.t("rapid_poweruser_features.heading.label"))).append("div").attr("class","beta")}return l.install=v=>{t.keybinding().on(Ri(s),E=>{E.preventDefault(),E.stopPropagation(),d()}),i.on("hashchange",_),e.scene.on("layerchange",_),t.on("modechange",_),a=v.append("div").style("display","flex"),_()},l.uninstall=function(){t.keybinding().off(Ri(s)),i.off("hashchange",_),e.scene.off("layerchange",_),t.off("modechange",_),a=null},l}function mx(t){let e=PO(t),i=DO(t),r=IO(t),s=kO(t),n=RO(t),o=MO(t),a=CO(t);function l(){return t.scene().layers.get("notes")?.enabled}function u(m){let g=[e,"spacer",r,i];l()&&g.push("spacer",s),g.push("spacer",n,o),t.systems.urlhash.initialHashParams.get("support_download_osc")==="true"&&g.push(a);let v=m.selectAll(".toolbar-item").data(g,T=>T.id||T);v.exit().each(T=>{T.uninstall&&T.uninstall()}).remove();let b=v.enter().append("div").attr("class",T=>{let A="toolbar-item "+(T.id||T).replace("_","-");return T.klass&&(A+=" "+T.klass),A}).filter(T=>T!=="spacer");b.append("div").attr("class","item-content").each((T,A,M)=>{ye(M[A]).call(T.install,m)}),b.append("div").attr("class","item-label").html(T=>T.label)}function d(m){t.scene().on("layerchange",()=>u(m)),u(m)}return d}var FO=null,PS=!1,RS=!1;function gx(t){let e=t.version,i=e.match(/\d+\.\d+\.\d+.*/),r=t.systems.storage;return FO===null&&i!==null&&(r.getItem("sawVersion")?(RS=!1,PS=r.getItem("sawVersion")!==e&&e.indexOf("-")===-1):(RS=!0,PS=!0),r.setItem("sawVersion",e),FO=e),function(n){n.append("a").attr("target","_blank").attr("tabindex",-1).attr("href","https://github.com/facebook/Rapid/blob/main/CHANGELOG.md").text(e),PS&&!RS&&n.append("a").attr("class","badge").attr("target","_blank").attr("tabindex",-1).attr("href","https://github.com/facebook/Rapid/blob/main/CHANGELOG.md").call(Ye("#maki-gift")).call(Ft(t).title(t.tHtml("version.whats_new",{version:e})).placement("top").scrollContainer(t.container().select(".main-footer-wrap")))}}function yx(t){let e=t.systems.l10n,i=[{id:"zoom-in",icon:"rapid-icon-plus",title:e.t("zoom.in"),action:r,isDisabled:()=>!t.systems.map.canZoomIn(),disabledTitle:e.t("zoom.disabled.in"),key:"+"},{id:"zoom-out",icon:"rapid-icon-minus",title:e.t("zoom.out"),action:s,isDisabled:()=>!t.systems.map.canZoomOut(),disabledTitle:e.t("zoom.disabled.out"),key:"-"}];function r(a){a.shiftKey||(a.preventDefault(),t.systems.map.zoomIn())}function s(a){a.shiftKey||(a.preventDefault(),t.systems.map.zoomOut())}function n(a){a.shiftKey||(a.preventDefault(),t.systems.map.zoomInFurther())}function o(a){a.shiftKey||(a.preventDefault(),t.systems.map.zoomOutFurther())}return function(l){let u=Ft(t).placement(e.isRTL()?"right":"left").title(_=>_.isDisabled()?_.disabledTitle:_.title).keys(_=>[_.key]),d,m=l.selectAll("button").data(i).enter().append("button").attr("class",_=>_.id).on("pointerup",_=>d=_.pointerType).on("click",(_,v)=>{v.isDisabled()?(d==="touch"||d==="pen")&&t.systems.ui.flash.duration(2e3).iconName(`#${v.icon}`).iconClass("disabled").label(v.disabledTitle)():v.action(_),d=null}).call(u);m.each((_,v,E)=>{ye(E[v]).call(Ye(`#${_.icon}`,"light"))}),zi.plusKeys.forEach(_=>{t.keybinding().on([_],r),t.keybinding().on([Ri("\u2325"+_)],n)}),zi.minusKeys.forEach(_=>{t.keybinding().on([_],s),t.keybinding().on([Ri("\u2325"+_)],o)});function g(){m.classed("disabled",_=>_.isDisabled()).each((_,v,E)=>{let b=ye(E[v]);b.select(".tooltip.in").empty()||b.call(u.updateContent)})}g(),t.systems.map.on("draw",g)}}function _x(t){let e=t.systems.l10n,i=e.t("inspector.zoom_to.key"),r,s;return function(o){let a=Ft(t).placement(e.isRTL()?"right":"left").title(()=>u()?e.t("inspector.zoom_to.no_selection"):e.t("inspector.zoom_to.title")).keys([i]),l=o.append("button").on("pointerup",g=>r=g.pointerType).on("click",d).call(Ye("#rapid-icon-framed-dot","light")).call(a);t.keybinding().on(i,d),t.on("modechange",m),m();function u(){return!s&&!t.mode?.extent}function d(g){g&&g.preventDefault();let _=t.mode?.extent,v=t.systems.map;if(s)v.transformEase(s),s=null;else if(_){s=v.transform();let[E,b]=v.dimensions,T=v.extentZoom(_,[E/2,b/2]);v.centerZoomEase(_.center(),T)}else(r==="touch"||r==="pen")&&t.systems.ui.flash.duration(2e3).iconName("#rapid-icon-framed-dot").iconClass("disabled").label(e.t("inspector.zoom_to.no_selection"))();r=null}function m(){s=null,l.classed("disabled",u()),l.select(".tooltip.in").empty()||l.call(a.updateContent)}}}function xx(t){let e=t.systems.l10n,i=t.systems.storage,r=t.systems.imagery,s=Ji(t,"background-display-options").label(e.tHtml("background.display_options")).disclosureContent(g),n=i.getItem("background-opacity"),o=0,a=3,l=["brightness","contrast","saturation","sharpness"],u={brightness:n!==null?+n:1,contrast:1,saturation:1,sharpness:1};function d(_,v,E){return Math.max(v,Math.min(_,E))}function m(_,v){v=d(v,o,a),u[_]=v,_==="brightness"?(i.setItem("background-opacity",v),r.brightness=v):_==="contrast"?r.contrast=v:_==="saturation"?r.saturation=v:_==="sharpness"&&(r.sharpness=v),s.reRender()}function g(_){let v=_.selectAll(".display-options-container").data([0]),E=v.enter().append("div").attr("class","display-options-container controls-list"),b=E.selectAll(".display-control").data(l).enter().append("div").attr("class",A=>`display-control display-control-${A}`);b.append("h5").html(A=>e.tHtml(`background.${A}`)).append("span").attr("class",A=>`display-option-value display-option-value-${A}`);let T=b.append("div").attr("class","control-wrap");T.append("input").attr("class",A=>`display-option-input display-option-input-${A}`).attr("type","range").attr("min",o).attr("max",a).attr("step","0.05").on("input",(A,M)=>{m(M,A.target.value||1)}),T.append("button").attr("title",e.t("background.reset")).attr("class",A=>`display-option-reset display-option-reset-${A}`).on("click",(A,M)=>{A.button===0&&m(M,1)}).call(Ye("#rapid-icon-"+(e.isRTL()?"redo":"undo"))),E.append("a").attr("class","display-option-resetlink").attr("href","#").html(e.tHtml("background.reset_all")).on("click",A=>{A.preventDefault();for(let M of l)m(M,1)}),v=E.merge(v),v.selectAll(".display-option-input").property("value",A=>u[A]),v.selectAll(".display-option-value").text(A=>Math.floor(u[A]*100)+"%"),v.selectAll(".display-option-reset").classed("disabled",A=>u[A]===1),E.size()&&u.brightness!==1&&(r.brightness=u.brightness)}return s}function vx(t){let e=t.systems.storage,i=Mt("change");function r(s){let n={template:e.getItem("background-custom-template")},o=Object.assign({},n),a=_h(t,s).okButton();a.classed("settings-modal settings-custom-background",!0),a.select(".modal-section.header").append("h3").html(t.tHtml("settings.custom_background.header"));let l="settings.custom_background.instructions",u=t.t(`${l}.info`),d=t.t(`${l}.wms.tokens_label`),m=t.t(`${l}.wms.tokens.proj`),g=t.t(`${l}.wms.tokens.wkid`),_=t.t(`${l}.wms.tokens.dimensions`),v=t.t(`${l}.wms.tokens.bbox`),E=t.t(`${l}.tms.tokens_label`),b=t.t(`${l}.tms.tokens.xyz`),T=t.t(`${l}.tms.tokens.flipped_y`),A=t.t(`${l}.tms.tokens.switch`),M=t.t(`${l}.tms.tokens.quadtile`),k=t.t(`${l}.tms.tokens.scale_factor`),F=t.t("example"),O=Ki.parse(`
${u}
&nbsp;<br>
&nbsp;<br>
#### ${d}
* ${m}
* ${g}
* ${_}
* ${v}
&nbsp;<br>
&nbsp;<br>
#### ${E}
* ${b}
* ${T}
* ${A}
* ${M}
* ${k}
&nbsp;<br>
&nbsp;<br>
#### ${F}
* \`https://{switch:a,b,c}.tile.openstreetmap.org/{zoom}/{x}/{y}.png\`
`),B=a.select(".modal-section.message-text");B.append("div").attr("class","instructions-template").html(O),B.append("textarea").attr("class","field-template").attr("placeholder",t.t("settings.custom_background.template.placeholder")).call(ki).property("value",o.template);let U=a.select(".modal-section.buttons");U.insert("button",".ok-button").attr("class","button cancel-button secondary-action").html(t.tHtml("confirm.cancel")),U.select(".cancel-button").on("click.cancel",$),U.select(".ok-button").on("click.save",q);function $(){B.select(".field-template").property("value",n.template),e.setItem("background-custom-template",n.template),this.blur(),a.close()}function q(){o.template=B.select(".field-template").property("value"),e.setItem("background-custom-template",o.template),this.blur(),a.close(),i.call("change",this,o)}}return $t(r,i,"on")}function bx(t){let e=t.systems.map,i=t.systems.l10n,r=t.systems.imagery,s=t.systems.storage,n=Ji(t,"background-list").label(i.t("background.backgrounds")).disclosureContent(_),o=ye(null),a=r.getSource("custom"),l=vx(t).on("change",M),u=s.getItem("background-favorites"),d=u?JSON.parse(u):{};function m(){return s.getItem("background-last-used-toggle")}function g(U){return!U.overlay}function _(U){let $=U.selectAll(".layer-background-list").data([0]);o=$.enter().append("ul").attr("class","layer-list layer-background-list").attr("dir","auto").merge($);let q=U.selectAll(".bg-extras-list").data([0]).enter().append("ul").attr("class","layer-list bg-extras-list"),W=q.append("li").attr("class","minimap-toggle-item").append("label").call(Ft(t).title(i.t("background.minimap.tooltip")).keys([i.t("background.minimap.key")]).placement("top"));W.append("input").attr("type","checkbox").on("change",ce=>{ce.preventDefault(),d0.toggle()}),W.append("span").text(i.t("background.minimap.description"));let Z=q.append("li").attr("class","three-d-map-toggle-item").append("label").call(Ft(t).title(i.t("background.3dmap.tooltip")).keys([Ri("\u2318"+i.t("background.3dmap.key"))]).placement("top"));Z.append("input").attr("type","checkbox").on("change",ce=>{ce.preventDefault(),h0.toggle()}),Z.append("span").text(i.t("background.3dmap.description"));let Q=q.append("li").attr("class","background-panel-toggle-item").append("label").call(Ft(t).title(i.t("background.panel.tooltip")).keys([Ri("\u2318\u21E7"+i.t("info_panels.background.key"))]).placement("top"));Q.append("input").attr("type","checkbox").on("change",ce=>{ce.preventDefault(),t.systems.ui.info.toggle("background")}),Q.append("span").text(i.t("background.panel.description"));let X=q.append("li").attr("class","location-panel-toggle-item").append("label").call(Ft(t).title(i.t("background.location_panel.tooltip")).keys([Ri("\u2318\u21E7"+i.t("info_panels.location.key"))]).placement("top"));X.append("input").attr("type","checkbox").on("change",ce=>{ce.preventDefault(),t.systems.ui.info.toggle("location")}),X.append("span").text(i.t("background.location_panel.description")),U.selectAll(".imagery-faq").data([0]).enter().append("div").attr("class","imagery-faq").append("a").attr("target","_blank").call(Ye("#rapid-icon-out-link","inline")).attr("href","https://github.com/openstreetmap/iD/blob/develop/FAQ.md#how-can-i-report-an-issue-with-background-imagery").append("span").text(i.t("background.imagery_problem_faq")),o.call(b)}function v(U){U.each(($,q,W)=>{let Z=ye(W[q]).select("label"),Q=Z.select("span"),X=q<W.length/2?"bottom":"top",ce=Q.property("clientWidth")!==Q.property("scrollWidth");Z.call(Ft(t).destroyAny),$.id===m()?Z.call(Ft(t).placement(X).title("<div>"+i.t("background.switch")+"</div>").keys([Ri("\u2318"+i.t("background.key"))])):($.description||ce)&&Z.call(Ft(t).placement(X).title($.description||$.name))})}function E(U,$){return d[U.id]&&!d[$.id]?-1:d[$.id]&&!d[U.id]?1:U.best&&!$.best?-1:$.best&&!U.best?1:yf(U.area,$.area)||yu(U.name,$.name)||0}function b(U){let $=r.sources(e.extent(),e.zoom()).filter(g),q=U.selectAll("li").data($,Q=>Q.id);q.exit().remove();let W=q.enter().append("li").classed("layer-custom",Q=>Q.id==="custom").classed("best",Q=>Q.best),Z=W.append("label");Z.append("input").attr("type","radio").attr("name","layers").on("change",A),Z.append("span").attr("class","background-name").text(Q=>Q.name),W.append("button").attr("class","background-favorite-button").classed("active",Q=>!!d[Q.id]).attr("tabindex",-1).call(Ye("#rapid-icon-favorite")).on("click",(Q,X)=>{d[X.id]?(ye(Q.currentTarget).classed("active",!1),delete d[X.id]):(ye(Q.currentTarget).classed("active",!0),d[X.id]=!0),s.setItem("background-favorites",JSON.stringify(d)),ye(Q.currentTarget.parentElement).transition().duration(300).ease(hd).style("background-color","orange").transition().duration(300).ease(hd).style("background-color",null),U.selectAll("li").sort(E),U.call(T)}),W.filter(Q=>Q.id==="custom").append("button").attr("class","layer-browse").call(Ft(t).title(i.t("settings.custom_background.tooltip")).placement(i.isRTL()?"right":"left")).on("click",k).call(Ye("#rapid-icon-more")),W.filter(Q=>Q.best).selectAll("label").append("span").attr("class","best").call(Ft(t).title(i.t("background.best_imagery")).placement("bottom")).call(Ye("#rapid-icon-best-background")),U.selectAll("li").sort(E),U.call(T)}function T(U){function $(q){return r.showsLayer(q)}U.selectAll("li").classed("active",$).classed("switch",q=>q.id===m()).call(v).selectAll("input").property("checked",$)}function A(U,$){if($.id==="custom"&&!$.template)return k();let q=r.baseLayerSource();q instanceof Il&&s.setItem("background-last-used-toggle",q.id),s.setItem("background-last-used",$.id),r.baseLayerSource($)}function M(U){U?.template?(a.template=U.template,A(void 0,a)):(a.template="",A(void 0,r.getSource("none")))}function k(U){U.preventDefault(),t.container().call(l)}function F(U){let $=r.sources(e.extent(),e.zoom()).filter(g);$.sort(E);let q=r.baseLayerSource(),W=$.indexOf(q);if(W===-1)return;let Z=(W+U+$.length)%$.length,Q=$[Z];Q.id==="custom"&&!Q.template&&(Z=(Z+U+$.length)%$.length,Q=$[Z]),A(void 0,Q)}function O(){F(1)}function B(){F(-1)}return r.on("imagerychange",()=>o.call(T)),e.on("draw",Ur(()=>{window.requestIdleCallback(n.reRender)},1e3,{leading:!0,trailing:!0})),t.keybinding().on(i.t("background.next_background.key"),O).on(i.t("background.previous_background.key"),B),n}function wx(t){let e=t.systems.l10n,i=t.systems.imagery,r=Ji(t,"background-offset").label(e.tHtml("background.fix_misalignment")).disclosureContent(d),s=[["top",[0,-.5]],["left",[-.5,0]],["right",[.5,0]],["bottom",[0,.5]]];function n(){let m=y8(i.offset),g=+m[0].toFixed(2),_=+m[1].toFixed(2);t.container().selectAll(".nudge-inner-rect").select("input").classed("error",!1).property("value",`${g},${_}`),t.container().selectAll(".nudge-reset").classed("disabled",g===0&&_===0)}function o(){i.offset=[0,0],n()}function a(m){i.nudge(m,t.systems.map.zoom()),n()}function l(m){let g=ye(m.target),_=g.node().value;if(_==="")return o();if(_=_.replace(/;/g,",").split(",").map(v=>!isNaN(v)&&v),_.length!==2||!_[0]||!_[1]){g.classed("error",!0);return}i.offset=g8(_),n()}function u(m){if(m.button!==0)return;let g=[m.clientX,m.clientY],_=m.pointerId||"mouse";t.container().append("div").attr("class","nudge-surface"),ye(window).on("pointermove.drag-bg-offset",v).on("pointerup.drag-bg-offset",E).on("pointercancel.drag-bg-offset",E);function v(b){if(_!==(b.pointerId||"mouse"))return;let T=[b.clientX,b.clientY],A=[-(g[0]-T[0])/4,-(g[1]-T[1])/4];g=T,a(A)}function E(b){_===(b.pointerId||"mouse")&&b.button===0&&(t.container().selectAll(".nudge-surface").remove(),ye(window).on(".drag-bg-offset",null))}}function d(m){let _=m.selectAll(".nudge-container").data([0]).enter().append("div").attr("class","nudge-container");_.append("div").attr("class","nudge-instructions").html(e.tHtml("background.offset"));let v=_.append("div").attr("class","nudge-controls-wrap");v.append("div").attr("class","nudge-outer-rect").on("pointerdown",u).append("div").attr("class","nudge-inner-rect").append("input").attr("type","text").on("change",l),v.append("div").selectAll("button").data(s).enter().append("button").attr("class",b=>`${b[0]} nudge`).attr("tabindex",-1).on("click",(b,T)=>a(T[1])),v.append("button").attr("title",e.t("background.reset")).attr("class","nudge-reset disabled").on("click",b=>{b.preventDefault(),o()}).call(Ye("#rapid-icon-"+(e.isRTL()?"redo":"undo"))),n()}return i.on("imagerychange",n),r}function LO(t){let e=t.systems.imagery,i=t.systems.rapid,r=Ji(t,"grid-display-options").label(t.t("background.grid.grids")).disclosureContent(a),s=[{numSplit:0,name:t.t("background.grid.no_grid")},{numSplit:2,name:t.t("background.grid.n_by_n",{num:2})},{numSplit:3,name:t.t("background.grid.n_by_n",{num:3})},{numSplit:4,name:t.t("background.grid.n_by_n",{num:4})},{numSplit:5,name:t.t("background.grid.n_by_n",{num:5})},{numSplit:6,name:t.t("background.grid.n_by_n",{num:6})}];function n(l,u){l.preventDefault(),e.numGridSplits=u.numSplit}function o(l){let u=l.selectAll(".layer-grid-list").data([0]),m=u.enter().append("ul").attr("class","layer-list layer-grid-list").attr("dir","auto").merge(u).selectAll("li").data(s,v=>v.name),_=m.enter().insert("li",".custom-gridsopt").attr("class","gridsopt").append("label");_.append("input").attr("type","radio").attr("name","grids").property("checked",v=>v.numSplit===e.numGridSplits).on("change",n),_.append("span").text(v=>v.name),m.exit().remove()}function a(l){let u=ye(".section-grid-display-options");if(i.on("taskchanged",()=>{i.isTaskRectangular()&&(u.classed("hide",!1),l.call(o))}),!i.isTaskRectangular()){u.classed("hide",!0);return}}return r}function Ex(t){let e=t.systems.map,i=t.systems.l10n,r=t.systems.imagery,s=Ji(t,"overlay-list").label(i.tHtml("background.overlays")).disclosureContent(m),n=ye(null);function o(g){g.each((_,v,E)=>{let b=ye(E[v]).select("label"),T=b.select("span"),A=v<E.length/2?"bottom":"top",M=T.property("clientWidth")!==T.property("scrollWidth");b.call(Ft(t).destroyAny),(_.description||M)&&b.call(Ft(t).placement(A).title(_.description||_.name))})}function a(g){function _(v){return r.showsLayer(v)}g.selectAll("li").classed("active",_).call(o).selectAll("input").property("checked",_)}function l(g){let _=r.sources(e.extent(),e.zoom()).filter(d),v=g.selectAll("li").data(_,A=>A.name);v.exit().remove();let b=v.enter().append("li").append("label");b.append("input").attr("type","checkbox").attr("name","layers").on("change",u),b.append("span").html(A=>A.label),g.selectAll("li").sort(T),g.call(a);function T(A,M){return A.best&&!M.best?-1:M.best&&!A.best?1:yf(A.area,M.area)||yu(A.name,M.name)||0}}function u(g,_){g.preventDefault(),r.toggleOverlayLayer(_),n.call(a)}function d(g){return!!g.overlay}function m(g){let _=g.selectAll(".layer-overlay-list").data([0]);n=_.enter().append("ul").attr("class","layer-list layer-overlay-list").attr("dir","auto").merge(_),n.call(l)}return r.on("imagerychange",()=>s.reRender),e.on("draw",Ur(()=>{window.requestIdleCallback(s.reRender)},1e3,{leading:!0,trailing:!0})),s}function Tx(t){var e=Fl(t,"background").key(t.t("background.key")).label(t.tHtml("background.title")).description(t.tHtml("background.description")).iconName("rapid-icon-layers").sections([bx(t),Ex(t),LO(t),xx(t),wx(t)]);return e}function Sx(t){let e=t.systems.l10n,i=[["help",["welcome","open_data_h","open_data","before_start_h","before_start","open_source_h","open_source","open_source_help"]],["overview",["navigation_h","navigation_drag","navigation_zoom","features_h","features","nodes_ways"]],["editing",["select_h","select_left_click","select_right_click","select_space","multiselect_h","multiselect","multiselect_shift_click","multiselect_lasso","undo_redo_h","undo_redo","save_h","save","save_validation","upload_h","upload","backups_h","backups","keyboard_h","keyboard"]],["feature_editor",["intro","definitions","type_h","type","type_picker","fields_h","fields_all_fields","fields_example","fields_add_field","tags_h","tags_all_tags","tags_resources"]],["points",["intro","add_point_h","add_point","add_point_finish","move_point_h","move_point","delete_point_h","delete_point","delete_point_command"]],["lines",["intro","add_line_h","add_line","add_line_draw","add_line_continue","add_line_finish","modify_line_h","modify_line_dragnode","modify_line_addnode","connect_line_h","connect_line","connect_line_display","connect_line_drag","connect_line_tag","disconnect_line_h","disconnect_line_command","move_line_h","move_line_command","move_line_connected","delete_line_h","delete_line","delete_line_command"]],["areas",["intro","point_or_area_h","point_or_area","add_area_h","add_area_command","add_area_draw","add_area_continue","add_area_finish","square_area_h","square_area_command","modify_area_h","modify_area_dragnode","modify_area_addnode","delete_area_h","delete_area","delete_area_command"]],["relations",["intro","edit_relation_h","edit_relation","edit_relation_add","edit_relation_delete","maintain_relation_h","maintain_relation","relation_types_h","multipolygon_h","multipolygon","multipolygon_create","multipolygon_merge","turn_restriction_h","turn_restriction","turn_restriction_field","turn_restriction_editing","route_h","route","route_add","boundary_h","boundary","boundary_add"]],["operations",["intro","intro_2","straighten","orthogonalize","circularize","move","rotate","reflect","continue","reverse","disconnect","split","extract","merge","delete","downgrade","copy_paste"]],["notes",["intro","add_note_h","add_note","place_note","move_note","update_note_h","update_note","save_note_h","save_note"]],["imagery",["intro","sources_h","choosing","sources","offsets_h","offset","offset_change"]],["streetlevel",["intro","using_h","using","photos","viewer"]],["gps",["intro","survey","using_h","using","tracing","upload"]],["qa",["intro","tools_h","tools","issues_h","issues"]]],r={"help.help.open_data_h":3,"help.help.before_start_h":3,"help.help.open_source_h":3,"help.overview.navigation_h":3,"help.overview.features_h":3,"help.editing.select_h":3,"help.editing.multiselect_h":3,"help.editing.undo_redo_h":3,"help.editing.save_h":3,"help.editing.upload_h":3,"help.editing.backups_h":3,"help.editing.keyboard_h":3,"help.feature_editor.type_h":3,"help.feature_editor.fields_h":3,"help.feature_editor.tags_h":3,"help.points.add_point_h":3,"help.points.move_point_h":3,"help.points.delete_point_h":3,"help.lines.add_line_h":3,"help.lines.modify_line_h":3,"help.lines.connect_line_h":3,"help.lines.disconnect_line_h":3,"help.lines.move_line_h":3,"help.lines.delete_line_h":3,"help.areas.point_or_area_h":3,"help.areas.add_area_h":3,"help.areas.square_area_h":3,"help.areas.modify_area_h":3,"help.areas.delete_area_h":3,"help.relations.edit_relation_h":3,"help.relations.maintain_relation_h":3,"help.relations.relation_types_h":2,"help.relations.multipolygon_h":3,"help.relations.turn_restriction_h":3,"help.relations.route_h":3,"help.relations.boundary_h":3,"help.notes.add_note_h":3,"help.notes.update_note_h":3,"help.notes.save_note_h":3,"help.imagery.sources_h":3,"help.imagery.offsets_h":3,"help.streetlevel.using_h":3,"help.gps.using_h":3,"help.qa.tools_h":3,"help.qa.issues_h":3},s={version:`**${t.version}**`,rapidicon:'<svg class="icon pre-text rapid"><use xlink:href="#rapid-logo-rapid-wordmark"></use></svg>'},n=[];for(let[a,l]of i){let u=l.reduce((d,m)=>{let g=`help.${a}.${m}`,_=r[g],v=_?Array(_+1).join("#")+" ":"";return d+v+lt(t,g,s)+`

`},"");n.push({title:e.tHtml(`help.${a}.title`),content:Ki.parse(u.trim()).replace(/<code>/g,"<kbd>").replace(/<\/code>/g,"</kbd>")})}let o=Fl(t,"help").key(e.t("help.key")).label(e.tHtml("help.title")).description(e.tHtml("help.title")).iconName("rapid-icon-help");return o.renderContent=function(a){function l(A,M){let k=e.isRTL();a.property("scrollTop",0),o.selection().select(".pane-heading h2").html(A.title),b.html(A.content),b.selectAll("a").attr("target","_blank"),g.classed("selected",B=>B.title===A.title),T.html(""),k?T.call(F).call(O):T.call(O).call(F);function F(B){if(M===n.length-1)return;B.append("a").attr("href","#").attr("class","next").on("click",function($){$.preventDefault(),l(n[M+1],M+1)}).append("span").html(n[M+1].title).call(Ye(k?"#rapid-icon-backward":"#rapid-icon-forward","inline"))}function O(B){if(M===0)return;B.append("a").attr("href","#").attr("class","previous").on("click",function($){$.preventDefault(),l(n[M-1],M-1)}).call(Ye(k?"#rapid-icon-forward":"#rapid-icon-backward","inline")).append("span").html(n[M-1].title)}}function u(A){A.preventDefault(),!t.inIntro&&(t.container().call(dc(t)),t.systems.ui.togglePanes())}function d(A){A.preventDefault(),t.container().call(t.systems.ui.shortcuts,!0)}let m=a.append("ul").attr("class","toc"),g=m.selectAll("li").data(n).enter().append("li").append("a").attr("href","#").html(A=>A.title).on("click",function(A,M){A.preventDefault(),l(M,n.indexOf(M))});m.append("li").attr("class","shortcuts").call(Ft(t).title(e.tHtml("shortcuts.tooltip")).keys(["?"]).placement("top")).append("a").attr("href","#").on("click",d).append("div").html(e.tHtml("shortcuts.title"));let v=m.append("li").attr("class","walkthrough").append("a").attr("href","#").on("click",u);v.append("svg").attr("class","logo logo-walkthrough").append("use").attr("xlink:href","#rapid-logo-walkthrough"),v.append("div").html(e.tHtml("splash.walkthrough"));let E=a.append("div").attr("class","left-content"),b=E.append("div").attr("class","body"),T=E.append("div").attr("class","nav");l(n[0],0)},o}var DS=1e3;function A6(t,e,i){let r=t.systems.validator,s=t.systems.storage,n=Ji(t,e).label(a).shouldDisplay(l).disclosureContent(u),o=[];function a(){let v=o.length>DS?`${DS}+`:String(o.length),E=t.t(`issues.${i}s.list_title`);return t.t("inspector.title_count",{title:E,count:v})}function l(){return o.length}function u(v){let E=t.systems.map.center(),b=t.graph(),T=o.map(function(M){let k=M.extent(b),F=k?fr(E,k.center()):0;return Object.assign(M,{dist:F})}).sort((A,M)=>A.dist-M.dist);T=T.slice(0,DS),v.call(d,T)}function d(v,E){let b=s.getItem("rapid-internal-feature.showAutoFix")==="true",T=v.selectAll(".issues-list").data([0]);T=T.enter().append("ul").attr("class",`layer-list issues-list ${i}s-list`).merge(T);let A=T.selectAll("li").data(E,q=>q.key);A.exit().remove();let M=A.enter().append("li").attr("class",q=>`issue severity-${q.severity}`),k=M.append("button").attr("class","issue-label").on("click",(q,W)=>r.focusIssue(W)).on("mouseover",(q,W)=>Yi(W.entityIds,!0,t)).on("mouseout",(q,W)=>Yi(W.entityIds,!1,t)),F=k.append("span").attr("class","issue-text");F.append("span").attr("class","issue-icon").each((q,W,Z)=>{let Q=q.severity==="warning"?"alert":"error";ye(Z[W]).call(Ye(`#rapid-icon-${Q}`))}),F.append("span").attr("class","issue-message"),b&&k.append("span").attr("class","issue-autofix").each((q,W,Z)=>{q.autoArgs&&ye(Z[W]).append("button").attr("title",t.t("issues.fix_one.title")).datum(q).attr("class","autofix action").on("click",(Q,X)=>{Q.preventDefault(),Q.stopPropagation(),Yi(X.entityIds,!1,t),t.perform.apply(t,X.autoArgs),r.validate()}).call(Ye("#rapid-icon-wrench"))}),A=A.merge(M).order(),A.selectAll(".issue-message").html(q=>q.message(t));let O=E.filter(q=>q.autoArgs),B=v.selectAll(".autofix-all").data(b&&O.length?[0]:[]);B.exit().remove();let U=B.enter().insert("div",".issues-list").attr("class","autofix-all"),$=U.append("a").attr("class","autofix-all-link").attr("href","#");$.append("span").attr("class","autofix-all-link-text").html(t.tHtml("issues.fix_all.title")),$.append("span").attr("class","autofix-all-link-icon").call(Ye("#rapid-icon-wrench")),B=B.merge(U),B.selectAll(".autofix-all-link").on("click",()=>{t.pauseChangeDispatch(),t.perform(as()),O.forEach(q=>{let W=q.autoArgs.slice();typeof W[W.length-1]!="function"&&W.pop(),W.push(t.t("issues.fix_all.annotation")),t.replace.apply(t,W)}),t.resumeChangeDispatch(),r.validate()})}function m(){return{what:s.getItem("validate-what")||"edited",where:s.getItem("validate-where")||"all"}}function g(){let v=m();o=r.getIssuesBySeverity(v)[i]}function _(){return t.container().selectAll(".map-panes .issues-pane.shown").size()}return r.on("validated",()=>{window.requestIdleCallback(()=>{_()&&(g(),n.reRender())})}),t.systems.map.on("draw",Ur(()=>{window.requestIdleCallback(()=>{_()&&(m().where==="visible"&&g(),n.reRender())})},1e3,{leading:!1,trailing:!0})),n}function Ax(t){let e=t.systems.storage,i=Ji(t,"issues-options").content(r);function r(o){let a=o.selectAll(".issues-options-container").data([0]);a=a.enter().append("div").attr("class","issues-options-container").merge(a);let l=[{key:"what",values:["edited","all"]},{key:"where",values:["visible","all"]}],d=a.selectAll(".issues-option").data(l,g=>g.key).enter().append("div").attr("class",g=>`issues-option issues-option-${g.key}`);d.append("div").attr("class","issues-option-title").html(g=>t.tHtml(`issues.options.${g.key}.title`));let m=d.selectAll("label").data(g=>g.values.map(_=>({value:_,key:g.key}))).enter().append("label");m.append("input").attr("type","radio").attr("name",g=>`issues-option-${g.key}`).attr("value",g=>g.value).property("checked",g=>s()[g.key]===g.value).on("change",(g,_)=>n(g,_.key,_.value)),m.append("span").html(g=>t.tHtml(`issues.options.${g.key}.${g.value}`))}function s(){return{what:e.getItem("validate-what")||"edited",where:e.getItem("validate-where")||"all"}}function n(o,a,l){!l&&o&&o.target&&(l=o.target.value),e.setItem(`validate-${a}`,l),t.systems.validator.validate()}return i}function Cx(t){let e=t.systems.validator,i=t.systems.storage,r=0,s=20,n=5,o=Ji(t,"issues-rules").disclosureContent(l).label(t.tHtml("issues.rules.title")),a=e.getRuleKeys().sort((_,v)=>t.t(`issues.${_}.title`)<t.t(`issues.${v}.title`)?-1:1);function l(_){let v=_.selectAll(".issues-rulelist-container").data([0]),E=v.enter().append("div").attr("class","issues-rulelist-container");E.append("ul").attr("class","layer-list issue-rules-list");let b=E.append("div").attr("class","issue-rules-links section-footer");b.append("a").attr("class","issue-rules-link").attr("href","#").html(t.tHtml("issues.disable_all")).on("click",T=>{T.preventDefault(),e.disableRules(a)}),b.append("a").attr("class","issue-rules-link").attr("href","#").html(t.tHtml("issues.enable_all")).on("click",T=>{T.preventDefault(),e.disableRules([])}),v=v.merge(E),v.selectAll(".issue-rules-list").call(u)}function u(_){let v=_.selectAll("li").data(a);v.exit().remove();let E=v.enter().append("li").call(Ft(t).title(k=>t.tHtml(`issues.${k}.tip`)).placement("top")),b=E.append("label");b.append("input").attr("type","checkbox").attr("name","rule").on("change",g),b.append("span").html(k=>{let F={};return k==="unsquare_way"&&(F.val='<span class="square-degrees"></span>'),t.tHtml(`issues.${k}.title`,F)}),v=v.merge(E),v.classed("active",m).selectAll("input").property("checked",m).property("indeterminate",!1);let T=i.getItem("validate-square-degrees");T===null&&(T=n.toString());let M=v.selectAll(".square-degrees").selectAll(".square-degrees-input").data([0]);M.enter().append("input").attr("type","number").attr("min",r.toString()).attr("max",s.toString()).attr("step","0.5").attr("class","square-degrees-input").call(ki).on("click",function(k){k.preventDefault(),k.stopPropagation(),this.select()}).on("keyup",function(k){k.keyCode===13&&(this.blur(),this.select())}).on("blur",d).merge(M).property("value",T)}function d(){let _=ye(this),v=ti(_).trim(),E=parseFloat(v,10);isFinite(E)?E>s?E=s:E<r&&(E=r):E=n,E=Math.round(E*10)/10,v=E.toString(),_.property("value",v),i.setItem("validate-square-degrees",v),e.revalidateUnsquare()}function m(_){return e.isRuleEnabled(_)}function g(_,v){e.toggleRule(v)}return e.on("validated",()=>{window.requestIdleCallback(o.reRender)}),o}function Ix(t){let e=t.systems.validator,i=Ji(t,"issues-status").shouldDisplay(r).content(n);function r(){return e.getIssues(s()).length===0}function s(){let l=t.systems.storage;return{what:l.getItem("validate-what")||"edited",where:l.getItem("validate-where")||"all"}}function n(l){let d=l.selectAll(".box").data([0]).enter().append("div").attr("class","box");d.append("div").call(Ye("#rapid-icon-apply","pre-text"));let m=d.append("span");m.append("strong").attr("class","message"),m.append("br"),m.append("span").attr("class","details"),o(l),a(l)}function o(l){let u=e.getIssues({what:"all",where:"all",includeDisabledRules:!0,includeIgnored:"only"}),d=l.selectAll(".reset-ignored").data(u.length?[0]:[]);d.exit().remove();let m=d.enter().append("div").attr("class","reset-ignored section-footer");m.append("a").attr("href","#"),d=d.merge(m),d.select("a").html(t.t("inspector.title_count",{title:t.tHtml("issues.reset_ignored"),count:u.length})),d.on("click",g=>{g.preventDefault(),e.resetIgnoredIssues()})}function a(l){let u=s();function d(g){for(let _ in g){let v=g[_],E=e.getIssues(v);if(E.length){l.select(".box .details").html(t.tHtml("issues.no_issues.hidden_issues."+_,{count:E.length.toString()}));return}}l.select(".box .details").html(t.tHtml("issues.no_issues.hidden_issues.none"))}let m;u.what==="edited"&&u.where==="visible"?(m="edits_in_view",d({elsewhere:{what:"edited",where:"all"},everything_else:{what:"all",where:"visible"},disabled_rules:{what:"edited",where:"visible",includeDisabledRules:"only"},everything_else_elsewhere:{what:"all",where:"all"},disabled_rules_elsewhere:{what:"edited",where:"all",includeDisabledRules:"only"},ignored_issues:{what:"edited",where:"visible",includeIgnored:"only"},ignored_issues_elsewhere:{what:"edited",where:"all",includeIgnored:"only"}})):u.what==="edited"&&u.where==="all"?(m="edits",d({everything_else:{what:"all",where:"all"},disabled_rules:{what:"edited",where:"all",includeDisabledRules:"only"},ignored_issues:{what:"edited",where:"all",includeIgnored:"only"}})):u.what==="all"&&u.where==="visible"?(m="everything_in_view",d({elsewhere:{what:"all",where:"all"},disabled_rules:{what:"all",where:"visible",includeDisabledRules:"only"},disabled_rules_elsewhere:{what:"all",where:"all",includeDisabledRules:"only"},ignored_issues:{what:"all",where:"visible",includeIgnored:"only"},ignored_issues_elsewhere:{what:"all",where:"all",includeIgnored:"only"}})):u.what==="all"&&u.where==="all"&&(m="everything",d({disabled_rules:{what:"all",where:"all",includeDisabledRules:"only"},ignored_issues:{what:"all",where:"all",includeIgnored:"only"}})),u.what==="edited"&&t.systems.edits.difference().summary().size===0&&(m="no_edits"),l.select(".box .message").html(t.tHtml(`issues.no_issues.message.${m}`))}return e.on("validated",()=>{window.requestIdleCallback(i.reRender)}),t.systems.map.on("draw",Ur(()=>{window.requestIdleCallback(i.reRender)},1e3)),i}function kx(t){return Fl(t,"issues").key(t.t("issues.key")).label(t.tHtml("issues.title")).description(t.tHtml("issues.title")).iconName("rapid-icon-alert").sections([Ax(t),Ix(t),A6(t,"issues-errors","error"),A6(t,"issues-warnings","warning"),Cx(t)])}function Mx(t){let e=t.systems.storage,i=t.systems.urlhash,r=Mt("change"),s="settings.custom_data",n=[".gpx","application/gpx","application/gpx+xml",".kml","application/vnd.google-earth.kml+xml","application/kml","application/kml+xml",".geojson",".json","application/geo+json","application/json","application/vnd.geo+json","text/x-json"];function o(a){let l=t.scene().layers.get("custom-data"),u=i.getParam("data")||i.getParam("gpx")||e.getItem("settings-custom-data-url"),d=l&&l.getFileList()||null,m=u,g=d,_=_h(t,a).okButton();_.classed("settings-modal settings-custom-data",!0),_.select(".modal-section.header").append("h3").html(t.tHtml("settings.custom_data.header"));let v=_.select(".modal-section.message-text"),E=t.t(`${s}.instructions`),b=t.t(`${s}.file.heading`),T=t.t(`${s}.file.instructions`),A=t.t(`${s}.file.types`),M=t.t(`${s}.file.tip`),k=Ki.parse(`
${E}
&nbsp;<br>
&nbsp;<br>
### ${b}
${T}
* ${A}
&nbsp;<br>
&nbsp;<br>
${M}
`);v.append("div").attr("class","instructions-template").html(k),v.append("input").attr("class","field-file").attr("type","file").attr("accept",n.join()).property("files",g).on("change",ee=>{let oe=ee.target.files;oe?.length?(g=oe,m="",v.select(".field-url").property("value","")):g=null});let F=t.t(`${s}.or`),O=t.t(`${s}.url.heading`),B=t.t(`${s}.url.instructions`),U=t.t(`${s}.url.tokens`),$=t.t(`${s}.url.xyz`),q=t.t(`${s}.url.example_file`),W=t.t(`${s}.url.example_xyz`),Z=t.t(`${s}.url.example_pmtiles`),Q=t.t("example"),X=Ki.parse(`
### ${F}
### ${O}
${B}
&nbsp;<br>
&nbsp;<br>
${U}
* ${$}
&nbsp;<br>
&nbsp;<br>
#### ${Q}
* \`${q}\`
* \`${W}\`
* \`${Z}\`
`);v.append("div").attr("class","instructions-template").html(X),v.append("textarea").attr("class","field-url").attr("placeholder",t.t("settings.custom_data.url.placeholder")).call(ki).property("value",m);let ce=_.select(".modal-section.buttons");ce.insert("button",".ok-button").attr("class","button cancel-button secondary-action").html(t.tHtml("confirm.cancel")),ce.select(".cancel-button").on("click.cancel",le),ce.select(".ok-button").attr("disabled",de).on("click.save",te);function de(){return null}function le(){v.select(".field-url").property("value",u),e.setItem("settings-custom-data-url",u),this.blur(),_.close()}function te(){m=v.select(".field-url").property("value").trim();let ee={};m?(ee={url:m,fileList:null},e.setItem("settings-custom-data-url",m)):g&&(ee={url:null,fileList:g}),this.blur(),_.close(),r.call("change",this,ee)}}return $t(o,r,"on")}function Px(t){let e=t.systems.l10n,i=Ji(t,"data-layers").label(e.tHtml("map_data.data_layers")).disclosureContent(n),r=Mx(t).on("change",_),s=t.scene();function n(E){let b=E.selectAll(".data-layer-container").data([0]);b.enter().append("div").attr("class","data-layer-container").merge(b).call(u).call(d).call(m).call(v)}function o(E){return s.layers.get(E)?.enabled}function a(E,b){let T=t.mode;T&&/^draw/.test(T.id)||(b?s.enableLayers(E):(s.disableLayers(E),(E==="osm"||E==="notes")&&t.enter("browse")))}function l(E){a(E,!o(E))}function u(E){let T=["osm","notes"].map(O=>s.layers.get(O)).filter(Boolean),A=E.selectAll(".layer-list-osm").data([0]);A=A.enter().append("ul").attr("class","layer-list layer-list-osm").merge(A);let M=A.selectAll(".list-item").data(T);M.exit().remove();let k=M.enter().append("li").attr("class",O=>`list-item list-item-${O.id}`),F=k.append("label").each((O,B,U)=>{O.id==="osm"?ye(U[B]).call(Ft(t).title(e.tHtml(`map_data.layers.${O.id}.tooltip`)).keys([Ri("\u2325"+e.t("area_fill.wireframe.key"))]).placement("bottom")):ye(U[B]).call(Ft(t).title(e.tHtml(`map_data.layers.${O.id}.tooltip`)).placement("bottom"))});F.append("input").attr("type","checkbox").on("change",(O,B)=>l(B.id)),F.append("span").html(O=>e.tHtml(`map_data.layers.${O.id}.title`)),M.merge(k).classed("active",O=>O.enabled).selectAll("input").property("checked",O=>O.enabled)}function d(E){let T=["keepRight","improveOSM","osmose"].map(O=>s.layers.get(O)).filter(Boolean),A=E.selectAll(".layer-list-qa").data([0]);A=A.enter().append("ul").attr("class","layer-list layer-list-qa").merge(A);let M=A.selectAll(".list-item").data(T);M.exit().remove();let k=M.enter().append("li").attr("class",O=>`list-item list-item-${O.id}`),F=k.append("label").each((O,B,U)=>{ye(U[B]).call(Ft(t).title(e.tHtml(`map_data.layers.${O.id}.tooltip`)).placement("bottom"))});F.append("input").attr("type","checkbox").on("change",(O,B)=>l(B.id)),F.append("span").html(O=>e.tHtml(`map_data.layers.${O.id}.title`)),M.merge(k).classed("active",O=>O.enabled).selectAll("input").property("checked",O=>O.enabled)}function m(E){let b=s.layers.get("custom-data"),T=e.isRTL(),A=E.selectAll(".layer-list-data").data(b?[b]:[]);A.exit().remove();let M=A.enter().append("ul").attr("class","layer-list layer-list-data"),k=M.append("li").attr("class","list-item-data"),F=k.append("label").call(Ft(t).title(e.tHtml("map_data.layers.custom.tooltip")).placement("top"));F.append("input").attr("type","checkbox").on("change",()=>l("custom-data")),F.append("span").html(e.tHtml("map_data.layers.custom.title")),k.append("button").attr("class","open-data-options").call(Ft(t).title(e.tHtml("settings.custom_data.tooltip")).placement(T?"right":"left")).on("click",O=>{O.preventDefault(),g()}).call(Ye("#rapid-icon-more")),k.append("button").attr("class","zoom-to-data").call(Ft(t).title(e.tHtml("map_data.layers.custom.zoom")).placement(T?"right":"left")).on("click",function(O){if(ye(this).classed("disabled"))return;O.preventDefault(),O.stopPropagation(),s.layers.get("custom-data")?.fitZoom()}).call(Ye("#rapid-icon-framed-dot","monochrome")),A=A.merge(M),A.selectAll(".list-item-data").classed("active",O=>O.enabled).selectAll("label").classed("deemphasize",O=>!O.hasData).selectAll("input").property("disabled",O=>!O.hasData).property("checked",O=>O.enabled),A.selectAll("button.zoom-to-data").classed("disabled",O=>!O.hasData)}function g(){t.container().call(r)}function _(E){let b=s.layers.get("custom-data");b&&(E?.url?b.setUrl(E.url):E?.fileList&&b.setFileList(E.fileList))}function v(E){let b=E.selectAll(".md-extras-list").data([0]).enter().append("ul").attr("class","layer-list md-extras-list"),T=b.append("li").attr("class","history-panel-toggle-item").append("label").call(Ft(t).title(e.tHtml("map_data.history_panel.tooltip")).keys([Ri("\u2318\u21E7"+e.t("info_panels.history.key"))]).placement("top"));T.append("input").attr("type","checkbox").on("change",M=>{M.preventDefault(),t.systems.ui.info.toggle("history")}),T.append("span").html(e.tHtml("map_data.history_panel.title"));let A=b.append("li").attr("class","measurement-panel-toggle-item").append("label").call(Ft(t).title(e.tHtml("map_data.measurement_panel.tooltip")).keys([Ri("\u2318\u21E7"+e.t("info_panels.measurement.key"))]).placement("top"));A.append("input").attr("type","checkbox").on("change",M=>{M.preventDefault(),t.systems.ui.info.toggle("measurement")}),A.append("span").html(e.tHtml("map_data.measurement_panel.title"))}return t.scene().on("layerchange",i.reRender),i}function Rx(t){let e=t.systems.filters,i=Ji(t,"map-features").label(t.tHtml("map_data.map_features")).disclosureContent(r);function r(a){let l=a.selectAll(".layer-feature-list-container").data([0]),u=l.enter().append("div").attr("class","layer-feature-list-container");u.append("ul").attr("class","layer-list layer-feature-list");let d=u.append("div").attr("class","feature-list-links section-footer");d.append("a").attr("class","feature-list-link").attr("href","#").html(t.tHtml("issues.disable_all")).on("click",m=>{m.preventDefault(),e.disableAll()}),d.append("a").attr("class","feature-list-link").attr("href","#").html(t.tHtml("issues.enable_all")).on("click",m=>{m.preventDefault(),e.enableAll()}),l=l.merge(u),l.selectAll(".layer-feature-list").call(s)}function s(a){let l=a.selectAll("li").data(e.keys);l.exit().remove();let u=l.enter().append("li").call(Ft(t).title(m=>t.tHtml(`feature.${m}.tooltip`)).placement("top")),d=u.append("label");d.append("input").attr("type","checkbox").attr("name","feature").on("change",o),d.append("span").html(m=>t.tHtml(`feature.${m}.description`)),l=l.merge(u),l.classed("active",n).selectAll("input").property("checked",n)}function n(a){return e.isEnabled(a)}function o(a,l){e.toggle(l)}return e.on("filterchange",i.reRender),i}function Dx(t){let e=Ji(t,"fill-area").label(t.tHtml("map_data.style_options")).disclosureContent(i);function i(l){let u=l.selectAll(".layer-fill-list").data([0]);u.enter().append("ul").attr("class","layer-list layer-fill-list").merge(u).call(r,t.systems.map.areaFillOptions,"radio","area_fill",n,s);let d=l.selectAll(".layer-visual-diff-list").data([0]);d.enter().append("ul").attr("class","layer-list layer-visual-diff-list").merge(d).call(r,["highlight_edits"],"checkbox","visual_diff",a,o)}function r(l,u,d,m,g,_){let v=l.selectAll("li").data(u);v.exit().remove();let E=v.enter().append("li").call(Ft(t).title(T=>t.tHtml(`${m}.${T}.tooltip`)).keys(T=>{let A=T==="wireframe"?t.t("area_fill.wireframe.key"):null;return T==="highlight_edits"&&(A=t.t("map_data.highlight_edits.key")),A?[A]:null}).placement("top")),b=E.append("label");b.append("input").attr("type",d).attr("name",m).on("change",g),b.append("span").html(T=>t.tHtml(`${m}.${T}.description`)),v=v.merge(E),v.classed("active",_).selectAll("input").property("checked",_).property("indeterminate",!1)}function s(l){return t.systems.map.areaFillMode===l}function n(l,u){t.systems.map.areaFillMode=u}function o(){return t.systems.map.highlightEdits}function a(l){let u=l.currentTarget;t.systems.map.highlightEdits=u.checked}return t.systems.map.on("mapchange",e.reRender),e}function Fx(t){let e=t.systems.photos,i=Ji(t,"photo-overlays").label(t.tHtml("photo_overlays.title")).disclosureContent(s),r=t.scene();function s(g){let _=g.selectAll(".photo-overlay-container").data([0]);_.enter().append("div").attr("class","photo-overlay-container").merge(_).call(l).call(u).call(d).call(m)}function n(g){let _=r.layers.get(g);return _&&_.enabled}function o(g,_){let v=t.mode;v&&/^draw/.test(v.id)||(_?r.enableLayers(g):r.disableLayers(g))}function a(g){o(g,!n(g))}function l(g){let E=e.overlayLayerIDs.map(O=>r.layers.get(O)).filter(Boolean).filter(O=>O.supported);function b(O){return O&&O.supported}function T(O){return b(O)&&O.enabled}let A=g.selectAll(".layer-list-photos").data([0]);A=A.enter().append("ul").attr("class","layer-list layer-list-photos").merge(A);let M=A.selectAll(".list-item-photos").data(E);M.exit().remove();let k=M.enter().append("li").attr("class",function(O){var B="list-item-photos list-item-"+O.id;return(O.id==="mapillary-signs"||O.id==="mapillary-map-features")&&(B+=" indented"),B}),F=k.append("label").each((O,B,U)=>{let $;O.id==="mapillary-signs"?$="mapillary.signs.tooltip":O.id==="mapillary"?$="mapillary_images.tooltip":O.id==="kartaview"?$="kartaview_images.tooltip":$=O.id.replace(/-/g,"_")+".tooltip",ye(U[B]).call(Ft(t).title(t.tHtml($)).placement("top"))});F.append("input").attr("type","checkbox").on("change",(O,B)=>a(B.id)),F.append("span").html(O=>{let B=O.id;return B==="mapillary-signs"&&(B="photo_overlays.traffic_signs"),t.tHtml(B.replace(/-/g,"_")+".title")}),M.merge(k).classed("active",T).selectAll("input").property("checked",T)}function u(g){let _=e.allPhotoTypes;function v(M){return e.showsPhotoType(M)}let E=g.selectAll(".layer-list-photo-types").data([0]);E.exit().remove(),E=E.enter().append("ul").attr("class","layer-list layer-list-photo-types").merge(E);let b=E.selectAll(".list-item-photo-types").data(e.shouldFilterByPhotoType()?_:[]);b.exit().remove();let T=b.enter().append("li").attr("class",M=>`list-item-photo-types list-item-${M}`),A=T.append("label").each(function(M){ye(this).call(Ft(t).title(t.tHtml(`photo_overlays.photo_type.${M}.tooltip`)).placement("top"))});A.append("input").attr("type","checkbox").on("change",(M,k)=>e.togglePhotoType(k)),A.append("span").html(M=>t.tHtml(`photo_overlays.photo_type.${M}.title`)),b.merge(T).classed("active",v).selectAll("input").property("checked",v)}function d(g){let _=e.dateFilters;function v(M){return e.dateFilterValue(M)}let E=g.selectAll(".layer-list-date-filter").data([0]);E.exit().remove(),E=E.enter().append("ul").attr("class","layer-list layer-list-date-filter").merge(E);let b=E.selectAll(".list-item-date-filter").data(e.shouldFilterByDate()?_:[]);b.exit().remove();let T=b.enter().append("li").attr("class","list-item-date-filter"),A=T.append("label").each((M,k,F)=>{ye(F[k]).call(Ft(t).title(t.tHtml(`photo_overlays.date_filter.${M}.tooltip`)).placement("top"))});A.append("span").html(M=>t.tHtml(`photo_overlays.date_filter.${M}.title`)),A.append("input").attr("type","date").attr("class","list-item-input").attr("placeholder",t.t("units.year_month_day")).call(ki).each((M,k,F)=>{ti(ye(F[k]),e.dateFilterValue(M)||"")}).on("change",function(M,k){let F=ti(ye(this)).trim();e.setDateFilter(k,F,!0),b.selectAll("input").each(function(O){ti(ye(this),e.dateFilterValue(O)||"")})}),b=b.merge(T).classed("active",v)}function m(g){function _(){return e.usernames}let v=g.selectAll(".layer-list-username-filter").data([0]);v.exit().remove(),v=v.enter().append("ul").attr("class","layer-list layer-list-username-filter").merge(v);let E=v.selectAll(".list-item-username-filter").data(e.shouldFilterByUsername()?["username-filter"]:[]);E.exit().remove();let b=E.enter().append("li").attr("class","list-item-username-filter"),T=b.append("label").each((M,k,F)=>{ye(F[k]).call(Ft(t).title(t.tHtml("photo_overlays.username_filter.tooltip")).placement("top"))});T.append("span").html(t.tHtml("photo_overlays.username_filter.title")),T.append("input").attr("type","text").attr("class","list-item-input").call(ki).property("value",A).on("change",function(){let M=ye(this).property("value");e.setUsernameFilter(M,!0),ye(this).property("value",A)}),E.merge(b).classed("active",_);function A(){let M=e.usernames;return M&&M.join("; ")}}return t.scene().on("layerchange",i.reRender),e.on("photochange",i.reRender),i}function Lx(t){return Fl(t,"map-data").key(t.t("map_data.key")).label(t.tHtml("map_data.title")).description(t.tHtml("map_data.description")).iconName("rapid-icon-data").sections([Px(t),Fx(t),Dx(t),Rx(t)])}function Nx(t){let e=t.systems.storage,i=Ji(t,"preferences-third-party").label(t.tHtml("preferences.privacy.title")).disclosureContent(s),r=e.getItem("preferences.privacy.thirdpartyicons")||"true";function s(n){let a=n.selectAll(".privacy-options-list").data([0]).enter().append("ul").attr("class","layer-list privacy-options-list").append("li").attr("class","privacy-third-party-icons-item").append("label").call(Ft(t).title(t.tHtml("preferences.privacy.third_party_icons.tooltip")).placement("bottom"));a.append("input").attr("type","checkbox").on("change",u=>{u.preventDefault(),r=r==="true"?"false":"true",e.setItem("preferences.privacy.thirdpartyicons",r),l()}),a.append("span").html(t.tHtml("preferences.privacy.third_party_icons.description")),n.selectAll(".privacy-link").data([0]).enter().append("div").attr("class","privacy-link").append("a").attr("target","_blank").call(Ye("#rapid-icon-out-link","inline")).attr("href","https://mapwith.ai/doc/license/MapWithAIPrivacyPolicy.pdf").append("span").html(t.tHtml("preferences.privacy.privacy_link")),l();function l(){n.selectAll(".privacy-third-party-icons-item").classed("active",r==="true").select("input").property("checked",r==="true")}}return i}function Ox(t){let e=t.systems.storage,i=Ji(t,"map-interaction").label(t.tHtml("preferences.map_interaction.title")).disclosureContent(s),r=["auto","zoom","pan"];function s(l){let u=l.selectAll(".mouse-wheel-options").data([0]),d=u.enter().append("div").attr("class","mouse-wheel-options");d.append("div").attr("class","mouse-wheel-title").text(t.t("preferences.map_interaction.mouse_wheel.title")),d.append("ul").attr("class","layer-list mouse-wheel-options-list"),u.merge(d).selectAll(".mouse-wheel-options-list").call(n)}function n(l){let u=l.selectAll("li").data(r);u.exit().remove();let d=u.enter().append("li").call(Ft(t).title(g=>t.t(`preferences.map_interaction.mouse_wheel.${g}.tooltip`)).placement("top")),m=d.append("label");m.append("input").attr("type","radio").attr("name","mouse_wheel").on("change",a),m.append("span").text(g=>t.t(`preferences.map_interaction.mouse_wheel.${g}.title`)),u.merge(d).classed("active",o).selectAll("input").property("checked",o).property("indeterminate",!1)}function o(l){return(e.getItem("prefs.mouse_wheel.interaction")||"auto")===l}function a(l,u){e.setItem("prefs.mouse_wheel.interaction",u),i.reRender()}return i}function Bx(t){return Fl(t,"preferences").key(t.t("preferences.key")).label(t.tHtml("preferences.title")).description(t.tHtml("preferences.description")).iconName("fas-user-cog").sections([Nx(t),Ox(t)])}var C6=class extends ui{constructor(e){super(e),this.id="ui",this.dependencies=new Set(["edits","imagery","l10n","map","storage","urlhash"]),this.authModal=null,this.defs=null,this.flash=null,this.editMenu=null,this.info=null,this.sidebar=null,this.photoviewer=null,this.shortcuts=null,this._didRender=!1,this._needWidth={},this._startPromise=null,this._initPromise=null,this.render=this.render.bind(this),this.resize=this.resize.bind(this),this._clickBugLink=this._clickBugLink.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let s of this.dependencies)if(!this.context.systems[s])return Promise.reject(`Cannot init:  ${this.id} requires ${s}`);let e=this.context,i=e.systems.l10n,r=i.initAsync();return this._initPromise=r.then(()=>{window.addEventListener("beforeunload",()=>e.save()),window.addEventListener("unload",()=>e.systems.edits.unlock()),window.addEventListener("resize",()=>this.resize()),this.authModal=Vc(e).blocking(!0),this.defs=new V4(e),this.flash=X4(e),this.editMenu=v_(e),this.sidebar=ux(e),this.photoviewer=Y_(e),this.shortcuts=cx(e),this.authModal.message(i.tHtml("loading_auth"));let s=e.services.osm;s&&s.on("authLoading",()=>e.container()?.call(this.authModal)).on("authDone",()=>this.authModal.close())})}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context.container();return e.empty()||this.render(e),this._started=!0,this._startPromise=Promise.resolve()}resetAsync(){let e=this.context.container();return e.empty()||e.select(".inspector-wrap *").remove(),Promise.resolve()}render(e){if(this._didRender)return;this.didRender=!0;let i=this.context,r=i.systems.l10n;e.attr("lang",r.localeCode()).attr("dir",r.textDirection()),e.call(k_(i));let s=i.systems.map;s.redrawEnabled=!1,e.append("svg").attr("id","rapid-defs").call(this.defs.render),e.append("div").attr("class","sidebar").call(this.sidebar),i.keybinding().on("\u232B",M=>M.preventDefault()).on([r.t("sidebar.key"),"`","\xB2","@"],this.sidebar.toggle).on(Ri("\u2318"+r.t("background.key")),M=>{M&&(M.stopImmediatePropagation(),M.preventDefault());let k=i.systems.imagery,F=i.systems.storage,O=k.getSource(F.getItem("background-last-used-toggle"));if(O){let B=k.baseLayerSource();F.setItem("background-last-used-toggle",B.id),F.setItem("background-last-used",O.id),k.baseLayerSource(O)}});let n=e.append("div").attr("class","main-content active");n.append("div").attr("class","main-map").attr("dir","ltr").call(s.render),n.append("div").attr("class","top-toolbar-wrap").append("div").attr("class","top-toolbar fillD").call(mx(i));let o=n.append("div").attr("class","over-map");o.append("div").attr("class","select-trap").text("t"),o.call(d0(i)),o.call(h0(i)),o.append("div").attr("class","spinner").call(dx(i));let a=o.append("div").attr("class","map-controls");a.append("div").attr("class","map-control zoombuttons").call(yx(i)),a.append("div").attr("class","map-control zoom-to-selection-control").call(_x(i)),a.append("div").attr("class","map-control geolocate-control").call(M_(i));let l=o.append("div").attr("class","map-panes"),u=[Tx(i),Lx(i),kx(i),Bx(i),Sx(i)];for(let M of u)a.append("div").attr("class",`map-control map-pane-control ${M.id}-control`).call(M.renderToggleButton),l.call(M.renderPane);this.info=N_(i),o.call(this.info),o.append("div").attr("class","photoviewer").classed("al",!0).classed("hide",!0).call(this.photoviewer),o.append("div").attr("class","attribution-wrap").attr("dir","ltr").call(d_(i));let d=n.append("div").attr("class","map-footer");d.append("div").attr("class","api-status").call(fx(i));let m=d.append("div").attr("class","map-footer-bar fillD");m.append("div").attr("class","flash-wrap footer-hide");let g=m.append("div").attr("class","main-footer-wrap footer-show");g.append("div").attr("class","scale-block").call(lx(i));let _=g.append("div").attr("class","info-block").append("ul").attr("class","map-footer-list");_.append("li").attr("class","user-list").call(__(i)),_.append("li").attr("class","fb-road-license").attr("tabindex",-1).call(nx(i));let v=i.apiConnections;v&&v.length>1&&_.append("li").attr("class","source-switch").call(hx(i).keys(v)),_.append("li").attr("class","issues-info").call(U_(i));let E=_.append("li");E.append("button").attr("class","bugnub").attr("tabindex",-1).on("click",this._clickBugLink).call(Ye("#rapid-icon-bug","bugnub")).call(Ft(i).title(r.tHtml("report_a_bug")).placement("top")),E.append("a").attr("target","_blank").attr("href","https://github.com/openstreetmap/iD/blob/develop/CONTRIBUTING.md#translating").call(Ye("#rapid-icon-translate","light")).call(Ft(i).title(r.tHtml("help_translate")).placement("top")),_.append("li").attr("class","version").call(gx(i)),i.embed()||_.call(c_(i)),e.call(this.shortcuts),this.resize(),s.redrawEnabled=!0,i.enter("browse");let b=i.systems.edits;i.systems.urlhash.initialHashParams.get("walkthrough")==="true"?e.call(dc(i)):b.lock()&&b.hasRestorableChanges()?e.call(ax(i)):e.call(ox(i))}resize(e){let i=this.context,r=i.container(),s=i.systems.map,n=hc(r.select(".main-content"),!0);hc(r.select(".sidebar"),!0),e!==void 0&&s.pan(e),s.dimensions=n,this.photoviewer.onMapResize(),this.checkOverflow(".top-toolbar"),this.checkOverflow(".map-footer-bar")}checkOverflow(e,i){i&&delete this._needWidth[e];let r=this.context.container().select(e);if(r.empty())return;let s=r.property("scrollWidth"),n=r.property("clientWidth"),o=this._needWidth[e]||s;s>n?(r.classed("narrow",!0),this._needWidth[e]||(this._needWidth[e]=s)):s>=o&&r.classed("narrow",!1)}togglePanes(e){let i=this.context,r=i.systems.l10n,s=i.container(),n=s.selectAll(".map-pane.shown"),o=r.isRTL()?"left":"right";n.classed("shown",!1).classed("hide",!0),s.selectAll(".map-pane-control button").classed("active",!1),e?(n.classed("shown",!1).classed("hide",!0).style(o,"-500px"),s.selectAll("."+e.attr("pane")+"-control button").classed("active",!0),e.classed("shown",!0).classed("hide",!1),n.empty()?e.style(o,"-500px").transition().duration(200).style(o,"0px"):e.style(o,"0px")):n.classed("shown",!0).classed("hide",!1).style(o,"0px").transition().duration(200).style(o,"-500px").on("end",function(){ye(this).classed("shown",!1).classed("hide",!0)})}showEditMenu(e,i,r){this.editMenu.close();let s=this.context,n=s.mode;if(!r&&n.operations&&(r=typeof n.operations=="function"?n.operations():n.operations),!r||!r.length||!s.editable())return;let o=s.surface().node();o.focus&&o.focus();for(let a of r)typeof a.point=="function"&&a.point(e);this.editMenu.anchorLoc(s.projection.invert(e)).triggerType(i).operations(r),s.systems.map.overlay.call(this.editMenu)}closeEditMenu(){this.editMenu.close()}_clickBugLink(){let e=new URL("https://github.com/facebook/Rapid/issues/new");e.searchParams.append("template","bug_report.yml");let i=Os(),r=`${i.browser} v${i.version}`,s=`${i.os}`,n=navigator.userAgent;e.searchParams.append("browser",r),e.searchParams.append("os",s),e.searchParams.append("useragent",n),e.searchParams.append("URL",window.location.href),e.searchParams.append("version",this.context.version),window.open(e.toString(),"_blank")}};var I6=class extends ui{constructor(e){super(e),this.id="uploader",this.dependencies=new Set(["data","edits","l10n"]),this.changeset=null,this._origChanges=null,this._discardTags={},this._isSaving=!1,this._localGraph=null,this._remoteGraph=null,this._toCheckIDs=new Set,this._toLoadIDs=new Set,this._loadedIDs=new Set,this._conflicts=[],this._errors=[],this._initPromise=null,this._loadedSome=this._loadedSome.bind(this),this._uploadCallback=this._uploadCallback.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let r of this.dependencies)if(!this.context.systems[r])return Promise.reject(`Cannot init:  ${this.id} requires ${r}`);let e=this.context.systems.data,i=e.initAsync();return this._initPromise=i.then(()=>e.getDataAsync("discarded")).then(r=>this._discardTags=r)}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this.changeset=null,Promise.resolve()}isSaving(){return this._isSaving}save(e,i){if(this._isSaving&&!e)return;let r=this.context,s=r.services.osm;if(!s)return;if(!s.authenticated()){s.authenticate(o=>{o||this.save(e,i)});return}this._isSaving||(this._isSaving=!0,this.emit("saveStarted")),this._localGraph=null,this._remoteGraph=null,this._toCheckIDs=new Set,this._toLoadIDs=new Set,this._loadedIDs=new Set,this._conflicts=[],this._errors=[];let n=r.systems.edits;this._origChanges=n.changes(Vu(n.difference(),this._discardTags)),e||n.perform(as()),i?this._startConflictCheck():this._tryUpload()}_startConflictCheck(){let e=this.context,i=e.services.osm,r=e.systems.edits,s=r.difference().summary(),n=e.graph();this._localGraph=n,this._remoteGraph=new vn(r.base(),!0),this._toCheckIDs=new Set;for(let[o,a]of s)if(a.changeType==="modified"){let l=n.entity(o);this._toCheckIDs.add(o);for(let u of n.childNodes(l))u.version!==void 0&&this._toCheckIDs.add(u.id)}this._toLoadIDs=new Set(this._toCheckIDs),this._loadedIDs=new Set,i&&this._toLoadIDs.size?(this.emit("progressChanged",this._loadedIDs.size,this._toCheckIDs.size),i.loadMultiple(Array.from(this._toLoadIDs),this._loadedSome)):this._tryUpload()}_loadedSome(e,i){if(this._errors.length)return;let r=this.context.systems.l10n,s=this.context.services.osm;if(e){this._errors.push({msg:e.message||e.responseText,details:[r.t("save.status_code",{code:e.status})]}),this._didResultInErrors();return}let n=new Set;for(let o of i.data)if(this._remoteGraph.replace(o),this._loadedIDs.add(o.id),this._toLoadIDs.delete(o.id),!!o.visible){if(o.type==="way")for(let a of o.nodes)this._toCheckIDs.has(a)||(this._toCheckIDs.add(a),this._toLoadIDs.add(a),n.add(a));else if(o.type==="relation"&&o.isMultipolygon())for(let a of o.members)this._toCheckIDs.has(a.id)||(this._toCheckIDs.add(a.id),this._toLoadIDs.add(a.id),n.add(a.id))}this.emit("progressChanged",this._loadedIDs.size,this._toCheckIDs.size),s&&n.size?s.loadMultiple(Array.from(n),this._loadedSome):this._toLoadIDs.size||(this._detectConflicts(),this._tryUpload())}_detectConflicts(){let e=this.context.systems.l10n,i=this.context.systems.edits,r=this.context.services.osm;if(!r)return;let s=this._localGraph,n=this._remoteGraph;for(let u of this._toCheckIDs){let d=s.entity(u),m=n.entity(u);if(l(d,m))continue;let g=Y2(u,{localGraph:s,remoteGraph:n,discardTags:this._discardTags,formatUser:o,localize:e.t,strategy:"safe"});i.replace(g);let _=g.conflicts();if(!_.length)continue;let v=Y2(u,{localGraph:s,remoteGraph:n,discardTags:this._discardTags,formatUser:o,localize:e.t,strategy:"force_local"}),E=Y2(u,{localGraph:s,remoteGraph:n,discardTags:this._discardTags,formatUser:o,localize:e.t,strategy:"force_remote"}),b=e.t("save.conflict."+(m.visible?"keep_local":"restore")),T=e.t("save.conflict."+(m.visible?"keep_remote":"delete"));this._conflicts.push({id:u,name:a(d),details:_,chosen:1,choices:[{id:u,text:b,action:()=>i.replace(v)},{id:u,text:T,action:()=>i.replace(E)}]})}function o(u){return'<a href="'+r.userURL(u)+'" target="_blank">'+u+"</a>"}function a(u){return e.displayName(u.tags)||e.displayType(u.id)+" "+u.id}function l(u,d){if(u.version!==d.version)return!1;if(u.type==="way")for(let m of ss(u.nodes,d.nodes)){let g=s.hasEntity(m),_=n.hasEntity(m);if(g&&_&&g.version!==_.version)return!1}return!0}}_tryUpload(){let e=this.context,i=e.services.osm;if(i||this._errors.push({msg:"No OSM Service"}),this.changeset||this._errors.push({msg:"No OSM Changeset"}),this._conflicts.length)this._didResultInConflicts();else if(this._errors.length)this._didResultInErrors();else{let r=e.systems.edits,s=r.changes(Vu(r.difference(),this._discardTags));s.modified.length||s.created.length||s.deleted.length?(this.emit("willAttemptUpload"),i.sendChangeset(this.changeset,s,this._uploadCallback)):this._didResultInNoChanges()}}_uploadCallback(e,i){if(i&&(this.changeset=i),e)if(e.status===409)this.save(!0,!0);else{let r=this.context.systems.l10n;this._errors.push({msg:e.message||e.responseText,details:[r.t("save.status_code",{code:e.status})]}),this._didResultInErrors()}else this._didResultInSuccess()}_didResultInNoChanges(){this.emit("resultNoChanges"),this._endSave()}_didResultInErrors(){this.context.systems.edits.pop(),this.emit("resultErrors",this._errors),this._endSave()}_didResultInConflicts(){this._conflicts.sort((e,i)=>i.id.localeCompare(e.id)),this.emit("resultConflicts",this.changeset,this._conflicts,this._origChanges),this._endSave()}_didResultInSuccess(){this.context.systems.edits.clearSaved(),this.emit("resultSuccess",this.changeset),this._endSave()}_endSave(){this._isSaving=!1,this.emit("saveEnded")}cancelConflictResolution(){this.context.systems.edits.pop()}processResolvedConflicts(){let e=this.context.systems.edits;for(let i of this._conflicts)if(i.chosen===1){let r=this.context.hasEntity(i.id);if(r?.type==="way")for(let s of Ei(r.nodes))e.replace(hm(s));e.replace(hm(i.id))}this.save(!0,!1)}};var k6=class extends ui{constructor(e){super(e),this.id="urlhash",this.dependencies=new Set(["edits","l10n","map"]),this.doUpdateTitle=!0,this.titleBase="Rapid";let i=ed(window.location.hash);this._initParams=new Map(Object.entries(i)),this._initParams.has("datasets")||this._initParams.set("datasets","fbRoads,msBuildings"),this._initParams.has("disable_features")||this._initParams.set("disable_features","boundaries"),this._currParams=new Map(this._initParams),this._currHash=null,this._prevParams=null,this._startPromise=null,this._hashchange=this._hashchange.bind(this),this._updateHash=this._updateHash.bind(this),this._updateTitle=this._updateTitle.bind(this),this.deferredUpdateHash=rl(this._updateHash,500,{leading:!1}),this.deferredUpdateTitle=rl(this._updateTitle,500,{leading:!1})}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){if(this._startPromise)return this._startPromise;let e=Promise.all([this.context.systems.l10n.startAsync(),this.context.systems.edits.startAsync()]);return this._startPromise=e.then(()=>{this._started=!0,this.enable()})}resetAsync(){return Promise.resolve()}enable(){this._enabled||(this._enabled=!0,this._currHash=null,this.context.systems.edits.on("change",this.deferredUpdateTitle),this.context.on("modechange",this.deferredUpdateTitle),window.addEventListener("hashchange",this._hashchange),this._updateHash(),this._hashchange(),this._updateTitle())}disable(){this._enabled&&(this._enabled=!1,this._currHash=null,this.deferredUpdateHash.cancel(),this.deferredUpdateTitle.cancel(),this.context.systems.edits.off("change",this.deferredUpdateTitle),this.context.off("modechange",this.deferredUpdateTitle),window.removeEventListener("hashchange",this._hashchange))}get initialHashParams(){return this._initParams}getParam(e){return this._currParams.get(e)}setParam(e,i){typeof e=="string"&&(i==null||i==="undefined"||i==="null"?this._currParams.delete(e):this._currParams.set(e,i),this._enabled&&this.deferredUpdateHash())}_updateHash(){if(!this._enabled)return;let e=["comment","source","hashtags","walkthrough"],i=un(Object.fromEntries(this._currParams),e),r="#"+nr(i,!0);r!==this._currHash&&(window.history.replaceState(null,this.titleBase,r),this._currHash=r)}_updateTitle(){if(!this._enabled||!this.doUpdateTitle)return;let e=this.context,i=e.systems.l10n,s=e.systems.edits.difference().summary().size,n,o=e.selectedIDs().filter(u=>e.hasEntity(u));if(o.length){let u=i.displayLabel(e.entity(o[0]),e.graph());o.length>1?n=i.t("title.labeled_and_more",{labeled:u,count:o.length-1}):n=u}let a;s&&n?a="title.format.changes_context":s&&!n?a="title.format.changes":!s&&n&&(a="title.format.context");let l;a?l=i.t(a,{changes:s,base:this.titleBase,context:n}):l=this.titleBase,document.title!==l&&(document.title=l)}_hashchange(){if(!this._enabled)return;this._currHash=window.location.hash;let e=ed(this._currHash);this._prevParams?this._prevParams=this._currParams:this._prevParams=new Map,this._currParams=new Map(Object.entries(e)),this.emit("hashchange",new Map(this._currParams),new Map(this._prevParams))}};var dA={};p9(dA,{validationAlmostJunction:()=>FS,validationCloseNodes:()=>LS,validationCrossingWays:()=>NS,validationDisconnectedWay:()=>OS,validationDuplicateWaySegments:()=>BS,validationFormatting:()=>US,validationHelpRequest:()=>zS,validationImpossibleOneway:()=>GS,validationIncompatibleSource:()=>$S,validationMismatchedGeometry:()=>HS,validationMissingRole:()=>VS,validationMissingTag:()=>jS,validationOutdatedTags:()=>XS,validationPrivateData:()=>WS,validationSuspiciousName:()=>uA,validationUnsquareWay:()=>hA,validationYShapedConnection:()=>cA});function FS(t){let e="almost_junction",i=t.systems.l10n,r=5,s=.75,n=r-s,o=Math.atan(s/r);function a(d){return d.type==="way"&&ml[d.tags.highway]}function l(d){return d.tags.noexit==="yes"||d.tags.amenity==="parking_entrance"||d.tags.entrance&&d.tags.entrance!=="no"}let u=function(m,g){if(!a(m))return[];if(m.isDegenerate())return[];let _=t.systems.edits.tree(),v=M(m),E=[];return v.forEach($=>{E.push(new rr(t,{type:e,subtype:"highway-highway",severity:"warning",message:function(){let q=t.hasEntity(this.entityIds[0]);if(this.entityIds[0]===this.entityIds[2])return q?i.tHtml("issues.almost_junction.self.message",{feature:i.displayLabel(q,t.graph())}):"";{let W=t.hasEntity(this.entityIds[2]);return q&&W?i.tHtml("issues.almost_junction.message",{feature:i.displayLabel(q,t.graph()),feature2:i.displayLabel(W,t.graph())}):""}},reference:T,entityIds:[m.id,$.node.id,$.wid],loc:$.node.loc,hash:JSON.stringify($.node.loc),data:{midId:$.mid.id,edge:$.edge,cross_loc:$.cross_loc},dynamicFixes:b}))}),E;function b(){let $=[new Ti({icon:"rapid-icon-abutment",title:i.tHtml("issues.fix.connect_features.title"),onClick:function(){let W=i.t("issues.fix.connect_almost_junction.annotation"),[,Z,Q]=this.issue.entityIds,X=t.entity(this.issue.data.midId),ce=t.entity(Z),de=t.entity(Q),le=k(ce,de);if(le.length>0){let me=F(X,ce,le);if(me){t.perform(Xa([me.id,ce.id],me.loc),W);return}}let te=this.issue.data.edge,ee=this.issue.data.cross_loc,ie=[t.entity(te[0]),t.entity(te[1])].map(me=>me.loc),ne=_8(ie,ee);ne.distance<s?t.perform(Xa([ne.id,ce.id],ne.loc),W):t.perform(tn({loc:ee,edge:te},ce),W)}})],q=t.hasEntity(this.entityIds[1]);return q&&!q.hasInterestingTags()&&$.push(new Ti({icon:"maki-barrier",title:i.tHtml("issues.fix.tag_as_disconnected.title"),onClick:function(){let W=this.issue.entityIds[1],Z=Object.assign({},t.entity(W).tags);Z.noexit="yes",t.perform(Hr(W,Z),i.t("issues.fix.tag_as_disconnected.annotation"))}})),$}function T($){$.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.almost_junction.highway-highway.reference"))}function A($,q){let W=t.services.osm;if(W&&!W.isDataLoaded($.loc)||l($)||g.parentWays($).length!==1)return!1;let Z=0;for(let Q in q.nodes)if(q.nodes[Q]===$.id&&(Z+=1,Z>1))return!1;return!0}function M($){let q=[];if($.isClosed())return q;let W;return[0,$.nodes.length-1].forEach(Q=>{let X=$.nodes[Q],ce=g.entity(X);if(!A(ce,$))return;let de=U($,Q);de&&(W=g.childNodes($).slice(),W[Q]=W[Q].move(de.cross_loc),!zd(W,X)&&q.push(de))}),q}function k($,q){return[q.nodes[0],q.nodes[q.nodes.length-1]].map(W=>g.entity(W)).filter(W=>W.id!==$.id&&fr($.loc,W.loc)<=n)}function F($,q,W){let Z,Q=1/0;return W.forEach(X=>{let ce=t.projection.project($.loc),de=t.projection.project(q.loc),le=t.projection.project(X.loc),te=fs(ce,de)+Math.PI,ee=fs(ce,le)+Math.PI,oe=Math.max(te,ee)-Math.min(te,ee);oe<Q&&(Z=X,Q=oe)}),Q<=o?Z:null}function O($,q){return $[q]!==void 0&&$[q]!=="no"}function B($,q){if($.id===q.id)return!0;if((O($.tags,"bridge")||O(q.tags,"bridge"))&&!(O($.tags,"bridge")&&O(q.tags,"bridge"))||(O($.tags,"tunnel")||O(q.tags,"tunnel"))&&!(O($.tags,"tunnel")&&O(q.tags,"tunnel")))return!1;let W=$.tags.layer||"0",Z=q.tags.layer||"0";if(W!==Z)return!1;let Q=$.tags.level||"0",X=q.tags.level||"0";return Q===X}function U($,q){let W=$.nodes[q],Z=q===0?$.nodes[1]:$.nodes[$.nodes.length-2],Q=g.entity(W),X=g.entity(Z),ce=Q.loc[0],de=Q.loc[1],le=Cn(r,de)/2,te=kc(r)/2,ee=new mt([ce-le,de-te],[ce+le,de+te]),oe=fr(X.loc,Q.loc),ie=r/oe+1,ne=pr(X.loc,Q.loc,ie),me=_.waySegments(ee,g);for(let De=0;De<me.length;De++){let He=me[De],Je=g.entity(He.wayId);if(!a(Je)||!B($,Je))continue;let ot=He.nodes[0],gt=He.nodes[1];if(ot===W||gt===W)continue;let vt=g.entity(ot),ct=g.entity(gt),Se=Su([Q.loc,ne],[vt.loc,ct.loc]);if(Se)return{mid:X,node:Q,wid:Je.id,edge:[vt.id,ct.id],cross_loc:Se}}return null}};return u.type=e,u}function LS(t){let e="close_nodes",i=t.systems.l10n;var r=.2,s=function(n,o){if(n.type==="node")return a(n);if(n.type==="way")return d(n);return[];function a(E){var b=o.parentWays(E);return b.length?m(E,b):_(E)}function l(E){if(E.tags.boundary&&E.tags.boundary!=="no")return"boundary";if(E.tags.indoor&&E.tags.indoor!=="no")return"indoor";if(E.tags.building&&E.tags.building!=="no"||E.tags["building:part"]&&E.tags["building:part"]!=="no")return"building";if(jl[E.tags.highway])return"path";var b=o.parentRelations(E);for(var T in b){var A=b[T];if(A.tags.type==="boundary")return"boundary";if(A.isMultipolygon()){if(A.tags.indoor&&A.tags.indoor!=="no")return"indoor";if(A.tags.building&&A.tags.building!=="no"||A.tags["building:part"]&&A.tags["building:part"]!=="no")return"building"}}return"other"}function u(E){if(E.nodes.length<=2||E.isClosed()&&E.nodes.length<=4)return!1;var b=E.extent(o).bbox(),T=fr([b.minX,b.minY],[b.maxX,b.maxY]);return!(T<1.5)}function d(E){if(!u(E))return[];for(var b=[],T=o.childNodes(E),A=0;A<T.length-1;A++){var M=T[A],k=T[A+1],F=v(M,k,E);F&&b.push(F)}return b}function m(E,b){var T=[];function A(B,U,$){var q=v(B,U,$);q&&T.push(q)}for(var M=0;M<b.length;M++){var k=b[M];if(u(k))for(var F=k.nodes.length-1,O=0;O<k.nodes.length;O++)O!==0&&k.nodes[O-1]===E.id&&A(E,o.entity(k.nodes[O]),k),O!==F&&k.nodes[O+1]===E.id&&A(o.entity(k.nodes[O]),E,k)}return T}function g(E){if(!u(E))return 0;var b=l(E);return b==="boundary"?0:b==="indoor"?.01:b==="building"?.05:b==="path"?.1:.2}function _(E){for(var b=[],T=E.loc[0],A=E.loc[1],M=Cn(r,A)/2,k=kc(r)/2,F=new mt([T-M,A-k],[T+M,A+k]),O=t.systems.edits.tree().intersects(F,o),B=0;B<O.length;B++){var U=O[B];if(U.id!==E.id&&!(U.type!=="node"||U.geometry(o)!=="point")&&(U.loc===E.loc||fr(E.loc,U.loc)<r)){if("memorial:type"in E.tags&&"memorial:type"in U.tags&&E.tags["memorial:type"]==="stolperstein"&&U.tags["memorial:type"]==="stolperstein"||"memorial"in E.tags&&"memorial"in U.tags&&E.tags.memorial==="stolperstein"&&U.tags.memorial==="stolperstein")continue;var $={layer:!0,level:!0,"addr:housenumber":!0,"addr:unit":!0},q=!1;for(var W in $){var Z=E.tags[W]||"0",Q=U.tags[W]||"0";if(Z!==Q){q=!0;break}}if(q)continue;b.push(new rr(t,{type:e,subtype:"detached",severity:"warning",message:function(){var ce=t.hasEntity(this.entityIds[0]),de=t.hasEntity(this.entityIds[1]);return ce&&de?i.tHtml("issues.close_nodes.detached.message",{feature:i.displayLabel(ce,t.graph()),feature2:i.displayLabel(de,t.graph())}):""},reference:X,entityIds:[E.id,U.id],dynamicFixes:function(){return[new Ti({icon:"rapid-operation-disconnect",title:i.tHtml("issues.fix.move_points_apart.title")}),new Ti({icon:"rapid-icon-layers",title:i.tHtml("issues.fix.use_different_layers_or_levels.title")})]}}))}}return b;function X(ce){var de=i.t("issues.close_nodes.detached.reference");ce.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(de)}}function v(E,b,T){if(E.id===b.id||E.hasInterestingTags()&&b.hasInterestingTags())return null;if(E.loc!==b.loc){var A=o.parentWays(E),M=new Set(o.parentWays(b)),k=A.filter(function($){return M.has($)}),F=k.map(function($){return g($)}),O=Math.min(...F),B=fr(E.loc,b.loc);if(B>O)return null}return new rr(t,{type:e,subtype:"vertices",severity:"warning",message:function(){var $=t.hasEntity(this.entityIds[0]);return $?i.tHtml("issues.close_nodes.message",{way:i.displayLabel($,t.graph())}):""},reference:U,entityIds:[T.id,E.id,b.id],loc:E.loc,dynamicFixes:function(){return[new Ti({icon:"rapid-icon-plus",title:i.tHtml("issues.fix.merge_points.title"),onClick:function(){var $=this.issue.entityIds,q=Xa([$[1],$[2]]);t.perform(q,i.t("issues.fix.merge_close_vertices.annotation"))}}),new Ti({icon:"rapid-operation-disconnect",title:i.tHtml("issues.fix.move_points_apart.title")})]}});function U($){var q=i.t("issues.close_nodes.reference");$.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(q)}}};return s.type=e,s}function NS(t){let e="crossing_ways",i=t.systems.l10n;function r(O,B){if(u(O,B)===null)for(var U=B.parentRelations(O),$=0;$<U.length;$++){var q=U[$];if(u(q,B)!==null)return q}return O}function s(O,B){return O[B]!==void 0&&O[B]!=="no"}function n(O){return s(O,"indoor")||s(O,"level")||O.highway==="corridor"}function o(O){return O==="highway"||O==="railway"||O==="waterway"||O==="aeroway"}function a(O){return O==="highway"||O==="railway"||O==="waterway"}var l={demolished:!0,dismantled:!0,proposed:!0,razed:!0};function u(O,B){var U=O.geometry(B);if(U!=="line"&&U!=="area")return null;var $=O.tags;return $.aeroway in kI?"aeroway":s($,"building")&&!l[$.building]?"building":s($,"highway")&&ml[$.highway]?"highway":U!=="line"?null:s($,"railway")&&S9[$.railway]?"railway":s($,"waterway")&&gf[$.waterway]&&O.tags.intermittent!=="yes"?"waterway":null}function d(O,B,U,$){var q=O.level||"0",W=U.level||"0";if(n(O)&&n(U)&&q!==W)return!0;var Z=O.layer||"0",Q=U.layer||"0";if(B==="highway"&&$==="highway"&&Z!==Q)return!0;if(o(B)&&o($)){if(s(O,"bridge")&&!s(U,"bridge")||!s(O,"bridge")&&s(U,"bridge")||s(O,"bridge")&&s(U,"bridge")&&Z!==Q)return!0}else{if(o(B)&&s(O,"bridge"))return!0;if(o($)&&s(U,"bridge"))return!0}if(a(B)&&a($)){if(s(O,"tunnel")&&!s(U,"tunnel")||!s(O,"tunnel")&&s(U,"tunnel")||s(O,"tunnel")&&s(U,"tunnel")&&Z!==Q)return!0}else{if(a(B)&&s(O,"tunnel"))return!0;if(a($)&&s(U,"tunnel"))return!0}return B==="waterway"&&$==="highway"&&U.man_made==="pier"||$==="waterway"&&B==="highway"&&O.man_made==="pier"||(B==="building"||$==="building")&&Z!==Q}var m={motorway:!0,motorway_link:!0,trunk:!0,trunk_link:!0,primary:!0,primary_link:!0,secondary:!0,secondary_link:!0},g={track:!0};function _(O,B,U){var $=u(O,U),q=u(B,U),W=O.geometry(U),Z=B.geometry(U),Q=W==="line"&&Z==="line";let X=[$,q].sort().join("-");if(X==="aeroway-aeroway")return{};if(X==="aeroway-highway"){let ie=O.tags.highway==="service"||B.tags.highway==="service",ne=O.tags.highway in jl||B.tags.highway in jl;return ie||ne?{}:{aeroway:"aircraft_crossing"}}if(X==="aeroway-railway")return{aeroway:"aircraft_crossing",railway:"level_crossing"};if(X==="aeroway-waterway")return null;if($===q){if($==="highway"){var ce=jl[O.tags.highway],de=jl[B.tags.highway];if((ce||de)&&ce!==de){var le=ce?B:O;if(!Q||g[le.tags.highway])return{};var te={highway:"crossing"},ee=ce?O:B;for(let ie of["crossing","crossing:markings","crossing:signals"])ee.tags[ie]&&(te[ie]=ee.tags[ie]);return te}return{}}if($==="waterway")return{};if($==="railway")return{}}else if(X.includes("highway")){if(X.includes("railway")){if(!Q)return{};var oe=O.tags.railway==="tram"||B.tags.railway==="tram";return jl[O.tags.highway]||jl[B.tags.highway]?oe?{railway:"tram_crossing"}:{railway:"crossing"}:oe?{railway:"tram_level_crossing"}:{railway:"level_crossing"}}if(X.includes("waterway"))return s(O.tags,"tunnel")&&s(B.tags,"tunnel")||s(O.tags,"bridge")&&s(B.tags,"bridge")||m[O.tags.highway]||m[B.tags.highway]?null:Q?{ford:"yes"}:{}}return null}function v(O,B,U){var $=[];if(O.type!=="way")return $;var q=r(O,B),W=u(q,B);if(W===null)return $;var Z={},Q,X,ce,de,le,te,ee,oe,ie,ne,me,De,He,Je,ot,gt,vt,ct=B.childNodes(O),Se={};for(Q=0;Q<ct.length-1;Q++)for(de=ct[Q],le=ct[Q+1],ce=new mt([Math.min(de.loc[0],le.loc[0]),Math.min(de.loc[1],le.loc[1])],[Math.max(de.loc[0],le.loc[0]),Math.max(de.loc[1],le.loc[1])]),He=U.waySegments(ce,B),X=0;X<He.length;X++)if(Je=He[X],Je.wayId!==O.id&&!Z[Je.wayId]&&(Se[Je.wayId]=!0,ot=B.hasEntity(Je.wayId),!!ot&&(gt=r(ot,B),vt=u(gt,B),!(vt===null||d(q.tags,W,gt.tags,vt))&&(De=W==="building"||vt==="building",oe=Je.nodes[0],ie=Je.nodes[1],!(oe===de.id||oe===le.id||ie===de.id||ie===le.id)&&(te=B.hasEntity(oe),!!te&&(ee=B.hasEntity(ie),!!ee)))))){ne=[de.loc,le.loc],me=[te.loc,ee.loc];var Qe=Su(ne,me);if(Qe&&($.push({wayInfos:[{way:O,featureType:W,edge:[de.id,le.id]},{way:ot,featureType:vt,edge:[te.id,ee.id]}],crossPoint:Qe}),De)){Z[ot.id]=!0;break}}return $}function E(O,B){var U=u(O,B);return U?O.type==="way"?[O]:O.type==="relation"?O.members.reduce(function($,q){if(q.type==="way"&&(!q.role||q.role==="outer"||q.role==="inner")){var W=B.hasEntity(q.id);W&&!$.includes(W)&&$.push(W)}return $},[]):[]:[]}var b=function(B,U){var $=t.systems.edits.tree(),q=E(B,U),W=[],Z,Q,X;for(Z in q){X=v(q[Z],U,$);for(Q in X)W.push(T(X[Q],U))}return W};function T(O,B){O.wayInfos.sort(function(ie,ne){var me=ie.featureType,De=ne.featureType;return me===De?i.displayLabel(ie.way,B)>i.displayLabel(ne.way,B):me==="waterway"?!0:De==="waterway"?!1:me<De});var U=O.wayInfos.map(function(ie){return r(ie.way,B)}),$=[O.wayInfos[0].edge,O.wayInfos[1].edge],q=[O.wayInfos[0].featureType,O.wayInfos[1].featureType],W=_(U[0],U[1],B),Z=O.wayInfos[0].featureType,Q=O.wayInfos[1].featureType,X=n(U[0].tags)&&n(U[1].tags),ce=a(Z)&&s(U[0].tags,"tunnel")&&a(Q)&&s(U[1].tags,"tunnel"),de=o(Z)&&s(U[0].tags,"bridge")&&o(Q)&&s(U[1].tags,"bridge"),le=[Z,Q].sort().join("-"),te=le;X?te="indoor-indoor":ce?te="tunnel-tunnel":de&&(te="bridge-bridge"),W&&(X||ce||de)&&(te+="_connectable");var ee=""+O.crossPoint[0].toFixed(4)+","+O.crossPoint[1].toFixed(4);return new rr(t,{type:e,subtype:le,severity:"warning",message:function(){var ie=t.graph(),ne=ie.hasEntity(this.entityIds[0]),me=ie.hasEntity(this.entityIds[1]);return ne&&me?i.tHtml("issues.crossing_ways.message",{feature:i.displayLabel(ne,ie),feature2:i.displayLabel(me,ie)}):""},reference:oe,entityIds:U.map(function(ie){return ie.id}),data:{edges:$,featureTypes:q,connectionTags:W},hash:ee,loc:O.crossPoint,autoArgs:W&&!W.ford&&M(O.crossPoint,$,W),dynamicFixes:function(){var ie=t.selectedIDs();if(t.mode?.id!=="select-osm"||ie.length!==1)return[];var ne=this.entityIds[0]===ie[0]?0:1,me=this.data.featureTypes[ne],De=this.data.featureTypes[ne===0?1:0],He=[];if(W&&He.push(k(this.data.connectionTags)),X)He.push(new Ti({icon:"rapid-icon-layers",title:i.tHtml("issues.fix.use_different_levels.title")}));else if(ce||de||Z==="building"||Q==="building")He.push(F("higher")),He.push(F("lower"));else if(t.graph().geometry(this.entityIds[0])==="line"&&t.graph().geometry(this.entityIds[1])==="line"){o(me)&&me!=="waterway"&&He.push(A("add_a_bridge","temaki-bridge","bridge"));var Je=De==="waterway"&&me!=="waterway";a(me)&&!Je&&He.push(A("add_a_tunnel","temaki-tunnel","tunnel"))}return He.push(new Ti({icon:"rapid-operation-move",title:i.tHtml("issues.fix.reposition_features.title")})),He}});function oe(ie){ie.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.crossing_ways."+te+".reference"))}}function A(O,B,U){return new Ti({icon:B,title:i.tHtml("issues.fix."+O+".title"),onClick:function(){if(t.mode?.id==="select-osm"){var $=t.selectedIDs();if($.length===1){var q=$[0];if(t.hasEntity(q)){var W=[q],Z,Q,X;this.issue.entityIds[0]===q?(Z=this.issue.data.edges[0],Q=this.issue.data.edges[1],X=this.issue.entityIds[1]):(Z=this.issue.data.edges[1],Q=this.issue.data.edges[0],X=this.issue.entityIds[0]);var ce=this.issue.loc,de=t.projection,le=function(ee){var oe=[ee.entity(Z[0]),ee.entity(Z[1])],ie=ee.hasEntity(X),ne=ie&&ie.tags.width&&parseFloat(ie.tags.width);ne||(ne=ie&&ie.impliedLineWidthMeters()),ne?u(ie,ee)==="railway"&&(ne*=2):ne=8;var me=fs(de.project(oe[0].loc),de.project(oe[1].loc))+Math.PI,De=fs(de.project(ee.entity(Q[0]).loc),de.project(ee.entity(Q[1]).loc))+Math.PI,He=Math.max(me,De)-Math.min(me,De);He>Math.PI&&(He-=Math.PI),ne=ne/2/Math.sin(He)*2,ne+=4,ne=Math.min(Math.max(ne,4),50);function Je(Ie){return[Y3(Ie[0],Ie[1]),Qb(Ie[1])]}function ot(Ie){var nt=kc(Ie[1]);return[Cn(Ie[0],nt),nt]}var gt=Je(oe[0].loc),vt=Je(oe[1].loc),ct=fs(gt,vt),Se=Je(ce),Qe=Hi(gt,vt)/fr(oe[0].loc,oe[1].loc);function xt(Ie,nt){var ht=nt*Qe;return ot([Se[0]+Math.cos(Ie)*ht,Se[1]+Math.sin(Ie)*ht])}var It=function(Ie){return xt(ct,Ie)},Gt=function(Ie){return xt(ct+Math.PI,Ie)},Ni=.55;function je(Ie,nt,ht){var Ht,hi=ne/2,at=fr(ce,nt.loc);if(at-hi>Ni){var Ot=ht(hi);Ht=vi(),ee=tn({loc:Ot,edge:Ie},Ht)(ee)}else{var Pt=0;if(nt.parentIntersectionWays(ee).forEach(function(dt){dt.nodes.forEach(function(Lt){Lt===nt.id&&(nt.id===dt.first()&&nt.id!==dt.last()||nt.id===dt.last()&&nt.id!==dt.first()?Pt+=1:Pt+=2)})}),Pt>=3){var Zi=at-Ni;if(Zi>Ni){var ji=ht(Zi);Ht=vi(),ee=tn({loc:ji,edge:Ie},Ht)(ee)}}}Ht||(Ht=nt);var Ke=ju([Ht.id]).limitWays(W);return ee=Ke(ee),Ke.getCreatedWayIDs().length&&W.push(Ke.getCreatedWayIDs()[0]),Ht}var be=je(Z,oe[1],It),ge=je([oe[0].id,be.id],oe[0],Gt),xe=W.map(function(Ie){return ee.entity(Ie)}).find(function(Ie){return Ie.nodes.includes(be.id)&&Ie.nodes.includes(ge.id)}),Pe=Object.assign({},xe.tags);if(U==="bridge")Pe.bridge="yes",Pe.layer="1";else{var Oe="yes";u(xe,ee)==="waterway"&&(Oe="culvert"),Pe.tunnel=Oe,Pe.layer="-1"}return ee=Hr(xe.id,Pe)(ee),ee};t.perform(le,i.t(`issues.fix.${O}.annotation`)),t.enter("select-osm",{selectedIDs:W})}}}}})}function M(O,B,U){var $=function(W){var Z=!1,Q=vi({loc:O,tags:U}),X=W.replace(Q),ce=[Q.id],de=.75;return B.forEach(function(le){var te=X.hasEntity(le[0]),ee=X.hasEntity(le[1]);if(!(!te||!ee)){var oe=!1,ie=[te,ee],ne=_8([te.loc,ee.loc],O);if(ne&&ne.distance<de){var me=ie[ne.index];(!me.hasInterestingTags()||me.isCrossing())&&(oe=!0,ce.push(me.id))}oe||(X=tn({loc:O,edge:le},Q)(X),Z=!0)}}),ce.length>1&&(X=Xa(ce,O)(X),Z=!0),Z?X:W};return[$,i.t("issues.fix.connect_crossing_features.annotation")]}function k(O){var B="connect_features";return O.ford&&(B="connect_using_ford"),new Ti({icon:"rapid-icon-crossing",title:i.tHtml(`issues.fix.${B}.title`),onClick:function(){var U=this.issue.loc,$=this.issue.data.edges,q=this.issue.data.connectionTags,W=M(U,$,q);t.perform(W[0],W[1])}})}function F(O){return new Ti({icon:"rapid-icon-"+(O==="higher"?"up":"down"),title:i.tHtml(`issues.fix.tag_this_as_${O}.title`),onClick:function(){if(t.mode?.id==="select-osm"){var B=t.selectedIDs();if(B.length===1){var U=B[0];if(this.issue.entityIds.some(function(Z){return Z===U})){var $=t.hasEntity(U);if($){var q=Object.assign({},$.tags),W=q.layer&&Number(q.layer);W&&!isNaN(W)?O==="higher"?W+=1:W-=1:O==="higher"?W=1:W=-1,q.layer=W.toString(),t.perform(Hr($.id,q),i.t("operations.change_tags.annotation"))}}}}}})}return b.type=e,b}function OS(t){let e="disconnected_way",i=t.systems.l10n;function r(n){return ml[n.tags.highway]}let s=function(o,a){let l=m(o);if(!l)return[];return[new rr(t,{type:e,subtype:"highway",severity:"warning",message:function(){let b=this.entityIds.length&&t.hasEntity(this.entityIds[0]),T=b&&i.displayLabel(b,t.graph());return i.tHtml("issues.disconnected_way.routable.message",{count:this.entityIds.length,highway:T})},reference:d,entityIds:Array.from(l).map(b=>b.id),dynamicFixes:u})];function u(){let b=this.entityIds.length===1&&t.hasEntity(this.entityIds[0]),T=[];if(b){if(b.type==="way"&&!b.isClosed()){let A=E(b.first(),"start");A&&T.push(A);let M=E(b.last(),"end");M&&T.push(M)}T.length||T.push(new Ti({title:i.tHtml("issues.fix.connect_feature.title")})),T.push(new Ti({icon:"rapid-operation-delete",title:i.tHtml("issues.fix.delete_feature.title"),entityIds:[b.id],onClick:function(){let A=this.issue.entityIds[0],M=ra(t,[A]);M.disabled()||M()}}))}else T.push(new Ti({title:i.tHtml("issues.fix.connect_features.title")}));return T}function d(b){b.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.disconnected_way.routable.reference"))}function m(b){let T=new Set,A=[];function M(k){for(let F of a.parentWays(k))!T.has(F)&&v(F,!1)&&(T.add(F),A.push(F))}if(b.type==="way"&&v(b,!0))T.add(b),A.push(b);else if(b.type==="node"&&_(b))T.add(b),M(b);else return null;for(;A.length;){let k=A.pop();for(let F of a.childNodes(k)){if(g(F))return null;_(F)&&T.add(F),M(F)}}return T}function g(b){let T=t.services.osm;return!!(T&&!T.isDataLoaded(b.loc)||b.tags.entrance&&b.tags.entrance!=="no"||b.tags.amenity==="parking_entrance")}function _(b){return b.tags.highway==="elevator"}function v(b,T){return r(b)||b.tags.route==="ferry"?!0:a.parentRelations(b).some(A=>!!(A.tags.type==="route"&&A.tags.route==="ferry"||A.isMultipolygon()&&r(A)&&(!T||A.memberById(b.id).role!=="inner")))}function E(b,T){let A=a.hasEntity(b);if(!A||A.tags.noexit==="yes")return null;let M=i.isRTL(),k=T==="start"&&!M||T==="end"&&M;return new Ti({icon:"rapid-operation-continue"+(k?"-left":""),title:i.tHtml(`issues.fix.continue_from_${T}.title`),entityIds:[b],onClick:function(){let F=this.issue.entityIds[0],O=t.hasEntity(F),B=this.entityIds[0],U=t.hasEntity(B);if(!O||!U)return;let $=t.systems.map;(!t.editable()||!$.trimmedExtent().contains(new mt(U.loc)))&&$.fitEntitiesEase(U),t.enter("draw-line",{continueWay:O,continueNode:U})}})}};return s.type=e,s}function BS(t){let e="duplicate_way_segments",i=t.systems.l10n,r=function(s,n){if(s.type==="way")return u(s);return[];function o(m){return m==="highway"||m==="railway"||m==="waterway"}function a(m){return m.isArea()?!1:Object.keys(m.tags).some(o)}function l(m,g,_){let v=n.childNodes(_),E=v.findIndex(T=>T.id===m.id),b=v.findIndex(T=>T.id===g.id);return Math.abs(E-b)===1}function u(m){let g=[];if(!a(m))return g;let _=n.childNodes(m);for(let v=0;v<_.length-1;v++){let E=_[v],b=_[v+1],T=d(E,b,m);T&&g.push(T)}return g}function d(m,g,_){if(m.id===g.id)return null;if(m.loc!==g.loc){let E=n.parentWays(m),b=new Set(n.parentWays(g));if(E.filter(k=>b.has(k)).filter(k=>a(k)).filter(k=>l(m,g,k)).length<=1)return null}return new rr(t,{type:e,subtype:"vertices",severity:"warning",message:function(){let E=t.hasEntity(this.entityIds[0]);return E?i.tHtml("issues.duplicate_way_segments.message",{way:i.displayLabel(E,t.graph())}):""},reference:v,entityIds:[_.id,m.id,g.id],loc:m.loc,dynamicFixes:function(){return[new Ti({icon:"rapid-icon-plus",title:i.tHtml("issues.fix.merge_points.title")}),new Ti({icon:"rapid-operation-delete",title:i.tHtml("issues.fix.remove_way_segments.title")}),new Ti({icon:"rapid-operation-disconnect",title:i.tHtml("issues.fix.move_way_segments_apart.title")})]}});function v(E){E.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.t("issues.duplicate_way_segments.reference"))}}};return r.type=e,r}function US(t){let e="invalid_format",i=t.systems.l10n,r=function(s){let n=[];function o(l){return!l||/^[^\(\)\\,":;<>@\[\]]+@[^\(\)\\,":;<>@\[\]\.]+(?:\.[a-z0-9-]+)*$/i.test(l)}function a(l){l.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.invalid_format.email.reference"))}if(s.tags.email){let l=s.tags.email.split(";").map(u=>u.trim()).filter(u=>!o(u));l.length&&n.push(new rr(t,{type:e,subtype:"email",severity:"warning",message:function(){let u=t.hasEntity(this.entityIds[0]);return u?i.tHtml("issues.invalid_format.email.message"+this.data,{feature:i.displayLabel(u,t.graph()),email:l.join(", ")}):""},reference:a,entityIds:[s.id],hash:l.join(),data:l.length>1?"_multi":""}))}return n};return r.type=e,r}function zS(t){let e="help_request",i=t.systems.l10n,r=function(n){if(!n.tags.fixme)return[];if(n.version===void 0)return[];if(n.v!==void 0){let a=t.systems.edits.base().hasEntity(n.id);if(!a||!a.tags.fixme)return[]}return[new rr(t,{type:e,subtype:"fixme_tag",severity:"warning",message:function(){let a=t.hasEntity(this.entityIds[0]);return a?i.tHtml("issues.fixme_tag.message",{feature:i.displayLabel(a,t.graph(),!0)}):""},dynamicFixes:()=>[new Ti({title:i.tHtml("issues.fix.address_the_concern.title")})],reference:o,entityIds:[n.id]})];function o(a){a.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.fixme_tag.reference"))}};return r.type=e,r}function GS(t){let e="impossible_oneway",i=t.systems.l10n,r=function(o,a){if(o.type!=="way"||o.geometry(a)!=="line")return[];if(o.isClosed())return[];if(!d(o))return[];if(!o.isOneWay())return[];if(o.tags.intermittent==="yes")return[];let l=_(o,o.first()),u=_(o,o.last());return l.concat(u);function d(v){return v.geometry(a)!=="line"?null:ml[v.tags.highway]?"highway":gf[v.tags.waterway]?"waterway":null}function m(v,E){return v.nodes.indexOf(E)!==v.nodes.lastIndexOf(E)}function g(v,E){let b=d(v);if(b==="highway"){if(E.tags.entrance&&E.tags.entrance!=="no"||E.tags.amenity==="parking_entrance")return!0}else if(b==="waterway"){if(E.id===v.first()){if(E.tags.natural==="spring")return!0}else if(E.tags.manhole==="drain")return!0}return a.parentWays(E).some(T=>T.id===v.id?!1:b==="highway"?T.geometry(a)==="area"&&ml[T.tags.highway]||T.tags.route==="ferry"?!0:a.parentRelations(T).some(A=>A.tags.type==="route"&&A.tags.route==="ferry"?!0:A.isMultipolygon()&&ml[A.tags.highway]):b==="waterway"&&(T.tags.natural==="water"||T.tags.natural==="coastline"))}function _(v,E){let b=E===v.first(),T=d(v);if(m(v,E))return[];let A=t.services.osm;if(!A)return[];let M=a.hasEntity(E);if(!M||!A.isDataLoaded(M.loc))return[];if(g(v,M))return[];let k=a.parentWays(M).filter(q=>q.id===v.id?!1:d(q)===T);if(T==="waterway"&&k.length===0)return[];let F=k.filter(q=>q.isOneWay());if(F.length<k.length)return[];if(F.length&&F.some(W=>!!((b?W.first():W.last())!==E||m(W,E))))return[];let O=b?"start":"end",B,U;return T==="waterway"?(B=`${T}.connected.${O}`,U=`${T}.connected`):(B=`${T}.${O}`,U=`${T}.${O}`),[new rr(t,{type:e,subtype:T,severity:"warning",message:function(){let q=t.hasEntity(this.entityIds[0]);return q?i.tHtml(`issues.impossible_oneway.${B}.message`,{feature:i.displayLabel(q,t.graph())}):""},reference:$(U),entityIds:[v.id,M.id],dynamicFixes:function(){let q=[];if(F.length&&q.push(new Ti({icon:"rapid-operation-reverse",title:i.tHtml("issues.fix.reverse_feature.title"),entityIds:[v.id],onClick:function(){let W=this.issue.entityIds[0];t.perform(pl(W),i.t("operations.reverse.annotation.line",{n:1}))}})),M.tags.noexit!=="yes"){let W=i.isRTL(),Z=b&&!W||!b&&W;q.push(new Ti({icon:"rapid-operation-continue"+(Z?"-left":""),title:i.tHtml("issues.fix.continue_from_"+(b?"start":"end")+".title"),onClick:function(){let Q=this.issue.entityIds[0],X=this.issue.entityIds[1],ce=t.entity(Q),de=t.entity(X);s(ce,de,t)}}))}return q},loc:M.loc})];function $(q){return function(Z){Z.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml(`issues.impossible_oneway.${q}.reference`))}}}};function s(n,o,a){let l=a.systems.map;(!a.editable()||!l.trimmedExtent().contains(new mt(o.loc)))&&l.fitEntitiesEase(o),a.enter("draw-line",{continueWay:n,continueNode:o})}return r.type=e,r}function $S(t){let e="incompatible_source",i=t.systems.l10n,r=[{id:"amap",regex:/(amap|autonavi|mapabc|)/i},{id:"baidu",regex:/(baidu|mapbar|)/i},{id:"google",regex:/google/i,exceptRegex:/((books|drive)\.google|google\s?(books|drive|plus))|(esri\/Google_Africa_Buildings)/i}],s=function(o){let a=o.tags&&o.tags.source&&o.tags.source.split(";");if(!a)return[];let l=o.id;return a.map(d=>{let m=r.find(g=>!(!g.regex.test(d)||g.exceptRegex&&g.exceptRegex.test(d)));return m?new rr(t,{type:e,severity:"warning",message:()=>{let g=t.hasEntity(l);return g?i.tHtml("issues.incompatible_source.feature.message",{feature:i.displayLabel(g,t.graph(),!0),value:d}):""},reference:u(m.id),entityIds:[l],hash:d,dynamicFixes:()=>[new Ti({title:i.tHtml("issues.fix.remove_proprietary_data.title")})]}):null}).filter(Boolean);function u(d){return function(g){g.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml(`issues.incompatible_source.reference.${d}`))}}};return s.type=e,s}var NO=Xi($2(),1);function HS(t){let e="mismatched_geometry",i=t.systems.l10n,r=t.systems.presets;function s(_){if(_.type!=="way"||_.isClosed())return null;var v=_.tagSuggestingArea();if(!v)return null;var E=r.matchTags(v,"line"),b=r.matchTags(v,"area");return E&&b&&E===b?null:v}function n(_,v){if(_.nodes.length<3)return null;var E=v.childNodes(_),b,T=fr(E[0].loc,E[E.length-1].loc);if(T<.75&&(b=E.slice(),b.pop(),b.push(b[0]),!zd(b,b[0].id)))return function(){var A=t.entity(this.issue.entityIds[0]);t.perform(Xa([A.nodes[0],A.nodes[A.nodes.length-1]],E[0].loc),i.t("issues.fix.connect_endpoints.annotation"))};if(b=E.slice(),b.push(b[0]),!zd(b,b[0].id))return function(){var A=this.issue.entityIds[0],M=t.entity(A),k=M.nodes[0],F=M.nodes.length;t.perform(xo(A,k,F),i.t("issues.fix.connect_endpoints.annotation"))}}function o(_){var v=s(_);if(!v)return null;return new rr(t,{type:e,subtype:"area_as_line",severity:"warning",message:function(){var b=t.hasEntity(this.entityIds[0]);return b?i.tHtml("issues.tag_suggests_area.message",{feature:i.displayLabel(b,"area",!0),tag:AI({tags:v})}):""},reference:E,entityIds:[_.id],hash:JSON.stringify(v),dynamicFixes:function(){var b=[],T=t.entity(this.entityIds[0]),A=n(T,t.graph());return b.push(new Ti({title:i.tHtml("issues.fix.connect_endpoints.title"),onClick:A})),b.push(new Ti({icon:"rapid-operation-delete",title:i.tHtml("issues.fix.remove_tag.title"),onClick:function(){var M=this.issue.entityIds[0],k=t.entity(M),F=Object.assign({},k.tags);for(var O in v)delete F[O];t.perform(Hr(M,F),i.t("issues.fix.remove_tag.annotation"))}})),b}});function E(b){b.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.tag_suggests_area.reference"))}}function a(_,v){if(_.type!=="node"||Object.keys(_.tags).length===0||_.isOnAddressLine(v))return null;var E=_.geometry(v),b=C1(_.tags);return E==="point"&&!b.point&&b.vertex?new rr(t,{type:e,subtype:"vertex_as_point",severity:"warning",message:function(){var T=t.hasEntity(this.entityIds[0]);return T?i.tHtml("issues.vertex_as_point.message",{feature:i.displayLabel(T,"vertex",!0)}):""},reference:function(A){A.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.vertex_as_point.reference"))},entityIds:[_.id]}):E==="vertex"&&!b.vertex&&b.point?new rr(t,{type:e,subtype:"point_as_vertex",severity:"warning",message:function(){var T=t.hasEntity(this.entityIds[0]);return T?i.tHtml("issues.point_as_vertex.message",{feature:i.displayLabel(T,"point",!0)}):""},reference:function(A){A.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.point_as_vertex.reference"))},entityIds:[_.id],dynamicFixes:d}):null}function l(_,v){if(!_.hasInterestingTags()||_.type!=="node"&&_.type!=="way"||_.type==="node"&&_.isOnAddressLine(v))return null;var E=_.geometry(v),b=_.type==="way"?["point","vertex"]:["line","area"];E==="area"&&b.unshift("line");var T=r.match(_,v),A=b.find(O=>{var B=r.matchTags(_.tags,O);if(!T||!B||T===B||(0,NO.default)(T.tags,B.tags)||B.isFallback())return!1;var U=Object.keys(B.tags)[0];return U==="building"||B.tags[U]==="*"?!1:T.isFallback()||T.tags[U]==="*"});if(!A)return null;var M=A+"_as_"+E;A==="vertex"&&(A="point"),E==="vertex"&&(E="point");var k=A+"_as_"+E,F;return A==="point"?F=d:E==="area"&&A==="line"&&(F=u),new rr(t,{type:e,subtype:M,severity:"warning",message:function(){var O=t.hasEntity(this.entityIds[0]);return O?i.tHtml("issues."+k+".message",{feature:i.displayLabel(O,A,!0)}):""},reference:function(B){B.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.mismatched_geometry.reference"))},entityIds:[_.id],dynamicFixes:F})}function u(){var _,v=this.entityIds[0],E=t.entity(v),b=Object.assign({},E.tags);return delete b.area,A1(b)||(_=function(){var T=this.issue.entityIds[0],A=t.entity(T),M=Object.assign({},A.tags);M.area&&delete M.area,t.perform(Hr(T,M),i.t("issues.fix.convert_to_line.annotation"))}),[new Ti({icon:"rapid-icon-line",title:i.tHtml("issues.fix.convert_to_line.title"),onClick:_})]}function d(){var _=this.entityIds[0],v=null;return t.hasHiddenConnections(_)||(v=function(){var E=this.issue.entityIds[0],b=z2(E,t.projection);t.perform(b,i.t("operations.extract.annotation",{n:1})),t.enter("select-osm",{selectedIDs:[b.getExtractedNodeID()]})}),[new Ti({icon:"rapid-operation-extract",title:i.tHtml("issues.fix.extract_point.title"),onClick:v})]}function m(_,v){if(_.type!=="relation"||!_.isMultipolygon()||_.isDegenerate()||!_.isComplete(v))return[];var E=xa(_.members,v),b=[];for(var T in E){var A=E[T];if(A.nodes){var M=A.nodes[0],k=A.nodes[A.nodes.length-1];if(M!==k){var F=new rr(t,{type:e,subtype:"unclosed_multipolygon_part",severity:"warning",message:function(){var B=t.hasEntity(this.entityIds[0]);return B?i.tHtml("issues.unclosed_multipolygon_part.message",{feature:i.displayLabel(B,t.graph(),!0)}):""},reference:O,loc:A.nodes[0].loc,entityIds:[_.id],hash:A.map(function(B){return B.id}).join()});b.push(F)}}}return b;function O(B){B.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.unclosed_multipolygon_part.reference"))}}var g=function(v,E){var b=a(v,E);if(b)return[b];var T=o(v);if(T)return[T];var A=l(v,E);return A?[A]:m(v,E)};return g.type=e,g}function VS(t){let e="missing_role",i=t.systems.l10n,r=function(l,u){let d=[];if(l.type==="way")for(let m of u.parentRelations(l)){if(!m.isMultipolygon())continue;let g=m.memberById(l.id);g&&s(g)&&d.push(n(l,m,g))}else if(l.type==="relation"&&l.isMultipolygon())for(let m of l.indexedMembers()){let g=u.hasEntity(m.id);g&&s(m)&&d.push(n(g,l,m))}return d};function s(a){return!a.role||!a.role.trim().length}function n(a,l,u){return new rr(t,{type:e,severity:"warning",message:function(){let m=t.hasEntity(this.entityIds[1]),g=t.hasEntity(this.entityIds[0]);return m&&g?i.tHtml("issues.missing_role.message",{member:i.displayLabel(m,t.graph()),relation:i.displayLabel(g,t.graph())}):""},reference:d,entityIds:[l.id,a.id],data:{member:u},hash:u.index.toString(),dynamicFixes:function(){return[o("inner"),o("outer"),new Ti({icon:"rapid-operation-delete",title:i.tHtml("issues.fix.remove_from_relation.title"),onClick:()=>{t.perform(rh(this.issue.entityIds[0],this.issue.data.member.index),i.t("operations.delete_member.annotation",{n:1}))}})]}});function d(m){m.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.missing_role.multipolygon.reference"))}}function o(a){return new Ti({title:i.tHtml(`issues.fix.set_as_${a}.title`),onClick:()=>{let l=this.issue.data.member,u={id:this.issue.entityIds[1],type:l.type,role:a};t.perform(ih(this.issue.entityIds[0],u,l.index),i.t("operations.change_role.annotation",{n:1}))}})}return r.type=e,r}function jS(t){let e="missing_tag",i=t.systems.l10n;function r(a,l){let u=["description","name","note","start_date"],d=Object.keys(a.tags).filter(m=>m==="area"||!Do(m)?!1:!u.some(g=>m===g||m.indexOf(g+":")===0));return a.type==="relation"&&d.length===1&&a.tags.type==="multipolygon"?O2(a,l):d.length>0}function s(a){return a.type==="way"&&a.tags.highway==="road"}function n(a){return a.type==="relation"&&!a.tags.type}let o=function(l,u){let d=t.services.osm,m=l.type==="node"&&d&&!d.isDataLoaded(l.loc),g;if(!m&&l.geometry(u)!=="vertex"&&!l.hasParentRelations(u)&&(Object.keys(l.tags).length===0?g="any":r(l,u)?n(l)&&(g="relation_type"):g="descriptive"),!g&&s(l)&&(g="highway_classification"),!g)return[];let _=g==="highway_classification"?"unknown_road":`missing_tag.${g}`,v=g==="highway_classification"?"unknown_road":"missing_tag",b=(l.version===void 0||l.v!==void 0)&&g!=="highway_classification"?"error":"warning";return[new rr(t,{type:e,subtype:g,severity:b,message:function(){let A=t.hasEntity(this.entityIds[0]);return A?i.tHtml(`issues.${_}.message`,{feature:i.displayLabel(A,t.graph())}):""},reference:T,entityIds:[l.id],dynamicFixes:function(){let A=[],M=g==="highway_classification"?"select_road_type":"select_preset";A.push(new Ti({icon:"rapid-icon-search",title:i.tHtml(`issues.fix.${M}.title`),onClick:function(){t.systems.ui.sidebar.showPresetList()}}));let k=this.entityIds[0],O=ra(t,[k]).disabled(),B;return O||(B=function(){let U=this.issue.entityIds[0],$=ra(t,[U]);$.disabled()||$()}),A.push(new Ti({icon:"rapid-operation-delete",title:i.tHtml("issues.fix.delete_feature.title"),disabledReason:O?i.t(`operations.delete.${O}.single`):void 0,onClick:B})),A}})];function T(A){A.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml(`issues.${v}.reference`))}};return o.type=e,o}function XS(t){let e="outdated_tags",i=t.systems.l10n,r=t.systems.presets,s=!0,n;t.systems.data.getDataAsync("deprecated").then(d=>n=d).catch(()=>{}).finally(()=>s=!1);function a(d,m){if(!d.hasInterestingTags())return[];let g=r.match(d,m);if(!g)return[];let _=Object.assign({},d.tags),v="deprecated_tags";if(g.replacement){let Z=r.item(g.replacement);m=ja(d.id,g,Z,!0)(m),d=m.entity(d.id),g=Z}if(n){let Z=d.deprecatedTags(n);Z.length&&(Z.forEach(Q=>{m=Lg(d.id,Q.old,Q.replace)(m)}),d=m.entity(d.id))}let E=Object.assign({},d.tags);g.tags!==g.addTags&&Object.keys(g.addTags).forEach(Z=>{E[Z]||(g.addTags[Z]==="*"?E[Z]="yes":E[Z]=g.addTags[Z])});let b=t.services.nsi,T=!1,A;if(b&&(T=b.status==="loading",!T)){let Z=d.extent(m).center();A=b.upgradeTags(E,Z),A&&(E=A.newTags,v="noncanonical_brand")}let M=[];M.provisional=s||T;let k=ff(_,E);if(!k.length)return M;let F=k.every(Z=>Z.type==="+"),O="";A?O="noncanonical_brand.":v==="deprecated_tags"&&F&&(v="incomplete_tags",O="incomplete.");let B=[U,i.t("issues.fix.upgrade_tags.annotation")];return M.push(new rr(t,{type:e,subtype:v,severity:"warning",message:q,reference:W,entityIds:[d.id],hash:d3(JSON.stringify(k)),autoArgs:B,dynamicFixes:()=>{let Z=[new Ti({autoArgs:B,title:i.tHtml("issues.fix.upgrade_tags.title"),onClick:()=>{t.perform(U,i.t("issues.fix.upgrade_tags.annotation"))}})],Q=A?.matched;return Q&&Z.push(new Ti({title:i.tHtml("issues.fix.tag_as_not.title",{name:Q.displayName}),onClick:()=>{t.perform($,i.t("issues.fix.tag_as_not.annotation"))}})),Z}})),M;function U(Z){let Q=Z.hasEntity(d.id);if(!Q)return Z;let X=Object.assign({},Q.tags);return k.forEach(ce=>{ce.type==="-"?delete X[ce.key]:ce.type==="+"&&(X[ce.key]=ce.newVal)}),Hr(Q.id,X)(Z)}function $(Z){let Q=Z.hasEntity(d.id);if(!Q)return Z;let X=A?.matched;if(!X)return Z;let ce=Object.assign({},Q.tags),de=X.mainTag,le=`not:${de}`,te=X.tags[de];if(ce[le]=te,ce[de]===te){let ee=X.mainTag.replace("wikidata","wikipedia");delete ce[de],delete ce[ee]}return Hr(Q.id,ce)(Z)}function q(){let Z=t.hasEntity(d.id);if(!Z)return"";let Q=`issues.outdated_tags.${O}message`;return v==="noncanonical_brand"&&F&&(Q+="_incomplete"),i.tHtml(Q,{feature:i.displayLabel(Z,t.graph(),!0)})}function W(Z){let Q=Z.selectAll(".issue-reference").data([0]).enter();Q.append("div").attr("class","issue-reference").html(i.tHtml(`issues.outdated_tags.${O}reference`)),Q.append("strong").html(i.tHtml("issues.suggested")),Q.append("table").attr("class","tagDiff-table").selectAll(".tagDiff-row").data(k).enter().append("tr").attr("class","tagDiff-row").append("td").attr("class",X=>`tagDiff-cell tagDiff-cell-${X.type==="+"?"add":"remove"}`).html(X=>X.display)}}function l(d,m){let g,_;if(d.type==="relation")_=O2(d,m),g=d;else if(d.type==="way")g=B2(d,m),_=d;else return[];if(!g||!_)return[];return[new rr(t,{type:e,subtype:"old_multipolygon",severity:"warning",message:E,reference:b,entityIds:[_.id,g.id],autoArgs:[v,i.t("issues.fix.move_tags.annotation")],dynamicFixes:()=>[new Ti({title:i.t("issues.fix.move_tags.title"),onClick:()=>{t.perform(v,i.t("issues.fix.move_tags.annotation"))}})]})];function v(T){let A=T.hasEntity(g.id),M=T.hasEntity(_.id);return!A||!M?T:(A=A.mergeTags(M.tags),T=T.replace(A),Hr(M.id,{})(T))}function E(){let T=t.hasEntity(g.id);return T?i.tHtml("issues.old_multipolygon.message",{multipolygon:i.displayLabel(T,t.graph(),!0)}):""}function b(T){T.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.old_multipolygon.reference"))}}let u=function(m,g){let _=l(m,g);return _.length||(_=a(m,g)),_};return u.type=e,u}function WS(t){let e="private_data",i=t.systems.l10n,r=new Set(["detached","farm","house","houseboat","residential","semidetached_house","static_caravan"]),s=new Set(["amenity","craft","historic","leisure","office","shop","tourism"]),n=new Set(["contact:email","contact:fax","contact:phone","email","fax","phone"]),o=function(l){let u=l.tags;if(!u.building||!r.has(u.building))return[];let d={};for(let[b,T]of Object.entries(u)){if(s.has(b))return[];n.has(b)||(d[b]=T)}let m=ff(u,d);if(!m.length)return[];let g=m.length===1?"remove_tag":"remove_tags";return[new rr(t,{type:e,severity:"warning",message:v,reference:E,entityIds:[l.id],dynamicFixes:()=>[new Ti({icon:"rapid-operation-delete",title:i.tHtml(`issues.fix.${g}.title`),onClick:function(){t.perform(_,i.t("issues.fix.upgrade_tags.annotation"))}})]})];function _(b){let T=b.hasEntity(l.id);if(!T)return b;let A=Object.assign({},T.tags);for(let M of m)M.type==="-"?delete A[M.key]:M.type==="+"&&(A[M.key]=M.newVal);return Hr(T.id,A)(b)}function v(){let b=t.hasEntity(this.entityIds[0]);return b?i.tHtml("issues.private_data.contact.message",{feature:i.displayLabel(b,t.graph())}):""}function E(b){let T=b.selectAll(".issue-reference").data([0]).enter();T.append("div").attr("class","issue-reference").html(i.tHtml("issues.private_data.reference")),T.append("strong").html(i.tHtml("issues.suggested")),T.append("table").attr("class","tagDiff-table").selectAll(".tagDiff-row").data(m).enter().append("tr").attr("class","tagDiff-row").append("td").attr("class",A=>`tagDiff-cell tagDiff-cell-${A.type==="+"?"add":"remove"}`).html(A=>A.display)}};return o.type=e,o}var lA={};p9(lA,{operationCircularize:()=>qS,operationContinue:()=>YS,operationCopy:()=>M6,operationCycleHighwayTag:()=>ZS,operationDelete:()=>ra,operationDisconnect:()=>QS,operationDowngrade:()=>P6,operationExtract:()=>KS,operationMerge:()=>JS,operationMove:()=>eA,operationOrthogonalize:()=>tA,operationPaste:()=>R6,operationReflectLong:()=>rA,operationReflectShort:()=>iA,operationReverse:()=>sA,operationRotate:()=>nA,operationSplit:()=>oA,operationStraighten:()=>aA});function qS(t,e){let i=e.length===1?"single":"multiple",r=e.map(d=>t.hasEntity(d)).filter(Boolean),s=r.every(d=>d.isNew()),n=Ar(r,t.graph()),o=r.map(l).filter(Boolean),a=ns(e,t.graph()).map(d=>d.loc);function l(d){return d.type!=="way"||new Set(d.nodes).size<=1?null:Sg(d.id,t.projection)}let u=function(){if(!o.length)return;let d=function(m,g){return o.forEach(_=>{_.disabled(m)||(m=_(m,g))}),m};d.transitionable=!0,t.perform(d,u.annotation()),window.setTimeout(()=>t.systems.validator.validate(),300)};return u.available=function(){return o.length&&e.length===o.length},u.disabled=function(){if(!o.length)return"";let d=o.map(_=>_.disabled(t.graph())).filter(Boolean);if(d.length===o.length)return new Set(d).size>1?"multiple_blockers":d[0];if(!s&&m())return"too_large";if(!s&&g())return"not_downloaded";if(e.some(t.hasHiddenConnections))return"connected_to_hidden";return!1;function m(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&n.percentContainedIn(t.systems.map.extent())<.8}function g(){if(t.inIntro)return!1;let _=t.services.osm;if(_){let v=a.filter(E=>!_.isDataLoaded(E));if(v.length)return v.forEach(E=>t.loadTileAtLoc(E)),!0}return!1}},u.tooltip=function(){let d=u.disabled();return d?t.t(`operations.circularize.${d}.${i}`):t.t(`operations.circularize.description.${i}`)},u.annotation=function(){return t.t("operations.circularize.annotation.feature",{n:o.length})},u.id="circularize",u.keys=[t.t("operations.circularize.key")],u.title=t.t("operations.circularize.title"),u.behavior=new Er(t,u),u}function YS(t,e){let i=e.map(l=>t.hasEntity(l)).filter(Boolean),r=Object.assign({line:[],vertex:[]},ds(i,l=>l.geometry(t.graph()))),s=r.vertex.length===1&&r.vertex[0],n=o();function o(){return s?t.graph().parentWays(s).filter(l=>l.geometry(t.graph())==="line"&&!l.isClosed()&&l.affix(s.id)&&(r.line.length===0||r.line[0]===l)):[]}let a=function(){n.length&&t.enter("draw-line",{continueWay:n[0],continueNode:s})};return a.relatedEntityIds=function(){return n.length?[n[0].id]:[]},a.available=function(){return r.vertex.length===1&&r.line.length<=1&&!t.systems.filters.hasHiddenConnections(s,t.graph())},a.disabled=function(){return n.length===0?"not_eligible":n.length>1?"multiple":!1},a.tooltip=function(){let l=a.disabled();return l?t.t(`operations.continue.${l}`):t.t("operations.continue.description")},a.annotation=function(){return t.t("operations.continue.annotation.line")},a.id="continue",a.keys=[t.t("operations.continue.key")],a.title=t.t("operations.continue.title"),a.behavior=new Er(t,a),a}var OO=[],BO=[];function ZS(t,e){let i=[/^highway\/(motorway|trunk|primary|secondary|tertiary|unclassified|residential|living_street|service|track)/,/^line$/],r=["highway/residential","highway/service","highway/track","highway/unclassified","highway/tertiary","line"],s=Gn(e,OO),n=new Set(s?BO:r),o=t.systems.presets,a=e.map(u=>t.hasEntity(u)).filter(u=>{if(u?.type!=="way")return!1;let d=o.match(u,t.graph());return i.some(m=>m.test(d.id))?(n.has(d.id)||n.add(d.id),!0):!1});OO=e.slice(),BO=Array.from(n);let l=function(){if(!a.length)return;let u=l.annotation();(!s||t.systems.edits.undoAnnotation()!==u)&&t.perform(as(),u);let d=Array.from(n),m=o.match(a[0],t.graph()),g=m?d.indexOf(m.id):-1,_=d[(g+1)%d.length],v=o.item(_);for(let E of a){let b=o.match(E,t.graph()),T=ja(E.id,b,v,!0);t.replace(T,u)}t.enter("select-osm",{selectedIDs:e})};return l.available=function(){return a.length>0},l.disabled=function(){return!1},l.tooltip=function(){let u=l.disabled();return u?t.t(`operations.cycle_highway_tag.${u}`):t.t("operations.cycle_highway_tag.description")},l.annotation=function(){return t.t("operations.cycle_highway_tag.annotation")},l.id="cycle_highway_tag",l.keys=["\u21E7"+t.t("operations.cycle_highway_tag.key")],l.title=t.t("operations.cycle_highway_tag.title"),l.behavior=new Er(t,l),l}function M6(t,e){let i=e.map(l=>t.hasEntity(l)).filter(l=>l&&(l.hasInterestingTags()||l.geometry(t.graph())!=="vertex")),r=i.every(l=>l.isNew()),s=Ar(i,t.graph()),n,o=function(){let l=t.graph(),u=Object.assign({relation:[],way:[],node:[]},ds(i,"type")),d=[],m={},g,_;for(_=0;_<u.relation.length;_++)g=u.relation[_],!m[g.id]&&g.isComplete(l)&&(d.push(g.id),m=a(g.id,l,m));for(_=0;_<u.way.length;_++)g=u.way[_],m[g.id]||(d.push(g.id),m=a(g.id,l,m));for(_=0;_<u.node.length;_++)g=u.node[_],m[g.id]||d.push(g.id);t.copyIDs=d,n&&(d.length!==1||l.entity(d[0]).type!=="node")?t.copyLoc=t.projection.invert(n):t.copyLoc=null};function a(l,u,d){let m=u.entity(l),g;d=d||{},m.type==="relation"?g=m.members.map(_=>_.id):m.type==="way"?g=m.nodes:g=[];for(let _=0;_<g.length;_++)d[g[_]]||(d[g[_]]=!0,d=a(g[_],u,d));return d}return o.available=function(){return i.length>0},o.disabled=function(){if(!r&&l())return"too_large";return!1;function l(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&s.percentContainedIn(t.systems.map.extent())<.8}},o.availableForKeypress=function(){let l=window.getSelection&&window.getSelection();return!l||!l.toString()},o.tooltip=function(){let l=o.disabled();return l?t.t(`operations.copy.${l}`,{n:e.length}):t.t("operations.copy.description",{n:e.length})},o.annotation=function(){return t.t("operations.copy.annotation",{n:e.length})},o.point=function(l){return n=l,o},o.id="copy",o.keys=[Ri("\u2318C")],o.title=t.t("operations.copy.title"),o.behavior=new Er(t,o),o}function QS(t,e){let i=e.map(b=>t.hasEntity(b)).filter(Boolean),r=i.every(b=>b.isNew()),s=[],n=[],o=[],a=[];i.forEach(b=>{b.type==="way"?n.push(b.id):b.geometry(t.graph())==="vertex"?s.push(b.id):o.push(b.id)});let l,u="",d="features",m=[],g=[],_=t.graph();if(s.length>0)m=s,s.forEach(b=>{let T=lm(b);if(n.length>0){let A=n.filter(M=>_.entity(M).nodes.indexOf(b)!==-1);T.limitWays(A)}a.push(T),g=g.concat(_.parentWays(_.entity(b)).map(A=>A.id))}),g=Ei(g).filter(b=>n.indexOf(b)===-1),u+=a.length===1?"single_point.":"multiple_points.",n.length===1?u+="single_way."+_.geometry(n[0]):u+=n.length===0?"no_ways":"multiple_ways";else if(n.length>0){let b=n.map(O=>_.entity(O)),T=ns(n,_);l=T.map(O=>O.loc);let A=[],M=[],k=[],F=[];T.forEach(O=>{let B=lm(O.id).limitWays(n);if(B.disabled(_)!=="not_connected"){let U=0;for(let $ in b)if(b[$].nodes.indexOf(O.id)!==-1&&(U+=1),U>1)break;U>1?(A.push(B),M.push(O)):(k.push(B),F.push(O))}}),u+="no_points.",u+=n.length===1?"single_way.":"multiple_ways.",A.length?(a=A,m=M.map(O=>O.id),u+="conjoined",d="from_each_other"):(a=k,m=F.map(O=>O.id),n.length===1?u+=_.geometry(n[0]):u+="separate")}let v=Ar(m,_),E=function(){let b=function(T){return a.forEach(A=>{A.disabled(T)||(T=A(T))}),T};t.perform(b,E.annotation()),t.systems.validator.validate()};return E.relatedEntityIds=function(){return s.length?g:m},E.available=function(){return!(a.length===0||o.length!==0||s.length!==0&&n.length!==0&&!n.every(function(b){return s.some(T=>t.entity(b).nodes.indexOf(T)!==-1)}))},E.disabled=function(){let b;for(let M of a)if(b=M.disabled(t.graph()),b)return b;if(!r&&T())return"too_large."+((s.length?s:n).length===1?"single":"multiple");if(!r&&l&&A())return"not_downloaded";if(e.some(t.hasHiddenConnections))return"connected_to_hidden";return!1;function T(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&v.percentContainedIn(t.systems.map.extent())<.8}function A(){if(t.inIntro)return!1;let M=t.services.osm;if(M){let k=l.filter(F=>!M.isDataLoaded(F));if(k.length)return k.forEach(F=>t.loadTileAtLoc(F)),!0}return!1}},E.tooltip=function(){let b=E.disabled();return b?t.t(`operations.disconnect.${b}`):t.t(`operations.disconnect.description.${u}`)},E.annotation=function(){return t.t(`operations.disconnect.annotation.${d}`)},E.id="disconnect",E.keys=[t.t("operations.disconnect.key")],E.title=t.t("operations.disconnect.title"),E.behavior=new Er(t,E),E}function P6(t,e){let i=0,r=n(e),s=i===1?"single":"multiple";function n(d){let m;i=0;for(let g in d){let _=d[g],v=o(_);v&&(i+=1,m&&v!==m?m!=="generic"&&v!=="generic"?m="building_address":m="generic":m=v)}return m}function o(d){let m=t.graph(),g=m.entity(d),v=t.systems.presets.match(g,m);if(!v||v.isFallback())return null;if(g.type==="node"&&v.id!=="address"&&Object.keys(g.tags).some(function(b){return b.match(/^addr:.{1,}/)}))return"address";let E=g.geometry(m);return E==="area"&&g.tags.building&&!v.tags.building?"building":E==="vertex"&&Object.keys(g.tags).length?"generic":null}let a=/architect|building|height|layer|nycdoitt:bin|source|type|wheelchair|roof/i,l=["source"],u=function(){t.perform(function(d){for(let m in e){let g=e[m],_=o(g);if(!_)continue;let v=Object.assign({},d.entity(g).tags);for(let E in v)_==="address"&&l.indexOf(E)!==-1||_==="building"&&a.test(E)||_!=="generic"&&(E.match(/^addr:.{1,}/)||E.match(/^source:.{1,}/))||delete v[E];d=Hr(g,v)(d)}return d},u.annotation()),t.systems.validator.validate(),t.enter("select-osm",{selectedIDs:e})};return u.available=function(){return r},u.disabled=function(){if(e.some(d))return"has_wikidata_tag";return!1;function d(m){let g=t.entity(m);return g.tags.wikidata&&g.tags.wikidata.trim().length>0}},u.tooltip=function(){let d=u.disabled();return d?t.t(`operations.downgrade.${d}.${s}`):t.t(`operations.downgrade.description.${r}`)},u.annotation=function(){let d;return r==="building_address"?d="generic":d=r,t.t(`operations.downgrade.annotation.${d}`,{n:i})},u.id="downgrade",u.keys=[Ri("\u232B")],u.title=t.t("operations.downgrade.title"),u.behavior=new Er(t,u),u}function KS(t,e){let i=t.systems.presets,r=e.length===1?"single":"multiple",s=e.map(m=>t.hasEntity(m)).filter(Boolean),n=s.every(m=>m.isNew()),o=Ar(s,t.graph()),a=Ei(s.map(m=>m.geometry(t.graph()))),l=a.length===1?a[0]:"feature",u=s.map(m=>{if(!m.hasInterestingTags())return null;let g=t.graph();return m.type==="node"&&g.parentWays(m).length===0||m.type!=="node"&&!i.match(m,g).geometry.includes("point")?null:z2(m.id,t.projection)}).filter(Boolean),d=function(){if(!u.length)return;let m=T=>{for(let A of u)T=A(T);return T};t.perform(m,d.annotation()),t.systems.validator.validate();let g=t.projection,_=u.map(T=>T.getExtractedNodeID()),v=g.project(o.center()),E=tr(t.systems.map.mouse(),v);t.perform($c(_,E,g));let b=new Map;for(let T of _)b.set(T,t.entity(T));t.enter("move",{selection:b})};return d.available=function(){return u.length&&e.length===u.length},d.disabled=function(){if(!n&&m())return"too_large";if(e.some(g=>t.graph().geometry(g)==="vertex"&&t.hasHiddenConnections(g)))return"connected_to_hidden";return!1;function m(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&o.percentContainedIn(t.systems.map.extent())<.8}},d.tooltip=function(){let m=d.disabled();return m?t.t(`operations.extract.${m}.${r}`):t.t(`operations.extract.description.${l}.${r}`)},d.annotation=function(){return t.t("operations.extract.annotation",{n:e.length})},d.id="extract",d.keys=[t.t("operations.extract.key")],d.title=t.t("operations.extract.title"),d.behavior=new Er(t,d),d}function JS(t,e){let i=r();function r(){let a={tagnosticRoadCombine:t.systems.storage.getItem("rapid-internal-feature.tagnosticRoadCombine")==="true"},l=Ag(e,a);if(!l.disabled(t.graph()))return l;let u=Cg(e);if(!u.disabled(t.graph()))return u;let d=Ig(e);if(!d.disabled(t.graph()))return d;let m=Xa(e);return m.disabled(t.graph())?l.disabled(t.graph())!=="not_eligible"?l:u.disabled(t.graph())!=="not_eligible"?u:d.disabled(t.graph())!=="not_eligible"?d:m:m}let s=function(){if(s.disabled())return;t.perform(i,s.annotation()),t.systems.validator.validate();let n=e.filter(o=>t.hasEntity(o));if(n.length>1){let o=n.filter(a=>t.entity(a).hasInterestingTags());o.length&&(n=o)}t.enter("select-osm",{selectedIDs:n})};return s.available=function(){return e.length>=2},s.disabled=function(){let n=i.disabled(t.graph());if(n)return n;let o=t.services.osm;return o&&i.resultingWayNodesLength&&i.resultingWayNodesLength(t.graph())>o.maxWayNodes?"too_many_vertices":!1},s.tooltip=function(){let n=s.disabled(),o=t.systems.presets;if(n){if(n==="conflicting_relations")return t.t("operations.merge.conflicting_relations");if(n==="restriction"||n==="connectivity"){let a=o.item("type/"+n);return t.t("operations.merge.damage_relation",{relation:a.name()})}else return t.t(`operations.merge.${n}`)}else return t.t("operations.merge.description")},s.annotation=function(){return t.t("operations.merge.annotation",{n:e.length})},s.id="merge",s.keys=[t.t("operations.merge.key")],s.title=t.t("operations.merge.title"),s.behavior=new Er(t,s),s}function eA(t,e){let i=e.length===1?"single":"multiple",r=e.map(u=>t.hasEntity(u)).filter(Boolean),s=r.every(u=>u.isNew()),o=ns(e,t.graph()).map(u=>u.loc),a=Ar(r,t.graph()),l=function(){let u=new Map;for(let d of e)u.set(d,t.entity(d));t.enter("move",{selection:u})};return l.available=function(){return r.length>0},l.disabled=function(){if(!s&&u())return"too_large";if(!s&&d())return"not_downloaded";if(e.some(t.hasHiddenConnections))return"connected_to_hidden";if(r.some(m))return"incomplete_relation";return!1;function u(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&a.percentContainedIn(t.systems.map.extent())<.8}function d(){if(t.inIntro)return!1;let g=t.services.osm;if(g){let _=o.filter(v=>!g.isDataLoaded(v));if(_.length)return _.forEach(v=>t.loadTileAtLoc(v)),!0}return!1}function m(g){return g.type==="relation"&&!g.isComplete(t.graph())}},l.tooltip=function(){let u=l.disabled();return u?t.t(`operations.move.${u}.${i}`):t.t(`operations.move.description.${i}`)},l.annotation=function(){return e.length===1?t.t("operations.move.annotation."+t.graph().geometry(e[0])):t.t("operations.move.annotation.feature",{n:e.length})},l.id="move",l.keys=[t.t("operations.move.key")],l.title=t.t("operations.move.title"),l.behavior=new Er(t,l),l.mouseOnly=!0,l}function tA(t,e){let i=e.length===1?"single":"multiple",r=e.map(m=>t.hasEntity(m)).filter(Boolean),s=r.every(m=>m.isNew()),n=Ar(r,t.graph()),o,a=r.map(u).filter(Boolean),l=ns(e,t.graph()).map(m=>m.loc);function u(m){let g=t.graph(),_=m.geometry(g);if(m.type==="way"&&new Set(m.nodes).size>2)return o&&o!=="feature"?null:(o="feature",sh(m.id,t.projection));if(_==="vertex"){if(o&&o!=="corner")return null;o="corner";let v=g.parentWays(m);if(v.length===1){let E=v[0];if(E.nodes.indexOf(m.id)!==-1)return sh(E.id,t.projection,m.id)}}return null}let d=function(){if(!a.length)return;let m=function(g,_){return a.forEach(v=>{v.disabled(g)||(g=v(g,_))}),g};m.transitionable=!0,t.perform(m,d.annotation()),window.setTimeout(()=>t.systems.validator.validate(),300)};return d.available=function(){return a.length&&e.length===a.length},d.disabled=function(){if(!a.length)return"";let m=a.map(v=>v.disabled(t.graph())).filter(Boolean);if(m.length===a.length)return new Set(m).size>1?"multiple_blockers":m[0];if(!s&&g())return"too_large";if(!s&&_())return"not_downloaded";if(e.some(t.hasHiddenConnections))return"connected_to_hidden";return!1;function g(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&n.percentContainedIn(t.systems.map.extent())<.8}function _(){if(t.inIntro)return!1;let v=t.services.osm;if(v){let E=l.filter(b=>!v.isDataLoaded(b));if(E.length)return E.forEach(b=>t.loadTileAtLoc(b)),!0}return!1}},d.tooltip=function(){let m=d.disabled();return m?t.t(`operations.orthogonalize.${m}.${i}`):t.t(`operations.orthogonalize.description.${o}.${i}`)},d.annotation=function(){return t.t("operations.orthogonalize.annotation."+o,{n:a.length})},d.id="orthogonalize",d.keys=[t.t("operations.orthogonalize.key")],d.title=t.t("operations.orthogonalize.title"),d.behavior=new Er(t,d),d}function R6(t){let e,i=function(){if(!e)return;let r=t.copyIDs;if(!r.length)return;let s=t.projection,n=t.copyGraph,o=new mt,a=[],l=U2(r,n);t.perform(l);let u=l.copies(),d=new Set;Object.values(u).forEach(function(v){d.add(v.id)});for(let v in u){let E=n.entity(v),b=u[v];o=o.extend(E.extent(n)),t.graph().parentWays(b).some(M=>d.has(M.id))||a.push(b.id)}let m=t.copyLoc,g=m&&s.project(m)||s.project(o.center()),_=tr(e,g);t.replace($c(a,_,s),i.annotation()),t.enter("select-osm",{selectedIDs:a})};return i.point=function(r){return e=r,i},i.available=function(){return t.mode?.id==="browse"},i.disabled=function(){return!t.copyIDs.length},i.tooltip=function(){let r=t.systems.l10n,s=t.copyGraph,n=t.copyIDs;return n.length?r.t("operations.paste.description",{feature:r.displayLabel(s.entity(n[0]),s),n:n.length}):r.t("operations.paste.nothing_copied")},i.annotation=function(){let r=t.copyIDs;return t.t("operations.paste.annotation",{n:r.length})},i.id="paste",i.keys=[Ri("\u2318V")],i.title=t.t("operations.paste.title"),i}function iA(t,e){return UO(t,e,"short")}function rA(t,e){return UO(t,e,"long")}function UO(t,e,i="long"){let r=e.length===1?"single":"multiple",s=e.map(d=>t.hasEntity(d)).filter(Boolean),n=s.every(d=>d.isNew()),o=Ar(s,t.graph()),a=ns(e,t.graph()),l=a.map(d=>d.loc),u=function(){let d=Fg(e,t.projection).useLongAxis(i==="long");t.perform(d,u.annotation()),window.setTimeout(()=>t.systems.validator.validate(),300)};return u.available=function(){return a.length>=3},u.disabled=function(){if(!n&&d())return"too_large";if(!n&&m())return"not_downloaded";if(e.some(t.hasHiddenConnections))return"connected_to_hidden";if(s.some(g))return"incomplete_relation";return!1;function d(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&o.percentContainedIn(t.systems.map.extent())<.8}function m(){if(t.inIntro)return!1;let _=t.services.osm;if(_){let v=l.filter(E=>!_.isDataLoaded(E));if(v.length)return v.forEach(E=>t.loadTileAtLoc(E)),!0}return!1}function g(_){return _.type==="relation"&&!_.isComplete(t.graph())}},u.tooltip=function(){let d=u.disabled();return d?t.t(`operations.reflect.${d}.${r}`):t.t(`operations.reflect.description.${i}.${r}`)},u.annotation=function(){return t.t(`operations.reflect.annotation.${i}.feature`,{n:e.length})},u.id=`reflect-${i}`,u.keys=[t.t(`operations.reflect.key.${i}`)],u.title=t.t(`operations.reflect.title.${i}`),u.behavior=new Er(t,u),u}function sA(t,e){let i=e.map(s).filter(Boolean),r=n();function s(a){let l=t.hasEntity(a);if(!l)return null;let u=l.geometry(t.graph());if(l.type!=="node"&&u!=="line")return null;let d=pl(a);return d.disabled(t.graph())?null:d}function n(){let a=i.filter(l=>t.hasEntity(l.entityID())?.type==="node").length;return a===0?"line":a===i.length?"point":"feature"}let o=function(){if(!i.length)return;let a=function(l){for(let u of i)l=u(l);return l};t.perform(a,o.annotation()),t.systems.validator.validate()};return o.available=function(){return i.length>0},o.disabled=function(){return!1},o.tooltip=function(){return t.t(`operations.reverse.description.${r}`)},o.annotation=function(){return t.t(`operations.reverse.annotation.${r}`,{n:i.length})},o.id="reverse",o.keys=[t.t("operations.reverse.key")],o.title=t.t("operations.reverse.title"),o.behavior=new Er(t,o),o}function nA(t,e){let i=e.length===1?"single":"multiple",r=e.map(u=>t.hasEntity(u)).filter(Boolean),s=r.every(u=>u.isNew()),n=Ar(r,t.graph()),o=ns(e,t.graph()),a=o.map(u=>u.loc),l=function(){let u=new Map;for(let d of e)u.set(d,t.entity(d));t.enter("rotate",{selection:u})};return l.available=function(){return o.length>=2},l.disabled=function(){if(!s&&u())return"too_large";if(!s&&d())return"not_downloaded";if(e.some(t.hasHiddenConnections))return"connected_to_hidden";if(r.some(m))return"incomplete_relation";return!1;function u(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&n.percentContainedIn(t.systems.map.extent())<.8}function d(){if(t.inIntro)return!1;let g=t.services.osm;if(g){let _=a.filter(v=>!g.isDataLoaded(v));if(_.length)return _.forEach(v=>t.loadTileAtLoc(v)),!0}return!1}function m(g){return g.type==="relation"&&!g.isComplete(t.graph())}},l.tooltip=function(){let u=l.disabled();return u?t.t(`operations.rotate.${u}.${i}`):t.t(`operations.rotate.description.${i}`)},l.annotation=function(){return e.length===1?t.t("operations.rotate.annotation."+t.graph().geometry(e[0])):t.t("operations.rotate.annotation.feature",{n:e.length})},l.id="rotate",l.keys=[t.t("operations.rotate.key")],l.title=t.t("operations.rotate.title"),l.behavior=new Er(t,l),l.mouseOnly=!0,l}function oA(t,e){let i=t.graph(),r=e.map(E=>t.hasEntity(E)).filter(Boolean),s=r.filter(E=>E.type==="node"&&E.geometry(i)==="vertex"),n=s.map(E=>E.id),o=n.length===1?"single":"multiple",a=r.filter(E=>E.type==="way"),l=a.map(E=>E.id),u=s.length>0&&s.length+a.length===e.length,d=ju(n),m="feature",g=[],_="single";if(u){l.length&&d.limitWays(l),g=d.ways(i);let E=new Set;for(let b of g)E.add(b.geometry(i));E.size===1&&(m=Array.from(E)[0]),_=g.length===1?"single":"multiple"}let v=function(){let E=t.perform(d,v.annotation());t.systems.validator.validate();let b=n.slice();for(let[T,A]of E.changes){let M=A.head;M&&M.type==="way"&&b.push(T)}t.enter("select-osm",{selectedIDs:b})};return v.relatedEntityIds=function(){return g.map(E=>E.id)},v.available=function(){return u},v.disabled=function(){let E=d.disabled(t.graph());return E||(e.some(t.hasHiddenConnections)?"connected_to_hidden":!1)},v.tooltip=function(){let E=v.disabled();return E?t.t(`operations.split.${E}`):t.t(`operations.split.description.${m}.${_}.${o}_node`)},v.annotation=function(){return t.t(`operations.split.annotation.${m}`,{n:g.length})},v.id="split",v.keys=[t.t("operations.split.key")],v.title=t.t("operations.split.title"),v.behavior=new Er(t,v),v}function aA(t,e){let i=e.map(E=>t.hasEntity(E)).filter(Boolean),r=i.every(E=>E.isNew()),s=i.filter(E=>E.type==="way"),n=s.map(E=>E.id),o=i.filter(E=>E.type==="node"),a=o.map(E=>E.id),l=(s.length?s:o).length===1?"single":"multiple",u=ns(e,t.graph()).map(E=>E.loc),d=Ar(e,t.graph()),m,g=_();function _(){if(s.length===0&&o.length>2)return m="point",Rg(a,t.projection);if(s.length>0&&(o.length===0||o.length===2)){let E=[],b=[];for(let A of i)if(A.type==="way"){if(A.type==="way"&&A.isClosed())return null;E.push(A.first()),b.push(A.last())}if(E=E.filter(A=>E.indexOf(A)===E.lastIndexOf(A)),b=b.filter(A=>b.indexOf(A)===b.lastIndexOf(A)),_n(E,b).length+_n(b,E).length!==2)return null;let T=ns(n,t.graph()).map(A=>A.id);return T.length<=2||a.length===2&&(T.indexOf(a[0])===-1||T.indexOf(a[1])===-1)?null:(a.length&&(d=Ar(a,t.graph())),m="line",Dg(e,t.projection))}return null}let v=function(){g&&(t.perform(g,v.annotation()),window.setTimeout(()=>t.systems.validator.validate(),300))};return v.available=function(){return!!g},v.disabled=function(){let E=g.disabled(t.graph());if(E)return E;if(!r&&b())return"too_large";if(!r&&T())return"not_downloaded";if(e.some(t.hasHiddenConnections))return"connected_to_hidden";return!1;function b(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&d.percentContainedIn(t.systems.map.extent())<.8}function T(){if(t.inIntro)return!1;let A=t.services.osm;if(A){let M=u.filter(k=>!A.isDataLoaded(k));if(M.length)return M.forEach(k=>t.loadTileAtLoc(k)),!0}return!1}},v.tooltip=function(){let E=v.disabled();return E?t.t(`operations.straighten.${E}.${l}`):t.t(`operations.straighten.description.${m}`+(s.length===1?"":"s"))},v.annotation=function(){return t.t(`operations.straighten.annotation.${m}`,{n:s.length?s.length:o.length})},v.id="straighten",v.keys=[t.t("operations.straighten.key")],v.title=t.t("operations.straighten.title"),v.behavior=new Er(t,v),v}function cA(t){let e="y_shaped_connection",i=t.systems.l10n,r=12,s=5,n=new Set(["residential","service","track","unclassified","tertiary","secondary","primary","living_street","cycleway","trunk","motorway","road","raceway"]);function o(d,m){return m.parentWays(d).filter(_=>n.has(_.tags.highway))}function a(d,m){let g=!ra(m,[d.id]).disabled(),_;return g?_=new Ti({icon:"rapid-operation-delete",title:i.t("issues.fix.delete_node_around_conn.title"),entityIds:[d.id],onClick:function(){let v=this.entityIds[0],E=ra(m,[v]);E.disabled()||E()}}):_=new Ti({icon:"rapid-operation-move",title:i.t("issues.fix.move_node_around_conn.title"),entityIds:[d.id]}),new rr(m,{type:e,severity:"warning",message:()=>i.t("issues.y_shaped_connection.message"),reference:v=>{v.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(i.t("issues.y_shaped_connection.reference"))},entityIds:[d.id],fixes:[_]})}function l(d,m,g,_){if(g<=0||g>=m.nodes.length-1)return!1;let v=m.nodes[g],E=d.entity(v);if(o(E,d).length<2)return!1;let T=m.nodes[_],A=d.entity(T);if(fr(E.loc,A.loc)>r)return!1;let k=g<_?g-1:g+1,F=m.nodes[k],O=d.entity(F),B=t.projection.project(O.loc),U=t.projection.project(E.loc),$=t.projection.project(A.loc),q=0,W=0,Z=0;return k<_?(q=fs(B,U),W=fs(U,$),Z=Math.abs(W-q)/Math.PI*180):(q=fs($,U),W=fs(U,B),Z=Math.abs(W-q)/Math.PI*180),Z>s}let u=function(d,m){if(d.type!=="node")return[];let g=o(d,m);if(g.length!==1||!g[0].id.startsWith("w-"))return[];let _=[],v=g[0],E=v.nodes.indexOf(d.id);return E<=0||(l(m,v,E-1,E)||l(m,v,E+1,E))&&_.push(a(d,t)),_};return u.type=e,u}function uA(t){let e="suspicious_name",i=t.systems.l10n,r=["aerialway","aeroway","amenity","building","craft","highway","leisure","railway","man_made","office","shop","tourism","waterway"],s=!1;function n(m){let g=t.services.nsi;return g&&(s=g.status==="loading",!s)?g.isGenericName(m):!1}function o(m,g){for(let _ of r){let v=g[_];if(v&&(v=v.toLowerCase(),_===m||v===m||_.replace(/\_/g," ")===m||v.replace(/\_/g," ")===m))return!0}return!1}function a(m,g){return m=m.toLowerCase(),o(m,g)||n(g)}function l(m,g,_,v){return new rr(t,{type:e,subtype:"generic_name",severity:"warning",message:function(){let b=t.hasEntity(this.entityIds[0]);if(!b)return"";let T=t.systems.presets.match(b,t.graph()),A=v&&i.languageName(v);return i.tHtml("issues.generic_name.message"+(A?"_language":""),{feature:T.name(),name:_,language:A})},reference:E,entityIds:[m],hash:`${g}=${_}`,dynamicFixes:function(){return[new Ti({icon:"rapid-operation-delete",title:i.tHtml("issues.fix.remove_the_name.title"),onClick:function(){let b=this.issue.entityIds[0],T=t.entity(b),A=Object.assign({},T.tags);delete A[g],t.perform(Hr(b,A),i.t("issues.fix.remove_generic_name.annotation"))}})]}});function E(b){b.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.generic_name.reference"))}}function u(m,g,_,v){return new rr(t,{type:e,subtype:"not_name",severity:"warning",message:function(){let b=t.hasEntity(this.entityIds[0]);if(!b)return"";let T=t.systems.presets.match(b,t.graph()),A=v&&i.languageName(v);return i.tHtml("issues.incorrect_name.message"+(A?"_language":""),{feature:T.name(),name:_,language:A})},reference:E,entityIds:[m],hash:`${g}=${_}`,dynamicFixes:function(){return[new Ti({icon:"rapid-operation-delete",title:i.tHtml("issues.fix.remove_the_name.title"),onClick:function(){let b=this.issue.entityIds[0],T=t.entity(b),A=Object.assign({},T.tags);delete A[g],t.perform(Hr(b,A),i.t("issues.fix.remove_mistaken_name.annotation"))}})]}});function E(b){b.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.generic_name.reference"))}}let d=function(g){let _=g.tags;if(!!_.wikidata||!!_["brand:wikidata"]||!!_["operator:wikidata"])return[];let E=[],b=new Set((_["not:name"]??"").split(";").map(T=>T.trim()).filter(Boolean));for(let[T,A]of Object.entries(_)){if(!A)continue;let M=T.match(/^name(?:(?::)([a-zA-Z_-]+))?$/);if(!M)continue;let k=M.length>=2?M[1]:null;b.has(A)&&E.push(u(g.id,T,A,k)),a(A,_)&&(E.provisional=s,E.push(l(g.id,T,A,k)))}return E};return d.type=e,d}function hA(t){let e="unsquare_way",i=t.systems.l10n,r=5,s=.05,n=10;function o(l,u){return l.type!=="way"||l.geometry(u)!=="area"?!1:l.tags.building&&l.tags.building!=="no"}let a=function(u,d){if(!o(u,d))return[];if(u.tags.nonsquare==="yes")return[];let m=u.isClosed();if(!m)return[];let g=d.childNodes(u).slice();if(g.length>n+1)return[];let _=t.services.osm;if(!_||g.some(F=>!_.isDataLoaded(F.loc)))return[];if(g.some(F=>d.parentWays(F).some(O=>O.id===u.id?!1:o(O,d)?!0:d.parentRelations(O).some(B=>B.isMultipolygon()&&B.tags.building&&B.tags.building!=="no"))))return[];let b=t.systems.storage.getItem("validate-square-degrees"),T=isNaN(b)?r:parseFloat(b),A=g.map(F=>t.projection.project(F.loc));if(!Z2(A,m,s,T,!0))return[];let M;if(!u.tags.wikidata){let F=sh(u.id,t.projection,void 0,T);F.transitionable=!1,M=[F,i.t("operations.orthogonalize.annotation.feature",{n:1})]}return[new rr(t,{type:e,subtype:"building",severity:"warning",message:function(){let F=t.hasEntity(this.entityIds[0]);return F?i.tHtml("issues.unsquare_way.message",{feature:i.displayLabel(F,t.graph())}):""},reference:k,entityIds:[u.id],hash:T,autoArgs:M,dynamicFixes:function(){return[new Ti({icon:"rapid-operation-orthogonalize",title:i.t("issues.fix.square_feature.title"),onClick:function(F,O){let B=this.issue.entityIds[0];F.perform(sh(B,F.projection,void 0,T),i.t("operations.orthogonalize.annotation.feature",{n:1})),window.setTimeout(function(){O()},175)}})]}})];function k(F){F.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.unsquare_way.buildings.reference"))}};return a.type=e,a}var cK=5e3,D6=class extends ui{constructor(e){super(e),this.id="validator",this.dependencies=new Set(["edits","storage","map","urlhash"]),this._rules=new Map,this._base=new rp("base"),this._head=new rp("head"),this._disabledRuleIDs=new Set,this._ignoredIssueIDs=new Set,this._resolvedIssueIDs=new Set,this._completeDiff=new Map,this._headIsCurrent=!1,this._deferredRIC=new Map,this._deferredST=new Set,this._headPromise=null,this._errorOverrides=[],this._warningOverrides=[],this._disableOverrides=[],this._initPromise=null,this.validate=this.validate.bind(this),this.validateAsync=this.validateAsync.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let o of this.dependencies)if(!this.context.systems[o])return Promise.reject(`Cannot init:  ${this.id} requires ${o}`);let e=this.context;Object.values(dA).forEach(o=>{if(typeof o!="function")return;let a=o(e);this._rules.set(a.type,a)});let i=e.systems.edits;e.on("modechange",this.validate),i.on("restore",this.validate).on("undone",this.validate).on("redone",this.validate),i.on("merge",o=>{if(!o)return;let a=i.base();this._head.graph||(this._head.graph=a),this._base.graph||(this._base.graph=a),o=this._base.withAllRelatedEntities(o),this._validateEntitiesAsync(o,this._base)});let r=e.systems.storage,s=e.systems.urlhash,n=Promise.all([r.initAsync(),s.initAsync()]);return this._initPromise=n.then(()=>{this._errorOverrides=this._parseHashParam(s.initialHashParams.get("validationError")),this._warningOverrides=this._parseHashParam(s.initialHashParams.get("validationWarning")),this._disableOverrides=this._parseHashParam(s.initialHashParams.get("validationDisable"));let o=r.getItem("validate-disabledRules");if(o){let a=o.split(",").map(l=>l.trim()).filter(Boolean);this._disabledRuleIDs=new Set(a)}})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this._reset(!0),Promise.resolve()}_parseHashParam(e=""){let i=[],r=e.split(",").map(n=>n.trim()).filter(Boolean);for(let n of r){let o=n.split("/",2),a=o[0],l=o[1]??"*";!a||!l||i.push({type:s(a),subtype:s(l)})}return i;function s(n){let o=n.replace(/[-\/\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*");return new RegExp(`^${o}$`)}}_reset(e=!1){this._base.queue=[],this._head.queue=[];for(let[i,r]of this._deferredRIC)window.cancelIdleCallback(i),r();this._deferredRIC.clear();for(let i of this._deferredST)window.clearTimeout(i);this._deferredST.clear(),e&&this._ignoredIssueIDs.clear(),this._resolvedIssueIDs.clear(),this._base=new rp("base"),this._head=new rp("head"),this._completeDiff=new Map,this._headIsCurrent=!1}resetIgnoredIssues(){this._ignoredIssueIDs.clear(),this.emit("validated")}revalidateUnsquare(){let e=this._rules.get("unsquare_way");if(typeof e!="function")return;let i=r=>{if(!r.graph)return;r.uncacheIssuesOfType("unsquare_way");let n=this.context.systems.edits.tree().intersects(new mt([-180,-90],[180,90]),r.graph).filter(o=>o.type==="way"&&o.tags.building&&o.tags.building!=="no");for(let o of n){let a=e(o,r.graph);a.length&&r.cacheIssues(a)}};i(this._head),i(this._base),this.emit("validated")}getIssues(e){let i=Object.assign({what:"all",where:"all",includeIgnored:!1,includeDisabledRules:!1},e),r=this.context,s=r.systems.map.extent(),n=new Set,o=[],a=l=>{if(!l||n.has(l.id)||this._resolvedIssueIDs.has(l.id)||i.includeDisabledRules==="only"&&!this._disabledRuleIDs.has(l.type)||!i.includeDisabledRules&&this._disabledRuleIDs.has(l.type)||i.includeIgnored==="only"&&!this._ignoredIssueIDs.has(l.id)||!i.includeIgnored&&this._ignoredIssueIDs.has(l.id)||(l.entityIds||[]).some(u=>!r.hasEntity(u)))return!1;if(i.where==="visible"){let u=l.extent(r.graph());if(!s.intersects(u))return!1}return!0};if(this._head.graph&&this._head.graph!==this._base.graph){let l=[...this._head.issues.values()];for(let u of l){let d=(u.entityIds||[]).some(m=>this._completeDiff.has(m));i.what==="edited"&&!d||a(u)&&(n.add(u.id),o.push(u))}}if(i.what==="all"){let l=[...this._base.issues.values()];for(let u of l)a(u)&&(n.add(u.id),o.push(u))}return o}getResolvedIssues(){return Array.from(this._resolvedIssueIDs).map(e=>this._base.issues.get(e)).filter(Boolean)}focusIssue(e){let i=this.context,r=i.graph(),s,n,o=e.extent(r);if(o&&(n=o.center()),e.entityIds&&e.entityIds.length&&(s=e.entityIds[0],s&&s.charAt(0)==="r")){let a=SI([s],r),l=a.find(u=>u.charAt(0)==="n"&&r.hasEntity(u));if(!l){let u=a.find(d=>d.charAt(0)==="w"&&r.hasEntity(d));u&&(l=r.entity(u).first())}l&&(n=r.entity(l).loc)}if(n){let a=Math.max(i.systems.map.zoom(),19);i.systems.map.centerZoomEase(n,a)}s&&window.setTimeout(()=>{i.enter("select-osm",{selectedIDs:[s]}),this.emit("focusedIssue",e)},250)}getIssuesBySeverity(e){let i=ds(this.getIssues(e),"severity");return i.error=i.error??[],i.warning=i.warning??[],i}getSharedEntityIssues(e,i){let r=["missing_tag","missing_role","outdated_tags","mismatched_geometry","crossing_ways","almost_junction","disconnected_way","impossible_oneway"],s=this.getIssues(i),n=new Set(e);return s.filter(o=>(o.entityIds??[]).some(a=>n.has(a))).sort((o,a)=>{if(o.type===a.type)return o.id<a.id?-1:1;let l=r.indexOf(o.type),u=r.indexOf(a.type);return l!==-1&&u!==-1?l-u:l===-1&&u===-1?o.type<a.type?-1:1:l!==-1?-1:1})}getEntityIssues(e,i){return this.getSharedEntityIssues([e],i)}getRuleKeys(){return[...this._rules.keys()]}isRuleEnabled(e){return!this._disabledRuleIDs.has(e)}toggleRule(e){this._disabledRuleIDs.has(e)?this._disabledRuleIDs.delete(e):this._disabledRuleIDs.add(e),this.context.systems.storage.setItem("validate-disabledRules",[...this._disabledRuleIDs].join(",")),this.validateAsync()}disableRules(e=[]){this._disabledRuleIDs=new Set(e),this.context.systems.storage.setItem("validate-disabledRules",[...this._disabledRuleIDs].join(",")),this.validateAsync()}ignoreIssue(e){this._ignoredIssueIDs.add(e)}validateAsync(){let e=this.context,i=e.systems.edits.base();this._head.graph||(this._head.graph=i),this._base.graph||(this._base.graph=i);let r=this._head.graph,s=e.graph();if(s===r)return this._headIsCurrent=!0,this.emit("validated"),Promise.resolve();if(this._headPromise)return this._headIsCurrent=!1,this._headPromise;this._head.graph=s,this._completeDiff=e.systems.edits.difference().complete();let o=[...new Wa(r,s).complete().keys()];return o=this._head.withAllRelatedEntities(o),o.size?(this._headPromise=this._validateEntitiesAsync(o,this._head).then(()=>this._updateResolvedIssues(o)).then(()=>this.emit("validated")).catch(a=>console.error(a)).then(()=>{this._headPromise=null,this._headIsCurrent||this.validateAsync()}),this._headPromise):(this.emit("validated"),Promise.resolve())}validate(){return this.validateAsync()}_validateEntity(e,i){let r=n=>{let o=n.type,a=n.subtype??"";for(let l of this._errorOverrides)if(l.type.test(o)&&l.subtype.test(a))return n.severity="error",!0;for(let l of this._warningOverrides)if(l.type.test(o)&&l.subtype.test(a))return n.severity="warning",!0;for(let l of this._disableOverrides)if(l.type.test(o)&&l.subtype.test(a))return!1;return!0},s={issues:[],provisional:!1};for(let[n,o]of this._rules){if(typeof o!="function"){console.error(`no such validation rule = ${n}`);continue}let a=o(e,i);a.provisional&&(s.provisional=!0),a=a.filter(r),s.issues=s.issues.concat(a)}return s}_updateResolvedIssues(e=[]){for(let i of e){let r=this._base.entityIssueIDs.get(i)??[];for(let s of r)(this._base.issues.get(s)?.entityIds||[]).some(a=>this._completeDiff.has(a))&&!this._head.issues.has(s)?this._resolvedIssueIDs.add(s):this._resolvedIssueIDs.delete(s)}}_validateEntitiesAsync(e,i){let r=Array.from(e).map(s=>i.queuedEntityIDs.has(s)?null:(i.queuedEntityIDs.add(s),i.uncacheEntityID(s),()=>{i.queuedEntityIDs.delete(s);let n=i.graph;if(!n)return;let o=n.hasEntity(s);if(!o)return;let a=this._validateEntity(o,n);a.provisional&&i.provisionalEntityIDs.add(s),i.cacheIssues(a.issues)})).filter(Boolean);return i.queue=i.queue.concat(h3(r,50)),i.queuePromise||(i.queuePromise=this._processQueue(i).then(()=>this._revalidateProvisionalEntities(i)).catch(s=>console.error(s)).finally(()=>i.queuePromise=null)),i.queuePromise}_revalidateProvisionalEntities(e){if(!e.provisionalEntityIDs.size)return;let i=window.setTimeout(()=>{this._deferredST.delete(i),e.provisionalEntityIDs.size&&this._validateEntitiesAsync(e.provisionalEntityIDs,e)},cK);this._deferredST.add(i)}_processQueue(e){if(!e.queue.length)return Promise.resolve();let i=e.queue.pop();return new Promise((r,s)=>{let n=window.requestIdleCallback(()=>{this._deferredRIC.delete(n),i.forEach(o=>o()),r()});this._deferredRIC.set(n,s)}).then(()=>{e.queue.length%100===0&&this.emit("validated")}).then(()=>this._processQueue(e))}},rp=class{constructor(e){this.which=e,this.graph=null,this.queue=[],this.queuePromise=null,this.queuedEntityIDs=new Set,this.provisionalEntityIDs=new Set,this.issues=new Map,this.entityIssueIDs=new Map}cacheIssue(e){for(let i of e.entityIds??[]){let r=this.entityIssueIDs.get(i);r||(r=new Set,this.entityIssueIDs.set(i,r)),r.add(e.id)}this.issues.set(e.id,e)}uncacheIssue(e){for(let i of e.entityIds??[]){let r=this.entityIssueIDs.get(i);r&&(r.delete(e.id),r.size||this.entityIssueIDs.delete(i))}this.issues.delete(e.id)}cacheIssues(e=[]){for(let i of e)this.cacheIssue(i)}uncacheIssues(e=[]){for(let i of e)this.uncacheIssue(i)}uncacheIssuesOfType(e){let r=[...this.issues.values()].filter(s=>s.type===e);this.uncacheIssues(r)}uncacheEntityID(e){let i=this.entityIssueIDs.get(e)??[];for(let r of i){let s=this.issues.get(r);s&&this.uncacheIssue(s)}this.entityIssueIDs.delete(e),this.provisionalEntityIDs.delete(e)}withAllRelatedEntities(e=[]){let i=new Set;for(let r of e){i.add(r);let s=this.entityIssueIDs.get(r)??[];for(let n of s){let a=this.issues.get(n)?.entityIDs??[];for(let l of a)i.add(l)}}return i}};var Pn={available:new Map};Pn.available.set("data",vm);Pn.available.set("edits",bm);Pn.available.set("filters",wm);Pn.available.set("imagery",Cm);Pn.available.set("l10n",Im);Pn.available.set("locations",Pm);Pn.available.set("map",h6);Pn.available.set("map3d",d6);Pn.available.set("photos",f6);Pn.available.set("presets",m6);Pn.available.set("rapid",g6);Pn.available.set("storage",y6);Pn.available.set("ui",C6);Pn.available.set("uploader",I6);Pn.available.set("urlhash",k6);Pn.available.set("validator",D6);var gs=class extends en.default{constructor(e){super(),this.context=e,this.id="",this._active=!1,this._selectedData=new Map,this.operations=[]}enter(){return this._active=!0,!0}exit(){this._active=!1}get active(){return this._active}get selectedData(){return this._selectedData}get selectedIDs(){return Array.from(this._selectedData.keys())}};var zO=!1,F6=class extends gs{constructor(e){super(e),this.id="add-note",this._click=this._click.bind(this),this._cancel=this._cancel.bind(this)}enter(){zO&&console.log("AddNoteMode: entering"),this._active=!0;let e=this.context;return e.enableBehaviors(["hover","draw","map-interaction","map-nudging"]),e.behaviors.draw.on("click",this._click).on("cancel",this._cancel).on("finish",this._cancel),e.systems.edits.on("undone",this._cancel).on("redone",this._cancel),e.behaviors["map-nudging"].allow(),!0}exit(){if(!this._active)return;this._active=!1,zO&&console.log("AddNoteMode: exiting");let e=this.context;e.behaviors.draw.off("click",this._click).off("cancel",this._cancel).off("finish",this._cancel),e.systems.edits.off("undone",this._cancel).off("redone",this._cancel)}_click(e){let i=this.context,r=i.services.osm,s=i.projection,n=e.coord,o=s.invert(n);if(!r)return;let a=Fr({loc:o,status:"open",comments:[]});r.replaceNote(a);let l=new Map().set(a.id,a);i.enter("select",{selection:l})}_cancel(){this.context.enter("browse")}};var GO=!1,L6=class extends gs{constructor(e){super(e),this.id="add-point",this.defaultTags={},this._click=this._click.bind(this),this._cancel=this._cancel.bind(this)}enter(){GO&&console.log("AddPointMode: entering"),this._active=!0;let e=this.context;return e.enableBehaviors(["hover","draw","map-interaction"]),e.behaviors.draw.on("click",this._click).on("cancel",this._cancel).on("finish",this._cancel),e.systems.edits.on("undone",this._cancel).on("redone",this._cancel),!0}exit(){if(!this._active)return;GO&&console.log("AddPointMode: exiting"),this._active=!1;let e=this.context;e.behaviors.draw.off("click",this._click).off("cancel",this._cancel).off("finish",this._cancel),e.systems.edits.off("undone",this._cancel).off("redone",this._cancel)}_click(e){let i=this.context,r=i.graph(),s=i.projection,n=e.coord,o=s.invert(n);if(i.systems.locations.blocksAt(o).length)return;let l=e?.target?.data,u=e?.target?.choice,d=l&&r.hasEntity(l.id);if(d?.type==="node"){this._clickNode(d.loc,d);return}if(d?.type==="way"){let m=Gs(r.childNodes(d),n,s),g=6;if(m&&m.distance<g){let _=[d.nodes[m.index-1],d.nodes[m.index]];this._clickWay(m.loc,_);return}}this._clickNothing(o)}_clickNothing(e){let i=this.context,r=vi({loc:e,tags:this.defaultTags}),s=i.t("operations.add.annotation.point");i.perform(Or(r),s),i.enter("select-osm",{selectedIDs:[r.id],newFeature:!0})}_clickWay(e,i){let r=this.context,s=vi({tags:this.defaultTags}),n=r.t("operations.add.annotation.vertex");r.perform(tn({loc:e,edge:i},s),n),r.enter("select-osm",{selectedIDs:[s.id],newFeature:!0})}_clickNode(e,i){let r=this.context;if(Object.keys(this.defaultTags).length===0){r.enter("select-osm",{selectedIDs:[i.id]});return}let s=Object.assign({},i.tags);for(let o in this.defaultTags)s[o]=this.defaultTags[o];let n=r.t("operations.add.annotation.point");r.perform(Hr(i.id,s),n),r.enter("select-osm",{selectedIDs:[i.id],newFeature:!0})}_cancel(){this.context.enter("browse")}};var $O=!1,N6=class extends gs{constructor(e){super(e),this.context=e,this.id="browse"}enter(){return $O&&console.log("BrowseMode: entering"),this.operations=[R6(this.context)],this._active=!0,this.context.enableBehaviors(["hover","select","drag","paste","lasso","map-interaction"]),document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),!0}exit(){this._active&&(this._active=!1,$O&&console.log("BrowseMode: exiting"))}sidebar(){console.error("error: do not call BrowseMode.sidebar anymore")}};var O6=class extends gs{constructor(e){super(e),this.id="drag-node",this.dragNode=null,this._reselectIDs=[],this._wasMidpoint=!1,this._startLoc=null,this._clickLoc=null,this._move=this._move.bind(this),this._end=this._end.bind(this),this._cancel=this._cancel.bind(this)}enter(e={}){let i=this.context,r=e.selection;if(!(r instanceof Map)||!r.size)return!1;this._reselectIDs=e.reselectIDs??[];let[s]=r.values();if(!i.editable())return!1;if(this._wasMidpoint=s.type==="midpoint",!this._wasMidpoint&&i.systems.filters.hasHiddenConnections(s,i.graph()))return i.systems.ui.flash.duration(4e3).iconName("#rapid-icon-no").label(i.t("modes.drag_node.connected_to_hidden"))(),!1;if(this._active=!0,this._wasMidpoint){let a={loc:s.loc,edge:[s.a.id,s.b.id]};s=vi(),i.perform(tn(a,s)),s=i.entity(s.id)}else i.perform(as());this.dragNode=s,this._startLoc=s.loc;let n=i.scene();n.classData("osm",this.dragNode.id,"drawing");for(let a of i.graph().parentWays(this.dragNode))n.classData("osm",a.id,"drawing");let o=i.behaviors.drag.lastDown.coord;return this._clickLoc=i.projection.invert(o),i.enableBehaviors(["hover","drag"]),i.behaviors.drag.on("move",this._move).on("end",this._end).on("cancel",this._cancel),i.systems.edits.on("undone",this._cancel).on("redone",this._cancel),!0}exit(){if(!this._active)return;this._active=!1,this.dragNode=null,this._startLoc=null,this._clickLoc=null,this._wasMidpoint=!1,this._selectedData.clear();let e=this.context;e.scene().clearClass("drawing"),e.behaviors.drag.off("move",this._move).off("end",this._end).off("cancel",this._cancel),e.systems.edits.off("undone",this._cancel).off("redone",this._cancel)}_refreshEntities(){let i=this.context.graph();if(this._selectedData.clear(),this.dragNode=this.dragNode&&i.hasEntity(this.dragNode.id),!this.dragNode){this._cancel();return}this._selectedData.set(this.dragNode.id,this.dragNode)}_move(e){if(!this.dragNode)return;let i=this.context,r=i.graph(),s=i.projection,n=e.coord,o=e?.target?.data,a=e?.target?.choice,l=o&&r.hasEntity(o.id),u;if(l?.type==="node"&&this._canSnapToNode(l))u=l.loc;else if(l?.type==="way"){let m=Gs(r.childNodes(l),n,s,this.dragNode.id),g=6;m&&m.distance<g&&(u=m.loc)}if(!u){let m=i.projection.project(this._clickLoc),g=i.projection.project(this._startLoc),_=tr(g,m),v=Sr(n,_);u=s.invert(v)}if(i.systems.locations.blocksAt(u).length){this._cancel();return}i.replace(Hc(this.dragNode.id,u)),this._refreshEntities()}_end(e){if(!this.dragNode)return;let i=this.context,r=i.graph(),s=this.dragNode.geometry(r)==="point",n=e?.target?.data,o=e?.target?.choice,a=n&&r.hasEntity(n.id);if(a?.type==="node"&&this._canSnapToNode(a))i.replace(Ud([a.id,this.dragNode.id]),this._connectAnnotation(a));else if(a?.type==="way"){let l=Gs(r.childNodes(a),e.coord,i.projection,this.dragNode.id),u=6;if(l&&l.distance<u){let d=[a.nodes[l.index-1],a.nodes[l.index]];i.replace(tn({loc:l.loc,edge:d},this.dragNode),this._connectAnnotation(a))}else i.replace(as(),this._moveAnnotation())}else this._wasMidpoint?i.replace(as(),i.t("operations.add.annotation.vertex")):i.replace(as(),this._moveAnnotation());s&&i.hasEntity(this.dragNode.id)?i.enter("select-osm",{selectedIDs:[this.dragNode.id]}):this._reselectIDs.length?i.enter("select-osm",{selectedIDs:this._reselectIDs}):i.enter("browse")}_moveAnnotation(){if(!this.dragNode)return;let e=this.context,i=this.dragNode.geometry(e.graph());return e.t(`operations.move.annotation.${i}`)}_connectAnnotation(e){if(!this.dragNode||!e)return;let i=this.context,r=i.graph(),s=this.dragNode.geometry(r),n=e.geometry(r);if(s==="vertex"&&n==="vertex"){let o=r.parentWays(this.dragNode),a=r.parentWays(e),l=Yn(o,a);if(l.length!==0)return l[0].areAdjacent(this.dragNode.id,e.id)?i.t("operations.connect.annotation.from_vertex.to_adjacent_vertex"):i.t("operations.connect.annotation.from_vertex.to_sibling_vertex")}return i.t(`operations.connect.annotation.from_${s}.to_${n}`)}_canSnapToNode(e){if(!this.dragNode)return!1;let i=this.context.graph(),r=this.context.systems.presets;return this.dragNode.geometry(i)!=="vertex"||e.geometry(i)==="vertex"||r.allowsVertex(e,i)}_cancel(){this.context.enter("browse")}};var fc=!1,B6=class extends gs{constructor(e){super(e),this.id="draw-area",this.defaultTags={},this.drawWay=null,this.drawNode=null,this.firstNode=null,this.lastNode=null,this._startGraph=null,this._move=this._move.bind(this),this._click=this._click.bind(this),this._finish=this._finish.bind(this),this._cancel=this._cancel.bind(this),this._undoOrRedo=this._undoOrRedo.bind(this)}enter(){fc&&console.log("DrawAreaMode: entering");let e=this.context;return this._active=!0,this.defaultTags={area:"yes"},this.drawWay=null,this.drawNode=null,this.lastNode=null,this.firstNode=null,this._startGraph=e.graph(),this._selectedData.clear(),e.enableBehaviors(["hover","draw","map-interaction","map-nudging"]),e.behaviors.draw.on("move",this._move).on("click",this._click).on("finish",this._finish).on("cancel",this._cancel),e.systems.edits.on("undone",this._undoOrRedo).on("redone",this._undoOrRedo),e.behaviors["map-interaction"].doubleClickEnabled=!1,!0}exit(){if(!this._active)return;this._active=!1,fc&&console.log("DrawAreaMode: exiting");let e=this.context;if(e.pauseChangeDispatch(),this.drawNode&&(e.pop(),this.drawWay&&(this.drawWay=e.hasEntity(this.drawWay.id))),(this.drawWay?.nodes?.length||0)<4)for(fc&&console.log("DrawAreaMode: draw way invalid, rolling back");e.graph()!==this._startGraph;)e.pop();this.drawWay=null,this.drawNode=null,this.lastNode=null,this.firstNode=null,this._selectedData.clear(),e.scene().clearClass("drawing"),window.setTimeout(()=>{e.behaviors["map-interaction"].doubleClickEnabled=!0},1e3),e.behaviors.draw.off("move",this._move).off("click",this._click).off("finish",this._finish).off("cancel",this._cancel),e.systems.edits.off("undone",this._undoOrRedo).off("redone",this._undoOrRedo),e.resumeChangeDispatch()}_refreshEntities(){let e=this.context,i=e.scene(),r=e.graph();if(this._selectedData.clear(),i.clearClass("drawing"),this.drawWay=this.drawWay&&r.hasEntity(this.drawWay.id),this.drawNode=this.drawNode&&r.hasEntity(this.drawNode.id),this.lastNode=this.lastNode&&r.hasEntity(this.lastNode.id),this.firstNode=this.firstNode&&r.hasEntity(this.firstNode.id),!this.drawWay||!this.drawNode||!this.lastNode||!this.firstNode){this._cancel();return}this._selectedData.set(this.drawWay.id,this.drawWay),i.classData("osm",this.drawWay.id,"drawing"),i.classData("osm",this.drawNode.id,"drawing")}_getAnnotation(){let e=this.drawWay?.nodes?.length||0;if(e<4)return;let i=e>4?"continue":"start";return this.context.t(`operations.${i}.annotation.area`)}_move(e){if(!this.drawNode)return;let i=this.context,r=i.graph(),s=i.projection,n=e.coord,o=s.invert(n),a=e?.target?.data,l=e?.target?.choice,u=a&&r.hasEntity(a.id);if(u?.type==="node")o=u.loc;else if(u&&u.type==="way"){let d=Gs(r.childNodes(u),n,s,this.drawNode.id),m=6;d&&d.distance<m&&(o=d.loc)}i.replace(Hc(this.drawNode.id,o)),this.drawNode=i.entity(this.drawNode.id)}_click(e){let i=this.context,r=i.graph(),s=i.projection,n=e.coord,o=s.invert(n);if(i.systems.locations.blocksAt(o).length)return;i.behaviors["map-nudging"].allow();let l=e?.target?.data,u=e?.target?.choice,d=l&&r.hasEntity(l.id);if(d?.type==="node"){this._clickNode(d.loc,d);return}if(d?.type==="way"){let m=Gs(r.childNodes(d),n,s,this.drawNode?.id),g=6;if(m&&m.distance<g){let _=[d.nodes[m.index-1],d.nodes[m.index]];this._clickWay(m.loc,_);return}}this._clickLoc(o)}_clickLoc(e){let r=this.context;if(r.pauseChangeDispatch(),this.drawWay){if(Wi(e,this.lastNode.loc,1e-6)||Wi(e,this.firstNode.loc,1e-6)){this._finish();return}fc&&console.log(`DrawAreaMode: _clickLoc, extending area to ${e}`),r.replace(as(),this._getAnnotation()),this.lastNode=this.drawNode,this.drawNode=vi({loc:e}),r.perform(Or(this.drawNode),xo(this.drawWay.id,this.drawNode.id))}else fc&&console.log(`DrawAreaMode: _clickLoc, starting area at ${e}`),this.firstNode=vi({loc:e}),this.lastNode=this.firstNode,this.drawNode=vi({loc:e}),this.drawWay=Cr({tags:this.defaultTags,nodes:[this.firstNode.id,this.drawNode.id,this.firstNode.id]}),r.perform(Or(this.drawNode),Or(this.firstNode),Or(this.drawWay));this._refreshEntities(),r.resumeChangeDispatch()}_clickWay(e,i){let s=this.context,n={loc:e,edge:i};if(s.pauseChangeDispatch(),this.drawWay){if(Wi(e,this.lastNode.loc,1e-6)||Wi(e,this.firstNode.loc,1e-6)){this._finish();return}fc&&console.log(`DrawAreaMode: _clickWay, extending area to edge ${i}`),s.replace(Hc(this.drawNode.id,e),tn(n,this.drawNode),this._getAnnotation()),this.lastNode=this.drawNode,this.drawNode=vi({loc:e}),s.perform(Or(this.drawNode),xo(this.drawWay.id,this.drawNode.id))}else fc&&console.log(`DrawAreaMode: _clickWay, starting area at edge ${i}`),this.firstNode=vi({loc:e}),this.lastNode=this.firstNode,this.drawNode=vi({loc:e}),this.drawWay=Cr({tags:this.defaultTags,nodes:[this.firstNode.id,this.drawNode.id,this.firstNode.id]}),s.perform(Or(this.firstNode),Or(this.drawNode),Or(this.drawWay),tn(n,this.firstNode));this._refreshEntities(),s.resumeChangeDispatch()}_clickNode(e,i){let s=this.context;if(s.pauseChangeDispatch(),this.drawWay){if(i===this.lastNode||i===this.firstNode||Wi(e,this.lastNode.loc,1e-6)||Wi(e,this.firstNode.loc,1e-6)){this._finish();return}fc&&console.log(`DrawAreaMode: _clickNode, extending area to ${i.id}`),s.replace(this._actionRemoveDrawNode(this.drawWay.id,this.drawNode),xo(this.drawWay.id,i.id),this._getAnnotation()),this.lastNode=i,s.perform(Or(this.drawNode),xo(this.drawWay.id,this.drawNode.id))}else fc&&console.log(`DrawAreaMode: _clickNode, starting line at ${i.id}`),this.firstNode=i,this.lastNode=this.firstNode,this.drawNode=vi({loc:e}),this.drawWay=Cr({tags:this.defaultTags,nodes:[this.firstNode.id,this.drawNode.id,this.firstNode.id]}),s.perform(Or(this.drawNode),Or(this.drawWay));this._refreshEntities(),s.resumeChangeDispatch()}_actionRemoveDrawNode(e,i){return function(r){return r.replace(r.entity(e).removeNode(i.id)).remove(i)}}_finish(){this.drawWay?(fc&&console.log(`DrawAreaMode: _finish, drawWay.id = ${this.drawWay.id}`),this.context.enter("select-osm",{selectedIDs:[this.drawWay.id],newFeature:!0})):this._cancel()}_cancel(){fc&&console.log("DrawAreaMode: _cancel"),this.drawWay=null,this.drawNode=null,this.firstNode=null,this.lastNode=null,this.context.enter("browse")}_undoOrRedo(){this._cancel()}};var Ll=!1,U6=class extends gs{constructor(e){super(e),this.id="draw-line",this.defaultTags={},this.drawWay=null,this.drawNode=null,this.firstNode=null,this.lastNode=null,this._insertIndex=void 0,this._startGraph=null,this._move=this._move.bind(this),this._click=this._click.bind(this),this._finish=this._finish.bind(this),this._cancel=this._cancel.bind(this),this._undoOrRedo=this._undoOrRedo.bind(this)}enter(e={}){let i=e.continueNode,r=e.continueWay;if(i||r){if(!(i instanceof vi)||!(r instanceof Cr))return!1;Ll&&console.log(`DrawLineMode: entering, continuing line ${r.id}`)}else Ll&&console.log("DrawLineMode: entering");let s=this.context;if(this._active=!0,this.drawWay=null,this.drawNode=null,this.lastNode=null,this.firstNode=null,this._insertIndex=void 0,this._startGraph=s.graph(),this._selectedData.clear(),s.enableBehaviors(["hover","draw","map-interaction","map-nudging"]),s.behaviors.draw.on("move",this._move).on("click",this._click).on("finish",this._finish).on("cancel",this._cancel),s.systems.edits.on("undone",this._undoOrRedo).on("redone",this._undoOrRedo),s.behaviors["map-interaction"].doubleClickEnabled=!1,i&&r){let n=r.affix(i.id)==="prefix",o=n?r.last():r.first();this._insertIndex=n?0:void 0,this.lastNode=i,this.firstNode=s.entity(o),this.drawWay=r,this.drawNode=vi({loc:s.systems.map.mouseLoc()}),s.perform(Or(this.drawNode),xo(this.drawWay.id,this.drawNode.id,this._insertIndex)),this._refreshEntities()}return!0}exit(){if(!this._active)return;this._active=!1,Ll&&console.log("DrawLineMode: exiting");let e=this.context;if(e.pauseChangeDispatch(),this.drawNode&&(e.pop(),this.drawWay&&(this.drawWay=e.hasEntity(this.drawWay.id))),(this.drawWay?.nodes?.length||0)<2||this.firstNode.id===this.lastNode.id)for(Ll&&console.log("DrawLineMode: draw way invalid, rolling back");e.graph()!==this._startGraph;)e.pop();this.drawWay=null,this.drawNode=null,this.lastNode=null,this.firstNode=null,this._insertIndex=void 0,this._selectedData.clear(),e.scene().clearClass("drawing"),window.setTimeout(()=>{e.behaviors["map-interaction"].doubleClickEnabled=!0},1e3),e.behaviors.draw.off("move",this._move).off("click",this._click).off("finish",this._finish).off("cancel",this._cancel),e.systems.edits.off("undone",this._undoOrRedo).off("redone",this._undoOrRedo),e.resumeChangeDispatch()}_refreshEntities(){let e=this.context,i=e.scene(),r=e.graph();if(this._selectedData.clear(),i.clearClass("drawing"),this.drawWay=this.drawWay&&r.hasEntity(this.drawWay.id),this.drawNode=this.drawNode&&r.hasEntity(this.drawNode.id),this.lastNode=this.lastNode&&r.hasEntity(this.lastNode.id),this.firstNode=this.firstNode&&r.hasEntity(this.firstNode.id),!this.drawWay||!this.drawNode||!this.lastNode||!this.firstNode){this._cancel();return}this._selectedData.set(this.drawWay.id,this.drawWay),i.classData("osm",this.drawNode.id,"drawing"),i.classData("osm",this.drawWay.id,"drawing")}_getAnnotation(){let e=this.drawWay?.nodes?.length||0;if(e<2)return;let i=e>2?"continue":"start";return this.context.t(`operations.${i}.annotation.line`)}_move(e){if(!this.drawNode)return;let i=this.context,r=i.graph(),s=i.projection,n=e.coord,o=s.invert(n),a=e?.target?.data,l=e?.target?.choice,u=a&&r.hasEntity(a.id);if(u?.type==="node")o=u.loc;else if(u?.type==="way"){let d=Gs(r.childNodes(u),n,s,this.drawNode.id),m=6;d&&d.distance<m&&(o=d.loc)}i.replace(Hc(this.drawNode.id,o)),this.drawNode=i.entity(this.drawNode.id)}_click(e){let i=this.context,r=i.graph(),s=i.projection,n=e.coord,o=s.invert(n);if(i.systems.locations.blocksAt(o).length)return;i.behaviors["map-nudging"].allow();let l=e?.target?.data,u=e?.target?.choice,d=l&&r.hasEntity(l.id);if(d?.type==="node"){this._clickNode(d.loc,d);return}if(d?.type==="way"){let m=Gs(r.childNodes(d),n,s,this.drawNode?.id),g=6;if(m&&m.distance<g){let _=[d.nodes[m.index-1],d.nodes[m.index]];this._clickWay(m.loc,_);return}}this._clickLoc(o)}_clickLoc(e){let r=this.context;if(r.pauseChangeDispatch(),this.drawWay){if(Wi(e,this.lastNode.loc,1e-6)||Wi(e,this.firstNode.loc,1e-6)){this._finish();return}Ll&&console.log(`DrawLineMode: _clickLoc, extending line to ${e}`),r.replace(as(),this._getAnnotation()),this.lastNode=this.drawNode,this.drawNode=vi({loc:e}),r.perform(Or(this.drawNode),xo(this.drawWay.id,this.drawNode.id,this._insertIndex))}else Ll&&console.log(`DrawLineMode: _clickLoc, starting line at ${e}`),this.firstNode=vi({loc:e}),this.lastNode=this.firstNode,this.drawNode=vi({loc:e}),this.drawWay=Cr({tags:this.defaultTags,nodes:[this.firstNode.id,this.drawNode.id]}),r.perform(Or(this.firstNode),Or(this.drawNode),Or(this.drawWay));this._refreshEntities(),r.resumeChangeDispatch()}_clickWay(e,i){let s=this.context,n={loc:e,edge:i};if(s.pauseChangeDispatch(),this.drawWay){if(Wi(e,this.lastNode.loc,1e-6)||Wi(e,this.firstNode.loc,1e-6)){this._finish();return}Ll&&console.log(`DrawLineMode: _clickWay, extending line to edge ${i}`),s.replace(Hc(this.drawNode.id,e),tn(n,this.drawNode),this._getAnnotation()),this.lastNode=this.drawNode,this.drawNode=vi({loc:e}),s.perform(Or(this.drawNode),xo(this.drawWay.id,this.drawNode.id,this._insertIndex))}else Ll&&console.log(`DrawLineMode: _clickWay, starting line at edge ${i}`),this.firstNode=vi({loc:e}),this.lastNode=this.firstNode,this.drawNode=vi({loc:e}),this.drawWay=Cr({tags:this.defaultTags,nodes:[this.firstNode.id,this.drawNode.id]}),s.perform(Or(this.firstNode),Or(this.drawNode),Or(this.drawWay),tn(n,this.firstNode));this._refreshEntities(),s.resumeChangeDispatch()}_clickNode(e,i){let s=this.context;if(s.pauseChangeDispatch(),this.drawWay){if(i===this.lastNode||i===this.firstNode||Wi(e,this.lastNode.loc,1e-6)||Wi(e,this.firstNode.loc,1e-6)){i===this.firstNode&&(s.replace(this._actionRemoveDrawNode(this.drawWay.id,this.drawNode),xo(this.drawWay.id,i.id,this._insertIndex),this._getAnnotation()),this.drawNode=null),this._finish();return}Ll&&console.log(`DrawLineMode: _clickNode, extending line to ${i.id}`),s.replace(this._actionRemoveDrawNode(this.drawWay.id,this.drawNode),xo(this.drawWay.id,i.id,this._insertIndex),this._getAnnotation()),this.lastNode=i,s.perform(Or(this.drawNode),xo(this.drawWay.id,this.drawNode.id,this._insertIndex))}else Ll&&console.log(`DrawLineMode: _clickNode, starting line at ${i.id}`),this.firstNode=i,this.lastNode=i,this.drawNode=vi({loc:e}),this.drawWay=Cr({tags:this.defaultTags,nodes:[i.id,this.drawNode.id]}),s.perform(Or(this.drawNode),Or(this.drawWay));this._refreshEntities(),s.resumeChangeDispatch()}_actionRemoveDrawNode(e,i){return function(r){return r.replace(r.entity(e).removeNode(i.id)).remove(i)}}_finish(){this.drawWay?(Ll&&console.log(`DrawLineMode: _finish, drawWay.id = ${this.drawWay.id}`),this.context.enter("select-osm",{selectedIDs:[this.drawWay.id],newFeature:!0})):this._cancel()}_cancel(){Ll&&console.log("DrawLineMode: _cancel"),this.drawWay=null,this.drawNode=null,this.firstNode=null,this.lastNode=null,this.context.enter("browse")}_undoOrRedo(){this._cancel()}};var z6=class extends gs{constructor(e){super(e),this.id="move",this._entityIDs=[],this._prevGraph=null,this._startLoc=null,this._movementCache=null,this._cancel=this._cancel.bind(this),this._finish=this._finish.bind(this),this._keydown=this._keydown.bind(this),this._pointermove=this._pointermove.bind(this),this._undoOrRedo=this._undoOrRedo.bind(this)}enter(e={}){let i=e.selection;if(!(i instanceof Map)||!i.size)return!1;this._entityIDs=[...i.keys()],this._active=!0;let r=this.context;return r.systems.filters.forceVisible(this._entityIDs),r.enableBehaviors(["map-interaction","map-nudging"]),r.behaviors["map-nudging"].allow(),this._prevGraph=null,this._startLoc=null,this._movementCache=null,r.systems.map.renderer.events.on("click",this._finish).on("keydown",this._keydown).on("pointercancel",this._cancel).on("pointermove",this._pointermove),r.systems.edits.on("undone",this._undoOrRedo).on("redone",this._undoOrRedo),!0}exit(){if(!this._active)return;this._active=!1,this._prevGraph=null,this._startLoc=null,this._movementCache=null;let e=this.context;e.systems.filters.forceVisible([]),this.context.systems.map.renderer.events.off("click",this._finish).off("keydown",this._keydown).off("pointercancel",this._cancel).off("pointermove",this._pointermove),e.systems.edits.off("undone",this._undoOrRedo).off("redone",this._undoOrRedo)}_keydown(e){["Enter"].includes(e.key)?(e.preventDefault(),this._finish()):["Backspace","Delete","Del","Escape","Esc"].includes(e.key)&&(e.preventDefault(),this._cancel())}_pointermove(){let e=this.context,i;this._prevGraph!==e.graph()?(this._startLoc=e.systems.map.mouseLoc(),this._movementCache={},i=e.perform):i=e.overwrite;let r=e.systems.map.mouseLoc();if(e.systems.locations.blocksAt(r).length){this._cancel();return}let n=e.projection.project(this._startLoc),o=e.projection.project(r),a=tr(o,n);i($c(this._entityIDs,a,e.projection,this._movementCache)),this._prevGraph=e.graph(),this._selectedData.clear();for(let l of this._entityIDs)this._selectedData.set(l,e.entity(l))}_finish(){let e=this.context;if(this._prevGraph){let i=this._entityIDs.length===1?e.t("operations.move.annotation."+e.graph().geometry(this._entityIDs[0])):e.t("operations.move.annotation.feature",{n:this._entityIDs.length});e.replace(as(),i)}e.enter("select-osm",{selectedIDs:this._entityIDs})}_cancel(){let e=this.context;this._prevGraph&&e.pop(),e.enter("select-osm",{selectedIDs:this._entityIDs})}_undoOrRedo(){this.context.enter("browse")}};var G6=class extends gs{constructor(e){super(e),this.id="rotate",this._entityIDs=[],this._prevGraph=null,this._lastPoint=null,this._pivotLoc=null,this._cancel=this._cancel.bind(this),this._finish=this._finish.bind(this),this._keydown=this._keydown.bind(this),this._pointermove=this._pointermove.bind(this),this._undoOrRedo=this._undoOrRedo.bind(this)}enter(e={}){let i=e.selection;if(!(i instanceof Map)||!i.size)return!1;this._entityIDs=[...i.keys()],this._active=!0;let r=this.context;return r.systems.filters.forceVisible(this._entityIDs),r.enableBehaviors(["map-interaction"]),this._prevGraph=null,this._lastPoint=null,this._pivotLoc=null,r.systems.map.renderer.events.on("click",this._finish).on("keydown",this._keydown).on("pointercancel",this._cancel).on("pointermove",this._pointermove),r.systems.edits.on("undone",this._undoOrRedo).on("redone",this._undoOrRedo),!0}exit(){if(!this._active)return;this._active=!1,this._prevGraph=null,this._lastPoint=null,this._pivotLoc=null;let e=this.context;e.systems.filters.forceVisible([]),this.context.systems.map.renderer.events.off("click",this._finish).off("keydown",this._keydown).off("pointercancel",this._cancel).off("pointermove",this._pointermove),e.systems.edits.off("undone",this._undoOrRedo).off("redone",this._undoOrRedo)}_keydown(e){["Enter"].includes(e.key)?(e.preventDefault(),this._finish()):["Backspace","Delete","Del","Escape","Esc"].includes(e.key)&&(e.preventDefault(),this._cancel())}_pointermove(){let e=this.context,r=e.systems.map.renderer.events.coord,s;if(this._prevGraph!==e.graph()?(this._pivotLoc=this._calcPivotLoc(),s=e.perform):s=e.replace,this._lastPoint){let n=e.projection.project(this._pivotLoc),[o,a]=tr(r,this._lastPoint),[l,u]=[r[0]>n[0]?1:-1,r[1]>n[1]?-1:1],d=u*o+l*a,m=.3,g=d*(Math.PI/180)*m;s(Pg(this._entityIDs,n,g,e.projection)),this._prevGraph=e.graph()}this._lastPoint=r.slice(),this._selectedData.clear();for(let n of this._entityIDs)this._selectedData.set(n,e.entity(n))}_calcPivotLoc(){let e=this.context.projection,r=ns(this._entityIDs,this.context.graph()).map(n=>e.project(n.loc)),s;return r.length===1?s=r[0]:r.length===2?s=pr(r[0],r[1],.5):ql(r).length===2?s=pr(r[0],r[1],.5):s=da(ql(r)),e.invert(s)}_finish(){let e=this.context;if(this._prevGraph){let i=this._entityIDs.length===1?e.t("operations.rotate.annotation."+e.graph().geometry(this._entityIDs[0])):e.t("operations.rotate.annotation.feature",{n:this._entityIDs.length});e.replace(as(),i)}e.enter("select-osm",{selectedIDs:this._entityIDs})}_cancel(){let e=this.context;this._prevGraph&&e.pop(),e.enter("select-osm",{selectedIDs:this._entityIDs})}_undoOrRedo(){this.context.enter("browse")}};var HO=!1,$6=class extends gs{constructor(e){super(e),this.id="save",this._keybinding=zi("SaveMode"),this._cancel=this._cancel.bind(this),this._hideLoading=this._hideLoading.bind(this),this._keybindingOff=this._keybindingOff.bind(this),this._keybindingOn=this._keybindingOn.bind(this),this._prepareForSuccess=this._prepareForSuccess.bind(this),this._progressChanged=this._progressChanged.bind(this),this._resultConflicts=this._resultConflicts.bind(this),this._resultErrors=this._resultErrors.bind(this),this._resultNoChanges=this._resultNoChanges.bind(this),this._resultSuccess=this._resultSuccess.bind(this),this._saveEnded=this._saveEnded.bind(this),this._saveStarted=this._saveStarted.bind(this),this._showLoading=this._showLoading.bind(this),this._location=null,this._uiConflicts=null,this._uiLoading=null,this._uiSuccess=null,this._wasSuccessfulSave=!1}enter(){HO&&console.log("SaveMode: entering");let e=this.context;e.systems.ui.sidebar.expand();let i=e.services.osm;return i?(this._active=!0,this._wasSuccessfulSave=!1,this._uiCommit=g_(e).on("cancel",this._cancel),i.authenticated()?e.systems.ui.sidebar.show(this._uiCommit):i.authenticate(r=>{r?this._cancel():e.systems.ui.sidebar.show(this._uiCommit)}),e.container().selectAll(".main-content").classed("active",!1).classed("inactive",!0),this._keybindingOn(),e.enableBehaviors(["map-interaction"]),e.systems.uploader.on("progressChanged",this._progressChanged).on("resultConflicts",this._resultConflicts).on("resultErrors",this._resultErrors).on("resultNoChanges",this._resultNoChanges).on("resultSuccess",this._resultSuccess).on("saveEnded",this._saveEnded).on("saveStarted",this._saveStarted).on("willAttemptUpload",this._prepareForSuccess),!0):!1}exit(){this._active&&(this._active=!1,HO&&console.log("SaveMode: exiting"),this._uiCommit.on("cancel",null),this._uiCommit=null,this.context.systems.uploader.off("progressChanged",this._progressChanged).off("resultConflicts",this._resultConflicts).off("resultErrors",this._resultErrors).off("resultNoChanges",this._resultNoChanges).off("resultSuccess",this._resultSuccess).off("saveEnded",this._saveEnded).off("saveStarted",this._saveStarted).off("willAttemptUpload",this._prepareForSuccess),this._keybindingOff(),this._hideLoading(),this.context.container().selectAll(".main-content").classed("active",!0).classed("inactive",!1),this._wasSuccessfulSave||this.context.systems.ui.sidebar.hide())}_cancel(){this.context.enter("browse")}_progressChanged(e,i){let s=this.context.container().select(".loading-modal .modal-section").selectAll(".progress").data([0]);s.enter().append("div").attr("class","progress").merge(s).text(this.context.t("save.conflict_progress",{num:e,total:i}))}_resultConflicts(e,i){let r=this.context,s=r.systems.uploader,n=r.container().select(".sidebar").append("div").attr("class","sidebar-component"),o=r.container().selectAll(".main-content");o.classed("active",!0).classed("inactive",!1),this._uiConflicts=y_(r).conflictList(e).origChanges(i).on("cancel",()=>{o.classed("active",!1).classed("inactive",!0),n.remove(),this._keybindingOn(),s.cancelConflictResolution()}).on("save",()=>{o.classed("active",!1).classed("inactive",!0),n.remove(),s.processResolvedConflicts()}),n.call(this._uiConflicts)}_resultErrors(e){this._keybindingOn();let i=_h(this.context,this.context.container());i.select(".modal-section.header").append("h3").text(this.context.t("save.error")),this._addErrors(i,e),i.okButton()}_addErrors(e,i){let s=e.select(".modal-section.message-text").selectAll(".error-container").data(i),n=s.enter().append("div").attr("class","error-container");n.append("a").attr("class","error-description").attr("href","#").classed("hide-toggle",!0).text(a=>a.msg||this.context.t("save.unknown_error_details")).on("click",function(a){a.preventDefault();let l=ye(this),u=ye(this.nextElementSibling),d=l.classed("expanded");u.style("display",d?"none":"block"),l.classed("expanded",!d)}),n.append("div").attr("class","error-detail-container").style("display","none").append("ul").attr("class","error-detail-list").selectAll("li").data(a=>a.details||[]).enter().append("li").attr("class","error-detail-item").text(a=>a),s.exit().remove()}_resultNoChanges(){let e=this.context;e.resetAsync().then(()=>e.enter("browse"))}_resultSuccess(e){let i=this.context,r=this._uiSuccess.changeset(e).location(this._location).on("cancel",()=>i.systems.ui.sidebar.hide());this._wasSuccessfulSave=!0,i.systems.ui.sidebar.show(r),window.setTimeout(()=>{i.resetAsync().then(()=>i.enter("browse"))},2500)}_saveStarted(){this._keybindingOff(),this._showLoading()}_saveEnded(){this._keybindingOn(),this._hideLoading()}_showLoading(){if(this._saveLoading)return;let e=this.context;this._saveLoading=Vc(e).message(e.tHtml("save.uploading")).blocking(!0),e.container().call(this._saveLoading)}_hideLoading(){this._saveLoading&&(this._saveLoading.close(),this._saveLoading=null)}_keybindingOn(){ye(document).call(this._keybinding.on("\u238B",this._cancel,!0))}_keybindingOff(){ye(document).call(this._keybinding.unbind)}_prepareForSuccess(){this._uiSuccess=px(this.context),this._location=null;let e=this.context.systems.map.center(),i=this.context.services.nominatim;i&&i.reverse(e,(r,s)=>{if(r||!s||!s.address)return;let n=s.address,o=n?.town??n?.city??n?.county??"",a=n?.state??n?.country??"",l=o&&a?this.context.t("success.thank_you_where.separator"):"";this._location=this.context.t("success.thank_you_where.format",{place:o,separator:l,region:a})})}};var VO=!1,H6=class extends gs{constructor(e){super(e),this.id="select",this.keybinding=null,this.extent=null}enter(e={}){let i=e.selection;if(!(i instanceof Map)||!i.size)return!1;let[[r,s]]=i.entries();VO&&console.log(`SelectMode: entering, selected ${r}`),this._selectedData=i,this._active=!0;let n=this.context;n.enableBehaviors(["hover","select","drag","map-interaction","lasso","paste"]);let o=n.systems.ui.sidebar,a=null;this.extent=new mt;for(let l of i.values()){let u;if(l.loc)u=new mt(l.loc);else if(l.__featurehash__){let d=Sb(l);u=new mt(d[0],d[1])}else if(l.__fbid__){let d=n.services[l.__service__];if(!d)continue;let m=d.graph(l.__datasetid__);if(!m)continue;u=l.extent(m)}u&&(this.extent=this.extent.extend(u))}return s instanceof Fr?(a=Z4(n).note(s),a.on("change",()=>{n.systems.map.immediateRedraw();let u=n.services.osm?.getNote(r);u instanceof Fr&&(n.systems.ui.sidebar.show(a.note(u)),this._selectedData.set(r,u))})):s instanceof vr&&s.service==="improveOSM"?(a=W4(n).error(s),a.on("change",()=>{n.systems.map.immediateRedraw();let u=n.services.improveOSM?.getError(r);u instanceof vr&&(n.systems.ui.sidebar.show(a.error(u)),this._selectedData.set(r,u))})):s instanceof vr&&s.service==="keepRight"?(a=Y4(n).error(s),a.on("change",()=>{n.systems.map.immediateRedraw();let u=n.services.keepRight?.getError(r);u instanceof vr&&(n.systems.ui.sidebar.show(a.error(u)),this._selectedData.set(r,u))})):s instanceof vr&&s.service==="osmose"?(a=Q4(n).error(s),a.on("change",()=>{n.systems.map.immediateRedraw();let u=n.services.osmose?.getError(r);u instanceof vr&&(n.systems.ui.sidebar.show(a.error(u)),this._selectedData.set(r,u))})):s.__featurehash__?a=H4(n).datum(s):s.__fbid__&&(this.keybinding=zi("select-ai-features"),a=K4(n,this.keybinding).datum(s)),a&&o.show(a),!0}exit(){this._active&&(this._active=!1,this.extent=null,this.keybinding&&(ye(document).call(this.keybinding.unbind),this.keybinding=null),VO&&console.log("SelectMode: exiting"),this._selectedData.clear(),this.context.systems.ui.sidebar.hide())}};var V6=class extends gs{constructor(e){super(e),this.id="select-osm",this.keybinding=null,this.extent=null,this._newFeature=!1,this._focusedParentID=null,this._singularDatum=null,this._esc=this._esc.bind(this),this._firstVertex=this._firstVertex.bind(this),this._focusNextParent=this._focusNextParent.bind(this),this._lastVertex=this._lastVertex.bind(this),this._nextVertex=this._nextVertex.bind(this),this._previousVertex=this._previousVertex.bind(this),this._undoOrRedo=this._undoOrRedo.bind(this)}enter(e={}){let i=e.selectedIDs;if(this._newFeature=e.newFeature,!Array.isArray(i)||!i.length)return!1;let r=this.context,s=r.systems.locations,n=[];this._selectedData=new Map,this._singularDatum=null;for(let o of i){let a=r.hasEntity(o);a&&(a.type==="node"&&s.blocksAt(a.loc).length||(this._selectedData.set(o,a),n.push(o),i.length===1&&(this._singularDatum=a)))}return this._selectedData.size?(this._active=!0,r.enableBehaviors(["hover","select","drag","map-interaction","lasso","paste"]),this.extent=Ar(n,r.graph()),r.systems.urlhash.setParam("id",n.join(",")),r.systems.filters.forceVisible(n),this.operations.forEach(o=>{o.behavior&&o.behavior.disable()}),this.operations=Object.values(lA).map(o=>o(r,n)).filter(o=>o.id!=="delete"&&o.id!=="downgrade"&&o.id!=="copy").concat([M6(r,n),P6(r,n),ra(r,n)]).filter(o=>o.available()),this.operations.forEach(o=>{o.behavior&&o.behavior.enable()}),r.systems.ui.closeEditMenu(),this.keybinding=zi("select"),this.keybinding.on(["[","pgup"],this._previousVertex).on(["]","pgdown"],this._nextVertex).on(["{",Ri("\u2318["),"home"],this._firstVertex).on(["}",Ri("\u2318]"),"end"],this._lastVertex).on(["\\","pause"],this._focusNextParent).on("\u238B",this._esc,!0),ye(document).call(this.keybinding),r.systems.ui.sidebar.select(n,this._newFeature),r.systems.edits.on("undone",this._undoOrRedo).on("redone",this._undoOrRedo),!0):!1}exit(){if(!this._active)return;this._active=!1;let e=this.context,i=this._singularDatum;if(i&&i.type==="relation"&&Object.keys(i.tags).length===0&&e.graph().parentRelations(i).length===0&&(i.members.length===0||i.members.length===1&&!i.members[0].role)){let r=pn(i.id,!0);e.perform(r,e.t("operations.delete.annotation.relation")),e.systems.validator.validate()}this.extent=null,this._newFeature=!1,this._singularDatum=null,this._selectedData.clear(),this.operations.forEach(r=>{r.behavior&&r.behavior.disable()}),this.operations=[],e.systems.ui.closeEditMenu(),e.systems.ui.sidebar.hide(),e.systems.urlhash.setParam("id",null),e.systems.filters.forceVisible([]),this.keybinding&&(ye(document).call(this.keybinding.unbind),this.keybinding=null),e.systems.edits.off("undone",this._undoOrRedo).off("redone",this._undoOrRedo)}_esc(){let e=this.context;e.container().select(".combobox").size()||e.enter("browse")}_undoOrRedo(){let e=this.context,i=e.systems.locations,r=[];for(let[s,n]of this._selectedData)e.hasEntity(s)&&(n.type==="node"&&i.blocksAt(n.loc).length||r.push(s));r.length?e.enter("select-osm",{selectedIDs:r}):e.enter("browse")}_chooseParentWay(e){if(!e)return null;let i=this.context.graph();if(e.type==="way")this._focusedParentID=e.id;else{let r=i.parentWays(e).map(s=>s.id);r.length?r.includes(this._focusedParentID)||(this._focusedParentID=r[0]):this._focusedParentID=null}return i.hasEntity(this._focusedParentID)}_firstVertex(e){e.preventDefault();let i=this.context,r=this._chooseParentWay(this._singularDatum);if(!r)return;let s=i.entity(r.first());i.enter("select-osm",{selectedIDs:[s.id]}),i.systems.map.centerEase(s.loc)}_lastVertex(e){e.preventDefault();let i=this.context,r=this._chooseParentWay(this._singularDatum);if(!r)return;let s=i.entity(r.last());i.enter("select-osm",{selectedIDs:[s.id]}),i.systems.map.centerEase(s.loc)}_previousVertex(e){e.preventDefault();let i=this.context,r=this._singularDatum;if(r?.type!=="node")return;let s=this._chooseParentWay(this._singularDatum);if(!s)return;let n=s.nodes.indexOf(r.id),o=-1;if(n>0?o=n-1:s.isClosed()&&(o=length-2),o!==-1){let a=i.entity(s.nodes[o]);i.enter("select-osm",{selectedIDs:[a.id]}),i.systems.map.centerEase(a.loc)}}_nextVertex(e){e.preventDefault();let i=this.context,r=this._singularDatum;if(r?.type!=="node")return;let s=this._chooseParentWay(this._singularDatum);if(!s)return;let n=s.nodes.indexOf(r.id),o=-1;if(n<s.nodes.length-1?o=n+1:s.isClosed()&&(o=0),o!==-1){let a=i.entity(s.nodes[o]);i.enter("select-osm",{selectedIDs:[a.id]}),i.systems.map.centerEase(a.loc)}}_focusNextParent(e){e.preventDefault();let i=this._singularDatum;if(i?.type!=="node")return;let s=this.context.graph().parentWays(i).map(n=>n.id);if(s.length){let o=s.indexOf(this._focusedParentID)+1;o>=s.length&&(o=0),this._focusedParentID=s[o]}}};function jO(t){var e={id:"drag-note",button:"browse"};let i=t.behaviors.drag.on("start",u).on("move",d).on("end",g);var r,s,n;function o(_,v){r&&window.clearInterval(r),r=window.setInterval(function(){t.systems.map.pan(v),m(_,v)},50)}function a(){r&&(window.clearInterval(r),r=null)}function l(_){return t.projection.project(_.loc)}function u(_,v){n=v;var E=t.services.osm;E&&(n=E.getNote(n.id)),n.id&&(t.surface().selectAll(".note-"+n.id).classed("active",!0),t.perform(as()),t.enter(e))}function d(_,v,E){_.stopPropagation(),s=t.projection.invert(E),m(_);var b=b8(E,t.systems.map.dimensions);b?o(_,b):a()}function m(_,v){v=v||[0,0];var E=_&&_.point||t.projection.project(s),b=tr(E,v),T=t.projection.invert(b);n=n.move(T);var A=t.services.osm;A&&A.replaceNote(n),t.replace(as())}function g(){t.replace(as());let _=new Map().set(n.id,n);t.enter("select",_)}return e.enter=function(){return t.enableBehaviors(["hover","drag","map-interaction"]),!0},e.exit=function(){t.systems.ui.sidebar.hover.cancel(),t.surface().selectAll(".active").classed("active",!1),a()},e}var Ia={available:new Map};Ia.available.set("add-note",F6);Ia.available.set("add-point",L6);Ia.available.set("browse",N6);Ia.available.set("drag-node",O6);Ia.available.set("draw-area",B6);Ia.available.set("draw-line",U6);Ia.available.set("move",z6);Ia.available.set("rotate",G6);Ia.available.set("save",$6);Ia.available.set("select",H6);Ia.available.set("select-osm",V6);var uK="bdf6c800b3ae453b9db239e03d7c1727",hK="https://openstreetmap.maps.arcgis.com/sharing/rest/content",dK="https://openstreetmap.maps.arcgis.com/home",fK=14,j6=class extends ui{constructor(e){super(e),this.id="esri",this.context=e,this._tiler=new Ns().zoomRange(fK),this._datasets={},this._gotDatasets=!1,this._off=!1,this._parseDataset=this._parseDataset.bind(this)}initAsync(){return this.resetAsync()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){for(let e of Object.values(this._datasets))e.cache.inflight&&Object.values(e.cache.inflight).forEach(i=>this._abortRequest(i)),e.graph=new vn,e.tree=new qa(e.graph),e.cache={inflight:{},loaded:{},seen:{},origIdTile:{},firstNodeIDs:new Set};return Promise.resolve()}getData(e){let i=this._datasets[e];if(!i||!i.tree||!i.graph)return[];let r=this.context.systems.map.extent();return i.tree.intersects(r,i.graph)}loadTiles(e){if(this._off)return;let i=this._datasets[e];if(!i||!i.layer)return;let r=i.cache,s=this.context.systems.locations,n=this.context.projection,o=this._tiler.getTiles(n).tiles;for(let a of Object.keys(r.inflight))o.find(u=>u.id===a)||(this._abortRequest(r.inflight[a]),delete r.inflight[a]);for(let a of o){if(r.loaded[a.id]||r.inflight[a.id])continue;if(a.wgs84Extent.polygon().slice(0,4).every(d=>s.blocksAt(d).length)){r.loaded[a.id]=!0;continue}this._loadTilePage(i,a,0)}}graph(e){return this._datasets[e]?.graph}toggle(e){this._off=!e}loadDatasetsAsync(){if(this._gotDatasets)return Promise.resolve(this._datasets);{let e=this;return new Promise((i,r)=>{n(1);function n(o){fetch(e._searchURL(o)).then(Ai).then(a=>{for(let l of a.results??[])e._parseDataset(l);a.nextStart>0?n(a.nextStart):(e._gotDatasets=!0,i(e._datasets))}).catch(a=>{e._gotDatasets=!1,r(a)})}})}}loadLayerAsync(e){let i=this._datasets[e];return!i||!i.url?Promise.reject(`Unknown datasetID: ${e}`):i.layer?Promise.resolve(i.layer):fetch(this._layerURL(i.url)).then(Ai).then(r=>{if(!r.layers||!r.layers.length)throw new Error(`Missing layer info for datasetID: ${e}`);i.layer=r.layers[0];let s={};for(let n of i.layer.fields)n.type==="esriFieldTypeOID"&&(i.layer.idfield=n.name),n.editable&&(s[n.name]=n.alias);return i.layer.tagmap=s,i.layer}).catch(r=>{r.name!=="AbortError"&&console.error(r)})}_abortRequest(e){e.abort()}_searchURL(e){let i={f:"json",sortField:"title",sortOrder:"asc",num:100,start:e};return`${hK}/groups/${uK}/search?`+nr(i)}_layerURL(e){return`${e}/layers?f=json`}_itemURL(e){return`${dK}/item.html?id=${e}`}_tileURL(e,i,r){r=r||0;let s=e.layer.id,n=e.layer.maxRecordCount||2e3,o=n*r,a={f:"geojson",outfields:"*",outSR:4326,geometryType:"esriGeometryEnvelope",geometry:i.toParam(),resultOffset:o,resultRecordCount:n};return`${e.url}/${s}/query?`+nr(a)}_parseDataset(e){if(this._datasets[e.id])return;this._datasets[e.id]=e,e.graph=new vn,e.tree=new qa(e.graph),e.cache={inflight:{},loaded:{},seen:{},origIdTile:{}};let i=ye(document.createElement("div"));i.html(e.licenseInfo),i.selectAll("*").attr("style",null).attr("size",null),e.license_html=i.html(),e.itemURL=this._itemURL(e.id)}_loadTilePage(e,i,r){let s=e.cache;if(s.loaded[i.id])return;let n=new AbortController,o=this._tileURL(e,i.wgs84Extent,r);fetch(o,{signal:n.signal}).then(Ai).then(a=>{if(!a)throw new Error("no geojson");return this._parseTile(e,i,a,(l,u)=>{if(l)throw new Error(l);e.graph.rebase(u,[e.graph],!0),e.tree.rebase(u,!0)}),a.properties?.exceededTransferLimit}).then(a=>{a?this._loadTilePage(e,i,++r):(s.loaded[i.id]=!0,delete s.inflight[i.id],this.context.deferredRedraw(),this.emit("loadedData"))}).catch(a=>{a.name!=="AbortError"&&console.error(a)}),s.inflight[i.id]=n}_parseTile(e,i,r,s){if(!r)return s({message:"No GeoJSON",status:-1});let n=[];for(let o of r.features??[]){let a=this._parseFeature(o,e);a&&n.push.apply(n,a)}s(null,n)}_parseFeature(e,i){let r=e.geometry,s=e.properties;if(!r||!s)return null;let n=s[i.layer.idfield]||s.OBJECTID||s.FID||s.id;if(!n||i.cache.seen[n])return null;i.cache.seen[n]=!0;let o=`${i.id}-${n}`,a={__fbid__:o,__origid__:o,__service__:"esri",__datasetid__:i.id},l=[],u=new Map;if(r.type==="Point")return[new vi({loc:r.coordinates,tags:m(s)},a)];if(r.type==="LineString"){let _=d(r.coordinates);if(_.length<2)return null;let v=new Cr({nodes:_,tags:m(s)},a);return l.push(v),l}else if(r.type==="Polygon"){let _=[];for(let v of r.coordinates??[]){let E=d(v);if(E.length<3)continue;let b=E[0],T=E[E.length-1];b!==T&&E.push(b);let A=new Cr({nodes:E});_.push(A)}if(_.length===1)l.push(_[0].update(Object.assign({tags:m(s)},a)));else{let v=_.map((T,A)=>(l.push(T),{id:T.id,role:A===0?"outer":"inner",type:"way"})),E=Object.assign(m(s),{type:"multipolygon"}),b=new Cs({members:v,tags:E},a);l.push(b)}return l}function d(_){let v=[];for(let E of _){let b=E.toString(),T=u.get(b);T||(T=new vi({loc:E}),l.push(T),u.set(b,T)),v.push(T.id)}return v}function m(_){let v={};for(let E of Object.keys(_)){let b=g(i.layer.tagmap[E]),T=g(_[E]);b&&T&&(v[b]=T)}return v.source=`esri/${i.name}`,v}function g(_){return _?_.toString().trim():null}}};var XO=Xi(kl(),1);var pK=14,Ux={ow:"https://grab.community.improve-osm.org/directionOfFlowService",mr:"https://grab.community.improve-osm.org/missingGeoService",tr:"https://grab.community.improve-osm.org/turnRestrictionService"},m0=new Map;m0.set("tr",15473700);m0.set("ow",2003199);m0.set("mr-road",11817677);m0.set("mr-path",10506797);m0.set("mr-parking",15658496);m0.set("mr-both",16753920);var X6=class extends ui{constructor(e){super(e),this.id="improveOSM",this.autoStart=!1,this._impOsmData={icons:{}},this._cache=null,this._tiler=new Ns().zoomRange(pK).skipNullIsland(!0)}initAsync(){return this.resetAsync()}startAsync(){return this.context.systems.data.getDataAsync("qa_data").then(i=>{this._impOsmData=i.improveOSM,this._started=!0})}resetAsync(){if(this._cache)for(let e of Object.values(this._cache.inflightTile))this._abortRequest(e);return this._cache={data:{},loadedTile:{},inflightTile:{},inflightPost:{},closed:{},rtree:new XO.default},Promise.resolve()}getData(){let e=this.context.systems.map.extent();return this._cache.rtree.search(e.bbox()).map(i=>i.data)}loadTiles(){let e={client:"Rapid",status:"OPEN",zoom:"19"},i=this.context,r=this._tiler.getTiles(i.projection).tiles;this._abortUnwantedRequests(this._cache,r);for(let s of r){if(this._cache.loadedTile[s.id]||this._cache.inflightTile[s.id])continue;let[n,o,a,l]=s.wgs84Extent.rectangle(),u=Object.assign({},e,{east:n,south:l,west:a,north:o}),d={};for(let m of Object.keys(Ux)){let g=Object.assign({},u,m==="mr"?{type:"PARKING,ROAD,BOTH,PATH"}:{confidenceLevel:"C1"}),_=`${Ux[m]}/search?`+nr(g),v=new AbortController;d[m]=v,fetch(_,{signal:v.signal}).then(Ai).then(E=>{delete this._cache.inflightTile[s.id][m],Object.keys(this._cache.inflightTile[s.id]).length||(delete this._cache.inflightTile[s.id],this._cache.loadedTile[s.id]=!0),E.roadSegments&&E.roadSegments.forEach(b=>{let{points:T,wayId:A,fromNodeId:M,toNodeId:k}=b,F=`${A}${M}${k}`,O=T.length/2,B;O%1===0?B=this._pointAverage([T[O-1],T[O]]):(O=T[Math.floor(O)],B=[O.lon,O.lat]),B=this._preventCoincident(B,!1);let U=new vr(B,this,m,F,{issueKey:m,identifier:{wayId:A,fromNodeId:M,toNodeId:k},objectId:A,objectType:"way"});U.replacements={percentage:b.percentOfTrips,num_trips:b.numberOfTrips,highway:this._linkErrorObject(i.t("QA.keepRight.error_parts.highway")),from_node:this._linkEntity("n"+b.fromNodeId),to_node:this._linkEntity("n"+b.toNodeId)},this._cache.data[U.id]=U,this._cache.rtree.insert(this._encodeIssueRtree(U))}),E.tiles&&E.tiles.forEach(b=>{let{type:T,x:A,y:M,numberOfTrips:k}=b,F=T.toLowerCase(),O=`${F}${A}${M}${k}`,B=this._pointAverage(b.points);B=this._preventCoincident(B,!1);let U=new vr(B,this,`${m}-${F}`,O,{issueKey:m,identifier:{x:A,y:M}});U.replacements={num_trips:k,geometry_type:i.t(`QA.improveOSM.geometry_types.${F}`)},k===-1&&(U.desc=i.t("QA.improveOSM.error_types.mr.description_alt",U.replacements)),this._cache.data[U.id]=U,this._cache.rtree.insert(this._encodeIssueRtree(U))}),E.entities&&E.entities.forEach(b=>{let{point:T,id:A,segments:M,numberOfPasses:k,turnType:F}=b,O=`${A.replace(/[,:+#]/g,"_")}`,B=this._preventCoincident([T.lon,T.lat],!0),U=A.split(","),$=U[0],q=U[3],W=U[2].split(":")[1],Z=new vr(B,this,m,O,{issueKey:m,identifier:A,objectId:q,objectType:"node"}),[Q,X]=M[0].points,ce=this._cardinalDirection(this._relativeBearing(Q,X));Z.replacements={num_passed:k,num_trips:M[0].numberOfTrips,turn_restriction:F.toLowerCase(),from_way:this._linkEntity("w"+$),to_way:this._linkEntity("w"+W),travel_direction:ce,junction:this._linkErrorObject(i.t("QA.keepRight.error_parts.this_node"))},this._cache.data[Z.id]=Z,this._cache.rtree.insert(this._encodeIssueRtree(Z)),this.context.deferredRedraw(),this.emit("loadedData")})}).catch(E=>{console.error(E),delete this._cache.inflightTile[s.id][m],Object.keys(this._cache.inflightTile[s.id]).length||(delete this._cache.inflightTile[s.id],this._cache.loadedTile[s.id]=!0)})}this._cache.inflightTile[s.id]=d}}getCommentsAsync(e){if(e.comments)return Promise.resolve(e);let i=e.issueKey,r={};i==="ow"?r=e.identifier:i==="mr"?(r.tileX=e.identifier.x,r.tileY=e.identifier.y):i==="tr"&&(r.targetId=e.identifier);let s=`${Ux[i]}/retrieveComments?`+nr(r),n=o=>{e.comments=o.comments?o.comments.reverse():[],this.replaceItem(e)};return fetch(s).then(Ai).then(n).then(()=>e)}postUpdate(e,i){let r=this.context.services.osm;if(!r||!r.authenticated())return i({message:"Not Authenticated",status:-3},e);if(this._cache.inflightPost[e.id])return i({message:"Error update already inflight",status:-2},e);r.userDetails(s.bind(this));function s(n,o){if(n)return i(n,e);let a=e.issueKey,l=`${Ux[a]}/comment`,u={username:o.display_name,targetIds:[e.identifier]};e.newStatus&&(u.status=e.newStatus,u.text="status changed"),e.newComment&&(u.text=e.newComment);let d=new AbortController;this._cache.inflightPost[e.id]=d;let m={method:"POST",signal:d.signal,body:JSON.stringify(u)};fetch(l,m).then(Ai).then(()=>{if(delete this._cache.inflightPost[e.id],e.newStatus)this.removeItem(e),e.newStatus==="SOLVED"&&(e.issueKey in this._cache.closed||(this._cache.closed[e.issueKey]=0),this._cache.closed[e.issueKey]+=1);else{let g=new Date,_=e.comments?e.comments:[];_.push({username:u.username,text:u.text,timestamp:g.getTime()/1e3}),this.replaceItem(e.update({comments:_,newComment:void 0}))}i&&i(null,e)}).catch(g=>{delete this._cache.inflightPost[e.id],i&&i(g.message)})}}getError(e){return this._cache.data[e]}getColor(e){return m0.get(e)??16777215}getIcon(e){return this._impOsmData.icons[e]}replaceItem(e){if(!(!(e instanceof vr)||!e.id))return this._cache.data[e.id]=e,this._updateRtree(this._encodeIssueRtree(e),!0),e}removeItem(e){!(e instanceof vr)||!e.id||(delete this._cache.data[e.id],this._updateRtree(this._encodeIssueRtree(e),!1))}getClosedCounts(){return this._cache.closed}_abortRequest(e){for(let i of Object.values(e))i.abort()}_abortUnwantedRequests(e,i){for(let r of Object.keys(e.inflightTile))i.find(n=>r===n.id)||(this._abortRequest(e.inflightTile[r]),delete e.inflightTile[r])}_encodeIssueRtree(e){return{minX:e.loc[0],minY:e.loc[1],maxX:e.loc[0],maxY:e.loc[1],data:e}}_updateRtree(e,i){this._cache.rtree.remove(e,(r,s)=>r.data.id===s.data.id),i&&this._cache.rtree.insert(e)}_linkErrorObject(e){return`<a class="error_object_link">${e}</a>`}_linkEntity(e){return`<a class="error_entity_link">${e}</a>`}_pointAverage(e){if(e.length){let i=e.reduce((r,s)=>Sr(r,[s.lon,s.lat]),[0,0]);return Uo(i,1/e.length)}else return[0,0]}_relativeBearing(e,i){let r=Math.atan2(i.lon-e.lon,i.lat-e.lat);return r<0&&(r+=2*Math.PI),r*180/Math.PI}_cardinalDirection(e){let i=45*Math.round(e/45),r={0:"north",45:"northeast",90:"east",135:"southeast",180:"south",225:"southwest",270:"west",315:"northwest",360:"north"};return this.context.t(`QA.improveOSM.directions.${r[i]}`)}_preventCoincident(e,i){let r=!1;do{e=Sr(e,r?[1e-5,0]:i?[0,1e-5]:[0,0]);let n=new mt(e).bbox();r=this._cache.rtree.search(n).length}while(r);return e}};var YO=Xi(kl(),1);var WO="https://kartaview.org",qO=1e3,mK=14,W6=class extends ui{constructor(e){super(e),this.id="kartaview",this.autoStart=!1,this._imgZoom=Df().extent([[0,0],[320,240]]).translateExtent([[0,0],[320,240]]).scaleExtent([1,15]),this._cache={},this._selectedImage=null,this._waitingForPhotoID=null,this._startPromise=null,this._tiler=new Ns().zoomRange(mK).skipNullIsland(!0),this._zoomPan=this._zoomPan.bind(this)}initAsync(){return this.resetAsync()}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context,r=e.container().select(".photoviewer").selectAll(".osc-wrapper").data([0]).enter().append("div").attr("class","photo-wrapper osc-wrapper").classed("hide",!0).call(this._imgZoom.on("zoom",this._zoomPan)).on("dblclick.zoom",null);r.append("div").attr("class","photo-attribution fillD");let s=r.append("div").attr("class","photo-controls-wrap").append("div").attr("class","photo-controls");return s.append("button").on("click.back",()=>this._step(-1)).html("\u25C4"),s.append("button").on("click.rotate-ccw",()=>this._rotate(-90)).html("\u293F"),s.append("button").on("click.rotate-cw",()=>this._rotate(90)).html("\u293E"),s.append("button").on("click.forward",()=>this._step(1)).html("\u25BA"),r.append("div").attr("class","osc-image-wrap"),e.systems.ui.photoviewer.on("resize.kartaview",n=>{this._imgZoom=Df().extent([[0,0],n]).translateExtent([[0,0],n]).scaleExtent([1,15]).on("zoom",this._zoomPan)}),this._started=!0,this._startPromise=Promise.resolve()}resetAsync(){if(this._cache.inflight)for(let e of this._cache.inflight.values())e.controller.abort();return this._cache={inflight:new Map,loaded:new Set,nextPage:new Map,images:new Map,sequences:new Map,rtree:new YO.default},this._selectedImage=null,Promise.resolve()}getImages(){let e=this.context.systems.map.extent();return this._cache.rtree.search(e.bbox()).map(i=>i.data)}getSequences(){let e=this.context.systems.map.extent(),i=new Set;for(let s of this._cache.rtree.search(e.bbox()))s.data.sequenceID&&i.add(s.data.sequenceID);let r=[];for(let s of i){let n=this._cache.sequences.get(s),o=n?.images??[];o.length&&r.push({type:"LineString",properties:{id:s,v:n.v,captured_at:o[0]?.captured_at,captured_by:o[0]?.captured_by},coordinates:o.map(a=>a.loc).filter(Boolean)})}return r}loadTiles(){let e=this.context.projection,i=Math.floor(Ba(e.scale())),r=this._tiler.getTiles(e).tiles;for(let[s,n]of this._cache.inflight)r.find(a=>s.indexOf(a.id)===0)||n.controller.abort();for(let s of r)this._loadNextTilePage(i,s)}showViewer(){let e=this.context.container().select(".photoviewer").classed("hide",!1);e.selectAll(".photo-wrapper.osc-wrapper.hide").size()&&(e.selectAll(".photo-wrapper:not(.osc-wrapper)").classed("hide",!0),e.selectAll(".photo-wrapper.osc-wrapper").classed("hide",!1))}hideViewer(){this._selectedImage=null;let e=this.context;e.systems.photos.selectPhoto(null);let i=e.container().select(".photoviewer");i.empty()||i.datum(null),i.classed("hide",!0).selectAll(".photo-wrapper").classed("hide",!0),e.container().selectAll(".viewfield-group, .sequence, .icon-sign").classed("currentView",!1),this.setStyles(e,null,!0),this.emit("imageChanged")}selectImageAsync(e){let i=this._cache.images.get(e);this._selectedImage=i;let r=this.context;if(!r.container())return;let s=r.container().select(".photoviewer");if(s.empty()||s.datum(i),this.setStyles(r,null,!0),r.container().selectAll(".icon-sign").classed("currentView",!1),e&&!i&&(this._waitingForPhotoID=e),!i)return Promise.resolve();let n=r.container().select(".photoviewer .osc-wrapper"),o=n.selectAll(".osc-image-wrap"),a=n.selectAll(".photo-attribution").html("");if(n.transition().duration(100).call(this._imgZoom.transform,yl),o.selectAll(".osc-image").remove(),i){let d=this._cache.sequences.get(i.sequenceID)?.rotation??0;o.append("img").attr("class","osc-image").attr("src",`${WO}/${i.imagePath}`).style("transform",`rotate(${d}deg)`),i.captured_by&&(a.append("a").attr("class","captured_by").attr("target","_blank").attr("href","https://kartaview.org/user/"+encodeURIComponent(i.captured_by)).text("@"+i.captured_by),a.append("span").text("|")),i.captured_at&&(a.append("span").attr("class","captured_at").text(l(i.captured_at)),a.append("span").text("|")),a.append("a").attr("class","image-link").attr("target","_blank").attr("href",`https://kartaview.org/details/${i.sequenceID}/${i.sequenceIndex}`).text("kartaview.org")}return Promise.resolve();function l(u){if(!u)return null;let d={day:"numeric",month:"short",year:"numeric"},m=new Date(u);if(isNaN(m.getTime()))return null;let g=r.systems.l10n.localeCode();return m.toLocaleDateString(g,d)}}setStyles(e,i,r){r&&(e.container().selectAll(".viewfield-group").classed("highlighted",!1).classed("hovered",!1).classed("currentView",!1),e.container().selectAll(".sequence").classed("highlighted",!1).classed("currentView",!1));let s=i?.id,n=i?.sequenceID,o=n&&this._cache.sequences.get(n),a=o&&o.images.map(function(b){return b.id})||[],l=e.container().select(".photoviewer"),u=l.empty()?void 0:l.datum(),d=u?.id,m=u?.sequenceID,g=m&&this._cache.sequences.get(m),_=g&&g.images.map(function(b){return b.id})||[],v=ss(a,_);e.container().selectAll(".layer-kartaview .viewfield-group").classed("highlighted",function(b){return v.indexOf(b.id)!==-1}).classed("hovered",function(b){return b.id===s}).classed("currentView",function(b){return b.id===d}),e.container().selectAll(".layer-kartaview .sequence").classed("highlighted",function(b){return b.properties.id===n}).classed("currentView",function(b){return b.properties.id===m}),e.container().selectAll(".layer-kartaview .viewfield-group .viewfield").attr("d",E);function E(){let b=this.parentNode.__data__;return b.isPano&&b.id!==d?"M 8,13 m -10,0 a 10,10 0 1,0 20,0 a 10,10 0 1,0 -20,0":"M 6,9 C 8,8.4 8,8.4 10,9 L 16,-2 C 12,-5 4,-5 0,-2 z"}}_maxPageAtZoom(e){if(e<15)return 2;if(e===15)return 5;if(e===16)return 10;if(e===17)return 20;if(e===18)return 40;if(e>18)return 80}_loadNextTilePage(e,i){let r=i.wgs84Extent.bbox(),s=this._maxPageAtZoom(e),n=this._cache.nextPage.get(i.id)??1;if(n>s)return;let o=`${i.id},${n}`;if(this._cache.loaded.has(o)||this._cache.inflight.has(o))return;let a=nr({ipp:qO,page:n,bbTopLeft:[r.maxY,r.minX].join(","),bbBottomRight:[r.minY,r.maxX].join(",")},!0),l=new AbortController,u={method:"POST",signal:l.signal,body:a,headers:{"Content-Type":"application/x-www-form-urlencoded"}},d=`${WO}/1.0/list/nearby-photos/`,m=fetch(d,u).then(Ai).then(g=>{if(this._cache.loaded.add(o),!g||!g.currentPageItems||!g.currentPageItems.length)throw new Error("No Data");let _=null,v=g.currentPageItems.map(E=>{let b=E.id;if(this._waitingForPhotoID===b&&(_=b,this._waitingForPhotoID=null),this._cache.images.has(b))return null;let T=[+E.lng,+E.lat],A={id:b,loc:T,ca:+E.heading,captured_at:E.shot_date||E.date_added,captured_by:E.username,imagePath:E.lth_name,sequenceID:E.sequence_id,sequenceIndex:+E.sequence_index};this._cache.images.set(b,A);let M=this._cache.sequences.get(A.sequenceID);return M||(M={rotation:0,images:[],v:0},this._cache.sequences.set(A.sequenceID,M)),M.images[A.sequenceIndex]=A,M.v++,{minX:T[0],minY:T[1],maxX:T[0],maxY:T[1],data:A}}).filter(Boolean);if(this._cache.rtree.load(v),g.currentPageItems.length===qO?(this._cache.nextPage.set(i.id,n+1),this._loadNextTilePage(e,i)):this._cache.nextPage.set(i.id,1/0),_){let E=this.context.systems.photos;E.selectPhoto(),E.selectPhoto("kartaview",_)}this.context.deferredRedraw(),this.emit("loadedData")}).catch(g=>{g.name!=="AbortError"&&g instanceof Error&&console.error(g)}).finally(()=>{this._cache.inflight.delete(o)});this._cache.inflight.set(o,{promise:m,controller:l})}_zoomPan(e){let i=e.transform;this.context.container().select(".photoviewer .osc-image-wrap").call(Sl,i.x,i.y,i.k)}_rotate(e){if(!this._selectedImage)return;let i=this._selectedImage.sequenceID,r=this._cache.sequences.get(i);if(!r)return;let s=r.rotation||0;s+=e,s>180&&(s-=360),s<-180&&(s+=360),r.rotation=s;let n=this.context.container().select(".photoviewer .osc-wrapper");n.transition().duration(100).call(this._imgZoom.transform,yl),n.selectAll(".osc-image").transition().duration(100).style("transform",`rotate(${s}deg)`)}_step(e){if(!this._selectedImage)return;let i=this._selectedImage.sequenceID,r=this._cache.sequences.get(i);if(!r)return;let s=this._selectedImage.sequenceIndex+e,n=r.images[s];if(!n)return;let o=this.context;o.systems.map.centerEase(n.loc),o.systems.photos.selectPhoto("kartaview",n.id),this.emit("imageChanged")}};var ZO=Xi(kl(),1);var fA="https://www.keepright.at",gK=14,yK=[30,40,50,60,70,90,100,110,120,130,150,160,170,180,190,191,192,193,194,195,196,197,198,200,201,202,203,204,205,206,207,208,210,220,230,231,232,270,280,281,282,283,284,285,290,291,292,293,294,295,296,297,298,300,310,311,312,313,320,350,360,370,380,390,400,401,402,410,411,412,413],Xn=new Map;["20","40","210","270","310","320","350"].forEach(t=>Xn.set(t,16777113));["60","70","90","100","110","150","220","380"].forEach(t=>Xn.set(t,5627136));["360","370","410"].forEach(t=>Xn.set(t,16751035));Xn.set("50",16777113);Xn.set("120",13382485);Xn.set("130",16755251);Xn.set("160",12281344);Xn.set("170",16776960);Xn.set("180",11193582);Xn.set("190",16724787);Xn.set("200",16629615);Xn.set("230",12281344);Xn.set("280",6244256);Xn.set("290",11193582);Xn.set("300",39168);Xn.set("390",39168);Xn.set("400",13382485);var q6=class extends ui{constructor(e){super(e),this.id="keepRight",this.autoStart=!1,this._krData={errorTypes:{},localizeStrings:{}},this._cache=null,this._tiler=new Ns().zoomRange(gK).skipNullIsland(!0)}initAsync(){return this.resetAsync()}startAsync(){return this.context.systems.data.getDataAsync("keepRight").then(i=>{this._krData=i,this._started=!0})}resetAsync(){return this._cache&&Object.values(this._cache.inflightTile).forEach(e=>this._abortRequest(e)),this._cache={data:{},loadedTile:{},inflightTile:{},inflightPost:{},closed:{},rtree:new ZO.default},Promise.resolve()}getData(){let e=this.context.systems.map.extent();return this._cache.rtree.search(e.bbox()).map(i=>i.data)}loadTiles(){let e={format:"geojson",ch:yK},i=this.context.projection,r=this._tiler.getTiles(i).tiles;this._abortUnwantedRequests(this._cache,r);for(let s of r){if(this._cache.loadedTile[s.id]||this._cache.inflightTile[s.id])continue;let[n,o,a,l]=s.wgs84Extent.rectangle(),u=Object.assign({},e,{left:n,bottom:l,right:a,top:o}),d=`${fA}/export.php?`+nr(u),m=new AbortController;this._cache.inflightTile[s.id]=m,fetch(d,{signal:m.signal}).then(Ai).then(g=>{if(delete this._cache.inflightTile[s.id],this._cache.loadedTile[s.id]=!0,!g||!g.features||!g.features.length)throw new Error("No Data");for(let _ of g.features){let{properties:{error_type:v,error_id:E,comment:b=null,object_id:T,object_type:A,schema:M,title:k}}=_,{geometry:{coordinates:F},properties:{description:O=""}}=_,B=this._krData.errorTypes[v],U=(Math.floor(v/10)*10).toString(),$=B?v:U,q=this._krData.errorTypes[$];switch($){case"170":O=`This feature has a FIXME tag: ${O}`;break;case"292":case"293":O=O.replace("A turn-","This turn-");break;case"294":case"295":case"296":case"297":case"298":O=`This turn-restriction~${O}`;break;case"300":O="This highway is missing a maxspeed tag";break;case"411":case"412":case"413":O=`This feature~${O}`;break}let W=!1;do{F=Sr(F,W?[1e-5,0]:[0,1e-5]);let X=new mt(F).bbox();W=this._cache.rtree.search(X).length}while(W);let Z=new vr(F,this,v,E,{comment:b,description:O,whichType:$,parentIssueType:U,severity:q.severity||"error",objectId:T,objectType:A,schema:M,title:k});Z.replacements=this._tokenReplacements(Z),this._cache.data[E]=Z,this._cache.rtree.insert(this._encodeIssueRtree(Z))}this.context.deferredRedraw(),this.emit("loadedData")}).catch(()=>{delete this._cache.inflightTile[s.id],this._cache.loadedTile[s.id]=!0})}}postUpdate(e,i){if(this._cache.inflightPost[e.id])return i({message:"Error update already inflight",status:-2},e);let r={schema:e.schema,id:e.id};e.newStatus&&(r.st=e.newStatus),e.newComment!==void 0&&(r.co=e.newComment);let s=`${fA}/comment.php?`+nr(r),n=new AbortController;this._cache.inflightPost[e.id]=n,fetch(s,{signal:n.signal}).then(Ai).finally(()=>{delete this._cache.inflightPost[e.id],e.newStatus==="ignore"?this.removeItem(e):e.newStatus==="ignore_t"?(this.removeItem(e),this._cache.closed[`${e.schema}:${e.id}`]=!0):e=this.replaceItem(e.update({comment:e.newComment,newComment:void 0,newState:void 0})),i&&i(null,e)})}getError(e){return this._cache.data[e]}getColor(e){return Xn.get(e)??16777215}replaceItem(e){return!(e instanceof vr)||!e.id?null:(this._cache.data[e.id]=e,this._updateRtree(this._encodeIssueRtree(e),!0),e)}removeItem(e){!(e instanceof vr)||!e.id||(delete this._cache.data[e.id],this._updateRtree(this._encodeIssueRtree(e),!1))}issueURL(e){return`${fA}/report_map.php?schema=${e.schema}&error=${e.id}`}getClosedIDs(){return Object.keys(this._cache.closed).sort()}_abortRequest(e){e&&e.abort()}_abortUnwantedRequests(e,i){Object.keys(e.inflightTile).forEach(r=>{i.find(n=>r===n.id)||(this._abortRequest(e.inflightTile[r]),delete e.inflightTile[r])})}_encodeIssueRtree(e){return{minX:e.loc[0],minY:e.loc[1],maxX:e.loc[0],maxY:e.loc[1],data:e}}_updateRtree(e,i){this._cache.rtree.remove(e,(r,s)=>r.data.id===s.data.id),i&&this._cache.rtree.insert(e)}_tokenReplacements(e){if(!(e instanceof vr))return;let i=new RegExp(/<\/[a-z][\s\S]*>/),r={},s=this._krData.errorTypes[e.whichType];if(!s){console.log("No Template: ",e.whichType),console.log("  ",e.description);return}if(!s.regex)return;let n=new RegExp(s.regex,"i"),o=n.exec(e.description);if(!o){console.log("Unmatched: ",e.whichType),console.log("  ",e.description),console.log("  ",n);return}for(let a=1;a<o.length;a++){let l=o[a],u;if(u="IDs"in s?s.IDs[a-1]:"",u&&l)l=this._parseError(l,u);else if(i.test(l))l="\\"+l+"\\";else{let d=l.toLowerCase();this._krData.localizeStrings[d]&&(l=this.context.t("QA.keepRight.error_parts."+this._krData.localizeStrings[d]))}r["var"+a]=l}return r}_parseError(e,i){let r=e.toLowerCase();switch(this._krData.localizeStrings[r]&&(e=this.context.t("QA.keepRight.error_parts."+this._krData.localizeStrings[r])),i){case"this":e=s(e);break;case"url":e=o(e);break;case"n":case"w":case"r":e=n(i+e);break;case"20":e=m(e);break;case"211":e=a(e);break;case"231":e=l(e);break;case"294":e=u(e);break;case"370":e=d(e);break}return e;function s(g){return`<a class="error_object_link">${g}</a>`}function n(g){return`<a class="error_entity_link">${g}</a>`}function o(g){return`<a class="kr_external_link" target="_blank" href="${g}">${g}</a>`}function a(g){let _=[],v=g.split(", ");for(let E of v){let b=n("n"+E.slice(1));_.push(b)}return _.join(", ")}function l(g){let _=[],v=g.split("),");for(let E of v){let b=E.match(/\#(\d+)\((.+)\)?/);b!==null&&b.length>2&&_.push(n("w"+b[1])+" "+this.context.t("QA.keepRight.errorTypes.231.layer",{layer:b[2]}))}return _.join(", ")}function u(g){let _=[],v=g.split(",");for(let E of v){let b=E.split(" "),T=`"${b[0]}"`,A=b[1].slice(0,1),M=b[2].slice(1);M=n(A+M),_.push(`${T} ${b[1]} ${M}`)}return _.join(", ")}function d(g){if(!g)return"";let _=g.match(/\(including the name (\'.+\')\)/);return _?.length?this.context.t("QA.keepRight.errorTypes.370.including_the_name",{name:_[1]}):""}function m(g){let _=[],v=g.split(",");for(let E of v){let b=n("n"+E.slice(1));_.push(b)}return _.join(", ")}}};var vA=Xi(gA(),1),bA=Xi(xA(),1),Hx=Xi(kl(),1);var lp="MLY|3376030635833192|f13ab0bdf6b2f7b99e0d8bd5868e1d88",uB="https://graph.mapillary.com/",wA="https://tiles.mapillary.com/maps/vtp",XK=`${wA}/mly1_public/2/{z}/{x}/{y}?access_token=${lp}`,WK=`${wA}/mly_map_feature_point/2/{z}/{x}/{y}?access_token=${lp}`,qK=`${wA}/mly_map_feature_traffic_sign/2/{z}/{x}/{y}?access_token=${lp}`,YK="mapillary-js/mapillary.css",ZK="mapillary-js/mapillary.js",QK=14,Y6=class extends ui{constructor(e){super(e),this.id="mapillary",this._startPromise=null,this._mlyActiveImage=null,this._mlyCache={},this._mlyIsFallback=!1,this._mlyHighlightedDetection=null,this._mlyShowFeatureDetections=!1,this._mlyShowSignDetections=!1,this._mlyViewer=null,this._mlyViewerFilter=["all"],this._tiler=new Ns().zoomRange(QK).skipNullIsland(!0)}initAsync(){return this.resetAsync()}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context;return e.container().select(".photoviewer").selectAll(".mly-wrapper").data([0]).enter().append("div").attr("id","rapideditor-mly").attr("class","photo-wrapper mly-wrapper").classed("hide",!0),this._startPromise=new Promise((r,s)=>{let n=0;function o(){n+=1,n===2&&r()}let a=ye("head");a.selectAll("#rapideditor-mapillary-viewercss").data([0]).enter().append("link").attr("id","rapideditor-mapillary-viewercss").attr("rel","stylesheet").attr("crossorigin","anonymous").attr("href",e.asset(YK)).on("load",o).on("error",s),a.selectAll("#rapideditor-mapillary-viewerjs").data([0]).enter().append("script").attr("id","rapideditor-mapillary-viewerjs").attr("crossorigin","anonymous").attr("src",e.asset(ZK)).on("load",o).on("error",s)}).then(()=>this._initViewer()).then(()=>this._started=!0).catch(r=>{r instanceof Error&&console.error(r),this._startPromise=null}),this._startPromise}resetAsync(){return this._mlyCache.requests&&Object.values(this._mlyCache.requests.inflight).forEach(function(e){e.abort()}),this._mlyCache={images:{rtree:new Hx.default,forImageID:{}},signs:{rtree:new Hx.default},points:{rtree:new Hx.default},sequences:new Map,image_detections:{forImageID:{}},requests:{loaded:{},inflight:{}}},this._mlyActiveImage=null,Promise.resolve()}getData(e){if(!["images","signs","points"].includes(e))return[];let i=this.context.systems.map.extent();return this._mlyCache[e].rtree.search(i.bbox()).map(s=>s.data)}getSequences(){let e=this.context.systems.map.extent(),i=new Map;for(let r of this._mlyCache.images.rtree.search(e.bbox())){let s=r.data.sequenceID;if(!s)continue;let n=this._mlyCache.sequences.get(s);n&&(i.has(s)||i.set(s,n))}return[...i.values()]}loadTiles(e){if(!["images","signs","points"].includes(e))return;let i=this.context.projection,r=this._tiler.getTiles(i).tiles;for(let s of r)this._loadTile(e,s)}resetTags(){this._mlyViewer&&!this._mlyIsFallback&&this._mlyViewer.getComponent("tag").removeAll()}showFeatureDetections(e){this._mlyShowFeatureDetections=e,!this._mlyShowFeatureDetections&&!this._mlyShowSignDetections&&this.resetTags()}showSignDetections(e){this._mlyShowSignDetections=e,!this._mlyShowFeatureDetections&&!this._mlyShowSignDetections&&this.resetTags()}filterViewer(){let e=this.context.systems.photos,i=e.showsPanoramic,r=e.showsFlat,s=e.fromDate,n=e.toDate,o=["all"];return i||o.push(["!=","cameraType","spherical"]),!r&&i&&o.push(["==","pano",!0]),s&&o.push([">=","capturedAt",new Date(s).getTime()]),n&&o.push([">=","capturedAt",new Date(n).getTime()]),this._mlyViewer&&this._mlyViewer.setFilter(o),this._mlyViewerFilter=o,o}showViewer(){let e=this.context.container().select(".photoviewer").classed("hide",!1);e.selectAll(".photo-wrapper.mly-wrapper.hide").size()&&this._mlyViewer&&(e.selectAll(".photo-wrapper:not(.mly-wrapper)").classed("hide",!0),e.selectAll(".photo-wrapper.mly-wrapper").classed("hide",!1),this._mlyViewer.resize())}hideViewer(){this._mlyActiveImage=null;let e=this.context;e.systems.photos.selectPhoto(null),!this._mlyIsFallback&&this._mlyViewer&&this._mlyViewer.getComponent("sequence").stop();let i=e.container().select(".photoviewer");i.empty()||i.datum(null),i.classed("hide",!0).selectAll(".photo-wrapper").classed("hide",!0),this.setStyles(e,null),this.emit("imageChanged")}highlightDetection(e){return e&&(this._mlyHighlightedDetection=e.id),this}selectImageAsync(e){return e?this.startAsync().then(()=>this._mlyViewer.moveTo(e).catch(i=>console.error("mly3",i))):Promise.resolve()}getActiveImage(){return this._mlyActiveImage}getDetectionsAsync(e){return this._loadDataAsync(`${uB}/${e}/detections?access_token=${lp}&fields=id,value,image`)}setActiveImage(e){e?this._mlyActiveImage={ca:e.originalCompassAngle,id:e.id,loc:[e.originalLngLat.lng,e.originalLngLat.lat],isPano:e.cameraType==="spherical",sequenceID:e.sequenceID}:this._mlyActiveImage=null}setStyles(e,i){let r=i?.id,s=i?.sequenceID,n=this._mlyActiveImage&&this._mlyActiveImage.sequenceID;e.container().selectAll(".layer-mapillary .viewfield-group").classed("highlighted",function(o){return o.sequenceID===n||o.id===r}).classed("hovered",function(o){return o.id===r}),e.container().selectAll(".layer-mapillary .sequence").classed("highlighted",function(o){return o.properties.id===s}).classed("currentView",function(o){return o.properties.id===n})}updateDetections(e,i){if(!this._mlyViewer||this._mlyIsFallback||!e)return;let r=this._mlyCache.image_detections,s=r.forImageID[e];s?this._showDetections(s):this._loadDataAsync(i).then(n=>{for(let o of n)r.forImageID[e]||(r.forImageID[e]=[]),r.forImageID[e].push({id:o.id,geometry:o.geometry,image_id:e,value:o.value});this._showDetections(r.forImageID[e]||[])})}_showDetections(e){let i=this._mlyViewer.getComponent("tag");for(let r of e){let s=this._makeTag(r);s&&i.add([s])}}_makeTag(e){let i=e.value.split("--");if(!i.length)return;let r,s,n=16777215;this._mlyHighlightedDetection===e.id&&(n=16776960,s=i[1],(s==="flat"||s==="discrete"||s==="sign")&&(s=i[2]),s=s.replace(/-/g," "),s=s.charAt(0).toUpperCase()+s.slice(1),this._mlyHighlightedDetection=null);let o=window.atob(e.geometry),a=new Uint8Array(o.length);for(let _=0;_<o.length;_++)a[_]=o.charCodeAt(_);let u=new vA.VectorTile(new bA.default(a.buffer)).layers["mpy-or"],m=u.feature(0).loadGeometry().map(_=>_.map(v=>[v.x/u.extent,v.y/u.extent])),g=window.mapillary;return r=new g.OutlineTag(e.id,new g.PolygonGeometry(m[0]),{text:s,textColor:n,lineColor:n,lineWidth:2,fillColor:n,fillOpacity:.3}),r}_loadTile(e,i){if(!["images","signs","points"].includes(e))return;let r=this._mlyCache.requests,s=`${i.id}-${e}`;if(r.loaded[s]||r.inflight[s])return;let n=new AbortController;r.inflight[s]=n;let o={images:XK,signs:qK,points:WK}[e];o=o.replace("{x}",i.xyz[0]).replace("{y}",i.xyz[1]).replace("{z}",i.xyz[2]),fetch(o,{signal:n.signal}).then(Ai).then(a=>{if(r.loaded[s]=!0,!a)throw new Error("No Data");this._loadTileDataToCache(a,i),this.context.deferredRedraw(),e==="images"?this.emit("loadedImages"):e==="signs"?this.emit("loadedSigns"):e==="points"&&this.emit("loadedMapFeatures")}).catch(a=>{a.name!=="AbortError"&&(a instanceof Error&&console.error(a),r.loaded[s]=!0)}).finally(()=>{delete r.inflight[s]})}_loadTileDataToCache(e,i){let r=new vA.VectorTile(new bA.default(e));if(r.layers.hasOwnProperty("image")){let s=this._mlyCache.images,n=r.layers.image,o=[];for(let a=0;a<n.length;a++){let l=n.feature(a).toGeoJSON(i.xyz[0],i.xyz[1],i.xyz[2]);if(!l||s.forImageID[l.properties.id]!==void 0)continue;let u=l.geometry.coordinates,d={id:l.properties.id,loc:u,captured_at:l.properties.captured_at,ca:l.properties.compass_angle,isPano:l.properties.is_pano,sequenceID:l.properties.sequence_id};s.forImageID[d.id]=d,o.push({minX:u[0],minY:u[1],maxX:u[0],maxY:u[1],data:d})}s.rtree.load(o)}if(r.layers.hasOwnProperty("sequence")){let s=this._mlyCache.sequences,n=r.layers.sequence;for(let o=0;o<n.length;o++){let a=n.feature(o).toGeoJSON(i.xyz[0],i.xyz[1],i.xyz[2]);if(!a)continue;let l=a.properties.id,u=s.get(l);u||(u=[],s.set(l,u)),u.push(a)}}if(r.layers.hasOwnProperty("point")){let s=this._mlyCache.points,n=r.layers.point,o=[];for(let a=0;a<n.length;a++){let l=n.feature(a).toGeoJSON(i.xyz[0],i.xyz[1],i.xyz[2]);if(!l)continue;let u=l.geometry.coordinates,d={id:l.properties.id,loc:u,first_seen_at:l.properties.first_seen_at,last_seen_at:l.properties.last_seen_at,value:l.properties.value};o.push({minX:u[0],minY:u[1],maxX:u[0],maxY:u[1],data:d})}s.rtree.load(o)}if(r.layers.hasOwnProperty("traffic_sign")){let s=this._mlyCache.signs,n=r.layers.traffic_sign,o=[];for(let a=0;a<n.length;a++){let l=n.feature(a).toGeoJSON(i.xyz[0],i.xyz[1],i.xyz[2]),u=l.geometry.coordinates,d={id:l.properties.id,loc:u,first_seen_at:l.properties.first_seen_at,last_seen_at:l.properties.last_seen_at,value:l.properties.value};o.push({minX:u[0],minY:u[1],maxX:u[0],maxY:u[1],data:d})}s.rtree.load(o)}}_loadDataAsync(e){return fetch(e).then(Ai).then(i=>i?.data||[]).catch(i=>{i.name!=="AbortError"&&i instanceof Error&&console.error(i)})}_initViewer(){let e=window.mapillary;if(!e)return;let i=this.context,r={accessToken:lp,component:{cover:!1,keyboard:!1,tag:!0},container:"rapideditor-mly"};!e.isSupported()&&e.isFallbackSupported()&&(this._mlyIsFallback=!0,r.component={cover:!1,direction:!1,imagePlane:!1,keyboard:!1,mouse:!1,sequence:!1,tag:!1,image:!0,navigation:!0});let s=o=>{this.resetTags();let a=o.image;this.setActiveImage(a),this.setStyles(i,null);let l=[a.originalLngLat.lng,a.originalLngLat.lat];i.systems.map.centerEase(l),i.systems.photos.selectPhoto("mapillary",a.id),(this._mlyShowFeatureDetections||this._mlyShowSignDetections)&&this.updateDetections(a.id,`${uB}/${a.id}/detections?access_token=${lp}&fields=id,image,geometry,value`),this.emit("imageChanged")},n=o=>{this.emit("bearingChanged",void 0,o)};this._mlyViewer=new e.Viewer(r),this._mlyViewer.on("image",s),this._mlyViewer.on("bearing",n),this._mlyViewerFilter&&this._mlyViewer.setFilter(this._mlyViewerFilter),i.systems.ui.photoviewer.on("resize.mapillary",()=>{this._mlyViewer&&this._mlyViewer.resize()})}};var KK="https://mapwith.ai/maps/ml_roads",JK=16,Z6=class extends ui{constructor(e){super(e),this.id="mapwithai",this._tiler=new Ns().zoomRange(JK),this._datasets={},this._deferred=new Set,this._off=!1,this._parseNode=this._parseNode.bind(this),this._parseWay=this._parseWay.bind(this)}initAsync(){return this.resetAsync().then(()=>{let e="rapid_intro_graph",i=new vn,r=new qa(i),n={id:e,graph:i,tree:r,cache:{inflight:{},loaded:{},seen:{},origIdTile:{},firstNodeIDs:new Set}};this._datasets[e]=n})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){for(let e of this._deferred)window.cancelIdleCallback(e),this._deferred.delete(e);for(let e of Object.values(this._datasets))e.cache.inflight&&Object.values(e.cache.inflight).forEach(i=>this._abortRequest(i)),e.graph=new vn,e.tree=new qa(e.graph),e.cache={inflight:{},loaded:{},seen:{},origIdTile:{},firstNodeIDs:new Set};return Promise.resolve()}getData(e){let i=this._datasets[e];if(!i||!i.tree||!i.graph)return[];let r=this.context.systems.map.extent();return i.tree.intersects(r,i.graph)}loadTiles(e){if(this._off)return;let i=this._datasets[e],r,s,n;i?(r=i.graph,s=i.tree,n=i.cache):(r=new vn,s=new qa(r),n={inflight:{},loaded:{},seen:{},origIdTile:{},firstNodeIDs:new Set},i={id:e,graph:r,tree:s,cache:n},this._datasets[e]=i);let o=this.context.systems.locations,a=this.context.projection,l=this._tiler.getTiles(a).tiles;for(let u of Object.keys(n.inflight))l.find(m=>m.id===u)||(this._abortRequest(n.inflight[u]),delete n.inflight[u]);for(let u of l){if(n.loaded[u.id]||n.inflight[u.id])continue;if(u.wgs84Extent.polygon().slice(0,4).every(v=>o.blocksAt(v).length)){n.loaded[u.id]=!0;continue}let g=this._tileURL(i,u.wgs84Extent),_=new AbortController;fetch(g,{signal:_.signal}).then(Ai).then(v=>{delete n.inflight[u.id],v&&this._parseXML(i,v,u,(E,b)=>{E||(r.rebase(b,[r],!0),s.rebase(b,!0),n.loaded[u.id]=!0,this.context.deferredRedraw(),this.emit("loadedData"))})}).catch(v=>{v.name!=="AbortError"&&console.error(v)}),n.inflight[u.id]=_}}graph(e){return this._datasets[e]?.graph}merge(e,i){let r=this._datasets[e];!r||!r.tree||!r.graph||(r.graph.rebase(i,[r.graph],!1),r.tree.rebase(i,!1))}toggle(e){this._off=!e}_abortRequest(e){e.abort()}_tileURL(e,i){let r=/-conflated$/.test(e.id),s=e.id.replace("-conflated",""),n={conflate_with_osm:r,theme:"ml_road_vector",collaborator:"fbid",token:"ASZUVdYpCkd3M6ZrzjXdQzHulqRMnxdlkeBJWEKOeTUoY_Gwm9fuEd2YObLrClgDB_xfavizBsh0oDfTWTF7Zb4C",hash:"ASYM8LPNy8k1XoJiI7A"};s==="fbRoads"?n.result_type="road_vector_xml":s==="msBuildings"?(n.result_type="road_building_vector_xml",n.building_source="microsoft"):(n.result_type="osm_xml",n.sources=`esri_building.${s}`),n.bbox=i.toParam();let o=this.context.systems.rapid.taskExtent;return o&&(n.crop_bbox=o.toParam()),KK+"?"+l(n,!0);function l(u,d){function m(g){return encodeURIComponent(g).replace(/(%2F|%3A|%2C|%7B|%7D)/g,decodeURIComponent)}return Object.keys(u).map(g=>encodeURIComponent(g)+"="+(d?m(u[g]):encodeURIComponent(u[g]))).join("&")}}_getLoc(e){let i=e.lon?.value,r=e.lat?.value;return[parseFloat(i),parseFloat(r)]}_getNodes(e){return Array.from(e.getElementsByTagName("nd")).map(r=>"n"+r.attributes.ref.value)}_getTags(e){let i=Array.from(e.getElementsByTagName("tag")),r={};for(let s of i){let n=s.attributes,o=(n.k.value??"").trim(),a=(n.v.value??"").trim();o&&a&&(r[o]=a)}return r}_getVisible(e){return!e.visible||e.visible.value!=="false"}_parseNode(e,i){let r=e.attributes;return new vi({id:i,visible:this._getVisible(r),loc:this._getLoc(r),tags:this._getTags(e)})}_parseWay(e,i){let r=e.attributes;return new Cr({id:i,visible:this._getVisible(r),tags:this._getTags(e),nodes:this._getNodes(e)})}_parseXML(e,i,r,s,n){if(n=Object.assign({skipSeen:!0},n),!i||!i.childNodes)return s({message:"No XML",status:-1});let a=i.childNodes[0].childNodes,l=window.requestIdleCallback(()=>{this._deferred.delete(l);let u=[];for(let d of a){let m=this._parseChild(e,r,d,n);m&&u.push(m)}s(null,u)});this._deferred.add(l)}_parseChild(e,i,r,s){let n=e.graph,o=e.cache,a;if(r.nodeName==="node"?a=this._parseNode:r.nodeName==="way"&&(a=this._parseWay),!a)return null;let l=Dt.id.fromOSM(r.nodeName,r.attributes.id.value);if(s.skipSeen){if(o.seen[l]||o.origIdTile[l])return null;o.seen[l]=!0}let u;if(r.attributes.orig_id){if(u=Dt.id.fromOSM(r.nodeName,r.attributes.orig_id.value),n.hasEntity(u)||o.origIdTile[u]&&o.origIdTile[u]!==i.id)return null;o.origIdTile[u]=i.id}let d=a(r,l);if(/^msBuildings/.test(e.id)&&d.type==="way"){let g=d.nodes[0];if(o.firstNodeIDs.has(g))return null;o.firstNodeIDs.add(g)}let m={__fbid__:r.attributes.id.value,__origid__:u,__service__:"mapwithai",__datasetid__:e.id};return Object.assign(d,m)}};var EA=Xi(kl(),1);var Q6=class extends ui{constructor(e){super(e),this.id="nominatim",this.apibase="https://nominatim.openstreetmap.org/",this._inflight={},this._nominatimCache=new EA.default,this.countryCode=this.countryCode.bind(this),this.reverse=this.reverse.bind(this),this.search=this.search.bind(this)}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Object.values(this._inflight).forEach(e=>e.abort()),this._inflight={},this._nominatimCache=new EA.default,Promise.resolve()}countryCode(e,i){this.reverse(e,(r,s)=>r?i(r):s.address?i(null,s.address.country_code):i("Unable to geocode",null))}reverse(e,i){let r=this._nominatimCache.search({minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]});if(r.length>0){i&&i(null,r[0].data);return}let s={zoom:13,format:"json",addressdetails:1,lat:e[1],lon:e[0]},n=this.apibase+"reverse?"+nr(s);if(this._inflight[n])return;let o=new AbortController;this._inflight[n]=o;let a=this.context.systems.l10n,l={signal:o.signal,headers:{"Accept-Language":a.localeCodes().join(",")}};fetch(n,l).then(Ai).then(u=>{if(delete this._inflight[n],u?.error)throw new Error(u.error);let d=new mt(e).padByMeters(200);this._nominatimCache.insert(Object.assign(d.bbox(),{data:u})),i&&i(null,u)}).catch(u=>{delete this._inflight[n],u.name!=="AbortError"&&i&&i(u.message)})}search(e,i){let r=encodeURIComponent(e),s=this.apibase+`search?q=${r}&limit=10&format=json`;if(this._inflight[s])return;let n=new AbortController;this._inflight[s]=n;let o=this.context.systems.l10n,a={signal:n.signal,headers:{"Accept-Language":o.localeCodes().join(",")}};fetch(s,a).then(Ai).then(l=>{if(delete this._inflight[s],l?.error)throw new Error(l.error);i&&i(null,l)}).catch(l=>{delete this._inflight[s],l.name!=="AbortError"&&i&&i(l.message)})}};var mB=Xi(Am(),1);var hB=Xi(_9(),1);function g0(t){return typeof t!="string"?"":hB.default.remove(t.replace(/&/g,"and").replace(/(|i)/ig,"i").replace(/[\s\-=_!"#%'*{},.\/:;?\(\)\[\]@\\$\^*+<>~`\u00a1\u00a7\u00b6\u00b7\u00bf\u037e\u0387\u055a-\u055f\u0589\u05c0\u05c3\u05c6\u05f3\u05f4\u0609\u060a\u060c\u060d\u061b\u061e\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0830-\u083e\u085e\u0964\u0965\u0970\u0af0\u0df4\u0e4f\u0e5a\u0e5b\u0f04-\u0f12\u0f14\u0f85\u0fd0-\u0fd4\u0fd9\u0fda\u104a-\u104f\u10fb\u1360-\u1368\u166d\u166e\u16eb-\u16ed\u1735\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u1805\u1807-\u180a\u1944\u1945\u1a1e\u1a1f\u1aa0-\u1aa6\u1aa8-\u1aad\u1b5a-\u1b60\u1bfc-\u1bff\u1c3b-\u1c3f\u1c7e\u1c7f\u1cc0-\u1cc7\u1cd3\u2000-\u206f\u2cf9-\u2cfc\u2cfe\u2cff\u2d70\u2e00-\u2e7f\u3001-\u3003\u303d\u30fb\ua4fe\ua4ff\ua60d-\ua60f\ua673\ua67e\ua6f2-\ua6f7\ua874-\ua877\ua8ce\ua8cf\ua8f8-\ua8fa\ua92e\ua92f\ua95f\ua9c1-\ua9cd\ua9de\ua9df\uaa5c-\uaa5f\uaade\uaadf\uaaf0\uaaf1\uabeb\ufe10-\ufe16\ufe19\ufe30\ufe45\ufe46\ufe49-\ufe4c\ufe50-\ufe52\ufe54-\ufe57\ufe5f-\ufe61\ufe68\ufe6a\ufe6b\ufeff\uff01-\uff03\uff05-\uff07\uff0a\uff0c\uff0e\uff0f\uff1a\uff1b\uff1f\uff20\uff3c\uff61\uff64\uff65]+/g,"").toLowerCase())}var dB={matchGroups:{adult_gaming_centre:["amenity/casino","amenity/gambling","leisure/adult_gaming_centre"],bar:["amenity/bar","amenity/pub","amenity/restaurant"],beauty:["shop/beauty","shop/hairdresser_supply"],bed:["shop/bed","shop/furniture"],beverages:["shop/alcohol","shop/beer","shop/beverages","shop/kiosk","shop/wine"],camping:["tourism/camp_site","tourism/caravan_site"],car_parts:["shop/car_parts","shop/car_repair","shop/tires","shop/tyres"],clinic:["amenity/clinic","amenity/doctors","healthcare/clinic","healthcare/laboratory","healthcare/physiotherapist","healthcare/sample_collection","healthcare/dialysis"],convenience:["shop/beauty","shop/chemist","shop/convenience","shop/cosmetics","shop/grocery","shop/kiosk","shop/newsagent","shop/perfumery"],coworking:["amenity/coworking_space","office/coworking","office/coworking_space"],dentist:["amenity/dentist","amenity/doctors","healthcare/dentist"],electronics:["office/telecommunication","shop/appliance","shop/computer","shop/electronics","shop/hifi","shop/kiosk","shop/mobile","shop/mobile_phone","shop/telecommunication","shop/video_games"],fabric:["shop/fabric","shop/haberdashery","shop/sewing"],fashion:["shop/accessories","shop/bag","shop/boutique","shop/clothes","shop/department_store","shop/fashion","shop/fashion_accessories","shop/sports","shop/shoes"],financial:["amenity/bank","office/accountant","office/financial","office/financial_advisor","office/tax_advisor","shop/tax"],fitness:["leisure/fitness_centre","leisure/fitness_center","leisure/sports_centre","leisure/sports_center"],food:["amenity/cafe","amenity/fast_food","amenity/ice_cream","amenity/restaurant","shop/bakery","shop/candy","shop/chocolate","shop/coffee","shop/confectionary","shop/confectionery","shop/food","shop/kiosk","shop/ice_cream","shop/pastry","shop/tea"],fuel:["amenity/fuel","shop/gas","shop/convenience;gas","shop/gas;convenience"],gift:["shop/gift","shop/card","shop/cards","shop/kiosk","shop/stationery"],hardware:["shop/bathroom_furnishing","shop/carpet","shop/diy","shop/doityourself","shop/doors","shop/electrical","shop/flooring","shop/hardware","shop/hardware_store","shop/power_tools","shop/tool_hire","shop/tools","shop/trade"],health_food:["shop/health","shop/health_food","shop/herbalist","shop/nutrition_supplements"],hobby:["shop/electronics","shop/hobby","shop/books","shop/games","shop/collector","shop/toys","shop/model","shop/video_games","shop/anime"],hospital:["amenity/doctors","amenity/hospital","healthcare/hospital"],houseware:["shop/houseware","shop/interior_decoration"],water_rescue:["amenity/lifeboat_station","emergency/lifeboat_station","emergency/marine_rescue","emergency/water_rescue"],lodging:["tourism/guest_house","tourism/hotel","tourism/motel"],money_transfer:["amenity/money_transfer","shop/money_transfer"],office_supplies:["shop/office_supplies","shop/stationary","shop/stationery"],outdoor:["shop/clothes","shop/outdoor","shop/sports"],parcel_locker:["amenity/parcel_locker","amenity/vending_machine"],pharmacy:["amenity/doctors","amenity/pharmacy","healthcare/pharmacy","shop/chemist"],playground:["amenity/theme_park","leisure/amusement_arcade","leisure/playground"],rental:["amenity/bicycle_rental","amenity/boat_rental","amenity/car_rental","amenity/truck_rental","amenity/vehicle_rental","shop/kiosk","shop/plant_hire","shop/rental","shop/tool_hire"],school:["amenity/childcare","amenity/college","amenity/kindergarten","amenity/language_school","amenity/prep_school","amenity/school","amenity/university"],storage:["shop/storage_units","shop/storage_rental"],substation:["power/station","power/substation","power/sub_station"],supermarket:["shop/food","shop/frozen_food","shop/greengrocer","shop/grocery","shop/supermarket","shop/wholesale"],thrift:["shop/charity","shop/clothes","shop/second_hand"],tobacco:["shop/e-cigarette","shop/tobacco"],variety_store:["shop/variety_store","shop/discount","shop/convenience"],vending:["amenity/vending_machine","shop/kiosk","shop/vending_machine"],weight_loss:["amenity/clinic","amenity/doctors","amenity/weight_clinic","healthcare/counselling","leisure/fitness_centre","office/therapist","shop/beauty","shop/diet","shop/food","shop/health_food","shop/herbalist","shop/nutrition","shop/nutrition_supplements","shop/weight_loss"],wholesale:["shop/wholesale","shop/supermarket","shop/department_store"]}};var fB={genericWords:["^(barn|bazaa?r|bench|bou?tique|building|casa|church)$","^(baseball|basketball|football|soccer|softball|tennis(halle)?)\\s?(field|court)?$","^(club|green|out|ware)\\s?house$","^(driveway|el \xE1rbol|fountain|generic|golf|government|graveyard)$","^(fixme|n\\s?\\/?\\s?a|name|no\\s?name|none|null|temporary|test|unknown)$","^(hofladen|librairie|magazine?|maison)$","^(mobile home|skate)?\\s?park$","^(obuwie|pond|pool|sale|shops?|sklep|stores?)$","^\\?+$","^private$","^tattoo( studio)?$","^windmill$","^\u0446\u0435\u0440\u043A\u043E\u0432\u043D\u0430\u044F( \u043B\u0430\u0432\u043A\u0430)?$"]};var pB={trees:{brands:{emoji:"\u{1F354}",mainTag:"brand:wikidata",sourceTags:["brand","name"],nameTags:{primary:"^(name|name:\\w+)$",alternate:"^(brand|brand:\\w+|operator|operator:\\w+|\\w+_name|\\w+_name:\\w+)$"}},flags:{emoji:"\u{1F6A9}",mainTag:"flag:wikidata",nameTags:{primary:"^(flag:name|flag:name:\\w+)$",alternate:"^(country|country:\\w+|flag|flag:\\w+|subject|subject:\\w+)$"}},operators:{emoji:"\u{1F4BC}",mainTag:"operator:wikidata",sourceTags:["operator"],nameTags:{primary:"^(name|name:\\w+|operator|operator:\\w+)$",alternate:"^(brand|brand:\\w+|\\w+_name|\\w+_name:\\w+)$"}},transit:{emoji:"\u{1F687}",mainTag:"network:wikidata",sourceTags:["network"],nameTags:{primary:"^network$",alternate:"^(operator|operator:\\w+|network:\\w+|\\w+_name|\\w+_name:\\w+)$"}}}};var TA=dB.matchGroups,rJ=pB.trees,K6=class{constructor(){this.matchIndex=void 0,this.genericWords=new Map,(fB.genericWords||[]).forEach(e=>this.genericWords.set(e,new RegExp(e,"i"))),this.itemLocation=void 0,this.locationSets=void 0,this.locationIndex=void 0,this.warnings=[]}buildMatchIndex(e){let i=this;if(i.matchIndex)return;i.matchIndex=new Map;let r=new Map;Object.keys(e).forEach(o=>{let a=e[o],l=o.split("/",3),u=l[0],d=l[1],m=l[2],g=`${d}/${m}`,_=rJ[u],v=i.matchIndex.get(g);v||(v={primary:new Map,alternate:new Map,excludeGeneric:new Map,excludeNamed:new Map},i.matchIndex.set(g,v));let b=(a.properties||{}).exclude||{};(b.generic||[]).forEach($=>v.excludeGeneric.set($,new RegExp($,"i"))),(b.named||[]).forEach($=>v.excludeNamed.set($,new RegExp($,"i")));let T=[...v.excludeGeneric.values(),...v.excludeNamed.values()],A=a.items;if(!Array.isArray(A)||!A.length)return;let M=new RegExp(_.nameTags.primary,"i"),k=new RegExp(_.nameTags.alternate,"i"),F=/:(colou?r|type|forward|backward|left|right|etymology|pronunciation|wikipedia)$/i,O=n(u,d,m),B=new Set([`${d}/yes`,"building/yes"]),U=new Set;Object.values(TA).forEach($=>{$.some(W=>W===g)&&$.forEach(W=>{if(W===g)return;U.add(W);let Z=W.split("/",2)[0];B.add(`${Z}/yes`)})}),A.forEach($=>{if(!$.id)return;Array.isArray($.matchTags)&&$.matchTags.length&&($.matchTags=$.matchTags.filter(Z=>!U.has(Z)&&Z!==g&&!B.has(Z)),$.matchTags.length||delete $.matchTags);let q=[`${g}`].concat($.matchTags||[]);O||(q=q.concat(Array.from(B))),Object.keys($.tags).forEach(Z=>{if(F.test(Z))return;let Q=$.tags[Z];!Q||T.some(X=>X.test(Q))||(M.test(Z)?q.forEach(X=>s("primary",u,X,g0(Q),$.id)):k.test(Z)&&q.forEach(X=>s("alternate",u,X,g0(Q),$.id)))});let W=new Set;($.matchNames||[]).forEach(Z=>{let Q=g0(Z);q.forEach(X=>{let ce=i.matchIndex.get(X),de=ce&&ce.primary.get(Q),le=ce&&ce.alternate.get(Q),te=de&&de.has($.id),ee=le&&le.has($.id);!te&&!ee&&(s("alternate",u,X,Q,$.id),W.add(Z))})}),W.size?$.matchNames=Array.from(W):delete $.matchNames})});function s(o,a,l,u,d){if(!u){i.warnings.push(`Warning: skipping empty ${o} name for item ${a}/${l}: ${d}`);return}let m=i.matchIndex.get(l);m||(m={primary:new Map,alternate:new Map,excludeGeneric:new Map,excludeNamed:new Map},i.matchIndex.set(l,m));let g=m[o].get(u);if(g||(g=new Set,m[o].set(u,g)),g.add(d),!/yes$/.test(l)){let _=`${l}/${u}`,v=r.get(_);if(v&&v!==a){let E=Array.from(g);i.warnings.push(`Duplicate cache key "${_}" in trees "${a}" and "${v}", check items: ${E}`);return}r.set(_,a)}}function n(o,a,l){return o==="flags"||o==="transit"||a==="landuse"||l==="atm"||l==="bicycle_parking"||l==="car_sharing"||l==="caravan_site"||l==="charging_station"||l==="dog_park"||l==="parking"||l==="phone"||l==="playground"||l==="post_box"||l==="public_bookcase"||l==="recycling"||l==="vending_machine"}}buildLocationIndex(e,i){let r=this;if(r.locationIndex)return;r.itemLocation=new Map,r.locationSets=new Map,Object.keys(e).forEach(n=>{let o=e[n].items;!Array.isArray(o)||!o.length||o.forEach(a=>{if(r.itemLocation.has(a.id))return;let l;try{l=i.resolveLocationSet(a.locationSet)}catch(d){console.warn(`buildLocationIndex: ${d.message}`)}if(!l||!l.id||(r.itemLocation.set(a.id,l.id),r.locationSets.has(l.id)))return;let u=s(l.feature);if(u.id=l.id,u.properties.id=l.id,!u.geometry.coordinates.length||!u.properties.area){console.warn(`buildLocationIndex: locationSet ${l.id} for ${a.id} resolves to an empty feature:`),console.warn(JSON.stringify(u));return}r.locationSets.set(l.id,u)})}),r.locationIndex=(0,mB.default)({type:"FeatureCollection",features:[...r.locationSets.values()]});function s(n){return JSON.parse(JSON.stringify(n))}}match(e,i,r,s){let n=this;if(!n.matchIndex)throw new Error("match:  matchIndex not built.");let o;Array.isArray(s)&&n.locationIndex&&(o=n.locationIndex([s[0],s[1],s[0],s[1]],!0));let a=g0(r),l=new Set,u=[];if(d("primary"),d("alternate"),u.length)return u;return d("exclude"),u.length?u:null;function d(g){let _=`${e}/${i}`,v=m(g,_);if(!v){for(let E in TA){let b=TA[E];if(b.some(A=>A===_))for(let A=0;A<b.length;A++){let M=b[A];if(M!==_&&(v=m(g,M),v))return}}if(g==="exclude"){let E=[...n.genericWords.values()].find(b=>b.test(r));if(E){u.push({match:"excludeGeneric",pattern:String(E)});return}}}}function m(g,_){let v=n.matchIndex.get(_);if(!v)return;if(g==="exclude"){let F=[...v.excludeNamed.values()].find(O=>O.test(r));if(F){u.push({match:"excludeNamed",pattern:String(F),kv:_});return}if(F=[...v.excludeGeneric.values()].find(O=>O.test(r)),F){u.push({match:"excludeGeneric",pattern:String(F),kv:_});return}return}let E=v[g].get(a);if(!E||!E.size)return;let b=Array.from(E).map(F=>{let O=1/0;if(n.itemLocation&&n.locationSets){let B=n.locationSets.get(n.itemLocation.get(F));O=B&&B.properties.area||1/0}return{match:g,itemID:F,area:O,kv:_,nsimple:a}}),T=k;if(o&&(b=b.filter(A),T=M),!b.length)return;return b.sort(T).forEach(F=>{l.has(F.itemID)||(l.add(F.itemID),u.push(F))}),!0;function A(F){return n.itemLocation?o.find(O=>O.id===n.itemLocation.get(F.itemID)):!0}function M(F,O){return F.area-O.area}function k(F,O){return O.area-F.area}}}getWarnings(){return this.warnings}};var sJ={"building/commercial":!0,"building/government":!0,"building/hotel":!0,"building/retail":!0,"building/office":!0,"building/supermarket":!0,"building/yes":!0},nJ=/:(colou?r|type|forward|backward|left|right|etymology|pronunciation|wikipedia)$/i,oJ=/(coop|express|wireless|factory|outlet)/i,J6=class extends ui{constructor(e){super(e),this.id="nsi",this.status="loading",this._nsi={}}initAsync(){let e={nsi_data:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/nsi.min.json",nsi_dissolved:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/dissolved.min.json",nsi_features:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/featureCollection.min.json",nsi_generics:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/genericWords.min.json",nsi_presets:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/presets/nsi-id-presets.min.json",nsi_replacements:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/replacements.min.json",nsi_trees:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/trees.min.json"},r=this.context.systems.data.fileMap;for(let[n,o]of Object.entries(e))r.has(n)||r.set(n,o);return this.context.systems.presets.initAsync().then(()=>this._loadNsiPresetsAsync()).then(()=>this._loadNsiDataAsync()).then(()=>this.status="ok").catch(n=>{console.error(n),this.status="failed"})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}isGenericName(e){let i=e.name;if(!i)return!1;let r={primary:new Set([i]),alternate:new Set},s=this._gatherKVs(e);if(!s.primary.size&&!s.alternate.size)return!1;let n=this._gatherTuples(s,r);for(let o of n){let a=this._nsi.matcher.match(o.k,o.v,o.n);if(a?.length&&a[0].match==="excludeGeneric")return!0}return!1}upgradeTags(e,i){let r=Object.assign({},e),s=!1;for(let d of Object.keys(r)){let m=d.match(/^(\w+:)?wikidata$/);if(m){let g=m[1]||"",_=r[d],v=this._nsi.replacements[_];if(v?.wikidata!==void 0&&(s=!0,v.wikidata?r[d]=v.wikidata:delete r[d]),v?.wikipedia!==void 0){s=!0;let E=`${g}wikipedia`;v.wikipedia?r[E]=v.wikipedia:delete r[E]}}}let n=e.type==="route_master",o=this._gatherKVs(e);if(!o.primary.size&&!o.alternate.size)return s?{newTags:r,matched:null}:null;let a=this._gatherNames(e),l=this._nsi.qids.get(e.wikidata)||this._nsi.qids.get(e.wikipedia);if(l&&a.primary.add(l),!a.primary.size&&!a.alternate.size)return s?{newTags:r,matched:null}:null;let u=this._gatherTuples(o,a);for(let d of u){let m=this._nsi.matcher.match(d.k,d.v,d.n,i);if(!m||!m.length)continue;if(m[0].match!=="primary"&&m[0].match!=="alternate")break;let g,_;for(let $ of m){if(g=$.itemID,this._nsi.dissolved[g]||(_=this._nsi.ids.get(g),!_))continue;let q=_.mainTag,W=_.tags[q],Z=r[`not:${q}`];if(!W||W===Z||r.office&&!_.tags.office){_=null;continue}else break}if(!_)continue;_=JSON.parse(JSON.stringify(_));let v=_.tkv,E=v.split("/",3),b=E[1],T=E[2],M=this._nsi.data[v].properties||{},k=_.preserveTags||M.preserveTags||[];["building","emergency","internet_access","takeaway"].forEach($=>{b!==$&&k.push(`^${$}$`)});let F=k.map($=>new RegExp($,"i")),O={};for(let $ of Object.keys(r))F.some(q=>q.test($))&&(O[$]=r[$]);this._nsi.kvt.forEach(($,q)=>{r[q]==="yes"&&delete r[q]}),l&&(delete r.wikipedia,delete r.wikidata),Object.assign(r,_.tags,O),n&&(r.route_master=r.route,delete r.route);let B=e.name,U=r.name;if(U&&B&&U!==B&&!r.branch){let $=this._gatherNames(r);if(!new Set([...$.primary,...$.alternate]).has(B)){let Z=B.split(/[\s\-\/,.]/);for(let Q=Z.length;Q>0;Q--){let X=Z.slice(0,Q).join(" "),ce=Z.slice(Q).join(" "),de=this._nsi.matcher.match(b,T,X,i);if(!(!de||!de.length)&&de.some(le=>le.itemID===g)){if(ce)if(oJ.test(ce))r.name=B;else{let le=this._nsi.matcher.match(b,T,ce,i);if(le&&le.length){if(le[0].match==="primary"||le[0].match==="alternate")return null}else r.branch=ce}break}}}}return{newTags:r,matched:_}}return s?{newTags:r,matched:null}:null}_loadNsiPresetsAsync(){let e=this.context.systems.data;return Promise.all([e.getDataAsync("nsi_presets"),e.getDataAsync("nsi_features")]).then(i=>{Object.values(i[0].presets).forEach(s=>s.suggestion=!0),this.context.systems.presets.merge({presets:i[0].presets,featureCollection:i[1]})})}_loadNsiDataAsync(){let e=this.context.systems.data;return Promise.all([e.getDataAsync("nsi_data"),e.getDataAsync("nsi_dissolved"),e.getDataAsync("nsi_replacements"),e.getDataAsync("nsi_trees")]).then(i=>{this._nsi={data:i[0].nsi,dissolved:i[1].dissolved,replacements:i[2].replacements,trees:i[3].trees,kvt:new Map,qids:new Map,ids:new Map};let r=this._nsi.matcher=new K6;r.buildMatchIndex(this._nsi.data),r.itemLocation=new Map,r.locationSets=new Map;let s=this.context.systems.locations;for(let n of Object.values(this._nsi.data))for(let o of n.items??[]){if(r.itemLocation.has(o.id))continue;let a=s.locationSetID(o.locationSet);if(r.itemLocation.set(o.id,a),r.locationSets.has(a))continue;let l={id:a,properties:{id:a,area:1}};r.locationSets.set(a,l)}r.locationIndex=n=>{let o=s.locationSetsAt([n[0],n[1]]),a=[];for(let[l,u]of Object.entries(o)){let d=r.locationSets.get(l);d&&(d.properties.area=u,a.push(d))}return a},Object.keys(this._nsi.data).forEach(n=>{let o=this._nsi.data[n],[a,l,u]=n.split("/",3),d=this._nsi.kvt.get(l);d||(d=new Map,this._nsi.kvt.set(l,d)),d.set(u,a);let g=this._nsi.trees[a].mainTag;(o.items||[]).forEach(v=>{v.tkv=n,v.mainTag=g,this._nsi.ids.set(v.id,v);let E=v.tags[g],b=v.tags[g.replace("wikidata","wikipedia")];E&&this._nsi.qids.set(E,E),b&&E&&this._nsi.qids.set(b,E)})})})}_gatherKVs(e){let i=new Set,r=new Set;for(let[o,a]of Object.entries(e)){if(!o||!a)continue;o==="route_master"&&(o="route");let l=this._nsi.kvt.get(o);l&&(l.get(a)?i.add(`${o}/${a}`):a==="yes"&&r.add(`${o}/${a}`))}let n=this.context.systems.presets.matchTags(e,"area");return sJ[n.id]&&r.add("building/yes"),{primary:i,alternate:r}}_identifyTree(e){let i,r;for(let[s,n]of Object.entries(e)){if(!s||!n)continue;s==="route_master"&&(s="route");let o=this._nsi.kvt.get(s);if(o)if(n==="yes")i="unknown";else{r=o.get(n);break}}return r||i||null}_gatherNames(e){let i={primary:new Set,alternate:new Set},r=new Set,s=new Set,n=!1,o=!1,a,l=this._identifyTree(e);if(!l)return i;if(l==="transit"?a={primary:/^network$/i,alternate:/^(operator|operator:\w+|network:\w+|\w+_name|\w+_name:\w+)$/i}:l==="flags"?a={primary:/^(flag:name|flag:name:\w+)$/i,alternate:/^(flag|flag:\w+|subject|subject:\w+)$/i}:l==="brands"?(o=!0,a={primary:/^(name|name:\w+)$/i,alternate:/^(brand|brand:\w+|operator|operator:\w+|\w+_name|\w+_name:\w+)/i}):l==="operators"?(o=!0,a={primary:/^(name|name:\w+|operator|operator:\w+)$/i,alternate:/^(brand|brand:\w+|\w+_name|\w+_name:\w+)/i}):(o=!0,a={primary:/^(name|name:\w+)$/i,alternate:/^(brand|brand:\w+|network|network:\w+|operator|operator:\w+|\w+_name|\w+_name:\w+)/i}),e.name&&o){let d=e.name.split(/[\s\-\/,.]/);for(let m=d.length;m>0;m--){let g=d.slice(0,m).join(" ");r.add(g)}}for(let[d,m]of Object.entries(e))!d||!m||(u(d,"primary")?/;/.test(m)?n=!0:(r.add(m),s.delete(m)):!r.has(m)&&u(d,"alternate")&&(/;/.test(m)?n=!0:s.add(m)));if(e.man_made==="flagpole"&&!r.size&&!s.size&&e.country){let d=e.country;/;/.test(d)?n=!0:s.add(d)}if(n)return i;return{primary:r,alternate:s};function u(d,m){return d==="old_name"?!1:a[m].test(d)&&!nJ.test(d)}}_gatherTuples(e,i){let r=[];for(let s of["primary","alternate"]){let n=Array.from(i[s]).sort((o,a)=>a.length-o.length);for(let o of n)for(let a of["primary","alternate"])for(let l of e[a]){let[u,d]=l.split("/",2);r.push({k:u,v:d,n:o})}}return r}};var s7=Xi(XB(),1);function YB(t){var e={};e.authenticated=function(){return!!s("oauth2_access_token")},e.logout=function(){return s("oauth2_access_token",""),s("oauth_token",""),s("oauth_token_secret",""),s("oauth_request_token_secret",""),e},e.authenticate=function(o){if(e.authenticated()){o(null,e);return}e.logout(),qB(function(a){i(a,o)})},e.authenticateAsync=function(){return e.authenticated()?Promise.resolve(e):(e.logout(),new Promise((o,a)=>{var l=(u,d)=>{u?a(new Error(u)):o(d)};qB(u=>i(u,l))}))};function i(o,a){var l=uee(),u=t.url+"/oauth2/authorize?"+WB({client_id:t.client_id,redirect_uri:t.redirect_uri,response_type:"code",scope:t.scope,state:l,code_challenge:o.code_challenge,code_challenge_method:o.code_challenge_method});if(t.singlepage){if(!s7.default.enabled){var d=new Error("local storage unavailable, but require in singlepage mode");d.status="pkce-localstorage-unavailable",a(d);return}var m=FA(window.location.search.slice(1));m.code?e.bootstrapToken(m.code,a):(s("oauth2_state",l),s("oauth2_pkce_code_verifier",o.code_verifier),window.location=u)}else{var g=600,_=550,v=[["width",g],["height",_],["left",window.screen.width/2-g/2],["top",window.screen.height/2-_/2]].map(function(T){return T.join("=")}).join(","),E=window.open("about:blank","oauth_window",v);e.popupWindow=E,E.location=u,E||(d=new Error("Popup was blocked"),d.status="popup-blocked",a(d))}window.authComplete=function(T){var A=FA(T.split("?")[1]);if(A.state!==l){d=new Error("Invalid state"),d.status="invalid-state",a(d);return}r(A.code,o.code_verifier,b),delete window.authComplete};function b(T,A){if(t.done(),T){a(T);return}var M=JSON.parse(A.response);s("oauth2_access_token",M.access_token),a(null,e)}}function r(o,a,l){var u=t.url+"/oauth2/token?"+WB({client_id:t.client_id,redirect_uri:t.redirect_uri,grant_type:"authorization_code",code:o,code_verifier:a});e.rawxhr("POST",u,null,null,null,l),t.loading()}e.bringPopupWindowToFront=function(){var o=!1;try{e.popupWindow&&!e.popupWindow.closed&&(e.popupWindow.focus(),o=!0)}catch{}return o},e.bootstrapToken=function(o,a){var l=s("oauth2_state");s("oauth2_state","");var u=FA(window.location.search.slice(1));if(u.state!==l){var d=new Error("Invalid state");d.status="invalid-state",a(d);return}var m=s("oauth2_pkce_code_verifier");s("oauth2_pkce_code_verifier",""),r(o,m,g);function g(_,v){if(t.done(),_){a(_);return}var E=JSON.parse(v.response);s("oauth2_access_token",E.access_token),a(null,e)}},e.fetch=function(o,a){if(e.authenticated())return l();return t.auto?e.authenticateAsync().then(l):Promise.reject(new Error("not authenticated"));function l(){return a=a||{},a.headers||(a.headers={"Content-Type":"application/x-www-form-urlencoded"}),a.headers.Authorization="Bearer "+s("oauth2_access_token"),fetch(o,a)}},e.xhr=function(o,a){if(e.authenticated())return l();if(t.auto){e.authenticate(l);return}else{a("not authenticated",null);return}function l(){var d=o.prefix!==!1?t.url+o.path:o.path;return e.rawxhr(o.method,d,s("oauth2_access_token"),o.content,o.headers,u)}function u(d,m){d?a(d):m.responseXML?a(d,m.responseXML):a(d,m.response)}},e.rawxhr=function(o,a,l,u,d,m){d=d||{"Content-Type":"application/x-www-form-urlencoded"},l&&(d.Authorization="Bearer "+l);var g=new XMLHttpRequest;g.onreadystatechange=function(){g.readyState===4&&g.status!==0&&(/^20\d$/.test(g.status)?m(null,g):m(g,null))},g.onerror=function(v){m(v,null)},g.open(o,a,!0);for(var _ in d)g.setRequestHeader(_,d[_]);return g.send(u),g},e.preauth=function(o){return o&&o.access_token&&s("oauth2_access_token",o.access_token),e},e.options=function(o){return arguments.length?(t=o,t.url=t.url||"https://www.openstreetmap.org",t.auto=t.auto||!1,t.singlepage=t.singlepage||!1,t.loading=t.loading||function(){},t.done=t.done||function(){},e.preauth(t)):t};var s;if(s7.default.enabled)s=function(o,a){if(arguments.length===1)return s7.default.get(t.url+o);if(arguments.length===2)return s7.default.set(t.url+o,a)};else{var n={};s=function(o,a){if(arguments.length===1)return n[t.url+o];if(arguments.length===2)return n[t.url+o]=a}}return e.options(t),e}function WB(t){return Object.keys(t).filter(function(e){return t[e]!==void 0}).sort().map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}function FA(t){for(var e=0;e<t.length&&(t[e]==="?"||t[e]==="#");)e++;return t=t.slice(e),t.split("&").reduce(function(i,r){var s=r.split("=");return s.length===2&&(i[s[0]]=decodeURIComponent(s[1])),i},{})}function ZB(){return window&&window.crypto&&window.crypto.getRandomValues&&window.crypto.subtle&&window.crypto.subtle.digest}function qB(t){var e;if(ZB()){var i=window.crypto.getRandomValues(new Uint8Array(32));e=LA(i.buffer);var r=Uint8Array.from(Array.from(e).map(function(o){return o.charCodeAt(0)}));window.crypto.subtle.digest("SHA-256",r).then(function(o){var a=LA(o);t({code_challenge:a,code_verifier:e,code_challenge_method:"S256"})})}else{var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";e="";for(var n=0;n<64;n++)e+=s[Math.floor(Math.random()*s.length)];t({code_verifier:e,code_challenge:e,code_challenge_method:"plain"})}}function uee(){var t;if(ZB()){var e=window.crypto.getRandomValues(new Uint8Array(32));t=LA(e.buffer)}else{var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";t="";for(var r=0;r<64;r++)t+=i[Math.floor(Math.random()*i.length)]}return t}function LA(t){return btoa(String.fromCharCode.apply(null,new Uint8Array(t))).replace(/\//g,"_").replace(/\+/g,"-").replace(/[=]/g,"")}var dp=Xi(kl(),1);var n7=class extends ui{constructor(e){super(e),this.id="osm",this._maxWayNodes=2e3,this._imageryBlocklists=[/.*\.google(apis)?\..*\/(vt|kh)[\?\/].*([xyz]=.*){3}.*/],this._urlroot="https://www.openstreetmap.org",this._tileCache={toLoad:{},loaded:{},inflight:{},seen:{},rtree:new dp.default},this._noteCache={toLoad:{},loaded:{},inflight:{},inflightPost:{},note:{},closed:{},rtree:new dp.default},this._userCache={toLoad:{},user:{}},this._changeset={},this._tiler=new Ns,this._deferred=new Set,this._connectionID=0,this._tileZoom=16,this._noteZoom=12,this._rateLimitError=void 0,this._userChangesets=void 0,this._userDetails=void 0,this._cachedApiStatus=void 0,this._off=!1,this._authLoading=this._authLoading.bind(this),this._authDone=this._authDone.bind(this),this._parseNodeJSON=this._parseNodeJSON.bind(this),this._parseWayJSON=this._parseWayJSON.bind(this),this._parseRelationJSON=this._parseRelationJSON.bind(this),this._parseNodeXML=this._parseNodeXML.bind(this),this._parseWayXML=this._parseWayXML.bind(this),this._parseRelationXML=this._parseRelationXML.bind(this),this._parseNoteXML=this._parseNoteXML.bind(this),this._parseUserXML=this._parseUserXML.bind(this),this.reloadApiStatus=this.reloadApiStatus.bind(this),this.throttledReloadApiStatus=rl(this.reloadApiStatus,500);let i=window.location.origin,r=window.location.pathname;(i==="https://mapwith.ai"||i==="https://rapideditor.org")&&(r="/rapid/"),this._oauth=YB({url:this._urlroot,client_id:"O3g0mOUuA2WY5Fs826j5tP260qR3DDX7cIIE2R2WWSc",client_secret:"b4aeHD1cNeapPPQTrvpPoExqQRjybit6JBlNnxh62uE",scope:"read_prefs write_prefs write_api read_gpx write_notes",redirect_uri:`${i}${r}land.html`,loading:this._authLoading,done:this._authDone})}initAsync(){return this.resetAsync()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){for(let e of this._deferred)window.cancelIdleCallback(e),this._deferred.delete(e);return this._connectionID++,this._userChangesets=void 0,this._userDetails=void 0,this._rateLimitError=void 0,this._cachedApiStatus=void 0,Object.values(this._tileCache.inflight).forEach(this._abortRequest),Object.values(this._noteCache.inflight).forEach(this._abortRequest),Object.values(this._noteCache.inflightPost).forEach(this._abortRequest),this._changeset.inflight&&this._abortRequest(this._changeset.inflight),this._tileCache={toLoad:{},loaded:{},inflight:{},seen:{},rtree:new dp.default},this._noteCache={toLoad:{},loaded:{},inflight:{},inflightPost:{},note:{},closed:{},rtree:new dp.default},this._userCache={toLoad:{},user:{}},this._changeset={},Promise.resolve()}switchAsync(e){this._urlroot=e.url;let i=un(this._oauth.options(),"access_token");return this._oauth.options(Object.assign(i,e)),this.resetAsync().then(()=>{this.emit("authchange")})}toggle(e){this._off=!e}isChangesetInflight(){return!!this._changeset.inflight}get connectionID(){return this._connectionID}get urlroot(){return this._urlroot}get imageryBlocklists(){return this._imageryBlocklists}get maxWayNodes(){return this._maxWayNodes}changesetURL(e){return`${this._urlroot}/changeset/${e}`}changesetsURL(e,i){let r=Math.max(0,Math.ceil(Math.log(i)/Math.LN2));return this._urlroot+"/history#map="+Math.floor(i)+"/"+e[1].toFixed(r)+"/"+e[0].toFixed(r)}entityURL(e){let i=e.osmId();return`${this._urlroot}/${e.type}/${i}`}historyURL(e){let i=e.osmId();return`${this._urlroot}/${e.type}/${i}/history`}userURL(e){return`${this._urlroot}/user/${e}`}noteURL(e){return`${this._urlroot}/note/${e.id}`}noteReportURL(e){return`${this._urlroot}/reports/new?reportable_type=Note&reportable_id=${e.id}`}loadFromAPI(e,i,r){r=Object.assign({skipSeen:!0},r);let s=this._connectionID,n=(u,d)=>{if(this._connectionID!==s){i&&i({message:"Connection Switched",status:-1});return}let m=this.authenticated();if(m&&(u?.status===400||u?.status===401||u?.status===403))this.logout(),this.loadFromAPI(e,i,r);else if(!m&&!this._rateLimitError&&(u?.status===509||u?.status===429)?(this._rateLimitError=u,this.emit("authchange"),this.throttledReloadApiStatus()):(u&&this._cachedApiStatus==="online"||!u&&this._cachedApiStatus!=="online")&&this.throttledReloadApiStatus(),i)return u?i(u):e.indexOf(".json")!==-1?this._parseJSON(d,i,r):this._parseXML(d,i,r)},o=this._urlroot+e,a=new AbortController;return(this.authenticated()?this._oauth.fetch:window.fetch)(o,{signal:a.signal}).then(Ai).then(u=>n(null,u)).catch(u=>{if(u.name!=="AbortError"&&u.name==="FetchError"){n(u);return}}),a}loadEntity(e,i){let r=Dt.id.type(e),s=Dt.id.toOSM(e),n={skipSeen:!1},o=r!=="node"?"/full":"";this.loadFromAPI(`/api/0.6/${r}/${s}${o}.json`,i,n)}loadEntityVersion(e,i,r){let s=Dt.id.type(e),n=Dt.id.toOSM(e),o={skipSeen:!1};this.loadFromAPI(`/api/0.6/${s}/${n}/${i}.json`,r,o)}loadEntityRelations(e,i){let r=Dt.id.type(e),s=Dt.id.toOSM(e),n={skipSeen:!1};this.loadFromAPI(`/api/0.6/${r}/${s}/relations.json`,i,n)}loadMultiple(e,i){let r=ds(Ei(e),Dt.id.type),s={skipSeen:!1};for(let[n,o]of Object.entries(r)){let a=n+"s",l=o.map(u=>Dt.id.toOSM(u));for(let u of h3(l,150))this.loadFromAPI(`/api/0.6/${a}.json?${a}=`+u.join(),i,s)}}createChangeset(e,i){if(this._changeset.inflight)return i({message:"Changeset already inflight",status:-2});if(!this.authenticated())return i({message:"Not Authenticated",status:-3});let r=(l,u)=>{if(this._changeset.inflight=null,l)return i(l,e);this._changeset.openChangesetID=u,e=e.update({id:u}),i(null,e)};if(this._changeset.openChangesetID)return r(null,this._changeset.openChangesetID);let s=this._wrapcb(r),n=this._urlroot+"/api/0.6/changeset/create",o=new AbortController,a={method:"PUT",headers:{"Content-Type":"text/xml"},body:Kc.stringify(e.asJXON()),signal:o.signal};this._oauth.fetch(n,a).then(Ai).then(l=>s(null,l)).catch(l=>{if(this._changeset.inflight=null,l.name!=="AbortError"&&l.name==="FetchError"){s(l);return}}),this._changeset.inflight=o}uploadChangeset(e,i,r){if(this._changeset.inflight)return r({message:"Changeset already inflight",status:-2});if(this.authenticated()){if(e.id!==this._changeset.openChangesetID)return r({message:"Changeset ID mismatch",status:-4})}else return r({message:"Not Authenticated",status:-3});let s=u=>{this._changeset.inflight=null,r(u,e)},n=this._wrapcb(s),o=this._urlroot+`/api/0.6/changeset/${e.id}/upload`,a=new AbortController,l={method:"POST",headers:{"Content-Type":"text/xml"},body:Kc.stringify(e.osmChangeJXON(i)),signal:a.signal};this._oauth.fetch(o,l).then(Ai).then(u=>n(null,u)).catch(u=>{if(this._changeset.inflight=null,u.name!=="AbortError"&&u.name==="FetchError"){n(u);return}}),this._changeset.inflight=a}closeChangeset(e,i){if(this._changeset.inflight)return i({message:"Changeset already inflight",status:-2});if(this.authenticated()){if(e.id!==this._changeset.openChangesetID)return i({message:"Changeset ID mismatch",status:-4})}else return i({message:"Not Authenticated",status:-3});let r=l=>{this._changeset.inflight=null,this._changeset.openChangesetID=null,i(l,e)},s=this._wrapcb(r),n=this._urlroot+`/api/0.6/changeset/${e.id}/close`,o=new AbortController,a={method:"PUT",headers:{"Content-Type":"text/xml"},signal:o.signal};this._oauth.fetch(n,a).then(Ai).then(l=>s(null,l)).catch(l=>{if(this._changeset.inflight=null,l.name!=="AbortError"&&l.name==="FetchError"){s(l);return}}),this._changeset.inflight=o}sendChangeset(e,i,r){let s=this._connectionID;this.createChangeset(e,(n,o)=>{if(e=o,n)return r(n,e);this.uploadChangeset(e,i,(a,l)=>{if(e=l,a)return r(a,e);window.setTimeout(()=>{this._changeset.openChangesetID=null,r(null,e)},2500),this.connectionID===s&&this.closeChangeset(e,()=>{})})})}loadUsers(e,i){let r=[],s=[];for(let a of Ei(e))this._userCache.user[a]?(delete this._userCache.toLoad[a],s.push(this._userCache.user[a])):r.push(a);if((s.length||!this.authenticated())&&(i(void 0,s),!this.authenticated()))return;let n=(a,l)=>{if(a)return i(a);i(void 0,l.data)},o={skipSeen:!0};for(let a of h3(r,150))this.loadFromAPI("/api/0.6/users.json?users="+a.join(),n,o)}loadUser(e,i){if(this._userCache.user[e]||!this.authenticated())return delete this._userCache.toLoad[e],i(void 0,this._userCache.user[e]);let r=(n,o)=>{if(n)return i(n);i(void 0,o.data[0])},s={skipSeen:!0};this.loadFromAPI(`/api/0.6/user/${e}.json`,r,s)}userDetails(e){if(this._userDetails)return e(void 0,this._userDetails);let i=(s,n)=>{if(s)return e(s);this._userDetails=n.data[0],e(void 0,this._userDetails)},r={skipSeen:!1};this.loadFromAPI("/api/0.6/user/details.json",i,r)}userChangesets(e){if(this._userChangesets)return e(void 0,this._userChangesets);let i=(n,o)=>n?e(n):(this._userChangesets=o.data,e(void 0,this._userChangesets)),r={skipSeen:!1},s=(n,o)=>{if(n)return e(n);this.loadFromAPI(`/api/0.6/changesets.json?user=${o.id}`,i,r)};this.userDetails(s)}status(e){let i=(n,o)=>{if(n)return e(n,null);if(this._rateLimitError)return e(this._rateLimitError,"rateLimited");{let a=[];for(let g of o.getElementsByTagName("blacklist")){let _=g.getAttribute("regex");if(_)try{a.push(new RegExp(_))}catch{}}a.length&&(this._imageryBlocklists=a);let l=o.getElementsByTagName("waynodes"),u=l.length&&parseInt(l[0].getAttribute("maximum"),10);u&&isFinite(u)&&(this._maxWayNodes=u);let m=o.getElementsByTagName("status")[0].getAttribute("api");return e(void 0,m)}},r=this._urlroot+"/api/capabilities",s=this._wrapcb(i);fetch(r).then(Ai).then(n=>s(null,n)).catch(n=>s(n))}reloadApiStatus(){this.status((e,i)=>{i!==this._cachedApiStatus&&(this._cachedApiStatus=i,this.emit("apiStatusChange",e,i))})}loadTiles(e,i){if(this._off)return;let r=this._tiler.zoomRange(this._tileZoom).margin(1).getTiles(e).tiles,s=this._tileCache,n=this._hasInflightRequests(s);this._abortUnwantedRequests(s,r),n&&!this._hasInflightRequests(s)&&this.emit("loaded");for(let o of r)this.loadTile(o,i)}loadTile(e,i){if(this._off)return;let r=this._tileCache;if(r.loaded[e.id]||r.inflight[e.id])return;let s=this.context.systems.locations;if(e.wgs84Extent.polygon().slice(0,4).every(d=>s.blocksAt(d).length)){r.loaded[e.id]=!0;return}this._hasInflightRequests(r)||this.emit("loading");let a=(d,m)=>{if(delete r.inflight[e.id],!d){delete r.toLoad[e.id],r.loaded[e.id]=!0;let g=e.wgs84Extent.bbox();g.id=e.id,r.rtree.insert(g)}i&&i(d,Object.assign({},m,{tile:e})),this._hasInflightRequests(r)||this.emit("loaded")},l="/api/0.6/map.json?bbox=",u={skipSeen:!0};r.inflight[e.id]=this.loadFromAPI(l+e.wgs84Extent.toParam(),a,u)}isDataLoaded(e){let i={minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]};return this._tileCache.rtree.collides(i)}loadTileAtLoc(e,i){let r=this._tileCache;if(Object.keys(r.toLoad).length>50)return;let s=In(this._tileZoom+1),n=new zo().scale(s).project(e),o=new zo().transform({k:s,x:-n[0],y:-n[1]}),a=this._tiler.zoomRange(this._tileZoom).getTiles(o).tiles;for(let l of a)r.toLoad[l.id]||r.loaded[l.id]||r.inflight[l.id]||(r.toLoad[l.id]=!0,this.loadTile(l,i))}loadNotes(e,i){if(this._off)return;i=Object.assign({limit:1e4,closed:7},i);let r=this._noteCache,s=this,n="/api/0.6/notes?limit="+i.limit+"&closed="+i.closed+"&bbox=",o=rl(()=>{let l=Object.keys(s._userCache.toLoad);l.length&&s.loadUsers(l,function(){})},750),a=this._tiler.zoomRange(this._noteZoom).margin(1).getTiles(e).tiles;this._abortUnwantedRequests(r,a);for(let l of a){if(r.loaded[l.id]||r.inflight[l.id])continue;let u=this.context.systems.locations;if(l.wgs84Extent.polygon().slice(0,4).every(_=>u.blocksAt(_).length)){r.loaded[l.id]=!0;continue}let g={skipSeen:!1};r.inflight[l.id]=this.loadFromAPI(n+l.wgs84Extent.toParam(),function(_){delete s._noteCache.inflight[l.id],_||(s._noteCache.loaded[l.id]=!0),s.emit("loadedNotes")},g)}}postNoteCreate(e,i){if(this._noteCache.inflightPost[e.id])return i({message:"Note update already inflight",status:-2},e);if(!this.authenticated())return i({message:"Not Authenticated",status:-3},e);if(!e.loc[0]||!e.loc[1]||!e.newComment)return;let r=(l,u)=>{if(delete this._noteCache.inflightPost[e.id],l)return i(l);this.removeNote(e);let d={skipSeen:!1};return this._parseXML(u,(m,g)=>m?i(m):i(void 0,g.data[0]),d)},s=this._wrapcb(r),n=this._urlroot+"/api/0.6/notes?"+nr({lon:e.loc[0],lat:e.loc[1],text:e.newComment}),o=new AbortController,a={method:"POST",signal:o.signal};this._oauth.fetch(n,a).then(Ai).then(l=>s(null,l)).catch(l=>{if(this._changeset.inflight=null,l.name!=="AbortError"&&l.name==="FetchError"){s(l);return}}),this._noteCache.inflightPost[e.id]=o}postNoteUpdate(e,i,r){if(!this.authenticated())return r({message:"Not Authenticated",status:-3},e);if(this._noteCache.inflightPost[e.id])return r({message:"Note update already inflight",status:-2},e);let s;if(e.status!=="closed"&&i==="closed")s="close";else if(e.status!=="open"&&i==="open")s="reopen";else if(s="comment",!e.newComment)return;let n=(d,m)=>{if(delete this._noteCache.inflightPost[e.id],d)return r(d);this.removeNote(e),s==="close"?this._noteCache.closed[e.id]=!0:s==="reopen"&&delete this._noteCache.closed[e.id];let g={skipSeen:!1};return this._parseXML(m,(_,v)=>_?r(_):r(void 0,v.data[0]),g)},o=this._wrapcb(n),a=this._urlroot+`/api/0.6/notes/${e.id}/${s}`;e.newComment&&(a+="?"+nr({text:e.newComment}));let l=new AbortController,u={method:"POST",signal:l.signal};this._oauth.fetch(a,u).then(Ai).then(d=>o(null,d)).catch(d=>{if(this._changeset.inflight=null,d.name!=="AbortError"&&d.name==="FetchError"){o(d);return}}),this._noteCache.inflightPost[e.id]=l}caches(e){function i(r){let s={};for(let[n,o]of Object.entries(r))if(n==="rtree")s.rtree=new dp.default().fromJSON(o.toJSON());else if(n==="note"){s.note={};for(let a of Object.keys(o))s.note[a]=Fr(r.note[a])}else s[n]=JSON.parse(JSON.stringify(o));return s}return e===void 0?{tile:i(this._tileCache),note:i(this._noteCache),user:i(this._userCache)}:e==="get"?{tile:this._tileCache,note:this._noteCache,user:this._userCache}:(e.tile&&(this._tileCache=e.tile,this._tileCache.inflight={}),e.note&&(this._noteCache=e.note,this._noteCache.inflight={},this._noteCache.inflightPost={}),e.user&&(this._userCache=e.user),this)}logout(){return this._userChangesets=void 0,this._userDetails=void 0,this._oauth.logout(),this.emit("authchange"),this}authenticated(){return this._oauth.authenticated()}authenticate(e){let i=this._connectionID;this._userChangesets=void 0,this._userDetails=void 0;let r=(s,n)=>{if(s){e&&e(s);return}if(this._connectionID!==i){e&&e({message:"Connection Switched",status:-1});return}this._rateLimitError=void 0,this.emit("authchange"),e&&e(s,n),this.userChangesets(function(){})};this._oauth.authenticate(r)}notes(e){let i=e.dimensions(),r=[i[0][0],i[1][1]],s=[i[1][0],i[0][1]],n=new mt(e.invert(r),e.invert(s)).bbox();return this._noteCache.rtree.search(n).map(o=>o.data)}getNote(e){return this._noteCache.note[e]}removeNote(e){!(e instanceof Fr)||!e.id||(delete this._noteCache.note[e.id],this._updateRtree(this._encodeNoteRtree(e),!1))}replaceNote(e){if(!(!(e instanceof Fr)||!e.id))return this._noteCache.note[e.id]=e,this._updateRtree(this._encodeNoteRtree(e),!0),e}getClosedIDs(){return Object.keys(this._noteCache.closed).sort()}_authLoading(){this.emit("authLoading")}_authDone(){this.emit("authDone")}_abortRequest(e){e&&e.abort()}_hasInflightRequests(e){return Object.keys(e.inflight).length}_abortUnwantedRequests(e,i){for(let r of Object.keys(e.inflight))e.toLoad[r]||i.find(s=>s.id===r)||(this._abortRequest(e.inflight[r]),delete e.inflight[r])}_getLoc(e){let i=e.lon?.value,r=e.lat?.value;return[parseFloat(i),parseFloat(r)]}_getNodes(e){return Array.from(e.getElementsByTagName("nd")).map(r=>"n"+r.attributes.ref.value)}_getNodesJSON(e){return(e.nodes??[]).map(i=>"n"+i)}_getTags(e){let i=Array.from(e.getElementsByTagName("tag")),r={};for(let s of i){let n=s.attributes,o=(n.k.value??"").trim(),a=(n.v.value??"").trim();o&&(r[o]=a)}return r}_getMembers(e){return Array.from(e.getElementsByTagName("member")).map(r=>{let s=r.attributes;return{id:s.type.value[0]+s.ref.value,type:s.type.value,role:s.role.value}})}_getMembersJSON(e){return(e.members??[]).map(i=>({id:i.type[0]+i.ref,type:i.type,role:i.role}))}_parseComments(e){let i=[];for(let r of e)if(r.nodeName==="comment"){let s={};for(let n of r.childNodes){let o=n.nodeName;if(o!=="#text"&&(s[o]=n.textContent,o==="uid")){let a=n.textContent;a&&!this._userCache.user[a]&&(this._userCache.toLoad[a]=!0)}}Object.keys(s).length&&i.push(s)}return i}_encodeNoteRtree(e){return{minX:e.loc[0],minY:e.loc[1],maxX:e.loc[0],maxY:e.loc[1],data:e}}_parseJSON(e,i,r){if(r=Object.assign({skipSeen:!0},r),!e)return i({message:"No JSON",status:-1});let s=e;typeof s!="object"&&(s=JSON.parse(e));let n=s.elements??[],o=(s.user?[s.user]:s.users)??[],a=s?.changesets||[];if(!n||!o||!a)return i({message:"No JSON",status:-1});if(n.some(u=>u.type==="error"))return i({message:"Partial JSON",status:-1});let l=window.requestIdleCallback(()=>{this._deferred.delete(l);let u={data:[],seenIDs:new Set};for(let d of n){let m;if(d.type==="node"?m=this._parseNodeJSON:d.type==="way"?m=this._parseWayJSON:d.type==="relation"&&(m=this._parseRelationJSON),!m)continue;let g=Dt.id.fromOSM(d.type,d.id);if(u.seenIDs.add(g),r.skipSeen){if(this._tileCache.seen[g])continue;this._tileCache.seen[g]=!0}let _=m(d,g);_&&u.data.push(_)}for(let d of o){let m=d.id?.toString();if(!m||(delete this._userCache.toLoad[m],u.seenIDs.add(m),r.skipSeen&&this._userCache.user[m]))continue;let g={id:m,display_name:d.display_name,account_created:d.account_created,image_url:d.img?.href,changesets_count:d.changesets?.count?.toString()??"0",active_blocks:d.blocks?.received?.active?.toString()??"0"};this._userCache.user[m]=g,u.data.push(g)}for(let d of a)d?.tags?.comment&&u.data.push(d);i(null,u)});this._deferred.add(l)}_parseXML(e,i,r){if(r=Object.assign({skipSeen:!0},r),!e||!e.childNodes)return i({message:"No XML",status:-1});let s=e.childNodes[0],n=Array.from(s.childNodes);if(n.some(a=>a.nodename==="error"))return i({message:"Partial XML",status:-1});let o=window.requestIdleCallback(()=>{this._deferred.delete(o);let a={data:[],seenIDs:new Set};for(let l of n){let u;if(l.nodeName==="node"?u=this._parseNodeXML:l.nodeName==="way"?u=this._parseWayXML:l.nodeName==="relation"?u=this._parseRelationXML:l.nodeName==="note"?u=this._parseNoteXML:l.nodeName==="user"&&(u=this._parseUserXML),!u)continue;let d;if(l.nodeName==="user"){if(d=l.attributes.id.value,a.seenIDs.add(d),r.skipSeen&&this._userCache.user[d]){delete this._userCache.toLoad[d];continue}}else if(l.nodeName==="note")d=l.getElementsByTagName("id")[0].textContent,a.seenIDs.add(d);else if(d=Dt.id.fromOSM(l.nodeName,l.attributes.id.value),a.seenIDs.add(d),r.skipSeen){if(this._tileCache.seen[d])continue;this._tileCache.seen[d]=!0}let m=u(l,d);m&&a.data.push(m)}i(null,a)});this._deferred.add(o)}_parseNodeJSON(e,i){return new vi({id:i,visible:typeof e.visible=="boolean"?e.visible:!0,version:e.version?.toString(),changeset:e.changeset?.toString(),timestamp:e.timestamp,user:e.user,uid:e.uid?.toString(),loc:[parseFloat(e.lon),parseFloat(e.lat)],tags:e.tags})}_parseWayJSON(e,i){return new Cr({id:i,visible:typeof e.visible=="boolean"?e.visible:!0,version:e.version?.toString(),changeset:e.changeset?.toString(),timestamp:e.timestamp,user:e.user,uid:e.uid?.toString(),tags:e.tags,nodes:this._getNodesJSON(e)})}_parseRelationJSON(e,i){return new Cs({id:i,visible:typeof e.visible=="boolean"?e.visible:!0,version:e.version?.toString(),changeset:e.changeset?.toString(),timestamp:e.timestamp,user:e.user,uid:e.uid?.toString(),tags:e.tags,members:this._getMembersJSON(e)})}_parseNodeXML(e,i){let r=e.attributes;return new vi({id:i,visible:!r.visible||r.visible.value!=="false",version:r.version.value,changeset:r.changeset?.value,timestamp:r.timestamp?.value,user:r.user?.value,uid:r.uid?.value,loc:this._getLoc(r),tags:this._getTags(e)})}_parseWayXML(e,i){let r=e.attributes;return new Cr({id:i,visible:!r.visible||r.visible.value!=="false",version:r.version.value,changeset:r.changeset?.value,timestamp:r.timestamp?.value,user:r.user?.value,uid:r.uid?.value,tags:this._getTags(e),nodes:this._getNodes(e)})}_parseRelationXML(e,i){let r=e.attributes;return new Cs({id:i,visible:!r.visible||r.visible.value!=="false",version:r.version.value,changeset:r.changeset?.value,timestamp:r.timestamp?.value,user:r.user?.value,uid:r.uid?.value,tags:this._getTags(e),members:this._getMembers(e)})}_parseNoteXML(e,i){let r=e.attributes,s=e.childNodes,n={};n.id=i,n.loc=this._getLoc(r);let o=!1,a=1e-5;do{o&&(n.loc=Sr(n.loc,[a,a]));let d=new mt(n.loc).bbox();o=this._noteCache.rtree.search(d).length}while(o);for(let d of s){let m=d.nodeName;m!=="#text"&&(m==="comments"?n[m]=this._parseComments(d.childNodes):n[m]=d.textContent)}let l=new Fr(n),u=this._encodeNoteRtree(l);return this._noteCache.note[l.id]=l,this._noteCache.rtree.insert(u),l}_parseUserXML(e,i){let r=e.attributes,s={id:i,display_name:r.display_name?.value,account_created:r.account_created?.value,changesets_count:"0",active_blocks:"0"},n=e.getElementsByTagName("img");n&&n[0]&&n[0].getAttribute("href")&&(s.image_url=n[0].getAttribute("href"));let o=e.getElementsByTagName("changesets");o&&o[0]&&o[0].getAttribute("count")&&(s.changesets_count=o[0].getAttribute("count"));let a=e.getElementsByTagName("blocks");if(a&&a[0]){let l=a[0].getElementsByTagName("received");l&&l[0]&&l[0].getAttribute("active")&&(s.active_blocks=l[0].getAttribute("active"))}return this._userCache.user[i]=s,delete this._userCache.toLoad[i],s}_updateRtree(e,i){this._noteCache.rtree.remove(e,(r,s)=>r.data.id===s.data.id),i&&this._noteCache.rtree.insert(e)}_wrapcb(e){let i=this._connectionID;return(r,s)=>r?((r.status===400||r.status===401||r.status===403)&&this.logout(),e.call(this,r)):this._connectionID!==i?e.call(this,{message:"Connection Switched",status:-1}):e.call(this,r,s)}};var QB=Xi(kl(),1);var hee=14,Vx="https://osmose.openstreetmap.fr/api/0.3",o7=class extends ui{constructor(e){super(e),this.id="osmose",this.autoStart=!1,this._osmoseColors=new Map,this._osmoseStrings=new Map,this._osmoseData={icons:{},types:[]},this._cache=null,this._tiler=new Ns().zoomRange(hee).skipNullIsland(!0)}initAsync(){return this.resetAsync()}startAsync(){return this.context.systems.data.getDataAsync("qa_data").then(i=>{this._osmoseData.icons=i.osmose.icons,this._osmoseData.types=Object.keys(i.osmose.icons).map(r=>r.split("-")[0]).reduce((r,s)=>r.indexOf(s)!==-1?r:[...r,s],[])}).then(()=>this._loadStringsAsync()).then(()=>this._started=!0)}resetAsync(){return this._cache&&Object.values(this._cache.inflightTile).forEach(e=>this._abortRequest(e)),this._cache={issues:new Map,loadedTile:{},inflightTile:{},inflightPost:{},closed:{},rtree:new QB.default},Promise.resolve()}getData(){let e=this.context.systems.map.extent();return this._cache.rtree.search(e.bbox()).map(i=>i.data)}loadTiles(){let e=this.context.projection,i=this._tiler.getTiles(e).tiles;this._abortUnwantedRequests(this._cache,i);for(let r of i){if(this._cache.loadedTile[r.id]||this._cache.inflightTile[r.id])continue;let[s,n,o]=r.xyz,a={item:this._osmoseData.types},l=`${Vx}/issues/${o}/${s}/${n}.json?`+nr(a),u=new AbortController;this._cache.inflightTile[r.id]=u,fetch(l,{signal:u.signal}).then(Ai).then(d=>{this._cache.loadedTile[r.id]=!0;for(let m of d.features??[]){let{item:g,class:_,uuid:v}=m.properties,E=`${g}-${_}`;if(E in this._osmoseData.icons){let b=m.geometry.coordinates;b=this._preventCoincident(b);let T=new vr(b,this,E,v,{item:g});(g===8300||g===8360)&&(T.elems=[]),this._cache.issues.set(T.id,T),this._cache.rtree.insert(this._encodeIssueRtree(T))}}this.context.deferredRedraw(),this.emit("loadedData")}).catch(d=>{d.name!=="AbortError"&&(this._cache.loadedTile[r.id]=!0)}).finally(()=>{delete this._cache.inflightTile[r.id]})}}loadIssueDetailAsync(e){if(e.elems!==void 0)return Promise.resolve(e);let i=this.context.systems.l10n.localeCode(),r=`${Vx}/issue/${e.id}?langs=${i}`,s=n=>{e.elems=n.elems.map(o=>o.type.substring(0,1)+o.id),e.detail=n.subtitle?Ki.parse(n.subtitle.auto):"",this.replaceItem(e)};return fetch(r).then(Ai).then(s).then(()=>e)}getStrings(e,i){return i=i||this.context.systems.l10n.localeCode(),(this._osmoseStrings.get(i)??{})[e]??{}}getColor(e){return this._osmoseColors.get(e)??16777215}getIcon(e){return this._osmoseData.icons[e]}postUpdate(e,i){if(this._cache.inflightPost[e.id])return i({message:"Issue update already inflight",status:-2},e);let r=`${Vx}/issue/${e.id}/${e.newStatus}`,s=new AbortController,n=()=>{delete this._cache.inflightPost[e.id],this.removeItem(e),e.newStatus==="done"&&(e.item in this._cache.closed||(this._cache.closed[e.item]=0),this._cache.closed[e.item]+=1),i&&i(null,e)};this._cache.inflightPost[e.id]=s,fetch(r,{signal:s.signal}).then(n).catch(o=>{delete this._cache.inflightPost[e.id],i&&i(o.message)})}getError(e){return this._cache.issues.get(e)}replaceItem(e){if(!(!(e instanceof vr)||!e.id))return this._cache.issues.set(e.id,e),this._updateRtree(this._encodeIssueRtree(e),!0),e}removeItem(e){!(e instanceof vr)||!e.id||(this._cache.isseus.delete(e.id),this._updateRtree(this._encodeIssueRtree(e),!1))}getClosedCounts(){return this._cache.closed}itemURL(e){return`https://osmose.openstreetmap.fr/en/error/${e.id}`}_abortRequest(e){e&&e.abort()}_abortUnwantedRequests(e,i){Object.keys(e.inflightTile).forEach(r=>{i.find(n=>r===n.id)||(this._abortRequest(e.inflightTile[r]),delete e.inflightTile[r])})}_encodeIssueRtree(e){return{minX:e.loc[0],minY:e.loc[1],maxX:e.loc[0],maxY:e.loc[1],data:e}}_updateRtree(e,i){this._cache.rtree.remove(e,(r,s)=>r.data.id===s.data.id),i&&this._cache.rtree.insert(e)}_preventCoincident(e){let i=!1;do{e=Sr(e,i?[1e-5,0]:[0,1e-5]);let s=new mt(e).bbox();i=this._cache.rtree.search(s).length}while(i);return e}_loadStringsAsync(){let e=Object.keys(this._osmoseData.icons),i={},r=this.context.systems.l10n.localeCode();this._osmoseStrings.set(r,i);let s=e.map(n=>{let o=d=>{let[m={items:[]}]=d.categories,[g={class:[]}]=m.items,[_=null]=g.class;if(!_){console.log(`Osmose strings request (${n}) had unexpected data`);return}let v=g.item;this._osmoseColors.set(v,new fi(g.color).toNumber());let{title:E,detail:b,fix:T,trap:A}=_,M={};E&&(M.title=E.auto.charAt(0).toUpperCase()+E.auto.slice(1)),b&&(M.detail=Ki.parse(b.auto)),A&&(M.trap=Ki.parse(A.auto)),T&&(M.fix=Ki.parse(T.auto)),i[n]=M},[a,l]=n.split("-"),u=`${Vx}/items/${a}/class/${l}?langs=${r}`;return fetch(u).then(Ai).then(o)}).filter(Boolean);return Promise.all(s)}};var a7=class extends ui{constructor(e){super(e),this.id="osmwikibase",this.apibase="https://wiki.openstreetmap.org/w/api.php",this._inflight={},this._cache={},this._localeIDs={en:!1},this.claimToValue=this.claimToValue.bind(this),this.monolingualClaimToValueObj=this.monolingualClaimToValueObj.bind(this),this.toSitelink=this.toSitelink.bind(this),this.getEntity=this.getEntity.bind(this),this.getDocs=this.getDocs.bind(this),this._request=this._request.bind(this),this._debouncedRequest=Ur(this._request,500,{leading:!1})}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this._debouncedRequest.cancel(),Object.values(this._inflight).forEach(e=>e.abort()),this._inflight={},Promise.resolve()}claimToValue(e,i,r){if(!e.claims[i])return;let s=this._localeIDs[r],n,o;for(let l of e.claims[i]){!n&&l.rank==="preferred"&&(n=l);let u=l.qualifiers?.P26&&l.qualifiers.P26[0].datavalue.value.id;s&&u===s&&(o=l)}let a=o??n;if(a){let l=a.mainsnak.datavalue;return l.type==="wikibase-entityid"?l.value.id:l.value}else return}monolingualClaimToValueObj(e,i){if(e?.claims[i])return e.claims[i].reduce(function(r,s){var n=s.mainsnak.datavalue.value;return r[n.language]=n.text,r},{})}toSitelink(e,i){return(i?`Tag:${e}=${i}`:`Key:${e}`).replace(/_/g," ").trim()}getEntity(e,i){let r=e.debounce?this._debouncedRequest:this._request,s=e.key==="type"&&e.value?`Relation:${e.value}`.replace(/_/g," ").trim():!1,n=e.key?this.toSitelink(e.key):!1,o=e.key&&e.value?this.toSitelink(e.key,e.value):!1,a=[],l={},u;if(e.langCodes)for(let g of e.langCodes)this._localeIDs[g]===void 0&&(u=`Locale:${g}`.replace(/_/g," ").trim(),a.push(u));if(s&&(this._cache[s]?l.rtype=this._cache[s]:a.push(s)),n&&(this._cache[n]?l.key=this._cache[n]:a.push(n)),o&&(this._cache[o]?l.tag=this._cache[o]:a.push(o)),!a.length)return i(null,l);let d={action:"wbgetentities",sites:"wiki",titles:a.join("|"),languages:e.langCodes.join("|"),languagefallback:1,origin:"*",format:"json"},m=this.apibase+"?"+nr(d);r(m,(g,_)=>{if(g)i(g);else if(!_.success||_.error)i(_.error.messages.map(v=>v.html["*"]).join("<br>"));else{let v=!1;for(let E of Object.values(_.entities))if(E.missing!==""){let b=E.sitelinks.wiki.title;b===s?(this._cache[s]=E,l.rtype=E):b===n?(this._cache[n]=E,l.key=E):b===o?(this._cache[o]=E,l.tag=E):b===u?v=E.id:console.log(`Unexpected title ${b}`)}u&&this.addLocale(e.langCodes[0],v),i(null,l)}})}getDocs(e,i){let r=this.context.systems.l10n.localeCodes().map(s=>s.toLowerCase());e.langCodes=r,this.getEntity(e,(s,n)=>{if(s){i(s);return}let o=n.rtype||n.tag||n.key;if(!o){i("No entity");return}let a;for(let _ of r)if(o.descriptions[_]?.language===_){a=o.descriptions[_];break}!a&&Object.values(o.descriptions).length&&(a=Object.values(o.descriptions)[0]);let l={title:o.title,description:a?.value??"",descriptionLocaleCode:a?.language??"",editURL:`https://wiki.openstreetmap.org/wiki/${o.title}`};if(o.claims){let _,v=this.claimToValue(o,"P4",r[0]);v?_="https://commons.wikimedia.org/w/index.php":(v=this.claimToValue(o,"P28",r[0]),v&&(_="https://wiki.openstreetmap.org/w/index.php")),_&&v&&(l.imageURL=_+"?"+nr({title:`Special:Redirect/file/${v}`,width:400}))}let u=this.monolingualClaimToValueObj(n.rtype,"P31"),d=this.monolingualClaimToValueObj(n.tag,"P31"),m=this.monolingualClaimToValueObj(n.key,"P31");for(let _ of[u,d,m]){for(let v of r){let b=r[0].split("-")[0]!=="en"&&v.split("-")[0]==="en"?"inspector.wiki_en_reference":"inspector.wiki_reference",T=g(_,v,b);if(T){l.wiki=T;break}}if(l.wiki)break}i(null,l);function g(_,v,E){if(_&&_[v])return{title:_[v],text:E,url:`https://wiki.openstreetmap.org/wiki/${_[v]}`}}})}addLocale(e,i){this._localeIDs[e]=i}_request(e,i){if(this._inflight[e])return;let r=new AbortController;this._inflight[e]=r,fetch(e,{signal:r.signal}).then(Ai).then(s=>{delete this._inflight[e],i&&i(null,s)}).catch(s=>{delete this._inflight[e],s.name!=="AbortError"&&i&&i(s.message)})}};var eU=Xi(kl(),1);var jx={};window.jsonpCache=jx;function KB(t,e){var i={abort:function(){}};if(window.JSONP_FIX){if(window.JSONP_DELAY===0)e(window.JSONP_FIX);else{var r=window.setTimeout(function(){e(window.JSONP_FIX)},window.JSONP_DELAY||0);i.abort=function(){window.clearTimeout(r)}}return i}function s(){for(var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",u="",d=-1;++d<15;)u+=l.charAt(Math.floor(Math.random()*52));return u}function n(l){var u=l.match(/callback=(\w+)/),d=u?u[1]:s();jx[d]=function(g){jx[d]&&e(g),m()};function m(){delete jx[d],a.remove()}return i.abort=m,"jsonpCache."+d}var o=n(t),a=ye("head").append("script").attr("type","text/javascript").attr("src",t.replace(/(\{|%7B)callback(\}|%7D)/,o));return i}var dee="pannellum-streetside/pannellum.css",fee="pannellum-streetside/pannellum.js",JB=16.5,l7=class extends ui{constructor(e){super(e),this.id="streetside",this.autoStart=!1,this._hires=!1,this._resolution=512,this._currScene=0,this._cache={},this._pannellumViewer=null,this._nextSequenceID=0,this._waitingForPhotoID=null,this._startPromise=null,this._sceneOptions={showFullscreenCtrl:!1,autoLoad:!0,compass:!0,yaw:0,hfov:45,minHfov:10,maxHfov:90,type:"cubemap",cubeMap:[]},this._setupCanvas=this._setupCanvas.bind(this),this._tiler=new Ns().zoomRange(JB).skipNullIsland(!0)}initAsync(){return this.resetAsync()}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context,i=e.container().select(".photoviewer").selectAll(".ms-wrapper").data([0]),r=i.enter().append("div").attr("class","photo-wrapper ms-wrapper").classed("hide",!0);r.append("div").attr("id","rapideditor-viewer-streetside").on("pointerdown.streetside",()=>{ye(window).on("pointermove.streetside",()=>{this.emit("viewerChanged")},!0)}).on("pointerup.streetside pointercancel.streetside",()=>{ye(window).on("pointermove.streetside",null);let n=kf(o=>{this.emit("viewerChanged"),o>2e3&&n.stop()})}).append("div").attr("class","photo-attribution fillD");let s=r.append("div").attr("class","photo-controls-wrap").append("div").attr("class","photo-controls");return s.append("button").on("click.back",()=>this._step(-1)).html("\u25C4"),s.append("button").on("click.forward",()=>this._step(1)).html("\u25BA"),i=i.merge(r).call(this._setupCanvas),e.systems.ui.photoviewer.on("resize.streetside",()=>{this._pannellumViewer&&this._pannellumViewer.resize()}),this._startPromise=new Promise((n,o)=>{let a=0;function l(){a+=1,a===2&&n()}let u=ye("head");u.selectAll("#rapideditor-streetside-viewercss").data([0]).enter().append("link").attr("id","rapideditor-streetside-viewercss").attr("rel","stylesheet").attr("crossorigin","anonymous").attr("href",e.asset(dee)).on("load",l).on("error",o),u.selectAll("#rapideditor-streetside-viewerjs").data([0]).enter().append("script").attr("id","rapideditor-streetside-viewerjs").attr("crossorigin","anonymous").attr("src",e.asset(fee)).on("load",l).on("error",o)}).then(()=>this._started=!0).catch(n=>{n instanceof Error&&console.error(n),this._startPromise=null}),this._startPromise}resetAsync(){if(this._cache.inflight)for(let e of this._cache.inflight.values())e.controller.abort();return this._cache={rtree:new eU.default,inflight:new Map,loaded:new Set,bubbles:new Map,sequences:new Map,unattachedBubbles:new Set,bubbleHasSequences:new Map,metadataPromise:null},Promise.resolve()}getImages(){let e=this.context.systems.map.extent();return this._cache.rtree.search(e.bbox()).map(i=>i.data)}getSequences(){let e=this._cache,i=this.context.systems.map.extent(),r=new Map;for(let s of e.rtree.search(i.bbox())){let n=s.data.id,o=e.bubbleHasSequences.get(n)??[];for(let a of o)r.has(a)||r.set(a,e.sequences.get(a))}return[...r.values()]}loadTiles(){let i=this.context.projection,r=this._tiler.zoomRange(JB).margin(2).getTiles(i).tiles;for(let[s,n]of this._cache.inflight)r.find(a=>a.id===s)||n.controller.abort();for(let s of r){let n=s.id;this._cache.loaded.has(n)||this._cache.inflight.has(n)||this._loadTileAsync(s).then(o=>this._processResults(o)).catch(o=>{o.name!=="AbortError"&&o instanceof Error&&console.error(o)})}}showViewer(){let e=this.context.container().select(".photoviewer").classed("hide",!1);e.selectAll(".photo-wrapper.ms-wrapper.hide").size()&&(e.selectAll(".photo-wrapper:not(.ms-wrapper)").classed("hide",!0),e.selectAll(".photo-wrapper.ms-wrapper").classed("hide",!1))}hideViewer(){let e=this.context;e.systems.photos.selectPhoto(null);let i=e.container().select(".photoviewer");i.empty()||i.datum(null),i.classed("hide",!0).selectAll(".photo-wrapper").classed("hide",!0),e.container().selectAll(".viewfield-group, .sequence, .icon-sign").classed("currentView",!1),this.setStyles(e,null,!0),this.emit("imageChanged")}selectImageAsync(e){let i=this._cache.bubbles.get(e),r=this.context,s=r.container().select(".photoviewer");s.empty()||s.datum(i),this.setStyles(r,null,!0);let n=r.container().select(".photoviewer .ms-wrapper"),o=n.selectAll(".photo-attribution").html("");if(n.selectAll(".pnlm-load-box").style("display","block").style("transform","translate(-50%, -50%)"),e&&!i&&(this._waitingForPhotoID=e),!i)return Promise.resolve();this._sceneOptions.northOffset=i.ca;let a=o.append("div").attr("class","attribution-row"),l=fl("streetside-hires"),u=a.append("label").attr("for",l).attr("class","streetside-hires");u.append("input").attr("type","checkbox").attr("id",l).property("checked",this._hires).on("click",F=>{F.stopPropagation(),this._hires=!this._hires,this._resolution=this._hires?1024:512,n.call(this._setupCanvas);let O={yaw:this._pannellumViewer.getYaw(),pitch:this._pannellumViewer.getPitch(),hfov:this._pannellumViewer.getHfov()};this._sceneOptions=Object.assign(this._sceneOptions,O),r.systems.photos.selectPhoto(),r.systems.photos.selectPhoto("streetside",i.id)}),u.append("span").text(this.context.t("streetside.hires"));let d=a.append("div").attr("class","attribution-capture-info");if(i.captured_by){let F=new Date().getFullYear();d.append("a").attr("class","captured_by").attr("target","_blank").attr("href","https://www.microsoft.com/en-us/maps/streetside").text(`\xA9 ${F} Microsoft`),d.append("span").text("|")}i.captured_at&&d.append("span").attr("class","captured_at").text(this._localeDateString(i.captured_at));let m=o.append("div").attr("class","attribution-row");m.append("a").attr("class","image-view-link").attr("target","_blank").attr("href","https://www.bing.com/maps?cp="+i.loc[1]+"~"+i.loc[0]+"&lvl=17&dir="+i.ca+"&style=x&v=2&sV=1").text(this.context.t("streetside.view_on_bing")),m.append("a").attr("class","image-report-link").attr("target","_blank").attr("href","https://www.bing.com/maps/privacyreport/streetsideprivacyreport?bubbleid="+encodeURIComponent(i.id)+"&focus=photo&lat="+i.loc[1]+"&lng="+i.loc[0]+"&z=17").text(this.context.t("streetside.report"));let g="http://ecn.t0.tiles.virtualearth.net/tiles/",v=parseInt(i.id,10).toString(4),E=16-v.length;for(let F=0;F<E;F++)v="0"+v;let b=g+"hs"+v,T="?g=13305&n=z",A=["01","02","03","10","11","12"],M=this._getQuadKeys(),k=A.map(F=>M.map(O=>{let B=this._qkToXY(O);return{face:F,url:b+F+O+T,x:B[0],y:B[1]}}));return this._loadFacesAsync(k).then(()=>{if(!this._pannellumViewer)this._initViewer();else{this._currScene++;let F=this._currScene.toString();this._pannellumViewer.addScene(F,this._sceneOptions).loadScene(F),this._currScene>2&&(F=(this._currScene-1).toString(),this._pannellumViewer.removeScene(F))}})}setStyles(e,i,r){r&&(e.container().selectAll(".viewfield-group").classed("highlighted",!1).classed("hovered",!1).classed("currentView",!1),e.container().selectAll(".sequence").classed("highlighted",!1).classed("currentView",!1));let s=i?.id,n=i?.sequenceID,o=n&&this._cache.sequences.get(n),a=o&&o.bubbles.map(b=>b.id)||[],l=e.container().select(".photoviewer"),u=l.empty()?void 0:l.datum(),d=u?.id,m=u?.sequenceID,g=m&&this._cache.sequences.get(m),_=g&&g.bubbles.map(b=>b.id)||[],v=ss(a,_);e.container().selectAll(".layer-streetside-images .viewfield-group").classed("highlighted",b=>v.indexOf(b.id)!==-1).classed("hovered",b=>b.id===s).classed("currentView",b=>b.id===d),e.container().selectAll(".layer-streetside-images .sequence").classed("highlighted",b=>b.properties.id===n).classed("currentView",b=>b.properties.id===m),e.container().selectAll(".layer-streetside-images .viewfield-group .viewfield").attr("d",E);function E(){let b=this.parentNode.__data__;return b.isPano&&b.id!==d?"M 8,13 m -10,0 a 10,10 0 1,0 20,0 a 10,10 0 1,0 -20,0":"M 6,9 C 8,8.4 8,8.4 10,9 L 16,-2 C 12,-5 4,-5 0,-2 z"}}_initViewer(){if(!window.pannellum||this._pannellumViewer)return;this._currScene++;let e=this._currScene.toString(),i={default:{firstScene:e},scenes:{}};i.scenes[e]=this._sceneOptions,this._pannellumViewer=window.pannellum.viewer("rapideditor-viewer-streetside",i)}_step(e){let i=this.context,r=i.container().select(".photoviewer"),s=r.empty()?void 0:r.datum();if(!s)return;let n=e===1?s.ne:s.pr,o=this._pannellumViewer.getYaw();this._sceneOptions.yaw=o;let a=s.ca+o,l=s.loc,u=35,d=[l[0]+Cn(u/5,l[1]),l[1]],m=[l[0]+Cn(u/2,l[1]),l[1]+kc(u)],g=[l[0]-Cn(u/2,l[1]),l[1]+kc(u)],_=[l[0]-Cn(u/5,l[1]),l[1]],v=[d,m,g,_,d],E=(e===1?a:a+180)*(Math.PI/180);v=Tu(v,-E,l);let b=v.reduce((M,k)=>(M.min=[Math.min(M.min[0],k[0]),Math.min(M.min[1],k[1])],M.max=[Math.max(M.max[0],k[0]),Math.max(M.max[1],k[1])],M),new mt),T=1/0;this._cache.rtree.search(b.bbox()).forEach(M=>{if(M.data.id===s.id||!Lf(M.data.loc,v))return;let k=Hi(M.data.loc,s.loc),F=s.ca-M.data.ca;Math.min(Math.abs(F),360-Math.abs(F))>20&&(k+=5),k<T&&(n=M.data.id,T=k)});let A=this._cache.bubbles.get(n);A&&(i.systems.map.centerEase(A.loc),i.systems.photos.selectPhoto("streetside",A.id),this.emit("imageChanged"))}_localeDateString(e){if(!e)return null;let i={day:"numeric",month:"short",year:"numeric"},r=new Date(e);if(isNaN(r.getTime()))return null;let s=this.context.systems.l10n.localeCode();return r.toLocaleString(s,i)}_processResults(e){let i=this._cache;i.loaded.add(e.tile.id);let r=e.data;if(!r)return;if(r.error)throw new Error(r.error);r.shift();let s=null,n=r.map(o=>{let l=o.id.toString();if(this._waitingForPhotoID===l&&(s=l,this._waitingForPhotoID=null),i.bubbles.has(l))return null;let u=[o.lo,o.la],d={loc:u,id:l,ca:o.he,captured_at:o.cd,captured_by:"microsoft",pr:o.pr?.toString(),ne:o.ne?.toString(),isPano:!0};return i.bubbles.set(l,d),i.unattachedBubbles.add(l),{minX:u[0],minY:u[1],maxX:u[0],maxY:u[1],data:d}}).filter(Boolean);if(this._cache.rtree.load(n),this._connectSequences(),s){let o=this.context.systems.photos;o.selectPhoto(),o.selectPhoto("streetside",s)}this.context.deferredRedraw(),this.emit("loadedData")}_connectSequences(){let e=this._cache,i=new Set,r=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}),s=Array.from(e.unattachedBubbles).sort(r.compare),n=(o,a)=>{i.add(o),e.unattachedBubbles.delete(a);let l=e.bubbleHasSequences.get(a);l||(l=[],e.bubbleHasSequences.set(a,l)),l.push(o)};for(let o of s){let a=e.unattachedBubbles.has(o),l=e.bubbles.get(o);if(!l||!a)continue;let u=l.ne,d=u&&e.bubbles.get(u),m=l.pr,g=m&&e.bubbles.get(m);if(u&&d){let _,v,E=d&&e.bubbleHasSequences.get(u)||[];for(_ of E){v=e.sequences.get(_);let b=v.bubbleIDs.at(0),T=v.bubbleIDs.at(-1);if(u===T){v.bubbleIDs.push(o),n(_,o);break}else if(u===b){v.bubbleIDs.unshift(o),n(_,o);break}}}if(m&&g){let _,v,E=g&&e.bubbleHasSequences.get(m)||[];for(_ of E){v=e.sequences.get(_);let b=v.bubbleIDs.at(0),T=v.bubbleIDs.at(-1);if(m===T){v.bubbleIDs.push(o),n(_,o);break}else if(m===b){v.bubbleIDs.unshift(o),n(_,o);break}}}if(e.unattachedBubbles.has(o)){let v=`s${this._nextSequenceID++}`,E={id:v,v:0,bubbleIDs:[o]};e.sequences.set(v,E),n(v,o),m&&g&&(E.bubbleIDs.unshift(m),n(v,m)),u&&d&&(E.bubbleIDs.push(u),n(v,u))}}for(let o of i){let a=e.sequences.get(o),l=a.bubbleIDs.map(u=>e.bubbles.get(u));a.v++,a.captured_at=l[0].captured_at,a.captured_by=l[0].captured_by,a.coordinates=l.map(u=>u.loc)}}_fetchMetadataAsync(e){if(this._cache.metadataPromise)return this._cache.metadataPromise;let[i,r]=e.wgs84Extent.center(),o=`https://dev.virtualearth.net/REST/v1/Imagery/MetaData/Streetside/${r},${i}?key=AoG8TaQvkPo6o8SlpRVmBs7WJwO_NDQklVRcAfpn7P8oiEMYWNY59XHSJU81sP1Y`;this._cache.metadataPromise=fetch(o).then(Ai).then(a=>{if(!a)throw new Error("no data");return a})}_loadTileAsync(e){let[i,r,s,n]=e.wgs84Extent.rectangle(),u="https://dev.virtualearth.net/mapcontrol/HumanScaleServices/GetBubbles.ashx?"+nr({n,s:r,e:s,w:i,c:2e3,appkey:"AuftgJsO0Xs8Ts4M1xZUQJQXJNsvmh3IV8DkNieCiy3tCwCUMq76-WpkrBtNAuEm",jsCallback:"{callback}"}),d=this._cache.inflight.get(e.id);if(d)return d.promise;let m=new AbortController,g=new Promise((_,v)=>{let E,b=KB(u,T=>{E&&m.signal.removeEventListener("abort",E),_({data:T,tile:e})});E=()=>{m.signal.removeEventListener("abort",E),b.abort(),v(new DOMException("Aborted","AbortError"))},m.signal.addEventListener("abort",E)}).finally(()=>{this._cache.inflight.delete(e.id)});return this._cache.inflight.set(e.id,{promise:g,controller:m}),g}_loadImageAsync(e){return new Promise(i=>{let r=e.face,s=document.getElementById(`rapideditor-canvas${r}`),n=s.getContext("2d"),o=new Image;o.onload=()=>{n.drawImage(o,e.x,e.y),i({imgInfo:e,status:"ok"})},o.onerror=()=>{n.clearRect(0,0,s.width,s.height),i({imgInfo:e,status:"error"})},o.setAttribute("crossorigin",""),o.src=e.url})}_loadFaceAsync(e){return Promise.all(e.map(i=>this._loadImageAsync(i))).then(i=>{let r=i[0].imgInfo.face,s=document.getElementById(`rapideditor-canvas${r}`),n={"01":0,"02":1,"03":2,10:3,11:4,12:5};return this._sceneOptions.cubeMap[n[r]]=s.toDataURL("image/jpeg",1),{status:`face ${r} ok`}})}_loadFacesAsync(e){return Promise.all(e.map(i=>this._loadFaceAsync(i))).then(()=>({status:"this._loadFacesAsync done"}))}_setupCanvas(e){e.selectAll("#rapideditor-stitcher-canvases").remove(),e.selectAll("#rapideditor-stitcher-canvases").data([0]).enter().append("div").attr("id","rapideditor-stitcher-canvases").attr("display","none").selectAll("canvas").data(["canvas01","canvas02","canvas03","canvas10","canvas11","canvas12"]).enter().append("canvas").attr("id",i=>`rapideditor-${i}`).attr("width",this._resolution).attr("height",this._resolution)}_qkToXY(e){let i=0,r=0,s=256;for(let n=e.length;n>0;n--){let o=e[n-1];i+=+(o==="1"||o==="3")*s,r+=+(o==="2"||o==="3")*s,s*=2}return[i,r]}_getQuadKeys(){let e=this._resolution/256,i;return e===16?i=["0000","0001","0010","0011","0100","0101","0110","0111","1000","1001","1010","1011","1100","1101","1110","1111","0002","0003","0012","0013","0102","0103","0112","0113","1002","1003","1012","1013","1102","1103","1112","1113","0020","0021","0030","0031","0120","0121","0130","0131","1020","1021","1030","1031","1120","1121","1130","1131","0022","0023","0032","0033","0122","0123","0132","0133","1022","1023","1032","1033","1122","1123","1132","1133","0200","0201","0210","0211","0300","0301","0310","0311","1200","1201","1210","1211","1300","1301","1310","1311","0202","0203","0212","0213","0302","0303","0312","0313","1202","1203","1212","1213","1302","1303","1312","1313","0220","0221","0230","0231","0320","0321","0330","0331","1220","1221","1230","1231","1320","1321","1330","1331","0222","0223","0232","0233","0322","0323","0332","0333","1222","1223","1232","1233","1322","1323","1332","1333","2000","2001","2010","2011","2100","2101","2110","2111","3000","3001","3010","3011","3100","3101","3110","3111","2002","2003","2012","2013","2102","2103","2112","2113","3002","3003","3012","3013","3102","3103","3112","3113","2020","2021","2030","2031","2120","2121","2130","2131","3020","3021","3030","3031","3120","3121","3130","3131","2022","2023","2032","2033","2122","2123","2132","2133","3022","3023","3032","3033","3122","3123","3132","3133","2200","2201","2210","2211","2300","2301","2310","2311","3200","3201","3210","3211","3300","3301","3310","3311","2202","2203","2212","2213","2302","2303","2312","2313","3202","3203","3212","3213","3302","3303","3312","3313","2220","2221","2230","2231","2320","2321","2330","2331","3220","3221","3230","3231","3320","3321","3330","3331","2222","2223","2232","2233","2322","2323","2332","2333","3222","3223","3232","3233","3322","3323","3332","3333"]:e===8?i=["000","001","010","011","100","101","110","111","002","003","012","013","102","103","112","113","020","021","030","031","120","121","130","131","022","023","032","033","122","123","132","133","200","201","210","211","300","301","310","311","202","203","212","213","302","303","312","313","220","221","230","231","320","321","330","331","222","223","232","233","322","323","332","333"]:e===4?i=["00","01","10","11","02","03","12","13","20","21","30","31","22","23","32","33"]:i=["0","1","2","3"],i}};var c7="https://taginfo.openstreetmap.org/api/4/",pee={point:"count_nodes",vertex:"count_nodes",area:"count_ways",line:"count_ways"},mee={point:"count_node_members",vertex:"count_node_members",area:"count_way_members",line:"count_way_members",relation:"count_relation_members"},gee={point:"nodes",vertex:"nodes",area:"ways",line:"ways"},yee={point:"count_node_members_fraction",vertex:"count_node_members_fraction",area:"count_way_members_fraction",line:"count_way_members_fraction",relation:"count_relation_members_fraction"},u7=class extends ui{constructor(e){super(e),this.id="taginfo",this._inflight={},this._cache={},this._popularKeys={postal_code:!0,full_name:!0,loc_name:!0,reg_name:!0,short_name:!0,sorting_name:!0,artist_name:!0,nat_name:!0,long_name:!0,"bridge:name":!0},this.keys=this.keys.bind(this),this.multikeys=this.multikeys.bind(this),this.values=this.values.bind(this),this.roles=this.roles.bind(this),this.docs=this.docs.bind(this),this._request=this._request.bind(this),this._debouncedRequest=Ur(this._request,300,{leading:!1})}initAsync(){return Promise.resolve()}startAsync(){let i={rp:100,sortname:"values_all",sortorder:"desc",page:1,debounce:!1,lang:this.context.systems.l10n.languageCode()};return new Promise((r,s)=>{this.keys(i,(n,o)=>{if(n)s();else{for(let a of o)a.value!=="opening_hours"&&(this._popularKeys[a.value]=!0);this._started=!0,r()}})})}resetAsync(){return this._debouncedRequest.cancel(),Object.values(this._inflight).forEach(e=>e.abort()),this._inflight={},Promise.resolve()}keys(e,i){let r=this.context.systems.l10n.languageCode(),s=e.debounce?this._debouncedRequest:this._request;e=this._clean(this._setSort(e)),e=Object.assign({rp:10,sortname:"count_all",sortorder:"desc",page:1,lang:r},e);let n=c7+"keys/all?"+nr(e);s(n,e,!1,i,(o,a)=>{if(o)i(o);else{let l=this._filterKeys(e.filter),u=a.data.filter(l).sort(this._sortKeys).map(this._valKey);this._cache[n]=u,i(null,u)}})}multikeys(e,i){let r=this.context.systems.l10n.languageCode(),s=e.debounce?this._debouncedRequest:this._request;e=this._clean(this._setSort(e)),e=Object.assign({rp:25,sortname:"count_all",sortorder:"desc",page:1,lang:r},e);let n=e.query,o=c7+"keys/all?"+nr(e);s(o,e,!0,i,(a,l)=>{if(a)i(a);else{let u=this._filterMultikeys(n),d=l.data.filter(u).map(this._valKey);this._cache[o]=d,i(null,d)}})}values(e,i){let r=e.key;if(r&&this._popularKeys[r]){i(null,[]);return}let s=this.context.systems.l10n.languageCode(),n=e.debounce?this._debouncedRequest:this._request;e=this._clean(this._setSort(this._setFilter(e))),e=Object.assign({rp:25,sortname:"count_all",sortorder:"desc",page:1,lang:s},e);let o=c7+"key/values?"+nr(e);n(o,e,!1,i,(a,l)=>{if(a)i(a);else{let d=/network|taxon|genus|species|brand|grape_constiety|royal_cypher|listed_status|booth|rating|stars|:output|_hours|_times|_ref|manufacturer|country|target|brewery/.test(e.key),m=this._filterValues(d),g=l.data.filter(m).map(this._valKeyDescription);this._cache[o]=g,i(null,g)}})}roles(e,i){let r=this.context.systems.l10n.languageCode(),s=e.debounce?this._debouncedRequest:this._request,n=e.geometry;e=this._clean(this._setSortMembers(e)),e=Object.assign({rp:25,sortname:"count_all_members",sortorder:"desc",page:1,lang:r},e);let o=c7+"relation/roles?"+nr(e);s(o,e,!0,i,(a,l)=>{if(a)i(a);else{let u=this._filterRoles(n),d=l.data.filter(u).map(this._roleKey);this._cache[o]=d,i(null,d)}})}docs(e,i){let r=e.debounce?this._debouncedRequest:this._request;e=this._clean(this._setSort(e));let s="key/wiki_pages?";e.value?s="tag/wiki_pages?":e.rtype&&(s="relation/wiki_pages?");let n=c7+s+nr(e);r(n,e,!0,i,(o,a)=>{o?i(o):(this._cache[n]=a.data,i(null,a.data))})}_sets(e,i,r){return e.geometry&&r[e.geometry]&&(e[i]=r[e.geometry]),e}_setFilter(e){return this._sets(e,"filter",gee)}_setSort(e){return this._sets(e,"sortname",pee)}_setSortMembers(e){return this._sets(e,"sortname",mee)}_clean(e){return un(e,["geometry","debounce"])}_filterKeys(e){let i=e?"count_"+e:"count_all";return r=>parseFloat(r[i])>2500||r.in_wiki}_filterMultikeys(e){return i=>{let r=new RegExp("^"+e+"(.*)$"),s=i.key.match(r)||[];return s.length===2&&s[1].indexOf(":")===-1}}_filterValues(e){return i=>i.value.match(/[;,]/)!==null||!e&&i.value.match(/[A-Z*]/)!==null?!1:parseFloat(i.fraction)>0}_filterRoles(e){return i=>i.role===""||i.role.match(/[A-Z*;,]/)!==null?!1:parseFloat(i[yee[e]])>0}_valKey(e){return{value:e.key,title:e.key}}_valKeyDescription(e){let i={value:e.value,title:e.description||e.value};return e.count&&(i.count=e.count),i}_roleKey(e){return{value:e.role,title:e.role}}_sortKeys(e,i){return e.key.indexOf(":")===-1&&i.key.indexOf(":")!==-1?-1:e.key.indexOf(":")!==-1&&i.key.indexOf(":")===-1?1:0}_request(e,i,r,s,n){if(this._inflight[e]||this._checkCache(e,i,r,s))return;let o=new AbortController;this._inflight[e]=o,fetch(e,{signal:o.signal}).then(Ai).then(a=>{delete this._inflight[e],n&&n(null,a)}).catch(a=>{delete this._inflight[e],a.name!=="AbortError"&&n&&n(a.message)})}_checkCache(e,i,r,s){let n=i.rp??25,o=i.query??"",a=e;do{let l=this._cache[a];if(l&&(e===a||l.length<n))return s(null,l),!0;if(r||!o.length)return!1;o=o.slice(0,-1),a=e.replace(/&query=(.*?)&/,`&query=${o}&`)}while(o.length>=0);return!1}};var vU=Xi(gA(),1),GA=Xi(a6(),1);var sa=(t,e,i)=>new Promise((r,s)=>{var n=l=>{try{a(i.next(l))}catch(u){s(u)}},o=l=>{try{a(i.throw(l))}catch(u){s(u)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(n,o);a((i=i.apply(t,e)).next())}),nl=Uint8Array,pp=Uint16Array,_ee=Int32Array,rU=new nl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),sU=new nl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),xee=new nl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),nU=function(t,e){for(var i=new pp(31),r=0;r<31;++r)i[r]=e+=1<<t[r-1];for(var s=new _ee(i[30]),r=1;r<30;++r)for(var n=i[r];n<i[r+1];++n)s[n]=n-i[r]<<5|r;return{b:i,r:s}},oU=nU(rU,2),aU=oU.b,vee=oU.r;aU[28]=258,vee[258]=28;var lU=nU(sU,0),bee=lU.b,U5t=lU.r,BA=new pp(32768);for(Gr=0;Gr<32768;++Gr)n1=(Gr&43690)>>1|(Gr&21845)<<1,n1=(n1&52428)>>2|(n1&13107)<<2,n1=(n1&61680)>>4|(n1&3855)<<4,BA[Gr]=((n1&65280)>>8|(n1&255)<<8)>>1;var n1,Gr,f7=function(t,e,i){for(var r=t.length,s=0,n=new pp(e);s<r;++s)t[s]&&++n[t[s]-1];var o=new pp(e);for(s=1;s<e;++s)o[s]=o[s-1]+n[s-1]<<1;var a;if(i){a=new pp(1<<e);var l=15-e;for(s=0;s<r;++s)if(t[s])for(var u=s<<4|t[s],d=e-t[s],m=o[t[s]-1]++<<d,g=m|(1<<d)-1;m<=g;++m)a[BA[m]>>l]=u}else for(a=new pp(r),s=0;s<r;++s)t[s]&&(a[s]=BA[o[t[s]-1]++]>>15-t[s]);return a},p7=new nl(288);for(Gr=0;Gr<144;++Gr)p7[Gr]=8;var Gr;for(Gr=144;Gr<256;++Gr)p7[Gr]=9;var Gr;for(Gr=256;Gr<280;++Gr)p7[Gr]=7;var Gr;for(Gr=280;Gr<288;++Gr)p7[Gr]=8;var Gr,cU=new nl(32);for(Gr=0;Gr<32;++Gr)cU[Gr]=5;var Gr,wee=f7(p7,9,1),Eee=f7(cU,5,1),NA=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},pc=function(t,e,i){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(e&7)&i},OA=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(e&7)},Tee=function(t){return(t+7)/8|0},See=function(t,e,i){(e==null||e<0)&&(e=0),(i==null||i>t.length)&&(i=t.length);var r=new nl(i-e);return r.set(t.subarray(e,i)),r},Aee=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],sl=function(t,e,i){var r=new Error(e||Aee[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,sl),!i)throw r;return r},zA=function(t,e,i,r){var s=t.length,n=r?r.length:0;if(!s||e.f&&!e.l)return i||new nl(0);var o=!i||e.i!=2,a=e.i;i||(i=new nl(s*3));var l=function(ct){var Se=i.length;if(ct>Se){var Qe=new nl(Math.max(Se*2,ct));Qe.set(i),i=Qe}},u=e.f||0,d=e.p||0,m=e.b||0,g=e.l,_=e.d,v=e.m,E=e.n,b=s*8;do{if(!g){u=pc(t,d,1);var T=pc(t,d+1,3);if(d+=3,T)if(T==1)g=wee,_=Eee,v=9,E=5;else if(T==2){var F=pc(t,d,31)+257,O=pc(t,d+10,15)+4,B=F+pc(t,d+5,31)+1;d+=14;for(var U=new nl(B),$=new nl(19),q=0;q<O;++q)$[xee[q]]=pc(t,d+q*3,7);d+=O*3;for(var W=NA($),Z=(1<<W)-1,Q=f7($,W,1),q=0;q<B;){var X=Q[pc(t,d,Z)];d+=X&15;var A=X>>4;if(A<16)U[q++]=A;else{var ce=0,de=0;for(A==16?(de=3+pc(t,d,3),d+=2,ce=U[q-1]):A==17?(de=3+pc(t,d,7),d+=3):A==18&&(de=11+pc(t,d,127),d+=7);de--;)U[q++]=ce}}var le=U.subarray(0,F),te=U.subarray(F);v=NA(le),E=NA(te),g=f7(le,v,1),_=f7(te,E,1)}else sl(1);else{var A=Tee(d)+4,M=t[A-4]|t[A-3]<<8,k=A+M;if(k>s){a&&sl(0);break}o&&l(m+M),i.set(t.subarray(A,k),m),e.b=m+=M,e.p=d=k*8,e.f=u;continue}if(d>b){a&&sl(0);break}}o&&l(m+131072);for(var ee=(1<<v)-1,oe=(1<<E)-1,ie=d;;ie=d){var ce=g[OA(t,d)&ee],ne=ce>>4;if(d+=ce&15,d>b){a&&sl(0);break}if(ce||sl(2),ne<256)i[m++]=ne;else if(ne==256){ie=d,g=null;break}else{var me=ne-254;if(ne>264){var q=ne-257,De=rU[q];me=pc(t,d,(1<<De)-1)+aU[q],d+=De}var He=_[OA(t,d)&oe],Je=He>>4;He||sl(3),d+=He&15;var te=bee[Je];if(Je>3){var De=sU[Je];te+=OA(t,d)&(1<<De)-1,d+=De}if(d>b){a&&sl(0);break}o&&l(m+131072);var ot=m+me;if(m<te){var gt=n-te,vt=Math.min(te,ot);for(gt+m<0&&sl(3);m<vt;++m)i[m]=r[gt+m]}for(;m<ot;m+=4)i[m]=i[m-te],i[m+1]=i[m+1-te],i[m+2]=i[m+2-te],i[m+3]=i[m+3-te];m=ot}}e.l=g,e.p=ie,e.b=m,e.f=u,g&&(u=1,e.m=v,e.d=_,e.n=E)}while(!u);return m==i.length?i:See(i,0,m)},Cee=new nl(0),Iee=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&sl(6,"invalid gzip data");var e=t[3],i=10;e&4&&(i+=(t[10]|t[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!t[i++]);return i+(e&2)},kee=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},Mee=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&sl(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&sl(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function Pee(t,e){return zA(t,{i:2},e&&e.out,e&&e.dictionary)}function Ree(t,e){var i=Iee(t);return i+8>t.length&&sl(6,"invalid gzip data"),zA(t.subarray(i,-8),{i:2},e&&e.out||new nl(kee(t)),e&&e.dictionary)}function Dee(t,e){return zA(t.subarray(Mee(t,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function UA(t,e){return t[0]==31&&t[1]==139&&t[2]==8?Ree(t,e):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?Pee(t,e):Dee(t,e)}var Fee=typeof TextDecoder<"u"&&new TextDecoder,Lee=0;try{Fee.decode(Cee,{stream:!0}),Lee=1}catch{}var uU=(t,e)=>t*Math.pow(2,e),h7=(t,e)=>Math.floor(t/Math.pow(2,e)),Xx=(t,e)=>uU(t.getUint16(e+1,!0),8)+t.getUint8(e),hU=(t,e)=>uU(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),Nee=(t,e,i,r,s)=>{if(t!=r.getUint8(s))return t-r.getUint8(s);let n=Xx(r,s+1);if(e!=n)return e-n;let o=Xx(r,s+4);return i!=o?i-o:0},Oee=(t,e,i,r)=>{let s=dU(t,e|128,i,r);return s?{z:e,x:i,y:r,offset:s[0],length:s[1],is_dir:!0}:null},tU=(t,e,i,r)=>{let s=dU(t,e,i,r);return s?{z:e,x:i,y:r,offset:s[0],length:s[1],is_dir:!1}:null},dU=(t,e,i,r)=>{let s=0,n=t.byteLength/17-1;for(;s<=n;){let o=n+s>>1,a=Nee(e,i,r,t,o*17);if(a>0)s=o+1;else if(a<0)n=o-1;else return[hU(t,o*17+7),t.getUint32(o*17+13,!0)]}return null},Bee=(t,e)=>t.is_dir&&!e.is_dir?1:!t.is_dir&&e.is_dir?-1:t.z!==e.z?t.z-e.z:t.x!==e.x?t.x-e.x:t.y-e.y,fU=(t,e)=>{let i=t.getUint8(e*17);return{z:i&127,x:Xx(t,e*17+1),y:Xx(t,e*17+4),offset:hU(t,e*17+7),length:t.getUint32(e*17+13,!0),is_dir:i>>7===1}},iU=t=>{let e=[],i=new DataView(t);for(let r=0;r<i.byteLength/17;r++)e.push(fU(i,r));return Uee(e)},Uee=t=>{t.sort(Bee);let e=new ArrayBuffer(17*t.length),i=new Uint8Array(e);for(let r=0;r<t.length;r++){let s=t[r],n=s.z;s.is_dir&&(n=n|128),i[r*17]=n,i[r*17+1]=s.x&255,i[r*17+2]=s.x>>8&255,i[r*17+3]=s.x>>16&255,i[r*17+4]=s.y&255,i[r*17+5]=s.y>>8&255,i[r*17+6]=s.y>>16&255,i[r*17+7]=s.offset&255,i[r*17+8]=h7(s.offset,8)&255,i[r*17+9]=h7(s.offset,16)&255,i[r*17+10]=h7(s.offset,24)&255,i[r*17+11]=h7(s.offset,32)&255,i[r*17+12]=h7(s.offset,48)&255,i[r*17+13]=s.length&255,i[r*17+14]=s.length>>8&255,i[r*17+15]=s.length>>16&255,i[r*17+16]=s.length>>24&255}return e},zee=(t,e)=>{if(t.byteLength<17)return null;let i=t.byteLength/17,r=fU(t,i-1);if(r.is_dir){let s=r.z,n=e.z-s,o=Math.trunc(e.x/(1<<n)),a=Math.trunc(e.y/(1<<n));return{z:s,x:o,y:a}}return null};function Gee(t){return sa(this,null,function*(){let e=yield t.getBytes(0,512e3),i=new DataView(e.data),r=i.getUint32(4,!0),s=i.getUint16(8,!0),n=new TextDecoder("utf-8"),o=JSON.parse(n.decode(new DataView(e.data,10,r))),a=0;o.compression==="gzip"&&(a=2);let l=0;"minzoom"in o&&(l=+o.minzoom);let u=0;"maxzoom"in o&&(u=+o.maxzoom);let d=0,m=0,g=0,_=-180,v=-85,E=180,b=85;if(o.bounds){let A=o.bounds.split(",");_=+A[0],v=+A[1],E=+A[2],b=+A[3]}if(o.center){let A=o.center.split(",");d=+A[0],m=+A[1],g=+A[2]}return{specVersion:i.getUint16(2,!0),rootDirectoryOffset:10+r,rootDirectoryLength:s*17,jsonMetadataOffset:10,jsonMetadataLength:r,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:l,maxZoom:u,minLon:_,minLat:v,maxLon:E,maxLat:b,centerZoom:g,centerLon:d,centerLat:m,etag:e.etag}})}function $ee(t,e,i,r,s,n,o){return sa(this,null,function*(){let a=yield i.getArrayBuffer(e,t.rootDirectoryOffset,t.rootDirectoryLength,t);t.specVersion===1&&(a=iU(a));let l=tU(new DataView(a),r,s,n);if(l){let m=(yield e.getBytes(l.offset,l.length,o)).data,g=new DataView(m);return g.getUint8(0)==31&&g.getUint8(1)==139&&(m=UA(new Uint8Array(m))),{data:m}}let u=zee(new DataView(a),{z:r,x:s,y:n});if(u){let d=Oee(new DataView(a),u.z,u.x,u.y);if(d){let m=yield i.getArrayBuffer(e,d.offset,d.length,t);t.specVersion===1&&(m=iU(m));let g=tU(new DataView(m),r,s,n);if(g){let v=(yield e.getBytes(g.offset,g.length,o)).data,E=new DataView(v);return E.getUint8(0)==31&&E.getUint8(1)==139&&(v=UA(new Uint8Array(v))),{data:v}}}}})}var pU={getHeader:Gee,getZxy:$ee};function fp(t,e){return(e>>>0)*4294967296+(t>>>0)}function Hee(t,e){let i=e.buf,r,s;if(s=i[e.pos++],r=(s&112)>>4,s<128||(s=i[e.pos++],r|=(s&127)<<3,s<128)||(s=i[e.pos++],r|=(s&127)<<10,s<128)||(s=i[e.pos++],r|=(s&127)<<17,s<128)||(s=i[e.pos++],r|=(s&127)<<24,s<128)||(s=i[e.pos++],r|=(s&1)<<31,s<128))return fp(t,r);throw new Error("Expected varint not more than 10 bytes")}function d7(t){let e=t.buf,i,r;return r=e[t.pos++],i=r&127,r<128||(r=e[t.pos++],i|=(r&127)<<7,r<128)||(r=e[t.pos++],i|=(r&127)<<14,r<128)||(r=e[t.pos++],i|=(r&127)<<21,r<128)?i:(r=e[t.pos],i|=(r&15)<<28,Hee(i,t))}function Vee(t,e,i,r){if(r==0){i==1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);let s=e[0];e[0]=e[1],e[1]=s}}var jee=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Xee(t,e,i){if(t>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,t)-1||i>Math.pow(2,t)-1)throw Error("tile x/y outside zoom level bounds");let r=jee[t],s=Math.pow(2,t),n=0,o=0,a=0,l=[e,i],u=s/2;for(;u>0;)n=(l[0]&u)>0?1:0,o=(l[1]&u)>0?1:0,a+=u*u*(3*n^o),Vee(u,l,n,o),u=u/2;return r+a}function mU(t,e){return sa(this,null,function*(){if(e===1||e===0)return t;if(e===2){if(typeof globalThis.DecompressionStream>"u")return UA(new Uint8Array(t));{let r=new Response(t).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}}else throw Error("Compression method not supported")})}var Wee=127;function qee(t,e){let i=0,r=t.length-1;for(;i<=r;){let s=r+i>>1,n=e-t[s].tileId;if(n>0)i=s+1;else if(n<0)r=s-1;else return t[s]}return r>=0&&(t[r].runLength===0||e-t[r].tileId<t[r].runLength)?t[r]:null}var Yee=class{constructor(t){this.url=t}getKey(){return this.url}getBytes(t,e,i){return sa(this,null,function*(){let r;i||(r=new AbortController,i=r.signal);let s=yield fetch(this.url,{signal:i,headers:{Range:"bytes="+t+"-"+(t+e-1)}});if(s.status===416&&t===0){let a=s.headers.get("Content-Range");if(!a||!a.startsWith("bytes */"))throw Error("Missing content-length on 416 response");let l=+a.substr(8);s=yield fetch(this.url,{signal:i,headers:{Range:"bytes=0-"+(l-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);let n=s.headers.get("Content-Length");if(s.status===200&&(!n||+n>e))throw r&&r.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function mc(t,e){let i=t.getUint32(e+4,!0),r=t.getUint32(e+0,!0);return i*Math.pow(2,32)+r}function Zee(t,e){let i=new DataView(t),r=i.getUint8(7);if(r>3)throw Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:mc(i,8),rootDirectoryLength:mc(i,16),jsonMetadataOffset:mc(i,24),jsonMetadataLength:mc(i,32),leafDirectoryOffset:mc(i,40),leafDirectoryLength:mc(i,48),tileDataOffset:mc(i,56),tileDataLength:mc(i,64),numAddressedTiles:mc(i,72),numTileEntries:mc(i,80),numTileContents:mc(i,88),clustered:i.getUint8(96)===1,internalCompression:i.getUint8(97),tileCompression:i.getUint8(98),tileType:i.getUint8(99),minZoom:i.getUint8(100),maxZoom:i.getUint8(101),minLon:i.getInt32(102,!0)/1e7,minLat:i.getInt32(106,!0)/1e7,maxLon:i.getInt32(110,!0)/1e7,maxLat:i.getInt32(114,!0)/1e7,centerZoom:i.getUint8(118),centerLon:i.getInt32(119,!0)/1e7,centerLat:i.getInt32(123,!0)/1e7,etag:e}}function gU(t){let e={buf:new Uint8Array(t),pos:0},i=d7(e),r=[],s=0;for(let n=0;n<i;n++){let o=d7(e);r.push({tileId:s+o,offset:0,length:0,runLength:1}),s+=o}for(let n=0;n<i;n++)r[n].runLength=d7(e);for(let n=0;n<i;n++)r[n].length=d7(e);for(let n=0;n<i;n++){let o=d7(e);o===0&&n>0?r[n].offset=r[n-1].offset+r[n-1].length:r[n].offset=o-1}return r}function Qee(t){let e=new DataView(t);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var mp=class extends Error{};function Kee(t,e,i,r){return sa(this,null,function*(){let s=yield t.getBytes(0,16384);if(new DataView(s.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Qee(s.data)<3)return[yield pU.getHeader(t)];let o=s.data.slice(0,Wee),a=s.etag;r&&s.etag!=r&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+t.getKey()),a=void 0);let l=Zee(o,a);if(i){let u=s.data.slice(l.rootDirectoryOffset,l.rootDirectoryOffset+l.rootDirectoryLength),d=t.getKey()+"|"+(l.etag||"")+"|"+l.rootDirectoryOffset+"|"+l.rootDirectoryLength,m=gU(yield e(u,l.internalCompression));return[l,[d,m.length,m]]}return[l,void 0]})}function Jee(t,e,i,r,s){return sa(this,null,function*(){let n=yield t.getBytes(i,r);if(s.etag&&s.etag!==n.etag)throw new mp(n.etag);let o=yield e(n.data,s.internalCompression),a=gU(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var ete=class{constructor(t=100,e=!0,i=mU){this.cache=new Map,this.maxCacheEntries=t,this.counter=1,this.prefetch=e,this.decompress=i}getHeader(t,e){return sa(this,null,function*(){let i=t.getKey();if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;let r=new Promise((s,n)=>{Kee(t,this.decompress,this.prefetch,e).then(o=>{o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:Promise.resolve(o[1][2])}),s(o[0]),this.prune()}).catch(o=>{n(o)})});return this.cache.set(i,{lastUsed:this.counter++,data:r}),r})}getDirectory(t,e,i,r){return sa(this,null,function*(){let s=t.getKey()+"|"+(r.etag||"")+"|"+e+"|"+i;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;let n=new Promise((o,a)=>{Jee(t,this.decompress,e,i,r).then(l=>{o(l),this.prune()}).catch(l=>{a(l)})});return this.cache.set(s,{lastUsed:this.counter++,data:n}),n})}getArrayBuffer(t,e,i,r){return sa(this,null,function*(){let s=t.getKey()+"|"+(r.etag||"")+"|"+e+"|"+i;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;let n=new Promise((o,a)=>{t.getBytes(e,i).then(l=>{if(r.etag&&r.etag!==l.etag)throw new mp(l.etag);o(l.data),this.cache.has(s),this.prune()}).catch(l=>{a(l)})});return this.cache.set(s,{lastUsed:this.counter++,data:n}),n})}prune(){if(this.cache.size>=this.maxCacheEntries){let t=1/0,e;this.cache.forEach((i,r)=>{i.lastUsed<t&&(t=i.lastUsed,e=r)}),e&&this.cache.delete(e)}}invalidate(t,e){return sa(this,null,function*(){this.cache.delete(t.getKey()),yield this.getHeader(t,e)})}},yU=class{constructor(t,e,i){typeof t=="string"?this.source=new Yee(t):this.source=t,i?this.decompress=i:this.decompress=mU,e?this.cache=e:this.cache=new ete}getHeader(){return sa(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(t,e,i,r){return sa(this,null,function*(){let s=Xee(t,e,i),n=yield this.cache.getHeader(this.source);if(n.specVersion<3)return pU.getZxy(n,this.source,this.cache,t,e,i,r);if(t<n.minZoom||t>n.maxZoom)return;let o=n.rootDirectoryOffset,a=n.rootDirectoryLength;for(let l=0;l<=3;l++){let u=yield this.cache.getDirectory(this.source,o,a,n),d=qee(u,s);if(d)if(d.runLength>0){let m=yield this.source.getBytes(n.tileDataOffset+d.offset,d.length,r);if(n.etag&&n.etag!==m.etag)throw new mp(m.etag);return{data:yield this.decompress(m.data,n.tileCompression),cacheControl:m.cacheControl,expires:m.expires}}else o=n.leafDirectoryOffset+d.offset,a=d.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(t,e,i,r){return sa(this,null,function*(){try{return yield this.getZxyAttempt(t,e,i,r)}catch(s){if(s instanceof mp)return this.cache.invalidate(this.source,s.message),yield this.getZxyAttempt(t,e,i,r);throw s}})}getMetadataAttempt(){return sa(this,null,function*(){let t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength);if(t.etag&&t.etag!==e.etag)throw new mp(e.etag);let i=yield this.decompress(e.data,t.internalCompression),r=new TextDecoder("utf-8");return JSON.parse(r.decode(i))})}getMetadata(){return sa(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof mp)return this.cache.invalidate(this.source,t.message),yield this.getMetadataAttempt();throw t}})}};var bU=Xi(xU(),1),wU=Xi(nT(),1),EU=Xi(xA(),1),TU=Xi(kl(),1);var m7=class extends ui{constructor(e){super(e),this.id="vectortile",this._sources=new Map,this._tiler=new Ns().tileSize(512).margin(1),this._nextID=0}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){for(let e of this._sources.values()){for(let i of e.inflight.values())i.abort();e.inflight.clear(),e.loaded.clear(),e.readyPromise=null;for(let i of e.zoomCache.values())i.features.clear(),i.boxes.clear(),i.toMerge.clear(),i.didMerge.clear(),i.rbush.clear();e.zoomCache.clear()}return this._sources.clear(),Promise.resolve()}getNextID(){return(this._nextID++).toString()}getData(e){let i=this._sources.get(e);if(!i)return[];let r=this.context.systems.map,s=r.extent(),n=Math.round(r.zoom())-1,o;for(let a=0;a<12;a++){if(o=i.zoomCache.get(n+a),o)return o.rbush.search(s.bbox()).map(l=>l.data);if(o=i.zoomCache.get(n-a),o)return o.rbush.search(s.bbox()).map(l=>l.data)}return[]}loadTiles(e){this._getSourceAsync(e).then(i=>{let r=i.header;if(r&&(this._tiler.zoomRange(r.minZoom,r.maxZoom),r.tileType!==1))throw new Error(`Unsupported tileType ${r.tileType}. Only Type 1 (MVT) is supported`);let s=this.context.projection,n=this._tiler.getTiles(s).tiles;for(let[a,l]of i.inflight)n.find(d=>d.id===a)||l.abort();let o=n.map(a=>this._loadTileAsync(i,a));return Promise.all(o).then(()=>this._processMergeQueue(i))})}_getSourceAsync(e){if(!e)return Promise.reject(new Error("No template"));let i=this._sources.get(e);if(!i){let r=new URL(e),s=r.hostname,n=r.pathname.split("/").at(-1);i={id:d3(e).toString(),displayName:s,template:e,inflight:new Map,loaded:new Map,zoomCache:new Map},this._sources.set(e,i),n&&/\.pmtiles$/.test(n)?(i.displayName=n,i.pmtiles=new yU(e),i.readyPromise=i.pmtiles.getHeader().then(o=>i.header=o).then(()=>Promise.resolve(i))):i.readyPromise=Promise.resolve(i)}return i.readyPromise}_getZoomCache(e,i){let r=e.zoomCache.get(i);return r||(r={features:new Map,boxes:new Map,toMerge:new Map,didMerge:new Set,rbush:new TU.default},e.zoomCache.set(i,r)),r}_loadTileAsync(e,i){let r=i.id;if(e.loaded.has(r)||e.inflight.has(r))return;let s=new AbortController;e.inflight.set(r,s);let[n,o,a]=i.xyz,l;if(e.pmtiles)l=e.pmtiles.getZxy(a,n,o,s.signal).then(u=>u?.data);else{let u=e.template.replace("{x}",n).replace("{y}",o).replace(/\{[t-]y\}/,Math.pow(2,a)-o-1).replace(/\{z(oom)?\}/,a).replace(/\{switch:([^}]+)\}/,function(d,m){let g=m.split(",");return g[(n+o)%g.length]});l=fetch(u,{signal:s.signal}).then(Ai)}return l.then(u=>{e.loaded.set(r,i),this._parseTileBuffer(e,i,u)}).catch(u=>{u.name!=="AbortError"&&u instanceof Error&&console.error(u)}).finally(()=>{e.inflight.delete(r)})}_parseTileBuffer(e,i,r){if(!r)return;let[s,n,o]=i.xyz,a=i.id,l=i.wgs84Extent,u=`${s-1},${n},${o}-${a}`,d=`${a}-${s+1},${n},${o}`,m=`${s},${n-1},${o}-${a}`,g=`${a}-${s},${n+1},${o}`,_=new vU.VectorTile(new EU.default(r)),v=this._getZoomCache(e,o),E=[];for(let[b,T]of Object.entries(_.layers)){if(!T)continue;let A=0,M=T.extent;for(let k=0;k<T.length;k++){let F=T.feature(k),[O,B,U,$]=F.bbox();if(O>M||B>M||U<A||$<A)continue;for(let[Z,Q]of Object.entries(F.properties))F.properties[Z]=Q.toString();let q=d3((0,bU.default)(F.properties)).toString();F.id||(F.id=q);let W=F.toGeoJSON(s,n,o);for(let Z of this._toSingleFeatures(W)){let Q=this._calcExtent(Z);if(!isFinite(Q.min[0]))continue;let X=this.getNextID();Z.id=X,Z.__featurehash__=X,Z.geometry.type==="Polygon"&&(Q.min[0]<l.min[0]&&this._queueMerge(v,X,q,u),Q.max[0]>l.max[0]&&this._queueMerge(v,X,q,d),Q.min[1]<l.min[1]&&this._queueMerge(v,X,q,g),Q.max[1]>l.max[1]&&this._queueMerge(v,X,q,m)),E.push({id:X,extent:Q,layerID:b,prophash:q,geojson:(0,GA.default)(Z,!0),v:0})}}}E.length&&(this._cacheFeatures(v,E),this.context.deferredRedraw(),this.emit("loadedData"))}_queueMerge(e,i,r,s){if(e.didMerge.has(s))return;let n=e.toMerge.get(s);n||(n=new Map,e.toMerge.set(s,n));let o=n.get(r);o||(o=new Set,n.set(r,o)),o.add(i)}_processMergeQueue(e){for(let i of e.zoomCache.values())for(let[r,s]of i.toMerge){let[n,o]=r.split("-"),a=e.loaded.get(n),l=e.loaded.get(o);if(!(!a||!l)){i.didMerge.add(r);for(let[u,d]of s)this._mergePolygons(i,u,d,a,l),s.delete(u);i.toMerge.delete(r)}}}_cacheFeatures(e,i){let r=[];for(let s of i){e.features.set(s.id,s);let n=s.extent.bbox();n.data=s,e.boxes.set(s.id,n),r.push(n)}e.rbush.load(r)}_uncacheFeatureIDs(e,i){for(let r of i){let s=e.boxes.get(r);s&&(e.boxes.delete(r),e.rbush.remove(s)),e.features.delete(r)}}_mergePolygons(e,i,r,s,n){let o=Array.from(r).map(de=>e.features.get(de)).filter(Boolean);if(!o.length)return;let[a,l,u]=s.xyz,[d,m,g]=n.xyz,_=s.id,v=n.id,E=s.wgs84Extent,b=n.wgs84Extent,T=m===l+1,A=d===a+1,M=`${a-1},${l},${u}-${_}`,k=`${_}-${a+1},${l},${u}`,F=`${a},${l-1},${u}-${_}`,O=`${_}-${a},${l+1},${u}`,B=`${d-1},${m},${g}-${v}`,U=`${v}-${d+1},${m},${g}`,$=`${d},${m-1},${g}-${v}`,q=`${v}-${d},${m+1},${g}`,W=o[0];this._uncacheFeatureIDs(e,r);let Z=o.map(de=>de.geojson.geometry.coordinates),Q=wU.default.union(...Z);if(!Q||!Q.length)throw new Error("Failed to merge");let X={type:"Feature",geometry:{type:"MultiPolygon",coordinates:Q},properties:Object.assign({},W.geojson.properties)},ce=[];for(let de of this._toSingleFeatures(X)){let le=this._calcExtent(de);if(!isFinite(le.min[0]))continue;this._dedupePoints(de);let te=this.getNextID();de.id=te,de.__featurehash__=te,le.min[0]<E.min[0]&&this._queueMerge(e,te,i,M),T&&le.max[0]>E.max[0]&&this._queueMerge(e,te,i,k),A&&le.min[1]<E.min[1]&&this._queueMerge(e,te,i,O),le.max[1]>E.max[1]&&this._queueMerge(e,te,i,F),T&&le.min[0]<b.min[0]&&this._queueMerge(e,te,i,B),le.max[0]>b.max[0]&&this._queueMerge(e,te,i,U),le.min[1]<b.min[1]&&this._queueMerge(e,te,i,q),A&&le.max[1]>b.max[1]&&this._queueMerge(e,te,i,$),ce.push({id:te,extent:le,layerID:W.layerID,prophash:i,geojson:(0,GA.default)(de,!0),v:0})}ce.length&&(this._cacheFeatures(e,ce),this.context.deferredRedraw())}_calcExtent(e){let i=new mt,r=e?.geometry;if(!e||!r)return i;let s=r.type,n=r.coordinates,o=/^Multi/.test(s)?n:[n];if(/Polygon$/.test(s))for(let l of o){let u=l[0];for(let d of u)a(d)}else if(/LineString$/.test(s))for(let l of o)for(let u of l)a(u);else if(/Point$/.test(s))for(let l of o)a(l);return i;function a(l){i.min=[Math.min(i.min[0],l[0]),Math.min(i.min[1],l[1])],i.max=[Math.max(i.max[0],l[0]),Math.max(i.max[1],l[1])]}}_dedupePoints(e){let i=e?.geometry;if(!e||!i||i.type!=="Polygon")return;let r=5e-6,s=i.coordinates;for(let n=0;n<s.length;n++){let o=s[n],a=[],l=null;for(let u=0;u<o.length;u++){let d=o[u];u===0||u===o.length-1?a.push(d):Wi(d,l,r)||a.push(d),l=d}s[n]=a}}_toSingleFeatures(e){let i=[],r=e?.geometry;if(!e||!r)return i;let s=r.type,n=r.coordinates,o=/^Multi/.test(s)?n:[n];for(let a of o)i.push({type:"Feature",id:e.id??void 0,geometry:{type:s.replace("Multi",""),coordinates:a},properties:Object.assign({},e.properties)});return i}};var $A="https://www.wikidata.org/w/api.php?",g7=class extends ui{constructor(e){super(e),this.id="wikidata",this._cache=new Map}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this._cache.clear(),Promise.resolve()}itemsForSearchQuery(e,i){if(!e){i&&i("No query",{});return}let r=this.languagesToQuery()[0],s=$A+nr({action:"wbsearchentities",format:"json",formatversion:2,search:e,type:"item",language:r,uselang:r,limit:10,origin:"*"});fetch(s).then(Ai).then(n=>{if(n&&n.error)throw new Error(n.error);i&&i(null,n.search||{})}).catch(n=>{i&&i(n.message,{})})}itemsByTitle(e,i,r){if(!i){r&&r("No title",{});return}e=e||"en";let s=$A+nr({action:"wbgetentities",format:"json",formatversion:2,sites:e.replace(/-/g,"_")+"wiki",titles:i,languages:"en",origin:"*"});fetch(s).then(Ai).then(n=>{if(n&&n.error)throw new Error(n.error);r&&r(null,n.entities||{})}).catch(n=>{r&&r(n.message,{})})}languagesToQuery(){return this.context.systems.l10n.localeCodes().map(i=>i.toLowerCase()).filter(i=>i!=="en-us")}entityByQID(e,i){if(!e){i("No qid",{});return}if(this._cache.has(e)){i&&i(null,this._cache.get(e));return}let r=this.languagesToQuery(),s=$A+nr({action:"wbgetentities",format:"json",formatversion:2,ids:e,props:"labels|descriptions|claims|sitelinks",sitefilter:r.map(n=>`${n}wiki`).join("|"),languages:r.join("|"),languagefallback:1,origin:"*"});fetch(s).then(Ai).then(n=>{if(n&&n.error)throw new Error(n.error);this._cache.set(e,n.entities[e]),i&&i(null,n.entities[e]||{})}).catch(n=>{i&&i(n.message,{})})}getDocs(e,i){let r=this.languagesToQuery();this.entityByQID(e.qid,function(s,n){if(s||!n){i(s||"No entity");return}let o;for(let l of r)if(n.descriptions[l]&&n.descriptions[l].language===l){o=n.descriptions[l];break}!o&&Object.values(n.descriptions).length&&(o=Object.values(n.descriptions)[0]);let a={title:n.id,description:o?.value??"",descriptionLocaleCode:o?.language??"",editURL:`https://www.wikidata.org/wiki/${n.id}`};if(n.claims){let l="https://commons.wikimedia.org/w/index.php?";for(let u of["P154","P18"]){let d=n.claims[u];if(d&&Object.keys(d).length){let m=d[Object.keys(d)[0]].mainsnak.datavalue.value;if(m){a.imageURL=l+nr({title:`Special:Redirect/file/${m}`,width:400});break}}}}if(n.sitelinks){let u=this.context.systems.l10n.languageCode().toLowerCase()==="en";for(let d of r){let m=`${d}wiki`;if(n.sitelinks[m]){let g=n.sitelinks[m].title,_="inspector.wiki_reference";!u&&d==="en"&&(_="inspector.wiki_en_reference"),a.wiki={title:g,text:_,url:`https://${d}.wikipedia.org/wiki/`+g.replace(/ /g,"_")};break}}}i(null,a)})}};var HA="https://en.wikipedia.org/w/api.php?",y7=class extends ui{constructor(e){super(e),this.id="wikipedia"}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}search(e,i,r){if(!i){r&&r("No Query",[]);return}e=e||"en";let s=HA.replace("en",e)+nr({action:"query",list:"search",srlimit:"10",srinfo:"suggestion",format:"json",origin:"*",srsearch:i});fetch(s).then(Ai).then(n=>{if(n&&n.error)throw new Error(n.error);if(!n||!n.query||!n.query.search)throw new Error("No Results");if(r){let o=n.query.search.map(a=>a.title);r(null,o)}}).catch(n=>{r&&r(n,[])})}suggestions(e,i,r){if(!i){r&&r("",[]);return}e=e||"en";let s=HA.replace("en",e)+nr({action:"opensearch",namespace:0,suggest:"",format:"json",origin:"*",search:i});fetch(s).then(Ai).then(n=>{if(n&&n.error)throw new Error(n.error);if(!n||n.length<2)throw new Error("No Results");r&&r(null,n[1]||[])}).catch(n=>{r&&r(n.message,[])})}translations(e,i,r){if(!i){r&&r("No Title");return}e=e||"en";let s=HA.replace("en",e)+nr({action:"query",prop:"langlinks",format:"json",origin:"*",lllimit:500,titles:i});fetch(s).then(Ai).then(n=>{if(n&&n.error)throw new Error(n.error);if(!n||!n.query||!n.query.pages)throw new Error("No Results");if(r){let o=n.query.pages[Object.keys(n.query.pages)[0]],a={};o&&o.langlinks&&o.langlinks.forEach(function(l){a[l.lang]=l["*"]}),r(null,a)}}).catch(n=>{r&&r(n.message)})}};var Rn={available:new Map};Rn.available.set("esri",j6);Rn.available.set("improveOSM",X6);Rn.available.set("kartaview",W6);Rn.available.set("keepRight",q6);Rn.available.set("mapillary",Y6);Rn.available.set("mapwithai",Z6);Rn.available.set("nominatim",Q6);Rn.available.set("nsi",J6);Rn.available.set("osm",n7);Rn.available.set("osmose",o7);Rn.available.set("osmwikibase",a7);Rn.available.set("streetside",l7);Rn.available.set("taginfo",u7);Rn.available.set("vectortile",m7);Rn.available.set("wikidata",g7);Rn.available.set("wikipedia",y7);function SU(){var t=["building","highway","railway","waterway","aeroway","aerialway","piste:type","boundary","power","amenity","natural","landuse","leisure","military","place","man_made","route","attraction","building:part","indoor"],e=Object.keys(S1),i=["oneway","bridge","tunnel","embankment","cutting","barrier","surface","tracktype","footway","crossing","service","sport","public_transport","location","parking","golf","type","leisure","man_made","indoor"],r=function(n){return n.tags},s=function(n){n.each(function(a){var l=this.className;l.baseVal!==void 0&&(l=l.baseVal);var u=r(a),d=s.getClassesString(u,l);d!==l&&ye(this).attr("class",d)})};return s.getClassesString=function(n,o){var a,l,u,d,m,g,_;/\bstroke\b/.test(o)&&n.barrier&&n.barrier!=="no"&&(_="line");var v=o.trim().split(/\s+/).filter(function(T){return T.length&&!/^tag-/.test(T)}).map(function(T){return(T==="line"||T==="area")&&_||T});for(u=0;u<t.length;u++)if(m=t[u],g=n[m],!(!g||g==="no")){m==="piste:type"?m="piste":m==="building:part"&&(m="building_part"),a=m,e.indexOf(g)!==-1?(l=g,v.push("tag-"+m)):(v.push("tag-"+m),v.push("tag-"+m+"-"+g));break}if(!a){for(u=0;u<e.length;u++)for(d=0;d<t.length;d++)if(m=e[u]+":"+t[d],g=n[m],!(!g||g==="no")){l=e[u];break}}if(!l)for(u=0;u<e.length&&(m=e[u],g=n[m],!(!(!g||g==="no")&&(g==="yes"||a&&a===g?l=m:!a&&t.indexOf(g)!==-1&&(l=m,a=g,v.push("tag-"+g)),l)));u++);for(l&&(v.push("tag-status"),v.push("tag-status-"+l)),u=0;u<i.length;u++)m=i[u],g=n[m],!(!g||g==="no"||m===a)&&(v.push("tag-"+m),v.push("tag-"+m+"-"+g));if(a==="highway"&&!jl[n.highway]||a==="aeroway"){var E=n.highway==="track"?"unpaved":"paved";for(m in n)g=n[m],m in rd&&(E=rd[m][g]?"paved":"unpaved"),m in pb&&pb[m][g]&&(E="semipaved");v.push("tag-"+E)}var b=n.wikidata||n["flag:wikidata"]||n["brand:wikidata"]||n["network:wikidata"]||n["operator:wikidata"];return b&&v.push("tag-wikidata"),v.join(" ").trim()},s.tags=function(n){return arguments.length?(r=n,s):r},s}var tte=15,ite=256,Wx=class extends en.default{constructor(){super(),this.version="2.1.1",this.privacyVersion="20201202",this.maxCharsForTagKey=255,this.maxCharsForTagValue=255,this.maxCharsForRelationRole=255,this.assetPath="",this.assetMap={},this.projection=new zo,this.systems={},this.modes={},this._currMode=null,this.behaviors={},this.services={},this.lastPointerType="mouse",this._keybinding=zi("context"),ye(document).call(this._keybinding),this._preauth=null,this._apiConnections=null,this._prelocale=null,this._copyGraph=null,this._copyIDs=[],this._copyLoc=null,this._debugFlags={tile:!1,label:!1,imagery:!1,target:!1,downloaded:!1},this._container=ye(null),this._embed=null,this.inIntro=!1,this.save=this.save.bind(this),this.debouncedSave=Ur(this.save,350)}initAsync(){for(let[l,u]of Pn.available)this.systems[l]=new u(this);let e=this.systems.edits,i=l=>(...u)=>{let d=l.apply(e,u);return this.debouncedSave(),d};this.graph=e.graph,this.hasEntity=l=>e.graph().hasEntity(l),this.entity=l=>e.graph().entity(l),this.pauseChangeDispatch=e.pauseChangeDispatch,this.resumeChangeDispatch=e.resumeChangeDispatch,this.perform=i(e.perform),this.replace=i(e.replace),this.pop=i(e.pop),this.overwrite=i(e.overwrite),this.undo=i(e.undo),this.redo=i(e.redo);let r=this.systems.l10n;this.t=r.t,this.tHtml=r.tHtml,this.tAppend=r.tAppend,this._prelocale&&(this.systems.l10n.preferredLocaleCodes=this._prelocale);let s=this.systems.filters;this.hasHiddenConnections=l=>{let u=e.graph(),d=u.entity(l);return s.hasHiddenConnections(d,u)};let n=this.systems.map;this.deferredRedraw=n.deferredRedraw,this.immediateRedraw=n.immediateRedraw,this.scene=()=>n.scene,this.surface=()=>n.surface,this.surfaceRect=()=>n.surface.node().getBoundingClientRect(),this.editable=()=>{let l=this._currMode;return!(!l||l.id==="save")};for(let[l,u]of Ia.available)this.modes[l]=new u(this);for(let[l,u]of ac.available)this.behaviors[l]=new u(this);if(!window.mocha)for(let[l,u]of Rn.available)this.services[l]=new u(this);let o=Object.values(this.systems),a=Object.values(this.services);return Promise.resolve().then(()=>Promise.all(o.map(l=>l.initAsync()))).then(()=>Promise.all(a.map(l=>l.initAsync()))).then(()=>{let l=this.services.osm;return l&&this._preauth?l.switchAsync(this._preauth):Promise.resolve()}).then(()=>Promise.all(o.map(l=>l.autoStart?l.startAsync():Promise.resolve()))).then(()=>Promise.all(a.map(l=>l.autoStart?l.startAsync():Promise.resolve())))}resetAsync(){this.debouncedSave.cancel();let e=Object.values(this.systems),i=Object.values(this.services);return Promise.resolve().then(()=>Promise.all(e.map(r=>r.resetAsync()))).then(()=>Promise.all(i.map(r=>r.resetAsync())))}keybinding(){return this._keybinding}get preauth(){return this._preauth}set preauth(e){this._preauth=Object.assign({},e)}get apiConnections(){return this._apiConnections}set apiConnections(e){this._apiConnections=e}get locale(){return this._prelocale}set locale(e){this._prelocale=e}_afterLoad(e,i){return(r,s)=>{let n=this.services.osm;if(r){(r.status===400||r.status===401||r.status===403)&&n?.logout(),typeof i=="function"&&i(r);return}else if(n?.connectionID!==e){typeof i=="function"&&i({message:"Connection Switched",status:-1});return}else{this.systems.edits.merge(s.data,s.seenIDs),typeof i=="function"&&i(r,s);return}}}loadTiles(e,i){let r=this.services.osm;if(!(!r||Ba(e.scale(),ite)<tte)&&this.editable()){let n=r.connectionID;r.loadTiles(e,this._afterLoad(n,i))}}loadTileAtLoc(e,i){let r=this.services.osm;if(r&&this.editable()){let s=r.connectionID;r.loadTileAtLoc(e,this._afterLoad(s,i))}}loadEntity(e,i){let r=this.services.osm;if(!r)return;let s=r.connectionID;r.loadEntity(e,this._afterLoad(s,i)),r.loadEntityRelations(e,this._afterLoad(s,i))}_cleanOsmString(e,i){return e==null?e="":e=e.toString(),e=e.trim(),e.normalize&&(e=e.normalize("NFC")),b9(e,i)}cleanTagKey(e){return this._cleanOsmString(e,this.maxCharsForTagKey)}cleanTagValue(e){return this._cleanOsmString(e,this.maxCharsForTagValue)}cleanRelationRole(e){return this._cleanOsmString(e,this.maxCharsForRelationRole)}save(){let e=this.systems.edits,i=this.systems.l10n;if(this.inIntro||this._container.select(".modal").size())return;let r;if(this._currMode?.id==="save"){r=!1;let s=this.services.osm;if(s&&s.isChangesetInflight()){e.clearSaved();return}}else r=this.selectedIDs().every(s=>{let n=this.hasEntity(s);return n&&!n.isDegenerate()});if(r&&e.save(),e.hasChanges())return i.t("save.unsaved_changes")}get mode(){return this._currMode}enter(e,i){let r=this._currMode,s;return typeof e=="string"?s=this.modes[e]:s=e,s||(console.error(`context.enter: no such mode: ${e}`),s=this.modes.browse),r&&(r.exit(),this._container.classed(`mode-${r.id}`,!1)),this._currMode=s,this._currMode.enter(i)||(this._currMode=this.modes.browse,this._currMode.enter()),this._container.classed(`mode-${this._currMode.id}`,!0),this.emit("modechange",this._currMode),this._currMode}selectedData(){return this._currMode?this._currMode.selectedData||new Map:new Map}selectedIDs(){return this._currMode?this._currMode.selectedIDs||[]:[]}selectedNoteID(){return console.error("deprecated: do not call context.selectedNoteID anymore"),null}selectedErrorID(){return console.error("deprecated: do not call context.selectedErrorID anymore"),null}enableBehaviors(e){e instanceof Set||(e=new Set([].concat(e)));for(let[i,r]of Object.entries(this.behaviors))e.has(i)?r.enabled||r.enable():r.enabled&&r.disable()}get copyGraph(){return this._copyGraph}set copyGraph(e){this._copyGraph=e}get copyIDs(){return this._copyIDs}set copyIDs(e){this._copyIDs=e,this._copyGraph=this.systems.edits.graph()}get copyLoc(){return this._copyLoc}set copyLoc(e){this._copyLoc=e}debugFlags(){return this._debugFlags}getDebug(e){return e&&this._debugFlags[e]}setDebug(e,i=!0){this._debugFlags[e]=i,this.systems.map?.renderer&&this.systems.map.immediateRedraw()}container(e){return e===void 0?this._container:(this._container=e,this._container.classed("ideditor",!0),this)}get containerNode(){return this._container.node()}set containerNode(e){this.container(ye(e))}embed(e){return e===void 0?this._embed:(this._embed=e,this)}asset(e){if(/^http(s)?:\/\//i.test(e))return e;let i=`${this.assetPath}${e}`;return this.assetMap[i]||i}imagePath(e){return console.error("deprecated: do not call context.imagePath anymore"),this.asset(`img/${e}`)}};var{abs:C6t,max:I6t,min:k6t}=Math;function AU(t){return[+t[0],+t[1]]}function rte(t){return[AU(t[0]),AU(t[1])]}var M6t={name:"x",handles:["w","e"].map(VA),input:function(t,e){return t==null?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},P6t={name:"y",handles:["n","s"].map(VA),input:function(t,e){return t==null?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},R6t={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(VA),input:function(t){return t==null?null:rte(t)},output:function(t){return t}};function VA(t){return{type:t}}var nte={polygonArea:Sf,polygonCentroid:da,select:ye,selectAll:Bb,timerFlush:a8},ote={Projection:zo,Extent:mt,geoSphericalDistance:fr,geoZoomToScale:In,vecLength:Hi,utilQsString:nr,utilStringQs:ed};Ki.setOptions({headerIds:!1,mangle:!1});window.requestIdleCallback=window.requestIdleCallback||function(t){var e=Date.now();return window.requestAnimationFrame(function(){t({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-e))}})})};window.cancelIdleCallback=window.cancelIdleCallback||function(t){window.cancelAnimationFrame(t)};window.Rapid=qx;window.iD=qx;})();
//# sourceMappingURL=rapid.min.js.map
