(()=>{var OG=Object.create;var S9=Object.defineProperty,BG=Object.defineProperties,UG=Object.getOwnPropertyDescriptor,zG=Object.getOwnPropertyDescriptors,GG=Object.getOwnPropertyNames,T9=Object.getOwnPropertySymbols,$G=Object.getPrototypeOf,_b=Object.prototype.hasOwnProperty,LI=Object.prototype.propertyIsEnumerable;var yb=(t,e,i)=>e in t?S9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,di=(t,e)=>{for(var i in e||(e={}))_b.call(e,i)&&yb(t,i,e[i]);if(T9)for(var i of T9(e))LI.call(e,i)&&yb(t,i,e[i]);return t},Tn=(t,e)=>BG(t,zG(e));var df=(t,e)=>{var i={};for(var r in t)_b.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(t!=null&&T9)for(var r of T9(t))e.indexOf(r)<0&&LI.call(t,r)&&(i[r]=t[r]);return i};var Gi=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),A9=(t,e)=>{for(var i in e)S9(t,i,{get:e[i],enumerable:!0})},HG=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of GG(e))!_b.call(t,s)&&s!==i&&S9(t,s,{get:()=>e[s],enumerable:!(r=UG(e,s))||r.enumerable});return t};var Yi=(t,e,i)=>(i=t!=null?OG($G(t)):{},HG(e||!t||!t.__esModule?S9(i,"default",{value:t,enumerable:!0}):i,t));var Vr=(t,e,i)=>(yb(t,typeof e!="symbol"?e+"":e,i),i),VG=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)};var xb=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)};var C9=(t,e,i)=>(VG(t,e,"access private method"),i);var ii=(t,e,i)=>new Promise((r,s)=>{var n=l=>{try{a(i.next(l))}catch(c){s(c)}},o=l=>{try{a(i.throw(l))}catch(c){s(c)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(n,o);a((i=i.apply(t,e)).next())});var OI=Gi((vb,NI)=>{(function(t){"use strict";function e(re){return parseInt(re)===re}function i(re){if(!e(re.length))return!1;for(var te=0;te<re.length;te++)if(!e(re[te])||re[te]<0||re[te]>255)return!1;return!0}function r(re,te){if(re.buffer&&re.name==="Uint8Array")return te&&(re.slice?re=re.slice():re=Array.prototype.slice.call(re)),re;if(Array.isArray(re)){if(!i(re))throw new Error("Array contains invalid value: "+re);return new Uint8Array(re)}if(e(re.length)&&i(re))return new Uint8Array(re);throw new Error("unsupported array-like object")}function s(re){return new Uint8Array(re)}function n(re,te,ie,oe,fe){(oe!=null||fe!=null)&&(re.slice?re=re.slice(oe,fe):re=Array.prototype.slice.call(re,oe,fe)),te.set(re,ie)}var o=function(){function re(ie){var oe=[],fe=0;for(ie=encodeURI(ie);fe<ie.length;){var Re=ie.charCodeAt(fe++);Re===37?(oe.push(parseInt(ie.substr(fe,2),16)),fe+=2):oe.push(Re)}return r(oe)}function te(ie){for(var oe=[],fe=0;fe<ie.length;){var Re=ie[fe];Re<128?(oe.push(String.fromCharCode(Re)),fe++):Re>191&&Re<224?(oe.push(String.fromCharCode((Re&31)<<6|ie[fe+1]&63)),fe+=2):(oe.push(String.fromCharCode((Re&15)<<12|(ie[fe+1]&63)<<6|ie[fe+2]&63)),fe+=3)}return oe.join("")}return{toBytes:re,fromBytes:te}}(),a=function(){function re(oe){for(var fe=[],Re=0;Re<oe.length;Re+=2)fe.push(parseInt(oe.substr(Re,2),16));return fe}var te="0123456789abcdef";function ie(oe){for(var fe=[],Re=0;Re<oe.length;Re++){var He=oe[Re];fe.push(te[(He&240)>>4]+te[He&15])}return fe.join("")}return{toBytes:re,fromBytes:ie}}(),l={16:10,24:12,32:14},c=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],d=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],m=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],g=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],_=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],v=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],E=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],b=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],T=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],A=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239e3,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],M=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998e3,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],k=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],F=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],O=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],B=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];function U(re){for(var te=[],ie=0;ie<re.length;ie+=4)te.push(re[ie]<<24|re[ie+1]<<16|re[ie+2]<<8|re[ie+3]);return te}var z=function(re){if(!(this instanceof z))throw Error("AES must be instanitated with `new`");Object.defineProperty(this,"key",{value:r(re,!0)}),this._prepare()};z.prototype._prepare=function(){var re=l[this.key.length];if(re==null)throw new Error("invalid key size (must be 16, 24 or 32 bytes)");this._Ke=[],this._Kd=[];for(var te=0;te<=re;te++)this._Ke.push([0,0,0,0]),this._Kd.push([0,0,0,0]);for(var ie=(re+1)*4,oe=this.key.length/4,fe=U(this.key),Re,te=0;te<oe;te++)Re=te>>2,this._Ke[Re][te%4]=fe[te],this._Kd[re-Re][te%4]=fe[te];for(var He=0,Je=oe,ot;Je<ie;){if(ot=fe[oe-1],fe[0]^=d[ot>>16&255]<<24^d[ot>>8&255]<<16^d[ot&255]<<8^d[ot>>24&255]^c[He]<<24,He+=1,oe!=8)for(var te=1;te<oe;te++)fe[te]^=fe[te-1];else{for(var te=1;te<oe/2;te++)fe[te]^=fe[te-1];ot=fe[oe/2-1],fe[oe/2]^=d[ot&255]^d[ot>>8&255]<<8^d[ot>>16&255]<<16^d[ot>>24&255]<<24;for(var te=oe/2+1;te<oe;te++)fe[te]^=fe[te-1]}for(var te=0,yt,bt;te<oe&&Je<ie;)yt=Je>>2,bt=Je%4,this._Ke[yt][bt]=fe[te],this._Kd[re-yt][bt]=fe[te++],Je++}for(var yt=1;yt<re;yt++)for(var bt=0;bt<4;bt++)ot=this._Kd[yt][bt],this._Kd[yt][bt]=k[ot>>24&255]^F[ot>>16&255]^O[ot>>8&255]^B[ot&255]},z.prototype.encrypt=function(re){if(re.length!=16)throw new Error("invalid plaintext size (must be 16 bytes)");for(var te=this._Ke.length-1,ie=[0,0,0,0],oe=U(re),fe=0;fe<4;fe++)oe[fe]^=this._Ke[0][fe];for(var Re=1;Re<te;Re++){for(var fe=0;fe<4;fe++)ie[fe]=g[oe[fe]>>24&255]^_[oe[(fe+1)%4]>>16&255]^v[oe[(fe+2)%4]>>8&255]^E[oe[(fe+3)%4]&255]^this._Ke[Re][fe];oe=ie.slice()}for(var He=s(16),Je,fe=0;fe<4;fe++)Je=this._Ke[te][fe],He[4*fe]=(d[oe[fe]>>24&255]^Je>>24)&255,He[4*fe+1]=(d[oe[(fe+1)%4]>>16&255]^Je>>16)&255,He[4*fe+2]=(d[oe[(fe+2)%4]>>8&255]^Je>>8)&255,He[4*fe+3]=(d[oe[(fe+3)%4]&255]^Je)&255;return He},z.prototype.decrypt=function(re){if(re.length!=16)throw new Error("invalid ciphertext size (must be 16 bytes)");for(var te=this._Kd.length-1,ie=[0,0,0,0],oe=U(re),fe=0;fe<4;fe++)oe[fe]^=this._Kd[0][fe];for(var Re=1;Re<te;Re++){for(var fe=0;fe<4;fe++)ie[fe]=b[oe[fe]>>24&255]^T[oe[(fe+3)%4]>>16&255]^A[oe[(fe+2)%4]>>8&255]^M[oe[(fe+1)%4]&255]^this._Kd[Re][fe];oe=ie.slice()}for(var He=s(16),Je,fe=0;fe<4;fe++)Je=this._Kd[te][fe],He[4*fe]=(m[oe[fe]>>24&255]^Je>>24)&255,He[4*fe+1]=(m[oe[(fe+3)%4]>>16&255]^Je>>16)&255,He[4*fe+2]=(m[oe[(fe+2)%4]>>8&255]^Je>>8)&255,He[4*fe+3]=(m[oe[(fe+1)%4]&255]^Je)&255;return He};var Z=function(re){if(!(this instanceof Z))throw Error("AES must be instanitated with `new`");this.description="Electronic Code Block",this.name="ecb",this._aes=new z(re)};Z.prototype.encrypt=function(re){if(re=r(re),re.length%16!==0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var te=s(re.length),ie=s(16),oe=0;oe<re.length;oe+=16)n(re,ie,0,oe,oe+16),ie=this._aes.encrypt(ie),n(ie,te,oe);return te},Z.prototype.decrypt=function(re){if(re=r(re),re.length%16!==0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var te=s(re.length),ie=s(16),oe=0;oe<re.length;oe+=16)n(re,ie,0,oe,oe+16),ie=this._aes.decrypt(ie),n(ie,te,oe);return te};var W=function(re,te){if(!(this instanceof W))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Block Chaining",this.name="cbc",!te)te=s(16);else if(te.length!=16)throw new Error("invalid initialation vector size (must be 16 bytes)");this._lastCipherblock=r(te,!0),this._aes=new z(re)};W.prototype.encrypt=function(re){if(re=r(re),re.length%16!==0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var te=s(re.length),ie=s(16),oe=0;oe<re.length;oe+=16){n(re,ie,0,oe,oe+16);for(var fe=0;fe<16;fe++)ie[fe]^=this._lastCipherblock[fe];this._lastCipherblock=this._aes.encrypt(ie),n(this._lastCipherblock,te,oe)}return te},W.prototype.decrypt=function(re){if(re=r(re),re.length%16!==0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var te=s(re.length),ie=s(16),oe=0;oe<re.length;oe+=16){n(re,ie,0,oe,oe+16),ie=this._aes.decrypt(ie);for(var fe=0;fe<16;fe++)te[oe+fe]=ie[fe]^this._lastCipherblock[fe];n(re,this._lastCipherblock,0,oe,oe+16)}return te};var q=function(re,te,ie){if(!(this instanceof q))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Feedback",this.name="cfb",!te)te=s(16);else if(te.length!=16)throw new Error("invalid initialation vector size (must be 16 size)");ie||(ie=1),this.segmentSize=ie,this._shiftRegister=r(te,!0),this._aes=new z(re)};q.prototype.encrypt=function(re){if(re.length%this.segmentSize!=0)throw new Error("invalid plaintext size (must be segmentSize bytes)");for(var te=r(re,!0),ie,oe=0;oe<te.length;oe+=this.segmentSize){ie=this._aes.encrypt(this._shiftRegister);for(var fe=0;fe<this.segmentSize;fe++)te[oe+fe]^=ie[fe];n(this._shiftRegister,this._shiftRegister,0,this.segmentSize),n(te,this._shiftRegister,16-this.segmentSize,oe,oe+this.segmentSize)}return te},q.prototype.decrypt=function(re){if(re.length%this.segmentSize!=0)throw new Error("invalid ciphertext size (must be segmentSize bytes)");for(var te=r(re,!0),ie,oe=0;oe<te.length;oe+=this.segmentSize){ie=this._aes.encrypt(this._shiftRegister);for(var fe=0;fe<this.segmentSize;fe++)te[oe+fe]^=ie[fe];n(this._shiftRegister,this._shiftRegister,0,this.segmentSize),n(re,this._shiftRegister,16-this.segmentSize,oe,oe+this.segmentSize)}return te};var Q=function(re,te){if(!(this instanceof Q))throw Error("AES must be instanitated with `new`");if(this.description="Output Feedback",this.name="ofb",!te)te=s(16);else if(te.length!=16)throw new Error("invalid initialation vector size (must be 16 bytes)");this._lastPrecipher=r(te,!0),this._lastPrecipherIndex=16,this._aes=new z(re)};Q.prototype.encrypt=function(re){for(var te=r(re,!0),ie=0;ie<te.length;ie++)this._lastPrecipherIndex===16&&(this._lastPrecipher=this._aes.encrypt(this._lastPrecipher),this._lastPrecipherIndex=0),te[ie]^=this._lastPrecipher[this._lastPrecipherIndex++];return te},Q.prototype.decrypt=Q.prototype.encrypt;var V=function(re){if(!(this instanceof V))throw Error("Counter must be instanitated with `new`");re!==0&&!re&&(re=1),typeof re=="number"?(this._counter=s(16),this.setValue(re)):this.setBytes(re)};V.prototype.setValue=function(re){if(typeof re!="number"||parseInt(re)!=re)throw new Error("invalid counter value (must be an integer)");if(re>Number.MAX_SAFE_INTEGER)throw new Error("integer value out of safe range");for(var te=15;te>=0;--te)this._counter[te]=re%256,re=parseInt(re/256)},V.prototype.setBytes=function(re){if(re=r(re,!0),re.length!=16)throw new Error("invalid counter bytes size (must be 16 bytes)");this._counter=re},V.prototype.increment=function(){for(var re=15;re>=0;re--)if(this._counter[re]===255)this._counter[re]=0;else{this._counter[re]++;break}};var le=function(re,te){if(!(this instanceof le))throw Error("AES must be instanitated with `new`");this.description="Counter",this.name="ctr",te instanceof V||(te=new V(te)),this._counter=te,this._remainingCounter=null,this._remainingCounterIndex=16,this._aes=new z(re)};le.prototype.encrypt=function(re){for(var te=r(re,!0),ie=0;ie<te.length;ie++)this._remainingCounterIndex===16&&(this._remainingCounter=this._aes.encrypt(this._counter._counter),this._remainingCounterIndex=0,this._counter.increment()),te[ie]^=this._remainingCounter[this._remainingCounterIndex++];return te},le.prototype.decrypt=le.prototype.encrypt;function de(re){re=r(re,!0);var te=16-re.length%16,ie=s(re.length+te);n(re,ie);for(var oe=re.length;oe<ie.length;oe++)ie[oe]=te;return ie}function ne(re){if(re=r(re,!0),re.length<16)throw new Error("PKCS#7 invalid length");var te=re[re.length-1];if(te>16)throw new Error("PKCS#7 padding byte out of range");for(var ie=re.length-te,oe=0;oe<te;oe++)if(re[ie+oe]!==te)throw new Error("PKCS#7 invalid padding byte");var fe=s(ie);return n(re,fe,0,0,ie),fe}var ee={AES:z,Counter:V,ModeOfOperation:{ecb:Z,cbc:W,cfb:q,ofb:Q,ctr:le},utils:{hex:a,utf8:o},padding:{pkcs7:{pad:de,strip:ne}},_arrayTest:{coerceArray:r,createArray:s,copyArray:n}};typeof vb!="undefined"?NI.exports=ee:typeof define=="function"&&define.amd?define([],function(){return ee}):(t.aesjs&&(ee._aesjs=t.aesjs),t.aesjs=ee)})(vb)});var P9=Gi(M9=>{M9.remove=jG;var k9=[{base:" ",chars:"\xA0"},{base:"0",chars:"\u07C0"},{base:"A",chars:"\u24B6\uFF21\xC0\xC1\xC2\u1EA6\u1EA4\u1EAA\u1EA8\xC3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\xC4\u01DE\u1EA2\xC5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F"},{base:"AA",chars:"\uA732"},{base:"AE",chars:"\xC6\u01FC\u01E2"},{base:"AO",chars:"\uA734"},{base:"AU",chars:"\uA736"},{base:"AV",chars:"\uA738\uA73A"},{base:"AY",chars:"\uA73C"},{base:"B",chars:"\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0181"},{base:"C",chars:"\u24B8\uFF23\uA73E\u1E08\u0106C\u0108\u010A\u010C\xC7\u0187\u023B"},{base:"D",chars:"\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018A\u0189\u1D05\uA779"},{base:"Dh",chars:"\xD0"},{base:"DZ",chars:"\u01F1\u01C4"},{base:"Dz",chars:"\u01F2\u01C5"},{base:"E",chars:"\u025B\u24BA\uFF25\xC8\xC9\xCA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\xCB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E\u1D07"},{base:"F",chars:"\uA77C\u24BB\uFF26\u1E1E\u0191\uA77B"},{base:"G",chars:"\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E\u0262"},{base:"H",chars:"\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D"},{base:"I",chars:"\u24BE\uFF29\xCC\xCD\xCE\u0128\u012A\u012C\u0130\xCF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197"},{base:"J",chars:"\u24BF\uFF2A\u0134\u0248\u0237"},{base:"K",chars:"\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2"},{base:"L",chars:"\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780"},{base:"LJ",chars:"\u01C7"},{base:"Lj",chars:"\u01C8"},{base:"M",chars:"\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C\u03FB"},{base:"N",chars:"\uA7A4\u0220\u24C3\uFF2E\u01F8\u0143\xD1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u019D\uA790\u1D0E"},{base:"NJ",chars:"\u01CA"},{base:"Nj",chars:"\u01CB"},{base:"O",chars:"\u24C4\uFF2F\xD2\xD3\xD4\u1ED2\u1ED0\u1ED6\u1ED4\xD5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\xD6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\xD8\u01FE\u0186\u019F\uA74A\uA74C"},{base:"OE",chars:"\u0152"},{base:"OI",chars:"\u01A2"},{base:"OO",chars:"\uA74E"},{base:"OU",chars:"\u0222"},{base:"P",chars:"\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754"},{base:"Q",chars:"\u24C6\uFF31\uA756\uA758\u024A"},{base:"R",chars:"\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782"},{base:"S",chars:"\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784"},{base:"T",chars:"\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786"},{base:"Th",chars:"\xDE"},{base:"TZ",chars:"\uA728"},{base:"U",chars:"\u24CA\uFF35\xD9\xDA\xDB\u0168\u1E78\u016A\u1E7A\u016C\xDC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244"},{base:"V",chars:"\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245"},{base:"VY",chars:"\uA760"},{base:"W",chars:"\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72"},{base:"X",chars:"\u24CD\uFF38\u1E8A\u1E8C"},{base:"Y",chars:"\u24CE\uFF39\u1EF2\xDD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE"},{base:"Z",chars:"\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762"},{base:"a",chars:"\u24D0\uFF41\u1E9A\xE0\xE1\xE2\u1EA7\u1EA5\u1EAB\u1EA9\xE3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\xE4\u01DF\u1EA3\xE5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250\u0251"},{base:"aa",chars:"\uA733"},{base:"ae",chars:"\xE6\u01FD\u01E3"},{base:"ao",chars:"\uA735"},{base:"au",chars:"\uA737"},{base:"av",chars:"\uA739\uA73B"},{base:"ay",chars:"\uA73D"},{base:"b",chars:"\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253\u0182"},{base:"c",chars:"\uFF43\u24D2\u0107\u0109\u010B\u010D\xE7\u1E09\u0188\u023C\uA73F\u2184"},{base:"d",chars:"\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\u018B\u13E7\u0501\uA7AA"},{base:"dh",chars:"\xF0"},{base:"dz",chars:"\u01F3\u01C6"},{base:"e",chars:"\u24D4\uFF45\xE8\xE9\xEA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\xEB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u01DD"},{base:"f",chars:"\u24D5\uFF46\u1E1F\u0192"},{base:"ff",chars:"\uFB00"},{base:"fi",chars:"\uFB01"},{base:"fl",chars:"\uFB02"},{base:"ffi",chars:"\uFB03"},{base:"ffl",chars:"\uFB04"},{base:"g",chars:"\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\uA77F\u1D79"},{base:"h",chars:"\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265"},{base:"hv",chars:"\u0195"},{base:"i",chars:"\u24D8\uFF49\xEC\xED\xEE\u0129\u012B\u012D\xEF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131"},{base:"j",chars:"\u24D9\uFF4A\u0135\u01F0\u0249"},{base:"k",chars:"\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3"},{base:"l",chars:"\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747\u026D"},{base:"lj",chars:"\u01C9"},{base:"m",chars:"\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F"},{base:"n",chars:"\u24DD\uFF4E\u01F9\u0144\xF1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5\u043B\u0509"},{base:"nj",chars:"\u01CC"},{base:"o",chars:"\u24DE\uFF4F\xF2\xF3\xF4\u1ED3\u1ED1\u1ED7\u1ED5\xF5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\xF6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\xF8\u01FF\uA74B\uA74D\u0275\u0254\u1D11"},{base:"oe",chars:"\u0153"},{base:"oi",chars:"\u01A3"},{base:"oo",chars:"\uA74F"},{base:"ou",chars:"\u0223"},{base:"p",chars:"\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755\u03C1"},{base:"q",chars:"\u24E0\uFF51\u024B\uA757\uA759"},{base:"r",chars:"\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783"},{base:"s",chars:"\u24E2\uFF53\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B\u0282"},{base:"ss",chars:"\xDF"},{base:"t",chars:"\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787"},{base:"th",chars:"\xFE"},{base:"tz",chars:"\uA729"},{base:"u",chars:"\u24E4\uFF55\xF9\xFA\xFB\u0169\u1E79\u016B\u1E7B\u016D\xFC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289"},{base:"v",chars:"\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C"},{base:"vy",chars:"\uA761"},{base:"w",chars:"\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73"},{base:"x",chars:"\u24E7\uFF58\u1E8B\u1E8D"},{base:"y",chars:"\u24E8\uFF59\u1EF3\xFD\u0177\u1EF9\u0233\u1E8F\xFF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF"},{base:"z",chars:"\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763"}],wb={};for(f3=0;f3<k9.length;f3+=1)for(bb=k9[f3].chars,I9=0;I9<bb.length;I9+=1)wb[bb[I9]]=k9[f3].base;var bb,I9,f3;function jG(t){return t.replace(/[^\u0000-\u007e]/g,function(e){return wb[e]||e})}M9.replacementList=k9;M9.diacriticsMap=wb});var vw=Gi((mce,xw)=>{"use strict";var LV=Object.prototype.hasOwnProperty,Wo="~";function J3(){}Object.create&&(J3.prototype=Object.create(null),new J3().__proto__||(Wo=!1));function NV(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function CP(t,e,i,r,s){if(typeof i!="function")throw new TypeError("The listener must be a function");var n=new NV(i,r||t,s),o=Wo?Wo+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],n]:t._events[o].push(n):(t._events[o]=n,t._eventsCount++),t}function G8(t,e){--t._eventsCount===0?t._events=new J3:delete t._events[e]}function vo(){this._events=new J3,this._eventsCount=0}vo.prototype.eventNames=function(){var e=[],i,r;if(this._eventsCount===0)return e;for(r in i=this._events)LV.call(i,r)&&e.push(Wo?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(i)):e};vo.prototype.listeners=function(e){var i=Wo?Wo+e:e,r=this._events[i];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,n=r.length,o=new Array(n);s<n;s++)o[s]=r[s].fn;return o};vo.prototype.listenerCount=function(e){var i=Wo?Wo+e:e,r=this._events[i];return r?r.fn?1:r.length:0};vo.prototype.emit=function(e,i,r,s,n,o){var a=Wo?Wo+e:e;if(!this._events[a])return!1;var l=this._events[a],c=arguments.length,d,m;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,i),!0;case 3:return l.fn.call(l.context,i,r),!0;case 4:return l.fn.call(l.context,i,r,s),!0;case 5:return l.fn.call(l.context,i,r,s,n),!0;case 6:return l.fn.call(l.context,i,r,s,n,o),!0}for(m=1,d=new Array(c-1);m<c;m++)d[m-1]=arguments[m];l.fn.apply(l.context,d)}else{var g=l.length,_;for(m=0;m<g;m++)switch(l[m].once&&this.removeListener(e,l[m].fn,void 0,!0),c){case 1:l[m].fn.call(l[m].context);break;case 2:l[m].fn.call(l[m].context,i);break;case 3:l[m].fn.call(l[m].context,i,r);break;case 4:l[m].fn.call(l[m].context,i,r,s);break;default:if(!d)for(_=1,d=new Array(c-1);_<c;_++)d[_-1]=arguments[_];l[m].fn.apply(l[m].context,d)}}return!0};vo.prototype.on=function(e,i,r){return CP(this,e,i,r,!1)};vo.prototype.once=function(e,i,r){return CP(this,e,i,r,!0)};vo.prototype.removeListener=function(e,i,r,s){var n=Wo?Wo+e:e;if(!this._events[n])return this;if(!i)return G8(this,n),this;var o=this._events[n];if(o.fn)o.fn===i&&(!s||o.once)&&(!r||o.context===r)&&G8(this,n);else{for(var a=0,l=[],c=o.length;a<c;a++)(o[a].fn!==i||s&&!o[a].once||r&&o[a].context!==r)&&l.push(o[a]);l.length?this._events[n]=l.length===1?l[0]:l:G8(this,n)}return this};vo.prototype.removeAllListeners=function(e){var i;return e?(i=Wo?Wo+e:e,this._events[i]&&G8(this,i)):(this._events=new J3,this._eventsCount=0),this};vo.prototype.off=vo.prototype.removeListener;vo.prototype.addListener=vo.prototype.on;vo.prefixed=Wo;vo.EventEmitter=vo;typeof xw!="undefined"&&(xw.exports=vo)});var Sw=Gi((gce,Tw)=>{"use strict";Tw.exports=V8;Tw.exports.default=V8;function V8(t,e,i){i=i||2;var r=e&&e.length,s=r?e[0]*i:t.length,n=kP(t,0,s,i,!0),o=[];if(!n||n.next===n.prev)return o;var a,l,c,d,m,g,_;if(r&&(n=GV(t,e,n,i)),t.length>80*i){a=c=t[0],l=d=t[1];for(var v=i;v<s;v+=i)m=t[v],g=t[v+1],m<a&&(a=m),g<l&&(l=g),m>c&&(c=m),g>d&&(d=g);_=Math.max(c-a,d-l),_=_!==0?32767/_:0}return e5(n,o,i,a,l,_,0),o}function kP(t,e,i,r,s){var n,o;if(s===Ew(t,e,i,r)>0)for(n=e;n<i;n+=r)o=IP(n,t[n],t[n+1],o);else for(n=i-r;n>=e;n-=r)o=IP(n,t[n],t[n+1],o);return o&&j8(o,o.next)&&(i5(o),o=o.next),o}function ud(t,e){if(!t)return t;e||(e=t);var i=t,r;do if(r=!1,!i.steiner&&(j8(i,i.next)||$s(i.prev,i,i.next)===0)){if(i5(i),i=e=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==e);return e}function e5(t,e,i,r,s,n,o){if(t){!o&&n&&XV(t,r,s,n);for(var a=t,l,c;t.prev!==t.next;){if(l=t.prev,c=t.next,n?BV(t,r,s,n):OV(t)){e.push(l.i/i|0),e.push(t.i/i|0),e.push(c.i/i|0),i5(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=UV(ud(t),e,i),e5(t,e,i,r,s,n,2)):o===2&&zV(t,e,i,r,s,n):e5(ud(t),e,i,r,s,n,1);break}}}}function OV(t){var e=t.prev,i=t,r=t.next;if($s(e,i,r)>=0)return!1;for(var s=e.x,n=i.x,o=r.x,a=e.y,l=i.y,c=r.y,d=s<n?s<o?s:o:n<o?n:o,m=a<l?a<c?a:c:l<c?l:c,g=s>n?s>o?s:o:n>o?n:o,_=a>l?a>c?a:c:l>c?l:c,v=r.next;v!==e;){if(v.x>=d&&v.x<=g&&v.y>=m&&v.y<=_&&zf(s,a,n,l,o,c,v.x,v.y)&&$s(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function BV(t,e,i,r){var s=t.prev,n=t,o=t.next;if($s(s,n,o)>=0)return!1;for(var a=s.x,l=n.x,c=o.x,d=s.y,m=n.y,g=o.y,_=a<l?a<c?a:c:l<c?l:c,v=d<m?d<g?d:g:m<g?m:g,E=a>l?a>c?a:c:l>c?l:c,b=d>m?d>g?d:g:m>g?m:g,T=bw(_,v,e,i,r),A=bw(E,b,e,i,r),M=t.prevZ,k=t.nextZ;M&&M.z>=T&&k&&k.z<=A;){if(M.x>=_&&M.x<=E&&M.y>=v&&M.y<=b&&M!==s&&M!==o&&zf(a,d,l,m,c,g,M.x,M.y)&&$s(M.prev,M,M.next)>=0||(M=M.prevZ,k.x>=_&&k.x<=E&&k.y>=v&&k.y<=b&&k!==s&&k!==o&&zf(a,d,l,m,c,g,k.x,k.y)&&$s(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;M&&M.z>=T;){if(M.x>=_&&M.x<=E&&M.y>=v&&M.y<=b&&M!==s&&M!==o&&zf(a,d,l,m,c,g,M.x,M.y)&&$s(M.prev,M,M.next)>=0)return!1;M=M.prevZ}for(;k&&k.z<=A;){if(k.x>=_&&k.x<=E&&k.y>=v&&k.y<=b&&k!==s&&k!==o&&zf(a,d,l,m,c,g,k.x,k.y)&&$s(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function UV(t,e,i){var r=t;do{var s=r.prev,n=r.next.next;!j8(s,n)&&MP(s,r,r.next,n)&&t5(s,n)&&t5(n,s)&&(e.push(s.i/i|0),e.push(r.i/i|0),e.push(n.i/i|0),i5(r),i5(r.next),r=t=n),r=r.next}while(r!==t);return ud(r)}function zV(t,e,i,r,s,n){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&YV(o,a)){var l=PP(o,a);o=ud(o,o.next),l=ud(l,l.next),e5(o,e,i,r,s,n,0),e5(l,e,i,r,s,n,0);return}a=a.next}o=o.next}while(o!==t)}function GV(t,e,i,r){var s=[],n,o,a,l,c;for(n=0,o=e.length;n<o;n++)a=e[n]*r,l=n<o-1?e[n+1]*r:t.length,c=kP(t,a,l,r,!1),c===c.next&&(c.steiner=!0),s.push(qV(c));for(s.sort($V),n=0;n<s.length;n++)i=HV(s[n],i);return i}function $V(t,e){return t.x-e.x}function HV(t,e){var i=VV(t,e);if(!i)return e;var r=PP(i,t);return ud(r,r.next),ud(i,i.next)}function VV(t,e){var i=e,r=t.x,s=t.y,n=-1/0,o;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var a=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>n&&(n=a,o=i.x<i.next.x?i:i.next,a===r))return o}i=i.next}while(i!==e);if(!o)return null;var l=o,c=o.x,d=o.y,m=1/0,g;i=o;do r>=i.x&&i.x>=c&&r!==i.x&&zf(s<d?r:n,s,c,d,s<d?n:r,s,i.x,i.y)&&(g=Math.abs(s-i.y)/(r-i.x),t5(i,t)&&(g<m||g===m&&(i.x>o.x||i.x===o.x&&jV(o,i)))&&(o=i,m=g)),i=i.next;while(i!==l);return o}function jV(t,e){return $s(t.prev,t,e.prev)<0&&$s(e.next,t,t.next)<0}function XV(t,e,i,r){var s=t;do s.z===0&&(s.z=bw(s.x,s.y,e,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,WV(s)}function WV(t){var e,i,r,s,n,o,a,l,c=1;do{for(i=t,t=null,n=null,o=0;i;){for(o++,r=i,a=0,e=0;e<c&&(a++,r=r.nextZ,!!r);e++);for(l=c;a>0||l>0&&r;)a!==0&&(l===0||!r||i.z<=r.z)?(s=i,i=i.nextZ,a--):(s=r,r=r.nextZ,l--),n?n.nextZ=s:t=s,s.prevZ=n,n=s;i=r}n.nextZ=null,c*=2}while(o>1);return t}function bw(t,e,i,r,s){return t=(t-i)*s|0,e=(e-r)*s|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function qV(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function zf(t,e,i,r,s,n,o,a){return(s-o)*(e-a)>=(t-o)*(n-a)&&(t-o)*(r-a)>=(i-o)*(e-a)&&(i-o)*(n-a)>=(s-o)*(r-a)}function YV(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!ZV(t,e)&&(t5(t,e)&&t5(e,t)&&QV(t,e)&&($s(t.prev,t,e.prev)||$s(t,e.prev,e))||j8(t,e)&&$s(t.prev,t,t.next)>0&&$s(e.prev,e,e.next)>0)}function $s(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function j8(t,e){return t.x===e.x&&t.y===e.y}function MP(t,e,i,r){var s=H8($s(t,e,i)),n=H8($s(t,e,r)),o=H8($s(i,r,t)),a=H8($s(i,r,e));return!!(s!==n&&o!==a||s===0&&$8(t,i,e)||n===0&&$8(t,r,e)||o===0&&$8(i,t,r)||a===0&&$8(i,e,r))}function $8(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function H8(t){return t>0?1:t<0?-1:0}function ZV(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&MP(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function t5(t,e){return $s(t.prev,t,t.next)<0?$s(t,e,t.next)>=0&&$s(t,t.prev,e)>=0:$s(t,e,t.prev)<0||$s(t,t.next,e)<0}function QV(t,e){var i=t,r=!1,s=(t.x+e.x)/2,n=(t.y+e.y)/2;do i.y>n!=i.next.y>n&&i.next.y!==i.y&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function PP(t,e){var i=new ww(t.i,t.x,t.y),r=new ww(e.i,e.x,e.y),s=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function IP(t,e,i,r){var s=new ww(t,e,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function i5(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ww(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}V8.deviation=function(t,e,i,r){var s=e&&e.length,n=s?e[0]*i:t.length,o=Math.abs(Ew(t,0,n,i));if(s)for(var a=0,l=e.length;a<l;a++){var c=e[a]*i,d=a<l-1?e[a+1]*i:t.length;o-=Math.abs(Ew(t,c,d,i))}var m=0;for(a=0;a<r.length;a+=3){var g=r[a]*i,_=r[a+1]*i,v=r[a+2]*i;m+=Math.abs((t[g]-t[v])*(t[_+1]-t[g+1])-(t[g]-t[_])*(t[v+1]-t[g+1]))}return o===0&&m===0?0:Math.abs((m-o)/o)};function Ew(t,e,i,r){for(var s=0,n=e,o=i-r;n<i;n+=r)s+=(t[o]-t[n])*(t[n+1]+t[o+1]),o=n;return s}V8.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,s=0;s<t.length;s++){for(var n=0;n<t[s].length;n++)for(var o=0;o<e;o++)i.vertices.push(t[s][n][o]);s>0&&(r+=t[s-1].length,i.holes.push(r))}return i}});var RP=Gi((Gf,$f)=>{(function(t){var e=typeof Gf=="object"&&Gf&&!Gf.nodeType&&Gf,i=typeof $f=="object"&&$f&&!$f.nodeType&&$f,r=typeof global=="object"&&global;(r.global===r||r.window===r||r.self===r)&&(t=r);var s,n=2147483647,o=36,a=1,l=26,c=38,d=700,m=72,g=128,_="-",v=/^xn--/,E=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,T={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},A=o-a,M=Math.floor,k=String.fromCharCode,F;function O(ee){throw RangeError(T[ee])}function B(ee,re){for(var te=ee.length,ie=[];te--;)ie[te]=re(ee[te]);return ie}function U(ee,re){var te=ee.split("@"),ie="";te.length>1&&(ie=te[0]+"@",ee=te[1]),ee=ee.replace(b,".");var oe=ee.split("."),fe=B(oe,re).join(".");return ie+fe}function z(ee){for(var re=[],te=0,ie=ee.length,oe,fe;te<ie;)oe=ee.charCodeAt(te++),oe>=55296&&oe<=56319&&te<ie?(fe=ee.charCodeAt(te++),(fe&64512)==56320?re.push(((oe&1023)<<10)+(fe&1023)+65536):(re.push(oe),te--)):re.push(oe);return re}function Z(ee){return B(ee,function(re){var te="";return re>65535&&(re-=65536,te+=k(re>>>10&1023|55296),re=56320|re&1023),te+=k(re),te}).join("")}function W(ee){return ee-48<10?ee-22:ee-65<26?ee-65:ee-97<26?ee-97:o}function q(ee,re){return ee+22+75*(ee<26)-((re!=0)<<5)}function Q(ee,re,te){var ie=0;for(ee=te?M(ee/d):ee>>1,ee+=M(ee/re);ee>A*l>>1;ie+=o)ee=M(ee/A);return M(ie+(A+1)*ee/(ee+c))}function V(ee){var re=[],te=ee.length,ie,oe=0,fe=g,Re=m,He,Je,ot,yt,bt,at,Te,Ze,xt;for(He=ee.lastIndexOf(_),He<0&&(He=0),Je=0;Je<He;++Je)ee.charCodeAt(Je)>=128&&O("not-basic"),re.push(ee.charCodeAt(Je));for(ot=He>0?He+1:0;ot<te;){for(yt=oe,bt=1,at=o;ot>=te&&O("invalid-input"),Te=W(ee.charCodeAt(ot++)),(Te>=o||Te>M((n-oe)/bt))&&O("overflow"),oe+=Te*bt,Ze=at<=Re?a:at>=Re+l?l:at-Re,!(Te<Ze);at+=o)xt=o-Ze,bt>M(n/xt)&&O("overflow"),bt*=xt;ie=re.length+1,Re=Q(oe-yt,ie,yt==0),M(oe/ie)>n-fe&&O("overflow"),fe+=M(oe/ie),oe%=ie,re.splice(oe++,0,fe)}return Z(re)}function le(ee){var re,te,ie,oe,fe,Re,He,Je,ot,yt,bt,at=[],Te,Ze,xt,It;for(ee=z(ee),Te=ee.length,re=g,te=0,fe=m,Re=0;Re<Te;++Re)bt=ee[Re],bt<128&&at.push(k(bt));for(ie=oe=at.length,oe&&at.push(_);ie<Te;){for(He=n,Re=0;Re<Te;++Re)bt=ee[Re],bt>=re&&bt<He&&(He=bt);for(Ze=ie+1,He-re>M((n-te)/Ze)&&O("overflow"),te+=(He-re)*Ze,re=He,Re=0;Re<Te;++Re)if(bt=ee[Re],bt<re&&++te>n&&O("overflow"),bt==re){for(Je=te,ot=o;yt=ot<=fe?a:ot>=fe+l?l:ot-fe,!(Je<yt);ot+=o)It=Je-yt,xt=o-yt,at.push(k(q(yt+It%xt,0))),Je=M(It/xt);at.push(k(q(Je,0))),fe=Q(te,Ze,ie==oe),te=0,++ie}++te,++re}return at.join("")}function de(ee){return U(ee,function(re){return v.test(re)?V(re.slice(4).toLowerCase()):re})}function ne(ee){return U(ee,function(re){return E.test(re)?"xn--"+le(re):re})}if(s={version:"1.3.2",ucs2:{decode:z,encode:Z},decode:V,encode:le,toASCII:ne,toUnicode:de},typeof define=="function"&&typeof define.amd=="object"&&define.amd)define("punycode",function(){return s});else if(e&&i)if($f.exports==e)i.exports=s;else for(F in s)s.hasOwnProperty(F)&&(e[F]=s[F]);else t.punycode=s})(Gf)});var FP=Gi((yce,DP)=>{"use strict";DP.exports={isString:function(t){return typeof t=="string"},isObject:function(t){return typeof t=="object"&&t!==null},isNull:function(t){return t===null},isNullOrUndefined:function(t){return t==null}}});var NP=Gi((_ce,LP)=>{"use strict";function KV(t,e){return Object.prototype.hasOwnProperty.call(t,e)}LP.exports=function(t,e,i,r){e=e||"&",i=i||"=";var s={};if(typeof t!="string"||t.length===0)return s;var n=/\+/g;t=t.split(e);var o=1e3;r&&typeof r.maxKeys=="number"&&(o=r.maxKeys);var a=t.length;o>0&&a>o&&(a=o);for(var l=0;l<a;++l){var c=t[l].replace(n,"%20"),d=c.indexOf(i),m,g,_,v;d>=0?(m=c.substr(0,d),g=c.substr(d+1)):(m=c,g=""),_=decodeURIComponent(m),v=decodeURIComponent(g),KV(s,_)?Array.isArray(s[_])?s[_].push(v):s[_]=[s[_],v]:s[_]=v}return s}});var BP=Gi((xce,OP)=>{"use strict";var r5=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};OP.exports=function(t,e,i,r){return e=e||"&",i=i||"=",t===null&&(t=void 0),typeof t=="object"?Object.keys(t).map(function(s){var n=encodeURIComponent(r5(s))+i;return Array.isArray(t[s])?t[s].map(function(o){return n+encodeURIComponent(r5(o))}).join(e):n+encodeURIComponent(r5(t[s]))}).join(e):r?encodeURIComponent(r5(r))+i+encodeURIComponent(r5(t)):""}});var UP=Gi(s5=>{"use strict";s5.decode=s5.parse=NP();s5.encode=s5.stringify=BP()});var kw=Gi(Vf=>{"use strict";var JV=RP(),Lc=FP();Vf.parse=n5;Vf.resolve=cj;Vf.resolveObject=uj;Vf.format=lj;Vf.Url=vl;function vl(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var ej=/^([a-z0-9.+-]+:)/i,tj=/:[0-9]*$/,ij=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,rj=["<",">",'"',"`"," ","\r",`
`,"	"],sj=["{","}","|","\\","^","`"].concat(rj),Aw=["'"].concat(sj),zP=["%","/","?",";","#"].concat(Aw),GP=["/","?","#"],nj=255,$P=/^[+a-z0-9A-Z_-]{0,63}$/,oj=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,aj={javascript:!0,"javascript:":!0},Cw={javascript:!0,"javascript:":!0},Hf={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Iw=UP();function n5(t,e,i){if(t&&Lc.isObject(t)&&t instanceof vl)return t;var r=new vl;return r.parse(t,e,i),r}vl.prototype.parse=function(t,e,i){if(!Lc.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t.indexOf("?"),s=r!==-1&&r<t.indexOf("#")?"?":"#",n=t.split(s),o=/\\/g;n[0]=n[0].replace(o,"/"),t=n.join(s);var a=t;if(a=a.trim(),!i&&t.split("#").length===1){var l=ij.exec(a);if(l)return this.path=a,this.href=a,this.pathname=l[1],l[2]?(this.search=l[2],e?this.query=Iw.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var c=ej.exec(a);if(c){c=c[0];var d=c.toLowerCase();this.protocol=d,a=a.substr(c.length)}if(i||c||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var m=a.substr(0,2)==="//";m&&!(c&&Cw[c])&&(a=a.substr(2),this.slashes=!0)}if(!Cw[c]&&(m||c&&!Hf[c])){for(var g=-1,_=0;_<GP.length;_++){var v=a.indexOf(GP[_]);v!==-1&&(g===-1||v<g)&&(g=v)}var E,b;g===-1?b=a.lastIndexOf("@"):b=a.lastIndexOf("@",g),b!==-1&&(E=a.slice(0,b),a=a.slice(b+1),this.auth=decodeURIComponent(E)),g=-1;for(var _=0;_<zP.length;_++){var v=a.indexOf(zP[_]);v!==-1&&(g===-1||v<g)&&(g=v)}g===-1&&(g=a.length),this.host=a.slice(0,g),a=a.slice(g),this.parseHost(),this.hostname=this.hostname||"";var T=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!T)for(var A=this.hostname.split(/\./),_=0,M=A.length;_<M;_++){var k=A[_];if(k&&!k.match($P)){for(var F="",O=0,B=k.length;O<B;O++)k.charCodeAt(O)>127?F+="x":F+=k[O];if(!F.match($P)){var U=A.slice(0,_),z=A.slice(_+1),Z=k.match(oj);Z&&(U.push(Z[1]),z.unshift(Z[2])),z.length&&(a="/"+z.join(".")+a),this.hostname=U.join(".");break}}}this.hostname.length>nj?this.hostname="":this.hostname=this.hostname.toLowerCase(),T||(this.hostname=JV.toASCII(this.hostname));var W=this.port?":"+this.port:"",q=this.hostname||"";this.host=q+W,this.href+=this.host,T&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!aj[d])for(var _=0,M=Aw.length;_<M;_++){var Q=Aw[_];if(a.indexOf(Q)!==-1){var V=encodeURIComponent(Q);V===Q&&(V=escape(Q)),a=a.split(Q).join(V)}}var le=a.indexOf("#");le!==-1&&(this.hash=a.substr(le),a=a.slice(0,le));var de=a.indexOf("?");if(de!==-1?(this.search=a.substr(de),this.query=a.substr(de+1),e&&(this.query=Iw.parse(this.query)),a=a.slice(0,de)):e&&(this.search="",this.query={}),a&&(this.pathname=a),Hf[d]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var W=this.pathname||"",ne=this.search||"";this.path=W+ne}return this.href=this.format(),this};function lj(t){return Lc.isString(t)&&(t=n5(t)),t instanceof vl?t.format():vl.prototype.format.call(t)}vl.prototype.format=function(){var t=this.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",r=this.hash||"",s=!1,n="";this.host?s=t+this.host:this.hostname&&(s=t+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&Lc.isObject(this.query)&&Object.keys(this.query).length&&(n=Iw.stringify(this.query));var o=this.search||n&&"?"+n||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||Hf[e])&&s!==!1?(s="//"+(s||""),i&&i.charAt(0)!=="/"&&(i="/"+i)):s||(s=""),r&&r.charAt(0)!=="#"&&(r="#"+r),o&&o.charAt(0)!=="?"&&(o="?"+o),i=i.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),e+s+i+o+r};function cj(t,e){return n5(t,!1,!0).resolve(e)}vl.prototype.resolve=function(t){return this.resolveObject(n5(t,!1,!0)).format()};function uj(t,e){return t?n5(t,!1,!0).resolveObject(e):e}vl.prototype.resolveObject=function(t){if(Lc.isString(t)){var e=new vl;e.parse(t,!1,!0),t=e}for(var i=new vl,r=Object.keys(this),s=0;s<r.length;s++){var n=r[s];i[n]=this[n]}if(i.hash=t.hash,t.href==="")return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var o=Object.keys(t),a=0;a<o.length;a++){var l=o[a];l!=="protocol"&&(i[l]=t[l])}return Hf[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!Hf[t.protocol]){for(var c=Object.keys(t),d=0;d<c.length;d++){var m=c[d];i[m]=t[m]}return i.href=i.format(),i}if(i.protocol=t.protocol,!t.host&&!Cw[t.protocol]){for(var M=(t.pathname||"").split("/");M.length&&!(t.host=M.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),M[0]!==""&&M.unshift(""),M.length<2&&M.unshift(""),i.pathname=M.join("/")}else i.pathname=t.pathname;if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var g=i.pathname||"",_=i.search||"";i.path=g+_}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var v=i.pathname&&i.pathname.charAt(0)==="/",E=t.host||t.pathname&&t.pathname.charAt(0)==="/",b=E||v||i.host&&t.pathname,T=b,A=i.pathname&&i.pathname.split("/")||[],M=t.pathname&&t.pathname.split("/")||[],k=i.protocol&&!Hf[i.protocol];if(k&&(i.hostname="",i.port=null,i.host&&(A[0]===""?A[0]=i.host:A.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(M[0]===""?M[0]=t.host:M.unshift(t.host)),t.host=null),b=b&&(M[0]===""||A[0]==="")),E)i.host=t.host||t.host===""?t.host:i.host,i.hostname=t.hostname||t.hostname===""?t.hostname:i.hostname,i.search=t.search,i.query=t.query,A=M;else if(M.length)A||(A=[]),A.pop(),A=A.concat(M),i.search=t.search,i.query=t.query;else if(!Lc.isNullOrUndefined(t.search)){if(k){i.hostname=i.host=A.shift();var F=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;F&&(i.auth=F.shift(),i.host=i.hostname=F.shift())}return i.search=t.search,i.query=t.query,(!Lc.isNull(i.pathname)||!Lc.isNull(i.search))&&(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!A.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var O=A.slice(-1)[0],B=(i.host||t.host||A.length>1)&&(O==="."||O==="..")||O==="",U=0,z=A.length;z>=0;z--)O=A[z],O==="."?A.splice(z,1):O===".."?(A.splice(z,1),U++):U&&(A.splice(z,1),U--);if(!b&&!T)for(;U--;U)A.unshift("..");b&&A[0]!==""&&(!A[0]||A[0].charAt(0)!=="/")&&A.unshift(""),B&&A.join("/").substr(-1)!=="/"&&A.push("");var Z=A[0]===""||A[0]&&A[0].charAt(0)==="/";if(k){i.hostname=i.host=Z?"":A.length?A.shift():"";var F=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;F&&(i.auth=F.shift(),i.host=i.hostname=F.shift())}return b=b||i.host&&A.length,b&&!Z&&A.unshift(""),A.length?i.pathname=A.join("/"):(i.pathname=null,i.path=null),(!Lc.isNull(i.pathname)||!Lc.isNull(i.search))&&(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i};vl.prototype.parseHost=function(){var t=this.host,e=tj.exec(t);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}});var H2=Gi((IAe,WD)=>{"use strict";WD.exports=function t(e,i){if(e===i)return!0;if(e&&i&&typeof e=="object"&&typeof i=="object"){if(e.constructor!==i.constructor)return!1;var r,s,n;if(Array.isArray(e)){if(r=e.length,r!=i.length)return!1;for(s=r;s--!==0;)if(!t(e[s],i[s]))return!1;return!0}if(e.constructor===RegExp)return e.source===i.source&&e.flags===i.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===i.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===i.toString();if(n=Object.keys(e),r=n.length,r!==Object.keys(i).length)return!1;for(s=r;s--!==0;)if(!Object.prototype.hasOwnProperty.call(i,n[s]))return!1;for(s=r;s--!==0;){var o=n[s];if(!t(e[o],i[o]))return!1}return!0}return e!==e&&i!==i}});var kl=Gi((YE,ZE)=>{(function(t,e){typeof YE=="object"&&typeof ZE!="undefined"?ZE.exports=e():typeof define=="function"&&define.amd?define(e):(t=t||self).RBush=e()})(YE,function(){"use strict";function t(b,T,A,M,k){(function F(O,B,U,z,Z){for(;z>U;){if(z-U>600){var W=z-U+1,q=B-U+1,Q=Math.log(W),V=.5*Math.exp(2*Q/3),le=.5*Math.sqrt(Q*V*(W-V)/W)*(q-W/2<0?-1:1),de=Math.max(U,Math.floor(B-q*V/W+le)),ne=Math.min(z,Math.floor(B+(W-q)*V/W+le));F(O,B,de,ne,Z)}var ee=O[B],re=U,te=z;for(e(O,U,B),Z(O[z],ee)>0&&e(O,U,z);re<te;){for(e(O,re,te),re++,te--;Z(O[re],ee)<0;)re++;for(;Z(O[te],ee)>0;)te--}Z(O[U],ee)===0?e(O,U,te):e(O,++te,z),te<=B&&(U=te+1),B<=te&&(z=te-1)}})(b,T,A||0,M||b.length-1,k||i)}function e(b,T,A){var M=b[T];b[T]=b[A],b[A]=M}function i(b,T){return b<T?-1:b>T?1:0}var r=function(b){b===void 0&&(b=9),this._maxEntries=Math.max(4,b),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(b,T,A){if(!A)return T.indexOf(b);for(var M=0;M<T.length;M++)if(A(b,T[M]))return M;return-1}function n(b,T){o(b,0,b.children.length,T,b)}function o(b,T,A,M,k){k||(k=v(null)),k.minX=1/0,k.minY=1/0,k.maxX=-1/0,k.maxY=-1/0;for(var F=T;F<A;F++){var O=b.children[F];a(k,b.leaf?M(O):O)}return k}function a(b,T){return b.minX=Math.min(b.minX,T.minX),b.minY=Math.min(b.minY,T.minY),b.maxX=Math.max(b.maxX,T.maxX),b.maxY=Math.max(b.maxY,T.maxY),b}function l(b,T){return b.minX-T.minX}function c(b,T){return b.minY-T.minY}function d(b){return(b.maxX-b.minX)*(b.maxY-b.minY)}function m(b){return b.maxX-b.minX+(b.maxY-b.minY)}function g(b,T){return b.minX<=T.minX&&b.minY<=T.minY&&T.maxX<=b.maxX&&T.maxY<=b.maxY}function _(b,T){return T.minX<=b.maxX&&T.minY<=b.maxY&&T.maxX>=b.minX&&T.maxY>=b.minY}function v(b){return{children:b,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function E(b,T,A,M,k){for(var F=[T,A];F.length;)if(!((A=F.pop())-(T=F.pop())<=M)){var O=T+Math.ceil((A-T)/M/2)*M;t(b,O,T,A,k),F.push(T,O,O,A)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(b){var T=this.data,A=[];if(!_(b,T))return A;for(var M=this.toBBox,k=[];T;){for(var F=0;F<T.children.length;F++){var O=T.children[F],B=T.leaf?M(O):O;_(b,B)&&(T.leaf?A.push(O):g(b,B)?this._all(O,A):k.push(O))}T=k.pop()}return A},r.prototype.collides=function(b){var T=this.data;if(!_(b,T))return!1;for(var A=[];T;){for(var M=0;M<T.children.length;M++){var k=T.children[M],F=T.leaf?this.toBBox(k):k;if(_(b,F)){if(T.leaf||g(b,F))return!0;A.push(k)}}T=A.pop()}return!1},r.prototype.load=function(b){if(!b||!b.length)return this;if(b.length<this._minEntries){for(var T=0;T<b.length;T++)this.insert(b[T]);return this}var A=this._build(b.slice(),0,b.length-1,0);if(this.data.children.length)if(this.data.height===A.height)this._splitRoot(this.data,A);else{if(this.data.height<A.height){var M=this.data;this.data=A,A=M}this._insert(A,this.data.height-A.height-1,!0)}else this.data=A;return this},r.prototype.insert=function(b){return b&&this._insert(b,this.data.height-1),this},r.prototype.clear=function(){return this.data=v([]),this},r.prototype.remove=function(b,T){if(!b)return this;for(var A,M,k,F=this.data,O=this.toBBox(b),B=[],U=[];F||B.length;){if(F||(F=B.pop(),M=B[B.length-1],A=U.pop(),k=!0),F.leaf){var z=s(b,F.children,T);if(z!==-1)return F.children.splice(z,1),B.push(F),this._condense(B),this}k||F.leaf||!g(F,O)?M?(A++,F=M.children[A],k=!1):F=null:(B.push(F),U.push(A),A=0,M=F,F=F.children[0])}return this},r.prototype.toBBox=function(b){return b},r.prototype.compareMinX=function(b,T){return b.minX-T.minX},r.prototype.compareMinY=function(b,T){return b.minY-T.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(b){return this.data=b,this},r.prototype._all=function(b,T){for(var A=[];b;)b.leaf?T.push.apply(T,b.children):A.push.apply(A,b.children),b=A.pop();return T},r.prototype._build=function(b,T,A,M){var k,F=A-T+1,O=this._maxEntries;if(F<=O)return n(k=v(b.slice(T,A+1)),this.toBBox),k;M||(M=Math.ceil(Math.log(F)/Math.log(O)),O=Math.ceil(F/Math.pow(O,M-1))),(k=v([])).leaf=!1,k.height=M;var B=Math.ceil(F/O),U=B*Math.ceil(Math.sqrt(O));E(b,T,A,U,this.compareMinX);for(var z=T;z<=A;z+=U){var Z=Math.min(z+U-1,A);E(b,z,Z,B,this.compareMinY);for(var W=z;W<=Z;W+=B){var q=Math.min(W+B-1,Z);k.children.push(this._build(b,W,q,M-1))}}return n(k,this.toBBox),k},r.prototype._chooseSubtree=function(b,T,A,M){for(;M.push(T),!T.leaf&&M.length-1!==A;){for(var k=1/0,F=1/0,O=void 0,B=0;B<T.children.length;B++){var U=T.children[B],z=d(U),Z=(W=b,q=U,(Math.max(q.maxX,W.maxX)-Math.min(q.minX,W.minX))*(Math.max(q.maxY,W.maxY)-Math.min(q.minY,W.minY))-z);Z<F?(F=Z,k=z<k?z:k,O=U):Z===F&&z<k&&(k=z,O=U)}T=O||T.children[0]}var W,q;return T},r.prototype._insert=function(b,T,A){var M=A?b:this.toBBox(b),k=[],F=this._chooseSubtree(M,this.data,T,k);for(F.children.push(b),a(F,M);T>=0&&k[T].children.length>this._maxEntries;)this._split(k,T),T--;this._adjustParentBBoxes(M,k,T)},r.prototype._split=function(b,T){var A=b[T],M=A.children.length,k=this._minEntries;this._chooseSplitAxis(A,k,M);var F=this._chooseSplitIndex(A,k,M),O=v(A.children.splice(F,A.children.length-F));O.height=A.height,O.leaf=A.leaf,n(A,this.toBBox),n(O,this.toBBox),T?b[T-1].children.push(O):this._splitRoot(A,O)},r.prototype._splitRoot=function(b,T){this.data=v([b,T]),this.data.height=b.height+1,this.data.leaf=!1,n(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(b,T,A){for(var M,k,F,O,B,U,z,Z=1/0,W=1/0,q=T;q<=A-T;q++){var Q=o(b,0,q,this.toBBox),V=o(b,q,A,this.toBBox),le=(k=Q,F=V,O=void 0,B=void 0,U=void 0,z=void 0,O=Math.max(k.minX,F.minX),B=Math.max(k.minY,F.minY),U=Math.min(k.maxX,F.maxX),z=Math.min(k.maxY,F.maxY),Math.max(0,U-O)*Math.max(0,z-B)),de=d(Q)+d(V);le<Z?(Z=le,M=q,W=de<W?de:W):le===Z&&de<W&&(W=de,M=q)}return M||A-T},r.prototype._chooseSplitAxis=function(b,T,A){var M=b.leaf?this.compareMinX:l,k=b.leaf?this.compareMinY:c;this._allDistMargin(b,T,A,M)<this._allDistMargin(b,T,A,k)&&b.children.sort(M)},r.prototype._allDistMargin=function(b,T,A,M){b.children.sort(M);for(var k=this.toBBox,F=o(b,0,T,k),O=o(b,A-T,A,k),B=m(F)+m(O),U=T;U<A-T;U++){var z=b.children[U];a(F,b.leaf?k(z):z),B+=m(F)}for(var Z=A-T-1;Z>=T;Z--){var W=b.children[Z];a(O,b.leaf?k(W):W),B+=m(O)}return B},r.prototype._adjustParentBBoxes=function(b,T,A){for(var M=A;M>=0;M--)a(T[M],b)},r.prototype._condense=function(b){for(var T=b.length-1,A=void 0;T>=0;T--)b[T].children.length===0?T>0?(A=b[T-1].children).splice(A.indexOf(b[T]),1):this.clear():n(b[T],this.toBBox)},r})});var dF=Gi((eT,tT)=>{(function(t,e){typeof eT=="object"&&typeof tT!="undefined"?tT.exports=e():typeof define=="function"&&define.amd?define(e):t.quickselect=e()})(eT,function(){"use strict";function t(s,n,o,a,l){e(s,n,o||0,a||s.length-1,l||r)}function e(s,n,o,a,l){for(;a>o;){if(a-o>600){var c=a-o+1,d=n-o+1,m=Math.log(c),g=.5*Math.exp(2*m/3),_=.5*Math.sqrt(m*g*(c-g)/c)*(d-c/2<0?-1:1),v=Math.max(o,Math.floor(n-d*g/c+_)),E=Math.min(a,Math.floor(n+(c-d)*g/c+_));e(s,n,v,E,l)}var b=s[n],T=o,A=a;for(i(s,o,n),l(s[a],b)>0&&i(s,o,a);T<A;){for(i(s,T,A),T++,A--;l(s[T],b)<0;)T++;for(;l(s[A],b)>0;)A--}l(s[o],b)===0?i(s,o,A):(A++,i(s,A,a)),A<=n&&(o=A+1),n<=A&&(a=A-1)}}function i(s,n,o){var a=s[n];s[n]=s[o],s[o]=a}function r(s,n){return s<n?-1:s>n?1:0}return t})});var gF=Gi(($Me,sT)=>{"use strict";sT.exports=Im;sT.exports.default=Im;var EW=dF();function Im(t,e){if(!(this instanceof Im))return new Im(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),e&&this._initFormat(e),this.clear()}Im.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],r=this.toBBox;if(!ty(t,e))return i;for(var s=[],n,o,a,l;e;){for(n=0,o=e.children.length;n<o;n++)a=e.children[n],l=e.leaf?r(a):a,ty(t,l)&&(e.leaf?i.push(a):rT(t,l)?this._all(a,i):s.push(a));e=s.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!ty(t,e))return!1;for(var r=[],s,n,o,a;e;){for(s=0,n=e.children.length;s<n;s++)if(o=e.children[s],a=e.leaf?i(o):o,ty(t,a)){if(e.leaf||rT(t,a))return!0;r.push(o)}e=r.pop()}return!1},load:function(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=r;else if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var s=this.data;this.data=r,r=s}this._insert(r,this.data.height-r.height-1,!0)}return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=J2([]),this},remove:function(t,e){if(!t)return this;for(var i=this.data,r=this.toBBox(t),s=[],n=[],o,a,l,c;i||s.length;){if(i||(i=s.pop(),a=s[s.length-1],o=n.pop(),c=!0),i.leaf&&(l=TW(t,i.children,e),l!==-1))return i.children.splice(l,1),s.push(i),this._condense(s),this;!c&&!i.leaf&&rT(i,r)?(s.push(i),n.push(o),o=0,a=i,i=i.children[0]):a?(o++,i=a.children[o],c=!1):i=null}return this},toBBox:function(t){return t},compareMinX:fF,compareMinY:pF,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,r){var s=i-e+1,n=this._maxEntries,o;if(s<=n)return o=J2(t.slice(e,i+1)),K2(o,this.toBBox),o;r||(r=Math.ceil(Math.log(s)/Math.log(n)),n=Math.ceil(s/Math.pow(n,r-1))),o=J2([]),o.leaf=!1,o.height=r;var a=Math.ceil(s/n),l=a*Math.ceil(Math.sqrt(n)),c,d,m,g;for(mF(t,e,i,l,this.compareMinX),c=e;c<=i;c+=l)for(m=Math.min(c+l-1,i),mF(t,c,m,a,this.compareMinY),d=c;d<=m;d+=a)g=Math.min(d+a-1,m),o.children.push(this._build(t,d,g,r-1));return K2(o,this.toBBox),o},_chooseSubtree:function(t,e,i,r){for(var s,n,o,a,l,c,d,m;r.push(e),!(e.leaf||r.length-1===i);){for(d=m=1/0,s=0,n=e.children.length;s<n;s++)o=e.children[s],l=iT(o),c=SW(t,o)-l,c<m?(m=c,d=l<d?l:d,a=o):c===m&&l<d&&(d=l,a=o);e=a||e.children[0]}return e},_insert:function(t,e,i){var r=this.toBBox,s=i?t:r(t),n=[],o=this._chooseSubtree(s,this.data,e,n);for(o.children.push(t),Cm(o,s);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(s,n,e)},_split:function(t,e){var i=t[e],r=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,r);var n=this._chooseSplitIndex(i,s,r),o=J2(i.children.splice(n,i.children.length-n));o.height=i.height,o.leaf=i.leaf,K2(i,this.toBBox),K2(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)},_splitRoot:function(t,e){this.data=J2([t,e]),this.data.height=t.height+1,this.data.leaf=!1,K2(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var r,s,n,o,a,l,c,d;for(l=c=1/0,r=e;r<=i-e;r++)s=Am(t,0,r,this.toBBox),n=Am(t,r,i,this.toBBox),o=AW(s,n),a=iT(s)+iT(n),o<l?(l=o,d=r,c=a<c?a:c):o===l&&a<c&&(c=a,d=r);return d},_chooseSplitAxis:function(t,e,i){var r=t.leaf?this.compareMinX:fF,s=t.leaf?this.compareMinY:pF,n=this._allDistMargin(t,e,i,r),o=this._allDistMargin(t,e,i,s);n<o&&t.children.sort(r)},_allDistMargin:function(t,e,i,r){t.children.sort(r);var s=this.toBBox,n=Am(t,0,e,s),o=Am(t,i-e,i,s),a=ey(n)+ey(o),l,c;for(l=e;l<i-e;l++)c=t.children[l],Cm(n,t.leaf?s(c):c),a+=ey(n);for(l=i-e-1;l>=e;l--)c=t.children[l],Cm(o,t.leaf?s(c):c),a+=ey(o);return a},_adjustParentBBoxes:function(t,e,i){for(var r=i;r>=0;r--)Cm(e[r],t)},_condense:function(t){for(var e=t.length-1,i;e>=0;e--)t[e].children.length===0?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():K2(t[e],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};function TW(t,e,i){if(!i)return e.indexOf(t);for(var r=0;r<e.length;r++)if(i(t,e[r]))return r;return-1}function K2(t,e){Am(t,0,t.children.length,e,t)}function Am(t,e,i,r,s){s||(s=J2(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var n=e,o;n<i;n++)o=t.children[n],Cm(s,t.leaf?r(o):o);return s}function Cm(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function fF(t,e){return t.minX-e.minX}function pF(t,e){return t.minY-e.minY}function iT(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function ey(t){return t.maxX-t.minX+(t.maxY-t.minY)}function SW(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function AW(t,e){var i=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),s=Math.min(t.maxX,e.maxX),n=Math.min(t.maxY,e.maxY);return Math.max(0,s-i)*Math.max(0,n-r)}function rT(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function ty(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function J2(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function mF(t,e,i,r,s){for(var n=[e,i],o;n.length;)i=n.pop(),e=n.pop(),!(i-e<=r)&&(o=e+Math.ceil((i-e)/r/2)*r,EW(t,o,e,i,s),n.push(e,o,o,i))}});var _F=Gi((HMe,yF)=>{"use strict";yF.exports=iy;iy.polyline=iy;iy.polygon=CW;function iy(t,e,i){var r=t.length,s=e4(t[0],e),n=[],o,a,l,c,d;for(i||(i=[]),o=1;o<r;o++){for(a=t[o-1],l=t[o],c=d=e4(l,e);;)if(s|c){if(s&c)break;s?(a=nT(a,l,s,e),s=e4(a,e)):(l=nT(a,l,c,e),c=e4(l,e))}else{n.push(a),c!==d?(n.push(l),o<r-1&&(i.push(n),n=[])):o===r-1&&n.push(l);break}s=d}return n.length&&i.push(n),i}function CW(t,e){var i,r,s,n,o,a,l;for(r=1;r<=8;r*=2){for(i=[],s=t[t.length-1],n=!(e4(s,e)&r),o=0;o<t.length;o++)a=t[o],l=!(e4(a,e)&r),l!==n&&i.push(nT(s,a,r,e)),l&&i.push(a),s=a,n=l;if(t=i,!t.length)break}return i}function nT(t,e,i,r){return i&8?[t[0]+(e[0]-t[0])*(r[3]-t[1])/(e[1]-t[1]),r[3]]:i&4?[t[0]+(e[0]-t[0])*(r[1]-t[1])/(e[1]-t[1]),r[1]]:i&2?[r[2],t[1]+(e[1]-t[1])*(r[2]-t[0])/(e[0]-t[0])]:i&1?[r[0],t[1]+(e[1]-t[1])*(r[0]-t[0])/(e[0]-t[0])]:null}function e4(t,e){var i=0;return t[0]<e[0]?i|=1:t[0]>e[2]&&(i|=2),t[1]<e[1]?i|=4:t[1]>e[3]&&(i|=8),i}});var km=Gi((VMe,bF)=>{"use strict";var IW=gF(),kW=_F();bF.exports=MW;function MW(t){for(var e=[],i=0;i<t.features.length;i++){var r=t.features[i];if(r.geometry){var s=r.geometry.coordinates;if(r.geometry.type==="Polygon")e.push(xF(s,r.properties));else if(r.geometry.type==="MultiPolygon")for(var n=0;n<s.length;n++)e.push(xF(s[n],r.properties))}}var o=IW().load(e);function a(l,c){for(var d=[],m=o.search({minX:l[0],minY:l[1],maxX:l[0],maxY:l[1]}),g=0;g<m.length;g++)if(vF(m[g].coords,l))if(c)d.push(m[g].props);else return m[g].props;return c&&d.length?d:null}return a.tree=o,a.bbox=function(c){for(var d=[],m=o.search({minX:c[0],minY:c[1],maxX:c[2],maxY:c[3]}),g=0;g<m.length;g++)PW(m[g].coords,c)&&d.push(m[g].props);return d},a}function PW(t,e){var i=[(e[0]+e[2])/2,(e[1]+e[3])/2];if(vF(t,i))return!0;for(var r=0;r<t.length;r++)if(kW(t[r],e).length>0)return!0;return!1}function vF(t,e){for(var i=!1,r=0,s=t.length;r<s;r++)for(var n=t[r],o=0,a=n.length,l=a-1;o<a;l=o++)RW(e,n[o],n[l])&&(i=!i);return i}function RW(t,e,i){return e[1]>t[1]!=i[1]>t[1]&&t[0]<(i[0]-e[0])*(t[1]-e[1])/(i[1]-e[1])+e[0]}function xF(t,e){for(var i={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0,coords:t,props:e},r=0;r<t[0].length;r++){var s=t[0][r];i.minX=Math.min(i.minX,s[0]),i.minY=Math.min(i.minY,s[1]),i.maxX=Math.max(i.maxX,s[0]),i.maxY=Math.max(i.maxY,s[1])}return i}});var RF=Gi((KMe,ry)=>{ry.exports.RADIUS=6378137;ry.exports.FLATTENING=1/298.257223563;ry.exports.POLAR_RADIUS=63567523142e-4});var hT=Gi((JMe,uT)=>{var DF=RF();uT.exports.geometry=LF;uT.exports.ring=cT;function LF(t){var e=0,i;switch(t.type){case"Polygon":return FF(t.coordinates);case"MultiPolygon":for(i=0;i<t.coordinates.length;i++)e+=FF(t.coordinates[i]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(i=0;i<t.geometries.length;i++)e+=LF(t.geometries[i]);return e}}function FF(t){var e=0;if(t&&t.length>0){e+=Math.abs(cT(t[0]));for(var i=1;i<t.length;i++)e-=Math.abs(cT(t[i]))}return e}function cT(t){var e,i,r,s,n,o,a,l=0,c=t.length;if(c>2){for(a=0;a<c;a++)a===c-2?(s=c-2,n=c-1,o=0):a===c-1?(s=c-1,n=0,o=1):(s=a,n=a+1,o=a+2),e=t[s],i=t[n],r=t[o],l+=(lT(r[0])-lT(e[0]))*Math.sin(lT(i[1]));l=l*DF.RADIUS*DF.RADIUS/2}return l}function lT(t){return t*Math.PI/180}});var OF=Gi(NF=>{NF.validateCenter=function(e){var i=[2,3];if(!Array.isArray(e)||!i.includes(e.length))throw new Error("ERROR! Center has to be an array of length two or three");var[r,s]=e;if(typeof r!="number"||typeof s!="number")throw new Error(`ERROR! Longitude and Latitude has to be numbers but where ${typeof r} and ${typeof s}`);if(r>180||r<-180)throw new Error(`ERROR! Longitude has to be between -180 and 180 but was ${r}`);if(s>90||s<-90)throw new Error(`ERROR! Latitude has to be between -90 and 90 but was ${s}`)}});var UF=Gi(BF=>{BF.validateRadius=function(e){if(typeof e!="number")throw new Error(`ERROR! Radius has to be a positive number but was: ${typeof e}`);if(e<=0)throw new Error(`ERROR! Radius has to be a positive number but was: ${e}`)}});var GF=Gi(zF=>{zF.validateNumberOfEdges=function(e){if(typeof e!="number"){let i=Array.isArray(e)?"array":typeof e;throw new Error(`ERROR! Number of edges has to be a number but was: ${i}`)}if(e<3)throw new Error(`ERROR! Number of edges has to be at least 3 but was: ${e}`)}});var HF=Gi($F=>{$F.validateEarthRadius=function(e){if(typeof e!="number"){let i=Array.isArray(e)?"array":typeof e;throw new Error(`ERROR! Earth radius has to be a number but was: ${i}`)}if(e<=0)throw new Error(`ERROR! Earth radius has to be a positive number but was: ${e}`)}});var jF=Gi(VF=>{VF.validateBearing=function(e){if(typeof e!="number"){let i=Array.isArray(e)?"array":typeof e;throw new Error(`ERROR! Bearing has to be a number but was: ${i}`)}}});var QF=Gi(zd=>{var XF=OF().validateCenter,WF=UF().validateRadius,qF=GF().validateNumberOfEdges,YF=HF().validateEarthRadius,ZF=jF().validateBearing;function VW({center:t,radius:e,numberOfEdges:i,earthRadius:r,bearing:s}){XF(t),WF(e),qF(i),YF(r),ZF(s)}zd.validateCenter=XF;zd.validateRadius=WF;zd.validateNumberOfEdges=qF;zd.validateEarthRadius=YF;zd.validateBearing=ZF;zd.validateInput=VW});var eL=Gi((oPe,JF)=>{"use strict";var{validateInput:jW}=QF(),dT=6378137;function fT(t){return t*Math.PI/180}function KF(t){return t*180/Math.PI}function XW(t,e,i,r){var s=fT(t[1]),n=fT(t[0]),o=e/i,a=Math.asin(Math.sin(s)*Math.cos(o)+Math.cos(s)*Math.sin(o)*Math.cos(r)),l=n+Math.atan2(Math.sin(r)*Math.sin(o)*Math.cos(s),Math.cos(o)-Math.sin(s)*Math.sin(a));return[KF(l),KF(a)]}JF.exports=function(e,i,r){var s=WW(r),n=qW(r),o=ZW(r),a=YW(r);jW({center:e,radius:i,numberOfEdges:s,earthRadius:n,bearing:o});for(var l=fT(o),c=[],d=0;d<s;++d)c.push(XW(e,i,n,l+a*2*Math.PI*-d/s));return c.push(c[0]),{type:"Polygon",coordinates:[c]}};function WW(t){if(pT(t))return 32;if(sy(t)){var e=t.numberOfEdges;return e===void 0?32:e}return t}function qW(t){if(pT(t))return dT;if(sy(t)){var e=t.earthRadius;return e===void 0?dT:e}return dT}function YW(t){return sy(t)&&t.rightHandRule?-1:1}function ZW(t){if(pT(t))return 0;if(sy(t)){var e=t.bearing;return e===void 0?0:e}return 0}function sy(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function pT(t){return t==null}});var yT=Gi((mT,gT)=>{(function(t,e){typeof mT=="object"&&typeof gT!="undefined"?gT.exports=e():typeof define=="function"&&define.amd?define(e):(t=typeof globalThis!="undefined"?globalThis:t||self,t.polygonClipping=e())})(mT,function(){"use strict";function t(je,be){if(!(je instanceof be))throw new TypeError("Cannot call a class as a function")}function e(je,be){for(var ge=0;ge<be.length;ge++){var xe=be[ge];xe.enumerable=xe.enumerable||!1,xe.configurable=!0,"value"in xe&&(xe.writable=!0),Object.defineProperty(je,xe.key,xe)}}function i(je,be,ge){return be&&e(je.prototype,be),ge&&e(je,ge),je}var r=function(){function je(be,ge){this.next=null,this.key=be,this.data=ge,this.left=null,this.right=null}return je}();function s(je,be){return je>be?1:je<be?-1:0}function n(je,be,ge){for(var xe=new r(null,null),Me=xe,Oe=xe;;){var De=ge(je,be.key);if(De<0){if(be.left===null)break;if(ge(je,be.left.key)<0){var rt=be.left;if(be.left=rt.right,rt.right=be,be=rt,be.left===null)break}Oe.left=be,Oe=be,be=be.left}else if(De>0){if(be.right===null)break;if(ge(je,be.right.key)>0){var rt=be.right;if(be.right=rt.left,rt.left=be,be=rt,be.right===null)break}Me.right=be,Me=be,be=be.right}else break}return Me.right=be.left,Oe.left=be.right,be.left=xe.right,be.right=xe.left,be}function o(je,be,ge,xe){var Me=new r(je,be);if(ge===null)return Me.left=Me.right=null,Me;ge=n(je,ge,xe);var Oe=xe(je,ge.key);return Oe<0?(Me.left=ge.left,Me.right=ge,ge.left=null):Oe>=0&&(Me.right=ge.right,Me.left=ge,ge.right=null),Me}function a(je,be,ge){var xe=null,Me=null;if(be){be=n(je,be,ge);var Oe=ge(be.key,je);Oe===0?(xe=be.left,Me=be.right):Oe<0?(Me=be.right,be.right=null,xe=be):(xe=be.left,be.left=null,Me=be)}return{left:xe,right:Me}}function l(je,be,ge){return be===null?je:(je===null||(be=n(je.key,be,ge),be.left=je),be)}function c(je,be,ge,xe,Me){if(je){xe(""+be+(ge?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Me(je)+`
`);var Oe=be+(ge?"    ":"\u2502   ");je.left&&c(je.left,Oe,!1,xe,Me),je.right&&c(je.right,Oe,!0,xe,Me)}}var d=function(){function je(be){be===void 0&&(be=s),this._root=null,this._size=0,this._comparator=be}return je.prototype.insert=function(be,ge){return this._size++,this._root=o(be,ge,this._root,this._comparator)},je.prototype.add=function(be,ge){var xe=new r(be,ge);this._root===null&&(xe.left=xe.right=null,this._size++,this._root=xe);var Me=this._comparator,Oe=n(be,this._root,Me),De=Me(be,Oe.key);return De===0?this._root=Oe:(De<0?(xe.left=Oe.left,xe.right=Oe,Oe.left=null):De>0&&(xe.right=Oe.right,xe.left=Oe,Oe.right=null),this._size++,this._root=xe),this._root},je.prototype.remove=function(be){this._root=this._remove(be,this._root,this._comparator)},je.prototype._remove=function(be,ge,xe){var Me;if(ge===null)return null;ge=n(be,ge,xe);var Oe=xe(be,ge.key);return Oe===0?(ge.left===null?Me=ge.right:(Me=n(be,ge.left,xe),Me.right=ge.right),this._size--,Me):ge},je.prototype.pop=function(){var be=this._root;if(be){for(;be.left;)be=be.left;return this._root=n(be.key,this._root,this._comparator),this._root=this._remove(be.key,this._root,this._comparator),{key:be.key,data:be.data}}return null},je.prototype.findStatic=function(be){for(var ge=this._root,xe=this._comparator;ge;){var Me=xe(be,ge.key);if(Me===0)return ge;Me<0?ge=ge.left:ge=ge.right}return null},je.prototype.find=function(be){return this._root&&(this._root=n(be,this._root,this._comparator),this._comparator(be,this._root.key)!==0)?null:this._root},je.prototype.contains=function(be){for(var ge=this._root,xe=this._comparator;ge;){var Me=xe(be,ge.key);if(Me===0)return!0;Me<0?ge=ge.left:ge=ge.right}return!1},je.prototype.forEach=function(be,ge){for(var xe=this._root,Me=[],Oe=!1;!Oe;)xe!==null?(Me.push(xe),xe=xe.left):Me.length!==0?(xe=Me.pop(),be.call(ge,xe),xe=xe.right):Oe=!0;return this},je.prototype.range=function(be,ge,xe,Me){for(var Oe=[],De=this._comparator,rt=this._root,ct;Oe.length!==0||rt;)if(rt)Oe.push(rt),rt=rt.left;else{if(rt=Oe.pop(),ct=De(rt.key,ge),ct>0)break;if(De(rt.key,be)>=0&&xe.call(Me,rt))return this;rt=rt.right}return this},je.prototype.keys=function(){var be=[];return this.forEach(function(ge){var xe=ge.key;return be.push(xe)}),be},je.prototype.values=function(){var be=[];return this.forEach(function(ge){var xe=ge.data;return be.push(xe)}),be},je.prototype.min=function(){return this._root?this.minNode(this._root).key:null},je.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},je.prototype.minNode=function(be){if(be===void 0&&(be=this._root),be)for(;be.left;)be=be.left;return be},je.prototype.maxNode=function(be){if(be===void 0&&(be=this._root),be)for(;be.right;)be=be.right;return be},je.prototype.at=function(be){for(var ge=this._root,xe=!1,Me=0,Oe=[];!xe;)if(ge)Oe.push(ge),ge=ge.left;else if(Oe.length>0){if(ge=Oe.pop(),Me===be)return ge;Me++,ge=ge.right}else xe=!0;return null},je.prototype.next=function(be){var ge=this._root,xe=null;if(be.right){for(xe=be.right;xe.left;)xe=xe.left;return xe}for(var Me=this._comparator;ge;){var Oe=Me(be.key,ge.key);if(Oe===0)break;Oe<0?(xe=ge,ge=ge.left):ge=ge.right}return xe},je.prototype.prev=function(be){var ge=this._root,xe=null;if(be.left!==null){for(xe=be.left;xe.right;)xe=xe.right;return xe}for(var Me=this._comparator;ge;){var Oe=Me(be.key,ge.key);if(Oe===0)break;Oe<0?ge=ge.left:(xe=ge,ge=ge.right)}return xe},je.prototype.clear=function(){return this._root=null,this._size=0,this},je.prototype.toList=function(){return _(this._root)},je.prototype.load=function(be,ge,xe){ge===void 0&&(ge=[]),xe===void 0&&(xe=!1);var Me=be.length,Oe=this._comparator;if(xe&&b(be,ge,0,Me-1,Oe),this._root===null)this._root=m(be,ge,0,Me),this._size=Me;else{var De=E(this.toList(),g(be,ge),Oe);Me=this._size+Me,this._root=v({head:De},0,Me)}return this},je.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(je.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(je.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),je.prototype.toString=function(be){be===void 0&&(be=function(Me){return String(Me.key)});var ge=[];return c(this._root,"",!0,function(xe){return ge.push(xe)},be),ge.join("")},je.prototype.update=function(be,ge,xe){var Me=this._comparator,Oe=a(be,this._root,Me),De=Oe.left,rt=Oe.right;Me(be,ge)<0?rt=o(ge,xe,rt,Me):De=o(ge,xe,De,Me),this._root=l(De,rt,Me)},je.prototype.split=function(be){return a(be,this._root,this._comparator)},je}();function m(je,be,ge,xe){var Me=xe-ge;if(Me>0){var Oe=ge+Math.floor(Me/2),De=je[Oe],rt=be[Oe],ct=new r(De,rt);return ct.left=m(je,be,ge,Oe),ct.right=m(je,be,Oe+1,xe),ct}return null}function g(je,be){for(var ge=new r(null,null),xe=ge,Me=0;Me<je.length;Me++)xe=xe.next=new r(je[Me],be[Me]);return xe.next=null,ge.next}function _(je){for(var be=je,ge=[],xe=!1,Me=new r(null,null),Oe=Me;!xe;)be?(ge.push(be),be=be.left):ge.length>0?(be=Oe=Oe.next=ge.pop(),be=be.right):xe=!0;return Oe.next=null,Me.next}function v(je,be,ge){var xe=ge-be;if(xe>0){var Me=be+Math.floor(xe/2),Oe=v(je,be,Me),De=je.head;return De.left=Oe,je.head=je.head.next,De.right=v(je,Me+1,ge),De}return null}function E(je,be,ge){for(var xe=new r(null,null),Me=xe,Oe=je,De=be;Oe!==null&&De!==null;)ge(Oe.key,De.key)<0?(Me.next=Oe,Oe=Oe.next):(Me.next=De,De=De.next),Me=Me.next;return Oe!==null?Me.next=Oe:De!==null&&(Me.next=De),xe.next}function b(je,be,ge,xe,Me){if(!(ge>=xe)){for(var Oe=je[ge+xe>>1],De=ge-1,rt=xe+1;;){do De++;while(Me(je[De],Oe)<0);do rt--;while(Me(je[rt],Oe)>0);if(De>=rt)break;var ct=je[De];je[De]=je[rt],je[rt]=ct,ct=be[De],be[De]=be[rt],be[rt]=ct}b(je,be,ge,rt,Me),b(je,be,rt+1,xe,Me)}}var T=function(be,ge){return be.ll.x<=ge.x&&ge.x<=be.ur.x&&be.ll.y<=ge.y&&ge.y<=be.ur.y},A=function(be,ge){if(ge.ur.x<be.ll.x||be.ur.x<ge.ll.x||ge.ur.y<be.ll.y||be.ur.y<ge.ll.y)return null;var xe=be.ll.x<ge.ll.x?ge.ll.x:be.ll.x,Me=be.ur.x<ge.ur.x?be.ur.x:ge.ur.x,Oe=be.ll.y<ge.ll.y?ge.ll.y:be.ll.y,De=be.ur.y<ge.ur.y?be.ur.y:ge.ur.y;return{ll:{x:xe,y:Oe},ur:{x:Me,y:De}}},M=Number.EPSILON;M===void 0&&(M=Math.pow(2,-52));var k=M*M,F=function(be,ge){if(-M<be&&be<M&&-M<ge&&ge<M)return 0;var xe=be-ge;return xe*xe<k*be*ge?0:be<ge?-1:1},O=function(){function je(){t(this,je),this.reset()}return i(je,[{key:"reset",value:function(){this.xRounder=new B,this.yRounder=new B}},{key:"round",value:function(ge,xe){return{x:this.xRounder.round(ge),y:this.yRounder.round(xe)}}}]),je}(),B=function(){function je(){t(this,je),this.tree=new d,this.round(0)}return i(je,[{key:"round",value:function(ge){var xe=this.tree.add(ge),Me=this.tree.prev(xe);if(Me!==null&&F(xe.key,Me.key)===0)return this.tree.remove(ge),Me.key;var Oe=this.tree.next(xe);return Oe!==null&&F(xe.key,Oe.key)===0?(this.tree.remove(ge),Oe.key):ge}}]),je}(),U=new O,z=function(be,ge){return be.x*ge.y-be.y*ge.x},Z=function(be,ge){return be.x*ge.x+be.y*ge.y},W=function(be,ge,xe){var Me={x:ge.x-be.x,y:ge.y-be.y},Oe={x:xe.x-be.x,y:xe.y-be.y},De=z(Me,Oe);return F(De,0)},q=function(be){return Math.sqrt(Z(be,be))},Q=function(be,ge,xe){var Me={x:ge.x-be.x,y:ge.y-be.y},Oe={x:xe.x-be.x,y:xe.y-be.y};return z(Oe,Me)/q(Oe)/q(Me)},V=function(be,ge,xe){var Me={x:ge.x-be.x,y:ge.y-be.y},Oe={x:xe.x-be.x,y:xe.y-be.y};return Z(Oe,Me)/q(Oe)/q(Me)},le=function(be,ge,xe){return ge.y===0?null:{x:be.x+ge.x/ge.y*(xe-be.y),y:xe}},de=function(be,ge,xe){return ge.x===0?null:{x:xe,y:be.y+ge.y/ge.x*(xe-be.x)}},ne=function(be,ge,xe,Me){if(ge.x===0)return de(xe,Me,be.x);if(Me.x===0)return de(be,ge,xe.x);if(ge.y===0)return le(xe,Me,be.y);if(Me.y===0)return le(be,ge,xe.y);var Oe=z(ge,Me);if(Oe==0)return null;var De={x:xe.x-be.x,y:xe.y-be.y},rt=z(De,ge)/Oe,ct=z(De,Me)/Oe,Vt=be.x+ct*ge.x,ti=xe.x+rt*Me.x,lt=be.y+ct*ge.y,Nt=xe.y+rt*Me.y,Lt=(Vt+ti)/2,qi=(lt+Nt)/2;return{x:Lt,y:qi}},ee=function(){i(je,null,[{key:"compare",value:function(ge,xe){var Me=je.comparePoints(ge.point,xe.point);return Me!==0?Me:(ge.point!==xe.point&&ge.link(xe),ge.isLeft!==xe.isLeft?ge.isLeft?1:-1:te.compare(ge.segment,xe.segment))}},{key:"comparePoints",value:function(ge,xe){return ge.x<xe.x?-1:ge.x>xe.x?1:ge.y<xe.y?-1:ge.y>xe.y?1:0}}]);function je(be,ge){t(this,je),be.events===void 0?be.events=[this]:be.events.push(this),this.point=be,this.isLeft=ge}return i(je,[{key:"link",value:function(ge){if(ge.point===this.point)throw new Error("Tried to link already linked events");for(var xe=ge.point.events,Me=0,Oe=xe.length;Me<Oe;Me++){var De=xe[Me];this.point.events.push(De),De.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var ge=this.point.events.length,xe=0;xe<ge;xe++){var Me=this.point.events[xe];if(Me.segment.consumedBy===void 0)for(var Oe=xe+1;Oe<ge;Oe++){var De=this.point.events[Oe];De.consumedBy===void 0&&Me.otherSE.point.events===De.otherSE.point.events&&Me.segment.consume(De.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var ge=[],xe=0,Me=this.point.events.length;xe<Me;xe++){var Oe=this.point.events[xe];Oe!==this&&!Oe.segment.ringOut&&Oe.segment.isInResult()&&ge.push(Oe)}return ge}},{key:"getLeftmostComparator",value:function(ge){var xe=this,Me=new Map,Oe=function(rt){var ct=rt.otherSE;Me.set(rt,{sine:Q(xe.point,ge.point,ct.point),cosine:V(xe.point,ge.point,ct.point)})};return function(De,rt){Me.has(De)||Oe(De),Me.has(rt)||Oe(rt);var ct=Me.get(De),Vt=ct.sine,ti=ct.cosine,lt=Me.get(rt),Nt=lt.sine,Lt=lt.cosine;return Vt>=0&&Nt>=0?ti<Lt?1:ti>Lt?-1:0:Vt<0&&Nt<0?ti<Lt?-1:ti>Lt?1:0:Nt<Vt?-1:Nt>Vt?1:0}}}]),je}(),re=0,te=function(){i(je,null,[{key:"compare",value:function(ge,xe){var Me=ge.leftSE.point.x,Oe=xe.leftSE.point.x,De=ge.rightSE.point.x,rt=xe.rightSE.point.x;if(rt<Me)return 1;if(De<Oe)return-1;var ct=ge.leftSE.point.y,Vt=xe.leftSE.point.y,ti=ge.rightSE.point.y,lt=xe.rightSE.point.y;if(Me<Oe){if(Vt<ct&&Vt<ti)return 1;if(Vt>ct&&Vt>ti)return-1;var Nt=ge.comparePoint(xe.leftSE.point);if(Nt<0)return 1;if(Nt>0)return-1;var Lt=xe.comparePoint(ge.rightSE.point);return Lt!==0?Lt:-1}if(Me>Oe){if(ct<Vt&&ct<lt)return-1;if(ct>Vt&&ct>lt)return 1;var qi=xe.comparePoint(ge.leftSE.point);if(qi!==0)return qi;var Vi=ge.comparePoint(xe.rightSE.point);return Vi<0?1:Vi>0?-1:1}if(ct<Vt)return-1;if(ct>Vt)return 1;if(De<rt){var Ke=xe.comparePoint(ge.rightSE.point);if(Ke!==0)return Ke}if(De>rt){var dt=ge.comparePoint(xe.rightSE.point);if(dt<0)return 1;if(dt>0)return-1}if(De!==rt){var kt=ti-ct,Zt=De-Me,Qt=lt-Vt,Oi=rt-Oe;if(kt>Zt&&Qt<Oi)return 1;if(kt<Zt&&Qt>Oi)return-1}return De>rt?1:De<rt||ti<lt?-1:ti>lt?1:ge.id<xe.id?-1:ge.id>xe.id?1:0}}]);function je(be,ge,xe,Me){t(this,je),this.id=++re,this.leftSE=be,be.segment=this,be.otherSE=ge,this.rightSE=ge,ge.segment=this,ge.otherSE=be,this.rings=xe,this.windings=Me}return i(je,[{key:"replaceRightSE",value:function(ge){this.rightSE=ge,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var ge=this.leftSE.point.y,xe=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:ge<xe?ge:xe},ur:{x:this.rightSE.point.x,y:ge>xe?ge:xe}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(ge){return ge.x===this.leftSE.point.x&&ge.y===this.leftSE.point.y||ge.x===this.rightSE.point.x&&ge.y===this.rightSE.point.y}},{key:"comparePoint",value:function(ge){if(this.isAnEndpoint(ge))return 0;var xe=this.leftSE.point,Me=this.rightSE.point,Oe=this.vector();if(xe.x===Me.x)return ge.x===xe.x?0:ge.x<xe.x?1:-1;var De=(ge.y-xe.y)/Oe.y,rt=xe.x+De*Oe.x;if(ge.x===rt)return 0;var ct=(ge.x-xe.x)/Oe.x,Vt=xe.y+ct*Oe.y;return ge.y===Vt?0:ge.y<Vt?-1:1}},{key:"getIntersection",value:function(ge){var xe=this.bbox(),Me=ge.bbox(),Oe=A(xe,Me);if(Oe===null)return null;var De=this.leftSE.point,rt=this.rightSE.point,ct=ge.leftSE.point,Vt=ge.rightSE.point,ti=T(xe,ct)&&this.comparePoint(ct)===0,lt=T(Me,De)&&ge.comparePoint(De)===0,Nt=T(xe,Vt)&&this.comparePoint(Vt)===0,Lt=T(Me,rt)&&ge.comparePoint(rt)===0;if(lt&&ti)return Lt&&!Nt?rt:!Lt&&Nt?Vt:null;if(lt)return Nt&&De.x===Vt.x&&De.y===Vt.y?null:De;if(ti)return Lt&&rt.x===ct.x&&rt.y===ct.y?null:ct;if(Lt&&Nt)return null;if(Lt)return rt;if(Nt)return Vt;var qi=ne(De,this.vector(),ct,ge.vector());return qi===null||!T(Oe,qi)?null:U.round(qi.x,qi.y)}},{key:"split",value:function(ge){var xe=[],Me=ge.events!==void 0,Oe=new ee(ge,!0),De=new ee(ge,!1),rt=this.rightSE;this.replaceRightSE(De),xe.push(De),xe.push(Oe);var ct=new je(Oe,rt,this.rings.slice(),this.windings.slice());return ee.comparePoints(ct.leftSE.point,ct.rightSE.point)>0&&ct.swapEvents(),ee.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Me&&(Oe.checkForConsuming(),De.checkForConsuming()),xe}},{key:"swapEvents",value:function(){var ge=this.rightSE;this.rightSE=this.leftSE,this.leftSE=ge,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var xe=0,Me=this.windings.length;xe<Me;xe++)this.windings[xe]*=-1}},{key:"consume",value:function(ge){for(var xe=this,Me=ge;xe.consumedBy;)xe=xe.consumedBy;for(;Me.consumedBy;)Me=Me.consumedBy;var Oe=je.compare(xe,Me);if(Oe!==0){if(Oe>0){var De=xe;xe=Me,Me=De}if(xe.prev===Me){var rt=xe;xe=Me,Me=rt}for(var ct=0,Vt=Me.rings.length;ct<Vt;ct++){var ti=Me.rings[ct],lt=Me.windings[ct],Nt=xe.rings.indexOf(ti);Nt===-1?(xe.rings.push(ti),xe.windings.push(lt)):xe.windings[Nt]+=lt}Me.rings=null,Me.windings=null,Me.consumedBy=xe,Me.leftSE.consumedBy=xe.leftSE,Me.rightSE.consumedBy=xe.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var ge=this.prev.consumedBy||this.prev;this._beforeState=ge.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var ge=this.beforeState();this._afterState={rings:ge.rings.slice(0),windings:ge.windings.slice(0),multiPolys:[]};for(var xe=this._afterState.rings,Me=this._afterState.windings,Oe=this._afterState.multiPolys,De=0,rt=this.rings.length;De<rt;De++){var ct=this.rings[De],Vt=this.windings[De],ti=xe.indexOf(ct);ti===-1?(xe.push(ct),Me.push(Vt)):Me[ti]+=Vt}for(var lt=[],Nt=[],Lt=0,qi=xe.length;Lt<qi;Lt++)if(Me[Lt]!==0){var Vi=xe[Lt],Ke=Vi.poly;if(Nt.indexOf(Ke)===-1)if(Vi.isExterior)lt.push(Ke);else{Nt.indexOf(Ke)===-1&&Nt.push(Ke);var dt=lt.indexOf(Vi.poly);dt!==-1&&lt.splice(dt,1)}}for(var kt=0,Zt=lt.length;kt<Zt;kt++){var Qt=lt[kt].multiPoly;Oe.indexOf(Qt)===-1&&Oe.push(Qt)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var ge=this.beforeState().multiPolys,xe=this.afterState().multiPolys;switch(Te.type){case"union":{var Me=ge.length===0,Oe=xe.length===0;this._isInResult=Me!==Oe;break}case"intersection":{var De,rt;ge.length<xe.length?(De=ge.length,rt=xe.length):(De=xe.length,rt=ge.length),this._isInResult=rt===Te.numMultiPolys&&De<rt;break}case"xor":{var ct=Math.abs(ge.length-xe.length);this._isInResult=ct%2===1;break}case"difference":{var Vt=function(lt){return lt.length===1&&lt[0].isSubject};this._isInResult=Vt(ge)!==Vt(xe);break}default:throw new Error("Unrecognized operation type found ".concat(Te.type))}return this._isInResult}}],[{key:"fromRing",value:function(ge,xe,Me){var Oe,De,rt,ct=ee.comparePoints(ge,xe);if(ct<0)Oe=ge,De=xe,rt=1;else if(ct>0)Oe=xe,De=ge,rt=-1;else throw new Error("Tried to create degenerate segment at [".concat(ge.x,", ").concat(ge.y,"]"));var Vt=new ee(Oe,!0),ti=new ee(De,!1);return new je(Vt,ti,[Me],[rt])}}]),je}(),ie=function(){function je(be,ge,xe){if(t(this,je),!Array.isArray(be)||be.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=ge,this.isExterior=xe,this.segments=[],typeof be[0][0]!="number"||typeof be[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Me=U.round(be[0][0],be[0][1]);this.bbox={ll:{x:Me.x,y:Me.y},ur:{x:Me.x,y:Me.y}};for(var Oe=Me,De=1,rt=be.length;De<rt;De++){if(typeof be[De][0]!="number"||typeof be[De][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var ct=U.round(be[De][0],be[De][1]);ct.x===Oe.x&&ct.y===Oe.y||(this.segments.push(te.fromRing(Oe,ct,this)),ct.x<this.bbox.ll.x&&(this.bbox.ll.x=ct.x),ct.y<this.bbox.ll.y&&(this.bbox.ll.y=ct.y),ct.x>this.bbox.ur.x&&(this.bbox.ur.x=ct.x),ct.y>this.bbox.ur.y&&(this.bbox.ur.y=ct.y),Oe=ct)}(Me.x!==Oe.x||Me.y!==Oe.y)&&this.segments.push(te.fromRing(Oe,Me,this))}return i(je,[{key:"getSweepEvents",value:function(){for(var ge=[],xe=0,Me=this.segments.length;xe<Me;xe++){var Oe=this.segments[xe];ge.push(Oe.leftSE),ge.push(Oe.rightSE)}return ge}}]),je}(),oe=function(){function je(be,ge){if(t(this,je),!Array.isArray(be))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ie(be[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var xe=1,Me=be.length;xe<Me;xe++){var Oe=new ie(be[xe],this,!1);Oe.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Oe.bbox.ll.x),Oe.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Oe.bbox.ll.y),Oe.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Oe.bbox.ur.x),Oe.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Oe.bbox.ur.y),this.interiorRings.push(Oe)}this.multiPoly=ge}return i(je,[{key:"getSweepEvents",value:function(){for(var ge=this.exteriorRing.getSweepEvents(),xe=0,Me=this.interiorRings.length;xe<Me;xe++)for(var Oe=this.interiorRings[xe].getSweepEvents(),De=0,rt=Oe.length;De<rt;De++)ge.push(Oe[De]);return ge}}]),je}(),fe=function(){function je(be,ge){if(t(this,je),!Array.isArray(be))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof be[0][0][0]=="number"&&(be=[be])}catch(De){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var xe=0,Me=be.length;xe<Me;xe++){var Oe=new oe(be[xe],this);Oe.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Oe.bbox.ll.x),Oe.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Oe.bbox.ll.y),Oe.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Oe.bbox.ur.x),Oe.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Oe.bbox.ur.y),this.polys.push(Oe)}this.isSubject=ge}return i(je,[{key:"getSweepEvents",value:function(){for(var ge=[],xe=0,Me=this.polys.length;xe<Me;xe++)for(var Oe=this.polys[xe].getSweepEvents(),De=0,rt=Oe.length;De<rt;De++)ge.push(Oe[De]);return ge}}]),je}(),Re=function(){i(je,null,[{key:"factory",value:function(ge){for(var xe=[],Me=0,Oe=ge.length;Me<Oe;Me++){var De=ge[Me];if(!(!De.isInResult()||De.ringOut)){for(var rt=null,ct=De.leftSE,Vt=De.rightSE,ti=[ct],lt=ct.point,Nt=[];rt=ct,ct=Vt,ti.push(ct),ct.point!==lt;)for(;;){var Lt=ct.getAvailableLinkedEvents();if(Lt.length===0){var qi=ti[0].point,Vi=ti[ti.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(qi.x,",")+" ".concat(qi.y,"]. Last matching segment found ends at")+" [".concat(Vi.x,", ").concat(Vi.y,"]."))}if(Lt.length===1){Vt=Lt[0].otherSE;break}for(var Ke=null,dt=0,kt=Nt.length;dt<kt;dt++)if(Nt[dt].point===ct.point){Ke=dt;break}if(Ke!==null){var Zt=Nt.splice(Ke)[0],Qt=ti.splice(Zt.index);Qt.unshift(Qt[0].otherSE),xe.push(new je(Qt.reverse()));continue}Nt.push({index:ti.length,point:ct.point});var Oi=ct.getLeftmostComparator(rt);Vt=Lt.sort(Oi)[0].otherSE;break}xe.push(new je(ti))}}return xe}}]);function je(be){t(this,je),this.events=be;for(var ge=0,xe=be.length;ge<xe;ge++)be[ge].segment.ringOut=this;this.poly=null}return i(je,[{key:"getGeom",value:function(){for(var ge=this.events[0].point,xe=[ge],Me=1,Oe=this.events.length-1;Me<Oe;Me++){var De=this.events[Me].point,rt=this.events[Me+1].point;W(De,ge,rt)!==0&&(xe.push(De),ge=De)}if(xe.length===1)return null;var ct=xe[0],Vt=xe[1];W(ct,ge,Vt)===0&&xe.shift(),xe.push(xe[0]);for(var ti=this.isExteriorRing()?1:-1,lt=this.isExteriorRing()?0:xe.length-1,Nt=this.isExteriorRing()?xe.length:-1,Lt=[],qi=lt;qi!=Nt;qi+=ti)Lt.push([xe[qi].x,xe[qi].y]);return Lt}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var ge=this.enclosingRing();this._isExteriorRing=ge?!ge.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var ge=this.events[0],xe=1,Me=this.events.length;xe<Me;xe++){var Oe=this.events[xe];ee.compare(ge,Oe)>0&&(ge=Oe)}for(var De=ge.segment.prevInResult(),rt=De?De.prevInResult():null;;){if(!De)return null;if(!rt)return De.ringOut;if(rt.ringOut!==De.ringOut)return rt.ringOut.enclosingRing()!==De.ringOut?De.ringOut:De.ringOut.enclosingRing();De=rt.prevInResult(),rt=De?De.prevInResult():null}}}]),je}(),He=function(){function je(be){t(this,je),this.exteriorRing=be,be.poly=this,this.interiorRings=[]}return i(je,[{key:"addInterior",value:function(ge){this.interiorRings.push(ge),ge.poly=this}},{key:"getGeom",value:function(){var ge=[this.exteriorRing.getGeom()];if(ge[0]===null)return null;for(var xe=0,Me=this.interiorRings.length;xe<Me;xe++){var Oe=this.interiorRings[xe].getGeom();Oe!==null&&ge.push(Oe)}return ge}}]),je}(),Je=function(){function je(be){t(this,je),this.rings=be,this.polys=this._composePolys(be)}return i(je,[{key:"getGeom",value:function(){for(var ge=[],xe=0,Me=this.polys.length;xe<Me;xe++){var Oe=this.polys[xe].getGeom();Oe!==null&&ge.push(Oe)}return ge}},{key:"_composePolys",value:function(ge){for(var xe=[],Me=0,Oe=ge.length;Me<Oe;Me++){var De=ge[Me];if(!De.poly)if(De.isExteriorRing())xe.push(new He(De));else{var rt=De.enclosingRing();rt.poly||xe.push(new He(rt)),rt.poly.addInterior(De)}}return xe}}]),je}(),ot=function(){function je(be){var ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:te.compare;t(this,je),this.queue=be,this.tree=new d(ge),this.segments=[]}return i(je,[{key:"process",value:function(ge){var xe=ge.segment,Me=[];if(ge.consumedBy)return ge.isLeft?this.queue.remove(ge.otherSE):this.tree.remove(xe),Me;var Oe=ge.isLeft?this.tree.insert(xe):this.tree.find(xe);if(!Oe)throw new Error("Unable to find segment #".concat(xe.id," ")+"[".concat(xe.leftSE.point.x,", ").concat(xe.leftSE.point.y,"] -> ")+"[".concat(xe.rightSE.point.x,", ").concat(xe.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var De=Oe,rt=Oe,ct=void 0,Vt=void 0;ct===void 0;)De=this.tree.prev(De),De===null?ct=null:De.key.consumedBy===void 0&&(ct=De.key);for(;Vt===void 0;)rt=this.tree.next(rt),rt===null?Vt=null:rt.key.consumedBy===void 0&&(Vt=rt.key);if(ge.isLeft){var ti=null;if(ct){var lt=ct.getIntersection(xe);if(lt!==null&&(xe.isAnEndpoint(lt)||(ti=lt),!ct.isAnEndpoint(lt)))for(var Nt=this._splitSafely(ct,lt),Lt=0,qi=Nt.length;Lt<qi;Lt++)Me.push(Nt[Lt])}var Vi=null;if(Vt){var Ke=Vt.getIntersection(xe);if(Ke!==null&&(xe.isAnEndpoint(Ke)||(Vi=Ke),!Vt.isAnEndpoint(Ke)))for(var dt=this._splitSafely(Vt,Ke),kt=0,Zt=dt.length;kt<Zt;kt++)Me.push(dt[kt])}if(ti!==null||Vi!==null){var Qt=null;if(ti===null)Qt=Vi;else if(Vi===null)Qt=ti;else{var Oi=ee.comparePoints(ti,Vi);Qt=Oi<=0?ti:Vi}this.queue.remove(xe.rightSE),Me.push(xe.rightSE);for(var gr=xe.split(Qt),Ji=0,ys=gr.length;Ji<ys;Ji++)Me.push(gr[Ji])}Me.length>0?(this.tree.remove(xe),Me.push(ge)):(this.segments.push(xe),xe.prev=ct)}else{if(ct&&Vt){var hs=ct.getIntersection(Vt);if(hs!==null){if(!ct.isAnEndpoint(hs))for(var ke=this._splitSafely(ct,hs),he=0,me=ke.length;he<me;he++)Me.push(ke[he]);if(!Vt.isAnEndpoint(hs))for(var Ee=this._splitSafely(Vt,hs),Fe=0,Ue=Ee.length;Fe<Ue;Fe++)Me.push(Ee[Fe])}}this.tree.remove(xe)}return Me}},{key:"_splitSafely",value:function(ge,xe){this.tree.remove(ge);var Me=ge.rightSE;this.queue.remove(Me);var Oe=ge.split(xe);return Oe.push(Me),ge.consumedBy===void 0&&this.tree.insert(ge),Oe}}]),je}(),yt=typeof process!="undefined"&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,bt=typeof process!="undefined"&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,at=function(){function je(){t(this,je)}return i(je,[{key:"run",value:function(ge,xe,Me){Te.type=ge,U.reset();for(var Oe=[new fe(xe,!0)],De=0,rt=Me.length;De<rt;De++)Oe.push(new fe(Me[De],!1));if(Te.numMultiPolys=Oe.length,Te.type==="difference")for(var ct=Oe[0],Vt=1;Vt<Oe.length;)A(Oe[Vt].bbox,ct.bbox)!==null?Vt++:Oe.splice(Vt,1);if(Te.type==="intersection"){for(var ti=0,lt=Oe.length;ti<lt;ti++)for(var Nt=Oe[ti],Lt=ti+1,qi=Oe.length;Lt<qi;Lt++)if(A(Nt.bbox,Oe[Lt].bbox)===null)return[]}for(var Vi=new d(ee.compare),Ke=0,dt=Oe.length;Ke<dt;Ke++)for(var kt=Oe[Ke].getSweepEvents(),Zt=0,Qt=kt.length;Zt<Qt;Zt++)if(Vi.insert(kt[Zt]),Vi.size>yt)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Oi=new ot(Vi),gr=Vi.size,Ji=Vi.pop();Ji;){var ys=Ji.key;if(Vi.size===gr){var hs=ys.segment;throw new Error("Unable to pop() ".concat(ys.isLeft?"left":"right"," SweepEvent ")+"[".concat(ys.point.x,", ").concat(ys.point.y,"] from segment #").concat(hs.id," ")+"[".concat(hs.leftSE.point.x,", ").concat(hs.leftSE.point.y,"] -> ")+"[".concat(hs.rightSE.point.x,", ").concat(hs.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(Vi.size>yt)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Oi.segments.length>bt)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var ke=Oi.process(ys),he=0,me=ke.length;he<me;he++){var Ee=ke[he];Ee.consumedBy===void 0&&Vi.insert(Ee)}gr=Vi.size,Ji=Vi.pop()}U.reset();var Fe=Re.factory(Oi.segments),Ue=new Je(Fe);return Ue.getGeom()}}]),je}(),Te=new at,Ze=function(be){for(var ge=arguments.length,xe=new Array(ge>1?ge-1:0),Me=1;Me<ge;Me++)xe[Me-1]=arguments[Me];return Te.run("union",be,xe)},xt=function(be){for(var ge=arguments.length,xe=new Array(ge>1?ge-1:0),Me=1;Me<ge;Me++)xe[Me-1]=arguments[Me];return Te.run("intersection",be,xe)},It=function(be){for(var ge=arguments.length,xe=new Array(ge>1?ge-1:0),Me=1;Me<ge;Me++)xe[Me-1]=arguments[Me];return Te.run("xor",be,xe)},Bt=function(be){for(var ge=arguments.length,xe=new Array(ge>1?ge-1:0),Me=1;Me<ge;Me++)xe[Me-1]=arguments[Me];return Te.run("difference",be,xe)},Mi={union:Ze,intersection:xt,xor:It,difference:Bt};return Mi})});var tL=Gi((aPe,_T)=>{(function(){function t(e,i,r){function s(g){return g.map(function(_,v){return v<2?1*_.toFixed(i):1*_.toFixed(r)})}function n(g){return g.map(s)}function o(g){return g.map(n)}function a(g){return g.map(o)}function l(g){if(!g)return{};switch(g.type){case"Point":return g.coordinates=s(g.coordinates),g;case"LineString":case"MultiPoint":return g.coordinates=n(g.coordinates),g;case"Polygon":case"MultiLineString":return g.coordinates=o(g.coordinates),g;case"MultiPolygon":return g.coordinates=a(g.coordinates),g;case"GeometryCollection":return g.geometries=g.geometries.map(l),g;default:return{}}}function c(g){return g.geometry=l(g.geometry),g}function d(g){return g.features=g.features.map(c),g}function m(g){return g.geometries=g.geometries.map(l),g}if(!e)return e;switch(e.type){case"Feature":return c(e);case"GeometryCollection":return m(e);case"FeatureCollection":return d(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiPolygon":case"MultiLineString":return l(e);default:return e}}_T.exports=t,_T.exports.parse=t})()});var sL=Gi((lPe,rL)=>{function ny(t){return typeof t=="object"&&t!==null}function QW(t,e){Array.isArray(t)?t.forEach(e):ny(t)&&Object.keys(t).forEach(function(i){var r=t[i];e(r,i)})}function iL(t){var e=0;return Array.isArray(t)||ny(t)?(QW(t,function(i){if(Array.isArray(i)||ny(i)){var r=iL(i);r>e&&(e=r)}}),e+1):e}function KW(t,e){e=e||{};var i=JSON.stringify([1],null,t4(e,"indent",2)).slice(2,-3),r=t4(e,"margins",!1),s=t4(e,"arrayMargins",!1),n=t4(e,"objectMargins",!1),o=i===""?1/0:t4(e,"maxLength",80),a=t4(e,"maxNesting",1/0);return function l(c,d,m){c&&typeof c.toJSON=="function"&&(c=c.toJSON());var g=JSON.stringify(c);if(g===void 0)return g;var _=o-d.length-m,v=iL(c);if(v<=a&&g.length<=_){var E=eq(g,{addMargin:r,addArrayMargin:s,addObjectMargin:n});if(E.length<=_)return E}if(ny(c)){var b=d+i,T=[],A,M=function(F,O){return O===F.length-1?0:1};if(Array.isArray(c)){for(var k=0;k<c.length;k++)T.push(l(c[k],b,M(c,k))||"null");A="[]"}else Object.keys(c).forEach(function(F,O,B){var U=JSON.stringify(F)+": ",z=l(c[F],b,U.length+M(B,O));z!==void 0&&T.push(U+z)}),A="{}";if(T.length>0)return[A[0],i+T.join(`,
`+b),A[1]].join(`
`+d)}return g}(t,"",0)}var JW=/("(?:[^\\"]|\\.)*")|[:,\][}{]/g;function eq(t,e){e=e||{};var i={"{":"{","}":"}","[":"[","]":"]",",":", ",":":": "};return(e.addMargin||e.addObjectMargin)&&(i["{"]="{ ",i["}"]=" }"),(e.addMargin||e.addArrayMargin)&&(i["["]="[ ",i["]"]=" ]"),t.replace(JW,function(r,s){return s?r:i[r]})}function t4(t,e,i){return e in t?t[e]:i}rL.exports=KW});var gN=Gi((MXe,nS)=>{"use strict";nS.exports=l6;nS.exports.default=l6;function l6(t,e){if(!(this instanceof l6))return new l6(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||lZ,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function lZ(t,e){return t<e?-1:t>e?1:0}l6.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,i=this.compare,r=e[t];t>0;){var s=t-1>>1,n=e[s];if(i(r,n)>=0)break;e[t]=n,t=s}e[t]=r},_down:function(t){for(var e=this.data,i=this.compare,r=this.length>>1,s=e[t];t<r;){var n=(t<<1)+1,o=n+1,a=e[n];if(o<this.length&&i(e[o],a)<0&&(n=o,a=e[o]),i(a,s)>=0)break;e[t]=a,t=n}e[t]=s}}});var _N=Gi((PXe,oS)=>{"use strict";var cZ=gN();oS.exports=yN;oS.exports.default=yN;function yN(t,e,i){e=e||1;for(var r,s,n,o,a=0;a<t[0].length;a++){var l=t[0][a];(!a||l[0]<r)&&(r=l[0]),(!a||l[1]<s)&&(s=l[1]),(!a||l[0]>n)&&(n=l[0]),(!a||l[1]>o)&&(o=l[1])}var c=n-r,d=o-s,m=Math.min(c,d),g=m/2,_=new cZ(null,uZ);if(m===0)return[r,s];for(var v=r;v<n;v+=m)for(var E=s;E<o;E+=m)_.push(new Eh(v+g,E+g,g,t));var b=dZ(t),T=new Eh(r+c/2,s+d/2,0,t);T.d>b.d&&(b=T);for(var A=_.length;_.length;){var M=_.pop();M.d>b.d&&(b=M,i&&console.log("found best %d after %d probes",Math.round(1e4*M.d)/1e4,A)),!(M.max-b.d<=e)&&(g=M.h/2,_.push(new Eh(M.x-g,M.y-g,g,t)),_.push(new Eh(M.x+g,M.y-g,g,t)),_.push(new Eh(M.x-g,M.y+g,g,t)),_.push(new Eh(M.x+g,M.y+g,g,t)),A+=4)}return i&&(console.log("num probes: "+A),console.log("best distance: "+b.d)),[b.x,b.y]}function uZ(t,e){return e.max-t.max}function Eh(t,e,i,r){this.x=t,this.y=e,this.h=i,this.d=hZ(t,e,r),this.max=this.d+this.h*Math.SQRT2}function hZ(t,e,i){for(var r=!1,s=1/0,n=0;n<i.length;n++)for(var o=i[n],a=0,l=o.length,c=l-1;a<l;c=a++){var d=o[a],m=o[c];d[1]>e!=m[1]>e&&t<(m[0]-d[0])*(e-d[1])/(m[1]-d[1])+d[0]&&(r=!r),s=Math.min(s,fZ(t,e,d,m))}return(r?1:-1)*Math.sqrt(s)}function dZ(t){for(var e=0,i=0,r=0,s=t[0],n=0,o=s.length,a=o-1;n<o;a=n++){var l=s[n],c=s[a],d=l[0]*c[1]-c[0]*l[1];i+=(l[0]+c[0])*d,r+=(l[1]+c[1])*d,e+=d*3}return e===0?new Eh(s[0][0],s[0][1],0,t):new Eh(i/e,r/e,0,t)}function fZ(t,e,i,r){var s=i[0],n=i[1],o=r[0]-s,a=r[1]-n;if(o!==0||a!==0){var l=((t-s)*o+(e-n)*a)/(o*o+a*a);l>1?(s=r[0],n=r[1]):l>0&&(s+=o*l,n+=a*l)}return o=t-s,a=e-n,o*o+a*a}});var u6=Gi((kWe,TN)=>{TN.exports=e_;function e_(t,e){var i=t&&t.type,r;if(i==="FeatureCollection")for(r=0;r<t.features.length;r++)e_(t.features[r],e);else if(i==="GeometryCollection")for(r=0;r<t.geometries.length;r++)e_(t.geometries[r],e);else if(i==="Feature")e_(t.geometry,e);else if(i==="Polygon")wN(t.coordinates,e);else if(i==="MultiPolygon")for(r=0;r<t.coordinates.length;r++)wN(t.coordinates[r],e);return t}function wN(t,e){if(t.length!==0){EN(t[0],e);for(var i=1;i<t.length;i++)EN(t[i],!e)}}function EN(t,e){for(var i=0,r=0,s=0,n=t.length,o=n-1;s<n;o=s++){var a=(t[s][0]-t[o][0])*(t[o][1]+t[s][1]),l=i+a;r+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+r>=0!=!!e&&t.reverse()}});var YN=Gi((bS,wS)=>{(function(t,e){typeof bS=="object"&&typeof wS!="undefined"?wS.exports=e():typeof define=="function"&&define.amd?define(e):(t=typeof globalThis!="undefined"?globalThis:t||self,t.maplibregl=e())})(bS,function(){"use strict";var t,e,i;function r(n,o){if(!t)t=o;else if(!e)e=o;else{var a="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",l={};t(l),i=o(l),typeof window!="undefined"&&(i.workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}}r(["exports"],function(n){"use strict";function o(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var a=l;function l(p,u){this.x=p,this.y=u}l.prototype={clone:function(){return new l(this.x,this.y)},add:function(p){return this.clone()._add(p)},sub:function(p){return this.clone()._sub(p)},multByPoint:function(p){return this.clone()._multByPoint(p)},divByPoint:function(p){return this.clone()._divByPoint(p)},mult:function(p){return this.clone()._mult(p)},div:function(p){return this.clone()._div(p)},rotate:function(p){return this.clone()._rotate(p)},rotateAround:function(p,u){return this.clone()._rotateAround(p,u)},matMult:function(p){return this.clone()._matMult(p)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(p){return this.x===p.x&&this.y===p.y},dist:function(p){return Math.sqrt(this.distSqr(p))},distSqr:function(p){var u=p.x-this.x,y=p.y-this.y;return u*u+y*y},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(p){return Math.atan2(this.y-p.y,this.x-p.x)},angleWith:function(p){return this.angleWithSep(p.x,p.y)},angleWithSep:function(p,u){return Math.atan2(this.x*u-this.y*p,this.x*p+this.y*u)},_matMult:function(p){var u=p[2]*this.x+p[3]*this.y;return this.x=p[0]*this.x+p[1]*this.y,this.y=u,this},_add:function(p){return this.x+=p.x,this.y+=p.y,this},_sub:function(p){return this.x-=p.x,this.y-=p.y,this},_mult:function(p){return this.x*=p,this.y*=p,this},_div:function(p){return this.x/=p,this.y/=p,this},_multByPoint:function(p){return this.x*=p.x,this.y*=p.y,this},_divByPoint:function(p){return this.x/=p.x,this.y/=p.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var p=this.y;return this.y=this.x,this.x=-p,this},_rotate:function(p){var u=Math.cos(p),y=Math.sin(p),w=y*this.x+u*this.y;return this.x=u*this.x-y*this.y,this.y=w,this},_rotateAround:function(p,u){var y=Math.cos(p),w=Math.sin(p),C=u.y+w*(this.x-u.x)+y*(this.y-u.y);return this.x=u.x+y*(this.x-u.x)-w*(this.y-u.y),this.y=C,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},l.convert=function(p){return p instanceof l?p:Array.isArray(p)?new l(p[0],p[1]):p};var c=o(a),d=m;function m(p,u,y,w){this.cx=3*p,this.bx=3*(y-p)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(w-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=p,this.p1y=u,this.p2x=y,this.p2y=w}m.prototype={sampleCurveX:function(p){return((this.ax*p+this.bx)*p+this.cx)*p},sampleCurveY:function(p){return((this.ay*p+this.by)*p+this.cy)*p},sampleCurveDerivativeX:function(p){return(3*this.ax*p+2*this.bx)*p+this.cx},solveCurveX:function(p,u){if(u===void 0&&(u=1e-6),p<0)return 0;if(p>1)return 1;for(var y=p,w=0;w<8;w++){var C=this.sampleCurveX(y)-p;if(Math.abs(C)<u)return y;var R=this.sampleCurveDerivativeX(y);if(Math.abs(R)<1e-6)break;y-=C/R}var N=0,G=1;for(y=p,w=0;w<20&&(C=this.sampleCurveX(y),!(Math.abs(C-p)<u));w++)p>C?N=y:G=y,y=.5*(G-N)+N;return y},solve:function(p,u){return this.sampleCurveY(this.solveCurveX(p,u))}};var g=o(d);function _(p,u,y,w){let C=new g(p,u,y,w);return function(R){return C.solve(R)}}let v=_(.25,.1,.25,1);function E(p,u,y){return Math.min(y,Math.max(u,p))}function b(p,u,y){let w=y-u,C=((p-u)%w+w)%w+u;return C===u?y:C}function T(p,...u){for(let y of u)for(let w in y)p[w]=y[w];return p}let A=1;function M(p,u,y){let w={};for(let C in p)w[C]=u.call(y||this,p[C],C,p);return w}function k(p,u,y){let w={};for(let C in p)u.call(y||this,p[C],C,p)&&(w[C]=p[C]);return w}function F(p){return Array.isArray(p)?p.map(F):typeof p=="object"&&p?M(p,F):p}let O={};function B(p){O[p]||(typeof console!="undefined"&&console.warn(p),O[p]=!0)}function U(p,u,y){return(y.y-p.y)*(u.x-p.x)>(u.y-p.y)*(y.x-p.x)}function z(p){let u=0;for(let y,w,C=0,R=p.length,N=R-1;C<R;N=C++)y=p[C],w=p[N],u+=(w.x-y.x)*(y.y+w.y);return u}function Z(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}let W=null;function q(p){if(W==null){let u=p.navigator?p.navigator.userAgent:null;W=!!p.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return W}function Q(p){return typeof ImageBitmap!="undefined"&&p instanceof ImageBitmap}let V="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",le,de,ne={now:typeof performance!="undefined"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(p){let u=requestAnimationFrame(p);return{cancel:()=>cancelAnimationFrame(u)}},getImageData(p,u=0){return this.getImageCanvasContext(p).getImageData(-u,-u,p.width+2*u,p.height+2*u)},getImageCanvasContext(p){let u=window.document.createElement("canvas"),y=u.getContext("2d",{willReadFrequently:!0});if(!y)throw new Error("failed to create canvas 2d context");return u.width=p.width,u.height=p.height,y.drawImage(p,0,0,p.width,p.height),y},resolveURL:p=>(le||(le=document.createElement("a")),le.href=p,le.href),hardwareConcurrency:typeof navigator!="undefined"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(de==null&&(de=matchMedia("(prefers-reduced-motion: reduce)")),de.matches)}},ee={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class re extends Error{constructor(u,y,w,C){super(`AJAXError: ${y} (${u}): ${w}`),this.status=u,this.statusText=y,this.url=w,this.body=C}}let te=Z()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,ie=p=>ee.REGISTERED_PROTOCOLS[p.substring(0,p.indexOf("://"))];function oe(p,u){let y=new AbortController,w=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:te(),signal:y.signal}),C=!1,R=!1;return p.type==="json"&&w.headers.set("Accept","application/json"),R||fetch(w).then(N=>N.ok?(G=>{(p.type==="arrayBuffer"||p.type==="image"?G.arrayBuffer():p.type==="json"?G.json():G.text()).then(X=>{R||(C=!0,u(null,X,G.headers.get("Cache-Control"),G.headers.get("Expires")))}).catch(X=>{R||u(new Error(X.message))})})(N):N.blob().then(G=>u(new re(N.status,N.statusText,p.url,G)))).catch(N=>{N.code!==20&&u(new Error(N.message))}),{cancel:()=>{R=!0,C||y.abort()}}}let fe=function(p,u){if(/:\/\//.test(p.url)&&!/^https?:|^file:/.test(p.url)){if(Z()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",p,u);if(!Z())return(ie(p.url)||oe)(p,u)}if(!(/^file:/.test(y=p.url)||/^file:/.test(te())&&!/^\w+:/.test(y))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return oe(p,u);if(Z()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",p,u,void 0,!0)}var y;return function(w,C){let R=new XMLHttpRequest;R.open(w.method||"GET",w.url,!0),w.type!=="arrayBuffer"&&w.type!=="image"||(R.responseType="arraybuffer");for(let N in w.headers)R.setRequestHeader(N,w.headers[N]);return w.type==="json"&&(R.responseType="text",R.setRequestHeader("Accept","application/json")),R.withCredentials=w.credentials==="include",R.onerror=()=>{C(new Error(R.statusText))},R.onload=()=>{if((R.status>=200&&R.status<300||R.status===0)&&R.response!==null){let N=R.response;if(w.type==="json")try{N=JSON.parse(R.response)}catch(G){return C(G)}C(null,N,R.getResponseHeader("Cache-Control"),R.getResponseHeader("Expires"))}else{let N=new Blob([R.response],{type:R.getResponseHeader("Content-Type")});C(new re(R.status,R.statusText,w.url,N))}},R.send(w.body),{cancel:()=>R.abort()}}(p,u)},Re=function(p,u){return fe(T(p,{type:"arrayBuffer"}),u)};function He(p){if(!p||p.indexOf("://")<=0||p.indexOf("data:image/")===0||p.indexOf("blob:")===0)return!0;let u=new URL(p),y=window.location;return u.protocol===y.protocol&&u.host===y.host}function Je(p,u,y){y[p]&&y[p].indexOf(u)!==-1||(y[p]=y[p]||[],y[p].push(u))}function ot(p,u,y){if(y&&y[p]){let w=y[p].indexOf(u);w!==-1&&y[p].splice(w,1)}}class yt{constructor(u,y={}){T(this,y),this.type=u}}class bt extends yt{constructor(u,y={}){super("error",T({error:u},y))}}class at{on(u,y){return this._listeners=this._listeners||{},Je(u,y,this._listeners),this}off(u,y){return ot(u,y,this._listeners),ot(u,y,this._oneTimeListeners),this}once(u,y){return y?(this._oneTimeListeners=this._oneTimeListeners||{},Je(u,y,this._oneTimeListeners),this):new Promise(w=>this.once(u,w))}fire(u,y){typeof u=="string"&&(u=new yt(u,y||{}));let w=u.type;if(this.listens(w)){u.target=this;let C=this._listeners&&this._listeners[w]?this._listeners[w].slice():[];for(let G of C)G.call(this,u);let R=this._oneTimeListeners&&this._oneTimeListeners[w]?this._oneTimeListeners[w].slice():[];for(let G of R)ot(w,G,this._oneTimeListeners),G.call(this,u);let N=this._eventedParent;N&&(T(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),N.fire(u))}else u instanceof bt&&console.error(u.error);return this}listens(u){return this._listeners&&this._listeners[u]&&this._listeners[u].length>0||this._oneTimeListeners&&this._oneTimeListeners[u]&&this._oneTimeListeners[u].length>0||this._eventedParent&&this._eventedParent.listens(u)}setEventedParent(u,y){return this._eventedParent=u,this._eventedParentData=y,this}}var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let Ze=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function xt(p,u){let y={};for(let w in p)w!=="ref"&&(y[w]=p[w]);return Ze.forEach(w=>{w in u&&(y[w]=u[w])}),y}function It(p,u){if(Array.isArray(p)){if(!Array.isArray(u)||p.length!==u.length)return!1;for(let y=0;y<p.length;y++)if(!It(p[y],u[y]))return!1;return!0}if(typeof p=="object"&&p!==null&&u!==null){if(typeof u!="object"||Object.keys(p).length!==Object.keys(u).length)return!1;for(let y in p)if(!It(p[y],u[y]))return!1;return!0}return p===u}let Bt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Mi(p,u,y){y.push({command:Bt.addSource,args:[p,u[p]]})}function je(p,u,y){u.push({command:Bt.removeSource,args:[p]}),y[p]=!0}function be(p,u,y,w){je(p,y,w),Mi(p,u,y)}function ge(p,u,y){let w;for(w in p[y])if(Object.prototype.hasOwnProperty.call(p[y],w)&&w!=="data"&&!It(p[y][w],u[y][w]))return!1;for(w in u[y])if(Object.prototype.hasOwnProperty.call(u[y],w)&&w!=="data"&&!It(p[y][w],u[y][w]))return!1;return!0}function xe(p,u,y,w,C,R){let N;for(N in u=u||{},p=p||{})Object.prototype.hasOwnProperty.call(p,N)&&(It(p[N],u[N])||y.push({command:R,args:[w,N,u[N],C]}));for(N in u)Object.prototype.hasOwnProperty.call(u,N)&&!Object.prototype.hasOwnProperty.call(p,N)&&(It(p[N],u[N])||y.push({command:R,args:[w,N,u[N],C]}))}function Me(p){return p.id}function Oe(p,u){return p[u.id]=u,p}class De{constructor(u,y,w,C){this.message=(u?`${u}: `:"")+w,C&&(this.identifier=C),y!=null&&y.__line__&&(this.line=y.__line__)}}function rt(p,...u){for(let y of u)for(let w in y)p[w]=y[w];return p}class ct extends Error{constructor(u,y){super(y),this.message=y,this.key=u}}class Vt{constructor(u,y=[]){this.parent=u,this.bindings={};for(let[w,C]of y)this.bindings[w]=C}concat(u){return new Vt(this,u)}get(u){if(this.bindings[u])return this.bindings[u];if(this.parent)return this.parent.get(u);throw new Error(`${u} not found in scope.`)}has(u){return!!this.bindings[u]||!!this.parent&&this.parent.has(u)}}let ti={kind:"null"},lt={kind:"number"},Nt={kind:"string"},Lt={kind:"boolean"},qi={kind:"color"},Vi={kind:"object"},Ke={kind:"value"},dt={kind:"collator"},kt={kind:"formatted"},Zt={kind:"padding"},Qt={kind:"resolvedImage"},Oi={kind:"variableAnchorOffsetCollection"};function gr(p,u){return{kind:"array",itemType:p,N:u}}function Ji(p){if(p.kind==="array"){let u=Ji(p.itemType);return typeof p.N=="number"?`array<${u}, ${p.N}>`:p.itemType.kind==="value"?"array":`array<${u}>`}return p.kind}let ys=[ti,lt,Nt,Lt,qi,kt,Vi,gr(Ke),Zt,Qt,Oi];function hs(p,u){if(u.kind==="error")return null;if(p.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!hs(p.itemType,u.itemType))&&(typeof p.N!="number"||p.N===u.N))return null}else{if(p.kind===u.kind)return null;if(p.kind==="value"){for(let y of ys)if(!hs(y,u))return null}}return`Expected ${Ji(p)} but found ${Ji(u)} instead.`}function ke(p,u){return u.some(y=>y.kind===p.kind)}function he(p,u){return u.some(y=>y==="null"?p===null:y==="array"?Array.isArray(p):y==="object"?p&&!Array.isArray(p)&&typeof p=="object":y===typeof p)}function me(p,u){return p.kind==="array"&&u.kind==="array"?p.itemType.kind===u.itemType.kind&&typeof p.N=="number":p.kind===u.kind}let Ee=.96422,Fe=.82521,Ue=4/29,We=6/29,Ge=3*We*We,ze=We*We*We,Qe=Math.PI/180,_t=180/Math.PI;function wt(p){return(p%=360)<0&&(p+=360),p}function Et([p,u,y,w]){let C,R,N=ji((.2225045*(p=wi(p))+.7168786*(u=wi(u))+.0606169*(y=wi(y)))/1);p===u&&u===y?C=R=N:(C=ji((.4360747*p+.3850649*u+.1430804*y)/Ee),R=ji((.0139322*p+.0971045*u+.7141733*y)/Fe));let G=116*N-16;return[G<0?0:G,500*(C-N),200*(N-R),w]}function wi(p){return p<=.04045?p/12.92:Math.pow((p+.055)/1.055,2.4)}function ji(p){return p>ze?Math.pow(p,1/3):p/Ge+Ue}function ai([p,u,y,w]){let C=(p+16)/116,R=isNaN(u)?C:C+u/500,N=isNaN(y)?C:C-y/200;return C=1*zi(C),R=Ee*zi(R),N=Fe*zi(N),[_i(3.1338561*R-1.6168667*C-.4906146*N),_i(-.9787684*R+1.9161415*C+.033454*N),_i(.0719453*R-.2289914*C+1.4052427*N),w]}function _i(p){return(p=p<=.00304?12.92*p:1.055*Math.pow(p,1/2.4)-.055)<0?0:p>1?1:p}function zi(p){return p>We?p*p*p:Ge*(p-Ue)}function wr(p){return parseInt(p.padEnd(2,p),16)/255}function Or(p,u){return ur(u?p/100:p,0,1)}function ur(p,u,y){return Math.min(Math.max(u,p),y)}function vr(p){return!p.some(Number.isNaN)}let co={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Fi{constructor(u,y,w,C=1,R=!0){this.r=u,this.g=y,this.b=w,this.a=C,R||(this.r*=C,this.g*=C,this.b*=C,C||this.overwriteGetter("rgb",[u,y,w,C]))}static parse(u){if(u instanceof Fi)return u;if(typeof u!="string")return;let y=function(w){if((w=w.toLowerCase().trim())==="transparent")return[0,0,0,0];let C=co[w];if(C){let[N,G,X]=C;return[N/255,G/255,X/255,1]}if(w.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(w)){let N=w.length<6?1:2,G=1;return[wr(w.slice(G,G+=N)),wr(w.slice(G,G+=N)),wr(w.slice(G,G+=N)),wr(w.slice(G,G+N)||"ff")]}if(w.startsWith("rgb")){let N=w.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(N){let[G,X,K,ae,ue,pe,ve,we,Ie,Le,Be,qe]=N,$e=[ae||" ",ve||" ",Le].join("");if($e==="  "||$e==="  /"||$e===",,"||$e===",,,"){let et=[K,pe,Ie].join(""),it=et==="%%%"?100:et===""?255:0;if(it){let pt=[ur(+X/it,0,1),ur(+ue/it,0,1),ur(+we/it,0,1),Be?Or(+Be,qe):1];if(vr(pt))return pt}}return}}let R=w.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(R){let[N,G,X,K,ae,ue,pe,ve,we]=R,Ie=[X||" ",ae||" ",pe].join("");if(Ie==="  "||Ie==="  /"||Ie===",,"||Ie===",,,"){let Le=[+G,ur(+K,0,100),ur(+ue,0,100),ve?Or(+ve,we):1];if(vr(Le))return function([Be,qe,$e,et]){function it(pt){let Xt=(pt+Be/30)%12,ci=qe*Math.min($e,1-$e);return $e-ci*Math.max(-1,Math.min(Xt-3,9-Xt,1))}return Be=wt(Be),qe/=100,$e/=100,[it(0),it(8),it(4),et]}(Le)}}}(u);return y?new Fi(...y,!1):void 0}get rgb(){let{r:u,g:y,b:w,a:C}=this,R=C||1/0;return this.overwriteGetter("rgb",[u/R,y/R,w/R,C])}get hcl(){return this.overwriteGetter("hcl",function(u){let[y,w,C,R]=Et(u),N=Math.sqrt(w*w+C*C);return[Math.round(1e4*N)?wt(Math.atan2(C,w)*_t):NaN,N,y,R]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Et(this.rgb))}overwriteGetter(u,y){return Object.defineProperty(this,u,{value:y}),y}toString(){let[u,y,w,C]=this.rgb;return`rgba(${[u,y,w].map(R=>Math.round(255*R)).join(",")},${C})`}}Fi.black=new Fi(0,0,0,1),Fi.white=new Fi(1,1,1,1),Fi.transparent=new Fi(0,0,0,0),Fi.red=new Fi(1,0,0,1);class Ws{constructor(u,y,w){this.sensitivity=u?y?"variant":"case":y?"accent":"base",this.locale=w,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(u,y){return this.collator.compare(u,y)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Pn{constructor(u,y,w,C,R){this.text=u,this.image=y,this.scale=w,this.fontStack=C,this.textColor=R}}class Ps{constructor(u){this.sections=u}static fromString(u){return new Ps([new Pn(u,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(u=>u.text.length!==0||u.image&&u.image.name.length!==0)}static factory(u){return u instanceof Ps?u:Ps.fromString(u)}toString(){return this.sections.length===0?"":this.sections.map(u=>u.text).join("")}}class Co{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof Co)return u;if(typeof u=="number")return new Co([u,u,u,u]);if(Array.isArray(u)&&!(u.length<1||u.length>4)){for(let y of u)if(typeof y!="number")return;switch(u.length){case 1:u=[u[0],u[0],u[0],u[0]];break;case 2:u=[u[0],u[1],u[0],u[1]];break;case 3:u=[u[0],u[1],u[2],u[1]]}return new Co(u)}}toString(){return JSON.stringify(this.values)}}let lv=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Un{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof Un)return u;if(Array.isArray(u)&&!(u.length<1)&&u.length%2==0){for(let y=0;y<u.length;y+=2){let w=u[y],C=u[y+1];if(typeof w!="string"||!lv.has(w)||!Array.isArray(C)||C.length!==2||typeof C[0]!="number"||typeof C[1]!="number")return}return new Un(u)}}toString(){return JSON.stringify(this.values)}}class la{constructor(u){this.name=u.name,this.available=u.available}toString(){return this.name}static fromString(u){return u?new la({name:u,available:!1}):null}}function w7(p,u,y,w){return typeof p=="number"&&p>=0&&p<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof y=="number"&&y>=0&&y<=255?w===void 0||typeof w=="number"&&w>=0&&w<=1?null:`Invalid rgba value [${[p,u,y,w].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof w=="number"?[p,u,y,w]:[p,u,y]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function x0(p){if(p===null||typeof p=="string"||typeof p=="boolean"||typeof p=="number"||p instanceof Fi||p instanceof Ws||p instanceof Ps||p instanceof Co||p instanceof Un||p instanceof la)return!0;if(Array.isArray(p)){for(let u of p)if(!x0(u))return!1;return!0}if(typeof p=="object"){for(let u in p)if(!x0(p[u]))return!1;return!0}return!1}function Rs(p){if(p===null)return ti;if(typeof p=="string")return Nt;if(typeof p=="boolean")return Lt;if(typeof p=="number")return lt;if(p instanceof Fi)return qi;if(p instanceof Ws)return dt;if(p instanceof Ps)return kt;if(p instanceof Co)return Zt;if(p instanceof Un)return Oi;if(p instanceof la)return Qt;if(Array.isArray(p)){let u=p.length,y;for(let w of p){let C=Rs(w);if(y){if(y===C)continue;y=Ke;break}y=C}return gr(y||Ke,u)}return Vi}function xc(p){let u=typeof p;return p===null?"":u==="string"||u==="number"||u==="boolean"?String(p):p instanceof Fi||p instanceof Ps||p instanceof Co||p instanceof Un||p instanceof la?p.toString():JSON.stringify(p)}class nu{constructor(u,y){this.type=u,this.value=y}static parse(u,y){if(u.length!==2)return y.error(`'literal' expression requires exactly one argument, but found ${u.length-1} instead.`);if(!x0(u[1]))return y.error("invalid value");let w=u[1],C=Rs(w),R=y.expectedType;return C.kind!=="array"||C.N!==0||!R||R.kind!=="array"||typeof R.N=="number"&&R.N!==0||(C=R),new nu(C,w)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ds{constructor(u){this.name="ExpressionEvaluationError",this.message=u}toJSON(){return this.message}}let v0={string:Nt,number:lt,boolean:Lt,object:Vi};class zn{constructor(u,y){this.type=u,this.args=y}static parse(u,y){if(u.length<2)return y.error("Expected at least one argument.");let w,C=1,R=u[0];if(R==="array"){let G,X;if(u.length>2){let K=u[1];if(typeof K!="string"||!(K in v0)||K==="object")return y.error('The item type argument of "array" must be one of string, number, boolean',1);G=v0[K],C++}else G=Ke;if(u.length>3){if(u[2]!==null&&(typeof u[2]!="number"||u[2]<0||u[2]!==Math.floor(u[2])))return y.error('The length argument to "array" must be a positive integer literal',2);X=u[2],C++}w=gr(G,X)}else{if(!v0[R])throw new Error(`Types doesn't contain name = ${R}`);w=v0[R]}let N=[];for(;C<u.length;C++){let G=y.parse(u[C],C,Ke);if(!G)return null;N.push(G)}return new zn(w,N)}evaluate(u){for(let y=0;y<this.args.length;y++){let w=this.args[y].evaluate(u);if(!hs(this.type,Rs(w)))return w;if(y===this.args.length-1)throw new Ds(`Expected value to be of type ${Ji(this.type)}, but found ${Ji(Rs(w))} instead.`)}throw new Error}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}let b0={"to-boolean":Lt,"to-color":qi,"to-number":lt,"to-string":Nt};class cl{constructor(u,y){this.type=u,this.args=y}static parse(u,y){if(u.length<2)return y.error("Expected at least one argument.");let w=u[0];if(!b0[w])throw new Error(`Can't parse ${w} as it is not part of the known types`);if((w==="to-boolean"||w==="to-string")&&u.length!==2)return y.error("Expected one argument.");let C=b0[w],R=[];for(let N=1;N<u.length;N++){let G=y.parse(u[N],N,Ke);if(!G)return null;R.push(G)}return new cl(C,R)}evaluate(u){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(u);case"color":{let y,w;for(let C of this.args){if(y=C.evaluate(u),w=null,y instanceof Fi)return y;if(typeof y=="string"){let R=u.parseColor(y);if(R)return R}else if(Array.isArray(y)&&(w=y.length<3||y.length>4?`Invalid rbga value ${JSON.stringify(y)}: expected an array containing either three or four numeric values.`:w7(y[0],y[1],y[2],y[3]),!w))return new Fi(y[0]/255,y[1]/255,y[2]/255,y[3])}throw new Ds(w||`Could not parse color from value '${typeof y=="string"?y:JSON.stringify(y)}'`)}case"padding":{let y;for(let w of this.args){y=w.evaluate(u);let C=Co.parse(y);if(C)return C}throw new Ds(`Could not parse padding from value '${typeof y=="string"?y:JSON.stringify(y)}'`)}case"variableAnchorOffsetCollection":{let y;for(let w of this.args){y=w.evaluate(u);let C=Un.parse(y);if(C)return C}throw new Ds(`Could not parse variableAnchorOffsetCollection from value '${typeof y=="string"?y:JSON.stringify(y)}'`)}case"number":{let y=null;for(let w of this.args){if(y=w.evaluate(u),y===null)return 0;let C=Number(y);if(!isNaN(C))return C}throw new Ds(`Could not convert ${JSON.stringify(y)} to number.`)}case"formatted":return Ps.fromString(xc(this.args[0].evaluate(u)));case"resolvedImage":return la.fromString(xc(this.args[0].evaluate(u)));default:return xc(this.args[0].evaluate(u))}}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}let Mh=["Unknown","Point","LineString","Polygon"];class Fr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Mh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(u){let y=this._parseColorCache[u];return y||(y=this._parseColorCache[u]=Fi.parse(u)),y}}class w0{constructor(u,y,w=[],C,R=new Vt,N=[]){this.registry=u,this.path=w,this.key=w.map(G=>`[${G}]`).join(""),this.scope=R,this.errors=N,this.expectedType=C,this._isConstant=y}parse(u,y,w,C,R={}){return y?this.concat(y,w,C)._parse(u,R):this._parse(u,R)}_parse(u,y){function w(C,R,N){return N==="assert"?new zn(R,[C]):N==="coerce"?new cl(R,[C]):C}if(u!==null&&typeof u!="string"&&typeof u!="boolean"&&typeof u!="number"||(u=["literal",u]),Array.isArray(u)){if(u.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let C=u[0];if(typeof C!="string")return this.error(`Expression name must be a string, but found ${typeof C} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let R=this.registry[C];if(R){let N=R.parse(u,this);if(!N)return null;if(this.expectedType){let G=this.expectedType,X=N.type;if(G.kind!=="string"&&G.kind!=="number"&&G.kind!=="boolean"&&G.kind!=="object"&&G.kind!=="array"||X.kind!=="value")if(G.kind!=="color"&&G.kind!=="formatted"&&G.kind!=="resolvedImage"||X.kind!=="value"&&X.kind!=="string")if(G.kind!=="padding"||X.kind!=="value"&&X.kind!=="number"&&X.kind!=="array")if(G.kind!=="variableAnchorOffsetCollection"||X.kind!=="value"&&X.kind!=="array"){if(this.checkSubtype(G,X))return null}else N=w(N,G,y.typeAnnotation||"coerce");else N=w(N,G,y.typeAnnotation||"coerce");else N=w(N,G,y.typeAnnotation||"coerce");else N=w(N,G,y.typeAnnotation||"assert")}if(!(N instanceof nu)&&N.type.kind!=="resolvedImage"&&this._isConstant(N)){let G=new Fr;try{N=new nu(N.type,N.evaluate(G))}catch(X){return this.error(X.message),null}}return N}return this.error(`Unknown expression "${C}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(u===void 0?"'undefined' value invalid. Use null instead.":typeof u=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof u} instead.`)}concat(u,y,w){let C=typeof u=="number"?this.path.concat(u):this.path,R=w?this.scope.concat(w):this.scope;return new w0(this.registry,this._isConstant,C,y||null,R,this.errors)}error(u,...y){let w=`${this.key}${y.map(C=>`[${C}]`).join("")}`;this.errors.push(new ct(w,u))}checkSubtype(u,y){let w=hs(u,y);return w&&this.error(w),w}}class f1{constructor(u,y,w){this.type=dt,this.locale=w,this.caseSensitive=u,this.diacriticSensitive=y}static parse(u,y){if(u.length!==2)return y.error("Expected one argument.");let w=u[1];if(typeof w!="object"||Array.isArray(w))return y.error("Collator options argument must be an object.");let C=y.parse(w["case-sensitive"]!==void 0&&w["case-sensitive"],1,Lt);if(!C)return null;let R=y.parse(w["diacritic-sensitive"]!==void 0&&w["diacritic-sensitive"],1,Lt);if(!R)return null;let N=null;return w.locale&&(N=y.parse(w.locale,1,Nt),!N)?null:new f1(C,R,N)}evaluate(u){return new Ws(this.caseSensitive.evaluate(u),this.diacriticSensitive.evaluate(u),this.locale?this.locale.evaluate(u):null)}eachChild(u){u(this.caseSensitive),u(this.diacriticSensitive),this.locale&&u(this.locale)}outputDefined(){return!1}}let vc=8192;function E0(p,u){p[0]=Math.min(p[0],u[0]),p[1]=Math.min(p[1],u[1]),p[2]=Math.max(p[2],u[0]),p[3]=Math.max(p[3],u[1])}function Ph(p,u){return!(p[0]<=u[0]||p[2]>=u[2]||p[1]<=u[1]||p[3]>=u[3])}function cv(p,u){let y=(180+p[0])/360,w=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+p[1]*Math.PI/360)))/360,C=Math.pow(2,u.z);return[Math.round(y*C*vc),Math.round(w*C*vc)]}function E7(p,u,y){let w=p[0]-u[0],C=p[1]-u[1],R=p[0]-y[0],N=p[1]-y[1];return w*N-R*C==0&&w*R<=0&&C*N<=0}function T0(p,u){let y=!1;for(let N=0,G=u.length;N<G;N++){let X=u[N];for(let K=0,ae=X.length;K<ae-1;K++){if(E7(p,X[K],X[K+1]))return!1;(C=X[K])[1]>(w=p)[1]!=(R=X[K+1])[1]>w[1]&&w[0]<(R[0]-C[0])*(w[1]-C[1])/(R[1]-C[1])+C[0]&&(y=!y)}}var w,C,R;return y}function uv(p,u){for(let y=0;y<u.length;y++)if(T0(p,u[y]))return!0;return!1}function T7(p,u,y,w){let C=w[0]-y[0],R=w[1]-y[1],N=(p[0]-y[0])*R-C*(p[1]-y[1]),G=(u[0]-y[0])*R-C*(u[1]-y[1]);return N>0&&G<0||N<0&&G>0}function hv(p,u,y){for(let K of y)for(let ae=0;ae<K.length-1;++ae)if((G=[(N=K[ae+1])[0]-(R=K[ae])[0],N[1]-R[1]])[0]*(X=[(C=u)[0]-(w=p)[0],C[1]-w[1]])[1]-G[1]*X[0]!=0&&T7(w,C,R,N)&&T7(R,N,w,C))return!0;var w,C,R,N,G,X;return!1}function S7(p,u){for(let y=0;y<p.length;++y)if(!T0(p[y],u))return!1;for(let y=0;y<p.length-1;++y)if(hv(p[y],p[y+1],u))return!1;return!0}function A7(p,u){for(let y=0;y<u.length;y++)if(S7(p,u[y]))return!0;return!1}function S0(p,u,y){let w=[];for(let C=0;C<p.length;C++){let R=[];for(let N=0;N<p[C].length;N++){let G=cv(p[C][N],y);E0(u,G),R.push(G)}w.push(R)}return w}function C7(p,u,y){let w=[];for(let C=0;C<p.length;C++){let R=S0(p[C],u,y);w.push(R)}return w}function I7(p,u,y,w){if(p[0]<y[0]||p[0]>y[2]){let C=.5*w,R=p[0]-y[0]>C?-w:y[0]-p[0]>C?w:0;R===0&&(R=p[0]-y[2]>C?-w:y[2]-p[0]>C?w:0),p[0]+=R}E0(u,p)}function A0(p,u,y,w){let C=Math.pow(2,w.z)*vc,R=[w.x*vc,w.y*vc],N=[];for(let G of p)for(let X of G){let K=[X.x+R[0],X.y+R[1]];I7(K,u,y,C),N.push(K)}return N}function k7(p,u,y,w){let C=Math.pow(2,w.z)*vc,R=[w.x*vc,w.y*vc],N=[];for(let X of p){let K=[];for(let ae of X){let ue=[ae.x+R[0],ae.y+R[1]];E0(u,ue),K.push(ue)}N.push(K)}if(u[2]-u[0]<=C/2){(G=u)[0]=G[1]=1/0,G[2]=G[3]=-1/0;for(let X of N)for(let K of X)I7(K,u,y,C)}var G;return N}class ou{constructor(u,y){this.type=Lt,this.geojson=u,this.geometries=y}static parse(u,y){if(u.length!==2)return y.error(`'within' expression requires exactly one argument, but found ${u.length-1} instead.`);if(x0(u[1])){let w=u[1];if(w.type==="FeatureCollection")for(let C=0;C<w.features.length;++C){let R=w.features[C].geometry.type;if(R==="Polygon"||R==="MultiPolygon")return new ou(w,w.features[C].geometry)}else if(w.type==="Feature"){let C=w.geometry.type;if(C==="Polygon"||C==="MultiPolygon")return new ou(w,w.geometry)}else if(w.type==="Polygon"||w.type==="MultiPolygon")return new ou(w,w)}return y.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(u){if(u.geometry()!=null&&u.canonicalID()!=null){if(u.geometryType()==="Point")return function(y,w){let C=[1/0,1/0,-1/0,-1/0],R=[1/0,1/0,-1/0,-1/0],N=y.canonicalID();if(w.type==="Polygon"){let G=S0(w.coordinates,R,N),X=A0(y.geometry(),C,R,N);if(!Ph(C,R))return!1;for(let K of X)if(!T0(K,G))return!1}if(w.type==="MultiPolygon"){let G=C7(w.coordinates,R,N),X=A0(y.geometry(),C,R,N);if(!Ph(C,R))return!1;for(let K of X)if(!uv(K,G))return!1}return!0}(u,this.geometries);if(u.geometryType()==="LineString")return function(y,w){let C=[1/0,1/0,-1/0,-1/0],R=[1/0,1/0,-1/0,-1/0],N=y.canonicalID();if(w.type==="Polygon"){let G=S0(w.coordinates,R,N),X=k7(y.geometry(),C,R,N);if(!Ph(C,R))return!1;for(let K of X)if(!S7(K,G))return!1}if(w.type==="MultiPolygon"){let G=C7(w.coordinates,R,N),X=k7(y.geometry(),C,R,N);if(!Ph(C,R))return!1;for(let K of X)if(!A7(K,G))return!1}return!0}(u,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class C0{constructor(u,y){this.type=y.type,this.name=u,this.boundExpression=y}static parse(u,y){if(u.length!==2||typeof u[1]!="string")return y.error("'var' expression requires exactly one string literal argument.");let w=u[1];return y.scope.has(w)?new C0(w,y.scope.get(w)):y.error(`Unknown variable "${w}". Make sure "${w}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(u){return this.boundExpression.evaluate(u)}eachChild(){}outputDefined(){return!1}}class Io{constructor(u,y,w,C){this.name=u,this.type=y,this._evaluate=w,this.args=C}evaluate(u){return this._evaluate(u,this.args)}eachChild(u){this.args.forEach(u)}outputDefined(){return!1}static parse(u,y){let w=u[0],C=Io.definitions[w];if(!C)return y.error(`Unknown expression "${w}". If you wanted a literal array, use ["literal", [...]].`,0);let R=Array.isArray(C)?C[0]:C.type,N=Array.isArray(C)?[[C[1],C[2]]]:C.overloads,G=N.filter(([K])=>!Array.isArray(K)||K.length===u.length-1),X=null;for(let[K,ae]of G){X=new w0(y.registry,Rh,y.path,null,y.scope);let ue=[],pe=!1;for(let ve=1;ve<u.length;ve++){let we=u[ve],Ie=Array.isArray(K)?K[ve-1]:K.type,Le=X.parse(we,1+ue.length,Ie);if(!Le){pe=!0;break}ue.push(Le)}if(!pe)if(Array.isArray(K)&&K.length!==ue.length)X.error(`Expected ${K.length} arguments, but found ${ue.length} instead.`);else{for(let ve=0;ve<ue.length;ve++){let we=Array.isArray(K)?K[ve]:K.type,Ie=ue[ve];X.concat(ve+1).checkSubtype(we,Ie.type)}if(X.errors.length===0)return new Io(w,R,ae,ue)}}if(G.length===1)y.errors.push(...X.errors);else{let K=(G.length?G:N).map(([ue])=>{return pe=ue,Array.isArray(pe)?`(${pe.map(Ji).join(", ")})`:`(${Ji(pe.type)}...)`;var pe}).join(" | "),ae=[];for(let ue=1;ue<u.length;ue++){let pe=y.parse(u[ue],1+ae.length);if(!pe)return null;ae.push(Ji(pe.type))}y.error(`Expected arguments of type ${K}, but found (${ae.join(", ")}) instead.`)}return null}static register(u,y){Io.definitions=y;for(let w in y)u[w]=Io}}function Rh(p){if(p instanceof C0)return Rh(p.boundExpression);if(p instanceof Io&&p.name==="error"||p instanceof f1||p instanceof ou)return!1;let u=p instanceof cl||p instanceof zn,y=!0;return p.eachChild(w=>{y=u?y&&Rh(w):y&&w instanceof nu}),!!y&&I0(p)&&Fh(p,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function I0(p){if(p instanceof Io&&(p.name==="get"&&p.args.length===1||p.name==="feature-state"||p.name==="has"&&p.args.length===1||p.name==="properties"||p.name==="geometry-type"||p.name==="id"||/^filter-/.test(p.name))||p instanceof ou)return!1;let u=!0;return p.eachChild(y=>{u&&!I0(y)&&(u=!1)}),u}function Dh(p){if(p instanceof Io&&p.name==="feature-state")return!1;let u=!0;return p.eachChild(y=>{u&&!Dh(y)&&(u=!1)}),u}function Fh(p,u){if(p instanceof Io&&u.indexOf(p.name)>=0)return!1;let y=!0;return p.eachChild(w=>{y&&!Fh(w,u)&&(y=!1)}),y}function Lh(p,u){let y=p.length-1,w,C,R=0,N=y,G=0;for(;R<=N;)if(G=Math.floor((R+N)/2),w=p[G],C=p[G+1],w<=u){if(G===y||u<C)return G;R=G+1}else{if(!(w>u))throw new Ds("Input is not a number.");N=G-1}return 0}class Nh{constructor(u,y,w){this.type=u,this.input=y,this.labels=[],this.outputs=[];for(let[C,R]of w)this.labels.push(C),this.outputs.push(R)}static parse(u,y){if(u.length-1<4)return y.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return y.error("Expected an even number of arguments.");let w=y.parse(u[1],1,lt);if(!w)return null;let C=[],R=null;y.expectedType&&y.expectedType.kind!=="value"&&(R=y.expectedType);for(let N=1;N<u.length;N+=2){let G=N===1?-1/0:u[N],X=u[N+1],K=N,ae=N+1;if(typeof G!="number")return y.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',K);if(C.length&&C[C.length-1][0]>=G)return y.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',K);let ue=y.parse(X,ae,R);if(!ue)return null;R=R||ue.type,C.push([G,ue])}return new Nh(R,w,C)}evaluate(u){let y=this.labels,w=this.outputs;if(y.length===1)return w[0].evaluate(u);let C=this.input.evaluate(u);if(C<=y[0])return w[0].evaluate(u);let R=y.length;return C>=y[R-1]?w[R-1].evaluate(u):w[Lh(y,C)].evaluate(u)}eachChild(u){u(this.input);for(let y of this.outputs)u(y)}outputDefined(){return this.outputs.every(u=>u.outputDefined())}}function au(p,u,y){return p+y*(u-p)}function k0(p,u,y){return p.map((w,C)=>au(w,u[C],y))}let ko={number:au,color:function(p,u,y,w="rgb"){switch(w){case"rgb":{let[C,R,N,G]=k0(p.rgb,u.rgb,y);return new Fi(C,R,N,G,!1)}case"hcl":{let[C,R,N,G]=p.hcl,[X,K,ae,ue]=u.hcl,pe,ve;if(isNaN(C)||isNaN(X))isNaN(C)?isNaN(X)?pe=NaN:(pe=X,N!==1&&N!==0||(ve=K)):(pe=C,ae!==1&&ae!==0||(ve=R));else{let qe=X-C;X>C&&qe>180?qe-=360:X<C&&C-X>180&&(qe+=360),pe=C+y*qe}let[we,Ie,Le,Be]=function([qe,$e,et,it]){return qe=isNaN(qe)?0:qe*Qe,ai([et,Math.cos(qe)*$e,Math.sin(qe)*$e,it])}([pe,ve!=null?ve:au(R,K,y),au(N,ae,y),au(G,ue,y)]);return new Fi(we,Ie,Le,Be,!1)}case"lab":{let[C,R,N,G]=ai(k0(p.lab,u.lab,y));return new Fi(C,R,N,G,!1)}}},array:k0,padding:function(p,u,y){return new Co(k0(p.values,u.values,y))},variableAnchorOffsetCollection:function(p,u,y){let w=p.values,C=u.values;if(w.length!==C.length)throw new Ds(`Cannot interpolate values of different length. from: ${p.toString()}, to: ${u.toString()}`);let R=[];for(let N=0;N<w.length;N+=2){if(w[N]!==C[N])throw new Ds(`Cannot interpolate values containing mismatched anchors. from[${N}]: ${w[N]}, to[${N}]: ${C[N]}`);R.push(w[N]);let[G,X]=w[N+1],[K,ae]=C[N+1];R.push([au(G,K,y),au(X,ae,y)])}return new Un(R)}};class Mo{constructor(u,y,w,C,R){this.type=u,this.operator=y,this.interpolation=w,this.input=C,this.labels=[],this.outputs=[];for(let[N,G]of R)this.labels.push(N),this.outputs.push(G)}static interpolationFactor(u,y,w,C){let R=0;if(u.name==="exponential")R=yp(y,u.base,w,C);else if(u.name==="linear")R=yp(y,1,w,C);else if(u.name==="cubic-bezier"){let N=u.controlPoints;R=new g(N[0],N[1],N[2],N[3]).solve(yp(y,1,w,C))}return R}static parse(u,y){let[w,C,R,...N]=u;if(!Array.isArray(C)||C.length===0)return y.error("Expected an interpolation type expression.",1);if(C[0]==="linear")C={name:"linear"};else if(C[0]==="exponential"){let K=C[1];if(typeof K!="number")return y.error("Exponential interpolation requires a numeric base.",1,1);C={name:"exponential",base:K}}else{if(C[0]!=="cubic-bezier")return y.error(`Unknown interpolation type ${String(C[0])}`,1,0);{let K=C.slice(1);if(K.length!==4||K.some(ae=>typeof ae!="number"||ae<0||ae>1))return y.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);C={name:"cubic-bezier",controlPoints:K}}}if(u.length-1<4)return y.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return y.error("Expected an even number of arguments.");if(R=y.parse(R,2,lt),!R)return null;let G=[],X=null;w==="interpolate-hcl"||w==="interpolate-lab"?X=qi:y.expectedType&&y.expectedType.kind!=="value"&&(X=y.expectedType);for(let K=0;K<N.length;K+=2){let ae=N[K],ue=N[K+1],pe=K+3,ve=K+4;if(typeof ae!="number")return y.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',pe);if(G.length&&G[G.length-1][0]>=ae)return y.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',pe);let we=y.parse(ue,ve,X);if(!we)return null;X=X||we.type,G.push([ae,we])}return me(X,lt)||me(X,qi)||me(X,Zt)||me(X,Oi)||me(X,gr(lt))?new Mo(X,w,C,R,G):y.error(`Type ${Ji(X)} is not interpolatable.`)}evaluate(u){let y=this.labels,w=this.outputs;if(y.length===1)return w[0].evaluate(u);let C=this.input.evaluate(u);if(C<=y[0])return w[0].evaluate(u);let R=y.length;if(C>=y[R-1])return w[R-1].evaluate(u);let N=Lh(y,C),G=Mo.interpolationFactor(this.interpolation,C,y[N],y[N+1]),X=w[N].evaluate(u),K=w[N+1].evaluate(u);switch(this.operator){case"interpolate":return ko[this.type.kind](X,K,G);case"interpolate-hcl":return ko.color(X,K,G,"hcl");case"interpolate-lab":return ko.color(X,K,G,"lab")}}eachChild(u){u(this.input);for(let y of this.outputs)u(y)}outputDefined(){return this.outputs.every(u=>u.outputDefined())}}function yp(p,u,y,w){let C=w-y,R=p-y;return C===0?0:u===1?R/C:(Math.pow(u,R)-1)/(Math.pow(u,C)-1)}class M0{constructor(u,y){this.type=u,this.args=y}static parse(u,y){if(u.length<2)return y.error("Expectected at least one argument.");let w=null,C=y.expectedType;C&&C.kind!=="value"&&(w=C);let R=[];for(let G of u.slice(1)){let X=y.parse(G,1+R.length,w,void 0,{typeAnnotation:"omit"});if(!X)return null;w=w||X.type,R.push(X)}if(!w)throw new Error("No output type");let N=C&&R.some(G=>hs(C,G.type));return new M0(N?Ke:w,R)}evaluate(u){let y,w=null,C=0;for(let R of this.args)if(C++,w=R.evaluate(u),w&&w instanceof la&&!w.available&&(y||(y=w.name),w=null,C===this.args.length&&(w=y)),w!==null)break;return w}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}class p1{constructor(u,y){this.type=y.type,this.bindings=[].concat(u),this.result=y}evaluate(u){return this.result.evaluate(u)}eachChild(u){for(let y of this.bindings)u(y[1]);u(this.result)}static parse(u,y){if(u.length<4)return y.error(`Expected at least 3 arguments, but found ${u.length-1} instead.`);let w=[];for(let R=1;R<u.length-1;R+=2){let N=u[R];if(typeof N!="string")return y.error(`Expected string, but found ${typeof N} instead.`,R);if(/[^a-zA-Z0-9_]/.test(N))return y.error("Variable names must contain only alphanumeric characters or '_'.",R);let G=y.parse(u[R+1],R+1);if(!G)return null;w.push([N,G])}let C=y.parse(u[u.length-1],u.length-1,y.expectedType,w);return C?new p1(w,C):null}outputDefined(){return this.result.outputDefined()}}class m1{constructor(u,y,w){this.type=u,this.index=y,this.input=w}static parse(u,y){if(u.length!==3)return y.error(`Expected 2 arguments, but found ${u.length-1} instead.`);let w=y.parse(u[1],1,lt),C=y.parse(u[2],2,gr(y.expectedType||Ke));return w&&C?new m1(C.type.itemType,w,C):null}evaluate(u){let y=this.index.evaluate(u),w=this.input.evaluate(u);if(y<0)throw new Ds(`Array index out of bounds: ${y} < 0.`);if(y>=w.length)throw new Ds(`Array index out of bounds: ${y} > ${w.length-1}.`);if(y!==Math.floor(y))throw new Ds(`Array index must be an integer, but found ${y} instead.`);return w[y]}eachChild(u){u(this.index),u(this.input)}outputDefined(){return!1}}class Sr{constructor(u,y){this.type=Lt,this.needle=u,this.haystack=y}static parse(u,y){if(u.length!==3)return y.error(`Expected 2 arguments, but found ${u.length-1} instead.`);let w=y.parse(u[1],1,Ke),C=y.parse(u[2],2,Ke);return w&&C?ke(w.type,[Lt,Nt,lt,ti,Ke])?new Sr(w,C):y.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ji(w.type)} instead`):null}evaluate(u){let y=this.needle.evaluate(u),w=this.haystack.evaluate(u);if(!w)return!1;if(!he(y,["boolean","string","number","null"]))throw new Ds(`Expected first argument to be of type boolean, string, number or null, but found ${Ji(Rs(y))} instead.`);if(!he(w,["string","array"]))throw new Ds(`Expected second argument to be of type array or string, but found ${Ji(Rs(w))} instead.`);return w.indexOf(y)>=0}eachChild(u){u(this.needle),u(this.haystack)}outputDefined(){return!0}}class P0{constructor(u,y,w){this.type=lt,this.needle=u,this.haystack=y,this.fromIndex=w}static parse(u,y){if(u.length<=2||u.length>=5)return y.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);let w=y.parse(u[1],1,Ke),C=y.parse(u[2],2,Ke);if(!w||!C)return null;if(!ke(w.type,[Lt,Nt,lt,ti,Ke]))return y.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ji(w.type)} instead`);if(u.length===4){let R=y.parse(u[3],3,lt);return R?new P0(w,C,R):null}return new P0(w,C)}evaluate(u){let y=this.needle.evaluate(u),w=this.haystack.evaluate(u);if(!he(y,["boolean","string","number","null"]))throw new Ds(`Expected first argument to be of type boolean, string, number or null, but found ${Ji(Rs(y))} instead.`);if(!he(w,["string","array"]))throw new Ds(`Expected second argument to be of type array or string, but found ${Ji(Rs(w))} instead.`);if(this.fromIndex){let C=this.fromIndex.evaluate(u);return w.indexOf(y,C)}return w.indexOf(y)}eachChild(u){u(this.needle),u(this.haystack),this.fromIndex&&u(this.fromIndex)}outputDefined(){return!1}}class _p{constructor(u,y,w,C,R,N){this.inputType=u,this.type=y,this.input=w,this.cases=C,this.outputs=R,this.otherwise=N}static parse(u,y){if(u.length<5)return y.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if(u.length%2!=1)return y.error("Expected an even number of arguments.");let w,C;y.expectedType&&y.expectedType.kind!=="value"&&(C=y.expectedType);let R={},N=[];for(let K=2;K<u.length-1;K+=2){let ae=u[K],ue=u[K+1];Array.isArray(ae)||(ae=[ae]);let pe=y.concat(K);if(ae.length===0)return pe.error("Expected at least one branch label.");for(let we of ae){if(typeof we!="number"&&typeof we!="string")return pe.error("Branch labels must be numbers or strings.");if(typeof we=="number"&&Math.abs(we)>Number.MAX_SAFE_INTEGER)return pe.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof we=="number"&&Math.floor(we)!==we)return pe.error("Numeric branch labels must be integer values.");if(w){if(pe.checkSubtype(w,Rs(we)))return null}else w=Rs(we);if(R[String(we)]!==void 0)return pe.error("Branch labels must be unique.");R[String(we)]=N.length}let ve=y.parse(ue,K,C);if(!ve)return null;C=C||ve.type,N.push(ve)}let G=y.parse(u[1],1,Ke);if(!G)return null;let X=y.parse(u[u.length-1],u.length-1,C);return X?G.type.kind!=="value"&&y.concat(1).checkSubtype(w,G.type)?null:new _p(w,C,G,R,N,X):null}evaluate(u){let y=this.input.evaluate(u);return(Rs(y)===this.inputType&&this.outputs[this.cases[y]]||this.otherwise).evaluate(u)}eachChild(u){u(this.input),this.outputs.forEach(u),u(this.otherwise)}outputDefined(){return this.outputs.every(u=>u.outputDefined())&&this.otherwise.outputDefined()}}class xp{constructor(u,y,w){this.type=u,this.branches=y,this.otherwise=w}static parse(u,y){if(u.length<4)return y.error(`Expected at least 3 arguments, but found only ${u.length-1}.`);if(u.length%2!=0)return y.error("Expected an odd number of arguments.");let w;y.expectedType&&y.expectedType.kind!=="value"&&(w=y.expectedType);let C=[];for(let N=1;N<u.length-1;N+=2){let G=y.parse(u[N],N,Lt);if(!G)return null;let X=y.parse(u[N+1],N+1,w);if(!X)return null;C.push([G,X]),w=w||X.type}let R=y.parse(u[u.length-1],u.length-1,w);if(!R)return null;if(!w)throw new Error("Can't infer output type");return new xp(w,C,R)}evaluate(u){for(let[y,w]of this.branches)if(y.evaluate(u))return w.evaluate(u);return this.otherwise.evaluate(u)}eachChild(u){for(let[y,w]of this.branches)u(y),u(w);u(this.otherwise)}outputDefined(){return this.branches.every(([u,y])=>y.outputDefined())&&this.otherwise.outputDefined()}}class R0{constructor(u,y,w,C){this.type=u,this.input=y,this.beginIndex=w,this.endIndex=C}static parse(u,y){if(u.length<=2||u.length>=5)return y.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);let w=y.parse(u[1],1,Ke),C=y.parse(u[2],2,lt);if(!w||!C)return null;if(!ke(w.type,[gr(Ke),Nt,Ke]))return y.error(`Expected first argument to be of type array or string, but found ${Ji(w.type)} instead`);if(u.length===4){let R=y.parse(u[3],3,lt);return R?new R0(w.type,w,C,R):null}return new R0(w.type,w,C)}evaluate(u){let y=this.input.evaluate(u),w=this.beginIndex.evaluate(u);if(!he(y,["string","array"]))throw new Ds(`Expected first argument to be of type array or string, but found ${Ji(Rs(y))} instead.`);if(this.endIndex){let C=this.endIndex.evaluate(u);return y.slice(w,C)}return y.slice(w)}eachChild(u){u(this.input),u(this.beginIndex),this.endIndex&&u(this.endIndex)}outputDefined(){return!1}}function M7(p,u){return p==="=="||p==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function P7(p,u,y,w){return w.compare(u,y)===0}function g1(p,u,y){let w=p!=="=="&&p!=="!=";return class qN{constructor(R,N,G){this.type=Lt,this.lhs=R,this.rhs=N,this.collator=G,this.hasUntypedArgument=R.type.kind==="value"||N.type.kind==="value"}static parse(R,N){if(R.length!==3&&R.length!==4)return N.error("Expected two or three arguments.");let G=R[0],X=N.parse(R[1],1,Ke);if(!X)return null;if(!M7(G,X.type))return N.concat(1).error(`"${G}" comparisons are not supported for type '${Ji(X.type)}'.`);let K=N.parse(R[2],2,Ke);if(!K)return null;if(!M7(G,K.type))return N.concat(2).error(`"${G}" comparisons are not supported for type '${Ji(K.type)}'.`);if(X.type.kind!==K.type.kind&&X.type.kind!=="value"&&K.type.kind!=="value")return N.error(`Cannot compare types '${Ji(X.type)}' and '${Ji(K.type)}'.`);w&&(X.type.kind==="value"&&K.type.kind!=="value"?X=new zn(K.type,[X]):X.type.kind!=="value"&&K.type.kind==="value"&&(K=new zn(X.type,[K])));let ae=null;if(R.length===4){if(X.type.kind!=="string"&&K.type.kind!=="string"&&X.type.kind!=="value"&&K.type.kind!=="value")return N.error("Cannot use collator to compare non-string types.");if(ae=N.parse(R[3],3,dt),!ae)return null}return new qN(X,K,ae)}evaluate(R){let N=this.lhs.evaluate(R),G=this.rhs.evaluate(R);if(w&&this.hasUntypedArgument){let X=Rs(N),K=Rs(G);if(X.kind!==K.kind||X.kind!=="string"&&X.kind!=="number")throw new Ds(`Expected arguments for "${p}" to be (string, string) or (number, number), but found (${X.kind}, ${K.kind}) instead.`)}if(this.collator&&!w&&this.hasUntypedArgument){let X=Rs(N),K=Rs(G);if(X.kind!=="string"||K.kind!=="string")return u(R,N,G)}return this.collator?y(R,N,G,this.collator.evaluate(R)):u(R,N,G)}eachChild(R){R(this.lhs),R(this.rhs),this.collator&&R(this.collator)}outputDefined(){return!0}}}let dv=g1("==",function(p,u,y){return u===y},P7),fv=g1("!=",function(p,u,y){return u!==y},function(p,u,y,w){return!P7(0,u,y,w)}),pv=g1("<",function(p,u,y){return u<y},function(p,u,y,w){return w.compare(u,y)<0}),mv=g1(">",function(p,u,y){return u>y},function(p,u,y,w){return w.compare(u,y)>0}),gv=g1("<=",function(p,u,y){return u<=y},function(p,u,y,w){return w.compare(u,y)<=0}),yv=g1(">=",function(p,u,y){return u>=y},function(p,u,y,w){return w.compare(u,y)>=0});class vp{constructor(u,y,w,C,R){this.type=Nt,this.number=u,this.locale=y,this.currency=w,this.minFractionDigits=C,this.maxFractionDigits=R}static parse(u,y){if(u.length!==3)return y.error("Expected two arguments.");let w=y.parse(u[1],1,lt);if(!w)return null;let C=u[2];if(typeof C!="object"||Array.isArray(C))return y.error("NumberFormat options argument must be an object.");let R=null;if(C.locale&&(R=y.parse(C.locale,1,Nt),!R))return null;let N=null;if(C.currency&&(N=y.parse(C.currency,1,Nt),!N))return null;let G=null;if(C["min-fraction-digits"]&&(G=y.parse(C["min-fraction-digits"],1,lt),!G))return null;let X=null;return C["max-fraction-digits"]&&(X=y.parse(C["max-fraction-digits"],1,lt),!X)?null:new vp(w,R,N,G,X)}evaluate(u){return new Intl.NumberFormat(this.locale?this.locale.evaluate(u):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(u):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(u):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(u):void 0}).format(this.number.evaluate(u))}eachChild(u){u(this.number),this.locale&&u(this.locale),this.currency&&u(this.currency),this.minFractionDigits&&u(this.minFractionDigits),this.maxFractionDigits&&u(this.maxFractionDigits)}outputDefined(){return!1}}class D0{constructor(u){this.type=kt,this.sections=u}static parse(u,y){if(u.length<2)return y.error("Expected at least one argument.");let w=u[1];if(!Array.isArray(w)&&typeof w=="object")return y.error("First argument must be an image or text section.");let C=[],R=!1;for(let N=1;N<=u.length-1;++N){let G=u[N];if(R&&typeof G=="object"&&!Array.isArray(G)){R=!1;let X=null;if(G["font-scale"]&&(X=y.parse(G["font-scale"],1,lt),!X))return null;let K=null;if(G["text-font"]&&(K=y.parse(G["text-font"],1,gr(Nt)),!K))return null;let ae=null;if(G["text-color"]&&(ae=y.parse(G["text-color"],1,qi),!ae))return null;let ue=C[C.length-1];ue.scale=X,ue.font=K,ue.textColor=ae}else{let X=y.parse(u[N],1,Ke);if(!X)return null;let K=X.type.kind;if(K!=="string"&&K!=="value"&&K!=="null"&&K!=="resolvedImage")return y.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");R=!0,C.push({content:X,scale:null,font:null,textColor:null})}}return new D0(C)}evaluate(u){return new Ps(this.sections.map(y=>{let w=y.content.evaluate(u);return Rs(w)===Qt?new Pn("",w,null,null,null):new Pn(xc(w),null,y.scale?y.scale.evaluate(u):null,y.font?y.font.evaluate(u).join(","):null,y.textColor?y.textColor.evaluate(u):null)}))}eachChild(u){for(let y of this.sections)u(y.content),y.scale&&u(y.scale),y.font&&u(y.font),y.textColor&&u(y.textColor)}outputDefined(){return!1}}class bp{constructor(u){this.type=Qt,this.input=u}static parse(u,y){if(u.length!==2)return y.error("Expected two arguments.");let w=y.parse(u[1],1,Nt);return w?new bp(w):y.error("No image name provided.")}evaluate(u){let y=this.input.evaluate(u),w=la.fromString(y);return w&&u.availableImages&&(w.available=u.availableImages.indexOf(y)>-1),w}eachChild(u){u(this.input)}outputDefined(){return!1}}class wp{constructor(u){this.type=lt,this.input=u}static parse(u,y){if(u.length!==2)return y.error(`Expected 1 argument, but found ${u.length-1} instead.`);let w=y.parse(u[1],1);return w?w.type.kind!=="array"&&w.type.kind!=="string"&&w.type.kind!=="value"?y.error(`Expected argument of type string or array, but found ${Ji(w.type)} instead.`):new wp(w):null}evaluate(u){let y=this.input.evaluate(u);if(typeof y=="string"||Array.isArray(y))return y.length;throw new Ds(`Expected value to be of type string or array, but found ${Ji(Rs(y))} instead.`)}eachChild(u){u(this.input)}outputDefined(){return!1}}let y1={"==":dv,"!=":fv,">":mv,"<":pv,">=":yv,"<=":gv,array:zn,at:m1,boolean:zn,case:xp,coalesce:M0,collator:f1,format:D0,image:bp,in:Sr,"index-of":P0,interpolate:Mo,"interpolate-hcl":Mo,"interpolate-lab":Mo,length:wp,let:p1,literal:nu,match:_p,number:zn,"number-format":vp,object:zn,slice:R0,step:Nh,string:zn,"to-boolean":cl,"to-color":cl,"to-number":cl,"to-string":cl,var:C0,within:ou};function R7(p,[u,y,w,C]){u=u.evaluate(p),y=y.evaluate(p),w=w.evaluate(p);let R=C?C.evaluate(p):1,N=w7(u,y,w,R);if(N)throw new Ds(N);return new Fi(u/255,y/255,w/255,R,!1)}function D7(p,u){return p in u}function Ep(p,u){let y=u[p];return y===void 0?null:y}function lu(p){return{type:p}}function F7(p){return{result:"success",value:p}}function _1(p){return{result:"error",value:p}}function x1(p){return p["property-type"]==="data-driven"||p["property-type"]==="cross-faded-data-driven"}function L7(p){return!!p.expression&&p.expression.parameters.indexOf("zoom")>-1}function Tp(p){return!!p.expression&&p.expression.interpolated}function Pr(p){return p instanceof Number?"number":p instanceof String?"string":p instanceof Boolean?"boolean":Array.isArray(p)?"array":p===null?"null":typeof p}function F0(p){return typeof p=="object"&&p!==null&&!Array.isArray(p)}function _v(p){return p}function N7(p,u){let y=u.type==="color",w=p.stops&&typeof p.stops[0][0]=="object",C=w||!(w||p.property!==void 0),R=p.type||(Tp(u)?"exponential":"interval");if(y||u.type==="padding"){let ae=y?Fi.parse:Co.parse;(p=rt({},p)).stops&&(p.stops=p.stops.map(ue=>[ue[0],ae(ue[1])])),p.default=ae(p.default?p.default:u.default)}if(p.colorSpace&&(N=p.colorSpace)!=="rgb"&&N!=="hcl"&&N!=="lab")throw new Error(`Unknown color space: "${p.colorSpace}"`);var N;let G,X,K;if(R==="exponential")G=O7;else if(R==="interval")G=vv;else if(R==="categorical"){G=xv,X=Object.create(null);for(let ae of p.stops)X[ae[0]]=ae[1];K=typeof p.stops[0][0]}else{if(R!=="identity")throw new Error(`Unknown function type "${R}"`);G=bv}if(w){let ae={},ue=[];for(let we=0;we<p.stops.length;we++){let Ie=p.stops[we],Le=Ie[0].zoom;ae[Le]===void 0&&(ae[Le]={zoom:Le,type:p.type,property:p.property,default:p.default,stops:[]},ue.push(Le)),ae[Le].stops.push([Ie[0].value,Ie[1]])}let pe=[];for(let we of ue)pe.push([ae[we].zoom,N7(ae[we],u)]);let ve={name:"linear"};return{kind:"composite",interpolationType:ve,interpolationFactor:Mo.interpolationFactor.bind(void 0,ve),zoomStops:pe.map(we=>we[0]),evaluate:({zoom:we},Ie)=>O7({stops:pe,base:p.base},u,we).evaluate(we,Ie)}}if(C){let ae=R==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:ae,interpolationFactor:Mo.interpolationFactor.bind(void 0,ae),zoomStops:p.stops.map(ue=>ue[0]),evaluate:({zoom:ue})=>G(p,u,ue,X,K)}}return{kind:"source",evaluate(ae,ue){let pe=ue&&ue.properties?ue.properties[p.property]:void 0;return pe===void 0?cu(p.default,u.default):G(p,u,pe,X,K)}}}function cu(p,u,y){return p!==void 0?p:u!==void 0?u:y!==void 0?y:void 0}function xv(p,u,y,w,C){return cu(typeof y===C?w[y]:void 0,p.default,u.default)}function vv(p,u,y){if(Pr(y)!=="number")return cu(p.default,u.default);let w=p.stops.length;if(w===1||y<=p.stops[0][0])return p.stops[0][1];if(y>=p.stops[w-1][0])return p.stops[w-1][1];let C=Lh(p.stops.map(R=>R[0]),y);return p.stops[C][1]}function O7(p,u,y){let w=p.base!==void 0?p.base:1;if(Pr(y)!=="number")return cu(p.default,u.default);let C=p.stops.length;if(C===1||y<=p.stops[0][0])return p.stops[0][1];if(y>=p.stops[C-1][0])return p.stops[C-1][1];let R=Lh(p.stops.map(ae=>ae[0]),y),N=function(ae,ue,pe,ve){let we=ve-pe,Ie=ae-pe;return we===0?0:ue===1?Ie/we:(Math.pow(ue,Ie)-1)/(Math.pow(ue,we)-1)}(y,w,p.stops[R][0],p.stops[R+1][0]),G=p.stops[R][1],X=p.stops[R+1][1],K=ko[u.type]||_v;return typeof G.evaluate=="function"?{evaluate(...ae){let ue=G.evaluate.apply(void 0,ae),pe=X.evaluate.apply(void 0,ae);if(ue!==void 0&&pe!==void 0)return K(ue,pe,N,p.colorSpace)}}:K(G,X,N,p.colorSpace)}function bv(p,u,y){switch(u.type){case"color":y=Fi.parse(y);break;case"formatted":y=Ps.fromString(y.toString());break;case"resolvedImage":y=la.fromString(y.toString());break;case"padding":y=Co.parse(y);break;default:Pr(y)===u.type||u.type==="enum"&&u.values[y]||(y=void 0)}return cu(y,p.default,u.default)}Io.register(y1,{error:[{kind:"error"},[Nt],(p,[u])=>{throw new Ds(u.evaluate(p))}],typeof:[Nt,[Ke],(p,[u])=>Ji(Rs(u.evaluate(p)))],"to-rgba":[gr(lt,4),[qi],(p,[u])=>{let[y,w,C,R]=u.evaluate(p).rgb;return[255*y,255*w,255*C,R]}],rgb:[qi,[lt,lt,lt],R7],rgba:[qi,[lt,lt,lt,lt],R7],has:{type:Lt,overloads:[[[Nt],(p,[u])=>D7(u.evaluate(p),p.properties())],[[Nt,Vi],(p,[u,y])=>D7(u.evaluate(p),y.evaluate(p))]]},get:{type:Ke,overloads:[[[Nt],(p,[u])=>Ep(u.evaluate(p),p.properties())],[[Nt,Vi],(p,[u,y])=>Ep(u.evaluate(p),y.evaluate(p))]]},"feature-state":[Ke,[Nt],(p,[u])=>Ep(u.evaluate(p),p.featureState||{})],properties:[Vi,[],p=>p.properties()],"geometry-type":[Nt,[],p=>p.geometryType()],id:[Ke,[],p=>p.id()],zoom:[lt,[],p=>p.globals.zoom],"heatmap-density":[lt,[],p=>p.globals.heatmapDensity||0],"line-progress":[lt,[],p=>p.globals.lineProgress||0],accumulated:[Ke,[],p=>p.globals.accumulated===void 0?null:p.globals.accumulated],"+":[lt,lu(lt),(p,u)=>{let y=0;for(let w of u)y+=w.evaluate(p);return y}],"*":[lt,lu(lt),(p,u)=>{let y=1;for(let w of u)y*=w.evaluate(p);return y}],"-":{type:lt,overloads:[[[lt,lt],(p,[u,y])=>u.evaluate(p)-y.evaluate(p)],[[lt],(p,[u])=>-u.evaluate(p)]]},"/":[lt,[lt,lt],(p,[u,y])=>u.evaluate(p)/y.evaluate(p)],"%":[lt,[lt,lt],(p,[u,y])=>u.evaluate(p)%y.evaluate(p)],ln2:[lt,[],()=>Math.LN2],pi:[lt,[],()=>Math.PI],e:[lt,[],()=>Math.E],"^":[lt,[lt,lt],(p,[u,y])=>Math.pow(u.evaluate(p),y.evaluate(p))],sqrt:[lt,[lt],(p,[u])=>Math.sqrt(u.evaluate(p))],log10:[lt,[lt],(p,[u])=>Math.log(u.evaluate(p))/Math.LN10],ln:[lt,[lt],(p,[u])=>Math.log(u.evaluate(p))],log2:[lt,[lt],(p,[u])=>Math.log(u.evaluate(p))/Math.LN2],sin:[lt,[lt],(p,[u])=>Math.sin(u.evaluate(p))],cos:[lt,[lt],(p,[u])=>Math.cos(u.evaluate(p))],tan:[lt,[lt],(p,[u])=>Math.tan(u.evaluate(p))],asin:[lt,[lt],(p,[u])=>Math.asin(u.evaluate(p))],acos:[lt,[lt],(p,[u])=>Math.acos(u.evaluate(p))],atan:[lt,[lt],(p,[u])=>Math.atan(u.evaluate(p))],min:[lt,lu(lt),(p,u)=>Math.min(...u.map(y=>y.evaluate(p)))],max:[lt,lu(lt),(p,u)=>Math.max(...u.map(y=>y.evaluate(p)))],abs:[lt,[lt],(p,[u])=>Math.abs(u.evaluate(p))],round:[lt,[lt],(p,[u])=>{let y=u.evaluate(p);return y<0?-Math.round(-y):Math.round(y)}],floor:[lt,[lt],(p,[u])=>Math.floor(u.evaluate(p))],ceil:[lt,[lt],(p,[u])=>Math.ceil(u.evaluate(p))],"filter-==":[Lt,[Nt,Ke],(p,[u,y])=>p.properties()[u.value]===y.value],"filter-id-==":[Lt,[Ke],(p,[u])=>p.id()===u.value],"filter-type-==":[Lt,[Nt],(p,[u])=>p.geometryType()===u.value],"filter-<":[Lt,[Nt,Ke],(p,[u,y])=>{let w=p.properties()[u.value],C=y.value;return typeof w==typeof C&&w<C}],"filter-id-<":[Lt,[Ke],(p,[u])=>{let y=p.id(),w=u.value;return typeof y==typeof w&&y<w}],"filter->":[Lt,[Nt,Ke],(p,[u,y])=>{let w=p.properties()[u.value],C=y.value;return typeof w==typeof C&&w>C}],"filter-id->":[Lt,[Ke],(p,[u])=>{let y=p.id(),w=u.value;return typeof y==typeof w&&y>w}],"filter-<=":[Lt,[Nt,Ke],(p,[u,y])=>{let w=p.properties()[u.value],C=y.value;return typeof w==typeof C&&w<=C}],"filter-id-<=":[Lt,[Ke],(p,[u])=>{let y=p.id(),w=u.value;return typeof y==typeof w&&y<=w}],"filter->=":[Lt,[Nt,Ke],(p,[u,y])=>{let w=p.properties()[u.value],C=y.value;return typeof w==typeof C&&w>=C}],"filter-id->=":[Lt,[Ke],(p,[u])=>{let y=p.id(),w=u.value;return typeof y==typeof w&&y>=w}],"filter-has":[Lt,[Ke],(p,[u])=>u.value in p.properties()],"filter-has-id":[Lt,[],p=>p.id()!==null&&p.id()!==void 0],"filter-type-in":[Lt,[gr(Nt)],(p,[u])=>u.value.indexOf(p.geometryType())>=0],"filter-id-in":[Lt,[gr(Ke)],(p,[u])=>u.value.indexOf(p.id())>=0],"filter-in-small":[Lt,[Nt,gr(Ke)],(p,[u,y])=>y.value.indexOf(p.properties()[u.value])>=0],"filter-in-large":[Lt,[Nt,gr(Ke)],(p,[u,y])=>function(w,C,R,N){for(;R<=N;){let G=R+N>>1;if(C[G]===w)return!0;C[G]>w?N=G-1:R=G+1}return!1}(p.properties()[u.value],y.value,0,y.value.length-1)],all:{type:Lt,overloads:[[[Lt,Lt],(p,[u,y])=>u.evaluate(p)&&y.evaluate(p)],[lu(Lt),(p,u)=>{for(let y of u)if(!y.evaluate(p))return!1;return!0}]]},any:{type:Lt,overloads:[[[Lt,Lt],(p,[u,y])=>u.evaluate(p)||y.evaluate(p)],[lu(Lt),(p,u)=>{for(let y of u)if(y.evaluate(p))return!0;return!1}]]},"!":[Lt,[Lt],(p,[u])=>!u.evaluate(p)],"is-supported-script":[Lt,[Nt],(p,[u])=>{let y=p.globals&&p.globals.isSupportedScript;return!y||y(u.evaluate(p))}],upcase:[Nt,[Nt],(p,[u])=>u.evaluate(p).toUpperCase()],downcase:[Nt,[Nt],(p,[u])=>u.evaluate(p).toLowerCase()],concat:[Nt,lu(Ke),(p,u)=>u.map(y=>xc(y.evaluate(p))).join("")],"resolved-locale":[Nt,[dt],(p,[u])=>u.evaluate(p).resolvedLocale()]});class _s{constructor(u,y){var w;this.expression=u,this._warningHistory={},this._evaluator=new Fr,this._defaultValue=y?(w=y).type==="color"&&F0(w.default)?new Fi(0,0,0,0):w.type==="color"?Fi.parse(w.default)||null:w.type==="padding"?Co.parse(w.default)||null:w.type==="variableAnchorOffsetCollection"?Un.parse(w.default)||null:w.default===void 0?null:w.default:null,this._enumValues=y&&y.type==="enum"?y.values:null}evaluateWithoutErrorHandling(u,y,w,C,R,N){return this._evaluator.globals=u,this._evaluator.feature=y,this._evaluator.featureState=w,this._evaluator.canonical=C,this._evaluator.availableImages=R||null,this._evaluator.formattedSection=N,this.expression.evaluate(this._evaluator)}evaluate(u,y,w,C,R,N){this._evaluator.globals=u,this._evaluator.feature=y||null,this._evaluator.featureState=w||null,this._evaluator.canonical=C,this._evaluator.availableImages=R||null,this._evaluator.formattedSection=N||null;try{let G=this.expression.evaluate(this._evaluator);if(G==null||typeof G=="number"&&G!=G)return this._defaultValue;if(this._enumValues&&!(G in this._enumValues))throw new Ds(`Expected value to be one of ${Object.keys(this._enumValues).map(X=>JSON.stringify(X)).join(", ")}, but found ${JSON.stringify(G)} instead.`);return G}catch(G){return this._warningHistory[G.message]||(this._warningHistory[G.message]=!0,typeof console!="undefined"&&console.warn(G.message)),this._defaultValue}}}function L0(p){return Array.isArray(p)&&p.length>0&&typeof p[0]=="string"&&p[0]in y1}function hr(p,u){let y=new w0(y1,Rh,[],u?function(C){let R={color:qi,string:Nt,number:lt,enum:Nt,boolean:Lt,formatted:kt,padding:Zt,resolvedImage:Qt,variableAnchorOffsetCollection:Oi};return C.type==="array"?gr(R[C.value]||Ke,C.length):R[C.type]}(u):void 0),w=y.parse(p,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return w?F7(new _s(w,u)):_1(y.errors)}class Oh{constructor(u,y){this.kind=u,this._styleExpression=y,this.isStateDependent=u!=="constant"&&!Dh(y.expression)}evaluateWithoutErrorHandling(u,y,w,C,R,N){return this._styleExpression.evaluateWithoutErrorHandling(u,y,w,C,R,N)}evaluate(u,y,w,C,R,N){return this._styleExpression.evaluate(u,y,w,C,R,N)}}class Jr{constructor(u,y,w,C){this.kind=u,this.zoomStops=w,this._styleExpression=y,this.isStateDependent=u!=="camera"&&!Dh(y.expression),this.interpolationType=C}evaluateWithoutErrorHandling(u,y,w,C,R,N){return this._styleExpression.evaluateWithoutErrorHandling(u,y,w,C,R,N)}evaluate(u,y,w,C,R,N){return this._styleExpression.evaluate(u,y,w,C,R,N)}interpolationFactor(u,y,w){return this.interpolationType?Mo.interpolationFactor(this.interpolationType,u,y,w):0}}function es(p,u){let y=hr(p,u);if(y.result==="error")return y;let w=y.value.expression,C=I0(w);if(!C&&!x1(u))return _1([new ct("","data expressions not supported")]);let R=Fh(w,["zoom"]);if(!R&&!L7(u))return _1([new ct("","zoom expressions not supported")]);let N=Bh(w);return N||R?N instanceof ct?_1([N]):N instanceof Mo&&!Tp(u)?_1([new ct("",'"interpolate" expressions cannot be used with this property')]):F7(N?new Jr(C?"camera":"composite",y.value,N.labels,N instanceof Mo?N.interpolation:void 0):new Oh(C?"constant":"source",y.value)):_1([new ct("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class uu{constructor(u,y){this._parameters=u,this._specification=y,rt(this,N7(this._parameters,this._specification))}static deserialize(u){return new uu(u._parameters,u._specification)}static serialize(u){return{_parameters:u._parameters,_specification:u._specification}}}function Bh(p){let u=null;if(p instanceof p1)u=Bh(p.result);else if(p instanceof M0){for(let y of p.args)if(u=Bh(y),u)break}else(p instanceof Nh||p instanceof Mo)&&p.input instanceof Io&&p.input.name==="zoom"&&(u=p);return u instanceof ct||p.eachChild(y=>{let w=Bh(y);w instanceof ct?u=w:!u&&w?u=new ct("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):u&&w&&u!==w&&(u=new ct("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),u}function Sp(p){if(p===!0||p===!1)return!0;if(!Array.isArray(p)||p.length===0)return!1;switch(p[0]){case"has":return p.length>=2&&p[1]!=="$id"&&p[1]!=="$type";case"in":return p.length>=3&&(typeof p[1]!="string"||Array.isArray(p[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return p.length!==3||Array.isArray(p[1])||Array.isArray(p[2]);case"any":case"all":for(let u of p.slice(1))if(!Sp(u)&&typeof u!="boolean")return!1;return!0;default:return!0}}let wv={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ap(p){if(p==null)return{filter:()=>!0,needGeometry:!1};Sp(p)||(p=Uh(p));let u=hr(p,wv);if(u.result==="error")throw new Error(u.value.map(y=>`${y.key}: ${y.message}`).join(", "));return{filter:(y,w,C)=>u.value.evaluate(y,w,{},C),needGeometry:Cp(p)}}function Ev(p,u){return p<u?-1:p>u?1:0}function Cp(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(let u=1;u<p.length;u++)if(Cp(p[u]))return!0;return!1}function Uh(p){if(!p)return!0;let u=p[0];return p.length<=1?u!=="any":u==="=="?N0(p[1],p[2],"=="):u==="!="?B0(N0(p[1],p[2],"==")):u==="<"||u===">"||u==="<="||u===">="?N0(p[1],p[2],u):u==="any"?(y=p.slice(1),["any"].concat(y.map(Uh))):u==="all"?["all"].concat(p.slice(1).map(Uh)):u==="none"?["all"].concat(p.slice(1).map(Uh).map(B0)):u==="in"?Ip(p[1],p.slice(2)):u==="!in"?B0(Ip(p[1],p.slice(2))):u==="has"?O0(p[1]):u==="!has"?B0(O0(p[1])):u!=="within"||p;var y}function N0(p,u,y){switch(p){case"$type":return[`filter-type-${y}`,u];case"$id":return[`filter-id-${y}`,u];default:return[`filter-${y}`,p,u]}}function Ip(p,u){if(u.length===0)return!1;switch(p){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(y=>typeof y!=typeof u[0])?["filter-in-large",p,["literal",u.sort(Ev)]]:["filter-in-small",p,["literal",u]]}}function O0(p){switch(p){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",p]}}function B0(p){return["!",p]}function kp(p){let u=typeof p;if(u==="number"||u==="boolean"||u==="string"||p==null)return JSON.stringify(p);if(Array.isArray(p)){let C="[";for(let R of p)C+=`${kp(R)},`;return`${C}]`}let y=Object.keys(p).sort(),w="{";for(let C=0;C<y.length;C++)w+=`${JSON.stringify(y[C])}:${kp(p[y[C]])},`;return`${w}}`}function Tv(p){let u="";for(let y of Ze)u+=`/${kp(p[y])}`;return u}function B7(p){let u=p.value;return u?[new De(p.key,u,"constants have been deprecated as of v8")]:[]}function Fs(p){return p instanceof Number||p instanceof String||p instanceof Boolean?p.valueOf():p}function hu(p){if(Array.isArray(p))return p.map(hu);if(p instanceof Object&&!(p instanceof Number||p instanceof String||p instanceof Boolean)){let u={};for(let y in p)u[y]=hu(p[y]);return u}return Fs(p)}function ca(p){let u=p.key,y=p.value,w=p.valueSpec||{},C=p.objectElementValidators||{},R=p.style,N=p.styleSpec,G=p.validateSpec,X=[],K=Pr(y);if(K!=="object")return[new De(u,y,`object expected, ${K} found`)];for(let ae in y){let ue=ae.split(".")[0],pe=w[ue]||w["*"],ve;if(C[ue])ve=C[ue];else if(w[ue])ve=G;else if(C["*"])ve=C["*"];else{if(!w["*"]){X.push(new De(u,y[ae],`unknown property "${ae}"`));continue}ve=G}X=X.concat(ve({key:(u&&`${u}.`)+ae,value:y[ae],valueSpec:pe,style:R,styleSpec:N,object:y,objectKey:ae,validateSpec:G},y))}for(let ae in w)C[ae]||w[ae].required&&w[ae].default===void 0&&y[ae]===void 0&&X.push(new De(u,y,`missing required property "${ae}"`));return X}function Mp(p){let u=p.value,y=p.valueSpec,w=p.style,C=p.styleSpec,R=p.key,N=p.arrayElementValidator||p.validateSpec;if(Pr(u)!=="array")return[new De(R,u,`array expected, ${Pr(u)} found`)];if(y.length&&u.length!==y.length)return[new De(R,u,`array length ${y.length} expected, length ${u.length} found`)];if(y["min-length"]&&u.length<y["min-length"])return[new De(R,u,`array length at least ${y["min-length"]} expected, length ${u.length} found`)];let G={type:y.value,values:y.values};C.$version<7&&(G.function=y.function),Pr(y.value)==="object"&&(G=y.value);let X=[];for(let K=0;K<u.length;K++)X=X.concat(N({array:u,arrayIndex:K,value:u[K],valueSpec:G,validateSpec:p.validateSpec,style:w,styleSpec:C,key:`${R}[${K}]`}));return X}function U0(p){let u=p.key,y=p.value,w=p.valueSpec,C=Pr(y);return C==="number"&&y!=y&&(C="NaN"),C!=="number"?[new De(u,y,`number expected, ${C} found`)]:"minimum"in w&&y<w.minimum?[new De(u,y,`${y} is less than the minimum value ${w.minimum}`)]:"maximum"in w&&y>w.maximum?[new De(u,y,`${y} is greater than the maximum value ${w.maximum}`)]:[]}function Pp(p){let u=p.valueSpec,y=Fs(p.value.type),w,C,R,N={},G=y!=="categorical"&&p.value.property===void 0,X=!G,K=Pr(p.value.stops)==="array"&&Pr(p.value.stops[0])==="array"&&Pr(p.value.stops[0][0])==="object",ae=ca({key:p.key,value:p.value,valueSpec:p.styleSpec.function,validateSpec:p.validateSpec,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(ve){if(y==="identity")return[new De(ve.key,ve.value,'identity function may not have a "stops" property')];let we=[],Ie=ve.value;return we=we.concat(Mp({key:ve.key,value:Ie,valueSpec:ve.valueSpec,validateSpec:ve.validateSpec,style:ve.style,styleSpec:ve.styleSpec,arrayElementValidator:ue})),Pr(Ie)==="array"&&Ie.length===0&&we.push(new De(ve.key,Ie,"array must have at least one stop")),we},default:function(ve){return ve.validateSpec({key:ve.key,value:ve.value,valueSpec:u,validateSpec:ve.validateSpec,style:ve.style,styleSpec:ve.styleSpec})}}});return y==="identity"&&G&&ae.push(new De(p.key,p.value,'missing required property "property"')),y==="identity"||p.value.stops||ae.push(new De(p.key,p.value,'missing required property "stops"')),y==="exponential"&&p.valueSpec.expression&&!Tp(p.valueSpec)&&ae.push(new De(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(X&&!x1(p.valueSpec)?ae.push(new De(p.key,p.value,"property functions not supported")):G&&!L7(p.valueSpec)&&ae.push(new De(p.key,p.value,"zoom functions not supported"))),y!=="categorical"&&!K||p.value.property!==void 0||ae.push(new De(p.key,p.value,'"property" property is required')),ae;function ue(ve){let we=[],Ie=ve.value,Le=ve.key;if(Pr(Ie)!=="array")return[new De(Le,Ie,`array expected, ${Pr(Ie)} found`)];if(Ie.length!==2)return[new De(Le,Ie,`array length 2 expected, length ${Ie.length} found`)];if(K){if(Pr(Ie[0])!=="object")return[new De(Le,Ie,`object expected, ${Pr(Ie[0])} found`)];if(Ie[0].zoom===void 0)return[new De(Le,Ie,"object stop key must have zoom")];if(Ie[0].value===void 0)return[new De(Le,Ie,"object stop key must have value")];if(R&&R>Fs(Ie[0].zoom))return[new De(Le,Ie[0].zoom,"stop zoom values must appear in ascending order")];Fs(Ie[0].zoom)!==R&&(R=Fs(Ie[0].zoom),C=void 0,N={}),we=we.concat(ca({key:`${Le}[0]`,value:Ie[0],valueSpec:{zoom:{}},validateSpec:ve.validateSpec,style:ve.style,styleSpec:ve.styleSpec,objectElementValidators:{zoom:U0,value:pe}}))}else we=we.concat(pe({key:`${Le}[0]`,value:Ie[0],valueSpec:{},validateSpec:ve.validateSpec,style:ve.style,styleSpec:ve.styleSpec},Ie));return L0(hu(Ie[1]))?we.concat([new De(`${Le}[1]`,Ie[1],"expressions are not allowed in function stops.")]):we.concat(ve.validateSpec({key:`${Le}[1]`,value:Ie[1],valueSpec:u,validateSpec:ve.validateSpec,style:ve.style,styleSpec:ve.styleSpec}))}function pe(ve,we){let Ie=Pr(ve.value),Le=Fs(ve.value),Be=ve.value!==null?ve.value:we;if(w){if(Ie!==w)return[new De(ve.key,Be,`${Ie} stop domain type must match previous stop domain type ${w}`)]}else w=Ie;if(Ie!=="number"&&Ie!=="string"&&Ie!=="boolean")return[new De(ve.key,Be,"stop domain value must be a number, string, or boolean")];if(Ie!=="number"&&y!=="categorical"){let qe=`number expected, ${Ie} found`;return x1(u)&&y===void 0&&(qe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new De(ve.key,Be,qe)]}return y!=="categorical"||Ie!=="number"||isFinite(Le)&&Math.floor(Le)===Le?y!=="categorical"&&Ie==="number"&&C!==void 0&&Le<C?[new De(ve.key,Be,"stop domain values must appear in ascending order")]:(C=Le,y==="categorical"&&Le in N?[new De(ve.key,Be,"stop domain values must be unique")]:(N[Le]=!0,[])):[new De(ve.key,Be,`integer expected, found ${Le}`)]}}function Nl(p){let u=(p.expressionContext==="property"?es:hr)(hu(p.value),p.valueSpec);if(u.result==="error")return u.value.map(w=>new De(`${p.key}${w.key}`,p.value,w.message));let y=u.value.expression||u.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!y.outputDefined())return[new De(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!Dh(y))return[new De(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter"&&!Dh(y))return[new De(p.key,p.value,'"feature-state" data expressions are not supported with filters.')];if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!Fh(y,["zoom","feature-state"]))return[new De(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!I0(y))return[new De(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function zh(p){let u=p.key,y=p.value,w=p.valueSpec,C=[];return Array.isArray(w.values)?w.values.indexOf(Fs(y))===-1&&C.push(new De(u,y,`expected one of [${w.values.join(", ")}], ${JSON.stringify(y)} found`)):Object.keys(w.values).indexOf(Fs(y))===-1&&C.push(new De(u,y,`expected one of [${Object.keys(w.values).join(", ")}], ${JSON.stringify(y)} found`)),C}function z0(p){return Sp(hu(p.value))?Nl(rt({},p,{expressionContext:"filter",valueSpec:{value:"boolean"}})):U7(p)}function U7(p){let u=p.value,y=p.key;if(Pr(u)!=="array")return[new De(y,u,`array expected, ${Pr(u)} found`)];let w=p.styleSpec,C,R=[];if(u.length<1)return[new De(y,u,"filter array must have at least 1 element")];switch(R=R.concat(zh({key:`${y}[0]`,value:u[0],valueSpec:w.filter_operator,style:p.style,styleSpec:p.styleSpec})),Fs(u[0])){case"<":case"<=":case">":case">=":u.length>=2&&Fs(u[1])==="$type"&&R.push(new De(y,u,`"$type" cannot be use with operator "${u[0]}"`));case"==":case"!=":u.length!==3&&R.push(new De(y,u,`filter array for operator "${u[0]}" must have 3 elements`));case"in":case"!in":u.length>=2&&(C=Pr(u[1]),C!=="string"&&R.push(new De(`${y}[1]`,u[1],`string expected, ${C} found`)));for(let N=2;N<u.length;N++)C=Pr(u[N]),Fs(u[1])==="$type"?R=R.concat(zh({key:`${y}[${N}]`,value:u[N],valueSpec:w.geometry_type,style:p.style,styleSpec:p.styleSpec})):C!=="string"&&C!=="number"&&C!=="boolean"&&R.push(new De(`${y}[${N}]`,u[N],`string, number, or boolean expected, ${C} found`));break;case"any":case"all":case"none":for(let N=1;N<u.length;N++)R=R.concat(U7({key:`${y}[${N}]`,value:u[N],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":C=Pr(u[1]),u.length!==2?R.push(new De(y,u,`filter array for "${u[0]}" operator must have 2 elements`)):C!=="string"&&R.push(new De(`${y}[1]`,u[1],`string expected, ${C} found`));break;case"within":C=Pr(u[1]),u.length!==2?R.push(new De(y,u,`filter array for "${u[0]}" operator must have 2 elements`)):C!=="object"&&R.push(new De(`${y}[1]`,u[1],`object expected, ${C} found`))}return R}function G0(p,u){let y=p.key,w=p.validateSpec,C=p.style,R=p.styleSpec,N=p.value,G=p.objectKey,X=R[`${u}_${p.layerType}`];if(!X)return[];let K=G.match(/^(.*)-transition$/);if(u==="paint"&&K&&X[K[1]]&&X[K[1]].transition)return w({key:y,value:N,valueSpec:R.transition,style:C,styleSpec:R});let ae=p.valueSpec||X[G];if(!ae)return[new De(y,N,`unknown property "${G}"`)];let ue;if(Pr(N)==="string"&&x1(ae)&&!ae.tokens&&(ue=/^{([^}]+)}$/.exec(N)))return[new De(y,N,`"${G}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(ue[1])} }\`.`)];let pe=[];return p.layerType==="symbol"&&(G==="text-field"&&C&&!C.glyphs&&pe.push(new De(y,N,'use of "text-field" requires a style "glyphs" property')),G==="text-font"&&F0(hu(N))&&Fs(N.type)==="identity"&&pe.push(new De(y,N,'"text-font" does not support identity functions'))),pe.concat(w({key:p.key,value:N,valueSpec:ae,style:C,styleSpec:R,expressionContext:"property",propertyType:u,propertyKey:G}))}function Gh(p){return G0(p,"paint")}function $0(p){return G0(p,"layout")}function H0(p){let u=[],y=p.value,w=p.key,C=p.style,R=p.styleSpec;y.type||y.ref||u.push(new De(w,y,'either "type" or "ref" is required'));let N=Fs(y.type),G=Fs(y.ref);if(y.id){let X=Fs(y.id);for(let K=0;K<p.arrayIndex;K++){let ae=C.layers[K];Fs(ae.id)===X&&u.push(new De(w,y.id,`duplicate layer id "${y.id}", previously used at line ${ae.id.__line__}`))}}if("ref"in y){let X;["type","source","source-layer","filter","layout"].forEach(K=>{K in y&&u.push(new De(w,y[K],`"${K}" is prohibited for ref layers`))}),C.layers.forEach(K=>{Fs(K.id)===G&&(X=K)}),X?X.ref?u.push(new De(w,y.ref,"ref cannot reference another ref layer")):N=Fs(X.type):u.push(new De(w,y.ref,`ref layer "${G}" not found`))}else if(N!=="background")if(y.source){let X=C.sources&&C.sources[y.source],K=X&&Fs(X.type);X?K==="vector"&&N==="raster"?u.push(new De(w,y.source,`layer "${y.id}" requires a raster source`)):K==="raster"&&N!=="raster"?u.push(new De(w,y.source,`layer "${y.id}" requires a vector source`)):K!=="vector"||y["source-layer"]?K==="raster-dem"&&N!=="hillshade"?u.push(new De(w,y.source,"raster-dem source can only be used with layer type 'hillshade'.")):N!=="line"||!y.paint||!y.paint["line-gradient"]||K==="geojson"&&X.lineMetrics||u.push(new De(w,y,`layer "${y.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):u.push(new De(w,y,`layer "${y.id}" must specify a "source-layer"`)):u.push(new De(w,y.source,`source "${y.source}" not found`))}else u.push(new De(w,y,'missing required property "source"'));return u=u.concat(ca({key:w,value:y,valueSpec:R.layer,style:p.style,styleSpec:p.styleSpec,validateSpec:p.validateSpec,objectElementValidators:{"*":()=>[],type:()=>p.validateSpec({key:`${w}.type`,value:y.type,valueSpec:R.layer.type,style:p.style,styleSpec:p.styleSpec,validateSpec:p.validateSpec,object:y,objectKey:"type"}),filter:z0,layout:X=>ca({layer:y,key:X.key,value:X.value,style:X.style,styleSpec:X.styleSpec,validateSpec:X.validateSpec,objectElementValidators:{"*":K=>$0(rt({layerType:N},K))}}),paint:X=>ca({layer:y,key:X.key,value:X.value,style:X.style,styleSpec:X.styleSpec,validateSpec:X.validateSpec,objectElementValidators:{"*":K=>Gh(rt({layerType:N},K))}})}})),u}function du(p){let u=p.value,y=p.key,w=Pr(u);return w!=="string"?[new De(y,u,`string expected, ${w} found`)]:[]}let $h={promoteId:function({key:p,value:u}){if(Pr(u)==="string")return du({key:p,value:u});{let y=[];for(let w in u)y.push(...du({key:`${p}.${w}`,value:u[w]}));return y}}};function z7(p){let u=p.value,y=p.key,w=p.styleSpec,C=p.style,R=p.validateSpec;if(!u.type)return[new De(y,u,'"type" is required')];let N=Fs(u.type),G;switch(N){case"vector":case"raster":case"raster-dem":return G=ca({key:y,value:u,valueSpec:w[`source_${N.replace("-","_")}`],style:p.style,styleSpec:w,objectElementValidators:$h,validateSpec:R}),G;case"geojson":if(G=ca({key:y,value:u,valueSpec:w.source_geojson,style:C,styleSpec:w,validateSpec:R,objectElementValidators:$h}),u.cluster)for(let X in u.clusterProperties){let[K,ae]=u.clusterProperties[X],ue=typeof K=="string"?[K,["accumulated"],["get",X]]:K;G.push(...Nl({key:`${y}.${X}.map`,value:ae,validateSpec:R,expressionContext:"cluster-map"})),G.push(...Nl({key:`${y}.${X}.reduce`,value:ue,validateSpec:R,expressionContext:"cluster-reduce"}))}return G;case"video":return ca({key:y,value:u,valueSpec:w.source_video,style:C,validateSpec:R,styleSpec:w});case"image":return ca({key:y,value:u,valueSpec:w.source_image,style:C,validateSpec:R,styleSpec:w});case"canvas":return[new De(y,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return zh({key:`${y}.type`,value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:C,validateSpec:R,styleSpec:w})}}function G7(p){let u=p.value,y=p.styleSpec,w=y.light,C=p.style,R=[],N=Pr(u);if(u===void 0)return R;if(N!=="object")return R=R.concat([new De("light",u,`object expected, ${N} found`)]),R;for(let G in u){let X=G.match(/^(.*)-transition$/);R=R.concat(X&&w[X[1]]&&w[X[1]].transition?p.validateSpec({key:G,value:u[G],valueSpec:y.transition,validateSpec:p.validateSpec,style:C,styleSpec:y}):w[G]?p.validateSpec({key:G,value:u[G],valueSpec:w[G],validateSpec:p.validateSpec,style:C,styleSpec:y}):[new De(G,u[G],`unknown property "${G}"`)])}return R}function $7(p){let u=p.value,y=p.styleSpec,w=y.terrain,C=p.style,R=[],N=Pr(u);if(u===void 0)return R;if(N!=="object")return R=R.concat([new De("terrain",u,`object expected, ${N} found`)]),R;for(let G in u)R=R.concat(w[G]?p.validateSpec({key:G,value:u[G],valueSpec:w[G],validateSpec:p.validateSpec,style:C,styleSpec:y}):[new De(G,u[G],`unknown property "${G}"`)]);return R}function H7(p){let u=[],y=p.value,w=p.key;if(Array.isArray(y)){let C=[],R=[];for(let N in y)y[N].id&&C.includes(y[N].id)&&u.push(new De(w,y,`all the sprites' ids must be unique, but ${y[N].id} is duplicated`)),C.push(y[N].id),y[N].url&&R.includes(y[N].url)&&u.push(new De(w,y,`all the sprites' URLs must be unique, but ${y[N].url} is duplicated`)),R.push(y[N].url),u=u.concat(ca({key:`${w}[${N}]`,value:y[N],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:p.validateSpec}));return u}return du({key:w,value:y})}let V7={"*":()=>[],array:Mp,boolean:function(p){let u=p.value,y=p.key,w=Pr(u);return w!=="boolean"?[new De(y,u,`boolean expected, ${w} found`)]:[]},number:U0,color:function(p){let u=p.key,y=p.value,w=Pr(y);return w!=="string"?[new De(u,y,`color expected, ${w} found`)]:Fi.parse(String(y))?[]:[new De(u,y,`color expected, "${y}" found`)]},constants:B7,enum:zh,filter:z0,function:Pp,layer:H0,object:ca,source:z7,light:G7,terrain:$7,string:du,formatted:function(p){return du(p).length===0?[]:Nl(p)},resolvedImage:function(p){return du(p).length===0?[]:Nl(p)},padding:function(p){let u=p.key,y=p.value;if(Pr(y)==="array"){if(y.length<1||y.length>4)return[new De(u,y,`padding requires 1 to 4 values; ${y.length} values found`)];let w={type:"number"},C=[];for(let R=0;R<y.length;R++)C=C.concat(p.validateSpec({key:`${u}[${R}]`,value:y[R],validateSpec:p.validateSpec,valueSpec:w}));return C}return U0({key:u,value:y,valueSpec:{}})},variableAnchorOffsetCollection:function(p){let u=p.key,y=p.value,w=Pr(y),C=p.styleSpec;if(w!=="array"||y.length<1||y.length%2!=0)return[new De(u,y,"variableAnchorOffsetCollection requires a non-empty array of even length")];let R=[];for(let N=0;N<y.length;N+=2)R=R.concat(zh({key:`${u}[${N}]`,value:y[N],valueSpec:C.layout_symbol["text-anchor"]})),R=R.concat(Mp({key:`${u}[${N+1}]`,value:y[N+1],valueSpec:{length:2,value:"number"},validateSpec:p.validateSpec,style:p.style,styleSpec:C}));return R},sprite:H7};function bc(p){let u=p.value,y=p.valueSpec,w=p.styleSpec;return p.validateSpec=bc,y.expression&&F0(Fs(u))?Pp(p):y.expression&&L0(hu(u))?Nl(p):y.type&&V7[y.type]?V7[y.type](p):ca(rt({},p,{valueSpec:y.type?w[y.type]:y}))}function Hh(p){let u=p.value,y=p.key,w=du(p);return w.length||(u.indexOf("{fontstack}")===-1&&w.push(new De(y,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&w.push(new De(y,u,'"glyphs" url must include a "{range}" token'))),w}function Ls(p,u=Te){let y=[];return y=y.concat(bc({key:"",value:p,valueSpec:u.$root,styleSpec:u,style:p,validateSpec:bc,objectElementValidators:{glyphs:Hh,"*":()=>[]}})),p.constants&&(y=y.concat(B7({key:"constants",value:p.constants,style:p,styleSpec:u,validateSpec:bc}))),j7(y)}function ua(p){return function(u){return p(Tn(di({},u),{validateSpec:bc}))}}function j7(p){return[].concat(p).sort((u,y)=>u.line-y.line)}function Ol(p){return function(...u){return j7(p.apply(this,u))}}Ls.source=Ol(ua(z7)),Ls.sprite=Ol(ua(H7)),Ls.glyphs=Ol(ua(Hh)),Ls.light=Ol(ua(G7)),Ls.terrain=Ol(ua($7)),Ls.layer=Ol(ua(H0)),Ls.filter=Ol(ua(z0)),Ls.paintProperty=Ol(ua(Gh)),Ls.layoutProperty=Ol(ua($0));let Vh=Ls,jh=Vh.light,Sv=Vh.paintProperty,Rp=Vh.layoutProperty;function X7(p,u){let y=!1;if(u&&u.length)for(let w of u)p.fire(new bt(new Error(w.message))),y=!0;return y}class fu{constructor(u,y,w){let C=this.cells=[];if(u instanceof ArrayBuffer){this.arrayBuffer=u;let N=new Int32Array(this.arrayBuffer);u=N[0],this.d=(y=N[1])+2*(w=N[2]);for(let X=0;X<this.d*this.d;X++){let K=N[3+X],ae=N[3+X+1];C.push(K===ae?null:N.subarray(K,ae))}let G=N[3+C.length+1];this.keys=N.subarray(N[3+C.length],G),this.bboxes=N.subarray(G),this.insert=this._insertReadonly}else{this.d=y+2*w;for(let N=0;N<this.d*this.d;N++)C.push([]);this.keys=[],this.bboxes=[]}this.n=y,this.extent=u,this.padding=w,this.scale=y/u,this.uid=0;let R=w/y*u;this.min=-R,this.max=u+R}insert(u,y,w,C,R){this._forEachCell(y,w,C,R,this._insertCell,this.uid++,void 0,void 0),this.keys.push(u),this.bboxes.push(y),this.bboxes.push(w),this.bboxes.push(C),this.bboxes.push(R)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(u,y,w,C,R,N){this.cells[R].push(N)}query(u,y,w,C,R){let N=this.min,G=this.max;if(u<=N&&y<=N&&G<=w&&G<=C&&!R)return Array.prototype.slice.call(this.keys);{let X=[];return this._forEachCell(u,y,w,C,this._queryCell,X,{},R),X}}_queryCell(u,y,w,C,R,N,G,X){let K=this.cells[R];if(K!==null){let ae=this.keys,ue=this.bboxes;for(let pe=0;pe<K.length;pe++){let ve=K[pe];if(G[ve]===void 0){let we=4*ve;(X?X(ue[we+0],ue[we+1],ue[we+2],ue[we+3]):u<=ue[we+2]&&y<=ue[we+3]&&w>=ue[we+0]&&C>=ue[we+1])?(G[ve]=!0,N.push(ae[ve])):G[ve]=!1}}}}_forEachCell(u,y,w,C,R,N,G,X){let K=this._convertToCellCoord(u),ae=this._convertToCellCoord(y),ue=this._convertToCellCoord(w),pe=this._convertToCellCoord(C);for(let ve=K;ve<=ue;ve++)for(let we=ae;we<=pe;we++){let Ie=this.d*we+ve;if((!X||X(this._convertFromCellCoord(ve),this._convertFromCellCoord(we),this._convertFromCellCoord(ve+1),this._convertFromCellCoord(we+1)))&&R.call(this,u,y,w,C,Ie,N,G,X))return}}_convertFromCellCoord(u){return(u-this.padding)/this.scale}_convertToCellCoord(u){return Math.max(0,Math.min(this.d-1,Math.floor(u*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let u=this.cells,y=3+this.cells.length+1+1,w=0;for(let N=0;N<this.cells.length;N++)w+=this.cells[N].length;let C=new Int32Array(y+w+this.keys.length+this.bboxes.length);C[0]=this.extent,C[1]=this.n,C[2]=this.padding;let R=y;for(let N=0;N<u.length;N++){let G=u[N];C[3+N]=R,C.set(G,R),R+=G.length}return C[3+u.length]=R,C.set(this.keys,R),R+=this.keys.length,C[3+u.length+1]=R,C.set(this.bboxes,R),R+=this.bboxes.length,C.buffer}static serialize(u,y){let w=u.toArrayBuffer();return y&&y.push(w),{buffer:w}}static deserialize(u){return new fu(u.buffer)}}let wc={};function qt(p,u,y={}){if(wc[p])throw new Error(`${p} is already registered.`);Object.defineProperty(u,"_classRegistryKey",{value:p,writeable:!1}),wc[p]={klass:u,omit:y.omit||[],shallow:y.shallow||[]}}qt("Object",Object),qt("TransferableGridIndex",fu),qt("Color",Fi),qt("Error",Error),qt("AJAXError",re),qt("ResolvedImage",la),qt("StylePropertyFunction",uu),qt("StyleExpression",_s,{omit:["_evaluator"]}),qt("ZoomDependentExpression",Jr),qt("ZoomConstantExpression",Oh),qt("CompoundExpression",Io,{omit:["_evaluate"]});for(let p in y1)y1[p]._classRegistryKey||qt(`Expression_${p}`,y1[p]);function W7(p){return p&&typeof ArrayBuffer!="undefined"&&(p instanceof ArrayBuffer||p.constructor&&p.constructor.name==="ArrayBuffer")}function pu(p,u){if(p==null||typeof p=="boolean"||typeof p=="number"||typeof p=="string"||p instanceof Boolean||p instanceof Number||p instanceof String||p instanceof Date||p instanceof RegExp||p instanceof Blob)return p;if(W7(p)||Q(p))return u&&u.push(p),p;if(ArrayBuffer.isView(p)){let y=p;return u&&u.push(y.buffer),y}if(p instanceof ImageData)return u&&u.push(p.data.buffer),p;if(Array.isArray(p)){let y=[];for(let w of p)y.push(pu(w,u));return y}if(typeof p=="object"){let y=p.constructor,w=y._classRegistryKey;if(!w)throw new Error("can't serialize object of unregistered class");if(!wc[w])throw new Error(`${w} is not registered.`);let C=y.serialize?y.serialize(p,u):{};if(y.serialize){if(u&&C===u[u.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let R in p){if(!p.hasOwnProperty(R)||wc[w].omit.indexOf(R)>=0)continue;let N=p[R];C[R]=wc[w].shallow.indexOf(R)>=0?N:pu(N,u)}p instanceof Error&&(C.message=p.message)}if(C.$name)throw new Error("$name property is reserved for worker serialization logic.");return w!=="Object"&&(C.$name=w),C}throw new Error("can't serialize object of type "+typeof p)}function v1(p){if(p==null||typeof p=="boolean"||typeof p=="number"||typeof p=="string"||p instanceof Boolean||p instanceof Number||p instanceof String||p instanceof Date||p instanceof RegExp||p instanceof Blob||W7(p)||Q(p)||ArrayBuffer.isView(p)||p instanceof ImageData)return p;if(Array.isArray(p))return p.map(v1);if(typeof p=="object"){let u=p.$name||"Object";if(!wc[u])throw new Error(`can't deserialize unregistered class ${u}`);let{klass:y}=wc[u];if(!y)throw new Error(`can't deserialize unregistered class ${u}`);if(y.deserialize)return y.deserialize(p);let w=Object.create(y.prototype);for(let C of Object.keys(p)){if(C==="$name")continue;let R=p[C];w[C]=wc[u].shallow.indexOf(C)>=0?R:v1(R)}return w}throw new Error("can't deserialize object of type "+typeof p)}class V0{constructor(){this.first=!0}update(u,y){let w=Math.floor(u);return this.first?(this.first=!1,this.lastIntegerZoom=w,this.lastIntegerZoomTime=0,this.lastZoom=u,this.lastFloorZoom=w,!0):(this.lastFloorZoom>w?(this.lastIntegerZoom=w+1,this.lastIntegerZoomTime=y):this.lastFloorZoom<w&&(this.lastIntegerZoom=w,this.lastIntegerZoomTime=y),u!==this.lastZoom&&(this.lastZoom=u,this.lastFloorZoom=w,!0))}}let jt={"Latin-1 Supplement":p=>p>=128&&p<=255,Arabic:p=>p>=1536&&p<=1791,"Arabic Supplement":p=>p>=1872&&p<=1919,"Arabic Extended-A":p=>p>=2208&&p<=2303,"Hangul Jamo":p=>p>=4352&&p<=4607,"Unified Canadian Aboriginal Syllabics":p=>p>=5120&&p<=5759,Khmer:p=>p>=6016&&p<=6143,"Unified Canadian Aboriginal Syllabics Extended":p=>p>=6320&&p<=6399,"General Punctuation":p=>p>=8192&&p<=8303,"Letterlike Symbols":p=>p>=8448&&p<=8527,"Number Forms":p=>p>=8528&&p<=8591,"Miscellaneous Technical":p=>p>=8960&&p<=9215,"Control Pictures":p=>p>=9216&&p<=9279,"Optical Character Recognition":p=>p>=9280&&p<=9311,"Enclosed Alphanumerics":p=>p>=9312&&p<=9471,"Geometric Shapes":p=>p>=9632&&p<=9727,"Miscellaneous Symbols":p=>p>=9728&&p<=9983,"Miscellaneous Symbols and Arrows":p=>p>=11008&&p<=11263,"CJK Radicals Supplement":p=>p>=11904&&p<=12031,"Kangxi Radicals":p=>p>=12032&&p<=12255,"Ideographic Description Characters":p=>p>=12272&&p<=12287,"CJK Symbols and Punctuation":p=>p>=12288&&p<=12351,Hiragana:p=>p>=12352&&p<=12447,Katakana:p=>p>=12448&&p<=12543,Bopomofo:p=>p>=12544&&p<=12591,"Hangul Compatibility Jamo":p=>p>=12592&&p<=12687,Kanbun:p=>p>=12688&&p<=12703,"Bopomofo Extended":p=>p>=12704&&p<=12735,"CJK Strokes":p=>p>=12736&&p<=12783,"Katakana Phonetic Extensions":p=>p>=12784&&p<=12799,"Enclosed CJK Letters and Months":p=>p>=12800&&p<=13055,"CJK Compatibility":p=>p>=13056&&p<=13311,"CJK Unified Ideographs Extension A":p=>p>=13312&&p<=19903,"Yijing Hexagram Symbols":p=>p>=19904&&p<=19967,"CJK Unified Ideographs":p=>p>=19968&&p<=40959,"Yi Syllables":p=>p>=40960&&p<=42127,"Yi Radicals":p=>p>=42128&&p<=42191,"Hangul Jamo Extended-A":p=>p>=43360&&p<=43391,"Hangul Syllables":p=>p>=44032&&p<=55215,"Hangul Jamo Extended-B":p=>p>=55216&&p<=55295,"Private Use Area":p=>p>=57344&&p<=63743,"CJK Compatibility Ideographs":p=>p>=63744&&p<=64255,"Arabic Presentation Forms-A":p=>p>=64336&&p<=65023,"Vertical Forms":p=>p>=65040&&p<=65055,"CJK Compatibility Forms":p=>p>=65072&&p<=65103,"Small Form Variants":p=>p>=65104&&p<=65135,"Arabic Presentation Forms-B":p=>p>=65136&&p<=65279,"Halfwidth and Fullwidth Forms":p=>p>=65280&&p<=65519};function j0(p){for(let u of p)if(b1(u.charCodeAt(0)))return!0;return!1}function Av(p){for(let u of p)if(!Dp(u.charCodeAt(0)))return!1;return!0}function Dp(p){return!(jt.Arabic(p)||jt["Arabic Supplement"](p)||jt["Arabic Extended-A"](p)||jt["Arabic Presentation Forms-A"](p)||jt["Arabic Presentation Forms-B"](p))}function b1(p){return!(p!==746&&p!==747&&(p<4352||!(jt["Bopomofo Extended"](p)||jt.Bopomofo(p)||jt["CJK Compatibility Forms"](p)&&!(p>=65097&&p<=65103)||jt["CJK Compatibility Ideographs"](p)||jt["CJK Compatibility"](p)||jt["CJK Radicals Supplement"](p)||jt["CJK Strokes"](p)||!(!jt["CJK Symbols and Punctuation"](p)||p>=12296&&p<=12305||p>=12308&&p<=12319||p===12336)||jt["CJK Unified Ideographs Extension A"](p)||jt["CJK Unified Ideographs"](p)||jt["Enclosed CJK Letters and Months"](p)||jt["Hangul Compatibility Jamo"](p)||jt["Hangul Jamo Extended-A"](p)||jt["Hangul Jamo Extended-B"](p)||jt["Hangul Jamo"](p)||jt["Hangul Syllables"](p)||jt.Hiragana(p)||jt["Ideographic Description Characters"](p)||jt.Kanbun(p)||jt["Kangxi Radicals"](p)||jt["Katakana Phonetic Extensions"](p)||jt.Katakana(p)&&p!==12540||!(!jt["Halfwidth and Fullwidth Forms"](p)||p===65288||p===65289||p===65293||p>=65306&&p<=65310||p===65339||p===65341||p===65343||p>=65371&&p<=65503||p===65507||p>=65512&&p<=65519)||!(!jt["Small Form Variants"](p)||p>=65112&&p<=65118||p>=65123&&p<=65126)||jt["Unified Canadian Aboriginal Syllabics"](p)||jt["Unified Canadian Aboriginal Syllabics Extended"](p)||jt["Vertical Forms"](p)||jt["Yijing Hexagram Symbols"](p)||jt["Yi Syllables"](p)||jt["Yi Radicals"](p))))}function Fp(p){return!(b1(p)||function(u){return!!(jt["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||jt["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||jt["Letterlike Symbols"](u)||jt["Number Forms"](u)||jt["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||jt["Control Pictures"](u)&&u!==9251||jt["Optical Character Recognition"](u)||jt["Enclosed Alphanumerics"](u)||jt["Geometric Shapes"](u)||jt["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||jt["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||jt["CJK Symbols and Punctuation"](u)||jt.Katakana(u)||jt["Private Use Area"](u)||jt["CJK Compatibility Forms"](u)||jt["Small Form Variants"](u)||jt["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(p))}function q7(p){return p>=1424&&p<=2303||jt["Arabic Presentation Forms-A"](p)||jt["Arabic Presentation Forms-B"](p)}function Y7(p,u){return!(!u&&q7(p)||p>=2304&&p<=3583||p>=3840&&p<=4255||jt.Khmer(p))}function Cv(p){for(let u of p)if(q7(u.charCodeAt(0)))return!0;return!1}let Xh="deferred",Lp="loading",Np="loaded",Op=null,uo="unavailable",Bl=null,Z7=function(p){p&&typeof p=="string"&&p.indexOf("NetworkError")>-1&&(uo="error"),Op&&Op(p)};function Bp(){Up.fire(new yt("pluginStateChange",{pluginStatus:uo,pluginURL:Bl}))}let Up=new at,zp=function(){return uo},Q7=function(){if(uo!==Xh||!Bl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");uo=Lp,Bp(),Bl&&Re({url:Bl},p=>{p?Z7(p):(uo=Np,Bp())})},ha={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>uo===Np||ha.applyArabicShaping!=null,isLoading:()=>uo===Lp,setState(p){if(!Z())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");uo=p.pluginStatus,Bl=p.pluginURL},isParsed(){if(!Z())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return ha.applyArabicShaping!=null&&ha.processBidirectionalText!=null&&ha.processStyledBidirectionalText!=null},getPluginURL(){if(!Z())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Bl}};class ns{constructor(u,y){this.zoom=u,y?(this.now=y.now,this.fadeDuration=y.fadeDuration,this.zoomHistory=y.zoomHistory,this.transition=y.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new V0,this.transition={})}isSupportedScript(u){return function(y,w){for(let C of y)if(!Y7(C.charCodeAt(0),w))return!1;return!0}(u,ha.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let u=this.zoom,y=u-Math.floor(u),w=this.crossFadingFactor();return u>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:y+(1-y)*w}:{fromScale:.5,toScale:1,t:1-(1-w)*y}}}class mu{constructor(u,y){this.property=u,this.value=y,this.expression=function(w,C){if(F0(w))return new uu(w,C);if(L0(w)){let R=es(w,C);if(R.result==="error")throw new Error(R.value.map(N=>`${N.key}: ${N.message}`).join(", "));return R.value}{let R=w;return C.type==="color"&&typeof w=="string"?R=Fi.parse(w):C.type!=="padding"||typeof w!="number"&&!Array.isArray(w)?C.type==="variableAnchorOffsetCollection"&&Array.isArray(w)&&(R=Un.parse(w)):R=Co.parse(w),{kind:"constant",evaluate:()=>R}}}(y===void 0?u.specification.default:y,u.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(u,y,w){return this.property.possiblyEvaluate(this,u,y,w)}}class Gp{constructor(u){this.property=u,this.value=new mu(u,void 0)}transitioned(u,y){return new K7(this.property,this.value,y,T({},u.transition,this.transition),u.now)}untransitioned(){return new K7(this.property,this.value,null,{},0)}}class X0{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitionablePropertyValues)}getValue(u){return F(this._values[u].value.value)}setValue(u,y){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new Gp(this._values[u].property)),this._values[u].value=new mu(this._values[u].property,y===null?void 0:F(y))}getTransition(u){return F(this._values[u].transition)}setTransition(u,y){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new Gp(this._values[u].property)),this._values[u].transition=F(y)||void 0}serialize(){let u={};for(let y of Object.keys(this._values)){let w=this.getValue(y);w!==void 0&&(u[y]=w);let C=this.getTransition(y);C!==void 0&&(u[`${y}-transition`]=C)}return u}transitioned(u,y){let w=new J7(this._properties);for(let C of Object.keys(this._values))w._values[C]=this._values[C].transitioned(u,y._values[C]);return w}untransitioned(){let u=new J7(this._properties);for(let y of Object.keys(this._values))u._values[y]=this._values[y].untransitioned();return u}}class K7{constructor(u,y,w,C,R){this.property=u,this.value=y,this.begin=R+C.delay||0,this.end=this.begin+C.duration||0,u.specification.transition&&(C.delay||C.duration)&&(this.prior=w)}possiblyEvaluate(u,y,w){let C=u.now||0,R=this.value.possiblyEvaluate(u,y,w),N=this.prior;if(N){if(C>this.end)return this.prior=null,R;if(this.value.isDataDriven())return this.prior=null,R;if(C<this.begin)return N.possiblyEvaluate(u,y,w);{let G=(C-this.begin)/(this.end-this.begin);return this.property.interpolate(N.possiblyEvaluate(u,y,w),R,function(X){if(X<=0)return 0;if(X>=1)return 1;let K=X*X,ae=K*X;return 4*(X<.5?ae:3*(X-K)+ae-.75)}(G))}}return R}}class J7{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitioningPropertyValues)}possiblyEvaluate(u,y,w){let C=new W0(this._properties);for(let R of Object.keys(this._values))C._values[R]=this._values[R].possiblyEvaluate(u,y,w);return C}hasTransition(){for(let u of Object.keys(this._values))if(this._values[u].prior)return!0;return!1}}class e9{constructor(u){this._properties=u,this._values=Object.create(u.defaultPropertyValues)}hasValue(u){return this._values[u].value!==void 0}getValue(u){return F(this._values[u].value)}setValue(u,y){this._values[u]=new mu(this._values[u].property,y===null?void 0:F(y))}serialize(){let u={};for(let y of Object.keys(this._values)){let w=this.getValue(y);w!==void 0&&(u[y]=w)}return u}possiblyEvaluate(u,y,w){let C=new W0(this._properties);for(let R of Object.keys(this._values))C._values[R]=this._values[R].possiblyEvaluate(u,y,w);return C}}class Ra{constructor(u,y,w){this.property=u,this.value=y,this.parameters=w}isConstant(){return this.value.kind==="constant"}constantOr(u){return this.value.kind==="constant"?this.value.value:u}evaluate(u,y,w,C){return this.property.evaluate(this.value,this.parameters,u,y,w,C)}}class W0{constructor(u){this._properties=u,this._values=Object.create(u.defaultPossiblyEvaluatedValues)}get(u){return this._values[u]}}class pi{constructor(u){this.specification=u}possiblyEvaluate(u,y){if(u.isDataDriven())throw new Error("Value should not be data driven");return u.expression.evaluate(y)}interpolate(u,y,w){let C=ko[this.specification.type];return C?C(u,y,w):u}}class Ci{constructor(u,y){this.specification=u,this.overrides=y}possiblyEvaluate(u,y,w,C){return new Ra(this,u.expression.kind==="constant"||u.expression.kind==="camera"?{kind:"constant",value:u.expression.evaluate(y,null,{},w,C)}:u.expression,y)}interpolate(u,y,w){if(u.value.kind!=="constant"||y.value.kind!=="constant")return u;if(u.value.value===void 0||y.value.value===void 0)return new Ra(this,{kind:"constant",value:void 0},u.parameters);let C=ko[this.specification.type];if(C){let R=C(u.value.value,y.value.value,w);return new Ra(this,{kind:"constant",value:R},u.parameters)}return u}evaluate(u,y,w,C,R,N){return u.kind==="constant"?u.value:u.evaluate(y,w,C,R,N)}}class q0 extends Ci{possiblyEvaluate(u,y,w,C){if(u.value===void 0)return new Ra(this,{kind:"constant",value:void 0},y);if(u.expression.kind==="constant"){let R=u.expression.evaluate(y,null,{},w,C),N=u.property.specification.type==="resolvedImage"&&typeof R!="string"?R.name:R,G=this._calculate(N,N,N,y);return new Ra(this,{kind:"constant",value:G},y)}if(u.expression.kind==="camera"){let R=this._calculate(u.expression.evaluate({zoom:y.zoom-1}),u.expression.evaluate({zoom:y.zoom}),u.expression.evaluate({zoom:y.zoom+1}),y);return new Ra(this,{kind:"constant",value:R},y)}return new Ra(this,u.expression,y)}evaluate(u,y,w,C,R,N){if(u.kind==="source"){let G=u.evaluate(y,w,C,R,N);return this._calculate(G,G,G,y)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(y.zoom)-1},w,C),u.evaluate({zoom:Math.floor(y.zoom)},w,C),u.evaluate({zoom:Math.floor(y.zoom)+1},w,C),y):u.value}_calculate(u,y,w,C){return C.zoom>C.zoomHistory.lastIntegerZoom?{from:u,to:y}:{from:w,to:y}}interpolate(u){return u}}class $p{constructor(u){this.specification=u}possiblyEvaluate(u,y,w,C){if(u.value!==void 0){if(u.expression.kind==="constant"){let R=u.expression.evaluate(y,null,{},w,C);return this._calculate(R,R,R,y)}return this._calculate(u.expression.evaluate(new ns(Math.floor(y.zoom-1),y)),u.expression.evaluate(new ns(Math.floor(y.zoom),y)),u.expression.evaluate(new ns(Math.floor(y.zoom+1),y)),y)}}_calculate(u,y,w,C){return C.zoom>C.zoomHistory.lastIntegerZoom?{from:u,to:y}:{from:w,to:y}}interpolate(u){return u}}class Hp{constructor(u){this.specification=u}possiblyEvaluate(u,y,w,C){return!!u.expression.evaluate(y,null,{},w,C)}interpolate(){return!1}}class ln{constructor(u){this.properties=u,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let y in u){let w=u[y];w.specification.overridable&&this.overridableProperties.push(y);let C=this.defaultPropertyValues[y]=new mu(w,void 0),R=this.defaultTransitionablePropertyValues[y]=new Gp(w);this.defaultTransitioningPropertyValues[y]=R.untransitioned(),this.defaultPossiblyEvaluatedValues[y]=C.possiblyEvaluate({})}}}qt("DataDrivenProperty",Ci),qt("DataConstantProperty",pi),qt("CrossFadedDataDrivenProperty",q0),qt("CrossFadedProperty",$p),qt("ColorRampProperty",Hp);let t9="-transition";class ul extends at{constructor(u,y){if(super(),this.id=u.id,this.type=u.type,this._featureFilter={filter:()=>!0,needGeometry:!1},u.type!=="custom"&&(this.metadata=u.metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),y.layout&&(this._unevaluatedLayout=new e9(y.layout)),y.paint)){this._transitionablePaint=new X0(y.paint);for(let w in u.paint)this.setPaintProperty(w,u.paint[w],{validate:!1});for(let w in u.layout)this.setLayoutProperty(w,u.layout[w],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new W0(y.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)}setLayoutProperty(u,y,w={}){y!=null&&this._validate(Rp,`layers.${this.id}.layout.${u}`,u,y,w)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,y):this.visibility=y)}getPaintProperty(u){return u.endsWith(t9)?this._transitionablePaint.getTransition(u.slice(0,-11)):this._transitionablePaint.getValue(u)}setPaintProperty(u,y,w={}){if(y!=null&&this._validate(Sv,`layers.${this.id}.paint.${u}`,u,y,w))return!1;if(u.endsWith(t9))return this._transitionablePaint.setTransition(u.slice(0,-11),y||void 0),!1;{let C=this._transitionablePaint._values[u],R=C.property.specification["property-type"]==="cross-faded-data-driven",N=C.value.isDataDriven(),G=C.value;this._transitionablePaint.setValue(u,y),this._handleSpecialPaintPropertyUpdate(u);let X=this._transitionablePaint._values[u].value;return X.isDataDriven()||N||R||this._handleOverridablePaintPropertyUpdate(u,G,X)}}_handleSpecialPaintPropertyUpdate(u){}_handleOverridablePaintPropertyUpdate(u,y,w){return!1}isHidden(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"}updateTransitions(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(u,y){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,y)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,y)}serialize(){let u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),k(u,(y,w)=>!(y===void 0||w==="layout"&&!Object.keys(y).length||w==="paint"&&!Object.keys(y).length))}_validate(u,y,w,C,R={}){return(!R||R.validate!==!1)&&X7(this,u.call(Vh,{key:y,layerType:this.type,objectKey:w,value:C,styleSpec:Te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let u in this.paint._values){let y=this.paint.get(u);if(y instanceof Ra&&x1(y.property.specification)&&(y.value.kind==="source"||y.value.kind==="composite")&&y.value.isStateDependent)return!0}return!1}}let Iv={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class w1{constructor(u,y){this._structArray=u,this._pos1=y*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class xs{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(u,y){return u._trim(),y&&(u.isTransferred=!0,y.push(u.arrayBuffer)),{length:u.length,arrayBuffer:u.arrayBuffer}}static deserialize(u){let y=Object.create(this.prototype);return y.arrayBuffer=u.arrayBuffer,y.length=u.length,y.capacity=u.arrayBuffer.byteLength/y.bytesPerElement,y._refreshViews(),y}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(u){this.reserve(u),this.length=u}reserve(u){if(u>this.capacity){this.capacity=Math.max(u,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let y=this.uint8;this._refreshViews(),y&&this.uint8.set(y)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ns(p,u=1){let y=0,w=0;return{members:p.map(C=>{let R=Iv[C.type].BYTES_PER_ELEMENT,N=y=Ul(y,Math.max(u,R)),G=C.components||1;return w=Math.max(w,R),y+=R*G,{name:C.name,type:C.type,components:G,offset:N}}),size:Ul(y,Math.max(w,u)),alignment:u}}function Ul(p,u){return Math.ceil(p/u)*u}class E1 extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,y){let w=this.length;return this.resize(w+1),this.emplace(w,u,y)}emplace(u,y,w){let C=2*u;return this.int16[C+0]=y,this.int16[C+1]=w,u}}E1.prototype.bytesPerElement=4,qt("StructArrayLayout2i4",E1);class T1 extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,y,w){let C=this.length;return this.resize(C+1),this.emplace(C,u,y,w)}emplace(u,y,w,C){let R=3*u;return this.int16[R+0]=y,this.int16[R+1]=w,this.int16[R+2]=C,u}}T1.prototype.bytesPerElement=6,qt("StructArrayLayout3i6",T1);class Y0 extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,y,w,C){let R=this.length;return this.resize(R+1),this.emplace(R,u,y,w,C)}emplace(u,y,w,C,R){let N=4*u;return this.int16[N+0]=y,this.int16[N+1]=w,this.int16[N+2]=C,this.int16[N+3]=R,u}}Y0.prototype.bytesPerElement=8,qt("StructArrayLayout4i8",Y0);class Wh extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,y,w,C,R,N){let G=this.length;return this.resize(G+1),this.emplace(G,u,y,w,C,R,N)}emplace(u,y,w,C,R,N,G){let X=6*u;return this.int16[X+0]=y,this.int16[X+1]=w,this.int16[X+2]=C,this.int16[X+3]=R,this.int16[X+4]=N,this.int16[X+5]=G,u}}Wh.prototype.bytesPerElement=12,qt("StructArrayLayout2i4i12",Wh);class Vp extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,y,w,C,R,N){let G=this.length;return this.resize(G+1),this.emplace(G,u,y,w,C,R,N)}emplace(u,y,w,C,R,N,G){let X=4*u,K=8*u;return this.int16[X+0]=y,this.int16[X+1]=w,this.uint8[K+4]=C,this.uint8[K+5]=R,this.uint8[K+6]=N,this.uint8[K+7]=G,u}}Vp.prototype.bytesPerElement=8,qt("StructArrayLayout2i4ub8",Vp);class Ec extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,y){let w=this.length;return this.resize(w+1),this.emplace(w,u,y)}emplace(u,y,w){let C=2*u;return this.float32[C+0]=y,this.float32[C+1]=w,u}}Ec.prototype.bytesPerElement=8,qt("StructArrayLayout2f8",Ec);class gu extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,y,w,C,R,N,G,X,K,ae){let ue=this.length;return this.resize(ue+1),this.emplace(ue,u,y,w,C,R,N,G,X,K,ae)}emplace(u,y,w,C,R,N,G,X,K,ae,ue){let pe=10*u;return this.uint16[pe+0]=y,this.uint16[pe+1]=w,this.uint16[pe+2]=C,this.uint16[pe+3]=R,this.uint16[pe+4]=N,this.uint16[pe+5]=G,this.uint16[pe+6]=X,this.uint16[pe+7]=K,this.uint16[pe+8]=ae,this.uint16[pe+9]=ue,u}}gu.prototype.bytesPerElement=20,qt("StructArrayLayout10ui20",gu);class jp extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,y,w,C,R,N,G,X,K,ae,ue,pe){let ve=this.length;return this.resize(ve+1),this.emplace(ve,u,y,w,C,R,N,G,X,K,ae,ue,pe)}emplace(u,y,w,C,R,N,G,X,K,ae,ue,pe,ve){let we=12*u;return this.int16[we+0]=y,this.int16[we+1]=w,this.int16[we+2]=C,this.int16[we+3]=R,this.uint16[we+4]=N,this.uint16[we+5]=G,this.uint16[we+6]=X,this.uint16[we+7]=K,this.int16[we+8]=ae,this.int16[we+9]=ue,this.int16[we+10]=pe,this.int16[we+11]=ve,u}}jp.prototype.bytesPerElement=24,qt("StructArrayLayout4i4ui4i24",jp);class Z0 extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,y,w){let C=this.length;return this.resize(C+1),this.emplace(C,u,y,w)}emplace(u,y,w,C){let R=3*u;return this.float32[R+0]=y,this.float32[R+1]=w,this.float32[R+2]=C,u}}Z0.prototype.bytesPerElement=12,qt("StructArrayLayout3f12",Z0);class yu extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(u){let y=this.length;return this.resize(y+1),this.emplace(y,u)}emplace(u,y){return this.uint32[1*u+0]=y,u}}yu.prototype.bytesPerElement=4,qt("StructArrayLayout1ul4",yu);class Xp extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,y,w,C,R,N,G,X,K){let ae=this.length;return this.resize(ae+1),this.emplace(ae,u,y,w,C,R,N,G,X,K)}emplace(u,y,w,C,R,N,G,X,K,ae){let ue=10*u,pe=5*u;return this.int16[ue+0]=y,this.int16[ue+1]=w,this.int16[ue+2]=C,this.int16[ue+3]=R,this.int16[ue+4]=N,this.int16[ue+5]=G,this.uint32[pe+3]=X,this.uint16[ue+8]=K,this.uint16[ue+9]=ae,u}}Xp.prototype.bytesPerElement=20,qt("StructArrayLayout6i1ul2ui20",Xp);class Wp extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,y,w,C,R,N){let G=this.length;return this.resize(G+1),this.emplace(G,u,y,w,C,R,N)}emplace(u,y,w,C,R,N,G){let X=6*u;return this.int16[X+0]=y,this.int16[X+1]=w,this.int16[X+2]=C,this.int16[X+3]=R,this.int16[X+4]=N,this.int16[X+5]=G,u}}Wp.prototype.bytesPerElement=12,qt("StructArrayLayout2i2i2i12",Wp);class Q0 extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,y,w,C,R){let N=this.length;return this.resize(N+1),this.emplace(N,u,y,w,C,R)}emplace(u,y,w,C,R,N){let G=4*u,X=8*u;return this.float32[G+0]=y,this.float32[G+1]=w,this.float32[G+2]=C,this.int16[X+6]=R,this.int16[X+7]=N,u}}Q0.prototype.bytesPerElement=16,qt("StructArrayLayout2f1f2i16",Q0);class qp extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,y,w,C){let R=this.length;return this.resize(R+1),this.emplace(R,u,y,w,C)}emplace(u,y,w,C,R){let N=12*u,G=3*u;return this.uint8[N+0]=y,this.uint8[N+1]=w,this.float32[G+1]=C,this.float32[G+2]=R,u}}qp.prototype.bytesPerElement=12,qt("StructArrayLayout2ub2f12",qp);class K0 extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,y,w){let C=this.length;return this.resize(C+1),this.emplace(C,u,y,w)}emplace(u,y,w,C){let R=3*u;return this.uint16[R+0]=y,this.uint16[R+1]=w,this.uint16[R+2]=C,u}}K0.prototype.bytesPerElement=6,qt("StructArrayLayout3ui6",K0);class Cr extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,y,w,C,R,N,G,X,K,ae,ue,pe,ve,we,Ie,Le,Be){let qe=this.length;return this.resize(qe+1),this.emplace(qe,u,y,w,C,R,N,G,X,K,ae,ue,pe,ve,we,Ie,Le,Be)}emplace(u,y,w,C,R,N,G,X,K,ae,ue,pe,ve,we,Ie,Le,Be,qe){let $e=24*u,et=12*u,it=48*u;return this.int16[$e+0]=y,this.int16[$e+1]=w,this.uint16[$e+2]=C,this.uint16[$e+3]=R,this.uint32[et+2]=N,this.uint32[et+3]=G,this.uint32[et+4]=X,this.uint16[$e+10]=K,this.uint16[$e+11]=ae,this.uint16[$e+12]=ue,this.float32[et+7]=pe,this.float32[et+8]=ve,this.uint8[it+36]=we,this.uint8[it+37]=Ie,this.uint8[it+38]=Le,this.uint32[et+10]=Be,this.int16[$e+22]=qe,u}}Cr.prototype.bytesPerElement=48,qt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Cr);class P extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,y,w,C,R,N,G,X,K,ae,ue,pe,ve,we,Ie,Le,Be,qe,$e,et,it,pt,Xt,ci,Ht,Gt,Rt,Kt){let Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,u,y,w,C,R,N,G,X,K,ae,ue,pe,ve,we,Ie,Le,Be,qe,$e,et,it,pt,Xt,ci,Ht,Gt,Rt,Kt)}emplace(u,y,w,C,R,N,G,X,K,ae,ue,pe,ve,we,Ie,Le,Be,qe,$e,et,it,pt,Xt,ci,Ht,Gt,Rt,Kt,Ot){let Ct=32*u,xi=16*u;return this.int16[Ct+0]=y,this.int16[Ct+1]=w,this.int16[Ct+2]=C,this.int16[Ct+3]=R,this.int16[Ct+4]=N,this.int16[Ct+5]=G,this.int16[Ct+6]=X,this.int16[Ct+7]=K,this.uint16[Ct+8]=ae,this.uint16[Ct+9]=ue,this.uint16[Ct+10]=pe,this.uint16[Ct+11]=ve,this.uint16[Ct+12]=we,this.uint16[Ct+13]=Ie,this.uint16[Ct+14]=Le,this.uint16[Ct+15]=Be,this.uint16[Ct+16]=qe,this.uint16[Ct+17]=$e,this.uint16[Ct+18]=et,this.uint16[Ct+19]=it,this.uint16[Ct+20]=pt,this.uint16[Ct+21]=Xt,this.uint16[Ct+22]=ci,this.uint32[xi+12]=Ht,this.float32[xi+13]=Gt,this.float32[xi+14]=Rt,this.uint16[Ct+30]=Kt,this.uint16[Ct+31]=Ot,u}}P.prototype.bytesPerElement=64,qt("StructArrayLayout8i15ui1ul2f2ui64",P);class h extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u){let y=this.length;return this.resize(y+1),this.emplace(y,u)}emplace(u,y){return this.float32[1*u+0]=y,u}}h.prototype.bytesPerElement=4,qt("StructArrayLayout1f4",h);class x extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,y,w){let C=this.length;return this.resize(C+1),this.emplace(C,u,y,w)}emplace(u,y,w,C){let R=3*u;return this.uint16[6*u+0]=y,this.float32[R+1]=w,this.float32[R+2]=C,u}}x.prototype.bytesPerElement=12,qt("StructArrayLayout1ui2f12",x);class S extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,y,w){let C=this.length;return this.resize(C+1),this.emplace(C,u,y,w)}emplace(u,y,w,C){let R=4*u;return this.uint32[2*u+0]=y,this.uint16[R+2]=w,this.uint16[R+3]=C,u}}S.prototype.bytesPerElement=8,qt("StructArrayLayout1ul2ui8",S);class I extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,y){let w=this.length;return this.resize(w+1),this.emplace(w,u,y)}emplace(u,y,w){let C=2*u;return this.uint16[C+0]=y,this.uint16[C+1]=w,u}}I.prototype.bytesPerElement=4,qt("StructArrayLayout2ui4",I);class D extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u){let y=this.length;return this.resize(y+1),this.emplace(y,u)}emplace(u,y){return this.uint16[1*u+0]=y,u}}D.prototype.bytesPerElement=2,qt("StructArrayLayout1ui2",D);class $ extends xs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,y,w,C){let R=this.length;return this.resize(R+1),this.emplace(R,u,y,w,C)}emplace(u,y,w,C,R){let N=4*u;return this.float32[N+0]=y,this.float32[N+1]=w,this.float32[N+2]=C,this.float32[N+3]=R,u}}$.prototype.bytesPerElement=16,qt("StructArrayLayout4f16",$);class H extends w1{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new c(this.anchorPointX,this.anchorPointY)}}H.prototype.size=20;class Y extends Xp{get(u){return new H(this,u)}}qt("CollisionBoxArray",Y);class J extends w1{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(u){this._structArray.uint8[this._pos1+37]=u}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(u){this._structArray.uint8[this._pos1+38]=u}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(u){this._structArray.uint32[this._pos4+10]=u}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}J.prototype.size=48;class se extends Cr{get(u){return new J(this,u)}}qt("PlacedSymbolArray",se);class ce extends w1{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(u){this._structArray.uint32[this._pos4+12]=u}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ce.prototype.size=64;class _e extends P{get(u){return new ce(this,u)}}qt("SymbolInstanceArray",_e);class Ce extends h{getoffsetX(u){return this.float32[1*u+0]}}qt("GlyphOffsetArray",Ce);class Ae extends T1{getx(u){return this.int16[3*u+0]}gety(u){return this.int16[3*u+1]}gettileUnitDistanceFromAnchor(u){return this.int16[3*u+2]}}qt("SymbolLineVertexArray",Ae);class Pe extends w1{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Pe.prototype.size=12;class Se extends x{get(u){return new Pe(this,u)}}qt("TextAnchorOffsetArray",Se);class Ve extends w1{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ve.prototype.size=8;class tt extends S{get(u){return new Ve(this,u)}}qt("FeatureIndexArray",tt);class Ne extends E1{}class Xe extends E1{}class st extends E1{}class nt extends Wh{}class ft extends Vp{}class At extends Ec{}class vt extends gu{}class Mt extends jp{}class li extends Z0{}class dr extends yu{}class Ut extends Wp{}class Ii extends qp{}class Jt extends K0{}class Yr extends I{}let cr=Ns([{name:"a_pos",components:2,type:"Int16"}],4),{members:ir}=cr;class Pi{constructor(u=[]){this.segments=u}prepareSegment(u,y,w,C){let R=this.segments[this.segments.length-1];return u>Pi.MAX_VERTEX_ARRAY_LENGTH&&B(`Max vertices per segment is ${Pi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${u}`),(!R||R.vertexLength+u>Pi.MAX_VERTEX_ARRAY_LENGTH||R.sortKey!==C)&&(R={vertexOffset:y.length,primitiveOffset:w.length,vertexLength:0,primitiveLength:0},C!==void 0&&(R.sortKey=C),this.segments.push(R)),R}get(){return this.segments}destroy(){for(let u of this.segments)for(let y in u.vaos)u.vaos[y].destroy()}static simpleSegment(u,y,w,C){return new Pi([{vertexOffset:u,primitiveOffset:y,vertexLength:w,primitiveLength:C,vaos:{},sortKey:0}])}}function As(p,u){return 256*(p=E(Math.floor(p),0,255))+E(Math.floor(u),0,255)}Pi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qt("SegmentVector",Pi);let Lr=Ns([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Qn={exports:{}},xn={exports:{}};xn.exports=function(p,u){var y,w,C,R,N,G,X,K;for(w=p.length-(y=3&p.length),C=u,N=3432918353,G=461845907,K=0;K<w;)X=255&p.charCodeAt(K)|(255&p.charCodeAt(++K))<<8|(255&p.charCodeAt(++K))<<16|(255&p.charCodeAt(++K))<<24,++K,C=27492+(65535&(R=5*(65535&(C=(C^=X=(65535&(X=(X=(65535&X)*N+(((X>>>16)*N&65535)<<16)&4294967295)<<15|X>>>17))*G+(((X>>>16)*G&65535)<<16)&4294967295)<<13|C>>>19))+((5*(C>>>16)&65535)<<16)&4294967295))+((58964+(R>>>16)&65535)<<16);switch(X=0,y){case 3:X^=(255&p.charCodeAt(K+2))<<16;case 2:X^=(255&p.charCodeAt(K+1))<<8;case 1:C^=X=(65535&(X=(X=(65535&(X^=255&p.charCodeAt(K)))*N+(((X>>>16)*N&65535)<<16)&4294967295)<<15|X>>>17))*G+(((X>>>16)*G&65535)<<16)&4294967295}return C^=p.length,C=2246822507*(65535&(C^=C>>>16))+((2246822507*(C>>>16)&65535)<<16)&4294967295,C=3266489909*(65535&(C^=C>>>13))+((3266489909*(C>>>16)&65535)<<16)&4294967295,(C^=C>>>16)>>>0};var Os=xn.exports,ho={exports:{}};ho.exports=function(p,u){for(var y,w=p.length,C=u^w,R=0;w>=4;)y=1540483477*(65535&(y=255&p.charCodeAt(R)|(255&p.charCodeAt(++R))<<8|(255&p.charCodeAt(++R))<<16|(255&p.charCodeAt(++R))<<24))+((1540483477*(y>>>16)&65535)<<16),C=1540483477*(65535&C)+((1540483477*(C>>>16)&65535)<<16)^(y=1540483477*(65535&(y^=y>>>24))+((1540483477*(y>>>16)&65535)<<16)),w-=4,++R;switch(w){case 3:C^=(255&p.charCodeAt(R+2))<<16;case 2:C^=(255&p.charCodeAt(R+1))<<8;case 1:C=1540483477*(65535&(C^=255&p.charCodeAt(R)))+((1540483477*(C>>>16)&65535)<<16)}return C=1540483477*(65535&(C^=C>>>13))+((1540483477*(C>>>16)&65535)<<16),(C^=C>>>15)>>>0};var Da=Os,zl=ho.exports;Qn.exports=Da,Qn.exports.murmur3=Da,Qn.exports.murmur2=zl;var Gl=o(Qn.exports);class Tc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(u,y,w,C){this.ids.push(_u(u)),this.positions.push(y,w,C)}getPositions(u){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let y=_u(u),w=0,C=this.ids.length-1;for(;w<C;){let N=w+C>>1;this.ids[N]>=y?C=N:w=N+1}let R=[];for(;this.ids[w]===y;)R.push({index:this.positions[3*w],start:this.positions[3*w+1],end:this.positions[3*w+2]}),w++;return R}static serialize(u,y){let w=new Float64Array(u.ids),C=new Uint32Array(u.positions);return Sc(w,C,0,w.length-1),y&&y.push(w.buffer,C.buffer),{ids:w,positions:C}}static deserialize(u){let y=new Tc;return y.ids=u.ids,y.positions=u.positions,y.indexed=!0,y}}function _u(p){let u=+p;return!isNaN(u)&&u<=Number.MAX_SAFE_INTEGER?u:Gl(String(p))}function Sc(p,u,y,w){for(;y<w;){let C=p[y+w>>1],R=y-1,N=w+1;for(;;){do R++;while(p[R]<C);do N--;while(p[N]>C);if(R>=N)break;vn(p,R,N),vn(u,3*R,3*N),vn(u,3*R+1,3*N+1),vn(u,3*R+2,3*N+2)}N-y<w-N?(Sc(p,u,y,N),y=N+1):(Sc(p,u,N+1,w),w=N)}}function vn(p,u,y){let w=p[u];p[u]=p[y],p[y]=w}qt("FeaturePositionMap",Tc);class Cs{constructor(u,y){this.gl=u.gl,this.location=y}}class bn extends Cs{constructor(u,y){super(u,y),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class S1 extends Cs{constructor(u,y){super(u,y),this.current=[0,0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))}}class qs extends Cs{constructor(u,y){super(u,y),this.current=Fi.transparent}set(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))}}let wn=new Float32Array(16);function fo(p){return[As(255*p.r,255*p.g),As(255*p.b,255*p.a)]}class vs{constructor(u,y,w){this.value=u,this.uniformNames=y.map(C=>`u_${C}`),this.type=w}setUniform(u,y,w){u.set(w.constantOr(this.value))}getBinding(u,y,w){return this.type==="color"?new qs(u,y):new bn(u,y)}}class A1{constructor(u,y){this.uniformNames=y.map(w=>`u_${w}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(u,y){this.pixelRatioFrom=y.pixelRatio,this.pixelRatioTo=u.pixelRatio,this.patternFrom=y.tlbr,this.patternTo=u.tlbr}setUniform(u,y,w,C){let R=C==="u_pattern_to"?this.patternTo:C==="u_pattern_from"?this.patternFrom:C==="u_pixel_ratio_to"?this.pixelRatioTo:C==="u_pixel_ratio_from"?this.pixelRatioFrom:null;R&&u.set(R)}getBinding(u,y,w){return w.substr(0,9)==="u_pattern"?new S1(u,y):new bn(u,y)}}class $l{constructor(u,y,w,C){this.expression=u,this.type=w,this.maxValue=0,this.paintVertexAttributes=y.map(R=>({name:`a_${R}`,type:"Float32",components:w==="color"?2:1,offset:0})),this.paintVertexArray=new C}populatePaintArray(u,y,w,C,R){let N=this.paintVertexArray.length,G=this.expression.evaluate(new ns(0),y,{},C,[],R);this.paintVertexArray.resize(u),this._setPaintValue(N,u,G)}updatePaintArray(u,y,w,C){let R=this.expression.evaluate({zoom:0},w,C);this._setPaintValue(u,y,R)}_setPaintValue(u,y,w){if(this.type==="color"){let C=fo(w);for(let R=u;R<y;R++)this.paintVertexArray.emplace(R,C[0],C[1])}else{for(let C=u;C<y;C++)this.paintVertexArray.emplace(C,w);this.maxValue=Math.max(this.maxValue,Math.abs(w))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fa{constructor(u,y,w,C,R,N){this.expression=u,this.uniformNames=y.map(G=>`u_${G}_t`),this.type=w,this.useIntegerZoom=C,this.zoom=R,this.maxValue=0,this.paintVertexAttributes=y.map(G=>({name:`a_${G}`,type:"Float32",components:w==="color"?4:2,offset:0})),this.paintVertexArray=new N}populatePaintArray(u,y,w,C,R){let N=this.expression.evaluate(new ns(this.zoom),y,{},C,[],R),G=this.expression.evaluate(new ns(this.zoom+1),y,{},C,[],R),X=this.paintVertexArray.length;this.paintVertexArray.resize(u),this._setPaintValue(X,u,N,G)}updatePaintArray(u,y,w,C){let R=this.expression.evaluate({zoom:this.zoom},w,C),N=this.expression.evaluate({zoom:this.zoom+1},w,C);this._setPaintValue(u,y,R,N)}_setPaintValue(u,y,w,C){if(this.type==="color"){let R=fo(w),N=fo(C);for(let G=u;G<y;G++)this.paintVertexArray.emplace(G,R[0],R[1],N[0],N[1])}else{for(let R=u;R<y;R++)this.paintVertexArray.emplace(R,w,C);this.maxValue=Math.max(this.maxValue,Math.abs(w),Math.abs(C))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(u,y){let w=this.useIntegerZoom?Math.floor(y.zoom):y.zoom,C=E(this.expression.interpolationFactor(w,this.zoom,this.zoom+1),0,1);u.set(C)}getBinding(u,y,w){return new bn(u,y)}}class Ac{constructor(u,y,w,C,R,N){this.expression=u,this.type=y,this.useIntegerZoom=w,this.zoom=C,this.layerId=N,this.zoomInPaintVertexArray=new R,this.zoomOutPaintVertexArray=new R}populatePaintArray(u,y,w){let C=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(u),this.zoomOutPaintVertexArray.resize(u),this._setPaintValues(C,u,y.patterns&&y.patterns[this.layerId],w)}updatePaintArray(u,y,w,C,R){this._setPaintValues(u,y,w.patterns&&w.patterns[this.layerId],R)}_setPaintValues(u,y,w,C){if(!C||!w)return;let{min:R,mid:N,max:G}=w,X=C[R],K=C[N],ae=C[G];if(X&&K&&ae)for(let ue=u;ue<y;ue++)this.zoomInPaintVertexArray.emplace(ue,K.tl[0],K.tl[1],K.br[0],K.br[1],X.tl[0],X.tl[1],X.br[0],X.br[1],K.pixelRatio,X.pixelRatio),this.zoomOutPaintVertexArray.emplace(ue,K.tl[0],K.tl[1],K.br[0],K.br[1],ae.tl[0],ae.tl[1],ae.br[0],ae.br[1],K.pixelRatio,ae.pixelRatio)}upload(u){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=u.createVertexBuffer(this.zoomInPaintVertexArray,Lr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=u.createVertexBuffer(this.zoomOutPaintVertexArray,Lr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class i9{constructor(u,y,w){this.binders={},this._buffers=[];let C=[];for(let R in u.paint._values){if(!w(R))continue;let N=u.paint.get(R);if(!(N instanceof Ra&&x1(N.property.specification)))continue;let G=C1(R,u.type),X=N.value,K=N.property.specification.type,ae=N.property.useIntegerZoom,ue=N.property.specification["property-type"],pe=ue==="cross-faded"||ue==="cross-faded-data-driven";if(X.kind==="constant")this.binders[R]=pe?new A1(X.value,G):new vs(X.value,G,K),C.push(`/u_${R}`);else if(X.kind==="source"||pe){let ve=Yp(R,K,"source");this.binders[R]=pe?new Ac(X,K,ae,y,ve,u.id):new $l(X,G,K,ve),C.push(`/a_${R}`)}else{let ve=Yp(R,K,"composite");this.binders[R]=new Fa(X,G,K,ae,y,ve),C.push(`/z_${R}`)}}this.cacheKey=C.sort().join("")}getMaxValue(u){let y=this.binders[u];return y instanceof $l||y instanceof Fa?y.maxValue:0}populatePaintArrays(u,y,w,C,R){for(let N in this.binders){let G=this.binders[N];(G instanceof $l||G instanceof Fa||G instanceof Ac)&&G.populatePaintArray(u,y,w,C,R)}}setConstantPatternPositions(u,y){for(let w in this.binders){let C=this.binders[w];C instanceof A1&&C.setConstantPatternPositions(u,y)}}updatePaintArrays(u,y,w,C,R){let N=!1;for(let G in u){let X=y.getPositions(G);for(let K of X){let ae=w.feature(K.index);for(let ue in this.binders){let pe=this.binders[ue];if((pe instanceof $l||pe instanceof Fa||pe instanceof Ac)&&pe.expression.isStateDependent===!0){let ve=C.paint.get(ue);pe.expression=ve.value,pe.updatePaintArray(K.start,K.end,ae,u[G],R),N=!0}}}}return N}defines(){let u=[];for(let y in this.binders){let w=this.binders[y];(w instanceof vs||w instanceof A1)&&u.push(...w.uniformNames.map(C=>`#define HAS_UNIFORM_${C}`))}return u}getBinderAttributes(){let u=[];for(let y in this.binders){let w=this.binders[y];if(w instanceof $l||w instanceof Fa)for(let C=0;C<w.paintVertexAttributes.length;C++)u.push(w.paintVertexAttributes[C].name);else if(w instanceof Ac)for(let C=0;C<Lr.members.length;C++)u.push(Lr.members[C].name)}return u}getBinderUniforms(){let u=[];for(let y in this.binders){let w=this.binders[y];if(w instanceof vs||w instanceof A1||w instanceof Fa)for(let C of w.uniformNames)u.push(C)}return u}getPaintVertexBuffers(){return this._buffers}getUniforms(u,y){let w=[];for(let C in this.binders){let R=this.binders[C];if(R instanceof vs||R instanceof A1||R instanceof Fa){for(let N of R.uniformNames)if(y[N]){let G=R.getBinding(u,y[N],N);w.push({name:N,property:C,binding:G})}}}return w}setUniforms(u,y,w,C){for(let{name:R,property:N,binding:G}of y)this.binders[N].setUniform(G,C,w.get(N),R)}updatePaintBuffers(u){this._buffers=[];for(let y in this.binders){let w=this.binders[y];if(u&&w instanceof Ac){let C=u.fromScale===2?w.zoomInPaintVertexBuffer:w.zoomOutPaintVertexBuffer;C&&this._buffers.push(C)}else(w instanceof $l||w instanceof Fa)&&w.paintVertexBuffer&&this._buffers.push(w.paintVertexBuffer)}}upload(u){for(let y in this.binders){let w=this.binders[y];(w instanceof $l||w instanceof Fa||w instanceof Ac)&&w.upload(u)}this.updatePaintBuffers()}destroy(){for(let u in this.binders){let y=this.binders[u];(y instanceof $l||y instanceof Fa||y instanceof Ac)&&y.destroy()}}}class xu{constructor(u,y,w=()=>!0){this.programConfigurations={};for(let C of u)this.programConfigurations[C.id]=new i9(C,y,w);this.needsUpload=!1,this._featureMap=new Tc,this._bufferOffset=0}populatePaintArrays(u,y,w,C,R,N){for(let G in this.programConfigurations)this.programConfigurations[G].populatePaintArrays(u,y,C,R,N);y.id!==void 0&&this._featureMap.add(y.id,w,this._bufferOffset,u),this._bufferOffset=u,this.needsUpload=!0}updatePaintArrays(u,y,w,C){for(let R of w)this.needsUpload=this.programConfigurations[R.id].updatePaintArrays(u,this._featureMap,y,R,C)||this.needsUpload}get(u){return this.programConfigurations[u]}upload(u){if(this.needsUpload){for(let y in this.programConfigurations)this.programConfigurations[y].upload(u);this.needsUpload=!1}}destroy(){for(let u in this.programConfigurations)this.programConfigurations[u].destroy()}}function C1(p,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[p]||[p.replace(`${u}-`,"").replace(/-/g,"_")]}function Yp(p,u,y){let w={color:{source:Ec,composite:$},number:{source:h,composite:Ec}},C=function(R){return{"line-pattern":{source:vt,composite:vt},"fill-pattern":{source:vt,composite:vt},"fill-extrusion-pattern":{source:vt,composite:vt}}[R]}(p);return C&&C[y]||w[u][y]}qt("ConstantBinder",vs),qt("CrossFadedConstantBinder",A1),qt("SourceExpressionBinder",$l),qt("CrossFadedCompositeBinder",Ac),qt("CompositeExpressionBinder",Fa),qt("ProgramConfiguration",i9,{omit:["_buffers"]}),qt("ProgramConfigurationSet",xu);let bs=8192,J0=Math.pow(2,14)-1,ef=-J0-1;function Cc(p){let u=bs/p.extent,y=p.loadGeometry();for(let w=0;w<y.length;w++){let C=y[w];for(let R=0;R<C.length;R++){let N=C[R],G=Math.round(N.x*u),X=Math.round(N.y*u);N.x=E(G,ef,J0),N.y=E(X,ef,J0),(G<N.x||G>N.x+1||X<N.y||X>N.y+1)&&B("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return y}function Hl(p,u){return{type:p.type,id:p.id,properties:p.properties,geometry:u?Cc(p):[]}}function r9(p,u,y,w,C){p.emplaceBack(2*u+(w+1)/2,2*y+(C+1)/2)}class kv{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(y=>y.id),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new Xe,this.indexArray=new Jt,this.segments=new Pi,this.programConfigurations=new xu(u.layers,u.zoom),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id)}populate(u,y,w){let C=this.layers[0],R=[],N=null,G=!1;C.type==="circle"&&(N=C.layout.get("circle-sort-key"),G=!N.isConstant());for(let{feature:X,id:K,index:ae,sourceLayerIndex:ue}of u){let pe=this.layers[0]._featureFilter.needGeometry,ve=Hl(X,pe);if(!this.layers[0]._featureFilter.filter(new ns(this.zoom),ve,w))continue;let we=G?N.evaluate(ve,{},w):void 0,Ie={id:K,properties:X.properties,type:X.type,sourceLayerIndex:ue,index:ae,geometry:pe?ve.geometry:Cc(X),patterns:{},sortKey:we};R.push(Ie)}G&&R.sort((X,K)=>X.sortKey-K.sortKey);for(let X of R){let{geometry:K,index:ae,sourceLayerIndex:ue}=X,pe=u[ae].feature;this.addFeature(X,K,ae,w),y.featureIndex.insert(pe,K,ae,ue,this.index)}}update(u,y,w){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,y,this.stateDependentLayers,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,ir),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(u,y,w,C){for(let R of y)for(let N of R){let G=N.x,X=N.y;if(G<0||G>=bs||X<0||X>=bs)continue;let K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,u.sortKey),ae=K.vertexLength;r9(this.layoutVertexArray,G,X,-1,-1),r9(this.layoutVertexArray,G,X,1,-1),r9(this.layoutVertexArray,G,X,1,1),r9(this.layoutVertexArray,G,X,-1,1),this.indexArray.emplaceBack(ae,ae+1,ae+2),this.indexArray.emplaceBack(ae,ae+3,ae+2),K.vertexLength+=4,K.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,w,{},C)}}function sC(p,u){for(let y=0;y<p.length;y++)if(tf(u,p[y]))return!0;for(let y=0;y<u.length;y++)if(tf(p,u[y]))return!0;return!!Mv(p,u)}function VU(p,u,y){return!!tf(p,u)||!!Pv(u,p,y)}function nC(p,u){if(p.length===1)return aC(u,p[0]);for(let y=0;y<u.length;y++){let w=u[y];for(let C=0;C<w.length;C++)if(tf(p,w[C]))return!0}for(let y=0;y<p.length;y++)if(aC(u,p[y]))return!0;for(let y=0;y<u.length;y++)if(Mv(p,u[y]))return!0;return!1}function jU(p,u,y){if(p.length>1){if(Mv(p,u))return!0;for(let w=0;w<u.length;w++)if(Pv(u[w],p,y))return!0}for(let w=0;w<p.length;w++)if(Pv(p[w],u,y))return!0;return!1}function Mv(p,u){if(p.length===0||u.length===0)return!1;for(let y=0;y<p.length-1;y++){let w=p[y],C=p[y+1];for(let R=0;R<u.length-1;R++)if(XU(w,C,u[R],u[R+1]))return!0}return!1}function XU(p,u,y,w){return U(p,y,w)!==U(u,y,w)&&U(p,u,y)!==U(p,u,w)}function Pv(p,u,y){let w=y*y;if(u.length===1)return p.distSqr(u[0])<w;for(let C=1;C<u.length;C++)if(oC(p,u[C-1],u[C])<w)return!0;return!1}function oC(p,u,y){let w=u.distSqr(y);if(w===0)return p.distSqr(u);let C=((p.x-u.x)*(y.x-u.x)+(p.y-u.y)*(y.y-u.y))/w;return p.distSqr(C<0?u:C>1?y:y.sub(u)._mult(C)._add(u))}function aC(p,u){let y,w,C,R=!1;for(let N=0;N<p.length;N++){y=p[N];for(let G=0,X=y.length-1;G<y.length;X=G++)w=y[G],C=y[X],w.y>u.y!=C.y>u.y&&u.x<(C.x-w.x)*(u.y-w.y)/(C.y-w.y)+w.x&&(R=!R)}return R}function tf(p,u){let y=!1;for(let w=0,C=p.length-1;w<p.length;C=w++){let R=p[w],N=p[C];R.y>u.y!=N.y>u.y&&u.x<(N.x-R.x)*(u.y-R.y)/(N.y-R.y)+R.x&&(y=!y)}return y}function WU(p,u,y){let w=y[0],C=y[2];if(p.x<w.x&&u.x<w.x||p.x>C.x&&u.x>C.x||p.y<w.y&&u.y<w.y||p.y>C.y&&u.y>C.y)return!1;let R=U(p,u,y[0]);return R!==U(p,u,y[1])||R!==U(p,u,y[2])||R!==U(p,u,y[3])}function Zp(p,u,y){let w=u.paint.get(p).value;return w.kind==="constant"?w.value:y.programConfigurations.get(u.id).getMaxValue(p)}function s9(p){return Math.sqrt(p[0]*p[0]+p[1]*p[1])}function n9(p,u,y,w,C){if(!u[0]&&!u[1])return p;let R=c.convert(u)._mult(C);y==="viewport"&&R._rotate(-w);let N=[];for(let G=0;G<p.length;G++)N.push(p[G].sub(R));return N}let lC,cC;qt("CircleBucket",kv,{omit:["layers"]});var qU={get paint(){return cC=cC||new ln({"circle-radius":new Ci(Te.paint_circle["circle-radius"]),"circle-color":new Ci(Te.paint_circle["circle-color"]),"circle-blur":new Ci(Te.paint_circle["circle-blur"]),"circle-opacity":new Ci(Te.paint_circle["circle-opacity"]),"circle-translate":new pi(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new pi(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pi(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pi(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ci(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ci(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ci(Te.paint_circle["circle-stroke-opacity"])})},get layout(){return lC=lC||new ln({"circle-sort-key":new Ci(Te.layout_circle["circle-sort-key"])})}},po=1e-6,rf=typeof Float32Array!="undefined"?Float32Array:Array;function Rv(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function uC(p,u,y){var w=u[0],C=u[1],R=u[2],N=u[3],G=u[4],X=u[5],K=u[6],ae=u[7],ue=u[8],pe=u[9],ve=u[10],we=u[11],Ie=u[12],Le=u[13],Be=u[14],qe=u[15],$e=y[0],et=y[1],it=y[2],pt=y[3];return p[0]=$e*w+et*G+it*ue+pt*Ie,p[1]=$e*C+et*X+it*pe+pt*Le,p[2]=$e*R+et*K+it*ve+pt*Be,p[3]=$e*N+et*ae+it*we+pt*qe,p[4]=($e=y[4])*w+(et=y[5])*G+(it=y[6])*ue+(pt=y[7])*Ie,p[5]=$e*C+et*X+it*pe+pt*Le,p[6]=$e*R+et*K+it*ve+pt*Be,p[7]=$e*N+et*ae+it*we+pt*qe,p[8]=($e=y[8])*w+(et=y[9])*G+(it=y[10])*ue+(pt=y[11])*Ie,p[9]=$e*C+et*X+it*pe+pt*Le,p[10]=$e*R+et*K+it*ve+pt*Be,p[11]=$e*N+et*ae+it*we+pt*qe,p[12]=($e=y[12])*w+(et=y[13])*G+(it=y[14])*ue+(pt=y[15])*Ie,p[13]=$e*C+et*X+it*pe+pt*Le,p[14]=$e*R+et*K+it*ve+pt*Be,p[15]=$e*N+et*ae+it*we+pt*qe,p}Math.hypot||(Math.hypot=function(){for(var p=0,u=arguments.length;u--;)p+=arguments[u]*arguments[u];return Math.sqrt(p)});var Qp,YU=uC;function o9(p,u,y){var w=u[0],C=u[1],R=u[2],N=u[3];return p[0]=y[0]*w+y[4]*C+y[8]*R+y[12]*N,p[1]=y[1]*w+y[5]*C+y[9]*R+y[13]*N,p[2]=y[2]*w+y[6]*C+y[10]*R+y[14]*N,p[3]=y[3]*w+y[7]*C+y[11]*R+y[15]*N,p}Qp=new rf(4),rf!=Float32Array&&(Qp[0]=0,Qp[1]=0,Qp[2]=0,Qp[3]=0);class ZU extends ul{constructor(u){super(u,qU)}createBucket(u){return new kv(u)}queryRadius(u){let y=u;return Zp("circle-radius",this,y)+Zp("circle-stroke-width",this,y)+s9(this.paint.get("circle-translate"))}queryIntersectsFeature(u,y,w,C,R,N,G,X){let K=n9(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),N.angle,G),ae=this.paint.get("circle-radius").evaluate(y,w)+this.paint.get("circle-stroke-width").evaluate(y,w),ue=this.paint.get("circle-pitch-alignment")==="map",pe=ue?K:function(we,Ie){return we.map(Le=>hC(Le,Ie))}(K,X),ve=ue?ae*G:ae;for(let we of C)for(let Ie of we){let Le=ue?Ie:hC(Ie,X),Be=ve,qe=o9([],[Ie.x,Ie.y,0,1],X);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Be*=qe[3]/N.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Be*=N.cameraToCenterDistance/qe[3]),VU(pe,Le,Be))return!0}return!1}}function hC(p,u){let y=o9([],[p.x,p.y,0,1],u);return new c(y[0]/y[3],y[1]/y[3])}class dC extends kv{}let fC;qt("HeatmapBucket",dC,{omit:["layers"]});var QU={get paint(){return fC=fC||new ln({"heatmap-radius":new Ci(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ci(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pi(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Hp(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pi(Te.paint_heatmap["heatmap-opacity"])})}};function Dv(p,{width:u,height:y},w,C){if(C){if(C instanceof Uint8ClampedArray)C=new Uint8Array(C.buffer);else if(C.length!==u*y*w)throw new RangeError(`mismatched image size. expected: ${C.length} but got: ${u*y*w}`)}else C=new Uint8Array(u*y*w);return p.width=u,p.height=y,p.data=C,p}function pC(p,{width:u,height:y},w){if(u===p.width&&y===p.height)return;let C=Dv({},{width:u,height:y},w);Fv(p,C,{x:0,y:0},{x:0,y:0},{width:Math.min(p.width,u),height:Math.min(p.height,y)},w),p.width=u,p.height=y,p.data=C.data}function Fv(p,u,y,w,C,R){if(C.width===0||C.height===0)return u;if(C.width>p.width||C.height>p.height||y.x>p.width-C.width||y.y>p.height-C.height)throw new RangeError("out of range source coordinates for image copy");if(C.width>u.width||C.height>u.height||w.x>u.width-C.width||w.y>u.height-C.height)throw new RangeError("out of range destination coordinates for image copy");let N=p.data,G=u.data;if(N===G)throw new Error("srcData equals dstData, so image is already copied");for(let X=0;X<C.height;X++){let K=((y.y+X)*p.width+y.x)*R,ae=((w.y+X)*u.width+w.x)*R;for(let ue=0;ue<C.width*R;ue++)G[ae+ue]=N[K+ue]}return u}class Kp{constructor(u,y){Dv(this,u,1,y)}resize(u){pC(this,u,1)}clone(){return new Kp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,y,w,C,R){Fv(u,y,w,C,R,1)}}class La{constructor(u,y){Dv(this,u,4,y)}resize(u){pC(this,u,4)}replace(u,y){y?this.data.set(u):this.data=u instanceof Uint8ClampedArray?new Uint8Array(u.buffer):u}clone(){return new La({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,y,w,C,R){Fv(u,y,w,C,R,4)}}function mC(p){let u={},y=p.resolution||256,w=p.clips?p.clips.length:1,C=p.image||new La({width:y,height:w});if(Math.log(y)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${y}`);let R=(N,G,X)=>{u[p.evaluationKey]=X;let K=p.expression.evaluate(u);C.data[N+G+0]=Math.floor(255*K.r/K.a),C.data[N+G+1]=Math.floor(255*K.g/K.a),C.data[N+G+2]=Math.floor(255*K.b/K.a),C.data[N+G+3]=Math.floor(255*K.a)};if(p.clips)for(let N=0,G=0;N<w;++N,G+=4*y)for(let X=0,K=0;X<y;X++,K+=4){let ae=X/(y-1),{start:ue,end:pe}=p.clips[N];R(G,K,ue*(1-ae)+pe*ae)}else for(let N=0,G=0;N<y;N++,G+=4)R(0,G,N/(y-1));return C}qt("AlphaImage",Kp),qt("RGBAImage",La);class KU extends ul{createBucket(u){return new dC(u)}constructor(u){super(u,QU),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=mC({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let gC;var JU={get paint(){return gC=gC||new ln({"hillshade-illumination-direction":new pi(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new pi(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pi(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pi(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pi(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pi(Te.paint_hillshade["hillshade-accent-color"])})}};class ez extends ul{constructor(u){super(u,JU)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let tz=Ns([{name:"a_pos",components:2,type:"Int16"}],4),{members:iz}=tz;var Lv={exports:{}};function a9(p,u,y){y=y||2;var w,C,R,N,G,X,K,ae=u&&u.length,ue=ae?u[0]*y:p.length,pe=yC(p,0,ue,y,!0),ve=[];if(!pe||pe.next===pe.prev)return ve;if(ae&&(pe=function(Ie,Le,Be,qe){var $e,et,it,pt=[];for($e=0,et=Le.length;$e<et;$e++)(it=yC(Ie,Le[$e]*qe,$e<et-1?Le[$e+1]*qe:Ie.length,qe,!1))===it.next&&(it.steiner=!0),pt.push(uz(it));for(pt.sort(az),$e=0;$e<pt.length;$e++)Be=lz(pt[$e],Be);return Be}(p,u,pe,y)),p.length>80*y){w=R=p[0],C=N=p[1];for(var we=y;we<ue;we+=y)(G=p[we])<w&&(w=G),(X=p[we+1])<C&&(C=X),G>R&&(R=G),X>N&&(N=X);K=(K=Math.max(R-w,N-C))!==0?32767/K:0}return Jp(pe,ve,y,w,C,K,0),ve}function yC(p,u,y,w,C){var R,N;if(C===Bv(p,u,y,w)>0)for(R=u;R<y;R+=w)N=vC(R,p[R],p[R+1],N);else for(R=y-w;R>=u;R-=w)N=vC(R,p[R],p[R+1],N);return N&&l9(N,N.next)&&(t3(N),N=N.next),N}function qh(p,u){if(!p)return p;u||(u=p);var y,w=p;do if(y=!1,w.steiner||!l9(w,w.next)&&Bs(w.prev,w,w.next)!==0)w=w.next;else{if(t3(w),(w=u=w.prev)===w.next)break;y=!0}while(y||w!==u);return u}function Jp(p,u,y,w,C,R,N){if(p){!N&&R&&function(ae,ue,pe,ve){var we=ae;do we.z===0&&(we.z=Nv(we.x,we.y,ue,pe,ve)),we.prevZ=we.prev,we.nextZ=we.next,we=we.next;while(we!==ae);we.prevZ.nextZ=null,we.prevZ=null,function(Ie){var Le,Be,qe,$e,et,it,pt,Xt,ci=1;do{for(Be=Ie,Ie=null,et=null,it=0;Be;){for(it++,qe=Be,pt=0,Le=0;Le<ci&&(pt++,qe=qe.nextZ);Le++);for(Xt=ci;pt>0||Xt>0&&qe;)pt!==0&&(Xt===0||!qe||Be.z<=qe.z)?($e=Be,Be=Be.nextZ,pt--):($e=qe,qe=qe.nextZ,Xt--),et?et.nextZ=$e:Ie=$e,$e.prevZ=et,et=$e;Be=qe}et.nextZ=null,ci*=2}while(it>1)}(we)}(p,w,C,R);for(var G,X,K=p;p.prev!==p.next;)if(G=p.prev,X=p.next,R?sz(p,w,C,R):rz(p))u.push(G.i/y|0),u.push(p.i/y|0),u.push(X.i/y|0),t3(p),p=X.next,K=X.next;else if((p=X)===K){N?N===1?Jp(p=nz(qh(p),u,y),u,y,w,C,R,2):N===2&&oz(p,u,y,w,C,R):Jp(qh(p),u,y,w,C,R,1);break}}}function rz(p){var u=p.prev,y=p,w=p.next;if(Bs(u,y,w)>=0)return!1;for(var C=u.x,R=y.x,N=w.x,G=u.y,X=y.y,K=w.y,ae=C<R?C<N?C:N:R<N?R:N,ue=G<X?G<K?G:K:X<K?X:K,pe=C>R?C>N?C:N:R>N?R:N,ve=G>X?G>K?G:K:X>K?X:K,we=w.next;we!==u;){if(we.x>=ae&&we.x<=pe&&we.y>=ue&&we.y<=ve&&sf(C,G,R,X,N,K,we.x,we.y)&&Bs(we.prev,we,we.next)>=0)return!1;we=we.next}return!0}function sz(p,u,y,w){var C=p.prev,R=p,N=p.next;if(Bs(C,R,N)>=0)return!1;for(var G=C.x,X=R.x,K=N.x,ae=C.y,ue=R.y,pe=N.y,ve=G<X?G<K?G:K:X<K?X:K,we=ae<ue?ae<pe?ae:pe:ue<pe?ue:pe,Ie=G>X?G>K?G:K:X>K?X:K,Le=ae>ue?ae>pe?ae:pe:ue>pe?ue:pe,Be=Nv(ve,we,u,y,w),qe=Nv(Ie,Le,u,y,w),$e=p.prevZ,et=p.nextZ;$e&&$e.z>=Be&&et&&et.z<=qe;){if($e.x>=ve&&$e.x<=Ie&&$e.y>=we&&$e.y<=Le&&$e!==C&&$e!==N&&sf(G,ae,X,ue,K,pe,$e.x,$e.y)&&Bs($e.prev,$e,$e.next)>=0||($e=$e.prevZ,et.x>=ve&&et.x<=Ie&&et.y>=we&&et.y<=Le&&et!==C&&et!==N&&sf(G,ae,X,ue,K,pe,et.x,et.y)&&Bs(et.prev,et,et.next)>=0))return!1;et=et.nextZ}for(;$e&&$e.z>=Be;){if($e.x>=ve&&$e.x<=Ie&&$e.y>=we&&$e.y<=Le&&$e!==C&&$e!==N&&sf(G,ae,X,ue,K,pe,$e.x,$e.y)&&Bs($e.prev,$e,$e.next)>=0)return!1;$e=$e.prevZ}for(;et&&et.z<=qe;){if(et.x>=ve&&et.x<=Ie&&et.y>=we&&et.y<=Le&&et!==C&&et!==N&&sf(G,ae,X,ue,K,pe,et.x,et.y)&&Bs(et.prev,et,et.next)>=0)return!1;et=et.nextZ}return!0}function nz(p,u,y){var w=p;do{var C=w.prev,R=w.next.next;!l9(C,R)&&_C(C,w,w.next,R)&&e3(C,R)&&e3(R,C)&&(u.push(C.i/y|0),u.push(w.i/y|0),u.push(R.i/y|0),t3(w),t3(w.next),w=p=R),w=w.next}while(w!==p);return qh(w)}function oz(p,u,y,w,C,R){var N=p;do{for(var G=N.next.next;G!==N.prev;){if(N.i!==G.i&&hz(N,G)){var X=xC(N,G);return N=qh(N,N.next),X=qh(X,X.next),Jp(N,u,y,w,C,R,0),void Jp(X,u,y,w,C,R,0)}G=G.next}N=N.next}while(N!==p)}function az(p,u){return p.x-u.x}function lz(p,u){var y=function(C,R){var N,G=R,X=C.x,K=C.y,ae=-1/0;do{if(K<=G.y&&K>=G.next.y&&G.next.y!==G.y){var ue=G.x+(K-G.y)*(G.next.x-G.x)/(G.next.y-G.y);if(ue<=X&&ue>ae&&(ae=ue,N=G.x<G.next.x?G:G.next,ue===X))return N}G=G.next}while(G!==R);if(!N)return null;var pe,ve=N,we=N.x,Ie=N.y,Le=1/0;G=N;do X>=G.x&&G.x>=we&&X!==G.x&&sf(K<Ie?X:ae,K,we,Ie,K<Ie?ae:X,K,G.x,G.y)&&(pe=Math.abs(K-G.y)/(X-G.x),e3(G,C)&&(pe<Le||pe===Le&&(G.x>N.x||G.x===N.x&&cz(N,G)))&&(N=G,Le=pe)),G=G.next;while(G!==ve);return N}(p,u);if(!y)return u;var w=xC(y,p);return qh(w,w.next),qh(y,y.next)}function cz(p,u){return Bs(p.prev,p,u.prev)<0&&Bs(u.next,p,p.next)<0}function Nv(p,u,y,w,C){return(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p=(p-y)*C|0)|p<<8))|p<<4))|p<<2))|p<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-w)*C|0)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function uz(p){var u=p,y=p;do(u.x<y.x||u.x===y.x&&u.y<y.y)&&(y=u),u=u.next;while(u!==p);return y}function sf(p,u,y,w,C,R,N,G){return(C-N)*(u-G)>=(p-N)*(R-G)&&(p-N)*(w-G)>=(y-N)*(u-G)&&(y-N)*(R-G)>=(C-N)*(w-G)}function hz(p,u){return p.next.i!==u.i&&p.prev.i!==u.i&&!function(y,w){var C=y;do{if(C.i!==y.i&&C.next.i!==y.i&&C.i!==w.i&&C.next.i!==w.i&&_C(C,C.next,y,w))return!0;C=C.next}while(C!==y);return!1}(p,u)&&(e3(p,u)&&e3(u,p)&&function(y,w){var C=y,R=!1,N=(y.x+w.x)/2,G=(y.y+w.y)/2;do C.y>G!=C.next.y>G&&C.next.y!==C.y&&N<(C.next.x-C.x)*(G-C.y)/(C.next.y-C.y)+C.x&&(R=!R),C=C.next;while(C!==y);return R}(p,u)&&(Bs(p.prev,p,u.prev)||Bs(p,u.prev,u))||l9(p,u)&&Bs(p.prev,p,p.next)>0&&Bs(u.prev,u,u.next)>0)}function Bs(p,u,y){return(u.y-p.y)*(y.x-u.x)-(u.x-p.x)*(y.y-u.y)}function l9(p,u){return p.x===u.x&&p.y===u.y}function _C(p,u,y,w){var C=u9(Bs(p,u,y)),R=u9(Bs(p,u,w)),N=u9(Bs(y,w,p)),G=u9(Bs(y,w,u));return C!==R&&N!==G||!(C!==0||!c9(p,y,u))||!(R!==0||!c9(p,w,u))||!(N!==0||!c9(y,p,w))||!(G!==0||!c9(y,u,w))}function c9(p,u,y){return u.x<=Math.max(p.x,y.x)&&u.x>=Math.min(p.x,y.x)&&u.y<=Math.max(p.y,y.y)&&u.y>=Math.min(p.y,y.y)}function u9(p){return p>0?1:p<0?-1:0}function e3(p,u){return Bs(p.prev,p,p.next)<0?Bs(p,u,p.next)>=0&&Bs(p,p.prev,u)>=0:Bs(p,u,p.prev)<0||Bs(p,p.next,u)<0}function xC(p,u){var y=new Ov(p.i,p.x,p.y),w=new Ov(u.i,u.x,u.y),C=p.next,R=u.prev;return p.next=u,u.prev=p,y.next=C,C.prev=y,w.next=y,y.prev=w,R.next=w,w.prev=R,w}function vC(p,u,y,w){var C=new Ov(p,u,y);return w?(C.next=w.next,C.prev=w,w.next.prev=C,w.next=C):(C.prev=C,C.next=C),C}function t3(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Ov(p,u,y){this.i=p,this.x=u,this.y=y,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Bv(p,u,y,w){for(var C=0,R=u,N=y-w;R<y;R+=w)C+=(p[N]-p[R])*(p[R+1]+p[N+1]),N=R;return C}Lv.exports=a9,Lv.exports.default=a9,a9.deviation=function(p,u,y,w){var C=u&&u.length,R=Math.abs(Bv(p,0,C?u[0]*y:p.length,y));if(C)for(var N=0,G=u.length;N<G;N++)R-=Math.abs(Bv(p,u[N]*y,N<G-1?u[N+1]*y:p.length,y));var X=0;for(N=0;N<w.length;N+=3){var K=w[N]*y,ae=w[N+1]*y,ue=w[N+2]*y;X+=Math.abs((p[K]-p[ue])*(p[ae+1]-p[K+1])-(p[K]-p[ae])*(p[ue+1]-p[K+1]))}return R===0&&X===0?0:Math.abs((X-R)/R)},a9.flatten=function(p){for(var u=p[0][0].length,y={vertices:[],holes:[],dimensions:u},w=0,C=0;C<p.length;C++){for(var R=0;R<p[C].length;R++)for(var N=0;N<u;N++)y.vertices.push(p[C][R][N]);C>0&&y.holes.push(w+=p[C-1].length)}return y};var bC=o(Lv.exports);function dz(p,u,y,w,C){wC(p,u,y||0,w||p.length-1,C||fz)}function wC(p,u,y,w,C){for(;w>y;){if(w-y>600){var R=w-y+1,N=u-y+1,G=Math.log(R),X=.5*Math.exp(2*G/3),K=.5*Math.sqrt(G*X*(R-X)/R)*(N-R/2<0?-1:1);wC(p,u,Math.max(y,Math.floor(u-N*X/R+K)),Math.min(w,Math.floor(u+(R-N)*X/R+K)),C)}var ae=p[u],ue=y,pe=w;for(i3(p,y,u),C(p[w],ae)>0&&i3(p,y,w);ue<pe;){for(i3(p,ue,pe),ue++,pe--;C(p[ue],ae)<0;)ue++;for(;C(p[pe],ae)>0;)pe--}C(p[y],ae)===0?i3(p,y,pe):i3(p,++pe,w),pe<=u&&(y=pe+1),u<=pe&&(w=pe-1)}}function i3(p,u,y){var w=p[u];p[u]=p[y],p[y]=w}function fz(p,u){return p<u?-1:p>u?1:0}function Uv(p,u){let y=p.length;if(y<=1)return[p];let w=[],C,R;for(let N=0;N<y;N++){let G=z(p[N]);G!==0&&(p[N].area=Math.abs(G),R===void 0&&(R=G<0),R===G<0?(C&&w.push(C),C=[p[N]]):C.push(p[N]))}if(C&&w.push(C),u>1)for(let N=0;N<w.length;N++)w[N].length<=u||(dz(w[N],u,1,w[N].length-1,pz),w[N]=w[N].slice(0,u));return w}function pz(p,u){return u.area-p.area}function zv(p,u,y){let w=y.patternDependencies,C=!1;for(let R of u){let N=R.paint.get(`${p}-pattern`);N.isConstant()||(C=!0);let G=N.constantOr(null);G&&(C=!0,w[G.to]=!0,w[G.from]=!0)}return C}function Gv(p,u,y,w,C){let R=C.patternDependencies;for(let N of u){let G=N.paint.get(`${p}-pattern`).value;if(G.kind!=="constant"){let X=G.evaluate({zoom:w-1},y,{},C.availableImages),K=G.evaluate({zoom:w},y,{},C.availableImages),ae=G.evaluate({zoom:w+1},y,{},C.availableImages);X=X&&X.name?X.name:X,K=K&&K.name?K.name:K,ae=ae&&ae.name?ae.name:ae,R[X]=!0,R[K]=!0,R[ae]=!0,y.patterns[N.id]={min:X,mid:K,max:ae}}}return y}class $v{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(y=>y.id),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new st,this.indexArray=new Jt,this.indexArray2=new Yr,this.programConfigurations=new xu(u.layers,u.zoom),this.segments=new Pi,this.segments2=new Pi,this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id)}populate(u,y,w){this.hasPattern=zv("fill",this.layers,y);let C=this.layers[0].layout.get("fill-sort-key"),R=!C.isConstant(),N=[];for(let{feature:G,id:X,index:K,sourceLayerIndex:ae}of u){let ue=this.layers[0]._featureFilter.needGeometry,pe=Hl(G,ue);if(!this.layers[0]._featureFilter.filter(new ns(this.zoom),pe,w))continue;let ve=R?C.evaluate(pe,{},w,y.availableImages):void 0,we={id:X,properties:G.properties,type:G.type,sourceLayerIndex:ae,index:K,geometry:ue?pe.geometry:Cc(G),patterns:{},sortKey:ve};N.push(we)}R&&N.sort((G,X)=>G.sortKey-X.sortKey);for(let G of N){let{geometry:X,index:K,sourceLayerIndex:ae}=G;if(this.hasPattern){let ue=Gv("fill",this.layers,G,this.zoom,y);this.patternFeatures.push(ue)}else this.addFeature(G,X,K,w,{});y.featureIndex.insert(u[K].feature,X,K,ae,this.index)}}update(u,y,w){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,y,this.stateDependentLayers,w)}addFeatures(u,y,w){for(let C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,y,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,iz),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.indexBuffer2=u.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(u,y,w,C,R){for(let N of Uv(y,500)){let G=0;for(let ve of N)G+=ve.length;let X=this.segments.prepareSegment(G,this.layoutVertexArray,this.indexArray),K=X.vertexLength,ae=[],ue=[];for(let ve of N){if(ve.length===0)continue;ve!==N[0]&&ue.push(ae.length/2);let we=this.segments2.prepareSegment(ve.length,this.layoutVertexArray,this.indexArray2),Ie=we.vertexLength;this.layoutVertexArray.emplaceBack(ve[0].x,ve[0].y),this.indexArray2.emplaceBack(Ie+ve.length-1,Ie),ae.push(ve[0].x),ae.push(ve[0].y);for(let Le=1;Le<ve.length;Le++)this.layoutVertexArray.emplaceBack(ve[Le].x,ve[Le].y),this.indexArray2.emplaceBack(Ie+Le-1,Ie+Le),ae.push(ve[Le].x),ae.push(ve[Le].y);we.vertexLength+=ve.length,we.primitiveLength+=ve.length}let pe=bC(ae,ue);for(let ve=0;ve<pe.length;ve+=3)this.indexArray.emplaceBack(K+pe[ve],K+pe[ve+1],K+pe[ve+2]);X.vertexLength+=G,X.primitiveLength+=pe.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,w,R,C)}}let EC,TC;qt("FillBucket",$v,{omit:["layers","patternFeatures"]});var mz={get paint(){return TC=TC||new ln({"fill-antialias":new pi(Te.paint_fill["fill-antialias"]),"fill-opacity":new Ci(Te.paint_fill["fill-opacity"]),"fill-color":new Ci(Te.paint_fill["fill-color"]),"fill-outline-color":new Ci(Te.paint_fill["fill-outline-color"]),"fill-translate":new pi(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new pi(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new q0(Te.paint_fill["fill-pattern"])})},get layout(){return EC=EC||new ln({"fill-sort-key":new Ci(Te.layout_fill["fill-sort-key"])})}};class gz extends ul{constructor(u){super(u,mz)}recalculate(u,y){super.recalculate(u,y);let w=this.paint._values["fill-outline-color"];w.value.kind==="constant"&&w.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new $v(u)}queryRadius(){return s9(this.paint.get("fill-translate"))}queryIntersectsFeature(u,y,w,C,R,N,G){return nC(n9(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),N.angle,G),C)}isTileClipped(){return!0}}let yz=Ns([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),_z=Ns([{name:"a_centroid",components:2,type:"Int16"}],4),{members:xz}=yz;var I1={},vz=a,SC=nf;function nf(p,u,y,w,C){this.properties={},this.extent=y,this.type=0,this._pbf=p,this._geometry=-1,this._keys=w,this._values=C,p.readFields(bz,this,u)}function bz(p,u,y){p==1?u.id=y.readVarint():p==2?function(w,C){for(var R=w.readVarint()+w.pos;w.pos<R;){var N=C._keys[w.readVarint()],G=C._values[w.readVarint()];C.properties[N]=G}}(y,u):p==3?u.type=y.readVarint():p==4&&(u._geometry=y.pos)}function wz(p){for(var u,y,w=0,C=0,R=p.length,N=R-1;C<R;N=C++)w+=((y=p[N]).x-(u=p[C]).x)*(u.y+y.y);return w}nf.types=["Unknown","Point","LineString","Polygon"],nf.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var u,y=p.readVarint()+p.pos,w=1,C=0,R=0,N=0,G=[];p.pos<y;){if(C<=0){var X=p.readVarint();w=7&X,C=X>>3}if(C--,w===1||w===2)R+=p.readSVarint(),N+=p.readSVarint(),w===1&&(u&&G.push(u),u=[]),u.push(new vz(R,N));else{if(w!==7)throw new Error("unknown command "+w);u&&u.push(u[0].clone())}}return u&&G.push(u),G},nf.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var u=p.readVarint()+p.pos,y=1,w=0,C=0,R=0,N=1/0,G=-1/0,X=1/0,K=-1/0;p.pos<u;){if(w<=0){var ae=p.readVarint();y=7&ae,w=ae>>3}if(w--,y===1||y===2)(C+=p.readSVarint())<N&&(N=C),C>G&&(G=C),(R+=p.readSVarint())<X&&(X=R),R>K&&(K=R);else if(y!==7)throw new Error("unknown command "+y)}return[N,X,G,K]},nf.prototype.toGeoJSON=function(p,u,y){var w,C,R=this.extent*Math.pow(2,y),N=this.extent*p,G=this.extent*u,X=this.loadGeometry(),K=nf.types[this.type];function ae(ve){for(var we=0;we<ve.length;we++){var Ie=ve[we];ve[we]=[360*(Ie.x+N)/R-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ie.y+G)/R)*Math.PI/180))-90]}}switch(this.type){case 1:var ue=[];for(w=0;w<X.length;w++)ue[w]=X[w][0];ae(X=ue);break;case 2:for(w=0;w<X.length;w++)ae(X[w]);break;case 3:for(X=function(ve){var we=ve.length;if(we<=1)return[ve];for(var Ie,Le,Be=[],qe=0;qe<we;qe++){var $e=wz(ve[qe]);$e!==0&&(Le===void 0&&(Le=$e<0),Le===$e<0?(Ie&&Be.push(Ie),Ie=[ve[qe]]):Ie.push(ve[qe]))}return Ie&&Be.push(Ie),Be}(X),w=0;w<X.length;w++)for(C=0;C<X[w].length;C++)ae(X[w][C])}X.length===1?X=X[0]:K="Multi"+K;var pe={type:"Feature",geometry:{type:K,coordinates:X},properties:this.properties};return"id"in this&&(pe.id=this.id),pe};var Ez=SC,AC=CC;function CC(p,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=p,this._keys=[],this._values=[],this._features=[],p.readFields(Tz,this,u),this.length=this._features.length}function Tz(p,u,y){p===15?u.version=y.readVarint():p===1?u.name=y.readString():p===5?u.extent=y.readVarint():p===2?u._features.push(y.pos):p===3?u._keys.push(y.readString()):p===4&&u._values.push(function(w){for(var C=null,R=w.readVarint()+w.pos;w.pos<R;){var N=w.readVarint()>>3;C=N===1?w.readString():N===2?w.readFloat():N===3?w.readDouble():N===4?w.readVarint64():N===5?w.readVarint():N===6?w.readSVarint():N===7?w.readBoolean():null}return C}(y))}CC.prototype.feature=function(p){if(p<0||p>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[p];var u=this._pbf.readVarint()+this._pbf.pos;return new Ez(this._pbf,u,this.extent,this._keys,this._values)};var Sz=AC;function Az(p,u,y){if(p===3){var w=new Sz(y,y.readVarint()+y.pos);w.length&&(u[w.name]=w)}}I1.VectorTile=function(p,u){this.layers=p.readFields(Az,{},u)},I1.VectorTileFeature=SC,I1.VectorTileLayer=AC;let Cz=I1.VectorTileFeature.types,Hv=Math.pow(2,13);function r3(p,u,y,w,C,R,N,G){p.emplaceBack(u,y,2*Math.floor(w*Hv)+N,C*Hv*2,R*Hv*2,Math.round(G))}class Vv{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(y=>y.id),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new nt,this.centroidVertexArray=new Ne,this.indexArray=new Jt,this.programConfigurations=new xu(u.layers,u.zoom),this.segments=new Pi,this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id)}populate(u,y,w){this.features=[],this.hasPattern=zv("fill-extrusion",this.layers,y);for(let{feature:C,id:R,index:N,sourceLayerIndex:G}of u){let X=this.layers[0]._featureFilter.needGeometry,K=Hl(C,X);if(!this.layers[0]._featureFilter.filter(new ns(this.zoom),K,w))continue;let ae={id:R,sourceLayerIndex:G,index:N,geometry:X?K.geometry:Cc(C),properties:C.properties,type:C.type,patterns:{}};this.hasPattern?this.features.push(Gv("fill-extrusion",this.layers,ae,this.zoom,y)):this.addFeature(ae,ae.geometry,N,w,{}),y.featureIndex.insert(C,ae.geometry,N,G,this.index,!0)}}addFeatures(u,y,w){for(let C of this.features){let{geometry:R}=C;this.addFeature(C,R,C.index,y,w)}}update(u,y,w){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,y,this.stateDependentLayers,w)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,xz),this.centroidVertexBuffer=u.createVertexBuffer(this.centroidVertexArray,_z.members,!0),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(u,y,w,C,R){let N={x:0,y:0,vertexCount:0};for(let G of Uv(y,500)){let X=0;for(let we of G)X+=we.length;let K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let we of G){if(we.length===0||kz(we))continue;let Ie=0;for(let Le=0;Le<we.length;Le++){let Be=we[Le];if(Le>=1){let qe=we[Le-1];if(!Iz(Be,qe)){K.vertexLength+4>Pi.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let $e=Be.sub(qe)._perp()._unit(),et=qe.dist(Be);Ie+et>32768&&(Ie=0),r3(this.layoutVertexArray,Be.x,Be.y,$e.x,$e.y,0,0,Ie),r3(this.layoutVertexArray,Be.x,Be.y,$e.x,$e.y,0,1,Ie),N.x+=2*Be.x,N.y+=2*Be.y,N.vertexCount+=2,Ie+=et,r3(this.layoutVertexArray,qe.x,qe.y,$e.x,$e.y,0,0,Ie),r3(this.layoutVertexArray,qe.x,qe.y,$e.x,$e.y,0,1,Ie),N.x+=2*qe.x,N.y+=2*qe.y,N.vertexCount+=2;let it=K.vertexLength;this.indexArray.emplaceBack(it,it+2,it+1),this.indexArray.emplaceBack(it+1,it+2,it+3),K.vertexLength+=4,K.primitiveLength+=2}}}}if(K.vertexLength+X>Pi.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(X,this.layoutVertexArray,this.indexArray)),Cz[u.type]!=="Polygon")continue;let ae=[],ue=[],pe=K.vertexLength;for(let we of G)if(we.length!==0){we!==G[0]&&ue.push(ae.length/2);for(let Ie=0;Ie<we.length;Ie++){let Le=we[Ie];r3(this.layoutVertexArray,Le.x,Le.y,0,0,1,1,0),N.x+=Le.x,N.y+=Le.y,N.vertexCount+=1,ae.push(Le.x),ae.push(Le.y)}}let ve=bC(ae,ue);for(let we=0;we<ve.length;we+=3)this.indexArray.emplaceBack(pe+ve[we],pe+ve[we+2],pe+ve[we+1]);K.primitiveLength+=ve.length/3,K.vertexLength+=X}for(let G=0;G<N.vertexCount;G++)this.centroidVertexArray.emplaceBack(Math.floor(N.x/N.vertexCount),Math.floor(N.y/N.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,w,R,C)}}function Iz(p,u){return p.x===u.x&&(p.x<0||p.x>bs)||p.y===u.y&&(p.y<0||p.y>bs)}function kz(p){return p.every(u=>u.x<0)||p.every(u=>u.x>bs)||p.every(u=>u.y<0)||p.every(u=>u.y>bs)}let IC;qt("FillExtrusionBucket",Vv,{omit:["layers","features"]});var Mz={get paint(){return IC=IC||new ln({"fill-extrusion-opacity":new pi(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ci(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pi(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pi(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new q0(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ci(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ci(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new pi(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Pz extends ul{constructor(u){super(u,Mz)}createBucket(u){return new Vv(u)}queryRadius(){return s9(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(u,y,w,C,R,N,G,X){let K=n9(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),N.angle,G),ae=this.paint.get("fill-extrusion-height").evaluate(y,w),ue=this.paint.get("fill-extrusion-base").evaluate(y,w),pe=function(we,Ie,Le,Be){let qe=[];for(let $e of we){let et=[$e.x,$e.y,0,1];o9(et,et,Ie),qe.push(new c(et[0]/et[3],et[1]/et[3]))}return qe}(K,X),ve=function(we,Ie,Le,Be){let qe=[],$e=[],et=Be[8]*Ie,it=Be[9]*Ie,pt=Be[10]*Ie,Xt=Be[11]*Ie,ci=Be[8]*Le,Ht=Be[9]*Le,Gt=Be[10]*Le,Rt=Be[11]*Le;for(let Kt of we){let Ot=[],Ct=[];for(let xi of Kt){let hi=xi.x,ar=xi.y,ts=Be[0]*hi+Be[4]*ar+Be[12],os=Be[1]*hi+Be[5]*ar+Be[13],un=Be[2]*hi+Be[6]*ar+Be[14],da=Be[3]*hi+Be[7]*ar+Be[15],mo=un+pt,Ys=da+Xt,En=ts+ci,$n=os+Ht,Ro=un+Gt,go=da+Rt,Zs=new c((ts+et)/Ys,(os+it)/Ys);Zs.z=mo/Ys,Ot.push(Zs);let hn=new c(En/go,$n/go);hn.z=Ro/go,Ct.push(hn)}qe.push(Ot),$e.push(Ct)}return[qe,$e]}(C,ue,ae,X);return function(we,Ie,Le){let Be=1/0;nC(Le,Ie)&&(Be=kC(Le,Ie[0]));for(let qe=0;qe<Ie.length;qe++){let $e=Ie[qe],et=we[qe];for(let it=0;it<$e.length-1;it++){let pt=$e[it],Xt=[pt,$e[it+1],et[it+1],et[it],pt];sC(Le,Xt)&&(Be=Math.min(Be,kC(Le,Xt)))}}return Be!==1/0&&Be}(ve[0],ve[1],pe)}}function s3(p,u){return p.x*u.x+p.y*u.y}function kC(p,u){if(p.length===1){let y=0,w=u[y++],C;for(;!C||w.equals(C);)if(C=u[y++],!C)return 1/0;for(;y<u.length;y++){let R=u[y],N=p[0],G=C.sub(w),X=R.sub(w),K=N.sub(w),ae=s3(G,G),ue=s3(G,X),pe=s3(X,X),ve=s3(K,G),we=s3(K,X),Ie=ae*pe-ue*ue,Le=(pe*ve-ue*we)/Ie,Be=(ae*we-ue*ve)/Ie,qe=w.z*(1-Le-Be)+C.z*Le+R.z*Be;if(isFinite(qe))return qe}return 1/0}{let y=1/0;for(let w of u)y=Math.min(y,w.z);return y}}let Rz=Ns([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Dz}=Rz,Fz=Ns([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Lz}=Fz,Nz=I1.VectorTileFeature.types,Oz=Math.cos(Math.PI/180*37.5),MC=Math.pow(2,14)/.5;class jv{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(y=>y.id),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(y=>{this.gradients[y.id]={}}),this.layoutVertexArray=new ft,this.layoutVertexArray2=new At,this.indexArray=new Jt,this.programConfigurations=new xu(u.layers,u.zoom),this.segments=new Pi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id)}populate(u,y,w){this.hasPattern=zv("line",this.layers,y);let C=this.layers[0].layout.get("line-sort-key"),R=!C.isConstant(),N=[];for(let{feature:G,id:X,index:K,sourceLayerIndex:ae}of u){let ue=this.layers[0]._featureFilter.needGeometry,pe=Hl(G,ue);if(!this.layers[0]._featureFilter.filter(new ns(this.zoom),pe,w))continue;let ve=R?C.evaluate(pe,{},w):void 0,we={id:X,properties:G.properties,type:G.type,sourceLayerIndex:ae,index:K,geometry:ue?pe.geometry:Cc(G),patterns:{},sortKey:ve};N.push(we)}R&&N.sort((G,X)=>G.sortKey-X.sortKey);for(let G of N){let{geometry:X,index:K,sourceLayerIndex:ae}=G;if(this.hasPattern){let ue=Gv("line",this.layers,G,this.zoom,y);this.patternFeatures.push(ue)}else this.addFeature(G,X,K,w,{});y.featureIndex.insert(u[K].feature,X,K,ae,this.index)}}update(u,y,w){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,y,this.stateDependentLayers,w)}addFeatures(u,y,w){for(let C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,y,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=u.createVertexBuffer(this.layoutVertexArray2,Lz)),this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,Dz),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(u){if(u.properties&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_end"))return{start:+u.properties.mapbox_clip_start,end:+u.properties.mapbox_clip_end}}addFeature(u,y,w,C,R){let N=this.layers[0].layout,G=N.get("line-join").evaluate(u,{}),X=N.get("line-cap"),K=N.get("line-miter-limit"),ae=N.get("line-round-limit");this.lineClips=this.lineFeatureClips(u);for(let ue of y)this.addLine(ue,u,G,X,K,ae);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,w,R,C)}addLine(u,y,w,C,R,N){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Be=0;Be<u.length-1;Be++)this.totalDistance+=u[Be].dist(u[Be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let G=Nz[y.type]==="Polygon",X=u.length;for(;X>=2&&u[X-1].equals(u[X-2]);)X--;let K=0;for(;K<X-1&&u[K].equals(u[K+1]);)K++;if(X<(G?3:2))return;w==="bevel"&&(R=1.05);let ae=this.overscaling<=16?15*bs/(512*this.overscaling):0,ue=this.segments.prepareSegment(10*X,this.layoutVertexArray,this.indexArray),pe,ve,we,Ie,Le;this.e1=this.e2=-1,G&&(pe=u[X-2],Le=u[K].sub(pe)._unit()._perp());for(let Be=K;Be<X;Be++){if(we=Be===X-1?G?u[K+1]:void 0:u[Be+1],we&&u[Be].equals(we))continue;Le&&(Ie=Le),pe&&(ve=pe),pe=u[Be],Le=we?we.sub(pe)._unit()._perp():Ie,Ie=Ie||Le;let qe=Ie.add(Le);qe.x===0&&qe.y===0||qe._unit();let $e=Ie.x*Le.x+Ie.y*Le.y,et=qe.x*Le.x+qe.y*Le.y,it=et!==0?1/et:1/0,pt=2*Math.sqrt(2-2*et),Xt=et<Oz&&ve&&we,ci=Ie.x*Le.y-Ie.y*Le.x>0;if(Xt&&Be>K){let Rt=pe.dist(ve);if(Rt>2*ae){let Kt=pe.sub(pe.sub(ve)._mult(ae/Rt)._round());this.updateDistance(ve,Kt),this.addCurrentVertex(Kt,Ie,0,0,ue),ve=Kt}}let Ht=ve&&we,Gt=Ht?w:G?"butt":C;if(Ht&&Gt==="round"&&(it<N?Gt="miter":it<=2&&(Gt="fakeround")),Gt==="miter"&&it>R&&(Gt="bevel"),Gt==="bevel"&&(it>2&&(Gt="flipbevel"),it<R&&(Gt="miter")),ve&&this.updateDistance(ve,pe),Gt==="miter")qe._mult(it),this.addCurrentVertex(pe,qe,0,0,ue);else if(Gt==="flipbevel"){if(it>100)qe=Le.mult(-1);else{let Rt=it*Ie.add(Le).mag()/Ie.sub(Le).mag();qe._perp()._mult(Rt*(ci?-1:1))}this.addCurrentVertex(pe,qe,0,0,ue),this.addCurrentVertex(pe,qe.mult(-1),0,0,ue)}else if(Gt==="bevel"||Gt==="fakeround"){let Rt=-Math.sqrt(it*it-1),Kt=ci?Rt:0,Ot=ci?0:Rt;if(ve&&this.addCurrentVertex(pe,Ie,Kt,Ot,ue),Gt==="fakeround"){let Ct=Math.round(180*pt/Math.PI/20);for(let xi=1;xi<Ct;xi++){let hi=xi/Ct;if(hi!==.5){let ts=hi-.5;hi+=hi*ts*(hi-1)*((1.0904+$e*($e*(3.55645-1.43519*$e)-3.2452))*ts*ts+(.848013+$e*(.215638*$e-1.06021)))}let ar=Le.sub(Ie)._mult(hi)._add(Ie)._unit()._mult(ci?-1:1);this.addHalfVertex(pe,ar.x,ar.y,!1,ci,0,ue)}}we&&this.addCurrentVertex(pe,Le,-Kt,-Ot,ue)}else if(Gt==="butt")this.addCurrentVertex(pe,qe,0,0,ue);else if(Gt==="square"){let Rt=ve?1:-1;this.addCurrentVertex(pe,qe,Rt,Rt,ue)}else Gt==="round"&&(ve&&(this.addCurrentVertex(pe,Ie,0,0,ue),this.addCurrentVertex(pe,Ie,1,1,ue,!0)),we&&(this.addCurrentVertex(pe,Le,-1,-1,ue,!0),this.addCurrentVertex(pe,Le,0,0,ue)));if(Xt&&Be<X-1){let Rt=pe.dist(we);if(Rt>2*ae){let Kt=pe.add(we.sub(pe)._mult(ae/Rt)._round());this.updateDistance(pe,Kt),this.addCurrentVertex(Kt,Le,0,0,ue),pe=Kt}}}}addCurrentVertex(u,y,w,C,R,N=!1){let G=y.y*C-y.x,X=-y.y-y.x*C;this.addHalfVertex(u,y.x+y.y*w,y.y-y.x*w,N,!1,w,R),this.addHalfVertex(u,G,X,N,!0,-C,R),this.distance>MC/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(u,y,w,C,R,N))}addHalfVertex({x:u,y},w,C,R,N,G,X){let K=.5*(this.lineClips?this.scaledDistance*(MC-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((u<<1)+(R?1:0),(y<<1)+(N?1:0),Math.round(63*w)+128,Math.round(63*C)+128,1+(G===0?0:G<0?-1:1)|(63&K)<<2,K>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let ae=X.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,ae),X.primitiveLength++),N?this.e2=ae:this.e1=ae}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(u,y){this.distance+=u.dist(y),this.updateScaledDistance()}}let PC,RC;qt("LineBucket",jv,{omit:["layers","patternFeatures"]});var DC={get paint(){return RC=RC||new ln({"line-opacity":new Ci(Te.paint_line["line-opacity"]),"line-color":new Ci(Te.paint_line["line-color"]),"line-translate":new pi(Te.paint_line["line-translate"]),"line-translate-anchor":new pi(Te.paint_line["line-translate-anchor"]),"line-width":new Ci(Te.paint_line["line-width"]),"line-gap-width":new Ci(Te.paint_line["line-gap-width"]),"line-offset":new Ci(Te.paint_line["line-offset"]),"line-blur":new Ci(Te.paint_line["line-blur"]),"line-dasharray":new $p(Te.paint_line["line-dasharray"]),"line-pattern":new q0(Te.paint_line["line-pattern"]),"line-gradient":new Hp(Te.paint_line["line-gradient"])})},get layout(){return PC=PC||new ln({"line-cap":new pi(Te.layout_line["line-cap"]),"line-join":new Ci(Te.layout_line["line-join"]),"line-miter-limit":new pi(Te.layout_line["line-miter-limit"]),"line-round-limit":new pi(Te.layout_line["line-round-limit"]),"line-sort-key":new Ci(Te.layout_line["line-sort-key"])})}};class Bz extends Ci{possiblyEvaluate(u,y){return y=new ns(Math.floor(y.zoom),{now:y.now,fadeDuration:y.fadeDuration,zoomHistory:y.zoomHistory,transition:y.transition}),super.possiblyEvaluate(u,y)}evaluate(u,y,w,C){return y=T({},y,{zoom:Math.floor(y.zoom)}),super.evaluate(u,y,w,C)}}let h9;class Uz extends ul{constructor(u){super(u,DC),this.gradientVersion=0,h9||(h9=new Bz(DC.paint.properties["line-width"].specification),h9.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Nh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(u,y){super.recalculate(u,y),this.paint._values["line-floorwidth"]=h9.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new jv(u)}queryRadius(u){let y=u,w=FC(Zp("line-width",this,y),Zp("line-gap-width",this,y)),C=Zp("line-offset",this,y);return w/2+Math.abs(C)+s9(this.paint.get("line-translate"))}queryIntersectsFeature(u,y,w,C,R,N,G){let X=n9(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),N.angle,G),K=G/2*FC(this.paint.get("line-width").evaluate(y,w),this.paint.get("line-gap-width").evaluate(y,w)),ae=this.paint.get("line-offset").evaluate(y,w);return ae&&(C=function(ue,pe){let ve=[];for(let we=0;we<ue.length;we++){let Ie=ue[we],Le=[];for(let Be=0;Be<Ie.length;Be++){let qe=Ie[Be-1],$e=Ie[Be],et=Ie[Be+1],it=Be===0?new c(0,0):$e.sub(qe)._unit()._perp(),pt=Be===Ie.length-1?new c(0,0):et.sub($e)._unit()._perp(),Xt=it._add(pt)._unit(),ci=Xt.x*pt.x+Xt.y*pt.y;ci!==0&&Xt._mult(1/ci),Le.push(Xt._mult(pe)._add($e))}ve.push(Le)}return ve}(C,ae*G)),function(ue,pe,ve){for(let we=0;we<pe.length;we++){let Ie=pe[we];if(ue.length>=3){for(let Le=0;Le<Ie.length;Le++)if(tf(ue,Ie[Le]))return!0}if(jU(ue,Ie,ve))return!0}return!1}(X,C,K)}isTileClipped(){return!0}}function FC(p,u){return u>0?u+2*p:p}let zz=Ns([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Gz=Ns([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ns([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let $z=Ns([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Ns([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let LC=Ns([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Hz=Ns([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Vz(p,u,y){return p.sections.forEach(w=>{w.text=function(C,R,N){let G=R.layout.get("text-transform").evaluate(N,{});return G==="uppercase"?C=C.toLocaleUpperCase():G==="lowercase"&&(C=C.toLocaleLowerCase()),ha.applyArabicShaping&&(C=ha.applyArabicShaping(C)),C}(w.text,u,y)}),p}Ns([{name:"triangle",components:3,type:"Uint16"}]),Ns([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ns([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ns([{type:"Float32",name:"offsetX"}]),Ns([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ns([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let n3={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var cn=24,NC=Br,OC=function(p,u,y,w,C){var R,N,G=8*C-w-1,X=(1<<G)-1,K=X>>1,ae=-7,ue=y?C-1:0,pe=y?-1:1,ve=p[u+ue];for(ue+=pe,R=ve&(1<<-ae)-1,ve>>=-ae,ae+=G;ae>0;R=256*R+p[u+ue],ue+=pe,ae-=8);for(N=R&(1<<-ae)-1,R>>=-ae,ae+=w;ae>0;N=256*N+p[u+ue],ue+=pe,ae-=8);if(R===0)R=1-K;else{if(R===X)return N?NaN:1/0*(ve?-1:1);N+=Math.pow(2,w),R-=K}return(ve?-1:1)*N*Math.pow(2,R-w)},BC=function(p,u,y,w,C,R){var N,G,X,K=8*R-C-1,ae=(1<<K)-1,ue=ae>>1,pe=C===23?Math.pow(2,-24)-Math.pow(2,-77):0,ve=w?0:R-1,we=w?1:-1,Ie=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(G=isNaN(u)?1:0,N=ae):(N=Math.floor(Math.log(u)/Math.LN2),u*(X=Math.pow(2,-N))<1&&(N--,X*=2),(u+=N+ue>=1?pe/X:pe*Math.pow(2,1-ue))*X>=2&&(N++,X/=2),N+ue>=ae?(G=0,N=ae):N+ue>=1?(G=(u*X-1)*Math.pow(2,C),N+=ue):(G=u*Math.pow(2,ue-1)*Math.pow(2,C),N=0));C>=8;p[y+ve]=255&G,ve+=we,G/=256,C-=8);for(N=N<<C|G,K+=C;K>0;p[y+ve]=255&N,ve+=we,N/=256,K-=8);p[y+ve-we]|=128*Ie};function Br(p){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(p)?p:new Uint8Array(p||0),this.pos=0,this.type=0,this.length=this.buf.length}Br.Varint=0,Br.Fixed64=1,Br.Bytes=2,Br.Fixed32=5;var Xv=4294967296,UC=1/Xv,zC=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function vu(p){return p.type===Br.Bytes?p.readVarint()+p.pos:p.pos+1}function of(p,u,y){return y?4294967296*u+(p>>>0):4294967296*(u>>>0)+(p>>>0)}function GC(p,u,y){var w=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));y.realloc(w);for(var C=y.pos-1;C>=p;C--)y.buf[C+w]=y.buf[C]}function jz(p,u){for(var y=0;y<p.length;y++)u.writeVarint(p[y])}function Xz(p,u){for(var y=0;y<p.length;y++)u.writeSVarint(p[y])}function Wz(p,u){for(var y=0;y<p.length;y++)u.writeFloat(p[y])}function qz(p,u){for(var y=0;y<p.length;y++)u.writeDouble(p[y])}function Yz(p,u){for(var y=0;y<p.length;y++)u.writeBoolean(p[y])}function Zz(p,u){for(var y=0;y<p.length;y++)u.writeFixed32(p[y])}function Qz(p,u){for(var y=0;y<p.length;y++)u.writeSFixed32(p[y])}function Kz(p,u){for(var y=0;y<p.length;y++)u.writeFixed64(p[y])}function Jz(p,u){for(var y=0;y<p.length;y++)u.writeSFixed64(p[y])}function d9(p,u){return(p[u]|p[u+1]<<8|p[u+2]<<16)+16777216*p[u+3]}function af(p,u,y){p[y]=u,p[y+1]=u>>>8,p[y+2]=u>>>16,p[y+3]=u>>>24}function $C(p,u){return(p[u]|p[u+1]<<8|p[u+2]<<16)+(p[u+3]<<24)}Br.prototype={destroy:function(){this.buf=null},readFields:function(p,u,y){for(y=y||this.length;this.pos<y;){var w=this.readVarint(),C=w>>3,R=this.pos;this.type=7&w,p(C,u,this),this.pos===R&&this.skip(w)}return u},readMessage:function(p,u){return this.readFields(p,u,this.readVarint()+this.pos)},readFixed32:function(){var p=d9(this.buf,this.pos);return this.pos+=4,p},readSFixed32:function(){var p=$C(this.buf,this.pos);return this.pos+=4,p},readFixed64:function(){var p=d9(this.buf,this.pos)+d9(this.buf,this.pos+4)*Xv;return this.pos+=8,p},readSFixed64:function(){var p=d9(this.buf,this.pos)+$C(this.buf,this.pos+4)*Xv;return this.pos+=8,p},readFloat:function(){var p=OC(this.buf,this.pos,!0,23,4);return this.pos+=4,p},readDouble:function(){var p=OC(this.buf,this.pos,!0,52,8);return this.pos+=8,p},readVarint:function(p){var u,y,w=this.buf;return u=127&(y=w[this.pos++]),y<128?u:(u|=(127&(y=w[this.pos++]))<<7,y<128?u:(u|=(127&(y=w[this.pos++]))<<14,y<128?u:(u|=(127&(y=w[this.pos++]))<<21,y<128?u:function(C,R,N){var G,X,K=N.buf;if(G=(112&(X=K[N.pos++]))>>4,X<128||(G|=(127&(X=K[N.pos++]))<<3,X<128)||(G|=(127&(X=K[N.pos++]))<<10,X<128)||(G|=(127&(X=K[N.pos++]))<<17,X<128)||(G|=(127&(X=K[N.pos++]))<<24,X<128)||(G|=(1&(X=K[N.pos++]))<<31,X<128))return of(C,G,R);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(y=w[this.pos]))<<28,p,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var p=this.readVarint();return p%2==1?(p+1)/-2:p/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var p=this.readVarint()+this.pos,u=this.pos;return this.pos=p,p-u>=12&&zC?function(y,w,C){return zC.decode(y.subarray(w,C))}(this.buf,u,p):function(y,w,C){for(var R="",N=w;N<C;){var G,X,K,ae=y[N],ue=null,pe=ae>239?4:ae>223?3:ae>191?2:1;if(N+pe>C)break;pe===1?ae<128&&(ue=ae):pe===2?(192&(G=y[N+1]))==128&&(ue=(31&ae)<<6|63&G)<=127&&(ue=null):pe===3?(X=y[N+2],(192&(G=y[N+1]))==128&&(192&X)==128&&((ue=(15&ae)<<12|(63&G)<<6|63&X)<=2047||ue>=55296&&ue<=57343)&&(ue=null)):pe===4&&(X=y[N+2],K=y[N+3],(192&(G=y[N+1]))==128&&(192&X)==128&&(192&K)==128&&((ue=(15&ae)<<18|(63&G)<<12|(63&X)<<6|63&K)<=65535||ue>=1114112)&&(ue=null)),ue===null?(ue=65533,pe=1):ue>65535&&(ue-=65536,R+=String.fromCharCode(ue>>>10&1023|55296),ue=56320|1023&ue),R+=String.fromCharCode(ue),N+=pe}return R}(this.buf,u,p)},readBytes:function(){var p=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,p);return this.pos=p,u},readPackedVarint:function(p,u){if(this.type!==Br.Bytes)return p.push(this.readVarint(u));var y=vu(this);for(p=p||[];this.pos<y;)p.push(this.readVarint(u));return p},readPackedSVarint:function(p){if(this.type!==Br.Bytes)return p.push(this.readSVarint());var u=vu(this);for(p=p||[];this.pos<u;)p.push(this.readSVarint());return p},readPackedBoolean:function(p){if(this.type!==Br.Bytes)return p.push(this.readBoolean());var u=vu(this);for(p=p||[];this.pos<u;)p.push(this.readBoolean());return p},readPackedFloat:function(p){if(this.type!==Br.Bytes)return p.push(this.readFloat());var u=vu(this);for(p=p||[];this.pos<u;)p.push(this.readFloat());return p},readPackedDouble:function(p){if(this.type!==Br.Bytes)return p.push(this.readDouble());var u=vu(this);for(p=p||[];this.pos<u;)p.push(this.readDouble());return p},readPackedFixed32:function(p){if(this.type!==Br.Bytes)return p.push(this.readFixed32());var u=vu(this);for(p=p||[];this.pos<u;)p.push(this.readFixed32());return p},readPackedSFixed32:function(p){if(this.type!==Br.Bytes)return p.push(this.readSFixed32());var u=vu(this);for(p=p||[];this.pos<u;)p.push(this.readSFixed32());return p},readPackedFixed64:function(p){if(this.type!==Br.Bytes)return p.push(this.readFixed64());var u=vu(this);for(p=p||[];this.pos<u;)p.push(this.readFixed64());return p},readPackedSFixed64:function(p){if(this.type!==Br.Bytes)return p.push(this.readSFixed64());var u=vu(this);for(p=p||[];this.pos<u;)p.push(this.readSFixed64());return p},skip:function(p){var u=7&p;if(u===Br.Varint)for(;this.buf[this.pos++]>127;);else if(u===Br.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Br.Fixed32)this.pos+=4;else{if(u!==Br.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(p,u){this.writeVarint(p<<3|u)},realloc:function(p){for(var u=this.length||16;u<this.pos+p;)u*=2;if(u!==this.length){var y=new Uint8Array(u);y.set(this.buf),this.buf=y,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(p){this.realloc(4),af(this.buf,p,this.pos),this.pos+=4},writeSFixed32:function(p){this.realloc(4),af(this.buf,p,this.pos),this.pos+=4},writeFixed64:function(p){this.realloc(8),af(this.buf,-1&p,this.pos),af(this.buf,Math.floor(p*UC),this.pos+4),this.pos+=8},writeSFixed64:function(p){this.realloc(8),af(this.buf,-1&p,this.pos),af(this.buf,Math.floor(p*UC),this.pos+4),this.pos+=8},writeVarint:function(p){(p=+p||0)>268435455||p<0?function(u,y){var w,C;if(u>=0?(w=u%4294967296|0,C=u/4294967296|0):(C=~(-u/4294967296),4294967295^(w=~(-u%4294967296))?w=w+1|0:(w=0,C=C+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");y.realloc(10),function(R,N,G){G.buf[G.pos++]=127&R|128,R>>>=7,G.buf[G.pos++]=127&R|128,R>>>=7,G.buf[G.pos++]=127&R|128,R>>>=7,G.buf[G.pos++]=127&R|128,G.buf[G.pos]=127&(R>>>=7)}(w,0,y),function(R,N){var G=(7&R)<<4;N.buf[N.pos++]|=G|((R>>>=3)?128:0),R&&(N.buf[N.pos++]=127&R|((R>>>=7)?128:0),R&&(N.buf[N.pos++]=127&R|((R>>>=7)?128:0),R&&(N.buf[N.pos++]=127&R|((R>>>=7)?128:0),R&&(N.buf[N.pos++]=127&R|((R>>>=7)?128:0),R&&(N.buf[N.pos++]=127&R)))))}(C,y)}(p,this):(this.realloc(4),this.buf[this.pos++]=127&p|(p>127?128:0),p<=127||(this.buf[this.pos++]=127&(p>>>=7)|(p>127?128:0),p<=127||(this.buf[this.pos++]=127&(p>>>=7)|(p>127?128:0),p<=127||(this.buf[this.pos++]=p>>>7&127))))},writeSVarint:function(p){this.writeVarint(p<0?2*-p-1:2*p)},writeBoolean:function(p){this.writeVarint(!!p)},writeString:function(p){p=String(p),this.realloc(4*p.length),this.pos++;var u=this.pos;this.pos=function(w,C,R){for(var N,G,X=0;X<C.length;X++){if((N=C.charCodeAt(X))>55295&&N<57344){if(!G){N>56319||X+1===C.length?(w[R++]=239,w[R++]=191,w[R++]=189):G=N;continue}if(N<56320){w[R++]=239,w[R++]=191,w[R++]=189,G=N;continue}N=G-55296<<10|N-56320|65536,G=null}else G&&(w[R++]=239,w[R++]=191,w[R++]=189,G=null);N<128?w[R++]=N:(N<2048?w[R++]=N>>6|192:(N<65536?w[R++]=N>>12|224:(w[R++]=N>>18|240,w[R++]=N>>12&63|128),w[R++]=N>>6&63|128),w[R++]=63&N|128)}return R}(this.buf,p,this.pos);var y=this.pos-u;y>=128&&GC(u,y,this),this.pos=u-1,this.writeVarint(y),this.pos+=y},writeFloat:function(p){this.realloc(4),BC(this.buf,p,this.pos,!0,23,4),this.pos+=4},writeDouble:function(p){this.realloc(8),BC(this.buf,p,this.pos,!0,52,8),this.pos+=8},writeBytes:function(p){var u=p.length;this.writeVarint(u),this.realloc(u);for(var y=0;y<u;y++)this.buf[this.pos++]=p[y]},writeRawMessage:function(p,u){this.pos++;var y=this.pos;p(u,this);var w=this.pos-y;w>=128&&GC(y,w,this),this.pos=y-1,this.writeVarint(w),this.pos+=w},writeMessage:function(p,u,y){this.writeTag(p,Br.Bytes),this.writeRawMessage(u,y)},writePackedVarint:function(p,u){u.length&&this.writeMessage(p,jz,u)},writePackedSVarint:function(p,u){u.length&&this.writeMessage(p,Xz,u)},writePackedBoolean:function(p,u){u.length&&this.writeMessage(p,Yz,u)},writePackedFloat:function(p,u){u.length&&this.writeMessage(p,Wz,u)},writePackedDouble:function(p,u){u.length&&this.writeMessage(p,qz,u)},writePackedFixed32:function(p,u){u.length&&this.writeMessage(p,Zz,u)},writePackedSFixed32:function(p,u){u.length&&this.writeMessage(p,Qz,u)},writePackedFixed64:function(p,u){u.length&&this.writeMessage(p,Kz,u)},writePackedSFixed64:function(p,u){u.length&&this.writeMessage(p,Jz,u)},writeBytesField:function(p,u){this.writeTag(p,Br.Bytes),this.writeBytes(u)},writeFixed32Field:function(p,u){this.writeTag(p,Br.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(p,u){this.writeTag(p,Br.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(p,u){this.writeTag(p,Br.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(p,u){this.writeTag(p,Br.Fixed64),this.writeSFixed64(u)},writeVarintField:function(p,u){this.writeTag(p,Br.Varint),this.writeVarint(u)},writeSVarintField:function(p,u){this.writeTag(p,Br.Varint),this.writeSVarint(u)},writeStringField:function(p,u){this.writeTag(p,Br.Bytes),this.writeString(u)},writeFloatField:function(p,u){this.writeTag(p,Br.Fixed32),this.writeFloat(u)},writeDoubleField:function(p,u){this.writeTag(p,Br.Fixed64),this.writeDouble(u)},writeBooleanField:function(p,u){this.writeVarintField(p,!!u)}};var Wv=o(NC);let qv=3;function eG(p,u,y){p===1&&y.readMessage(tG,u)}function tG(p,u,y){if(p===3){let{id:w,bitmap:C,width:R,height:N,left:G,top:X,advance:K}=y.readMessage(iG,{});u.push({id:w,bitmap:new Kp({width:R+2*qv,height:N+2*qv},C),metrics:{width:R,height:N,left:G,top:X,advance:K}})}}function iG(p,u,y){p===1?u.id=y.readVarint():p===2?u.bitmap=y.readBytes():p===3?u.width=y.readVarint():p===4?u.height=y.readVarint():p===5?u.left=y.readSVarint():p===6?u.top=y.readSVarint():p===7&&(u.advance=y.readVarint())}let HC=qv;function VC(p){let u=0,y=0;for(let N of p)u+=N.w*N.h,y=Math.max(y,N.w);p.sort((N,G)=>G.h-N.h);let w=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),y),h:1/0}],C=0,R=0;for(let N of p)for(let G=w.length-1;G>=0;G--){let X=w[G];if(!(N.w>X.w||N.h>X.h)){if(N.x=X.x,N.y=X.y,R=Math.max(R,N.y+N.h),C=Math.max(C,N.x+N.w),N.w===X.w&&N.h===X.h){let K=w.pop();G<w.length&&(w[G]=K)}else N.h===X.h?(X.x+=N.w,X.w-=N.w):N.w===X.w?(X.y+=N.h,X.h-=N.h):(w.push({x:X.x+N.w,y:X.y,w:X.w-N.w,h:N.h}),X.y+=N.h,X.h-=N.h);break}}return{w:C,h:R,fill:u/(C*R)||0}}let Po=1;class Yv{constructor(u,{pixelRatio:y,version:w,stretchX:C,stretchY:R,content:N}){this.paddedRect=u,this.pixelRatio=y,this.stretchX=C,this.stretchY=R,this.content=N,this.version=w}get tl(){return[this.paddedRect.x+Po,this.paddedRect.y+Po]}get br(){return[this.paddedRect.x+this.paddedRect.w-Po,this.paddedRect.y+this.paddedRect.h-Po]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Po)/this.pixelRatio,(this.paddedRect.h-2*Po)/this.pixelRatio]}}class jC{constructor(u,y){let w={},C={};this.haveRenderCallbacks=[];let R=[];this.addImages(u,w,R),this.addImages(y,C,R);let{w:N,h:G}=VC(R),X=new La({width:N||1,height:G||1});for(let K in u){let ae=u[K],ue=w[K].paddedRect;La.copy(ae.data,X,{x:0,y:0},{x:ue.x+Po,y:ue.y+Po},ae.data)}for(let K in y){let ae=y[K],ue=C[K].paddedRect,pe=ue.x+Po,ve=ue.y+Po,we=ae.data.width,Ie=ae.data.height;La.copy(ae.data,X,{x:0,y:0},{x:pe,y:ve},ae.data),La.copy(ae.data,X,{x:0,y:Ie-1},{x:pe,y:ve-1},{width:we,height:1}),La.copy(ae.data,X,{x:0,y:0},{x:pe,y:ve+Ie},{width:we,height:1}),La.copy(ae.data,X,{x:we-1,y:0},{x:pe-1,y:ve},{width:1,height:Ie}),La.copy(ae.data,X,{x:0,y:0},{x:pe+we,y:ve},{width:1,height:Ie})}this.image=X,this.iconPositions=w,this.patternPositions=C}addImages(u,y,w){for(let C in u){let R=u[C],N={x:0,y:0,w:R.data.width+2*Po,h:R.data.height+2*Po};w.push(N),y[C]=new Yv(N,R),R.hasRenderCallback&&this.haveRenderCallbacks.push(C)}}patchUpdatedImages(u,y){u.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let w in u.updatedImages)this.patchUpdatedImage(this.iconPositions[w],u.getImage(w),y),this.patchUpdatedImage(this.patternPositions[w],u.getImage(w),y)}patchUpdatedImage(u,y,w){if(!u||!y||u.version===y.version)return;u.version=y.version;let[C,R]=u.tl;w.update(y.data,void 0,{x:C,y:R})}}var k1;qt("ImagePosition",Yv),qt("ImageAtlas",jC),n.WritingMode=void 0,(k1=n.WritingMode||(n.WritingMode={}))[k1.none=0]="none",k1[k1.horizontal=1]="horizontal",k1[k1.vertical=2]="vertical",k1[k1.horizontalOnly=3]="horizontalOnly";let o3=-17;class a3{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(u,y){let w=new a3;return w.scale=u||1,w.fontStack=y,w}static forImage(u){let y=new a3;return y.imageName=u,y}}class lf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(u,y){let w=new lf;for(let C=0;C<u.sections.length;C++){let R=u.sections[C];R.image?w.addImageSection(R):w.addTextSection(R,y)}return w}length(){return this.text.length}getSection(u){return this.sections[this.sectionIndex[u]]}getSectionIndex(u){return this.sectionIndex[u]}getCharCode(u){return this.text.charCodeAt(u)}verticalizePunctuation(){this.text=function(u){let y="";for(let w=0;w<u.length;w++){let C=u.charCodeAt(w+1)||null,R=u.charCodeAt(w-1)||null;y+=C&&Fp(C)&&!n3[u[w+1]]||R&&Fp(R)&&!n3[u[w-1]]||!n3[u[w]]?u[w]:n3[u[w]]}return y}(this.text)}trim(){let u=0;for(let w=0;w<this.text.length&&p9[this.text.charCodeAt(w)];w++)u++;let y=this.text.length;for(let w=this.text.length-1;w>=0&&w>=u&&p9[this.text.charCodeAt(w)];w--)y--;this.text=this.text.substring(u,y),this.sectionIndex=this.sectionIndex.slice(u,y)}substring(u,y){let w=new lf;return w.text=this.text.substring(u,y),w.sectionIndex=this.sectionIndex.slice(u,y),w.sections=this.sections,w}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((u,y)=>Math.max(u,this.sections[y].scale),0)}addTextSection(u,y){this.text+=u.text,this.sections.push(a3.forText(u.scale,u.fontStack||y));let w=this.sections.length-1;for(let C=0;C<u.text.length;++C)this.sectionIndex.push(w)}addImageSection(u){let y=u.image?u.image.name:"";if(y.length===0)return void B("Can't add FormattedSection with an empty image.");let w=this.getNextImageSectionCharCode();w?(this.text+=String.fromCharCode(w),this.sections.push(a3.forImage(y)),this.sectionIndex.push(this.sections.length-1)):B("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function f9(p,u,y,w,C,R,N,G,X,K,ae,ue,pe,ve,we,Ie){let Le=lf.fromFeature(p,C),Be;ue===n.WritingMode.vertical&&Le.verticalizePunctuation();let{processBidirectionalText:qe,processStyledBidirectionalText:$e}=ha;if(qe&&Le.sections.length===1){Be=[];let pt=qe(Le.toString(),Zv(Le,K,R,u,w,ve,we));for(let Xt of pt){let ci=new lf;ci.text=Xt,ci.sections=Le.sections;for(let Ht=0;Ht<Xt.length;Ht++)ci.sectionIndex.push(0);Be.push(ci)}}else if($e){Be=[];let pt=$e(Le.text,Le.sectionIndex,Zv(Le,K,R,u,w,ve,we));for(let Xt of pt){let ci=new lf;ci.text=Xt[0],ci.sectionIndex=Xt[1],ci.sections=Le.sections,Be.push(ci)}}else Be=function(pt,Xt){let ci=[],Ht=pt.text,Gt=0;for(let Rt of Xt)ci.push(pt.substring(Gt,Rt)),Gt=Rt;return Gt<Ht.length&&ci.push(pt.substring(Gt,Ht.length)),ci}(Le,Zv(Le,K,R,u,w,ve,we));let et=[],it={positionedLines:et,text:Le.toString(),top:ae[1],bottom:ae[1],left:ae[0],right:ae[0],writingMode:ue,iconsInText:!1,verticalizable:!1};return function(pt,Xt,ci,Ht,Gt,Rt,Kt,Ot,Ct,xi,hi,ar){let ts=0,os=o3,un=0,da=0,mo=Ot==="right"?1:Ot==="left"?0:.5,Ys=0;for(let Zs of Gt){Zs.trim();let hn=Zs.getMaxScale(),Kn=(hn-1)*cn,yo={positionedGlyphs:[],lineOffset:0};pt.positionedLines[Ys]=yo;let Do=yo.positionedGlyphs,Fo=0;if(!Zs.length()){os+=Rt,++Ys;continue}for(let Hn=0;Hn<Zs.length();Hn++){let pr=Zs.getSection(Hn),fa=Zs.getSectionIndex(Hn),Vn=Zs.getCharCode(Hn),_o=0,hl=null,Vl=null,jl=null,bu=cn,dl=!(Ct===n.WritingMode.horizontal||!hi&&!b1(Vn)||hi&&(p9[Vn]||(En=Vn,jt.Arabic(En)||jt["Arabic Supplement"](En)||jt["Arabic Extended-A"](En)||jt["Arabic Presentation Forms-A"](En)||jt["Arabic Presentation Forms-B"](En))));if(pr.imageName){let Oa=Ht[pr.imageName];if(!Oa)continue;jl=pr.imageName,pt.iconsInText=pt.iconsInText||!0,Vl=Oa.paddedRect;let Lo=Oa.displaySize;pr.scale=pr.scale*cn/ar,hl={width:Lo[0],height:Lo[1],left:Po,top:-HC,advance:dl?Lo[1]:Lo[0]},_o=Kn+(cn-Lo[1]*pr.scale),bu=hl.advance;let wu=dl?Lo[0]*pr.scale-cn*hn:Lo[1]*pr.scale-cn*hn;wu>0&&wu>Fo&&(Fo=wu)}else{let Oa=ci[pr.fontStack],Lo=Oa&&Oa[Vn];if(Lo&&Lo.rect)Vl=Lo.rect,hl=Lo.metrics;else{let wu=Xt[pr.fontStack],d3=wu&&wu[Vn];if(!d3)continue;hl=d3.metrics}_o=(hn-pr.scale)*cn}dl?(pt.verticalizable=!0,Do.push({glyph:Vn,imageName:jl,x:ts,y:os+_o,vertical:dl,scale:pr.scale,fontStack:pr.fontStack,sectionIndex:fa,metrics:hl,rect:Vl}),ts+=bu*pr.scale+xi):(Do.push({glyph:Vn,imageName:jl,x:ts,y:os+_o,vertical:dl,scale:pr.scale,fontStack:pr.fontStack,sectionIndex:fa,metrics:hl,rect:Vl}),ts+=hl.advance*pr.scale+xi)}Do.length!==0&&(un=Math.max(ts-xi,un),nG(Do,0,Do.length-1,mo,Fo)),ts=0;let Is=Rt*hn+Fo;yo.lineOffset=Math.max(Fo,Kn),os+=Is,da=Math.max(Is,da),++Ys}var En;let $n=os-o3,{horizontalAlign:Ro,verticalAlign:go}=Qv(Kt);(function(Zs,hn,Kn,yo,Do,Fo,Is,Hn,pr){let fa=(hn-Kn)*Do,Vn=0;Vn=Fo!==Is?-Hn*yo-o3:(-yo*pr+.5)*Is;for(let _o of Zs)for(let hl of _o.positionedGlyphs)hl.x+=fa,hl.y+=Vn})(pt.positionedLines,mo,Ro,go,un,da,Rt,$n,Gt.length),pt.top+=-go*$n,pt.bottom=pt.top+$n,pt.left+=-Ro*un,pt.right=pt.left+un}(it,u,y,w,Be,N,G,X,ue,K,pe,Ie),!function(pt){for(let Xt of pt)if(Xt.positionedGlyphs.length!==0)return!1;return!0}(et)&&it}let p9={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},rG={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function XC(p,u,y,w,C,R){if(u.imageName){let N=w[u.imageName];return N?N.displaySize[0]*u.scale*cn/R+C:0}{let N=y[u.fontStack],G=N&&N[p];return G?G.metrics.advance*u.scale+C:0}}function WC(p,u,y,w){let C=Math.pow(p-u,2);return w?p<u?C/2:2*C:C+Math.abs(y)*y}function sG(p,u,y){let w=0;return p===10&&(w-=1e4),y&&(w+=150),p!==40&&p!==65288||(w+=50),u!==41&&u!==65289||(w+=50),w}function qC(p,u,y,w,C,R){let N=null,G=WC(u,y,C,R);for(let X of w){let K=WC(u-X.x,y,C,R)+X.badness;K<=G&&(N=X,G=K)}return{index:p,x:u,priorBreak:N,badness:G}}function YC(p){return p?YC(p.priorBreak).concat(p.index):[]}function Zv(p,u,y,w,C,R,N){if(R!=="point")return[];if(!p)return[];let G=[],X=function(pe,ve,we,Ie,Le,Be){let qe=0;for(let $e=0;$e<pe.length();$e++){let et=pe.getSection($e);qe+=XC(pe.getCharCode($e),et,Ie,Le,ve,Be)}return qe/Math.max(1,Math.ceil(qe/we))}(p,u,y,w,C,N),K=p.text.indexOf("\u200B")>=0,ae=0;for(let pe=0;pe<p.length();pe++){let ve=p.getSection(pe),we=p.getCharCode(pe);if(p9[we]||(ae+=XC(we,ve,w,C,u,N)),pe<p.length()-1){let Ie=!((ue=we)<11904||!(jt["Bopomofo Extended"](ue)||jt.Bopomofo(ue)||jt["CJK Compatibility Forms"](ue)||jt["CJK Compatibility Ideographs"](ue)||jt["CJK Compatibility"](ue)||jt["CJK Radicals Supplement"](ue)||jt["CJK Strokes"](ue)||jt["CJK Symbols and Punctuation"](ue)||jt["CJK Unified Ideographs Extension A"](ue)||jt["CJK Unified Ideographs"](ue)||jt["Enclosed CJK Letters and Months"](ue)||jt["Halfwidth and Fullwidth Forms"](ue)||jt.Hiragana(ue)||jt["Ideographic Description Characters"](ue)||jt["Kangxi Radicals"](ue)||jt["Katakana Phonetic Extensions"](ue)||jt.Katakana(ue)||jt["Vertical Forms"](ue)||jt["Yi Radicals"](ue)||jt["Yi Syllables"](ue)));(rG[we]||Ie||ve.imageName)&&G.push(qC(pe+1,ae,X,G,sG(we,p.getCharCode(pe+1),Ie&&K),!1))}}var ue;return YC(qC(p.length(),ae,X,G,0,!0))}function Qv(p){let u=.5,y=.5;switch(p){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(p){case"bottom":case"bottom-right":case"bottom-left":y=1;break;case"top":case"top-right":case"top-left":y=0}return{horizontalAlign:u,verticalAlign:y}}function nG(p,u,y,w,C){if(!w&&!C)return;let R=p[y],N=(p[y].x+R.metrics.advance*R.scale)*w;for(let G=u;G<=y;G++)p[G].x-=N,p[G].y+=C}function oG(p,u,y){let{horizontalAlign:w,verticalAlign:C}=Qv(y),R=u[0]-p.displaySize[0]*w,N=u[1]-p.displaySize[1]*C;return{image:p,top:N,bottom:N+p.displaySize[1],left:R,right:R+p.displaySize[0]}}function ZC(p,u,y,w,C,R){let N=p.image,G;if(N.content){let Le=N.content,Be=N.pixelRatio||1;G=[Le[0]/Be,Le[1]/Be,N.displaySize[0]-Le[2]/Be,N.displaySize[1]-Le[3]/Be]}let X=u.left*R,K=u.right*R,ae,ue,pe,ve;y==="width"||y==="both"?(ve=C[0]+X-w[3],ue=C[0]+K+w[1]):(ve=C[0]+(X+K-N.displaySize[0])/2,ue=ve+N.displaySize[0]);let we=u.top*R,Ie=u.bottom*R;return y==="height"||y==="both"?(ae=C[1]+we-w[0],pe=C[1]+Ie+w[2]):(ae=C[1]+(we+Ie-N.displaySize[1])/2,pe=ae+N.displaySize[1]),{image:N,top:ae,right:ue,bottom:pe,left:ve,collisionPadding:G}}let l3=255,Ic=128,M1=l3*Ic;function QC(p,u){let{expression:y}=u;if(y.kind==="constant")return{kind:"constant",layoutSize:y.evaluate(new ns(p+1))};if(y.kind==="source")return{kind:"source"};{let{zoomStops:w,interpolationType:C}=y,R=0;for(;R<w.length&&w[R]<=p;)R++;R=Math.max(0,R-1);let N=R;for(;N<w.length&&w[N]<p+1;)N++;N=Math.min(w.length-1,N);let G=w[R],X=w[N];return y.kind==="composite"?{kind:"composite",minZoom:G,maxZoom:X,interpolationType:C}:{kind:"camera",minZoom:G,maxZoom:X,minSize:y.evaluate(new ns(G)),maxSize:y.evaluate(new ns(X)),interpolationType:C}}}function Kv(p,u,y){let w="never",C=p.get(u);return C?w=C:p.get(y)&&(w="always"),w}let aG=I1.VectorTileFeature.types,lG=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function m9(p,u,y,w,C,R,N,G,X,K,ae,ue,pe){let ve=G?Math.min(M1,Math.round(G[0])):0,we=G?Math.min(M1,Math.round(G[1])):0;p.emplaceBack(u,y,Math.round(32*w),Math.round(32*C),R,N,(ve<<1)+(X?1:0),we,16*K,16*ae,256*ue,256*pe)}function Jv(p,u,y){p.emplaceBack(u.x,u.y,y),p.emplaceBack(u.x,u.y,y),p.emplaceBack(u.x,u.y,y),p.emplaceBack(u.x,u.y,y)}function cG(p){for(let u of p.sections)if(Cv(u.text))return!0;return!1}class eb{constructor(u){this.layoutVertexArray=new Mt,this.indexArray=new Jt,this.programConfigurations=u,this.segments=new Pi,this.dynamicLayoutVertexArray=new li,this.opacityVertexArray=new dr,this.hasVisibleVertices=!1,this.placedSymbolArray=new se}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(u,y,w,C){this.isEmpty()||(w&&(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,zz.members),this.indexBuffer=u.createIndexBuffer(this.indexArray,y),this.dynamicLayoutVertexBuffer=u.createVertexBuffer(this.dynamicLayoutVertexArray,Gz.members,!0),this.opacityVertexBuffer=u.createVertexBuffer(this.opacityVertexArray,lG,!0),this.opacityVertexBuffer.itemSize=1),(w||C)&&this.programConfigurations.upload(u))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}qt("SymbolBuffers",eb);class tb{constructor(u,y,w){this.layoutVertexArray=new u,this.layoutAttributes=y,this.indexArray=new w,this.segments=new Pi,this.collisionVertexArray=new Ii}upload(u){this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=u.createVertexBuffer(this.collisionVertexArray,$z.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}qt("CollisionBuffers",tb);class cf{constructor(u){this.collisionBoxArray=u.collisionBoxArray,this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(N=>N.id),this.index=u.index,this.pixelRatio=u.pixelRatio,this.sourceLayerIndex=u.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Rv([]),this.placementViewportMatrix=Rv([]);let y=this.layers[0]._unevaluatedLayout._values;this.textSizeData=QC(this.zoom,y["text-size"]),this.iconSizeData=QC(this.zoom,y["icon-size"]);let w=this.layers[0].layout,C=w.get("symbol-sort-key"),R=w.get("symbol-z-order");this.canOverlap=Kv(w,"text-overlap","text-allow-overlap")!=="never"||Kv(w,"icon-overlap","icon-allow-overlap")!=="never"||w.get("text-ignore-placement")||w.get("icon-ignore-placement"),this.sortFeaturesByKey=R!=="viewport-y"&&!C.isConstant(),this.sortFeaturesByY=(R==="viewport-y"||R==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,w.get("symbol-placement")==="point"&&(this.writingModes=w.get("text-writing-mode").map(N=>n.WritingMode[N])),this.stateDependentLayerIds=this.layers.filter(N=>N.isStateDependent()).map(N=>N.id),this.sourceID=u.sourceID}createArrays(){this.text=new eb(new xu(this.layers,this.zoom,u=>/^text/.test(u))),this.icon=new eb(new xu(this.layers,this.zoom,u=>/^icon/.test(u))),this.glyphOffsetArray=new Ce,this.lineVertexArray=new Ae,this.symbolInstances=new _e,this.textAnchorOffsets=new Se}calculateGlyphDependencies(u,y,w,C,R){for(let N=0;N<u.length;N++)if(y[u.charCodeAt(N)]=!0,(w||C)&&R){let G=n3[u.charAt(N)];G&&(y[G.charCodeAt(0)]=!0)}}populate(u,y,w){let C=this.layers[0],R=C.layout,N=R.get("text-font"),G=R.get("text-field"),X=R.get("icon-image"),K=(G.value.kind!=="constant"||G.value.value instanceof Ps&&!G.value.value.isEmpty()||G.value.value.toString().length>0)&&(N.value.kind!=="constant"||N.value.value.length>0),ae=X.value.kind!=="constant"||!!X.value.value||Object.keys(X.parameters).length>0,ue=R.get("symbol-sort-key");if(this.features=[],!K&&!ae)return;let pe=y.iconDependencies,ve=y.glyphDependencies,we=y.availableImages,Ie=new ns(this.zoom);for(let{feature:Le,id:Be,index:qe,sourceLayerIndex:$e}of u){let et=C._featureFilter.needGeometry,it=Hl(Le,et);if(!C._featureFilter.filter(Ie,it,w))continue;let pt,Xt;if(et||(it.geometry=Cc(Le)),K){let Ht=C.getValueAndResolveTokens("text-field",it,w,we),Gt=Ps.factory(Ht);cG(Gt)&&(this.hasRTLText=!0),(!this.hasRTLText||zp()==="unavailable"||this.hasRTLText&&ha.isParsed())&&(pt=Vz(Gt,C,it))}if(ae){let Ht=C.getValueAndResolveTokens("icon-image",it,w,we);Xt=Ht instanceof la?Ht:la.fromString(Ht)}if(!pt&&!Xt)continue;let ci=this.sortFeaturesByKey?ue.evaluate(it,{},w):void 0;if(this.features.push({id:Be,text:pt,icon:Xt,index:qe,sourceLayerIndex:$e,geometry:it.geometry,properties:Le.properties,type:aG[Le.type],sortKey:ci}),Xt&&(pe[Xt.name]=!0),pt){let Ht=N.evaluate(it,{},w).join(","),Gt=R.get("text-rotation-alignment")!=="viewport"&&R.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(n.WritingMode.vertical)>=0;for(let Rt of pt.sections)if(Rt.image)pe[Rt.image.name]=!0;else{let Kt=j0(pt.toString()),Ot=Rt.fontStack||Ht,Ct=ve[Ot]=ve[Ot]||{};this.calculateGlyphDependencies(Rt.text,Ct,Gt,this.allowVerticalPlacement,Kt)}}}R.get("symbol-placement")==="line"&&(this.features=function(Le){let Be={},qe={},$e=[],et=0;function it(Ht){$e.push(Le[Ht]),et++}function pt(Ht,Gt,Rt){let Kt=qe[Ht];return delete qe[Ht],qe[Gt]=Kt,$e[Kt].geometry[0].pop(),$e[Kt].geometry[0]=$e[Kt].geometry[0].concat(Rt[0]),Kt}function Xt(Ht,Gt,Rt){let Kt=Be[Gt];return delete Be[Gt],Be[Ht]=Kt,$e[Kt].geometry[0].shift(),$e[Kt].geometry[0]=Rt[0].concat($e[Kt].geometry[0]),Kt}function ci(Ht,Gt,Rt){let Kt=Rt?Gt[0][Gt[0].length-1]:Gt[0][0];return`${Ht}:${Kt.x}:${Kt.y}`}for(let Ht=0;Ht<Le.length;Ht++){let Gt=Le[Ht],Rt=Gt.geometry,Kt=Gt.text?Gt.text.toString():null;if(!Kt){it(Ht);continue}let Ot=ci(Kt,Rt),Ct=ci(Kt,Rt,!0);if(Ot in qe&&Ct in Be&&qe[Ot]!==Be[Ct]){let xi=Xt(Ot,Ct,Rt),hi=pt(Ot,Ct,$e[xi].geometry);delete Be[Ot],delete qe[Ct],qe[ci(Kt,$e[hi].geometry,!0)]=hi,$e[xi].geometry=null}else Ot in qe?pt(Ot,Ct,Rt):Ct in Be?Xt(Ot,Ct,Rt):(it(Ht),Be[Ot]=et-1,qe[Ct]=et-1)}return $e.filter(Ht=>Ht.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Le,Be)=>Le.sortKey-Be.sortKey)}update(u,y,w){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(u,y,this.layers,w),this.icon.programConfigurations.updatePaintArrays(u,y,this.layers,w))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(u){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(u),this.iconCollisionBox.upload(u)),this.text.upload(u,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(u,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(u,y){let w=this.lineVertexArray.length;if(u.segment!==void 0){let C=u.dist(y[u.segment+1]),R=u.dist(y[u.segment]),N={};for(let G=u.segment+1;G<y.length;G++)N[G]={x:y[G].x,y:y[G].y,tileUnitDistanceFromAnchor:C},G<y.length-1&&(C+=y[G+1].dist(y[G]));for(let G=u.segment||0;G>=0;G--)N[G]={x:y[G].x,y:y[G].y,tileUnitDistanceFromAnchor:R},G>0&&(R+=y[G-1].dist(y[G]));for(let G=0;G<y.length;G++){let X=N[G];this.lineVertexArray.emplaceBack(X.x,X.y,X.tileUnitDistanceFromAnchor)}}return{lineStartIndex:w,lineLength:this.lineVertexArray.length-w}}addSymbols(u,y,w,C,R,N,G,X,K,ae,ue,pe){let ve=u.indexArray,we=u.layoutVertexArray,Ie=u.segments.prepareSegment(4*y.length,we,ve,this.canOverlap?N.sortKey:void 0),Le=this.glyphOffsetArray.length,Be=Ie.vertexLength,qe=this.allowVerticalPlacement&&G===n.WritingMode.vertical?Math.PI/2:0,$e=N.text&&N.text.sections;for(let et=0;et<y.length;et++){let{tl:it,tr:pt,bl:Xt,br:ci,tex:Ht,pixelOffsetTL:Gt,pixelOffsetBR:Rt,minFontScaleX:Kt,minFontScaleY:Ot,glyphOffset:Ct,isSDF:xi,sectionIndex:hi}=y[et],ar=Ie.vertexLength,ts=Ct[1];m9(we,X.x,X.y,it.x,ts+it.y,Ht.x,Ht.y,w,xi,Gt.x,Gt.y,Kt,Ot),m9(we,X.x,X.y,pt.x,ts+pt.y,Ht.x+Ht.w,Ht.y,w,xi,Rt.x,Gt.y,Kt,Ot),m9(we,X.x,X.y,Xt.x,ts+Xt.y,Ht.x,Ht.y+Ht.h,w,xi,Gt.x,Rt.y,Kt,Ot),m9(we,X.x,X.y,ci.x,ts+ci.y,Ht.x+Ht.w,Ht.y+Ht.h,w,xi,Rt.x,Rt.y,Kt,Ot),Jv(u.dynamicLayoutVertexArray,X,qe),ve.emplaceBack(ar,ar+1,ar+2),ve.emplaceBack(ar+1,ar+2,ar+3),Ie.vertexLength+=4,Ie.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ct[0]),et!==y.length-1&&hi===y[et+1].sectionIndex||u.programConfigurations.populatePaintArrays(we.length,N,N.index,{},pe,$e&&$e[hi])}u.placedSymbolArray.emplaceBack(X.x,X.y,Le,this.glyphOffsetArray.length-Le,Be,K,ae,X.segment,w?w[0]:0,w?w[1]:0,C[0],C[1],G,0,!1,0,ue)}_addCollisionDebugVertex(u,y,w,C,R,N){return y.emplaceBack(0,0),u.emplaceBack(w.x,w.y,C,R,Math.round(N.x),Math.round(N.y))}addCollisionDebugVertices(u,y,w,C,R,N,G){let X=R.segments.prepareSegment(4,R.layoutVertexArray,R.indexArray),K=X.vertexLength,ae=R.layoutVertexArray,ue=R.collisionVertexArray,pe=G.anchorX,ve=G.anchorY;this._addCollisionDebugVertex(ae,ue,N,pe,ve,new c(u,y)),this._addCollisionDebugVertex(ae,ue,N,pe,ve,new c(w,y)),this._addCollisionDebugVertex(ae,ue,N,pe,ve,new c(w,C)),this._addCollisionDebugVertex(ae,ue,N,pe,ve,new c(u,C)),X.vertexLength+=4;let we=R.indexArray;we.emplaceBack(K,K+1),we.emplaceBack(K+1,K+2),we.emplaceBack(K+2,K+3),we.emplaceBack(K+3,K),X.primitiveLength+=4}addDebugCollisionBoxes(u,y,w,C){for(let R=u;R<y;R++){let N=this.collisionBoxArray.get(R);this.addCollisionDebugVertices(N.x1,N.y1,N.x2,N.y2,C?this.textCollisionBox:this.iconCollisionBox,N.anchorPoint,w)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new tb(Ut,LC.members,Yr),this.iconCollisionBox=new tb(Ut,LC.members,Yr);for(let u=0;u<this.symbolInstances.length;u++){let y=this.symbolInstances.get(u);this.addDebugCollisionBoxes(y.textBoxStartIndex,y.textBoxEndIndex,y,!0),this.addDebugCollisionBoxes(y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y,!0),this.addDebugCollisionBoxes(y.iconBoxStartIndex,y.iconBoxEndIndex,y,!1),this.addDebugCollisionBoxes(y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y,!1)}}_deserializeCollisionBoxesForSymbol(u,y,w,C,R,N,G,X,K){let ae={};for(let ue=y;ue<w;ue++){let pe=u.get(ue);ae.textBox={x1:pe.x1,y1:pe.y1,x2:pe.x2,y2:pe.y2,anchorPointX:pe.anchorPointX,anchorPointY:pe.anchorPointY},ae.textFeatureIndex=pe.featureIndex;break}for(let ue=C;ue<R;ue++){let pe=u.get(ue);ae.verticalTextBox={x1:pe.x1,y1:pe.y1,x2:pe.x2,y2:pe.y2,anchorPointX:pe.anchorPointX,anchorPointY:pe.anchorPointY},ae.verticalTextFeatureIndex=pe.featureIndex;break}for(let ue=N;ue<G;ue++){let pe=u.get(ue);ae.iconBox={x1:pe.x1,y1:pe.y1,x2:pe.x2,y2:pe.y2,anchorPointX:pe.anchorPointX,anchorPointY:pe.anchorPointY},ae.iconFeatureIndex=pe.featureIndex;break}for(let ue=X;ue<K;ue++){let pe=u.get(ue);ae.verticalIconBox={x1:pe.x1,y1:pe.y1,x2:pe.x2,y2:pe.y2,anchorPointX:pe.anchorPointX,anchorPointY:pe.anchorPointY},ae.verticalIconFeatureIndex=pe.featureIndex;break}return ae}deserializeCollisionBoxes(u){this.collisionArrays=[];for(let y=0;y<this.symbolInstances.length;y++){let w=this.symbolInstances.get(y);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(u,w.textBoxStartIndex,w.textBoxEndIndex,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w.iconBoxStartIndex,w.iconBoxEndIndex,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(u,y){let w=u.placedSymbolArray.get(y),C=w.vertexStartIndex+4*w.numGlyphs;for(let R=w.vertexStartIndex;R<C;R+=4)u.indexArray.emplaceBack(R,R+1,R+2),u.indexArray.emplaceBack(R+1,R+2,R+3)}getSortedSymbolIndexes(u){if(this.sortedAngle===u&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let y=Math.sin(u),w=Math.cos(u),C=[],R=[],N=[];for(let G=0;G<this.symbolInstances.length;++G){N.push(G);let X=this.symbolInstances.get(G);C.push(0|Math.round(y*X.anchorX+w*X.anchorY)),R.push(X.featureIndex)}return N.sort((G,X)=>C[G]-C[X]||R[X]-R[G]),N}addToSortKeyRanges(u,y){let w=this.sortKeyRanges[this.sortKeyRanges.length-1];w&&w.sortKey===y?w.symbolInstanceEnd=u+1:this.sortKeyRanges.push({sortKey:y,symbolInstanceStart:u,symbolInstanceEnd:u+1})}sortFeatures(u){if(this.sortFeaturesByY&&this.sortedAngle!==u&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(u),this.sortedAngle=u,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let y of this.symbolInstanceIndexes){let w=this.symbolInstances.get(y);this.featureSortOrder.push(w.featureIndex),[w.rightJustifiedTextSymbolIndex,w.centerJustifiedTextSymbolIndex,w.leftJustifiedTextSymbolIndex].forEach((C,R,N)=>{C>=0&&N.indexOf(C)===R&&this.addIndicesForPlacedSymbol(this.text,C)}),w.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,w.verticalPlacedTextSymbolIndex),w.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,w.placedIconSymbolIndex),w.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,w.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let KC,JC;qt("SymbolBucket",cf,{omit:["layers","collisionBoxArray","features","compareText"]}),cf.MAX_GLYPHS=65535,cf.addDynamicAttributes=Jv;var ib={get paint(){return JC=JC||new ln({"icon-opacity":new Ci(Te.paint_symbol["icon-opacity"]),"icon-color":new Ci(Te.paint_symbol["icon-color"]),"icon-halo-color":new Ci(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ci(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ci(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new pi(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new pi(Te.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ci(Te.paint_symbol["text-opacity"]),"text-color":new Ci(Te.paint_symbol["text-color"],{runtimeType:qi,getOverride:p=>p.textColor,hasOverride:p=>!!p.textColor}),"text-halo-color":new Ci(Te.paint_symbol["text-halo-color"]),"text-halo-width":new Ci(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new Ci(Te.paint_symbol["text-halo-blur"]),"text-translate":new pi(Te.paint_symbol["text-translate"]),"text-translate-anchor":new pi(Te.paint_symbol["text-translate-anchor"])})},get layout(){return KC=KC||new ln({"symbol-placement":new pi(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new pi(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pi(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ci(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pi(Te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new pi(Te.layout_symbol["icon-allow-overlap"]),"icon-overlap":new pi(Te.layout_symbol["icon-overlap"]),"icon-ignore-placement":new pi(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new pi(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pi(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ci(Te.layout_symbol["icon-size"]),"icon-text-fit":new pi(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new pi(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ci(Te.layout_symbol["icon-image"]),"icon-rotate":new Ci(Te.layout_symbol["icon-rotate"]),"icon-padding":new Ci(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new pi(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new Ci(Te.layout_symbol["icon-offset"]),"icon-anchor":new Ci(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pi(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pi(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pi(Te.layout_symbol["text-rotation-alignment"]),"text-field":new Ci(Te.layout_symbol["text-field"]),"text-font":new Ci(Te.layout_symbol["text-font"]),"text-size":new Ci(Te.layout_symbol["text-size"]),"text-max-width":new Ci(Te.layout_symbol["text-max-width"]),"text-line-height":new pi(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new Ci(Te.layout_symbol["text-letter-spacing"]),"text-justify":new Ci(Te.layout_symbol["text-justify"]),"text-radial-offset":new Ci(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pi(Te.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ci(Te.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ci(Te.layout_symbol["text-anchor"]),"text-max-angle":new pi(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new pi(Te.layout_symbol["text-writing-mode"]),"text-rotate":new Ci(Te.layout_symbol["text-rotate"]),"text-padding":new pi(Te.layout_symbol["text-padding"]),"text-keep-upright":new pi(Te.layout_symbol["text-keep-upright"]),"text-transform":new Ci(Te.layout_symbol["text-transform"]),"text-offset":new Ci(Te.layout_symbol["text-offset"]),"text-allow-overlap":new pi(Te.layout_symbol["text-allow-overlap"]),"text-overlap":new pi(Te.layout_symbol["text-overlap"]),"text-ignore-placement":new pi(Te.layout_symbol["text-ignore-placement"]),"text-optional":new pi(Te.layout_symbol["text-optional"])})}};class eI{constructor(u){if(u.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=u.property.overrides?u.property.overrides.runtimeType:ti,this.defaultValue=u}evaluate(u){if(u.formattedSection){let y=this.defaultValue.property.overrides;if(y&&y.hasOverride(u.formattedSection))return y.getOverride(u.formattedSection)}return u.feature&&u.featureState?this.defaultValue.evaluate(u.feature,u.featureState):this.defaultValue.property.specification.default}eachChild(u){this.defaultValue.isConstant()||u(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qt("FormatSectionOverride",eI,{omit:["defaultValue"]});class g9 extends ul{constructor(u){super(u,ib)}recalculate(u,y){if(super.recalculate(u,y),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let w=this.layout.get("text-writing-mode");if(w){let C=[];for(let R of w)C.indexOf(R)<0&&C.push(R);this.layout._values["text-writing-mode"]=C}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(u,y,w,C){let R=this.layout.get(u).evaluate(y,{},w,C),N=this._unevaluatedLayout._values[u];return N.isDataDriven()||L0(N.value)||!R?R:function(G,X){return X.replace(/{([^{}]+)}/g,(K,ae)=>ae in G?String(G[ae]):"")}(y.properties,R)}createBucket(u){return new cf(u)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let u of ib.paint.overridableProperties){if(!g9.hasPaintOverride(this.layout,u))continue;let y=this.paint.get(u),w=new eI(y),C=new _s(w,y.property.specification),R=null;R=y.value.kind==="constant"||y.value.kind==="source"?new Oh("source",C):new Jr("composite",C,y.value.zoomStops),this.paint._values[u]=new Ra(y.property,R,y.parameters)}}_handleOverridablePaintPropertyUpdate(u,y,w){return!(!this.layout||y.isDataDriven()||w.isDataDriven())&&g9.hasPaintOverride(this.layout,u)}static hasPaintOverride(u,y){let w=u.get("text-field"),C=ib.paint.properties[y],R=!1,N=G=>{for(let X of G)if(C.overrides&&C.overrides.hasOverride(X))return void(R=!0)};if(w.value.kind==="constant"&&w.value.value instanceof Ps)N(w.value.value.sections);else if(w.value.kind==="source"){let G=K=>{R||(K instanceof nu&&Rs(K.value)===kt?N(K.value.sections):K instanceof D0?N(K.sections):K.eachChild(G))},X=w.value;X._styleExpression&&G(X._styleExpression.expression)}return R}}let tI;var uG={get paint(){return tI=tI||new ln({"background-color":new pi(Te.paint_background["background-color"]),"background-pattern":new $p(Te.paint_background["background-pattern"]),"background-opacity":new pi(Te.paint_background["background-opacity"])})}};class hG extends ul{constructor(u){super(u,uG)}}let iI;var dG={get paint(){return iI=iI||new ln({"raster-opacity":new pi(Te.paint_raster["raster-opacity"]),"raster-hue-rotate":new pi(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pi(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pi(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new pi(Te.paint_raster["raster-saturation"]),"raster-contrast":new pi(Te.paint_raster["raster-contrast"]),"raster-resampling":new pi(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new pi(Te.paint_raster["raster-fade-duration"])})}};class fG extends ul{constructor(u){super(u,dG)}}class pG extends ul{constructor(u){super(u,{}),this.onAdd=y=>{this.implementation.onAdd&&this.implementation.onAdd(y,y.painter.context.gl)},this.onRemove=y=>{this.implementation.onRemove&&this.implementation.onRemove(y,y.painter.context.gl)},this.implementation=u}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class mG{constructor(u){this._callback=u,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}let rb=63710088e-1;class P1{constructor(u,y){if(isNaN(u)||isNaN(y))throw new Error(`Invalid LngLat object: (${u}, ${y})`);if(this.lng=+u,this.lat=+y,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new P1(b(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(u){let y=Math.PI/180,w=this.lat*y,C=u.lat*y,R=Math.sin(w)*Math.sin(C)+Math.cos(w)*Math.cos(C)*Math.cos((u.lng-this.lng)*y);return rb*Math.acos(Math.min(R,1))}static convert(u){if(u instanceof P1)return u;if(Array.isArray(u)&&(u.length===2||u.length===3))return new P1(Number(u[0]),Number(u[1]));if(!Array.isArray(u)&&typeof u=="object"&&u!==null)return new P1(Number("lng"in u?u.lng:u.lon),Number(u.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let rI=2*Math.PI*rb;function sI(p){return rI*Math.cos(p*Math.PI/180)}function nI(p){return(180+p)/360}function oI(p){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+p*Math.PI/360)))/360}function aI(p,u){return p/sI(u)}function sb(p){return 360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90}class y9{constructor(u,y,w=0){this.x=+u,this.y=+y,this.z=+w}static fromLngLat(u,y=0){let w=P1.convert(u);return new y9(nI(w.lng),oI(w.lat),aI(y,w.lat))}toLngLat(){return new P1(360*this.x-180,sb(this.y))}toAltitude(){return this.z*sI(sb(this.y))}meterInMercatorCoordinateUnits(){return 1/rI*(u=sb(this.y),1/Math.cos(u*Math.PI/180));var u}}function lI(p,u,y){var w=2*Math.PI*6378137/256/Math.pow(2,y);return[p*w-2*Math.PI*6378137/2,u*w-2*Math.PI*6378137/2]}class nb{constructor(u,y,w){if(u<0||u>25||w<0||w>=Math.pow(2,u)||y<0||y>=Math.pow(2,u))throw new Error(`x=${y}, y=${w}, z=${u} outside of bounds. 0<=x<${Math.pow(2,u)}, 0<=y<${Math.pow(2,u)} 0<=z<=25 `);this.z=u,this.x=y,this.y=w,this.key=c3(0,u,u,y,w)}equals(u){return this.z===u.z&&this.x===u.x&&this.y===u.y}url(u,y,w){let C=(N=this.y,G=this.z,X=lI(256*(R=this.x),256*(N=Math.pow(2,G)-N-1),G),K=lI(256*(R+1),256*(N+1),G),X[0]+","+X[1]+","+K[0]+","+K[1]);var R,N,G,X,K;let ae=function(ue,pe,ve){let we,Ie="";for(let Le=ue;Le>0;Le--)we=1<<Le-1,Ie+=(pe&we?1:0)+(ve&we?2:0);return Ie}(this.z,this.x,this.y);return u[(this.x+this.y)%u.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(w==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,y>1?"@2x":"").replace(/{quadkey}/g,ae).replace(/{bbox-epsg-3857}/g,C)}isChildOf(u){let y=this.z-u.z;return y>0&&u.x===this.x>>y&&u.y===this.y>>y}getTilePoint(u){let y=Math.pow(2,this.z);return new c((u.x*y-this.x)*bs,(u.y*y-this.y)*bs)}toString(){return`${this.z}/${this.x}/${this.y}`}}class cI{constructor(u,y){this.wrap=u,this.canonical=y,this.key=c3(u,y.z,y.z,y.x,y.y)}}class Na{constructor(u,y,w,C,R){if(u<w)throw new Error(`overscaledZ should be >= z; overscaledZ = ${u}; z = ${w}`);this.overscaledZ=u,this.wrap=y,this.canonical=new nb(w,+C,+R),this.key=c3(y,u,w,C,R)}clone(){return new Na(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(u){return this.overscaledZ===u.overscaledZ&&this.wrap===u.wrap&&this.canonical.equals(u.canonical)}scaledTo(u){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);let y=this.canonical.z-u;return u>this.canonical.z?new Na(u,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Na(u,this.wrap,u,this.canonical.x>>y,this.canonical.y>>y)}calculateScaledKey(u,y){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);let w=this.canonical.z-u;return u>this.canonical.z?c3(this.wrap*+y,u,this.canonical.z,this.canonical.x,this.canonical.y):c3(this.wrap*+y,u,u,this.canonical.x>>w,this.canonical.y>>w)}isChildOf(u){if(u.wrap!==this.wrap)return!1;let y=this.canonical.z-u.canonical.z;return u.overscaledZ===0||u.overscaledZ<this.overscaledZ&&u.canonical.x===this.canonical.x>>y&&u.canonical.y===this.canonical.y>>y}children(u){if(this.overscaledZ>=u)return[new Na(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let y=this.canonical.z+1,w=2*this.canonical.x,C=2*this.canonical.y;return[new Na(y,this.wrap,y,w,C),new Na(y,this.wrap,y,w+1,C),new Na(y,this.wrap,y,w,C+1),new Na(y,this.wrap,y,w+1,C+1)]}isLessThan(u){return this.wrap<u.wrap||!(this.wrap>u.wrap)&&(this.overscaledZ<u.overscaledZ||!(this.overscaledZ>u.overscaledZ)&&(this.canonical.x<u.canonical.x||!(this.canonical.x>u.canonical.x)&&this.canonical.y<u.canonical.y))}wrapped(){return new Na(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(u){return new Na(this.overscaledZ,u,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new cI(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(u){return this.canonical.getTilePoint(new y9(u.x-this.wrap,u.y))}}function c3(p,u,y,w,C){(p*=2)<0&&(p=-1*p-1);let R=1<<y;return(R*R*p+R*C+w).toString(36)+y.toString(36)+u.toString(36)}qt("CanonicalTileID",nb),qt("OverscaledTileID",Na,{omit:["posMatrix"]});class uI{constructor(u,y,w){if(this.uid=u,y.height!==y.width)throw new RangeError("DEM tiles must be square");if(w&&w!=="mapbox"&&w!=="terrarium")return void B(`"${w}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=y.height;let C=this.dim=y.height-2;this.data=new Uint32Array(y.data.buffer),this.encoding=w||"mapbox";for(let R=0;R<C;R++)this.data[this._idx(-1,R)]=this.data[this._idx(0,R)],this.data[this._idx(C,R)]=this.data[this._idx(C-1,R)],this.data[this._idx(R,-1)]=this.data[this._idx(R,0)],this.data[this._idx(R,C)]=this.data[this._idx(R,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let R=0;R<C;R++)for(let N=0;N<C;N++){let G=this.get(R,N);G>this.max&&(this.max=G),G<this.min&&(this.min=G)}}get(u,y){let w=new Uint8Array(this.data.buffer),C=4*this._idx(u,y);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(w[C],w[C+1],w[C+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(u,y){if(u<-1||u>=this.dim+1||y<-1||y>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(y+1)*this.stride+(u+1)}_unpackMapbox(u,y,w){return(256*u*256+256*y+w)/10-1e4}_unpackTerrarium(u,y,w){return 256*u+y+w/256-32768}getPixels(){return new La({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(u,y,w){if(this.dim!==u.dim)throw new Error("dem dimension mismatch");let C=y*this.dim,R=y*this.dim+this.dim,N=w*this.dim,G=w*this.dim+this.dim;switch(y){case-1:C=R-1;break;case 1:R=C+1}switch(w){case-1:N=G-1;break;case 1:G=N+1}let X=-y*this.dim,K=-w*this.dim;for(let ae=N;ae<G;ae++)for(let ue=C;ue<R;ue++)this.data[this._idx(ue,ae)]=u.data[this._idx(ue+X,ae+K)]}}qt("DEMData",uI);class hI{constructor(u){this._stringToNumber={},this._numberToString=[];for(let y=0;y<u.length;y++){let w=u[y];this._stringToNumber[w]=y,this._numberToString[y]=w}}encode(u){return this._stringToNumber[u]}decode(u){if(u>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${u} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[u]}}class dI{constructor(u,y,w,C,R){this.type="Feature",this._vectorTileFeature=u,u._z=y,u._x=w,u._y=C,this.properties=u.properties,this.id=R}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(u){this._geometry=u}toJSON(){let u={geometry:this.geometry};for(let y in this)y!=="_geometry"&&y!=="_vectorTileFeature"&&(u[y]=this[y]);return u}}class fI{constructor(u,y){this.tileID=u,this.x=u.canonical.x,this.y=u.canonical.y,this.z=u.canonical.z,this.grid=new fu(bs,16,0),this.grid3D=new fu(bs,16,0),this.featureIndexArray=new tt,this.promoteId=y}insert(u,y,w,C,R,N){let G=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(w,C,R);let X=N?this.grid3D:this.grid;for(let K=0;K<y.length;K++){let ae=y[K],ue=[1/0,1/0,-1/0,-1/0];for(let pe=0;pe<ae.length;pe++){let ve=ae[pe];ue[0]=Math.min(ue[0],ve.x),ue[1]=Math.min(ue[1],ve.y),ue[2]=Math.max(ue[2],ve.x),ue[3]=Math.max(ue[3],ve.y)}ue[0]<bs&&ue[1]<bs&&ue[2]>=0&&ue[3]>=0&&X.insert(G,ue[0],ue[1],ue[2],ue[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new I1.VectorTile(new Wv(this.rawTileData)).layers,this.sourceLayerCoder=new hI(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(u,y,w,C){this.loadVTLayers();let R=u.params||{},N=bs/u.tileSize/u.scale,G=Ap(R.filter),X=u.queryGeometry,K=u.queryPadding*N,ae=mI(X),ue=this.grid.query(ae.minX-K,ae.minY-K,ae.maxX+K,ae.maxY+K),pe=mI(u.cameraQueryGeometry),ve=this.grid3D.query(pe.minX-K,pe.minY-K,pe.maxX+K,pe.maxY+K,(Le,Be,qe,$e)=>function(et,it,pt,Xt,ci){for(let Gt of et)if(it<=Gt.x&&pt<=Gt.y&&Xt>=Gt.x&&ci>=Gt.y)return!0;let Ht=[new c(it,pt),new c(it,ci),new c(Xt,ci),new c(Xt,pt)];if(et.length>2){for(let Gt of Ht)if(tf(et,Gt))return!0}for(let Gt=0;Gt<et.length-1;Gt++)if(WU(et[Gt],et[Gt+1],Ht))return!0;return!1}(u.cameraQueryGeometry,Le-K,Be-K,qe+K,$e+K));for(let Le of ve)ue.push(Le);ue.sort(gG);let we={},Ie;for(let Le=0;Le<ue.length;Le++){let Be=ue[Le];if(Be===Ie)continue;Ie=Be;let qe=this.featureIndexArray.get(Be),$e=null;this.loadMatchingFeature(we,qe.bucketIndex,qe.sourceLayerIndex,qe.featureIndex,G,R.layers,R.availableImages,y,w,C,(et,it,pt)=>($e||($e=Cc(et)),it.queryIntersectsFeature(X,et,pt,$e,this.z,u.transform,N,u.pixelPosMatrix)))}return we}loadMatchingFeature(u,y,w,C,R,N,G,X,K,ae,ue){let pe=this.bucketLayerIDs[y];if(N&&!function(Le,Be){for(let qe=0;qe<Le.length;qe++)if(Be.indexOf(Le[qe])>=0)return!0;return!1}(N,pe))return;let ve=this.sourceLayerCoder.decode(w),we=this.vtLayers[ve].feature(C);if(R.needGeometry){let Le=Hl(we,!0);if(!R.filter(new ns(this.tileID.overscaledZ),Le,this.tileID.canonical))return}else if(!R.filter(new ns(this.tileID.overscaledZ),we))return;let Ie=this.getId(we,ve);for(let Le=0;Le<pe.length;Le++){let Be=pe[Le];if(N&&N.indexOf(Be)<0)continue;let qe=X[Be];if(!qe)continue;let $e={};Ie&&ae&&($e=ae.getState(qe.sourceLayer||"_geojsonTileLayer",Ie));let et=T({},K[Be]);et.paint=pI(et.paint,qe.paint,we,$e,G),et.layout=pI(et.layout,qe.layout,we,$e,G);let it=!ue||ue(we,qe,$e);if(!it)continue;let pt=new dI(we,this.z,this.x,this.y,Ie);pt.layer=et;let Xt=u[Be];Xt===void 0&&(Xt=u[Be]=[]),Xt.push({featureIndex:C,feature:pt,intersectionZ:it})}}lookupSymbolFeatures(u,y,w,C,R,N,G,X){let K={};this.loadVTLayers();let ae=Ap(R);for(let ue of u)this.loadMatchingFeature(K,w,C,ue,ae,N,G,X,y);return K}hasLayer(u){for(let y of this.bucketLayerIDs)for(let w of y)if(u===w)return!0;return!1}getId(u,y){let w=u.id;return this.promoteId&&(w=u.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[y]],typeof w=="boolean"&&(w=Number(w))),w}}function pI(p,u,y,w,C){return M(p,(R,N)=>{let G=u instanceof W0?u.get(N):null;return G&&G.evaluate?G.evaluate(y,w,C):G})}function mI(p){let u=1/0,y=1/0,w=-1/0,C=-1/0;for(let R of p)u=Math.min(u,R.x),y=Math.min(y,R.y),w=Math.max(w,R.x),C=Math.max(C,R.y);return{minX:u,minY:y,maxX:w,maxY:C}}function gG(p,u){return u-p}function gI(p,u,y,w,C){let R=[];for(let N=0;N<p.length;N++){let G=p[N],X;for(let K=0;K<G.length-1;K++){let ae=G[K],ue=G[K+1];ae.x<u&&ue.x<u||(ae.x<u?ae=new c(u,ae.y+(u-ae.x)/(ue.x-ae.x)*(ue.y-ae.y))._round():ue.x<u&&(ue=new c(u,ae.y+(u-ae.x)/(ue.x-ae.x)*(ue.y-ae.y))._round()),ae.y<y&&ue.y<y||(ae.y<y?ae=new c(ae.x+(y-ae.y)/(ue.y-ae.y)*(ue.x-ae.x),y)._round():ue.y<y&&(ue=new c(ae.x+(y-ae.y)/(ue.y-ae.y)*(ue.x-ae.x),y)._round()),ae.x>=w&&ue.x>=w||(ae.x>=w?ae=new c(w,ae.y+(w-ae.x)/(ue.x-ae.x)*(ue.y-ae.y))._round():ue.x>=w&&(ue=new c(w,ae.y+(w-ae.x)/(ue.x-ae.x)*(ue.y-ae.y))._round()),ae.y>=C&&ue.y>=C||(ae.y>=C?ae=new c(ae.x+(C-ae.y)/(ue.y-ae.y)*(ue.x-ae.x),C)._round():ue.y>=C&&(ue=new c(ae.x+(C-ae.y)/(ue.y-ae.y)*(ue.x-ae.x),C)._round()),X&&ae.equals(X[X.length-1])||(X=[ae],R.push(X)),X.push(ue)))))}}return R}qt("FeatureIndex",fI,{omit:["rawTileData","sourceLayerCoder"]});class R1 extends c{constructor(u,y,w,C){super(u,y),this.angle=w,C!==void 0&&(this.segment=C)}clone(){return new R1(this.x,this.y,this.angle,this.segment)}}function yI(p,u,y,w,C){if(u.segment===void 0||y===0)return!0;let R=u,N=u.segment+1,G=0;for(;G>-y/2;){if(N--,N<0)return!1;G-=p[N].dist(R),R=p[N]}G+=p[N].dist(p[N+1]),N++;let X=[],K=0;for(;G<y/2;){let ae=p[N],ue=p[N+1];if(!ue)return!1;let pe=p[N-1].angleTo(ae)-ae.angleTo(ue);for(pe=Math.abs((pe+3*Math.PI)%(2*Math.PI)-Math.PI),X.push({distance:G,angleDelta:pe}),K+=pe;G-X[0].distance>w;)K-=X.shift().angleDelta;if(K>C)return!1;N++,G+=ae.dist(ue)}return!0}function _I(p){let u=0;for(let y=0;y<p.length-1;y++)u+=p[y].dist(p[y+1]);return u}function xI(p,u,y){return p?.6*u*y:0}function vI(p,u){return Math.max(p?p.right-p.left:0,u?u.right-u.left:0)}function yG(p,u,y,w,C,R){let N=xI(y,C,R),G=vI(y,w)*R,X=0,K=_I(p)/2;for(let ae=0;ae<p.length-1;ae++){let ue=p[ae],pe=p[ae+1],ve=ue.dist(pe);if(X+ve>K){let we=(K-X)/ve,Ie=ko.number(ue.x,pe.x,we),Le=ko.number(ue.y,pe.y,we),Be=new R1(Ie,Le,pe.angleTo(ue),ae);return Be._round(),!N||yI(p,Be,G,N,u)?Be:void 0}X+=ve}}function _G(p,u,y,w,C,R,N,G,X){let K=xI(w,R,N),ae=vI(w,C),ue=ae*N,pe=p[0].x===0||p[0].x===X||p[0].y===0||p[0].y===X;return u-ue<u/4&&(u=ue+u/4),bI(p,pe?u/2*G%u:(ae/2+2*R)*N*G%u,u,K,y,ue,pe,!1,X)}function bI(p,u,y,w,C,R,N,G,X){let K=R/2,ae=_I(p),ue=0,pe=u-y,ve=[];for(let we=0;we<p.length-1;we++){let Ie=p[we],Le=p[we+1],Be=Ie.dist(Le),qe=Le.angleTo(Ie);for(;pe+y<ue+Be;){pe+=y;let $e=(pe-ue)/Be,et=ko.number(Ie.x,Le.x,$e),it=ko.number(Ie.y,Le.y,$e);if(et>=0&&et<X&&it>=0&&it<X&&pe-K>=0&&pe+K<=ae){let pt=new R1(et,it,qe,we);pt._round(),w&&!yI(p,pt,R,w,C)||ve.push(pt)}}ue+=Be}return G||ve.length||N||(ve=bI(p,ue/2,y,w,C,R,N,!0,X)),ve}qt("Anchor",R1);let uf=Po;function wI(p,u,y,w){let C=[],R=p.image,N=R.pixelRatio,G=R.paddedRect.w-2*uf,X=R.paddedRect.h-2*uf,K=p.right-p.left,ae=p.bottom-p.top,ue=R.stretchX||[[0,G]],pe=R.stretchY||[[0,X]],ve=(Rt,Kt)=>Rt+Kt[1]-Kt[0],we=ue.reduce(ve,0),Ie=pe.reduce(ve,0),Le=G-we,Be=X-Ie,qe=0,$e=we,et=0,it=Ie,pt=0,Xt=Le,ci=0,Ht=Be;if(R.content&&w){let Rt=R.content;qe=_9(ue,0,Rt[0]),et=_9(pe,0,Rt[1]),$e=_9(ue,Rt[0],Rt[2]),it=_9(pe,Rt[1],Rt[3]),pt=Rt[0]-qe,ci=Rt[1]-et,Xt=Rt[2]-Rt[0]-$e,Ht=Rt[3]-Rt[1]-it}let Gt=(Rt,Kt,Ot,Ct)=>{let xi=x9(Rt.stretch-qe,$e,K,p.left),hi=v9(Rt.fixed-pt,Xt,Rt.stretch,we),ar=x9(Kt.stretch-et,it,ae,p.top),ts=v9(Kt.fixed-ci,Ht,Kt.stretch,Ie),os=x9(Ot.stretch-qe,$e,K,p.left),un=v9(Ot.fixed-pt,Xt,Ot.stretch,we),da=x9(Ct.stretch-et,it,ae,p.top),mo=v9(Ct.fixed-ci,Ht,Ct.stretch,Ie),Ys=new c(xi,ar),En=new c(os,ar),$n=new c(os,da),Ro=new c(xi,da),go=new c(hi/N,ts/N),Zs=new c(un/N,mo/N),hn=u*Math.PI/180;if(hn){let Do=Math.sin(hn),Fo=Math.cos(hn),Is=[Fo,-Do,Do,Fo];Ys._matMult(Is),En._matMult(Is),Ro._matMult(Is),$n._matMult(Is)}let Kn=Rt.stretch+Rt.fixed,yo=Kt.stretch+Kt.fixed;return{tl:Ys,tr:En,bl:Ro,br:$n,tex:{x:R.paddedRect.x+uf+Kn,y:R.paddedRect.y+uf+yo,w:Ot.stretch+Ot.fixed-Kn,h:Ct.stretch+Ct.fixed-yo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:go,pixelOffsetBR:Zs,minFontScaleX:Xt/N/K,minFontScaleY:Ht/N/ae,isSDF:y}};if(w&&(R.stretchX||R.stretchY)){let Rt=EI(ue,Le,we),Kt=EI(pe,Be,Ie);for(let Ot=0;Ot<Rt.length-1;Ot++){let Ct=Rt[Ot],xi=Rt[Ot+1];for(let hi=0;hi<Kt.length-1;hi++)C.push(Gt(Ct,Kt[hi],xi,Kt[hi+1]))}}else C.push(Gt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:G+1},{fixed:0,stretch:X+1}));return C}function _9(p,u,y){let w=0;for(let C of p)w+=Math.max(u,Math.min(y,C[1]))-Math.max(u,Math.min(y,C[0]));return w}function EI(p,u,y){let w=[{fixed:-uf,stretch:0}];for(let[C,R]of p){let N=w[w.length-1];w.push({fixed:C-N.stretch,stretch:N.stretch}),w.push({fixed:C-N.stretch,stretch:N.stretch+(R-C)})}return w.push({fixed:u+uf,stretch:y}),w}function x9(p,u,y,w){return p/u*y+w}function v9(p,u,y,w){return p-u*y/w}class b9{constructor(u,y,w,C,R,N,G,X,K,ae){if(this.boxStartIndex=u.length,K){let ue=N.top,pe=N.bottom,ve=N.collisionPadding;ve&&(ue-=ve[1],pe+=ve[3]);let we=pe-ue;we>0&&(we=Math.max(10,we),this.circleDiameter=we)}else{let ue=N.top*G-X[0],pe=N.bottom*G+X[2],ve=N.left*G-X[3],we=N.right*G+X[1],Ie=N.collisionPadding;if(Ie&&(ve-=Ie[0]*G,ue-=Ie[1]*G,we+=Ie[2]*G,pe+=Ie[3]*G),ae){let Le=new c(ve,ue),Be=new c(we,ue),qe=new c(ve,pe),$e=new c(we,pe),et=ae*Math.PI/180;Le._rotate(et),Be._rotate(et),qe._rotate(et),$e._rotate(et),ve=Math.min(Le.x,Be.x,qe.x,$e.x),we=Math.max(Le.x,Be.x,qe.x,$e.x),ue=Math.min(Le.y,Be.y,qe.y,$e.y),pe=Math.max(Le.y,Be.y,qe.y,$e.y)}u.emplaceBack(y.x,y.y,ve,ue,we,pe,w,C,R)}this.boxEndIndex=u.length}}class xG{constructor(u=[],y=vG){if(this.data=u,this.length=this.data.length,this.compare=y,this.length>0)for(let w=(this.length>>1)-1;w>=0;w--)this._down(w)}push(u){this.data.push(u),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;let u=this.data[0],y=this.data.pop();return this.length--,this.length>0&&(this.data[0]=y,this._down(0)),u}peek(){return this.data[0]}_up(u){let{data:y,compare:w}=this,C=y[u];for(;u>0;){let R=u-1>>1,N=y[R];if(w(C,N)>=0)break;y[u]=N,u=R}y[u]=C}_down(u){let{data:y,compare:w}=this,C=this.length>>1,R=y[u];for(;u<C;){let N=1+(u<<1),G=y[N],X=N+1;if(X<this.length&&w(y[X],G)<0&&(N=X,G=y[X]),w(G,R)>=0)break;y[u]=G,u=N}y[u]=R}}function vG(p,u){return p<u?-1:p>u?1:0}function bG(p,u=1,y=!1){let w=1/0,C=1/0,R=-1/0,N=-1/0,G=p[0];for(let ve=0;ve<G.length;ve++){let we=G[ve];(!ve||we.x<w)&&(w=we.x),(!ve||we.y<C)&&(C=we.y),(!ve||we.x>R)&&(R=we.x),(!ve||we.y>N)&&(N=we.y)}let X=Math.min(R-w,N-C),K=X/2,ae=new xG([],wG);if(X===0)return new c(w,C);for(let ve=w;ve<R;ve+=X)for(let we=C;we<N;we+=X)ae.push(new hf(ve+K,we+K,K,p));let ue=function(ve){let we=0,Ie=0,Le=0,Be=ve[0];for(let qe=0,$e=Be.length,et=$e-1;qe<$e;et=qe++){let it=Be[qe],pt=Be[et],Xt=it.x*pt.y-pt.x*it.y;Ie+=(it.x+pt.x)*Xt,Le+=(it.y+pt.y)*Xt,we+=3*Xt}return new hf(Ie/we,Le/we,0,ve)}(p),pe=ae.length;for(;ae.length;){let ve=ae.pop();(ve.d>ue.d||!ue.d)&&(ue=ve,y&&console.log("found best %d after %d probes",Math.round(1e4*ve.d)/1e4,pe)),ve.max-ue.d<=u||(K=ve.h/2,ae.push(new hf(ve.p.x-K,ve.p.y-K,K,p)),ae.push(new hf(ve.p.x+K,ve.p.y-K,K,p)),ae.push(new hf(ve.p.x-K,ve.p.y+K,K,p)),ae.push(new hf(ve.p.x+K,ve.p.y+K,K,p)),pe+=4)}return y&&(console.log(`num probes: ${pe}`),console.log(`best distance: ${ue.d}`)),ue.p}function wG(p,u){return u.max-p.max}function hf(p,u,y,w){this.p=new c(p,u),this.h=y,this.d=function(C,R){let N=!1,G=1/0;for(let X=0;X<R.length;X++){let K=R[X];for(let ae=0,ue=K.length,pe=ue-1;ae<ue;pe=ae++){let ve=K[ae],we=K[pe];ve.y>C.y!=we.y>C.y&&C.x<(we.x-ve.x)*(C.y-ve.y)/(we.y-ve.y)+ve.x&&(N=!N),G=Math.min(G,oC(C,ve,we))}}return(N?1:-1)*Math.sqrt(G)}(this.p,w),this.max=this.d+this.h*Math.SQRT2}var Gn;n.TextAnchorEnum=void 0,(Gn=n.TextAnchorEnum||(n.TextAnchorEnum={}))[Gn.center=1]="center",Gn[Gn.left=2]="left",Gn[Gn.right=3]="right",Gn[Gn.top=4]="top",Gn[Gn.bottom=5]="bottom",Gn[Gn["top-left"]=6]="top-left",Gn[Gn["top-right"]=7]="top-right",Gn[Gn["bottom-left"]=8]="bottom-left",Gn[Gn["bottom-right"]=9]="bottom-right";let D1=7,ob=Number.POSITIVE_INFINITY;function TI(p,u){return u[1]!==ob?function(y,w,C){let R=0,N=0;switch(w=Math.abs(w),C=Math.abs(C),y){case"top-right":case"top-left":case"top":N=C-D1;break;case"bottom-right":case"bottom-left":case"bottom":N=-C+D1}switch(y){case"top-right":case"bottom-right":case"right":R=-w;break;case"top-left":case"bottom-left":case"left":R=w}return[R,N]}(p,u[0],u[1]):function(y,w){let C=0,R=0;w<0&&(w=0);let N=w/Math.sqrt(2);switch(y){case"top-right":case"top-left":R=N-D1;break;case"bottom-right":case"bottom-left":R=-N+D1;break;case"bottom":R=-w+D1;break;case"top":R=w-D1}switch(y){case"top-right":case"bottom-right":C=-N;break;case"top-left":case"bottom-left":C=N;break;case"left":C=w;break;case"right":C=-w}return[C,R]}(p,u[0])}function SI(p,u,y){var w;let C=p.layout,R=(w=C.get("text-variable-anchor-offset"))===null||w===void 0?void 0:w.evaluate(u,{},y);if(R){let G=R.values,X=[];for(let K=0;K<G.length;K+=2){let ae=X[K]=G[K],ue=G[K+1].map(pe=>pe*cn);ae.startsWith("top")?ue[1]-=D1:ae.startsWith("bottom")&&(ue[1]+=D1),X[K+1]=ue}return new Un(X)}let N=C.get("text-variable-anchor");if(N){let G;G=p._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[C.get("text-radial-offset").evaluate(u,{},y)*cn,ob]:C.get("text-offset").evaluate(u,{},y).map(K=>K*cn);let X=[];for(let K of N)X.push(K,TI(K,G));return new Un(X)}return null}function ab(p){switch(p){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function EG(p,u,y,w,C,R,N,G,X,K,ae){let ue=R.textMaxSize.evaluate(u,{});ue===void 0&&(ue=N);let pe=p.layers[0].layout,ve=pe.get("icon-offset").evaluate(u,{},ae),we=CI(y.horizontal),Ie=N/24,Le=p.tilePixelRatio*Ie,Be=p.tilePixelRatio*ue/24,qe=p.tilePixelRatio*G,$e=p.tilePixelRatio*pe.get("symbol-spacing"),et=pe.get("text-padding")*p.tilePixelRatio,it=function(Ct,xi,hi,ar=1){let ts=Ct.get("icon-padding").evaluate(xi,{},hi),os=ts&&ts.values;return[os[0]*ar,os[1]*ar,os[2]*ar,os[3]*ar]}(pe,u,ae,p.tilePixelRatio),pt=pe.get("text-max-angle")/180*Math.PI,Xt=pe.get("text-rotation-alignment")!=="viewport"&&pe.get("symbol-placement")!=="point",ci=pe.get("icon-rotation-alignment")==="map"&&pe.get("symbol-placement")!=="point",Ht=pe.get("symbol-placement"),Gt=$e/2,Rt=pe.get("icon-text-fit"),Kt;w&&Rt!=="none"&&(p.allowVerticalPlacement&&y.vertical&&(Kt=ZC(w,y.vertical,Rt,pe.get("icon-text-fit-padding"),ve,Ie)),we&&(w=ZC(w,we,Rt,pe.get("icon-text-fit-padding"),ve,Ie)));let Ot=(Ct,xi)=>{xi.x<0||xi.x>=bs||xi.y<0||xi.y>=bs||function(hi,ar,ts,os,un,da,mo,Ys,En,$n,Ro,go,Zs,hn,Kn,yo,Do,Fo,Is,Hn,pr,fa,Vn,_o,hl){let Vl=hi.addToLineVertexArray(ar,ts),jl,bu,dl,Oa,Lo=0,wu=0,d3=0,PI=0,mb=-1,gb=-1,Eu={},RI=Gl("");if(hi.allowVerticalPlacement&&os.vertical){let Jn=Ys.layout.get("text-rotate").evaluate(pr,{},_o)+90;dl=new b9(En,ar,$n,Ro,go,os.vertical,Zs,hn,Kn,Jn),mo&&(Oa=new b9(En,ar,$n,Ro,go,mo,Do,Fo,Kn,Jn))}if(un){let Jn=Ys.layout.get("icon-rotate").evaluate(pr,{}),Ba=Ys.layout.get("icon-text-fit")!=="none",Yh=wI(un,Jn,Vn,Ba),Wl=mo?wI(mo,Jn,Vn,Ba):void 0;bu=new b9(En,ar,$n,Ro,go,un,Do,Fo,!1,Jn),Lo=4*Yh.length;let Zh=hi.iconSizeData,kc=null;Zh.kind==="source"?(kc=[Ic*Ys.layout.get("icon-size").evaluate(pr,{})],kc[0]>M1&&B(`${hi.layerIds[0]}: Value for "icon-size" is >= ${l3}. Reduce your "icon-size".`)):Zh.kind==="composite"&&(kc=[Ic*fa.compositeIconSizes[0].evaluate(pr,{},_o),Ic*fa.compositeIconSizes[1].evaluate(pr,{},_o)],(kc[0]>M1||kc[1]>M1)&&B(`${hi.layerIds[0]}: Value for "icon-size" is >= ${l3}. Reduce your "icon-size".`)),hi.addSymbols(hi.icon,Yh,kc,Hn,Is,pr,n.WritingMode.none,ar,Vl.lineStartIndex,Vl.lineLength,-1,_o),mb=hi.icon.placedSymbolArray.length-1,Wl&&(wu=4*Wl.length,hi.addSymbols(hi.icon,Wl,kc,Hn,Is,pr,n.WritingMode.vertical,ar,Vl.lineStartIndex,Vl.lineLength,-1,_o),gb=hi.icon.placedSymbolArray.length-1)}let DI=Object.keys(os.horizontal);for(let Jn of DI){let Ba=os.horizontal[Jn];if(!jl){RI=Gl(Ba.text);let Wl=Ys.layout.get("text-rotate").evaluate(pr,{},_o);jl=new b9(En,ar,$n,Ro,go,Ba,Zs,hn,Kn,Wl)}let Yh=Ba.positionedLines.length===1;if(d3+=AI(hi,ar,Ba,da,Ys,Kn,pr,yo,Vl,os.vertical?n.WritingMode.horizontal:n.WritingMode.horizontalOnly,Yh?DI:[Jn],Eu,mb,fa,_o),Yh)break}os.vertical&&(PI+=AI(hi,ar,os.vertical,da,Ys,Kn,pr,yo,Vl,n.WritingMode.vertical,["vertical"],Eu,gb,fa,_o));let AG=jl?jl.boxStartIndex:hi.collisionBoxArray.length,CG=jl?jl.boxEndIndex:hi.collisionBoxArray.length,IG=dl?dl.boxStartIndex:hi.collisionBoxArray.length,kG=dl?dl.boxEndIndex:hi.collisionBoxArray.length,MG=bu?bu.boxStartIndex:hi.collisionBoxArray.length,PG=bu?bu.boxEndIndex:hi.collisionBoxArray.length,RG=Oa?Oa.boxStartIndex:hi.collisionBoxArray.length,DG=Oa?Oa.boxEndIndex:hi.collisionBoxArray.length,Xl=-1,E9=(Jn,Ba)=>Jn&&Jn.circleDiameter?Math.max(Jn.circleDiameter,Ba):Ba;Xl=E9(jl,Xl),Xl=E9(dl,Xl),Xl=E9(bu,Xl),Xl=E9(Oa,Xl);let FI=Xl>-1?1:0;FI&&(Xl*=hl/cn),hi.glyphOffsetArray.length>=cf.MAX_GLYPHS&&B("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),pr.sortKey!==void 0&&hi.addToSortKeyRanges(hi.symbolInstances.length,pr.sortKey);let FG=SI(Ys,pr,_o),[LG,NG]=function(Jn,Ba){let Yh=Jn.length,Wl=Ba==null?void 0:Ba.values;if((Wl==null?void 0:Wl.length)>0)for(let Zh=0;Zh<Wl.length;Zh+=2){let kc=Wl[Zh+1];Jn.emplaceBack(n.TextAnchorEnum[Wl[Zh]],kc[0],kc[1])}return[Yh,Jn.length]}(hi.textAnchorOffsets,FG);hi.symbolInstances.emplaceBack(ar.x,ar.y,Eu.right>=0?Eu.right:-1,Eu.center>=0?Eu.center:-1,Eu.left>=0?Eu.left:-1,Eu.vertical||-1,mb,gb,RI,AG,CG,IG,kG,MG,PG,RG,DG,$n,d3,PI,Lo,wu,FI,0,Zs,Xl,LG,NG)}(p,xi,Ct,y,w,C,Kt,p.layers[0],p.collisionBoxArray,u.index,u.sourceLayerIndex,p.index,Le,[et,et,et,et],Xt,X,qe,it,ci,ve,u,R,K,ae,N)};if(Ht==="line")for(let Ct of gI(u.geometry,0,0,bs,bs)){let xi=_G(Ct,$e,pt,y.vertical||we,w,24,Be,p.overscaling,bs);for(let hi of xi)we&&TG(p,we.text,Gt,hi)||Ot(Ct,hi)}else if(Ht==="line-center"){for(let Ct of u.geometry)if(Ct.length>1){let xi=yG(Ct,pt,y.vertical||we,w,24,Be);xi&&Ot(Ct,xi)}}else if(u.type==="Polygon")for(let Ct of Uv(u.geometry,0)){let xi=bG(Ct,16);Ot(Ct[0],new R1(xi.x,xi.y,0))}else if(u.type==="LineString")for(let Ct of u.geometry)Ot(Ct,new R1(Ct[0].x,Ct[0].y,0));else if(u.type==="Point")for(let Ct of u.geometry)for(let xi of Ct)Ot([xi],new R1(xi.x,xi.y,0))}function AI(p,u,y,w,C,R,N,G,X,K,ae,ue,pe,ve,we){let Ie=function(qe,$e,et,it,pt,Xt,ci,Ht){let Gt=it.layout.get("text-rotate").evaluate(Xt,{})*Math.PI/180,Rt=[];for(let Kt of $e.positionedLines)for(let Ot of Kt.positionedGlyphs){if(!Ot.rect)continue;let Ct=Ot.rect||{},xi=HC+1,hi=!0,ar=1,ts=0,os=(pt||Ht)&&Ot.vertical,un=Ot.metrics.advance*Ot.scale/2;if(Ht&&$e.verticalizable&&(ts=Kt.lineOffset/2-(Ot.imageName?-(cn-Ot.metrics.width*Ot.scale)/2:(Ot.scale-1)*cn)),Ot.imageName){let Is=ci[Ot.imageName];hi=Is.sdf,ar=Is.pixelRatio,xi=Po/ar}let da=pt?[Ot.x+un,Ot.y]:[0,0],mo=pt?[0,0]:[Ot.x+un+et[0],Ot.y+et[1]-ts],Ys=[0,0];os&&(Ys=mo,mo=[0,0]);let En=(Ot.metrics.left-xi)*Ot.scale-un+mo[0],$n=(-Ot.metrics.top-xi)*Ot.scale+mo[1],Ro=En+Ct.w*Ot.scale/ar,go=$n+Ct.h*Ot.scale/ar,Zs=new c(En,$n),hn=new c(Ro,$n),Kn=new c(En,go),yo=new c(Ro,go);if(os){let Is=new c(-un,un-o3),Hn=-Math.PI/2,pr=cn/2-un,fa=new c(5-o3-pr,-(Ot.imageName?pr:0)),Vn=new c(...Ys);Zs._rotateAround(Hn,Is)._add(fa)._add(Vn),hn._rotateAround(Hn,Is)._add(fa)._add(Vn),Kn._rotateAround(Hn,Is)._add(fa)._add(Vn),yo._rotateAround(Hn,Is)._add(fa)._add(Vn)}if(Gt){let Is=Math.sin(Gt),Hn=Math.cos(Gt),pr=[Hn,-Is,Is,Hn];Zs._matMult(pr),hn._matMult(pr),Kn._matMult(pr),yo._matMult(pr)}let Do=new c(0,0),Fo=new c(0,0);Rt.push({tl:Zs,tr:hn,bl:Kn,br:yo,tex:Ct,writingMode:$e.writingMode,glyphOffset:da,sectionIndex:Ot.sectionIndex,isSDF:hi,pixelOffsetTL:Do,pixelOffsetBR:Fo,minFontScaleX:0,minFontScaleY:0})}return Rt}(0,y,G,C,R,N,w,p.allowVerticalPlacement),Le=p.textSizeData,Be=null;Le.kind==="source"?(Be=[Ic*C.layout.get("text-size").evaluate(N,{})],Be[0]>M1&&B(`${p.layerIds[0]}: Value for "text-size" is >= ${l3}. Reduce your "text-size".`)):Le.kind==="composite"&&(Be=[Ic*ve.compositeTextSizes[0].evaluate(N,{},we),Ic*ve.compositeTextSizes[1].evaluate(N,{},we)],(Be[0]>M1||Be[1]>M1)&&B(`${p.layerIds[0]}: Value for "text-size" is >= ${l3}. Reduce your "text-size".`)),p.addSymbols(p.text,Ie,Be,G,R,N,K,u,X.lineStartIndex,X.lineLength,pe,we);for(let qe of ae)ue[qe]=p.text.placedSymbolArray.length-1;return 4*Ie.length}function CI(p){for(let u in p)return p[u];return null}function TG(p,u,y,w){let C=p.compareText;if(u in C){let R=C[u];for(let N=R.length-1;N>=0;N--)if(w.dist(R[N])<y)return!0}else C[u]=[];return C[u].push(w),!1}let II=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class lb{static from(u){if(!(u instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[y,w]=new Uint8Array(u,0,2);if(y!==219)throw new Error("Data does not appear to be in a KDBush format.");let C=w>>4;if(C!==1)throw new Error(`Got v${C} data when expected v1.`);let R=II[15&w];if(!R)throw new Error("Unrecognized array type.");let[N]=new Uint16Array(u,2,1),[G]=new Uint32Array(u,4,1);return new lb(G,N,R,u)}constructor(u,y=64,w=Float64Array,C){if(isNaN(u)||u<0)throw new Error(`Unpexpected numItems value: ${u}.`);this.numItems=+u,this.nodeSize=Math.min(Math.max(+y,2),65535),this.ArrayType=w,this.IndexArrayType=u<65536?Uint16Array:Uint32Array;let R=II.indexOf(this.ArrayType),N=2*u*this.ArrayType.BYTES_PER_ELEMENT,G=u*this.IndexArrayType.BYTES_PER_ELEMENT,X=(8-G%8)%8;if(R<0)throw new Error(`Unexpected typed array class: ${w}.`);C&&C instanceof ArrayBuffer?(this.data=C,this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+G+X,2*u),this._pos=2*u,this._finished=!0):(this.data=new ArrayBuffer(8+N+G+X),this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+G+X,2*u),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+R]),new Uint16Array(this.data,2,1)[0]=y,new Uint32Array(this.data,4,1)[0]=u)}add(u,y){let w=this._pos>>1;return this.ids[w]=w,this.coords[this._pos++]=u,this.coords[this._pos++]=y,w}finish(){let u=this._pos>>1;if(u!==this.numItems)throw new Error(`Added ${u} items when expected ${this.numItems}.`);return cb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(u,y,w,C){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:R,coords:N,nodeSize:G}=this,X=[0,R.length-1,0],K=[];for(;X.length;){let ae=X.pop()||0,ue=X.pop()||0,pe=X.pop()||0;if(ue-pe<=G){for(let Le=pe;Le<=ue;Le++){let Be=N[2*Le],qe=N[2*Le+1];Be>=u&&Be<=w&&qe>=y&&qe<=C&&K.push(R[Le])}continue}let ve=pe+ue>>1,we=N[2*ve],Ie=N[2*ve+1];we>=u&&we<=w&&Ie>=y&&Ie<=C&&K.push(R[ve]),(ae===0?u<=we:y<=Ie)&&(X.push(pe),X.push(ve-1),X.push(1-ae)),(ae===0?w>=we:C>=Ie)&&(X.push(ve+1),X.push(ue),X.push(1-ae))}return K}within(u,y,w){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:C,coords:R,nodeSize:N}=this,G=[0,C.length-1,0],X=[],K=w*w;for(;G.length;){let ae=G.pop()||0,ue=G.pop()||0,pe=G.pop()||0;if(ue-pe<=N){for(let Le=pe;Le<=ue;Le++)MI(R[2*Le],R[2*Le+1],u,y)<=K&&X.push(C[Le]);continue}let ve=pe+ue>>1,we=R[2*ve],Ie=R[2*ve+1];MI(we,Ie,u,y)<=K&&X.push(C[ve]),(ae===0?u-w<=we:y-w<=Ie)&&(G.push(pe),G.push(ve-1),G.push(1-ae)),(ae===0?u+w>=we:y+w>=Ie)&&(G.push(ve+1),G.push(ue),G.push(1-ae))}return X}}function cb(p,u,y,w,C,R){if(C-w<=y)return;let N=w+C>>1;kI(p,u,N,w,C,R),cb(p,u,y,w,N-1,1-R),cb(p,u,y,N+1,C,1-R)}function kI(p,u,y,w,C,R){for(;C>w;){if(C-w>600){let K=C-w+1,ae=y-w+1,ue=Math.log(K),pe=.5*Math.exp(2*ue/3),ve=.5*Math.sqrt(ue*pe*(K-pe)/K)*(ae-K/2<0?-1:1);kI(p,u,y,Math.max(w,Math.floor(y-ae*pe/K+ve)),Math.min(C,Math.floor(y+(K-ae)*pe/K+ve)),R)}let N=u[2*y+R],G=w,X=C;for(u3(p,u,w,y),u[2*C+R]>N&&u3(p,u,w,C);G<X;){for(u3(p,u,G,X),G++,X--;u[2*G+R]<N;)G++;for(;u[2*X+R]>N;)X--}u[2*w+R]===N?u3(p,u,w,X):(X++,u3(p,u,X,C)),X<=y&&(w=X+1),y<=X&&(C=X-1)}}function u3(p,u,y,w){ub(p,y,w),ub(u,2*y,2*w),ub(u,2*y+1,2*w+1)}function ub(p,u,y){let w=p[u];p[u]=p[y],p[y]=w}function MI(p,u,y,w){let C=p-y,R=u-w;return C*C+R*R}var hb;n.PerformanceMarkers=void 0,(hb=n.PerformanceMarkers||(n.PerformanceMarkers={})).create="create",hb.load="load",hb.fullLoad="fullLoad";let w9=null,h3=[],db=1e3/60,fb="loadTime",pb="fullLoadTime",SG={mark(p){performance.mark(p)},frame(p){let u=p;w9!=null&&h3.push(u-w9),w9=u},clearMetrics(){w9=null,h3=[],performance.clearMeasures(fb),performance.clearMeasures(pb);for(let p in n.PerformanceMarkers)performance.clearMarks(n.PerformanceMarkers[p])},getPerformanceMetrics(){performance.measure(fb,n.PerformanceMarkers.create,n.PerformanceMarkers.load),performance.measure(pb,n.PerformanceMarkers.create,n.PerformanceMarkers.fullLoad);let p=performance.getEntriesByName(fb)[0].duration,u=performance.getEntriesByName(pb)[0].duration,y=h3.length,w=1/(h3.reduce((R,N)=>R+N,0)/y/1e3),C=h3.filter(R=>R>db).reduce((R,N)=>R+(N-db)/db,0);return{loadTime:p,fullLoadTime:u,fps:w,percentDroppedFrames:C/(y+C)*100,totalFrames:y}}};n.AJAXError=re,n.ARRAY_TYPE=rf,n.Actor=class{constructor(p,u,y){this.receive=w=>{let C=w.data,R=C.id;if(R&&(!C.targetMapId||this.mapId===C.targetMapId))if(C.type==="<cancel>"){delete this.tasks[R];let N=this.cancelCallbacks[R];delete this.cancelCallbacks[R],N&&N()}else Z()||C.mustQueue?(this.tasks[R]=C,this.taskQueue.push(R),this.invoker.trigger()):this.processTask(R,C)},this.process=()=>{if(!this.taskQueue.length)return;let w=this.taskQueue.shift(),C=this.tasks[w];delete this.tasks[w],this.taskQueue.length&&this.invoker.trigger(),C&&this.processTask(w,C)},this.target=p,this.parent=u,this.mapId=y,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new mG(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Z()?p:window}send(p,u,y,w,C=!1){let R=Math.round(1e18*Math.random()).toString(36).substring(0,10);y&&(this.callbacks[R]=y);let N=q(this.globalScope)?void 0:[];return this.target.postMessage({id:R,type:p,hasCallback:!!y,targetMapId:w,mustQueue:C,sourceMapId:this.mapId,data:pu(u,N)},N),{cancel:()=>{y&&delete this.callbacks[R],this.target.postMessage({id:R,type:"<cancel>",targetMapId:w,sourceMapId:this.mapId})}}}processTask(p,u){if(u.type==="<response>"){let y=this.callbacks[p];delete this.callbacks[p],y&&(u.error?y(v1(u.error)):y(null,v1(u.data)))}else{let y=!1,w=q(this.globalScope)?void 0:[],C=u.hasCallback?(G,X)=>{y=!0,delete this.cancelCallbacks[p],this.target.postMessage({id:p,type:"<response>",sourceMapId:this.mapId,error:G?pu(G):null,data:pu(X,w)},w)}:G=>{y=!0},R=null,N=v1(u.data);if(this.parent[u.type])R=this.parent[u.type](u.sourceMapId,N,C);else if(this.parent.getWorkerSource){let G=u.type.split(".");R=this.parent.getWorkerSource(u.sourceMapId,G[0],N.source)[G[1]](N,C)}else C(new Error(`Could not find function ${u.type}`));!y&&R&&R.cancel&&(this.cancelCallbacks[p]=R.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},n.AlphaImage=Kp,n.CanonicalTileID=nb,n.CollisionBoxArray=Y,n.CollisionCircleLayoutArray=class extends Q0{},n.Color=Fi,n.DEMData=uI,n.DataConstantProperty=pi,n.DictionaryCoder=hI,n.EXTENT=bs,n.ErrorEvent=bt,n.EvaluationParameters=ns,n.Event=yt,n.Evented=at,n.FeatureIndex=fI,n.FillBucket=$v,n.FillExtrusionBucket=Vv,n.GeoJSONFeature=dI,n.ImageAtlas=jC,n.ImagePosition=Yv,n.KDBush=lb,n.LineBucket=jv,n.LineStripIndexArray=class extends D{},n.LngLat=P1,n.MercatorCoordinate=y9,n.ONE_EM=cn,n.OverscaledTileID=Na,n.PerformanceUtils=SG,n.Point=c,n.Pos3dArray=class extends T1{},n.PosArray=Ne,n.Properties=ln,n.Protobuf=Wv,n.QuadTriangleArray=class extends K0{},n.RGBAImage=La,n.RasterBoundsArray=class extends Y0{},n.RequestPerformance=class{constructor(p){this._marks={start:[p.url,"start"].join("#"),end:[p.url,"end"].join("#"),measure:p.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let p=performance.getEntriesByName(this._marks.measure);return p.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),p=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),p}},n.SegmentVector=Pi,n.SymbolBucket=cf,n.Transitionable=X0,n.TriangleIndexArray=Jt,n.Uniform1f=bn,n.Uniform1i=class extends Cs{constructor(p,u){super(p,u),this.current=0}set(p){this.current!==p&&(this.current=p,this.gl.uniform1i(this.location,p))}},n.Uniform2f=class extends Cs{constructor(p,u){super(p,u),this.current=[0,0]}set(p){p[0]===this.current[0]&&p[1]===this.current[1]||(this.current=p,this.gl.uniform2f(this.location,p[0],p[1]))}},n.Uniform3f=class extends Cs{constructor(p,u){super(p,u),this.current=[0,0,0]}set(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]||(this.current=p,this.gl.uniform3f(this.location,p[0],p[1],p[2]))}},n.Uniform4f=S1,n.UniformColor=qs,n.UniformMatrix4f=class extends Cs{constructor(p,u){super(p,u),this.current=wn}set(p){if(p[12]!==this.current[12]||p[0]!==this.current[0])return this.current=p,void this.gl.uniformMatrix4fv(this.location,!1,p);for(let u=1;u<16;u++)if(p[u]!==this.current[u]){this.current=p,this.gl.uniformMatrix4fv(this.location,!1,p);break}}},n.UnwrappedTileID=cI,n.ValidationError=De,n.ZoomHistory=V0,n.addDynamicAttributes=Jv,n.arrayBufferToImage=function(p,u){let y=new Image;y.onload=()=>{u(null,y),URL.revokeObjectURL(y.src),y.onload=null,window.requestAnimationFrame(()=>{y.src=V})},y.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let w=new Blob([new Uint8Array(p)],{type:"image/png"});y.src=p.byteLength?URL.createObjectURL(w):V},n.arrayBufferToImageBitmap=function(p,u){let y=new Blob([new Uint8Array(p)],{type:"image/png"});createImageBitmap(y).then(w=>{u(null,w)}).catch(w=>{u(new Error(`Could not load image because of ${w.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},n.asyncAll=function(p,u,y){if(!p.length)return y(null,[]);let w=p.length,C=new Array(p.length),R=null;p.forEach((N,G)=>{u(N,(X,K)=>{X&&(R=X),C[G]=K,--w==0&&y(R,C)})})},n.bezier=_,n.browser=ne,n.clamp=E,n.clipLine=gI,n.clone=function(p){var u=new rf(16);return u[0]=p[0],u[1]=p[1],u[2]=p[2],u[3]=p[3],u[4]=p[4],u[5]=p[5],u[6]=p[6],u[7]=p[7],u[8]=p[8],u[9]=p[9],u[10]=p[10],u[11]=p[11],u[12]=p[12],u[13]=p[13],u[14]=p[14],u[15]=p[15],u},n.clone$1=F,n.collisionCircleLayout=Hz,n.config=ee,n.copy=function(p,u){return p[0]=u[0],p[1]=u[1],p[2]=u[2],p[3]=u[3],p[4]=u[4],p[5]=u[5],p[6]=u[6],p[7]=u[7],p[8]=u[8],p[9]=u[9],p[10]=u[10],p[11]=u[11],p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15],p},n.create=function(){var p=new rf(16);return rf!=Float32Array&&(p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=0,p[12]=0,p[13]=0,p[14]=0),p[0]=1,p[5]=1,p[10]=1,p[15]=1,p},n.createExpression=hr,n.createFilter=Ap,n.createLayout=Ns,n.createStyleLayer=function(p){if(p.type==="custom")return new pG(p);switch(p.type){case"background":return new hG(p);case"circle":return new ZU(p);case"fill":return new gz(p);case"fill-extrusion":return new Pz(p);case"heatmap":return new KU(p);case"hillshade":return new ez(p);case"line":return new Uz(p);case"raster":return new fG(p);case"symbol":return new g9(p)}},n.deepEqual=function p(u,y){if(Array.isArray(u)){if(!Array.isArray(y)||u.length!==y.length)return!1;for(let w=0;w<u.length;w++)if(!p(u[w],y[w]))return!1;return!0}if(typeof u=="object"&&u!==null&&y!==null){if(typeof y!="object"||Object.keys(u).length!==Object.keys(y).length)return!1;for(let w in u)if(!p(u[w],y[w]))return!1;return!0}return u===y},n.defaultEasing=v,n.derefLayers=function(p){p=p.slice();let u=Object.create(null);for(let y=0;y<p.length;y++)u[p[y].id]=p[y];for(let y=0;y<p.length;y++)"ref"in p[y]&&(p[y]=xt(p[y],u[p[y].ref]));return p},n.diffStyles=function(p,u){if(!p)return[{command:Bt.setStyle,args:[u]}];let y=[];try{if(!It(p.version,u.version))return[{command:Bt.setStyle,args:[u]}];It(p.center,u.center)||y.push({command:Bt.setCenter,args:[u.center]}),It(p.zoom,u.zoom)||y.push({command:Bt.setZoom,args:[u.zoom]}),It(p.bearing,u.bearing)||y.push({command:Bt.setBearing,args:[u.bearing]}),It(p.pitch,u.pitch)||y.push({command:Bt.setPitch,args:[u.pitch]}),It(p.sprite,u.sprite)||y.push({command:Bt.setSprite,args:[u.sprite]}),It(p.glyphs,u.glyphs)||y.push({command:Bt.setGlyphs,args:[u.glyphs]}),It(p.transition,u.transition)||y.push({command:Bt.setTransition,args:[u.transition]}),It(p.light,u.light)||y.push({command:Bt.setLight,args:[u.light]});let w={},C=[];(function(N,G,X,K){let ae;for(ae in G=G||{},N=N||{})Object.prototype.hasOwnProperty.call(N,ae)&&(Object.prototype.hasOwnProperty.call(G,ae)||je(ae,X,K));for(ae in G)Object.prototype.hasOwnProperty.call(G,ae)&&(Object.prototype.hasOwnProperty.call(N,ae)?It(N[ae],G[ae])||(N[ae].type==="geojson"&&G[ae].type==="geojson"&&ge(N,G,ae)?X.push({command:Bt.setGeoJSONSourceData,args:[ae,G[ae].data]}):be(ae,G,X,K)):Mi(ae,G,X))})(p.sources,u.sources,C,w);let R=[];p.layers&&p.layers.forEach(N=>{w[N.source]?y.push({command:Bt.removeLayer,args:[N.id]}):R.push(N)}),y=y.concat(C),function(N,G,X){G=G||[];let K=(N=N||[]).map(Me),ae=G.map(Me),ue=N.reduce(Oe,{}),pe=G.reduce(Oe,{}),ve=K.slice(),we=Object.create(null),Ie,Le,Be,qe,$e,et,it;for(Ie=0,Le=0;Ie<K.length;Ie++)Be=K[Ie],Object.prototype.hasOwnProperty.call(pe,Be)?Le++:(X.push({command:Bt.removeLayer,args:[Be]}),ve.splice(ve.indexOf(Be,Le),1));for(Ie=0,Le=0;Ie<ae.length;Ie++)Be=ae[ae.length-1-Ie],ve[ve.length-1-Ie]!==Be&&(Object.prototype.hasOwnProperty.call(ue,Be)?(X.push({command:Bt.removeLayer,args:[Be]}),ve.splice(ve.lastIndexOf(Be,ve.length-Le),1)):Le++,et=ve[ve.length-Ie],X.push({command:Bt.addLayer,args:[pe[Be],et]}),ve.splice(ve.length-Ie,0,Be),we[Be]=!0);for(Ie=0;Ie<ae.length;Ie++)if(Be=ae[Ie],qe=ue[Be],$e=pe[Be],!we[Be]&&!It(qe,$e))if(It(qe.source,$e.source)&&It(qe["source-layer"],$e["source-layer"])&&It(qe.type,$e.type)){for(it in xe(qe.layout,$e.layout,X,Be,null,Bt.setLayoutProperty),xe(qe.paint,$e.paint,X,Be,null,Bt.setPaintProperty),It(qe.filter,$e.filter)||X.push({command:Bt.setFilter,args:[Be,$e.filter]}),It(qe.minzoom,$e.minzoom)&&It(qe.maxzoom,$e.maxzoom)||X.push({command:Bt.setLayerZoomRange,args:[Be,$e.minzoom,$e.maxzoom]}),qe)Object.prototype.hasOwnProperty.call(qe,it)&&it!=="layout"&&it!=="paint"&&it!=="filter"&&it!=="metadata"&&it!=="minzoom"&&it!=="maxzoom"&&(it.indexOf("paint.")===0?xe(qe[it],$e[it],X,Be,it.slice(6),Bt.setPaintProperty):It(qe[it],$e[it])||X.push({command:Bt.setLayerProperty,args:[Be,it,$e[it]]}));for(it in $e)Object.prototype.hasOwnProperty.call($e,it)&&!Object.prototype.hasOwnProperty.call(qe,it)&&it!=="layout"&&it!=="paint"&&it!=="filter"&&it!=="metadata"&&it!=="minzoom"&&it!=="maxzoom"&&(it.indexOf("paint.")===0?xe(qe[it],$e[it],X,Be,it.slice(6),Bt.setPaintProperty):It(qe[it],$e[it])||X.push({command:Bt.setLayerProperty,args:[Be,it,$e[it]]}))}else X.push({command:Bt.removeLayer,args:[Be]}),et=ve[ve.lastIndexOf(Be)+1],X.push({command:Bt.addLayer,args:[$e,et]})}(R,u.layers,y)}catch(w){console.warn("Unable to compute style diff:",w),y=[{command:Bt.setStyle,args:[u]}]}return y},n.dot=function(p,u){return p[0]*u[0]+p[1]*u[1]+p[2]*u[2]+p[3]*u[3]},n.earthRadius=rb,n.emitValidationErrors=X7,n.emptyStyle=function(){let p={},u=Te.$version;for(let y in Te.$root){let w=Te.$root[y];if(w.required){let C=null;C=y==="version"?u:w.type==="array"?[]:{},C!=null&&(p[y]=C)}}return p},n.equals=function(p,u){var y=p[0],w=p[1],C=p[2],R=p[3],N=p[4],G=p[5],X=p[6],K=p[7],ae=p[8],ue=p[9],pe=p[10],ve=p[11],we=p[12],Ie=p[13],Le=p[14],Be=p[15],qe=u[0],$e=u[1],et=u[2],it=u[3],pt=u[4],Xt=u[5],ci=u[6],Ht=u[7],Gt=u[8],Rt=u[9],Kt=u[10],Ot=u[11],Ct=u[12],xi=u[13],hi=u[14],ar=u[15];return Math.abs(y-qe)<=po*Math.max(1,Math.abs(y),Math.abs(qe))&&Math.abs(w-$e)<=po*Math.max(1,Math.abs(w),Math.abs($e))&&Math.abs(C-et)<=po*Math.max(1,Math.abs(C),Math.abs(et))&&Math.abs(R-it)<=po*Math.max(1,Math.abs(R),Math.abs(it))&&Math.abs(N-pt)<=po*Math.max(1,Math.abs(N),Math.abs(pt))&&Math.abs(G-Xt)<=po*Math.max(1,Math.abs(G),Math.abs(Xt))&&Math.abs(X-ci)<=po*Math.max(1,Math.abs(X),Math.abs(ci))&&Math.abs(K-Ht)<=po*Math.max(1,Math.abs(K),Math.abs(Ht))&&Math.abs(ae-Gt)<=po*Math.max(1,Math.abs(ae),Math.abs(Gt))&&Math.abs(ue-Rt)<=po*Math.max(1,Math.abs(ue),Math.abs(Rt))&&Math.abs(pe-Kt)<=po*Math.max(1,Math.abs(pe),Math.abs(Kt))&&Math.abs(ve-Ot)<=po*Math.max(1,Math.abs(ve),Math.abs(Ot))&&Math.abs(we-Ct)<=po*Math.max(1,Math.abs(we),Math.abs(Ct))&&Math.abs(Ie-xi)<=po*Math.max(1,Math.abs(Ie),Math.abs(xi))&&Math.abs(Le-hi)<=po*Math.max(1,Math.abs(Le),Math.abs(hi))&&Math.abs(Be-ar)<=po*Math.max(1,Math.abs(Be),Math.abs(ar))},n.evaluateSizeForFeature=function(p,{uSize:u,uSizeT:y},{lowerSize:w,upperSize:C}){return p.kind==="source"?w/Ic:p.kind==="composite"?ko.number(w/Ic,C/Ic,y):u},n.evaluateSizeForZoom=function(p,u){let y=0,w=0;if(p.kind==="constant")w=p.layoutSize;else if(p.kind!=="source"){let{interpolationType:C,minZoom:R,maxZoom:N}=p,G=C?E(Mo.interpolationFactor(C,u,R,N),0,1):0;p.kind==="camera"?w=ko.number(p.minSize,p.maxSize,G):y=G}return{uSizeT:y,uSize:w}},n.evented=Up,n.extend=T,n.filterObject=k,n.findLineIntersection=function(p,u,y,w){let C=u.y-p.y,R=u.x-p.x,N=w.y-y.y,G=w.x-y.x,X=N*R-G*C;if(X===0)return null;let K=(G*(p.y-y.y)-N*(p.x-y.x))/X;return new c(p.x+K*R,p.y+K*C)},n.fromScaling=function(p,u){return p[0]=u[0],p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=u[1],p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=u[2],p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},n.getAnchorAlignment=Qv,n.getAnchorJustification=ab,n.getArrayBuffer=Re,n.getDefaultExportFromCjs=o,n.getJSON=function(p,u){return fe(T(p,{type:"json"}),u)},n.getOverlapMode=Kv,n.getProtocolAction=ie,n.getRTLTextPluginStatus=zp,n.getReferrer=te,n.getVideo=function(p,u){let y=window.document.createElement("video");y.muted=!0,y.onloadstart=function(){u(null,y)};for(let w=0;w<p.length;w++){let C=window.document.createElement("source");He(p[w])||(y.crossOrigin="Anonymous"),C.src=p[w],y.appendChild(C)}return{cancel:()=>{}}},n.groupByLayout=function(p,u){let y={};for(let C=0;C<p.length;C++){let R=u&&u[p[C].id]||Tv(p[C]);u&&(u[p[C].id]=R);let N=y[R];N||(N=y[R]=[]),N.push(p[C])}let w=[];for(let C in y)w.push(y[C]);return w},n.identity=Rv,n.interpolate=ko,n.invert=function(p,u){var y=u[0],w=u[1],C=u[2],R=u[3],N=u[4],G=u[5],X=u[6],K=u[7],ae=u[8],ue=u[9],pe=u[10],ve=u[11],we=u[12],Ie=u[13],Le=u[14],Be=u[15],qe=y*G-w*N,$e=y*X-C*N,et=y*K-R*N,it=w*X-C*G,pt=w*K-R*G,Xt=C*K-R*X,ci=ae*Ie-ue*we,Ht=ae*Le-pe*we,Gt=ae*Be-ve*we,Rt=ue*Le-pe*Ie,Kt=ue*Be-ve*Ie,Ot=pe*Be-ve*Le,Ct=qe*Ot-$e*Kt+et*Rt+it*Gt-pt*Ht+Xt*ci;return Ct?(p[0]=(G*Ot-X*Kt+K*Rt)*(Ct=1/Ct),p[1]=(C*Kt-w*Ot-R*Rt)*Ct,p[2]=(Ie*Xt-Le*pt+Be*it)*Ct,p[3]=(pe*pt-ue*Xt-ve*it)*Ct,p[4]=(X*Gt-N*Ot-K*Ht)*Ct,p[5]=(y*Ot-C*Gt+R*Ht)*Ct,p[6]=(Le*et-we*Xt-Be*$e)*Ct,p[7]=(ae*Xt-pe*et+ve*$e)*Ct,p[8]=(N*Kt-G*Gt+K*ci)*Ct,p[9]=(w*Gt-y*Kt-R*ci)*Ct,p[10]=(we*pt-Ie*et+Be*qe)*Ct,p[11]=(ue*et-ae*pt-ve*qe)*Ct,p[12]=(G*Ht-N*Rt-X*ci)*Ct,p[13]=(y*Rt-w*Ht+C*ci)*Ct,p[14]=(Ie*$e-we*it-Le*qe)*Ct,p[15]=(ae*it-ue*$e+pe*qe)*Ct,p):null},n.isImageBitmap=Q,n.isSafari=q,n.isWorker=Z,n.keysDifference=function(p,u){let y=[];for(let w in p)w in u||y.push(w);return y},n.lazyLoadRTLTextPlugin=function(){ha.isLoading()||ha.isLoaded()||zp()!=="deferred"||Q7()},n.makeRequest=fe,n.mapObject=M,n.mercatorXfromLng=nI,n.mercatorYfromLat=oI,n.mercatorZfromAltitude=aI,n.mul=YU,n.mul$1=function(p,u,y){return p[0]=u[0]*y[0],p[1]=u[1]*y[1],p[2]=u[2]*y[2],p[3]=u[3]*y[3],p},n.multiply=uC,n.nextPowerOfTwo=function(p){return p<=1?1:Math.pow(2,Math.ceil(Math.log(p)/Math.LN2))},n.operations=Bt,n.ortho=function(p,u,y,w,C,R,N){var G=1/(u-y),X=1/(w-C),K=1/(R-N);return p[0]=-2*G,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=-2*X,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=2*K,p[11]=0,p[12]=(u+y)*G,p[13]=(C+w)*X,p[14]=(N+R)*K,p[15]=1,p},n.parseCacheControl=function(p){let u={};if(p.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(y,w,C,R)=>{let N=C||R;return u[w]=!N||N.toLowerCase(),""}),u["max-age"]){let y=parseInt(u["max-age"],10);isNaN(y)?delete u["max-age"]:u["max-age"]=y}return u},n.parseGlyphPbf=function(p){return new Wv(p).readFields(eG,[])},n.pbf=NC,n.performSymbolLayout=function(p){p.bucket.createArrays(),p.bucket.tilePixelRatio=bs/(512*p.bucket.overscaling),p.bucket.compareText={},p.bucket.iconsNeedLinear=!1;let u=p.bucket.layers[0],y=u.layout,w=u._unevaluatedLayout._values,C={layoutIconSize:w["icon-size"].possiblyEvaluate(new ns(p.bucket.zoom+1),p.canonical),layoutTextSize:w["text-size"].possiblyEvaluate(new ns(p.bucket.zoom+1),p.canonical),textMaxSize:w["text-size"].possiblyEvaluate(new ns(18))};if(p.bucket.textSizeData.kind==="composite"){let{minZoom:K,maxZoom:ae}=p.bucket.textSizeData;C.compositeTextSizes=[w["text-size"].possiblyEvaluate(new ns(K),p.canonical),w["text-size"].possiblyEvaluate(new ns(ae),p.canonical)]}if(p.bucket.iconSizeData.kind==="composite"){let{minZoom:K,maxZoom:ae}=p.bucket.iconSizeData;C.compositeIconSizes=[w["icon-size"].possiblyEvaluate(new ns(K),p.canonical),w["icon-size"].possiblyEvaluate(new ns(ae),p.canonical)]}let R=y.get("text-line-height")*cn,N=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point",G=y.get("text-keep-upright"),X=y.get("text-size");for(let K of p.bucket.features){let ae=y.get("text-font").evaluate(K,{},p.canonical).join(","),ue=X.evaluate(K,{},p.canonical),pe=C.layoutTextSize.evaluate(K,{},p.canonical),ve=C.layoutIconSize.evaluate(K,{},p.canonical),we={horizontal:{},vertical:void 0},Ie=K.text,Le,Be=[0,0];if(Ie){let et=Ie.toString(),it=y.get("text-letter-spacing").evaluate(K,{},p.canonical)*cn,pt=Av(et)?it:0,Xt=y.get("text-anchor").evaluate(K,{},p.canonical),ci=SI(u,K,p.canonical);if(!ci){let Ot=y.get("text-radial-offset").evaluate(K,{},p.canonical);Be=Ot?TI(Xt,[Ot*cn,ob]):y.get("text-offset").evaluate(K,{},p.canonical).map(Ct=>Ct*cn)}let Ht=N?"center":y.get("text-justify").evaluate(K,{},p.canonical),Gt=y.get("symbol-placement"),Rt=Gt==="point"?y.get("text-max-width").evaluate(K,{},p.canonical)*cn:0,Kt=()=>{p.bucket.allowVerticalPlacement&&j0(et)&&(we.vertical=f9(Ie,p.glyphMap,p.glyphPositions,p.imagePositions,ae,Rt,R,Xt,"left",pt,Be,n.WritingMode.vertical,!0,Gt,pe,ue))};if(!N&&ci){let Ot=new Set;if(Ht==="auto")for(let xi=0;xi<ci.values.length;xi+=2)Ot.add(ab(ci.values[xi]));else Ot.add(Ht);let Ct=!1;for(let xi of Ot)if(!we.horizontal[xi])if(Ct)we.horizontal[xi]=we.horizontal[0];else{let hi=f9(Ie,p.glyphMap,p.glyphPositions,p.imagePositions,ae,Rt,R,"center",xi,pt,Be,n.WritingMode.horizontal,!1,Gt,pe,ue);hi&&(we.horizontal[xi]=hi,Ct=hi.positionedLines.length===1)}Kt()}else{Ht==="auto"&&(Ht=ab(Xt));let Ot=f9(Ie,p.glyphMap,p.glyphPositions,p.imagePositions,ae,Rt,R,Xt,Ht,pt,Be,n.WritingMode.horizontal,!1,Gt,pe,ue);Ot&&(we.horizontal[Ht]=Ot),Kt(),j0(et)&&N&&G&&(we.vertical=f9(Ie,p.glyphMap,p.glyphPositions,p.imagePositions,ae,Rt,R,Xt,Ht,pt,Be,n.WritingMode.vertical,!1,Gt,pe,ue))}}let qe=!1;if(K.icon&&K.icon.name){let et=p.imageMap[K.icon.name];et&&(Le=oG(p.imagePositions[K.icon.name],y.get("icon-offset").evaluate(K,{},p.canonical),y.get("icon-anchor").evaluate(K,{},p.canonical)),qe=!!et.sdf,p.bucket.sdfIcons===void 0?p.bucket.sdfIcons=qe:p.bucket.sdfIcons!==qe&&B("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(et.pixelRatio!==p.bucket.pixelRatio||y.get("icon-rotate").constantOr(1)!==0)&&(p.bucket.iconsNeedLinear=!0))}let $e=CI(we.horizontal)||we.vertical;p.bucket.iconsInText=!!$e&&$e.iconsInText,($e||Le)&&EG(p.bucket,K,we,Le,p.imageMap,C,pe,ve,Be,qe,p.canonical)}p.showCollisionBoxes&&p.bucket.generateCollisionDebugBuffers()},n.perspective=function(p,u,y,w,C){var R,N=1/Math.tan(u/2);return p[0]=N/y,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=N,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,C!=null&&C!==1/0?(p[10]=(C+w)*(R=1/(w-C)),p[14]=2*C*w*R):(p[10]=-1,p[14]=-2*w),p},n.pick=function(p,u){let y={};for(let w=0;w<u.length;w++){let C=u[w];C in p&&(y[C]=p[C])}return y},n.plugin=ha,n.pointGeometry=a,n.polygonIntersectsPolygon=sC,n.potpack=VC,n.register=qt,n.registerForPluginStateChange=function(p){return p({pluginStatus:uo,pluginURL:Bl}),Up.on("pluginStateChange",p),p},n.renderColorRamp=mC,n.rotateX=function(p,u,y){var w=Math.sin(y),C=Math.cos(y),R=u[4],N=u[5],G=u[6],X=u[7],K=u[8],ae=u[9],ue=u[10],pe=u[11];return u!==p&&(p[0]=u[0],p[1]=u[1],p[2]=u[2],p[3]=u[3],p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15]),p[4]=R*C+K*w,p[5]=N*C+ae*w,p[6]=G*C+ue*w,p[7]=X*C+pe*w,p[8]=K*C-R*w,p[9]=ae*C-N*w,p[10]=ue*C-G*w,p[11]=pe*C-X*w,p},n.rotateZ=function(p,u,y){var w=Math.sin(y),C=Math.cos(y),R=u[0],N=u[1],G=u[2],X=u[3],K=u[4],ae=u[5],ue=u[6],pe=u[7];return u!==p&&(p[8]=u[8],p[9]=u[9],p[10]=u[10],p[11]=u[11],p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15]),p[0]=R*C+K*w,p[1]=N*C+ae*w,p[2]=G*C+ue*w,p[3]=X*C+pe*w,p[4]=K*C-R*w,p[5]=ae*C-N*w,p[6]=ue*C-G*w,p[7]=pe*C-X*w,p},n.sameOrigin=He,n.scale=function(p,u,y){var w=y[0],C=y[1],R=y[2];return p[0]=u[0]*w,p[1]=u[1]*w,p[2]=u[2]*w,p[3]=u[3]*w,p[4]=u[4]*C,p[5]=u[5]*C,p[6]=u[6]*C,p[7]=u[7]*C,p[8]=u[8]*R,p[9]=u[9]*R,p[10]=u[10]*R,p[11]=u[11]*R,p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15],p},n.setRTLTextPlugin=function(p,u,y=!1){if(uo===Xh||uo===Lp||uo===Np)throw new Error("setRTLTextPlugin cannot be called multiple times.");Bl=ne.resolveURL(p),uo=Xh,Op=u,Bp(),y||Q7()},n.sphericalToCartesian=function([p,u,y]){return u+=90,u*=Math.PI/180,y*=Math.PI/180,{x:p*Math.cos(u)*Math.sin(y),y:p*Math.sin(u)*Math.sin(y),z:p*Math.cos(y)}},n.toEvaluationFeature=Hl,n.transformMat4=o9,n.translate=function(p,u,y){var w,C,R,N,G,X,K,ae,ue,pe,ve,we,Ie=y[0],Le=y[1],Be=y[2];return u===p?(p[12]=u[0]*Ie+u[4]*Le+u[8]*Be+u[12],p[13]=u[1]*Ie+u[5]*Le+u[9]*Be+u[13],p[14]=u[2]*Ie+u[6]*Le+u[10]*Be+u[14],p[15]=u[3]*Ie+u[7]*Le+u[11]*Be+u[15]):(C=u[1],R=u[2],N=u[3],G=u[4],X=u[5],K=u[6],ae=u[7],ue=u[8],pe=u[9],ve=u[10],we=u[11],p[0]=w=u[0],p[1]=C,p[2]=R,p[3]=N,p[4]=G,p[5]=X,p[6]=K,p[7]=ae,p[8]=ue,p[9]=pe,p[10]=ve,p[11]=we,p[12]=w*Ie+G*Le+ue*Be+u[12],p[13]=C*Ie+X*Le+pe*Be+u[13],p[14]=R*Ie+K*Le+ve*Be+u[14],p[15]=N*Ie+ae*Le+we*Be+u[15]),p},n.triggerPluginCompletionEvent=Z7,n.unicodeBlockLookup=jt,n.uniqueId=function(){return A++},n.v8Spec=Te,n.validateCustomStyleLayer=function(p){let u=[],y=p.id;return y===void 0&&u.push({message:`layers.${y}: missing required property "id"`}),p.render===void 0&&u.push({message:`layers.${y}: missing required method "render"`}),p.renderingMode&&p.renderingMode!=="2d"&&p.renderingMode!=="3d"&&u.push({message:`layers.${y}: property "renderingMode" must be either "2d" or "3d"`}),u},n.validateLight=jh,n.validateStyle=Vh,n.vectorTile=I1,n.warnOnce=B,n.wrap=b}),r(["./shared"],function(n){"use strict";class o{constructor(he){this.keyCache={},he&&this.replace(he)}replace(he){this._layerConfigs={},this._layers={},this.update(he,[])}update(he,me){for(let Fe of he){this._layerConfigs[Fe.id]=Fe;let Ue=this._layers[Fe.id]=n.createStyleLayer(Fe);Ue._featureFilter=n.createFilter(Ue.filter),this.keyCache[Fe.id]&&delete this.keyCache[Fe.id]}for(let Fe of me)delete this.keyCache[Fe],delete this._layerConfigs[Fe],delete this._layers[Fe];this.familiesBySource={};let Ee=n.groupByLayout(Object.values(this._layerConfigs),this.keyCache);for(let Fe of Ee){let Ue=Fe.map(wt=>this._layers[wt.id]),We=Ue[0];if(We.visibility==="none")continue;let Ge=We.source||"",ze=this.familiesBySource[Ge];ze||(ze=this.familiesBySource[Ge]={});let Qe=We.sourceLayer||"_geojsonTileLayer",_t=ze[Qe];_t||(_t=ze[Qe]=[]),_t.push(Ue)}}}class a{constructor(he){let me={},Ee=[];for(let Ge in he){let ze=he[Ge],Qe=me[Ge]={};for(let _t in ze){let wt=ze[+_t];if(!wt||wt.bitmap.width===0||wt.bitmap.height===0)continue;let Et={x:0,y:0,w:wt.bitmap.width+2,h:wt.bitmap.height+2};Ee.push(Et),Qe[_t]={rect:Et,metrics:wt.metrics}}}let{w:Fe,h:Ue}=n.potpack(Ee),We=new n.AlphaImage({width:Fe||1,height:Ue||1});for(let Ge in he){let ze=he[Ge];for(let Qe in ze){let _t=ze[+Qe];if(!_t||_t.bitmap.width===0||_t.bitmap.height===0)continue;let wt=me[Ge][Qe].rect;n.AlphaImage.copy(_t.bitmap,We,{x:0,y:0},{x:wt.x+1,y:wt.y+1},_t.bitmap)}}this.image=We,this.positions=me}}n.register("GlyphAtlas",a);class l{constructor(he){this.tileID=new n.OverscaledTileID(he.tileID.overscaledZ,he.tileID.wrap,he.tileID.canonical.z,he.tileID.canonical.x,he.tileID.canonical.y),this.uid=he.uid,this.zoom=he.zoom,this.pixelRatio=he.pixelRatio,this.tileSize=he.tileSize,this.source=he.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=he.showCollisionBoxes,this.collectResourceTiming=!!he.collectResourceTiming,this.returnDependencies=!!he.returnDependencies,this.promoteId=he.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(he,me,Ee,Fe,Ue){this.status="parsing",this.data=he,this.collisionBoxArray=new n.CollisionBoxArray;let We=new n.DictionaryCoder(Object.keys(he.layers).sort()),Ge=new n.FeatureIndex(this.tileID,this.promoteId);Ge.bucketLayerIDs=[];let ze={},Qe={featureIndex:Ge,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Ee},_t=me.familiesBySource[this.source];for(let ur in _t){let vr=he.layers[ur];if(!vr)continue;vr.version===1&&n.warnOnce(`Vector tile source "${this.source}" layer "${ur}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let co=We.encode(ur),Fi=[];for(let Ws=0;Ws<vr.length;Ws++){let Pn=vr.feature(Ws),Ps=Ge.getId(Pn,ur);Fi.push({feature:Pn,id:Ps,index:Ws,sourceLayerIndex:co})}for(let Ws of _t[ur]){let Pn=Ws[0];Pn.source!==this.source&&n.warnOnce(`layer.source = ${Pn.source} does not equal this.source = ${this.source}`),Pn.minzoom&&this.zoom<Math.floor(Pn.minzoom)||Pn.maxzoom&&this.zoom>=Pn.maxzoom||Pn.visibility!=="none"&&(c(Ws,this.zoom,Ee),(ze[Pn.id]=Pn.createBucket({index:Ge.bucketLayerIDs.length,layers:Ws,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:co,sourceID:this.source})).populate(Fi,Qe,this.tileID.canonical),Ge.bucketLayerIDs.push(Ws.map(Ps=>Ps.id)))}}let wt,Et,wi,ji,ai=n.mapObject(Qe.glyphDependencies,ur=>Object.keys(ur).map(Number));this.inFlightDependencies.forEach(ur=>ur==null?void 0:ur.cancel()),this.inFlightDependencies=[];let _i=++this.dependencySentinel;Object.keys(ai).length?this.inFlightDependencies.push(Fe.send("getGlyphs",{uid:this.uid,stacks:ai,source:this.source,tileID:this.tileID,type:"glyphs"},(ur,vr)=>{_i===this.dependencySentinel&&(wt||(wt=ur,Et=vr,Or.call(this)))})):Et={};let zi=Object.keys(Qe.iconDependencies);zi.length?this.inFlightDependencies.push(Fe.send("getImages",{icons:zi,source:this.source,tileID:this.tileID,type:"icons"},(ur,vr)=>{_i===this.dependencySentinel&&(wt||(wt=ur,wi=vr,Or.call(this)))})):wi={};let wr=Object.keys(Qe.patternDependencies);function Or(){if(wt)return Ue(wt);if(Et&&wi&&ji){let ur=new a(Et),vr=new n.ImageAtlas(wi,ji);for(let co in ze){let Fi=ze[co];Fi instanceof n.SymbolBucket?(c(Fi.layers,this.zoom,Ee),n.performSymbolLayout({bucket:Fi,glyphMap:Et,glyphPositions:ur.positions,imageMap:wi,imagePositions:vr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Fi.hasPattern&&(Fi instanceof n.LineBucket||Fi instanceof n.FillBucket||Fi instanceof n.FillExtrusionBucket)&&(c(Fi.layers,this.zoom,Ee),Fi.addFeatures(Qe,this.tileID.canonical,vr.patternPositions))}this.status="done",Ue(null,{buckets:Object.values(ze).filter(co=>!co.isEmpty()),featureIndex:Ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ur.image,imageAtlas:vr,glyphMap:this.returnDependencies?Et:null,iconMap:this.returnDependencies?wi:null,glyphPositions:this.returnDependencies?ur.positions:null})}}wr.length?this.inFlightDependencies.push(Fe.send("getImages",{icons:wr,source:this.source,tileID:this.tileID,type:"patterns"},(ur,vr)=>{_i===this.dependencySentinel&&(wt||(wt=ur,ji=vr,Or.call(this)))})):ji={},Or.call(this)}}function c(ke,he,me){let Ee=new n.EvaluationParameters(he);for(let Fe of ke)Fe.recalculate(Ee,me)}function d(ke,he){let me=n.getArrayBuffer(ke.request,(Ee,Fe,Ue,We)=>{Ee?he(Ee):Fe&&he(null,{vectorTile:new n.vectorTile.VectorTile(new n.Protobuf(Fe)),rawData:Fe,cacheControl:Ue,expires:We})});return()=>{me.cancel(),he()}}class m{constructor(he,me,Ee,Fe){this.actor=he,this.layerIndex=me,this.availableImages=Ee,this.loadVectorData=Fe||d,this.fetching={},this.loading={},this.loaded={}}loadTile(he,me){let Ee=he.uid;this.loading||(this.loading={});let Fe=!!(he&&he.request&&he.request.collectResourceTiming)&&new n.RequestPerformance(he.request),Ue=this.loading[Ee]=new l(he);Ue.abort=this.loadVectorData(he,(We,Ge)=>{if(delete this.loading[Ee],We||!Ge)return Ue.status="done",this.loaded[Ee]=Ue,me(We);let ze=Ge.rawData,Qe={};Ge.expires&&(Qe.expires=Ge.expires),Ge.cacheControl&&(Qe.cacheControl=Ge.cacheControl);let _t={};if(Fe){let wt=Fe.finish();wt&&(_t.resourceTiming=JSON.parse(JSON.stringify(wt)))}Ue.vectorTile=Ge.vectorTile,Ue.parse(Ge.vectorTile,this.layerIndex,this.availableImages,this.actor,(wt,Et)=>{if(delete this.fetching[Ee],wt||!Et)return me(wt);me(null,n.extend({rawTileData:ze.slice(0)},Et,Qe,_t))}),this.loaded=this.loaded||{},this.loaded[Ee]=Ue,this.fetching[Ee]={rawTileData:ze,cacheControl:Qe,resourceTiming:_t}})}reloadTile(he,me){let Ee=this.loaded,Fe=he.uid;if(Ee&&Ee[Fe]){let Ue=Ee[Fe];Ue.showCollisionBoxes=he.showCollisionBoxes,Ue.status==="parsing"?Ue.parse(Ue.vectorTile,this.layerIndex,this.availableImages,this.actor,(We,Ge)=>{if(We||!Ge)return me(We,Ge);let ze;if(this.fetching[Fe]){let{rawTileData:Qe,cacheControl:_t,resourceTiming:wt}=this.fetching[Fe];delete this.fetching[Fe],ze=n.extend({rawTileData:Qe.slice(0)},Ge,_t,wt)}else ze=Ge;me(null,ze)}):Ue.status==="done"&&(Ue.vectorTile?Ue.parse(Ue.vectorTile,this.layerIndex,this.availableImages,this.actor,me):me())}}abortTile(he,me){let Ee=this.loading,Fe=he.uid;Ee&&Ee[Fe]&&Ee[Fe].abort&&(Ee[Fe].abort(),delete Ee[Fe]),me()}removeTile(he,me){let Ee=this.loaded,Fe=he.uid;Ee&&Ee[Fe]&&delete Ee[Fe],me()}}class g{constructor(){this.loaded={}}loadTile(he,me){let{uid:Ee,encoding:Fe,rawImageData:Ue}=he,We=n.isImageBitmap(Ue)?this.getImageData(Ue):Ue,Ge=new n.DEMData(Ee,We,Fe);this.loaded=this.loaded||{},this.loaded[Ee]=Ge,me(null,Ge)}getImageData(he){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(he.width,he.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=he.width,this.offscreenCanvas.height=he.height,this.offscreenCanvasContext.drawImage(he,0,0,he.width,he.height);let me=this.offscreenCanvasContext.getImageData(-1,-1,he.width+2,he.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new n.RGBAImage({width:me.width,height:me.height},me.data)}removeTile(he){let me=this.loaded,Ee=he.uid;me&&me[Ee]&&delete me[Ee]}}function _(ke,he){if(ke.length!==0){v(ke[0],he);for(var me=1;me<ke.length;me++)v(ke[me],!he)}}function v(ke,he){for(var me=0,Ee=0,Fe=0,Ue=ke.length,We=Ue-1;Fe<Ue;We=Fe++){var Ge=(ke[Fe][0]-ke[We][0])*(ke[We][1]+ke[Fe][1]),ze=me+Ge;Ee+=Math.abs(me)>=Math.abs(Ge)?me-ze+Ge:Ge-ze+me,me=ze}me+Ee>=0!=!!he&&ke.reverse()}var E=n.getDefaultExportFromCjs(function ke(he,me){var Ee,Fe=he&&he.type;if(Fe==="FeatureCollection")for(Ee=0;Ee<he.features.length;Ee++)ke(he.features[Ee],me);else if(Fe==="GeometryCollection")for(Ee=0;Ee<he.geometries.length;Ee++)ke(he.geometries[Ee],me);else if(Fe==="Feature")ke(he.geometry,me);else if(Fe==="Polygon")_(he.coordinates,me);else if(Fe==="MultiPolygon")for(Ee=0;Ee<he.coordinates.length;Ee++)_(he.coordinates[Ee],me);return he});let b=n.vectorTile.VectorTileFeature.prototype.toGeoJSON;var T={exports:{}},A=n.pointGeometry,M=n.vectorTile.VectorTileFeature,k=F;function F(ke,he){this.options=he||{},this.features=ke,this.length=ke.length}function O(ke,he){this.id=typeof ke.id=="number"?ke.id:void 0,this.type=ke.type,this.rawGeometry=ke.type===1?[ke.geometry]:ke.geometry,this.properties=ke.tags,this.extent=he||4096}F.prototype.feature=function(ke){return new O(this.features[ke],this.options.extent)},O.prototype.loadGeometry=function(){var ke=this.rawGeometry;this.geometry=[];for(var he=0;he<ke.length;he++){for(var me=ke[he],Ee=[],Fe=0;Fe<me.length;Fe++)Ee.push(new A(me[Fe][0],me[Fe][1]));this.geometry.push(Ee)}return this.geometry},O.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ke=this.geometry,he=1/0,me=-1/0,Ee=1/0,Fe=-1/0,Ue=0;Ue<ke.length;Ue++)for(var We=ke[Ue],Ge=0;Ge<We.length;Ge++){var ze=We[Ge];he=Math.min(he,ze.x),me=Math.max(me,ze.x),Ee=Math.min(Ee,ze.y),Fe=Math.max(Fe,ze.y)}return[he,Ee,me,Fe]},O.prototype.toGeoJSON=M.prototype.toGeoJSON;var B=n.pbf,U=k;function z(ke){var he=new B;return function(me,Ee){for(var Fe in me.layers)Ee.writeMessage(3,Z,me.layers[Fe])}(ke,he),he.finish()}function Z(ke,he){var me;he.writeVarintField(15,ke.version||1),he.writeStringField(1,ke.name||""),he.writeVarintField(5,ke.extent||4096);var Ee={keys:[],values:[],keycache:{},valuecache:{}};for(me=0;me<ke.length;me++)Ee.feature=ke.feature(me),he.writeMessage(2,W,Ee);var Fe=Ee.keys;for(me=0;me<Fe.length;me++)he.writeStringField(3,Fe[me]);var Ue=Ee.values;for(me=0;me<Ue.length;me++)he.writeMessage(4,de,Ue[me])}function W(ke,he){var me=ke.feature;me.id!==void 0&&he.writeVarintField(1,me.id),he.writeMessage(2,q,ke),he.writeVarintField(3,me.type),he.writeMessage(4,le,me)}function q(ke,he){var me=ke.feature,Ee=ke.keys,Fe=ke.values,Ue=ke.keycache,We=ke.valuecache;for(var Ge in me.properties){var ze=me.properties[Ge],Qe=Ue[Ge];if(ze!==null){Qe===void 0&&(Ee.push(Ge),Ue[Ge]=Qe=Ee.length-1),he.writeVarint(Qe);var _t=typeof ze;_t!=="string"&&_t!=="boolean"&&_t!=="number"&&(ze=JSON.stringify(ze));var wt=_t+":"+ze,Et=We[wt];Et===void 0&&(Fe.push(ze),We[wt]=Et=Fe.length-1),he.writeVarint(Et)}}}function Q(ke,he){return(he<<3)+(7&ke)}function V(ke){return ke<<1^ke>>31}function le(ke,he){for(var me=ke.loadGeometry(),Ee=ke.type,Fe=0,Ue=0,We=me.length,Ge=0;Ge<We;Ge++){var ze=me[Ge],Qe=1;Ee===1&&(Qe=ze.length),he.writeVarint(Q(1,Qe));for(var _t=Ee===3?ze.length-1:ze.length,wt=0;wt<_t;wt++){wt===1&&Ee!==1&&he.writeVarint(Q(2,_t-1));var Et=ze[wt].x-Fe,wi=ze[wt].y-Ue;he.writeVarint(V(Et)),he.writeVarint(V(wi)),Fe+=Et,Ue+=wi}Ee===3&&he.writeVarint(Q(7,1))}}function de(ke,he){var me=typeof ke;me==="string"?he.writeStringField(1,ke):me==="boolean"?he.writeBooleanField(7,ke):me==="number"&&(ke%1!=0?he.writeDoubleField(3,ke):ke<0?he.writeSVarintField(6,ke):he.writeVarintField(5,ke))}T.exports=z,T.exports.fromVectorTileJs=z,T.exports.fromGeojsonVt=function(ke,he){he=he||{};var me={};for(var Ee in ke)me[Ee]=new U(ke[Ee].features,he),me[Ee].name=Ee,me[Ee].version=he.version,me[Ee].extent=he.extent;return z({layers:me})},T.exports.GeoJSONWrapper=U;var ne=n.getDefaultExportFromCjs(T.exports);let ee={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ke=>ke},re=Math.fround||(te=new Float32Array(1),ke=>(te[0]=+ke,te[0]));var te;let ie=3,oe=5,fe=6;class Re{constructor(he){this.options=Object.assign(Object.create(ee),he),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(he){let{log:me,minZoom:Ee,maxZoom:Fe}=this.options;me&&console.time("total time");let Ue=`prepare ${he.length} points`;me&&console.time(Ue),this.points=he;let We=[];for(let ze=0;ze<he.length;ze++){let Qe=he[ze];if(!Qe.geometry)continue;let[_t,wt]=Qe.geometry.coordinates,Et=re(ot(_t)),wi=re(yt(wt));We.push(Et,wi,1/0,ze,-1,1),this.options.reduce&&We.push(0)}let Ge=this.trees[Fe+1]=this._createTree(We);me&&console.timeEnd(Ue);for(let ze=Fe;ze>=Ee;ze--){let Qe=+Date.now();Ge=this.trees[ze]=this._createTree(this._cluster(Ge,ze)),me&&console.log("z%d: %d clusters in %dms",ze,Ge.numItems,+Date.now()-Qe)}return me&&console.timeEnd("total time"),this}getClusters(he,me){let Ee=((he[0]+180)%360+360)%360-180,Fe=Math.max(-90,Math.min(90,he[1])),Ue=he[2]===180?180:((he[2]+180)%360+360)%360-180,We=Math.max(-90,Math.min(90,he[3]));if(he[2]-he[0]>=360)Ee=-180,Ue=180;else if(Ee>Ue){let wt=this.getClusters([Ee,Fe,180,We],me),Et=this.getClusters([-180,Fe,Ue,We],me);return wt.concat(Et)}let Ge=this.trees[this._limitZoom(me)],ze=Ge.range(ot(Ee),yt(We),ot(Ue),yt(Fe)),Qe=Ge.data,_t=[];for(let wt of ze){let Et=this.stride*wt;_t.push(Qe[Et+oe]>1?He(Qe,Et,this.clusterProps):this.points[Qe[Et+ie]])}return _t}getChildren(he){let me=this._getOriginId(he),Ee=this._getOriginZoom(he),Fe="No cluster with the specified id.",Ue=this.trees[Ee];if(!Ue)throw new Error(Fe);let We=Ue.data;if(me*this.stride>=We.length)throw new Error(Fe);let Ge=this.options.radius/(this.options.extent*Math.pow(2,Ee-1)),ze=Ue.within(We[me*this.stride],We[me*this.stride+1],Ge),Qe=[];for(let _t of ze){let wt=_t*this.stride;We[wt+4]===he&&Qe.push(We[wt+oe]>1?He(We,wt,this.clusterProps):this.points[We[wt+ie]])}if(Qe.length===0)throw new Error(Fe);return Qe}getLeaves(he,me,Ee){let Fe=[];return this._appendLeaves(Fe,he,me=me||10,Ee=Ee||0,0),Fe}getTile(he,me,Ee){let Fe=this.trees[this._limitZoom(he)],Ue=Math.pow(2,he),{extent:We,radius:Ge}=this.options,ze=Ge/We,Qe=(Ee-ze)/Ue,_t=(Ee+1+ze)/Ue,wt={features:[]};return this._addTileFeatures(Fe.range((me-ze)/Ue,Qe,(me+1+ze)/Ue,_t),Fe.data,me,Ee,Ue,wt),me===0&&this._addTileFeatures(Fe.range(1-ze/Ue,Qe,1,_t),Fe.data,Ue,Ee,Ue,wt),me===Ue-1&&this._addTileFeatures(Fe.range(0,Qe,ze/Ue,_t),Fe.data,-1,Ee,Ue,wt),wt.features.length?wt:null}getClusterExpansionZoom(he){let me=this._getOriginZoom(he)-1;for(;me<=this.options.maxZoom;){let Ee=this.getChildren(he);if(me++,Ee.length!==1)break;he=Ee[0].properties.cluster_id}return me}_appendLeaves(he,me,Ee,Fe,Ue){let We=this.getChildren(me);for(let Ge of We){let ze=Ge.properties;if(ze&&ze.cluster?Ue+ze.point_count<=Fe?Ue+=ze.point_count:Ue=this._appendLeaves(he,ze.cluster_id,Ee,Fe,Ue):Ue<Fe?Ue++:he.push(Ge),he.length===Ee)break}return Ue}_createTree(he){let me=new n.KDBush(he.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ee=0;Ee<he.length;Ee+=this.stride)me.add(he[Ee],he[Ee+1]);return me.finish(),me.data=he,me}_addTileFeatures(he,me,Ee,Fe,Ue,We){for(let Ge of he){let ze=Ge*this.stride,Qe=me[ze+oe]>1,_t,wt,Et;if(Qe)_t=Je(me,ze,this.clusterProps),wt=me[ze],Et=me[ze+1];else{let ai=this.points[me[ze+ie]];_t=ai.properties;let[_i,zi]=ai.geometry.coordinates;wt=ot(_i),Et=yt(zi)}let wi={type:1,geometry:[[Math.round(this.options.extent*(wt*Ue-Ee)),Math.round(this.options.extent*(Et*Ue-Fe))]],tags:_t},ji;ji=Qe||this.options.generateId?me[ze+ie]:this.points[me[ze+ie]].id,ji!==void 0&&(wi.id=ji),We.features.push(wi)}}_limitZoom(he){return Math.max(this.options.minZoom,Math.min(Math.floor(+he),this.options.maxZoom+1))}_cluster(he,me){let{radius:Ee,extent:Fe,reduce:Ue,minPoints:We}=this.options,Ge=Ee/(Fe*Math.pow(2,me)),ze=he.data,Qe=[],_t=this.stride;for(let wt=0;wt<ze.length;wt+=_t){if(ze[wt+2]<=me)continue;ze[wt+2]=me;let Et=ze[wt],wi=ze[wt+1],ji=he.within(ze[wt],ze[wt+1],Ge),ai=ze[wt+oe],_i=ai;for(let zi of ji){let wr=zi*_t;ze[wr+2]>me&&(_i+=ze[wr+oe])}if(_i>ai&&_i>=We){let zi,wr=Et*ai,Or=wi*ai,ur=-1,vr=((wt/_t|0)<<5)+(me+1)+this.points.length;for(let co of ji){let Fi=co*_t;if(ze[Fi+2]<=me)continue;ze[Fi+2]=me;let Ws=ze[Fi+oe];wr+=ze[Fi]*Ws,Or+=ze[Fi+1]*Ws,ze[Fi+4]=vr,Ue&&(zi||(zi=this._map(ze,wt,!0),ur=this.clusterProps.length,this.clusterProps.push(zi)),Ue(zi,this._map(ze,Fi)))}ze[wt+4]=vr,Qe.push(wr/_i,Or/_i,1/0,vr,-1,_i),Ue&&Qe.push(ur)}else{for(let zi=0;zi<_t;zi++)Qe.push(ze[wt+zi]);if(_i>1)for(let zi of ji){let wr=zi*_t;if(!(ze[wr+2]<=me)){ze[wr+2]=me;for(let Or=0;Or<_t;Or++)Qe.push(ze[wr+Or])}}}}return Qe}_getOriginId(he){return he-this.points.length>>5}_getOriginZoom(he){return(he-this.points.length)%32}_map(he,me,Ee){if(he[me+oe]>1){let We=this.clusterProps[he[me+fe]];return Ee?Object.assign({},We):We}let Fe=this.points[he[me+ie]].properties,Ue=this.options.map(Fe);return Ee&&Ue===Fe?Object.assign({},Ue):Ue}}function He(ke,he,me){return{type:"Feature",id:ke[he+ie],properties:Je(ke,he,me),geometry:{type:"Point",coordinates:[(Ee=ke[he],360*(Ee-.5)),bt(ke[he+1])]}};var Ee}function Je(ke,he,me){let Ee=ke[he+oe],Fe=Ee>=1e4?`${Math.round(Ee/1e3)}k`:Ee>=1e3?Math.round(Ee/100)/10+"k":Ee,Ue=ke[he+fe],We=Ue===-1?{}:Object.assign({},me[Ue]);return Object.assign(We,{cluster:!0,cluster_id:ke[he+ie],point_count:Ee,point_count_abbreviated:Fe})}function ot(ke){return ke/360+.5}function yt(ke){let he=Math.sin(ke*Math.PI/180),me=.5-.25*Math.log((1+he)/(1-he))/Math.PI;return me<0?0:me>1?1:me}function bt(ke){let he=(180-360*ke)*Math.PI/180;return 360*Math.atan(Math.exp(he))/Math.PI-90}function at(ke,he,me,Ee){for(var Fe,Ue=Ee,We=me-he>>1,Ge=me-he,ze=ke[he],Qe=ke[he+1],_t=ke[me],wt=ke[me+1],Et=he+3;Et<me;Et+=3){var wi=Te(ke[Et],ke[Et+1],ze,Qe,_t,wt);if(wi>Ue)Fe=Et,Ue=wi;else if(wi===Ue){var ji=Math.abs(Et-We);ji<Ge&&(Fe=Et,Ge=ji)}}Ue>Ee&&(Fe-he>3&&at(ke,he,Fe,Ee),ke[Fe+2]=Ue,me-Fe>3&&at(ke,Fe,me,Ee))}function Te(ke,he,me,Ee,Fe,Ue){var We=Fe-me,Ge=Ue-Ee;if(We!==0||Ge!==0){var ze=((ke-me)*We+(he-Ee)*Ge)/(We*We+Ge*Ge);ze>1?(me=Fe,Ee=Ue):ze>0&&(me+=We*ze,Ee+=Ge*ze)}return(We=ke-me)*We+(Ge=he-Ee)*Ge}function Ze(ke,he,me,Ee){var Fe={id:ke===void 0?null:ke,type:he,geometry:me,tags:Ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ue){var We=Ue.geometry,Ge=Ue.type;if(Ge==="Point"||Ge==="MultiPoint"||Ge==="LineString")xt(Ue,We);else if(Ge==="Polygon"||Ge==="MultiLineString")for(var ze=0;ze<We.length;ze++)xt(Ue,We[ze]);else if(Ge==="MultiPolygon")for(ze=0;ze<We.length;ze++)for(var Qe=0;Qe<We[ze].length;Qe++)xt(Ue,We[ze][Qe])}(Fe),Fe}function xt(ke,he){for(var me=0;me<he.length;me+=3)ke.minX=Math.min(ke.minX,he[me]),ke.minY=Math.min(ke.minY,he[me+1]),ke.maxX=Math.max(ke.maxX,he[me]),ke.maxY=Math.max(ke.maxY,he[me+1])}function It(ke,he,me,Ee){if(he.geometry){var Fe=he.geometry.coordinates,Ue=he.geometry.type,We=Math.pow(me.tolerance/((1<<me.maxZoom)*me.extent),2),Ge=[],ze=he.id;if(me.promoteId?ze=he.properties[me.promoteId]:me.generateId&&(ze=Ee||0),Ue==="Point")Bt(Fe,Ge);else if(Ue==="MultiPoint")for(var Qe=0;Qe<Fe.length;Qe++)Bt(Fe[Qe],Ge);else if(Ue==="LineString")Mi(Fe,Ge,We,!1);else if(Ue==="MultiLineString"){if(me.lineMetrics){for(Qe=0;Qe<Fe.length;Qe++)Mi(Fe[Qe],Ge=[],We,!1),ke.push(Ze(ze,"LineString",Ge,he.properties));return}je(Fe,Ge,We,!1)}else if(Ue==="Polygon")je(Fe,Ge,We,!0);else{if(Ue!=="MultiPolygon"){if(Ue==="GeometryCollection"){for(Qe=0;Qe<he.geometry.geometries.length;Qe++)It(ke,{id:ze,geometry:he.geometry.geometries[Qe],properties:he.properties},me,Ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Qe=0;Qe<Fe.length;Qe++){var _t=[];je(Fe[Qe],_t,We,!0),Ge.push(_t)}}ke.push(Ze(ze,Ue,Ge,he.properties))}}function Bt(ke,he){he.push(be(ke[0])),he.push(ge(ke[1])),he.push(0)}function Mi(ke,he,me,Ee){for(var Fe,Ue,We=0,Ge=0;Ge<ke.length;Ge++){var ze=be(ke[Ge][0]),Qe=ge(ke[Ge][1]);he.push(ze),he.push(Qe),he.push(0),Ge>0&&(We+=Ee?(Fe*Qe-ze*Ue)/2:Math.sqrt(Math.pow(ze-Fe,2)+Math.pow(Qe-Ue,2))),Fe=ze,Ue=Qe}var _t=he.length-3;he[2]=1,at(he,0,_t,me),he[_t+2]=1,he.size=Math.abs(We),he.start=0,he.end=he.size}function je(ke,he,me,Ee){for(var Fe=0;Fe<ke.length;Fe++){var Ue=[];Mi(ke[Fe],Ue,me,Ee),he.push(Ue)}}function be(ke){return ke/360+.5}function ge(ke){var he=Math.sin(ke*Math.PI/180),me=.5-.25*Math.log((1+he)/(1-he))/Math.PI;return me<0?0:me>1?1:me}function xe(ke,he,me,Ee,Fe,Ue,We,Ge){if(Ee/=he,Ue>=(me/=he)&&We<Ee)return ke;if(We<me||Ue>=Ee)return null;for(var ze=[],Qe=0;Qe<ke.length;Qe++){var _t=ke[Qe],wt=_t.geometry,Et=_t.type,wi=Fe===0?_t.minX:_t.minY,ji=Fe===0?_t.maxX:_t.maxY;if(wi>=me&&ji<Ee)ze.push(_t);else if(!(ji<me||wi>=Ee)){var ai=[];if(Et==="Point"||Et==="MultiPoint")Me(wt,ai,me,Ee,Fe);else if(Et==="LineString")Oe(wt,ai,me,Ee,Fe,!1,Ge.lineMetrics);else if(Et==="MultiLineString")rt(wt,ai,me,Ee,Fe,!1);else if(Et==="Polygon")rt(wt,ai,me,Ee,Fe,!0);else if(Et==="MultiPolygon")for(var _i=0;_i<wt.length;_i++){var zi=[];rt(wt[_i],zi,me,Ee,Fe,!0),zi.length&&ai.push(zi)}if(ai.length){if(Ge.lineMetrics&&Et==="LineString"){for(_i=0;_i<ai.length;_i++)ze.push(Ze(_t.id,Et,ai[_i],_t.tags));continue}Et!=="LineString"&&Et!=="MultiLineString"||(ai.length===1?(Et="LineString",ai=ai[0]):Et="MultiLineString"),Et!=="Point"&&Et!=="MultiPoint"||(Et=ai.length===3?"Point":"MultiPoint"),ze.push(Ze(_t.id,Et,ai,_t.tags))}}}return ze.length?ze:null}function Me(ke,he,me,Ee,Fe){for(var Ue=0;Ue<ke.length;Ue+=3){var We=ke[Ue+Fe];We>=me&&We<=Ee&&(he.push(ke[Ue]),he.push(ke[Ue+1]),he.push(ke[Ue+2]))}}function Oe(ke,he,me,Ee,Fe,Ue,We){for(var Ge,ze,Qe=De(ke),_t=Fe===0?Vt:ti,wt=ke.start,Et=0;Et<ke.length-3;Et+=3){var wi=ke[Et],ji=ke[Et+1],ai=ke[Et+2],_i=ke[Et+3],zi=ke[Et+4],wr=Fe===0?wi:ji,Or=Fe===0?_i:zi,ur=!1;We&&(Ge=Math.sqrt(Math.pow(wi-_i,2)+Math.pow(ji-zi,2))),wr<me?Or>me&&(ze=_t(Qe,wi,ji,_i,zi,me),We&&(Qe.start=wt+Ge*ze)):wr>Ee?Or<Ee&&(ze=_t(Qe,wi,ji,_i,zi,Ee),We&&(Qe.start=wt+Ge*ze)):ct(Qe,wi,ji,ai),Or<me&&wr>=me&&(ze=_t(Qe,wi,ji,_i,zi,me),ur=!0),Or>Ee&&wr<=Ee&&(ze=_t(Qe,wi,ji,_i,zi,Ee),ur=!0),!Ue&&ur&&(We&&(Qe.end=wt+Ge*ze),he.push(Qe),Qe=De(ke)),We&&(wt+=Ge)}var vr=ke.length-3;wi=ke[vr],ji=ke[vr+1],ai=ke[vr+2],(wr=Fe===0?wi:ji)>=me&&wr<=Ee&&ct(Qe,wi,ji,ai),vr=Qe.length-3,Ue&&vr>=3&&(Qe[vr]!==Qe[0]||Qe[vr+1]!==Qe[1])&&ct(Qe,Qe[0],Qe[1],Qe[2]),Qe.length&&he.push(Qe)}function De(ke){var he=[];return he.size=ke.size,he.start=ke.start,he.end=ke.end,he}function rt(ke,he,me,Ee,Fe,Ue){for(var We=0;We<ke.length;We++)Oe(ke[We],he,me,Ee,Fe,Ue,!1)}function ct(ke,he,me,Ee){ke.push(he),ke.push(me),ke.push(Ee)}function Vt(ke,he,me,Ee,Fe,Ue){var We=(Ue-he)/(Ee-he);return ke.push(Ue),ke.push(me+(Fe-me)*We),ke.push(1),We}function ti(ke,he,me,Ee,Fe,Ue){var We=(Ue-me)/(Fe-me);return ke.push(he+(Ee-he)*We),ke.push(Ue),ke.push(1),We}function lt(ke,he){for(var me=[],Ee=0;Ee<ke.length;Ee++){var Fe,Ue=ke[Ee],We=Ue.type;if(We==="Point"||We==="MultiPoint"||We==="LineString")Fe=Nt(Ue.geometry,he);else if(We==="MultiLineString"||We==="Polygon"){Fe=[];for(var Ge=0;Ge<Ue.geometry.length;Ge++)Fe.push(Nt(Ue.geometry[Ge],he))}else if(We==="MultiPolygon")for(Fe=[],Ge=0;Ge<Ue.geometry.length;Ge++){for(var ze=[],Qe=0;Qe<Ue.geometry[Ge].length;Qe++)ze.push(Nt(Ue.geometry[Ge][Qe],he));Fe.push(ze)}me.push(Ze(Ue.id,We,Fe,Ue.tags))}return me}function Nt(ke,he){var me=[];me.size=ke.size,ke.start!==void 0&&(me.start=ke.start,me.end=ke.end);for(var Ee=0;Ee<ke.length;Ee+=3)me.push(ke[Ee]+he,ke[Ee+1],ke[Ee+2]);return me}function Lt(ke,he){if(ke.transformed)return ke;var me,Ee,Fe,Ue=1<<ke.z,We=ke.x,Ge=ke.y;for(me=0;me<ke.features.length;me++){var ze=ke.features[me],Qe=ze.geometry,_t=ze.type;if(ze.geometry=[],_t===1)for(Ee=0;Ee<Qe.length;Ee+=2)ze.geometry.push(qi(Qe[Ee],Qe[Ee+1],he,Ue,We,Ge));else for(Ee=0;Ee<Qe.length;Ee++){var wt=[];for(Fe=0;Fe<Qe[Ee].length;Fe+=2)wt.push(qi(Qe[Ee][Fe],Qe[Ee][Fe+1],he,Ue,We,Ge));ze.geometry.push(wt)}}return ke.transformed=!0,ke}function qi(ke,he,me,Ee,Fe,Ue){return[Math.round(me*(ke*Ee-Fe)),Math.round(me*(he*Ee-Ue))]}function Vi(ke,he,me,Ee,Fe){for(var Ue=he===Fe.maxZoom?0:Fe.tolerance/((1<<he)*Fe.extent),We={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:me,y:Ee,z:he,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ge=0;Ge<ke.length;Ge++){We.numFeatures++,Ke(We,ke[Ge],Ue,Fe);var ze=ke[Ge].minX,Qe=ke[Ge].minY,_t=ke[Ge].maxX,wt=ke[Ge].maxY;ze<We.minX&&(We.minX=ze),Qe<We.minY&&(We.minY=Qe),_t>We.maxX&&(We.maxX=_t),wt>We.maxY&&(We.maxY=wt)}return We}function Ke(ke,he,me,Ee){var Fe=he.geometry,Ue=he.type,We=[];if(Ue==="Point"||Ue==="MultiPoint")for(var Ge=0;Ge<Fe.length;Ge+=3)We.push(Fe[Ge]),We.push(Fe[Ge+1]),ke.numPoints++,ke.numSimplified++;else if(Ue==="LineString")dt(We,Fe,ke,me,!1,!1);else if(Ue==="MultiLineString"||Ue==="Polygon")for(Ge=0;Ge<Fe.length;Ge++)dt(We,Fe[Ge],ke,me,Ue==="Polygon",Ge===0);else if(Ue==="MultiPolygon")for(var ze=0;ze<Fe.length;ze++){var Qe=Fe[ze];for(Ge=0;Ge<Qe.length;Ge++)dt(We,Qe[Ge],ke,me,!0,Ge===0)}if(We.length){var _t=he.tags||null;if(Ue==="LineString"&&Ee.lineMetrics){for(var wt in _t={},he.tags)_t[wt]=he.tags[wt];_t.mapbox_clip_start=Fe.start/Fe.size,_t.mapbox_clip_end=Fe.end/Fe.size}var Et={geometry:We,type:Ue==="Polygon"||Ue==="MultiPolygon"?3:Ue==="LineString"||Ue==="MultiLineString"?2:1,tags:_t};he.id!==null&&(Et.id=he.id),ke.features.push(Et)}}function dt(ke,he,me,Ee,Fe,Ue){var We=Ee*Ee;if(Ee>0&&he.size<(Fe?We:Ee))me.numPoints+=he.length/3;else{for(var Ge=[],ze=0;ze<he.length;ze+=3)(Ee===0||he[ze+2]>We)&&(me.numSimplified++,Ge.push(he[ze]),Ge.push(he[ze+1])),me.numPoints++;Fe&&function(Qe,_t){for(var wt=0,Et=0,wi=Qe.length,ji=wi-2;Et<wi;ji=Et,Et+=2)wt+=(Qe[Et]-Qe[ji])*(Qe[Et+1]+Qe[ji+1]);if(wt>0===_t)for(Et=0,wi=Qe.length;Et<wi/2;Et+=2){var ai=Qe[Et],_i=Qe[Et+1];Qe[Et]=Qe[wi-2-Et],Qe[Et+1]=Qe[wi-1-Et],Qe[wi-2-Et]=ai,Qe[wi-1-Et]=_i}}(Ge,Ue),ke.push(Ge)}}function kt(ke,he){var me=(he=this.options=function(Fe,Ue){for(var We in Ue)Fe[We]=Ue[We];return Fe}(Object.create(this.options),he)).debug;if(me&&console.time("preprocess data"),he.maxZoom<0||he.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(he.promoteId&&he.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ee=function(Fe,Ue){var We=[];if(Fe.type==="FeatureCollection")for(var Ge=0;Ge<Fe.features.length;Ge++)It(We,Fe.features[Ge],Ue,Ge);else It(We,Fe.type==="Feature"?Fe:{geometry:Fe},Ue);return We}(ke,he);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",he.indexMaxZoom,he.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ee=function(Fe,Ue){var We=Ue.buffer/Ue.extent,Ge=Fe,ze=xe(Fe,1,-1-We,We,0,-1,2,Ue),Qe=xe(Fe,1,1-We,2+We,0,-1,2,Ue);return(ze||Qe)&&(Ge=xe(Fe,1,-We,1+We,0,-1,2,Ue)||[],ze&&(Ge=lt(ze,1).concat(Ge)),Qe&&(Ge=Ge.concat(lt(Qe,-1)))),Ge}(Ee,he),Ee.length&&this.splitTile(Ee,0,0,0),me&&(Ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Zt(ke,he,me){return 32*((1<<ke)*me+he)+ke}function Qt(ke,he){return he?ke.properties[he]:ke.id}function Oi(ke,he){if(ke==null)return!0;if(ke.type==="Feature")return Qt(ke,he)!=null;if(ke.type==="FeatureCollection"){let me=new Set;for(let Ee of ke.features){let Fe=Qt(Ee,he);if(Fe==null||me.has(Fe))return!1;me.add(Fe)}return!0}return!1}function gr(ke,he){let me=new Map;if(ke!=null)if(ke.type==="Feature")me.set(Qt(ke,he),ke);else for(let Ee of ke.features)me.set(Qt(Ee,he),Ee);return me}function Ji(ke,he){let me=ke.tileID.canonical;if(!this._geoJSONIndex)return he(null,null);let Ee=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!Ee)return he(null,null);let Fe=new class{constructor(We){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.EXTENT,this.length=We.length,this._features=We}feature(We){return new class{constructor(Ge){this._feature=Ge,this.extent=n.EXTENT,this.type=Ge.type,this.properties=Ge.tags,"id"in Ge&&!isNaN(Ge.id)&&(this.id=parseInt(Ge.id,10))}loadGeometry(){if(this._feature.type===1){let Ge=[];for(let ze of this._feature.geometry)Ge.push([new n.Point(ze[0],ze[1])]);return Ge}{let Ge=[];for(let ze of this._feature.geometry){let Qe=[];for(let _t of ze)Qe.push(new n.Point(_t[0],_t[1]));Ge.push(Qe)}return Ge}}toGeoJSON(Ge,ze,Qe){return b.call(this,Ge,ze,Qe)}}(this._features[We])}}(Ee.features),Ue=ne(Fe);Ue.byteOffset===0&&Ue.byteLength===Ue.buffer.byteLength||(Ue=new Uint8Array(Ue)),he(null,{vectorTile:Fe,rawData:Ue.buffer})}kt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},kt.prototype.splitTile=function(ke,he,me,Ee,Fe,Ue,We){for(var Ge=[ke,he,me,Ee],ze=this.options,Qe=ze.debug;Ge.length;){Ee=Ge.pop(),me=Ge.pop(),he=Ge.pop(),ke=Ge.pop();var _t=1<<he,wt=Zt(he,me,Ee),Et=this.tiles[wt];if(!Et&&(Qe>1&&console.time("creation"),Et=this.tiles[wt]=Vi(ke,he,me,Ee,ze),this.tileCoords.push({z:he,x:me,y:Ee}),Qe)){Qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",he,me,Ee,Et.numFeatures,Et.numPoints,Et.numSimplified),console.timeEnd("creation"));var wi="z"+he;this.stats[wi]=(this.stats[wi]||0)+1,this.total++}if(Et.source=ke,Fe){if(he===ze.maxZoom||he===Fe)continue;var ji=1<<Fe-he;if(me!==Math.floor(Ue/ji)||Ee!==Math.floor(We/ji))continue}else if(he===ze.indexMaxZoom||Et.numPoints<=ze.indexMaxPoints)continue;if(Et.source=null,ke.length!==0){Qe>1&&console.time("clipping");var ai,_i,zi,wr,Or,ur,vr=.5*ze.buffer/ze.extent,co=.5-vr,Fi=.5+vr,Ws=1+vr;ai=_i=zi=wr=null,Or=xe(ke,_t,me-vr,me+Fi,0,Et.minX,Et.maxX,ze),ur=xe(ke,_t,me+co,me+Ws,0,Et.minX,Et.maxX,ze),ke=null,Or&&(ai=xe(Or,_t,Ee-vr,Ee+Fi,1,Et.minY,Et.maxY,ze),_i=xe(Or,_t,Ee+co,Ee+Ws,1,Et.minY,Et.maxY,ze),Or=null),ur&&(zi=xe(ur,_t,Ee-vr,Ee+Fi,1,Et.minY,Et.maxY,ze),wr=xe(ur,_t,Ee+co,Ee+Ws,1,Et.minY,Et.maxY,ze),ur=null),Qe>1&&console.timeEnd("clipping"),Ge.push(ai||[],he+1,2*me,2*Ee),Ge.push(_i||[],he+1,2*me,2*Ee+1),Ge.push(zi||[],he+1,2*me+1,2*Ee),Ge.push(wr||[],he+1,2*me+1,2*Ee+1)}}},kt.prototype.getTile=function(ke,he,me){var Ee=this.options,Fe=Ee.extent,Ue=Ee.debug;if(ke<0||ke>24)return null;var We=1<<ke,Ge=Zt(ke,he=(he%We+We)%We,me);if(this.tiles[Ge])return Lt(this.tiles[Ge],Fe);Ue>1&&console.log("drilling down to z%d-%d-%d",ke,he,me);for(var ze,Qe=ke,_t=he,wt=me;!ze&&Qe>0;)Qe--,_t=Math.floor(_t/2),wt=Math.floor(wt/2),ze=this.tiles[Zt(Qe,_t,wt)];return ze&&ze.source?(Ue>1&&console.log("found parent tile z%d-%d-%d",Qe,_t,wt),Ue>1&&console.time("drilling down"),this.splitTile(ze.source,Qe,_t,wt,ke,he,me),Ue>1&&console.timeEnd("drilling down"),this.tiles[Ge]?Lt(this.tiles[Ge],Fe):null):null};class ys extends m{constructor(he,me,Ee,Fe){super(he,me,Ee,Ji),this._dataUpdateable=new Map,this.loadGeoJSON=(Ue,We)=>{let{promoteId:Ge}=Ue;if(Ue.request)return n.getJSON(Ue.request,(ze,Qe,_t,wt)=>{this._dataUpdateable=Oi(Qe,Ge)?gr(Qe,Ge):void 0,We(ze,Qe,_t,wt)});if(typeof Ue.data=="string")try{let ze=JSON.parse(Ue.data);this._dataUpdateable=Oi(ze,Ge)?gr(ze,Ge):void 0,We(null,ze)}catch(ze){We(new Error(`Input data given to '${Ue.source}' is not a valid GeoJSON object.`))}else Ue.dataDiff?this._dataUpdateable?(function(ze,Qe,_t){var wt,Et,wi,ji;if(Qe.removeAll&&ze.clear(),Qe.remove)for(let ai of Qe.remove)ze.delete(ai);if(Qe.add)for(let ai of Qe.add){let _i=Qt(ai,_t);_i!=null&&ze.set(_i,ai)}if(Qe.update)for(let ai of Qe.update){let _i=ze.get(ai.id);if(_i==null)continue;let zi=!ai.removeAllProperties&&(((wt=ai.removeProperties)===null||wt===void 0?void 0:wt.length)>0||((Et=ai.addOrUpdateProperties)===null||Et===void 0?void 0:Et.length)>0);if((ai.newGeometry||ai.removeAllProperties||zi)&&(_i=di({},_i),ze.set(ai.id,_i),zi&&(_i.properties=di({},_i.properties))),ai.newGeometry&&(_i.geometry=ai.newGeometry),ai.removeAllProperties)_i.properties={};else if(((wi=ai.removeProperties)===null||wi===void 0?void 0:wi.length)>0)for(let wr of ai.removeProperties)Object.prototype.hasOwnProperty.call(_i.properties,wr)&&delete _i.properties[wr];if(((ji=ai.addOrUpdateProperties)===null||ji===void 0?void 0:ji.length)>0)for(let{key:wr,value:Or}of ai.addOrUpdateProperties)_i.properties[wr]=Or}}(this._dataUpdateable,Ue.dataDiff,Ge),We(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):We(new Error(`Cannot update existing geojson data in ${Ue.source}`)):We(new Error(`Input data given to '${Ue.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},Fe&&(this.loadGeoJSON=Fe)}loadData(he,me){var Ee;(Ee=this._pendingRequest)===null||Ee===void 0||Ee.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});let Fe=!!(he&&he.request&&he.request.collectResourceTiming)&&new n.RequestPerformance(he.request);this._pendingCallback=me,this._pendingRequest=this.loadGeoJSON(he,(Ue,We)=>{if(delete this._pendingCallback,delete this._pendingRequest,Ue||!We)return me(Ue);if(typeof We!="object")return me(new Error(`Input data given to '${he.source}' is not a valid GeoJSON object.`));{E(We,!0);try{if(he.filter){let ze=n.createExpression(he.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ze.result==="error")throw new Error(ze.value.map(_t=>`${_t.key}: ${_t.message}`).join(", "));We={type:"FeatureCollection",features:We.features.filter(_t=>ze.value.evaluate({zoom:0},_t))}}this._geoJSONIndex=he.cluster?new Re(function({superclusterOptions:ze,clusterProperties:Qe}){if(!Qe||!ze)return ze;let _t={},wt={},Et={accumulated:null,zoom:0},wi={properties:null},ji=Object.keys(Qe);for(let ai of ji){let[_i,zi]=Qe[ai],wr=n.createExpression(zi),Or=n.createExpression(typeof _i=="string"?[_i,["accumulated"],["get",ai]]:_i);_t[ai]=wr.value,wt[ai]=Or.value}return ze.map=ai=>{wi.properties=ai;let _i={};for(let zi of ji)_i[zi]=_t[zi].evaluate(Et,wi);return _i},ze.reduce=(ai,_i)=>{wi.properties=_i;for(let zi of ji)Et.accumulated=ai[zi],ai[zi]=wt[zi].evaluate(Et,wi)},ze}(he)).load(We.features):function(ze,Qe){return new kt(ze,Qe)}(We,he.geojsonVtOptions)}catch(ze){return me(ze)}this.loaded={};let Ge={};if(Fe){let ze=Fe.finish();ze&&(Ge.resourceTiming={},Ge.resourceTiming[he.source]=JSON.parse(JSON.stringify(ze)))}me(null,Ge)}})}reloadTile(he,me){let Ee=this.loaded;return Ee&&Ee[he.uid]?super.reloadTile(he,me):this.loadTile(he,me)}removeSource(he,me){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),me()}getClusterExpansionZoom(he,me){try{me(null,this._geoJSONIndex.getClusterExpansionZoom(he.clusterId))}catch(Ee){me(Ee)}}getClusterChildren(he,me){try{me(null,this._geoJSONIndex.getChildren(he.clusterId))}catch(Ee){me(Ee)}}getClusterLeaves(he,me){try{me(null,this._geoJSONIndex.getLeaves(he.clusterId,he.limit,he.offset))}catch(Ee){me(Ee)}}}class hs{constructor(he){this.self=he,this.actor=new n.Actor(he,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:m,geojson:ys},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(me,Ee)=>{if(this.workerSourceTypes[me])throw new Error(`Worker source with name "${me}" already registered.`);this.workerSourceTypes[me]=Ee},this.self.registerRTLTextPlugin=me=>{if(n.plugin.isParsed())throw new Error("RTL text plugin already registered.");n.plugin.applyArabicShaping=me.applyArabicShaping,n.plugin.processBidirectionalText=me.processBidirectionalText,n.plugin.processStyledBidirectionalText=me.processStyledBidirectionalText}}setReferrer(he,me){this.referrer=me}setImages(he,me,Ee){this.availableImages[he]=me;for(let Fe in this.workerSources[he]){let Ue=this.workerSources[he][Fe];for(let We in Ue)Ue[We].availableImages=me}Ee()}setLayers(he,me,Ee){this.getLayerIndex(he).replace(me),Ee()}updateLayers(he,me,Ee){this.getLayerIndex(he).update(me.layers,me.removedIds),Ee()}loadTile(he,me,Ee){this.getWorkerSource(he,me.type,me.source).loadTile(me,Ee)}loadDEMTile(he,me,Ee){this.getDEMWorkerSource(he,me.source).loadTile(me,Ee)}reloadTile(he,me,Ee){this.getWorkerSource(he,me.type,me.source).reloadTile(me,Ee)}abortTile(he,me,Ee){this.getWorkerSource(he,me.type,me.source).abortTile(me,Ee)}removeTile(he,me,Ee){this.getWorkerSource(he,me.type,me.source).removeTile(me,Ee)}removeDEMTile(he,me){this.getDEMWorkerSource(he,me.source).removeTile(me)}removeSource(he,me,Ee){if(!this.workerSources[he]||!this.workerSources[he][me.type]||!this.workerSources[he][me.type][me.source])return;let Fe=this.workerSources[he][me.type][me.source];delete this.workerSources[he][me.type][me.source],Fe.removeSource!==void 0?Fe.removeSource(me,Ee):Ee()}loadWorkerSource(he,me,Ee){try{this.self.importScripts(me.url),Ee()}catch(Fe){Ee(Fe.toString())}}syncRTLPluginState(he,me,Ee){try{n.plugin.setState(me);let Fe=n.plugin.getPluginURL();if(n.plugin.isLoaded()&&!n.plugin.isParsed()&&Fe!=null){this.self.importScripts(Fe);let Ue=n.plugin.isParsed();Ee(Ue?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Fe}`),Ue)}}catch(Fe){Ee(Fe.toString())}}getAvailableImages(he){let me=this.availableImages[he];return me||(me=[]),me}getLayerIndex(he){let me=this.layerIndexes[he];return me||(me=this.layerIndexes[he]=new o),me}getWorkerSource(he,me,Ee){if(this.workerSources[he]||(this.workerSources[he]={}),this.workerSources[he][me]||(this.workerSources[he][me]={}),!this.workerSources[he][me][Ee]){let Fe={send:(Ue,We,Ge)=>{this.actor.send(Ue,We,Ge,he)}};this.workerSources[he][me][Ee]=new this.workerSourceTypes[me](Fe,this.getLayerIndex(he),this.getAvailableImages(he))}return this.workerSources[he][me][Ee]}getDEMWorkerSource(he,me){return this.demWorkerSources[he]||(this.demWorkerSources[he]={}),this.demWorkerSources[he][me]||(this.demWorkerSources[he][me]=new g),this.demWorkerSources[he][me]}}return n.isWorker()&&(self.worker=new hs(self)),hs}),r(["./shared"],function(n){"use strict";var o="3.3.0";class a{static testProp(h){if(!a.docStyle)return h[0];for(let x=0;x<h.length;x++)if(h[x]in a.docStyle)return h[x];return h[0]}static create(h,x,S){let I=window.document.createElement(h);return x!==void 0&&(I.className=x),S&&S.appendChild(I),I}static createNS(h,x){return window.document.createElementNS(h,x)}static disableDrag(){a.docStyle&&a.selectProp&&(a.userSelect=a.docStyle[a.selectProp],a.docStyle[a.selectProp]="none")}static enableDrag(){a.docStyle&&a.selectProp&&(a.docStyle[a.selectProp]=a.userSelect)}static setTransform(h,x){h.style[a.transformProp]=x}static addEventListener(h,x,S,I={}){h.addEventListener(x,S,"passive"in I?I:I.capture)}static removeEventListener(h,x,S,I={}){h.removeEventListener(x,S,"passive"in I?I:I.capture)}static suppressClickInternal(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",a.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",a.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",a.suppressClickInternal,!0)},0)}static mousePos(h,x){let S=h.getBoundingClientRect();return new n.Point(x.clientX-S.left-h.clientLeft,x.clientY-S.top-h.clientTop)}static touchPos(h,x){let S=h.getBoundingClientRect(),I=[];for(let D=0;D<x.length;D++)I.push(new n.Point(x[D].clientX-S.left-h.clientLeft,x[D].clientY-S.top-h.clientTop));return I}static mouseButton(h){return h.button}static remove(h){h.parentNode&&h.parentNode.removeChild(h)}}a.docStyle=typeof window!="undefined"&&window.document&&window.document.documentElement.style,a.selectProp=a.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),a.transformProp=a.testProp(["transform","WebkitTransform"]);let l={supported:!1,testSupport:function(P){!m&&d&&(g?_(P):c=P)}},c,d,m=!1,g=!1;function _(P){let h=P.createTexture();P.bindTexture(P.TEXTURE_2D,h);try{if(P.texImage2D(P.TEXTURE_2D,0,P.RGBA,P.RGBA,P.UNSIGNED_BYTE,d),P.isContextLost())return;l.supported=!0}catch(x){}P.deleteTexture(h),m=!0}var v,E;typeof document!="undefined"&&(d=document.createElement("img"),d.onload=function(){c&&_(c),c=null,g=!0},d.onerror=function(){m=!0,c=null},d.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(P){let h,x,S,I;P.resetRequestQueue=()=>{h=[],x=0,S=0,I={}},P.addThrottleControl=J=>{let se=S++;return I[se]=J,se},P.removeThrottleControl=J=>{delete I[J],H()},P.getImage=(J,se,ce=!0)=>{l.supported&&(J.headers||(J.headers={}),J.headers.accept="image/webp,*/*");let _e={requestParameters:J,supportImageRefresh:ce,callback:se,cancelled:!1,completed:!1,cancel:()=>{_e.completed||_e.cancelled||(_e.cancelled=!0,_e.innerRequest&&(_e.innerRequest.cancel(),x--),H())}};return h.push(_e),H(),_e};let D=J=>{let{requestParameters:se,supportImageRefresh:ce,callback:_e}=J;return n.extend(se,{type:"image"}),(ce!==!1||n.isWorker()||n.getProtocolAction(se.url)||se.headers&&!Object.keys(se.headers).reduce((Ce,Ae)=>Ce&&Ae==="accept",!0)?n.makeRequest:Y)(se,(Ce,Ae,Pe,Se)=>{$(J,_e,Ce,Ae,Pe,Se)})},$=(J,se,ce,_e,Ce,Ae)=>{ce?se(ce):_e instanceof HTMLImageElement||n.isImageBitmap(_e)?se(null,_e):_e&&((Pe,Se)=>{typeof createImageBitmap=="function"?n.arrayBufferToImageBitmap(Pe,Se):n.arrayBufferToImage(Pe,Se)})(_e,(Pe,Se)=>{Pe!=null?se(Pe):Se!=null&&se(null,Se,{cacheControl:Ce,expires:Ae})}),J.cancelled||(J.completed=!0,x--,H())},H=()=>{let J=(()=>{let se=Object.keys(I),ce=!1;if(se.length>0){for(let _e of se)if(ce=I[_e](),ce)break}return ce})()?n.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:n.config.MAX_PARALLEL_IMAGE_REQUESTS;for(let se=x;se<J&&h.length>0;se++){let ce=h.shift();if(ce.cancelled){se--;continue}let _e=D(ce);x++,ce.innerRequest=_e}},Y=(J,se)=>{let ce=new Image,_e=J.url,Ce=!1,Ae=J.credentials;return Ae&&Ae==="include"?ce.crossOrigin="use-credentials":(Ae&&Ae==="same-origin"||!n.sameOrigin(_e))&&(ce.crossOrigin="anonymous"),ce.fetchPriority="high",ce.onload=()=>{se(null,ce),ce.onerror=ce.onload=null},ce.onerror=()=>{Ce||se(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),ce.onerror=ce.onload=null},ce.src=_e,{cancel:()=>{Ce=!0,ce.src=""}}}}(v||(v={})),v.resetRequestQueue(),function(P){P.Glyphs="Glyphs",P.Image="Image",P.Source="Source",P.SpriteImage="SpriteImage",P.SpriteJSON="SpriteJSON",P.Style="Style",P.Tile="Tile",P.Unknown="Unknown"}(E||(E={}));class b{constructor(h){this._transformRequestFn=h}transformRequest(h,x){return this._transformRequestFn&&this._transformRequestFn(h,x)||{url:h}}normalizeSpriteURL(h,x,S){let I=function(D){let $=D.match(T);if(!$)throw new Error(`Unable to parse URL "${D}"`);return{protocol:$[1],authority:$[2],path:$[3]||"/",params:$[4]?$[4].split("&"):[]}}(h);return I.path+=`${x}${S}`,function(D){let $=D.params.length?`?${D.params.join("&")}`:"";return`${D.protocol}://${D.authority}${D.path}${$}`}(I)}setTransformRequest(h){this._transformRequestFn=h}}let T=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function A(P){var h=new n.ARRAY_TYPE(3);return h[0]=P[0],h[1]=P[1],h[2]=P[2],h}var M,k=function(P,h,x){return P[0]=h[0]-x[0],P[1]=h[1]-x[1],P[2]=h[2]-x[2],P};M=new n.ARRAY_TYPE(3),n.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0);var F=function(P){var h=P[0],x=P[1];return h*h+x*x};function O(P){let h=[];if(typeof P=="string")h.push({id:"default",url:P});else if(P&&P.length>0){let x=[];for(let{id:S,url:I}of P){let D=`${S}${I}`;x.indexOf(D)===-1&&(x.push(D),h.push({id:S,url:I}))}}return h}function B(P,h,x,S,I){if(S)return void P(S);if(I!==Object.values(h).length||I!==Object.values(x).length)return;let D={};for(let $ in h){D[$]={};let H=n.browser.getImageCanvasContext(x[$]),Y=h[$];for(let J in Y){let{width:se,height:ce,x:_e,y:Ce,sdf:Ae,pixelRatio:Pe,stretchX:Se,stretchY:Ve,content:tt}=Y[J];D[$][J]={data:null,pixelRatio:Pe,sdf:Ae,stretchX:Se,stretchY:Ve,content:tt,spriteData:{width:se,height:ce,x:_e,y:Ce,context:H}}}}P(null,D)}(function(){var P=new n.ARRAY_TYPE(2);n.ARRAY_TYPE!=Float32Array&&(P[0]=0,P[1]=0)})();class U{constructor(h,x,S,I){this.context=h,this.format=S,this.texture=h.gl.createTexture(),this.update(x,I)}update(h,x,S){let{width:I,height:D}=h,$=!(this.size&&this.size[0]===I&&this.size[1]===D||S),{context:H}=this,{gl:Y}=H;if(this.useMipmap=!!(x&&x.useMipmap),Y.bindTexture(Y.TEXTURE_2D,this.texture),H.pixelStoreUnpackFlipY.set(!1),H.pixelStoreUnpack.set(1),H.pixelStoreUnpackPremultiplyAlpha.set(this.format===Y.RGBA&&(!x||x.premultiply!==!1)),$)this.size=[I,D],h instanceof HTMLImageElement||h instanceof HTMLCanvasElement||h instanceof HTMLVideoElement||h instanceof ImageData||n.isImageBitmap(h)?Y.texImage2D(Y.TEXTURE_2D,0,this.format,this.format,Y.UNSIGNED_BYTE,h):Y.texImage2D(Y.TEXTURE_2D,0,this.format,I,D,0,this.format,Y.UNSIGNED_BYTE,h.data);else{let{x:J,y:se}=S||{x:0,y:0};h instanceof HTMLImageElement||h instanceof HTMLCanvasElement||h instanceof HTMLVideoElement||h instanceof ImageData||n.isImageBitmap(h)?Y.texSubImage2D(Y.TEXTURE_2D,0,J,se,Y.RGBA,Y.UNSIGNED_BYTE,h):Y.texSubImage2D(Y.TEXTURE_2D,0,J,se,I,D,Y.RGBA,Y.UNSIGNED_BYTE,h.data)}this.useMipmap&&this.isSizePowerOfTwo()&&Y.generateMipmap(Y.TEXTURE_2D)}bind(h,x,S){let{context:I}=this,{gl:D}=I;D.bindTexture(D.TEXTURE_2D,this.texture),S!==D.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(S=D.LINEAR),h!==this.filter&&(D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,h),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,S||h),this.filter=h),x!==this.wrap&&(D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,x),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,x),this.wrap=x)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:h}=this.context;h.deleteTexture(this.texture),this.texture=null}}function z(P){let{userImage:h}=P;return!!(h&&h.render&&h.render())&&(P.data.replace(new Uint8Array(h.data.buffer)),!0)}class Z extends n.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new n.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(h){if(this.loaded!==h&&(this.loaded=h,h)){for(let{ids:x,callback:S}of this.requestors)this._notify(x,S);this.requestors=[]}}getImage(h){let x=this.images[h];if(x&&!x.data&&x.spriteData){let S=x.spriteData;x.data=new n.RGBAImage({width:S.width,height:S.height},S.context.getImageData(S.x,S.y,S.width,S.height).data),x.spriteData=null}return x}addImage(h,x){if(this.images[h])throw new Error(`Image id ${h} already exist, use updateImage instead`);this._validate(h,x)&&(this.images[h]=x)}_validate(h,x){let S=!0,I=x.data||x.spriteData;return this._validateStretch(x.stretchX,I&&I.width)||(this.fire(new n.ErrorEvent(new Error(`Image "${h}" has invalid "stretchX" value`))),S=!1),this._validateStretch(x.stretchY,I&&I.height)||(this.fire(new n.ErrorEvent(new Error(`Image "${h}" has invalid "stretchY" value`))),S=!1),this._validateContent(x.content,x)||(this.fire(new n.ErrorEvent(new Error(`Image "${h}" has invalid "content" value`))),S=!1),S}_validateStretch(h,x){if(!h)return!0;let S=0;for(let I of h){if(I[0]<S||I[1]<I[0]||x<I[1])return!1;S=I[1]}return!0}_validateContent(h,x){if(!h)return!0;if(h.length!==4)return!1;let S=x.spriteData,I=S&&S.width||x.data.width,D=S&&S.height||x.data.height;return!(h[0]<0||I<h[0]||h[1]<0||D<h[1]||h[2]<0||I<h[2]||h[3]<0||D<h[3]||h[2]<h[0]||h[3]<h[1])}updateImage(h,x,S=!0){let I=this.getImage(h);if(S&&(I.data.width!==x.data.width||I.data.height!==x.data.height))throw new Error(`size mismatch between old image (${I.data.width}x${I.data.height}) and new image (${x.data.width}x${x.data.height}).`);x.version=I.version+1,this.images[h]=x,this.updatedImages[h]=!0}removeImage(h){let x=this.images[h];delete this.images[h],delete this.patterns[h],x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(h,x){let S=!0;if(!this.isLoaded())for(let I of h)this.images[I]||(S=!1);this.isLoaded()||S?this._notify(h,x):this.requestors.push({ids:h,callback:x})}_notify(h,x){let S={};for(let I of h){let D=this.getImage(I);D||(this.fire(new n.Event("styleimagemissing",{id:I})),D=this.getImage(I)),D?S[I]={data:D.data.clone(),pixelRatio:D.pixelRatio,sdf:D.sdf,version:D.version,stretchX:D.stretchX,stretchY:D.stretchY,content:D.content,hasRenderCallback:!!(D.userImage&&D.userImage.render)}:n.warnOnce(`Image "${I}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}x(null,S)}getPixelSize(){let{width:h,height:x}=this.atlasImage;return{width:h,height:x}}getPattern(h){let x=this.patterns[h],S=this.getImage(h);if(!S)return null;if(x&&x.position.version===S.version)return x.position;if(x)x.position.version=S.version;else{let I={w:S.data.width+2,h:S.data.height+2,x:0,y:0},D=new n.ImagePosition(I,S);this.patterns[h]={bin:I,position:D}}return this._updatePatternAtlas(),this.patterns[h].position}bind(h){let x=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new U(h,this.atlasImage,x.RGBA),this.atlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE)}_updatePatternAtlas(){let h=[];for(let D in this.patterns)h.push(this.patterns[D].bin);let{w:x,h:S}=n.potpack(h),I=this.atlasImage;I.resize({width:x||1,height:S||1});for(let D in this.patterns){let{bin:$}=this.patterns[D],H=$.x+1,Y=$.y+1,J=this.getImage(D).data,se=J.width,ce=J.height;n.RGBAImage.copy(J,I,{x:0,y:0},{x:H,y:Y},{width:se,height:ce}),n.RGBAImage.copy(J,I,{x:0,y:ce-1},{x:H,y:Y-1},{width:se,height:1}),n.RGBAImage.copy(J,I,{x:0,y:0},{x:H,y:Y+ce},{width:se,height:1}),n.RGBAImage.copy(J,I,{x:se-1,y:0},{x:H-1,y:Y},{width:1,height:ce}),n.RGBAImage.copy(J,I,{x:0,y:0},{x:H+se,y:Y},{width:1,height:ce})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(h){for(let x of h){if(this.callbackDispatchedThisFrame[x])continue;this.callbackDispatchedThisFrame[x]=!0;let S=this.getImage(x);S||n.warnOnce(`Image with ID: "${x}" was not found`),z(S)&&this.updateImage(x,S)}}}let W=1e20;function q(P,h,x,S,I,D,$,H,Y){for(let J=h;J<h+S;J++)Q(P,x*D+J,D,I,$,H,Y);for(let J=x;J<x+I;J++)Q(P,J*D+h,1,S,$,H,Y)}function Q(P,h,x,S,I,D,$){D[0]=0,$[0]=-W,$[1]=W,I[0]=P[h];for(let H=1,Y=0,J=0;H<S;H++){I[H]=P[h+H*x];let se=H*H;do{let ce=D[Y];J=(I[H]-I[ce]+se-ce*ce)/(H-ce)/2}while(J<=$[Y]&&--Y>-1);Y++,D[Y]=H,$[Y]=J,$[Y+1]=W}for(let H=0,Y=0;H<S;H++){for(;$[Y+1]<H;)Y++;let J=D[Y],se=H-J;P[h+H*x]=I[J]+se*se}}class V{constructor(h,x){this.requestManager=h,this.localIdeographFontFamily=x,this.entries={}}setURL(h){this.url=h}getGlyphs(h,x){let S=[];for(let I in h)for(let D of h[I])S.push({stack:I,id:D});n.asyncAll(S,({stack:I,id:D},$)=>{let H=this.entries[I];H||(H=this.entries[I]={glyphs:{},requests:{},ranges:{}});let Y=H.glyphs[D];if(Y!==void 0)return void $(null,{stack:I,id:D,glyph:Y});if(Y=this._tinySDF(H,I,D),Y)return H.glyphs[D]=Y,void $(null,{stack:I,id:D,glyph:Y});let J=Math.floor(D/256);if(256*J>65535)return void $(new Error("glyphs > 65535 not supported"));if(H.ranges[J])return void $(null,{stack:I,id:D,glyph:Y});if(!this.url)return void $(new Error("glyphsUrl is not set"));let se=H.requests[J];se||(se=H.requests[J]=[],V.loadGlyphRange(I,J,this.url,this.requestManager,(ce,_e)=>{if(_e){for(let Ce in _e)this._doesCharSupportLocalGlyph(+Ce)||(H.glyphs[+Ce]=_e[+Ce]);H.ranges[J]=!0}for(let Ce of se)Ce(ce,_e);delete H.requests[J]})),se.push((ce,_e)=>{ce?$(ce):_e&&$(null,{stack:I,id:D,glyph:_e[D]||null})})},(I,D)=>{if(I)x(I);else if(D){let $={};for(let{stack:H,id:Y,glyph:J}of D)($[H]||($[H]={}))[Y]=J&&{id:J.id,bitmap:J.bitmap.clone(),metrics:J.metrics};x(null,$)}})}_doesCharSupportLocalGlyph(h){return!!this.localIdeographFontFamily&&(n.unicodeBlockLookup["CJK Unified Ideographs"](h)||n.unicodeBlockLookup["Hangul Syllables"](h)||n.unicodeBlockLookup.Hiragana(h)||n.unicodeBlockLookup.Katakana(h))}_tinySDF(h,x,S){let I=this.localIdeographFontFamily;if(!I||!this._doesCharSupportLocalGlyph(S))return;let D=h.tinySDF;if(!D){let H="400";/bold/i.test(x)?H="900":/medium/i.test(x)?H="500":/light/i.test(x)&&(H="200"),D=h.tinySDF=new V.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:I,fontWeight:H})}let $=D.draw(String.fromCharCode(S));return{id:S,bitmap:new n.AlphaImage({width:$.width||30,height:$.height||30},$.data),metrics:{width:$.glyphWidth||24,height:$.glyphHeight||24,left:$.glyphLeft||0,top:$.glyphTop-27||-8,advance:$.glyphAdvance||24}}}}V.loadGlyphRange=function(P,h,x,S,I){let D=256*h,$=D+255,H=S.transformRequest(x.replace("{fontstack}",P).replace("{range}",`${D}-${$}`),E.Glyphs);n.getArrayBuffer(H,(Y,J)=>{if(Y)I(Y);else if(J){let se={};for(let ce of n.parseGlyphPbf(J))se[ce.id]=ce;I(null,se)}})},V.TinySDF=class{constructor({fontSize:P=24,buffer:h=3,radius:x=8,cutoff:S=.25,fontFamily:I="sans-serif",fontWeight:D="normal",fontStyle:$="normal"}={}){this.buffer=h,this.cutoff=S,this.radius=x;let H=this.size=P+4*h,Y=this._createCanvas(H),J=this.ctx=Y.getContext("2d",{willReadFrequently:!0});J.font=`${$} ${D} ${P}px ${I}`,J.textBaseline="alphabetic",J.textAlign="left",J.fillStyle="black",this.gridOuter=new Float64Array(H*H),this.gridInner=new Float64Array(H*H),this.f=new Float64Array(H),this.z=new Float64Array(H+1),this.v=new Uint16Array(H)}_createCanvas(P){let h=document.createElement("canvas");return h.width=h.height=P,h}draw(P){let{width:h,actualBoundingBoxAscent:x,actualBoundingBoxDescent:S,actualBoundingBoxLeft:I,actualBoundingBoxRight:D}=this.ctx.measureText(P),$=Math.ceil(x),H=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(D-I))),Y=Math.min(this.size-this.buffer,$+Math.ceil(S)),J=H+2*this.buffer,se=Y+2*this.buffer,ce=Math.max(J*se,0),_e=new Uint8ClampedArray(ce),Ce={data:_e,width:J,height:se,glyphWidth:H,glyphHeight:Y,glyphTop:$,glyphLeft:0,glyphAdvance:h};if(H===0||Y===0)return Ce;let{ctx:Ae,buffer:Pe,gridInner:Se,gridOuter:Ve}=this;Ae.clearRect(Pe,Pe,H,Y),Ae.fillText(P,Pe,Pe+$);let tt=Ae.getImageData(Pe,Pe,H,Y);Ve.fill(W,0,ce),Se.fill(0,0,ce);for(let Ne=0;Ne<Y;Ne++)for(let Xe=0;Xe<H;Xe++){let st=tt.data[4*(Ne*H+Xe)+3]/255;if(st===0)continue;let nt=(Ne+Pe)*J+Xe+Pe;if(st===1)Ve[nt]=0,Se[nt]=W;else{let ft=.5-st;Ve[nt]=ft>0?ft*ft:0,Se[nt]=ft<0?ft*ft:0}}q(Ve,0,0,J,se,J,this.f,this.v,this.z),q(Se,Pe,Pe,H,Y,J,this.f,this.v,this.z);for(let Ne=0;Ne<ce;Ne++){let Xe=Math.sqrt(Ve[Ne])-Math.sqrt(Se[Ne]);_e[Ne]=Math.round(255-255*(Xe/this.radius+this.cutoff))}return Ce}};class le{constructor(){this.specification=n.v8Spec.light.position}possiblyEvaluate(h,x){return n.sphericalToCartesian(h.expression.evaluate(x))}interpolate(h,x,S){return{x:n.interpolate.number(h.x,x.x,S),y:n.interpolate.number(h.y,x.y,S),z:n.interpolate.number(h.z,x.z,S)}}}let de,ne;class ee extends n.Evented{constructor(h){super(),de=de||new n.Properties({anchor:new n.DataConstantProperty(n.v8Spec.light.anchor),position:new le,color:new n.DataConstantProperty(n.v8Spec.light.color),intensity:new n.DataConstantProperty(n.v8Spec.light.intensity)}),this._transitionable=new n.Transitionable(de),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(h,x={}){if(!this._validate(n.validateLight,h,x))for(let S in h){let I=h[S];S.endsWith("-transition")?this._transitionable.setTransition(S.slice(0,-11),I):this._transitionable.setValue(S,I)}}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,x,S){return(!S||S.validate!==!1)&&n.emitValidationErrors(this,h.call(n.validateStyle,n.extend({value:x,style:{glyphs:!0,sprite:!0},styleSpec:n.v8Spec})))}}class re{constructor(h,x){this.width=h,this.height=x,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(h,x){let S=h.join(",")+String(x);return this.dashEntry[S]||(this.dashEntry[S]=this.addDash(h,x)),this.dashEntry[S]}getDashRanges(h,x,S){let I=[],D=h.length%2==1?-h[h.length-1]*S:0,$=h[0]*S,H=!0;I.push({left:D,right:$,isDash:H,zeroLength:h[0]===0});let Y=h[0];for(let J=1;J<h.length;J++){H=!H;let se=h[J];D=Y*S,Y+=se,$=Y*S,I.push({left:D,right:$,isDash:H,zeroLength:se===0})}return I}addRoundDash(h,x,S){let I=x/2;for(let D=-S;D<=S;D++){let $=this.width*(this.nextRow+S+D),H=0,Y=h[H];for(let J=0;J<this.width;J++){J/Y.right>1&&(Y=h[++H]);let se=Math.abs(J-Y.left),ce=Math.abs(J-Y.right),_e=Math.min(se,ce),Ce,Ae=D/S*(I+1);if(Y.isDash){let Pe=I-Math.abs(Ae);Ce=Math.sqrt(_e*_e+Pe*Pe)}else Ce=I-Math.sqrt(_e*_e+Ae*Ae);this.data[$+J]=Math.max(0,Math.min(255,Ce+128))}}}addRegularDash(h){for(let H=h.length-1;H>=0;--H){let Y=h[H],J=h[H+1];Y.zeroLength?h.splice(H,1):J&&J.isDash===Y.isDash&&(J.left=Y.left,h.splice(H,1))}let x=h[0],S=h[h.length-1];x.isDash===S.isDash&&(x.left=S.left-this.width,S.right=x.right+this.width);let I=this.width*this.nextRow,D=0,$=h[D];for(let H=0;H<this.width;H++){H/$.right>1&&($=h[++D]);let Y=Math.abs(H-$.left),J=Math.abs(H-$.right),se=Math.min(Y,J);this.data[I+H]=Math.max(0,Math.min(255,($.isDash?se:-se)+128))}}addDash(h,x){let S=x?7:0,I=2*S+1;if(this.nextRow+I>this.height)return n.warnOnce("LineAtlas out of space"),null;let D=0;for(let H=0;H<h.length;H++)D+=h[H];if(D!==0){let H=this.width/D,Y=this.getDashRanges(h,this.width,H);x?this.addRoundDash(Y,H,S):this.addRegularDash(Y)}let $={y:(this.nextRow+S+.5)/this.height,height:2*S/this.height,width:D};return this.nextRow+=I,this.dirty=!0,$}bind(h){let x=h.gl;this.texture?(x.bindTexture(x.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,x.texSubImage2D(x.TEXTURE_2D,0,0,0,this.width,this.height,x.ALPHA,x.UNSIGNED_BYTE,this.data))):(this.texture=x.createTexture(),x.bindTexture(x.TEXTURE_2D,this.texture),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.REPEAT),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.REPEAT),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.LINEAR),x.texImage2D(x.TEXTURE_2D,0,x.ALPHA,this.width,this.height,0,x.ALPHA,x.UNSIGNED_BYTE,this.data))}}class te{constructor(h,x,S){this.workerPool=h,this.actors=[],this.currentActor=0,this.id=S;let I=this.workerPool.acquire(S);for(let D=0;D<I.length;D++){let $=new te.Actor(I[D],x,S);$.name=`Worker ${D}`,this.actors.push($)}if(!this.actors.length)throw new Error("No actors found")}broadcast(h,x,S){n.asyncAll(this.actors,(I,D)=>{I.send(h,x,D)},S=S||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(h=!0){this.actors.forEach(x=>{x.remove()}),this.actors=[],h&&this.workerPool.release(this.id)}}function ie(P,h,x){let S=function(I,D){if(I)return x(I);if(D){let $=n.pick(n.extend(D,P),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);D.vector_layers&&($.vectorLayers=D.vector_layers,$.vectorLayerIds=$.vectorLayers.map(H=>H.id)),x(null,$)}};return P.url?n.getJSON(h.transformRequest(P.url,E.Source),S):n.browser.frame(()=>S(null,P))}te.Actor=n.Actor;class oe{constructor(h,x){h&&(x?this.setSouthWest(h).setNorthEast(x):Array.isArray(h)&&(h.length===4?this.setSouthWest([h[0],h[1]]).setNorthEast([h[2],h[3]]):this.setSouthWest(h[0]).setNorthEast(h[1])))}setNorthEast(h){return this._ne=h instanceof n.LngLat?new n.LngLat(h.lng,h.lat):n.LngLat.convert(h),this}setSouthWest(h){return this._sw=h instanceof n.LngLat?new n.LngLat(h.lng,h.lat):n.LngLat.convert(h),this}extend(h){let x=this._sw,S=this._ne,I,D;if(h instanceof n.LngLat)I=h,D=h;else{if(!(h instanceof oe))return Array.isArray(h)?h.length===4||h.every(Array.isArray)?this.extend(oe.convert(h)):this.extend(n.LngLat.convert(h)):h&&("lng"in h||"lon"in h)&&"lat"in h?this.extend(n.LngLat.convert(h)):this;if(I=h._sw,D=h._ne,!I||!D)return this}return x||S?(x.lng=Math.min(I.lng,x.lng),x.lat=Math.min(I.lat,x.lat),S.lng=Math.max(D.lng,S.lng),S.lat=Math.max(D.lat,S.lat)):(this._sw=new n.LngLat(I.lng,I.lat),this._ne=new n.LngLat(D.lng,D.lat)),this}getCenter(){return new n.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new n.LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new n.LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(h){let{lng:x,lat:S}=n.LngLat.convert(h),I=this._sw.lng<=x&&x<=this._ne.lng;return this._sw.lng>this._ne.lng&&(I=this._sw.lng>=x&&x>=this._ne.lng),this._sw.lat<=S&&S<=this._ne.lat&&I}static convert(h){return h instanceof oe?h:h&&new oe(h)}static fromLngLat(h,x=0){let S=360*x/40075017,I=S/Math.cos(Math.PI/180*h.lat);return new oe(new n.LngLat(h.lng-I,h.lat-S),new n.LngLat(h.lng+I,h.lat+S))}}class fe{constructor(h,x,S){this.bounds=oe.convert(this.validateBounds(h)),this.minzoom=x||0,this.maxzoom=S||24}validateBounds(h){return Array.isArray(h)&&h.length===4?[Math.max(-180,h[0]),Math.max(-90,h[1]),Math.min(180,h[2]),Math.min(90,h[3])]:[-180,-90,180,90]}contains(h){let x=Math.pow(2,h.z),S=Math.floor(n.mercatorXfromLng(this.bounds.getWest())*x),I=Math.floor(n.mercatorYfromLat(this.bounds.getNorth())*x),D=Math.ceil(n.mercatorXfromLng(this.bounds.getEast())*x),$=Math.ceil(n.mercatorYfromLat(this.bounds.getSouth())*x);return h.x>=S&&h.x<D&&h.y>=I&&h.y<$}}class Re extends n.Evented{constructor(h,x,S,I){if(super(),this.load=()=>{this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ie(this._options,this.map._requestManager,(D,$)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),D?this.fire(new n.ErrorEvent(D)):$&&(n.extend(this,$),$.bounds&&(this.tileBounds=new fe($.bounds,this.minzoom,this.maxzoom)),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>n.extend({},this._options),this.id=h,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.extend(this,n.pick(x,["url","scheme","tileSize","promoteId"])),this._options=n.extend({type:"vector"},x),this._collectResourceTiming=x.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(I)}loaded(){return this._loaded}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}onAdd(h){this.map=h,this.load()}setSourceProperty(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.load()}setTiles(h){return this.setSourceProperty(()=>{this._options.tiles=h}),this}setUrl(h){return this.setSourceProperty(()=>{this.url=h,this._options.url=h}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(h,x){let S=h.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),I={request:this.map._requestManager.transformRequest(S,E.Tile),uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function D($,H){return delete h.request,h.aborted?x(null):$&&$.status!==404?x($):(H&&H.resourceTiming&&(h.resourceTiming=H.resourceTiming),this.map._refreshExpiredTiles&&H&&h.setExpiryData(H),h.loadVectorData(H,this.map.painter),x(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}I.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired"?h.state==="loading"?h.reloadCallback=x:h.request=h.actor.send("reloadTile",I,D.bind(this)):(h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",I,D.bind(this)))}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id},void 0)}unloadTile(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class He extends n.Evented{constructor(h,x,S,I){super(),this.id=h,this.dispatcher=S,this.setEventedParent(I),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.extend({type:"raster"},x),n.extend(this,n.pick(x,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ie(this._options,this.map._requestManager,(h,x)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new n.ErrorEvent(h)):x&&(n.extend(this,x),x.bounds&&(this.tileBounds=new fe(x.bounds,this.minzoom,this.maxzoom)),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(h){this.map=h,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return n.extend({},this._options)}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,x){let S=h.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);h.request=v.getImage(this.map._requestManager.transformRequest(S,E.Tile),(I,D,$)=>{if(delete h.request,h.aborted)h.state="unloaded",x(null);else if(I)h.state="errored",x(I);else if(D){this.map._refreshExpiredTiles&&$&&h.setExpiryData($);let H=this.map.painter.context,Y=H.gl;h.texture=this.map.painter.getTileTexture(D.width),h.texture?h.texture.update(D,{useMipmap:!0}):(h.texture=new U(H,D,Y.RGBA,{useMipmap:!0}),h.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST),H.extTextureFilterAnisotropic&&Y.texParameterf(Y.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax)),h.state="loaded",x(null)}},this.map._refreshExpiredTiles)}abortTile(h,x){h.request&&(h.request.cancel(),delete h.request),x()}unloadTile(h,x){h.texture&&this.map.painter.saveTileTexture(h.texture),x()}hasTransition(){return!1}}class Je extends He{constructor(h,x,S,I){super(h,x,S,I),this.type="raster-dem",this.maxzoom=22,this._options=n.extend({type:"raster-dem"},x),this.encoding=x.encoding||"mapbox"}loadTile(h,x){let S=h.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function I(D,$){D&&(h.state="errored",x(D)),$&&(h.dem=$,h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0,h.state="loaded",x(null))}h.request=v.getImage(this.map._requestManager.transformRequest(S,E.Tile),function(D,$){if(delete h.request,h.aborted)h.state="unloaded",x(null);else if(D)h.state="errored",x(D);else if($){this.map._refreshExpiredTiles&&h.setExpiryData($),delete $.cacheControl,delete $.expires;let H=n.isImageBitmap($)&&(ne==null&&(ne=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ne)?$:n.browser.getImageData($,1),Y={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:H,encoding:this.encoding};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",Y,I.bind(this)))}}.bind(this),this.map._refreshExpiredTiles),h.neighboringTiles=this._getNeighboringTiles(h.tileID)}_getNeighboringTiles(h){let x=h.canonical,S=Math.pow(2,x.z),I=(x.x-1+S)%S,D=x.x===0?h.wrap-1:h.wrap,$=(x.x+1+S)%S,H=x.x+1===S?h.wrap+1:h.wrap,Y={};return Y[new n.OverscaledTileID(h.overscaledZ,D,x.z,I,x.y).key]={backfilled:!1},Y[new n.OverscaledTileID(h.overscaledZ,H,x.z,$,x.y).key]={backfilled:!1},x.y>0&&(Y[new n.OverscaledTileID(h.overscaledZ,D,x.z,I,x.y-1).key]={backfilled:!1},Y[new n.OverscaledTileID(h.overscaledZ,h.wrap,x.z,x.x,x.y-1).key]={backfilled:!1},Y[new n.OverscaledTileID(h.overscaledZ,H,x.z,$,x.y-1).key]={backfilled:!1}),x.y+1<S&&(Y[new n.OverscaledTileID(h.overscaledZ,D,x.z,I,x.y+1).key]={backfilled:!1},Y[new n.OverscaledTileID(h.overscaledZ,h.wrap,x.z,x.x,x.y+1).key]={backfilled:!1},Y[new n.OverscaledTileID(h.overscaledZ,H,x.z,$,x.y+1).key]={backfilled:!1}),Y}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded",h.actor&&h.actor.send("removeDEMTile",{uid:h.uid,source:this.id})}}class ot extends n.Evented{constructor(h,x,S,I){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>n.extend({},this._options,{type:this.type,data:this._data}),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=S.getActor(),this.setEventedParent(I),this._data=x.data,this._options=n.extend({},x),this._collectResourceTiming=x.collectResourceTiming,x.maxzoom!==void 0&&(this.maxzoom=x.maxzoom),x.type&&(this.type=x.type),x.attribution&&(this.attribution=x.attribution),this.promoteId=x.promoteId;let D=n.EXTENT/this.tileSize;this.workerOptions=n.extend({source:this.id,cluster:x.cluster||!1,geojsonVtOptions:{buffer:(x.buffer!==void 0?x.buffer:128)*D,tolerance:(x.tolerance!==void 0?x.tolerance:.375)*D,extent:n.EXTENT,maxZoom:this.maxzoom,lineMetrics:x.lineMetrics||!1,generateId:x.generateId||!1},superclusterOptions:{maxZoom:x.clusterMaxZoom!==void 0?x.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,x.clusterMinPoints||2),extent:n.EXTENT,radius:(x.clusterRadius||50)*D,log:!1,generateId:x.generateId||!1},clusterProperties:x.clusterProperties,filter:x.filter},x.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(h){this.map=h,this.load()}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){return this._updateWorkerData(h),this}setClusterOptions(h){return this.workerOptions.cluster=h.cluster,h&&(h.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=h.clusterRadius),h.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=h.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(h,x){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},x),this}getClusterChildren(h,x){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},x),this}getClusterLeaves(h,x,S,I){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:x,offset:S},I),this}_updateWorkerData(h){let x=n.extend({},this.workerOptions);h?x.dataDiff=h:typeof this._data=="string"?(x.request=this.map._requestManager.transformRequest(n.browser.resolveURL(this._data),E.Source),x.request.collectResourceTiming=this._collectResourceTiming):x.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new n.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,x,(S,I)=>{if(this._pendingLoads--,this._removed||I&&I.abandoned)return void this.fire(new n.Event("dataabort",{dataType:"source"}));let D=null;if(I&&I.resourceTiming&&I.resourceTiming[this.id]&&(D=I.resourceTiming[this.id].slice(0)),S)return void this.fire(new n.ErrorEvent(S));let $={dataType:"source"};this._collectResourceTiming&&D&&D.length>0&&n.extend($,{resourceTiming:D}),this.fire(new n.Event("data",Tn(di({},$),{sourceDataType:"metadata"}))),this.fire(new n.Event("data",Tn(di({},$),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(h,x){let S=h.actor?"reloadTile":"loadTile";h.actor=this.actor;let I={type:this.type,uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};h.request=this.actor.send(S,I,(D,$)=>(delete h.request,h.unloadVectorData(),h.aborted?x(null):D?x(D):(h.loadVectorData($,this.map.painter,S==="reloadTile"),x(null))))}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var yt=n.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class bt extends n.Evented{constructor(h,x,S,I){super(),this.load=(D,$)=>{this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=v.getImage(this.map._requestManager.transformRequest(this.url,E.Image),(H,Y)=>{this._request=null,this._loaded=!0,H?this.fire(new n.ErrorEvent(H)):Y&&(this.image=Y,D&&(this.coordinates=D),$&&$(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;let D=this.map.painter.context,$=D.gl;this.boundsBuffer||(this.boundsBuffer=D.createVertexBuffer(this._boundsArray,yt.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new U(D,this.image,$.RGBA),this.texture.bind($.LINEAR,$.CLAMP_TO_EDGE));let H=!1;for(let Y in this.tiles){let J=this.tiles[Y];J.state!=="loaded"&&(J.state="loaded",J.texture=this.texture,H=!0)}H&&this.fire(new n.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=h,this.dispatcher=S,this.coordinates=x.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(I),this.options=x}loaded(){return this._loaded}updateImage(h){return h.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=h.url,this.load(h.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(h){this.map=h,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(h){this.coordinates=h;let x=h.map(n.MercatorCoordinate.fromLngLat);this.tileID=function(I){let D=1/0,$=1/0,H=-1/0,Y=-1/0;for(let _e of I)D=Math.min(D,_e.x),$=Math.min($,_e.y),H=Math.max(H,_e.x),Y=Math.max(Y,_e.y);let J=Math.max(H-D,Y-$),se=Math.max(0,Math.floor(-Math.log(J)/Math.LN2)),ce=Math.pow(2,se);return new n.CanonicalTileID(se,Math.floor((D+H)/2*ce),Math.floor(($+Y)/2*ce))}(x),this.minzoom=this.maxzoom=this.tileID.z;let S=x.map(I=>this.tileID.getTilePoint(I)._round());return this._boundsArray=new n.RasterBoundsArray,this._boundsArray.emplaceBack(S[0].x,S[0].y,0,0),this._boundsArray.emplaceBack(S[1].x,S[1].y,n.EXTENT,0),this._boundsArray.emplaceBack(S[3].x,S[3].y,0,n.EXTENT),this._boundsArray.emplaceBack(S[2].x,S[2].y,n.EXTENT,n.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(h,x){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},x(null)):(h.state="errored",x(null))}hasTransition(){return!1}}class at extends bt{constructor(h,x,S,I){super(h,x,S,I),this.load=()=>{this._loaded=!1;let D=this.options;this.urls=[];for(let $ of D.urls)this.urls.push(this.map._requestManager.transformRequest($,E.Source).url);n.getVideo(this.urls,($,H)=>{this._loaded=!0,$?this.fire(new n.ErrorEvent($)):H&&(this.video=H,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let D=this.map.painter.context,$=D.gl;this.boundsBuffer||(this.boundsBuffer=D.createVertexBuffer(this._boundsArray,yt.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind($.LINEAR,$.CLAMP_TO_EDGE),$.texSubImage2D($.TEXTURE_2D,0,0,0,$.RGBA,$.UNSIGNED_BYTE,this.video)):(this.texture=new U(D,this.video,$.RGBA),this.texture.bind($.LINEAR,$.CLAMP_TO_EDGE));let H=!1;for(let Y in this.tiles){let J=this.tiles[Y];J.state!=="loaded"&&(J.state="loaded",J.texture=this.texture,H=!0)}H&&this.fire(new n.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=x}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){let x=this.video.seekable;h<x.start(0)||h>x.end(0)?this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${x.start(0)} and ${x.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Te extends bt{constructor(h,x,S,I){super(h,x,S,I),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let D=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,D=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,D=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let $=this.map.painter.context,H=$.gl;this.boundsBuffer||(this.boundsBuffer=$.createVertexBuffer(this._boundsArray,yt.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(D||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new U($,this.canvas,H.RGBA,{premultiply:!0});let Y=!1;for(let J in this.tiles){let se=this.tiles[J];se.state!=="loaded"&&(se.state="loaded",se.texture=this.texture,Y=!0)}Y&&this.fire(new n.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),x.coordinates?Array.isArray(x.coordinates)&&x.coordinates.length===4&&!x.coordinates.some(D=>!Array.isArray(D)||D.length!==2||D.some($=>typeof $!="number"))||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),x.animate&&typeof x.animate!="boolean"&&this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),x.canvas?typeof x.canvas=="string"||x.canvas instanceof HTMLCanvasElement||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=x,this.animate=x.animate===void 0||x.animate}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}}let Ze={},xt=P=>{switch(P){case"geojson":return ot;case"image":return bt;case"raster":return He;case"raster-dem":return Je;case"vector":return Re;case"video":return at;case"canvas":return Te}return Ze[P]};function It(P,h){let x=n.create();return n.translate(x,x,[1,1,0]),n.scale(x,x,[.5*P.width,.5*P.height,1]),n.multiply(x,x,P.calculatePosMatrix(h.toUnwrapped()))}function Bt(P,h,x,S,I,D){let $=function(ce,_e,Ce){if(ce)for(let Ae of ce){let Pe=_e[Ae];if(Pe&&Pe.source===Ce&&Pe.type==="fill-extrusion")return!0}else for(let Ae in _e){let Pe=_e[Ae];if(Pe.source===Ce&&Pe.type==="fill-extrusion")return!0}return!1}(I&&I.layers,h,P.id),H=D.maxPitchScaleFactor(),Y=P.tilesIn(S,H,$);Y.sort(Mi);let J=[];for(let ce of Y)J.push({wrappedTileID:ce.tileID.wrapped().key,queryResults:ce.tile.queryRenderedFeatures(h,x,P._state,ce.queryGeometry,ce.cameraQueryGeometry,ce.scale,I,D,H,It(P.transform,ce.tileID))});let se=function(ce){let _e={},Ce={};for(let Ae of ce){let Pe=Ae.queryResults,Se=Ae.wrappedTileID,Ve=Ce[Se]=Ce[Se]||{};for(let tt in Pe){let Ne=Pe[tt],Xe=Ve[tt]=Ve[tt]||{},st=_e[tt]=_e[tt]||[];for(let nt of Ne)Xe[nt.featureIndex]||(Xe[nt.featureIndex]=!0,st.push(nt))}}return _e}(J);for(let ce in se)se[ce].forEach(_e=>{let Ce=_e.feature,Ae=P.getFeatureState(Ce.layer["source-layer"],Ce.id);Ce.source=Ce.layer.source,Ce.layer["source-layer"]&&(Ce.sourceLayer=Ce.layer["source-layer"]),Ce.state=Ae});return se}function Mi(P,h){let x=P.tileID,S=h.tileID;return x.overscaledZ-S.overscaledZ||x.canonical.y-S.canonical.y||x.wrap-S.wrap||x.canonical.x-S.canonical.x}class je{constructor(h,x){this.timeAdded=0,this.fadeEndTime=0,this.tileID=h,this.uid=n.uniqueId(),this.uses=0,this.tileSize=x,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(h){let x=h+this.timeAdded;x<this.fadeEndTime||(this.fadeEndTime=x)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(h){this.demTexture&&h.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(h,x,S){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",h){h.featureIndex&&(this.latestFeatureIndex=h.featureIndex,h.rawTileData?(this.latestRawTileData=h.rawTileData,this.latestFeatureIndex.rawTileData=h.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=h.collisionBoxArray,this.buckets=function(I,D){let $={};if(!D)return $;for(let H of I){let Y=H.layerIds.map(J=>D.getLayer(J)).filter(Boolean);if(Y.length!==0){H.layers=Y,H.stateDependentLayerIds&&(H.stateDependentLayers=H.stateDependentLayerIds.map(J=>Y.filter(se=>se.id===J)[0]));for(let J of Y)$[J.id]=H}}return $}(h.buckets,x.style),this.hasSymbolBuckets=!1;for(let I in this.buckets){let D=this.buckets[I];if(D instanceof n.SymbolBucket){if(this.hasSymbolBuckets=!0,!S)break;D.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let I in this.buckets){let D=this.buckets[I];if(D instanceof n.SymbolBucket&&D.hasRTLText){this.hasRTLText=!0,n.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(let I in this.buckets){let D=this.buckets[I];this.queryPadding=Math.max(this.queryPadding,x.style.getLayer(I).queryRadius(D))}h.imageAtlas&&(this.imageAtlas=h.imageAtlas),h.glyphAtlasImage&&(this.glyphAtlasImage=h.glyphAtlasImage)}else this.collisionBoxArray=new n.CollisionBoxArray}unloadVectorData(){for(let h in this.buckets)this.buckets[h].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(h){return this.buckets[h.id]}upload(h){for(let S in this.buckets){let I=this.buckets[S];I.uploadPending()&&I.upload(h)}let x=h.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new U(h,this.imageAtlas.image,x.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new U(h,this.glyphAtlasImage,x.ALPHA),this.glyphAtlasImage=null)}prepare(h){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(h,this.imageAtlasTexture)}queryRenderedFeatures(h,x,S,I,D,$,H,Y,J,se){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:I,cameraQueryGeometry:D,scale:$,tileSize:this.tileSize,pixelPosMatrix:se,transform:Y,params:H,queryPadding:this.queryPadding*J},h,x,S):{}}querySourceFeatures(h,x){let S=this.latestFeatureIndex;if(!S||!S.rawTileData)return;let I=S.loadVTLayers(),D=x&&x.sourceLayer?x.sourceLayer:"",$=I._geojsonTileLayer||I[D];if(!$)return;let H=n.createFilter(x&&x.filter),{z:Y,x:J,y:se}=this.tileID.canonical,ce={z:Y,x:J,y:se};for(let _e=0;_e<$.length;_e++){let Ce=$.feature(_e);if(H.needGeometry){let Se=n.toEvaluationFeature(Ce,!0);if(!H.filter(new n.EvaluationParameters(this.tileID.overscaledZ),Se,this.tileID.canonical))continue}else if(!H.filter(new n.EvaluationParameters(this.tileID.overscaledZ),Ce))continue;let Ae=S.getId(Ce,D),Pe=new n.GeoJSONFeature(Ce,Y,J,se,Ae);Pe.tile=ce,h.push(Pe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(h){let x=this.expirationTime;if(h.cacheControl){let S=n.parseCacheControl(h.cacheControl);S["max-age"]&&(this.expirationTime=Date.now()+1e3*S["max-age"])}else h.expires&&(this.expirationTime=new Date(h.expires).getTime());if(this.expirationTime){let S=Date.now(),I=!1;if(this.expirationTime>S)I=!1;else if(x)if(this.expirationTime<x)I=!0;else{let D=this.expirationTime-x;D?this.expirationTime=S+Math.max(D,3e4):I=!0}else I=!0;I?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(h,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(h).length===0)return;let S=this.latestFeatureIndex.loadVTLayers();for(let I in this.buckets){if(!x.style.hasLayer(I))continue;let D=this.buckets[I],$=D.layers[0].sourceLayer||"_geojsonTileLayer",H=S[$],Y=h[$];if(!H||!Y||Object.keys(Y).length===0)continue;D.update(Y,H,this.imageAtlas&&this.imageAtlas.patternPositions||{});let J=x&&x.style&&x.style.getLayer(I);J&&(this.queryPadding=Math.max(this.queryPadding,J.queryRadius(D)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.browser.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(h){this.symbolFadeHoldUntil=n.browser.now()+h}setDependencies(h,x){let S={};for(let I of x)S[I]=!0;this.dependencies[h]=S}hasDependency(h,x){for(let S of h){let I=this.dependencies[S];if(I){for(let D of x)if(I[D])return!0}}return!1}}class be{constructor(h,x){this.max=h,this.onRemove=x,this.reset()}reset(){for(let h in this.data)for(let x of this.data[h])x.timeout&&clearTimeout(x.timeout),this.onRemove(x.value);return this.data={},this.order=[],this}add(h,x,S){let I=h.wrapped().key;this.data[I]===void 0&&(this.data[I]=[]);let D={value:x,timeout:void 0};if(S!==void 0&&(D.timeout=setTimeout(()=>{this.remove(h,D)},S)),this.data[I].push(D),this.order.push(I),this.order.length>this.max){let $=this._getAndRemoveByKey(this.order[0]);$&&this.onRemove($)}return this}has(h){return h.wrapped().key in this.data}getAndRemove(h){return this.has(h)?this._getAndRemoveByKey(h.wrapped().key):null}_getAndRemoveByKey(h){let x=this.data[h].shift();return x.timeout&&clearTimeout(x.timeout),this.data[h].length===0&&delete this.data[h],this.order.splice(this.order.indexOf(h),1),x.value}getByKey(h){let x=this.data[h];return x?x[0].value:null}get(h){return this.has(h)?this.data[h.wrapped().key][0].value:null}remove(h,x){if(!this.has(h))return this;let S=h.wrapped().key,I=x===void 0?0:this.data[S].indexOf(x),D=this.data[S][I];return this.data[S].splice(I,1),D.timeout&&clearTimeout(D.timeout),this.data[S].length===0&&delete this.data[S],this.onRemove(D.value),this.order.splice(this.order.indexOf(S),1),this}setMaxSize(h){for(this.max=h;this.order.length>this.max;){let x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}filter(h){let x=[];for(let S in this.data)for(let I of this.data[S])h(I.value)||x.push(I);for(let S of x)this.remove(S.value.tileID,S)}}class ge{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(h,x,S){let I=String(x);if(this.stateChanges[h]=this.stateChanges[h]||{},this.stateChanges[h][I]=this.stateChanges[h][I]||{},n.extend(this.stateChanges[h][I],S),this.deletedStates[h]===null){this.deletedStates[h]={};for(let D in this.state[h])D!==I&&(this.deletedStates[h][D]=null)}else if(this.deletedStates[h]&&this.deletedStates[h][I]===null){this.deletedStates[h][I]={};for(let D in this.state[h][I])S[D]||(this.deletedStates[h][I][D]=null)}else for(let D in S)this.deletedStates[h]&&this.deletedStates[h][I]&&this.deletedStates[h][I][D]===null&&delete this.deletedStates[h][I][D]}removeFeatureState(h,x,S){if(this.deletedStates[h]===null)return;let I=String(x);if(this.deletedStates[h]=this.deletedStates[h]||{},S&&x!==void 0)this.deletedStates[h][I]!==null&&(this.deletedStates[h][I]=this.deletedStates[h][I]||{},this.deletedStates[h][I][S]=null);else if(x!==void 0)if(this.stateChanges[h]&&this.stateChanges[h][I])for(S in this.deletedStates[h][I]={},this.stateChanges[h][I])this.deletedStates[h][I][S]=null;else this.deletedStates[h][I]=null;else this.deletedStates[h]=null}getState(h,x){let S=String(x),I=n.extend({},(this.state[h]||{})[S],(this.stateChanges[h]||{})[S]);if(this.deletedStates[h]===null)return{};if(this.deletedStates[h]){let D=this.deletedStates[h][x];if(D===null)return{};for(let $ in D)delete I[$]}return I}initializeTileState(h,x){h.setFeatureState(this.state,x)}coalesceChanges(h,x){let S={};for(let I in this.stateChanges){this.state[I]=this.state[I]||{};let D={};for(let $ in this.stateChanges[I])this.state[I][$]||(this.state[I][$]={}),n.extend(this.state[I][$],this.stateChanges[I][$]),D[$]=this.state[I][$];S[I]=D}for(let I in this.deletedStates){this.state[I]=this.state[I]||{};let D={};if(this.deletedStates[I]===null)for(let $ in this.state[I])D[$]={},this.state[I][$]={};else for(let $ in this.deletedStates[I]){if(this.deletedStates[I][$]===null)this.state[I][$]={};else for(let H of Object.keys(this.deletedStates[I][$]))delete this.state[I][$][H];D[$]=this.state[I][$]}S[I]=S[I]||{},n.extend(S[I],D)}if(this.stateChanges={},this.deletedStates={},Object.keys(S).length!==0)for(let I in h)h[I].setFeatureState(S,x)}}class xe extends n.Evented{constructor(h,x,S){super(),this.id=h,this.dispatcher=S,this.on("data",I=>{I.dataType==="source"&&I.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&I.dataType==="source"&&I.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((I,D,$,H)=>{let Y=new(xt(D.type))(I,D,$,H);if(Y.id!==I)throw new Error(`Expected Source id to be ${I} instead of ${Y.id}`);return Y})(h,x,S,this),this._tiles={},this._cache=new be(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ge,this._didEmitContent=!1,this._updated=!1}onAdd(h){this.map=h,this._maxTileCacheSize=h?h._maxTileCacheSize:null,this._maxTileCacheZoomLevels=h?h._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(h)}onRemove(h){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(h)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let h in this._tiles){let x=this._tiles[h];if(x.state!=="loaded"&&x.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let h=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,h&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(h,x){return this._source.loadTile(h,x)}_unloadTile(h){if(this._source.unloadTile)return this._source.unloadTile(h,()=>{})}_abortTile(h){this._source.abortTile&&this._source.abortTile(h,()=>{}),this._source.fire(new n.Event("dataabort",{tile:h,coord:h.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(h){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let x in this._tiles){let S=this._tiles[x];S.upload(h),S.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(h=>h.tileID).sort(Me).map(h=>h.key)}getRenderableIds(h){let x=[];for(let S in this._tiles)this._isIdRenderable(S,h)&&x.push(this._tiles[S]);return h?x.sort((S,I)=>{let D=S.tileID,$=I.tileID,H=new n.Point(D.canonical.x,D.canonical.y)._rotate(this.transform.angle),Y=new n.Point($.canonical.x,$.canonical.y)._rotate(this.transform.angle);return D.overscaledZ-$.overscaledZ||Y.y-H.y||Y.x-H.x}).map(S=>S.tileID.key):x.map(S=>S.tileID).sort(Me).map(S=>S.key)}hasRenderableParent(h){let x=this.findLoadedParent(h,0);return!!x&&this._isIdRenderable(x.tileID.key)}_isIdRenderable(h,x){return this._tiles[h]&&this._tiles[h].hasData()&&!this._coveredTiles[h]&&(x||!this._tiles[h].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let h in this._tiles)this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")}}_reloadTile(h,x){let S=this._tiles[h];S&&(S.state!=="loading"&&(S.state=x),this._loadTile(S,this._tileLoaded.bind(this,S,h,x)))}_tileLoaded(h,x,S,I){if(I)return h.state="errored",void(I.status!==404?this._source.fire(new n.ErrorEvent(I,{tile:h})):this.update(this.transform,this.terrain));h.timeAdded=n.browser.now(),S==="expired"&&(h.refreshedUponExpiration=!0),this._setTileReloadTimer(x,h),this.getSource().type==="raster-dem"&&h.dem&&this._backfillDEM(h),this._state.initializeTileState(h,this.map?this.map.painter:null),h.aborted||this._source.fire(new n.Event("data",{dataType:"source",tile:h,coord:h.tileID}))}_backfillDEM(h){let x=this.getRenderableIds();for(let I=0;I<x.length;I++){let D=x[I];if(h.neighboringTiles&&h.neighboringTiles[D]){let $=this.getTileByID(D);S(h,$),S($,h)}}function S(I,D){I.needsHillshadePrepare=!0,I.needsTerrainPrepare=!0;let $=D.tileID.canonical.x-I.tileID.canonical.x,H=D.tileID.canonical.y-I.tileID.canonical.y,Y=Math.pow(2,I.tileID.canonical.z),J=D.tileID.key;$===0&&H===0||Math.abs(H)>1||(Math.abs($)>1&&(Math.abs($+Y)===1?$+=Y:Math.abs($-Y)===1&&($-=Y)),D.dem&&I.dem&&(I.dem.backfillBorder(D.dem,$,H),I.neighboringTiles&&I.neighboringTiles[J]&&(I.neighboringTiles[J].backfilled=!0)))}}getTile(h){return this.getTileByID(h.key)}getTileByID(h){return this._tiles[h]}_retainLoadedChildren(h,x,S,I){for(let D in this._tiles){let $=this._tiles[D];if(I[D]||!$.hasData()||$.tileID.overscaledZ<=x||$.tileID.overscaledZ>S)continue;let H=$.tileID;for(;$&&$.tileID.overscaledZ>x+1;){let J=$.tileID.scaledTo($.tileID.overscaledZ-1);$=this._tiles[J.key],$&&$.hasData()&&(H=J)}let Y=H;for(;Y.overscaledZ>x;)if(Y=Y.scaledTo(Y.overscaledZ-1),h[Y.key]){I[H.key]=H;break}}}findLoadedParent(h,x){if(h.key in this._loadedParentTiles){let S=this._loadedParentTiles[h.key];return S&&S.tileID.overscaledZ>=x?S:null}for(let S=h.overscaledZ-1;S>=x;S--){let I=h.scaledTo(S),D=this._getLoadedTile(I);if(D)return D}}_getLoadedTile(h){let x=this._tiles[h.key];return x&&x.hasData()?x:this._cache.getByKey(h.wrapped().key)}updateCacheSize(h){let x=Math.ceil(h.width/this._source.tileSize)+1,S=Math.ceil(h.height/this._source.tileSize)+1,I=Math.floor(x*S*(this._maxTileCacheZoomLevels===null?n.config.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),D=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,I):I;this._cache.setMaxSize(D)}handleWrapJump(h){let x=Math.round((h-(this._prevLng===void 0?h:this._prevLng))/360);if(this._prevLng=h,x){let S={};for(let I in this._tiles){let D=this._tiles[I];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+x),S[D.tileID.key]=D}this._tiles=S;for(let I in this._timers)clearTimeout(this._timers[I]),delete this._timers[I];for(let I in this._tiles)this._setTileReloadTimer(I,this._tiles[I])}}update(h,x){if(this.transform=h,this.terrain=x,!this._sourceLoaded||this._paused)return;let S;this.updateCacheSize(h),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?S=h.getVisibleUnwrappedCoordinates(this._source.tileID).map(se=>new n.OverscaledTileID(se.canonical.z,se.wrap,se.canonical.z,se.canonical.x,se.canonical.y)):(S=h.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:x}),this._source.hasTile&&(S=S.filter(se=>this._source.hasTile(se)))):S=[];let I=h.coveringZoomLevel(this._source),D=Math.max(I-xe.maxOverzooming,this._source.minzoom),$=Math.max(I+xe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let se={};for(let ce of S)if(ce.canonical.z>this._source.minzoom){let _e=ce.scaledTo(ce.canonical.z-1);se[_e.key]=_e;let Ce=ce.scaledTo(Math.max(this._source.minzoom,Math.min(ce.canonical.z,5)));se[Ce.key]=Ce}S=S.concat(Object.values(se))}let H=S.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,H&&this.fire(new n.Event("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let Y=this._updateRetainedTiles(S,I);if(Oe(this._source.type)){let se={},ce={},_e=Object.keys(Y),Ce=n.browser.now();for(let Ae of _e){let Pe=Y[Ae],Se=this._tiles[Ae];if(!Se||Se.fadeEndTime!==0&&Se.fadeEndTime<=Ce)continue;let Ve=this.findLoadedParent(Pe,D);Ve&&(this._addTile(Ve.tileID),se[Ve.tileID.key]=Ve.tileID),ce[Ae]=Pe}this._retainLoadedChildren(ce,I,$,Y);for(let Ae in se)Y[Ae]||(this._coveredTiles[Ae]=!0,Y[Ae]=se[Ae]);if(x){let Ae={},Pe={};for(let Se of S)this._tiles[Se.key].hasData()?Ae[Se.key]=Se:Pe[Se.key]=Se;for(let Se in Pe){let Ve=Pe[Se].children(this._source.maxzoom);this._tiles[Ve[0].key]&&this._tiles[Ve[1].key]&&this._tiles[Ve[2].key]&&this._tiles[Ve[3].key]&&(Ae[Ve[0].key]=Y[Ve[0].key]=Ve[0],Ae[Ve[1].key]=Y[Ve[1].key]=Ve[1],Ae[Ve[2].key]=Y[Ve[2].key]=Ve[2],Ae[Ve[3].key]=Y[Ve[3].key]=Ve[3],delete Pe[Se])}for(let Se in Pe){let Ve=this.findLoadedParent(Pe[Se],this._source.minzoom);if(Ve){Ae[Ve.tileID.key]=Y[Ve.tileID.key]=Ve.tileID;for(let tt in Ae)Ae[tt].isChildOf(Ve.tileID)&&delete Ae[tt]}}for(let Se in this._tiles)Ae[Se]||(this._coveredTiles[Se]=!0)}}for(let se in Y)this._tiles[se].clearFadeHold();let J=n.keysDifference(this._tiles,Y);for(let se of J){let ce=this._tiles[se];ce.hasSymbolBuckets&&!ce.holdingForFade()?ce.setHoldDuration(this.map._fadeDuration):ce.hasSymbolBuckets&&!ce.symbolFadeFinished()||this._removeTile(se)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(let h in this._tiles)this._tiles[h].holdingForFade()&&this._removeTile(h)}_updateRetainedTiles(h,x){let S={},I={},D=Math.max(x-xe.maxOverzooming,this._source.minzoom),$=Math.max(x+xe.maxUnderzooming,this._source.minzoom),H={};for(let Y of h){let J=this._addTile(Y);S[Y.key]=Y,J.hasData()||x<this._source.maxzoom&&(H[Y.key]=Y)}this._retainLoadedChildren(H,x,$,S);for(let Y of h){let J=this._tiles[Y.key];if(J.hasData())continue;if(x+1>this._source.maxzoom){let ce=Y.children(this._source.maxzoom)[0],_e=this.getTile(ce);if(_e&&_e.hasData()){S[ce.key]=ce;continue}}else{let ce=Y.children(this._source.maxzoom);if(S[ce[0].key]&&S[ce[1].key]&&S[ce[2].key]&&S[ce[3].key])continue}let se=J.wasRequested();for(let ce=Y.overscaledZ-1;ce>=D;--ce){let _e=Y.scaledTo(ce);if(I[_e.key])break;if(I[_e.key]=!0,J=this.getTile(_e),!J&&se&&(J=this._addTile(_e)),J){let Ce=J.hasData();if((se||Ce)&&(S[_e.key]=_e),se=J.wasRequested(),Ce)break}}}return S}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let h in this._tiles){let x=[],S,I=this._tiles[h].tileID;for(;I.overscaledZ>0;){if(I.key in this._loadedParentTiles){S=this._loadedParentTiles[I.key];break}x.push(I.key);let D=I.scaledTo(I.overscaledZ-1);if(S=this._getLoadedTile(D),S)break;I=D}for(let D of x)this._loadedParentTiles[D]=S}}_addTile(h){let x=this._tiles[h.key];if(x)return x;x=this._cache.getAndRemove(h),x&&(this._setTileReloadTimer(h.key,x),x.tileID=h,this._state.initializeTileState(x,this.map?this.map.painter:null),this._cacheTimers[h.key]&&(clearTimeout(this._cacheTimers[h.key]),delete this._cacheTimers[h.key],this._setTileReloadTimer(h.key,x)));let S=x;return x||(x=new je(h,this._source.tileSize*h.overscaleFactor()),this._loadTile(x,this._tileLoaded.bind(this,x,h.key,x.state))),x.uses++,this._tiles[h.key]=x,S||this._source.fire(new n.Event("dataloading",{tile:x,coord:x.tileID,dataType:"source"})),x}_setTileReloadTimer(h,x){h in this._timers&&(clearTimeout(this._timers[h]),delete this._timers[h]);let S=x.getExpiryTimeout();S&&(this._timers[h]=setTimeout(()=>{this._reloadTile(h,"expired"),delete this._timers[h]},S))}_removeTile(h){let x=this._tiles[h];x&&(x.uses--,delete this._tiles[h],this._timers[h]&&(clearTimeout(this._timers[h]),delete this._timers[h]),x.uses>0||(x.hasData()&&x.state!=="reloading"?this._cache.add(x.tileID,x,x.getExpiryTimeout()):(x.aborted=!0,this._abortTile(x),this._unloadTile(x))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let h in this._tiles)this._removeTile(h);this._cache.reset()}tilesIn(h,x,S){let I=[],D=this.transform;if(!D)return I;let $=S?D.getCameraQueryGeometry(h):h,H=h.map(Ae=>D.pointCoordinate(Ae,this.terrain)),Y=$.map(Ae=>D.pointCoordinate(Ae,this.terrain)),J=this.getIds(),se=1/0,ce=1/0,_e=-1/0,Ce=-1/0;for(let Ae of Y)se=Math.min(se,Ae.x),ce=Math.min(ce,Ae.y),_e=Math.max(_e,Ae.x),Ce=Math.max(Ce,Ae.y);for(let Ae=0;Ae<J.length;Ae++){let Pe=this._tiles[J[Ae]];if(Pe.holdingForFade())continue;let Se=Pe.tileID,Ve=Math.pow(2,D.zoom-Pe.tileID.overscaledZ),tt=x*Pe.queryPadding*n.EXTENT/Pe.tileSize/Ve,Ne=[Se.getTilePoint(new n.MercatorCoordinate(se,ce)),Se.getTilePoint(new n.MercatorCoordinate(_e,Ce))];if(Ne[0].x-tt<n.EXTENT&&Ne[0].y-tt<n.EXTENT&&Ne[1].x+tt>=0&&Ne[1].y+tt>=0){let Xe=H.map(nt=>Se.getTilePoint(nt)),st=Y.map(nt=>Se.getTilePoint(nt));I.push({tile:Pe,tileID:Se,queryGeometry:Xe,cameraQueryGeometry:st,scale:Ve})}}return I}getVisibleCoordinates(h){let x=this.getRenderableIds(h).map(S=>this._tiles[S].tileID);for(let S of x)S.posMatrix=this.transform.calculatePosMatrix(S.toUnwrapped());return x}hasTransition(){if(this._source.hasTransition())return!0;if(Oe(this._source.type)){let h=n.browser.now();for(let x in this._tiles)if(this._tiles[x].fadeEndTime>=h)return!0}return!1}setFeatureState(h,x,S){this._state.updateState(h=h||"_geojsonTileLayer",x,S)}removeFeatureState(h,x,S){this._state.removeFeatureState(h=h||"_geojsonTileLayer",x,S)}getFeatureState(h,x){return this._state.getState(h=h||"_geojsonTileLayer",x)}setDependencies(h,x,S){let I=this._tiles[h];I&&I.setDependencies(x,S)}reloadTilesForDependencies(h,x){for(let S in this._tiles)this._tiles[S].hasDependency(h,x)&&this._reloadTile(S,"reloading");this._cache.filter(S=>!S.hasDependency(h,x))}}function Me(P,h){let x=Math.abs(2*P.wrap)-+(P.wrap<0),S=Math.abs(2*h.wrap)-+(h.wrap<0);return P.overscaledZ-h.overscaledZ||S-x||h.canonical.y-P.canonical.y||h.canonical.x-P.canonical.x}function Oe(P){return P==="raster"||P==="image"||P==="video"}xe.maxOverzooming=10,xe.maxUnderzooming=3;let De="mapboxgl_preloaded_worker_pool";class rt{constructor(){this.active={}}acquire(h){if(!this.workers)for(this.workers=[];this.workers.length<rt.workerCount;)this.workers.push(new Worker(n.config.WORKER_URL));return this.active[h]=!0,this.workers.slice()}release(h){delete this.active[h],this.numActive()===0&&(this.workers.forEach(x=>{x.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[De]}numActive(){return Object.keys(this.active).length}}let ct=Math.floor(n.browser.hardwareConcurrency/2),Vt;function ti(){return Vt||(Vt=new rt),Vt}rt.workerCount=n.isSafari(globalThis)?Math.max(Math.min(ct,3),1):1;class lt{constructor(h,x){this.reset(h,x)}reset(h,x){this.points=h||[],this._distances=[0];for(let S=1;S<this.points.length;S++)this._distances[S]=this._distances[S-1]+this.points[S].dist(this.points[S-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(x||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(h){if(this.points.length===1)return this.points[0];h=n.clamp(h,0,1);let x=1,S=this._distances[x],I=h*this.paddedLength+this.padding;for(;S<I&&x<this._distances.length;)S=this._distances[++x];let D=x-1,$=this._distances[D],H=S-$,Y=H>0?(I-$)/H:0;return this.points[D].mult(1-Y).add(this.points[x].mult(Y))}}function Nt(P,h){let x=!0;return P==="always"||P!=="never"&&h!=="never"||(x=!1),x}class Lt{constructor(h,x,S){let I=this.boxCells=[],D=this.circleCells=[];this.xCellCount=Math.ceil(h/S),this.yCellCount=Math.ceil(x/S);for(let $=0;$<this.xCellCount*this.yCellCount;$++)I.push([]),D.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=h,this.height=x,this.xScale=this.xCellCount/h,this.yScale=this.yCellCount/x,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(h,x,S,I,D){this._forEachCell(x,S,I,D,this._insertBoxCell,this.boxUid++),this.boxKeys.push(h),this.bboxes.push(x),this.bboxes.push(S),this.bboxes.push(I),this.bboxes.push(D)}insertCircle(h,x,S,I){this._forEachCell(x-I,S-I,x+I,S+I,this._insertCircleCell,this.circleUid++),this.circleKeys.push(h),this.circles.push(x),this.circles.push(S),this.circles.push(I)}_insertBoxCell(h,x,S,I,D,$){this.boxCells[D].push($)}_insertCircleCell(h,x,S,I,D,$){this.circleCells[D].push($)}_query(h,x,S,I,D,$,H){if(S<0||h>this.width||I<0||x>this.height)return[];let Y=[];if(h<=0&&x<=0&&this.width<=S&&this.height<=I){if(D)return[{key:null,x1:h,y1:x,x2:S,y2:I}];for(let J=0;J<this.boxKeys.length;J++)Y.push({key:this.boxKeys[J],x1:this.bboxes[4*J],y1:this.bboxes[4*J+1],x2:this.bboxes[4*J+2],y2:this.bboxes[4*J+3]});for(let J=0;J<this.circleKeys.length;J++){let se=this.circles[3*J],ce=this.circles[3*J+1],_e=this.circles[3*J+2];Y.push({key:this.circleKeys[J],x1:se-_e,y1:ce-_e,x2:se+_e,y2:ce+_e})}}else this._forEachCell(h,x,S,I,this._queryCell,Y,{hitTest:D,overlapMode:$,seenUids:{box:{},circle:{}}},H);return Y}query(h,x,S,I){return this._query(h,x,S,I,!1,null)}hitTest(h,x,S,I,D,$){return this._query(h,x,S,I,!0,D,$).length>0}hitTestCircle(h,x,S,I,D){let $=h-S,H=h+S,Y=x-S,J=x+S;if(H<0||$>this.width||J<0||Y>this.height)return!1;let se=[];return this._forEachCell($,Y,H,J,this._queryCellCircle,se,{hitTest:!0,overlapMode:I,circle:{x:h,y:x,radius:S},seenUids:{box:{},circle:{}}},D),se.length>0}_queryCell(h,x,S,I,D,$,H,Y){let{seenUids:J,hitTest:se,overlapMode:ce}=H,_e=this.boxCells[D];if(_e!==null){let Ae=this.bboxes;for(let Pe of _e)if(!J.box[Pe]){J.box[Pe]=!0;let Se=4*Pe,Ve=this.boxKeys[Pe];if(h<=Ae[Se+2]&&x<=Ae[Se+3]&&S>=Ae[Se+0]&&I>=Ae[Se+1]&&(!Y||Y(Ve))&&(!se||!Nt(ce,Ve.overlapMode))&&($.push({key:Ve,x1:Ae[Se],y1:Ae[Se+1],x2:Ae[Se+2],y2:Ae[Se+3]}),se))return!0}}let Ce=this.circleCells[D];if(Ce!==null){let Ae=this.circles;for(let Pe of Ce)if(!J.circle[Pe]){J.circle[Pe]=!0;let Se=3*Pe,Ve=this.circleKeys[Pe];if(this._circleAndRectCollide(Ae[Se],Ae[Se+1],Ae[Se+2],h,x,S,I)&&(!Y||Y(Ve))&&(!se||!Nt(ce,Ve.overlapMode))){let tt=Ae[Se],Ne=Ae[Se+1],Xe=Ae[Se+2];if($.push({key:Ve,x1:tt-Xe,y1:Ne-Xe,x2:tt+Xe,y2:Ne+Xe}),se)return!0}}}return!1}_queryCellCircle(h,x,S,I,D,$,H,Y){let{circle:J,seenUids:se,overlapMode:ce}=H,_e=this.boxCells[D];if(_e!==null){let Ae=this.bboxes;for(let Pe of _e)if(!se.box[Pe]){se.box[Pe]=!0;let Se=4*Pe,Ve=this.boxKeys[Pe];if(this._circleAndRectCollide(J.x,J.y,J.radius,Ae[Se+0],Ae[Se+1],Ae[Se+2],Ae[Se+3])&&(!Y||Y(Ve))&&!Nt(ce,Ve.overlapMode))return $.push(!0),!0}}let Ce=this.circleCells[D];if(Ce!==null){let Ae=this.circles;for(let Pe of Ce)if(!se.circle[Pe]){se.circle[Pe]=!0;let Se=3*Pe,Ve=this.circleKeys[Pe];if(this._circlesCollide(Ae[Se],Ae[Se+1],Ae[Se+2],J.x,J.y,J.radius)&&(!Y||Y(Ve))&&!Nt(ce,Ve.overlapMode))return $.push(!0),!0}}}_forEachCell(h,x,S,I,D,$,H,Y){let J=this._convertToXCellCoord(h),se=this._convertToYCellCoord(x),ce=this._convertToXCellCoord(S),_e=this._convertToYCellCoord(I);for(let Ce=J;Ce<=ce;Ce++)for(let Ae=se;Ae<=_e;Ae++)if(D.call(this,h,x,S,I,this.xCellCount*Ae+Ce,$,H,Y))return}_convertToXCellCoord(h){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(h*this.xScale)))}_convertToYCellCoord(h){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(h*this.yScale)))}_circlesCollide(h,x,S,I,D,$){let H=I-h,Y=D-x,J=S+$;return J*J>H*H+Y*Y}_circleAndRectCollide(h,x,S,I,D,$,H){let Y=($-I)/2,J=Math.abs(h-(I+Y));if(J>Y+S)return!1;let se=(H-D)/2,ce=Math.abs(x-(D+se));if(ce>se+S)return!1;if(J<=Y||ce<=se)return!0;let _e=J-Y,Ce=ce-se;return _e*_e+Ce*Ce<=S*S}}function qi(P,h,x,S,I){let D=n.create();return h?(n.scale(D,D,[1/I,1/I,1]),x||n.rotateZ(D,D,S.angle)):n.multiply(D,S.labelPlaneMatrix,P),D}function Vi(P,h,x,S,I){if(h){let D=n.clone(P);return n.scale(D,D,[I,I,1]),x||n.rotateZ(D,D,-S.angle),D}return S.glCoordMatrix}function Ke(P,h,x){let S;x?(S=[P.x,P.y,x(P.x,P.y),1],n.transformMat4(S,S,h)):(S=[P.x,P.y,0,1],Fe(S,S,h));let I=S[3];return{point:new n.Point(S[0]/I,S[1]/I),signedDistanceFromCamera:I}}function dt(P,h){return .5+P/h*.5}function kt(P,h){let x=P[0]/P[3],S=P[1]/P[3];return x>=-h[0]&&x<=h[0]&&S>=-h[1]&&S<=h[1]}function Zt(P,h,x,S,I,D,$,H,Y,J){let se=S?P.textSizeData:P.iconSizeData,ce=n.evaluateSizeForZoom(se,x.transform.zoom),_e=[256/x.width*2+1,256/x.height*2+1],Ce=S?P.text.dynamicLayoutVertexArray:P.icon.dynamicLayoutVertexArray;Ce.clear();let Ae=P.lineVertexArray,Pe=S?P.text.placedSymbolArray:P.icon.placedSymbolArray,Se=x.transform.width/x.transform.height,Ve=!1;for(let tt=0;tt<Pe.length;tt++){let Ne=Pe.get(tt);if(Ne.hidden||Ne.writingMode===n.WritingMode.vertical&&!Ve){Ee(Ne.numGlyphs,Ce);continue}let Xe;if(Ve=!1,J?(Xe=[Ne.anchorX,Ne.anchorY,J(Ne.anchorX,Ne.anchorY),1],n.transformMat4(Xe,Xe,h)):(Xe=[Ne.anchorX,Ne.anchorY,0,1],Fe(Xe,Xe,h)),!kt(Xe,_e)){Ee(Ne.numGlyphs,Ce);continue}let st=dt(x.transform.cameraToCenterDistance,Xe[3]),nt=n.evaluateSizeForFeature(se,ce,Ne),ft=$?nt/st:nt*st,At=new n.Point(Ne.anchorX,Ne.anchorY),vt=Ke(At,I,J).point,Mt={projections:{},offsets:{}},li=gr(Ne,ft,!1,H,h,I,D,P.glyphOffsetArray,Ae,Ce,vt,At,Mt,Se,Y,J);Ve=li.useVertical,(li.notEnoughRoom||Ve||li.needsFlipping&&gr(Ne,ft,!0,H,h,I,D,P.glyphOffsetArray,Ae,Ce,vt,At,Mt,Se,Y,J).notEnoughRoom)&&Ee(Ne.numGlyphs,Ce)}S?P.text.dynamicLayoutVertexBuffer.updateData(Ce):P.icon.dynamicLayoutVertexBuffer.updateData(Ce)}function Qt(P,h,x,S,I,D,$,H,Y,J,se,ce,_e){let Ce=H.glyphStartIndex+H.numGlyphs,Ae=H.lineStartIndex,Pe=H.lineStartIndex+H.lineLength,Se=h.getoffsetX(H.glyphStartIndex),Ve=h.getoffsetX(Ce-1),tt=he(P*Se,x,S,I,D,$,H.segment,Ae,Pe,Y,J,se,ce,_e);if(!tt)return null;let Ne=he(P*Ve,x,S,I,D,$,H.segment,Ae,Pe,Y,J,se,ce,_e);return Ne?{first:tt,last:Ne}:null}function Oi(P,h,x,S){return P===n.WritingMode.horizontal&&Math.abs(x.y-h.y)>Math.abs(x.x-h.x)*S?{useVertical:!0}:(P===n.WritingMode.vertical?h.y<x.y:h.x>x.x)?{needsFlipping:!0}:null}function gr(P,h,x,S,I,D,$,H,Y,J,se,ce,_e,Ce,Ae,Pe){let Se=h/24,Ve=P.lineOffsetX*Se,tt=P.lineOffsetY*Se,Ne;if(P.numGlyphs>1){let Xe=P.glyphStartIndex+P.numGlyphs,st=P.lineStartIndex,nt=P.lineStartIndex+P.lineLength,ft=Qt(Se,H,Ve,tt,x,se,ce,P,Y,D,_e,Ae,Pe);if(!ft)return{notEnoughRoom:!0};let At=Ke(ft.first.point,$,Pe).point,vt=Ke(ft.last.point,$,Pe).point;if(S&&!x){let Mt=Oi(P.writingMode,At,vt,Ce);if(Mt)return Mt}Ne=[ft.first];for(let Mt=P.glyphStartIndex+1;Mt<Xe-1;Mt++)Ne.push(he(Se*H.getoffsetX(Mt),Ve,tt,x,se,ce,P.segment,st,nt,Y,D,_e,Ae,Pe));Ne.push(ft.last)}else{if(S&&!x){let st=Ke(ce,I,Pe).point,nt=P.lineStartIndex+P.segment+1,ft=new n.Point(Y.getx(nt),Y.gety(nt)),At=Ke(ft,I,Pe),vt=At.signedDistanceFromCamera>0?At.point:Ji(ce,ft,st,1,I,Pe),Mt=Oi(P.writingMode,st,vt,Ce);if(Mt)return Mt}let Xe=he(Se*H.getoffsetX(P.glyphStartIndex),Ve,tt,x,se,ce,P.segment,P.lineStartIndex,P.lineStartIndex+P.lineLength,Y,D,_e,Ae,Pe);if(!Xe)return{notEnoughRoom:!0};Ne=[Xe]}for(let Xe of Ne)n.addDynamicAttributes(J,Xe.point,Xe.angle);return{}}function Ji(P,h,x,S,I,D){let $=Ke(P.add(P.sub(h)._unit()),I,D).point,H=x.sub($);return x.add(H._mult(S/H.mag()))}function ys(P,h){let{projectionCache:x,lineVertexArray:S,labelPlaneMatrix:I,tileAnchorPoint:D,distanceFromAnchor:$,getElevation:H,previousVertex:Y,direction:J,absOffsetX:se}=h;if(x.projections[P])return x.projections[P];let ce=new n.Point(S.getx(P),S.gety(P)),_e=Ke(ce,I,H);if(_e.signedDistanceFromCamera>0)return x.projections[P]=_e.point,_e.point;let Ce=P-J;return Ji($===0?D:new n.Point(S.getx(Ce),S.gety(Ce)),ce,Y,se-$+1,I,H)}function hs(P,h,x){return P._unit()._perp()._mult(h*x)}function ke(P,h,x,S,I,D,$,H){let{projectionCache:Y,direction:J}=H;if(Y.offsets[P])return Y.offsets[P];let se=x.add(h);if(P+J<S||P+J>=I)return Y.offsets[P]=se,se;let ce=ys(P+J,H),_e=hs(ce.sub(x),$,J),Ce=x.add(_e),Ae=ce.add(_e);return Y.offsets[P]=n.findLineIntersection(D,se,Ce,Ae)||se,Y.offsets[P]}function he(P,h,x,S,I,D,$,H,Y,J,se,ce,_e,Ce){let Ae=S?P-h:P+h,Pe=Ae>0?1:-1,Se=0;S&&(Pe*=-1,Se=Math.PI),Pe<0&&(Se+=Math.PI);let Ve,tt,Ne=Pe>0?H+$:H+$+1,Xe=I,st=I,nt=0,ft=0,At=Math.abs(Ae),vt=[],Mt;for(;nt+ft<=At;){if(Ne+=Pe,Ne<H||Ne>=Y)return null;nt+=ft,st=Xe,tt=Ve;let Ut={projectionCache:ce,lineVertexArray:J,labelPlaneMatrix:se,tileAnchorPoint:D,distanceFromAnchor:nt,getElevation:Ce,previousVertex:st,direction:Pe,absOffsetX:At};if(Xe=ys(Ne,Ut),x===0)vt.push(st),Mt=Xe.sub(st);else{let Ii,Jt=Xe.sub(st);Ii=Jt.mag()===0?hs(ys(Ne+Pe,Ut).sub(Xe),x,Pe):hs(Jt,x,Pe),tt||(tt=st.add(Ii)),Ve=ke(Ne,Ii,Xe,H,Y,tt,x,Ut),vt.push(tt),Mt=Ve.sub(tt)}ft=Mt.mag()}let li=Mt._mult((At-nt)/ft)._add(tt||st),dr=Se+Math.atan2(Xe.y-st.y,Xe.x-st.x);return vt.push(li),{point:li,angle:_e?dr:0,path:vt}}let me=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ee(P,h){for(let x=0;x<P;x++){let S=h.length;h.resize(S+4),h.float32.set(me,3*S)}}function Fe(P,h,x){let S=h[0],I=h[1];return P[0]=x[0]*S+x[4]*I+x[12],P[1]=x[1]*S+x[5]*I+x[13],P[3]=x[3]*S+x[7]*I+x[15],P}let Ue=100;class We{constructor(h,x=new Lt(h.width+200,h.height+200,25),S=new Lt(h.width+200,h.height+200,25)){this.transform=h,this.grid=x,this.ignoredGrid=S,this.pitchfactor=Math.cos(h._pitch)*h.cameraToCenterDistance,this.screenRightBoundary=h.width+Ue,this.screenBottomBoundary=h.height+Ue,this.gridRightBoundary=h.width+200,this.gridBottomBoundary=h.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(h,x,S,I,D,$){let H=this.projectAndGetPerspectiveRatio(I,h.anchorPointX,h.anchorPointY,$),Y=S*H.perspectiveRatio,J=h.x1*Y+H.point.x,se=h.y1*Y+H.point.y,ce=h.x2*Y+H.point.x,_e=h.y2*Y+H.point.y;return!this.isInsideGrid(J,se,ce,_e)||x!=="always"&&this.grid.hitTest(J,se,ce,_e,x,D)||H.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[J,se,ce,_e],offscreen:this.isOffscreen(J,se,ce,_e)}}placeCollisionCircles(h,x,S,I,D,$,H,Y,J,se,ce,_e,Ce,Ae){let Pe=[],Se=new n.Point(x.anchorX,x.anchorY),Ve=Ke(Se,$,Ae),tt=dt(this.transform.cameraToCenterDistance,Ve.signedDistanceFromCamera),Ne=(se?D/tt:D*tt)/n.ONE_EM,Xe=Ke(Se,H,Ae).point,st=Qt(Ne,I,x.lineOffsetX*Ne,x.lineOffsetY*Ne,!1,Xe,Se,x,S,H,{projections:{},offsets:{}},!1,Ae),nt=!1,ft=!1,At=!0;if(st){let vt=.5*_e*tt+Ce,Mt=new n.Point(-100,-100),li=new n.Point(this.screenRightBoundary,this.screenBottomBoundary),dr=new lt,Ut=st.first,Ii=st.last,Jt=[];for(let ir=Ut.path.length-1;ir>=1;ir--)Jt.push(Ut.path[ir]);for(let ir=1;ir<Ii.path.length;ir++)Jt.push(Ii.path[ir]);let Yr=2.5*vt;if(Y){let ir=Jt.map(Pi=>Ke(Pi,Y,Ae));Jt=ir.some(Pi=>Pi.signedDistanceFromCamera<=0)?[]:ir.map(Pi=>Pi.point)}let cr=[];if(Jt.length>0){let ir=Jt[0].clone(),Pi=Jt[0].clone();for(let As=1;As<Jt.length;As++)ir.x=Math.min(ir.x,Jt[As].x),ir.y=Math.min(ir.y,Jt[As].y),Pi.x=Math.max(Pi.x,Jt[As].x),Pi.y=Math.max(Pi.y,Jt[As].y);cr=ir.x>=Mt.x&&Pi.x<=li.x&&ir.y>=Mt.y&&Pi.y<=li.y?[Jt]:Pi.x<Mt.x||ir.x>li.x||Pi.y<Mt.y||ir.y>li.y?[]:n.clipLine([Jt],Mt.x,Mt.y,li.x,li.y)}for(let ir of cr){dr.reset(ir,.25*vt);let Pi=0;Pi=dr.length<=.5*vt?1:Math.ceil(dr.paddedLength/Yr)+1;for(let As=0;As<Pi;As++){let Lr=As/Math.max(Pi-1,1),Qn=dr.lerp(Lr),xn=Qn.x+Ue,Os=Qn.y+Ue;Pe.push(xn,Os,vt,0);let ho=xn-vt,Da=Os-vt,zl=xn+vt,Gl=Os+vt;if(At=At&&this.isOffscreen(ho,Da,zl,Gl),ft=ft||this.isInsideGrid(ho,Da,zl,Gl),h!=="always"&&this.grid.hitTestCircle(xn,Os,vt,h,ce)&&(nt=!0,!J))return{circles:[],offscreen:!1,collisionDetected:nt}}}}return{circles:!J&&nt||!ft||tt<this.perspectiveRatioCutoff?[]:Pe,offscreen:At,collisionDetected:nt}}queryRenderedSymbols(h){if(h.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let x=[],S=1/0,I=1/0,D=-1/0,$=-1/0;for(let se of h){let ce=new n.Point(se.x+Ue,se.y+Ue);S=Math.min(S,ce.x),I=Math.min(I,ce.y),D=Math.max(D,ce.x),$=Math.max($,ce.y),x.push(ce)}let H=this.grid.query(S,I,D,$).concat(this.ignoredGrid.query(S,I,D,$)),Y={},J={};for(let se of H){let ce=se.key;if(Y[ce.bucketInstanceId]===void 0&&(Y[ce.bucketInstanceId]={}),Y[ce.bucketInstanceId][ce.featureIndex])continue;let _e=[new n.Point(se.x1,se.y1),new n.Point(se.x2,se.y1),new n.Point(se.x2,se.y2),new n.Point(se.x1,se.y2)];n.polygonIntersectsPolygon(x,_e)&&(Y[ce.bucketInstanceId][ce.featureIndex]=!0,J[ce.bucketInstanceId]===void 0&&(J[ce.bucketInstanceId]=[]),J[ce.bucketInstanceId].push(ce.featureIndex))}return J}insertCollisionBox(h,x,S,I,D,$){(S?this.ignoredGrid:this.grid).insert({bucketInstanceId:I,featureIndex:D,collisionGroupID:$,overlapMode:x},h[0],h[1],h[2],h[3])}insertCollisionCircles(h,x,S,I,D,$){let H=S?this.ignoredGrid:this.grid,Y={bucketInstanceId:I,featureIndex:D,collisionGroupID:$,overlapMode:x};for(let J=0;J<h.length;J+=4)H.insertCircle(Y,h[J],h[J+1],h[J+2])}projectAndGetPerspectiveRatio(h,x,S,I){let D;return I?(D=[x,S,I(x,S),1],n.transformMat4(D,D,h)):(D=[x,S,0,1],Fe(D,D,h)),{point:new n.Point((D[0]/D[3]+1)/2*this.transform.width+Ue,(-D[1]/D[3]+1)/2*this.transform.height+Ue),perspectiveRatio:.5+this.transform.cameraToCenterDistance/D[3]*.5}}isOffscreen(h,x,S,I){return S<Ue||h>=this.screenRightBoundary||I<Ue||x>this.screenBottomBoundary}isInsideGrid(h,x,S,I){return S>=0&&h<this.gridRightBoundary&&I>=0&&x<this.gridBottomBoundary}getViewportMatrix(){let h=n.identity([]);return n.translate(h,h,[-100,-100,0]),h}}function Ge(P,h,x){return h*(n.EXTENT/(P.tileSize*Math.pow(2,x-P.tileID.overscaledZ)))}class ze{constructor(h,x,S,I){this.opacity=h?Math.max(0,Math.min(1,h.opacity+(h.placed?x:-x))):I&&S?1:0,this.placed=S}isHidden(){return this.opacity===0&&!this.placed}}class Qe{constructor(h,x,S,I,D){this.text=new ze(h?h.text:null,x,S,D),this.icon=new ze(h?h.icon:null,x,I,D)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _t{constructor(h,x,S){this.text=h,this.icon=x,this.skipFade=S}}class wt{constructor(){this.invProjMatrix=n.create(),this.viewportMatrix=n.create(),this.circles=[]}}class Et{constructor(h,x,S,I,D){this.bucketInstanceId=h,this.featureIndex=x,this.sourceLayerIndex=S,this.bucketIndex=I,this.tileID=D}}class wi{constructor(h){this.crossSourceCollisions=h,this.maxGroupID=0,this.collisionGroups={}}get(h){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[h]){let x=++this.maxGroupID;this.collisionGroups[h]={ID:x,predicate:S=>S.collisionGroupID===x}}return this.collisionGroups[h]}}function ji(P,h,x,S,I){let{horizontalAlign:D,verticalAlign:$}=n.getAnchorAlignment(P);return new n.Point(-(D-.5)*h+S[0]*I,-($-.5)*x+S[1]*I)}function ai(P,h,x,S,I,D){let{x1:$,x2:H,y1:Y,y2:J,anchorPointX:se,anchorPointY:ce}=P,_e=new n.Point(h,x);return S&&_e._rotate(I?D:-D),{x1:$+_e.x,y1:Y+_e.y,x2:H+_e.x,y2:J+_e.y,anchorPointX:se,anchorPointY:ce}}class _i{constructor(h,x,S,I,D){this.transform=h.clone(),this.terrain=x,this.collisionIndex=new We(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=S,this.retainedQueryData={},this.collisionGroups=new wi(I),this.collisionCircleArrays={},this.prevPlacement=D,D&&(D.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(h,x,S,I){let D=S.getBucket(x),$=S.latestFeatureIndex;if(!D||!$||x.id!==D.layerIds[0])return;let H=S.collisionBoxArray,Y=D.layers[0].layout,J=Math.pow(2,this.transform.zoom-S.tileID.overscaledZ),se=S.tileSize/n.EXTENT,ce=this.transform.calculatePosMatrix(S.tileID.toUnwrapped()),_e=Y.get("text-pitch-alignment")==="map",Ce=Y.get("text-rotation-alignment")==="map",Ae=Ge(S,1,this.transform.zoom),Pe=qi(ce,_e,Ce,this.transform,Ae),Se=null;if(_e){let tt=Vi(ce,_e,Ce,this.transform,Ae);Se=n.multiply([],this.transform.labelPlaneMatrix,tt)}this.retainedQueryData[D.bucketInstanceId]=new Et(D.bucketInstanceId,$,D.sourceLayerIndex,D.index,S.tileID);let Ve={bucket:D,layout:Y,posMatrix:ce,textLabelPlaneMatrix:Pe,labelToScreenMatrix:Se,scale:J,textPixelRatio:se,holdingForFade:S.holdingForFade(),collisionBoxArray:H,partiallyEvaluatedTextSize:n.evaluateSizeForZoom(D.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(D.sourceID)};if(I)for(let tt of D.sortKeyRanges){let{sortKey:Ne,symbolInstanceStart:Xe,symbolInstanceEnd:st}=tt;h.push({sortKey:Ne,symbolInstanceStart:Xe,symbolInstanceEnd:st,parameters:Ve})}else h.push({symbolInstanceStart:0,symbolInstanceEnd:D.symbolInstances.length,parameters:Ve})}attemptAnchorPlacement(h,x,S,I,D,$,H,Y,J,se,ce,_e,Ce,Ae,Pe,Se){let Ve=n.TextAnchorEnum[h.textAnchor],tt=[h.textOffset0,h.textOffset1],Ne=ji(Ve,S,I,tt,D),Xe=this.collisionIndex.placeCollisionBox(ai(x,Ne.x,Ne.y,$,H,this.transform.angle),ce,Y,J,se.predicate,Se);if((!Pe||this.collisionIndex.placeCollisionBox(ai(Pe,Ne.x,Ne.y,$,H,this.transform.angle),ce,Y,J,se.predicate,Se).box.length!==0)&&Xe.box.length>0){let st;if(this.prevPlacement&&this.prevPlacement.variableOffsets[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID].text&&(st=this.prevPlacement.variableOffsets[_e.crossTileID].anchor),_e.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[_e.crossTileID]={textOffset:tt,width:S,height:I,anchor:Ve,textBoxScale:D,prevAnchor:st},this.markUsedJustification(Ce,Ve,_e,Ae),Ce.allowVerticalPlacement&&(this.markUsedOrientation(Ce,Ae,_e),this.placedOrientations[_e.crossTileID]=Ae),{shift:Ne,placedGlyphBoxes:Xe}}}placeLayerBucketPart(h,x,S){let{bucket:I,layout:D,posMatrix:$,textLabelPlaneMatrix:H,labelToScreenMatrix:Y,textPixelRatio:J,holdingForFade:se,collisionBoxArray:ce,partiallyEvaluatedTextSize:_e,collisionGroup:Ce}=h.parameters,Ae=D.get("text-optional"),Pe=D.get("icon-optional"),Se=n.getOverlapMode(D,"text-overlap","text-allow-overlap"),Ve=Se==="always",tt=n.getOverlapMode(D,"icon-overlap","icon-allow-overlap"),Ne=tt==="always",Xe=D.get("text-rotation-alignment")==="map",st=D.get("text-pitch-alignment")==="map",nt=D.get("icon-text-fit")!=="none",ft=D.get("symbol-z-order")==="viewport-y",At=Ve&&(Ne||!I.hasIconData()||Pe),vt=Ne&&(Ve||!I.hasTextData()||Ae);!I.collisionArrays&&ce&&I.deserializeCollisionBoxes(ce);let Mt=this.retainedQueryData[I.bucketInstanceId].tileID,li=this.terrain?(Ut,Ii)=>this.terrain.getElevation(Mt,Ut,Ii):null,dr=(Ut,Ii)=>{var Jt,Yr;if(x[Ut.crossTileID])return;if(se)return void(this.placements[Ut.crossTileID]=new _t(!1,!1,!1));let cr=!1,ir=!1,Pi=!0,As=null,Lr={box:null,offscreen:null},Qn={box:null,offscreen:null},xn=null,Os=null,ho=null,Da=0,zl=0,Gl=0;Ii.textFeatureIndex?Da=Ii.textFeatureIndex:Ut.useRuntimeCollisionCircles&&(Da=Ut.featureIndex),Ii.verticalTextFeatureIndex&&(zl=Ii.verticalTextFeatureIndex);let Tc=Ii.textBox;if(Tc){let vn=qs=>{let wn=n.WritingMode.horizontal;if(I.allowVerticalPlacement&&!qs&&this.prevPlacement){let fo=this.prevPlacement.placedOrientations[Ut.crossTileID];fo&&(this.placedOrientations[Ut.crossTileID]=fo,wn=fo,this.markUsedOrientation(I,wn,Ut))}return wn},Cs=(qs,wn)=>{if(I.allowVerticalPlacement&&Ut.numVerticalGlyphVertices>0&&Ii.verticalTextBox){for(let fo of I.writingModes)if(fo===n.WritingMode.vertical?(Lr=wn(),Qn=Lr):Lr=qs(),Lr&&Lr.box&&Lr.box.length)break}else Lr=qs()},bn=Ut.textAnchorOffsetStartIndex,S1=Ut.textAnchorOffsetEndIndex;if(S1===bn){let qs=(wn,fo)=>{let vs=this.collisionIndex.placeCollisionBox(wn,Se,J,$,Ce.predicate,li);return vs&&vs.box&&vs.box.length&&(this.markUsedOrientation(I,fo,Ut),this.placedOrientations[Ut.crossTileID]=fo),vs};Cs(()=>qs(Tc,n.WritingMode.horizontal),()=>{let wn=Ii.verticalTextBox;return I.allowVerticalPlacement&&Ut.numVerticalGlyphVertices>0&&wn?qs(wn,n.WritingMode.vertical):{box:null,offscreen:null}}),vn(Lr&&Lr.box&&Lr.box.length)}else{let qs=n.TextAnchorEnum[(Yr=(Jt=this.prevPlacement)===null||Jt===void 0?void 0:Jt.variableOffsets[Ut.crossTileID])===null||Yr===void 0?void 0:Yr.anchor],wn=(vs,A1,$l)=>{let Fa=vs.x2-vs.x1,Ac=vs.y2-vs.y1,i9=Ut.textBoxScale,xu=nt&&tt==="never"?A1:null,C1={box:[],offscreen:!1},Yp=Se==="never"?1:2,bs="never";qs&&Yp++;for(let J0=0;J0<Yp;J0++){for(let ef=bn;ef<S1;ef++){let Cc=I.textAnchorOffsets.get(ef);if(qs&&Cc.textAnchor!==qs)continue;let Hl=this.attemptAnchorPlacement(Cc,vs,Fa,Ac,i9,Xe,st,J,$,Ce,bs,Ut,I,$l,xu,li);if(Hl&&(C1=Hl.placedGlyphBoxes,C1&&C1.box&&C1.box.length))return cr=!0,As=Hl.shift,C1}qs?qs=null:bs=Se}return C1};Cs(()=>wn(Tc,Ii.iconBox,n.WritingMode.horizontal),()=>{let vs=Ii.verticalTextBox;return I.allowVerticalPlacement&&!(Lr&&Lr.box&&Lr.box.length)&&Ut.numVerticalGlyphVertices>0&&vs?wn(vs,Ii.verticalIconBox,n.WritingMode.vertical):{box:null,offscreen:null}}),Lr&&(cr=Lr.box,Pi=Lr.offscreen);let fo=vn(Lr&&Lr.box);if(!cr&&this.prevPlacement){let vs=this.prevPlacement.variableOffsets[Ut.crossTileID];vs&&(this.variableOffsets[Ut.crossTileID]=vs,this.markUsedJustification(I,vs.anchor,Ut,fo))}}}if(xn=Lr,cr=xn&&xn.box&&xn.box.length>0,Pi=xn&&xn.offscreen,Ut.useRuntimeCollisionCircles){let vn=I.text.placedSymbolArray.get(Ut.centerJustifiedTextSymbolIndex),Cs=n.evaluateSizeForFeature(I.textSizeData,_e,vn),bn=D.get("text-padding");Os=this.collisionIndex.placeCollisionCircles(Se,vn,I.lineVertexArray,I.glyphOffsetArray,Cs,$,H,Y,S,st,Ce.predicate,Ut.collisionCircleDiameter,bn,li),Os.circles.length&&Os.collisionDetected&&!S&&n.warnOnce("Collisions detected, but collision boxes are not shown"),cr=Ve||Os.circles.length>0&&!Os.collisionDetected,Pi=Pi&&Os.offscreen}if(Ii.iconFeatureIndex&&(Gl=Ii.iconFeatureIndex),Ii.iconBox){let vn=Cs=>{let bn=nt&&As?ai(Cs,As.x,As.y,Xe,st,this.transform.angle):Cs;return this.collisionIndex.placeCollisionBox(bn,tt,J,$,Ce.predicate,li)};Qn&&Qn.box&&Qn.box.length&&Ii.verticalIconBox?(ho=vn(Ii.verticalIconBox),ir=ho.box.length>0):(ho=vn(Ii.iconBox),ir=ho.box.length>0),Pi=Pi&&ho.offscreen}let _u=Ae||Ut.numHorizontalGlyphVertices===0&&Ut.numVerticalGlyphVertices===0,Sc=Pe||Ut.numIconVertices===0;if(_u||Sc?Sc?_u||(ir=ir&&cr):cr=ir&&cr:ir=cr=ir&&cr,cr&&xn&&xn.box&&this.collisionIndex.insertCollisionBox(xn.box,Se,D.get("text-ignore-placement"),I.bucketInstanceId,Qn&&Qn.box&&zl?zl:Da,Ce.ID),ir&&ho&&this.collisionIndex.insertCollisionBox(ho.box,tt,D.get("icon-ignore-placement"),I.bucketInstanceId,Gl,Ce.ID),Os&&(cr&&this.collisionIndex.insertCollisionCircles(Os.circles,Se,D.get("text-ignore-placement"),I.bucketInstanceId,Da,Ce.ID),S)){let vn=I.bucketInstanceId,Cs=this.collisionCircleArrays[vn];Cs===void 0&&(Cs=this.collisionCircleArrays[vn]=new wt);for(let bn=0;bn<Os.circles.length;bn+=4)Cs.circles.push(Os.circles[bn+0]),Cs.circles.push(Os.circles[bn+1]),Cs.circles.push(Os.circles[bn+2]),Cs.circles.push(Os.collisionDetected?1:0)}if(Ut.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(I.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ut.crossTileID]=new _t(cr||At,ir||vt,Pi||I.justReloaded),x[Ut.crossTileID]=!0};if(ft){if(h.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let Ut=I.getSortedSymbolIndexes(this.transform.angle);for(let Ii=Ut.length-1;Ii>=0;--Ii){let Jt=Ut[Ii];dr(I.symbolInstances.get(Jt),I.collisionArrays[Jt])}}else for(let Ut=h.symbolInstanceStart;Ut<h.symbolInstanceEnd;Ut++)dr(I.symbolInstances.get(Ut),I.collisionArrays[Ut]);if(S&&I.bucketInstanceId in this.collisionCircleArrays){let Ut=this.collisionCircleArrays[I.bucketInstanceId];n.invert(Ut.invProjMatrix,$),Ut.viewportMatrix=this.collisionIndex.getViewportMatrix()}I.justReloaded=!1}markUsedJustification(h,x,S,I){let D;D=I===n.WritingMode.vertical?S.verticalPlacedTextSymbolIndex:{left:S.leftJustifiedTextSymbolIndex,center:S.centerJustifiedTextSymbolIndex,right:S.rightJustifiedTextSymbolIndex}[n.getAnchorJustification(x)];let $=[S.leftJustifiedTextSymbolIndex,S.centerJustifiedTextSymbolIndex,S.rightJustifiedTextSymbolIndex,S.verticalPlacedTextSymbolIndex];for(let H of $)H>=0&&(h.text.placedSymbolArray.get(H).crossTileID=D>=0&&H!==D?0:S.crossTileID)}markUsedOrientation(h,x,S){let I=x===n.WritingMode.horizontal||x===n.WritingMode.horizontalOnly?x:0,D=x===n.WritingMode.vertical?x:0,$=[S.leftJustifiedTextSymbolIndex,S.centerJustifiedTextSymbolIndex,S.rightJustifiedTextSymbolIndex];for(let H of $)h.text.placedSymbolArray.get(H).placedOrientation=I;S.verticalPlacedTextSymbolIndex&&(h.text.placedSymbolArray.get(S.verticalPlacedTextSymbolIndex).placedOrientation=D)}commit(h){this.commitTime=h,this.zoomAtLastRecencyCheck=this.transform.zoom;let x=this.prevPlacement,S=!1;this.prevZoomAdjustment=x?x.zoomAdjustment(this.transform.zoom):0;let I=x?x.symbolFadeChange(h):1,D=x?x.opacities:{},$=x?x.variableOffsets:{},H=x?x.placedOrientations:{};for(let Y in this.placements){let J=this.placements[Y],se=D[Y];se?(this.opacities[Y]=new Qe(se,I,J.text,J.icon),S=S||J.text!==se.text.placed||J.icon!==se.icon.placed):(this.opacities[Y]=new Qe(null,I,J.text,J.icon,J.skipFade),S=S||J.text||J.icon)}for(let Y in D){let J=D[Y];if(!this.opacities[Y]){let se=new Qe(J,I,!1,!1);se.isHidden()||(this.opacities[Y]=se,S=S||J.text.placed||J.icon.placed)}}for(let Y in $)this.variableOffsets[Y]||!this.opacities[Y]||this.opacities[Y].isHidden()||(this.variableOffsets[Y]=$[Y]);for(let Y in H)this.placedOrientations[Y]||!this.opacities[Y]||this.opacities[Y].isHidden()||(this.placedOrientations[Y]=H[Y]);if(x&&x.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");S?this.lastPlacementChangeTime=h:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=x?x.lastPlacementChangeTime:h)}updateLayerOpacities(h,x){let S={};for(let I of x){let D=I.getBucket(h);D&&I.latestFeatureIndex&&h.id===D.layerIds[0]&&this.updateBucketOpacities(D,S,I.collisionBoxArray)}}updateBucketOpacities(h,x,S){h.hasTextData()&&(h.text.opacityVertexArray.clear(),h.text.hasVisibleVertices=!1),h.hasIconData()&&(h.icon.opacityVertexArray.clear(),h.icon.hasVisibleVertices=!1),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexArray.clear(),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexArray.clear();let I=h.layers[0],D=I.layout,$=new Qe(null,0,!1,!1,!0),H=D.get("text-allow-overlap"),Y=D.get("icon-allow-overlap"),J=I._unevaluatedLayout.hasValue("text-variable-anchor")||I._unevaluatedLayout.hasValue("text-variable-anchor-offset"),se=D.get("text-rotation-alignment")==="map",ce=D.get("text-pitch-alignment")==="map",_e=D.get("icon-text-fit")!=="none",Ce=new Qe(null,0,H&&(Y||!h.hasIconData()||D.get("icon-optional")),Y&&(H||!h.hasTextData()||D.get("text-optional")),!0);!h.collisionArrays&&S&&(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData())&&h.deserializeCollisionBoxes(S);let Ae=(Pe,Se,Ve)=>{for(let tt=0;tt<Se/4;tt++)Pe.opacityVertexArray.emplaceBack(Ve);Pe.hasVisibleVertices=Pe.hasVisibleVertices||Ve!==Ps};for(let Pe=0;Pe<h.symbolInstances.length;Pe++){let Se=h.symbolInstances.get(Pe),{numHorizontalGlyphVertices:Ve,numVerticalGlyphVertices:tt,crossTileID:Ne}=Se,Xe=this.opacities[Ne];x[Ne]?Xe=$:Xe||(Xe=Ce,this.opacities[Ne]=Xe),x[Ne]=!0;let st=Se.numIconVertices>0,nt=this.placedOrientations[Se.crossTileID],ft=nt===n.WritingMode.vertical,At=nt===n.WritingMode.horizontal||nt===n.WritingMode.horizontalOnly;if(Ve>0||tt>0){let vt=Pn(Xe.text);Ae(h.text,Ve,ft?Ps:vt),Ae(h.text,tt,At?Ps:vt);let Mt=Xe.text.isHidden();[Se.rightJustifiedTextSymbolIndex,Se.centerJustifiedTextSymbolIndex,Se.leftJustifiedTextSymbolIndex].forEach(Ut=>{Ut>=0&&(h.text.placedSymbolArray.get(Ut).hidden=Mt||ft?1:0)}),Se.verticalPlacedTextSymbolIndex>=0&&(h.text.placedSymbolArray.get(Se.verticalPlacedTextSymbolIndex).hidden=Mt||At?1:0);let li=this.variableOffsets[Se.crossTileID];li&&this.markUsedJustification(h,li.anchor,Se,nt);let dr=this.placedOrientations[Se.crossTileID];dr&&(this.markUsedJustification(h,"left",Se,dr),this.markUsedOrientation(h,dr,Se))}if(st){let vt=Pn(Xe.icon),Mt=!(_e&&Se.verticalPlacedIconSymbolIndex&&ft);Se.placedIconSymbolIndex>=0&&(Ae(h.icon,Se.numIconVertices,Mt?vt:Ps),h.icon.placedSymbolArray.get(Se.placedIconSymbolIndex).hidden=Xe.icon.isHidden()),Se.verticalPlacedIconSymbolIndex>=0&&(Ae(h.icon,Se.numVerticalIconVertices,Mt?Ps:vt),h.icon.placedSymbolArray.get(Se.verticalPlacedIconSymbolIndex).hidden=Xe.icon.isHidden())}if(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData()){let vt=h.collisionArrays[Pe];if(vt){let Mt=new n.Point(0,0);if(vt.textBox||vt.verticalTextBox){let dr=!0;if(J){let Ut=this.variableOffsets[Ne];Ut?(Mt=ji(Ut.anchor,Ut.width,Ut.height,Ut.textOffset,Ut.textBoxScale),se&&Mt._rotate(ce?this.transform.angle:-this.transform.angle)):dr=!1}vt.textBox&&zi(h.textCollisionBox.collisionVertexArray,Xe.text.placed,!dr||ft,Mt.x,Mt.y),vt.verticalTextBox&&zi(h.textCollisionBox.collisionVertexArray,Xe.text.placed,!dr||At,Mt.x,Mt.y)}let li=!!(!At&&vt.verticalIconBox);vt.iconBox&&zi(h.iconCollisionBox.collisionVertexArray,Xe.icon.placed,li,_e?Mt.x:0,_e?Mt.y:0),vt.verticalIconBox&&zi(h.iconCollisionBox.collisionVertexArray,Xe.icon.placed,!li,_e?Mt.x:0,_e?Mt.y:0)}}}if(h.sortFeatures(this.transform.angle),this.retainedQueryData[h.bucketInstanceId]&&(this.retainedQueryData[h.bucketInstanceId].featureSortOrder=h.featureSortOrder),h.hasTextData()&&h.text.opacityVertexBuffer&&h.text.opacityVertexBuffer.updateData(h.text.opacityVertexArray),h.hasIconData()&&h.icon.opacityVertexBuffer&&h.icon.opacityVertexBuffer.updateData(h.icon.opacityVertexArray),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexBuffer&&h.iconCollisionBox.collisionVertexBuffer.updateData(h.iconCollisionBox.collisionVertexArray),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexBuffer&&h.textCollisionBox.collisionVertexBuffer.updateData(h.textCollisionBox.collisionVertexArray),h.text.opacityVertexArray.length!==h.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${h.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${h.text.layoutVertexArray.length}) / 4`);if(h.icon.opacityVertexArray.length!==h.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${h.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${h.icon.layoutVertexArray.length}) / 4`);if(h.bucketInstanceId in this.collisionCircleArrays){let Pe=this.collisionCircleArrays[h.bucketInstanceId];h.placementInvProjMatrix=Pe.invProjMatrix,h.placementViewportMatrix=Pe.viewportMatrix,h.collisionCircleArray=Pe.circles,delete this.collisionCircleArrays[h.bucketInstanceId]}}symbolFadeChange(h){return this.fadeDuration===0?1:(h-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(h){return Math.max(0,(this.transform.zoom-h)/1.5)}hasTransitions(h){return this.stale||h-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(h,x){let S=this.zoomAtLastRecencyCheck===x?1-this.zoomAdjustment(x):1;return this.zoomAtLastRecencyCheck=x,this.commitTime+this.fadeDuration*S>h}setStale(){this.stale=!0}}function zi(P,h,x,S,I){P.emplaceBack(h?1:0,x?1:0,S||0,I||0),P.emplaceBack(h?1:0,x?1:0,S||0,I||0),P.emplaceBack(h?1:0,x?1:0,S||0,I||0),P.emplaceBack(h?1:0,x?1:0,S||0,I||0)}let wr=Math.pow(2,25),Or=Math.pow(2,24),ur=Math.pow(2,17),vr=Math.pow(2,16),co=Math.pow(2,9),Fi=Math.pow(2,8),Ws=Math.pow(2,1);function Pn(P){if(P.opacity===0&&!P.placed)return 0;if(P.opacity===1&&P.placed)return 4294967295;let h=P.placed?1:0,x=Math.floor(127*P.opacity);return x*wr+h*Or+x*ur+h*vr+x*co+h*Fi+x*Ws+h}let Ps=0;class Co{constructor(h){this._sortAcrossTiles=h.layout.get("symbol-z-order")!=="viewport-y"&&!h.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(h,x,S,I,D){let $=this._bucketParts;for(;this._currentTileIndex<h.length;)if(x.getBucketParts($,I,h[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,D())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,$.sort((H,Y)=>H.sortKey-Y.sortKey));this._currentPartIndex<$.length;)if(x.placeLayerBucketPart($[this._currentPartIndex],this._seenCrossTileIDs,S),this._currentPartIndex++,D())return!0;return!1}}class lv{constructor(h,x,S,I,D,$,H,Y){this.placement=new _i(h,x,$,H,Y),this._currentPlacementIndex=S.length-1,this._forceFullPlacement=I,this._showCollisionBoxes=D,this._done=!1}isDone(){return this._done}continuePlacement(h,x,S){let I=n.browser.now(),D=()=>!this._forceFullPlacement&&n.browser.now()-I>2;for(;this._currentPlacementIndex>=0;){let $=x[h[this._currentPlacementIndex]],H=this.placement.collisionIndex.transform.zoom;if($.type==="symbol"&&(!$.minzoom||$.minzoom<=H)&&(!$.maxzoom||$.maxzoom>H)){if(this._inProgressLayer||(this._inProgressLayer=new Co($)),this._inProgressLayer.continuePlacement(S[$.source],this.placement,this._showCollisionBoxes,$,D))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(h){return this.placement.commit(h),this.placement}}let Un=512/n.EXTENT/2;class la{constructor(h,x,S){this.tileID=h,this.bucketInstanceId=S,this._symbolsByKey={};let I=new Map;for(let D=0;D<x.length;D++){let $=x.get(D),H=$.key,Y=I.get(H);Y?Y.push($):I.set(H,[$])}for(let[D,$]of I){let H={positions:$.map(Y=>({x:Math.floor(Y.anchorX*Un),y:Math.floor(Y.anchorY*Un)})),crossTileIDs:$.map(Y=>Y.crossTileID)};if(H.positions.length>128){let Y=new n.KDBush(H.positions.length,16,Uint16Array);for(let{x:J,y:se}of H.positions)Y.add(J,se);Y.finish(),delete H.positions,H.index=Y}this._symbolsByKey[D]=H}}getScaledCoordinates(h,x){let{x:S,y:I,z:D}=this.tileID.canonical,{x:$,y:H,z:Y}=x.canonical,J=Un/Math.pow(2,Y-D),se=(H*n.EXTENT+h.anchorY)*J,ce=I*n.EXTENT*Un;return{x:Math.floor(($*n.EXTENT+h.anchorX)*J-S*n.EXTENT*Un),y:Math.floor(se-ce)}}findMatches(h,x,S){let I=this.tileID.canonical.z<x.canonical.z?1:Math.pow(2,this.tileID.canonical.z-x.canonical.z);for(let D=0;D<h.length;D++){let $=h.get(D);if($.crossTileID)continue;let H=this._symbolsByKey[$.key];if(!H)continue;let Y=this.getScaledCoordinates($,x);if(H.index){let J=H.index.range(Y.x-I,Y.y-I,Y.x+I,Y.y+I).sort();for(let se of J){let ce=H.crossTileIDs[se];if(!S[ce]){S[ce]=!0,$.crossTileID=ce;break}}}else if(H.positions)for(let J=0;J<H.positions.length;J++){let se=H.positions[J],ce=H.crossTileIDs[J];if(Math.abs(se.x-Y.x)<=I&&Math.abs(se.y-Y.y)<=I&&!S[ce]){S[ce]=!0,$.crossTileID=ce;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:h})=>h)}}class w7{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class x0{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(h){let x=Math.round((h-this.lng)/360);if(x!==0)for(let S in this.indexes){let I=this.indexes[S],D={};for(let $ in I){let H=I[$];H.tileID=H.tileID.unwrapTo(H.tileID.wrap+x),D[H.tileID.key]=H}this.indexes[S]=D}this.lng=h}addBucket(h,x,S){if(this.indexes[h.overscaledZ]&&this.indexes[h.overscaledZ][h.key]){if(this.indexes[h.overscaledZ][h.key].bucketInstanceId===x.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(h.overscaledZ,this.indexes[h.overscaledZ][h.key])}for(let D=0;D<x.symbolInstances.length;D++)x.symbolInstances.get(D).crossTileID=0;this.usedCrossTileIDs[h.overscaledZ]||(this.usedCrossTileIDs[h.overscaledZ]={});let I=this.usedCrossTileIDs[h.overscaledZ];for(let D in this.indexes){let $=this.indexes[D];if(Number(D)>h.overscaledZ)for(let H in $){let Y=$[H];Y.tileID.isChildOf(h)&&Y.findMatches(x.symbolInstances,h,I)}else{let H=$[h.scaledTo(Number(D)).key];H&&H.findMatches(x.symbolInstances,h,I)}}for(let D=0;D<x.symbolInstances.length;D++){let $=x.symbolInstances.get(D);$.crossTileID||($.crossTileID=S.generate(),I[$.crossTileID]=!0)}return this.indexes[h.overscaledZ]===void 0&&(this.indexes[h.overscaledZ]={}),this.indexes[h.overscaledZ][h.key]=new la(h,x.symbolInstances,x.bucketInstanceId),!0}removeBucketCrossTileIDs(h,x){for(let S of x.getCrossTileIDsLists())for(let I of S)delete this.usedCrossTileIDs[h][I]}removeStaleBuckets(h){let x=!1;for(let S in this.indexes){let I=this.indexes[S];for(let D in I)h[I[D].bucketInstanceId]||(this.removeBucketCrossTileIDs(S,I[D]),delete I[D],x=!0)}return x}}class Rs{constructor(){this.layerIndexes={},this.crossTileIDs=new w7,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(h,x,S){let I=this.layerIndexes[h.id];I===void 0&&(I=this.layerIndexes[h.id]=new x0);let D=!1,$={};I.handleWrapJump(S);for(let H of x){let Y=H.getBucket(h);Y&&h.id===Y.layerIds[0]&&(Y.bucketInstanceId||(Y.bucketInstanceId=++this.maxBucketInstanceId),I.addBucket(H.tileID,Y,this.crossTileIDs)&&(D=!0),$[Y.bucketInstanceId]=!0)}return I.removeStaleBuckets($)&&(D=!0),D}pruneUnusedLayers(h){let x={};h.forEach(S=>{x[S]=!0});for(let S in this.layerIndexes)x[S]||delete this.layerIndexes[S]}}let xc=(P,h)=>n.emitValidationErrors(P,h&&h.filter(x=>x.identifier!=="source.canvas")),nu=n.pick(n.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Ds=n.pick(n.operations,["setCenter","setZoom","setBearing","setPitch"]),v0=n.emptyStyle();class zn extends n.Evented{constructor(h,x={}){super(),this.map=h,this.dispatcher=new te(ti(),this,h._getMapId()),this.imageManager=new Z,this.imageManager.setEventedParent(this),this.glyphManager=new V(h._requestManager,x.localIdeographFontFamily),this.lineAtlas=new re(256,512),this.crossTileSymbolIndex=new Rs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new n.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",n.getReferrer());let S=this;this._rtlTextPluginCallback=zn.registerForPluginStateChange(I=>{S.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:I.pluginStatus,pluginURL:I.pluginURL},(D,$)=>{if(n.triggerPluginCompletionEvent(D),$&&$.every(H=>H))for(let H in S.sourceCaches){let Y=S.sourceCaches[H].getSource().type;Y!=="vector"&&Y!=="geojson"||S.sourceCaches[H].reload()}})}),this.on("data",I=>{if(I.dataType!=="source"||I.sourceDataType!=="metadata")return;let D=this.sourceCaches[I.sourceId];if(!D)return;let $=D.getSource();if($&&$.vectorLayerIds)for(let H in this._layers){let Y=this._layers[H];Y.source===$.id&&this._validateLayer(Y)}})}loadURL(h,x={},S){this.fire(new n.Event("dataloading",{dataType:"style"})),x.validate=typeof x.validate!="boolean"||x.validate;let I=this.map._requestManager.transformRequest(h,E.Style);this._request=n.getJSON(I,(D,$)=>{this._request=null,D?this.fire(new n.ErrorEvent(D)):$&&this._load($,x,S)})}loadJSON(h,x={},S){this.fire(new n.Event("dataloading",{dataType:"style"})),this._request=n.browser.frame(()=>{this._request=null,x.validate=x.validate!==!1,this._load(h,x,S)})}loadEmpty(){this.fire(new n.Event("dataloading",{dataType:"style"})),this._load(v0,{validate:!1})}_load(h,x,S){let I=x.transformStyle?x.transformStyle(S,h):h;if(!x.validate||!xc(this,n.validateStyle(I))){this._loaded=!0,this.stylesheet=I;for(let D in I.sources)this.addSource(D,I.sources[D],{validate:!1});I.sprite?this._loadSprite(I.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(I.glyphs),this._createLayers(),this.light=new ee(this.stylesheet.light),this.map.setTerrain(this.stylesheet.terrain),this.fire(new n.Event("data",{dataType:"style"})),this.fire(new n.Event("style.load"))}}_createLayers(){let h=n.derefLayers(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",h),this._order=h.map(x=>x.id),this._layers={},this._serializedLayers=null;for(let x of h){let S=n.createStyleLayer(x);S.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=S}}_loadSprite(h,x=!1,S=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(I,D,$,H){let Y=O(I),J=Y.length,se=$>1?"@2x":"",ce={},_e={},Ce={};for(let{id:Ae,url:Pe}of Y){let Se=D.transformRequest(D.normalizeSpriteURL(Pe,se,".json"),E.SpriteJSON),Ve=`${Ae}_${Se.url}`;ce[Ve]=n.getJSON(Se,(Xe,st)=>{delete ce[Ve],_e[Ae]=st,B(H,_e,Ce,Xe,J)});let tt=D.transformRequest(D.normalizeSpriteURL(Pe,se,".png"),E.SpriteImage),Ne=`${Ae}_${tt.url}`;ce[Ne]=v.getImage(tt,(Xe,st)=>{delete ce[Ne],Ce[Ae]=st,B(H,_e,Ce,Xe,J)})}return{cancel(){for(let Ae of Object.values(ce))Ae.cancel()}}}(h,this.map._requestManager,this.map.getPixelRatio(),(I,D)=>{if(this._spriteRequest=null,I)this.fire(new n.ErrorEvent(I));else if(D)for(let $ in D){this._spritesImagesIds[$]=[];let H=this._spritesImagesIds[$]?this._spritesImagesIds[$].filter(Y=>!(Y in D)):[];for(let Y of H)this.imageManager.removeImage(Y),this._changedImages[Y]=!0;for(let Y in D[$]){let J=$==="default"?Y:`${$}:${Y}`;this._spritesImagesIds[$].push(J),J in this.imageManager.images?this.imageManager.updateImage(J,D[$][Y],!1):this.imageManager.addImage(J,D[$][Y]),x&&(this._changedImages[J]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),x&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"})),S&&S(I)})}_unloadSprite(){for(let h of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(h),this._changedImages[h]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}_validateLayer(h){let x=this.sourceCaches[h.source];if(!x)return;let S=h.sourceLayer;if(!S)return;let I=x.getSource();(I.type==="geojson"||I.vectorLayerIds&&I.vectorLayerIds.indexOf(S)===-1)&&this.fire(new n.ErrorEvent(new Error(`Source layer "${S}" does not exist on source "${I.id}" as specified by style layer "${h.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let h in this.sourceCaches)if(!this.sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(h){let x=this._serializedAllLayers();if(!h||h.length===0)return Object.values(x);let S=[];for(let I of h)x[I]&&S.push(x[I]);return S}_serializedAllLayers(){let h=this._serializedLayers;if(h)return h;h=this._serializedLayers={};let x=Object.keys(this._layers);for(let S of x){let I=this._layers[S];I.type!=="custom"&&(h[S]=I.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(let h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(let h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(h){if(!this._loaded)return;let x=this._changed;if(this._changed){let I=Object.keys(this._updatedLayers),D=Object.keys(this._removedLayers);(I.length||D.length)&&this._updateWorkerLayers(I,D);for(let $ in this._updatedSources){let H=this._updatedSources[$];if(H==="reload")this._reloadSource($);else{if(H!=="clear")throw new Error(`Invalid action ${H}`);this._clearSource($)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let $ in this._updatedPaintProps)this._layers[$].updateTransitions(h);this.light.updateTransitions(h),this._resetUpdates()}let S={};for(let I in this.sourceCaches){let D=this.sourceCaches[I];S[I]=D.used,D.used=!1}for(let I of this._order){let D=this._layers[I];D.recalculate(h,this._availableImages),!D.isHidden(h.zoom)&&D.source&&(this.sourceCaches[D.source].used=!0)}for(let I in S){let D=this.sourceCaches[I];S[I]!==D.used&&D.fire(new n.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:I}))}this.light.recalculate(h),this.z=h.zoom,x&&this.fire(new n.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){let h=Object.keys(this._changedImages);if(h.length){for(let x in this.sourceCaches)this.sourceCaches[x].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(h,x){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(h),removedIds:x})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(h,x={}){this._checkLoaded();let S=this.serialize();if(h=x.transformStyle?x.transformStyle(S,h):h,xc(this,n.validateStyle(h)))return!1;(h=n.clone$1(h)).layers=n.derefLayers(h.layers);let I=n.diffStyles(S,h).filter($=>!($.command in Ds));if(I.length===0)return!1;let D=I.filter($=>!($.command in nu));if(D.length>0)throw new Error(`Unimplemented: ${D.map($=>$.command).join(", ")}.`);for(let $ of I)$.command!=="setTransition"&&this[$.command].apply(this,$.args);return this.stylesheet=h,!0}addImage(h,x){if(this.getImage(h))return this.fire(new n.ErrorEvent(new Error(`An image named "${h}" already exists.`)));this.imageManager.addImage(h,x),this._afterImageUpdated(h)}updateImage(h,x){this.imageManager.updateImage(h,x)}getImage(h){return this.imageManager.getImage(h)}removeImage(h){if(!this.getImage(h))return this.fire(new n.ErrorEvent(new Error(`An image named "${h}" does not exist.`)));this.imageManager.removeImage(h),this._afterImageUpdated(h)}_afterImageUpdated(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(h,x,S={}){if(this._checkLoaded(),this.sourceCaches[h]!==void 0)throw new Error(`Source "${h}" already exists.`);if(!x.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(x).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(x.type)>=0&&this._validate(n.validateStyle.source,`sources.${h}`,x,null,S))return;this.map&&this.map._collectResourceTiming&&(x.collectResourceTiming=!0);let I=this.sourceCaches[h]=new xe(h,x,this.dispatcher);I.style=this,I.setEventedParent(this,()=>({isSourceLoaded:I.loaded(),source:I.serialize(),sourceId:h})),I.onAdd(this.map),this._changed=!0}removeSource(h){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error("There is no source with this ID");for(let S in this._layers)if(this._layers[S].source===h)return this.fire(new n.ErrorEvent(new Error(`Source "${h}" cannot be removed while layer "${S}" is using it.`)));let x=this.sourceCaches[h];delete this.sourceCaches[h],delete this._updatedSources[h],x.fire(new n.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:h})),x.setEventedParent(null),x.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(h,x){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error(`There is no source with this ID=${h}`);let S=this.sourceCaches[h].getSource();if(S.type!=="geojson")throw new Error(`geojsonSource.type is ${S.type}, which is !== 'geojson`);S.setData(x),this._changed=!0}getSource(h){return this.sourceCaches[h]&&this.sourceCaches[h].getSource()}addLayer(h,x,S={}){this._checkLoaded();let I=h.id;if(this.getLayer(I))return void this.fire(new n.ErrorEvent(new Error(`Layer "${I}" already exists on this map.`)));let D;if(h.type==="custom"){if(xc(this,n.validateCustomStyleLayer(h)))return;D=n.createStyleLayer(h)}else{if(typeof h.source=="object"&&(this.addSource(I,h.source),h=n.clone$1(h),h=n.extend(h,{source:I})),this._validate(n.validateStyle.layer,`layers.${I}`,h,{arrayIndex:-1},S))return;D=n.createStyleLayer(h),this._validateLayer(D),D.setEventedParent(this,{layer:{id:I}})}let $=x?this._order.indexOf(x):this._order.length;if(x&&$===-1)this.fire(new n.ErrorEvent(new Error(`Cannot add layer "${I}" before non-existing layer "${x}".`)));else{if(this._order.splice($,0,I),this._layerOrderChanged=!0,this._layers[I]=D,this._removedLayers[I]&&D.source&&D.type!=="custom"){let H=this._removedLayers[I];delete this._removedLayers[I],H.type!==D.type?this._updatedSources[D.source]="clear":(this._updatedSources[D.source]="reload",this.sourceCaches[D.source].pause())}this._updateLayer(D),D.onAdd&&D.onAdd(this.map)}}moveLayer(h,x){if(this._checkLoaded(),this._changed=!0,!this._layers[h])return void this.fire(new n.ErrorEvent(new Error(`The layer '${h}' does not exist in the map's style and cannot be moved.`)));if(h===x)return;let S=this._order.indexOf(h);this._order.splice(S,1);let I=x?this._order.indexOf(x):this._order.length;x&&I===-1?this.fire(new n.ErrorEvent(new Error(`Cannot move layer "${h}" before non-existing layer "${x}".`))):(this._order.splice(I,0,h),this._layerOrderChanged=!0)}removeLayer(h){this._checkLoaded();let x=this._layers[h];if(!x)return void this.fire(new n.ErrorEvent(new Error(`Cannot remove non-existing layer "${h}".`)));x.setEventedParent(null);let S=this._order.indexOf(h);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=x,delete this._layers[h],this._serializedLayers&&delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],x.onRemove&&x.onRemove(this.map)}getLayer(h){return this._layers[h]}hasLayer(h){return h in this._layers}setLayerZoomRange(h,x,S){this._checkLoaded();let I=this.getLayer(h);I?I.minzoom===x&&I.maxzoom===S||(x!=null&&(I.minzoom=x),S!=null&&(I.maxzoom=S),this._updateLayer(I)):this.fire(new n.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${h}".`)))}setFilter(h,x,S={}){this._checkLoaded();let I=this.getLayer(h);if(I){if(!n.deepEqual(I.filter,x))return x==null?(I.filter=void 0,void this._updateLayer(I)):void(this._validate(n.validateStyle.filter,`layers.${I.id}.filter`,x,null,S)||(I.filter=n.clone$1(x),this._updateLayer(I)))}else this.fire(new n.ErrorEvent(new Error(`Cannot filter non-existing layer "${h}".`)))}getFilter(h){return n.clone$1(this.getLayer(h).filter)}setLayoutProperty(h,x,S,I={}){this._checkLoaded();let D=this.getLayer(h);D?n.deepEqual(D.getLayoutProperty(x),S)||(D.setLayoutProperty(x,S,I),this._updateLayer(D)):this.fire(new n.ErrorEvent(new Error(`Cannot style non-existing layer "${h}".`)))}getLayoutProperty(h,x){let S=this.getLayer(h);if(S)return S.getLayoutProperty(x);this.fire(new n.ErrorEvent(new Error(`Cannot get style of non-existing layer "${h}".`)))}setPaintProperty(h,x,S,I={}){this._checkLoaded();let D=this.getLayer(h);D?n.deepEqual(D.getPaintProperty(x),S)||(D.setPaintProperty(x,S,I)&&this._updateLayer(D),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new n.ErrorEvent(new Error(`Cannot style non-existing layer "${h}".`)))}getPaintProperty(h,x){return this.getLayer(h).getPaintProperty(x)}setFeatureState(h,x){this._checkLoaded();let S=h.source,I=h.sourceLayer,D=this.sourceCaches[S];if(D===void 0)return void this.fire(new n.ErrorEvent(new Error(`The source '${S}' does not exist in the map's style.`)));let $=D.getSource().type;$==="geojson"&&I?this.fire(new n.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):$!=="vector"||I?(h.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided."))),D.setFeatureState(I,h.id,x)):this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(h,x){this._checkLoaded();let S=h.source,I=this.sourceCaches[S];if(I===void 0)return void this.fire(new n.ErrorEvent(new Error(`The source '${S}' does not exist in the map's style.`)));let D=I.getSource().type,$=D==="vector"?h.sourceLayer:void 0;D!=="vector"||$?x&&typeof h.id!="string"&&typeof h.id!="number"?this.fire(new n.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):I.removeFeatureState($,h.id,x):this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(h){this._checkLoaded();let x=h.source,S=h.sourceLayer,I=this.sourceCaches[x];if(I!==void 0)return I.getSource().type!=="vector"||S?(h.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided."))),I.getFeatureState(S,h.id)):void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new n.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)))}getTransition(){return n.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let h=n.mapObject(this.sourceCaches,I=>I.serialize()),x=this._serializeByIds(this._order),S=this.stylesheet;return n.filterObject({version:S.version,name:S.name,metadata:S.metadata,light:S.light,center:S.center,zoom:S.zoom,bearing:S.bearing,pitch:S.pitch,sprite:S.sprite,glyphs:S.glyphs,transition:S.transition,sources:h,layers:x},I=>I!==void 0)}_updateLayer(h){this._updatedLayers[h.id]=!0,h.source&&!this._updatedSources[h.source]&&this.sourceCaches[h.source].getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(h){let x=$=>this._layers[$].type==="fill-extrusion",S={},I=[];for(let $=this._order.length-1;$>=0;$--){let H=this._order[$];if(x(H)){S[H]=$;for(let Y of h){let J=Y[H];if(J)for(let se of J)I.push(se)}}}I.sort(($,H)=>H.intersectionZ-$.intersectionZ);let D=[];for(let $=this._order.length-1;$>=0;$--){let H=this._order[$];if(x(H))for(let Y=I.length-1;Y>=0;Y--){let J=I[Y].feature;if(S[J.layer.id]<$)break;D.push(J),I.pop()}else for(let Y of h){let J=Y[H];if(J)for(let se of J)D.push(se.feature)}}return D}queryRenderedFeatures(h,x,S){x&&x.filter&&this._validate(n.validateStyle.filter,"queryRenderedFeatures.filter",x.filter,null,x);let I={};if(x&&x.layers){if(!Array.isArray(x.layers))return this.fire(new n.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(let H of x.layers){let Y=this._layers[H];if(!Y)return this.fire(new n.ErrorEvent(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];I[Y.source]=!0}}let D=[];x.availableImages=this._availableImages;let $=this._serializedAllLayers();for(let H in this.sourceCaches)x.layers&&!I[H]||D.push(Bt(this.sourceCaches[H],this._layers,$,h,x,S));return this.placement&&D.push(function(H,Y,J,se,ce,_e,Ce){let Ae={},Pe=_e.queryRenderedSymbols(se),Se=[];for(let Ve of Object.keys(Pe).map(Number))Se.push(Ce[Ve]);Se.sort(Mi);for(let Ve of Se){let tt=Ve.featureIndex.lookupSymbolFeatures(Pe[Ve.bucketInstanceId],Y,Ve.bucketIndex,Ve.sourceLayerIndex,ce.filter,ce.layers,ce.availableImages,H);for(let Ne in tt){let Xe=Ae[Ne]=Ae[Ne]||[],st=tt[Ne];st.sort((nt,ft)=>{let At=Ve.featureSortOrder;if(At){let vt=At.indexOf(nt.featureIndex);return At.indexOf(ft.featureIndex)-vt}return ft.featureIndex-nt.featureIndex});for(let nt of st)Xe.push(nt)}}for(let Ve in Ae)Ae[Ve].forEach(tt=>{let Ne=tt.feature,Xe=J[H[Ve].source].getFeatureState(Ne.layer["source-layer"],Ne.id);Ne.source=Ne.layer.source,Ne.layer["source-layer"]&&(Ne.sourceLayer=Ne.layer["source-layer"]),Ne.state=Xe});return Ae}(this._layers,$,this.sourceCaches,h,x,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(D)}querySourceFeatures(h,x){x&&x.filter&&this._validate(n.validateStyle.filter,"querySourceFeatures.filter",x.filter,null,x);let S=this.sourceCaches[h];return S?function(I,D){let $=I.getRenderableIds().map(J=>I.getTileByID(J)),H=[],Y={};for(let J=0;J<$.length;J++){let se=$[J],ce=se.tileID.canonical.key;Y[ce]||(Y[ce]=!0,se.querySourceFeatures(H,D))}return H}(S,x):[]}addSourceType(h,x,S){return xt(h)?S(new Error(`A source type called "${h}" already exists.`)):(((I,D)=>{Ze[I]=D})(h,x),x.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:x.workerSourceURL},S):S(null,null))}getLight(){return this.light.getLight()}setLight(h,x={}){this._checkLoaded();let S=this.light.getLight(),I=!1;for(let $ in h)if(!n.deepEqual(h[$],S[$])){I=!0;break}if(!I)return;let D={now:n.browser.now(),transition:n.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(h,x),this.light.updateTransitions(D)}_validate(h,x,S,I,D={}){return(!D||D.validate!==!1)&&xc(this,h.call(n.validateStyle,n.extend({key:x,style:this.serialize(),value:S,styleSpec:n.v8Spec},I)))}_remove(h=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(let x in this._layers)this._layers[x].setEventedParent(null);for(let x in this.sourceCaches){let S=this.sourceCaches[x];S.setEventedParent(null),S.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(h)}_clearSource(h){this.sourceCaches[h].clearTiles()}_reloadSource(h){this.sourceCaches[h].resume(),this.sourceCaches[h].reload()}_updateSources(h){for(let x in this.sourceCaches)this.sourceCaches[x].update(h,this.map.terrain)}_generateCollisionBoxes(){for(let h in this.sourceCaches)this._reloadSource(h)}_updatePlacement(h,x,S,I,D=!1){let $=!1,H=!1,Y={};for(let J of this._order){let se=this._layers[J];if(se.type!=="symbol")continue;if(!Y[se.source]){let _e=this.sourceCaches[se.source];Y[se.source]=_e.getRenderableIds(!0).map(Ce=>_e.getTileByID(Ce)).sort((Ce,Ae)=>Ae.tileID.overscaledZ-Ce.tileID.overscaledZ||(Ce.tileID.isLessThan(Ae.tileID)?-1:1))}let ce=this.crossTileSymbolIndex.addLayer(se,Y[se.source],h.center.lng);$=$||ce}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((D=D||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.browser.now(),h.zoom))&&(this.pauseablePlacement=new lv(h,this.map.terrain,this._order,D,x,S,I,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.browser.now()),H=!0),$&&this.pauseablePlacement.placement.setStale()),H||$)for(let J of this._order){let se=this._layers[J];se.type==="symbol"&&this.placement.updateLayerOpacities(se,Y[se.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.browser.now())}_releaseSymbolFadeTiles(){for(let h in this.sourceCaches)this.sourceCaches[h].releaseSymbolFadeTiles()}getImages(h,x,S){this.imageManager.getImages(x.icons,S),this._updateTilesForChangedImages();let I=this.sourceCaches[x.source];I&&I.setDependencies(x.tileID.key,x.type,x.icons)}getGlyphs(h,x,S){this.glyphManager.getGlyphs(x.stacks,S);let I=this.sourceCaches[x.source];I&&I.setDependencies(x.tileID.key,x.type,[""])}getResource(h,x,S){return n.makeRequest(x,S)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(h,x={}){this._checkLoaded(),h&&this._validate(n.validateStyle.glyphs,"glyphs",h,null,x)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=h,this.glyphManager.entries={},this.glyphManager.setURL(h))}addSprite(h,x,S={},I){this._checkLoaded();let D=[{id:h,url:x}],$=[...O(this.stylesheet.sprite),...D];this._validate(n.validateStyle.sprite,"sprite",$,null,S)||(this.stylesheet.sprite=$,this._loadSprite(D,!0,I))}removeSprite(h){this._checkLoaded();let x=O(this.stylesheet.sprite);if(x.find(S=>S.id===h)){if(this._spritesImagesIds[h])for(let S of this._spritesImagesIds[h])this.imageManager.removeImage(S),this._changedImages[S]=!0;x.splice(x.findIndex(S=>S.id===h),1),this.stylesheet.sprite=x.length>0?x:void 0,delete this._spritesImagesIds[h],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}else this.fire(new n.ErrorEvent(new Error(`Sprite "${h}" doesn't exists on this map.`)))}getSprite(){return O(this.stylesheet.sprite)}setSprite(h,x={},S){this._checkLoaded(),h&&this._validate(n.validateStyle.sprite,"sprite",h,null,x)||(this.stylesheet.sprite=h,h?this._loadSprite(h,!0,S):(this._unloadSprite(),S&&S(null)))}}zn.registerForPluginStateChange=n.registerForPluginStateChange;var b0=n.createLayout([{name:"a_pos",type:"Int16",components:2}]),cl="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";let Mh={prelude:Fr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Fr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Fr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Fr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Fr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Fr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Fr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Fr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Fr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Fr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Fr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Fr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Fr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Fr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Fr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Fr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Fr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Fr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Fr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Fr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Fr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Fr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Fr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Fr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Fr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Fr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Fr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",cl),terrainDepth:Fr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",cl),terrainCoords:Fr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",cl)};function Fr(P,h){let x=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,S=h.match(/attribute ([\w]+) ([\w]+)/g),I=P.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),D=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),$=D?D.concat(I):I,H={};return{fragmentSource:P=P.replace(x,(Y,J,se,ce,_e)=>(H[_e]=!0,J==="define"?`
#ifndef HAS_UNIFORM_u_${_e}
varying ${se} ${ce} ${_e};
#else
uniform ${se} ${ce} u_${_e};
#endif
`:`
#ifdef HAS_UNIFORM_u_${_e}
    ${se} ${ce} ${_e} = u_${_e};
#endif
`)),vertexSource:h=h.replace(x,(Y,J,se,ce,_e)=>{let Ce=ce==="float"?"vec2":"vec4",Ae=_e.match(/color/)?"color":Ce;return H[_e]?J==="define"?`
#ifndef HAS_UNIFORM_u_${_e}
uniform lowp float u_${_e}_t;
attribute ${se} ${Ce} a_${_e};
varying ${se} ${ce} ${_e};
#else
uniform ${se} ${ce} u_${_e};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${_e}
    ${_e} = a_${_e};
#else
    ${se} ${ce} ${_e} = u_${_e};
#endif
`:`
#ifndef HAS_UNIFORM_u_${_e}
    ${_e} = unpack_mix_${Ae}(a_${_e}, u_${_e}_t);
#else
    ${se} ${ce} ${_e} = u_${_e};
#endif
`:J==="define"?`
#ifndef HAS_UNIFORM_u_${_e}
uniform lowp float u_${_e}_t;
attribute ${se} ${Ce} a_${_e};
#else
uniform ${se} ${ce} u_${_e};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${_e}
    ${se} ${ce} ${_e} = a_${_e};
#else
    ${se} ${ce} ${_e} = u_${_e};
#endif
`:`
#ifndef HAS_UNIFORM_u_${_e}
    ${se} ${ce} ${_e} = unpack_mix_${Ae}(a_${_e}, u_${_e}_t);
#else
    ${se} ${ce} ${_e} = u_${_e};
#endif
`}),staticAttributes:S,staticUniforms:$}}class w0{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(h,x,S,I,D,$,H,Y,J){this.context=h;let se=this.boundPaintVertexBuffers.length!==I.length;for(let ce=0;!se&&ce<I.length;ce++)this.boundPaintVertexBuffers[ce]!==I[ce]&&(se=!0);!this.vao||this.boundProgram!==x||this.boundLayoutVertexBuffer!==S||se||this.boundIndexBuffer!==D||this.boundVertexOffset!==$||this.boundDynamicVertexBuffer!==H||this.boundDynamicVertexBuffer2!==Y||this.boundDynamicVertexBuffer3!==J?this.freshBind(x,S,I,D,$,H,Y,J):(h.bindVertexArray.set(this.vao),H&&H.bind(),D&&D.dynamicDraw&&D.bind(),Y&&Y.bind(),J&&J.bind())}freshBind(h,x,S,I,D,$,H,Y){let J=h.numAttributes,se=this.context,ce=se.gl;this.vao&&this.destroy(),this.vao=se.createVertexArray(),se.bindVertexArray.set(this.vao),this.boundProgram=h,this.boundLayoutVertexBuffer=x,this.boundPaintVertexBuffers=S,this.boundIndexBuffer=I,this.boundVertexOffset=D,this.boundDynamicVertexBuffer=$,this.boundDynamicVertexBuffer2=H,this.boundDynamicVertexBuffer3=Y,x.enableAttributes(ce,h);for(let _e of S)_e.enableAttributes(ce,h);$&&$.enableAttributes(ce,h),H&&H.enableAttributes(ce,h),Y&&Y.enableAttributes(ce,h),x.bind(),x.setVertexAttribPointers(ce,h,D);for(let _e of S)_e.bind(),_e.setVertexAttribPointers(ce,h,D);$&&($.bind(),$.setVertexAttribPointers(ce,h,D)),I&&I.bind(),H&&(H.bind(),H.setVertexAttribPointers(ce,h,D)),Y&&(Y.bind(),Y.setVertexAttribPointers(ce,h,D)),se.currentNumAttributes=J}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function f1(P){let h=[];for(let x=0;x<P.length;x++){if(P[x]===null)continue;let S=P[x].split(" ");h.push(S.pop())}return h}class vc{constructor(h,x,S,I,D,$){let H=h.gl;this.program=H.createProgram();let Y=f1(x.staticAttributes),J=S?S.getBinderAttributes():[],se=Y.concat(J),ce=Mh.prelude.staticUniforms?f1(Mh.prelude.staticUniforms):[],_e=x.staticUniforms?f1(x.staticUniforms):[],Ce=S?S.getBinderUniforms():[],Ae=ce.concat(_e).concat(Ce),Pe=[];for(let nt of Ae)Pe.indexOf(nt)<0&&Pe.push(nt);let Se=S?S.defines():[];D&&Se.push("#define OVERDRAW_INSPECTOR;"),$&&Se.push("#define TERRAIN3D;");let Ve=Se.concat(Mh.prelude.fragmentSource,x.fragmentSource).join(`
`),tt=Se.concat(Mh.prelude.vertexSource,x.vertexSource).join(`
`),Ne=H.createShader(H.FRAGMENT_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);H.shaderSource(Ne,Ve),H.compileShader(Ne),H.attachShader(this.program,Ne);let Xe=H.createShader(H.VERTEX_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);H.shaderSource(Xe,tt),H.compileShader(Xe),H.attachShader(this.program,Xe),this.attributes={};let st={};this.numAttributes=se.length;for(let nt=0;nt<this.numAttributes;nt++)se[nt]&&(H.bindAttribLocation(this.program,nt,se[nt]),this.attributes[se[nt]]=nt);H.linkProgram(this.program),H.deleteShader(Xe),H.deleteShader(Ne);for(let nt=0;nt<Pe.length;nt++){let ft=Pe[nt];if(ft&&!st[ft]){let At=H.getUniformLocation(this.program,ft);At&&(st[ft]=At)}}this.fixedUniforms=I(h,st),this.terrainUniforms=((nt,ft)=>({u_depth:new n.Uniform1i(nt,ft.u_depth),u_terrain:new n.Uniform1i(nt,ft.u_terrain),u_terrain_dim:new n.Uniform1f(nt,ft.u_terrain_dim),u_terrain_matrix:new n.UniformMatrix4f(nt,ft.u_terrain_matrix),u_terrain_unpack:new n.Uniform4f(nt,ft.u_terrain_unpack),u_terrain_exaggeration:new n.Uniform1f(nt,ft.u_terrain_exaggeration)}))(h,st),this.binderUniforms=S?S.getUniforms(h,st):[]}draw(h,x,S,I,D,$,H,Y,J,se,ce,_e,Ce,Ae,Pe,Se,Ve,tt){let Ne=h.gl;if(this.failedToCreate)return;if(h.program.set(this.program),h.setDepthMode(S),h.setStencilMode(I),h.setColorMode(D),h.setCullFace($),Y){h.activeTexture.set(Ne.TEXTURE2),Ne.bindTexture(Ne.TEXTURE_2D,Y.depthTexture),h.activeTexture.set(Ne.TEXTURE3),Ne.bindTexture(Ne.TEXTURE_2D,Y.texture);for(let st in this.terrainUniforms)this.terrainUniforms[st].set(Y[st])}for(let st in this.fixedUniforms)this.fixedUniforms[st].set(H[st]);Pe&&Pe.setUniforms(h,this.binderUniforms,Ce,{zoom:Ae});let Xe=0;switch(x){case Ne.LINES:Xe=2;break;case Ne.TRIANGLES:Xe=3;break;case Ne.LINE_STRIP:Xe=1}for(let st of _e.get()){let nt=st.vaos||(st.vaos={});(nt[J]||(nt[J]=new w0)).bind(h,this,se,Pe?Pe.getPaintVertexBuffers():[],ce,st.vertexOffset,Se,Ve,tt),Ne.drawElements(x,st.primitiveLength*Xe,Ne.UNSIGNED_SHORT,st.primitiveOffset*Xe*2)}}}function E0(P,h,x){let S=1/Ge(x,1,h.transform.tileZoom),I=Math.pow(2,x.tileID.overscaledZ),D=x.tileSize*Math.pow(2,h.transform.tileZoom)/I,$=D*(x.tileID.canonical.x+x.tileID.wrap*I),H=D*x.tileID.canonical.y;return{u_image:0,u_texsize:x.imageAtlasTexture.size,u_scale:[S,P.fromScale,P.toScale],u_fade:P.t,u_pixel_coord_upper:[$>>16,H>>16],u_pixel_coord_lower:[65535&$,65535&H]}}let Ph=(P,h,x,S)=>{let I=h.style.light,D=I.properties.get("position"),$=[D.x,D.y,D.z],H=function(){var J=new n.ARRAY_TYPE(9);return n.ARRAY_TYPE!=Float32Array&&(J[1]=0,J[2]=0,J[3]=0,J[5]=0,J[6]=0,J[7]=0),J[0]=1,J[4]=1,J[8]=1,J}();I.properties.get("anchor")==="viewport"&&function(J,se){var ce=Math.sin(se),_e=Math.cos(se);J[0]=_e,J[1]=ce,J[2]=0,J[3]=-ce,J[4]=_e,J[5]=0,J[6]=0,J[7]=0,J[8]=1}(H,-h.transform.angle),function(J,se,ce){var _e=se[0],Ce=se[1],Ae=se[2];J[0]=_e*ce[0]+Ce*ce[3]+Ae*ce[6],J[1]=_e*ce[1]+Ce*ce[4]+Ae*ce[7],J[2]=_e*ce[2]+Ce*ce[5]+Ae*ce[8]}($,$,H);let Y=I.properties.get("color");return{u_matrix:P,u_lightpos:$,u_lightintensity:I.properties.get("intensity"),u_lightcolor:[Y.r,Y.g,Y.b],u_vertical_gradient:+x,u_opacity:S}},cv=(P,h,x,S,I,D,$)=>n.extend(Ph(P,h,x,S),E0(D,h,$),{u_height_factor:-Math.pow(2,I.overscaledZ)/$.tileSize/8}),E7=P=>({u_matrix:P}),T0=(P,h,x,S)=>n.extend(E7(P),E0(x,h,S)),uv=(P,h)=>({u_matrix:P,u_world:h}),T7=(P,h,x,S,I)=>n.extend(T0(P,h,x,S),{u_world:I}),hv=(P,h,x,S)=>{let I=P.transform,D,$;if(S.paint.get("circle-pitch-alignment")==="map"){let H=Ge(x,1,I.zoom);D=!0,$=[H,H]}else D=!1,$=I.pixelsToGLUnits;return{u_camera_to_center_distance:I.cameraToCenterDistance,u_scale_with_map:+(S.paint.get("circle-pitch-scale")==="map"),u_matrix:P.translatePosMatrix(h.posMatrix,x,S.paint.get("circle-translate"),S.paint.get("circle-translate-anchor")),u_pitch_with_map:+D,u_device_pixel_ratio:P.pixelRatio,u_extrude_scale:$}},S7=(P,h,x)=>{let S=Ge(x,1,h.zoom),I=Math.pow(2,h.zoom-x.tileID.overscaledZ),D=x.tileID.overscaleFactor();return{u_matrix:P,u_camera_to_center_distance:h.cameraToCenterDistance,u_pixels_to_tile_units:S,u_extrude_scale:[h.pixelsToGLUnits[0]/(S*I),h.pixelsToGLUnits[1]/(S*I)],u_overscale_factor:D}},A7=(P,h,x=1)=>({u_matrix:P,u_color:h,u_overlay:0,u_overlay_scale:x}),S0=P=>({u_matrix:P}),C7=(P,h,x,S)=>({u_matrix:P,u_extrude_scale:Ge(h,1,x),u_intensity:S});function I7(P,h){let x=Math.pow(2,h.canonical.z),S=h.canonical.y;return[new n.MercatorCoordinate(0,S/x).toLngLat().lat,new n.MercatorCoordinate(0,(S+1)/x).toLngLat().lat]}let A0=(P,h,x,S)=>{let I=P.transform;return{u_matrix:Rh(P,h,x,S),u_ratio:1/Ge(h,1,I.zoom),u_device_pixel_ratio:P.pixelRatio,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]]}},k7=(P,h,x,S,I)=>n.extend(A0(P,h,x,I),{u_image:0,u_image_height:S}),ou=(P,h,x,S,I)=>{let D=P.transform,$=Io(h,D);return{u_matrix:Rh(P,h,x,I),u_texsize:h.imageAtlasTexture.size,u_ratio:1/Ge(h,1,D.zoom),u_device_pixel_ratio:P.pixelRatio,u_image:0,u_scale:[$,S.fromScale,S.toScale],u_fade:S.t,u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]]}},C0=(P,h,x,S,I,D)=>{let $=P.lineAtlas,H=Io(h,P.transform),Y=x.layout.get("line-cap")==="round",J=$.getDash(S.from,Y),se=$.getDash(S.to,Y),ce=J.width*I.fromScale,_e=se.width*I.toScale;return n.extend(A0(P,h,x,D),{u_patternscale_a:[H/ce,-J.height/2],u_patternscale_b:[H/_e,-se.height/2],u_sdfgamma:$.width/(256*Math.min(ce,_e)*P.pixelRatio)/2,u_image:0,u_tex_y_a:J.y,u_tex_y_b:se.y,u_mix:I.t})};function Io(P,h){return 1/Ge(P,1,h.tileZoom)}function Rh(P,h,x,S){return P.translatePosMatrix(S?S.posMatrix:h.tileID.posMatrix,h,x.paint.get("line-translate"),x.paint.get("line-translate-anchor"))}let I0=(P,h,x,S,I)=>{return{u_matrix:P,u_tl_parent:h,u_scale_parent:x,u_buffer_scale:1,u_fade_t:S.mix,u_opacity:S.opacity*I.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:I.paint.get("raster-brightness-min"),u_brightness_high:I.paint.get("raster-brightness-max"),u_saturation_factor:($=I.paint.get("raster-saturation"),$>0?1-1/(1.001-$):-$),u_contrast_factor:(D=I.paint.get("raster-contrast"),D>0?1/(1-D):1+D),u_spin_weights:Dh(I.paint.get("raster-hue-rotate"))};var D,$};function Dh(P){P*=Math.PI/180;let h=Math.sin(P),x=Math.cos(P);return[(2*x+1)/3,(-Math.sqrt(3)*h-x+1)/3,(Math.sqrt(3)*h-x+1)/3]}let Fh=(P,h,x,S,I,D,$,H,Y,J)=>{let se=I.transform;return{u_is_size_zoom_constant:+(P==="constant"||P==="source"),u_is_size_feature_constant:+(P==="constant"||P==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:se.cameraToCenterDistance,u_pitch:se.pitch/360*2*Math.PI,u_rotate_symbol:+x,u_aspect_ratio:se.width/se.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_matrix:D,u_label_plane_matrix:$,u_coord_matrix:H,u_is_text:+Y,u_pitch_with_map:+S,u_texsize:J,u_texture:0}},Lh=(P,h,x,S,I,D,$,H,Y,J,se)=>{let ce=I.transform;return n.extend(Fh(P,h,x,S,I,D,$,H,Y,J),{u_gamma_scale:S?Math.cos(ce._pitch)*ce.cameraToCenterDistance:1,u_device_pixel_ratio:I.pixelRatio,u_is_halo:+se})},Nh=(P,h,x,S,I,D,$,H,Y,J)=>n.extend(Lh(P,h,x,S,I,D,$,H,!0,Y,!0),{u_texsize_icon:J,u_texture_icon:1}),au=(P,h,x)=>({u_matrix:P,u_opacity:h,u_color:x}),k0=(P,h,x,S,I,D)=>n.extend(function($,H,Y,J){let se=Y.imageManager.getPattern($.from.toString()),ce=Y.imageManager.getPattern($.to.toString()),{width:_e,height:Ce}=Y.imageManager.getPixelSize(),Ae=Math.pow(2,J.tileID.overscaledZ),Pe=J.tileSize*Math.pow(2,Y.transform.tileZoom)/Ae,Se=Pe*(J.tileID.canonical.x+J.tileID.wrap*Ae),Ve=Pe*J.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:se.tl,u_pattern_br_a:se.br,u_pattern_tl_b:ce.tl,u_pattern_br_b:ce.br,u_texsize:[_e,Ce],u_mix:H.t,u_pattern_size_a:se.displaySize,u_pattern_size_b:ce.displaySize,u_scale_a:H.fromScale,u_scale_b:H.toScale,u_tile_units_to_pixels:1/Ge(J,1,Y.transform.tileZoom),u_pixel_coord_upper:[Se>>16,Ve>>16],u_pixel_coord_lower:[65535&Se,65535&Ve]}}(S,D,x,I),{u_matrix:P,u_opacity:h}),ko={fillExtrusion:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_lightpos:new n.Uniform3f(P,h.u_lightpos),u_lightintensity:new n.Uniform1f(P,h.u_lightintensity),u_lightcolor:new n.Uniform3f(P,h.u_lightcolor),u_vertical_gradient:new n.Uniform1f(P,h.u_vertical_gradient),u_opacity:new n.Uniform1f(P,h.u_opacity)}),fillExtrusionPattern:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_lightpos:new n.Uniform3f(P,h.u_lightpos),u_lightintensity:new n.Uniform1f(P,h.u_lightintensity),u_lightcolor:new n.Uniform3f(P,h.u_lightcolor),u_vertical_gradient:new n.Uniform1f(P,h.u_vertical_gradient),u_height_factor:new n.Uniform1f(P,h.u_height_factor),u_image:new n.Uniform1i(P,h.u_image),u_texsize:new n.Uniform2f(P,h.u_texsize),u_pixel_coord_upper:new n.Uniform2f(P,h.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(P,h.u_pixel_coord_lower),u_scale:new n.Uniform3f(P,h.u_scale),u_fade:new n.Uniform1f(P,h.u_fade),u_opacity:new n.Uniform1f(P,h.u_opacity)}),fill:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix)}),fillPattern:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_image:new n.Uniform1i(P,h.u_image),u_texsize:new n.Uniform2f(P,h.u_texsize),u_pixel_coord_upper:new n.Uniform2f(P,h.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(P,h.u_pixel_coord_lower),u_scale:new n.Uniform3f(P,h.u_scale),u_fade:new n.Uniform1f(P,h.u_fade)}),fillOutline:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_world:new n.Uniform2f(P,h.u_world)}),fillOutlinePattern:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_world:new n.Uniform2f(P,h.u_world),u_image:new n.Uniform1i(P,h.u_image),u_texsize:new n.Uniform2f(P,h.u_texsize),u_pixel_coord_upper:new n.Uniform2f(P,h.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(P,h.u_pixel_coord_lower),u_scale:new n.Uniform3f(P,h.u_scale),u_fade:new n.Uniform1f(P,h.u_fade)}),circle:(P,h)=>({u_camera_to_center_distance:new n.Uniform1f(P,h.u_camera_to_center_distance),u_scale_with_map:new n.Uniform1i(P,h.u_scale_with_map),u_pitch_with_map:new n.Uniform1i(P,h.u_pitch_with_map),u_extrude_scale:new n.Uniform2f(P,h.u_extrude_scale),u_device_pixel_ratio:new n.Uniform1f(P,h.u_device_pixel_ratio),u_matrix:new n.UniformMatrix4f(P,h.u_matrix)}),collisionBox:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_camera_to_center_distance:new n.Uniform1f(P,h.u_camera_to_center_distance),u_pixels_to_tile_units:new n.Uniform1f(P,h.u_pixels_to_tile_units),u_extrude_scale:new n.Uniform2f(P,h.u_extrude_scale),u_overscale_factor:new n.Uniform1f(P,h.u_overscale_factor)}),collisionCircle:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_inv_matrix:new n.UniformMatrix4f(P,h.u_inv_matrix),u_camera_to_center_distance:new n.Uniform1f(P,h.u_camera_to_center_distance),u_viewport_size:new n.Uniform2f(P,h.u_viewport_size)}),debug:(P,h)=>({u_color:new n.UniformColor(P,h.u_color),u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_overlay:new n.Uniform1i(P,h.u_overlay),u_overlay_scale:new n.Uniform1f(P,h.u_overlay_scale)}),clippingMask:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix)}),heatmap:(P,h)=>({u_extrude_scale:new n.Uniform1f(P,h.u_extrude_scale),u_intensity:new n.Uniform1f(P,h.u_intensity),u_matrix:new n.UniformMatrix4f(P,h.u_matrix)}),heatmapTexture:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_world:new n.Uniform2f(P,h.u_world),u_image:new n.Uniform1i(P,h.u_image),u_color_ramp:new n.Uniform1i(P,h.u_color_ramp),u_opacity:new n.Uniform1f(P,h.u_opacity)}),hillshade:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_image:new n.Uniform1i(P,h.u_image),u_latrange:new n.Uniform2f(P,h.u_latrange),u_light:new n.Uniform2f(P,h.u_light),u_shadow:new n.UniformColor(P,h.u_shadow),u_highlight:new n.UniformColor(P,h.u_highlight),u_accent:new n.UniformColor(P,h.u_accent)}),hillshadePrepare:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_image:new n.Uniform1i(P,h.u_image),u_dimension:new n.Uniform2f(P,h.u_dimension),u_zoom:new n.Uniform1f(P,h.u_zoom),u_unpack:new n.Uniform4f(P,h.u_unpack)}),line:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_ratio:new n.Uniform1f(P,h.u_ratio),u_device_pixel_ratio:new n.Uniform1f(P,h.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(P,h.u_units_to_pixels)}),lineGradient:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_ratio:new n.Uniform1f(P,h.u_ratio),u_device_pixel_ratio:new n.Uniform1f(P,h.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(P,h.u_units_to_pixels),u_image:new n.Uniform1i(P,h.u_image),u_image_height:new n.Uniform1f(P,h.u_image_height)}),linePattern:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_texsize:new n.Uniform2f(P,h.u_texsize),u_ratio:new n.Uniform1f(P,h.u_ratio),u_device_pixel_ratio:new n.Uniform1f(P,h.u_device_pixel_ratio),u_image:new n.Uniform1i(P,h.u_image),u_units_to_pixels:new n.Uniform2f(P,h.u_units_to_pixels),u_scale:new n.Uniform3f(P,h.u_scale),u_fade:new n.Uniform1f(P,h.u_fade)}),lineSDF:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_ratio:new n.Uniform1f(P,h.u_ratio),u_device_pixel_ratio:new n.Uniform1f(P,h.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(P,h.u_units_to_pixels),u_patternscale_a:new n.Uniform2f(P,h.u_patternscale_a),u_patternscale_b:new n.Uniform2f(P,h.u_patternscale_b),u_sdfgamma:new n.Uniform1f(P,h.u_sdfgamma),u_image:new n.Uniform1i(P,h.u_image),u_tex_y_a:new n.Uniform1f(P,h.u_tex_y_a),u_tex_y_b:new n.Uniform1f(P,h.u_tex_y_b),u_mix:new n.Uniform1f(P,h.u_mix)}),raster:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_tl_parent:new n.Uniform2f(P,h.u_tl_parent),u_scale_parent:new n.Uniform1f(P,h.u_scale_parent),u_buffer_scale:new n.Uniform1f(P,h.u_buffer_scale),u_fade_t:new n.Uniform1f(P,h.u_fade_t),u_opacity:new n.Uniform1f(P,h.u_opacity),u_image0:new n.Uniform1i(P,h.u_image0),u_image1:new n.Uniform1i(P,h.u_image1),u_brightness_low:new n.Uniform1f(P,h.u_brightness_low),u_brightness_high:new n.Uniform1f(P,h.u_brightness_high),u_saturation_factor:new n.Uniform1f(P,h.u_saturation_factor),u_contrast_factor:new n.Uniform1f(P,h.u_contrast_factor),u_spin_weights:new n.Uniform3f(P,h.u_spin_weights)}),symbolIcon:(P,h)=>({u_is_size_zoom_constant:new n.Uniform1i(P,h.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(P,h.u_is_size_feature_constant),u_size_t:new n.Uniform1f(P,h.u_size_t),u_size:new n.Uniform1f(P,h.u_size),u_camera_to_center_distance:new n.Uniform1f(P,h.u_camera_to_center_distance),u_pitch:new n.Uniform1f(P,h.u_pitch),u_rotate_symbol:new n.Uniform1i(P,h.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(P,h.u_aspect_ratio),u_fade_change:new n.Uniform1f(P,h.u_fade_change),u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(P,h.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(P,h.u_coord_matrix),u_is_text:new n.Uniform1i(P,h.u_is_text),u_pitch_with_map:new n.Uniform1i(P,h.u_pitch_with_map),u_texsize:new n.Uniform2f(P,h.u_texsize),u_texture:new n.Uniform1i(P,h.u_texture)}),symbolSDF:(P,h)=>({u_is_size_zoom_constant:new n.Uniform1i(P,h.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(P,h.u_is_size_feature_constant),u_size_t:new n.Uniform1f(P,h.u_size_t),u_size:new n.Uniform1f(P,h.u_size),u_camera_to_center_distance:new n.Uniform1f(P,h.u_camera_to_center_distance),u_pitch:new n.Uniform1f(P,h.u_pitch),u_rotate_symbol:new n.Uniform1i(P,h.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(P,h.u_aspect_ratio),u_fade_change:new n.Uniform1f(P,h.u_fade_change),u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(P,h.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(P,h.u_coord_matrix),u_is_text:new n.Uniform1i(P,h.u_is_text),u_pitch_with_map:new n.Uniform1i(P,h.u_pitch_with_map),u_texsize:new n.Uniform2f(P,h.u_texsize),u_texture:new n.Uniform1i(P,h.u_texture),u_gamma_scale:new n.Uniform1f(P,h.u_gamma_scale),u_device_pixel_ratio:new n.Uniform1f(P,h.u_device_pixel_ratio),u_is_halo:new n.Uniform1i(P,h.u_is_halo)}),symbolTextAndIcon:(P,h)=>({u_is_size_zoom_constant:new n.Uniform1i(P,h.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(P,h.u_is_size_feature_constant),u_size_t:new n.Uniform1f(P,h.u_size_t),u_size:new n.Uniform1f(P,h.u_size),u_camera_to_center_distance:new n.Uniform1f(P,h.u_camera_to_center_distance),u_pitch:new n.Uniform1f(P,h.u_pitch),u_rotate_symbol:new n.Uniform1i(P,h.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(P,h.u_aspect_ratio),u_fade_change:new n.Uniform1f(P,h.u_fade_change),u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(P,h.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(P,h.u_coord_matrix),u_is_text:new n.Uniform1i(P,h.u_is_text),u_pitch_with_map:new n.Uniform1i(P,h.u_pitch_with_map),u_texsize:new n.Uniform2f(P,h.u_texsize),u_texsize_icon:new n.Uniform2f(P,h.u_texsize_icon),u_texture:new n.Uniform1i(P,h.u_texture),u_texture_icon:new n.Uniform1i(P,h.u_texture_icon),u_gamma_scale:new n.Uniform1f(P,h.u_gamma_scale),u_device_pixel_ratio:new n.Uniform1f(P,h.u_device_pixel_ratio),u_is_halo:new n.Uniform1i(P,h.u_is_halo)}),background:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_opacity:new n.Uniform1f(P,h.u_opacity),u_color:new n.UniformColor(P,h.u_color)}),backgroundPattern:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_opacity:new n.Uniform1f(P,h.u_opacity),u_image:new n.Uniform1i(P,h.u_image),u_pattern_tl_a:new n.Uniform2f(P,h.u_pattern_tl_a),u_pattern_br_a:new n.Uniform2f(P,h.u_pattern_br_a),u_pattern_tl_b:new n.Uniform2f(P,h.u_pattern_tl_b),u_pattern_br_b:new n.Uniform2f(P,h.u_pattern_br_b),u_texsize:new n.Uniform2f(P,h.u_texsize),u_mix:new n.Uniform1f(P,h.u_mix),u_pattern_size_a:new n.Uniform2f(P,h.u_pattern_size_a),u_pattern_size_b:new n.Uniform2f(P,h.u_pattern_size_b),u_scale_a:new n.Uniform1f(P,h.u_scale_a),u_scale_b:new n.Uniform1f(P,h.u_scale_b),u_pixel_coord_upper:new n.Uniform2f(P,h.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(P,h.u_pixel_coord_lower),u_tile_units_to_pixels:new n.Uniform1f(P,h.u_tile_units_to_pixels)}),terrain:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_texture:new n.Uniform1i(P,h.u_texture),u_ele_delta:new n.Uniform1f(P,h.u_ele_delta)}),terrainDepth:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_ele_delta:new n.Uniform1f(P,h.u_ele_delta)}),terrainCoords:(P,h)=>({u_matrix:new n.UniformMatrix4f(P,h.u_matrix),u_texture:new n.Uniform1i(P,h.u_texture),u_terrain_coords_id:new n.Uniform1f(P,h.u_terrain_coords_id),u_ele_delta:new n.Uniform1f(P,h.u_ele_delta)})};class Mo{constructor(h,x,S){this.context=h;let I=h.gl;this.buffer=I.createBuffer(),this.dynamicDraw=!!S,this.context.unbindVAO(),h.bindElementBuffer.set(this.buffer),I.bufferData(I.ELEMENT_ARRAY_BUFFER,x.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||delete x.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(h){let x=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),x.bufferSubData(x.ELEMENT_ARRAY_BUFFER,0,h.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let yp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class M0{constructor(h,x,S,I){this.length=x.length,this.attributes=S,this.itemSize=x.bytesPerElement,this.dynamicDraw=I,this.context=h;let D=h.gl;this.buffer=D.createBuffer(),h.bindVertexBuffer.set(this.buffer),D.bufferData(D.ARRAY_BUFFER,x.arrayBuffer,this.dynamicDraw?D.DYNAMIC_DRAW:D.STATIC_DRAW),this.dynamicDraw||delete x.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(h){if(h.length!==this.length)throw new Error(`Length of new data is ${h.length}, which doesn't match current length of ${this.length}`);let x=this.context.gl;this.bind(),x.bufferSubData(x.ARRAY_BUFFER,0,h.arrayBuffer)}enableAttributes(h,x){for(let S=0;S<this.attributes.length;S++){let I=x.attributes[this.attributes[S].name];I!==void 0&&h.enableVertexAttribArray(I)}}setVertexAttribPointers(h,x,S){for(let I=0;I<this.attributes.length;I++){let D=this.attributes[I],$=x.attributes[D.name];$!==void 0&&h.vertexAttribPointer($,D.components,h[yp[D.type]],!1,this.itemSize,D.offset+this.itemSize*(S||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let p1=new WeakMap;function m1(P){if(p1.has(P))return p1.get(P);{let h=P.getParameter(P.VERSION).startsWith("WebGL 2.0");return p1.set(P,h),h}}class Sr{constructor(h){this.gl=h.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(h){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class P0 extends Sr{getDefault(){return n.Color.transparent}set(h){let x=this.current;(h.r!==x.r||h.g!==x.g||h.b!==x.b||h.a!==x.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)}}class _p extends Sr{getDefault(){return 1}set(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)}}class xp extends Sr{getDefault(){return 0}set(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)}}class R0 extends Sr{getDefault(){return[!0,!0,!0,!0]}set(h){let x=this.current;(h[0]!==x[0]||h[1]!==x[1]||h[2]!==x[2]||h[3]!==x[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)}}class M7 extends Sr{getDefault(){return!0}set(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)}}class P7 extends Sr{getDefault(){return 255}set(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)}}class g1 extends Sr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(h){let x=this.current;(h.func!==x.func||h.ref!==x.ref||h.mask!==x.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)}}class dv extends Sr{getDefault(){let h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]}set(h){let x=this.current;(h[0]!==x[0]||h[1]!==x[1]||h[2]!==x[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)}}class fv extends Sr{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;h?x.enable(x.STENCIL_TEST):x.disable(x.STENCIL_TEST),this.current=h,this.dirty=!1}}class pv extends Sr{getDefault(){return[0,1]}set(h){let x=this.current;(h[0]!==x[0]||h[1]!==x[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)}}class mv extends Sr{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;h?x.enable(x.DEPTH_TEST):x.disable(x.DEPTH_TEST),this.current=h,this.dirty=!1}}class gv extends Sr{getDefault(){return this.gl.LESS}set(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)}}class yv extends Sr{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;h?x.enable(x.BLEND):x.disable(x.BLEND),this.current=h,this.dirty=!1}}class vp extends Sr{getDefault(){let h=this.gl;return[h.ONE,h.ZERO]}set(h){let x=this.current;(h[0]!==x[0]||h[1]!==x[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)}}class D0 extends Sr{getDefault(){return n.Color.transparent}set(h){let x=this.current;(h.r!==x.r||h.g!==x.g||h.b!==x.b||h.a!==x.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)}}class bp extends Sr{getDefault(){return this.gl.FUNC_ADD}set(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)}}class wp extends Sr{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;h?x.enable(x.CULL_FACE):x.disable(x.CULL_FACE),this.current=h,this.dirty=!1}}class y1 extends Sr{getDefault(){return this.gl.BACK}set(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)}}class R7 extends Sr{getDefault(){return this.gl.CCW}set(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)}}class D7 extends Sr{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}}class Ep extends Sr{getDefault(){return this.gl.TEXTURE0}set(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)}}class lu extends Sr{getDefault(){let h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]}set(h){let x=this.current;(h[0]!==x[0]||h[1]!==x[1]||h[2]!==x[2]||h[3]!==x[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)}}class F7 extends Sr{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;x.bindFramebuffer(x.FRAMEBUFFER,h),this.current=h,this.dirty=!1}}class _1 extends Sr{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;x.bindRenderbuffer(x.RENDERBUFFER,h),this.current=h,this.dirty=!1}}class x1 extends Sr{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;x.bindTexture(x.TEXTURE_2D,h),this.current=h,this.dirty=!1}}class L7 extends Sr{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;x.bindBuffer(x.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}}class Tp extends Sr{getDefault(){return null}set(h){let x=this.gl;x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1}}class Pr extends Sr{getDefault(){return null}set(h){var x;if(h===this.current&&!this.dirty)return;let S=this.gl;m1(S)?S.bindVertexArray(h):(x=S.getExtension("OES_vertex_array_object"))===null||x===void 0||x.bindVertexArrayOES(h),this.current=h,this.dirty=!1}}class F0 extends Sr{getDefault(){return 4}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;x.pixelStorei(x.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}}class _v extends Sr{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}}class N7 extends Sr{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let x=this.gl;x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}}class cu extends Sr{constructor(h,x){super(h),this.context=h,this.parent=x}getDefault(){return null}}class xv extends cu{setDirty(){this.dirty=!0}set(h){if(h===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let x=this.gl;x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}}class vv extends cu{set(h){if(h===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let x=this.gl;x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_ATTACHMENT,x.RENDERBUFFER,h),this.current=h,this.dirty=!1}}class O7 extends cu{set(h){if(h===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let x=this.gl;x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_STENCIL_ATTACHMENT,x.RENDERBUFFER,h),this.current=h,this.dirty=!1}}class bv{constructor(h,x,S,I,D){this.context=h,this.width=x,this.height=S;let $=h.gl,H=this.framebuffer=$.createFramebuffer();if(this.colorAttachment=new xv(h,H),I)this.depthAttachment=D?new O7(h,H):new vv(h,H);else if(D)throw new Error("Stencil cannot be setted without depth");if($.checkFramebufferStatus($.FRAMEBUFFER)!==$.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){let h=this.context.gl,x=this.colorAttachment.get();if(x&&h.deleteTexture(x),this.depthAttachment){let S=this.depthAttachment.get();S&&h.deleteRenderbuffer(S)}h.deleteFramebuffer(this.framebuffer)}}class _s{constructor(h,x,S){this.blendFunction=h,this.blendColor=x,this.mask=S}}_s.Replace=[1,0],_s.disabled=new _s(_s.Replace,n.Color.transparent,[!1,!1,!1,!1]),_s.unblended=new _s(_s.Replace,n.Color.transparent,[!0,!0,!0,!0]),_s.alphaBlended=new _s([1,771],n.Color.transparent,[!0,!0,!0,!0]);class L0{constructor(h){var x,S;if(this.gl=h,this.clearColor=new P0(this),this.clearDepth=new _p(this),this.clearStencil=new xp(this),this.colorMask=new R0(this),this.depthMask=new M7(this),this.stencilMask=new P7(this),this.stencilFunc=new g1(this),this.stencilOp=new dv(this),this.stencilTest=new fv(this),this.depthRange=new pv(this),this.depthTest=new mv(this),this.depthFunc=new gv(this),this.blend=new yv(this),this.blendFunc=new vp(this),this.blendColor=new D0(this),this.blendEquation=new bp(this),this.cullFace=new wp(this),this.cullFaceSide=new y1(this),this.frontFace=new R7(this),this.program=new D7(this),this.activeTexture=new Ep(this),this.viewport=new lu(this),this.bindFramebuffer=new F7(this),this.bindRenderbuffer=new _1(this),this.bindTexture=new x1(this),this.bindVertexBuffer=new L7(this),this.bindElementBuffer=new Tp(this),this.bindVertexArray=new Pr(this),this.pixelStoreUnpack=new F0(this),this.pixelStoreUnpackPremultiplyAlpha=new _v(this),this.pixelStoreUnpackFlipY=new N7(this),this.extTextureFilterAnisotropic=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=h.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE),m1(h)){this.HALF_FLOAT=h.HALF_FLOAT;let I=h.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(x=h.RGBA16F)!==null&&x!==void 0?x:I==null?void 0:I.RGBA16F_EXT,this.RGB16F=(S=h.RGB16F)!==null&&S!==void 0?S:I==null?void 0:I.RGB16F_EXT,h.getExtension("EXT_color_buffer_float")}else{h.getExtension("EXT_color_buffer_half_float"),h.getExtension("OES_texture_half_float_linear");let I=h.getExtension("OES_texture_half_float");this.HALF_FLOAT=I==null?void 0:I.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(h,x){return new Mo(this,h,x)}createVertexBuffer(h,x,S){return new M0(this,h,x,S)}createRenderbuffer(h,x,S){let I=this.gl,D=I.createRenderbuffer();return this.bindRenderbuffer.set(D),I.renderbufferStorage(I.RENDERBUFFER,h,x,S),this.bindRenderbuffer.set(null),D}createFramebuffer(h,x,S,I){return new bv(this,h,x,S,I)}clear({color:h,depth:x,stencil:S}){let I=this.gl,D=0;h&&(D|=I.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),x!==void 0&&(D|=I.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(x),this.depthMask.set(!0)),S!==void 0&&(D|=I.STENCIL_BUFFER_BIT,this.clearStencil.set(S),this.stencilMask.set(255)),I.clear(D)}setCullFace(h){h.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(h.mode),this.frontFace.set(h.frontFace))}setDepthMode(h){h.func!==this.gl.ALWAYS||h.mask?(this.depthTest.set(!0),this.depthFunc.set(h.func),this.depthMask.set(h.mask),this.depthRange.set(h.range)):this.depthTest.set(!1)}setStencilMode(h){h.test.func!==this.gl.ALWAYS||h.mask?(this.stencilTest.set(!0),this.stencilMask.set(h.mask),this.stencilOp.set([h.fail,h.depthFail,h.pass]),this.stencilFunc.set({func:h.test.func,ref:h.ref,mask:h.test.mask})):this.stencilTest.set(!1)}setColorMode(h){n.deepEqual(h.blendFunction,_s.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(h.blendFunction),this.blendColor.set(h.blendColor)),this.colorMask.set(h.mask)}createVertexArray(){var h;return m1(this.gl)?this.gl.createVertexArray():(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.createVertexArrayOES()}deleteVertexArray(h){var x;return m1(this.gl)?this.gl.deleteVertexArray(h):(x=this.gl.getExtension("OES_vertex_array_object"))===null||x===void 0?void 0:x.deleteVertexArrayOES(h)}unbindVAO(){this.bindVertexArray.set(null)}}class hr{constructor(h,x,S){this.func=h,this.mask=x,this.range=S}}hr.ReadOnly=!1,hr.ReadWrite=!0,hr.disabled=new hr(519,hr.ReadOnly,[0,1]);let Oh=7680;class Jr{constructor(h,x,S,I,D,$){this.test=h,this.ref=x,this.mask=S,this.fail=I,this.depthFail=D,this.pass=$}}Jr.disabled=new Jr({func:519,mask:0},0,0,Oh,Oh,Oh);class es{constructor(h,x,S){this.enable=h,this.mode=x,this.frontFace=S}}let uu;function Bh(P,h,x,S,I,D,$){let H=P.context,Y=H.gl,J=P.useProgram("collisionBox"),se=[],ce=0,_e=0;for(let Ne=0;Ne<S.length;Ne++){let Xe=S[Ne],st=h.getTile(Xe),nt=st.getBucket(x);if(!nt)continue;let ft=Xe.posMatrix;I[0]===0&&I[1]===0||(ft=P.translatePosMatrix(Xe.posMatrix,st,I,D));let At=$?nt.textCollisionBox:nt.iconCollisionBox,vt=nt.collisionCircleArray;if(vt.length>0){let Mt=n.create(),li=ft;n.mul(Mt,nt.placementInvProjMatrix,P.transform.glCoordMatrix),n.mul(Mt,Mt,nt.placementViewportMatrix),se.push({circleArray:vt,circleOffset:_e,transform:li,invTransform:Mt,coord:Xe}),ce+=vt.length/4,_e=ce}At&&J.draw(H,Y.LINES,hr.disabled,Jr.disabled,P.colorModeForRenderPass(),es.disabled,S7(ft,P.transform,st),P.style.map.terrain&&P.style.map.terrain.getTerrainData(Xe),x.id,At.layoutVertexBuffer,At.indexBuffer,At.segments,null,P.transform.zoom,null,null,At.collisionVertexBuffer)}if(!$||!se.length)return;let Ce=P.useProgram("collisionCircle"),Ae=new n.CollisionCircleLayoutArray;Ae.resize(4*ce),Ae._trim();let Pe=0;for(let Ne of se)for(let Xe=0;Xe<Ne.circleArray.length/4;Xe++){let st=4*Xe,nt=Ne.circleArray[st+0],ft=Ne.circleArray[st+1],At=Ne.circleArray[st+2],vt=Ne.circleArray[st+3];Ae.emplace(Pe++,nt,ft,At,vt,0),Ae.emplace(Pe++,nt,ft,At,vt,1),Ae.emplace(Pe++,nt,ft,At,vt,2),Ae.emplace(Pe++,nt,ft,At,vt,3)}(!uu||uu.length<2*ce)&&(uu=function(Ne){let Xe=2*Ne,st=new n.QuadTriangleArray;st.resize(Xe),st._trim();for(let nt=0;nt<Xe;nt++){let ft=6*nt;st.uint16[ft+0]=4*nt+0,st.uint16[ft+1]=4*nt+1,st.uint16[ft+2]=4*nt+2,st.uint16[ft+3]=4*nt+2,st.uint16[ft+4]=4*nt+3,st.uint16[ft+5]=4*nt+0}return st}(ce));let Se=H.createIndexBuffer(uu,!0),Ve=H.createVertexBuffer(Ae,n.collisionCircleLayout.members,!0);for(let Ne of se){let Xe={u_matrix:Ne.transform,u_inv_matrix:Ne.invTransform,u_camera_to_center_distance:(tt=P.transform).cameraToCenterDistance,u_viewport_size:[tt.width,tt.height]};Ce.draw(H,Y.TRIANGLES,hr.disabled,Jr.disabled,P.colorModeForRenderPass(),es.disabled,Xe,P.style.map.terrain&&P.style.map.terrain.getTerrainData(Ne.coord),x.id,Ve,Se,n.SegmentVector.simpleSegment(0,2*Ne.circleOffset,Ne.circleArray.length,Ne.circleArray.length/2),null,P.transform.zoom,null,null,null)}var tt;Ve.destroy(),Se.destroy()}es.disabled=new es(!1,1029,2305),es.backCCW=new es(!0,1029,2305);let Sp=n.identity(new Float32Array(16));function wv(P,h,x,S,I,D){let{horizontalAlign:$,verticalAlign:H}=n.getAnchorAlignment(P);return new n.Point((-($-.5)*h/I+S[0])*D,(-(H-.5)*x/I+S[1])*D)}function Ap(P,h,x,S,I,D,$,H,Y,J,se){let ce=P.text.placedSymbolArray,_e=P.text.dynamicLayoutVertexArray,Ce=P.icon.dynamicLayoutVertexArray,Ae={};_e.clear();for(let Pe=0;Pe<ce.length;Pe++){let Se=ce.get(Pe),Ve=Se.hidden||!Se.crossTileID||P.allowVerticalPlacement&&!Se.placedOrientation?null:S[Se.crossTileID];if(Ve){let tt=new n.Point(Se.anchorX,Se.anchorY),Ne=Ke(tt,x?$:D,se),Xe=dt(I.cameraToCenterDistance,Ne.signedDistanceFromCamera),st=n.evaluateSizeForFeature(P.textSizeData,Y,Se)*Xe/n.ONE_EM;x&&(st*=P.tilePixelRatio/H);let{width:nt,height:ft,anchor:At,textOffset:vt,textBoxScale:Mt}=Ve,li=wv(At,nt,ft,vt,Mt,st),dr=x?Ke(tt.add(li),D,se).point:Ne.point.add(h?li.rotate(-I.angle):li),Ut=P.allowVerticalPlacement&&Se.placedOrientation===n.WritingMode.vertical?Math.PI/2:0;for(let Ii=0;Ii<Se.numGlyphs;Ii++)n.addDynamicAttributes(_e,dr,Ut);J&&Se.associatedIconIndex>=0&&(Ae[Se.associatedIconIndex]={shiftedAnchor:dr,angle:Ut})}else Ee(Se.numGlyphs,_e)}if(J){Ce.clear();let Pe=P.icon.placedSymbolArray;for(let Se=0;Se<Pe.length;Se++){let Ve=Pe.get(Se);if(Ve.hidden)Ee(Ve.numGlyphs,Ce);else{let tt=Ae[Se];if(tt)for(let Ne=0;Ne<Ve.numGlyphs;Ne++)n.addDynamicAttributes(Ce,tt.shiftedAnchor,tt.angle);else Ee(Ve.numGlyphs,Ce)}}P.icon.dynamicLayoutVertexBuffer.updateData(Ce)}P.text.dynamicLayoutVertexBuffer.updateData(_e)}function Ev(P,h,x){return x.iconsInText&&h?"symbolTextAndIcon":P?"symbolSDF":"symbolIcon"}function Cp(P,h,x,S,I,D,$,H,Y,J,se,ce){let _e=P.context,Ce=_e.gl,Ae=P.transform,Pe=H==="map",Se=Y==="map",Ve=H!=="viewport"&&x.layout.get("symbol-placement")!=="point",tt=Pe&&!Se&&!Ve,Ne=!x.layout.get("symbol-sort-key").isConstant(),Xe=!1,st=P.depthModeForSublayer(0,hr.ReadOnly),nt=x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ft=[];for(let At of S){let vt=h.getTile(At),Mt=vt.getBucket(x);if(!Mt)continue;let li=I?Mt.text:Mt.icon;if(!li||!li.segments.get().length||!li.hasVisibleVertices)continue;let dr=li.programConfigurations.get(x.id),Ut=I||Mt.sdfIcons,Ii=I?Mt.textSizeData:Mt.iconSizeData,Jt=Se||Ae.pitch!==0,Yr=P.useProgram(Ev(Ut,I,Mt),dr),cr=n.evaluateSizeForZoom(Ii,Ae.zoom),ir=P.style.map.terrain&&P.style.map.terrain.getTerrainData(At),Pi,As,Lr,Qn,xn=[0,0],Os=null;if(I)As=vt.glyphAtlasTexture,Lr=Ce.LINEAR,Pi=vt.glyphAtlasTexture.size,Mt.iconsInText&&(xn=vt.imageAtlasTexture.size,Os=vt.imageAtlasTexture,Qn=Jt||P.options.rotating||P.options.zooming||Ii.kind==="composite"||Ii.kind==="camera"?Ce.LINEAR:Ce.NEAREST);else{let qs=x.layout.get("icon-size").constantOr(0)!==1||Mt.iconsNeedLinear;As=vt.imageAtlasTexture,Lr=Ut||P.options.rotating||P.options.zooming||qs||Jt?Ce.LINEAR:Ce.NEAREST,Pi=vt.imageAtlasTexture.size}let ho=Ge(vt,1,P.transform.zoom),Da=qi(At.posMatrix,Se,Pe,P.transform,ho),zl=Vi(At.posMatrix,Se,Pe,P.transform,ho),Gl=nt&&Mt.hasTextData(),Tc=x.layout.get("icon-text-fit")!=="none"&&Gl&&Mt.hasIconData();if(Ve){let qs=P.style.map.terrain?(fo,vs)=>P.style.map.terrain.getElevation(At,fo,vs):null,wn=x.layout.get("text-rotation-alignment")==="map";Zt(Mt,At.posMatrix,P,I,Da,zl,Se,J,wn,qs)}let _u=P.translatePosMatrix(At.posMatrix,vt,D,$),Sc=Ve||I&&nt||Tc?Sp:Da,vn=P.translatePosMatrix(zl,vt,D,$,!0),Cs=Ut&&x.paint.get(I?"text-halo-width":"icon-halo-width").constantOr(1)!==0,bn;bn=Ut?Mt.iconsInText?Nh(Ii.kind,cr,tt,Se,P,_u,Sc,vn,Pi,xn):Lh(Ii.kind,cr,tt,Se,P,_u,Sc,vn,I,Pi,!0):Fh(Ii.kind,cr,tt,Se,P,_u,Sc,vn,I,Pi);let S1={program:Yr,buffers:li,uniformValues:bn,atlasTexture:As,atlasTextureIcon:Os,atlasInterpolation:Lr,atlasInterpolationIcon:Qn,isSDF:Ut,hasHalo:Cs};if(Ne&&Mt.canOverlap){Xe=!0;let qs=li.segments.get();for(let wn of qs)ft.push({segments:new n.SegmentVector([wn]),sortKey:wn.sortKey,state:S1,terrainData:ir})}else ft.push({segments:li.segments,sortKey:0,state:S1,terrainData:ir})}Xe&&ft.sort((At,vt)=>At.sortKey-vt.sortKey);for(let At of ft){let vt=At.state;if(_e.activeTexture.set(Ce.TEXTURE0),vt.atlasTexture.bind(vt.atlasInterpolation,Ce.CLAMP_TO_EDGE),vt.atlasTextureIcon&&(_e.activeTexture.set(Ce.TEXTURE1),vt.atlasTextureIcon&&vt.atlasTextureIcon.bind(vt.atlasInterpolationIcon,Ce.CLAMP_TO_EDGE)),vt.isSDF){let Mt=vt.uniformValues;vt.hasHalo&&(Mt.u_is_halo=1,Uh(vt.buffers,At.segments,x,P,vt.program,st,se,ce,Mt,At.terrainData)),Mt.u_is_halo=0}Uh(vt.buffers,At.segments,x,P,vt.program,st,se,ce,vt.uniformValues,At.terrainData)}}function Uh(P,h,x,S,I,D,$,H,Y,J){let se=S.context;I.draw(se,se.gl.TRIANGLES,D,$,H,es.disabled,Y,J,x.id,P.layoutVertexBuffer,P.indexBuffer,h,x.paint,S.transform.zoom,P.programConfigurations.get(x.id),P.dynamicLayoutVertexBuffer,P.opacityVertexBuffer)}function N0(P,h,x,S,I){if(!x||!S||!S.imageAtlas)return;let D=S.imageAtlas.patternPositions,$=D[x.to.toString()],H=D[x.from.toString()];if(!$||!H){let Y=I.getPaintProperty(h);$=D[Y],H=D[Y]}$&&H&&P.setConstantPatternPositions($,H)}function Ip(P,h,x,S,I,D,$){let H=P.context.gl,Y="fill-pattern",J=x.paint.get(Y),se=J&&J.constantOr(1),ce=x.getCrossfadeParameters(),_e,Ce,Ae,Pe,Se;$?(Ce=se&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",_e=H.LINES):(Ce=se?"fillPattern":"fill",_e=H.TRIANGLES);let Ve=J.constantOr(null);for(let tt of S){let Ne=h.getTile(tt);if(se&&!Ne.patternsLoaded())continue;let Xe=Ne.getBucket(x);if(!Xe)continue;let st=Xe.programConfigurations.get(x.id),nt=P.useProgram(Ce,st),ft=P.style.map.terrain&&P.style.map.terrain.getTerrainData(tt);se&&(P.context.activeTexture.set(H.TEXTURE0),Ne.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),st.updatePaintBuffers(ce)),N0(st,Y,Ve,Ne,x);let At=ft?tt:null,vt=P.translatePosMatrix(At?At.posMatrix:tt.posMatrix,Ne,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));if($){Pe=Xe.indexBuffer2,Se=Xe.segments2;let Mt=[H.drawingBufferWidth,H.drawingBufferHeight];Ae=Ce==="fillOutlinePattern"&&se?T7(vt,P,ce,Ne,Mt):uv(vt,Mt)}else Pe=Xe.indexBuffer,Se=Xe.segments,Ae=se?T0(vt,P,ce,Ne):E7(vt);nt.draw(P.context,_e,I,P.stencilModeForClipping(tt),D,es.disabled,Ae,ft,x.id,Xe.layoutVertexBuffer,Pe,Se,x.paint,P.transform.zoom,st)}}function O0(P,h,x,S,I,D,$){let H=P.context,Y=H.gl,J="fill-extrusion-pattern",se=x.paint.get(J),ce=se.constantOr(1),_e=x.getCrossfadeParameters(),Ce=x.paint.get("fill-extrusion-opacity"),Ae=se.constantOr(null);for(let Pe of S){let Se=h.getTile(Pe),Ve=Se.getBucket(x);if(!Ve)continue;let tt=P.style.map.terrain&&P.style.map.terrain.getTerrainData(Pe),Ne=Ve.programConfigurations.get(x.id),Xe=P.useProgram(ce?"fillExtrusionPattern":"fillExtrusion",Ne);ce&&(P.context.activeTexture.set(Y.TEXTURE0),Se.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),Ne.updatePaintBuffers(_e)),N0(Ne,J,Ae,Se,x);let st=P.translatePosMatrix(Pe.posMatrix,Se,x.paint.get("fill-extrusion-translate"),x.paint.get("fill-extrusion-translate-anchor")),nt=x.paint.get("fill-extrusion-vertical-gradient"),ft=ce?cv(st,P,nt,Ce,Pe,_e,Se):Ph(st,P,nt,Ce);Xe.draw(H,H.gl.TRIANGLES,I,D,$,es.backCCW,ft,tt,x.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,x.paint,P.transform.zoom,Ne,P.style.map.terrain&&Ve.centroidVertexBuffer)}}function B0(P,h,x,S,I,D,$){let H=P.context,Y=H.gl,J=x.fbo;if(!J)return;let se=P.useProgram("hillshade"),ce=P.style.map.terrain&&P.style.map.terrain.getTerrainData(h);H.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,J.colorAttachment.get()),se.draw(H,Y.TRIANGLES,I,D,$,es.disabled,((_e,Ce,Ae,Pe)=>{let Se=Ae.paint.get("hillshade-shadow-color"),Ve=Ae.paint.get("hillshade-highlight-color"),tt=Ae.paint.get("hillshade-accent-color"),Ne=Ae.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ae.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ne-=_e.transform.angle);let Xe=!_e.options.moving;return{u_matrix:Pe?Pe.posMatrix:_e.transform.calculatePosMatrix(Ce.tileID.toUnwrapped(),Xe),u_image:0,u_latrange:I7(0,Ce.tileID),u_light:[Ae.paint.get("hillshade-exaggeration"),Ne],u_shadow:Se,u_highlight:Ve,u_accent:tt}})(P,x,S,ce?h:null),ce,S.id,P.rasterBoundsBuffer,P.quadTriangleIndexBuffer,P.rasterBoundsSegments)}function kp(P,h,x,S,I,D){let $=P.context,H=$.gl,Y=h.dem;if(Y&&Y.data){let J=Y.dim,se=Y.stride,ce=Y.getPixels();if($.activeTexture.set(H.TEXTURE1),$.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||P.getTileTexture(se),h.demTexture){let Ce=h.demTexture;Ce.update(ce,{premultiply:!1}),Ce.bind(H.NEAREST,H.CLAMP_TO_EDGE)}else h.demTexture=new U($,ce,H.RGBA,{premultiply:!1}),h.demTexture.bind(H.NEAREST,H.CLAMP_TO_EDGE);$.activeTexture.set(H.TEXTURE0);let _e=h.fbo;if(!_e){let Ce=new U($,{width:J,height:J,data:null},H.RGBA);Ce.bind(H.LINEAR,H.CLAMP_TO_EDGE),_e=h.fbo=$.createFramebuffer(J,J,!0,!1),_e.colorAttachment.set(Ce.texture)}$.bindFramebuffer.set(_e.framebuffer),$.viewport.set([0,0,J,J]),P.useProgram("hillshadePrepare").draw($,H.TRIANGLES,S,I,D,es.disabled,((Ce,Ae)=>{let Pe=Ae.stride,Se=n.create();return n.ortho(Se,0,n.EXTENT,-n.EXTENT,0,0,1),n.translate(Se,Se,[0,-n.EXTENT,0]),{u_matrix:Se,u_image:1,u_dimension:[Pe,Pe],u_zoom:Ce.overscaledZ,u_unpack:Ae.getUnpackVector()}})(h.tileID,Y),null,x.id,P.rasterBoundsBuffer,P.quadTriangleIndexBuffer,P.rasterBoundsSegments),h.needsHillshadePrepare=!1}}function Tv(P,h,x,S,I,D){let $=S.paint.get("raster-fade-duration");if(!D&&$>0){let H=n.browser.now(),Y=(H-P.timeAdded)/$,J=h?(H-h.timeAdded)/$:-1,se=x.getSource(),ce=I.coveringZoomLevel({tileSize:se.tileSize,roundZoom:se.roundZoom}),_e=!h||Math.abs(h.tileID.overscaledZ-ce)>Math.abs(P.tileID.overscaledZ-ce),Ce=_e&&P.refreshedUponExpiration?1:n.clamp(_e?Y:1-J,0,1);return P.refreshedUponExpiration&&Y>=1&&(P.refreshedUponExpiration=!1),h?{opacity:1,mix:1-Ce}:{opacity:Ce,mix:0}}return{opacity:1,mix:0}}let B7=new n.Color(1,0,0,1),Fs=new n.Color(0,1,0,1),hu=new n.Color(0,0,1,1),ca=new n.Color(1,0,1,1),Mp=new n.Color(0,1,1,1);function U0(P,h,x,S){Nl(P,0,h+x/2,P.transform.width,x,S)}function Pp(P,h,x,S){Nl(P,h-x/2,0,x,P.transform.height,S)}function Nl(P,h,x,S,I,D){let $=P.context,H=$.gl;H.enable(H.SCISSOR_TEST),H.scissor(h*P.pixelRatio,x*P.pixelRatio,S*P.pixelRatio,I*P.pixelRatio),$.clear({color:D}),H.disable(H.SCISSOR_TEST)}function zh(P,h,x){let S=P.context,I=S.gl,D=x.posMatrix,$=P.useProgram("debug"),H=hr.disabled,Y=Jr.disabled,J=P.colorModeForRenderPass(),se="$debug",ce=P.style.map.terrain&&P.style.map.terrain.getTerrainData(x);S.activeTexture.set(I.TEXTURE0);let _e=h.getTileByID(x.key).latestRawTileData,Ce=Math.floor((_e&&_e.byteLength||0)/1024),Ae=h.getTile(x).tileSize,Pe=512/Math.min(Ae,512)*(x.overscaledZ/P.transform.zoom)*.5,Se=x.canonical.toString();x.overscaledZ!==x.canonical.z&&(Se+=` => ${x.overscaledZ}`),function(Ve,tt){Ve.initDebugOverlayCanvas();let Ne=Ve.debugOverlayCanvas,Xe=Ve.context.gl,st=Ve.debugOverlayCanvas.getContext("2d");st.clearRect(0,0,Ne.width,Ne.height),st.shadowColor="white",st.shadowBlur=2,st.lineWidth=1.5,st.strokeStyle="white",st.textBaseline="top",st.font="bold 36px Open Sans, sans-serif",st.fillText(tt,5,5),st.strokeText(tt,5,5),Ve.debugOverlayTexture.update(Ne),Ve.debugOverlayTexture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE)}(P,`${Se} ${Ce}kB`),$.draw(S,I.TRIANGLES,H,Y,_s.alphaBlended,es.disabled,A7(D,n.Color.transparent,Pe),null,se,P.debugBuffer,P.quadTriangleIndexBuffer,P.debugSegments),$.draw(S,I.LINE_STRIP,H,Y,J,es.disabled,A7(D,n.Color.red),ce,se,P.debugBuffer,P.tileBorderIndexBuffer,P.debugSegments)}function z0(P,h,x){let S=P.context,I=S.gl,D=P.colorModeForRenderPass(),$=new hr(I.LEQUAL,hr.ReadWrite,P.depthRangeFor3D),H=P.useProgram("terrain"),Y=h.getTerrainMesh();S.bindFramebuffer.set(null),S.viewport.set([0,0,P.width,P.height]);for(let J of x){let se=P.renderToTexture.getTexture(J),ce=h.getTerrainData(J.tileID);S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,se.texture);let _e={u_matrix:P.transform.calculatePosMatrix(J.tileID.toUnwrapped()),u_texture:0,u_ele_delta:h.getMeshFrameDelta(P.transform.zoom)};H.draw(S,I.TRIANGLES,$,Jr.disabled,D,es.backCCW,_e,ce,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments)}}class U7{constructor(h,x){this.context=new L0(h),this.transform=x,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:n.create(),renderTime:0},this.setup(),this.numSublayers=xe.maxUnderzooming+xe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Rs}resize(h,x,S){if(this.width=Math.floor(h*S),this.height=Math.floor(x*S),this.pixelRatio=S,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let I of this.style._order)this.style._layers[I].resize()}setup(){let h=this.context,x=new n.PosArray;x.emplaceBack(0,0),x.emplaceBack(n.EXTENT,0),x.emplaceBack(0,n.EXTENT),x.emplaceBack(n.EXTENT,n.EXTENT),this.tileExtentBuffer=h.createVertexBuffer(x,b0.members),this.tileExtentSegments=n.SegmentVector.simpleSegment(0,0,4,2);let S=new n.PosArray;S.emplaceBack(0,0),S.emplaceBack(n.EXTENT,0),S.emplaceBack(0,n.EXTENT),S.emplaceBack(n.EXTENT,n.EXTENT),this.debugBuffer=h.createVertexBuffer(S,b0.members),this.debugSegments=n.SegmentVector.simpleSegment(0,0,4,5);let I=new n.RasterBoundsArray;I.emplaceBack(0,0,0,0),I.emplaceBack(n.EXTENT,0,n.EXTENT,0),I.emplaceBack(0,n.EXTENT,0,n.EXTENT),I.emplaceBack(n.EXTENT,n.EXTENT,n.EXTENT,n.EXTENT),this.rasterBoundsBuffer=h.createVertexBuffer(I,yt.members),this.rasterBoundsSegments=n.SegmentVector.simpleSegment(0,0,4,2);let D=new n.PosArray;D.emplaceBack(0,0),D.emplaceBack(1,0),D.emplaceBack(0,1),D.emplaceBack(1,1),this.viewportBuffer=h.createVertexBuffer(D,b0.members),this.viewportSegments=n.SegmentVector.simpleSegment(0,0,4,2);let $=new n.LineStripIndexArray;$.emplaceBack(0),$.emplaceBack(1),$.emplaceBack(3),$.emplaceBack(2),$.emplaceBack(0),this.tileBorderIndexBuffer=h.createIndexBuffer($);let H=new n.TriangleIndexArray;H.emplaceBack(0,1,2),H.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=h.createIndexBuffer(H);let Y=this.context.gl;this.stencilClearMode=new Jr({func:Y.ALWAYS,mask:0},0,255,Y.ZERO,Y.ZERO,Y.ZERO)}clearStencil(){let h=this.context,x=h.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let S=n.create();n.ortho(S,0,this.width,this.height,0,0,1),n.scale(S,S,[x.drawingBufferWidth,x.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(h,x.TRIANGLES,hr.disabled,this.stencilClearMode,_s.disabled,es.disabled,S0(S),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(h,x){if(this.currentStencilSource===h.source||!h.isTileClipped()||!x||!x.length)return;this.currentStencilSource=h.source;let S=this.context,I=S.gl;this.nextStencilID+x.length>256&&this.clearStencil(),S.setColorMode(_s.disabled),S.setDepthMode(hr.disabled);let D=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(let $ of x){let H=this._tileClippingMaskIDs[$.key]=this.nextStencilID++,Y=this.style.map.terrain&&this.style.map.terrain.getTerrainData($);D.draw(S,I.TRIANGLES,hr.disabled,new Jr({func:I.ALWAYS,mask:0},H,255,I.KEEP,I.KEEP,I.REPLACE),_s.disabled,es.disabled,S0($.posMatrix),Y,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let h=this.nextStencilID++,x=this.context.gl;return new Jr({func:x.NOTEQUAL,mask:255},h,255,x.KEEP,x.KEEP,x.REPLACE)}stencilModeForClipping(h){let x=this.context.gl;return new Jr({func:x.EQUAL,mask:255},this._tileClippingMaskIDs[h.key],0,x.KEEP,x.KEEP,x.REPLACE)}stencilConfigForOverlap(h){let x=this.context.gl,S=h.sort(($,H)=>H.overscaledZ-$.overscaledZ),I=S[S.length-1].overscaledZ,D=S[0].overscaledZ-I+1;if(D>1){this.currentStencilSource=void 0,this.nextStencilID+D>256&&this.clearStencil();let $={};for(let H=0;H<D;H++)$[H+I]=new Jr({func:x.GEQUAL,mask:255},H+this.nextStencilID,255,x.KEEP,x.KEEP,x.REPLACE);return this.nextStencilID+=D,[$,S]}return[{[I]:Jr.disabled},S]}colorModeForRenderPass(){let h=this.context.gl;return this._showOverdrawInspector?new _s([h.CONSTANT_COLOR,h.ONE],new n.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?_s.unblended:_s.alphaBlended}depthModeForSublayer(h,x,S){if(!this.opaquePassEnabledForLayer())return hr.disabled;let I=1-((1+this.currentLayer)*this.numSublayers+h)*this.depthEpsilon;return new hr(S||this.context.gl.LEQUAL,x,[I,I])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(h,x){this.style=h,this.options=x,this.lineAtlas=h.lineAtlas,this.imageManager=h.imageManager,this.glyphManager=h.glyphManager,this.symbolFadeChange=h.placement.symbolFadeChange(n.browser.now()),this.imageManager.beginFrame();let S=this.style._order,I=this.style.sourceCaches,D={},$={},H={};for(let Y in I){let J=I[Y];J.used&&J.prepare(this.context),D[Y]=J.getVisibleCoordinates(),$[Y]=D[Y].slice().reverse(),H[Y]=J.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Y=0;Y<S.length;Y++)if(this.style._layers[S[Y]].is3D()){this.opaquePassCutoff=Y;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;let Y=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!n.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||Y.length)&&(n.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(J,se){let ce=J.context,_e=ce.gl,Ce=_s.unblended,Ae=new hr(_e.LEQUAL,hr.ReadWrite,[0,1]),Pe=se.getTerrainMesh(),Se=se.sourceCache.getRenderableTiles(),Ve=J.useProgram("terrainDepth");ce.bindFramebuffer.set(se.getFramebuffer("depth").framebuffer),ce.viewport.set([0,0,J.width/devicePixelRatio,J.height/devicePixelRatio]),ce.clear({color:n.Color.transparent,depth:1});for(let tt of Se){let Ne=se.getTerrainData(tt.tileID),Xe={u_matrix:J.transform.calculatePosMatrix(tt.tileID.toUnwrapped()),u_ele_delta:se.getMeshFrameDelta(J.transform.zoom)};Ve.draw(ce,_e.TRIANGLES,Ae,Jr.disabled,Ce,es.backCCW,Xe,Ne,"terrain",Pe.vertexBuffer,Pe.indexBuffer,Pe.segments)}ce.bindFramebuffer.set(null),ce.viewport.set([0,0,J.width,J.height])}(this,this.style.map.terrain),function(J,se){let ce=J.context,_e=ce.gl,Ce=_s.unblended,Ae=new hr(_e.LEQUAL,hr.ReadWrite,[0,1]),Pe=se.getTerrainMesh(),Se=se.getCoordsTexture(),Ve=se.sourceCache.getRenderableTiles(),tt=J.useProgram("terrainCoords");ce.bindFramebuffer.set(se.getFramebuffer("coords").framebuffer),ce.viewport.set([0,0,J.width/devicePixelRatio,J.height/devicePixelRatio]),ce.clear({color:n.Color.transparent,depth:1}),se.coordsIndex=[];for(let Ne of Ve){let Xe=se.getTerrainData(Ne.tileID);ce.activeTexture.set(_e.TEXTURE0),_e.bindTexture(_e.TEXTURE_2D,Se.texture);let st={u_matrix:J.transform.calculatePosMatrix(Ne.tileID.toUnwrapped()),u_terrain_coords_id:(255-se.coordsIndex.length)/255,u_texture:0,u_ele_delta:se.getMeshFrameDelta(J.transform.zoom)};tt.draw(ce,_e.TRIANGLES,Ae,Jr.disabled,Ce,es.backCCW,st,Xe,"terrain",Pe.vertexBuffer,Pe.indexBuffer,Pe.segments),se.coordsIndex.push(Ne.tileID.key)}ce.bindFramebuffer.set(null),ce.viewport.set([0,0,J.width,J.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(let Y of S){let J=this.style._layers[Y];if(!J.hasOffscreenPass()||J.isHidden(this.transform.zoom))continue;let se=$[J.source];(J.type==="custom"||se.length)&&this.renderLayer(this,I[J.source],J,se)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:x.showOverdrawInspector?n.Color.black:n.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=x.showOverdrawInspector,this.depthRangeFor3D=[0,1-(h._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){let Y=this.style._layers[S[this.currentLayer]],J=I[Y.source],se=D[Y.source];this._renderTileClippingMasks(Y,se),this.renderLayer(this,J,Y,se)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){let Y=this.style._layers[S[this.currentLayer]],J=I[Y.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(Y))continue;let se=(Y.type==="symbol"?H:$)[Y.source];this._renderTileClippingMasks(Y,D[Y.source]),this.renderLayer(this,J,Y,se)}if(this.options.showTileBoundaries){let Y=function(J,se){let ce=null,_e=Object.values(J._layers).flatMap(Se=>Se.source&&!Se.isHidden(se)?[J.sourceCaches[Se.source]]:[]),Ce=_e.filter(Se=>Se.getSource().type==="vector"),Ae=_e.filter(Se=>Se.getSource().type!=="vector"),Pe=Se=>{(!ce||ce.getSource().maxzoom<Se.getSource().maxzoom)&&(ce=Se)};return Ce.forEach(Se=>Pe(Se)),ce||Ae.forEach(Se=>Pe(Se)),ce}(this.style,this.transform.zoom);Y&&function(J,se,ce){for(let _e=0;_e<ce.length;_e++)zh(J,se,ce[_e])}(this,Y,Y.getVisibleCoordinates())}this.options.showPadding&&function(Y){let J=Y.transform.padding;U0(Y,Y.transform.height-(J.top||0),3,B7),U0(Y,J.bottom||0,3,Fs),Pp(Y,J.left||0,3,hu),Pp(Y,Y.transform.width-(J.right||0),3,ca);let se=Y.transform.centerPoint;(function(ce,_e,Ce,Ae){Nl(ce,_e-1,Ce-10,2,20,Ae),Nl(ce,_e-10,Ce-1,20,2,Ae)})(Y,se.x,Y.transform.height-se.y,Mp)}(this),this.context.setDefault()}renderLayer(h,x,S,I){if(!S.isHidden(this.transform.zoom)&&(S.type==="background"||S.type==="custom"||(I||[]).length))switch(this.id=S.id,S.type){case"symbol":(function(D,$,H,Y,J){if(D.renderPass!=="translucent")return;let se=Jr.disabled,ce=D.colorModeForRenderPass();(H._unevaluatedLayout.hasValue("text-variable-anchor")||H._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(_e,Ce,Ae,Pe,Se,Ve,tt){let Ne=Ce.transform,Xe=Se==="map",st=Ve==="map";for(let nt of _e){let ft=Pe.getTile(nt),At=ft.getBucket(Ae);if(!At||!At.text||!At.text.segments.get().length)continue;let vt=n.evaluateSizeForZoom(At.textSizeData,Ne.zoom),Mt=Ge(ft,1,Ce.transform.zoom),li=qi(nt.posMatrix,st,Xe,Ce.transform,Mt),dr=Ae.layout.get("icon-text-fit")!=="none"&&At.hasIconData();if(vt){let Ut=Math.pow(2,Ne.zoom-ft.tileID.overscaledZ);Ap(At,Xe,st,tt,Ne,li,nt.posMatrix,Ut,vt,dr,Ce.style.map.terrain?(Ii,Jt)=>Ce.style.map.terrain.getElevation(nt,Ii,Jt):null)}}}(Y,D,H,$,H.layout.get("text-rotation-alignment"),H.layout.get("text-pitch-alignment"),J),H.paint.get("icon-opacity").constantOr(1)!==0&&Cp(D,$,H,Y,!1,H.paint.get("icon-translate"),H.paint.get("icon-translate-anchor"),H.layout.get("icon-rotation-alignment"),H.layout.get("icon-pitch-alignment"),H.layout.get("icon-keep-upright"),se,ce),H.paint.get("text-opacity").constantOr(1)!==0&&Cp(D,$,H,Y,!0,H.paint.get("text-translate"),H.paint.get("text-translate-anchor"),H.layout.get("text-rotation-alignment"),H.layout.get("text-pitch-alignment"),H.layout.get("text-keep-upright"),se,ce),$.map.showCollisionBoxes&&(Bh(D,$,H,Y,H.paint.get("text-translate"),H.paint.get("text-translate-anchor"),!0),Bh(D,$,H,Y,H.paint.get("icon-translate"),H.paint.get("icon-translate-anchor"),!1))})(h,x,S,I,this.style.placement.variableOffsets);break;case"circle":(function(D,$,H,Y){if(D.renderPass!=="translucent")return;let J=H.paint.get("circle-opacity"),se=H.paint.get("circle-stroke-width"),ce=H.paint.get("circle-stroke-opacity"),_e=!H.layout.get("circle-sort-key").isConstant();if(J.constantOr(1)===0&&(se.constantOr(1)===0||ce.constantOr(1)===0))return;let Ce=D.context,Ae=Ce.gl,Pe=D.depthModeForSublayer(0,hr.ReadOnly),Se=Jr.disabled,Ve=D.colorModeForRenderPass(),tt=[];for(let Ne=0;Ne<Y.length;Ne++){let Xe=Y[Ne],st=$.getTile(Xe),nt=st.getBucket(H);if(!nt)continue;let ft=nt.programConfigurations.get(H.id),At=D.useProgram("circle",ft),vt=nt.layoutVertexBuffer,Mt=nt.indexBuffer,li=D.style.map.terrain&&D.style.map.terrain.getTerrainData(Xe),dr={programConfiguration:ft,program:At,layoutVertexBuffer:vt,indexBuffer:Mt,uniformValues:hv(D,Xe,st,H),terrainData:li};if(_e){let Ut=nt.segments.get();for(let Ii of Ut)tt.push({segments:new n.SegmentVector([Ii]),sortKey:Ii.sortKey,state:dr})}else tt.push({segments:nt.segments,sortKey:0,state:dr})}_e&&tt.sort((Ne,Xe)=>Ne.sortKey-Xe.sortKey);for(let Ne of tt){let{programConfiguration:Xe,program:st,layoutVertexBuffer:nt,indexBuffer:ft,uniformValues:At,terrainData:vt}=Ne.state;st.draw(Ce,Ae.TRIANGLES,Pe,Se,Ve,es.disabled,At,vt,H.id,nt,ft,Ne.segments,H.paint,D.transform.zoom,Xe)}})(h,x,S,I);break;case"heatmap":(function(D,$,H,Y){if(H.paint.get("heatmap-opacity")!==0)if(D.renderPass==="offscreen"){let J=D.context,se=J.gl,ce=Jr.disabled,_e=new _s([se.ONE,se.ONE],n.Color.transparent,[!0,!0,!0,!0]);(function(Ce,Ae,Pe){let Se=Ce.gl;Ce.activeTexture.set(Se.TEXTURE1),Ce.viewport.set([0,0,Ae.width/4,Ae.height/4]);let Ve=Pe.heatmapFbo;if(Ve)Se.bindTexture(Se.TEXTURE_2D,Ve.colorAttachment.get()),Ce.bindFramebuffer.set(Ve.framebuffer);else{let tt=Se.createTexture();Se.bindTexture(Se.TEXTURE_2D,tt),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_WRAP_S,Se.CLAMP_TO_EDGE),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_WRAP_T,Se.CLAMP_TO_EDGE),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_MIN_FILTER,Se.LINEAR),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_MAG_FILTER,Se.LINEAR),Ve=Pe.heatmapFbo=Ce.createFramebuffer(Ae.width/4,Ae.height/4,!1,!1),function(Ne,Xe,st,nt){var ft,At;let vt=Ne.gl,Mt=(ft=Ne.HALF_FLOAT)!==null&&ft!==void 0?ft:vt.UNSIGNED_BYTE,li=(At=Ne.RGBA16F)!==null&&At!==void 0?At:vt.RGBA;vt.texImage2D(vt.TEXTURE_2D,0,li,Xe.width/4,Xe.height/4,0,vt.RGBA,Mt,null),nt.colorAttachment.set(st)}(Ce,Ae,tt,Ve)}})(J,D,H),J.clear({color:n.Color.transparent});for(let Ce=0;Ce<Y.length;Ce++){let Ae=Y[Ce];if($.hasRenderableParent(Ae))continue;let Pe=$.getTile(Ae),Se=Pe.getBucket(H);if(!Se)continue;let Ve=Se.programConfigurations.get(H.id),tt=D.useProgram("heatmap",Ve),{zoom:Ne}=D.transform;tt.draw(J,se.TRIANGLES,hr.disabled,ce,_e,es.disabled,C7(Ae.posMatrix,Pe,Ne,H.paint.get("heatmap-intensity")),null,H.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,H.paint,D.transform.zoom,Ve)}J.viewport.set([0,0,D.width,D.height])}else D.renderPass==="translucent"&&(D.context.setColorMode(D.colorModeForRenderPass()),function(J,se){let ce=J.context,_e=ce.gl,Ce=se.heatmapFbo;if(!Ce)return;ce.activeTexture.set(_e.TEXTURE0),_e.bindTexture(_e.TEXTURE_2D,Ce.colorAttachment.get()),ce.activeTexture.set(_e.TEXTURE1);let Ae=se.colorRampTexture;Ae||(Ae=se.colorRampTexture=new U(ce,se.colorRamp,_e.RGBA)),Ae.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),J.useProgram("heatmapTexture").draw(ce,_e.TRIANGLES,hr.disabled,Jr.disabled,J.colorModeForRenderPass(),es.disabled,((Pe,Se,Ve,tt)=>{let Ne=n.create();n.ortho(Ne,0,Pe.width,Pe.height,0,0,1);let Xe=Pe.context.gl;return{u_matrix:Ne,u_world:[Xe.drawingBufferWidth,Xe.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Se.paint.get("heatmap-opacity")}})(J,se),null,se.id,J.viewportBuffer,J.quadTriangleIndexBuffer,J.viewportSegments,se.paint,J.transform.zoom)}(D,H))})(h,x,S,I);break;case"line":(function(D,$,H,Y){if(D.renderPass!=="translucent")return;let J=H.paint.get("line-opacity"),se=H.paint.get("line-width");if(J.constantOr(1)===0||se.constantOr(1)===0)return;let ce=D.depthModeForSublayer(0,hr.ReadOnly),_e=D.colorModeForRenderPass(),Ce=H.paint.get("line-dasharray"),Ae=H.paint.get("line-pattern"),Pe=Ae.constantOr(1),Se=H.paint.get("line-gradient"),Ve=H.getCrossfadeParameters(),tt=Pe?"linePattern":Ce?"lineSDF":Se?"lineGradient":"line",Ne=D.context,Xe=Ne.gl,st=!0;for(let nt of Y){let ft=$.getTile(nt);if(Pe&&!ft.patternsLoaded())continue;let At=ft.getBucket(H);if(!At)continue;let vt=At.programConfigurations.get(H.id),Mt=D.context.program.get(),li=D.useProgram(tt,vt),dr=st||li.program!==Mt,Ut=D.style.map.terrain&&D.style.map.terrain.getTerrainData(nt),Ii=Ae.constantOr(null);if(Ii&&ft.imageAtlas){let cr=ft.imageAtlas,ir=cr.patternPositions[Ii.to.toString()],Pi=cr.patternPositions[Ii.from.toString()];ir&&Pi&&vt.setConstantPatternPositions(ir,Pi)}let Jt=Ut?nt:null,Yr=Pe?ou(D,ft,H,Ve,Jt):Ce?C0(D,ft,H,Ce,Ve,Jt):Se?k7(D,ft,H,At.lineClipsArray.length,Jt):A0(D,ft,H,Jt);if(Pe)Ne.activeTexture.set(Xe.TEXTURE0),ft.imageAtlasTexture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE),vt.updatePaintBuffers(Ve);else if(Ce&&(dr||D.lineAtlas.dirty))Ne.activeTexture.set(Xe.TEXTURE0),D.lineAtlas.bind(Ne);else if(Se){let cr=At.gradients[H.id],ir=cr.texture;if(H.gradientVersion!==cr.version){let Pi=256;if(H.stepInterpolant){let As=$.getSource().maxzoom,Lr=nt.canonical.z===As?Math.ceil(1<<D.transform.maxZoom-nt.canonical.z):1;Pi=n.clamp(n.nextPowerOfTwo(At.maxLineLength/n.EXTENT*1024*Lr),256,Ne.maxTextureSize)}cr.gradient=n.renderColorRamp({expression:H.gradientExpression(),evaluationKey:"lineProgress",resolution:Pi,image:cr.gradient||void 0,clips:At.lineClipsArray}),cr.texture?cr.texture.update(cr.gradient):cr.texture=new U(Ne,cr.gradient,Xe.RGBA),cr.version=H.gradientVersion,ir=cr.texture}Ne.activeTexture.set(Xe.TEXTURE0),ir.bind(H.stepInterpolant?Xe.NEAREST:Xe.LINEAR,Xe.CLAMP_TO_EDGE)}li.draw(Ne,Xe.TRIANGLES,ce,D.stencilModeForClipping(nt),_e,es.disabled,Yr,Ut,H.id,At.layoutVertexBuffer,At.indexBuffer,At.segments,H.paint,D.transform.zoom,vt,At.layoutVertexBuffer2),st=!1}})(h,x,S,I);break;case"fill":(function(D,$,H,Y){let J=H.paint.get("fill-color"),se=H.paint.get("fill-opacity");if(se.constantOr(1)===0)return;let ce=D.colorModeForRenderPass(),_e=H.paint.get("fill-pattern"),Ce=D.opaquePassEnabledForLayer()&&!_e.constantOr(1)&&J.constantOr(n.Color.transparent).a===1&&se.constantOr(0)===1?"opaque":"translucent";if(D.renderPass===Ce){let Ae=D.depthModeForSublayer(1,D.renderPass==="opaque"?hr.ReadWrite:hr.ReadOnly);Ip(D,$,H,Y,Ae,ce,!1)}if(D.renderPass==="translucent"&&H.paint.get("fill-antialias")){let Ae=D.depthModeForSublayer(H.getPaintProperty("fill-outline-color")?2:0,hr.ReadOnly);Ip(D,$,H,Y,Ae,ce,!0)}})(h,x,S,I);break;case"fill-extrusion":(function(D,$,H,Y){let J=H.paint.get("fill-extrusion-opacity");if(J!==0&&D.renderPass==="translucent"){let se=new hr(D.context.gl.LEQUAL,hr.ReadWrite,D.depthRangeFor3D);if(J!==1||H.paint.get("fill-extrusion-pattern").constantOr(1))O0(D,$,H,Y,se,Jr.disabled,_s.disabled),O0(D,$,H,Y,se,D.stencilModeFor3D(),D.colorModeForRenderPass());else{let ce=D.colorModeForRenderPass();O0(D,$,H,Y,se,Jr.disabled,ce)}}})(h,x,S,I);break;case"hillshade":(function(D,$,H,Y){if(D.renderPass!=="offscreen"&&D.renderPass!=="translucent")return;let J=D.context,se=D.depthModeForSublayer(0,hr.ReadOnly),ce=D.colorModeForRenderPass(),[_e,Ce]=D.renderPass==="translucent"?D.stencilConfigForOverlap(Y):[{},Y];for(let Ae of Ce){let Pe=$.getTile(Ae);Pe.needsHillshadePrepare!==void 0&&Pe.needsHillshadePrepare&&D.renderPass==="offscreen"?kp(D,Pe,H,se,Jr.disabled,ce):D.renderPass==="translucent"&&B0(D,Ae,Pe,H,se,_e[Ae.overscaledZ],ce)}J.viewport.set([0,0,D.width,D.height])})(h,x,S,I);break;case"raster":(function(D,$,H,Y){if(D.renderPass!=="translucent"||H.paint.get("raster-opacity")===0||!Y.length)return;let J=D.context,se=J.gl,ce=$.getSource(),_e=D.useProgram("raster"),Ce=D.colorModeForRenderPass(),[Ae,Pe]=ce instanceof bt?[{},Y]:D.stencilConfigForOverlap(Y),Se=Pe[Pe.length-1].overscaledZ,Ve=!D.options.moving;for(let tt of Pe){let Ne=D.depthModeForSublayer(tt.overscaledZ-Se,H.paint.get("raster-opacity")===1?hr.ReadWrite:hr.ReadOnly,se.LESS),Xe=$.getTile(tt);Xe.registerFadeDuration(H.paint.get("raster-fade-duration"));let st=$.findLoadedParent(tt,0),nt=Tv(Xe,st,$,H,D.transform,D.style.map.terrain),ft,At,vt=H.paint.get("raster-resampling")==="nearest"?se.NEAREST:se.LINEAR;J.activeTexture.set(se.TEXTURE0),Xe.texture.bind(vt,se.CLAMP_TO_EDGE,se.LINEAR_MIPMAP_NEAREST),J.activeTexture.set(se.TEXTURE1),st?(st.texture.bind(vt,se.CLAMP_TO_EDGE,se.LINEAR_MIPMAP_NEAREST),ft=Math.pow(2,st.tileID.overscaledZ-Xe.tileID.overscaledZ),At=[Xe.tileID.canonical.x*ft%1,Xe.tileID.canonical.y*ft%1]):Xe.texture.bind(vt,se.CLAMP_TO_EDGE,se.LINEAR_MIPMAP_NEAREST);let Mt=D.style.map.terrain&&D.style.map.terrain.getTerrainData(tt),li=Mt?tt:null,dr=li?li.posMatrix:D.transform.calculatePosMatrix(tt.toUnwrapped(),Ve),Ut=I0(dr,At||[0,0],ft||1,nt,H);ce instanceof bt?_e.draw(J,se.TRIANGLES,Ne,Jr.disabled,Ce,es.disabled,Ut,Mt,H.id,ce.boundsBuffer,D.quadTriangleIndexBuffer,ce.boundsSegments):_e.draw(J,se.TRIANGLES,Ne,Ae[tt.overscaledZ],Ce,es.disabled,Ut,Mt,H.id,D.rasterBoundsBuffer,D.quadTriangleIndexBuffer,D.rasterBoundsSegments)}})(h,x,S,I);break;case"background":(function(D,$,H,Y){let J=H.paint.get("background-color"),se=H.paint.get("background-opacity");if(se===0)return;let ce=D.context,_e=ce.gl,Ce=D.transform,Ae=Ce.tileSize,Pe=H.paint.get("background-pattern");if(D.isPatternMissing(Pe))return;let Se=!Pe&&J.a===1&&se===1&&D.opaquePassEnabledForLayer()?"opaque":"translucent";if(D.renderPass!==Se)return;let Ve=Jr.disabled,tt=D.depthModeForSublayer(0,Se==="opaque"?hr.ReadWrite:hr.ReadOnly),Ne=D.colorModeForRenderPass(),Xe=D.useProgram(Pe?"backgroundPattern":"background"),st=Y||Ce.coveringTiles({tileSize:Ae,terrain:D.style.map.terrain});Pe&&(ce.activeTexture.set(_e.TEXTURE0),D.imageManager.bind(D.context));let nt=H.getCrossfadeParameters();for(let ft of st){let At=Y?ft.posMatrix:D.transform.calculatePosMatrix(ft.toUnwrapped()),vt=Pe?k0(At,se,D,Pe,{tileID:ft,tileSize:Ae},nt):au(At,se,J),Mt=D.style.map.terrain&&D.style.map.terrain.getTerrainData(ft);Xe.draw(ce,_e.TRIANGLES,tt,Ve,Ne,es.disabled,vt,Mt,H.id,D.tileExtentBuffer,D.quadTriangleIndexBuffer,D.tileExtentSegments)}})(h,0,S,I);break;case"custom":(function(D,$,H){let Y=D.context,J=H.implementation;if(D.renderPass==="offscreen"){let se=J.prerender;se&&(D.setCustomLayerDefaults(),Y.setColorMode(D.colorModeForRenderPass()),se.call(J,Y.gl,D.transform.customLayerMatrix()),Y.setDirty(),D.setBaseState())}else if(D.renderPass==="translucent"){D.setCustomLayerDefaults(),Y.setColorMode(D.colorModeForRenderPass()),Y.setStencilMode(Jr.disabled);let se=J.renderingMode==="3d"?new hr(D.context.gl.LEQUAL,hr.ReadWrite,D.depthRangeFor3D):D.depthModeForSublayer(0,hr.ReadOnly);Y.setDepthMode(se),J.render(Y.gl,D.transform.customLayerMatrix()),Y.setDirty(),D.setBaseState(),Y.bindFramebuffer.set(null)}})(h,0,S)}}translatePosMatrix(h,x,S,I,D){if(!S[0]&&!S[1])return h;let $=D?I==="map"?this.transform.angle:0:I==="viewport"?-this.transform.angle:0;if($){let J=Math.sin($),se=Math.cos($);S=[S[0]*se-S[1]*J,S[0]*J+S[1]*se]}let H=[D?S[0]:Ge(x,S[0],this.transform.zoom),D?S[1]:Ge(x,S[1],this.transform.zoom),0],Y=new Float32Array(16);return n.translate(Y,h,H),Y}saveTileTexture(h){let x=this._tileTextures[h.size[0]];x?x.push(h):this._tileTextures[h.size[0]]=[h]}getTileTexture(h){let x=this._tileTextures[h];return x&&x.length>0?x.pop():null}isPatternMissing(h){if(!h)return!1;if(!h.from||!h.to)return!0;let x=this.imageManager.getPattern(h.from.toString()),S=this.imageManager.getPattern(h.to.toString());return!x||!S}useProgram(h,x){this.cache=this.cache||{};let S=h+(x?x.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[S]||(this.cache[S]=new vc(this.context,Mh[h],x,ko[h],this._showOverdrawInspector,this.style.map.terrain)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let h=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(h.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new U(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:h,drawingBufferHeight:x}=this.context.gl;return this.width!==h||this.height!==x}}class G0{constructor(h,x){this.points=h,this.planes=x}static fromInvProjectionMatrix(h,x,S){let I=Math.pow(2,S),D=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(H=>{let Y=1/(H=n.transformMat4([],H,h))[3]/x*I;return n.mul$1(H,H,[Y,Y,1/H[3],Y])}),$=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(H=>{let Y=function(_e,Ce){var Ae=Ce[0],Pe=Ce[1],Se=Ce[2],Ve=Ae*Ae+Pe*Pe+Se*Se;return Ve>0&&(Ve=1/Math.sqrt(Ve)),_e[0]=Ce[0]*Ve,_e[1]=Ce[1]*Ve,_e[2]=Ce[2]*Ve,_e}([],function(_e,Ce,Ae){var Pe=Ce[0],Se=Ce[1],Ve=Ce[2],tt=Ae[0],Ne=Ae[1],Xe=Ae[2];return _e[0]=Se*Xe-Ve*Ne,_e[1]=Ve*tt-Pe*Xe,_e[2]=Pe*Ne-Se*tt,_e}([],k([],D[H[0]],D[H[1]]),k([],D[H[2]],D[H[1]]))),J=-((se=Y)[0]*(ce=D[H[1]])[0]+se[1]*ce[1]+se[2]*ce[2]);var se,ce;return Y.concat(J)});return new G0(D,$)}}class Gh{constructor(h,x){this.min=h,this.max=x,this.center=function(S,I,D){return S[0]=.5*I[0],S[1]=.5*I[1],S[2]=.5*I[2],S}([],function(S,I,D){return S[0]=I[0]+D[0],S[1]=I[1]+D[1],S[2]=I[2]+D[2],S}([],this.min,this.max))}quadrant(h){let x=[h%2==0,h<2],S=A(this.min),I=A(this.max);for(let D=0;D<x.length;D++)S[D]=x[D]?this.min[D]:this.center[D],I[D]=x[D]?this.center[D]:this.max[D];return I[2]=this.max[2],new Gh(S,I)}distanceX(h){return Math.max(Math.min(this.max[0],h[0]),this.min[0])-h[0]}distanceY(h){return Math.max(Math.min(this.max[1],h[1]),this.min[1])-h[1]}intersects(h){let x=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]],S=!0;for(let I=0;I<h.planes.length;I++){let D=h.planes[I],$=0;for(let H=0;H<x.length;H++)n.dot(D,x[H])>=0&&$++;if($===0)return 0;$!==x.length&&(S=!1)}if(S)return 2;for(let I=0;I<3;I++){let D=Number.MAX_VALUE,$=-Number.MAX_VALUE;for(let H=0;H<h.points.length;H++){let Y=h.points[H][I]-this.min[I];D=Math.min(D,Y),$=Math.max($,Y)}if($<0||D>this.max[I]-this.min[I])return 0}return 1}}class $0{constructor(h=0,x=0,S=0,I=0){if(isNaN(h)||h<0||isNaN(x)||x<0||isNaN(S)||S<0||isNaN(I)||I<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=h,this.bottom=x,this.left=S,this.right=I}interpolate(h,x,S){return x.top!=null&&h.top!=null&&(this.top=n.interpolate.number(h.top,x.top,S)),x.bottom!=null&&h.bottom!=null&&(this.bottom=n.interpolate.number(h.bottom,x.bottom,S)),x.left!=null&&h.left!=null&&(this.left=n.interpolate.number(h.left,x.left,S)),x.right!=null&&h.right!=null&&(this.right=n.interpolate.number(h.right,x.right,S)),this}getCenter(h,x){let S=n.clamp((this.left+h-this.right)/2,0,h),I=n.clamp((this.top+x-this.bottom)/2,0,x);return new n.Point(S,I)}equals(h){return this.top===h.top&&this.bottom===h.bottom&&this.left===h.left&&this.right===h.right}clone(){return new $0(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class H0{constructor(h,x,S,I,D){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=D===void 0||!!D,this._minZoom=h||0,this._maxZoom=x||22,this._minPitch=S==null?0:S,this._maxPitch=I==null?60:I,this.setMaxBounds(),this.width=0,this.height=0,this._center=new n.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new $0,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){let h=new H0(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return h.apply(this),h}apply(h){this.tileSize=h.tileSize,this.latRange=h.latRange,this.width=h.width,this.height=h.height,this._center=h._center,this._elevation=h._elevation,this._minEleveationForCurrentTile=h._minEleveationForCurrentTile,this.zoom=h.zoom,this.angle=h.angle,this._fov=h._fov,this._pitch=h._pitch,this._unmodified=h._unmodified,this._edgeInsets=h._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(h){this._minZoom!==h&&(this._minZoom=h,this.zoom=Math.max(this.zoom,h))}get maxZoom(){return this._maxZoom}set maxZoom(h){this._maxZoom!==h&&(this._maxZoom=h,this.zoom=Math.min(this.zoom,h))}get minPitch(){return this._minPitch}set minPitch(h){this._minPitch!==h&&(this._minPitch=h,this.pitch=Math.max(this.pitch,h))}get maxPitch(){return this._maxPitch}set maxPitch(h){this._maxPitch!==h&&(this._maxPitch=h,this.pitch=Math.min(this.pitch,h))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(h){h===void 0?h=!0:h===null&&(h=!1),this._renderWorldCopies=h}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(h){let x=-n.wrap(h,-180,180)*Math.PI/180;this.angle!==x&&(this._unmodified=!1,this.angle=x,this._calcMatrices(),this.rotationMatrix=function(){var S=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(S[1]=0,S[2]=0),S[0]=1,S[3]=1,S}(),function(S,I,D){var $=I[0],H=I[1],Y=I[2],J=I[3],se=Math.sin(D),ce=Math.cos(D);S[0]=$*ce+Y*se,S[1]=H*ce+J*se,S[2]=$*-se+Y*ce,S[3]=H*-se+J*ce}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(h){let x=n.clamp(h,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==x&&(this._unmodified=!1,this._pitch=x,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(h){h=Math.max(.01,Math.min(60,h)),this._fov!==h&&(this._unmodified=!1,this._fov=h/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(h){let x=Math.min(Math.max(h,this.minZoom),this.maxZoom);this._zoom!==x&&(this._unmodified=!1,this._zoom=x,this.tileZoom=Math.max(0,Math.floor(x)),this.scale=this.zoomScale(x),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(h){h.lat===this._center.lat&&h.lng===this._center.lng||(this._unmodified=!1,this._center=h,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(h){h!==this._elevation&&(this._elevation=h,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(h){this._edgeInsets.equals(h)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,h,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(h){return this._edgeInsets.equals(h)}interpolatePadding(h,x,S){this._unmodified=!1,this._edgeInsets.interpolate(h,x,S),this._constrain(),this._calcMatrices()}coveringZoomLevel(h){let x=(h.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/h.tileSize));return Math.max(0,x)}getVisibleUnwrappedCoordinates(h){let x=[new n.UnwrappedTileID(0,h)];if(this._renderWorldCopies){let S=this.pointCoordinate(new n.Point(0,0)),I=this.pointCoordinate(new n.Point(this.width,0)),D=this.pointCoordinate(new n.Point(this.width,this.height)),$=this.pointCoordinate(new n.Point(0,this.height)),H=Math.floor(Math.min(S.x,I.x,D.x,$.x)),Y=Math.floor(Math.max(S.x,I.x,D.x,$.x)),J=1;for(let se=H-J;se<=Y+J;se++)se!==0&&x.push(new n.UnwrappedTileID(se,h))}return x}coveringTiles(h){var x,S;let I=this.coveringZoomLevel(h),D=I;if(h.minzoom!==void 0&&I<h.minzoom)return[];h.maxzoom!==void 0&&I>h.maxzoom&&(I=h.maxzoom);let $=this.pointCoordinate(this.getCameraPoint()),H=n.MercatorCoordinate.fromLngLat(this.center),Y=Math.pow(2,I),J=[Y*$.x,Y*$.y,0],se=[Y*H.x,Y*H.y,0],ce=G0.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,I),_e=h.minzoom||0;!h.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(_e=I);let Ce=h.terrain?2/Math.min(this.tileSize,h.tileSize)*this.tileSize:3,Ae=Ne=>({aabb:new Gh([Ne*Y,0,0],[(Ne+1)*Y,Y,0]),zoom:0,x:0,y:0,wrap:Ne,fullyVisible:!1}),Pe=[],Se=[],Ve=I,tt=h.reparseOverscaled?D:I;if(this._renderWorldCopies)for(let Ne=1;Ne<=3;Ne++)Pe.push(Ae(-Ne)),Pe.push(Ae(Ne));for(Pe.push(Ae(0));Pe.length>0;){let Ne=Pe.pop(),Xe=Ne.x,st=Ne.y,nt=Ne.fullyVisible;if(!nt){let li=Ne.aabb.intersects(ce);if(li===0)continue;nt=li===2}let ft=h.terrain?J:se,At=Ne.aabb.distanceX(ft),vt=Ne.aabb.distanceY(ft),Mt=Math.max(Math.abs(At),Math.abs(vt));if(Ne.zoom===Ve||Mt>Ce+(1<<Ve-Ne.zoom)-2&&Ne.zoom>=_e){let li=Ve-Ne.zoom,dr=J[0]-.5-(Xe<<li),Ut=J[1]-.5-(st<<li);Se.push({tileID:new n.OverscaledTileID(Ne.zoom===Ve?tt:Ne.zoom,Ne.wrap,Ne.zoom,Xe,st),distanceSq:F([se[0]-.5-Xe,se[1]-.5-st]),tileDistanceToCamera:Math.sqrt(dr*dr+Ut*Ut)})}else for(let li=0;li<4;li++){let dr=(Xe<<1)+li%2,Ut=(st<<1)+(li>>1),Ii=Ne.zoom+1,Jt=Ne.aabb.quadrant(li);if(h.terrain){let Yr=new n.OverscaledTileID(Ii,Ne.wrap,Ii,dr,Ut),cr=h.terrain.getMinMaxElevation(Yr),ir=(x=cr.minElevation)!==null&&x!==void 0?x:this.elevation,Pi=(S=cr.maxElevation)!==null&&S!==void 0?S:this.elevation;Jt=new Gh([Jt.min[0],Jt.min[1],ir],[Jt.max[0],Jt.max[1],Pi])}Pe.push({aabb:Jt,zoom:Ii,x:dr,y:Ut,wrap:Ne.wrap,fullyVisible:nt})}}return Se.sort((Ne,Xe)=>Ne.distanceSq-Xe.distanceSq).map(Ne=>Ne.tileID)}resize(h,x){this.width=h,this.height=x,this.pixelsToGLUnits=[2/h,-2/x],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(h){return Math.pow(2,h)}scaleZoom(h){return Math.log(h)/Math.LN2}project(h){let x=n.clamp(h.lat,-this.maxValidLatitude,this.maxValidLatitude);return new n.Point(n.mercatorXfromLng(h.lng)*this.worldSize,n.mercatorYfromLat(x)*this.worldSize)}unproject(h){return new n.MercatorCoordinate(h.x/this.worldSize,h.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(h){let x=this.pointLocation(this.centerPoint,h),S=h.getElevationForLngLatZoom(x,this.tileZoom);if(!(this.elevation-S))return;let I=this.getCameraPosition(),D=n.MercatorCoordinate.fromLngLat(I.lngLat,I.altitude),$=n.MercatorCoordinate.fromLngLat(x,S),H=D.x-$.x,Y=D.y-$.y,J=D.z-$.z,se=Math.sqrt(H*H+Y*Y+J*J),ce=this.scaleZoom(this.cameraToCenterDistance/se/this.tileSize);this._elevation=S,this._center=x,this.zoom=ce}setLocationAtPoint(h,x){let S=this.pointCoordinate(x),I=this.pointCoordinate(this.centerPoint),D=this.locationCoordinate(h),$=new n.MercatorCoordinate(D.x-(S.x-I.x),D.y-(S.y-I.y));this.center=this.coordinateLocation($),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(h,x){return x?this.coordinatePoint(this.locationCoordinate(h),x.getElevationForLngLatZoom(h,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(h))}pointLocation(h,x){return this.coordinateLocation(this.pointCoordinate(h,x))}locationCoordinate(h){return n.MercatorCoordinate.fromLngLat(h)}coordinateLocation(h){return h&&h.toLngLat()}pointCoordinate(h,x){if(x){let _e=x.pointCoordinate(h);if(_e!=null)return _e}let S=[h.x,h.y,0,1],I=[h.x,h.y,1,1];n.transformMat4(S,S,this.pixelMatrixInverse),n.transformMat4(I,I,this.pixelMatrixInverse);let D=S[3],$=I[3],H=S[1]/D,Y=I[1]/$,J=S[2]/D,se=I[2]/$,ce=J===se?0:(0-J)/(se-J);return new n.MercatorCoordinate(n.interpolate.number(S[0]/D,I[0]/$,ce)/this.worldSize,n.interpolate.number(H,Y,ce)/this.worldSize)}coordinatePoint(h,x=0,S=this.pixelMatrix){let I=[h.x*this.worldSize,h.y*this.worldSize,x,1];return n.transformMat4(I,I,S),new n.Point(I[0]/I[3],I[1]/I[3])}getBounds(){let h=Math.max(0,this.height/2-this.getHorizon());return new oe().extend(this.pointLocation(new n.Point(0,h))).extend(this.pointLocation(new n.Point(this.width,h))).extend(this.pointLocation(new n.Point(this.width,this.height))).extend(this.pointLocation(new n.Point(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new oe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(h){h?(this.lngRange=[h.getWest(),h.getEast()],this.latRange=[h.getSouth(),h.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(h,x=!1){let S=h.key,I=x?this._alignedPosMatrixCache:this._posMatrixCache;if(I[S])return I[S];let D=h.canonical,$=this.worldSize/this.zoomScale(D.z),H=D.x+Math.pow(2,D.z)*h.wrap,Y=n.identity(new Float64Array(16));return n.translate(Y,Y,[H*$,D.y*$,0]),n.scale(Y,Y,[$/n.EXTENT,$/n.EXTENT,1]),n.multiply(Y,x?this.alignedProjMatrix:this.projMatrix,Y),I[S]=new Float32Array(Y),I[S]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let h,x,S,I,D=-90,$=90,H=-180,Y=180,J=this.size,se=this._unmodified;if(this.latRange){let Ce=this.latRange;D=n.mercatorYfromLat(Ce[1])*this.worldSize,$=n.mercatorYfromLat(Ce[0])*this.worldSize,h=$-D<J.y?J.y/($-D):0}if(this.lngRange){let Ce=this.lngRange;H=n.wrap(n.mercatorXfromLng(Ce[0])*this.worldSize,0,this.worldSize),Y=n.wrap(n.mercatorXfromLng(Ce[1])*this.worldSize,0,this.worldSize),Y<H&&(Y+=this.worldSize),x=Y-H<J.x?J.x/(Y-H):0}let ce=this.point,_e=Math.max(x||0,h||0);if(_e)return this.center=this.unproject(new n.Point(x?(Y+H)/2:ce.x,h?($+D)/2:ce.y)),this.zoom+=this.scaleZoom(_e),this._unmodified=se,void(this._constraining=!1);if(this.latRange){let Ce=ce.y,Ae=J.y/2;Ce-Ae<D&&(I=D+Ae),Ce+Ae>$&&(I=$-Ae)}if(this.lngRange){let Ce=(H+Y)/2,Ae=n.wrap(ce.x,Ce-this.worldSize/2,Ce+this.worldSize/2),Pe=J.x/2;Ae-Pe<H&&(S=H+Pe),Ae+Pe>Y&&(S=Y-Pe)}S===void 0&&I===void 0||(this.center=this.unproject(new n.Point(S!==void 0?S:ce.x,I!==void 0?I:ce.y)).wrap()),this._unmodified=se,this._constraining=!1}_calcMatrices(){if(!this.height)return;let h=this.centerOffset,x=this.point.x,S=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=n.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let I=n.identity(new Float64Array(16));n.scale(I,I,[this.width/2,-this.height/2,1]),n.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=n.identity(new Float64Array(16)),n.scale(I,I,[1,-1,1]),n.translate(I,I,[-1,-1,0]),n.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I;let D=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),$=Math.min(this.elevation,this._minEleveationForCurrentTile),H=D-$*this._pixelPerMeter/Math.cos(this._pitch),Y=$<0?H:D,J=Math.PI/2+this._pitch,se=this._fov*(.5+h.y/this.height),ce=Math.sin(se)*Y/Math.sin(n.clamp(Math.PI-J-se,.01,Math.PI-.01)),_e=this.getHorizon(),Ce=2*Math.atan(_e/this.cameraToCenterDistance)*(.5+h.y/(2*_e)),Ae=Math.sin(Ce)*Y/Math.sin(n.clamp(Math.PI-J-Ce,.01,Math.PI-.01)),Pe=Math.min(ce,Ae),Se=1.01*(Math.cos(Math.PI/2-this._pitch)*Pe+Y),Ve=this.height/50;I=new Float64Array(16),n.perspective(I,this._fov,this.width/this.height,Ve,Se),I[8]=2*-h.x/this.width,I[9]=2*h.y/this.height,n.scale(I,I,[1,-1,1]),n.translate(I,I,[0,0,-this.cameraToCenterDistance]),n.rotateX(I,I,this._pitch),n.rotateZ(I,I,this.angle),n.translate(I,I,[-x,-S,0]),this.mercatorMatrix=n.scale([],I,[this.worldSize,this.worldSize,this.worldSize]),n.scale(I,I,[1,1,this._pixelPerMeter]),this.pixelMatrix=n.multiply(new Float64Array(16),this.labelPlaneMatrix,I),n.translate(I,I,[0,0,-this.elevation]),this.projMatrix=I,this.invProjMatrix=n.invert([],I),this.pixelMatrix3D=n.multiply(new Float64Array(16),this.labelPlaneMatrix,I);let tt=this.width%2/2,Ne=this.height%2/2,Xe=Math.cos(this.angle),st=Math.sin(this.angle),nt=x-Math.round(x)+Xe*tt+st*Ne,ft=S-Math.round(S)+Xe*Ne+st*tt,At=new Float64Array(I);if(n.translate(At,At,[nt>.5?nt-1:nt,ft>.5?ft-1:ft,0]),this.alignedProjMatrix=At,I=n.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");this.pixelMatrixInverse=I,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;let h=this.pointCoordinate(new n.Point(0,0)),x=[h.x*this.worldSize,h.y*this.worldSize,0,1];return n.transformMat4(x,x,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){let h=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.Point(0,h))}getCameraQueryGeometry(h){let x=this.getCameraPoint();if(h.length===1)return[h[0],x];{let S=x.x,I=x.y,D=x.x,$=x.y;for(let H of h)S=Math.min(S,H.x),I=Math.min(I,H.y),D=Math.max(D,H.x),$=Math.max($,H.y);return[new n.Point(S,I),new n.Point(D,I),new n.Point(D,$),new n.Point(S,$),new n.Point(S,I)]}}}class du{constructor(h){this._getCurrentHash=()=>{let x=window.location.hash.replace("#","");if(this._hashName){let S;return x.split("&").map(I=>I.split("=")).forEach(I=>{I[0]===this._hashName&&(S=I)}),(S&&S[1]||"").split("/")}return x.split("/")},this._onHashChange=()=>{let x=this._getCurrentHash();if(x.length>=3&&!x.some(S=>isNaN(S))){let S=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(x[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+x[2],+x[1]],zoom:+x[0],bearing:S,pitch:+(x[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{let x=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,x)}catch(S){}},this._updateHash=function(x,S){let I=!1,D=null,$=()=>{D=null,I&&(x(),D=setTimeout($,300),I=!1)};return()=>(I=!0,D||$(),D)}(this._updateHashUnthrottled),this._hashName=h&&encodeURIComponent(h)}addTo(h){return this._map=h,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(h){let x=this._map.getCenter(),S=Math.round(100*this._map.getZoom())/100,I=Math.ceil((S*Math.LN2+Math.log(512/360/.5))/Math.LN10),D=Math.pow(10,I),$=Math.round(x.lng*D)/D,H=Math.round(x.lat*D)/D,Y=this._map.getBearing(),J=this._map.getPitch(),se="";if(se+=h?`/${$}/${H}/${S}`:`${S}/${H}/${$}`,(Y||J)&&(se+="/"+Math.round(10*Y)/10),J&&(se+=`/${Math.round(J)}`),this._hashName){let ce=this._hashName,_e=!1,Ce=window.location.hash.slice(1).split("&").map(Ae=>{let Pe=Ae.split("=")[0];return Pe===ce?(_e=!0,`${Pe}=${se}`):Ae}).filter(Ae=>Ae);return _e||Ce.push(`${ce}=${se}`),`#${Ce.join("&")}`}return`#${se}`}}let $h={linearity:.3,easing:n.bezier(0,0,.3,1)},z7=n.extend({deceleration:2500,maxSpeed:1400},$h),G7=n.extend({deceleration:20,maxSpeed:1400},$h),$7=n.extend({deceleration:1e3,maxSpeed:360},$h),H7=n.extend({deceleration:1e3,maxSpeed:90},$h);class V7{constructor(h){this._map=h,this.clear()}clear(){this._inertiaBuffer=[]}record(h){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.browser.now(),settings:h})}_drainInertiaBuffer(){let h=this._inertiaBuffer,x=n.browser.now();for(;h.length>0&&x-h[0].time>160;)h.shift()}_onMoveEnd(h){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let x={zoom:0,bearing:0,pitch:0,pan:new n.Point(0,0),pinchAround:void 0,around:void 0};for(let{settings:D}of this._inertiaBuffer)x.zoom+=D.zoomDelta||0,x.bearing+=D.bearingDelta||0,x.pitch+=D.pitchDelta||0,D.panDelta&&x.pan._add(D.panDelta),D.around&&(x.around=D.around),D.pinchAround&&(x.pinchAround=D.pinchAround);let S=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,I={};if(x.pan.mag()){let D=Hh(x.pan.mag(),S,n.extend({},z7,h||{}));I.offset=x.pan.mult(D.amount/x.pan.mag()),I.center=this._map.transform.center,bc(I,D)}if(x.zoom){let D=Hh(x.zoom,S,G7);I.zoom=this._map.transform.zoom+D.amount,bc(I,D)}if(x.bearing){let D=Hh(x.bearing,S,$7);I.bearing=this._map.transform.bearing+n.clamp(D.amount,-179,179),bc(I,D)}if(x.pitch){let D=Hh(x.pitch,S,H7);I.pitch=this._map.transform.pitch+D.amount,bc(I,D)}if(I.zoom||I.bearing){let D=x.pinchAround===void 0?x.around:x.pinchAround;I.around=D?this._map.unproject(D):this._map.getCenter()}return this.clear(),n.extend(I,{noMoveStart:!0})}}function bc(P,h){(!P.duration||P.duration<h.duration)&&(P.duration=h.duration,P.easing=h.easing)}function Hh(P,h,x){let{maxSpeed:S,linearity:I,deceleration:D}=x,$=n.clamp(P*I/(h/1e3),-S,S),H=Math.abs($)/(D*I);return{easing:x.easing,duration:1e3*H,amount:$*(H/2)}}class Ls extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,x,S,I={}){let D=a.mousePos(x.getCanvasContainer(),S),$=x.unproject(D);super(h,n.extend({point:D,lngLat:$,originalEvent:S},I)),this._defaultPrevented=!1,this.target=x}}class ua extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,x,S){let I=h==="touchend"?S.changedTouches:S.touches,D=a.touchPos(x.getCanvasContainer(),I),$=D.map(Y=>x.unproject(Y)),H=D.reduce((Y,J,se,ce)=>Y.add(J.div(ce.length)),new n.Point(0,0));super(h,{points:D,point:H,lngLats:$,lngLat:x.unproject(H),originalEvent:S}),this._defaultPrevented=!1}}class j7 extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,x,S){super(h,{originalEvent:S}),this._defaultPrevented=!1}}class Ol{constructor(h,x){this._map=h,this._clickTolerance=x.clickTolerance}reset(){delete this._mousedownPos}wheel(h){return this._firePreventable(new j7(h.type,this._map,h))}mousedown(h,x){return this._mousedownPos=x,this._firePreventable(new Ls(h.type,this._map,h))}mouseup(h){this._map.fire(new Ls(h.type,this._map,h))}click(h,x){this._mousedownPos&&this._mousedownPos.dist(x)>=this._clickTolerance||this._map.fire(new Ls(h.type,this._map,h))}dblclick(h){return this._firePreventable(new Ls(h.type,this._map,h))}mouseover(h){this._map.fire(new Ls(h.type,this._map,h))}mouseout(h){this._map.fire(new Ls(h.type,this._map,h))}touchstart(h){return this._firePreventable(new ua(h.type,this._map,h))}touchmove(h){this._map.fire(new ua(h.type,this._map,h))}touchend(h){this._map.fire(new ua(h.type,this._map,h))}touchcancel(h){this._map.fire(new ua(h.type,this._map,h))}_firePreventable(h){if(this._map.fire(h),h.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vh{constructor(h){this._map=h}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(h){this._map.fire(new Ls(h.type,this._map,h))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ls("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(h){this._delayContextMenu?this._contextMenuEvent=h:this._ignoreContextMenu||this._map.fire(new Ls(h.type,this._map,h)),this._map.listens("contextmenu")&&h.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jh{constructor(h){this._map=h}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(h){return this.transform.pointLocation(n.Point.convert(h),this._map.terrain)}}class Sv{constructor(h,x){this._map=h,this._tr=new jh(h),this._el=h.getCanvasContainer(),this._container=h.getContainer(),this._clickTolerance=x.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(h,x){this.isEnabled()&&h.shiftKey&&h.button===0&&(a.disableDrag(),this._startPos=this._lastPos=x,this._active=!0)}mousemoveWindow(h,x){if(!this._active)return;let S=x;if(this._lastPos.equals(S)||!this._box&&S.dist(this._startPos)<this._clickTolerance)return;let I=this._startPos;this._lastPos=S,this._box||(this._box=a.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",h));let D=Math.min(I.x,S.x),$=Math.max(I.x,S.x),H=Math.min(I.y,S.y),Y=Math.max(I.y,S.y);a.setTransform(this._box,`translate(${D}px,${H}px)`),this._box.style.width=$-D+"px",this._box.style.height=Y-H+"px"}mouseupWindow(h,x){if(!this._active||h.button!==0)return;let S=this._startPos,I=x;if(this.reset(),a.suppressClick(),S.x!==I.x||S.y!==I.y)return this._map.fire(new n.Event("boxzoomend",{originalEvent:h})),{cameraAnimation:D=>D.fitScreenCoordinates(S,I,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",h)}keydown(h){this._active&&h.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",h))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(a.remove(this._box),this._box=null),a.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(h,x){return this._map.fire(new n.Event(h,{originalEvent:x}))}}function Rp(P,h){if(P.length!==h.length)throw new Error(`The number of touches and points are not equal - touches ${P.length}, points ${h.length}`);let x={};for(let S=0;S<P.length;S++)x[P[S].identifier]=h[S];return x}class X7{constructor(h){this.reset(),this.numTouches=h.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(h,x,S){(this.centroid||S.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=h.timeStamp),S.length===this.numTouches&&(this.centroid=function(I){let D=new n.Point(0,0);for(let $ of I)D._add($);return D.div(I.length)}(x),this.touches=Rp(S,x)))}touchmove(h,x,S){if(this.aborted||!this.centroid)return;let I=Rp(S,x);for(let D in this.touches){let $=I[D];(!$||$.dist(this.touches[D])>30)&&(this.aborted=!0)}}touchend(h,x,S){if((!this.centroid||h.timeStamp-this.startTime>500)&&(this.aborted=!0),S.length===0){let I=!this.aborted&&this.centroid;if(this.reset(),I)return I}}}class fu{constructor(h){this.singleTap=new X7(h),this.numTaps=h.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(h,x,S){this.singleTap.touchstart(h,x,S)}touchmove(h,x,S){this.singleTap.touchmove(h,x,S)}touchend(h,x,S){let I=this.singleTap.touchend(h,x,S);if(I){let D=h.timeStamp-this.lastTime<500,$=!this.lastTap||this.lastTap.dist(I)<30;if(D&&$||this.reset(),this.count++,this.lastTime=h.timeStamp,this.lastTap=I,this.count===this.numTaps)return this.reset(),I}}}class wc{constructor(h){this._tr=new jh(h),this._zoomIn=new fu({numTouches:1,numTaps:2}),this._zoomOut=new fu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(h,x,S){this._zoomIn.touchstart(h,x,S),this._zoomOut.touchstart(h,x,S)}touchmove(h,x,S){this._zoomIn.touchmove(h,x,S),this._zoomOut.touchmove(h,x,S)}touchend(h,x,S){let I=this._zoomIn.touchend(h,x,S),D=this._zoomOut.touchend(h,x,S),$=this._tr;return I?(this._active=!0,h.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:H=>H.easeTo({duration:300,zoom:$.zoom+1,around:$.unproject(I)},{originalEvent:h})}):D?(this._active=!0,h.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:H=>H.easeTo({duration:300,zoom:$.zoom-1,around:$.unproject(D)},{originalEvent:h})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qt{constructor(h){this._enabled=!!h.enable,this._moveStateManager=h.moveStateManager,this._clickTolerance=h.clickTolerance||1,this._moveFunction=h.move,this._activateOnStart=!!h.activateOnStart,h.assignEvents(this),this.reset()}reset(h){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(h)}_move(...h){let x=this._moveFunction(...h);if(x.bearingDelta||x.pitchDelta||x.around||x.panDelta)return this._active=!0,x}dragStart(h,x){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(h)&&(this._moveStateManager.startMove(h),this._lastPoint=x.length?x[0]:x,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(h,x){if(!this.isEnabled())return;let S=this._lastPoint;if(!S)return;if(h.preventDefault(),!this._moveStateManager.isValidMoveEvent(h))return void this.reset(h);let I=x.length?x[0]:x;return!this._moved&&I.dist(S)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=I,this._move(S,I))}dragEnd(h){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(h)&&(this._moved&&a.suppressClick(),this.reset(h))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let W7={0:1,2:2};class pu{constructor(h){this._correctEvent=h.checkCorrectEvent}startMove(h){let x=a.mouseButton(h);this._eventButton=x}endMove(h){delete this._eventButton}isValidStartEvent(h){return this._correctEvent(h)}isValidMoveEvent(h){return!function(x,S){let I=W7[S];return x.buttons===void 0||(x.buttons&I)!==I}(h,this._eventButton)}isValidEndEvent(h){return a.mouseButton(h)===this._eventButton}}class v1{constructor(){this._firstTouch=void 0}_isOneFingerTouch(h){return h.targetTouches.length===1}_isSameTouchEvent(h){return h.targetTouches[0].identifier===this._firstTouch}startMove(h){this._firstTouch=h.targetTouches[0].identifier}endMove(h){delete this._firstTouch}isValidStartEvent(h){return this._isOneFingerTouch(h)}isValidMoveEvent(h){return this._isOneFingerTouch(h)&&this._isSameTouchEvent(h)}isValidEndEvent(h){return this._isOneFingerTouch(h)&&this._isSameTouchEvent(h)}}let V0=P=>{P.mousedown=P.dragStart,P.mousemoveWindow=P.dragMove,P.mouseup=P.dragEnd,P.contextmenu=function(h){h.preventDefault()}},jt=({enable:P,clickTolerance:h,bearingDegreesPerPixelMoved:x=.8})=>{let S=new pu({checkCorrectEvent:I=>a.mouseButton(I)===0&&I.ctrlKey||a.mouseButton(I)===2});return new qt({clickTolerance:h,move:(I,D)=>({bearingDelta:(D.x-I.x)*x}),moveStateManager:S,enable:P,assignEvents:V0})},j0=({enable:P,clickTolerance:h,pitchDegreesPerPixelMoved:x=-.5})=>{let S=new pu({checkCorrectEvent:I=>a.mouseButton(I)===0&&I.ctrlKey||a.mouseButton(I)===2});return new qt({clickTolerance:h,move:(I,D)=>({pitchDelta:(D.y-I.y)*x}),moveStateManager:S,enable:P,assignEvents:V0})};class Av{constructor(h,x){this._minTouches=h.cooperativeGestures?2:1,this._clickTolerance=h.clickTolerance||1,this._map=x,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new n.Point(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(h,x,S){return this._calculateTransform(h,x,S)}touchmove(h,x,S){if(this._map._cooperativeGestures&&(this._minTouches===2&&S.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(h,!1,S.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(S.length<this._minTouches))return h.preventDefault(),this._calculateTransform(h,x,S)}touchend(h,x,S){this._calculateTransform(h,x,S),this._active&&S.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(h,x,S){S.length>0&&(this._active=!0);let I=Rp(S,x),D=new n.Point(0,0),$=new n.Point(0,0),H=0;for(let J in I){let se=I[J],ce=this._touches[J];ce&&(D._add(se),$._add(se.sub(ce)),H++,I[J]=se)}if(this._touches=I,H<this._minTouches||!$.mag())return;let Y=$.div(H);return this._sum._add(Y),this._sum.mag()<this._clickTolerance?void 0:{around:D.div(H),panDelta:Y}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dp{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(h,x,S){this._firstTwoTouches||S.length<2||(this._firstTwoTouches=[S[0].identifier,S[1].identifier],this._start([x[0],x[1]]))}touchmove(h,x,S){if(!this._firstTwoTouches)return;h.preventDefault();let[I,D]=this._firstTwoTouches,$=b1(S,x,I),H=b1(S,x,D);if(!$||!H)return;let Y=this._aroundCenter?null:$.add(H).div(2);return this._move([$,H],Y,h)}touchend(h,x,S){if(!this._firstTwoTouches)return;let[I,D]=this._firstTwoTouches,$=b1(S,x,I),H=b1(S,x,D);$&&H||(this._active&&a.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(h){this._enabled=!0,this._aroundCenter=!!h&&h.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function b1(P,h,x){for(let S=0;S<P.length;S++)if(P[S].identifier===x)return h[S]}function Fp(P,h){return Math.log(P/h)/Math.LN2}class q7 extends Dp{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(h){this._startDistance=this._distance=h[0].dist(h[1])}_move(h,x){let S=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(Fp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Fp(this._distance,S),pinchAround:x}}}function Y7(P,h){return 180*P.angleWith(h)/Math.PI}class Cv extends Dp{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])}_move(h,x){let S=this._vector;if(this._vector=h[0].sub(h[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Y7(this._vector,S),pinchAround:x}}_isBelowThreshold(h){this._minDiameter=Math.min(this._minDiameter,h.mag());let x=25/(Math.PI*this._minDiameter)*360,S=Y7(h,this._startVector);return Math.abs(S)<x}}function Xh(P){return Math.abs(P.y)>Math.abs(P.x)}class Lp extends Dp{constructor(h){super(),this._map=h}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(h,x,S){super.touchstart(h,x,S),this._currentTouchCount=S.length}_start(h){this._lastPoints=h,Xh(h[0].sub(h[1]))&&(this._valid=!1)}_move(h,x,S){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;let I=h[0].sub(this._lastPoints[0]),D=h[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(I,D,S.timeStamp),this._valid?(this._lastPoints=h,this._active=!0,{pitchDelta:(I.y+D.y)/2*-.5}):void 0}gestureBeginsVertically(h,x,S){if(this._valid!==void 0)return this._valid;let I=h.mag()>=2,D=x.mag()>=2;if(!I&&!D)return;if(!I||!D)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;let $=h.y>0==x.y>0;return Xh(h)&&Xh(x)&&$}}let Np={panStep:100,bearingStep:15,pitchStep:10};class Op{constructor(h){this._tr=new jh(h);let x=Np;this._panStep=x.panStep,this._bearingStep=x.bearingStep,this._pitchStep=x.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(h){if(h.altKey||h.ctrlKey||h.metaKey)return;let x=0,S=0,I=0,D=0,$=0;switch(h.keyCode){case 61:case 107:case 171:case 187:x=1;break;case 189:case 109:case 173:x=-1;break;case 37:h.shiftKey?S=-1:(h.preventDefault(),D=-1);break;case 39:h.shiftKey?S=1:(h.preventDefault(),D=1);break;case 38:h.shiftKey?I=1:(h.preventDefault(),$=-1);break;case 40:h.shiftKey?I=-1:(h.preventDefault(),$=1);break;default:return}return this._rotationDisabled&&(S=0,I=0),{cameraAnimation:H=>{let Y=this._tr;H.easeTo({duration:300,easeId:"keyboardHandler",easing:uo,zoom:x?Math.round(Y.zoom)+x*(h.shiftKey?2:1):Y.zoom,bearing:Y.bearing+S*this._bearingStep,pitch:Y.pitch+I*this._pitchStep,offset:[-D*this._panStep,-$*this._panStep],center:Y.center},{originalEvent:h})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function uo(P){return P*(2-P)}let Bl=4.000244140625;class Z7{constructor(h,x){this._onTimeout=S=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(S)},this._map=h,this._tr=new jh(h),this._el=h.getCanvasContainer(),this._triggerRenderFrame=x,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(h){this._defaultZoomRate=h}setWheelZoomRate(h){this._wheelZoomRate=h}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(h){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!h&&h.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(h){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!h[this._map._metaKey])return;h.preventDefault()}let x=h.deltaMode===WheelEvent.DOM_DELTA_LINE?40*h.deltaY:h.deltaY,S=n.browser.now(),I=S-(this._lastWheelEventTime||0);this._lastWheelEventTime=S,x!==0&&x%Bl==0?this._type="wheel":x!==0&&Math.abs(x)<4?this._type="trackpad":I>400?(this._type=null,this._lastValue=x,this._timeout=setTimeout(this._onTimeout,40,h)):this._type||(this._type=Math.abs(I*x)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,x+=this._lastValue)),h.shiftKey&&x&&(x/=4),this._type&&(this._lastWheelEvent=h,this._delta-=x,this._active||this._start(h)),h.preventDefault()}_start(h){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let x=a.mousePos(this._el,h),S=this._tr;this._around=n.LngLat.convert(this._aroundCenter?S.center:S.unproject(x)),this._aroundPoint=S.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let h=this._tr.transform;if(this._delta!==0){let H=this._type==="wheel"&&Math.abs(this._delta)>Bl?this._wheelZoomRate:this._defaultZoomRate,Y=2/(1+Math.exp(-Math.abs(this._delta*H)));this._delta<0&&Y!==0&&(Y=1/Y);let J=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):h.scale;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(J*Y))),this._type==="wheel"&&(this._startZoom=h.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let x=typeof this._targetZoom=="number"?this._targetZoom:h.zoom,S=this._startZoom,I=this._easing,D,$=!1;if(this._type==="wheel"&&S&&I){let H=Math.min((n.browser.now()-this._lastWheelEventTime)/200,1),Y=I(H);D=n.interpolate.number(S,x,Y),H<1?this._frameId||(this._frameId=!0):$=!0}else D=x,$=!0;return this._active=!0,$&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!$,zoomDelta:D-h.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(h){let x=n.defaultEasing;if(this._prevEase){let S=this._prevEase,I=(n.browser.now()-S.start)/S.duration,D=S.easing(I+.01)-S.easing(I),$=.27/Math.sqrt(D*D+1e-4)*.01,H=Math.sqrt(.0729-$*$);x=n.bezier($,H,.25,1)}return this._prevEase={start:n.browser.now(),duration:h,easing:x},x}reset(){this._active=!1}}class Bp{constructor(h,x){this._clickZoom=h,this._tapZoom=x}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Up{constructor(h){this._tr=new jh(h),this.reset()}reset(){this._active=!1}dblclick(h,x){return h.preventDefault(),{cameraAnimation:S=>{S.easeTo({duration:300,zoom:this._tr.zoom+(h.shiftKey?-1:1),around:this._tr.unproject(x)},{originalEvent:h})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zp{constructor(){this._tap=new fu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(h,x,S){if(!this._swipePoint)if(this._tapTime){let I=x[0],D=h.timeStamp-this._tapTime<500,$=this._tapPoint.dist(I)<30;D&&$?S.length>0&&(this._swipePoint=I,this._swipeTouch=S[0].identifier):this.reset()}else this._tap.touchstart(h,x,S)}touchmove(h,x,S){if(this._tapTime){if(this._swipePoint){if(S[0].identifier!==this._swipeTouch)return;let I=x[0],D=I.y-this._swipePoint.y;return this._swipePoint=I,h.preventDefault(),this._active=!0,{zoomDelta:D/128}}}else this._tap.touchmove(h,x,S)}touchend(h,x,S){if(this._tapTime)this._swipePoint&&S.length===0&&this.reset();else{let I=this._tap.touchend(h,x,S);I&&(this._tapTime=h.timeStamp,this._tapPoint=I)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Q7{constructor(h,x,S){this._el=h,this._mousePan=x,this._touchPan=S}enable(h){this._inertiaOptions=h||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ha{constructor(h,x,S){this._pitchWithRotate=h.pitchWithRotate,this._mouseRotate=x,this._mousePitch=S}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ns{constructor(h,x,S,I){this._el=h,this._touchZoom=x,this._touchRotate=S,this._tapDragZoom=I,this._rotationDisabled=!1,this._enabled=!0}enable(h){this._touchZoom.enable(h),this._rotationDisabled||this._touchRotate.enable(h),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let mu=P=>P.zoom||P.drag||P.pitch||P.rotate;class Gp extends n.Event{}function X0(P){return P.panDelta&&P.panDelta.mag()||P.zoomDelta||P.bearingDelta||P.pitchDelta}class K7{constructor(h,x){this.handleWindowEvent=I=>{this.handleEvent(I,`${I.type}Window`)},this.handleEvent=(I,D)=>{if(I.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let $=I.type==="renderFrame"?void 0:I,H={needsRenderFrame:!1},Y={},J={},se=I.touches,ce=se?this._getMapTouches(se):void 0,_e=ce?a.touchPos(this._el,ce):a.mousePos(this._el,I);for(let{handlerName:Pe,handler:Se,allowed:Ve}of this._handlers){if(!Se.isEnabled())continue;let tt;this._blockedByActive(J,Ve,Pe)?Se.reset():Se[D||I.type]&&(tt=Se[D||I.type](I,_e,ce),this.mergeHandlerResult(H,Y,tt,Pe,$),tt&&tt.needsRenderFrame&&this._triggerRenderFrame()),(tt||Se.isActive())&&(J[Pe]=Se)}let Ce={};for(let Pe in this._previousActiveHandlers)J[Pe]||(Ce[Pe]=$);this._previousActiveHandlers=J,(Object.keys(Ce).length||X0(H))&&(this._changes.push([H,Y,Ce]),this._triggerRenderFrame()),(Object.keys(J).length||X0(H))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:Ae}=H;Ae&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ae(this._map))},this._map=h,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new V7(h),this._bearingSnap=x.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(x);let S=this._el;this._listeners=[[S,"touchstart",{passive:!0}],[S,"touchmove",{passive:!1}],[S,"touchend",void 0],[S,"touchcancel",void 0],[S,"mousedown",void 0],[S,"mousemove",void 0],[S,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[S,"mouseover",void 0],[S,"mouseout",void 0],[S,"dblclick",void 0],[S,"click",void 0],[S,"keydown",{capture:!1}],[S,"keyup",void 0],[S,"wheel",{passive:!1}],[S,"contextmenu",void 0],[window,"blur",void 0]];for(let[I,D,$]of this._listeners)a.addEventListener(I,D,I===document?this.handleWindowEvent:this.handleEvent,$)}destroy(){for(let[h,x,S]of this._listeners)a.removeEventListener(h,x,h===document?this.handleWindowEvent:this.handleEvent,S)}_addDefaultHandlers(h){let x=this._map,S=x.getCanvasContainer();this._add("mapEvent",new Ol(x,h));let I=x.boxZoom=new Sv(x,h);this._add("boxZoom",I),h.interactive&&h.boxZoom&&I.enable();let D=new wc(x),$=new Up(x);x.doubleClickZoom=new Bp($,D),this._add("tapZoom",D),this._add("clickZoom",$),h.interactive&&h.doubleClickZoom&&x.doubleClickZoom.enable();let H=new zp;this._add("tapDragZoom",H);let Y=x.touchPitch=new Lp(x);this._add("touchPitch",Y),h.interactive&&h.touchPitch&&x.touchPitch.enable(h.touchPitch);let J=jt(h),se=j0(h);x.dragRotate=new ha(h,J,se),this._add("mouseRotate",J,["mousePitch"]),this._add("mousePitch",se,["mouseRotate"]),h.interactive&&h.dragRotate&&x.dragRotate.enable();let ce=(({enable:Ve,clickTolerance:tt})=>{let Ne=new pu({checkCorrectEvent:Xe=>a.mouseButton(Xe)===0&&!Xe.ctrlKey});return new qt({clickTolerance:tt,move:(Xe,st)=>({around:st,panDelta:st.sub(Xe)}),activateOnStart:!0,moveStateManager:Ne,enable:Ve,assignEvents:V0})})(h),_e=new Av(h,x);x.dragPan=new Q7(S,ce,_e),this._add("mousePan",ce),this._add("touchPan",_e,["touchZoom","touchRotate"]),h.interactive&&h.dragPan&&x.dragPan.enable(h.dragPan);let Ce=new Cv,Ae=new q7;x.touchZoomRotate=new ns(S,Ae,Ce,H),this._add("touchRotate",Ce,["touchPan","touchZoom"]),this._add("touchZoom",Ae,["touchPan","touchRotate"]),h.interactive&&h.touchZoomRotate&&x.touchZoomRotate.enable(h.touchZoomRotate);let Pe=x.scrollZoom=new Z7(x,()=>this._triggerRenderFrame());this._add("scrollZoom",Pe,["mousePan"]),h.interactive&&h.scrollZoom&&x.scrollZoom.enable(h.scrollZoom);let Se=x.keyboard=new Op(x);this._add("keyboard",Se),h.interactive&&h.keyboard&&x.keyboard.enable(),this._add("blockableMapEvent",new Vh(x))}_add(h,x,S){this._handlers.push({handlerName:h,handler:x,allowed:S}),this._handlersById[h]=x}stop(h){if(!this._updatingCamera){for(let{handler:x}of this._handlers)x.reset();this._inertia.clear(),this._fireEvents({},{},h),this._changes=[]}}isActive(){for(let{handler:h}of this._handlers)if(h.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!mu(this._eventsInProgress)||this.isZooming()}_blockedByActive(h,x,S){for(let I in h)if(I!==S&&(!x||x.indexOf(I)<0))return!0;return!1}_getMapTouches(h){let x=[];for(let S of h)this._el.contains(S.target)&&x.push(S);return x}mergeHandlerResult(h,x,S,I,D){if(!S)return;n.extend(h,S);let $={handlerName:I,originalEvent:S.originalEvent||D};S.zoomDelta!==void 0&&(x.zoom=$),S.panDelta!==void 0&&(x.drag=$),S.pitchDelta!==void 0&&(x.pitch=$),S.bearingDelta!==void 0&&(x.rotate=$)}_applyChanges(){let h={},x={},S={};for(let[I,D,$]of this._changes)I.panDelta&&(h.panDelta=(h.panDelta||new n.Point(0,0))._add(I.panDelta)),I.zoomDelta&&(h.zoomDelta=(h.zoomDelta||0)+I.zoomDelta),I.bearingDelta&&(h.bearingDelta=(h.bearingDelta||0)+I.bearingDelta),I.pitchDelta&&(h.pitchDelta=(h.pitchDelta||0)+I.pitchDelta),I.around!==void 0&&(h.around=I.around),I.pinchAround!==void 0&&(h.pinchAround=I.pinchAround),I.noInertia&&(h.noInertia=I.noInertia),n.extend(x,D),n.extend(S,$);this._updateMapTransform(h,x,S),this._changes=[]}_updateMapTransform(h,x,S){let I=this._map,D=I._getTransformForUpdate(),$=I.terrain;if(!(X0(h)||$&&this._terrainMovement))return this._fireEvents(x,S,!0);let{panDelta:H,zoomDelta:Y,bearingDelta:J,pitchDelta:se,around:ce,pinchAround:_e}=h;_e!==void 0&&(ce=_e),I._stop(!0),ce=ce||I.transform.centerPoint;let Ce=D.pointLocation(H?ce.sub(H):ce);J&&(D.bearing+=J),se&&(D.pitch+=se),Y&&(D.zoom+=Y),$?this._terrainMovement||!x.drag&&!x.zoom?x.drag&&this._terrainMovement?D.center=D.pointLocation(D.centerPoint.sub(H)):D.setLocationAtPoint(Ce,ce):(this._terrainMovement=!0,this._map._elevationFreeze=!0,D.setLocationAtPoint(Ce,ce),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,D.recalculateZoom(I.terrain)})):D.setLocationAtPoint(Ce,ce),I._applyUpdatedTransform(D),this._map._update(),h.noInertia||this._inertia.record(h),this._fireEvents(x,S,!0)}_fireEvents(h,x,S){let I=mu(this._eventsInProgress),D=mu(h),$={};for(let se in h){let{originalEvent:ce}=h[se];this._eventsInProgress[se]||($[`${se}start`]=ce),this._eventsInProgress[se]=h[se]}!I&&D&&this._fireEvent("movestart",D.originalEvent);for(let se in $)this._fireEvent(se,$[se]);D&&this._fireEvent("move",D.originalEvent);for(let se in h){let{originalEvent:ce}=h[se];this._fireEvent(se,ce)}let H={},Y;for(let se in this._eventsInProgress){let{handlerName:ce,originalEvent:_e}=this._eventsInProgress[se];this._handlersById[ce].isActive()||(delete this._eventsInProgress[se],Y=x[ce]||_e,H[`${se}end`]=Y)}for(let se in H)this._fireEvent(se,H[se]);let J=mu(this._eventsInProgress);if(S&&(I||D)&&!J){this._updatingCamera=!0;let se=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ce=_e=>_e!==0&&-this._bearingSnap<_e&&_e<this._bearingSnap;se?(ce(se.bearing||this._map.getBearing())&&(se.bearing=0),se.freezeElevation=!0,this._map.easeTo(se,{originalEvent:Y})):(this._map.fire(new n.Event("moveend",{originalEvent:Y})),ce(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(h,x){this._map.fire(new n.Event(h,x?{originalEvent:x}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(h=>{delete this._frameId,this.handleEvent(new Gp("renderFrame",{timeStamp:h})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class J7 extends n.Evented{constructor(h,x){super(),this._renderFrameCallback=()=>{let S=Math.min((n.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(S)),S<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=x.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new n.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(h,x){return this.jumpTo({center:h},x)}panBy(h,x,S){return h=n.Point.convert(h).mult(-1),this.panTo(this.transform.center,n.extend({offset:h},x),S)}panTo(h,x,S){return this.easeTo(n.extend({center:h},x),S)}getZoom(){return this.transform.zoom}setZoom(h,x){return this.jumpTo({zoom:h},x),this}zoomTo(h,x,S){return this.easeTo(n.extend({zoom:h},x),S)}zoomIn(h,x){return this.zoomTo(this.getZoom()+1,h,x),this}zoomOut(h,x){return this.zoomTo(this.getZoom()-1,h,x),this}getBearing(){return this.transform.bearing}setBearing(h,x){return this.jumpTo({bearing:h},x),this}getPadding(){return this.transform.padding}setPadding(h,x){return this.jumpTo({padding:h},x),this}rotateTo(h,x,S){return this.easeTo(n.extend({bearing:h},x),S)}resetNorth(h,x){return this.rotateTo(0,n.extend({duration:1e3},h),x),this}resetNorthPitch(h,x){return this.easeTo(n.extend({bearing:0,pitch:0,duration:1e3},h),x),this}snapToNorth(h,x){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,x):this}getPitch(){return this.transform.pitch}setPitch(h,x){return this.jumpTo({pitch:h},x),this}cameraForBounds(h,x){h=oe.convert(h);let S=x&&x.bearing||0;return this._cameraForBoxAndBearing(h.getNorthWest(),h.getSouthEast(),S,x)}_cameraForBoxAndBearing(h,x,S,I){let D={top:0,bottom:0,right:0,left:0};if(typeof(I=n.extend({padding:D,offset:[0,0],maxZoom:this.transform.maxZoom},I)).padding=="number"){let st=I.padding;I.padding={top:st,bottom:st,right:st,left:st}}I.padding=n.extend(D,I.padding);let $=this.transform,H=$.padding,Y=$.project(n.LngLat.convert(h)),J=$.project(n.LngLat.convert(x)),se=Y.rotate(-S*Math.PI/180),ce=J.rotate(-S*Math.PI/180),_e=new n.Point(Math.max(se.x,ce.x),Math.max(se.y,ce.y)),Ce=new n.Point(Math.min(se.x,ce.x),Math.min(se.y,ce.y)),Ae=_e.sub(Ce),Pe=($.width-(H.left+H.right+I.padding.left+I.padding.right))/Ae.x,Se=($.height-(H.top+H.bottom+I.padding.top+I.padding.bottom))/Ae.y;if(Se<0||Pe<0)return void n.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let Ve=Math.min($.scaleZoom($.scale*Math.min(Pe,Se)),I.maxZoom),tt=n.Point.convert(I.offset),Ne=new n.Point((I.padding.left-I.padding.right)/2,(I.padding.top-I.padding.bottom)/2).rotate(S*Math.PI/180),Xe=tt.add(Ne).mult($.scale/$.zoomScale(Ve));return{center:$.unproject(Y.add(J).div(2).sub(Xe)),zoom:Ve,bearing:S}}fitBounds(h,x,S){return this._fitInternal(this.cameraForBounds(h,x),x,S)}fitScreenCoordinates(h,x,S,I,D){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(n.Point.convert(h)),this.transform.pointLocation(n.Point.convert(x)),S,I),I,D)}_fitInternal(h,x,S){return h?(delete(x=n.extend(h,x)).padding,x.linear?this.easeTo(x,S):this.flyTo(x,S)):this}jumpTo(h,x){this.stop();let S=this._getTransformForUpdate(),I=!1,D=!1,$=!1;return"zoom"in h&&S.zoom!==+h.zoom&&(I=!0,S.zoom=+h.zoom),h.center!==void 0&&(S.center=n.LngLat.convert(h.center)),"bearing"in h&&S.bearing!==+h.bearing&&(D=!0,S.bearing=+h.bearing),"pitch"in h&&S.pitch!==+h.pitch&&($=!0,S.pitch=+h.pitch),h.padding==null||S.isPaddingEqual(h.padding)||(S.padding=h.padding),this._applyUpdatedTransform(S),this.fire(new n.Event("movestart",x)).fire(new n.Event("move",x)),I&&this.fire(new n.Event("zoomstart",x)).fire(new n.Event("zoom",x)).fire(new n.Event("zoomend",x)),D&&this.fire(new n.Event("rotatestart",x)).fire(new n.Event("rotate",x)).fire(new n.Event("rotateend",x)),$&&this.fire(new n.Event("pitchstart",x)).fire(new n.Event("pitch",x)).fire(new n.Event("pitchend",x)),this.fire(new n.Event("moveend",x))}calculateCameraOptionsFromTo(h,x,S,I=0){let D=n.MercatorCoordinate.fromLngLat(h,x),$=n.MercatorCoordinate.fromLngLat(S,I),H=$.x-D.x,Y=$.y-D.y,J=$.z-D.z,se=Math.hypot(H,Y,J);if(se===0)throw new Error("Can't calculate camera options with same From and To");let ce=Math.hypot(H,Y),_e=this.transform.scaleZoom(this.transform.cameraToCenterDistance/se/this.transform.tileSize),Ce=180*Math.atan2(H,-Y)/Math.PI,Ae=180*Math.acos(ce/se)/Math.PI;return Ae=J<0?90-Ae:90+Ae,{center:$.toLngLat(),zoom:_e,pitch:Ae,bearing:Ce}}easeTo(h,x){this._stop(!1,h.easeId),((h=n.extend({offset:[0,0],duration:500,easing:n.defaultEasing},h)).animate===!1||!h.essential&&n.browser.prefersReducedMotion)&&(h.duration=0);let S=this._getTransformForUpdate(),I=this.getZoom(),D=this.getBearing(),$=this.getPitch(),H=this.getPadding(),Y="zoom"in h?+h.zoom:I,J="bearing"in h?this._normalizeBearing(h.bearing,D):D,se="pitch"in h?+h.pitch:$,ce="padding"in h?h.padding:S.padding,_e=n.Point.convert(h.offset),Ce=S.centerPoint.add(_e),Ae=S.pointLocation(Ce),Pe=n.LngLat.convert(h.center||Ae);this._normalizeCenter(Pe);let Se=S.project(Ae),Ve=S.project(Pe).sub(Se),tt=S.zoomScale(Y-I),Ne,Xe;h.around&&(Ne=n.LngLat.convert(h.around),Xe=S.locationPoint(Ne));let st={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Y!==I,this._rotating=this._rotating||D!==J,this._pitching=this._pitching||se!==$,this._padding=!S.isPaddingEqual(ce),this._easeId=h.easeId,this._prepareEase(x,h.noMoveStart,st),this.terrain&&this._prepareElevation(Pe),this._ease(nt=>{if(this._zooming&&(S.zoom=n.interpolate.number(I,Y,nt)),this._rotating&&(S.bearing=n.interpolate.number(D,J,nt)),this._pitching&&(S.pitch=n.interpolate.number($,se,nt)),this._padding&&(S.interpolatePadding(H,ce,nt),Ce=S.centerPoint.add(_e)),this.terrain&&!h.freezeElevation&&this._updateElevation(nt),Ne)S.setLocationAtPoint(Ne,Xe);else{let ft=S.zoomScale(S.zoom-I),At=Y>I?Math.min(2,tt):Math.max(.5,tt),vt=Math.pow(At,1-nt),Mt=S.unproject(Se.add(Ve.mult(nt*vt)).mult(ft));S.setLocationAtPoint(S.renderWorldCopies?Mt.wrap():Mt,Ce)}this._applyUpdatedTransform(S),this._fireMoveEvents(x)},nt=>{this.terrain&&this._finalizeElevation(),this._afterEase(x,nt)},h),this}_prepareEase(h,x,S={}){this._moving=!0,x||S.moving||this.fire(new n.Event("movestart",h)),this._zooming&&!S.zooming&&this.fire(new n.Event("zoomstart",h)),this._rotating&&!S.rotating&&this.fire(new n.Event("rotatestart",h)),this._pitching&&!S.pitching&&this.fire(new n.Event("pitchstart",h))}_prepareElevation(h){this._elevationCenter=h,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(h){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);let x=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(h<1&&x!==this._elevationTarget){let S=this._elevationTarget-this._elevationStart;this._elevationStart+=h*(S-(x-(S*h+this._elevationStart))/(1-h)),this._elevationTarget=x}this.transform.elevation=n.interpolate.number(this._elevationStart,this._elevationTarget,h)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(h){if(!this.transformCameraUpdate)return;let x=h.clone(),{center:S,zoom:I,pitch:D,bearing:$,elevation:H}=this.transformCameraUpdate(x);S&&(x.center=S),I!==void 0&&(x.zoom=I),D!==void 0&&(x.pitch=D),$!==void 0&&(x.bearing=$),H!==void 0&&(x.elevation=H),this.transform.apply(x)}_fireMoveEvents(h){this.fire(new n.Event("move",h)),this._zooming&&this.fire(new n.Event("zoom",h)),this._rotating&&this.fire(new n.Event("rotate",h)),this._pitching&&this.fire(new n.Event("pitch",h))}_afterEase(h,x){if(this._easeId&&x&&this._easeId===x)return;delete this._easeId;let S=this._zooming,I=this._rotating,D=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new n.Event("zoomend",h)),I&&this.fire(new n.Event("rotateend",h)),D&&this.fire(new n.Event("pitchend",h)),this.fire(new n.Event("moveend",h))}flyTo(h,x){if(!h.essential&&n.browser.prefersReducedMotion){let Jt=n.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Jt,x)}this.stop(),h=n.extend({offset:[0,0],speed:1.2,curve:1.42,easing:n.defaultEasing},h);let S=this._getTransformForUpdate(),I=this.getZoom(),D=this.getBearing(),$=this.getPitch(),H=this.getPadding(),Y="zoom"in h?n.clamp(+h.zoom,S.minZoom,S.maxZoom):I,J="bearing"in h?this._normalizeBearing(h.bearing,D):D,se="pitch"in h?+h.pitch:$,ce="padding"in h?h.padding:S.padding,_e=S.zoomScale(Y-I),Ce=n.Point.convert(h.offset),Ae=S.centerPoint.add(Ce),Pe=S.pointLocation(Ae),Se=n.LngLat.convert(h.center||Pe);this._normalizeCenter(Se);let Ve=S.project(Pe),tt=S.project(Se).sub(Ve),Ne=h.curve,Xe=Math.max(S.width,S.height),st=Xe/_e,nt=tt.mag();if("minZoom"in h){let Jt=n.clamp(Math.min(h.minZoom,I,Y),S.minZoom,S.maxZoom),Yr=Xe/S.zoomScale(Jt-I);Ne=Math.sqrt(Yr/nt*2)}let ft=Ne*Ne;function At(Jt){let Yr=(st*st-Xe*Xe+(Jt?-1:1)*ft*ft*nt*nt)/(2*(Jt?st:Xe)*ft*nt);return Math.log(Math.sqrt(Yr*Yr+1)-Yr)}function vt(Jt){return(Math.exp(Jt)-Math.exp(-Jt))/2}function Mt(Jt){return(Math.exp(Jt)+Math.exp(-Jt))/2}let li=At(!1),dr=function(Jt){return Mt(li)/Mt(li+Ne*Jt)},Ut=function(Jt){return Xe*((Mt(li)*(vt(Yr=li+Ne*Jt)/Mt(Yr))-vt(li))/ft)/nt;var Yr},Ii=(At(!0)-li)/Ne;if(Math.abs(nt)<1e-6||!isFinite(Ii)){if(Math.abs(Xe-st)<1e-6)return this.easeTo(h,x);let Jt=st<Xe?-1:1;Ii=Math.abs(Math.log(st/Xe))/Ne,Ut=function(){return 0},dr=function(Yr){return Math.exp(Jt*Ne*Yr)}}return h.duration="duration"in h?+h.duration:1e3*Ii/("screenSpeed"in h?+h.screenSpeed/Ne:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0),this._zooming=!0,this._rotating=D!==J,this._pitching=se!==$,this._padding=!S.isPaddingEqual(ce),this._prepareEase(x,!1),this.terrain&&this._prepareElevation(Se),this._ease(Jt=>{let Yr=Jt*Ii,cr=1/dr(Yr);S.zoom=Jt===1?Y:I+S.scaleZoom(cr),this._rotating&&(S.bearing=n.interpolate.number(D,J,Jt)),this._pitching&&(S.pitch=n.interpolate.number($,se,Jt)),this._padding&&(S.interpolatePadding(H,ce,Jt),Ae=S.centerPoint.add(Ce)),this.terrain&&!h.freezeElevation&&this._updateElevation(Jt);let ir=Jt===1?Se:S.unproject(Ve.add(tt.mult(Ut(Yr))).mult(cr));S.setLocationAtPoint(S.renderWorldCopies?ir.wrap():ir,Ae),this._applyUpdatedTransform(S),this._fireMoveEvents(x)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(x)},h),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(h,x){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,x)}if(!h){let S=this.handlers;S&&S.stop(!1)}return this}_ease(h,x,S){S.animate===!1||S.duration===0?(h(1),x()):(this._easeStart=n.browser.now(),this._easeOptions=S,this._onEaseFrame=h,this._onEaseEnd=x,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(h,x){h=n.wrap(h,-180,180);let S=Math.abs(h-x);return Math.abs(h-360-x)<S&&(h-=360),Math.abs(h+360-x)<S&&(h+=360),h}_normalizeCenter(h){let x=this.transform;if(!x.renderWorldCopies||x.lngRange)return;let S=h.lng-x.center.lng;h.lng+=S>180?-360:S<-180?360:0}queryTerrainElevation(h){return this.terrain?this.terrain.getElevationForLngLatZoom(n.LngLat.convert(h),this.transform.tileZoom)-this.transform.elevation:null}}class e9{constructor(h={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=x=>{!x||x.sourceDataType!=="metadata"&&x.sourceDataType!=="visibility"&&x.dataType!=="style"&&x.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=h}getDefaultPosition(){return"bottom-right"}onAdd(h){return this._map=h,this._compact=this.options&&this.options.compact,this._container=a.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=a.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=a.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){a.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(h,x){let S=this._map._getUIString(`AttributionControl.${x}`);h.title=S,h.setAttribute("aria-label",S)}_updateAttributions(){if(!this._map.style)return;let h=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?h=h.concat(this.options.customAttribution.map(I=>typeof I!="string"?"":I)):typeof this.options.customAttribution=="string"&&h.push(this.options.customAttribution)),this._map.style.stylesheet){let I=this._map.style.stylesheet;this.styleOwner=I.owner,this.styleId=I.id}let x=this._map.style.sourceCaches;for(let I in x){let D=x[I];if(D.used||D.usedForTerrain){let $=D.getSource();$.attribution&&h.indexOf($.attribution)<0&&h.push($.attribution)}}h=h.filter(I=>String(I).trim()),h.sort((I,D)=>I.length-D.length),h=h.filter((I,D)=>{for(let $=D+1;$<h.length;$++)if(h[$].indexOf(I)>=0)return!1;return!0});let S=h.join(" | ");S!==this._attribHTML&&(this._attribHTML=S,h.length?(this._innerContainer.innerHTML=S,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ra{constructor(h={}){this._updateCompact=()=>{let x=this._container.children;if(x.length){let S=x[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&S.classList.add("maplibregl-compact"):S.classList.remove("maplibregl-compact")}},this.options=h}getDefaultPosition(){return"bottom-left"}onAdd(h){this._map=h,this._compact=this.options&&this.options.compact,this._container=a.create("div","maplibregl-ctrl");let x=a.create("a","maplibregl-ctrl-logo");return x.target="_blank",x.rel="noopener nofollow",x.href="https://maplibre.org/",x.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),x.setAttribute("rel","noopener nofollow"),this._container.appendChild(x),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){a.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class W0{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(h){let x=++this._id;return this._queue.push({callback:h,id:x,cancelled:!1}),x}remove(h){let x=this._currentlyRunning,S=x?this._queue.concat(x):this._queue;for(let I of S)if(I.id===h)return void(I.cancelled=!0)}run(h=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let x=this._currentlyRunning=this._queue;this._queue=[];for(let S of x)if(!S.cancelled&&(S.callback(h),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}let pi={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Ci=n.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class q0 extends n.Evented{constructor(h){super(),this.sourceCache=h,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,h.usedForTerrain=!0,h.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(h,x){this.sourceCache.update(h,x),this._renderableTilesKeys=[];let S={};for(let I of h.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:x}))S[I.key]=!0,this._renderableTilesKeys.push(I.key),this._tiles[I.key]||(I.posMatrix=new Float64Array(16),n.ortho(I.posMatrix,0,n.EXTENT,0,n.EXTENT,0,1),this._tiles[I.key]=new je(I,this.tileSize));for(let I in this._tiles)S[I]||delete this._tiles[I]}freeRtt(h){for(let x in this._tiles){let S=this._tiles[x];(!h||S.tileID.equals(h)||S.tileID.isChildOf(h)||h.isChildOf(S.tileID))&&(S.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(h=>this.getTileByID(h))}getTileByID(h){return this._tiles[h]}getTerrainCoords(h){let x={};for(let S of this._renderableTilesKeys){let I=this._tiles[S].tileID;if(I.canonical.equals(h.canonical)){let D=h.clone();D.posMatrix=new Float64Array(16),n.ortho(D.posMatrix,0,n.EXTENT,0,n.EXTENT,0,1),x[S]=D}else if(I.canonical.isChildOf(h.canonical)){let D=h.clone();D.posMatrix=new Float64Array(16);let $=I.canonical.z-h.canonical.z,H=I.canonical.x-(I.canonical.x>>$<<$),Y=I.canonical.y-(I.canonical.y>>$<<$),J=n.EXTENT>>$;n.ortho(D.posMatrix,0,J,0,J,0,1),n.translate(D.posMatrix,D.posMatrix,[-H*J,-Y*J,0]),x[S]=D}else if(h.canonical.isChildOf(I.canonical)){let D=h.clone();D.posMatrix=new Float64Array(16);let $=h.canonical.z-I.canonical.z,H=h.canonical.x-(h.canonical.x>>$<<$),Y=h.canonical.y-(h.canonical.y>>$<<$),J=n.EXTENT>>$;n.ortho(D.posMatrix,0,n.EXTENT,0,n.EXTENT,0,1),n.translate(D.posMatrix,D.posMatrix,[H*J,Y*J,0]),n.scale(D.posMatrix,D.posMatrix,[1/2**$,1/2**$,0]),x[S]=D}}return x}getSourceTile(h,x){let S=this.sourceCache._source,I=h.overscaledZ-this.deltaZoom;if(I>S.maxzoom&&(I=S.maxzoom),I<S.minzoom)return null;this._sourceTileCache[h.key]||(this._sourceTileCache[h.key]=h.scaledTo(I).key);let D=this.sourceCache.getTileByID(this._sourceTileCache[h.key]);if((!D||!D.dem)&&x)for(;I>=S.minzoom&&(!D||!D.dem);)D=this.sourceCache.getTileByID(h.scaledTo(I--).key);return D}tilesAfterTime(h=Date.now()){return Object.values(this._tiles).filter(x=>x.timeAdded>=h)}}class $p{constructor(h,x,S){this.painter=h,this.sourceCache=new q0(x),this.options=S,this.exaggeration=typeof S.exaggeration=="number"?S.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(h,x,S,I=n.EXTENT){var D;if(!(x>=0&&x<I&&S>=0&&S<I))return 0;let $=this.getTerrainData(h),H=(D=$.tile)===null||D===void 0?void 0:D.dem;if(!H)return 0;let Y=function(Ae,Pe,Se){var Ve=Pe[0],tt=Pe[1];return Ae[0]=Se[0]*Ve+Se[4]*tt+Se[12],Ae[1]=Se[1]*Ve+Se[5]*tt+Se[13],Ae}([],[x/I*n.EXTENT,S/I*n.EXTENT],$.u_terrain_matrix),J=[Y[0]*H.dim,Y[1]*H.dim],se=Math.floor(J[0]),ce=Math.floor(J[1]),_e=J[0]-se,Ce=J[1]-ce;return H.get(se,ce)*(1-_e)*(1-Ce)+H.get(se+1,ce)*_e*(1-Ce)+H.get(se,ce+1)*(1-_e)*Ce+H.get(se+1,ce+1)*_e*Ce}getElevationForLngLatZoom(h,x){let{tileID:S,mercatorX:I,mercatorY:D}=this._getOverscaledTileIDFromLngLatZoom(h,x);return this.getElevation(S,I%n.EXTENT,D%n.EXTENT,n.EXTENT)}getElevation(h,x,S,I=n.EXTENT){return this.getDEMElevation(h,x,S,I)*this.exaggeration}getTerrainData(h){if(!this._emptyDemTexture){let I=this.painter.context,D=new n.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new U(I,D,I.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new U(I,new n.RGBAImage({width:1,height:1}),I.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(I.gl.NEAREST,I.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=n.identity([])}let x=this.sourceCache.getSourceTile(h,!0);if(x&&x.dem&&(!x.demTexture||x.needsTerrainPrepare)){let I=this.painter.context;x.demTexture=this.painter.getTileTexture(x.dem.stride),x.demTexture?x.demTexture.update(x.dem.getPixels(),{premultiply:!1}):x.demTexture=new U(I,x.dem.getPixels(),I.gl.RGBA,{premultiply:!1}),x.demTexture.bind(I.gl.NEAREST,I.gl.CLAMP_TO_EDGE),x.needsTerrainPrepare=!1}let S=x&&x+x.tileID.key+h.key;if(S&&!this._demMatrixCache[S]){let I=this.sourceCache.sourceCache._source.maxzoom,D=h.canonical.z-x.tileID.canonical.z;h.overscaledZ>h.canonical.z&&(h.canonical.z>=I?D=h.canonical.z-I:n.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let $=h.canonical.x-(h.canonical.x>>D<<D),H=h.canonical.y-(h.canonical.y>>D<<D),Y=n.fromScaling(new Float64Array(16),[1/(n.EXTENT<<D),1/(n.EXTENT<<D),0]);n.translate(Y,Y,[$*n.EXTENT,H*n.EXTENT,0]),this._demMatrixCache[h.key]={matrix:Y,coord:h}}return{u_depth:2,u_terrain:3,u_terrain_dim:x&&x.dem&&x.dem.dim||1,u_terrain_matrix:S?this._demMatrixCache[h.key].matrix:this._emptyDemMatrix,u_terrain_unpack:x&&x.dem&&x.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(x&&x.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:x}}getFramebuffer(h){let x=this.painter,S=x.width/devicePixelRatio,I=x.height/devicePixelRatio;return!this._fbo||this._fbo.width===S&&this._fbo.height===I||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new U(x.context,{width:S,height:I,data:null},x.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(x.context.gl.NEAREST,x.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new U(x.context,{width:S,height:I,data:null},x.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(x.context.gl.NEAREST,x.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=x.context.createFramebuffer(S,I,!0,!1),this._fbo.depthAttachment.set(x.context.createRenderbuffer(x.context.gl.DEPTH_COMPONENT16,S,I))),this._fbo.colorAttachment.set(h==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let h=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let x=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let D=0,$=0;D<this._coordsTextureSize;D++)for(let H=0;H<this._coordsTextureSize;H++,$+=4)x[$+0]=255&H,x[$+1]=255&D,x[$+2]=H>>8<<4|D>>8,x[$+3]=0;let S=new n.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(x.buffer)),I=new U(h,S,h.gl.RGBA,{premultiply:!1});return I.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._coordsTexture=I,I}pointCoordinate(h){let x=new Uint8Array(4),S=this.painter.context,I=S.gl;S.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),I.readPixels(h.x,this.painter.height/devicePixelRatio-h.y-1,1,1,I.RGBA,I.UNSIGNED_BYTE,x),S.bindFramebuffer.set(null);let D=x[0]+(x[2]>>4<<8),$=x[1]+((15&x[2])<<8),H=this.coordsIndex[255-x[3]],Y=H&&this.sourceCache.getTileByID(H);if(!Y)return null;let J=this._coordsTextureSize,se=(1<<Y.tileID.canonical.z)*J;return new n.MercatorCoordinate((Y.tileID.canonical.x*J+D)/se,(Y.tileID.canonical.y*J+$)/se,this.getElevation(Y.tileID,D,$,J))}getTerrainMesh(){if(this._mesh)return this._mesh;let h=this.painter.context,x=new n.Pos3dArray,S=new n.TriangleIndexArray,I=this.meshSize,D=n.EXTENT/I,$=I*I;for(let ce=0;ce<=I;ce++)for(let _e=0;_e<=I;_e++)x.emplaceBack(_e*D,ce*D,0);for(let ce=0;ce<$;ce+=I+1)for(let _e=0;_e<I;_e++)S.emplaceBack(_e+ce,I+_e+ce+1,I+_e+ce+2),S.emplaceBack(_e+ce,I+_e+ce+2,_e+ce+1);let H=x.length,Y=H+2*(I+1);for(let ce of[0,1])for(let _e=0;_e<=I;_e++)for(let Ce of[0,1])x.emplaceBack(_e*D,ce*n.EXTENT,Ce);for(let ce=0;ce<2*I;ce+=2)S.emplaceBack(Y+ce,Y+ce+1,Y+ce+3),S.emplaceBack(Y+ce,Y+ce+3,Y+ce+2),S.emplaceBack(H+ce,H+ce+3,H+ce+1),S.emplaceBack(H+ce,H+ce+2,H+ce+3);let J=x.length,se=J+2*(I+1);for(let ce of[0,1])for(let _e=0;_e<=I;_e++)for(let Ce of[0,1])x.emplaceBack(ce*n.EXTENT,_e*D,Ce);for(let ce=0;ce<2*I;ce+=2)S.emplaceBack(J+ce,J+ce+1,J+ce+3),S.emplaceBack(J+ce,J+ce+3,J+ce+2),S.emplaceBack(se+ce,se+ce+3,se+ce+1),S.emplaceBack(se+ce,se+ce+2,se+ce+3);return this._mesh={indexBuffer:h.createIndexBuffer(S),vertexBuffer:h.createVertexBuffer(x,Ci.members),segments:n.SegmentVector.simpleSegment(0,0,x.length,S.length)},this._mesh}getMeshFrameDelta(h){return 2*Math.PI*n.earthRadius/Math.pow(2,h)/5}getMinTileElevationForLngLatZoom(h,x){var S;let{tileID:I}=this._getOverscaledTileIDFromLngLatZoom(h,x);return(S=this.getMinMaxElevation(I).minElevation)!==null&&S!==void 0?S:0}getMinMaxElevation(h){let x=this.getTerrainData(h).tile,S={minElevation:null,maxElevation:null};return x&&x.dem&&(S.minElevation=x.dem.min*this.exaggeration,S.maxElevation=x.dem.max*this.exaggeration),S}_getOverscaledTileIDFromLngLatZoom(h,x){let S=n.MercatorCoordinate.fromLngLat(h.wrap()),I=(1<<x)*n.EXTENT,D=S.x*I,$=S.y*I,H=Math.floor(D/n.EXTENT),Y=Math.floor($/n.EXTENT);return{tileID:new n.OverscaledTileID(x,0,x,H,Y),mercatorX:D,mercatorY:$}}}class Hp{constructor(h,x,S){this._context=h,this._size=x,this._tileSize=S,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let h of this._objects)h.texture.destroy(),h.fbo.destroy()}_createObject(h){let x=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),S=new U(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return S.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),x.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),x.colorAttachment.set(S.texture),{id:h,fbo:x,texture:S,stamp:-1,inUse:!1}}getObjectForId(h){return this._objects[h]}useObject(h){h.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(x=>h.id!==x),this._recentlyUsed.push(h.id)}stampObject(h){h.stamp=++this._stamp}getOrCreateFreeObject(){for(let x of this._recentlyUsed)if(!this._objects[x].inUse)return this._objects[x];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let h=this._createObject(this._objects.length);return this._objects.push(h),h}freeObject(h){h.inUse=!1}freeAllObjects(){for(let h of this._objects)this.freeObject(h)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(h=>!h.inUse)===!1}}let ln={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class t9{constructor(h,x){this.painter=h,this.terrain=x,this.pool=new Hp(h.context,30,x.sourceCache.tileSize*x.qualityFactor)}destruct(){this.pool.destruct()}getTexture(h){return this.pool.getObjectForId(h.rtt[this._stacks.length-1].id).texture}prepareForRender(h,x){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=h._order.filter(S=>!h._layers[S].isHidden(x)),this._coordsDescendingInv={};for(let S in h.sourceCaches){this._coordsDescendingInv[S]={};let I=h.sourceCaches[S].getVisibleCoordinates();for(let D of I){let $=this.terrain.sourceCache.getTerrainCoords(D);for(let H in $)this._coordsDescendingInv[S][H]||(this._coordsDescendingInv[S][H]=[]),this._coordsDescendingInv[S][H].push($[H])}}this._coordsDescendingInvStr={};for(let S of h._order){let I=h._layers[S],D=I.source;if(ln[I.type]&&!this._coordsDescendingInvStr[D]){this._coordsDescendingInvStr[D]={};for(let $ in this._coordsDescendingInv[D])this._coordsDescendingInvStr[D][$]=this._coordsDescendingInv[D][$].map(H=>H.key).sort().join()}}for(let S of this._renderableTiles)for(let I in this._coordsDescendingInvStr){let D=this._coordsDescendingInvStr[I][S.tileID.key];D&&D!==S.rttCoords[I]&&(S.rtt=[])}}renderLayer(h){if(h.isHidden(this.painter.transform.zoom))return!1;let x=h.type,S=this.painter,I=this._renderableLayerIds[this._renderableLayerIds.length-1]===h.id;if(ln[x]&&(this._prevType&&ln[this._prevType]||this._stacks.push([]),this._prevType=x,this._stacks[this._stacks.length-1].push(h.id),!I))return!0;if(ln[this._prevType]||ln[x]&&I){this._prevType=x;let D=this._stacks.length-1,$=this._stacks[D]||[];for(let H of this._renderableTiles){if(this.pool.isFull()&&(z0(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(H),H.rtt[D]){let J=this.pool.getObjectForId(H.rtt[D].id);if(J.stamp===H.rtt[D].stamp){this.pool.useObject(J);continue}}let Y=this.pool.getOrCreateFreeObject();this.pool.useObject(Y),this.pool.stampObject(Y),H.rtt[D]={id:Y.id,stamp:Y.stamp},S.context.bindFramebuffer.set(Y.fbo.framebuffer),S.context.clear({color:n.Color.transparent,stencil:0}),S.currentStencilSource=void 0;for(let J=0;J<$.length;J++){let se=S.style._layers[$[J]],ce=se.source?this._coordsDescendingInv[se.source][H.tileID.key]:[H.tileID];S.context.viewport.set([0,0,Y.fbo.width,Y.fbo.height]),S._renderTileClippingMasks(se,ce),S.renderLayer(S,S.style.sourceCaches[se.source],se,ce),se.source&&(H.rttCoords[se.source]=this._coordsDescendingInvStr[se.source][H.tileID.key])}}return z0(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ln[x]}return!1}}let ul=o,Iv={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:n.config.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},w1=P=>{P.touchstart=P.dragStart,P.touchmoveWindow=P.dragMove,P.touchend=P.dragEnd},xs={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ns{constructor(h,x,S=!1){this.mousedown=$=>{this.startMouse(n.extend({},$,{ctrlKey:!0,preventDefault:()=>$.preventDefault()}),a.mousePos(this.element,$)),a.addEventListener(window,"mousemove",this.mousemove),a.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=$=>{this.moveMouse($,a.mousePos(this.element,$))},this.mouseup=$=>{this.mouseRotate.dragEnd($),this.mousePitch&&this.mousePitch.dragEnd($),this.offTemp()},this.touchstart=$=>{$.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=a.touchPos(this.element,$.targetTouches)[0],this.startTouch($,this._startPos),a.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.addEventListener(window,"touchend",this.touchend))},this.touchmove=$=>{$.targetTouches.length!==1?this.reset():(this._lastPos=a.touchPos(this.element,$.targetTouches)[0],this.moveTouch($,this._lastPos))},this.touchend=$=>{$.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;let I=h.dragRotate._mouseRotate.getClickTolerance(),D=h.dragRotate._mousePitch.getClickTolerance();this.element=x,this.mouseRotate=jt({clickTolerance:I,enable:!0}),this.touchRotate=(({enable:$,clickTolerance:H,bearingDegreesPerPixelMoved:Y=.8})=>{let J=new v1;return new qt({clickTolerance:H,move:(se,ce)=>({bearingDelta:(ce.x-se.x)*Y}),moveStateManager:J,enable:$,assignEvents:w1})})({clickTolerance:I,enable:!0}),this.map=h,S&&(this.mousePitch=j0({clickTolerance:D,enable:!0}),this.touchPitch=(({enable:$,clickTolerance:H,pitchDegreesPerPixelMoved:Y=-.5})=>{let J=new v1;return new qt({clickTolerance:H,move:(se,ce)=>({pitchDelta:(ce.y-se.y)*Y}),moveStateManager:J,enable:$,assignEvents:w1})})({clickTolerance:D,enable:!0})),a.addEventListener(x,"mousedown",this.mousedown),a.addEventListener(x,"touchstart",this.touchstart,{passive:!1}),a.addEventListener(x,"touchcancel",this.reset)}startMouse(h,x){this.mouseRotate.dragStart(h,x),this.mousePitch&&this.mousePitch.dragStart(h,x),a.disableDrag()}startTouch(h,x){this.touchRotate.dragStart(h,x),this.touchPitch&&this.touchPitch.dragStart(h,x),a.disableDrag()}moveMouse(h,x){let S=this.map,{bearingDelta:I}=this.mouseRotate.dragMove(h,x)||{};if(I&&S.setBearing(S.getBearing()+I),this.mousePitch){let{pitchDelta:D}=this.mousePitch.dragMove(h,x)||{};D&&S.setPitch(S.getPitch()+D)}}moveTouch(h,x){let S=this.map,{bearingDelta:I}=this.touchRotate.dragMove(h,x)||{};if(I&&S.setBearing(S.getBearing()+I),this.touchPitch){let{pitchDelta:D}=this.touchPitch.dragMove(h,x)||{};D&&S.setPitch(S.getPitch()+D)}}off(){let h=this.element;a.removeEventListener(h,"mousedown",this.mousedown),a.removeEventListener(h,"touchstart",this.touchstart,{passive:!1}),a.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.removeEventListener(window,"touchend",this.touchend),a.removeEventListener(h,"touchcancel",this.reset),this.offTemp()}offTemp(){a.enableDrag(),a.removeEventListener(window,"mousemove",this.mousemove),a.removeEventListener(window,"mouseup",this.mouseup),a.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.removeEventListener(window,"touchend",this.touchend)}}let Ul;function E1(P,h,x){if(P=new n.LngLat(P.lng,P.lat),h){let S=new n.LngLat(P.lng-360,P.lat),I=new n.LngLat(P.lng+360,P.lat),D=x.locationPoint(P).distSqr(h);x.locationPoint(S).distSqr(h)<D?P=S:x.locationPoint(I).distSqr(h)<D&&(P=I)}for(;Math.abs(P.lng-x.center.lng)>180;){let S=x.locationPoint(P);if(S.x>=0&&S.y>=0&&S.x<=x.width&&S.y<=x.height)break;P.lng>x.center.lng?P.lng-=360:P.lng+=360}return P}let T1={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Y0(P,h,x){let S=P.classList;for(let I in T1)S.remove(`maplibregl-${x}-anchor-${I}`);S.add(`maplibregl-${x}-anchor-${h}`)}class Wh extends n.Evented{constructor(h){if(super(),this._onKeyPress=x=>{let S=x.code,I=x.charCode||x.keyCode;S!=="Space"&&S!=="Enter"&&I!==32&&I!==13||this.togglePopup()},this._onMapClick=x=>{let S=x.originalEvent.target,I=this._element;this._popup&&(S===I||I.contains(S))&&this.togglePopup()},this._update=x=>{if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=E1(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let S="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?S=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(S=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let I="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?I="rotateX(0deg)":this._pitchAlignment==="map"&&(I=`rotateX(${this._map.getPitch()}deg)`),x&&x.type!=="moveend"||(this._pos=this._pos.round()),a.setTransform(this._element,`${T1[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${I} ${S}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{let D=this._map.unproject(this._pos),$=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=D.distanceTo(this._lngLat)>20*$?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=x=>{if(!this._isDragging){let S=this._clickTolerance||this._map._clickTolerance;this._isDragging=x.point.dist(this._pointerdownPos)>=S}this._isDragging&&(this._pos=x.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.Event("dragstart"))),this.fire(new n.Event("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new n.Event("dragend")),this._state="inactive"},this._addDragHandler=x=>{this._element.contains(x.originalEvent.target)&&(x.preventDefault(),this._positionDelta=x.point.sub(this._pos).add(this._offset),this._pointerdownPos=x.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment!=="auto"?h.pitchAlignment:this._rotationAlignment,h&&h.element)this._element=h.element,this._offset=n.Point.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=a.create("div"),this._element.setAttribute("aria-label","Map marker");let x=a.createNS("http://www.w3.org/2000/svg","svg"),S=41,I=27;x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height",`${S}px`),x.setAttributeNS(null,"width",`${I}px`),x.setAttributeNS(null,"viewBox",`0 0 ${I} ${S}`);let D=a.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"stroke","none"),D.setAttributeNS(null,"stroke-width","1"),D.setAttributeNS(null,"fill","none"),D.setAttributeNS(null,"fill-rule","evenodd");let $=a.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"fill-rule","nonzero");let H=a.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(3.0, 29.0)"),H.setAttributeNS(null,"fill","#000000");let Y=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let Ve of Y){let tt=a.createNS("http://www.w3.org/2000/svg","ellipse");tt.setAttributeNS(null,"opacity","0.04"),tt.setAttributeNS(null,"cx","10.5"),tt.setAttributeNS(null,"cy","5.80029008"),tt.setAttributeNS(null,"rx",Ve.rx),tt.setAttributeNS(null,"ry",Ve.ry),H.appendChild(tt)}let J=a.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"fill",this._color);let se=a.createNS("http://www.w3.org/2000/svg","path");se.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),J.appendChild(se);let ce=a.createNS("http://www.w3.org/2000/svg","g");ce.setAttributeNS(null,"opacity","0.25"),ce.setAttributeNS(null,"fill","#000000");let _e=a.createNS("http://www.w3.org/2000/svg","path");_e.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ce.appendChild(_e);let Ce=a.createNS("http://www.w3.org/2000/svg","g");Ce.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ce.setAttributeNS(null,"fill","#FFFFFF");let Ae=a.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(8.0, 8.0)");let Pe=a.createNS("http://www.w3.org/2000/svg","circle");Pe.setAttributeNS(null,"fill","#000000"),Pe.setAttributeNS(null,"opacity","0.25"),Pe.setAttributeNS(null,"cx","5.5"),Pe.setAttributeNS(null,"cy","5.5"),Pe.setAttributeNS(null,"r","5.4999962");let Se=a.createNS("http://www.w3.org/2000/svg","circle");Se.setAttributeNS(null,"fill","#FFFFFF"),Se.setAttributeNS(null,"cx","5.5"),Se.setAttributeNS(null,"cy","5.5"),Se.setAttributeNS(null,"r","5.4999962"),Ae.appendChild(Pe),Ae.appendChild(Se),$.appendChild(H),$.appendChild(J),$.appendChild(ce),$.appendChild(Ce),$.appendChild(Ae),x.appendChild($),x.setAttributeNS(null,"height",S*this._scale+"px"),x.setAttributeNS(null,"width",I*this._scale+"px"),this._element.appendChild(x),this._offset=n.Point.convert(h&&h.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()}),Y0(this._element,this._anchor,"marker"),h&&h.className)for(let x of h.className.split(" "))this._element.classList.add(x);this._popup=null}addTo(h){return this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._update),h.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),a.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=n.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){let I=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[I,-1*(38.1-13.5+I)],"bottom-right":[-I,-1*(38.1-13.5+I)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=h,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){let h=this._popup;return h?(h.isOpen()?h.remove():h.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(h){return this._offset=n.Point.convert(h),this._update(),this}addClassName(h){this._element.classList.add(h)}removeClassName(h){this._element.classList.remove(h)}toggleClassName(h){return this._element.classList.toggle(h)}setDraggable(h){return this._draggable=!!h,this._map&&(h?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(h){return this._rotation=h||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(h){return this._rotationAlignment=h||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(h){return this._pitchAlignment=h&&h!=="auto"?h:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}let Vp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ec=0,gu=!1,jp={maxWidth:100,unit:"metric"};function Z0(P,h,x){let S=x&&x.maxWidth||100,I=P._container.clientHeight/2,D=P.unproject([0,I]),$=P.unproject([S,I]),H=D.distanceTo($);if(x&&x.unit==="imperial"){let Y=3.2808*H;Y>5280?yu(h,S,Y/5280,P._getUIString("ScaleControl.Miles")):yu(h,S,Y,P._getUIString("ScaleControl.Feet"))}else x&&x.unit==="nautical"?yu(h,S,H/1852,P._getUIString("ScaleControl.NauticalMiles")):H>=1e3?yu(h,S,H/1e3,P._getUIString("ScaleControl.Kilometers")):yu(h,S,H,P._getUIString("ScaleControl.Meters"))}function yu(P,h,x,S){let I=function(D){let $=Math.pow(10,`${Math.floor(D)}`.length-1),H=D/$;return H=H>=10?10:H>=5?5:H>=3?3:H>=2?2:H>=1?1:function(Y){let J=Math.pow(10,Math.ceil(-Math.log(Y)/Math.LN10));return Math.round(Y*J)/J}(H),$*H}(x);P.style.width=h*(I/x)+"px",P.innerHTML=`${I}&nbsp;${S}`}let Xp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Wp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Q0(P){if(P){if(typeof P=="number"){let h=Math.round(Math.sqrt(.5*Math.pow(P,2)));return{center:new n.Point(0,0),top:new n.Point(0,P),"top-left":new n.Point(h,h),"top-right":new n.Point(-h,h),bottom:new n.Point(0,-P),"bottom-left":new n.Point(h,-h),"bottom-right":new n.Point(-h,-h),left:new n.Point(P,0),right:new n.Point(-P,0)}}if(P instanceof n.Point||Array.isArray(P)){let h=n.Point.convert(P);return{center:h,top:h,"top-left":h,"top-right":h,bottom:h,"bottom-left":h,"bottom-right":h,left:h,right:h}}return{center:n.Point.convert(P.center||[0,0]),top:n.Point.convert(P.top||[0,0]),"top-left":n.Point.convert(P["top-left"]||[0,0]),"top-right":n.Point.convert(P["top-right"]||[0,0]),bottom:n.Point.convert(P.bottom||[0,0]),"bottom-left":n.Point.convert(P["bottom-left"]||[0,0]),"bottom-right":n.Point.convert(P["bottom-right"]||[0,0]),left:n.Point.convert(P.left||[0,0]),right:n.Point.convert(P.right||[0,0])}}return Q0(new n.Point(0,0))}let qp={extend:(P,...h)=>n.extend(P,...h),run(P){P()},logToElement(P,h=!1,x="log"){let S=window.document.getElementById(x);S&&(h&&(S.innerHTML=""),S.innerHTML+=`<br>${P}`)}},K0=o;class Cr{static get version(){return K0}static get workerCount(){return rt.workerCount}static set workerCount(h){rt.workerCount=h}static get maxParallelImageRequests(){return n.config.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(h){n.config.MAX_PARALLEL_IMAGE_REQUESTS=h}static get workerUrl(){return n.config.WORKER_URL}static set workerUrl(h){n.config.WORKER_URL=h}static addProtocol(h,x){n.config.REGISTERED_PROTOCOLS[h]=x}static removeProtocol(h){delete n.config.REGISTERED_PROTOCOLS[h]}}return Cr.Map=class extends J7{constructor(P){if(n.PerformanceUtils.mark(n.PerformanceMarkers.create),(P=n.extend({},Iv,P)).minZoom!=null&&P.maxZoom!=null&&P.minZoom>P.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(P.minPitch!=null&&P.maxPitch!=null&&P.minPitch>P.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(P.minPitch!=null&&P.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(P.maxPitch!=null&&P.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new H0(P.minZoom,P.maxZoom,P.minPitch,P.maxPitch,P.renderWorldCopies),{bearingSnap:P.bearingSnap}),this._cooperativeGesturesOnWheel=h=>{this._onCooperativeGesture(h,h[this._metaKey],1)},this._contextLost=h=>{h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.Event("webglcontextlost",{originalEvent:h}))},this._contextRestored=h=>{this._setupPainter(),this.resize(),this._update(),this.fire(new n.Event("webglcontextrestored",{originalEvent:h}))},this._onMapScroll=h=>{if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=P.interactive,this._cooperativeGestures=P.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=P.maxTileCacheSize,this._maxTileCacheZoomLevels=P.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=P.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=P.preserveDrawingBuffer,this._antialias=P.antialias,this._trackResize=P.trackResize,this._bearingSnap=P.bearingSnap,this._refreshExpiredTiles=P.refreshExpiredTiles,this._fadeDuration=P.fadeDuration,this._crossSourceCollisions=P.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=P.collectResourceTiming,this._renderTaskQueue=new W0,this._controls=[],this._mapId=n.uniqueId(),this._locale=n.extend({},pi,P.locale),this._clickTolerance=P.clickTolerance,this._overridePixelRatio=P.pixelRatio,this._maxCanvasSize=P.maxCanvasSize,this.transformCameraUpdate=P.transformCameraUpdate,this._imageQueueHandle=v.addThrottleControl(()=>this.isMoving()),this._requestManager=new b(P.transformRequest),typeof P.container=="string"){if(this._container=document.getElementById(P.container),!this._container)throw new Error(`Container '${P.container}' not found.`)}else{if(!(P.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=P.container}if(P.maxBounds&&this.setMaxBounds(P.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window!="undefined"){addEventListener("online",this._onWindowOnline,!1);let h=!1;this._resizeObserver=new ResizeObserver(x=>{h?this._trackResize&&this.resize(x)._update():h=!0}),this._resizeObserver.observe(this._container)}this.handlers=new K7(this,P),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=P.hash&&new du(typeof P.hash=="string"&&P.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:P.center,zoom:P.zoom,bearing:P.bearing,pitch:P.pitch}),P.bounds&&(this.resize(),this.fitBounds(P.bounds,n.extend({},P.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=P.localIdeographFontFamily,this._validateStyle=P.validateStyle,P.style&&this.setStyle(P.style,{localIdeographFontFamily:P.localIdeographFontFamily}),P.attributionControl&&this.addControl(new e9({customAttribution:P.customAttribution})),P.maplibreLogo&&this.addControl(new Ra,P.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new n.Event(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new n.Event(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new n.Event("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(P,h){if(h===void 0&&(h=P.getDefaultPosition?P.getDefaultPosition():"top-right"),!P||!P.onAdd)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let x=P.onAdd(this);this._controls.push(P);let S=this._controlPositions[h];return h.indexOf("bottom")!==-1?S.insertBefore(x,S.firstChild):S.appendChild(x),this}removeControl(P){if(!P||!P.onRemove)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let h=this._controls.indexOf(P);return h>-1&&this._controls.splice(h,1),P.onRemove(this),this}hasControl(P){return this._controls.indexOf(P)>-1}calculateCameraOptionsFromTo(P,h,x,S){return S==null&&this.terrain&&(S=this.terrain.getElevationForLngLatZoom(x,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(P,h,x,S)}resize(P){var h;let x=this._containerDimensions(),S=x[0],I=x[1],D=this._getClampedPixelRatio(S,I);if(this._resizeCanvas(S,I,D),this.painter.resize(S,I,D),this.painter.overLimit()){let H=this.painter.context.gl;this._maxCanvasSize=[H.drawingBufferWidth,H.drawingBufferHeight];let Y=this._getClampedPixelRatio(S,I);this._resizeCanvas(S,I,Y),this.painter.resize(S,I,Y)}this.transform.resize(S,I),(h=this._requestedCameraState)===null||h===void 0||h.resize(S,I);let $=!this._moving;return $&&(this.stop(),this.fire(new n.Event("movestart",P)).fire(new n.Event("move",P))),this.fire(new n.Event("resize",P)),$&&this.fire(new n.Event("moveend",P)),this}_getClampedPixelRatio(P,h){let{0:x,1:S}=this._maxCanvasSize,I=this.getPixelRatio(),D=P*I,$=h*I;return Math.min(D>x?x/D:1,$>S?S/$:1)*I}getPixelRatio(){var P;return(P=this._overridePixelRatio)!==null&&P!==void 0?P:devicePixelRatio}setPixelRatio(P){this._overridePixelRatio=P,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(P){return this.transform.setMaxBounds(oe.convert(P)),this._update()}setMinZoom(P){if((P=P==null?-2:P)>=-2&&P<=this.transform.maxZoom)return this.transform.minZoom=P,this._update(),this.getZoom()<P&&this.setZoom(P),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(P){if((P=P==null?22:P)>=this.transform.minZoom)return this.transform.maxZoom=P,this._update(),this.getZoom()>P&&this.setZoom(P),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(P){if((P=P==null?0:P)<0)throw new Error("minPitch must be greater than or equal to 0");if(P>=0&&P<=this.transform.maxPitch)return this.transform.minPitch=P,this._update(),this.getPitch()<P&&this.setPitch(P),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(P){if((P=P==null?60:P)>85)throw new Error("maxPitch must be less than or equal to 85");if(P>=this.transform.minPitch)return this.transform.maxPitch=P,this._update(),this.getPitch()>P&&this.setPitch(P),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(P){return this.transform.renderWorldCopies=P,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(P){return this._cooperativeGestures=P,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(P){return this.transform.locationPoint(n.LngLat.convert(P),this.style&&this.terrain)}unproject(P){return this.transform.pointLocation(n.Point.convert(P),this.terrain)}isMoving(){var P;return this._moving||((P=this.handlers)===null||P===void 0?void 0:P.isMoving())}isZooming(){var P;return this._zooming||((P=this.handlers)===null||P===void 0?void 0:P.isZooming())}isRotating(){var P;return this._rotating||((P=this.handlers)===null||P===void 0?void 0:P.isRotating())}_createDelegatedListener(P,h,x){if(P==="mouseenter"||P==="mouseover"){let S=!1;return{layer:h,listener:x,delegates:{mousemove:D=>{let $=this.getLayer(h)?this.queryRenderedFeatures(D.point,{layers:[h]}):[];$.length?S||(S=!0,x.call(this,new Ls(P,this,D.originalEvent,{features:$}))):S=!1},mouseout:()=>{S=!1}}}}if(P==="mouseleave"||P==="mouseout"){let S=!1;return{layer:h,listener:x,delegates:{mousemove:$=>{(this.getLayer(h)?this.queryRenderedFeatures($.point,{layers:[h]}):[]).length?S=!0:S&&(S=!1,x.call(this,new Ls(P,this,$.originalEvent)))},mouseout:$=>{S&&(S=!1,x.call(this,new Ls(P,this,$.originalEvent)))}}}}{let S=I=>{let D=this.getLayer(h)?this.queryRenderedFeatures(I.point,{layers:[h]}):[];D.length&&(I.features=D,x.call(this,I),delete I.features)};return{layer:h,listener:x,delegates:{[P]:S}}}}on(P,h,x){if(x===void 0)return super.on(P,h);let S=this._createDelegatedListener(P,h,x);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[P]=this._delegatedListeners[P]||[],this._delegatedListeners[P].push(S);for(let I in S.delegates)this.on(I,S.delegates[I]);return this}once(P,h,x){if(x===void 0)return super.once(P,h);let S=this._createDelegatedListener(P,h,x);for(let I in S.delegates)this.once(I,S.delegates[I]);return this}off(P,h,x){return x===void 0?super.off(P,h):(this._delegatedListeners&&this._delegatedListeners[P]&&(S=>{let I=this._delegatedListeners[P];for(let D=0;D<I.length;D++){let $=I[D];if($.layer===h&&$.listener===x){for(let H in $.delegates)this.off(H,$.delegates[H]);return I.splice(D,1),this}}})(),this)}queryRenderedFeatures(P,h){if(!this.style)return[];let x,S=P instanceof n.Point||Array.isArray(P),I=S?P:[[0,0],[this.transform.width,this.transform.height]];if(h=h||(S?{}:P)||{},I instanceof n.Point||typeof I[0]=="number")x=[n.Point.convert(I)];else{let D=n.Point.convert(I[0]),$=n.Point.convert(I[1]);x=[D,new n.Point($.x,D.y),$,new n.Point(D.x,$.y),D]}return this.style.queryRenderedFeatures(x,h,this.transform)}querySourceFeatures(P,h){return this.style.querySourceFeatures(P,h)}setStyle(P,h){return(h=n.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},h)).diff!==!1&&h.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&P?(this._diffStyle(P,h),this):(this._localIdeographFontFamily=h.localIdeographFontFamily,this._updateStyle(P,h))}setTransformRequest(P){return this._requestManager.setTransformRequest(P),this}_getUIString(P){let h=this._locale[P];if(h==null)throw new Error(`Missing UI string '${P}'`);return h}_updateStyle(P,h){if(h.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(P,h));let x=this.style&&h.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!P)),P?(this.style=new zn(this,h||{}),this.style.setEventedParent(this,{style:this.style}),typeof P=="string"?this.style.loadURL(P,h,x):this.style.loadJSON(P,h,x),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new zn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(P,h){if(typeof P=="string"){let x=this._requestManager.transformRequest(P,E.Style);n.getJSON(x,(S,I)=>{S?this.fire(new n.ErrorEvent(S)):I&&this._updateDiff(I,h)})}else typeof P=="object"&&this._updateDiff(P,h)}_updateDiff(P,h){try{this.style.setState(P,h)&&this._update(!0)}catch(x){n.warnOnce(`Unable to perform style diff: ${x.message||x.error||x}.  Rebuilding the style from scratch.`),this._updateStyle(P,h)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():n.warnOnce("There is no style added to the map.")}addSource(P,h){return this._lazyInitEmptyStyle(),this.style.addSource(P,h),this._update(!0)}isSourceLoaded(P){let h=this.style&&this.style.sourceCaches[P];if(h!==void 0)return h.loaded();this.fire(new n.ErrorEvent(new Error(`There is no source with ID '${P}'`)))}setTerrain(P){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),P){let h=this.style.sourceCaches[P.source];if(!h)throw new Error(`cannot load terrain, because there exists no source with ID: ${P.source}`);for(let x in this.style._layers){let S=this.style._layers[x];S.type==="hillshade"&&S.source===P.source&&n.warnOnce("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new $p(this.painter,h,P),this.painter.renderToTexture=new t9(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=x=>{x.dataType==="style"?this.terrain.sourceCache.freeRtt():x.dataType==="source"&&x.tile&&(x.sourceId!==P.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(x.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new n.Event("terrain",{terrain:P})),this}getTerrain(){return this.terrain&&this.terrain.options}areTilesLoaded(){let P=this.style&&this.style.sourceCaches;for(let h in P){let x=P[h]._tiles;for(let S in x){let I=x[S];if(I.state!=="loaded"&&I.state!=="errored")return!1}}return!0}addSourceType(P,h,x){return this._lazyInitEmptyStyle(),this.style.addSourceType(P,h,x)}removeSource(P){return this.style.removeSource(P),this._update(!0)}getSource(P){return this.style.getSource(P)}addImage(P,h,x={}){let{pixelRatio:S=1,sdf:I=!1,stretchX:D,stretchY:$,content:H}=x;if(this._lazyInitEmptyStyle(),!(h instanceof HTMLImageElement||n.isImageBitmap(h))){if(h.width===void 0||h.height===void 0)return this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:Y,height:J,data:se}=h,ce=h;return this.style.addImage(P,{data:new n.RGBAImage({width:Y,height:J},new Uint8Array(se)),pixelRatio:S,stretchX:D,stretchY:$,content:H,sdf:I,version:0,userImage:ce}),ce.onAdd&&ce.onAdd(this,P),this}}{let{width:Y,height:J,data:se}=n.browser.getImageData(h);this.style.addImage(P,{data:new n.RGBAImage({width:Y,height:J},se),pixelRatio:S,stretchX:D,stretchY:$,content:H,sdf:I,version:0})}}updateImage(P,h){let x=this.style.getImage(P);if(!x)return this.fire(new n.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let S=h instanceof HTMLImageElement||n.isImageBitmap(h)?n.browser.getImageData(h):h,{width:I,height:D,data:$}=S;if(I===void 0||D===void 0)return this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(I!==x.data.width||D!==x.data.height)return this.fire(new n.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));let H=!(h instanceof HTMLImageElement||n.isImageBitmap(h));return x.data.replace($,H),this.style.updateImage(P,x),this}getImage(P){return this.style.getImage(P)}hasImage(P){return P?!!this.style.getImage(P):(this.fire(new n.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(P){this.style.removeImage(P)}loadImage(P,h){v.getImage(this._requestManager.transformRequest(P,E.Image),h)}listImages(){return this.style.listImages()}addLayer(P,h){return this._lazyInitEmptyStyle(),this.style.addLayer(P,h),this._update(!0)}moveLayer(P,h){return this.style.moveLayer(P,h),this._update(!0)}removeLayer(P){return this.style.removeLayer(P),this._update(!0)}getLayer(P){return this.style.getLayer(P)}setLayerZoomRange(P,h,x){return this.style.setLayerZoomRange(P,h,x),this._update(!0)}setFilter(P,h,x={}){return this.style.setFilter(P,h,x),this._update(!0)}getFilter(P){return this.style.getFilter(P)}setPaintProperty(P,h,x,S={}){return this.style.setPaintProperty(P,h,x,S),this._update(!0)}getPaintProperty(P,h){return this.style.getPaintProperty(P,h)}setLayoutProperty(P,h,x,S={}){return this.style.setLayoutProperty(P,h,x,S),this._update(!0)}getLayoutProperty(P,h){return this.style.getLayoutProperty(P,h)}setGlyphs(P,h={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(P,h),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(P,h,x={}){return this._lazyInitEmptyStyle(),this.style.addSprite(P,h,x,S=>{S||this._update(!0)}),this}removeSprite(P){return this._lazyInitEmptyStyle(),this.style.removeSprite(P),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(P,h={}){return this._lazyInitEmptyStyle(),this.style.setSprite(P,h,x=>{x||this._update(!0)}),this}setLight(P,h={}){return this._lazyInitEmptyStyle(),this.style.setLight(P,h),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(P,h){return this.style.setFeatureState(P,h),this._update()}removeFeatureState(P,h){return this.style.removeFeatureState(P,h),this._update()}getFeatureState(P){return this.style.getFeatureState(P)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let P=0,h=0;return this._container&&(P=this._container.clientWidth||400,h=this._container.clientHeight||300),[P,h]}_setupContainer(){let P=this._container;P.classList.add("maplibregl-map");let h=this._canvasContainer=a.create("div","maplibregl-canvas-container",P);this._interactive&&h.classList.add("maplibregl-interactive"),this._canvas=a.create("canvas","maplibregl-canvas",h),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");let x=this._containerDimensions(),S=this._getClampedPixelRatio(x[0],x[1]);this._resizeCanvas(x[0],x[1],S);let I=this._controlContainer=a.create("div","maplibregl-control-container",P),D=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach($=>{D[$]=a.create("div",`maplibregl-ctrl-${$} `,I)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=a.create("div","maplibregl-cooperative-gesture-screen",this._container);let P=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(P=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${P}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){a.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(P,h,x){this._canvas.width=Math.floor(x*P),this._canvas.height=Math.floor(x*h),this._canvas.style.width=`${P}px`,this._canvas.style.height=`${h}px`}_setupPainter(){let P={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1},h=null;this._canvas.addEventListener("webglcontextcreationerror",S=>{h={requestedAttributes:P},S&&(h.statusMessage=S.statusMessage,h.type=S.type)},{once:!0});let x=this._canvas.getContext("webgl2",P)||this._canvas.getContext("webgl",P);if(!x){let S="Failed to initialize WebGL";throw h?(h.message=S,new Error(JSON.stringify(h))):new Error(S)}this.painter=new U7(x,this.transform),l.testSupport(x)}_onCooperativeGesture(P,h,x){return!h&&x<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(P){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||P,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(P){return this._update(),this._renderTaskQueue.add(P)}_cancelRenderFrame(P){this._renderTaskQueue.remove(P)}_render(P){let h=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(P),this._removed)return;let x=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let I=this.transform.zoom,D=n.browser.now();this.style.zoomHistory.update(I,D);let $=new n.EvaluationParameters(I,{now:D,fadeDuration:h,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),H=$.crossFadingFactor();H===1&&H===this._crossFadingFactor||(x=!0,this._crossFadingFactor=H),this.style.update($)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,h,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:h,showPadding:this.showPadding}),this.fire(new n.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,n.PerformanceUtils.mark(n.PerformanceMarkers.load),this.fire(new n.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let S=this._sourcesDirty||this._styleDirty||this._placementDirty;return S||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new n.Event("idle")),!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,n.PerformanceUtils.mark(n.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var P;this._hash&&this._hash.remove();for(let x of this._controls)x.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window!="undefined"&&removeEventListener("online",this._onWindowOnline,!1),v.removeThrottleControl(this._imageQueueHandle),(P=this._resizeObserver)===null||P===void 0||P.disconnect();let h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),a.remove(this._canvasContainer),a.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),n.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new n.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=n.browser.frame(P=>{n.PerformanceUtils.frame(P),this._frame=null,this._render(P)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(P){this._showTileBoundaries!==P&&(this._showTileBoundaries=P,this._update())}get showPadding(){return!!this._showPadding}set showPadding(P){this._showPadding!==P&&(this._showPadding=P,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(P){this._showCollisionBoxes!==P&&(this._showCollisionBoxes=P,P?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(P){this._showOverdrawInspector!==P&&(this._showOverdrawInspector=P,this._update())}get repaint(){return!!this._repaint}set repaint(P){this._repaint!==P&&(this._repaint=P,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(P){this._vertices=P,this._update()}get version(){return ul}getCameraTargetElevation(){return this.transform.elevation}},Cr.NavigationControl=class{constructor(P){this._updateZoomButtons=()=>{let h=this._map.getZoom(),x=h===this._map.getMaxZoom(),S=h===this._map.getMinZoom();this._zoomInButton.disabled=x,this._zoomOutButton.disabled=S,this._zoomInButton.setAttribute("aria-disabled",x.toString()),this._zoomOutButton.setAttribute("aria-disabled",S.toString())},this._rotateCompassArrow=()=>{let h=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=h},this._setButtonTitle=(h,x)=>{let S=this._map._getUIString(`NavigationControl.${x}`);h.title=S,h.setAttribute("aria-label",S)},this.options=n.extend({},xs,P),this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",h=>h.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",h=>this._map.zoomIn({},{originalEvent:h})),a.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",h=>this._map.zoomOut({},{originalEvent:h})),a.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",h=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:h}):this._map.resetNorth({},{originalEvent:h})}),this._compassIcon=a.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(P){return this._map=P,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ns(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){a.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(P,h){let x=a.create("button",P,this._container);return x.type="button",x.addEventListener("click",h),x}},Cr.GeolocateControl=class extends n.Evented{constructor(P){super(),this._onSuccess=h=>{if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new n.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new n.Event("geolocate",h)),this._finish()}},this._updateCamera=h=>{let x=new n.LngLat(h.coords.longitude,h.coords.latitude),S=h.coords.accuracy,I=this._map.getBearing(),D=n.extend({bearing:I},this.options.fitBoundsOptions),$=oe.fromLngLat(x,S);this._map.fitBounds($,D,{geolocateSource:!0})},this._updateMarker=h=>{if(h){let x=new n.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(x).addTo(this._map),this._userLocationDotMarker.setLngLat(x).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=h=>{if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&gu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new n.Event("error",h)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=h=>{if(this._map){if(this._container.addEventListener("contextmenu",x=>x.preventDefault()),this._geolocateButton=a.create("button","maplibregl-ctrl-geolocate",this._container),a.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){n.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");let x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}else{let x=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=a.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Wh({element:this._dotElement}),this._circleElement=a.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",x=>{x.geolocateSource||this._watchState!=="ACTIVE_LOCK"||x.originalEvent&&x.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new n.Event("trackuserlocationend")))})}},this.options=n.extend({},Vp,P)}onAdd(P){return this._map=P,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(h,x=!1){Ul===void 0||x?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(S=>{Ul=S.state!=="denied",h(Ul)}).catch(()=>{Ul=!!window.navigator.geolocation,h(Ul)}):(Ul=!!window.navigator.geolocation,h(Ul)):h(Ul)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),a.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ec=0,gu=!1}_isOutOfMapMaxBounds(P){let h=this._map.getMaxBounds(),x=P.coords;return h&&(x.longitude<h.getWest()||x.longitude>h.getEast()||x.latitude<h.getSouth()||x.latitude>h.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let P=this._map.getBounds(),h=P.getSouthEast(),x=P.getNorthEast(),S=h.distanceTo(x),I=Math.ceil(this._accuracy/(S/this._map._container.clientHeight)*2);this._circleElement.style.width=`${I}px`,this._circleElement.style.height=`${I}px`}trigger(){if(!this._setup)return n.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ec--,gu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new n.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let P;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ec++,Ec>1?(P={maximumAge:6e5,timeout:0},gu=!0):(P=this.options.positionOptions,gu=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,P)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Cr.AttributionControl=e9,Cr.LogoControl=Ra,Cr.ScaleControl=class{constructor(P){this._onMove=()=>{Z0(this._map,this._container,this.options)},this.setUnit=h=>{this.options.unit=h,Z0(this._map,this._container,this.options)},this.options=n.extend({},jp,P)}getDefaultPosition(){return"bottom-left"}onAdd(P){return this._map=P,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-scale",P.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){a.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Cr.FullscreenControl=class extends n.Evented{constructor(P={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,P&&P.container&&(P.container instanceof HTMLElement?this._container=P.container:n.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(P){return this._map=P,this._container||(this._container=this._map.getContainer()),this._controlContainer=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){a.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let P=this._fullscreenButton=a.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);a.create("span","maplibregl-ctrl-icon",P).setAttribute("aria-hidden","true"),P.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let P=this._getTitle();this._fullscreenButton.setAttribute("aria-label",P),this._fullscreenButton.title=P}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new n.Event("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new n.Event("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Cr.TerrainControl=class{constructor(P){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=P}onAdd(P){return this._map=P,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=a.create("button","maplibregl-ctrl-terrain",this._container),a.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){a.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Cr.Popup=class extends n.Evented{constructor(P){super(),this.remove=()=>(this._content&&a.remove(this._content),this._container&&(a.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new n.Event("close")),this),this._onMouseUp=h=>{this._update(h.point)},this._onMouseMove=h=>{this._update(h.point)},this._onDrag=h=>{this._update(h.point)},this._update=h=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=a.create("div","maplibregl-popup",this._map.getContainer()),this._tip=a.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let $ of this.options.className.split(" "))this._container.classList.add($);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=E1(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!h)return;let x=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),S=this.options.anchor,I=Q0(this.options.offset);if(!S){let $=this._container.offsetWidth,H=this._container.offsetHeight,Y;Y=x.y+I.bottom.y<H?["top"]:x.y>this._map.transform.height-H?["bottom"]:[],x.x<$/2?Y.push("left"):x.x>this._map.transform.width-$/2&&Y.push("right"),S=Y.length===0?"bottom":Y.join("-")}let D=x.add(I[S]).round();a.setTransform(this._container,`${T1[S]} translate(${D.x}px,${D.y}px)`),Y0(this._container,S,"popup")},this._onClose=()=>{this.remove()},this.options=n.extend(Object.create(Xp),P)}addTo(P){return this._map&&this.remove(),this._map=P,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new n.Event("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(P){return this._lngLat=n.LngLat.convert(P),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(P){return this.setDOMContent(document.createTextNode(P))}setHTML(P){let h=document.createDocumentFragment(),x=document.createElement("body"),S;for(x.innerHTML=P;S=x.firstChild,S;)h.appendChild(S);return this.setDOMContent(h)}getMaxWidth(){var P;return(P=this._container)===null||P===void 0?void 0:P.style.maxWidth}setMaxWidth(P){return this.options.maxWidth=P,this._update(),this}setDOMContent(P){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=a.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(P),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(P){this._container&&this._container.classList.add(P)}removeClassName(P){this._container&&this._container.classList.remove(P)}setOffset(P){return this.options.offset=P,this._update(),this}toggleClassName(P){if(this._container)return this._container.classList.toggle(P)}_createCloseButton(){this.options.closeButton&&(this._closeButton=a.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let P=this._container.querySelector(Wp);P&&P.focus()}},Cr.Marker=Wh,Cr.Style=zn,Cr.LngLat=n.LngLat,Cr.LngLatBounds=oe,Cr.Point=n.Point,Cr.MercatorCoordinate=n.MercatorCoordinate,Cr.Evented=n.Evented,Cr.AJAXError=n.AJAXError,Cr.config=n.config,Cr.CanvasSource=Te,Cr.GeoJSONSource=ot,Cr.ImageSource=bt,Cr.RasterDEMTileSource=Je,Cr.RasterTileSource=He,Cr.VectorTileSource=Re,Cr.VideoSource=at,Cr.setRTLTextPlugin=n.setRTLTextPlugin,Cr.getRTLTextPluginStatus=n.getRTLTextPluginStatus,Cr.prewarm=function(){ti().acquire(De)},Cr.clearPrewarmedResources=function(){let P=Vt;P&&(P.isPreloaded()&&P.numActive()===1?(P.release(De),Vt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},qp.extend(Cr,{isSafari:n.isSafari,getPerformanceMetrics:n.PerformanceUtils.getPerformanceMetrics}),Cr});var s=i;return s})});var gO=Gi((fit,W4)=>{W4.exports=iK;W4.exports.pair=sK;W4.exports.format=LS;W4.exports.formatPair=rK;W4.exports.coordToDMS=mO;function iK(t,e){var i=NS(t,e);return i===null?null:i.val}function rK(t){return LS(t.lat,"lat")+" "+LS(t.lon,"lon")}function LS(t,e){var i=mO(t,e);return i.whole+"\xB0 "+(i.minutes?i.minutes+"' ":"")+(i.seconds?i.seconds+'" ':"")+i.dir}function mO(t,e){var i={lat:["N","S"],lon:["E","W"]}[e]||"",r=i[t>=0?0:1],s=Math.abs(t),n=Math.floor(s),o=s-n,a=o*60,l=Math.floor(a),c=Math.floor((a-l)*60);return{whole:n,minutes:l,seconds:c,dir:r}}function NS(t,e){if(e||(e="NSEW"),typeof t!="string")return null;t=t.toUpperCase();var i=/^[\s\,]*([NSEW])?\s*([\-|\|\]?[0-9.]+)[]?\s*(?:([0-9.]+)[']\s*)?(?:([0-9.]+)(?:''|"||)\s*)?([NSEW])?/,r=t.match(i);if(!r)return null;var s=r[0],n;if(r[1]&&r[5]?(n=r[1],s=s.slice(0,-1)):n=r[1]||r[5],n&&e.indexOf(n)===-1)return null;var o=r[2]?parseFloat(r[2]):0,a=r[3]?parseFloat(r[3])/60:0,l=r[4]?parseFloat(r[4])/3600:0,c=o<0?-1:1;return(n==="S"||n==="W")&&(c*=-1),{val:(Math.abs(o)+a+l)*c,dim:n,matched:s,remain:t.slice(s.length)}}function sK(t,e){t=t.trim();var i=NS(t,e);if(!i)return null;t=i.remain.trim();var r=NS(t,e);return!r||r.remain?null:i.dim?nK(i.val,r.val,i.dim):[i.val,r.val]}function nK(t,e,i){if(i==="N"||i==="S")return[t,e];if(i==="W"||i==="E")return[e,t]}});var mB=Gi((i5t,pB)=>{"use strict";pB.exports=np;function np(t,e){this.x=t,this.y=e}np.prototype={clone:function(){return new np(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=e*this.x-i*this.y,s=i*this.x+e*this.y;return this.x=r,this.y=s,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),s=e.x+i*(this.x-e.x)-r*(this.y-e.y),n=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=s,this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};np.convert=function(t){return t instanceof np?t:Array.isArray(t)?new np(t[0],t[1]):t}});var CA=Gi((r5t,gB)=>{"use strict";var OK=mB();gB.exports=op;function op(t,e,i,r,s){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=s,t.readFields(BK,this,e)}function BK(t,e,i){t==1?e.id=i.readVarint():t==2?UK(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function UK(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var r=e._keys[t.readVarint()],s=e._values[t.readVarint()];e.properties[r]=s}}op.types=["Unknown","Point","LineString","Polygon"];op.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,s=0,n=0,o=[],a;t.pos<e;){if(r<=0){var l=t.readVarint();i=l&7,r=l>>3}if(r--,i===1||i===2)s+=t.readSVarint(),n+=t.readSVarint(),i===1&&(a&&o.push(a),a=[]),a.push(new OK(s,n));else if(i===7)a&&a.push(a[0].clone());else throw new Error("unknown command "+i)}return a&&o.push(a),o};op.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,s=0,n=0,o=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(r<=0){var d=t.readVarint();i=d&7,r=d>>3}if(r--,i===1||i===2)s+=t.readSVarint(),n+=t.readSVarint(),s<o&&(o=s),s>a&&(a=s),n<l&&(l=n),n>c&&(c=n);else if(i!==7)throw new Error("unknown command "+i)}return[o,l,a,c]};op.prototype.toGeoJSON=function(t,e,i){var r=this.extent*Math.pow(2,i),s=this.extent*t,n=this.extent*e,o=this.loadGeometry(),a=op.types[this.type],l,c;function d(_){for(var v=0;v<_.length;v++){var E=_[v],b=180-(E.y+n)*360/r;_[v]=[(E.x+s)*360/r-180,360/Math.PI*Math.atan(Math.exp(b*Math.PI/180))-90]}}switch(this.type){case 1:var m=[];for(l=0;l<o.length;l++)m[l]=o[l][0];o=m,d(o);break;case 2:for(l=0;l<o.length;l++)d(o[l]);break;case 3:for(o=zK(o),l=0;l<o.length;l++)for(c=0;c<o[l].length;c++)d(o[l][c]);break}o.length===1?o=o[0]:a="Multi"+a;var g={type:"Feature",geometry:{type:a,coordinates:o},properties:this.properties};return"id"in this&&(g.id=this.id),g};function zK(t){var e=t.length;if(e<=1)return[t];for(var i=[],r,s,n=0;n<e;n++){var o=GK(t[n]);o!==0&&(s===void 0&&(s=o<0),s===o<0?(r&&i.push(r),r=[t[n]]):r.push(t[n]))}return r&&i.push(r),i}function GK(t){for(var e=0,i=0,r=t.length,s=r-1,n,o;i<r;s=i++)n=t[i],o=t[s],e+=(o.x-n.x)*(n.y+o.y);return e}});var IA=Gi((s5t,_B)=>{"use strict";var $K=CA();_B.exports=yB;function yB(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(HK,this,e),this.length=this._features.length}function HK(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(VK(i))}function VK(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var r=t.readVarint()>>3;e=r===1?t.readString():r===2?t.readFloat():r===3?t.readDouble():r===4?t.readVarint64():r===5?t.readVarint():r===6?t.readSVarint():r===7?t.readBoolean():null}return e}yB.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new $K(this._pbf,e,this.extent,this._keys,this._values)}});var vB=Gi((n5t,xB)=>{"use strict";var jK=IA();xB.exports=XK;function XK(t,e){this.layers=t.readFields(WK,{},e)}function WK(t,e,i){if(t===3){var r=new jK(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}});var kA=Gi((o5t,Jx)=>{Jx.exports.VectorTile=vB();Jx.exports.VectorTileFeature=CA();Jx.exports.VectorTileLayer=IA()});var bB=Gi(MA=>{MA.read=function(t,e,i,r,s){var n,o,a=s*8-r-1,l=(1<<a)-1,c=l>>1,d=-7,m=i?s-1:0,g=i?-1:1,_=t[e+m];for(m+=g,n=_&(1<<-d)-1,_>>=-d,d+=a;d>0;n=n*256+t[e+m],m+=g,d-=8);for(o=n&(1<<-d)-1,n>>=-d,d+=r;d>0;o=o*256+t[e+m],m+=g,d-=8);if(n===0)n=1-c;else{if(n===l)return o?NaN:(_?-1:1)*(1/0);o=o+Math.pow(2,r),n=n-c}return(_?-1:1)*o*Math.pow(2,n-r)};MA.write=function(t,e,i,r,s,n){var o,a,l,c=n*8-s-1,d=(1<<c)-1,m=d>>1,g=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,_=r?0:n-1,v=r?1:-1,E=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=d):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+m>=1?e+=g/l:e+=g*Math.pow(2,1-m),e*l>=2&&(o++,l/=2),o+m>=d?(a=0,o=d):o+m>=1?(a=(e*l-1)*Math.pow(2,s),o=o+m):(a=e*Math.pow(2,m-1)*Math.pow(2,s),o=0));s>=8;t[i+_]=a&255,_+=v,a/=256,s-=8);for(o=o<<s|a,c+=s;c>0;t[i+_]=o&255,_+=v,o/=256,c-=8);t[i+_-v]|=E*128}});var RA=Gi((l5t,AB)=>{"use strict";AB.exports=$r;var ev=bB();function $r(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}$r.Varint=0;$r.Fixed64=1;$r.Bytes=2;$r.Fixed32=5;var PA=65536*65536,wB=1/PA,qK=12,SB=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");$r.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),s=r>>3,n=this.pos;this.type=r&7,t(s,e,this),this.pos===n&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=tv(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=TB(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=tv(this.buf,this.pos)+tv(this.buf,this.pos+4)*PA;return this.pos+=8,t},readSFixed64:function(){var t=tv(this.buf,this.pos)+TB(this.buf,this.pos+4)*PA;return this.pos+=8,t},readFloat:function(){var t=ev.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ev.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,i,r;return r=e[this.pos++],i=r&127,r<128||(r=e[this.pos++],i|=(r&127)<<7,r<128)||(r=e[this.pos++],i|=(r&127)<<14,r<128)||(r=e[this.pos++],i|=(r&127)<<21,r<128)?i:(r=e[this.pos],i|=(r&15)<<28,YK(i,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=qK&&SB?cJ(this.buf,e,t):lJ(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==$r.Bytes)return t.push(this.readVarint(e));var i=h1(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==$r.Bytes)return t.push(this.readSVarint());var e=h1(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==$r.Bytes)return t.push(this.readBoolean());var e=h1(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==$r.Bytes)return t.push(this.readFloat());var e=h1(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==$r.Bytes)return t.push(this.readDouble());var e=h1(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==$r.Bytes)return t.push(this.readFixed32());var e=h1(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==$r.Bytes)return t.push(this.readSFixed32());var e=h1(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==$r.Bytes)return t.push(this.readFixed64());var e=h1(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==$r.Bytes)return t.push(this.readSFixed64());var e=h1(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===$r.Varint)for(;this.buf[this.pos++]>127;);else if(e===$r.Bytes)this.pos=this.readVarint()+this.pos;else if(e===$r.Fixed32)this.pos+=4;else if(e===$r.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),lp(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),lp(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),lp(this.buf,t&-1,this.pos),lp(this.buf,Math.floor(t*wB),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),lp(this.buf,t&-1,this.pos),lp(this.buf,Math.floor(t*wB),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){ZK(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=uJ(this.buf,t,this.pos);var i=this.pos-e;i>=128&&EB(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),ev.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ev.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&EB(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,$r.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,JK,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,eJ,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,rJ,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,tJ,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,iJ,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,sJ,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,nJ,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,oJ,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,aJ,e)},writeBytesField:function(t,e){this.writeTag(t,$r.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,$r.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,$r.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,$r.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,$r.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,$r.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,$r.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,$r.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,$r.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,$r.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};function YK(t,e,i){var r=i.buf,s,n;if(n=r[i.pos++],s=(n&112)>>4,n<128||(n=r[i.pos++],s|=(n&127)<<3,n<128)||(n=r[i.pos++],s|=(n&127)<<10,n<128)||(n=r[i.pos++],s|=(n&127)<<17,n<128)||(n=r[i.pos++],s|=(n&127)<<24,n<128)||(n=r[i.pos++],s|=(n&1)<<31,n<128))return ap(t,s,e);throw new Error("Expected varint not more than 10 bytes")}function h1(t){return t.type===$r.Bytes?t.readVarint()+t.pos:t.pos+1}function ap(t,e,i){return i?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function ZK(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(i=~(-t%4294967296),r=~(-t/4294967296),i^4294967295?i=i+1|0:(i=0,r=r+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),QK(i,r,e),KK(r,e)}function QK(t,e,i){i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos]=t&127}function KK(t,e){var i=(t&7)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function EB(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));i.realloc(r);for(var s=i.pos-1;s>=t;s--)i.buf[s+r]=i.buf[s]}function JK(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function eJ(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function tJ(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function iJ(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function rJ(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function sJ(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function nJ(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function oJ(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function aJ(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function tv(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function lp(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function TB(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function lJ(t,e,i){for(var r="",s=e;s<i;){var n=t[s],o=null,a=n>239?4:n>223?3:n>191?2:1;if(s+a>i)break;var l,c,d;a===1?n<128&&(o=n):a===2?(l=t[s+1],(l&192)===128&&(o=(n&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=t[s+1],c=t[s+2],(l&192)===128&&(c&192)===128&&(o=(n&15)<<12|(l&63)<<6|c&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=t[s+1],c=t[s+2],d=t[s+3],(l&192)===128&&(c&192)===128&&(d&192)===128&&(o=(n&15)<<18|(l&63)<<12|(c&63)<<6|d&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),r+=String.fromCharCode(o),s+=a}return r}function cJ(t,e,i){return SB.decode(t.subarray(e,i))}function uJ(t,e,i){for(var r=0,s,n;r<e.length;r++){if(s=e.charCodeAt(r),s>55295&&s<57344)if(n)if(s<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=s;continue}else s=n-55296<<10|s-56320|65536,n=null;else{s>56319||r+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=s;continue}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);s<128?t[i++]=s:(s<2048?t[i++]=s>>6|192:(s<65536?t[i++]=s>>12|224:(t[i++]=s>>18|240,t[i++]=s>>12&63|128),t[i++]=s>>6&63|128),t[i++]=s&63|128)}return i}});var g0=Gi((V5t,FB)=>{var BA=kJ(),AJ=MJ(),CJ=PJ(),IJ=typeof window!="undefined"?window:global;FB.exports={assign:BA,create:AJ,trim:CJ,bind:RJ,slice:UA,each:DB,map:DJ,pluck:zA,isList:GA,isFunction:FJ,isObject:LJ,Global:IJ};function kJ(){return Object.assign?Object.assign:function(e,i,r,s){for(var n=1;n<arguments.length;n++)DB(Object(arguments[n]),function(o,a){e[a]=o});return e}}function MJ(){if(Object.create)return function(i,r,s,n){var o=UA(arguments,1);return BA.apply(this,[Object.create(i)].concat(o))};{let e=function(){};var t=e;return function(r,s,n,o){var a=UA(arguments,1);return e.prototype=r,BA.apply(this,[new e].concat(a))}}}function PJ(){return String.prototype.trim?function(e){return String.prototype.trim.call(e)}:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}function RJ(t,e){return function(){return e.apply(t,Array.prototype.slice.call(arguments,0))}}function UA(t,e){return Array.prototype.slice.call(t,e||0)}function DB(t,e){zA(t,function(i,r){return e(i,r),!1})}function DJ(t,e){var i=GA(t)?[]:{};return zA(t,function(r,s){return i[s]=e(r,s),!1}),i}function zA(t,e){if(GA(t)){for(var i=0;i<t.length;i++)if(e(t[i],i))return t[i]}else for(var r in t)if(t.hasOwnProperty(r)&&e(t[r],r))return t[r]}function GA(t){return t!=null&&typeof t!="function"&&typeof t.length=="number"}function FJ(t){return t&&{}.toString.call(t)==="[object Function]"}function LJ(t){return t&&{}.toString.call(t)==="[object Object]"}});var NB=Gi((j5t,LB)=>{var kh=g0(),NJ=kh.slice,OJ=kh.pluck,up=kh.each,BJ=kh.bind,UJ=kh.create,$A=kh.isList,HA=kh.isFunction,zJ=kh.isObject;LB.exports={createStore:VA};var GJ={version:"2.0.12",enabled:!1,get:function(t,e){var i=this.storage.read(this._namespacePrefix+t);return this._deserialize(i,e)},set:function(t,e){return e===void 0?this.remove(t):(this.storage.write(this._namespacePrefix+t,this._serialize(e)),e)},remove:function(t){this.storage.remove(this._namespacePrefix+t)},each:function(t){var e=this;this.storage.each(function(i,r){t.call(e,e._deserialize(i),(r||"").replace(e._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(t){return this._namespacePrefix=="__storejs_"+t+"_"},createStore:function(){return VA.apply(this,arguments)},addPlugin:function(t){this._addPlugin(t)},namespace:function(t){return VA(this.storage,this.plugins,t)}};function $J(){var t=typeof console=="undefined"?null:console;if(t){var e=t.warn?t.warn:t.log;e.apply(t,arguments)}}function VA(t,e,i){i||(i=""),t&&!$A(t)&&(t=[t]),e&&!$A(e)&&(e=[e]);var r=i?"__storejs_"+i+"_":"",s=i?new RegExp("^"+r):null,n=/^[a-zA-Z0-9_\-]*$/;if(!n.test(i))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var o={_namespacePrefix:r,_namespaceRegexp:s,_testStorage:function(l){try{var c="__storejs__test__";l.write(c,c);var d=l.read(c)===c;return l.remove(c),d}catch(m){return!1}},_assignPluginFnProp:function(l,c){var d=this[c];this[c]=function(){var g=NJ(arguments,0),_=this;function v(){if(d)return up(arguments,function(b,T){g[T]=b}),d.apply(_,g)}var E=[v].concat(g);return l.apply(_,E)}},_serialize:function(l){return JSON.stringify(l)},_deserialize:function(l,c){if(!l)return c;var d="";try{d=JSON.parse(l)}catch(m){d=l}return d!==void 0?d:c},_addStorage:function(l){this.enabled||this._testStorage(l)&&(this.storage=l,this.enabled=!0)},_addPlugin:function(l){var c=this;if($A(l)){up(l,function(g){c._addPlugin(g)});return}var d=OJ(this.plugins,function(g){return l===g});if(!d){if(this.plugins.push(l),!HA(l))throw new Error("Plugins must be function values that return objects");var m=l.call(this);if(!zJ(m))throw new Error("Plugins must return an object of function properties");up(m,function(g,_){if(!HA(g))throw new Error("Bad plugin property: "+_+" from plugin "+l.name+". Plugins should only return functions.");c._assignPluginFnProp(g,_)})}},addStorage:function(l){$J("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(l)}},a=UJ(o,GJ,{plugins:[]});return a.raw={},up(a,function(l,c){HA(l)&&(a.raw[c]=BJ(a,l))}),up(t,function(l){a._addStorage(l)}),up(e,function(l){a._addPlugin(l)}),a}});var UB=Gi((X5t,BB)=>{var HJ=g0(),VJ=HJ.Global;BB.exports={name:"localStorage",read:OB,write:jJ,each:XJ,remove:WJ,clearAll:qJ};function hp(){return VJ.localStorage}function OB(t){return hp().getItem(t)}function jJ(t,e){return hp().setItem(t,e)}function XJ(t){for(var e=hp().length-1;e>=0;e--){var i=hp().key(e);t(OB(i),i)}}function WJ(t){return hp().removeItem(t)}function qJ(){return hp().clear()}});var $B=Gi((W5t,GB)=>{var YJ=g0(),ZJ=YJ.Global;GB.exports={name:"oldFF-globalStorage",read:QJ,write:KJ,each:zB,remove:JJ,clearAll:eee};var y0=ZJ.globalStorage;function QJ(t){return y0[t]}function KJ(t,e){y0[t]=e}function zB(t){for(var e=y0.length-1;e>=0;e--){var i=y0.key(e);t(y0[i],i)}}function JJ(t){return y0.removeItem(t)}function eee(){zB(function(t,e){delete y0[t]})}});var jB=Gi((q5t,VB)=>{var tee=g0(),jA=tee.Global;VB.exports={name:"oldIE-userDataStorage",write:iee,read:ree,each:see,remove:nee,clearAll:oee};var n7="storejs",s7=jA.document,o7=lee(),HB=(jA.navigator?jA.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./);function iee(t,e){if(!HB){var i=XA(t);o7(function(r){r.setAttribute(i,e),r.save(n7)})}}function ree(t){if(!HB){var e=XA(t),i=null;return o7(function(r){i=r.getAttribute(e)}),i}}function see(t){o7(function(e){for(var i=e.XMLDocument.documentElement.attributes,r=i.length-1;r>=0;r--){var s=i[r];t(e.getAttribute(s.name),s.name)}})}function nee(t){var e=XA(t);o7(function(i){i.removeAttribute(e),i.save(n7)})}function oee(){o7(function(t){var e=t.XMLDocument.documentElement.attributes;t.load(n7);for(var i=e.length-1;i>=0;i--)t.removeAttribute(e[i].name);t.save(n7)})}var aee=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function XA(t){return t.replace(/^\d/,"___$&").replace(aee,"___")}function lee(){if(!s7||!s7.documentElement||!s7.documentElement.addBehavior)return null;var t="script",e,i,r;try{i=new ActiveXObject("htmlfile"),i.open(),i.write("<"+t+">document.w=window</"+t+'><iframe src="/favicon.ico"></iframe>'),i.close(),e=i.w.frames[0].document,r=e.createElement("div")}catch(s){r=s7.createElement("div"),e=s7.body}return function(s){var n=[].slice.call(arguments,0);n.unshift(r),e.appendChild(r),r.addBehavior("#default#userData"),r.load(n7),s.apply(this,n),e.removeChild(r)}}});var QB=Gi((Y5t,ZB)=>{var XB=g0(),cee=XB.Global,uee=XB.trim;ZB.exports={name:"cookieStorage",read:hee,write:dee,each:WB,remove:qB,clearAll:fee};var a7=cee.document;function hee(t){if(!t||!YB(t))return null;var e="(?:^|.*;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(a7.cookie.replace(new RegExp(e),"$1"))}function WB(t){for(var e=a7.cookie.split(/; ?/g),i=e.length-1;i>=0;i--)if(uee(e[i])){var r=e[i].split("="),s=unescape(r[0]),n=unescape(r[1]);t(n,s)}}function dee(t,e){t&&(a7.cookie=escape(t)+"="+escape(e)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")}function qB(t){!t||!YB(t)||(a7.cookie=escape(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function fee(){WB(function(t,e){qB(e)})}function YB(t){return new RegExp("(?:^|;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(a7.cookie)}});var eU=Gi((Z5t,JB)=>{var pee=g0(),mee=pee.Global;JB.exports={name:"sessionStorage",read:KB,write:gee,each:yee,remove:_ee,clearAll:xee};function dp(){return mee.sessionStorage}function KB(t){return dp().getItem(t)}function gee(t,e){return dp().setItem(t,e)}function yee(t){for(var e=dp().length-1;e>=0;e--){var i=dp().key(e);t(KB(i),i)}}function _ee(t){return dp().removeItem(t)}function xee(){return dp().clear()}});var iU=Gi((Q5t,tU)=>{tU.exports={name:"memoryStorage",read:vee,write:bee,each:wee,remove:Eee,clearAll:Tee};var _0={};function vee(t){return _0[t]}function bee(t,e){_0[t]=e}function wee(t){for(var e in _0)_0.hasOwnProperty(e)&&t(_0[e],e)}function Eee(t){delete _0[t]}function Tee(t){_0={}}});var sU=Gi((K5t,rU)=>{rU.exports=[UB(),$B(),jB(),QB(),eU(),iU()]});var nU=Gi((exports,module)=>{typeof JSON!="object"&&(JSON={});(function(){"use strict";var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(t){return t<10?"0"+t:t}function this_value(){return this.valueOf()}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;function quote(t){return rx_escapable.lastIndex=0,rx_escapable.test(t)?'"'+t.replace(rx_escapable,function(e){var i=meta[e];return typeof i=="string"?i:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var i,r,s,n,o=gap,a,l=e[t];switch(l&&typeof l=="object"&&typeof l.toJSON=="function"&&(l=l.toJSON(t)),typeof rep=="function"&&(l=rep.call(e,t,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,a=[],Object.prototype.toString.apply(l)==="[object Array]"){for(n=l.length,i=0;i<n;i+=1)a[i]=str(i,l)||"null";return s=a.length===0?"[]":gap?`[
`+gap+a.join(`,
`+gap)+`
`+o+"]":"["+a.join(",")+"]",gap=o,s}if(rep&&typeof rep=="object")for(n=rep.length,i=0;i<n;i+=1)typeof rep[i]=="string"&&(r=rep[i],s=str(r,l),s&&a.push(quote(r)+(gap?": ":":")+s));else for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(s=str(r,l),s&&a.push(quote(r)+(gap?": ":":")+s));return s=a.length===0?"{}":gap?`{
`+gap+a.join(`,
`+gap)+`
`+o+"}":"{"+a.join(",")+"}",gap=o,s}}typeof JSON.stringify!="function"&&(meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,e,i){var r;if(gap="",indent="",typeof i=="number")for(r=0;r<i;r+=1)indent+=" ";else typeof i=="string"&&(indent=i);if(rep=e,e&&typeof e!="function"&&(typeof e!="object"||typeof e.length!="number"))throw new Error("JSON.stringify");return str("",{"":t})}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){var j;function walk(t,e){var i,r,s=t[e];if(s&&typeof s=="object")for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(r=walk(s,i),r!==void 0?s[i]=r:delete s[i]);return reviver.call(t,e,s)}if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})})()});var aU=Gi((J5t,oU)=>{oU.exports=See;function See(){return nU(),{}}});var cU=Gi((emt,lU)=>{var Aee=NB(),Cee=sU(),Iee=[aU()];lU.exports=Aee.createStore(Cee,Iee)});var NU=Gi((jmt,LU)=>{"use strict";LU.exports=function(t,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var i=typeof e.cycles=="boolean"?e.cycles:!1,r=e.cmp&&function(n){return function(o){return function(a,l){var c={key:a,value:o[a]},d={key:l,value:o[l]};return n(c,d)}}}(e.cmp),s=[];return function n(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,l;if(Array.isArray(o)){for(l="[",a=0;a<o.length;a++)a&&(l+=","),l+=n(o[a])||"null";return l+"]"}if(o===null)return"null";if(s.indexOf(o)!==-1){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var c=s.push(o)-1,d=Object.keys(o).sort(r&&r(o));for(l="",a=0;a<d.length;a++){var m=d[a],g=n(o[m]);g&&(l&&(l+=","),l+=JSON.stringify(m)+":"+g)}return s.splice(c,1),"{"+l+"}"}}(t)}});var av={};A9(av,{AbstractBehavior:()=>on,AbstractMode:()=>gs,AbstractSystem:()=>fi,AddNoteMode:()=>B6,AddPointMode:()=>U6,BrowseMode:()=>z6,Category:()=>$2,Collection:()=>jc,Context:()=>ov,DataLoaderSystem:()=>Em,Difference:()=>Za,DragBehavior:()=>mm,DragNodeMode:()=>G6,DrawAreaMode:()=>$6,DrawBehavior:()=>gm,DrawLineMode:()=>H6,EditSystem:()=>Tm,EsriService:()=>Y6,FetchError:()=>um,Field:()=>q2,FilterSystem:()=>Sm,Graph:()=>Cn,HoverBehavior:()=>ym,ImagerySource:()=>Il,ImagerySourceBing:()=>X2,ImagerySourceCustom:()=>j2,ImagerySourceEsri:()=>W2,ImagerySourceNone:()=>V2,ImagerySystem:()=>Mm,ImproveOsmService:()=>Z6,KartaviewService:()=>Q6,KeepRightService:()=>K6,KeyOperationBehavior:()=>Ar,LassoBehavior:()=>_m,LocalizationSystem:()=>Pm,LocationSystem:()=>Fm,Map3dSystem:()=>m6,MapInteractionBehavior:()=>xm,MapNudgingBehavior:()=>vm,MapSystem:()=>p6,MapWithAIService:()=>e7,MapillaryService:()=>J6,MoveMode:()=>V6,NominatimService:()=>t7,NsiService:()=>r7,OsmService:()=>c7,OsmWikibaseService:()=>h7,OsmoseService:()=>u7,PasteBehavior:()=>bm,PhotoSystem:()=>g6,Preset:()=>Xc,PresetSystem:()=>_6,QAItem:()=>Er,RapidSystem:()=>x6,RotateMode:()=>j6,SaveMode:()=>X6,SelectBehavior:()=>wm,SelectMode:()=>W6,SelectOsmMode:()=>q6,StorageSystem:()=>v6,StreetsideService:()=>d7,TaginfoService:()=>p7,Tree:()=>Qa,UiDefs:()=>X4,UiField:()=>Ma,UiPanelBackground:()=>E6,UiPanelHistory:()=>T6,UiPanelLocation:()=>S6,UiPanelMeasurement:()=>A6,UiSystem:()=>P6,UploaderSystem:()=>R6,UrlHashSystem:()=>D6,ValidationFix:()=>Ti,ValidationIssue:()=>or,ValidationSystem:()=>O6,VectorTileService:()=>x7,WikidataService:()=>v7,WikipediaService:()=>b7,actionAddEntity:()=>Ur,actionAddMember:()=>Nd,actionAddMidpoint:()=>nn,actionAddVertex:()=>To,actionChangeMember:()=>hh,actionChangePreset:()=>qa,actionChangeTags:()=>Xr,actionCircularize:()=>Bg,actionConnect:()=>Od,actionCopyEntities:()=>z2,actionDeleteMember:()=>dh,actionDeleteMultiple:()=>Zu,actionDeleteNode:()=>Vc,actionDeleteRelation:()=>gn,actionDeleteWay:()=>Cl,actionDiscardTags:()=>Qu,actionDisconnect:()=>hm,actionExtract:()=>G2,actionJoin:()=>Ug,actionMerge:()=>zg,actionMergeNodes:()=>Ya,actionMergePolygon:()=>Gg,actionMergeRemoteChanges:()=>Z2,actionMove:()=>Wc,actionMoveMember:()=>Hg,actionMoveNode:()=>qc,actionNoop:()=>us,actionOrthogonalize:()=>fh,actionRapidAcceptFeature:()=>Zg,actionReflect:()=>Wg,actionRestrictTurn:()=>tF,actionReverse:()=>pl,actionRevert:()=>pm,actionRotate:()=>Vg,actionScale:()=>iF,actionSplit:()=>Ku,actionStraightenNodes:()=>jg,actionStraightenWay:()=>Xg,actionUnrestrictTurn:()=>rF,actionUpgradeTags:()=>qg,behaviors:()=>uc,d3:()=>Tte,geoChooseEdge:()=>js,geoHasLineIntersections:()=>KD,geoHasSelfIntersections:()=>Bd,geoOrthoCalcScore:()=>$g,geoOrthoCanOrthogonalize:()=>Q2,geoOrthoMaxOffsetAngle:()=>eF,geoOrthoNormalizedDotProduct:()=>Ud,modeDragNote:()=>lB,modes:()=>Pa,operationCircularize:()=>aA,operationContinue:()=>lA,operationCopy:()=>F6,operationCycleHighwayTag:()=>cA,operationDelete:()=>oa,operationDisconnect:()=>uA,operationDowngrade:()=>L6,operationExtract:()=>hA,operationMerge:()=>dA,operationMove:()=>fA,operationOrthogonalize:()=>pA,operationPaste:()=>N6,operationReflectLong:()=>gA,operationReflectShort:()=>mA,operationReverse:()=>yA,operationRotate:()=>_A,operationSplit:()=>xA,operationStraighten:()=>vA,osmAreaKeys:()=>ed,osmChangeset:()=>ia,osmEntity:()=>Dt,osmFlowingWaterwayTagValues:()=>yf,osmInferRestriction:()=>YD,osmIntersection:()=>qD,osmIsInterestingTag:()=>No,osmIsOldMultipolygonOuterMember:()=>U2,osmJoinWays:()=>wa,osmLanes:()=>N8,osmLifecyclePrefixes:()=>F1,osmNode:()=>vi,osmNodeGeometriesForTags:()=>N1,osmNote:()=>Nr,osmOldMultipolygonOuterMember:()=>XD,osmOldMultipolygonOuterMemberOfRelation:()=>B2,osmOneWayTags:()=>O1,osmPavedTags:()=>td,osmPointTags:()=>mf,osmRailwayTrackTagValues:()=>B9,osmRelation:()=>Ms,osmRemoveLifecyclePrefix:()=>g3,osmRoutableHighwayTagValues:()=>ml,osmSetAreaKeys:()=>L9,osmSetPointTags:()=>N9,osmSetVertexTags:()=>O9,osmTagSuggestingArea:()=>L1,osmTurn:()=>fm,osmVertexTags:()=>gf,osmWay:()=>Mr,sdk:()=>Ste,services:()=>Bn,svgTagClasses:()=>$U,systems:()=>On,uiAccount:()=>b_,uiAttribution:()=>T_,uiChangesetEditor:()=>S_,uiCmd:()=>Li,uiCombobox:()=>xr,uiCommit:()=>I_,uiCommitWarnings:()=>C_,uiConfirm:()=>Ch,uiConflicts:()=>k_,uiContributors:()=>M_,uiDataEditor:()=>j4,uiDataHeader:()=>P_,uiDisclosure:()=>a0,uiEditMenu:()=>R_,uiEntityEditor:()=>U_,uiFeatureInfo:()=>pO,uiFeatureList:()=>z_,uiFieldAccess:()=>ES,uiFieldAddress:()=>TS,uiFieldCheck:()=>n0,uiFieldCombo:()=>nl,uiFieldCycleway:()=>SS,uiFieldDefaultCheck:()=>n0,uiFieldEmail:()=>ka,uiFieldIdentifier:()=>ka,uiFieldLanes:()=>__,uiFieldLocalized:()=>AS,uiFieldManyCombo:()=>nl,uiFieldMultiCombo:()=>nl,uiFieldNetworkCombo:()=>nl,uiFieldNumber:()=>ka,uiFieldOnewayCheck:()=>n0,uiFieldRadio:()=>y6,uiFieldRoadspeed:()=>CS,uiFieldSemiCombo:()=>nl,uiFieldStructureRadio:()=>y6,uiFieldTel:()=>ka,uiFieldText:()=>ka,uiFieldTextarea:()=>IS,uiFieldTypeCombo:()=>nl,uiFieldUrl:()=>ka,uiFieldWikidata:()=>kS,uiFieldWikipedia:()=>v_,uiFields:()=>G4,uiFlash:()=>q4,uiFormFields:()=>H4,uiFullScreen:()=>G_,uiGeolocate:()=>$_,uiIcon:()=>Ye,uiImproveOsmComments:()=>H_,uiImproveOsmDetails:()=>V_,uiImproveOsmEditor:()=>Y4,uiImproveOsmHeader:()=>j_,uiInfo:()=>q_,uiInspector:()=>Z_,uiIntro:()=>mc,uiIssuesInfo:()=>Q_,uiKeepRightDetails:()=>K_,uiKeepRightEditor:()=>Q4,uiKeepRightHeader:()=>J_,uiLoading:()=>Yc,uiMap3dViewer:()=>c0,uiMapInMap:()=>u0,uiModal:()=>Ts,uiNoteComments:()=>tx,uiNoteEditor:()=>K4,uiNoteHeader:()=>ix,uiNoteReport:()=>rx,uiOsmoseDetails:()=>sx,uiOsmoseEditor:()=>J4,uiOsmoseHeader:()=>nx,uiPane:()=>Fl,uiPaneBackground:()=>Ox,uiPaneHelp:()=>Bx,uiPaneIssues:()=>$x,uiPaneMapData:()=>qx,uiPanePreferences:()=>Qx,uiPhotoViewer:()=>ax,uiPopover:()=>x_,uiPresetIcon:()=>l0,uiPresetList:()=>Y_,uiRapidColorpicker:()=>lx,uiRapidFeatureInspector:()=>ep,uiRapidFeatureToggleDialog:()=>gx,uiRapidFirstEditDialog:()=>ux,uiRapidPowerUserFeaturesDialog:()=>yx,uiRapidServiceLicense:()=>_x,uiRapidSplash:()=>cx,uiRapidViewManageDatasets:()=>mx,uiRapidWhatsNew:()=>xx,uiRestore:()=>vx,uiScale:()=>bx,uiSection:()=>tr,uiSectionBackgroundDisplayOptions:()=>Rx,uiSectionBackgroundList:()=>Fx,uiSectionBackgroundOffset:()=>Lx,uiSectionChanges:()=>A_,uiSectionDataLayers:()=>Vx,uiSectionEntityIssues:()=>D_,uiSectionFeatureType:()=>F_,uiSectionMapFeatures:()=>jx,uiSectionMapInteractionOptions:()=>Zx,uiSectionMapStyleOptions:()=>Xx,uiSectionOverlayList:()=>Nx,uiSectionPhotoOverlays:()=>Wx,uiSectionPresetFields:()=>L_,uiSectionPrivacy:()=>Yx,uiSectionRawMemberEditor:()=>N_,uiSectionRawMembershipEditor:()=>O_,uiSectionRawTagEditor:()=>Ah,uiSectionSelectionList:()=>B_,uiSectionValidationIssues:()=>M6,uiSectionValidationOptions:()=>Ux,uiSectionValidationRules:()=>zx,uiSectionValidationStatus:()=>Gx,uiSettingsCustomBackground:()=>Dx,uiSettingsCustomData:()=>Hx,uiShortcuts:()=>wx,uiSidebar:()=>Ex,uiSourceSwitch:()=>Tx,uiSpinner:()=>Sx,uiSplash:()=>$O,uiStatus:()=>Ax,uiSuccess:()=>Cx,uiTagReference:()=>iu,uiToggle:()=>V4,uiTooltip:()=>Ft,uiTopToolbar:()=>Ix,uiVersion:()=>kx,uiViewOnKeepRight:()=>ex,uiViewOnOSM:()=>Z4,uiViewOnOsmose:()=>ox,uiZoom:()=>Mx,uiZoomToSelection:()=>Px,utilDetect:()=>Gs,utilFastMouse:()=>cm,utilFetchResponse:()=>Ai,utilFunctor:()=>ss,utilGetSetValue:()=>si,utilHighlightEntities:()=>Ki,utilKeybinding:()=>$i,utilNoAuto:()=>Ri,utilRebind:()=>$t,utilSetTransform:()=>Sl,utilTotalExtent:()=>kr,utilTriggerEvent:()=>N2,utilWrap:()=>L2,validationAlmostJunction:()=>WS,validationCloseNodes:()=>qS,validationCrossingWays:()=>YS,validationDisconnectedWay:()=>ZS,validationDuplicateWaySegments:()=>QS,validationFormatting:()=>KS,validationHelpRequest:()=>JS,validationImpossibleOneway:()=>eA,validationIncompatibleSource:()=>tA,validationMismatchedGeometry:()=>iA,validationMissingRole:()=>rA,validationMissingTag:()=>sA,validationOutdatedTags:()=>nA,validationPrivateData:()=>oA,validationSuspiciousName:()=>EA,validationUnsquareWay:()=>TA,validationYShapedConnection:()=>wA});function Ur(t){return function(e){return e.replace(t)}}var R9=Yi(OI(),1),Eb=Yi(P9(),1),XG=[250,157,60,79,142,134,229,129,138,126,210,129,29,71,160,208];function BI(t,e){e=e||XG;let i=R9.default.utils.hex.toBytes(t),s=new R9.default.ModeOfOperation.ctr(e).decrypt(i);return R9.default.utils.utf8.fromBytes(s)}function jn(t,e){if(t===e)return!0;let i=t.length;if(i!==e.length)return!1;for(;i--;)if(t[i]!==e[i])return!1;return!0}function Sn(t,e){let i=new Set(e);return Array.from(new Set(t)).filter(r=>!i.has(r))}function eo(t,e){let i=new Set(e);return Array.from(new Set(t)).filter(r=>i.has(r))}function as(t,e){let i=new Set(t);return e.forEach(r=>i.add(r)),Array.from(i)}function Ei(t){return Array.from(new Set(t))}function p3(t,e){if(!e||e<0)return[t.slice()];let i=new Array(Math.ceil(t.length/e));return Array.from(i,(r,s)=>t.slice(s*e,s*e+e))}function ds(t,e){return t.reduce((i,r)=>{let s=typeof e=="function"?e(r):r[e];return(i[s]=i[s]||[]).push(r),i},{})}function ff(t,e){let i=new Set;return t.reduce((r,s)=>{let n=typeof e=="function"?e(s):s[e];return n&&!i.has(n)&&(i.add(n),r.push(s)),r},[])}function dn(t,e){return Object.keys(t).reduce((i,r)=>(e.indexOf(r)===-1&&(i[r]=t[r]),i),{})}function Tb(t){let e={};for(let r in t){if(!r)continue;let s=t[r];s!==void 0&&(e[r]=i(r,s))}return e;function i(r,s){function n(l){return/_hours|_times|:conditional$/.test(l)}function o(l){return/^(description|note|fixme)$/.test(l)}if(o(r))return s;let a=s.split(";").map(l=>l.trim()).join(n(r)?"; ":";");return(r.indexOf("website")!==-1||r.indexOf("email")!==-1||a.indexOf("http")===0)&&(a=a.replace(/[\u200B-\u200F\uFEFF]/g,"")),a}}function UI(t,e){let i=new Set;return t.forEach(r),Array.from(i);function r(s){if(i.has(s))return;i.add(s);let n=e.hasEntity(s);!n||n.type!=="relation"||(n.members||[]).forEach(o=>r(o.id))}}function Qh(t,e){let i=new Set(t);return t.forEach(r),WG(Array.from(i));function r(s){var n=e.hasEntity(s);!n||n.type!=="relation"||(n.members||[]).forEach(o=>i.add(o.id))}}function WG(t){return t.length?"."+t.join(",."):"nothing"}function ls(t,e){let i=new Set,r=new Set;return t.forEach(s),Array.from(r);function s(n){if(i.has(n))return;i.add(n);let o=e.hasEntity(n);o&&(o.type==="node"?r.add(o):o.type==="way"?(o.nodes||[]).forEach(s):(o.members||[]).forEach(a=>s(a.id)))}}function pf(t,e){let i=[];return as(Object.keys(t),Object.keys(e)).sort().forEach(s=>{let n=t[s],o=e[s];(n||n==="")&&(o===void 0||o!==n)&&i.push({type:"-",key:s,oldVal:n,newVal:o,display:`- ${s}=${n}`}),(o||o==="")&&(n===void 0||o!==n)&&i.push({type:"+",key:s,oldVal:n,newVal:o,display:`+ ${s}=${o}`})}),i}function zI(t){let e=t&&t.tags||{};return Object.keys(e).map(i=>`${i}=${e[i]}`).join(", ")}function GI(t){let e;function i(){let s=new Date;s.setSeconds(s.getSeconds()+5),document.cookie=t+"=1; expires="+s.toUTCString()+"; sameSite=strict"}return{lock:()=>e?!0:document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+t+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")?!1:(i(),e=window.setInterval(i,4e3),!0),unlock:()=>{e&&(document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; sameSite=strict",clearInterval(e),e=null)},locked:()=>!!e}}function D9(t,e){if(t=(0,Eb.remove)(t.toLowerCase()),e=(0,Eb.remove)(e.toLowerCase()),t.length===0)return e.length;if(e.length===0)return t.length;let i=[];for(let r=0;r<=e.length;r++)i[r]=[r];for(let r=0;r<=t.length;r++)i[0][r]=r;for(let r=1;r<=e.length;r++)for(let s=1;s<=t.length;s++)e.charAt(r-1)===t.charAt(s-1)?i[r][s]=i[r-1][s-1]:i[r][s]=Math.min(i[r-1][s-1]+1,Math.min(i[r][s-1]+1,i[r-1][s]+1));return i[e.length][t.length]}function m3(t){let e=0;if(t.length===0)return e;for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);e=(e<<5)-e+r,e=e&e}return e}function lr(t,e){function i(r){return encodeURIComponent(r).replace(/(%2F|%3A|%2C|%7B|%7D)/g,decodeURIComponent)}return Object.keys(t).sort().map(r=>encodeURIComponent(r)+"="+(e?i(t[r]):encodeURIComponent(t[r]))).join("&")}function Kh(t){let e=0;for(;e<t.length&&(t[e]==="?"||t[e]==="#");)e++;return t=t.slice(e),t.split("&").reduce((i,r)=>{let s=r.split("=");return s.length===2&&(i[s[0]]=decodeURIComponent(s[1])),i},{})}function Sb(t){return Array.from(t).length}function F9(t,e){return Array.from(t).slice(0,e).join("")}function Jh(t){return t.toLowerCase().replace(/[^a-z0-9]+/g,"_")}function fl(t){return"rapideditor-"+Jh(t.toString())+"-"+new Date().getTime().toString()}function pl(t,e){var i=/^.*(_|:)?(description|name|note|website|ref|source|comment|watch|attribution)(_|:)?/,r=/^([+\-]?)(?=[\d.])/,s=/direction$/,n=/^turn:lanes:?/,o=[[/:right$/,":left"],[/:left$/,":right"],[/:forward$/,":backward"],[/:backward$/,":forward"],[/:right:/,":left:"],[/:left:/,":right:"],[/:forward:/,":backward:"],[/:backward:/,":forward:"]],a={left:"right",right:"left",up:"down",down:"up",forward:"backward",backward:"forward",forwards:"backward",backwards:"forward"},l={forward:"backward",backward:"forward",forwards:"backward",backwards:"forward"},c={yes:"-1",1:"-1","-1":"yes"},d={N:"S",NNE:"SSW",NE:"SW",ENE:"WSW",E:"W",ESE:"WNW",SE:"NW",SSE:"NNW",S:"N",SSW:"NNE",SW:"NE",WSW:"ENE",W:"E",WNW:"ESE",NW:"SE",NNW:"SSE"};function m(b){for(var T=0;T<o.length;++T){var A=o[T];if(A[0].test(b))return b.replace(A[0],A[1])}return b}function g(b,T,A){if(i.test(b)||n.test(b))return T;if(b==="incline"&&r.test(T))return T.replace(r,function(k,F){return F==="-"?"":"-"});if(e&&e.reverseOneway&&b==="oneway")return c[T]||T;if(A&&s.test(b)){if(d[T])return d[T];var M=parseFloat(T);if(typeof M=="number"&&!isNaN(M))return M<180?M+=180:M-=180,M.toString()}return a[T]||T}function _(b,T){for(var A=0;A<T.length;A++){var M=b.hasEntity(T[A]);if(!(!M||!Object.keys(M.tags).length)){var k={};for(var F in M.tags)k[m(F)]=g(F,M.tags[F],M.id===t);b=b.replace(M.update({tags:k}))}}return b}function v(b,T){var A=T.nodes.slice().reverse(),M={},k;for(var F in T.tags)M[m(F)]=g(F,T.tags[F]);return b.parentRelations(T).forEach(function(O){O.members.forEach(function(B,U){B.id===T.id&&(k=l[B.role])&&(O=O.updateMember({role:k},U),b=b.replace(O))})}),_(b,A).replace(T.update({nodes:A,tags:M}))}var E=function(b){var T=b.entity(t);return T.type==="way"?v(b,T):_(b,[t])};return E.disabled=function(b){var T=b.hasEntity(t);if(!T||T.type==="way")return!1;for(var A in T.tags){var M=T.tags[A];if(m(A)!==A||g(A,M,!0)!==M)return!1}return"nondirectional_node"},E.entityID=function(){return t},E}function No(t){return t!=="attribution"&&t!=="created_by"&&t!=="source"&&t!=="odbl"&&t.indexOf("source:")!==0&&t.indexOf("source_ref")!==0&&t.indexOf("tiger:")!==0}var ed={};function L9(t){ed=t}var F1={proposed:!0,planned:!0,construction:!0,disused:!0,abandoned:!0,was:!0,dismantled:!0,razed:!0,demolished:!0,destroyed:!0,removed:!0,obliterated:!0,intermittent:!0};function g3(t){let e=t.split(":");return e.length===1?t:e[0]in F1?t.slice(e[0].length+1):t}var $I={highway:{elevator:!0,rest_area:!0,services:!0},public_transport:{platform:!0},railway:{platform:!0,roundhouse:!0,station:!0,traverser:!0,turntable:!0,wash:!0},traffic_calming:{island:!0},waterway:{dam:!0}};function L1(t){if(t.area==="yes")return{area:"yes"};if(t.area==="no")return null;var e={};for(var i in t){let r=g3(i);if(r in ed&&!(t[i]in ed[r])||r in $I&&t[i]in $I[r])return e[i]=t[i],e}return null}var mf={};function N9(t){mf=t}var gf={};function O9(t){gf=t}function N1(t){var e={};for(var i in t)if(mf[i]&&(mf[i]["*"]||mf[i][t[i]])&&(e.point=!0),gf[i]&&(gf[i]["*"]||gf[i][t[i]])&&(e.vertex=!0),e.point&&e.vertex)break;return e}var O1={aerialway:{chair_lift:!0,drag_lift:!0,"j-bar":!0,magic_carpet:!0,mixed_lift:!0,platter:!0,rope_tow:!0,"t-bar":!0,zip_line:!0},highway:{motorway:!0},junction:{circular:!0,roundabout:!0},man_made:{goods_conveyor:!0,"piste:halfpipe":!0},"piste:type":{downhill:!0,sled:!0,yes:!0},"seamark:type":{"two-way_route":!0,recommended_traffic_lane:!0,separation_lane:!0,separation_roundabout:!0},waterway:{canal:!0,ditch:!0,drain:!0,fish_pass:!0,pressurised:!0,river:!0,spillway:!0,stream:!0,tidal_channel:!0}},td={surface:{paved:!0,asphalt:!0,concrete:!0,chipseal:!0,"concrete:lanes":!0,"concrete:plates":!0},tracktype:{grade1:!0}},Ab={surface:{cobblestone:!0,"cobblestone:flattened":!0,unhewn_cobblestone:!0,sett:!0,paving_stones:!0,metal:!0,wood:!0}},y3={natural:{cliff:!0,coastline:"coastline"},barrier:{retaining_wall:!0,kerb:!0,guard_rail:!0,city_wall:!0},man_made:{embankment:!0},waterway:{weir:!0}},ml={motorway:!0,trunk:!0,primary:!0,secondary:!0,tertiary:!0,residential:!0,motorway_link:!0,trunk_link:!0,primary_link:!0,secondary_link:!0,tertiary_link:!0,unclassified:!0,road:!0,service:!0,track:!0,living_street:!0,bus_guideway:!0,path:!0,footway:!0,cycleway:!0,bridleway:!0,pedestrian:!0,corridor:!0,steps:!0},HI={runway:!0,taxiway:!0},ql={path:!0,footway:!0,cycleway:!0,bridleway:!0,pedestrian:!0,corridor:!0,steps:!0},B9={rail:!0,light_rail:!0,tram:!0,subway:!0,monorail:!0,funicular:!0,miniature:!0,narrow_gauge:!0,disused:!0,preserved:!0},yf={canal:!0,ditch:!0,drain:!0,fish_pass:!0,river:!0,stream:!0,tidal_channel:!0};function Tu(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function _f(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function*VI(t,e){if(e===void 0)for(let i of t)i!=null&&(i=+i)>=i&&(yield i);else{let i=-1;for(let r of t)(r=e(r,++i,t))!=null&&(r=+r)>=r&&(yield r)}}var xo=class{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){let i=this._partials,r=0;for(let s=0;s<this._n&&s<32;s++){let n=i[s],o=e+n,a=Math.abs(e)<Math.abs(n)?e-(o-n):n-(o-e);a&&(i[r++]=a),e=o}return i[r]=e,this._n=r+1,this}valueOf(){let e=this._partials,i=this._n,r,s,n,o=0;if(i>0){for(o=e[--i];i>0&&(r=o,s=e[--i],o=r+s,n=s-(o-r),!n););i>0&&(n<0&&e[i-1]<0||n>0&&e[i-1]>0)&&(s=n*2,r=o+s,s==r-o&&(o=r))}return o}};function jI(t=Tu){if(t===Tu)return Cb;if(typeof t!="function")throw new TypeError("compare is not a function");return(e,i)=>{let r=t(e,i);return r||r===0?r:(t(i,i)===0)-(t(e,e)===0)}}function Cb(t,e){return(t==null||!(t>=t))-(e==null||!(e>=e))||(t<e?-1:t>e?1:0)}function U9(t,e){let i;if(e===void 0)for(let r of t)r!=null&&(i<r||i===void 0&&r>=r)&&(i=r);else{let r=-1;for(let s of t)(s=e(s,++r,t))!=null&&(i<s||i===void 0&&s>=s)&&(i=s)}return i}function z9(t,e){let i;if(e===void 0)for(let r of t)r!=null&&(i>r||i===void 0&&r>=r)&&(i=r);else{let r=-1;for(let s of t)(s=e(s,++r,t))!=null&&(i>s||i===void 0&&s>=s)&&(i=s)}return i}function G9(t,e,i=0,r=1/0,s){if(e=Math.floor(e),i=Math.floor(Math.max(0,i)),r=Math.floor(Math.min(t.length-1,r)),!(i<=e&&e<=r))return t;for(s=s===void 0?Cb:jI(s);r>i;){if(r-i>600){let l=r-i+1,c=e-i+1,d=Math.log(l),m=.5*Math.exp(2*d/3),g=.5*Math.sqrt(d*m*(l-m)/l)*(c-l/2<0?-1:1),_=Math.max(i,Math.floor(e-c*m/l+g)),v=Math.min(r,Math.floor(e+(l-c)*m/l+g));G9(t,e,_,v,s)}let n=t[e],o=i,a=r;for(_3(t,i,e),s(t[r],n)>0&&_3(t,i,r);o<a;){for(_3(t,o,a),++o,--a;s(t[o],n)<0;)++o;for(;s(t[a],n)>0;)--a}s(t[i],n)===0?_3(t,i,a):(++a,_3(t,a,r)),a<=e&&(i=a+1),e<=a&&(r=a-1)}return t}function _3(t,e,i){let r=t[e];t[e]=t[i],t[i]=r}function Ib(t,e,i){if(t=Float64Array.from(VI(t,i)),!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return z9(t);if(e>=1)return U9(t);var r,s=(r-1)*e,n=Math.floor(s),o=U9(G9(t,n).subarray(0,n+1)),a=z9(t.subarray(n+1));return o+(a-o)*(s-n)}}function $9(t,e){return Ib(t,.5,e)}var xf=1e-6,kb=1e-12,vf=Math.PI,x3=vf/2,Mb=vf/4,H9=vf*2,id=180/vf,ks=vf/180,bf=Math.abs,XI=Math.atan,Su=Math.atan2,Qs=Math.cos;var WI=Math.exp;var V9=Math.hypot,qI=Math.log;var Ks=Math.sin;var wf=Math.sqrt,YI=Math.tan;function v3(t){return t>1?x3:t<-1?-x3:Math.asin(t)}function Oo(){}function j9(t,e){t&&QI.hasOwnProperty(t.type)&&QI[t.type](t,e)}var ZI={Feature:function(t,e){j9(t.geometry,e)},FeatureCollection:function(t,e){for(var i=t.features,r=-1,s=i.length;++r<s;)j9(i[r].geometry,e)}},QI={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var i=t.coordinates,r=-1,s=i.length;++r<s;)t=i[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){Pb(t.coordinates,e,0)},MultiLineString:function(t,e){for(var i=t.coordinates,r=-1,s=i.length;++r<s;)Pb(i[r],e,0)},Polygon:function(t,e){KI(t.coordinates,e)},MultiPolygon:function(t,e){for(var i=t.coordinates,r=-1,s=i.length;++r<s;)KI(i[r],e)},GeometryCollection:function(t,e){for(var i=t.geometries,r=-1,s=i.length;++r<s;)j9(i[r],e)}};function Pb(t,e,i){var r=-1,s=t.length-i,n;for(e.lineStart();++r<s;)n=t[r],e.point(n[0],n[1],n[2]);e.lineEnd()}function KI(t,e){var i=-1,r=t.length;for(e.polygonStart();++i<r;)Pb(t[i],e,1);e.polygonEnd()}function B1(t,e){t&&ZI.hasOwnProperty(t.type)?ZI[t.type](t,e):j9(t,e)}var b3=new xo,X9=new xo,JI,ek,Rb,Db,Fb,Yl={point:Oo,lineStart:Oo,lineEnd:Oo,polygonStart:function(){b3=new xo,Yl.lineStart=YG,Yl.lineEnd=ZG},polygonEnd:function(){var t=+b3;X9.add(t<0?H9+t:t),this.lineStart=this.lineEnd=this.point=Oo},sphere:function(){X9.add(H9)}};function YG(){Yl.point=QG}function ZG(){tk(JI,ek)}function QG(t,e){Yl.point=tk,JI=t,ek=e,t*=ks,e*=ks,Rb=t,Db=Qs(e=e/2+Mb),Fb=Ks(e)}function tk(t,e){t*=ks,e*=ks,e=e/2+Mb;var i=t-Rb,r=i>=0?1:-1,s=r*i,n=Qs(e),o=Ks(e),a=Fb*o,l=Db*n+a*Qs(s),c=a*r*Ks(s);b3.add(Su(c,l)),Rb=t,Db=n,Fb=o}function Mc(t){return X9=new xo,B1(t,Yl),X9*2}function ik(t){return[Su(t[1],t[0]),v3(t[2])]}function rk(t){var e=t[0],i=t[1],r=Qs(i);return[r*Qs(e),r*Ks(e),Ks(i)]}function Lb(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function sk(t){var e=wf(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var Us,pa,Js,za,rd,lk,ck,Ef,w3,U1,Cu,Au={point:Nb,lineStart:nk,lineEnd:ok,polygonStart:function(){Au.point=hk,Au.lineStart=KG,Au.lineEnd=JG,w3=new xo,Yl.polygonStart()},polygonEnd:function(){Yl.polygonEnd(),Au.point=Nb,Au.lineStart=nk,Au.lineEnd=ok,b3<0?(Us=-(Js=180),pa=-(za=90)):w3>xf?za=90:w3<-xf&&(pa=-90),Cu[0]=Us,Cu[1]=Js},sphere:function(){Us=-(Js=180),pa=-(za=90)}};function Nb(t,e){U1.push(Cu=[Us=t,Js=t]),e<pa&&(pa=e),e>za&&(za=e)}function uk(t,e){var i=rk([t*ks,e*ks]);if(Ef){var r=Lb(Ef,i),s=[r[1],-r[0],0],n=Lb(s,r);sk(n),n=ik(n);var o=t-rd,a=o>0?1:-1,l=n[0]*id*a,c,d=bf(o)>180;d^(a*rd<l&&l<a*t)?(c=n[1]*id,c>za&&(za=c)):(l=(l+360)%360-180,d^(a*rd<l&&l<a*t)?(c=-n[1]*id,c<pa&&(pa=c)):(e<pa&&(pa=e),e>za&&(za=e))),d?t<rd?Ua(Us,t)>Ua(Us,Js)&&(Js=t):Ua(t,Js)>Ua(Us,Js)&&(Us=t):Js>=Us?(t<Us&&(Us=t),t>Js&&(Js=t)):t>rd?Ua(Us,t)>Ua(Us,Js)&&(Js=t):Ua(t,Js)>Ua(Us,Js)&&(Us=t)}else U1.push(Cu=[Us=t,Js=t]);e<pa&&(pa=e),e>za&&(za=e),Ef=i,rd=t}function nk(){Au.point=uk}function ok(){Cu[0]=Us,Cu[1]=Js,Au.point=Nb,Ef=null}function hk(t,e){if(Ef){var i=t-rd;w3.add(bf(i)>180?i+(i>0?360:-360):i)}else lk=t,ck=e;Yl.point(t,e),uk(t,e)}function KG(){Yl.lineStart()}function JG(){hk(lk,ck),Yl.lineEnd(),bf(w3)>xf&&(Us=-(Js=180)),Cu[0]=Us,Cu[1]=Js,Ef=null}function Ua(t,e){return(e-=t)<0?e+360:e}function e$(t,e){return t[0]-e[0]}function ak(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}function Ob(t){var e,i,r,s,n,o,a;if(za=Js=-(Us=pa=1/0),U1=[],B1(t,Au),i=U1.length){for(U1.sort(e$),e=1,r=U1[0],n=[r];e<i;++e)s=U1[e],ak(r,s[0])||ak(r,s[1])?(Ua(r[0],s[1])>Ua(r[0],r[1])&&(r[1]=s[1]),Ua(s[0],r[1])>Ua(r[0],r[1])&&(r[0]=s[0])):n.push(r=s);for(o=-1/0,i=n.length-1,e=0,r=n[i];e<=i;r=s,++e)s=n[e],(a=Ua(r[1],s[0]))>o&&(o=a,Us=s[0],Js=r[1])}return U1=Cu=null,Us===1/0||pa===1/0?[[NaN,NaN],[NaN,NaN]]:[[Us,pa],[Js,za]]}var E3,W9,q9,Y9,Z9,Q9,K9,J9,Bb,Ub,zb,pk,mk,Bo,Uo,zo,Zl={sphere:Oo,point:Gb,lineStart:dk,lineEnd:fk,polygonStart:function(){Zl.lineStart=r$,Zl.lineEnd=s$},polygonEnd:function(){Zl.lineStart=dk,Zl.lineEnd=fk}};function Gb(t,e){t*=ks,e*=ks;var i=Qs(e);T3(i*Qs(t),i*Ks(t),Ks(e))}function T3(t,e,i){++E3,q9+=(t-q9)/E3,Y9+=(e-Y9)/E3,Z9+=(i-Z9)/E3}function dk(){Zl.point=t$}function t$(t,e){t*=ks,e*=ks;var i=Qs(e);Bo=i*Qs(t),Uo=i*Ks(t),zo=Ks(e),Zl.point=i$,T3(Bo,Uo,zo)}function i$(t,e){t*=ks,e*=ks;var i=Qs(e),r=i*Qs(t),s=i*Ks(t),n=Ks(e),o=Su(wf((o=Uo*n-zo*s)*o+(o=zo*r-Bo*n)*o+(o=Bo*s-Uo*r)*o),Bo*r+Uo*s+zo*n);W9+=o,Q9+=o*(Bo+(Bo=r)),K9+=o*(Uo+(Uo=s)),J9+=o*(zo+(zo=n)),T3(Bo,Uo,zo)}function fk(){Zl.point=Gb}function r$(){Zl.point=n$}function s$(){gk(pk,mk),Zl.point=Gb}function n$(t,e){pk=t,mk=e,t*=ks,e*=ks,Zl.point=gk;var i=Qs(e);Bo=i*Qs(t),Uo=i*Ks(t),zo=Ks(e),T3(Bo,Uo,zo)}function gk(t,e){t*=ks,e*=ks;var i=Qs(e),r=i*Qs(t),s=i*Ks(t),n=Ks(e),o=Uo*n-zo*s,a=zo*r-Bo*n,l=Bo*s-Uo*r,c=V9(o,a,l),d=v3(c),m=c&&-d/c;Bb.add(m*o),Ub.add(m*a),zb.add(m*l),W9+=d,Q9+=d*(Bo+(Bo=r)),K9+=d*(Uo+(Uo=s)),J9+=d*(zo+(zo=n)),T3(Bo,Uo,zo)}function $b(t){E3=W9=q9=Y9=Z9=Q9=K9=J9=0,Bb=new xo,Ub=new xo,zb=new xo,B1(t,Zl);var e=+Bb,i=+Ub,r=+zb,s=V9(e,i,r);return s<kb&&(e=Q9,i=K9,r=J9,W9<xf&&(e=q9,i=Y9,r=Z9),s=V9(e,i,r),s<kb)?[NaN,NaN]:[Su(i,e)*id,v3(r/s)*id]}var Hb,Vb,e8,t8,Tf={sphere:Oo,point:Oo,lineStart:o$,lineEnd:Oo,polygonStart:Oo,polygonEnd:Oo};function o$(){Tf.point=l$,Tf.lineEnd=a$}function a$(){Tf.point=Tf.lineEnd=Oo}function l$(t,e){t*=ks,e*=ks,Vb=t,e8=Ks(e),t8=Qs(e),Tf.point=c$}function c$(t,e){t*=ks,e*=ks;var i=Ks(e),r=Qs(e),s=bf(t-Vb),n=Qs(s),o=Ks(s),a=r*o,l=t8*i-e8*r*n,c=e8*i+t8*r*n;Hb.add(Su(wf(a*a+l*l),c)),Vb=t,e8=i,t8=r}function jb(t){return Hb=new xo,B1(t,Tf),+Hb}function Wb(t){return{stream:u$(t)}}function u$(t){return function(e){var i=new Xb;for(var r in t)i[r]=t[r];return i.stream=e,i}}function Xb(){}Xb.prototype={constructor:Xb,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Sf(t,e){return[t,qI(YI((x3+e)/2))]}Sf.invert=function(t,e){return[t,2*XI(WI(e))-x3]};function Af(t){for(var e=-1,i=t.length,r,s=t[i-1],n=0;++e<i;)r=s,s=t[e],n+=r[1]*s[0]-r[0]*s[1];return n/2}function ma(t){for(var e=-1,i=t.length,r=0,s=0,n,o=t[i-1],a,l=0;++e<i;)n=o,o=t[e],l+=a=n[0]*o[1]-o[0]*n[1],r+=(n[0]+o[0])*a,s+=(n[1]+o[1])*a;return l*=3,[r/l,s/l]}function yk(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(e[1]-t[1])*(i[0]-t[0])}function h$(t,e){return t[0]-e[0]||t[1]-e[1]}function _k(t){let e=t.length,i=[0,1],r=2,s;for(s=2;s<e;++s){for(;r>1&&yk(t[i[r-2]],t[i[r-1]],t[s])<=0;)--r;i[r++]=s}return i.slice(0,r)}function Ql(t){if((i=t.length)<3)return null;var e,i,r=new Array(i),s=new Array(i);for(e=0;e<i;++e)r[e]=[+t[e][0],+t[e][1],e];for(r.sort(h$),e=0;e<i;++e)s[e]=[r[e][0],-r[e][1]];var n=_k(r),o=_k(s),a=o[0]===n[0],l=o[o.length-1]===n[n.length-1],c=[];for(e=n.length-1;e>=0;--e)c.push(t[r[n[e]][2]]);for(e=+a;e<o.length-l;++e)c.push(t[r[o[e]][2]]);return c}var d$={value:()=>{}};function vk(){for(var t=0,e=arguments.length,i={},r;t<e;++t){if(!(r=arguments[t]+"")||r in i||/[\s.]/.test(r))throw new Error("illegal type: "+r);i[r]=[]}return new i8(i)}function i8(t){this._=t}function f$(t,e){return t.trim().split(/^|\s+/).map(function(i){var r="",s=i.indexOf(".");if(s>=0&&(r=i.slice(s+1),i=i.slice(0,s)),i&&!e.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:r}})}i8.prototype=vk.prototype={constructor:i8,on:function(t,e){var i=this._,r=f$(t+"",i),s,n=-1,o=r.length;if(arguments.length<2){for(;++n<o;)if((s=(t=r[n]).type)&&(s=p$(i[s],t.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++n<o;)if(s=(t=r[n]).type)i[s]=xk(i[s],t.name,e);else if(e==null)for(s in i)i[s]=xk(i[s],t.name,null);return this},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new i8(t)},call:function(t,e){if((s=arguments.length-2)>0)for(var i=new Array(s),r=0,s,n;r<s;++r)i[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(n=this._[t],r=0,s=n.length;r<s;++r)n[r].value.apply(e,i)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],s=0,n=r.length;s<n;++s)r[s].value.apply(e,i)}};function p$(t,e){for(var i=0,r=t.length,s;i<r;++i)if((s=t[i]).name===e)return s.value}function xk(t,e,i){for(var r=0,s=t.length;r<s;++r)if(t[r].name===e){t[r]=d$,t=t.slice(0,r).concat(t.slice(r+1));break}return i!=null&&t.push({name:e,value:i}),t}var Pt=vk;var r8="http://www.w3.org/1999/xhtml",qb={svg:"http://www.w3.org/2000/svg",xhtml:r8,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Iu(t){var e=t+="",i=e.indexOf(":");return i>=0&&(e=t.slice(0,i))!=="xmlns"&&(t=t.slice(i+1)),qb.hasOwnProperty(e)?{space:qb[e],local:t}:t}function m$(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===r8&&e.documentElement.namespaceURI===r8?e.createElement(t):e.createElementNS(i,t)}}function g$(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function s8(t){var e=Iu(t);return(e.local?g$:m$)(e)}function y$(){}function sd(t){return t==null?y$:function(){return this.querySelector(t)}}function bk(t){typeof t!="function"&&(t=sd(t));for(var e=this._groups,i=e.length,r=new Array(i),s=0;s<i;++s)for(var n=e[s],o=n.length,a=r[s]=new Array(o),l,c,d=0;d<o;++d)(l=n[d])&&(c=t.call(l,l.__data__,d,n))&&("__data__"in l&&(c.__data__=l.__data__),a[d]=c);return new ws(r,this._parents)}function S3(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function _$(){return[]}function A3(t){return t==null?_$:function(){return this.querySelectorAll(t)}}function x$(t){return function(){return S3(t.apply(this,arguments))}}function wk(t){typeof t=="function"?t=x$(t):t=A3(t);for(var e=this._groups,i=e.length,r=[],s=[],n=0;n<i;++n)for(var o=e[n],a=o.length,l,c=0;c<a;++c)(l=o[c])&&(r.push(t.call(l,l.__data__,c,o)),s.push(l));return new ws(r,s)}function C3(t){return function(){return this.matches(t)}}function n8(t){return function(e){return e.matches(t)}}var v$=Array.prototype.find;function b$(t){return function(){return v$.call(this.children,t)}}function w$(){return this.firstElementChild}function Ek(t){return this.select(t==null?w$:b$(typeof t=="function"?t:n8(t)))}var E$=Array.prototype.filter;function T$(){return Array.from(this.children)}function S$(t){return function(){return E$.call(this.children,t)}}function Tk(t){return this.selectAll(t==null?T$:S$(typeof t=="function"?t:n8(t)))}function Sk(t){typeof t!="function"&&(t=C3(t));for(var e=this._groups,i=e.length,r=new Array(i),s=0;s<i;++s)for(var n=e[s],o=n.length,a=r[s]=[],l,c=0;c<o;++c)(l=n[c])&&t.call(l,l.__data__,c,n)&&a.push(l);return new ws(r,this._parents)}function o8(t){return new Array(t.length)}function Ak(){return new ws(this._enter||this._groups.map(o8),this._parents)}function I3(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}I3.prototype={constructor:I3,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Ck(t){return function(){return t}}function A$(t,e,i,r,s,n){for(var o=0,a,l=e.length,c=n.length;o<c;++o)(a=e[o])?(a.__data__=n[o],r[o]=a):i[o]=new I3(t,n[o]);for(;o<l;++o)(a=e[o])&&(s[o]=a)}function C$(t,e,i,r,s,n,o){var a,l,c=new Map,d=e.length,m=n.length,g=new Array(d),_;for(a=0;a<d;++a)(l=e[a])&&(g[a]=_=o.call(l,l.__data__,a,e)+"",c.has(_)?s[a]=l:c.set(_,l));for(a=0;a<m;++a)_=o.call(t,n[a],a,n)+"",(l=c.get(_))?(r[a]=l,l.__data__=n[a],c.delete(_)):i[a]=new I3(t,n[a]);for(a=0;a<d;++a)(l=e[a])&&c.get(g[a])===l&&(s[a]=l)}function I$(t){return t.__data__}function Ik(t,e){if(!arguments.length)return Array.from(this,I$);var i=e?C$:A$,r=this._parents,s=this._groups;typeof t!="function"&&(t=Ck(t));for(var n=s.length,o=new Array(n),a=new Array(n),l=new Array(n),c=0;c<n;++c){var d=r[c],m=s[c],g=m.length,_=k$(t.call(d,d&&d.__data__,c,r)),v=_.length,E=a[c]=new Array(v),b=o[c]=new Array(v),T=l[c]=new Array(g);i(d,m,E,b,T,_,e);for(var A=0,M=0,k,F;A<v;++A)if(k=E[A]){for(A>=M&&(M=A+1);!(F=b[M])&&++M<v;);k._next=F||null}}return o=new ws(o,r),o._enter=a,o._exit=l,o}function k$(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function kk(){return new ws(this._exit||this._groups.map(o8),this._parents)}function Mk(t,e,i){var r=this.enter(),s=this,n=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(s=e(s),s&&(s=s.selection())),i==null?n.remove():i(n),r&&s?r.merge(s).order():s}function Pk(t){for(var e=t.selection?t.selection():t,i=this._groups,r=e._groups,s=i.length,n=r.length,o=Math.min(s,n),a=new Array(s),l=0;l<o;++l)for(var c=i[l],d=r[l],m=c.length,g=a[l]=new Array(m),_,v=0;v<m;++v)(_=c[v]||d[v])&&(g[v]=_);for(;l<s;++l)a[l]=i[l];return new ws(a,this._parents)}function Rk(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var r=t[e],s=r.length-1,n=r[s],o;--s>=0;)(o=r[s])&&(n&&o.compareDocumentPosition(n)^4&&n.parentNode.insertBefore(o,n),n=o);return this}function Dk(t){t||(t=M$);function e(m,g){return m&&g?t(m.__data__,g.__data__):!m-!g}for(var i=this._groups,r=i.length,s=new Array(r),n=0;n<r;++n){for(var o=i[n],a=o.length,l=s[n]=new Array(a),c,d=0;d<a;++d)(c=o[d])&&(l[d]=c);l.sort(e)}return new ws(s,this._parents).order()}function M$(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Fk(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Lk(){return Array.from(this)}function Nk(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],s=0,n=r.length;s<n;++s){var o=r[s];if(o)return o}return null}function Ok(){let t=0;for(let e of this)++t;return t}function Bk(){return!this.node()}function Uk(t){for(var e=this._groups,i=0,r=e.length;i<r;++i)for(var s=e[i],n=0,o=s.length,a;n<o;++n)(a=s[n])&&t.call(a,a.__data__,n,s);return this}function P$(t){return function(){this.removeAttribute(t)}}function R$(t){return function(){this.removeAttributeNS(t.space,t.local)}}function D$(t,e){return function(){this.setAttribute(t,e)}}function F$(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function L$(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(t):this.setAttribute(t,i)}}function N$(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function zk(t,e){var i=Iu(t);if(arguments.length<2){var r=this.node();return i.local?r.getAttributeNS(i.space,i.local):r.getAttribute(i)}return this.each((e==null?i.local?R$:P$:typeof e=="function"?i.local?N$:L$:i.local?F$:D$)(i,e))}function a8(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function O$(t){return function(){this.style.removeProperty(t)}}function B$(t,e,i){return function(){this.style.setProperty(t,e,i)}}function U$(t,e,i){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,i)}}function Gk(t,e,i){return arguments.length>1?this.each((e==null?O$:typeof e=="function"?U$:B$)(t,e,i==null?"":i)):z1(this.node(),t)}function z1(t,e){return t.style.getPropertyValue(e)||a8(t).getComputedStyle(t,null).getPropertyValue(e)}function z$(t){return function(){delete this[t]}}function G$(t,e){return function(){this[t]=e}}function $$(t,e){return function(){var i=e.apply(this,arguments);i==null?delete this[t]:this[t]=i}}function $k(t,e){return arguments.length>1?this.each((e==null?z$:typeof e=="function"?$$:G$)(t,e)):this.node()[t]}function Hk(t){return t.trim().split(/^|\s+/)}function Yb(t){return t.classList||new Vk(t)}function Vk(t){this._node=t,this._names=Hk(t.getAttribute("class")||"")}Vk.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function jk(t,e){for(var i=Yb(t),r=-1,s=e.length;++r<s;)i.add(e[r])}function Xk(t,e){for(var i=Yb(t),r=-1,s=e.length;++r<s;)i.remove(e[r])}function H$(t){return function(){jk(this,t)}}function V$(t){return function(){Xk(this,t)}}function j$(t,e){return function(){(e.apply(this,arguments)?jk:Xk)(this,t)}}function Wk(t,e){var i=Hk(t+"");if(arguments.length<2){for(var r=Yb(this.node()),s=-1,n=i.length;++s<n;)if(!r.contains(i[s]))return!1;return!0}return this.each((typeof e=="function"?j$:e?H$:V$)(i,e))}function X$(){this.textContent=""}function W$(t){return function(){this.textContent=t}}function q$(t){return function(){var e=t.apply(this,arguments);this.textContent=e==null?"":e}}function qk(t){return arguments.length?this.each(t==null?X$:(typeof t=="function"?q$:W$)(t)):this.node().textContent}function Y$(){this.innerHTML=""}function Z$(t){return function(){this.innerHTML=t}}function Q$(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e==null?"":e}}function Yk(t){return arguments.length?this.each(t==null?Y$:(typeof t=="function"?Q$:Z$)(t)):this.node().innerHTML}function K$(){this.nextSibling&&this.parentNode.appendChild(this)}function Zk(){return this.each(K$)}function J$(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Qk(){return this.each(J$)}function Kk(t){var e=typeof t=="function"?t:s8(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function eH(){return null}function Jk(t,e){var i=typeof t=="function"?t:s8(t),r=e==null?eH:typeof e=="function"?e:sd(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),r.apply(this,arguments)||null)})}function tH(){var t=this.parentNode;t&&t.removeChild(this)}function eM(){return this.each(tH)}function iH(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function rH(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function tM(t){return this.select(t?rH:iH)}function iM(t){return arguments.length?this.property("__data__",t):this.node().__data__}function sH(t){return function(e){t.call(this,e,this.__data__)}}function nH(t){return t.trim().split(/^|\s+/).map(function(e){var i="",r=e.indexOf(".");return r>=0&&(i=e.slice(r+1),e=e.slice(0,r)),{type:e,name:i}})}function oH(t){return function(){var e=this.__on;if(e){for(var i=0,r=-1,s=e.length,n;i<s;++i)n=e[i],(!t.type||n.type===t.type)&&n.name===t.name?this.removeEventListener(n.type,n.listener,n.options):e[++r]=n;++r?e.length=r:delete this.__on}}}function aH(t,e,i){return function(){var r=this.__on,s,n=sH(e);if(r){for(var o=0,a=r.length;o<a;++o)if((s=r[o]).type===t.type&&s.name===t.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=n,s.options=i),s.value=e;return}}this.addEventListener(t.type,n,i),s={type:t.type,name:t.name,value:e,listener:n,options:i},r?r.push(s):this.__on=[s]}}function rM(t,e,i){var r=nH(t+""),s,n=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,d;l<c;++l)for(s=0,d=a[l];s<n;++s)if((o=r[s]).type===d.type&&o.name===d.name)return d.value}return}for(a=e?aH:oH,s=0;s<n;++s)this.each(a(r[s],e,i));return this}function sM(t,e,i){var r=a8(t),s=r.CustomEvent;typeof s=="function"?s=new s(e,i):(s=r.document.createEvent("Event"),i?(s.initEvent(e,i.bubbles,i.cancelable),s.detail=i.detail):s.initEvent(e,!1,!1)),t.dispatchEvent(s)}function lH(t,e){return function(){return sM(this,t,e)}}function cH(t,e){return function(){return sM(this,t,e.apply(this,arguments))}}function nM(t,e){return this.each((typeof e=="function"?cH:lH)(t,e))}function*oM(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],s=0,n=r.length,o;s<n;++s)(o=r[s])&&(yield o)}var k3=[null];function ws(t,e){this._groups=t,this._parents=e}function aM(){return new ws([[document.documentElement]],k3)}function uH(){return this}ws.prototype=aM.prototype={constructor:ws,select:bk,selectAll:wk,selectChild:Ek,selectChildren:Tk,filter:Sk,data:Ik,enter:Ak,exit:kk,join:Mk,merge:Pk,selection:uH,order:Rk,sort:Dk,call:Fk,nodes:Lk,node:Nk,size:Ok,empty:Bk,each:Uk,attr:zk,style:Gk,property:$k,classed:Wk,text:qk,html:Yk,raise:Zk,lower:Qk,append:Kk,insert:Jk,remove:eM,clone:tM,datum:iM,on:rM,dispatch:nM,[Symbol.iterator]:oM};var ku=aM;function ye(t){return typeof t=="string"?new ws([[document.querySelector(t)]],[document.documentElement]):new ws([[t]],k3)}function lM(t){let e;for(;e=t.sourceEvent;)t=e;return t}function gl(t,e){if(t=lM(t),e===void 0&&(e=t.currentTarget),e){var i=e.ownerSVGElement||e;if(i.createSVGPoint){var r=i.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}}return[t.pageX,t.pageY]}function Zb(t){return typeof t=="string"?new ws([document.querySelectorAll(t)],[document.documentElement]):new ws([S3(t)],k3)}var cM={passive:!1},nd={capture:!0,passive:!1};function l8(t){t.stopImmediatePropagation()}function G1(t){t.preventDefault(),t.stopImmediatePropagation()}function M3(t){var e=t.document.documentElement,i=ye(t).on("dragstart.drag",G1,nd);"onselectstart"in e?i.on("selectstart.drag",G1,nd):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function P3(t,e){var i=t.document.documentElement,r=ye(t).on("dragstart.drag",null);e&&(r.on("click.drag",G1,nd),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in i?r.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}var R3=t=>()=>t;function D3(t,{sourceEvent:e,subject:i,target:r,identifier:s,active:n,x:o,y:a,dx:l,dy:c,dispatch:d}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:i,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:n,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:d}})}D3.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function hH(t){return!t.ctrlKey&&!t.button}function dH(){return this.parentNode}function fH(t,e){return e==null?{x:t.x,y:t.y}:e}function pH(){return navigator.maxTouchPoints||"ontouchstart"in this}function F3(){var t=hH,e=dH,i=fH,r=pH,s={},n=Pt("start","drag","end"),o=0,a,l,c,d,m=0;function g(k){k.on("mousedown.drag",_).filter(r).on("touchstart.drag",b).on("touchmove.drag",T,cM).on("touchend.drag touchcancel.drag",A).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function _(k,F){if(!(d||!t.call(this,k,F))){var O=M(this,e.call(this,k,F),k,F,"mouse");O&&(ye(k.view).on("mousemove.drag",v,nd).on("mouseup.drag",E,nd),M3(k.view),l8(k),c=!1,a=k.clientX,l=k.clientY,O("start",k))}}function v(k){if(G1(k),!c){var F=k.clientX-a,O=k.clientY-l;c=F*F+O*O>m}s.mouse("drag",k)}function E(k){ye(k.view).on("mousemove.drag mouseup.drag",null),P3(k.view,c),G1(k),s.mouse("end",k)}function b(k,F){if(t.call(this,k,F)){var O=k.changedTouches,B=e.call(this,k,F),U=O.length,z,Z;for(z=0;z<U;++z)(Z=M(this,B,k,F,O[z].identifier,O[z]))&&(l8(k),Z("start",k,O[z]))}}function T(k){var F=k.changedTouches,O=F.length,B,U;for(B=0;B<O;++B)(U=s[F[B].identifier])&&(G1(k),U("drag",k,F[B]))}function A(k){var F=k.changedTouches,O=F.length,B,U;for(d&&clearTimeout(d),d=setTimeout(function(){d=null},500),B=0;B<O;++B)(U=s[F[B].identifier])&&(l8(k),U("end",k,F[B]))}function M(k,F,O,B,U,z){var Z=n.copy(),W=gl(z||O,F),q,Q,V;if((V=i.call(k,new D3("beforestart",{sourceEvent:O,target:g,identifier:U,active:o,x:W[0],y:W[1],dx:0,dy:0,dispatch:Z}),B))!=null)return q=V.x-W[0]||0,Q=V.y-W[1]||0,function le(de,ne,ee){var re=W,te;switch(de){case"start":s[U]=le,te=o++;break;case"end":delete s[U],--o;case"drag":W=gl(ee||ne,F),te=o;break}Z.call(de,k,new D3(de,{sourceEvent:ne,subject:V,target:g,identifier:U,active:te,x:W[0]+q,y:W[1]+Q,dx:W[0]-re[0],dy:W[1]-re[1],dispatch:Z}),B)}}return g.filter=function(k){return arguments.length?(t=typeof k=="function"?k:R3(!!k),g):t},g.container=function(k){return arguments.length?(e=typeof k=="function"?k:R3(k),g):e},g.subject=function(k){return arguments.length?(i=typeof k=="function"?k:R3(k),g):i},g.touchable=function(k){return arguments.length?(r=typeof k=="function"?k:R3(!!k),g):r},g.on=function(){var k=n.on.apply(n,arguments);return k===n?g:k},g.clickDistance=function(k){return arguments.length?(m=(k=+k)*k,g):Math.sqrt(m)},g}function c8(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function Qb(t,e){var i=Object.create(t.prototype);for(var r in e)i[r]=e[r];return i}function O3(){}var L3=.7,d8=1/L3,Cf="\\s*([+-]?\\d+)\\s*",N3="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Pc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",mH=/^#([0-9a-f]{3,8})$/,gH=new RegExp(`^rgb\\(${Cf},${Cf},${Cf}\\)$`),yH=new RegExp(`^rgb\\(${Pc},${Pc},${Pc}\\)$`),_H=new RegExp(`^rgba\\(${Cf},${Cf},${Cf},${N3}\\)$`),xH=new RegExp(`^rgba\\(${Pc},${Pc},${Pc},${N3}\\)$`),vH=new RegExp(`^hsl\\(${N3},${Pc},${Pc}\\)$`),bH=new RegExp(`^hsla\\(${N3},${Pc},${Pc},${N3}\\)$`),uM={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};c8(O3,Jl,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:hM,formatHex:hM,formatHex8:wH,formatHsl:EH,formatRgb:dM,toString:dM});function hM(){return this.rgb().formatHex()}function wH(){return this.rgb().formatHex8()}function EH(){return _M(this).formatHsl()}function dM(){return this.rgb().formatRgb()}function Jl(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=mH.exec(t))?(i=e[1].length,e=parseInt(e[1],16),i===6?fM(e):i===3?new ga(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?u8(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?u8(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=gH.exec(t))?new ga(e[1],e[2],e[3],1):(e=yH.exec(t))?new ga(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=_H.exec(t))?u8(e[1],e[2],e[3],e[4]):(e=xH.exec(t))?u8(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=vH.exec(t))?gM(e[1],e[2]/100,e[3]/100,1):(e=bH.exec(t))?gM(e[1],e[2]/100,e[3]/100,e[4]):uM.hasOwnProperty(t)?fM(uM[t]):t==="transparent"?new ga(NaN,NaN,NaN,0):null}function fM(t){return new ga(t>>16&255,t>>8&255,t&255,1)}function u8(t,e,i,r){return r<=0&&(t=e=i=NaN),new ga(t,e,i,r)}function TH(t){return t instanceof O3||(t=Jl(t)),t?(t=t.rgb(),new ga(t.r,t.g,t.b,t.opacity)):new ga}function If(t,e,i,r){return arguments.length===1?TH(t):new ga(t,e,i,r==null?1:r)}function ga(t,e,i,r){this.r=+t,this.g=+e,this.b=+i,this.opacity=+r}c8(ga,If,Qb(O3,{brighter(t){return t=t==null?d8:Math.pow(d8,t),new ga(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?L3:Math.pow(L3,t),new ga(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new ga(ad(this.r),ad(this.g),ad(this.b),f8(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:pM,formatHex:pM,formatHex8:SH,formatRgb:mM,toString:mM}));function pM(){return`#${od(this.r)}${od(this.g)}${od(this.b)}`}function SH(){return`#${od(this.r)}${od(this.g)}${od(this.b)}${od((isNaN(this.opacity)?1:this.opacity)*255)}`}function mM(){let t=f8(this.opacity);return`${t===1?"rgb(":"rgba("}${ad(this.r)}, ${ad(this.g)}, ${ad(this.b)}${t===1?")":`, ${t})`}`}function f8(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function ad(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function od(t){return t=ad(t),(t<16?"0":"")+t.toString(16)}function gM(t,e,i,r){return r<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new Kl(t,e,i,r)}function _M(t){if(t instanceof Kl)return new Kl(t.h,t.s,t.l,t.opacity);if(t instanceof O3||(t=Jl(t)),!t)return new Kl;if(t instanceof Kl)return t;t=t.rgb();var e=t.r/255,i=t.g/255,r=t.b/255,s=Math.min(e,i,r),n=Math.max(e,i,r),o=NaN,a=n-s,l=(n+s)/2;return a?(e===n?o=(i-r)/a+(i<r)*6:i===n?o=(r-e)/a+2:o=(e-i)/a+4,a/=l<.5?n+s:2-n-s,o*=60):a=l>0&&l<1?0:o,new Kl(o,a,l,t.opacity)}function xM(t,e,i,r){return arguments.length===1?_M(t):new Kl(t,e,i,r==null?1:r)}function Kl(t,e,i,r){this.h=+t,this.s=+e,this.l=+i,this.opacity=+r}c8(Kl,xM,Qb(O3,{brighter(t){return t=t==null?d8:Math.pow(d8,t),new Kl(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?L3:Math.pow(L3,t),new Kl(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,r=i+(i<.5?i:1-i)*e,s=2*i-r;return new ga(Kb(t>=240?t-240:t+120,s,r),Kb(t,s,r),Kb(t<120?t+240:t-120,s,r),this.opacity)},clamp(){return new Kl(yM(this.h),h8(this.s),h8(this.l),f8(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let t=f8(this.opacity);return`${t===1?"hsl(":"hsla("}${yM(this.h)}, ${h8(this.s)*100}%, ${h8(this.l)*100}%${t===1?")":`, ${t})`}`}}));function yM(t){return t=(t||0)%360,t<0?t+360:t}function h8(t){return Math.max(0,Math.min(1,t||0))}function Kb(t,e,i){return(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)*255}function Jb(t,e,i,r,s){var n=t*t,o=n*t;return((1-3*t+3*n-o)*e+(4-6*n+3*o)*i+(1+3*t+3*n-3*o)*r+o*s)/6}function vM(t){var e=t.length-1;return function(i){var r=i<=0?i=0:i>=1?(i=1,e-1):Math.floor(i*e),s=t[r],n=t[r+1],o=r>0?t[r-1]:2*s-n,a=r<e-1?t[r+2]:2*n-s;return Jb((i-r/e)*e,o,s,n,a)}}function bM(t){var e=t.length;return function(i){var r=Math.floor(((i%=1)<0?++i:i)*e),s=t[(r+e-1)%e],n=t[r%e],o=t[(r+1)%e],a=t[(r+2)%e];return Jb((i-r/e)*e,s,n,o,a)}}var B3=t=>()=>t;function AH(t,e){return function(i){return t+i*e}}function CH(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(r){return Math.pow(t+r*e,i)}}function wM(t){return(t=+t)==1?p8:function(e,i){return i-e?CH(e,i,t):B3(isNaN(e)?i:e)}}function p8(t,e){var i=e-t;return i?AH(t,i):B3(isNaN(t)?e:t)}var Rc=function t(e){var i=wM(e);function r(s,n){var o=i((s=If(s)).r,(n=If(n)).r),a=i(s.g,n.g),l=i(s.b,n.b),c=p8(s.opacity,n.opacity);return function(d){return s.r=o(d),s.g=a(d),s.b=l(d),s.opacity=c(d),s+""}}return r.gamma=t,r}(1);function EM(t){return function(e){var i=e.length,r=new Array(i),s=new Array(i),n=new Array(i),o,a;for(o=0;o<i;++o)a=If(e[o]),r[o]=a.r||0,s[o]=a.g||0,n[o]=a.b||0;return r=t(r),s=t(s),n=t(n),a.opacity=1,function(l){return a.r=r(l),a.g=s(l),a.b=n(l),a+""}}}var IH=EM(vM),kH=EM(bM);function TM(t,e){e||(e=[]);var i=t?Math.min(e.length,t.length):0,r=e.slice(),s;return function(n){for(s=0;s<i;++s)r[s]=t[s]*(1-n)+e[s]*n;return r}}function SM(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function AM(t,e){var i=e?e.length:0,r=t?Math.min(i,t.length):0,s=new Array(r),n=new Array(i),o;for(o=0;o<r;++o)s[o]=$1(t[o],e[o]);for(;o<i;++o)n[o]=e[o];return function(a){for(o=0;o<r;++o)n[o]=s[o](a);return n}}function CM(t,e){var i=new Date;return t=+t,e=+e,function(r){return i.setTime(t*(1-r)+e*r),i}}function en(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}function IM(t,e){var i={},r={},s;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in t?i[s]=$1(t[s],e[s]):r[s]=e[s];return function(n){for(s in i)r[s]=i[s](n);return r}}var tw=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ew=new RegExp(tw.source,"g");function MH(t){return function(){return t}}function PH(t){return function(e){return t(e)+""}}function U3(t,e){var i=tw.lastIndex=ew.lastIndex=0,r,s,n,o=-1,a=[],l=[];for(t=t+"",e=e+"";(r=tw.exec(t))&&(s=ew.exec(e));)(n=s.index)>i&&(n=e.slice(i,n),a[o]?a[o]+=n:a[++o]=n),(r=r[0])===(s=s[0])?a[o]?a[o]+=s:a[++o]=s:(a[++o]=null,l.push({i:o,x:en(r,s)})),i=ew.lastIndex;return i<e.length&&(n=e.slice(i),a[o]?a[o]+=n:a[++o]=n),a.length<2?l[0]?PH(l[0].x):MH(e):(e=l.length,function(c){for(var d=0,m;d<e;++d)a[(m=l[d]).i]=m.x(c);return a.join("")})}function $1(t,e){var i=typeof e,r;return e==null||i==="boolean"?B3(e):(i==="number"?en:i==="string"?(r=Jl(e))?(e=r,Rc):U3:e instanceof Jl?Rc:e instanceof Date?CM:SM(e)?TM:Array.isArray(e)?AM:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?IM:en)(t,e)}var kM=180/Math.PI,m8={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function iw(t,e,i,r,s,n){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*i+e*r)&&(i-=t*l,r-=e*l),(a=Math.sqrt(i*i+r*r))&&(i/=a,r/=a,l/=a),t*r<e*i&&(t=-t,e=-e,l=-l,o=-o),{translateX:s,translateY:n,rotate:Math.atan2(e,t)*kM,skewX:Math.atan(l)*kM,scaleX:o,scaleY:a}}var g8;function MM(t){let e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?m8:iw(e.a,e.b,e.c,e.d,e.e,e.f)}function PM(t){return t==null?m8:(g8||(g8=document.createElementNS("http://www.w3.org/2000/svg","g")),g8.setAttribute("transform",t),(t=g8.transform.baseVal.consolidate())?(t=t.matrix,iw(t.a,t.b,t.c,t.d,t.e,t.f)):m8)}function RM(t,e,i,r){function s(c){return c.length?c.pop()+" ":""}function n(c,d,m,g,_,v){if(c!==m||d!==g){var E=_.push("translate(",null,e,null,i);v.push({i:E-4,x:en(c,m)},{i:E-2,x:en(d,g)})}else(m||g)&&_.push("translate("+m+e+g+i)}function o(c,d,m,g){c!==d?(c-d>180?d+=360:d-c>180&&(c+=360),g.push({i:m.push(s(m)+"rotate(",null,r)-2,x:en(c,d)})):d&&m.push(s(m)+"rotate("+d+r)}function a(c,d,m,g){c!==d?g.push({i:m.push(s(m)+"skewX(",null,r)-2,x:en(c,d)}):d&&m.push(s(m)+"skewX("+d+r)}function l(c,d,m,g,_,v){if(c!==m||d!==g){var E=_.push(s(_)+"scale(",null,",",null,")");v.push({i:E-4,x:en(c,m)},{i:E-2,x:en(d,g)})}else(m!==1||g!==1)&&_.push(s(_)+"scale("+m+","+g+")")}return function(c,d){var m=[],g=[];return c=t(c),d=t(d),n(c.translateX,c.translateY,d.translateX,d.translateY,m,g),o(c.rotate,d.rotate,m,g),a(c.skewX,d.skewX,m,g),l(c.scaleX,c.scaleY,d.scaleX,d.scaleY,m,g),c=d=null,function(_){for(var v=-1,E=g.length,b;++v<E;)m[(b=g[v]).i]=b.x(_);return m.join("")}}}var rw=RM(MM,"px, ","px)","deg)"),sw=RM(PM,", ",")",")");var RH=1e-12;function DM(t){return((t=Math.exp(t))+1/t)/2}function DH(t){return((t=Math.exp(t))-1/t)/2}function FH(t){return((t=Math.exp(2*t))-1)/(t+1)}var nw=function t(e,i,r){function s(n,o){var a=n[0],l=n[1],c=n[2],d=o[0],m=o[1],g=o[2],_=d-a,v=m-l,E=_*_+v*v,b,T;if(E<RH)T=Math.log(g/c)/e,b=function(B){return[a+B*_,l+B*v,c*Math.exp(e*B*T)]};else{var A=Math.sqrt(E),M=(g*g-c*c+r*E)/(2*c*i*A),k=(g*g-c*c-r*E)/(2*g*i*A),F=Math.log(Math.sqrt(M*M+1)-M),O=Math.log(Math.sqrt(k*k+1)-k);T=(O-F)/e,b=function(B){var U=B*T,z=DM(F),Z=c/(i*A)*(z*FH(e*U+F)-DH(F));return[a+Z*_,l+Z*v,c*z/DM(e*U+F)]}}return b.duration=T*1e3*e/Math.SQRT2,b}return s.rho=function(n){var o=Math.max(.001,+n),a=o*o,l=a*a;return t(o,a,l)},s}(Math.SQRT2,2,4);var kf=0,G3=0,z3=0,LM=1e3,y8,$3,_8=0,ld=0,x8=0,H3=typeof performance=="object"&&performance.now?performance:Date,NM=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function j3(){return ld||(NM(LH),ld=H3.now()+x8)}function LH(){ld=0}function V3(){this._call=this._time=this._next=null}V3.prototype=Mf.prototype={constructor:V3,restart:function(t,e,i){if(typeof t!="function")throw new TypeError("callback is not a function");i=(i==null?j3():+i)+(e==null?0:+e),!this._next&&$3!==this&&($3?$3._next=this:y8=this,$3=this),this._call=t,this._time=i,ow()},stop:function(){this._call&&(this._call=null,this._time=1/0,ow())}};function Mf(t,e,i){var r=new V3;return r.restart(t,e,i),r}function v8(){j3(),++kf;for(var t=y8,e;t;)(e=ld-t._time)>=0&&t._call.call(void 0,e),t=t._next;--kf}function FM(){ld=(_8=H3.now())+x8,kf=G3=0;try{v8()}finally{kf=0,OH(),ld=0}}function NH(){var t=H3.now(),e=t-_8;e>LM&&(x8-=e,_8=t)}function OH(){for(var t,e=y8,i,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(i=e._next,e._next=null,e=t?t._next=i:y8=i);$3=t,ow(r)}function ow(t){if(!kf){G3&&(G3=clearTimeout(G3));var e=t-ld;e>24?(t<1/0&&(G3=setTimeout(FM,t-H3.now()-x8)),z3&&(z3=clearInterval(z3))):(z3||(_8=H3.now(),z3=setInterval(NH,LM)),kf=1,NM(FM))}}function Pf(t,e,i){var r=new V3;return e=e==null?0:+e,r.restart(s=>{r.stop(),t(s+e)},e,i),r}var BH=Pt("start","end","cancel","interrupt"),UH=[],UM=0,OM=1,w8=2,b8=3,BM=4,E8=5,X3=6;function H1(t,e,i,r,s,n){var o=t.__transition;if(!o)t.__transition={};else if(i in o)return;zH(t,i,{name:e,index:r,group:s,on:BH,tween:UH,time:n.time,delay:n.delay,duration:n.duration,ease:n.ease,timer:null,state:UM})}function W3(t,e){var i=Rn(t,e);if(i.state>UM)throw new Error("too late; already scheduled");return i}function to(t,e){var i=Rn(t,e);if(i.state>b8)throw new Error("too late; already running");return i}function Rn(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function zH(t,e,i){var r=t.__transition,s;r[e]=i,i.timer=Mf(n,0,i.time);function n(c){i.state=OM,i.timer.restart(o,i.delay,i.time),i.delay<=c&&o(c-i.delay)}function o(c){var d,m,g,_;if(i.state!==OM)return l();for(d in r)if(_=r[d],_.name===i.name){if(_.state===b8)return Pf(o);_.state===BM?(_.state=X3,_.timer.stop(),_.on.call("interrupt",t,t.__data__,_.index,_.group),delete r[d]):+d<e&&(_.state=X3,_.timer.stop(),_.on.call("cancel",t,t.__data__,_.index,_.group),delete r[d])}if(Pf(function(){i.state===b8&&(i.state=BM,i.timer.restart(a,i.delay,i.time),a(c))}),i.state=w8,i.on.call("start",t,t.__data__,i.index,i.group),i.state===w8){for(i.state=b8,s=new Array(g=i.tween.length),d=0,m=-1;d<g;++d)(_=i.tween[d].value.call(t,t.__data__,i.index,i.group))&&(s[++m]=_);s.length=m+1}}function a(c){for(var d=c<i.duration?i.ease.call(null,c/i.duration):(i.timer.restart(l),i.state=E8,1),m=-1,g=s.length;++m<g;)s[m].call(t,d);i.state===E8&&(i.on.call("end",t,t.__data__,i.index,i.group),l())}function l(){i.state=X3,i.timer.stop(),delete r[e];for(var c in r)return;delete t.__transition}}function V1(t,e){var i=t.__transition,r,s,n=!0,o;if(i){e=e==null?null:e+"";for(o in i){if((r=i[o]).name!==e){n=!1;continue}s=r.state>w8&&r.state<E8,r.state=X3,r.timer.stop(),r.on.call(s?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete i[o]}n&&delete t.__transition}}function zM(t){return this.each(function(){V1(this,t)})}function GH(t,e){var i,r;return function(){var s=to(this,t),n=s.tween;if(n!==i){r=i=n;for(var o=0,a=r.length;o<a;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}s.tween=r}}function $H(t,e,i){var r,s;if(typeof i!="function")throw new Error;return function(){var n=to(this,t),o=n.tween;if(o!==r){s=(r=o).slice();for(var a={name:e,value:i},l=0,c=s.length;l<c;++l)if(s[l].name===e){s[l]=a;break}l===c&&s.push(a)}n.tween=s}}function GM(t,e){var i=this._id;if(t+="",arguments.length<2){for(var r=Rn(this.node(),i).tween,s=0,n=r.length,o;s<n;++s)if((o=r[s]).name===t)return o.value;return null}return this.each((e==null?GH:$H)(i,t,e))}function Rf(t,e,i){var r=t._id;return t.each(function(){var s=to(this,r);(s.value||(s.value={}))[e]=i.apply(this,arguments)}),function(s){return Rn(s,r).value[e]}}function T8(t,e){var i;return(typeof e=="number"?en:e instanceof Jl?Rc:(i=Jl(e))?(e=i,Rc):U3)(t,e)}function HH(t){return function(){this.removeAttribute(t)}}function VH(t){return function(){this.removeAttributeNS(t.space,t.local)}}function jH(t,e,i){var r,s=i+"",n;return function(){var o=this.getAttribute(t);return o===s?null:o===r?n:n=e(r=o,i)}}function XH(t,e,i){var r,s=i+"",n;return function(){var o=this.getAttributeNS(t.space,t.local);return o===s?null:o===r?n:n=e(r=o,i)}}function WH(t,e,i){var r,s,n;return function(){var o,a=i(this),l;return a==null?void this.removeAttribute(t):(o=this.getAttribute(t),l=a+"",o===l?null:o===r&&l===s?n:(s=l,n=e(r=o,a)))}}function qH(t,e,i){var r,s,n;return function(){var o,a=i(this),l;return a==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),l=a+"",o===l?null:o===r&&l===s?n:(s=l,n=e(r=o,a)))}}function $M(t,e){var i=Iu(t),r=i==="transform"?sw:T8;return this.attrTween(t,typeof e=="function"?(i.local?qH:WH)(i,r,Rf(this,"attr."+t,e)):e==null?(i.local?VH:HH)(i):(i.local?XH:jH)(i,r,e))}function YH(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}function ZH(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}function QH(t,e){var i,r;function s(){var n=e.apply(this,arguments);return n!==r&&(i=(r=n)&&ZH(t,n)),i}return s._value=e,s}function KH(t,e){var i,r;function s(){var n=e.apply(this,arguments);return n!==r&&(i=(r=n)&&YH(t,n)),i}return s._value=e,s}function HM(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;var r=Iu(t);return this.tween(i,(r.local?QH:KH)(r,e))}function JH(t,e){return function(){W3(this,t).delay=+e.apply(this,arguments)}}function eV(t,e){return e=+e,function(){W3(this,t).delay=e}}function VM(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?JH:eV)(e,t)):Rn(this.node(),e).delay}function tV(t,e){return function(){to(this,t).duration=+e.apply(this,arguments)}}function iV(t,e){return e=+e,function(){to(this,t).duration=e}}function jM(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?tV:iV)(e,t)):Rn(this.node(),e).duration}function rV(t,e){if(typeof e!="function")throw new Error;return function(){to(this,t).ease=e}}function XM(t){var e=this._id;return arguments.length?this.each(rV(e,t)):Rn(this.node(),e).ease}function sV(t,e){return function(){var i=e.apply(this,arguments);if(typeof i!="function")throw new Error;to(this,t).ease=i}}function WM(t){if(typeof t!="function")throw new Error;return this.each(sV(this._id,t))}function qM(t){typeof t!="function"&&(t=C3(t));for(var e=this._groups,i=e.length,r=new Array(i),s=0;s<i;++s)for(var n=e[s],o=n.length,a=r[s]=[],l,c=0;c<o;++c)(l=n[c])&&t.call(l,l.__data__,c,n)&&a.push(l);return new Go(r,this._parents,this._name,this._id)}function YM(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,r=e.length,s=i.length,n=Math.min(r,s),o=new Array(r),a=0;a<n;++a)for(var l=e[a],c=i[a],d=l.length,m=o[a]=new Array(d),g,_=0;_<d;++_)(g=l[_]||c[_])&&(m[_]=g);for(;a<r;++a)o[a]=e[a];return new Go(o,this._parents,this._name,this._id)}function nV(t){return(t+"").trim().split(/^|\s+/).every(function(e){var i=e.indexOf(".");return i>=0&&(e=e.slice(0,i)),!e||e==="start"})}function oV(t,e,i){var r,s,n=nV(e)?W3:to;return function(){var o=n(this,t),a=o.on;a!==r&&(s=(r=a).copy()).on(e,i),o.on=s}}function ZM(t,e){var i=this._id;return arguments.length<2?Rn(this.node(),i).on.on(t):this.each(oV(i,t,e))}function aV(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}function QM(){return this.on("end.remove",aV(this._id))}function KM(t){var e=this._name,i=this._id;typeof t!="function"&&(t=sd(t));for(var r=this._groups,s=r.length,n=new Array(s),o=0;o<s;++o)for(var a=r[o],l=a.length,c=n[o]=new Array(l),d,m,g=0;g<l;++g)(d=a[g])&&(m=t.call(d,d.__data__,g,a))&&("__data__"in d&&(m.__data__=d.__data__),c[g]=m,H1(c[g],e,i,g,c,Rn(d,i)));return new Go(n,this._parents,e,i)}function JM(t){var e=this._name,i=this._id;typeof t!="function"&&(t=A3(t));for(var r=this._groups,s=r.length,n=[],o=[],a=0;a<s;++a)for(var l=r[a],c=l.length,d,m=0;m<c;++m)if(d=l[m]){for(var g=t.call(d,d.__data__,m,l),_,v=Rn(d,i),E=0,b=g.length;E<b;++E)(_=g[E])&&H1(_,e,i,E,g,v);n.push(g),o.push(d)}return new Go(n,o,e,i)}var lV=ku.prototype.constructor;function eP(){return new lV(this._groups,this._parents)}function cV(t,e){var i,r,s;return function(){var n=z1(this,t),o=(this.style.removeProperty(t),z1(this,t));return n===o?null:n===i&&o===r?s:s=e(i=n,r=o)}}function tP(t){return function(){this.style.removeProperty(t)}}function uV(t,e,i){var r,s=i+"",n;return function(){var o=z1(this,t);return o===s?null:o===r?n:n=e(r=o,i)}}function hV(t,e,i){var r,s,n;return function(){var o=z1(this,t),a=i(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(t),z1(this,t))),o===l?null:o===r&&l===s?n:(s=l,n=e(r=o,a))}}function dV(t,e){var i,r,s,n="style."+e,o="end."+n,a;return function(){var l=to(this,t),c=l.on,d=l.value[n]==null?a||(a=tP(e)):void 0;(c!==i||s!==d)&&(r=(i=c).copy()).on(o,s=d),l.on=r}}function iP(t,e,i){var r=(t+="")=="transform"?rw:T8;return e==null?this.styleTween(t,cV(t,r)).on("end.style."+t,tP(t)):typeof e=="function"?this.styleTween(t,hV(t,r,Rf(this,"style."+t,e))).each(dV(this._id,t)):this.styleTween(t,uV(t,r,e),i).on("end.style."+t,null)}function fV(t,e,i){return function(r){this.style.setProperty(t,e.call(this,r),i)}}function pV(t,e,i){var r,s;function n(){var o=e.apply(this,arguments);return o!==s&&(r=(s=o)&&fV(t,o,i)),r}return n._value=e,n}function rP(t,e,i){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,pV(t,e,i==null?"":i))}function mV(t){return function(){this.textContent=t}}function gV(t){return function(){var e=t(this);this.textContent=e==null?"":e}}function sP(t){return this.tween("text",typeof t=="function"?gV(Rf(this,"text",t)):mV(t==null?"":t+""))}function yV(t){return function(e){this.textContent=t.call(this,e)}}function _V(t){var e,i;function r(){var s=t.apply(this,arguments);return s!==i&&(e=(i=s)&&yV(s)),e}return r._value=t,r}function nP(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,_V(t))}function oP(){for(var t=this._name,e=this._id,i=S8(),r=this._groups,s=r.length,n=0;n<s;++n)for(var o=r[n],a=o.length,l,c=0;c<a;++c)if(l=o[c]){var d=Rn(l,e);H1(l,t,i,c,o,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new Go(r,this._parents,t,i)}function aP(){var t,e,i=this,r=i._id,s=i.size();return new Promise(function(n,o){var a={value:o},l={value:function(){--s===0&&n()}};i.each(function(){var c=to(this,r),d=c.on;d!==t&&(e=(t=d).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),c.on=e}),s===0&&n()})}var xV=0;function Go(t,e,i,r){this._groups=t,this._parents=e,this._name=i,this._id=r}function lP(t){return ku().transition(t)}function S8(){return++xV}var Mu=ku.prototype;Go.prototype=lP.prototype={constructor:Go,select:KM,selectAll:JM,selectChild:Mu.selectChild,selectChildren:Mu.selectChildren,filter:qM,merge:YM,selection:eP,transition:oP,call:Mu.call,nodes:Mu.nodes,node:Mu.node,size:Mu.size,empty:Mu.empty,each:Mu.each,on:ZM,attr:$M,attrTween:HM,style:iP,styleTween:rP,text:sP,textTween:nP,remove:QM,tween:GM,delay:VM,duration:jM,ease:XM,easeVarying:WM,end:aP,[Symbol.iterator]:Mu[Symbol.iterator]};var q3=t=>+t;function cd(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var vV={time:null,delay:0,duration:250,ease:cd};function bV(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return i}function cP(t){var e,i;t instanceof Go?(e=t._id,t=t._name):(e=S8(),(i=vV).time=j3(),t=t==null?null:t+"");for(var r=this._groups,s=r.length,n=0;n<s;++n)for(var o=r[n],a=o.length,l,c=0;c<a;++c)(l=o[c])&&H1(l,t,e,c,o,i||bV(l,e));return new Go(r,this._parents,t,e)}ku.prototype.interrupt=zM;ku.prototype.transition=cP;var Y3=t=>()=>t;function aw(t,{sourceEvent:e,target:i,transform:r,dispatch:s}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:s}})}function ec(t,e,i){this.k=t,this.x=e,this.y=i}ec.prototype={constructor:ec,scale:function(t){return t===1?this:new ec(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new ec(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var yl=new ec(1,0,0);lw.prototype=ec.prototype;function lw(t){for(;!t.__zoom;)if(!(t=t.parentNode))return yl;return t.__zoom}function A8(t){t.stopImmediatePropagation()}function Df(t){t.preventDefault(),t.stopImmediatePropagation()}function wV(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function EV(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function uP(){return this.__zoom||yl}function TV(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function SV(){return navigator.maxTouchPoints||"ontouchstart"in this}function AV(t,e,i){var r=t.invertX(e[0][0])-i[0][0],s=t.invertX(e[1][0])-i[1][0],n=t.invertY(e[0][1])-i[0][1],o=t.invertY(e[1][1])-i[1][1];return t.translate(s>r?(r+s)/2:Math.min(0,r)||Math.max(0,s),o>n?(n+o)/2:Math.min(0,n)||Math.max(0,o))}function Ff(){var t=wV,e=EV,i=AV,r=TV,s=SV,n=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,l=nw,c=Pt("start","zoom","end"),d,m,g,_=500,v=150,E=0,b=10;function T(V){V.property("__zoom",uP).on("wheel.zoom",U,{passive:!1}).on("mousedown.zoom",z).on("dblclick.zoom",Z).filter(s).on("touchstart.zoom",W).on("touchmove.zoom",q).on("touchend.zoom touchcancel.zoom",Q).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}T.transform=function(V,le,de,ne){var ee=V.selection?V.selection():V;ee.property("__zoom",uP),V!==ee?F(V,le,de,ne):ee.interrupt().each(function(){O(this,arguments).event(ne).start().zoom(null,typeof le=="function"?le.apply(this,arguments):le).end()})},T.scaleBy=function(V,le,de,ne){T.scaleTo(V,function(){var ee=this.__zoom.k,re=typeof le=="function"?le.apply(this,arguments):le;return ee*re},de,ne)},T.scaleTo=function(V,le,de,ne){T.transform(V,function(){var ee=e.apply(this,arguments),re=this.__zoom,te=de==null?k(ee):typeof de=="function"?de.apply(this,arguments):de,ie=re.invert(te),oe=typeof le=="function"?le.apply(this,arguments):le;return i(M(A(re,oe),te,ie),ee,o)},de,ne)},T.translateBy=function(V,le,de,ne){T.transform(V,function(){return i(this.__zoom.translate(typeof le=="function"?le.apply(this,arguments):le,typeof de=="function"?de.apply(this,arguments):de),e.apply(this,arguments),o)},null,ne)},T.translateTo=function(V,le,de,ne,ee){T.transform(V,function(){var re=e.apply(this,arguments),te=this.__zoom,ie=ne==null?k(re):typeof ne=="function"?ne.apply(this,arguments):ne;return i(yl.translate(ie[0],ie[1]).scale(te.k).translate(typeof le=="function"?-le.apply(this,arguments):-le,typeof de=="function"?-de.apply(this,arguments):-de),re,o)},ne,ee)};function A(V,le){return le=Math.max(n[0],Math.min(n[1],le)),le===V.k?V:new ec(le,V.x,V.y)}function M(V,le,de){var ne=le[0]-de[0]*V.k,ee=le[1]-de[1]*V.k;return ne===V.x&&ee===V.y?V:new ec(V.k,ne,ee)}function k(V){return[(+V[0][0]+ +V[1][0])/2,(+V[0][1]+ +V[1][1])/2]}function F(V,le,de,ne){V.on("start.zoom",function(){O(this,arguments).event(ne).start()}).on("interrupt.zoom end.zoom",function(){O(this,arguments).event(ne).end()}).tween("zoom",function(){var ee=this,re=arguments,te=O(ee,re).event(ne),ie=e.apply(ee,re),oe=de==null?k(ie):typeof de=="function"?de.apply(ee,re):de,fe=Math.max(ie[1][0]-ie[0][0],ie[1][1]-ie[0][1]),Re=ee.__zoom,He=typeof le=="function"?le.apply(ee,re):le,Je=l(Re.invert(oe).concat(fe/Re.k),He.invert(oe).concat(fe/He.k));return function(ot){if(ot===1)ot=He;else{var yt=Je(ot),bt=fe/yt[2];ot=new ec(bt,oe[0]-yt[0]*bt,oe[1]-yt[1]*bt)}te.zoom(null,ot)}})}function O(V,le,de){return!de&&V.__zooming||new B(V,le)}function B(V,le){this.that=V,this.args=le,this.active=0,this.sourceEvent=null,this.extent=e.apply(V,le),this.taps=0}B.prototype={event:function(V){return V&&(this.sourceEvent=V),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(V,le){return this.mouse&&V!=="mouse"&&(this.mouse[1]=le.invert(this.mouse[0])),this.touch0&&V!=="touch"&&(this.touch0[1]=le.invert(this.touch0[0])),this.touch1&&V!=="touch"&&(this.touch1[1]=le.invert(this.touch1[0])),this.that.__zoom=le,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(V){var le=ye(this.that).datum();c.call(V,this.that,new aw(V,{sourceEvent:this.sourceEvent,target:T,type:V,transform:this.that.__zoom,dispatch:c}),le)}};function U(V,...le){if(!t.apply(this,arguments))return;var de=O(this,le).event(V),ne=this.__zoom,ee=Math.max(n[0],Math.min(n[1],ne.k*Math.pow(2,r.apply(this,arguments)))),re=gl(V);if(de.wheel)(de.mouse[0][0]!==re[0]||de.mouse[0][1]!==re[1])&&(de.mouse[1]=ne.invert(de.mouse[0]=re)),clearTimeout(de.wheel);else{if(ne.k===ee)return;de.mouse=[re,ne.invert(re)],V1(this),de.start()}Df(V),de.wheel=setTimeout(te,v),de.zoom("mouse",i(M(A(ne,ee),de.mouse[0],de.mouse[1]),de.extent,o));function te(){de.wheel=null,de.end()}}function z(V,...le){if(g||!t.apply(this,arguments))return;var de=V.currentTarget,ne=O(this,le,!0).event(V),ee=ye(V.view).on("mousemove.zoom",oe,!0).on("mouseup.zoom",fe,!0),re=gl(V,de),te=V.clientX,ie=V.clientY;M3(V.view),A8(V),ne.mouse=[re,this.__zoom.invert(re)],V1(this),ne.start();function oe(Re){if(Df(Re),!ne.moved){var He=Re.clientX-te,Je=Re.clientY-ie;ne.moved=He*He+Je*Je>E}ne.event(Re).zoom("mouse",i(M(ne.that.__zoom,ne.mouse[0]=gl(Re,de),ne.mouse[1]),ne.extent,o))}function fe(Re){ee.on("mousemove.zoom mouseup.zoom",null),P3(Re.view,ne.moved),Df(Re),ne.event(Re).end()}}function Z(V,...le){if(t.apply(this,arguments)){var de=this.__zoom,ne=gl(V.changedTouches?V.changedTouches[0]:V,this),ee=de.invert(ne),re=de.k*(V.shiftKey?.5:2),te=i(M(A(de,re),ne,ee),e.apply(this,le),o);Df(V),a>0?ye(this).transition().duration(a).call(F,te,ne,V):ye(this).call(T.transform,te,ne,V)}}function W(V,...le){if(t.apply(this,arguments)){var de=V.touches,ne=de.length,ee=O(this,le,V.changedTouches.length===ne).event(V),re,te,ie,oe;for(A8(V),te=0;te<ne;++te)ie=de[te],oe=gl(ie,this),oe=[oe,this.__zoom.invert(oe),ie.identifier],ee.touch0?!ee.touch1&&ee.touch0[2]!==oe[2]&&(ee.touch1=oe,ee.taps=0):(ee.touch0=oe,re=!0,ee.taps=1+!!d);d&&(d=clearTimeout(d)),re&&(ee.taps<2&&(m=oe[0],d=setTimeout(function(){d=null},_)),V1(this),ee.start())}}function q(V,...le){if(this.__zooming){var de=O(this,le).event(V),ne=V.changedTouches,ee=ne.length,re,te,ie,oe;for(Df(V),re=0;re<ee;++re)te=ne[re],ie=gl(te,this),de.touch0&&de.touch0[2]===te.identifier?de.touch0[0]=ie:de.touch1&&de.touch1[2]===te.identifier&&(de.touch1[0]=ie);if(te=de.that.__zoom,de.touch1){var fe=de.touch0[0],Re=de.touch0[1],He=de.touch1[0],Je=de.touch1[1],ot=(ot=He[0]-fe[0])*ot+(ot=He[1]-fe[1])*ot,yt=(yt=Je[0]-Re[0])*yt+(yt=Je[1]-Re[1])*yt;te=A(te,Math.sqrt(ot/yt)),ie=[(fe[0]+He[0])/2,(fe[1]+He[1])/2],oe=[(Re[0]+Je[0])/2,(Re[1]+Je[1])/2]}else if(de.touch0)ie=de.touch0[0],oe=de.touch0[1];else return;de.zoom("touch",i(M(te,ie,oe),de.extent,o))}}function Q(V,...le){if(this.__zooming){var de=O(this,le).event(V),ne=V.changedTouches,ee=ne.length,re,te;for(A8(V),g&&clearTimeout(g),g=setTimeout(function(){g=null},_),re=0;re<ee;++re)te=ne[re],de.touch0&&de.touch0[2]===te.identifier?delete de.touch0:de.touch1&&de.touch1[2]===te.identifier&&delete de.touch1;if(de.touch1&&!de.touch0&&(de.touch0=de.touch1,delete de.touch1),de.touch0)de.touch0[1]=this.__zoom.invert(de.touch0[0]);else if(de.end(),de.taps===2&&(te=gl(te,this),Math.hypot(m[0]-te[0],m[1]-te[1])<b)){var ie=ye(this).on("dblclick.zoom");ie&&ie.apply(this,arguments)}}}return T.wheelDelta=function(V){return arguments.length?(r=typeof V=="function"?V:Y3(+V),T):r},T.filter=function(V){return arguments.length?(t=typeof V=="function"?V:Y3(!!V),T):t},T.touchable=function(V){return arguments.length?(s=typeof V=="function"?V:Y3(!!V),T):s},T.extent=function(V){return arguments.length?(e=typeof V=="function"?V:Y3([[+V[0][0],+V[0][1]],[+V[1][0],+V[1][1]]]),T):e},T.scaleExtent=function(V){return arguments.length?(n[0]=+V[0],n[1]=+V[1],T):[n[0],n[1]]},T.translateExtent=function(V){return arguments.length?(o[0][0]=+V[0][0],o[1][0]=+V[1][0],o[0][1]=+V[0][1],o[1][1]=+V[1][1],T):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},T.constrain=function(V){return arguments.length?(i=V,T):i},T.duration=function(V){return arguments.length?(a=+V,T):a},T.interpolate=function(V){return arguments.length?(l=V,T):l},T.on=function(){var V=c.on.apply(c,arguments);return V===c?T:V},T.clickDistance=function(V){return arguments.length?(E=(V=+V)*V,T):Math.sqrt(E)},T.tapDistance=function(V){return arguments.length?(b=+V,T):b},T}var Dc=2*Math.PI,C8=6356752314245179e-9,I8=6378137;function cw(t){return t*(Dc*I8/360)}function K3(t,e){return Math.abs(e)>=90?0:t*(Dc*C8/360)*Math.abs(Math.cos(e*(Math.PI/180)))}function Fc(t){return t/(Dc*I8/360)}function Dn(t,e){return Math.abs(e)>=90?0:t/(Dc*C8/360)/Math.abs(Math.cos(e*(Math.PI/180)))}function k8(t,e){return e=e||256,[t[0]*e/(Dc*C8),-t[1]*e/(Dc*I8)]}function M8(t,e){return e=e||256,[t[0]*Dc*C8/e,-t[1]*Dc*I8/e]}function mr(t,e){let i=K3(t[0]-e[0],(t[1]+e[1])/2),r=cw(t[1]-e[1]);return Math.sqrt(i*i+r*r)}function Ga(t,e){e=e||256;let i=Math.log(e)*Math.LOG2E;return Math.log(t*Dc)/Math.LN2-i}function Fn(t,e){return e=e||256,e*Math.pow(2,t)/Dc}function P8(t,e){let i=1/0,r;for(let s=0;s<t.length;s++){let n=mr(t[s],e);n<i&&(i=n,r=s)}return r!==void 0?{index:r,distance:i,point:t[r]}:null}var mt=class{constructor(t,e){this.min=[1/0,1/0],this.max=[-1/0,-1/0];let i;t instanceof mt?(i=t.min,e=t.max):i=t,i&&i.length===2&&(this.min[0]=i[0],this.min[1]=i[1],e||(e=i)),e&&e.length===2&&(this.max[0]=e[0],this.max[1]=e[1])}equals(t){return this.min[0]===t.min[0]&&this.min[1]===t.min[1]&&this.max[0]===t.max[0]&&this.max[1]===t.max[1]}area(){return Math.abs((this.max[0]-this.min[0])*(this.max[1]-this.min[1]))}center(){return[(this.min[0]+this.max[0])/2,(this.min[1]+this.max[1])/2]}rectangle(){return[this.min[0],this.min[1],this.max[0],this.max[1]]}toParam(){return this.rectangle().join(",")}bbox(){return{minX:this.min[0],minY:this.min[1],maxX:this.max[0],maxY:this.max[1]}}polygon(){return[[this.min[0],this.min[1]],[this.min[0],this.max[1]],[this.max[0],this.max[1]],[this.max[0],this.min[1]],[this.min[0],this.min[1]]]}contains(t){return t.min[0]>=this.min[0]&&t.min[1]>=this.min[1]&&t.max[0]<=this.max[0]&&t.max[1]<=this.max[1]}intersects(t){return t.min[0]<=this.max[0]&&t.min[1]<=this.max[1]&&t.max[0]>=this.min[0]&&t.max[1]>=this.min[1]}intersection(t){return this.intersects(t)?new mt([Math.max(t.min[0],this.min[0]),Math.max(t.min[1],this.min[1])],[Math.min(t.max[0],this.max[0]),Math.min(t.max[1],this.max[1])]):new mt}percentContainedIn(t){let e=this.intersection(t).area(),i=this.area();return e===1/0||i===1/0?0:e===0||i===0?t.contains(this)?1:0:e/i}extend(t){return new mt([Math.min(t.min[0],this.min[0]),Math.min(t.min[1],this.min[1])],[Math.max(t.max[0],this.max[0]),Math.max(t.max[1],this.max[1])])}padByMeters(t){let e=Fc(t),i=Dn(t,this.center()[1]);return new mt([this.min[0]-i,this.min[1]-e],[this.max[0]+i,this.max[1]+e])}};function Zi(t,e,i){return i?Math.abs(t[0]-e[0])<=i&&Math.abs(t[1]-e[1])<=i:t[0]===e[0]&&t[1]===e[1]}function Ir(t,e){return[t[0]+e[0],t[1]+e[1]]}function sr(t,e){return[t[0]-e[0],t[1]-e[1]]}function $o(t,e){return[t[0]*e,t[1]*e]}function yr(t,e,i){return[t[0]+(e[0]-t[0])*i,t[1]+(e[1]-t[1])*i]}function Xi(t,e){e=e||[0,0];let i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function uw(t,e=[0,0]){return(t[0]-e[0])**2+(t[1]-e[1])**2}function Lf(t){let e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return e!==0?$o(t,1/e):[0,0]}function fs(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])}function _l(t,e,i){i=i||[0,0];let r=sr(t,i),s=sr(e,i);return r[0]*s[0]+r[1]*s[1]}function R8(t,e,i){i=i||[0,0];let r=Lf(sr(t,i)),s=Lf(sr(e,i));return _l(r,s)}function Q3(t,e,i){i=i||[0,0];let r=sr(t,i),s=sr(e,i);return r[0]*s[1]-r[1]*s[0]}function dP(t,e){let i=1/0,r,s;for(let n=0;n<e.length-1;n++){let o=e[n],a=sr(e[n+1],o),l=sr(t,o),c=_l(l,a)/_l(a,a),d;c<0?d=o:c>1?d=e[n+1]:d=[o[0]+c*a[0],o[1]+c*a[1]];let m=Xi(d,t);m<i&&(i=m,r=n+1,s=d)}return r!==void 0&&s!==void 0?{index:r,distance:i,target:s}:null}function fP(t,e){return t[0]===e[0]&&t[1]===e[1]||t[0]===e[1]&&t[1]===e[0]}function Pu(t,e,i){return t.map(r=>{let s=sr(r,i);return[s[0]*Math.cos(e)-s[1]*Math.sin(e)+i[0],s[0]*Math.sin(e)+s[1]*Math.cos(e)+i[1]]})}function Ru(t,e){if(t.length!==2||e.length!==2)return null;let i=[t[0][0],t[0][1]],r=[t[1][0],t[1][1]],s=[e[0][0],e[0][1]],n=[e[1][0],e[1][1]],o=sr(r,i),a=sr(n,s),l=Q3(sr(s,i),o),c=Q3(o,a);if(l&&c){let d=l/c,m=Q3(sr(s,i),a)/c;if(m>=0&&m<=1&&d>=0&&d<=1)return yr(i,r,m)}return null}function D8(t,e){let i=[];for(let r=0;r<t.length-1;r++)for(let s=0;s<e.length-1;s++){let n=[t[r],t[r+1]],o=[e[s],e[s+1]],a=Ru(n,o);a&&i.push(a)}return i}function CV(t,e){for(let i=0;i<t.length-1;i++)for(let r=0;r<e.length-1;r++){let s=[t[i],t[i+1]],n=[e[r],e[r+1]];if(Ru(s,n))return!0}return!1}function Nf(t,e){let i=t[0],r=t[1],s=!1;for(let n=0,o=e.length-1;n<e.length;o=n++){let a=e[n][0],l=e[n][1],c=e[o][0],d=e[o][1];l>r!=d>r&&i<(c-a)*(r-l)/(d-l)+a&&(s=!s)}return s}function F8(t,e){return e.every(i=>Nf(i,t))}function pP(t,e,i){function r(s,n){return n.some(o=>Nf(o,s))}return r(t,e)||!!i&&CV(t,e)}function Of(t){let e=Ql(t);if(!e)return null;let i=ma(e),r=1/0,s=new mt,n=0,o=e[0];for(let a=0;a<=e.length-1;a++){let l=a===e.length-1?e[0]:e[a+1],c=Math.atan2(l[1]-o[1],l[0]-o[0]),m=Pu(e,-c,i).reduce((_,v)=>(_.min[0]=Math.min(_.min[0],v[0]),_.min[1]=Math.min(_.min[1],v[1]),_.max[0]=Math.max(_.max[0],v[0]),_.max[1]=Math.max(_.max[1],v[1]),_),new mt),g=m.area();g<r&&(r=g,s=m,n=c),o=l}return{poly:Pu(s.polygon(),n,i),angle:n}}function hw(t){let e=0;for(let i=0;i<t.length-1;i++)e+=Xi(t[i],t[i+1]);return e}function L8(t,e){let i=[80,20,50,20],r=0,s=0;return t[0]>e[0]-i[1]&&(r=-10),t[0]<i[3]&&(r=10),t[1]>e[1]-i[2]&&(s=-10),t[1]<i[0]&&(s=10),r||s?[r,s]:null}var Ho=class{constructor(t,e,i){this._proj=Sf,this._dimensions=[[0,0],[0,0]],this._x=t||0,this._y=e||0,this._k=i||256/Math.PI}project(t){return t=this._proj(t[0]*Math.PI/180,t[1]*Math.PI/180),[t[0]*this._k+this._x,this._y-t[1]*this._k]}invert(t){return t=this._proj.invert((t[0]-this._x)/this._k,(this._y-t[1])/this._k),[t[0]*180/Math.PI,t[1]*180/Math.PI]}scale(t){return t===void 0?this._k:(this._k=+t,this)}translate(t){return t===void 0?[this._x,this._y]:(this._x=+t[0],this._y=+t[1],this)}dimensions(t){return t===void 0?this._dimensions:(this._dimensions=t,this)}transform(t){return t===void 0?yl.translate(this._x,this._y).scale(this._k):(this._x=+t.x,this._y=+t.y,this._k=+t.k,this)}getStream(){let t=this;return Wb({point:function(e,i){let r=t.project([e,i]);this.stream.point(r[0],r[1])}}).stream}};function Z3(t,e,i){return Math.max(e,Math.min(t,i))}function hP(t,e){return Array.from(Array(1+e-t).keys()).map(i=>t+i)}var zs=class{constructor(){this._tileSize=256,this._zoomRange=[0,24],this._margin=0,this._skipNullIsland=!1}getTiles(t){let e=t.dimensions(),i=t.translate(),r=t.scale(),s=Ga(r,this._tileSize),n=Z3(Math.round(s),this._zoomRange[0],this._zoomRange[1]),o=0,a=Math.pow(2,n)-1,l=Math.log(this._tileSize)*Math.LOG2E,c=Math.pow(2,s-n+l),d=[r*Math.PI-i[0],r*Math.PI-i[1]],m=[d[0]+e[0][0],d[1]+e[0][1]],g=[d[0]+e[1][0],d[1]+e[1][1]],_=new mt(m,g),v=Math.pow(2,n)/2*this._tileSize,E=Fn(n,this._tileSize),b=new Ho(v,v,E),T=hP(Z3(Math.floor(m[0]/c)-this._margin,o,a),Z3(Math.floor(g[0]/c)+this._margin,o,a)),A=hP(Z3(Math.floor(m[1]/c)-this._margin,o,a),Z3(Math.floor(g[1]/c)+this._margin,o,a)),M=[];for(let k=0;k<A.length;k++){let F=A[k];for(let O=0;O<T.length;O++){let B=T[O],U=[B,F,n];if(this._skipNullIsland&&zs.isNearNullIsland(B,F,n))continue;let z=[B*this._tileSize,F*this._tileSize],Z=[(B+1)*this._tileSize,(F+1)*this._tileSize],W=new mt(z,Z),q=_.intersects(W),Q=b.invert([z[0],Z[1]]),V=b.invert([Z[0],z[1]]),le={id:U.toString(),xyz:U,pxExtent:new mt(z,Z),wgs84Extent:new mt(Q,V),isVisible:q};q?M.unshift(le):M.push(le)}}return{tiles:M}}getGeoJSON(t){return{type:"FeatureCollection",features:t.tiles.map(i=>({type:"Feature",properties:{id:i.id,name:i.id},geometry:{type:"Polygon",coordinates:[i.wgs84Extent.polygon()]}}))}}tileSize(t){return t===void 0?this._tileSize:(this._tileSize=t,this)}zoomRange(t,e){return t===void 0?this._zoomRange:(e===void 0&&(e=t),this._zoomRange=[t,e],this)}margin(t){return t===void 0?this._margin:(this._margin=+t,this)}skipNullIsland(t){return t===void 0?this._skipNullIsland:(this._skipNullIsland=t,this)}static isNearNullIsland(t,e,i){if(i>=7){let r=Math.pow(2,i-1),s=Math.pow(2,i-6),n=r-s/2,o=r+s/2-1;return t>=n&&t<=o&&e>=n&&e<=o}return!1}};var kV=0;function Dt(t){if(!(this instanceof Dt))return t&&t.type?Dt[t.type].apply(this,arguments):t&&t.id?Dt[Dt.id.type(t.id)].apply(this,arguments):new Dt().initialize(arguments)}Dt.id=function(t){return Dt.id.fromOSM(t,Dt.id.next[t]--)};Dt.id.next={changeset:-1,node:-1,way:-1,relation:-1};Dt.id.fromOSM=function(t,e){return t[0]+e};Dt.id.toOSM=function(t){return t.slice(1)};Dt.id.type=function(t){return{c:"changeset",n:"node",w:"way",r:"relation"}[t[0]]};Dt.key=function(t){return t.id+"v"+(t.v||0)};var Bf;Dt.deprecatedTagValuesByKey=function(t){return Bf||(Bf={},t.forEach(function(e){var i=Object.keys(e.old);if(i.length===1){var r=i[0],s=e.old[r];s!=="*"&&(Bf[r]?Bf[r].push(s):Bf[r]=[s])}})),Bf};Dt.prototype={tags:{},initialize:function(t){for(var e=0;e<t.length;++e){var i=t[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(i[r]===void 0?delete this[r]:this[r]=i[r])}return!this.id&&this.type&&(this.id=Dt.id(this.type)),this.hasOwnProperty("visible")||(this.visible=!0),this},copy:function(t,e){if(e[this.id])return e[this.id];var i=Dt(this,{id:void 0,user:void 0,version:void 0,v:void 0});return e[this.id]=i,i},osmId:function(){return Dt.id.toOSM(this.id)},isNew:function(){return this.osmId()<0},update:function(t){return Dt(this,t).touch()},touch:function(){return this.v=kV++,this},mergeTags:function(t){var e=Object.assign({},this.tags),i=!1;for(var r in t){var s=e[r],n=t[r];if(!s)i=!0,e[r]=n;else if(r==="building"){if(n==="yes")continue;s==="yes"&&(i=!0,e[r]=n)}else s!==n&&(i=!0,e[r]=F9(as(s.split(/;\s*/),n.split(/;\s*/)).join(";"),255))}return i?this.update({tags:e}):this},intersects:function(t,e){return this.extent(e).intersects(t)},hasNonGeometryTags:function(){return Object.keys(this.tags).some(function(t){return t!=="area"})},hasParentRelations:function(t){return t.parentRelations(this).length>0},hasInterestingTags:function(){return Object.keys(this.tags).some(No)},isHighwayIntersection:function(){return!1},isDegenerate:function(){return!0},deprecatedTags:function(t){var e=this.tags;if(Object.keys(e).length===0)return[];var i=[];return t.forEach(function(r){var s=Object.keys(r.old);if(r.replace){var n=Object.keys(r.replace).some(function(a){if(!e[a]||r.old[a])return!1;var l=r.replace[a];return!(l==="*"||l===e[a])});if(n)return}var o=s.every(function(a){if(!e[a])return!1;if(r.old[a]==="*"||r.old[a]===e[a])return!0;var l=e[a].split(";").filter(Boolean);if(l.length===0)return!1;if(l.length>1)return l.indexOf(r.old[a])!==-1;if(e[a]===r.old[a])if(r.replace&&r.old[a]===r.replace[a]){var c=Object.keys(r.replace);return!c.every(function(d){return e[d]===r.replace[d]})}else return!0;return!1});o&&i.push(r)}),i}};function N8(t){if(t.type!=="way"||!t.tags.highway)return null;var e=t.tags,i=t.isOneWay(),r=MV(e,i),s=PV(e),n=RV(e,i,r),o=n.forward,a=n.backward,l=n.bothways,c={};c.unspecified=dw(e["turn:lanes"]),c.forward=dw(e["turn:lanes:forward"]),c.backward=dw(e["turn:lanes:backward"]);var d={};d.unspecified=fw(e["maxspeed:lanes"],s),d.forward=fw(e["maxspeed:lanes:forward"],s),d.backward=fw(e["maxspeed:lanes:backward"],s);var m={};m.unspecified=Vo(e["psv:lanes"]),m.forward=Vo(e["psv:lanes:forward"]),m.backward=Vo(e["psv:lanes:backward"]);var g={};g.unspecified=Vo(e["bus:lanes"]),g.forward=Vo(e["bus:lanes:forward"]),g.backward=Vo(e["bus:lanes:backward"]);var _={};_.unspecified=Vo(e["taxi:lanes"]),_.forward=Vo(e["taxi:lanes:forward"]),_.backward=Vo(e["taxi:lanes:backward"]);var v={};v.unspecified=Vo(e["hov:lanes"]),v.forward=Vo(e["hov:lanes:forward"]),v.backward=Vo(e["hov:lanes:backward"]);var E={};E.unspecified=Vo(e["hgv:lanes"]),E.forward=Vo(e["hgv:lanes:forward"]),E.backward=Vo(e["hgv:lanes:backward"]);var b={};b.unspecified=pw(e["bicycleway:lanes"]),b.forward=pw(e["bicycleway:lanes:forward"]),b.backward=pw(e["bicycleway:lanes:backward"]);var T={forward:[],backward:[],unspecified:[]};return j1(T,c,"turnLane"),j1(T,d,"maxspeed"),j1(T,m,"psv"),j1(T,g,"bus"),j1(T,_,"taxi"),j1(T,v,"hov"),j1(T,E,"hgv"),j1(T,b,"bicycleway"),{metadata:{count:r,oneway:i,forward:o,backward:a,bothways:l,turnLanes:c,maxspeed:s,maxspeedLanes:d,psvLanes:m,busLanes:g,taxiLanes:_,hovLanes:v,hgvLanes:E,bicyclewayLanes:b},lanes:T}}function MV(t,e){var i;if(t.lanes&&(i=parseInt(t.lanes,10),i>0))return i;switch(t.highway){case"trunk":case"motorway":i=e?2:4;break;default:i=e?1:2;break}return i}function PV(t){var e=t.maxspeed;if(e){var i=/^([0-9][\.0-9]+?)(?:[ ]?(?:km\/h|kmh|kph|mph|knots))?$/;if(i.test(e))return parseInt(e,10)}}function RV(t,e,i){var r=parseInt(t["lanes:forward"],10),s=parseInt(t["lanes:backward"],10),n=parseInt(t["lanes:both_ways"],10)>0?1:0;return parseInt(t.oneway,10)===-1?(r=0,n=0,s=i):e?(r=i,n=0,s=0):isNaN(r)&&isNaN(s)?(s=Math.floor((i-n)/2),r=i-n-s):isNaN(r)?(s>i-n&&(s=i-n),r=i-n-s):isNaN(s)&&(r>i-n&&(r=i-n),s=i-n-r),{forward:r,backward:s,bothways:n}}function dw(t){if(t){var e=["left","slight_left","sharp_left","through","right","slight_right","sharp_right","reverse","merge_to_left","merge_to_right","none"];return t.split("|").map(function(i){return i===""&&(i="none"),i.split(";").map(function(r){return e.indexOf(r)===-1?"unknown":r})})}}function fw(t,e){if(t)return t.split("|").map(function(i){if(i==="none")return i;var r=parseInt(i,10);return i===""||r===e?null:isNaN(r)?"unknown":r})}function Vo(t){if(t){var e=["yes","no","designated"];return t.split("|").map(function(i){return i===""&&(i="no"),e.indexOf(i)===-1?"unknown":i})}}function pw(t){if(t){var e=["yes","no","designated","lane"];return t.split("|").map(function(i){return i===""&&(i="no"),e.indexOf(i)===-1?"unknown":i})}}function j1(t,e,i){e.forward&&e.forward.forEach(function(r,s){t.forward[s]||(t.forward[s]={}),t.forward[s][i]=r}),e.backward&&e.backward.forEach(function(r,s){t.backward[s]||(t.backward[s]={}),t.backward[s][i]=r}),e.unspecified&&e.unspecified.forEach(function(r,s){t.unspecified[s]||(t.unspecified[s]={}),t.unspecified[s][i]=r})}var nr;function Gs(t){if(nr&&!t)return nr;nr={};let e=navigator.userAgent,i=null;i=e.match(/(edg)\/?\s*(\.?\d+(\.\d+)*)/i),i!==null&&(nr.browser="Edge",nr.version=i[2]),nr.browser||(i=e.match(/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/i),i!==null&&(nr.browser="msie",nr.version=i[1])),nr.browser||(i=e.match(/(opr)\/?\s*(\.?\d+(\.\d+)*)/i),i!==null&&(nr.browser="Opera",nr.version=i[2])),nr.browser||(i=e.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i),i!==null&&(nr.browser=i[1],nr.version=i[2],i=e.match(/version\/([\.\d]+)/i),i!==null&&(nr.version=i[1]))),nr.browser||(nr.browser=navigator.appName,nr.version=navigator.appVersion),nr.version=nr.version.split(/\W/).slice(0,2).join("."),nr.opera=nr.browser.toLowerCase()==="opera"&&parseFloat(nr.version)<15,nr.browser.toLowerCase()==="msie"?nr.support=!1:nr.support=!0,nr.filedrop=window.FileReader&&"ondrop"in window,nr.download=!(nr.ie||nr.browser.toLowerCase()==="edge"),nr.cssfilters=!(nr.ie||nr.browser.toLowerCase()==="edge"),/Win/.test(e)?(nr.os="win",nr.platform="Windows"):/Mac/.test(e)?(nr.os="mac",nr.platform="Macintosh"):/X11/.test(e)||/Linux/.test(e)?(nr.os="linux",nr.platform="Linux"):(nr.os="win",nr.platform="Unknown"),nr.isMobileWebKit=(/\b(iPad|iPhone|iPod)\b/.test(e)||navigator.platform==="MacIntel"&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>1)&&/WebKit/.test(e)&&!/Edge/.test(e)&&!window.MSStream,nr.browserLocales=Array.from(new Set([navigator.language].concat(navigator.languages||[]).concat([navigator.userLanguage]).filter(Boolean)));let r=window.top.location,s=r.origin;return s||(s=r.protocol+"//"+r.hostname+(r.port?":"+r.port:"")),nr.host=s+r.pathname,nr}var jo=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(jo||{}),mw=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS",t))(mw||{}),O8=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(O8||{}),ki=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(ki||{}),ya=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(ya||{}),zt=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(zt||{}),Du=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(Du||{}),yi=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(yi||{}),B8=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(B8||{}),io=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(io||{}),_a=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(_a||{}),An=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(An||{}),tn=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(tn||{}),$a=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))($a||{}),U8=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(U8||{}),Xo=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(Xo||{}),rn=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(rn||{});var Zr=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(Zr||{}),xa=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(xa||{});var gw={createCanvas:(t,e)=>{let i=document.createElement("canvas");return i.width=t,i.height=e,i},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>{var t;return(t=document.baseURI)!=null?t:window.location.href},getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>new DOMParser().parseFromString(t,"text/xml")};var ht={ADAPTER:gw,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var yw=/iPhone/i,mP=/iPod/i,gP=/iPad/i,yP=/\biOS-universal(?:.+)Mac\b/i,_w=/\bAndroid(?:.+)Mobile\b/i,_P=/Android/i,Uf=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,z8=/Silk/i,Fu=/Windows Phone/i,xP=/\bWindows(?:.+)ARM\b/i,vP=/BlackBerry/i,bP=/BB10/i,wP=/Opera Mini/i,EP=/\b(CriOS|Chrome)(?:.+)Mobile/i,TP=/Mobile(?:.+)Firefox\b/i,SP=function(t){return typeof t!="undefined"&&t.platform==="MacIntel"&&typeof t.maxTouchPoints=="number"&&t.maxTouchPoints>1&&typeof MSStream=="undefined"};function DV(t){return function(e){return e.test(t)}}function X1(t){var e={userAgent:"",platform:"",maxTouchPoints:0};!t&&typeof navigator!="undefined"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof t=="string"?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0});var i=e.userAgent,r=i.split("[FBAN");typeof r[1]!="undefined"&&(i=r[0]),r=i.split("Twitter"),typeof r[1]!="undefined"&&(i=r[0]);var s=DV(i),n={apple:{phone:s(yw)&&!s(Fu),ipod:s(mP),tablet:!s(yw)&&(s(gP)||SP(e))&&!s(Fu),universal:s(yP),device:(s(yw)||s(mP)||s(gP)||s(yP)||SP(e))&&!s(Fu)},amazon:{phone:s(Uf),tablet:!s(Uf)&&s(z8),device:s(Uf)||s(z8)},android:{phone:!s(Fu)&&s(Uf)||!s(Fu)&&s(_w),tablet:!s(Fu)&&!s(Uf)&&!s(_w)&&(s(z8)||s(_P)),device:!s(Fu)&&(s(Uf)||s(z8)||s(_w)||s(_P))||s(/\bokhttp\b/i)},windows:{phone:s(Fu),tablet:s(xP),device:s(Fu)||s(xP)},other:{blackberry:s(vP),blackberry10:s(bP),opera:s(wP),firefox:s(TP),chrome:s(EP),device:s(vP)||s(bP)||s(wP)||s(TP)||s(EP)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}var AP,FV=(AP=X1.default)!=null?AP:X1,xl=FV(globalThis.navigator);var St={};A9(St,{BaseTextureCache:()=>Yo,BoundingBox:()=>Yf,CanvasRenderTarget:()=>Q8,DATA_URI:()=>Y8,EventEmitter:()=>sn.default,ProgramCache:()=>h5,TextureCache:()=>Wn,clearTextureCache:()=>mR,correctBlendMode:()=>oR,createIndicesForQuads:()=>uR,decomposeDataUri:()=>xR,deprecation:()=>rr,destroyTextureCache:()=>pR,determineCrossOrigin:()=>eg,earcut:()=>vR.default,getBufferType:()=>W1,getCanvasBoundingBox:()=>K8,getResolutionOfUrl:()=>d5,hex2rgb:()=>iR,hex2string:()=>rR,interleaveTypedArrays:()=>hR,isMobile:()=>xl,isPow2:()=>c5,isWebGLSupported:()=>W8,log2:()=>u5,nextPow2:()=>q1,path:()=>Mw,premultiplyBlendMode:()=>l5,premultiplyRgba:()=>aR,premultiplyTint:()=>lR,premultiplyTintToRgba:()=>cR,removeItems:()=>Z8,rgb2hex:()=>nR,sayHello:()=>jP,sign:()=>dR,skipHello:()=>VP,string2hex:()=>sR,trimCanvas:()=>_R,uid:()=>Nc,url:()=>X8});ht.RETINA_PREFIX=/@([0-9\.]+)x/;ht.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var sn=Yi(vw(),1),vR=Yi(Sw(),1);var jf=Yi(kw(),1),X8={parse:jf.parse,format:jf.format,resolve:jf.resolve};function tc(t){if(typeof t!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function o5(t){return t.split("?")[0].split("#")[0]}function hj(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function dj(t,e,i){return t.replace(new RegExp(hj(e),"g"),i)}function fj(t,e){let i="",r=0,s=-1,n=0,o=-1;for(let a=0;a<=t.length;++a){if(a<t.length)o=t.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(s===a-1||n===1))if(s!==a-1&&n===2){if(i.length<2||r!==2||i.charCodeAt(i.length-1)!==46||i.charCodeAt(i.length-2)!==46){if(i.length>2){let l=i.lastIndexOf("/");if(l!==i.length-1){l===-1?(i="",r=0):(i=i.slice(0,l),r=i.length-1-i.lastIndexOf("/")),s=a,n=0;continue}}else if(i.length===2||i.length===1){i="",r=0,s=a,n=0;continue}}e&&(i.length>0?i+="/..":i="..",r=2)}else i.length>0?i+=`/${t.slice(s+1,a)}`:i=t.slice(s+1,a),r=a-s-1;s=a,n=0}else o===46&&n!==-1?++n:n=-1}return i}var Mw={toPosix(t){return dj(t,"\\","/")},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl(t){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t)},hasProtocol(t){return/^[^/:]+:\//.test(this.toPosix(t))},getProtocol(t){tc(t),t=this.toPosix(t);let e="",i=/^file:\/\/\//.exec(t),r=/^[^/:]+:\/\//.exec(t),s=/^[^/:]+:\//.exec(t);if(i||r||s){let n=(i==null?void 0:i[0])||(r==null?void 0:r[0])||(s==null?void 0:s[0]);e=n,t=t.slice(n.length)}return e},toAbsolute(t,e,i){if(this.isDataUrl(t))return t;let r=o5(this.toPosix(e!=null?e:ht.ADAPTER.getBaseUrl())),s=o5(this.toPosix(i!=null?i:this.rootname(r)));return tc(t),t=this.toPosix(t),t.startsWith("/")?Mw.join(s,t.slice(1)):this.isAbsolute(t)?t:this.join(r,t)},normalize(t){if(t=this.toPosix(t),tc(t),t.length===0)return".";let e="",i=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));let r=t.endsWith("/");return t=fj(t,!1),t.length>0&&r&&(t+="/"),i?`/${t}`:e+t},isAbsolute(t){return tc(t),t=this.toPosix(t),this.hasProtocol(t)?!0:t.startsWith("/")},join(...t){var i;if(t.length===0)return".";let e;for(let r=0;r<t.length;++r){let s=t[r];if(tc(s),s.length>0)if(e===void 0)e=s;else{let n=(i=t[r-1])!=null?i:"";this.extname(n)?e+=`/../${s}`:e+=`/${s}`}}return e===void 0?".":this.normalize(e)},dirname(t){if(tc(t),t.length===0)return".";t=this.toPosix(t);let e=t.charCodeAt(0),i=e===47,r=-1,s=!0,n=this.getProtocol(t),o=t;t=t.slice(n.length);for(let a=t.length-1;a>=1;--a)if(e=t.charCodeAt(a),e===47){if(!s){r=a;break}}else s=!1;return r===-1?i?"/":this.isUrl(o)?n+t:n:i&&r===1?"//":n+t.slice(0,r)},rootname(t){tc(t),t=this.toPosix(t);let e="";if(t.startsWith("/")?e="/":e=this.getProtocol(t),this.isUrl(t)){let i=t.indexOf("/",e.length);i!==-1?e=t.slice(0,i):e=t,e.endsWith("/")||(e+="/")}return e},basename(t,e){tc(t),e&&tc(e),t=o5(this.toPosix(t));let i=0,r=-1,s=!0,n;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(n=t.length-1;n>=0;--n){let l=t.charCodeAt(n);if(l===47){if(!s){i=n+1;break}}else a===-1&&(s=!1,a=n+1),o>=0&&(l===e.charCodeAt(o)?--o===-1&&(r=n):(o=-1,r=a))}return i===r?r=a:r===-1&&(r=t.length),t.slice(i,r)}for(n=t.length-1;n>=0;--n)if(t.charCodeAt(n)===47){if(!s){i=n+1;break}}else r===-1&&(s=!1,r=n+1);return r===-1?"":t.slice(i,r)},extname(t){tc(t),t=o5(this.toPosix(t));let e=-1,i=0,r=-1,s=!0,n=0;for(let o=t.length-1;o>=0;--o){let a=t.charCodeAt(o);if(a===47){if(!s){i=o+1;break}continue}r===-1&&(s=!1,r=o+1),a===46?e===-1?e=o:n!==1&&(n=1):e!==-1&&(n=-1)}return e===-1||r===-1||n===0||n===1&&e===r-1&&e===i+1?"":t.slice(e,r)},parse(t){tc(t);let e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;t=o5(this.toPosix(t));let i=t.charCodeAt(0),r=this.isAbsolute(t),s,n="";e.root=this.rootname(t),r||this.hasProtocol(t)?s=1:s=0;let o=-1,a=0,l=-1,c=!0,d=t.length-1,m=0;for(;d>=s;--d){if(i=t.charCodeAt(d),i===47){if(!c){a=d+1;break}continue}l===-1&&(c=!1,l=d+1),i===46?o===-1?o=d:m!==1&&(m=1):o!==-1&&(m=-1)}return o===-1||l===-1||m===0||m===1&&o===l-1&&o===a+1?l!==-1&&(a===0&&r?e.base=e.name=t.slice(1,l):e.base=e.name=t.slice(a,l)):(a===0&&r?(e.name=t.slice(1,o),e.base=t.slice(1,l)):(e.name=t.slice(a,o),e.base=t.slice(a,l)),e.ext=t.slice(o,l)),e.dir=this.dirname(t),n&&(e.dir=n+e.dir),e},sep:"/",delimiter:":"};var HP={};function rr(t,e,i=3){if(HP[e])return;let r=new Error().stack;typeof r=="undefined"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${t}`):(r=r.split(`
`).splice(i).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${t}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${t}`),console.warn(r))),HP[e]=!0}function VP(){rr("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function jP(){rr("7.0.0",`sayHello is deprecated, please use Renderer's "hello" option`)}var Pw;function W8(){return typeof Pw=="undefined"&&(Pw=function(){var i;let e={stencil:!0,failIfMajorPerformanceCaveat:ht.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!ht.ADAPTER.getWebGLRenderingContext())return!1;let r=ht.ADAPTER.createCanvas(),s=r.getContext("webgl",e)||r.getContext("experimental-webgl",e),n=!!((i=s==null?void 0:s.getContextAttributes())!=null&&i.stencil);if(s){let o=s.getExtension("WEBGL_lose_context");o&&o.loseContext()}return s=null,n}catch(r){return!1}}()),Pw}var pj={grad:.9,turn:360,rad:360/(2*Math.PI)},Lu=function(t){return typeof t=="string"?t.length>0:typeof t=="number"},Xn=function(t,e,i){return e===void 0&&(e=0),i===void 0&&(i=Math.pow(10,e)),Math.round(i*t)/i+0},bl=function(t,e,i){return e===void 0&&(e=0),i===void 0&&(i=1),t>i?i:t>e?t:e},JP=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},XP=function(t){return{r:bl(t.r,0,255),g:bl(t.g,0,255),b:bl(t.b,0,255),a:bl(t.a)}},Rw=function(t){return{r:Xn(t.r),g:Xn(t.g),b:Xn(t.b),a:Xn(t.a,3)}},mj=/^#([0-9a-f]{3,8})$/i,q8=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},eR=function(t){var e=t.r,i=t.g,r=t.b,s=t.a,n=Math.max(e,i,r),o=n-Math.min(e,i,r),a=o?n===e?(i-r)/o:n===i?2+(r-e)/o:4+(e-i)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:s}},tR=function(t){var e=t.h,i=t.s,r=t.v,s=t.a;e=e/360*6,i/=100,r/=100;var n=Math.floor(e),o=r*(1-i),a=r*(1-(e-n)*i),l=r*(1-(1-e+n)*i),c=n%6;return{r:255*[r,a,o,o,l,r][c],g:255*[l,r,r,a,o,o][c],b:255*[o,o,l,r,r,a][c],a:s}},WP=function(t){return{h:JP(t.h),s:bl(t.s,0,100),l:bl(t.l,0,100),a:bl(t.a)}},qP=function(t){return{h:Xn(t.h),s:Xn(t.s),l:Xn(t.l),a:Xn(t.a,3)}},YP=function(t){return tR((i=(e=t).s,{h:e.h,s:(i*=((r=e.l)<50?r:100-r)/100)>0?2*i/(r+i)*100:0,v:r+i,a:e.a}));var e,i,r},a5=function(t){return{h:(e=eR(t)).h,s:(s=(200-(i=e.s))*(r=e.v)/100)>0&&s<200?i*r/100/(s<=100?s:200-s)*100:0,l:s/2,a:e.a};var e,i,r,s},gj=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,yj=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,_j=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,xj=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Lw={string:[[function(t){var e=mj.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:t.length===4?Xn(parseInt(t[3]+t[3],16)/255,2):1}:t.length===6||t.length===8?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:t.length===8?Xn(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=_j.exec(t)||xj.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:XP({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=gj.exec(t)||yj.exec(t);if(!e)return null;var i,r,s=WP({h:(i=e[1],r=e[2],r===void 0&&(r="deg"),Number(i)*(pj[r]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return YP(s)},"hsl"]],object:[[function(t){var e=t.r,i=t.g,r=t.b,s=t.a,n=s===void 0?1:s;return Lu(e)&&Lu(i)&&Lu(r)?XP({r:Number(e),g:Number(i),b:Number(r),a:Number(n)}):null},"rgb"],[function(t){var e=t.h,i=t.s,r=t.l,s=t.a,n=s===void 0?1:s;if(!Lu(e)||!Lu(i)||!Lu(r))return null;var o=WP({h:Number(e),s:Number(i),l:Number(r),a:Number(n)});return YP(o)},"hsl"],[function(t){var e=t.h,i=t.s,r=t.v,s=t.a,n=s===void 0?1:s;if(!Lu(e)||!Lu(i)||!Lu(r))return null;var o=function(a){return{h:JP(a.h),s:bl(a.s,0,100),v:bl(a.v,0,100),a:bl(a.a)}}({h:Number(e),s:Number(i),v:Number(r),a:Number(n)});return tR(o)},"hsv"]]},ZP=function(t,e){for(var i=0;i<e.length;i++){var r=e[i][0](t);if(r)return[r,e[i][1]]}return[null,void 0]},vj=function(t){return typeof t=="string"?ZP(t.trim(),Lw.string):typeof t=="object"&&t!==null?ZP(t,Lw.object):[null,void 0]};var Dw=function(t,e){var i=a5(t);return{h:i.h,s:bl(i.s+100*e,0,100),l:i.l,a:i.a}},Fw=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},QP=function(t,e){var i=a5(t);return{h:i.h,s:i.s,l:bl(i.l+100*e,0,100),a:i.a}},Nw=function(){function t(e){this.parsed=vj(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return this.parsed!==null},t.prototype.brightness=function(){return Xn(Fw(this.rgba),2)},t.prototype.isDark=function(){return Fw(this.rgba)<.5},t.prototype.isLight=function(){return Fw(this.rgba)>=.5},t.prototype.toHex=function(){return e=Rw(this.rgba),i=e.r,r=e.g,s=e.b,o=(n=e.a)<1?q8(Xn(255*n)):"","#"+q8(i)+q8(r)+q8(s)+o;var e,i,r,s,n,o},t.prototype.toRgb=function(){return Rw(this.rgba)},t.prototype.toRgbString=function(){return e=Rw(this.rgba),i=e.r,r=e.g,s=e.b,(n=e.a)<1?"rgba("+i+", "+r+", "+s+", "+n+")":"rgb("+i+", "+r+", "+s+")";var e,i,r,s,n},t.prototype.toHsl=function(){return qP(a5(this.rgba))},t.prototype.toHslString=function(){return e=qP(a5(this.rgba)),i=e.h,r=e.s,s=e.l,(n=e.a)<1?"hsla("+i+", "+r+"%, "+s+"%, "+n+")":"hsl("+i+", "+r+"%, "+s+"%)";var e,i,r,s,n},t.prototype.toHsv=function(){return e=eR(this.rgba),{h:Xn(e.h),s:Xn(e.s),v:Xn(e.v),a:Xn(e.a,3)};var e},t.prototype.invert=function(){return qo({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},t.prototype.saturate=function(e){return e===void 0&&(e=.1),qo(Dw(this.rgba,e))},t.prototype.desaturate=function(e){return e===void 0&&(e=.1),qo(Dw(this.rgba,-e))},t.prototype.grayscale=function(){return qo(Dw(this.rgba,-1))},t.prototype.lighten=function(e){return e===void 0&&(e=.1),qo(QP(this.rgba,e))},t.prototype.darken=function(e){return e===void 0&&(e=.1),qo(QP(this.rgba,-e))},t.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},t.prototype.alpha=function(e){return typeof e=="number"?qo({r:(i=this.rgba).r,g:i.g,b:i.b,a:e}):Xn(this.rgba.a,3);var i},t.prototype.hue=function(e){var i=a5(this.rgba);return typeof e=="number"?qo({h:e,s:i.s,l:i.l,a:i.a}):Xn(i.h)},t.prototype.isEqual=function(e){return this.toHex()===qo(e).toHex()},t}(),qo=function(t){return t instanceof Nw?t:new Nw(t)},KP=[],Xf=function(t){t.forEach(function(e){KP.indexOf(e)<0&&(e(Nw,Lw),KP.push(e))})};function Wf(t,e){var i={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var s in i)r[i[s]]=s;var n={};t.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,c=r[this.toHex()];if(c)return c;if(o!=null&&o.closest){var d=this.toRgb(),m=1/0,g="black";if(!n.length)for(var _ in i)n[_]=new t(i[_]).toRgb();for(var v in i){var E=(a=d,l=n[v],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));E<m&&(m=E,g=v)}return g}},e.string.push([function(o){var a=o.toLowerCase(),l=a==="transparent"?"#0000":i[a];return l?new t(l).toRgb():null},"name"])}Xf([Wf]);var qf=class{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof qf)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?di({},t):t}isSourceEqual(t,e){let i=typeof t;if(i!==typeof e)return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((s,n)=>s===e[n]);if(t!==null&&e!==null){let s=Object.keys(t),n=Object.keys(e);return s.length!==n.length?!1:s.every(o=>t[o]===e[o])}return t===e}toRgba(){let[t,e,i,r]=this._components;return{r:t,g:e,b:i,a:r}}toRgb(){let[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){let[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){let[e,i,r]=this._components;return t=t!=null?t:[],t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(r*255),t}toRgbArray(t){t=t!=null?t:[];let[e,i,r]=this._components;return t[0]=e,t[1]=i,t[2]=r,t}toNumber(){return this._int}toLittleEndianNumber(){let t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){let[e,i,r,s]=qf.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=r,this._components[3]*=s,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,r=this._int>>8&255,s=this._int&255;return e&&(i=i*t+.5|0,r=r*t+.5|0,s=s*t+.5|0),(t*255<<24)+(i<<16)+(r<<8)+s}toHex(){let t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){let e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){let[e,i,r]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(r*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t!=null?t:[];let[e,i,r,s]=this._components;return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}normalize(t){let e,i,r,s;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){let n=t;e=(n>>16&255)/255,i=(n>>8&255)/255,r=(n&255)/255,s=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,r,s=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,r,s=255]=t,e/=255,i/=255,r/=255,s/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){let o=qf.HEX_PATTERN.exec(t);o&&(t=`#${o[2]}`)}let n=qo(t);n.isValid()&&({r:e,g:i,b:r,a:s}=n.rgba,e/=255,i/=255,r/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=r,this._components[3]=s,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);let[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach((r,s)=>{t[s]=Math.min(Math.max(r,e),i)}),t)}},Ha=qf;Ha.shared=new qf;Ha.temp=new qf;Ha.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;function iR(t,e=[]){return rr("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),Ha.shared.setValue(t).toRgbArray(e)}function rR(t){return rr("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Ha.shared.setValue(t).toHex()}function sR(t){return rr("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),Ha.shared.setValue(t).toNumber()}function nR(t){return rr("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Ha.shared.setValue(t).toNumber()}function bj(){let t=[],e=[];for(let r=0;r<32;r++)t[r]=r,e[r]=r;t[ki.NORMAL_NPM]=ki.NORMAL,t[ki.ADD_NPM]=ki.ADD,t[ki.SCREEN_NPM]=ki.SCREEN,e[ki.NORMAL]=ki.NORMAL_NPM,e[ki.ADD]=ki.ADD_NPM,e[ki.SCREEN]=ki.SCREEN_NPM;let i=[];return i.push(e),i.push(t),i}var l5=bj();function oR(t,e){return l5[e?1:0][t]}function aR(t,e,i,r=!0){return rr("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),Ha.shared.setValue(t).premultiply(e,r).toArray(i!=null?i:new Float32Array(4))}function lR(t,e){return rr("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),Ha.shared.setValue(t).toPremultiplied(e)}function cR(t,e,i,r=!0){return rr("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),Ha.shared.setValue(t).premultiply(e,r).toArray(i!=null?i:new Float32Array(4))}var Y8=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function uR(t,e=null){let i=t*6;if(e=e||new Uint16Array(i),e.length!==i)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${i}`);for(let r=0,s=0;r<i;r+=6,s+=4)e[r+0]=s+0,e[r+1]=s+1,e[r+2]=s+2,e[r+3]=s+0,e[r+4]=s+2,e[r+5]=s+3;return e}function W1(t){if(t.BYTES_PER_ELEMENT===4)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(t.BYTES_PER_ELEMENT===2){if(t instanceof Uint16Array)return"Uint16Array"}else if(t.BYTES_PER_ELEMENT===1&&t instanceof Uint8Array)return"Uint8Array";return null}var wj={Float32Array,Uint32Array,Int32Array,Uint8Array};function hR(t,e){let i=0,r=0,s={};for(let l=0;l<t.length;l++)r+=e[l],i+=t[l].length;let n=new ArrayBuffer(i*4),o=null,a=0;for(let l=0;l<t.length;l++){let c=e[l],d=t[l],m=W1(d);s[m]||(s[m]=new wj[m](n)),o=s[m];for(let g=0;g<d.length;g++){let _=(g/c|0)*r+a,v=g%c;o[_+v]=d[g]}a+=c}return new Float32Array(n)}function q1(t){return t+=t===0?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t+1}function c5(t){return!(t&t-1)&&!!t}function u5(t){let e=(t>65535?1:0)<<4;t>>>=e;let i=(t>255?1:0)<<3;return t>>>=i,e|=i,i=(t>15?1:0)<<2,t>>>=i,e|=i,i=(t>3?1:0)<<1,t>>>=i,e|=i,e|t>>1}function Z8(t,e,i){let r=t.length,s;if(e>=r||i===0)return;i=e+i>r?r-e:i;let n=r-i;for(s=e;s<n;++s)t[s]=t[s+i];t.length=n}function dR(t){return t===0?0:t<0?-1:1}var Ej=0;function Nc(){return++Ej}var fR=class{constructor(t,e,i,r){this.left=t,this.top=e,this.right=i,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}},Yf=fR;Yf.EMPTY=new fR(0,0,0,0);var h5={},Wn=Object.create(null),Yo=Object.create(null);function pR(){let t;for(t in Wn)Wn[t].destroy();for(t in Yo)Yo[t].destroy()}function mR(){let t;for(t in Wn)delete Wn[t];for(t in Yo)delete Yo[t]}var Q8=class{constructor(e,i,r){this._canvas=ht.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||ht.RESOLUTION,this.resize(e,i)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,i){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(i*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}};function gR(t,e,i){for(let r=0,s=4*i*e;r<e;++r,s+=4)if(t[s+3]!==0)return!1;return!0}function yR(t,e,i,r,s){let n=4*e;for(let o=r,a=r*n+4*i;o<=s;++o,a+=n)if(t[a+3]!==0)return!1;return!0}function K8(t){let{width:e,height:i}=t,r=t.getContext("2d",{willReadFrequently:!0});if(r===null)throw new TypeError("Failed to get canvas 2D context");let n=r.getImageData(0,0,e,i).data,o=0,a=0,l=e-1,c=i-1;for(;a<i&&gR(n,e,a);)++a;if(a===i)return Yf.EMPTY;for(;gR(n,e,c);)--c;for(;yR(n,e,o,a,c);)++o;for(;yR(n,e,l,a,c);)--l;return++l,++c,new Yf(o,a,l,c)}function _R(t){let e=K8(t),{width:i,height:r}=e,s=null;if(!e.isEmpty()){let n=t.getContext("2d");if(n===null)throw new TypeError("Failed to get canvas 2D context");s=n.getImageData(e.left,e.top,i,r)}return{width:i,height:r,data:s}}function xR(t){let e=Y8.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}}var J8;function eg(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location,J8||(J8=document.createElement("a")),J8.href=t;let i=X8.parse(J8.href),r=!i.port&&e.port===""||i.port===e.port;return i.hostname!==e.hostname||!r||i.protocol!==e.protocol?"anonymous":""}function d5(t,e=1){var r;let i=(r=ht.RETINA_PREFIX)==null?void 0:r.exec(t);return i?parseFloat(i[1]):e}Xf([Wf]);var Zf=class{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Zf)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?di({},t):t}isSourceEqual(t,e){let i=typeof t;if(i!==typeof e)return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((s,n)=>s===e[n]);if(t!==null&&e!==null){let s=Object.keys(t),n=Object.keys(e);return s.length!==n.length?!1:s.every(o=>t[o]===e[o])}return t===e}toRgba(){let[t,e,i,r]=this._components;return{r:t,g:e,b:i,a:r}}toRgb(){let[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){let[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){let[e,i,r]=this._components;return t=t!=null?t:[],t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(r*255),t}toRgbArray(t){t=t!=null?t:[];let[e,i,r]=this._components;return t[0]=e,t[1]=i,t[2]=r,t}toNumber(){return this._int}toLittleEndianNumber(){let t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){let[e,i,r,s]=Zf.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=r,this._components[3]*=s,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,r=this._int>>8&255,s=this._int&255;return e&&(i=i*t+.5|0,r=r*t+.5|0,s=s*t+.5|0),(t*255<<24)+(i<<16)+(r<<8)+s}toHex(){let t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){let e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){let[e,i,r]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(r*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t!=null?t:[];let[e,i,r,s]=this._components;return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}normalize(t){let e,i,r,s;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){let n=t;e=(n>>16&255)/255,i=(n>>8&255)/255,r=(n&255)/255,s=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,r,s=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,r,s=255]=t,e/=255,i/=255,r/=255,s/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){let o=Zf.HEX_PATTERN.exec(t);o&&(t=`#${o[2]}`)}let n=qo(t);n.isValid()&&({r:e,g:i,b:r,a:s}=n.rgba,e/=255,i/=255,r/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=r,this._components[3]=s,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);let[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach((r,s)=>{t[s]=Math.min(Math.max(r,e),i)}),t)}},mi=Zf;mi.shared=new Zf;mi.temp=new Zf;mi.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;var gt=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(gt||{}),Ow=t=>{if(typeof t=="function"||typeof t=="object"&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");let e=typeof t.extension!="object"?{type:t.extension}:t.extension;t=Tn(di({},e),{ref:t})}if(typeof t=="object")t=di({},t);else throw new Error("Invalid extension type");return typeof t.type=="string"&&(t.type=[t.type]),t},bR=(t,e)=>{var i;return(i=Ow(t).priority)!=null?i:e},Tt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(Ow).forEach(e=>{e.type.forEach(i=>{var r,s;return(s=(r=this._removeHandlers)[i])==null?void 0:s.call(r,e)})}),this},add(...t){return t.map(Ow).forEach(e=>{e.type.forEach(i=>{let r=this._addHandlers,s=this._queue;r[i]?r[i](e):(s[i]=s[i]||[],s[i].push(e))})}),this},handle(t,e,i){let r=this._addHandlers,s=this._removeHandlers;if(r[t]||s[t])throw new Error(`Extension type ${t} already has a handler`);r[t]=e,s[t]=i;let n=this._queue;return n[t]&&(n[t].forEach(o=>e(o)),delete n[t]),this},handleByMap(t,e){return this.handle(t,i=>{e[i.name]=i.ref},i=>{delete e[i.name]})},handleByList(t,e,i=-1){return this.handle(t,r=>{e.includes(r.ref)||(e.push(r.ref),e.sort((s,n)=>bR(n,i)-bR(s,i)))},r=>{let s=e.indexOf(r.ref);s!==-1&&e.splice(s,1)})}};var Y1=class{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}};var Tj=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Sj(t){let e="";for(let i=0;i<t;++i)i>0&&(e+=`
else `),i<t-1&&(e+=`if(test == ${i}.0){}`);return e}function tg(t,e){if(t===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");let i=e.createShader(e.FRAGMENT_SHADER);for(;;){let r=Tj.replace(/%forloop%/gi,Sj(t));if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))t=t/2|0;else break}return t}var Bw=0,Uw=1,zw=2,Gw=3,$w=4,Hw=5,ro=class t{constructor(){this.data=0,this.blendMode=ki.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Bw)}set blend(e){!!(this.data&1<<Bw)!==e&&(this.data^=1<<Bw)}get offsets(){return!!(this.data&1<<Uw)}set offsets(e){!!(this.data&1<<Uw)!==e&&(this.data^=1<<Uw)}get culling(){return!!(this.data&1<<zw)}set culling(e){!!(this.data&1<<zw)!==e&&(this.data^=1<<zw)}get depthTest(){return!!(this.data&1<<Gw)}set depthTest(e){!!(this.data&1<<Gw)!==e&&(this.data^=1<<Gw)}get depthMask(){return!!(this.data&1<<Hw)}set depthMask(e){!!(this.data&1<<Hw)!==e&&(this.data^=1<<Hw)}get clockwiseFrontFace(){return!!(this.data&1<<$w)}set clockwiseFrontFace(e){!!(this.data&1<<$w)!==e&&(this.data^=1<<$w)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==ki.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){let e=new t;return e.depthTest=!1,e.blend=!0,e}};var Qf=[];function Kf(t,e){if(!t)return null;let i="";if(typeof t=="string"){let r=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);r&&(i=r[1].toLowerCase())}for(let r=Qf.length-1;r>=0;--r){let s=Qf[r];if(s.test&&s.test(t,i))return new s(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}var fn=class{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,i,r,s,n,o,a,l){if(arguments.length>8)throw new Error("max arguments reached");let{name:c,items:d}=this;this._aliasCount++;for(let m=0,g=d.length;m<g;m++)d[m][c](e,i,r,s,n,o,a,l);return d===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){let i=this.items.indexOf(e);return i!==-1&&(this.ensureNonAliasedItems(),this.items.splice(i,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}};Object.defineProperties(fn.prototype,{dispatch:{value:fn.prototype.emit},run:{value:fn.prototype.emit}});var Zo=class{constructor(e=0,i=0){this._width=e,this._height=i,this.destroyed=!1,this.internal=!1,this.onResize=new fn("setRealSize"),this.onUpdate=new fn("update"),this.onError=new fn("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,i){(e!==this._width||i!==this._height)&&(this._width=e,this._height=i,this.onResize.emit(e,i))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,i,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,i){return!1}};var va=class extends Zo{constructor(e,i){let{width:r,height:s}=i||{};if(!r||!s)throw new Error("BufferResource width or height invalid");super(r,s),this.data=e}upload(e,i,r){let s=e.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===tn.UNPACK);let n=i.realWidth,o=i.realHeight;return r.width===n&&r.height===o?s.texSubImage2D(i.target,0,0,0,n,o,i.format,r.type,this.data):(r.width=n,r.height=o,s.texImage2D(i.target,0,r.internalFormat,n,o,0,i.format,r.type,this.data)),!0}dispose(){this.data=null}static test(e){return e instanceof Float32Array||e instanceof Uint8Array||e instanceof Uint32Array}};var Aj={scaleMode:io.NEAREST,format:zt.RGBA,alphaMode:tn.NPM},Jf=class extends sn.default{constructor(t=null,e=null){super(),e=Object.assign({},Jf.defaultOptions,e);let{alphaMode:i,mipmap:r,anisotropicLevel:s,scaleMode:n,width:o,height:a,wrapMode:l,format:c,type:d,target:m,resolution:g,resourceOptions:_}=e;t&&!(t instanceof Zo)&&(t=Kf(t,_),t.internal=!0),this.resolution=g||ht.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=s,this._wrapMode=l,this._scaleMode=n,this.format=c,this.type=d,this.target=m,this.alphaMode=i,this.uid=Nc(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=c5(this.realWidth)&&c5(this.realHeight)}setResolution(t){let e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Yo[this.cacheId],delete Wn[this.cacheId],this.cacheId=null),this.dispose(),Jf.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,i=ht.STRICT_TEXTURE_CACHE){let r=typeof t=="string",s=null;if(r)s=t;else{if(!t._pixiId){let o=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${o}_${Nc()}`}s=t._pixiId}let n=Yo[s];if(r&&i&&!n)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return n||(n=new Jf(t,e),n.cacheId=s,Jf.addToCache(n,s)),n}static fromBuffer(t,e,i,r){t=t||new Float32Array(e*i*4);let s=new va(t,{width:e,height:i}),n=t instanceof Float32Array?yi.FLOAT:yi.UNSIGNED_BYTE;return new Jf(s,Object.assign({},Aj,{type:n},r))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Yo[e]&&Yo[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Yo[e]=t)}static removeFromCache(t){if(typeof t=="string"){let e=Yo[t];if(e){let i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Yo[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Yo[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}},ui=Jf;ui.defaultOptions={mipmap:An.POW2,anisotropicLevel:0,scaleMode:io.LINEAR,wrapMode:_a.CLAMP,alphaMode:tn.UNPACK,target:Du.TEXTURE_2D,format:zt.RGBA,type:yi.UNSIGNED_BYTE};ui._globalBatch=0;var Z1=class{constructor(){this.texArray=null,this.blend=0,this.type=ya.TRIANGLES,this.start=0,this.size=0,this.data=null}};var Cj=0,is=class t{constructor(e,i=!0,r=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=i,this.id=Cj++,this.disposeRunner=new fn("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?xa.ELEMENT_ARRAY_BUFFER:xa.ARRAY_BUFFER}get index(){return this.type===xa.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new t(e)}};var e2=class t{constructor(e,i=0,r=!1,s=yi.FLOAT,n,o,a,l=1){this.buffer=e,this.size=i,this.normalized=r,this.type=s,this.stride=n,this.start=o,this.instance=a,this.divisor=l}destroy(){this.buffer=null}static from(e,i,r,s,n){return new t(e,i,r,s,n)}};var Ij={Float32Array,Uint32Array,Int32Array,Uint8Array};function wR(t,e){let i=0,r=0,s={};for(let l=0;l<t.length;l++)r+=e[l],i+=t[l].length;let n=new ArrayBuffer(i*4),o=null,a=0;for(let l=0;l<t.length;l++){let c=e[l],d=t[l],m=W1(d);s[m]||(s[m]=new Ij[m](n)),o=s[m];for(let g=0;g<d.length;g++){let _=(g/c|0)*r+a,v=g%c;o[_+v]=d[g]}a+=c}return new Float32Array(n)}var ER={5126:4,5123:2,5121:1},kj=0,Mj={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},Qo=class t{constructor(e=[],i={}){this.buffers=e,this.indexBuffer=null,this.attributes=i,this.glVertexArrayObjects={},this.id=kj++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new fn("disposeGeometry"),this.refCount=0}addAttribute(e,i,r=0,s=!1,n,o,a,l=!1){if(!i)throw new Error("You must pass a buffer when creating an attribute");i instanceof is||(i instanceof Array&&(i=new Float32Array(i)),i=new is(i));let c=e.split("|");if(c.length>1){for(let m=0;m<c.length;m++)this.addAttribute(c[m],i,r,s,n);return this}let d=this.buffers.indexOf(i);return d===-1&&(this.buffers.push(i),d=this.buffers.length-1),this.attributes[e]=new e2(d,r,s,n,o,a,l),this.instanced=this.instanced||l,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof is||(e instanceof Array&&(e=new Uint16Array(e)),e=new is(e)),e.type=xa.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;let e=[],i=[],r=new is,s;for(s in this.attributes){let n=this.attributes[s],o=this.buffers[n.buffer];e.push(o.data),i.push(n.size*ER[n.type]/4),n.buffer=0}for(r.data=wR(e,i),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(let e in this.attributes){let i=this.attributes[e];return this.buffers[i.buffer].data.length/(i.stride/4||i.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){let e=new t;for(let i=0;i<this.buffers.length;i++)e.buffers[i]=new is(this.buffers[i].data.slice(0));for(let i in this.attributes){let r=this.attributes[i];e.attributes[i]=new e2(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=xa.ELEMENT_ARRAY_BUFFER),e}static merge(e){let i=new t,r=[],s=[],n=[],o;for(let a=0;a<e.length;a++){o=e[a];for(let l=0;l<o.buffers.length;l++)s[l]=s[l]||0,s[l]+=o.buffers[l].data.length,n[l]=0}for(let a=0;a<o.buffers.length;a++)r[a]=new Mj[W1(o.buffers[a].data)](s[a]),i.buffers[a]=new is(r[a]);for(let a=0;a<e.length;a++){o=e[a];for(let l=0;l<o.buffers.length;l++)r[l].set(o.buffers[l].data,n[l]),n[l]+=o.buffers[l].data.length}if(i.attributes=o.attributes,o.indexBuffer){i.indexBuffer=i.buffers[o.buffers.indexOf(o.indexBuffer)],i.indexBuffer.type=xa.ELEMENT_ARRAY_BUFFER;let a=0,l=0,c=0,d=0;for(let m=0;m<o.buffers.length;m++)if(o.buffers[m]!==o.indexBuffer){d=m;break}for(let m in o.attributes){let g=o.attributes[m];(g.buffer|0)===d&&(l+=g.size*ER[g.type]/4)}for(let m=0;m<e.length;m++){let g=e[m].indexBuffer.data;for(let _=0;_<g.length;_++)i.indexBuffer.data[_+c]+=a;a+=e[m].buffers[d].data.length/l,c+=g.length}}return i}};var hd=class extends Qo{constructor(e=!1){super(),this._buffer=new is(null,e,!1),this._indexBuffer=new is(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,yi.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,yi.FLOAT).addAttribute("aColor",this._buffer,4,!0,yi.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,yi.FLOAT).addIndex(this._indexBuffer)}};var Q1=Math.PI*2,Vw=180/Math.PI,ic=Math.PI/180,cs=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(cs||{});var ei=class t{constructor(e=0,i=0){this.x=0,this.y=0,this.x=e,this.y=i}clone(){return new t(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,i=e){return this.x=e,this.y=i,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}};var ig=[new ei,new ei,new ei,new ei],ri=class t{constructor(e=0,i=0,r=0,s=0){this.x=Number(e),this.y=Number(i),this.width=Number(r),this.height=Number(s),this.type=cs.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new t(0,0,0,0)}clone(){return new t(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,i){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&i>=this.y&&i<this.y+this.height}intersects(e,i){if(!i){let U=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=U)return!1;let Z=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>Z}let r=this.left,s=this.right,n=this.top,o=this.bottom;if(s<=r||o<=n)return!1;let a=ig[0].set(e.left,e.top),l=ig[1].set(e.left,e.bottom),c=ig[2].set(e.right,e.top),d=ig[3].set(e.right,e.bottom);if(c.x<=a.x||l.y<=a.y)return!1;let m=Math.sign(i.a*i.d-i.b*i.c);if(m===0||(i.apply(a,a),i.apply(l,l),i.apply(c,c),i.apply(d,d),Math.max(a.x,l.x,c.x,d.x)<=r||Math.min(a.x,l.x,c.x,d.x)>=s||Math.max(a.y,l.y,c.y,d.y)<=n||Math.min(a.y,l.y,c.y,d.y)>=o))return!1;let g=m*(l.y-a.y),_=m*(a.x-l.x),v=g*r+_*n,E=g*s+_*n,b=g*r+_*o,T=g*s+_*o;if(Math.max(v,E,b,T)<=g*a.x+_*a.y||Math.min(v,E,b,T)>=g*d.x+_*d.y)return!1;let A=m*(a.y-c.y),M=m*(c.x-a.x),k=A*r+M*n,F=A*s+M*n,O=A*r+M*o,B=A*s+M*o;return!(Math.max(k,F,O,B)<=A*a.x+M*a.y||Math.min(k,F,O,B)>=A*d.x+M*d.y)}pad(e=0,i=e){return this.x-=e,this.y-=i,this.width+=e*2,this.height+=i*2,this}fit(e){let i=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),s=Math.max(this.y,e.y),n=Math.min(this.y+this.height,e.y+e.height);return this.x=i,this.width=Math.max(r-i,0),this.y=s,this.height=Math.max(n-s,0),this}ceil(e=1,i=.001){let r=Math.ceil((this.x+this.width-i)*e)/e,s=Math.ceil((this.y+this.height-i)*e)/e;return this.x=Math.floor((this.x+i)*e)/e,this.y=Math.floor((this.y+i)*e)/e,this.width=r-this.x,this.height=s-this.y,this}enlarge(e){let i=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),s=Math.min(this.y,e.y),n=Math.max(this.y+this.height,e.y+e.height);return this.x=i,this.width=r-i,this.y=s,this.height=n-s,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}};var K1=class t{constructor(e=0,i=0,r=0){this.x=e,this.y=i,this.radius=r,this.type=cs.CIRC}clone(){return new t(this.x,this.y,this.radius)}contains(e,i){if(this.radius<=0)return!1;let r=this.radius*this.radius,s=this.x-e,n=this.y-i;return s*=s,n*=n,s+n<=r}getBounds(){return new ri(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}};var f5=class t{constructor(e=0,i=0,r=0,s=0){this.x=e,this.y=i,this.width=r,this.height=s,this.type=cs.ELIP}clone(){return new t(this.x,this.y,this.width,this.height)}contains(e,i){if(this.width<=0||this.height<=0)return!1;let r=(e-this.x)/this.width,s=(i-this.y)/this.height;return r*=r,s*=s,r+s<=1}getBounds(){return new ri(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}};var so=class t{constructor(...e){let i=Array.isArray(e[0])?e[0]:e;if(typeof i[0]!="number"){let r=[];for(let s=0,n=i.length;s<n;s++)r.push(i[s].x,i[s].y);i=r}this.points=i,this.type=cs.POLY,this.closeStroke=!0}clone(){let e=this.points.slice(),i=new t(e);return i.closeStroke=this.closeStroke,i}contains(e,i){let r=!1,s=this.points.length/2;for(let n=0,o=s-1;n<s;o=n++){let a=this.points[n*2],l=this.points[n*2+1],c=this.points[o*2],d=this.points[o*2+1];l>i!=d>i&&e<(c-a)*((i-l)/(d-l))+a&&(r=!r)}return r}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((e,i)=>`${e}, ${i}`,"")}]`}};var p5=class t{constructor(e=0,i=0,r=0,s=0,n=20){this.x=e,this.y=i,this.width=r,this.height=s,this.radius=n,this.type=cs.RREC}clone(){return new t(this.x,this.y,this.width,this.height,this.radius)}contains(e,i){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&i>=this.y&&i<=this.y+this.height){let r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(i>=this.y+r&&i<=this.y+this.height-r||e>=this.x+r&&e<=this.x+this.width-r)return!0;let s=e-(this.x+r),n=i-(this.y+r),o=r*r;if(s*s+n*n<=o||(s=e-(this.x+this.width-r),s*s+n*n<=o)||(n=i-(this.y+this.height-r),s*s+n*n<=o)||(s=e-(this.x+r),s*s+n*n<=o))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}};var fr=class t{constructor(e=1,i=0,r=0,s=1,n=0,o=0){this.array=null,this.a=e,this.b=i,this.c=r,this.d=s,this.tx=n,this.ty=o}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,i,r,s,n,o){return this.a=e,this.b=i,this.c=r,this.d=s,this.tx=n,this.ty=o,this}toArray(e,i){this.array||(this.array=new Float32Array(9));let r=i||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(e,i){i=i||new ei;let r=e.x,s=e.y;return i.x=this.a*r+this.c*s+this.tx,i.y=this.b*r+this.d*s+this.ty,i}applyInverse(e,i){i=i||new ei;let r=1/(this.a*this.d+this.c*-this.b),s=e.x,n=e.y;return i.x=this.d*r*s+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,i.y=this.a*r*n+-this.b*r*s+(-this.ty*this.a+this.tx*this.b)*r,i}translate(e,i){return this.tx+=e,this.ty+=i,this}scale(e,i){return this.a*=e,this.d*=i,this.c*=e,this.b*=i,this.tx*=e,this.ty*=i,this}rotate(e){let i=Math.cos(e),r=Math.sin(e),s=this.a,n=this.c,o=this.tx;return this.a=s*i-this.b*r,this.b=s*r+this.b*i,this.c=n*i-this.d*r,this.d=n*r+this.d*i,this.tx=o*i-this.ty*r,this.ty=o*r+this.ty*i,this}append(e){let i=this.a,r=this.b,s=this.c,n=this.d;return this.a=e.a*i+e.b*s,this.b=e.a*r+e.b*n,this.c=e.c*i+e.d*s,this.d=e.c*r+e.d*n,this.tx=e.tx*i+e.ty*s+this.tx,this.ty=e.tx*r+e.ty*n+this.ty,this}setTransform(e,i,r,s,n,o,a,l,c){return this.a=Math.cos(a+c)*n,this.b=Math.sin(a+c)*n,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=e-(r*this.a+s*this.c),this.ty=i-(r*this.b+s*this.d),this}prepend(e){let i=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){let r=this.a,s=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=s*e.a+this.d*e.c,this.d=s*e.b+this.d*e.d}return this.tx=i*e.a+this.ty*e.c+e.tx,this.ty=i*e.b+this.ty*e.d+e.ty,this}decompose(e){let i=this.a,r=this.b,s=this.c,n=this.d,o=e.pivot,a=-Math.atan2(-s,n),l=Math.atan2(r,i),c=Math.abs(a+l);return c<1e-5||Math.abs(Q1-c)<1e-5?(e.rotation=l,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=a,e.skew.y=l),e.scale.x=Math.sqrt(i*i+r*r),e.scale.y=Math.sqrt(s*s+n*n),e.position.x=this.tx+(o.x*i+o.y*s),e.position.y=this.ty+(o.x*r+o.y*n),e}invert(){let e=this.a,i=this.b,r=this.c,s=this.d,n=this.tx,o=e*s-i*r;return this.a=s/o,this.b=-i/o,this.c=-r/o,this.d=e/o,this.tx=(r*this.ty-s*n)/o,this.ty=-(e*this.ty-i*n)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){let e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new t}static get TEMP_MATRIX(){return new t}};var dd=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],fd=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],pd=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],md=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],jw=[],TR=[],rg=Math.sign;function Pj(){for(let t=0;t<16;t++){let e=[];jw.push(e);for(let i=0;i<16;i++){let r=rg(dd[t]*dd[i]+pd[t]*fd[i]),s=rg(fd[t]*dd[i]+md[t]*fd[i]),n=rg(dd[t]*pd[i]+pd[t]*md[i]),o=rg(fd[t]*pd[i]+md[t]*md[i]);for(let a=0;a<16;a++)if(dd[a]===r&&fd[a]===s&&pd[a]===n&&md[a]===o){e.push(a);break}}}for(let t=0;t<16;t++){let e=new fr;e.set(dd[t],fd[t],pd[t],md[t],0,0),TR.push(e)}}Pj();var Es={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>dd[t],uY:t=>fd[t],vX:t=>pd[t],vY:t=>md[t],inv:t=>t&8?t&15:-t&7,add:(t,e)=>jw[t][e],sub:(t,e)=>jw[t][Es.inv(e)],rotate180:t=>t^4,isVertical:t=>(t&3)===2,byDirection:(t,e)=>Math.abs(t)*2<=Math.abs(e)?e>=0?Es.S:Es.N:Math.abs(e)*2<=Math.abs(t)?t>0?Es.E:Es.W:e>0?t>0?Es.SE:Es.SW:t>0?Es.NE:Es.NW,matrixAppendRotationInv:(t,e,i=0,r=0)=>{let s=TR[Es.inv(e)];s.tx=i,s.ty=r,t.append(s)}};var Ko=class t{constructor(e,i,r=0,s=0){this._x=r,this._y=s,this.cb=e,this.scope=i}clone(e=this.cb,i=this.scope){return new t(e,i,this._x,this._y)}set(e=0,i=e){return(this._x!==e||this._y!==i)&&(this._x=e,this._y=i,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}};var SR=class{constructor(){this.worldTransform=new fr,this.localTransform=new fr,this.position=new Ko(this.onChange,this,0,0),this.scale=new Ko(this.onChange,this,1,1),this.pivot=new Ko(this.onChange,this,0,0),this.skew=new Ko(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){let t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){let e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){let i=t.worldTransform,r=this.worldTransform;r.a=e.a*i.a+e.b*i.c,r.b=e.a*i.b+e.b*i.d,r.c=e.c*i.a+e.d*i.c,r.d=e.c*i.b+e.d*i.d,r.tx=e.tx*i.a+e.ty*i.c+i.tx,r.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}},gd=SR;gd.IDENTITY=new SR;var AR=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`;var CR=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function sg(t,e,i){let r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}function Xw(t){let e=new Array(t);for(let i=0;i<e.length;i++)e[i]=!1;return e}function m5(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return Xw(2*e);case"bvec3":return Xw(3*e);case"bvec4":return Xw(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var Oc=[{test:t=>t.type==="float"&&t.size===1&&!t.isArray,code:t=>`
            if(uv["${t}"] !== ud["${t}"].value)
            {
                ud["${t}"].value = uv["${t}"]
                gl.uniform1f(ud["${t}"].location, uv["${t}"])
            }
            `},{test:(t,e)=>(t.type==="sampler2D"||t.type==="samplerCube"||t.type==="sampler2DArray")&&t.size===1&&!t.isArray&&(e==null||e.castToBaseTexture!==void 0),code:t=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${t}"], t);

            if(ud["${t}"].value !== t)
            {
                ud["${t}"].value = t;
                gl.uniform1i(ud["${t}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(t,e)=>t.type==="mat3"&&t.size===1&&!t.isArray&&e.a!==void 0,code:t=>`
            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));
            `,codeUbo:t=>`
                var ${t}_matrix = uv.${t}.toArray(true);

                data[offset] = ${t}_matrix[0];
                data[offset+1] = ${t}_matrix[1];
                data[offset+2] = ${t}_matrix[2];
        
                data[offset + 4] = ${t}_matrix[3];
                data[offset + 5] = ${t}_matrix[4];
                data[offset + 6] = ${t}_matrix[5];
        
                data[offset + 8] = ${t}_matrix[6];
                data[offset + 9] = ${t}_matrix[7];
                data[offset + 10] = ${t}_matrix[8];
            `},{test:(t,e)=>t.type==="vec2"&&t.size===1&&!t.isArray&&e.x!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${t}"].location, v.x, v.y);
                }`,codeUbo:t=>`
                v = uv.${t};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:t=>t.type==="vec2"&&t.size===1&&!t.isArray,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);
                }
            `},{test:(t,e)=>t.type==="vec4"&&t.size===1&&!t.isArray&&e.width!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:t=>`
                    v = uv.${t};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(t,e)=>t.type==="vec4"&&t.size===1&&!t.isArray&&e.red!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:t=>`
                    v = uv.${t};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(t,e)=>t.type==="vec3"&&t.size===1&&!t.isArray&&e.red!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)
                }`,codeUbo:t=>`
                    v = uv.${t};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:t=>t.type==="vec4"&&t.size===1&&!t.isArray,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])
                }`}];var Rj={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},Dj={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function Ww(t,e){var r;let i=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(let s in t.uniforms){let n=e[s];if(!n){(r=t.uniforms[s])!=null&&r.group&&(t.uniforms[s].ubo?i.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${s}, '${s}');
                    `):i.push(`
                        renderer.shader.syncUniformGroup(uv.${s}, syncData);
                    `));continue}let o=t.uniforms[s],a=!1;for(let l=0;l<Oc.length;l++)if(Oc[l].test(n,o)){i.push(Oc[l].code(s,o)),a=!0;break}if(!a){let c=(n.size===1&&!n.isArray?Rj:Dj)[n.type].replace("location",`ud["${s}"].location`);i.push(`
            cu = ud["${s}"];
            cv = cu.value;
            v = uv["${s}"];
            ${c};`)}}return new Function("ud","uv","renderer","syncData",i.join(`
`))}var IR={},t2=IR;function ng(){if(t2===IR||t2!=null&&t2.isContextLost()){let t=ht.ADAPTER.createCanvas(),e;ht.PREFER_ENV>=jo.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),t2=e}return t2}var og;function qw(){if(!og){og=Xo.MEDIUM;let t=ng();t&&t.getShaderPrecisionFormat&&(og=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision?Xo.HIGH:Xo.MEDIUM)}return og}function kR(t,e){let i=t.getShaderSource(e).split(`
`).map((c,d)=>`${d}: ${c}`),r=t.getShaderInfoLog(e),s=r.split(`
`),n={},o=s.map(c=>parseFloat(c.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(c=>c&&!n[c]?(n[c]=!0,!0):!1),a=[""];o.forEach(c=>{i[c-1]=`%c${i[c-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});let l=i.join(`
`);a[0]=l,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function Yw(t,e,i,r){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(i,t.COMPILE_STATUS)||kR(t,i),t.getShaderParameter(r,t.COMPILE_STATUS)||kR(t,r),console.error("PixiJS Error: Could not initialize shader."),t.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}var Fj={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function g5(t){return Fj[t]}var ag=null,MR={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function y5(t,e){if(!ag){let i=Object.keys(MR);ag={};for(let r=0;r<i.length;++r){let s=i[r];ag[t[s]]=MR[s]}}return ag[e]}function lg(t,e,i){if(t.substring(0,9)!=="precision"){let r=e;return e===Xo.HIGH&&i!==Xo.HIGH&&(r=Xo.MEDIUM),`precision ${r} float;
${t}`}else if(i!==Xo.HIGH&&t.substring(0,15)==="precision highp")return t.replace("precision highp","precision mediump");return t}var _5;function cg(){if(typeof _5=="boolean")return _5;try{_5=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch(t){_5=!1}return _5}var Lj=0,ug={},i2=class{constructor(t,e,i="pixi-shader",r={}){this.extra={},this.id=Lj++,this.vertexSrc=t||i2.defaultVertexSrc,this.fragmentSrc=e||i2.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=r,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),ug[i]?(ug[i]++,i+=`-${ug[i]}`):ug[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=lg(this.vertexSrc,i2.defaultVertexPrecision,Xo.HIGH),this.fragmentSrc=lg(this.fragmentSrc,i2.defaultFragmentPrecision,qw())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return CR}static get defaultFragmentSrc(){return AR}static from(t,e,i){let r=t+e,s=h5[r];return s||(h5[r]=s=new i2(t,e,i)),s}},qn=i2;qn.defaultVertexPrecision=Xo.HIGH;qn.defaultFragmentPrecision=xl.apple.device?Xo.HIGH:Xo.MEDIUM;var Nj=0,Jo=class t{constructor(e,i,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Nj++,this.static=!!i,this.ubo=!!r,e instanceof is?(this.buffer=e,this.buffer.type=xa.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new is(new Float32Array(1)),this.buffer.type=xa.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,i,r){if(!this.ubo)this.uniforms[e]=new t(i,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(e,i,r){return new t(e,i,r)}static uboFrom(e,i){return new t(e,i!=null?i:!0,!0)}};var no=class t{constructor(e,i){this.uniformBindCount=0,this.program=e,i?i instanceof Jo?this.uniformGroup=i:this.uniformGroup=new Jo(i):this.uniformGroup=new Jo({}),this.disposeRunner=new fn("disposeShader")}checkUniformExists(e,i){if(i.uniforms[e])return!0;for(let r in i.uniforms){let s=i.uniforms[r];if(s.group&&this.checkUniformExists(e,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,i,r){let s=qn.from(e,i);return new t(s,r)}};var x5=class{constructor(e,i){if(this.vertexSrc=e,this.fragTemplate=i,this.programCache={},this.defaultGroupCache={},!i.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!i.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){let r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=n;this.defaultGroupCache[e]=Jo.from({uSamplers:r},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${e}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new qn(this.vertexSrc,s)}let i={tint:new Float32Array([1,1,1,1]),translationMatrix:new fr,default:this.defaultGroupCache[e]};return new no(this.programCache[e],i)}generateSampleSrc(e){let i="";i+=`
`,i+=`
`;for(let r=0;r<e;r++)r>0&&(i+=`
else `),r<e-1&&(i+=`if(vTextureId < ${r}.5)`),i+=`
{`,i+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,i+=`
}`;return i+=`
`,i+=`
`,i}};var J1=class{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}};function PR(){return!xl.apple.device}function RR(t){let e=!0,i=ht.ADAPTER.getNavigator();if(xl.tablet||xl.phone){if(xl.apple.device){let r=i.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(e=!1)}if(xl.android.device){let r=i.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(e=!1)}}return e?t:4}var rc=class{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}};var DR=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`;var FR=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;var sc=class extends rc{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=hd,this.vertexSize=6,this.state=ro.for2d(),this.size=sc.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){var t;return this._defaultMaxTextures=(t=this._defaultMaxTextures)!=null?t:RR(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){var t;return this._canUploadSameBuffer=(t=this._canUploadSameBuffer)!=null?t:PR(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return rr("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return FR}static get defaultFragmentTemplate(){return DR}setShaderGenerator({vertex:t=sc.defaultVertexSrc,fragment:e=sc.defaultFragmentTemplate}={}){this.shaderGenerator=new x5(t,e)}contextChange(){let t=this.renderer.gl;ht.PREFER_ENV===jo.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),sc.defaultMaxTextures),this.maxTextures=tg(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){let{_drawCallPool:t,_textureArrayPool:e}=sc,i=this.size/4,r=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new Z1);for(;e.length<r;)e.push(new J1);for(let s=0;s<this.maxTextures;s++)this._tempBoundTextures[s]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){let{_bufferedTextures:t,maxTextures:e}=this,i=sc._textureArrayPool,r=this.renderer.batch,s=this._tempBoundTextures,n=this.renderer.textureGC.count,o=++ui._globalBatch,a=0,l=i[0],c=0;r.copyBoundTextures(s,e);for(let d=0;d<this._bufferSize;++d){let m=t[d];t[d]=null,m._batchEnabled!==o&&(l.count>=e&&(r.boundArray(l,s,o,e),this.buildDrawCalls(l,c,d),c=d,l=i[++a],++o),m._batchEnabled=o,m.touched=n,l.elements[l.count++]=m)}l.count>0&&(r.boundArray(l,s,o,e),this.buildDrawCalls(l,c,this._bufferSize),++a,++o);for(let d=0;d<s.length;d++)s[d]=null;ui._globalBatch=o}buildDrawCalls(t,e,i){let{_bufferedElements:r,_attributeBuffer:s,_indexBuffer:n,vertexSize:o}=this,a=sc._drawCallPool,l=this._dcIndex,c=this._aIndex,d=this._iIndex,m=a[l];m.start=this._iIndex,m.texArray=t;for(let g=e;g<i;++g){let _=r[g],v=_._texture.baseTexture,E=l5[v.alphaMode?1:0][_.blendMode];r[g]=null,e<g&&m.blend!==E&&(m.size=d-m.start,e=g,m=a[++l],m.texArray=t,m.start=d),this.packInterleavedGeometry(_,s,n,c,d),c+=_.vertexData.length/2*o,d+=_.indices.length,m.blend=E}e<i&&(m.size=d-m.start,++l),this._dcIndex=l,this._aIndex=c,this._iIndex=d}bindAndClearTexArray(t){let e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){let{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:i}=this;sc.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){let t=this._dcIndex,{gl:e,state:i}=this.renderer,r=sc._drawCallPool,s=null;for(let n=0;n<t;n++){let{texArray:o,type:a,size:l,start:c,blend:d}=r[n];s!==o&&(s=o,this.bindAndClearTexArray(o)),this.state.blendMode=d,i.set(this.state),e.drawElements(a,l,e.UNSIGNED_SHORT,c*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),sc.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){let e=q1(Math.ceil(t/8)),i=u5(e),r=e*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._aBuffers[r];return s||(this._aBuffers[r]=s=new Y1(r*this.vertexSize*4)),s}getIndexBuffer(t){let e=q1(Math.ceil(t/12)),i=u5(e),r=e*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._iBuffers[i];return s||(this._iBuffers[i]=s=new Uint16Array(r)),s}packInterleavedGeometry(t,e,i,r,s){let{uint32View:n,float32View:o}=e,a=r/this.vertexSize,l=t.uvs,c=t.indices,d=t.vertexData,m=t._texture.baseTexture._batchLocation,g=Math.min(t.worldAlpha,1),_=mi.shared.setValue(t._tintRGB).toPremultiplied(g,t._texture.baseTexture.alphaMode>0);for(let v=0;v<d.length;v+=2)o[r++]=d[v],o[r++]=d[v+1],o[r++]=l[v],o[r++]=l[v+1],n[r++]=_,o[r++]=m;for(let v=0;v<c.length;v++)i[s++]=a+c[v]}},Va=sc;Va.defaultBatchSize=4096;Va.extension={name:"batch",type:gt.RendererPlugin};Va._drawCallPool=[];Va._textureArrayPool=[];Tt.add(Va);var LR=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`;var NR=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var v5=class extends no{constructor(t,e,i){let r=qn.from(t||v5.defaultVertexSrc,e||v5.defaultFragmentSrc);super(r,i),this.padding=0,this.resolution=v5.defaultResolution,this.multisample=v5.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new ro}apply(t,e,i,r,s){t.applyFilter(this,e,i,r)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return NR}static get defaultFragmentSrc(){return LR}},Wt=v5;Wt.defaultResolution=1;Wt.defaultMultisample=Zr.NONE;var Nu=class{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new mi(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;let{backgroundColor:i,background:r,backgroundAlpha:s}=e,n=r!=null?r:i;n!==void 0&&(this.color=n),this.alpha=s}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}};Nu.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};Nu.extension={type:[gt.RendererSystem,gt.CanvasRendererSystem],name:"background"};Tt.add(Nu);var r2=class{constructor(e){this.renderer=e,this.emptyRenderer=new rc(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,i){let{boundTextures:r}=this.renderer.texture;for(let s=i-1;s>=0;--s)e[s]=r[s]||null,e[s]&&(e[s]._batchLocation=s)}boundArray(e,i,r,s){let{elements:n,ids:o,count:a}=e,l=0;for(let c=0;c<a;c++){let d=n[c],m=d._batchLocation;if(m>=0&&m<s&&i[m]===d){o[c]=m;continue}for(;l<s;){let g=i[l];if(g&&g._batchEnabled===r&&g._batchLocation===l){l++;continue}o[c]=l,d._batchLocation=l,i[l]=d;break}}}destroy(){this.renderer=null}};r2.extension={type:gt.RendererSystem,name:"batch"};Tt.add(r2);var OR=0,Ou=class{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=OR++}init(e){if(e.context)this.initFromContext(e.context);else{let i=this.renderer.background.alpha<1,r=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:i,premultipliedAlpha:r,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=OR++,this.renderer.runners.contextChange.emit(e);let i=this.renderer.view;i.addEventListener!==void 0&&(i.addEventListener("webglcontextlost",this.handleContextLost,!1),i.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){let i=this.createContext(this.renderer.view,e);this.initFromContext(i)}createContext(e,i){let r;if(ht.PREFER_ENV>=jo.WEBGL2&&(r=e.getContext("webgl2",i)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=e.getContext("webgl",i)||e.getContext("experimental-webgl",i),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){let{gl:e}=this,i={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,i,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,i,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){let e=this.renderer.view;this.renderer=null,e.removeEventListener!==void 0&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){let i=e.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),i&&!i.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");let s=r||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}};Ou.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"};Ou.extension={type:gt.RendererSystem,name:"context"};Tt.add(Ou);var hg=class extends va{upload(e,i,r){let s=e.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===tn.UNPACK);let n=i.realWidth,o=i.realHeight;return r.width===n&&r.height===o?s.texSubImage2D(i.target,0,0,0,n,o,i.format,r.type,this.data):(r.width=n,r.height=o,s.texImage2D(i.target,0,r.internalFormat,n,o,0,i.format,r.type,this.data)),!0}};var eh=class{constructor(e,i){this.width=Math.round(e||100),this.height=Math.round(i||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new fn("disposeFramebuffer"),this.multisample=Zr.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,i){return this.colorTextures[e]=i||new ui(null,{scaleMode:io.NEAREST,resolution:1,mipmap:An.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new ui(new hg(null,{width:this.width,height:this.height}),{scaleMode:io.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:An.OFF,format:zt.DEPTH_COMPONENT,type:yi.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,i){if(e=Math.round(e),i=Math.round(i),!(e===this.width&&i===this.height)){this.width=e,this.height=i,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){let s=this.colorTextures[r],n=s.resolution;s.setSize(e/n,i/n)}if(this.depthTexture){let r=this.depthTexture.resolution;this.depthTexture.setSize(e/r,i/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}};var th=class extends ui{constructor(e={}){var i;if(typeof e=="number"){let r=arguments[0],s=arguments[1],n=arguments[2],o=arguments[3];e={width:r,height:s,scaleMode:n,resolution:o}}e.width=e.width||100,e.height=e.height||100,(i=e.multisample)!=null||(e.multisample=Zr.NONE),super(null,e),this.mipmap=An.OFF,this.valid=!0,this._clear=new mi([0,0,0,0]),this.framebuffer=new eh(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(e,i){this.framebuffer.resize(e*this.resolution,i*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}};var oo=class extends Zo{constructor(e){let i=e,r=i.naturalWidth||i.videoWidth||i.width,s=i.naturalHeight||i.videoHeight||i.height;super(r,s),this.source=e,this.noSubImage=!1}static crossOrigin(e,i,r){r===void 0&&!i.startsWith("data:")?e.crossOrigin=eg(i):r!==!1&&(e.crossOrigin=typeof r=="string"?r:"anonymous")}upload(e,i,r,s){let n=e.gl,o=i.realWidth,a=i.realHeight;if(s=s||this.source,typeof HTMLImageElement!="undefined"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement!="undefined"&&s instanceof HTMLVideoElement&&s.readyState<=1&&s.buffered.length===0)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===tn.UNPACK),!this.noSubImage&&i.target===n.TEXTURE_2D&&r.width===o&&r.height===a?n.texSubImage2D(n.TEXTURE_2D,0,0,0,i.format,r.type,s):(r.width=o,r.height=a,n.texImage2D(i.target,0,r.internalFormat,i.format,r.type,s)),!0}update(){if(this.destroyed)return;let e=this.source,i=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;this.resize(i,r),super.update()}dispose(){this.source=null}};var ih=class extends oo{constructor(e,i){var r;if(i=i||{},typeof e=="string"){let s=new Image;oo.crossOrigin(s,e,i.crossorigin),s.src=e,e=s}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=((r=i.createBitmap)!=null?r:ht.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,this.bitmap=null,this._load=null,i.autoLoad!==!1&&this.load()}load(e){return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise((i,r)=>{let s=this.source;this.url=s.src;let n=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.resize(s.width,s.height),this._load=null,this.createBitmap?i(this.process()):i(this))};s.complete&&s.src?n():(s.onload=n,s.onerror=o=>{r(o),this.onError.emit(o)})}),this._load)}process(){let e=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);let i=globalThis.createImageBitmap,r=!e.crossOrigin||e.crossOrigin==="anonymous";return this._process=fetch(e.src,{mode:r?"cors":"no-cors"}).then(s=>s.blob()).then(s=>i(s,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===tn.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,i,r){if(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,i,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,i,r,this.bitmap),!this.preserveBitmap){let s=!0,n=i._glTextures;for(let o in n){let a=n[o];if(a!==r&&a.dirtyId!==i.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement!="undefined"&&(typeof e=="string"||e instanceof HTMLImageElement)}};var s2=class{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,i,r){let s=i.width,n=i.height;if(r){let o=e.width/2/s,a=e.height/2/n,l=e.x/s+o,c=e.y/n+a;r=Es.add(r,Es.NW),this.x0=l+o*Es.uX(r),this.y0=c+a*Es.uY(r),r=Es.add(r,2),this.x1=l+o*Es.uX(r),this.y1=c+a*Es.uY(r),r=Es.add(r,2),this.x2=l+o*Es.uX(r),this.y2=c+a*Es.uY(r),r=Es.add(r,2),this.x3=l+o*Es.uX(r),this.y3=c+a*Es.uY(r)}else this.x0=e.x/s,this.y0=e.y/n,this.x1=(e.x+e.width)/s,this.y1=e.y/n,this.x2=(e.x+e.width)/s,this.y2=(e.y+e.height)/n,this.x3=e.x/s,this.y3=(e.y+e.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}};var BR=new s2;function dg(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}var Yt=class t extends sn.default{constructor(e,i,r,s,n,o,a){if(super(),this.noFrame=!1,i||(this.noFrame=!0,i=new ri(0,0,1,1)),e instanceof t&&(e=e.baseTexture),this.baseTexture=e,this._frame=i,this.trim=s,this.valid=!1,this._uvs=BR,this.uvMatrix=null,this.orig=r||i,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new ei(o.x,o.y):new ei(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=i:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){let{resource:i}=this.baseTexture;i!=null&&i.url&&Wn[i.url]&&t.removeFromCache(i.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,t.removeFromCache(this),this.textureCacheIds=null}clone(){var s;let e=this._frame.clone(),i=this._frame===this.orig?e:this.orig.clone(),r=new t(this.baseTexture,!this.noFrame&&e,i,(s=this.trim)==null?void 0:s.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=e),r}updateUvs(){this._uvs===BR&&(this._uvs=new s2),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,i={},r=ht.STRICT_TEXTURE_CACHE){let s=typeof e=="string",n=null;if(s)n=e;else if(e instanceof ui){if(!e.cacheId){let a=(i==null?void 0:i.pixiIdPrefix)||"pixiid";e.cacheId=`${a}-${Nc()}`,ui.addToCache(e,e.cacheId)}n=e.cacheId}else{if(!e._pixiId){let a=(i==null?void 0:i.pixiIdPrefix)||"pixiid";e._pixiId=`${a}_${Nc()}`}n=e._pixiId}let o=Wn[n];if(s&&r&&!o)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!o&&!(e instanceof ui)?(i.resolution||(i.resolution=d5(e)),o=new t(new ui(e,i)),o.baseTexture.cacheId=n,ui.addToCache(o.baseTexture,n),t.addToCache(o,n)):!o&&e instanceof ui&&(o=new t(e),t.addToCache(o,n)),o}static fromURL(e,i){let r=Object.assign({autoLoad:!1},i==null?void 0:i.resourceOptions),s=t.from(e,Object.assign({resourceOptions:r},i),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then(()=>Promise.resolve(s))}static fromBuffer(e,i,r,s){return new t(ui.fromBuffer(e,i,r,s))}static fromLoader(e,i,r,s){let n=new ui(e,Object.assign({scaleMode:ui.defaultOptions.scaleMode,resolution:d5(i)},s)),{resource:o}=n;o instanceof ih&&(o.url=i);let a=new t(n);return r||(r=i),ui.addToCache(a.baseTexture,r),t.addToCache(a,r),r!==i&&(ui.addToCache(a.baseTexture,i),t.addToCache(a,i)),a.baseTexture.valid?Promise.resolve(a):new Promise(l=>{a.baseTexture.once("loaded",()=>l(a))})}static addToCache(e,i){i&&(e.textureCacheIds.includes(i)||e.textureCacheIds.push(i),Wn[i]&&Wn[i]!==e&&console.warn(`Texture added to the cache with an id [${i}] that already had an entry`),Wn[i]=e)}static removeFromCache(e){if(typeof e=="string"){let i=Wn[e];if(i){let r=i.textureCacheIds.indexOf(e);return r>-1&&i.textureCacheIds.splice(r,1),delete Wn[e],i}}else if(e!=null&&e.textureCacheIds){for(let i=0;i<e.textureCacheIds.length;++i)Wn[e.textureCacheIds[i]]===e&&delete Wn[e.textureCacheIds[i]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;let{x:i,y:r,width:s,height:n}=e,o=i+s>this.baseTexture.width,a=r+n>this.baseTexture.height;if(o||a){let l=o&&a?"and":"or",c=`X: ${i} + ${s} = ${i+s} > ${this.baseTexture.width}`,d=`Y: ${r} + ${n} = ${r+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${c} ${l} ${d}`)}this.valid=s&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return t._EMPTY||(t._EMPTY=new t(new ui),dg(t._EMPTY),dg(t._EMPTY.baseTexture)),t._EMPTY}static get WHITE(){if(!t._WHITE){let e=ht.ADAPTER.createCanvas(16,16),i=e.getContext("2d");e.width=16,e.height=16,i.fillStyle="white",i.fillRect(0,0,16,16),t._WHITE=new t(ui.from(e)),dg(t._WHITE),dg(t._WHITE.baseTexture)}return t._WHITE}};var ja=class t extends Yt{constructor(e,i){super(e,i),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,i,r=!0){let s=this.baseTexture.resolution,n=Math.round(e*s)/s,o=Math.round(i*s)/s;this.valid=n>0&&o>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=o,r&&this.baseTexture.resize(n,o),this.updateUvs()}setResolution(e){let{baseTexture:i}=this;i.resolution!==e&&(i.setResolution(e),this.resize(i.width,i.height,!1))}static create(e){return new t(new th(e))}};var n2=class{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,i,r=Zr.NONE){let s=new th(Object.assign({width:e,height:i,resolution:1,multisample:r},this.textureOptions));return new ja(s)}getOptimalTexture(e,i,r=1,s=Zr.NONE){let n;e=Math.ceil(e*r-1e-6),i=Math.ceil(i*r-1e-6),!this.enableFullScreen||e!==this._pixelsWidth||i!==this._pixelsHeight?(e=q1(e),i=q1(i),n=((e&65535)<<16|i&65535)>>>0,s>1&&(n+=s*4294967296)):n=s>1?-s:-1,this.texturePool[n]||(this.texturePool[n]=[]);let o=this.texturePool[n].pop();return o||(o=this.createTexture(e,i,s)),o.filterPoolKey=n,o.setResolution(r),o}getFilterTexture(e,i,r){let s=this.getOptimalTexture(e.width,e.height,i||e.resolution,r||Zr.NONE);return s.filterFrame=e.filterFrame,s}returnTexture(e){let i=e.filterPoolKey;e.filterFrame=null,this.texturePool[i].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=e!==!1,e)for(let i in this.texturePool){let r=this.texturePool[i];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0)}this.texturePool={}}setScreenSize(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(let i in this.texturePool){if(!(Number(i)<0))continue;let r=this.texturePool[i];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0);this.texturePool[i]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}};n2.SCREEN_KEY=-1;var b5=class extends Qo{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}};var yd=class extends Qo{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new is(this.vertices),this.uvBuffer=new is(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,i){let r=0,s=0;return this.uvs[0]=r,this.uvs[1]=s,this.uvs[2]=r+i.width/e.width,this.uvs[3]=s,this.uvs[4]=r+i.width/e.width,this.uvs[5]=s+i.height/e.height,this.uvs[6]=r,this.uvs[7]=s+i.height/e.height,r=i.x,s=i.y,this.vertices[0]=r,this.vertices[1]=s,this.vertices[2]=r+i.width,this.vertices[3]=s,this.vertices[4]=r+i.width,this.vertices[5]=s+i.height,this.vertices[6]=r,this.vertices[7]=s+i.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}};var w5=class{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Zr.NONE,this.sourceFrame=new ri,this.destinationFrame=new ri,this.bindingSourceFrame=new ri,this.bindingDestinationFrame=new ri,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}};var fg=[new ei,new ei,new ei,new ei],Zw=new fr,o2=class{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new n2,this.statePool=[],this.quad=new b5,this.quadUv=new yd,this.tempRect=new ri,this.activeState={},this.globalUniforms=new Jo({outputFrame:new ri,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,i){var v,E;let r=this.renderer,s=this.defaultFilterStack,n=this.statePool.pop()||new w5,o=this.renderer.renderTexture,a=i[0].resolution,l=i[0].multisample,c=i[0].padding,d=i[0].autoFit,m=(v=i[0].legacy)!=null?v:!0;for(let b=1;b<i.length;b++){let T=i[b];a=Math.min(a,T.resolution),l=Math.min(l,T.multisample),c=this.useMaxPadding?Math.max(c,T.padding):c+T.padding,d=d&&T.autoFit,m=m||((E=T.legacy)!=null?E:!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),s.push(n),n.resolution=a,n.multisample=l,n.legacy=m,n.target=e,n.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),n.sourceFrame.pad(c);let g=this.tempRect.copyFrom(o.sourceFrame);r.projection.transform&&this.transformAABB(Zw.copyFrom(r.projection.transform).invert(),g),d?(n.sourceFrame.fit(g),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(g)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,o.current?o.current.resolution:r.resolution,o.sourceFrame,o.destinationFrame,r.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,a,l),n.filters=i,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;let _=this.tempRect;_.x=0,_.y=0,_.width=n.sourceFrame.width,_.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(o.sourceFrame),n.bindingDestinationFrame.copyFrom(o.destinationFrame),n.transform=r.projection.transform,r.projection.transform=null,o.bind(n.renderTexture,n.sourceFrame,_),r.framebuffer.clear(0,0,0,0)}pop(){let e=this.defaultFilterStack,i=e.pop(),r=i.filters;this.activeState=i;let s=this.globalUniforms.uniforms;s.outputFrame=i.sourceFrame,s.resolution=i.resolution;let n=s.inputSize,o=s.inputPixel,a=s.inputClamp;if(n[0]=i.destinationFrame.width,n[1]=i.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=Math.round(n[0]*i.resolution),o[1]=Math.round(n[1]*i.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=i.sourceFrame.width*n[2]-.5*o[2],a[3]=i.sourceFrame.height*n[3]-.5*o[3],i.legacy){let c=s.filterArea;c[0]=i.destinationFrame.width,c[1]=i.destinationFrame.height,c[2]=i.sourceFrame.x,c[3]=i.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();let l=e[e.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,i.renderTexture,l.renderTexture,$a.BLEND,i),this.returnFilterTexture(i.renderTexture);else{let c=i.renderTexture,d=this.getOptimalFilterTexture(c.width,c.height,i.resolution);d.filterFrame=c.filterFrame;let m=0;for(m=0;m<r.length-1;++m){m===1&&i.multisample>1&&(d=this.getOptimalFilterTexture(c.width,c.height,i.resolution),d.filterFrame=c.filterFrame),r[m].apply(this,c,d,$a.CLEAR,i);let g=c;c=d,d=g}r[m].apply(this,c,l.renderTexture,$a.BLEND,i),m>1&&i.multisample>1&&this.returnFilterTexture(i.renderTexture),this.returnFilterTexture(c),this.returnFilterTexture(d)}i.clear(),this.statePool.push(i)}bindAndClear(e,i=$a.CLEAR){let{renderTexture:r,state:s}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e!=null&&e.filterFrame){let o=this.tempRect;o.x=0,o.y=0,o.width=e.filterFrame.width,o.height=e.filterFrame.height,r.bind(e,e.filterFrame,o)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);let n=s.stateId&1||this.forceClear;(i===$a.CLEAR||i===$a.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,i,r,s){let n=this.renderer;n.state.set(e.state),this.bindAndClear(r,s),e.uniforms.uSampler=i,e.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(i._frame,i.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(ya.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(ya.TRIANGLE_STRIP))}calculateSpriteMatrix(e,i){let{sourceFrame:r,destinationFrame:s}=this.activeState,{orig:n}=i._texture,o=e.set(s.width,0,0,s.height,r.x,r.y),a=i.worldTransform.copyTo(fr.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/n.width,1/n.height),o.translate(i.anchor.x,i.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,i,r=1,s=Zr.NONE){return this.texturePool.getOptimalTexture(e,i,r,s)}getFilterTexture(e,i,r){if(typeof e=="number"){let n=e;e=i,i=n}e=e||this.activeState.renderTexture;let s=this.texturePool.getOptimalTexture(e.width,e.height,i||e.resolution,r||Zr.NONE);return s.filterFrame=e.filterFrame,s}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,i){let r=fg[0],s=fg[1],n=fg[2],o=fg[3];r.set(i.left,i.top),s.set(i.left,i.bottom),n.set(i.right,i.top),o.set(i.right,i.bottom),e.apply(r,r),e.apply(s,s),e.apply(n,n),e.apply(o,o);let a=Math.min(r.x,s.x,n.x,o.x),l=Math.min(r.y,s.y,n.y,o.y),c=Math.max(r.x,s.x,n.x,o.x),d=Math.max(r.y,s.y,n.y,o.y);i.x=a,i.y=l,i.width=c-a,i.height=d-l}roundFrame(e,i,r,s,n){if(!(e.width<=0||e.height<=0||r.width<=0||r.height<=0)){if(n){let{a:o,b:a,c:l,d:c}=n;if((Math.abs(a)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(c)>1e-4))return}n=n?Zw.copyFrom(n):Zw.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.transformAABB(n,e),e.ceil(i),this.transformAABB(n.invert(),e)}}};o2.extension={type:gt.RendererSystem,name:"filter"};Tt.add(o2);var E5=class{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Zr.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}};var Oj=new ri,a2=class{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new eh(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);let e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new ri,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let i=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;ht.PREFER_ENV===jo.WEBGL_LEGACY&&(i=null,r=null),i?e.drawBuffers=s=>i.drawBuffersWEBGL(s):(this.hasMRT=!1,e.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,i,r=0){let{gl:s}=this;if(e){let n=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(e.dirtyId++,e.dirtyFormat++,n.mipLevel=r),n.dirtyId!==e.dirtyId&&(n.dirtyId=e.dirtyId,n.dirtyFormat!==e.dirtyFormat?(n.dirtyFormat=e.dirtyFormat,n.dirtySize=e.dirtySize,this.updateFramebuffer(e,r)):n.dirtySize!==e.dirtySize&&(n.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let o=0;o<e.colorTextures.length;o++){let a=e.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),i){let o=i.width>>r,a=i.height>>r,l=o/i.width;this.setViewport(i.x*l,i.y*l,o,a)}else{let o=e.width>>r,a=e.height>>r;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),i?this.setViewport(i.x,i.y,i.width,i.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,i,r,s){let n=this.viewport;e=Math.round(e),i=Math.round(i),r=Math.round(r),s=Math.round(s),(n.width!==r||n.height!==s||n.x!==e||n.y!==i)&&(n.x=e,n.y=i,n.width=r,n.height=s,this.gl.viewport(e,i,r,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,i,r,s,n=O8.COLOR|O8.DEPTH){let{gl:o}=this;o.clearColor(e,i,r,s),o.clear(n)}initFramebuffer(e){let{gl:i}=this,r=new E5(i.createFramebuffer());return r.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(e),e.disposeRunner.add(this),r}resizeFramebuffer(e){let{gl:i}=this,r=e.glFramebuffers[this.CONTEXT_UID];r.stencil&&(i.bindRenderbuffer(i.RENDERBUFFER,r.stencil),r.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.DEPTH24_STENCIL8,e.width,e.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e.width,e.height));let s=e.colorTextures,n=s.length;i.drawBuffers||(n=Math.min(n,1));for(let o=0;o<n;o++){let a=s[o],l=a.parentTextureArray||a;this.renderer.texture.bind(l,0),o===0&&r.msaaBuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,r.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,i){let{gl:r}=this,s=e.glFramebuffers[this.CONTEXT_UID],n=e.colorTextures,o=n.length;r.drawBuffers||(o=Math.min(o,1)),s.multisample>1&&this.canMultisampleFramebuffer(e)?s.msaaBuffer=s.msaaBuffer||r.createRenderbuffer():s.msaaBuffer&&(r.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));let a=[];for(let l=0;l<o;l++){let c=n[l],d=c.parentTextureArray||c;this.renderer.texture.bind(d,0),l===0&&s.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,s.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,d._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,s.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+l,c.target,d._glTextures[this.CONTEXT_UID].texture,i),a.push(r.COLOR_ATTACHMENT0+l))}if(a.length>1&&r.drawBuffers(a),e.depthTexture&&this.writeDepthTexture){let c=e.depthTexture;this.renderer.texture.bind(c,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,c._glTextures[this.CONTEXT_UID].texture,i)}(e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)?(s.stencil=s.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,s.stencil),s.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,r.DEPTH24_STENCIL8,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,s.stencil)):s.stencil&&(r.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){let{msaaSamples:i}=this,r=Zr.NONE;if(e<=1||i===null)return r;for(let s=0;s<i.length;s++)if(i[s]<=e){r=i[s];break}return r===1&&(r=Zr.NONE),r}blit(e,i,r){let{current:s,renderer:n,gl:o,CONTEXT_UID:a}=this;if(n.context.webGLVersion!==2||!s)return;let l=s.glFramebuffers[a];if(!l)return;if(!e){if(!l.msaaBuffer)return;let d=s.colorTextures[0];if(!d)return;l.blitFramebuffer||(l.blitFramebuffer=new eh(s.width,s.height),l.blitFramebuffer.addColorTexture(0,d)),e=l.blitFramebuffer,e.colorTextures[0]!==d&&(e.colorTextures[0]=d,e.dirtyId++,e.dirtyFormat++),(e.width!==s.width||e.height!==s.height)&&(e.width=s.width,e.height=s.height,e.dirtyId++,e.dirtySize++)}i||(i=Oj,i.width=s.width,i.height=s.height),r||(r=i);let c=i.width===r.width&&i.height===r.height;this.bind(e),o.bindFramebuffer(o.READ_FRAMEBUFFER,l.framebuffer),o.blitFramebuffer(i.left,i.top,i.right,i.bottom,r.left,r.top,r.right,r.bottom,o.COLOR_BUFFER_BIT,c?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,i){let r=e.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!r)return;delete e.glFramebuffers[this.CONTEXT_UID];let n=this.managedFramebuffers.indexOf(e);n>=0&&this.managedFramebuffers.splice(n,1),e.disposeRunner.remove(this),i||(s.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&s.deleteRenderbuffer(r.msaaBuffer),r.stencil&&s.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,i)}disposeAll(e){let i=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<i.length;r++)this.disposeFramebuffer(i[r],e)}forceStencil(){let e=this.current;if(!e)return;let i=e.glFramebuffers[this.CONTEXT_UID];if(!i||i.stencil)return;e.stencil=!0;let r=e.width,s=e.height,n=this.gl,o=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o),i.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,i.multisample,n.DEPTH24_STENCIL8,r,s):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,r,s),i.stencil=o,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new ri}destroy(){this.renderer=null}};a2.extension={type:gt.RendererSystem,name:"framebuffer"};Tt.add(a2);var Qw={5126:4,5123:2,5121:1},l2=class{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);let e=this.gl=this.renderer.gl,i=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,i.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;ht.PREFER_ENV===jo.WEBGL_LEGACY&&(r=null),r?(e.createVertexArray=()=>r.createVertexArrayOES(),e.bindVertexArray=s=>r.bindVertexArrayOES(s),e.deleteVertexArray=s=>r.deleteVertexArrayOES(s)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(i.webGLVersion!==2){let r=e.getExtension("ANGLE_instanced_arrays");r?(e.vertexAttribDivisor=(s,n)=>r.vertexAttribDivisorANGLE(s,n),e.drawElementsInstanced=(s,n,o,a,l)=>r.drawElementsInstancedANGLE(s,n,o,a,l),e.drawArraysInstanced=(s,n,o,a)=>r.drawArraysInstancedANGLE(s,n,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=i.webGLVersion===2||!!i.extensions.uint32ElementIndex}bind(e,i){i=i||this.renderer.shader.shader;let{gl:r}=this,s=e.glVertexArrayObjects[this.CONTEXT_UID],n=!1;s||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=s={},n=!0);let o=s[i.program.id]||this.initGeometryVao(e,i,n);this._activeGeometry=e,this._activeVao!==o&&(this._activeVao=o,this.hasVao?r.bindVertexArray(o):this.activateVao(e,i.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){let e=this._activeGeometry,i=this.renderer.buffer;for(let r=0;r<e.buffers.length;r++){let s=e.buffers[r];i.update(s)}}checkCompatibility(e,i){let r=e.attributes,s=i.attributeData;for(let n in s)if(!r[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(e,i){let r=e.attributes,s=i.attributeData,n=["g",e.id];for(let o in r)s[o]&&n.push(o,s[o].location);return n.join("-")}initGeometryVao(e,i,r=!0){let s=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,a=i.program;a.glPrograms[n]||this.renderer.shader.generateProgram(i),this.checkCompatibility(e,a);let l=this.getSignature(e,a),c=e.glVertexArrayObjects[this.CONTEXT_UID],d=c[l];if(d)return c[a.id]=d,d;let m=e.buffers,g=e.attributes,_={},v={};for(let E in m)_[E]=0,v[E]=0;for(let E in g)!g[E].size&&a.attributeData[E]?g[E].size=a.attributeData[E].size:g[E].size||console.warn(`PIXI Geometry attribute '${E}' size cannot be determined (likely the bound shader does not have the attribute)`),_[g[E].buffer]+=g[E].size*Qw[g[E].type];for(let E in g){let b=g[E],T=b.size;b.stride===void 0&&(_[b.buffer]===T*Qw[b.type]?b.stride=0:b.stride=_[b.buffer]),b.start===void 0&&(b.start=v[b.buffer],v[b.buffer]+=T*Qw[b.type])}d=s.createVertexArray(),s.bindVertexArray(d);for(let E=0;E<m.length;E++){let b=m[E];o.bind(b),r&&b._glBuffers[n].refCount++}return this.activateVao(e,a),c[a.id]=d,c[l]=d,s.bindVertexArray(null),o.unbind(xa.ARRAY_BUFFER),d}disposeGeometry(e,i){var a;if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];let r=e.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,n=e.buffers,o=(a=this.renderer)==null?void 0:a.buffer;if(e.disposeRunner.remove(this),!!r){if(o)for(let l=0;l<n.length;l++){let c=n[l]._glBuffers[this.CONTEXT_UID];c&&(c.refCount--,c.refCount===0&&!i&&o.dispose(n[l],i))}if(!i){for(let l in r)if(l[0]==="g"){let c=r[l];this._activeVao===c&&this.unbind(),s.deleteVertexArray(c)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){let i=Object.keys(this.managedGeometries);for(let r=0;r<i.length;r++)this.disposeGeometry(this.managedGeometries[i[r]],e)}activateVao(e,i){let r=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,o=e.buffers,a=e.attributes;e.indexBuffer&&n.bind(e.indexBuffer);let l=null;for(let c in a){let d=a[c],m=o[d.buffer],g=m._glBuffers[s];if(i.attributeData[c]){l!==g&&(n.bind(m),l=g);let _=i.attributeData[c].location;if(r.enableVertexAttribArray(_),r.vertexAttribPointer(_,d.size,d.type||r.FLOAT,d.normalized,d.stride,d.start),d.instance)if(this.hasInstance)r.vertexAttribDivisor(_,d.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,i,r,s){let{gl:n}=this,o=this._activeGeometry;if(o.indexBuffer){let a=o.indexBuffer.data.BYTES_PER_ELEMENT,l=a===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(e,i||o.indexBuffer.data.length,l,(r||0)*a,s||1):n.drawElements(e,i||o.indexBuffer.data.length,l,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(e,r,i||o.getSize(),s||1):n.drawArrays(e,r,i||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}};l2.extension={type:gt.RendererSystem,name:"geometry"};Tt.add(l2);var UR=new fr,rh=class{constructor(e,i){this._texture=e,this.mapCoord=new fr,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof i=="undefined"?.5:i,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,i){i===void 0&&(i=e);let r=this.mapCoord;for(let s=0;s<e.length;s+=2){let n=e[s],o=e[s+1];i[s]=n*r.a+o*r.c+r.tx,i[s+1]=n*r.b+o*r.d+r.ty}return i}update(e){let i=this._texture;if(!i||!i.valid||!e&&this._textureID===i._updateID)return!1;this._textureID=i._updateID,this._updateID++;let r=i._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);let s=i.orig,n=i.trim;n&&(UR.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(UR));let o=i.baseTexture,a=this.uClampFrame,l=this.clampMargin/o.resolution,c=this.clampOffset;return a[0]=(i._frame.x+l+c)/o.width,a[1]=(i._frame.y+l+c)/o.height,a[2]=(i._frame.x+i._frame.width-l+c)/o.width,a[3]=(i._frame.y+i._frame.height-l+c)/o.height,this.uClampOffset[0]=c/o.realWidth,this.uClampOffset[1]=c/o.realHeight,this.isSimple=i._frame.width===o.width&&i._frame.height===o.height&&i.rotate===0,!0}};var zR=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`;var GR=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;var T5=class extends Wt{constructor(e,i,r){let s=null;typeof e!="string"&&i===void 0&&r===void 0&&(s=e,e=void 0,i=void 0,r=void 0),super(e||GR,i||zR,r),this.maskSprite=s,this.maskMatrix=new fr}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,i,r,s){let n=this._maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new rh(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,e.applyFilter(this,i,r,s))}};var S5=class{constructor(e=null){this.type=rn.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Wt.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=rn.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}};var c2=class{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,i){let r=i;if(!r.isMaskData){let n=this.maskDataPool.pop()||new S5;n.pooled=!0,n.maskObject=i,r=n}let s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(s),r._colorMask=s?s._colorMask:15,r.autoDetect&&this.detect(r),r._target=e,r.type!==rn.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case rn.SCISSOR:this.renderer.scissor.push(r);break;case rn.STENCIL:this.renderer.stencil.push(r);break;case rn.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case rn.COLOR:this.pushColorMask(r);break;default:break}r.type===rn.SPRITE&&this.maskStack.push(r)}pop(e){let i=this.maskStack.pop();if(!(!i||i._target!==e)){if(i.enabled)switch(i.type){case rn.SCISSOR:this.renderer.scissor.pop(i);break;case rn.STENCIL:this.renderer.stencil.pop(i.maskObject);break;case rn.SPRITE:this.popSpriteMask(i);break;case rn.COLOR:this.popColorMask(i);break;default:break}if(i.reset(),i.pooled&&this.maskDataPool.push(i),this.maskStack.length!==0){let r=this.maskStack[this.maskStack.length-1];r.type===rn.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(e){let i=e.maskObject;i?i.isSprite?e.type=rn.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=rn.SCISSOR:e.type=rn.STENCIL:e.type=rn.COLOR}pushSpriteMask(e){var d,m;let{maskObject:i}=e,r=e._target,s=e._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new T5]));let n=this.renderer,o=n.renderTexture,a,l;if(o.current){let g=o.current;a=e.resolution||g.resolution,l=(d=e.multisample)!=null?d:g.multisample}else a=e.resolution||n.resolution,l=(m=e.multisample)!=null?m:n.multisample;s[0].resolution=a,s[0].multisample=l,s[0].maskSprite=i;let c=r.filterArea;r.filterArea=i.getBounds(!0),n.filter.push(r,s),r.filterArea=c,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){let i=e._colorMask,r=e._colorMask=i&e.colorMask;r!==i&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(e){let i=e._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==i&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}};c2.extension={type:gt.RendererSystem,name:"mask"};Tt.add(c2);var u2=class{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){let{gl:i}=this.renderer,r=this.getStackLength();this.maskStack=e;let s=this.getStackLength();s!==r&&(s===0?i.disable(this.glConst):(i.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}};var $R=new fr,HR=[],pg=class extends u2{constructor(t){super(t),this.glConst=ht.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){let t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){var o;if(t._scissorRectLocal)return;let e=t._scissorRect,{maskObject:i}=t,{renderer:r}=this,s=r.renderTexture,n=i.getBounds(!0,(o=HR.pop())!=null?o:new ri);this.roundFrameToPixels(n,s.current?s.current.resolution:r.resolution,s.sourceFrame,s.destinationFrame,r.projection.transform),e&&n.fit(e),t._scissorRectLocal=n}static isMatrixRotated(t){if(!t)return!1;let{a:e,b:i,c:r,d:s}=t;return(Math.abs(i)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(s)>1e-4)}testScissor(t){let{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||pg.isMatrixRotated(e.worldTransform)||pg.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);let i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,e,i,r,s){pg.isMatrixRotated(s)||(s=s?$R.copyFrom(s):$R.identity(),s.translate(-i.x,-i.y).scale(r.width/i.width,r.height/i.height).translate(r.x,r.y),this.renderer.filter.transformAABB(s,t),t.fit(r),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);let{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){let{gl:e}=this.renderer;t&&HR.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){let t=this.maskStack[this.maskStack.length-1]._scissorRect,e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}},mg=pg;mg.extension={type:gt.RendererSystem,name:"scissor"};Tt.add(mg);var h2=class extends u2{constructor(e){super(e),this.glConst=ht.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){let e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){let i=e.maskObject,{gl:r}=this.renderer,s=e._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),e._stencilCounter++;let n=e._colorMask;n!==0&&(e._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,s,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),i.renderable=!0,i.render(this.renderer),this.renderer.batch.flush(),i.renderable=!1,n!==0&&(e._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(e){let i=this.renderer.gl;if(this.getStackLength()===0)i.disable(i.STENCIL_TEST);else{let r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=r?r._colorMask:15;s!==0&&(r._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilOp(i.KEEP,i.KEEP,i.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(r._colorMask=s,i.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){let e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}};h2.extension={type:gt.RendererSystem,name:"stencil"};Tt.add(h2);var d2=class{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return rr("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract}},prepare:{enumerable:!1,get(){return rr("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare}},interaction:{enumerable:!1,get(){return rr("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events}}})}init(){let e=this.rendererPlugins;for(let i in e)this.plugins[i]=new e[i](this.renderer)}destroy(){for(let e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}};d2.extension={type:[gt.RendererSystem,gt.CanvasRendererSystem],name:"_plugin"};Tt.add(d2);var f2=class{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new fr,this.transform=null}update(e,i,r,s){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=i||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,s),this.transform&&this.projectionMatrix.append(this.transform);let n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(e,i,r,s){let n=this.projectionMatrix,o=s?-1:1;n.identity(),n.a=1/i.width*2,n.d=o*(1/i.height*2),n.tx=-1-i.x*n.a,n.ty=-o-i.y*n.d}setTransform(e){}destroy(){this.renderer=null}};f2.extension={type:gt.RendererSystem,name:"projection"};Tt.add(f2);var Bj=new gd,p2=class{constructor(e){this.renderer=e,this._tempMatrix=new fr}generateTexture(e,i){let l=i||{},{region:r}=l,s=df(l,["region"]),n=r||e.getLocalBounds(null,!0);n.width===0&&(n.width=1),n.height===0&&(n.height=1);let o=ja.create(di({width:n.width,height:n.height},s));this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;let a=e.transform;return e.transform=Bj,this.renderer.render(e,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=a,o}destroy(){}};p2.extension={type:[gt.RendererSystem,gt.CanvasRendererSystem],name:"textureGenerator"};Tt.add(p2);var _d=new ri,A5=new ri,m2=class{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new ri,this.destinationFrame=new ri,this.viewportFrame=new ri}contextChange(){var i;let e=(i=this.renderer)==null?void 0:i.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(e=null,i,r){let s=this.renderer;this.current=e;let n,o,a;e?(n=e.baseTexture,a=n.resolution,i||(_d.width=e.frame.width,_d.height=e.frame.height,i=_d),r||(A5.x=e.frame.x,A5.y=e.frame.y,A5.width=i.width,A5.height=i.height,r=A5),o=n.framebuffer):(a=s.resolution,i||(_d.width=s._view.screen.width,_d.height=s._view.screen.height,i=_d),r||(r=_d,r.width=i.width,r.height=i.height));let l=this.viewportFrame;l.x=r.x*a,l.y=r.y*a,l.width=r.width*a,l.height=r.height*a,e||(l.y=s.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(o,l),this.renderer.projection.update(r,i,a,!o),e?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(i),this.destinationFrame.copyFrom(r)}clear(e,i){let r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=mi.shared.setValue(e||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);let n=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=n.width!==o.width||n.height!==o.height;if(a){let{x:l,y:c,width:d,height:m}=this.viewportFrame;l=Math.round(l),c=Math.round(c),d=Math.round(d),m=Math.round(m),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,c,d,m)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,i),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}};m2.extension={type:gt.RendererSystem,name:"renderTexture"};Tt.add(m2);var C5=class{constructor(e,i){this.program=e,this.uniformData=i,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}};function VR(t,e){let i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){let n=e.getActiveAttrib(t,s);if(n.name.startsWith("gl_"))continue;let o=y5(e,n.type),a={type:o,name:n.name,size:g5(o),location:e.getAttribLocation(t,n.name)};i[n.name]=a}return i}function jR(t,e){let i={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<r;s++){let n=e.getActiveUniform(t,s),o=n.name.replace(/\[.*?\]$/,""),a=!!n.name.match(/\[.*?\]$/),l=y5(e,n.type);i[o]={name:o,index:s,type:l,size:n.size,isArray:a,value:m5(l,n.size)}}return i}function Kw(t,e){var l;let i=sg(t,t.VERTEX_SHADER,e.vertexSrc),r=sg(t,t.FRAGMENT_SHADER,e.fragmentSrc),s=t.createProgram();t.attachShader(s,i),t.attachShader(s,r);let n=(l=e.extra)==null?void 0:l.transformFeedbackVaryings;if(n&&(typeof t.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):t.transformFeedbackVaryings(s,n.names,n.bufferMode==="separate"?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||Yw(t,s,i,r),e.attributeData=VR(s,t),e.uniformData=jR(s,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){let c=Object.keys(e.attributeData);c.sort((d,m)=>d>m?1:-1);for(let d=0;d<c.length;d++)e.attributeData[c[d]].location=d,t.bindAttribLocation(s,d,c[d]);t.linkProgram(s)}t.deleteShader(i),t.deleteShader(r);let o={};for(let c in e.uniformData){let d=e.uniformData[c];o[c]={location:t.getUniformLocation(s,c),value:m5(d.type,d.size)}}return new C5(s,o)}function Uj(t,e,i,r,s){i.buffer.update(s)}var zj={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},XR={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function WR(t){let e=t.map(n=>({data:n,offset:0,dataLen:0,dirty:0})),i=0,r=0,s=0;for(let n=0;n<e.length;n++){let o=e[n];if(i=XR[o.data.type],o.data.size>1&&(i=Math.max(i,16)*o.data.size),o.dataLen=i,r%i!==0&&r<16){let a=r%i%16;r+=a,s+=a}r+i>16?(s=Math.ceil(s/16)*16,o.offset=s,s+=i,r=i):(o.offset=s,r+=i,s+=i)}return s=Math.ceil(s/16)*16,{uboElements:e,size:s}}function qR(t,e){let i=[];for(let r in t)e[r]&&i.push(e[r]);return i.sort((r,s)=>r.index-s.index),i}function Jw(t,e){if(!t.autoManage)return{size:0,syncFunc:Uj};let i=qR(t.uniforms,e),{uboElements:r,size:s}=WR(i),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<r.length;o++){let a=r[o],l=t.uniforms[a.data.name],c=a.data.name,d=!1;for(let m=0;m<Oc.length;m++){let g=Oc[m];if(g.codeUbo&&g.test(a.data,l)){n.push(`offset = ${a.offset/4};`,Oc[m].codeUbo(a.data.name,l)),d=!0;break}}if(!d)if(a.data.size>1){let m=g5(a.data.type),g=Math.max(XR[a.data.type]/16,1),_=m/g,v=(4-_%4)%4;n.push(`
                cv = ud.${c}.value;
                v = uv.${c};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*g}; i++)
                {
                    for(var j = 0; j < ${_}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${v};
                }

                `)}else{let m=zj[a.data.type];n.push(`
                cv = ud.${c}.value;
                v = uv.${c};
                offset = ${a.offset/4};
                ${m};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}var Gj=0,gg={textureCount:0,uboCount:0},g2=class{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Gj++}systemCheck(){if(!cg())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,i){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;let r=e.program,s=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==r&&(this.program=r,this.gl.useProgram(s.program)),i||(gg.textureCount=0,gg.uboCount=0,this.syncUniformGroup(e.uniformGroup,gg)),s}setUniforms(e){let i=this.shader.program,r=i.glPrograms[this.renderer.CONTEXT_UID];i.syncUniforms(r.uniformData,e,this.renderer)}syncUniformGroup(e,i){let r=this.getGlProgram();(!e.static||e.dirtyId!==r.uniformDirtyGroups[e.id])&&(r.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,r,i))}syncUniforms(e,i,r){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(i.uniformData,e.uniforms,this.renderer,r)}createSyncGroups(e){let i=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[i]||(this.cache[i]=Ww(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[i],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,i){let r=this.getGlProgram();if(!e.static||e.dirtyId!==0||!r.uniformGroups[e.id]){e.dirtyId=0;let s=r.uniformGroups[e.id]||this.createSyncBufferGroup(e,r,i);e.buffer.update(),s(r.uniformData,e.uniforms,this.renderer,gg,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,r.uniformBufferBindings[i])}createSyncBufferGroup(e,i,r){let{gl:s}=this.renderer;this.renderer.buffer.bind(e.buffer);let n=this.gl.getUniformBlockIndex(i.program,r);i.uniformBufferBindings[r]=this.shader.uniformBindCount,s.uniformBlockBinding(i.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;let o=this.getSignature(e,this.shader.program.uniformData,"ubo"),a=this._uboCache[o];if(a||(a=this._uboCache[o]=Jw(e,this.shader.program.uniformData)),e.autoManage){let l=new Float32Array(a.size/4);e.buffer.update(l)}return i.uniformGroups[e.id]=a.syncFunc,i.uniformGroups[e.id]}getSignature(e,i,r){let s=e.uniforms,n=[`${r}-`];for(let o in s)n.push(o),i[o]&&n.push(i[o].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){let i=this.gl,r=e.program,s=Kw(i,r);return r.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}};g2.extension={type:gt.RendererSystem,name:"shader"};Tt.add(g2);var Bu=class{constructor(e){this.renderer=e}run(e){let{renderer:i}=this;i.runners.init.emit(i.options),e.hello&&console.log(`PixiJS 7.2.4 - ${i.rendererLogId} - https://pixijs.com`),i.resize(i.screen.width,i.screen.height)}destroy(){}};Bu.defaultOptions={hello:!1};Bu.extension={type:[gt.RendererSystem,gt.CanvasRendererSystem],name:"startup"};Tt.add(Bu);function YR(t,e=[]){return e[ki.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.ADD]=[t.ONE,t.ONE],e[ki.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.NONE]=[0,0],e[ki.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[ki.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[ki.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[ki.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[ki.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[ki.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[ki.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[ki.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[ki.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[ki.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[ki.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}var $j=0,Hj=1,Vj=2,jj=3,Xj=4,Wj=5,eE=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=ki.NONE,this._blendEq=!1,this.map=[],this.map[$j]=this.setBlend,this.map[Hj]=this.setOffset,this.map[Vj]=this.setCullFace,this.map[jj]=this.setDepthTest,this.map[Xj]=this.setFrontFace,this.map[Wj]=this.setDepthMask,this.checks=[],this.defaultState=new ro,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=YR(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)e&1&&this.map[i].call(this,!!(t.data&1<<i)),e=e>>1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(eE.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(eE.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;let e=this.blendModes[t],i=this.gl;e.length===2?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){let i=this.checks.indexOf(t);e&&i===-1?this.checks.push(t):!e&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}},yg=eE;yg.extension={type:gt.RendererSystem,name:"state"};Tt.add(yg);var y2=class extends sn.default{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){var s;this.addRunners(...e.runners);let i=((s=e.priority)!=null?s:[]).filter(n=>e.systems[n]),r=[...i,...Object.keys(e.systems).filter(n=>!i.includes(n))];for(let n of r)this.addSystem(e.systems[n],n)}addRunners(...e){e.forEach(i=>{this.runners[i]=new fn(i)})}addSystem(e,i){let r=new e(this);if(this[i])throw new Error(`Whoops! The name "${i}" is already in use`);this[i]=r,this._systemsHash[i]=r;for(let s in this.runners)this.runners[s].add(r);return this}emitWithCustomOptions(e,i){let r=Object.keys(this._systemsHash);e.items.forEach(s=>{let n=r.find(o=>this._systemsHash[o]===s);s[e.name](i[n])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}};var _g=class{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=_g.defaultMaxIdle,this.checkCountMax=_g.defaultCheckCountMax,this.mode=_g.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==U8.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){let t=this.renderer.texture,e=t.managedTextures,i=!1;for(let r=0;r<e.length;r++){let s=e[r];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[r]=null,i=!0)}if(i){let r=0;for(let s=0;s<e.length;s++)e[s]!==null&&(e[r++]=e[s]);e.length=r}}unload(t){let e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let r=t.children.length-1;r>=0;r--)this.unload(t.children[r])}destroy(){this.renderer=null}},ba=_g;ba.defaultMode=U8.AUTO;ba.defaultMaxIdle=60*60;ba.defaultCheckCountMax=60*10;ba.extension={type:gt.RendererSystem,name:"textureGC"};Tt.add(ba);var xd=class{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=yi.UNSIGNED_BYTE,this.internalFormat=zt.RGBA,this.samplerType=0}};function ZR(t){let e;return"WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?e={[yi.UNSIGNED_BYTE]:{[zt.RGBA]:t.RGBA8,[zt.RGB]:t.RGB8,[zt.RG]:t.RG8,[zt.RED]:t.R8,[zt.RGBA_INTEGER]:t.RGBA8UI,[zt.RGB_INTEGER]:t.RGB8UI,[zt.RG_INTEGER]:t.RG8UI,[zt.RED_INTEGER]:t.R8UI,[zt.ALPHA]:t.ALPHA,[zt.LUMINANCE]:t.LUMINANCE,[zt.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[yi.BYTE]:{[zt.RGBA]:t.RGBA8_SNORM,[zt.RGB]:t.RGB8_SNORM,[zt.RG]:t.RG8_SNORM,[zt.RED]:t.R8_SNORM,[zt.RGBA_INTEGER]:t.RGBA8I,[zt.RGB_INTEGER]:t.RGB8I,[zt.RG_INTEGER]:t.RG8I,[zt.RED_INTEGER]:t.R8I},[yi.UNSIGNED_SHORT]:{[zt.RGBA_INTEGER]:t.RGBA16UI,[zt.RGB_INTEGER]:t.RGB16UI,[zt.RG_INTEGER]:t.RG16UI,[zt.RED_INTEGER]:t.R16UI,[zt.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[yi.SHORT]:{[zt.RGBA_INTEGER]:t.RGBA16I,[zt.RGB_INTEGER]:t.RGB16I,[zt.RG_INTEGER]:t.RG16I,[zt.RED_INTEGER]:t.R16I},[yi.UNSIGNED_INT]:{[zt.RGBA_INTEGER]:t.RGBA32UI,[zt.RGB_INTEGER]:t.RGB32UI,[zt.RG_INTEGER]:t.RG32UI,[zt.RED_INTEGER]:t.R32UI,[zt.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[yi.INT]:{[zt.RGBA_INTEGER]:t.RGBA32I,[zt.RGB_INTEGER]:t.RGB32I,[zt.RG_INTEGER]:t.RG32I,[zt.RED_INTEGER]:t.R32I},[yi.FLOAT]:{[zt.RGBA]:t.RGBA32F,[zt.RGB]:t.RGB32F,[zt.RG]:t.RG32F,[zt.RED]:t.R32F,[zt.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[yi.HALF_FLOAT]:{[zt.RGBA]:t.RGBA16F,[zt.RGB]:t.RGB16F,[zt.RG]:t.RG16F,[zt.RED]:t.R16F},[yi.UNSIGNED_SHORT_5_6_5]:{[zt.RGB]:t.RGB565},[yi.UNSIGNED_SHORT_4_4_4_4]:{[zt.RGBA]:t.RGBA4},[yi.UNSIGNED_SHORT_5_5_5_1]:{[zt.RGBA]:t.RGB5_A1},[yi.UNSIGNED_INT_2_10_10_10_REV]:{[zt.RGBA]:t.RGB10_A2,[zt.RGBA_INTEGER]:t.RGB10_A2UI},[yi.UNSIGNED_INT_10F_11F_11F_REV]:{[zt.RGB]:t.R11F_G11F_B10F},[yi.UNSIGNED_INT_5_9_9_9_REV]:{[zt.RGB]:t.RGB9_E5},[yi.UNSIGNED_INT_24_8]:{[zt.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[yi.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[zt.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:e={[yi.UNSIGNED_BYTE]:{[zt.RGBA]:t.RGBA,[zt.RGB]:t.RGB,[zt.ALPHA]:t.ALPHA,[zt.LUMINANCE]:t.LUMINANCE,[zt.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[yi.UNSIGNED_SHORT_5_6_5]:{[zt.RGB]:t.RGB},[yi.UNSIGNED_SHORT_4_4_4_4]:{[zt.RGBA]:t.RGBA},[yi.UNSIGNED_SHORT_5_5_5_1]:{[zt.RGBA]:t.RGBA}},e}var _2=class{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new ui,this.hasIntegerTextures=!1}contextChange(){let e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=ZR(e);let i=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=i;for(let s=0;s<i;s++)this.boundTextures[s]=null;this.emptyTextures={};let r=new xd(e.createTexture());e.bindTexture(e.TEXTURE_2D,r.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=r,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new xd(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(e,i=0){let{gl:r}=this;if(e=e==null?void 0:e.castToBaseTexture(),e!=null&&e.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;let s=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[i]!==e&&(this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),r.bindTexture(e.target,s.texture)),s.dirtyId!==e.dirtyId?(this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),this.updateTexture(e)):s.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[i]=e}else this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[i]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){let{gl:i,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<r.length;s++)r[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<r.length;s++)r[s]===e&&(this.currentLocation!==s&&(i.activeTexture(i.TEXTURE0+s),this.currentLocation=s),i.bindTexture(e.target,this.emptyTextures[e.target].texture),r[s]=null)}ensureSamplerType(e){let{boundTextures:i,hasIntegerTextures:r,CONTEXT_UID:s}=this;if(r)for(let n=e-1;n>=0;--n){let o=i[n];o&&o._glTextures[s].samplerType!==B8.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(e){let i=new xd(this.gl.createTexture());return i.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=i,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),i}initTextureType(e,i){var r,s;i.internalFormat=(s=(r=this.internalFormats[e.type])==null?void 0:r[e.format])!=null?s:e.format,this.webGLVersion===2&&e.type===yi.HALF_FLOAT?i.type=this.gl.HALF_FLOAT:i.type=e.type}updateTexture(e){var s;let i=e._glTextures[this.CONTEXT_UID];if(!i)return;let r=this.renderer;if(this.initTextureType(e,i),(s=e.resource)!=null&&s.upload(r,e,i))i.samplerType!==B8.FLOAT&&(this.hasIntegerTextures=!0);else{let n=e.realWidth,o=e.realHeight,a=r.gl;(i.width!==n||i.height!==o||i.dirtyId<0)&&(i.width=n,i.height=o,a.texImage2D(e.target,0,i.internalFormat,n,o,0,e.format,i.type,null))}e.dirtyStyleId!==i.dirtyStyleId&&this.updateTextureStyle(e),i.dirtyId=e.dirtyId}destroyTexture(e,i){let{gl:r}=this;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),r.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!i)){let s=this.managedTextures.indexOf(e);s!==-1&&Z8(this.managedTextures,s,1)}}updateTextureStyle(e){var r;let i=e._glTextures[this.CONTEXT_UID];i&&((e.mipmap===An.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?i.mipmap=!1:i.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?i.wrapMode=_a.CLAMP:i.wrapMode=e.wrapMode,(r=e.resource)!=null&&r.style(this.renderer,e,i)||this.setStyle(e,i),i.dirtyStyleId=e.dirtyStyleId)}setStyle(e,i){let r=this.gl;if(i.mipmap&&e.mipmap!==An.ON_MANUAL&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,i.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,i.wrapMode),i.mipmap){r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===io.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);let s=this.renderer.context.extensions.anisotropicFiltering;if(s&&e.anisotropicLevel>0&&e.scaleMode===io.LINEAR){let n=Math.min(e.anisotropicLevel,r.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(e.target,s.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===io.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode===io.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}};_2.extension={type:gt.RendererSystem,name:"texture"};Tt.add(_2);var x2=class{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){let{gl:i,CONTEXT_UID:r}=this,s=e._glTransformFeedbacks[r]||this.createGLTransformFeedback(e);i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,s)}unbind(){let{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,i){let{gl:r,renderer:s}=this;i&&s.shader.bind(i),r.beginTransformFeedback(e)}endTransformFeedback(){let{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){let{gl:i,renderer:r,CONTEXT_UID:s}=this,n=i.createTransformFeedback();e._glTransformFeedbacks[s]=n,i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,n);for(let o=0;o<e.buffers.length;o++){let a=e.buffers[o];a&&(r.buffer.update(a),a._glBuffers[s].refCount++,i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[s].buffer||null))}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),n}disposeTransformFeedback(e,i){let r=e._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this);let n=this.renderer.buffer;if(n)for(let o=0;o<e.buffers.length;o++){let a=e.buffers[o];if(!a)continue;let l=a._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!i&&n.dispose(a,i))}r&&(i||s.deleteTransformFeedback(r),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}};x2.extension={type:gt.RendererSystem,name:"transformFeedback"};Tt.add(x2);var Uu=class{constructor(e){this.renderer=e}init(e){this.screen=new ri(0,0,e.width,e.height),this.element=e.view||ht.ADAPTER.createCanvas(),this.resolution=e.resolution||ht.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,i){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(i*this.resolution);let r=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=r,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",r,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){var i;e&&((i=this.element.parentNode)==null||i.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}};Uu.defaultOptions={width:800,height:600,resolution:ht.RESOLUTION,autoDensity:!1};Uu.extension={type:[gt.RendererSystem,gt.CanvasRendererSystem],name:"_view"};Tt.add(Uu);ht.PREFER_ENV=jo.WEBGL2;ht.STRICT_TEXTURE_CACHE=!1;ht.RENDER_OPTIONS=di(di(di(di({},Ou.defaultOptions),Nu.defaultOptions),Uu.defaultOptions),Bu.defaultOptions);Object.defineProperties(ht,{WRAP_MODE:{get(){return ui.defaultOptions.wrapMode},set(t){rr("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),ui.defaultOptions.wrapMode=t}},SCALE_MODE:{get(){return ui.defaultOptions.scaleMode},set(t){rr("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),ui.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get(){return ui.defaultOptions.mipmap},set(t){rr("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),ui.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get(){return ui.defaultOptions.anisotropicLevel},set(t){rr("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),ui.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get(){return rr("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Wt.defaultResolution},set(t){Wt.defaultResolution=t}},FILTER_MULTISAMPLE:{get(){return rr("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Wt.defaultMultisample},set(t){Wt.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get(){return Va.defaultMaxTextures},set(t){rr("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Va.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get(){return Va.defaultBatchSize},set(t){rr("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Va.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get(){return Va.canUploadSameBuffer},set(t){rr("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Va.canUploadSameBuffer=t}},GC_MODE:{get(){return ba.defaultMode},set(t){rr("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),ba.defaultMode=t}},GC_MAX_IDLE:{get(){return ba.defaultMaxIdle},set(t){rr("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),ba.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get(){return ba.defaultCheckCountMax},set(t){rr("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),ba.defaultCheckCountMax=t}},PRECISION_VERTEX:{get(){return qn.defaultVertexPrecision},set(t){rr("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),qn.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get(){return qn.defaultFragmentPrecision},set(t){rr("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),qn.defaultFragmentPrecision=t}}});var Xa=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(Xa||{});var v2=class{constructor(e,i=null,r=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=i,this.priority=r,this.once=s}match(e,i=null){return this.fn===e&&this.context===i}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));let i=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),i}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);let i=this.next;return this.next=e?null:i,this.previous=null,i}};var Wa=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new v2(null,null,1/0),this.deltaMS=1/Wa.targetFPMS,this.elapsedMS=1/Wa.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=Xa.NORMAL){return this._addListener(new v2(t,e,i))}addOnce(t,e,i=Xa.NORMAL){return this._addListener(new v2(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){let s=t-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=t-s%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Wa.targetFPMS;let i=this._head,r=i.next;for(;r;)r=r.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){let e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,Wa.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{let e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Wa._shared){let t=Wa._shared=new Wa;t.autoStart=!0,t._protected=!0}return Wa._shared}static get system(){if(!Wa._system){let t=Wa._system=new Wa;t.autoStart=!0,t._protected=!0}return Wa._system}},Hs=Wa;Hs.targetFPMS=.06;Object.defineProperties(ht,{TARGET_FPMS:{get(){return Hs.targetFPMS},set(t){rr("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Hs.targetFPMS=t}}});var I5=class{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(i){this._ticker&&this._ticker.remove(this.render,this),this._ticker=i,i&&i.add(this.render,this,Xa.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Hs.shared:new Hs,e.autoStart&&this.start()}static destroy(){if(this._ticker){let e=this._ticker;this.ticker=null,e.destroy()}}};I5.extension=gt.Application;Tt.add(I5);var QR=[];Tt.handleByList(gt.Renderer,QR);function tE(t){for(let e of QR)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}var KR=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`;var JR=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var iE=KR,k5=JR;var M5=class{constructor(e){this.renderer=e}contextChange(e){let i;if(this.renderer.context.webGLVersion===1){let r=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),i=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,r)}else{let r=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),i=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,r)}i>=Zr.HIGH?this.multisample=Zr.HIGH:i>=Zr.MEDIUM?this.multisample=Zr.MEDIUM:i>=Zr.LOW?this.multisample=Zr.LOW:this.multisample=Zr.NONE}destroy(){}};M5.extension={type:gt.RendererSystem,name:"_multisample"};Tt.add(M5);var xg=class{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}};var P5=class{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){let{gl:i,CONTEXT_UID:r}=this,s=e._glBuffers[r]||this.createGLBuffer(e);i.bindBuffer(e.type,s.buffer)}unbind(e){let{gl:i}=this;i.bindBuffer(e,null)}bindBufferBase(e,i){let{gl:r,CONTEXT_UID:s}=this;if(this.boundBufferBases[i]!==e){let n=e._glBuffers[s]||this.createGLBuffer(e);this.boundBufferBases[i]=e,r.bindBufferBase(r.UNIFORM_BUFFER,i,n.buffer)}}bindBufferRange(e,i,r){let{gl:s,CONTEXT_UID:n}=this;r=r||0;let o=e._glBuffers[n]||this.createGLBuffer(e);s.bindBufferRange(s.UNIFORM_BUFFER,i||0,o.buffer,r*256,256)}update(e){let{gl:i,CONTEXT_UID:r}=this,s=e._glBuffers[r]||this.createGLBuffer(e);if(e._updateID!==s.updateID)if(s.updateID=e._updateID,i.bindBuffer(e.type,s.buffer),s.byteLength>=e.data.byteLength)i.bufferSubData(e.type,0,e.data);else{let n=e.static?i.STATIC_DRAW:i.DYNAMIC_DRAW;s.byteLength=e.data.byteLength,i.bufferData(e.type,e.data,n)}}dispose(e,i){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];let r=e._glBuffers[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this),r&&(i||s.deleteBuffer(r.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){let i=Object.keys(this.managedBuffers);for(let r=0;r<i.length;r++)this.dispose(this.managedBuffers[i[r]],e)}createGLBuffer(e){let{CONTEXT_UID:i,gl:r}=this;return e._glBuffers[i]=new xg(r.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[i]}};P5.extension={type:gt.RendererSystem,name:"buffer"};Tt.add(P5);var R5=class{constructor(e){this.renderer=e}render(e,i){let r=this.renderer,s,n,o,a;if(i&&(s=i.renderTexture,n=i.clear,o=i.transform,a=i.skipUpdateTransform),this.renderingToScreen=!s,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=o,!r.context.isLost){if(s||(this.lastObjectRendered=e),!a){let l=e.enableTempParent();e.updateTransform(),e.disableTempParent(l)}r.renderTexture.bind(s),r.batch.currentRenderer.start(),(n!=null?n:r.background.clearBeforeRender)&&r.renderTexture.clear(),e.render(r),r.batch.currentRenderer.flush(),s&&(i.blit&&r.framebuffer.blit(),s.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}};R5.extension={type:gt.RendererSystem,name:"objectRenderer"};Tt.add(R5);var rE=class extends y2{constructor(t){super(),this.type=mw.WEBGL,t=Object.assign({},ht.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Jo({projectionMatrix:new fr},!0);let e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:rE.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(rr("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=rE.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t!=null&&t.forceCanvas?!1:W8()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return rr("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return rr("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return rr("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return rr("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){rr("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return rr("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){rr("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return rr("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}},vd=rE;vd.extension={type:gt.Renderer,priority:1};vd.__plugins={};vd.__systems={};Tt.handleByMap(gt.RendererPlugin,vd.__plugins);Tt.handleByMap(gt.RendererSystem,vd.__systems);Tt.add(vd);var sh=class extends Zo{constructor(e,i){let{width:r,height:s}=i||{};super(r,s),this.items=[],this.itemDirtyIds=[];for(let n=0;n<e;n++){let o=new ui;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,i){for(let r=0;r<this.length;r++)e[r]&&(e[r].castToBaseTexture?this.addBaseTextureAt(e[r].castToBaseTexture(),r):e[r]instanceof Zo?this.addResourceAt(e[r],r):this.addResourceAt(Kf(e[r],i),r))}dispose(){for(let e=0,i=this.length;e<i;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,i){if(!this.items[i])throw new Error(`Index ${i} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[i].setResource(e),this}bind(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let i=0;i<this.length;i++)this.items[i].parentTextureArray=e,this.items[i].on("update",e.update,e)}unbind(e){super.unbind(e);for(let i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",e.update,e)}load(){if(this._load)return this._load;let i=this.items.map(r=>r.resource).filter(r=>r).map(r=>r.load());return this._load=Promise.all(i).then(()=>{let{realWidth:r,realHeight:s}=this.items[0];return this.resize(r,s),Promise.resolve(this)}),this._load}};var b2=class extends sh{constructor(e,i){let{width:r,height:s}=i||{},n,o;Array.isArray(e)?(n=e,o=e.length):o=e,super(o,{width:r,height:s}),n&&this.initFromArray(n,i)}addBaseTextureAt(e,i){if(e.resource)this.addResourceAt(e.resource,i);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(e){super.bind(e),e.target=Du.TEXTURE_2D_ARRAY}upload(e,i,r){let{length:s,itemDirtyIds:n,items:o}=this,{gl:a}=e;r.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,s,0,i.format,r.type,null);for(let l=0;l<s;l++){let c=o[l];n[l]<c.dirtyId&&(n[l]=c.dirtyId,c.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,l,c.resource.width,c.resource.height,1,i.format,r.type,c.resource.source))}return!0}};var w2=class extends oo{constructor(e){super(e)}static test(e){let{OffscreenCanvas:i}=globalThis;return i&&e instanceof i?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}};var D5=class extends sh{constructor(t,e){let{width:i,height:r,autoLoad:s,linkBaseTexture:n}=e||{};if(t&&t.length!==D5.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:r});for(let o=0;o<D5.SIDES;o++)this.items[o].target=Du.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=n!==!1,t&&this.initFromArray(t,e),s!==!1&&this.load()}bind(t){super.bind(t),t.target=Du.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=Du.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,i){let r=this.itemDirtyIds;for(let s=0;s<D5.SIDES;s++){let n=this.items[s];(r[s]<n.dirtyId||i.dirtyId<e.dirtyId)&&(n.valid&&n.resource?(n.resource.upload(t,n,i),r[s]=n.dirtyId):r[s]<-1&&(t.gl.texImage2D(n.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),r[s]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===D5.SIDES}},F5=D5;F5.SIDES=6;var E2=class t extends oo{constructor(e,i){var n;i=i||{};let r,s;typeof e=="string"?(r=t.EMPTY,s=e):(r=e,s=null),super(r),this.url=s,this.crossOrigin=(n=i.crossOrigin)!=null?n:!0,this.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,this._load=null,i.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise((e,i)=>ii(this,null,function*(){if(this.url===null){e(this);return}try{let r=yield ht.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;let s=yield r.blob();if(this.destroyed)return;let n=yield createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===tn.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=n,this.update(),e(this)}catch(r){if(this.destroyed)return;i(r),this.onError.emit(r)}})),this._load)}upload(e,i,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),super.upload(e,i,r)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap!="undefined"&&(typeof e=="string"||e instanceof ImageBitmap)}static get EMPTY(){var e;return t._EMPTY=(e=t._EMPTY)!=null?e:ht.ADAPTER.createCanvas(0,0),t._EMPTY}};var vg=class extends oo{constructor(t,e){e=e||{},super(ht.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),t(this)},vg.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){let t=new Image;oo.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;let e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=e*this.scale,s=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/i*e,s=this._overrideHeight||this._overrideWidth/e*i),r=Math.round(r),s=Math.round(s);let n=this.source;n.width=r,n.height=s,n._pixiId=`canvas_${Nc()}`,n.getContext("2d").drawImage(t,0,0,e,i,0,0,r,s),this._resolve(),this._resolve=null}}static getSize(t){let e=vg.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&vg.SVG_XML.test(t)}},nc=vg;nc.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;nc.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var sE=class extends oo{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){let i=document.createElement("video");i.setAttribute("preload","auto"),i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline",""),typeof t=="string"&&(t=[t]);let r=t[0].src||t[0];oo.crossOrigin(i,r,e.crossorigin);for(let s=0;s<t.length;++s){let n=document.createElement("source"),{src:o,mime:a}=t[s];o=o||t[s];let l=o.split("?").shift().toLowerCase(),c=l.slice(l.lastIndexOf(".")+1);a=a||sE.MIME_TYPES[c]||`video/${c}`,n.src=o,n.type=a,i.appendChild(n)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){let e=Hs.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;let t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise(e=>{this.valid?e(this):(this._resolve=e,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)}_isSourcePlaying(){let t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Hs.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Hs.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){let t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);let e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._isConnectedToTicker&&(Hs.shared.remove(this.update,this),this._isConnectedToTicker=!1);let t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Hs.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Hs.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t)}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||sE.TYPES.includes(e)}},T2=sE;T2.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];T2.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};Qf.push(E2,ih,w2,T2,nc,va,F5,b2);var Bc=class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?ri.EMPTY:(e=e||new ri(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,i){let{a:r,b:s,c:n,d:o,tx:a,ty:l}=e,c=r*i.x+n*i.y+a,d=s*i.x+o*i.y+l;this.minX=Math.min(this.minX,c),this.maxX=Math.max(this.maxX,c),this.minY=Math.min(this.minY,d),this.maxY=Math.max(this.maxY,d)}addQuad(e){let i=this.minX,r=this.minY,s=this.maxX,n=this.maxY,o=e[0],a=e[1];i=o<i?o:i,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=e[2],a=e[3],i=o<i?o:i,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=e[4],a=e[5],i=o<i?o:i,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=e[6],a=e[7],i=o<i?o:i,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,this.minX=i,this.minY=r,this.maxX=s,this.maxY=n}addFrame(e,i,r,s,n){this.addFrameMatrix(e.worldTransform,i,r,s,n)}addFrameMatrix(e,i,r,s,n){let o=e.a,a=e.b,l=e.c,c=e.d,d=e.tx,m=e.ty,g=this.minX,_=this.minY,v=this.maxX,E=this.maxY,b=o*i+l*r+d,T=a*i+c*r+m;g=b<g?b:g,_=T<_?T:_,v=b>v?b:v,E=T>E?T:E,b=o*s+l*r+d,T=a*s+c*r+m,g=b<g?b:g,_=T<_?T:_,v=b>v?b:v,E=T>E?T:E,b=o*i+l*n+d,T=a*i+c*n+m,g=b<g?b:g,_=T<_?T:_,v=b>v?b:v,E=T>E?T:E,b=o*s+l*n+d,T=a*s+c*n+m,g=b<g?b:g,_=T<_?T:_,v=b>v?b:v,E=T>E?T:E,this.minX=g,this.minY=_,this.maxX=v,this.maxY=E}addVertexData(e,i,r){let s=this.minX,n=this.minY,o=this.maxX,a=this.maxY;for(let l=i;l<r;l+=2){let c=e[l],d=e[l+1];s=c<s?c:s,n=d<n?d:n,o=c>o?c:o,a=d>a?d:a}this.minX=s,this.minY=n,this.maxX=o,this.maxY=a}addVertices(e,i,r,s){this.addVerticesMatrix(e.worldTransform,i,r,s)}addVerticesMatrix(e,i,r,s,n=0,o=n){let a=e.a,l=e.b,c=e.c,d=e.d,m=e.tx,g=e.ty,_=this.minX,v=this.minY,E=this.maxX,b=this.maxY;for(let T=r;T<s;T+=2){let A=i[T],M=i[T+1],k=a*A+c*M+m,F=d*M+l*A+g;_=Math.min(_,k-n),E=Math.max(E,k+n),v=Math.min(v,F-o),b=Math.max(b,F+o)}this.minX=_,this.minY=v,this.maxX=E,this.maxY=b}addBounds(e){let i=this.minX,r=this.minY,s=this.maxX,n=this.maxY;this.minX=e.minX<i?e.minX:i,this.minY=e.minY<r?e.minY:r,this.maxX=e.maxX>s?e.maxX:s,this.maxY=e.maxY>n?e.maxY:n}addBoundsMask(e,i){let r=e.minX>i.minX?e.minX:i.minX,s=e.minY>i.minY?e.minY:i.minY,n=e.maxX<i.maxX?e.maxX:i.maxX,o=e.maxY<i.maxY?e.maxY:i.maxY;if(r<=n&&s<=o){let a=this.minX,l=this.minY,c=this.maxX,d=this.maxY;this.minX=r<a?r:a,this.minY=s<l?s:l,this.maxX=n>c?n:c,this.maxY=o>d?o:d}}addBoundsMatrix(e,i){this.addFrameMatrix(i,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,i){let r=e.minX>i.x?e.minX:i.x,s=e.minY>i.y?e.minY:i.y,n=e.maxX<i.x+i.width?e.maxX:i.x+i.width,o=e.maxY<i.y+i.height?e.maxY:i.y+i.height;if(r<=n&&s<=o){let a=this.minX,l=this.minY,c=this.maxX,d=this.maxY;this.minX=r<a?r:a,this.minY=s<l?s:l,this.maxX=n>c?n:c,this.maxY=o>d?o:d}}pad(e=0,i=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=i,this.maxY+=i)}addFramePad(e,i,r,s,n,o){e-=n,i-=o,r+=n,s+=o,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<i?this.minY:i,this.maxY=this.maxY>s?this.maxY:s}};var jr=class t extends St.EventEmitter{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new gd,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Bc,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){let i=Object.keys(e);for(let r=0;r<i.length;++r){let s=i[r];Object.defineProperty(t.prototype,s,Object.getOwnPropertyDescriptor(e,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,i){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),i||(this._boundsRect||(this._boundsRect=new ri),i=this._boundsRect),this._bounds.getRectangle(i)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new ri),e=this._localBoundsRect),this._localBounds||(this._localBounds=new Bc);let i=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;let s=this._bounds,n=this._boundsID;this._bounds=this._localBounds;let o=this.getBounds(!1,e);return this.parent=r,this.transform=i,this._bounds=s,this._bounds.updateID+=this._boundsID-n,o}toGlobal(e,i,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,i)}toLocal(e,i,r,s){return i&&(e=i.toGlobal(e,r,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,r)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e=0,i=0,r=1,s=1,n=0,o=0,a=0,l=0,c=0){return this.position.x=e,this.position.y=i,this.scale.x=r||1,this.scale.y=s||1,this.rotation=n,this.skew.x=o,this.skew.y=a,this.pivot.x=l,this.pivot.y=c,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new bg),this.tempDisplayObjectParent}enableTempParent(){let e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*Vw}set angle(e){this.transform.rotation=e*ic}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex=e,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){let i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount--,i._maskRefCount===0&&(i.renderable=!0,i.isMask=!1))}if(this._mask=e,this._mask){let i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount===0&&(i.renderable=!1,i.isMask=!0),i._maskRefCount++)}}}},bg=class extends jr{constructor(){super(...arguments),this.sortDirty=null}};jr.prototype.displayObjectUpdateTransform=jr.prototype.updateTransform;var qj=new fr;function Yj(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}var nE=class extends jr{constructor(){super(),this.children=[],this.sortableChildren=nE.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{let e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;let i=this.getChildIndex(t),r=this.getChildIndex(e);this.children[i]=e,this.children[r]=t,this.onChildrenChange(i<r?i:r)}getChildIndex(t){let e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);let i=this.getChildIndex(t);St.removeItems(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{let e=t[0],i=this.children.indexOf(e);if(i===-1)return null;e.parent=null,e.transform._parentID=-1,St.removeItems(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this),this.emit("childRemoved",e,this,i)}return t[0]}removeChildAt(t){let e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,St.removeItems(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){let i=t,r=e,s=r-i,n;if(s>0&&s<=r){n=this.children.splice(i,s);for(let o=0;o<n.length;++o)n[o].parent=null,n[o].transform&&(n[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let o=0;o<n.length;++o)n[o].emit("removed",this),this.emit("childRemoved",n[o],this,o);return n}else if(s===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,i=this.children.length;e<i;++e){let r=this.children[e];r._lastSortedIndex=e,!t&&r.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(Yj),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){let i=this.children[t];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){let e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){let i=e._mask.isMaskData?e._mask.maskObject:e._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(e._bounds,i._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){let i=super.getLocalBounds(t);if(!e)for(let r=0,s=this.children.length;r<s;++r){let n=this.children[r];n.visible&&n.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(t){let e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let i,r;this.cullArea?(i=this.cullArea,r=this.worldTransform):this._render!==nE.prototype._render&&(i=this.getBounds(!0));let s=t.projection.transform;if(s&&(r?(r=qj.copyFrom(r),r.prepend(s)):r=s),i&&e.intersects(i,r))this._render(t);else if(this.cullArea)return;for(let n=0,o=this.children.length;n<o;++n){let a=this.children[n],l=a.cullable;a.cullable=l||!this.cullArea,a.render(t),a.cullable=l}}render(t){var e;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(e=this.filters)!=null&&e.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let i=0,r=this.children.length;i<r;++i)this.children[i].render(t)}}renderAdvanced(t){var s,n,o;let e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let a=0;a<e.length;a++)e[a].enabled&&this._enabledFilters.push(e[a])}let r=e&&((s=this._enabledFilters)==null?void 0:s.length)||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==rn.NONE));if(r&&t.batch.flush(),e&&((n=this._enabledFilters)!=null&&n.length)&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let a=0,l=this.children.length;a<l;++a)this.children[a].render(t)}r&&t.batch.flush(),i&&t.mask.pop(this),e&&((o=this._enabledFilters)!=null&&o.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;let e=typeof t=="boolean"?t:t==null?void 0:t.children,i=this.removeChildren(0,this.children.length);if(e)for(let r=0;r<i.length;++r)i[r].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){let e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){let e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}},Qi=nE;Qi.defaultSortableChildren=!1;Qi.prototype.containerUpdateTransform=Qi.prototype.updateTransform;Object.defineProperties(ht,{SORTABLE_CHILDREN:{get(){return Qi.defaultSortableChildren},set(t){St.deprecation("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Qi.defaultSortableChildren=t}}});var L5=new ei,Zj=new Uint16Array([0,1,2,0,2,3]),rs=class t extends Qi{constructor(e){super(),this._anchor=new Ko(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new mi(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=ki.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||Yt.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Zj,this.pluginName="batch",this.isSprite=!0,this._roundPixels=ht.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=St.sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=St.sign(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){let e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;let i=this.transform.worldTransform,r=i.a,s=i.b,n=i.c,o=i.d,a=i.tx,l=i.ty,c=this.vertexData,d=e.trim,m=e.orig,g=this._anchor,_=0,v=0,E=0,b=0;if(d?(v=d.x-g._x*m.width,_=v+d.width,b=d.y-g._y*m.height,E=b+d.height):(v=-g._x*m.width,_=v+m.width,b=-g._y*m.height,E=b+m.height),c[0]=r*v+n*b+a,c[1]=o*b+s*v+l,c[2]=r*_+n*b+a,c[3]=o*b+s*_+l,c[4]=r*_+n*E+a,c[5]=o*E+s*_+l,c[6]=r*v+n*E+a,c[7]=o*E+s*v+l,this._roundPixels){let T=ht.RESOLUTION;for(let A=0;A<c.length;++A)c[A]=Math.round(c[A]*T)/T}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;let e=this._texture,i=this.vertexTrimmedData,r=e.orig,s=this._anchor,n=this.transform.worldTransform,o=n.a,a=n.b,l=n.c,c=n.d,d=n.tx,m=n.ty,g=-s._x*r.width,_=g+r.width,v=-s._y*r.height,E=v+r.height;i[0]=o*g+l*v+d,i[1]=c*v+a*g+m,i[2]=o*_+l*v+d,i[3]=c*v+a*_+m,i[4]=o*_+l*E+d,i[5]=c*E+a*_+m,i[6]=o*g+l*E+d,i[7]=c*E+a*g+m}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){let e=this._texture.trim,i=this._texture.orig;!e||e.width===i.width&&e.height===i.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return this.children.length===0?(this._localBounds||(this._localBounds=new Bc),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new ri),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,L5);let i=this._texture.orig.width,r=this._texture.orig.height,s=-i*this.anchor.x,n=0;return L5.x>=s&&L5.x<s+i&&(n=-r*this.anchor.y,L5.y>=n&&L5.y<n+r)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof e=="boolean"?e:e==null?void 0:e.texture){let r=typeof e=="boolean"?e:e==null?void 0:e.baseTexture;this._texture.destroy(!!r)}this._texture=null}static from(e,i){let r=e instanceof Yt?e:Yt.from(e,i);return new t(r)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){let i=St.sign(this.scale.x)||1;this.scale.x=i*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){let i=St.sign(this.scale.y)||1;this.scale.y=i*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||Yt.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}};var eD=new fr;jr.prototype._cacheAsBitmap=!1;jr.prototype._cacheData=null;jr.prototype._cacheAsBitmapResolution=null;jr.prototype._cacheAsBitmapMultisample=null;var oE=class{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}};Object.defineProperties(jr.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;this._cacheAsBitmap=t;let e;t?(this._cacheData||(this._cacheData=new oE),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}});jr.prototype._renderCached=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))};jr.prototype._initCachedDisplayObject=function(e){var g,_,v;if((g=this._cacheData)!=null&&g.sprite)return;let i=this.alpha;this.alpha=1,e.batch.flush();let r=this.getLocalBounds(null,!0).clone();if((_=this.filters)!=null&&_.length){let E=this.filters[0].padding;r.pad(E)}r.ceil(ht.RESOLUTION);let s=e.renderTexture.current,n=e.renderTexture.sourceFrame.clone(),o=e.renderTexture.destinationFrame.clone(),a=e.projection.transform,l=ja.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||e.resolution,multisample:(v=this.cacheAsBitmapMultisample)!=null?v:e.multisample}),c=`cacheAsBitmap_${St.uid()}`;this._cacheData.textureCacheId=c,ui.addToCache(l.baseTexture,c),Yt.addToCache(l,c);let d=this.transform.localTransform.copyTo(eD).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,e.render(this,{renderTexture:l,clear:!0,transform:d,skipUpdateTransform:!1}),e.framebuffer.blit(),e.projection.transform=a,e.renderTexture.bind(s,n,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;let m=new rs(l);m.transform.worldTransform=this.transform.worldTransform,m.anchor.x=-(r.x/r.width),m.anchor.y=-(r.y/r.height),m.alpha=i,m._bounds=this._bounds,this._cacheData.sprite=m,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=m.containsPoint.bind(m)};jr.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))};jr.prototype._initCachedDisplayObjectCanvas=function(e){var d;if((d=this._cacheData)!=null&&d.sprite)return;let i=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;let s=e.canvasContext.activeContext,n=e._projTransform;i.ceil(ht.RESOLUTION);let o=ja.create({width:i.width,height:i.height}),a=`cacheAsBitmap_${St.uid()}`;this._cacheData.textureCacheId=a,ui.addToCache(o.baseTexture,a),Yt.addToCache(o,a);let l=eD;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=i.x,l.ty-=i.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,{renderTexture:o,clear:!0,transform:l,skipUpdateTransform:!1}),e.canvasContext.activeContext=s,e._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;let c=new rs(o);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-(i.x/i.width),c.anchor.y=-(i.y/i.height),c.alpha=r,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=c.containsPoint.bind(c)};jr.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};jr.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};jr.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,ui.removeFromCache(this._cacheData.textureCacheId),Yt.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};jr.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)};jr.prototype.name=null;Qi.prototype.getChildByName=function(e,i){for(let r=0,s=this.children.length;r<s;r++)if(this.children[r].name===e)return this.children[r];if(i)for(let r=0,s=this.children.length;r<s;r++){let n=this.children[r];if(!n.getChildByName)continue;let o=n.getChildByName(e,!0);if(o)return o}return null};jr.prototype.getGlobalPosition=function(e=new ei,i=!1){return this.parent?this.parent.toGlobal(this.position,e,i):(e.x=this.position.x,e.y=this.position.y),e};var tD=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;var S2=class extends Wt{constructor(e=1){super(iE,tD,{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}};var Qj={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Kj=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function iD(t){let e=Qj[t],i=e.length,r=Kj,s="",n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;",o;for(let a=0;a<t;a++){let l=n.replace("%index%",a.toString());o=a,a>=i&&(o=t-a-1),l=l.replace("%value%",e[o].toString()),s+=l,s+=`
`}return r=r.replace("%blur%",s),r=r.replace("%size%",t.toString()),r}var Jj=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function rD(t,e){let i=Math.ceil(t/2),r=Jj,s="",n;e?n="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":n="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<t;o++){let a=n.replace("%index%",o.toString());a=a.replace("%sampleIndex%",`${o-(i-1)}.0`),s+=a,s+=`
`}return r=r.replace("%blur%",s),r=r.replace("%size%",t.toString()),r}var zu=class extends Wt{constructor(e,i=8,r=4,s=Wt.defaultResolution,n=5){let o=rD(n,e),a=iD(n);super(o,a),this.horizontal=e,this.resolution=s,this._quality=0,this.quality=r,this.blur=i}apply(e,i,r,s){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/i.width):this.uniforms.strength=1/r.height*(r.height/i.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/i.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/i.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)e.applyFilter(this,i,r,s);else{let n=e.getFilterTexture(),o=e.renderer,a=i,l=n;this.state.blend=!1,e.applyFilter(this,a,l,$a.CLEAR);for(let c=1;c<this.passes-1;c++){e.bindAndClear(a,$a.BLIT),this.uniforms.uSampler=l;let d=l;l=a,a=d,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,l,r,s),e.returnFilterTexture(n)}}get blur(){return this.strength}set blur(e){this.padding=1+Math.abs(e)*2,this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}};var N5=class extends Wt{constructor(e=8,i=4,r=Wt.defaultResolution,s=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new zu(!0,e,i,r,s),this.blurYFilter=new zu(!1,e,i,r,s),this.resolution=r,this.quality=i,this.blur=e,this.repeatEdgePixels=!1}apply(e,i,r,s){let n=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(n&&o){let a=e.getFilterTexture();this.blurXFilter.apply(e,i,a,$a.CLEAR),this.blurYFilter.apply(e,a,r,s),e.returnFilterTexture(a)}else o?this.blurYFilter.apply(e,i,r,s):this.blurXFilter.apply(e,i,r,s)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}};var sD=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;var bd=class extends Wt{constructor(){let e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(k5,sD,e),this.alpha=1}_loadMatrix(e,i=!1){let r=e;i&&(this._multiply(r,this.uniforms.m,e),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(e,i,r){return e[0]=i[0]*r[0]+i[1]*r[5]+i[2]*r[10]+i[3]*r[15],e[1]=i[0]*r[1]+i[1]*r[6]+i[2]*r[11]+i[3]*r[16],e[2]=i[0]*r[2]+i[1]*r[7]+i[2]*r[12]+i[3]*r[17],e[3]=i[0]*r[3]+i[1]*r[8]+i[2]*r[13]+i[3]*r[18],e[4]=i[0]*r[4]+i[1]*r[9]+i[2]*r[14]+i[3]*r[19]+i[4],e[5]=i[5]*r[0]+i[6]*r[5]+i[7]*r[10]+i[8]*r[15],e[6]=i[5]*r[1]+i[6]*r[6]+i[7]*r[11]+i[8]*r[16],e[7]=i[5]*r[2]+i[6]*r[7]+i[7]*r[12]+i[8]*r[17],e[8]=i[5]*r[3]+i[6]*r[8]+i[7]*r[13]+i[8]*r[18],e[9]=i[5]*r[4]+i[6]*r[9]+i[7]*r[14]+i[8]*r[19]+i[9],e[10]=i[10]*r[0]+i[11]*r[5]+i[12]*r[10]+i[13]*r[15],e[11]=i[10]*r[1]+i[11]*r[6]+i[12]*r[11]+i[13]*r[16],e[12]=i[10]*r[2]+i[11]*r[7]+i[12]*r[12]+i[13]*r[17],e[13]=i[10]*r[3]+i[11]*r[8]+i[12]*r[13]+i[13]*r[18],e[14]=i[10]*r[4]+i[11]*r[9]+i[12]*r[14]+i[13]*r[19]+i[14],e[15]=i[15]*r[0]+i[16]*r[5]+i[17]*r[10]+i[18]*r[15],e[16]=i[15]*r[1]+i[16]*r[6]+i[17]*r[11]+i[18]*r[16],e[17]=i[15]*r[2]+i[16]*r[7]+i[17]*r[12]+i[18]*r[17],e[18]=i[15]*r[3]+i[16]*r[8]+i[17]*r[13]+i[18]*r[18],e[19]=i[15]*r[4]+i[16]*r[9]+i[17]*r[14]+i[18]*r[19]+i[19],e}_colorMatrix(e){let i=new Float32Array(e);return i[4]/=255,i[9]/=255,i[14]/=255,i[19]/=255,i}brightness(e,i){let r=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(r,i)}tint(e,i){let[r,s,n]=mi.shared.setValue(e).toArray(),o=[r,0,0,0,0,0,s,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(o,i)}greyscale(e,i){let r=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(r,i)}blackAndWhite(e){let i=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(i,e)}hue(e,i){e=(e||0)/180*Math.PI;let r=Math.cos(e),s=Math.sin(e),n=Math.sqrt,o=1/3,a=n(o),l=r+(1-r)*o,c=o*(1-r)-a*s,d=o*(1-r)+a*s,m=o*(1-r)+a*s,g=r+o*(1-r),_=o*(1-r)-a*s,v=o*(1-r)-a*s,E=o*(1-r)+a*s,b=r+o*(1-r),T=[l,c,d,0,0,m,g,_,0,0,v,E,b,0,0,0,0,0,1,0];this._loadMatrix(T,i)}contrast(e,i){let r=(e||0)+1,s=-.5*(r-1),n=[r,0,0,0,s,0,r,0,0,s,0,0,r,0,s,0,0,0,1,0];this._loadMatrix(n,i)}saturate(e=0,i){let r=e*2/3+1,s=(r-1)*-.5,n=[r,s,s,0,0,s,r,s,0,0,s,s,r,0,0,0,0,0,1,0];this._loadMatrix(n,i)}desaturate(){this.saturate(-1)}negative(e){let i=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(i,e)}sepia(e){let i=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(i,e)}technicolor(e){let i=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(i,e)}polaroid(e){let i=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(i,e)}toBGR(e){let i=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(i,e)}kodachrome(e){let i=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(i,e)}browni(e){let i=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(i,e)}vintage(e){let i=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(i,e)}colorTone(e,i,r,s,n){e=e||.2,i=i||.15,r=r||16770432,s=s||3375104;let o=mi.shared,[a,l,c]=o.setValue(r).toArray(),[d,m,g]=o.setValue(s).toArray(),_=[.3,.59,.11,0,0,a,l,c,e,0,d,m,g,i,0,a-d,l-m,c-g,0,0];this._loadMatrix(_,n)}night(e,i){e=e||.1;let r=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(r,i)}predator(e,i){let r=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(r,i)}lsd(e){let i=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(i,e)}reset(){let e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}};bd.prototype.grayscale=bd.prototype.greyscale;var nD=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`;var oD=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;var O5=class extends Wt{constructor(e,i){let r=new fr;e.renderable=!1,super(oD,nD,{mapSampler:e._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=r,i==null&&(i=20),this.scale=new ei(i,i)}apply(e,i,r,s){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;let n=this.maskSprite.worldTransform,o=Math.sqrt(n.a*n.a+n.b*n.b),a=Math.sqrt(n.c*n.c+n.d*n.d);o!==0&&a!==0&&(this.uniforms.rotation[0]=n.a/o,this.uniforms.rotation[1]=n.b/o,this.uniforms.rotation[2]=n.c/a,this.uniforms.rotation[3]=n.d/a),e.applyFilter(this,i,r,s)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}};var aD=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`;var lD=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;var B5=class extends Wt{constructor(){super(lD,aD)}};var cD=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;var U5=class extends Wt{constructor(e=.5,i=Math.random()){super(k5,cD,{uNoise:0,uSeed:0}),this.noise=e,this.seed=i}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}};var z5={AlphaFilter:S2,BlurFilter:N5,BlurFilterPass:zu,ColorMatrixFilter:bd,DisplacementFilter:O5,FXAAFilter:B5,NoiseFilter:U5};Object.entries(z5).forEach(([t,e])=>{Object.defineProperty(z5,t,{get(){return St.deprecation("7.1.0",`filters.${t} has moved to ${t}`),e}})});var aE=class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(Hs.system.add(this.tickerUpdate,this,Xa.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Hs.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}let e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&e.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}},Uc=new aE;var Gu=class t{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=t.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new ei,this.page=new ei,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,i,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,i,r,s,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}};var zc=class extends Gu{constructor(){super(...arguments),this.client=new ei,this.movement=new ei,this.offset=new ei,this.global=new ei,this.screen=new ei}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,i,r){return e.worldTransform.applyInverse(r||this.global,i)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,i,r,s,n,o,a,l,c,d,m,g,_,v,E){throw new Error("Method not implemented.")}};var bo=class extends zc{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}};var oc=class extends zc{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}};oc.DOM_DELTA_PIXEL=0;oc.DOM_DELTA_LINE=1;oc.DOM_DELTA_PAGE=2;var eX=2048,tX=new ei,lE=new ei,G5=class{constructor(e){this.dispatch=new St.EventEmitter,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,i){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:i,priority:0}),this.mappingTable[e].sort((r,s)=>r.priority-s.priority)}dispatchEvent(e,i){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,i),this.dispatch.emit(i||e.type,e)}mapEvent(e){if(!this.rootTarget)return;let i=this.mappingTable[e.type];if(i)for(let r=0,s=i.length;r<s;r++)i[r].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,i){Uc.pauseUpdate=!0;let s=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",n=this[s](this.rootTarget,this.rootTarget.eventMode,tX.set(e,i),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(e,i){if(!e.target)return;let r=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let s=0,n=r.length-1;s<n;s++)if(e.currentTarget=r[s],this.notifyTarget(e,i),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,i),!(e.propagationStopped||e.propagationImmediatelyStopped)){e.eventPhase=e.BUBBLING_PHASE;for(let s=r.length-2;s>=0;s--)if(e.currentTarget=r[s],this.notifyTarget(e,i),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,i,r=this._allInteractiveElements){if(r.length===0)return;e.eventPhase=e.BUBBLING_PHASE;let s=Array.isArray(i)?i:[i];for(let n=r.length-1;n>=0;n--)s.forEach(o=>{e.currentTarget=r[n],this.notifyTarget(e,o)})}propagationPath(e){let i=[e];for(let r=0;r<eX&&e!==this.rootTarget;r++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");i.push(e.parent),e=e.parent}return i.reverse(),i}hitTestMoveRecursive(e,i,r,s,n,o=!1){let a=!1;if(this._interactivePrune(e))return null;if((e.eventMode==="dynamic"||i==="dynamic")&&(Uc.pauseUpdate=!1),e.interactiveChildren&&e.children){let d=e.children;for(let m=d.length-1;m>=0;m--){let g=d[m],_=this.hitTestMoveRecursive(g,this._isInteractive(i)?i:g.eventMode,r,s,n,o||n(e,r));if(_){if(_.length>0&&!_[_.length-1].parent)continue;let v=e.isInteractive();(_.length>0||v)&&(v&&this._allInteractiveElements.push(e),_.push(e)),this._hitElements.length===0&&(this._hitElements=_),a=!0}}}let l=this._isInteractive(i),c=e.isInteractive();return c&&c&&this._allInteractiveElements.push(e),o||this._hitElements.length>0?null:a?this._hitElements:l&&!n(e,r)&&s(e,r)?c?[e]:[]:null}hitTestRecursive(e,i,r,s,n){if(this._interactivePrune(e)||n(e,r))return null;if((e.eventMode==="dynamic"||i==="dynamic")&&(Uc.pauseUpdate=!1),e.interactiveChildren&&e.children){let l=e.children;for(let c=l.length-1;c>=0;c--){let d=l[c],m=this.hitTestRecursive(d,this._isInteractive(i)?i:d.eventMode,r,s,n);if(m){if(m.length>0&&!m[m.length-1].parent)continue;let g=e.isInteractive();return(m.length>0||g)&&m.push(e),m}}}let o=this._isInteractive(i),a=e.isInteractive();return o&&s(e,r)?a?[e]:[]:null}_isInteractive(e){return e==="static"||e==="dynamic"}_interactivePrune(e){return!!(!e||e.isMask||!e.visible||!e.renderable||e.eventMode==="none"||e.eventMode==="passive"&&!e.interactiveChildren||e.isMask)}hitPruneFn(e,i){var r;if(e.hitArea&&(e.worldTransform.applyInverse(i,lE),!e.hitArea.contains(lE.x,lE.y)))return!0;if(e._mask){let s=e._mask.isMaskData?e._mask.maskObject:e._mask;if(s&&!((r=s.containsPoint)!=null&&r.call(s,i)))return!0}return!1}hitTestFn(e,i){return e.eventMode==="passive"?!1:e.hitArea?!0:e.containsPoint?e.containsPoint(i):!1}notifyTarget(e,i){var n,o;i=i!=null?i:e.type;let r=`on${i}`;(o=(n=e.currentTarget)[r])==null||o.call(n,e);let s=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${i}capture`:i;this.notifyListeners(e,s),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,i)}mapPointerDown(e){if(!(e instanceof bo)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let i=this.createPointerEvent(e);if(this.dispatchEvent(i,"pointerdown"),i.pointerType==="touch")this.dispatchEvent(i,"touchstart");else if(i.pointerType==="mouse"||i.pointerType==="pen"){let s=i.button===2;this.dispatchEvent(i,s?"rightdown":"mousedown")}let r=this.trackingData(e.pointerId);r.pressTargetsByButton[e.button]=i.composedPath(),this.freeEvent(i)}mapPointerMove(e){var l,c,d;if(!(e instanceof bo)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;let i=this.createPointerEvent(e);this._isPointerMoveEvent=!1;let r=i.pointerType==="mouse"||i.pointerType==="pen",s=this.trackingData(e.pointerId),n=this.findMountedTarget(s.overTargets);if(((l=s.overTargets)==null?void 0:l.length)>0&&n!==i.target){let m=e.type==="mousemove"?"mouseout":"pointerout",g=this.createPointerEvent(e,m,n);if(this.dispatchEvent(g,"pointerout"),r&&this.dispatchEvent(g,"mouseout"),!i.composedPath().includes(n)){let _=this.createPointerEvent(e,"pointerleave",n);for(_.eventPhase=_.AT_TARGET;_.target&&!i.composedPath().includes(_.target);)_.currentTarget=_.target,this.notifyTarget(_),r&&this.notifyTarget(_,"mouseleave"),_.target=_.target.parent;this.freeEvent(_)}this.freeEvent(g)}if(n!==i.target){let m=e.type==="mousemove"?"mouseover":"pointerover",g=this.clonePointerEvent(i,m);this.dispatchEvent(g,"pointerover"),r&&this.dispatchEvent(g,"mouseover");let _=n==null?void 0:n.parent;for(;_&&_!==this.rootTarget.parent&&_!==i.target;)_=_.parent;if(!_||_===this.rootTarget.parent){let E=this.clonePointerEvent(i,"pointerenter");for(E.eventPhase=E.AT_TARGET;E.target&&E.target!==n&&E.target!==this.rootTarget.parent;)E.currentTarget=E.target,this.notifyTarget(E),r&&this.notifyTarget(E,"mouseenter"),E.target=E.target.parent;this.freeEvent(E)}this.freeEvent(g)}let o=[],a=(c=this.enableGlobalMoveEvents)!=null?c:!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(i,"pointermove"),a&&o.push("globalpointermove"),i.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(i,"touchmove"),a&&o.push("globaltouchmove")),r&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(i,"mousemove"),a&&o.push("globalmousemove"),this.cursor=(d=i.target)==null?void 0:d.cursor),o.length>0&&this.all(i,o),this._allInteractiveElements.length=0,this._hitElements.length=0,s.overTargets=i.composedPath(),this.freeEvent(i)}mapPointerOver(e){var o;if(!(e instanceof bo)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let i=this.trackingData(e.pointerId),r=this.createPointerEvent(e),s=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),s&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=(o=r.target)==null?void 0:o.cursor);let n=this.clonePointerEvent(r,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),s&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;i.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(n)}mapPointerOut(e){if(!(e instanceof bo)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let i=this.trackingData(e.pointerId);if(i.overTargets){let r=e.pointerType==="mouse"||e.pointerType==="pen",s=this.findMountedTarget(i.overTargets),n=this.createPointerEvent(e,"pointerout",s);this.dispatchEvent(n),r&&this.dispatchEvent(n,"mouseout");let o=this.createPointerEvent(e,"pointerleave",s);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),r&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;i.overTargets=null,this.freeEvent(n),this.freeEvent(o)}this.cursor=null}mapPointerUp(e){if(!(e instanceof bo)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let i=performance.now(),r=this.createPointerEvent(e);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){let a=r.button===2;this.dispatchEvent(r,a?"rightup":"mouseup")}let s=this.trackingData(e.pointerId),n=this.findMountedTarget(s.pressTargetsByButton[e.button]),o=n;if(n&&!r.composedPath().includes(n)){let a=n;for(;a&&!r.composedPath().includes(a);){if(r.currentTarget=a,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){let l=r.button===2;this.notifyTarget(r,l?"rightupoutside":"mouseupoutside")}a=a.parent}delete s.pressTargetsByButton[e.button],o=a}if(o){let a=this.clonePointerEvent(r,"click");a.target=o,a.path=null,s.clicksByButton[e.button]||(s.clicksByButton[e.button]={clickCount:0,target:a.target,timeStamp:i});let l=s.clicksByButton[e.button];if(l.target===a.target&&i-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=a.target,l.timeStamp=i,a.detail=l.clickCount,a.pointerType==="mouse"){let c=a.button===2;this.dispatchEvent(a,c?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(r)}mapPointerUpOutside(e){if(!(e instanceof bo)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let i=this.trackingData(e.pointerId),r=this.findMountedTarget(i.pressTargetsByButton[e.button]),s=this.createPointerEvent(e);if(r){let n=r;for(;n;)s.currentTarget=n,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch"?this.notifyTarget(s,"touchendoutside"):(s.pointerType==="mouse"||s.pointerType==="pen")&&this.notifyTarget(s,s.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete i.pressTargetsByButton[e.button]}this.freeEvent(s)}mapWheel(e){if(!(e instanceof oc)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}let i=this.createWheelEvent(e);this.dispatchEvent(i),this.freeEvent(i)}findMountedTarget(e){if(!e)return null;let i=e[0];for(let r=1;r<e.length&&e[r].parent===i;r++)i=e[r];return i}createPointerEvent(e,i,r){var n;let s=this.allocateEvent(bo);return this.copyPointerData(e,s),this.copyMouseData(e,s),this.copyData(e,s),s.nativeEvent=e.nativeEvent,s.originalEvent=e,s.target=(n=r!=null?r:this.hitTest(s.global.x,s.global.y))!=null?n:this._hitElements[0],typeof i=="string"&&(s.type=i),s}createWheelEvent(e){let i=this.allocateEvent(oc);return this.copyWheelData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.nativeEvent=e.nativeEvent,i.originalEvent=e,i.target=this.hitTest(i.global.x,i.global.y),i}clonePointerEvent(e,i){let r=this.allocateEvent(bo);return r.nativeEvent=e.nativeEvent,r.originalEvent=e.originalEvent,this.copyPointerData(e,r),this.copyMouseData(e,r),this.copyData(e,r),r.target=e.target,r.path=e.composedPath().slice(),r.type=i!=null?i:r.type,r}copyWheelData(e,i){i.deltaMode=e.deltaMode,i.deltaX=e.deltaX,i.deltaY=e.deltaY,i.deltaZ=e.deltaZ}copyPointerData(e,i){e instanceof bo&&i instanceof bo&&(i.pointerId=e.pointerId,i.width=e.width,i.height=e.height,i.isPrimary=e.isPrimary,i.pointerType=e.pointerType,i.pressure=e.pressure,i.tangentialPressure=e.tangentialPressure,i.tiltX=e.tiltX,i.tiltY=e.tiltY,i.twist=e.twist)}copyMouseData(e,i){e instanceof zc&&i instanceof zc&&(i.altKey=e.altKey,i.button=e.button,i.buttons=e.buttons,i.client.copyFrom(e.client),i.ctrlKey=e.ctrlKey,i.metaKey=e.metaKey,i.movement.copyFrom(e.movement),i.screen.copyFrom(e.screen),i.shiftKey=e.shiftKey,i.global.copyFrom(e.global))}copyData(e,i){i.isTrusted=e.isTrusted,i.srcElement=e.srcElement,i.timeStamp=performance.now(),i.type=e.type,i.detail=e.detail,i.view=e.view,i.which=e.which,i.layer.copyFrom(e.layer),i.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);let i=this.eventPool.get(e).pop()||new e(this);return i.eventPhase=i.NONE,i.currentTarget=null,i.path=null,i.target=null,i}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");let i=e.constructor;this.eventPool.has(i)||this.eventPool.set(i,[]),this.eventPool.get(i).push(e)}notifyListeners(e,i){let r=e.currentTarget._events[i];if(r&&e.currentTarget.isInteractive())if("fn"in r)r.once&&e.currentTarget.removeListener(i,r.fn,void 0,!0),r.fn.call(r.context,e);else for(let s=0,n=r.length;s<n&&!e.propagationImmediatelyStopped;s++)r[s].once&&e.currentTarget.removeListener(i,r[s].fn,void 0,!0),r[s].fn.call(r[s].context,e)}};var iX=1,rX={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},cE=class{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new G5(null),Uc.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new bo(null),this.rootWheelEvent=new oc(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy(di({},cE.defaultEventFeatures),{set:(e,i,r)=>(i==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=r),e[i]=r,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){var r,s;let{view:e,resolution:i}=this.renderer;this.setTargetElement(e),this.resolution=i,cE._defaultEventMode=(r=t.eventMode)!=null?r:"auto",Object.assign(this.features,(s=t.eventFeatures)!=null?s:{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;let i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch"))return;let e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let i=0,r=e.length;i<r;i++){let s=e[i],n=this.bootstrapEvent(this.rootPointerEvent,s);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch"))return;Uc.pointerMoved();let e=this.normalizeToPointerData(t);for(let i=0,r=e.length;i<r;i++){let s=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch"))return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);let i=e!==this.domElement?"outside":"",r=this.normalizeToPointerData(t);for(let s=0,n=r.length;s<n;s++){let o=this.bootstrapEvent(this.rootPointerEvent,r[s]);o.type+=i,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch"))return;let e=this.normalizeToPointerData(t);for(let i=0,r=e.length;i<r;i++){let s=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;let e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,Uc.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Uc.addTickerListener();let t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Uc.removeTickerListener();let t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){let r;this.domElement.parentElement?r=this.domElement.getBoundingClientRect():r={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};let s=1/this.resolution;t.x=(e-r.left)*(this.domElement.width/r.width)*s,t.y=(i-r.top)*(this.domElement.height/r.height)*s}normalizeToPointerData(t){let e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,r=t.changedTouches.length;i<r;i++){let s=t.changedTouches[i];typeof s.button=="undefined"&&(s.button=0),typeof s.buttons=="undefined"&&(s.buttons=1),typeof s.isPrimary=="undefined"&&(s.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof s.width=="undefined"&&(s.width=s.radiusX||1),typeof s.height=="undefined"&&(s.height=s.radiusY||1),typeof s.tiltX=="undefined"&&(s.tiltX=0),typeof s.tiltY=="undefined"&&(s.tiltY=0),typeof s.pointerType=="undefined"&&(s.pointerType="touch"),typeof s.pointerId=="undefined"&&(s.pointerId=s.identifier||0),typeof s.pressure=="undefined"&&(s.pressure=s.force||.5),typeof s.twist=="undefined"&&(s.twist=0),typeof s.tangentialPressure=="undefined"&&(s.tangentialPressure=0),typeof s.layerX=="undefined"&&(s.layerX=s.offsetX=s.clientX),typeof s.layerY=="undefined"&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=t.type,e.push(s)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){let i=t;typeof i.isPrimary=="undefined"&&(i.isPrimary=!0),typeof i.width=="undefined"&&(i.width=1),typeof i.height=="undefined"&&(i.height=1),typeof i.tiltX=="undefined"&&(i.tiltX=0),typeof i.tiltY=="undefined"&&(i.tiltY=0),typeof i.pointerType=="undefined"&&(i.pointerType="mouse"),typeof i.pointerId=="undefined"&&(i.pointerId=iX),typeof i.pressure=="undefined"&&(i.pressure=.5),typeof i.twist=="undefined"&&(i.twist=0),typeof i.tangentialPressure=="undefined"&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){let e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=rX[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}},wd=cE;wd.extension={name:"events",type:[gt.RendererSystem,gt.CanvasRendererSystem]};wd.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};Tt.add(wd);function uD(t){return t==="dynamic"||t==="static"}var hD={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){var t;return(t=this._internalInteractive)!=null?t:uD(wd.defaultEventMode)},set interactive(t){St.deprecation("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=t,this.eventMode=t?"static":"auto"},_internalEventMode:void 0,get eventMode(){var t;return(t=this._internalEventMode)!=null?t:wd.defaultEventMode},set eventMode(t){this._internalInteractive=uD(t),this._internalEventMode=t},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(t,e,i){let r=typeof i=="boolean"&&i||typeof i=="object"&&i.capture,s=typeof e=="function"?void 0:e;t=r?`${t}capture`:t,e=typeof e=="function"?e:e.handleEvent,this.on(t,e,s)},removeEventListener(t,e,i){let r=typeof i=="boolean"&&i||typeof i=="object"&&i.capture,s=typeof e=="function"?void 0:e;t=r?`${t}capture`:t,e=typeof e=="function"?e:e.handleEvent,this.off(t,e,s)},dispatchEvent(t){if(!(t instanceof Gu))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};jr.mixin(hD);var uE={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};jr.mixin(uE);var sX=9,wg=100,nX=0,oX=0,dD=2,fD=1,aX=-1e3,lX=-1e3,cX=2,$5=class{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(St.isMobile.tablet||St.isMobile.phone)&&this.createTouchHook();let i=document.createElement("div");i.style.width=`${wg}px`,i.style.height=`${wg}px`,i.style.position="absolute",i.style.top=`${nX}px`,i.style.left=`${oX}px`,i.style.zIndex=dD.toString(),this.div=i,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){let e=document.createElement("button");e.style.width=`${fD}px`,e.style.height=`${fD}px`,e.style.position="absolute",e.style.top=`${aX}px`,e.style.left=`${lX}px`,e.style.zIndex=cX.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var e;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(e=this.renderer.view.parentNode)==null||e.appendChild(this.div))}deactivate(){var e;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(e=this.div.parentNode)==null||e.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);let i=e.children;if(i)for(let r=0;r<i.length;r++)this.updateAccessibleObjects(i[r])}update(){let e=performance.now();if(St.isMobile.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);let{x:i,y:r,width:s,height:n}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:l}=this.renderer,c=s/o*l,d=n/a*l,m=this.div;m.style.left=`${i}px`,m.style.top=`${r}px`,m.style.width=`${o}px`,m.style.height=`${a}px`;for(let g=0;g<this.children.length;g++){let _=this.children[g];if(_.renderId!==this.renderId)_._accessibleActive=!1,St.removeItems(this.children,g,1),this.div.removeChild(_._accessibleDiv),this.pool.push(_._accessibleDiv),_._accessibleDiv=null,g--;else{m=_._accessibleDiv;let v=_.hitArea,E=_.worldTransform;_.hitArea?(m.style.left=`${(E.tx+v.x*E.a)*c}px`,m.style.top=`${(E.ty+v.y*E.d)*d}px`,m.style.width=`${v.width*E.a*c}px`,m.style.height=`${v.height*E.d*d}px`):(v=_.getBounds(),this.capHitArea(v),m.style.left=`${v.x*c}px`,m.style.top=`${v.y*d}px`,m.style.width=`${v.width*c}px`,m.style.height=`${v.height*d}px`,m.title!==_.accessibleTitle&&_.accessibleTitle!==null&&(m.title=_.accessibleTitle),m.getAttribute("aria-label")!==_.accessibleHint&&_.accessibleHint!==null&&m.setAttribute("aria-label",_.accessibleHint)),(_.accessibleTitle!==m.title||_.tabIndex!==m.tabIndex)&&(m.title=_.accessibleTitle,m.tabIndex=_.tabIndex,this.debug&&this.updateDebugHTML(m))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);let{width:i,height:r}=this.renderer;e.x+e.width>i&&(e.width=i-e.x),e.y+e.height>r&&(e.height=r-e.y)}addChild(e){let i=this.pool.pop();i||(i=document.createElement("button"),i.style.width=`${wg}px`,i.style.height=`${wg}px`,i.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",i.style.position="absolute",i.style.zIndex=dD.toString(),i.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?i.setAttribute("aria-live","off"):i.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?i.setAttribute("aria-relevant","additions"):i.setAttribute("aria-relevant","text"),i.addEventListener("click",this._onClick.bind(this)),i.addEventListener("focus",this._onFocus.bind(this)),i.addEventListener("focusout",this._onFocusOut.bind(this))),i.style.pointerEvents=e.accessiblePointerEvents,i.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?i.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(i.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&e.accessibleHint!==null&&i.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(i),e._accessibleActive=!0,e._accessibleDiv=i,i.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,i){let{displayObject:r}=e.target,s=this.renderer.events.rootBoundary,n=Object.assign(new Gu(s),{target:r});s.rootTarget=this.renderer.lastObjectRendered,i.forEach(o=>s.dispatchEvent(n,o))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){e.keyCode===sX&&this.activate()}_onMouseMove(e){e.movementX===0&&e.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}};$5.extension={name:"accessibility",type:[gt.RendererPlugin,gt.CanvasRendererPlugin]};Tt.add($5);var hE=class{constructor(t){this.stage=new Qi,t=Object.assign({forceCanvas:!1},t),this.renderer=tE(t),hE._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(t,e){let i=hE._plugins.slice(0);i.reverse(),i.forEach(r=>{r.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}},Ed=hE;Ed._plugins=[];Tt.handleByList(gt.Application,Ed._plugins);var H5=class{static init(e){Object.defineProperty(this,"resizeTo",{set(i){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=i,i&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let i,r;if(this._resizeTo===globalThis.window)i=globalThis.innerWidth,r=globalThis.innerHeight;else{let{clientWidth:s,clientHeight:n}=this._resizeTo;i=s,r=n}this.renderer.resize(i,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}};H5.extension=gt.Application;Tt.add(H5);var pD={loader:gt.LoadParser,resolver:gt.ResolveParser,cache:gt.CacheParser,detection:gt.DetectionParser};Tt.handle(gt.Asset,t=>{let e=t.ref;Object.entries(pD).filter(([i])=>!!e[i]).forEach(([i,r])=>{var s;return Tt.add(Object.assign(e[i],{extension:(s=e[i].extension)!=null?s:r}))})},t=>{let e=t.ref;Object.keys(pD).filter(i=>!!e[i]).forEach(i=>Tt.remove(e[i]))});var Eg=class{constructor(e,i=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=i}add(e){e.forEach(i=>{this._assetList.push(i)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}_next(){return ii(this,null,function*(){if(this._assetList.length&&this._isActive){this._isLoading=!0;let e=[],i=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<i;r++)e.push(this._assetList.pop());yield this._loader.load(e),this._isLoading=!1,this._next()}})}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}};function wl(t,e){if(Array.isArray(e)){for(let i of e)if(t.startsWith(`data:${i}`))return!0;return!1}return t.startsWith(`data:${e}`)}function wo(t,e){let i=t.split("?")[0],r=St.path.extname(i).toLowerCase();return Array.isArray(e)?e.includes(r):r===e}var ea=(t,e)=>(Array.isArray(t)||(t=[t]),e?t.map(i=>typeof i=="string"?e(i):i):t);var Td=(t,e)=>{let i=e.split("?")[1];return i&&(t+=`?${i}`),t};function mD(t,e,i,r,s){let n=e[i];for(let o=0;o<n.length;o++){let a=n[o];i<e.length-1?mD(t.replace(r[i],a),e,i+1,r,s):s.push(t.replace(r[i],a))}}function Tg(t){let e=/\{(.*?)\}/g,i=t.match(e),r=[];if(i){let s=[];i.forEach(n=>{let o=n.substring(1,n.length-1).split(",");s.push(o)}),mD(t,s,0,i,r)}else r.push(t);return r}var $u=t=>!Array.isArray(t);var dE=class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){let i=this._cache.get(e);return i||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),i}set(e,i){let r=ea(e),s;for(let a=0;a<this.parsers.length;a++){let l=this.parsers[a];if(l.test(i)){s=l.getCacheableAssets(r,i);break}}s||(s={},r.forEach(a=>{s[a]=i}));let n=Object.keys(s),o={cacheKeys:n,keys:r};if(r.forEach(a=>{this._cacheMap.set(a,o)}),n.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==i&&console.warn("[Cache] already has key:",a),this._cache.set(a,s[a])}),i instanceof Yt){let a=i;r.forEach(l=>{a.baseTexture!==Yt.EMPTY.baseTexture&&ui.addToCache(a.baseTexture,l),Yt.addToCache(a,l)})}}remove(e){if(this._cacheMap.get(e),!this._cacheMap.has(e)){console.warn(`[Assets] Asset id ${e} was not found in the Cache`);return}let i=this._cacheMap.get(e);i.cacheKeys.forEach(s=>{this._cache.delete(s)}),i.keys.forEach(s=>{this._cacheMap.delete(s)})}get parsers(){return this._parsers}},nh=new dE;var Sg=class{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,i,r)=>(this._parsersValidated=!1,e[i]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,i){let r={promise:null,parser:null};return r.promise=(()=>ii(this,null,function*(){var o,a;let s=null,n=null;if(i.loadParser&&(n=this._parserHash[i.loadParser],n||console.warn(`[Assets] specified load parser "${i.loadParser}" not found while loading ${e}`)),!n){for(let l=0;l<this.parsers.length;l++){let c=this.parsers[l];if(c.load&&((o=c.test)!=null&&o.call(c,e,i,this))){n=c;break}}if(!n)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}s=yield n.load(e,i,this),r.parser=n;for(let l=0;l<this.parsers.length;l++){let c=this.parsers[l];c.parse&&c.parse&&(yield(a=c.testParse)==null?void 0:a.call(c,s,i,this))&&(s=(yield c.parse(s,i,this))||s,r.parser=c)}return s}))(),r}load(e,i){return ii(this,null,function*(){this._parsersValidated||this._validateParsers();let r=0,s={},n=$u(e),o=ea(e,c=>({src:c})),a=o.length,l=o.map(c=>ii(this,null,function*(){let d=St.path.toAbsolute(c.src);if(!s[c.src])try{this.promiseCache[d]||(this.promiseCache[d]=this._getLoadPromiseAndParser(d,c)),s[c.src]=yield this.promiseCache[d].promise,i&&i(++r/a)}catch(m){throw delete this.promiseCache[d],delete s[c.src],new Error(`[Loader.load] Failed to load ${d}.
${m}`)}}));return yield Promise.all(l),n?s[o[0].src]:s})}unload(e){return ii(this,null,function*(){let r=ea(e,s=>({src:s})).map(s=>ii(this,null,function*(){var a,l;let n=St.path.toAbsolute(s.src),o=this.promiseCache[n];if(o){let c=yield o.promise;(l=(a=o.parser)==null?void 0:a.unload)==null||l.call(a,c,s,this),delete this.promiseCache[n]}}));yield Promise.all(r)})}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,i)=>(e[i.name]&&console.warn(`[Assets] loadParser name conflict "${i.name}"`),Tn(di({},e),{[i.name]:i})),{})}};var pn=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(pn||{});var uX=".json",hX="application/json",fE={extension:{type:gt.LoadParser,priority:pn.Low},name:"loadJson",test(t){return wl(t,hX)||wo(t,uX)},load(t){return ii(this,null,function*(){return yield(yield ht.ADAPTER.fetch(t)).json()})}};Tt.add(fE);var dX=".txt",fX="text/plain",pE={name:"loadTxt",extension:{type:gt.LoadParser,priority:pn.Low},test(t){return wl(t,fX)||wo(t,dX)},load(t){return ii(this,null,function*(){return yield(yield ht.ADAPTER.fetch(t)).text()})}};Tt.add(pE);var pX=["normal","bold","100","200","300","400","500","600","700","800","900"],mX=[".ttf",".otf",".woff",".woff2"],gX=["font/ttf","font/otf","font/woff","font/woff2"],yX=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function mE(t){let e=St.path.extname(t),s=St.path.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1)),n=s.length>0;for(let a of s)if(!a.match(yX)){n=!1;break}let o=s.join(" ");return n||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}var gE={extension:{type:gt.LoadParser,priority:pn.Low},name:"loadWebFont",test(t){return wl(t,gX)||wo(t,mX)},load(t,e){return ii(this,null,function*(){var r,s,n,o,a,l;let i=ht.ADAPTER.getFontFaceSet();if(i){let c=[],d=(s=(r=e.data)==null?void 0:r.family)!=null?s:mE(t),m=(a=(o=(n=e.data)==null?void 0:n.weights)==null?void 0:o.filter(_=>pX.includes(_)))!=null?a:["normal"],g=(l=e.data)!=null?l:{};for(let _=0;_<m.length;_++){let v=m[_],E=new FontFace(d,`url(${encodeURI(t)})`,Tn(di({},g),{weight:v}));yield E.load(),i.add(E),c.push(E)}return c.length===1?c[0]:c}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null})},unload(t){(Array.isArray(t)?t:[t]).forEach(e=>ht.ADAPTER.getFontFaceSet().delete(e))}};Tt.add(gE);var gD=0,yE,_X="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",xX={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${_X}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},vX={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`},_E,xE=class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{let i=URL.createObjectURL(new Blob([xX.code],{type:"application/javascript"})),r=new Worker(i);r.addEventListener("message",s=>{r.terminate(),URL.revokeObjectURL(i),e(s.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}_initWorkers(){return ii(this,null,function*(){this._initialized||(this._initialized=!0)})}getWorker(){yE===void 0&&(yE=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<yE&&(_E||(_E=URL.createObjectURL(new Blob([vX.code],{type:"application/javascript"}))),this._createdWorkers++,e=new Worker(_E),e.addEventListener("message",i=>{this.complete(i.data),this.returnWorker(i.target),this.next()})),e}returnWorker(e){this.workerPool.push(e)}complete(e){e.error!==void 0?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}_run(e,i){return ii(this,null,function*(){yield this._initWorkers();let r=new Promise((s,n)=>{this.queue.push({id:e,arguments:i,resolve:s,reject:n})});return this.next(),r})}next(){if(!this.queue.length)return;let e=this.getWorker();if(!e)return;let i=this.queue.pop(),r=i.id;this.resolveHash[gD]={resolve:i.resolve,reject:i.reject},e.postMessage({data:i.arguments,uuid:gD++,id:r})}},vE=new xE;function Gc(t,e,i){let r=new Yt(t);return r.baseTexture.on("dispose",()=>{delete e.promiseCache[i]}),r}var bX=[".jpeg",".jpg",".png",".webp",".avif"],wX=["image/jpeg","image/png","image/webp","image/avif"];function bE(t){return ii(this,null,function*(){let e=yield ht.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);let i=yield e.blob();return yield createImageBitmap(i)})}var Hu={name:"loadTextures",extension:{type:gt.LoadParser,priority:pn.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(t){return wl(t,wX)||wo(t,bX)},load(t,e,i){return ii(this,null,function*(){let r=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&(yield vE.isImageBitmapSupported())?r=yield vE.loadImageBitmap(t):r=yield bE(t):r=yield new Promise(n=>{r=new Image,r.crossOrigin=this.config.crossOrigin,r.src=t,r.complete?n(r):r.onload=()=>{n(r)}});let s=new ui(r,di({resolution:St.getResolutionOfUrl(t)},e.data));return s.resource.src=t,Gc(s,i,t)})},unload(t){t.destroy(!0)}};Tt.add(Hu);var EX=".svg",TX="image/svg+xml",wE={extension:{type:gt.LoadParser,priority:pn.High},name:"loadSVG",test(t){return wl(t,TX)||wo(t,EX)},testParse(t){return ii(this,null,function*(){return nc.test(t)})},parse(t,e,i){return ii(this,null,function*(){var o;let r=new nc(t,(o=e==null?void 0:e.data)==null?void 0:o.resourceOptions);yield r.load();let s=new ui(r,di({resolution:St.getResolutionOfUrl(t)},e==null?void 0:e.data));return s.resource.src=t,Gc(s,i,t)})},load(t,e){return ii(this,null,function*(){return(yield ht.ADAPTER.fetch(t)).text()})},unload:Hu.unload};Tt.add(wE);var Ag=class{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,i)=>`${e}${this._bundleIdConnector}${i}`,extractAssetIdFromBundle:(e,i)=>i.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){var i,r,s;if(this._bundleIdConnector=(i=e.connector)!=null?i:this._bundleIdConnector,this._createBundleAssetId=(r=e.createBundleAssetId)!=null?r:this._createBundleAssetId,this._extractAssetIdFromBundle=(s=e.extractAssetIdFromBundle)!=null?s:this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(i=>{this._preferredOrder.push(i),i.priority||(i.priority=Object.keys(i.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{let i=e;this._defaultSearchParams=Object.keys(i).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(i[r])}`).join("&")}}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(i=>{this.addBundle(i.name,i.assets)})}addBundle(e,i){let r=[];Array.isArray(i)?i.forEach(s=>{if(typeof s.name=="string"){let n=this._createBundleAssetId(e,s.name);r.push(n),this.add([s.name,n],s.srcs,s.data)}else{let n=s.name.map(o=>this._createBundleAssetId(e,o));n.forEach(o=>{r.push(o)}),this.add([...s.name,...n],s.srcs)}}):Object.keys(i).forEach(s=>{r.push(this._createBundleAssetId(e,s)),this.add([s,this._createBundleAssetId(e,s)],i[s])}),this._bundles[e]=r}add(e,i,r){let s=ea(e);s.forEach(o=>{this.hasKey(o)&&console.warn(`[Resolver] already has key: ${o} overwriting`)}),Array.isArray(i)||(typeof i=="string"?i=Tg(i):i=[i]);let n=i.map(o=>{var l;let a=o;if(typeof o=="string"){let c=!1;for(let d=0;d<this._parsers.length;d++){let m=this._parsers[d];if(m.test(o)){a=m.parse(o),c=!0;break}}c||(a={src:o})}return a.format||(a.format=a.src.split(".").pop()),a.alias||(a.alias=s),(this._basePath||this._rootPath)&&(a.src=St.path.toAbsolute(a.src,this._basePath,this._rootPath)),a.src=this._appendDefaultSearchParams(a.src),a.data=(l=a.data)!=null?l:r,a});s.forEach(o=>{this._assetMap[o]=n})}resolveBundle(e){let i=$u(e);e=ea(e);let r={};return e.forEach(s=>{let n=this._bundles[s];if(n){let o=this.resolve(n),a={};for(let l in o){let c=o[l];a[this._extractAssetIdFromBundle(s,l)]=c}r[s]=a}}),i?r[e[0]]:r}resolveUrl(e){let i=this.resolve(e);if(typeof e!="string"){let r={};for(let s in i)r[s]=i[s].src;return r}return i.src}resolve(e){let i=$u(e);e=ea(e);let r={};return e.forEach(s=>{var n;if(!this._resolverHash[s])if(this._assetMap[s]){let o=this._assetMap[s],a=this._getPreferredOrder(o),l=o[0];a==null||a.priority.forEach(c=>{a.params[c].forEach(d=>{let m=o.filter(g=>g[c]?g[c]===d:!1);m.length&&(o=m)})}),this._resolverHash[s]=(n=o[0])!=null?n:l}else{let o=s;(this._basePath||this._rootPath)&&(o=St.path.toAbsolute(o,this._basePath,this._rootPath)),o=this._appendDefaultSearchParams(o),this._resolverHash[s]={src:o}}r[s]=this._resolverHash[s]}),i?r[e[0]]:r}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let i=0;i<e.length;i++){let r=e[0],s=this._preferredOrder.find(n=>n.params.format.includes(r.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;let i=/\?/.test(e)?"&":"?";return`${e}${i}${this._defaultSearchParams}`}};var Cg=class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Ag,this.loader=new Sg,this.cache=nh,this._backgroundLoader=new Eg(this.loader),this._backgroundLoader.active=!0,this.reset()}init(){return ii(this,arguments,function*(e={}){var n,o,a,l;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let c=e.manifest;typeof c=="string"&&(c=yield this.load(c)),this.resolver.addManifest(c)}let i=(o=(n=e.texturePreference)==null?void 0:n.resolution)!=null?o:1,r=typeof i=="number"?[i]:i,s=[];if((a=e.texturePreference)!=null&&a.format){let c=(l=e.texturePreference)==null?void 0:l.format;s=typeof c=="string"?[c]:c;for(let d of this._detections)(yield d.test())||(s=yield d.remove(s))}else for(let c of this._detections)(yield c.test())&&(s=yield c.add(s));this.resolver.prefer({params:{format:s,resolution:r}}),e.preferences&&this.setPreferences(e.preferences)})}add(e,i,r){this.resolver.add(e,i,r)}load(e,i){return ii(this,null,function*(){this._initialized||(yield this.init());let r=$u(e),s=ea(e).map(a=>typeof a!="string"?(this.resolver.add(a.src,a),a.src):(this.resolver.hasKey(a)||this.resolver.add(a,a),a)),n=this.resolver.resolve(s),o=yield this._mapLoadToResolve(n,i);return r?o[s[0]]:o})}addBundle(e,i){this.resolver.addBundle(e,i)}loadBundle(e,i){return ii(this,null,function*(){this._initialized||(yield this.init());let r=!1;typeof e=="string"&&(r=!0,e=[e]);let s=this.resolver.resolveBundle(e),n={},o=Object.keys(s),a=0,l=0,c=()=>{i==null||i(++a/l)},d=o.map(m=>{let g=s[m];return l+=Object.keys(g).length,this._mapLoadToResolve(g,c).then(_=>{n[m]=_})});return yield Promise.all(d),r?n[e[0]]:n})}backgroundLoad(e){return ii(this,null,function*(){this._initialized||(yield this.init()),typeof e=="string"&&(e=[e]);let i=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(i))})}backgroundLoadBundle(e){return ii(this,null,function*(){this._initialized||(yield this.init()),typeof e=="string"&&(e=[e]);let i=this.resolver.resolveBundle(e);Object.values(i).forEach(r=>{this._backgroundLoader.add(Object.values(r))})})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return nh.get(e);let i={};for(let r=0;r<e.length;r++)i[r]=nh.get(e[r]);return i}_mapLoadToResolve(e,i){return ii(this,null,function*(){let r=Object.values(e),s=Object.keys(e);this._backgroundLoader.active=!1;let n=yield this.loader.load(r,i);this._backgroundLoader.active=!0;let o={};return r.forEach((a,l)=>{let c=n[a.src],d=[a.src];a.alias&&d.push(...a.alias),o[s[l]]=c,nh.set(d,c)}),o})}unload(e){return ii(this,null,function*(){this._initialized||(yield this.init());let i=ea(e).map(s=>typeof s!="string"?s.src:s),r=this.resolver.resolve(i);yield this._unloadFromResolved(r)})}unloadBundle(e){return ii(this,null,function*(){this._initialized||(yield this.init()),e=ea(e);let i=this.resolver.resolveBundle(e),r=Object.keys(i).map(s=>this._unloadFromResolved(i[s]));yield Promise.all(r)})}_unloadFromResolved(e){return ii(this,null,function*(){let i=Object.values(e);i.forEach(r=>{nh.remove(r.src)}),yield this.loader.unload(i)})}get detections(){return this._detections}get preferWorkers(){return Hu.config.preferWorkers}set preferWorkers(e){St.deprecation("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach(i=>{i.config&&Object.keys(i.config).filter(r=>r in e).forEach(r=>{i.config[r]=e[r]})})}},oh=new Cg;Tt.handleByList(gt.LoadParser,oh.loader.parsers).handleByList(gt.ResolveParser,oh.resolver.parsers).handleByList(gt.CacheParser,oh.cache.parsers).handleByList(gt.DetectionParser,oh.detections);var EE={extension:gt.CacheParser,test:t=>Array.isArray(t)&&t.every(e=>e instanceof Yt),getCacheableAssets:(t,e)=>{let i={};return t.forEach(r=>{e.forEach((s,n)=>{i[r+(n===0?"":n+1)]=s})}),i}};Tt.add(EE);var TE={extension:{type:gt.DetectionParser,priority:1},test:()=>ii(void 0,null,function*(){if(!globalThis.createImageBitmap)return!1;let t="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",e=yield ht.ADAPTER.fetch(t).then(i=>i.blob());return createImageBitmap(e).then(()=>!0,()=>!1)}),add:t=>ii(void 0,null,function*(){return[...t,"avif"]}),remove:t=>ii(void 0,null,function*(){return t.filter(e=>e!=="avif")})};Tt.add(TE);var SE={extension:{type:gt.DetectionParser,priority:0},test:()=>ii(void 0,null,function*(){if(!globalThis.createImageBitmap)return!1;let t="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",e=yield ht.ADAPTER.fetch(t).then(i=>i.blob());return createImageBitmap(e).then(()=>!0,()=>!1)}),add:t=>ii(void 0,null,function*(){return[...t,"webp"]}),remove:t=>ii(void 0,null,function*(){return t.filter(e=>e!=="webp")})};Tt.add(SE);var yD=["png","jpg","jpeg"],AE={extension:{type:gt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:t=>ii(void 0,null,function*(){return[...t,...yD]}),remove:t=>ii(void 0,null,function*(){return t.filter(e=>!yD.includes(e))})};Tt.add(AE);var CE={extension:gt.ResolveParser,test:Hu.test,parse:t=>{var e,i;return{resolution:parseFloat((i=(e=ht.RETINA_PREFIX.exec(t))==null?void 0:e[1])!=null?i:"1"),format:t.split(".").pop(),src:t}}};Tt.add(CE);var ta=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t))(ta||{}),ah={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};var Vu,A2;function _D(){A2={s3tc:Vu.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Vu.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Vu.getExtension("WEBGL_compressed_texture_etc"),etc1:Vu.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Vu.getExtension("WEBGL_compressed_texture_pvrtc")||Vu.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Vu.getExtension("WEBGL_compressed_texture_atc"),astc:Vu.getExtension("WEBGL_compressed_texture_astc")}}var IE={extension:{type:gt.DetectionParser,priority:2},test:()=>ii(void 0,null,function*(){let e=ht.ADAPTER.createCanvas().getContext("webgl");return e?(Vu=e,!0):(console.warn("WebGL not available for compressed textures."),!1)}),add:t=>ii(void 0,null,function*(){A2||_D();let e=[];for(let i in A2)A2[i]&&e.push(i);return[...e,...t]}),remove:t=>ii(void 0,null,function*(){return A2||_D(),t.filter(e=>!(e in A2))})};Tt.add(IE);var C2=class extends va{constructor(e,i={width:1,height:1,autoLoad:!0}){let r,s;typeof e=="string"?(r=e,s=new Uint8Array):(r=null,s=e),super(s,i),this.origin=r,this.buffer=s?new Y1(s):null,this._load=null,this.loaded=!1,this.origin!==null&&i.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>(this.data=new Uint32Array(e),this.buffer=new Y1(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),this)),this._load)}};var ju=class t extends C2{constructor(e,i){super(e,i),this.format=i.format,this.levels=i.levels||1,this._width=i.width,this._height=i.height,this._extension=t._formatToExtension(this.format),(i.levelBuffers||this.buffer)&&(this._levelBuffers=i.levelBuffers||t._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,i,r){let s=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let o=0,a=this.levels;o<a;o++){let{levelID:l,levelWidth:c,levelHeight:d,levelBuffer:m}=this._levelBuffers[o];s.compressedTexImage2D(s.TEXTURE_2D,l,this.format,c,d,0,m)}return!0}onBlobLoaded(){this._levelBuffers=t._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(e>=36196)return"etc1";if(e>=35986&&e<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(e,i,r,s,n,o,a){let l=new Array(r),c=e.byteOffset,d=o,m=a,g=d+s-1&~(s-1),_=m+n-1&~(n-1),v=g*_*ah[i];for(let E=0;E<r;E++)l[E]={levelID:E,levelWidth:r>1?d:g,levelHeight:r>1?m:_,levelBuffer:new Uint8Array(e.buffer,c,v)},c+=v,d=d>>1||1,m=m>>1||1,g=d+s-1&~(s-1),_=m+n-1&~(n-1),v=g*_*ah[i];return l}};var kE=4,Ig=124,SX=32,xD=20,AX=542327876,kg={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},CX={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},Mg={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4};var IX=1,kX=2,MX=4,PX=64,RX=512,DX=131072,FX=827611204,LX=861165636,NX=894720068,OX=808540228,BX=4,UX={[FX]:ta.COMPRESSED_RGBA_S3TC_DXT1_EXT,[LX]:ta.COMPRESSED_RGBA_S3TC_DXT3_EXT,[NX]:ta.COMPRESSED_RGBA_S3TC_DXT5_EXT},zX={70:ta.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:ta.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:ta.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:ta.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:ta.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:ta.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:ta.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:ta.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:ta.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function Pg(t){let e=new Uint32Array(t);if(e[0]!==AX)throw new Error("Invalid DDS file magic word");let r=new Uint32Array(t,0,Ig/Uint32Array.BYTES_PER_ELEMENT),s=r[kg.HEIGHT],n=r[kg.WIDTH],o=r[kg.MIPMAP_COUNT],a=new Uint32Array(t,kg.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,SX/Uint32Array.BYTES_PER_ELEMENT),l=a[IX];if(l&MX){let c=a[CX.FOURCC];if(c!==OX){let M=UX[c],k=kE+Ig,F=new Uint8Array(t,k);return[new ju(F,{format:M,width:n,height:s,levels:o})]}let d=kE+Ig,m=new Uint32Array(e.buffer,d,xD/Uint32Array.BYTES_PER_ELEMENT),g=m[Mg.DXGI_FORMAT],_=m[Mg.RESOURCE_DIMENSION],v=m[Mg.MISC_FLAG],E=m[Mg.ARRAY_SIZE],b=zX[g];if(b===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${g}`);if(v===BX)throw new Error("DDSParser does not support cubemap textures");if(_===6)throw new Error("DDSParser does not supported 3D texture data");let T=new Array,A=kE+Ig+xD;if(E===1)T.push(new Uint8Array(t,A));else{let M=ah[b],k=0,F=n,O=s;for(let U=0;U<o;U++){let z=Math.max(1,F+3&-4),Z=Math.max(1,O+3&-4),W=z*Z*M;k+=W,F=F>>>1,O=O>>>1}let B=A;for(let U=0;U<E;U++)T.push(new Uint8Array(t,B,k)),B+=k}return T.map(M=>new ju(M,{format:b,width:n,height:s,levels:o}))}throw l&PX?new Error("DDSParser does not support uncompressed texture data."):l&RX?new Error("DDSParser does not supported YUV uncompressed texture data."):l&DX?new Error("DDSParser does not support single-channel (lumninance) texture data!"):l&kX?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}var vD=[171,75,84,88,32,49,49,187,13,10,26,10],GX=67305985,ac={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},ME=64,Rg={[yi.UNSIGNED_BYTE]:1,[yi.UNSIGNED_SHORT]:2,[yi.INT]:4,[yi.UNSIGNED_INT]:4,[yi.FLOAT]:4,[yi.HALF_FLOAT]:8},PE={[zt.RGBA]:4,[zt.RGB]:3,[zt.RG]:2,[zt.RED]:1,[zt.LUMINANCE]:1,[zt.LUMINANCE_ALPHA]:2,[zt.ALPHA]:1},RE={[yi.UNSIGNED_SHORT_4_4_4_4]:2,[yi.UNSIGNED_SHORT_5_5_5_1]:2,[yi.UNSIGNED_SHORT_5_6_5]:2};function Dg(t,e,i=!1){let r=new DataView(e);if(!$X(t,r))return null;let s=r.getUint32(ac.ENDIANNESS,!0)===GX,n=r.getUint32(ac.GL_TYPE,s),o=r.getUint32(ac.GL_FORMAT,s),a=r.getUint32(ac.GL_INTERNAL_FORMAT,s),l=r.getUint32(ac.PIXEL_WIDTH,s),c=r.getUint32(ac.PIXEL_HEIGHT,s)||1,d=r.getUint32(ac.PIXEL_DEPTH,s)||1,m=r.getUint32(ac.NUMBER_OF_ARRAY_ELEMENTS,s)||1,g=r.getUint32(ac.NUMBER_OF_FACES,s),_=r.getUint32(ac.NUMBER_OF_MIPMAP_LEVELS,s),v=r.getUint32(ac.BYTES_OF_KEY_VALUE_DATA,s);if(c===0||d!==1)throw new Error("Only 2D textures are supported");if(g!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(m!==1)throw new Error("WebGL does not support array textures");let E=4,b=4,T=l+3&-4,A=c+3&-4,M=new Array(m),k=l*c;n===0&&(k=T*A);let F;if(n!==0?Rg[n]?F=Rg[n]*PE[o]:F=RE[n]:F=ah[a],F===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");let O=i?VX(r,v,s):null,U=k*F,z=l,Z=c,W=T,q=A,Q=ME+v;for(let V=0;V<_;V++){let le=r.getUint32(Q,s),de=Q+4;for(let ne=0;ne<m;ne++){let ee=M[ne];ee||(ee=M[ne]=new Array(_)),ee[V]={levelID:V,levelWidth:_>1||n!==0?z:W,levelHeight:_>1||n!==0?Z:q,levelBuffer:new Uint8Array(e,de,U)},de+=U}Q+=le+4,Q=Q%4!==0?Q+4-Q%4:Q,z=z>>1||1,Z=Z>>1||1,W=z+E-1&~(E-1),q=Z+b-1&~(b-1),U=W*q*F}return n!==0?{uncompressed:M.map(V=>{let le=V[0].levelBuffer,de=!1;return n===yi.FLOAT?le=new Float32Array(V[0].levelBuffer.buffer,V[0].levelBuffer.byteOffset,V[0].levelBuffer.byteLength/4):n===yi.UNSIGNED_INT?(de=!0,le=new Uint32Array(V[0].levelBuffer.buffer,V[0].levelBuffer.byteOffset,V[0].levelBuffer.byteLength/4)):n===yi.INT&&(de=!0,le=new Int32Array(V[0].levelBuffer.buffer,V[0].levelBuffer.byteOffset,V[0].levelBuffer.byteLength/4)),{resource:new va(le,{width:V[0].levelWidth,height:V[0].levelHeight}),type:n,format:de?HX(o):o}}),kvData:O}:{compressed:M.map(V=>new ju(null,{format:a,width:l,height:c,levels:_,levelBuffers:V})),kvData:O}}function $X(t,e){for(let i=0;i<vD.length;i++)if(e.getUint8(i)!==vD[i])return console.error(`${t} is not a valid *.ktx file!`),!1;return!0}function HX(t){switch(t){case zt.RGBA:return zt.RGBA_INTEGER;case zt.RGB:return zt.RGB_INTEGER;case zt.RG:return zt.RG_INTEGER;case zt.RED:return zt.RED_INTEGER;default:return t}}function VX(t,e,i){let r=new Map,s=0;for(;s<e;){let n=t.getUint32(ME+s,i),o=ME+s+4,a=3-(n+3)%4;if(n===0||n>e-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<n&&t.getUint8(o+l)!==0;l++);if(l===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}let c=new TextDecoder().decode(new Uint8Array(t.buffer,o,l)),d=new DataView(t.buffer,o+l+1,n-l-1);r.set(c,d),s+=4+n+a}return r}var DE={extension:{type:gt.LoadParser,priority:pn.High},name:"loadDDS",test(t){return wo(t,".dds")},load(t,e,i){return ii(this,null,function*(){let s=yield(yield ht.ADAPTER.fetch(t)).arrayBuffer(),o=Pg(s).map(a=>{let l=new ui(a,di({mipmap:An.OFF,alphaMode:tn.NO_PREMULTIPLIED_ALPHA,resolution:St.getResolutionOfUrl(t)},e.data));return Gc(l,i,t)});return o.length===1?o[0]:o})},unload(t){Array.isArray(t)?t.forEach(e=>e.destroy(!0)):t.destroy(!0)}};Tt.add(DE);var FE={extension:{type:gt.LoadParser,priority:pn.High},name:"loadKTX",test(t){return wo(t,".ktx")},load(t,e,i){return ii(this,null,function*(){let s=yield(yield ht.ADAPTER.fetch(t)).arrayBuffer(),{compressed:n,uncompressed:o,kvData:a}=Dg(t,s),l=n!=null?n:o,c=di({mipmap:An.OFF,alphaMode:tn.NO_PREMULTIPLIED_ALPHA,resolution:St.getResolutionOfUrl(t)},e.data),d=l.map(m=>{l===o&&Object.assign(c,{type:m.type,format:m.format});let g=new ui(m,c);return g.ktxKeyValueData=a,Gc(g,i,t)});return d.length===1?d[0]:d})},unload(t){Array.isArray(t)?t.forEach(e=>e.destroy(!0)):t.destroy(!0)}};Tt.add(FE);var LE={extension:gt.ResolveParser,test:t=>{let i=t.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(i)},parse:t=>{var r,s,n,o;if(t.split("?")[0].split(".").pop()==="ktx"){let a=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(a.some(l=>t.endsWith(l)))return{resolution:parseFloat((s=(r=ht.RETINA_PREFIX.exec(t))==null?void 0:r[1])!=null?s:"1"),format:a.find(l=>t.endsWith(l)),src:t}}return{resolution:parseFloat((o=(n=ht.RETINA_PREFIX.exec(t))==null?void 0:n[1])!=null?o:"1"),format:t.split(".").pop(),src:t}}};Tt.add(LE);var jX=new ri,XX=4,V5=class{constructor(t){this.renderer=t}image(t,e,i){return ii(this,null,function*(){let r=new Image;return r.src=yield this.base64(t,e,i),r})}base64(t,e,i){return ii(this,null,function*(){let r=this.canvas(t);if(r.toBlob!==void 0)return new Promise((s,n)=>{r.toBlob(o=>{if(!o){n(new Error("ICanvas.toBlob failed!"));return}let a=new FileReader;a.onload=()=>s(a.result),a.onerror=n,a.readAsDataURL(o)},e,i)});if(r.toDataURL!==void 0)return r.toDataURL(e,i);if(r.convertToBlob!==void 0){let s=yield r.convertToBlob({type:e,quality:i});return new Promise((n,o)=>{let a=new FileReader;a.onload=()=>n(a.result),a.onerror=o,a.readAsDataURL(s)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")})}canvas(t,e){let{pixels:i,width:r,height:s,flipY:n}=this._rawPixels(t,e);n&&V5._flipY(i,r,s),V5._unpremultiplyAlpha(i);let o=new St.CanvasRenderTarget(r,s,1),a=new ImageData(new Uint8ClampedArray(i.buffer),r,s);return o.context.putImageData(a,0,0),o.canvas}pixels(t,e){let{pixels:i,width:r,height:s,flipY:n}=this._rawPixels(t,e);return n&&V5._flipY(i,r,s),V5._unpremultiplyAlpha(i),i}_rawPixels(t,e){let i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let r,s=!1,n,o=!1;if(t&&(t instanceof ja?n=t:(n=i.generateTexture(t,{resolution:i.resolution,multisample:i.multisample}),o=!0)),n){if(r=n.baseTexture.resolution,e=e!=null?e:n.frame,s=!1,!o){i.renderTexture.bind(n);let m=n.framebuffer.glFramebuffers[i.CONTEXT_UID];m.blitFramebuffer&&i.framebuffer.bind(m.blitFramebuffer)}}else r=i.resolution,e||(e=jX,e.width=i.width/r,e.height=i.height/r),s=!0,i.renderTexture.bind();let a=Math.round(e.width*r),l=Math.round(e.height*r),c=new Uint8Array(XX*a*l),d=i.gl;return d.readPixels(Math.round(e.x*r),Math.round(e.y*r),a,l,d.RGBA,d.UNSIGNED_BYTE,c),o&&(n==null||n.destroy(!0)),{pixels:c,width:a,height:l,flipY:s}}destroy(){this.renderer=null}static _flipY(t,e,i){let r=e<<2,s=i>>1,n=new Uint8Array(r);for(let o=0;o<s;o++){let a=o*r,l=(i-o-1)*r;n.set(t.subarray(a,a+r)),t.copyWithin(a,l,l+r),t.set(n,l)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));let e=t.length;for(let i=0;i<e;i+=4){let r=t[i+3];if(r!==0){let s=255.001/r;t[i]=t[i]*s+.5,t[i+1]=t[i+1]*s+.5,t[i+2]=t[i+2]*s+.5}}}},NE=V5;NE.extension={name:"extract",type:gt.RendererSystem};Tt.add(NE);var Xu={build(t){let e=t.points,i,r,s,n,o,a;if(t.type===cs.CIRC){let v=t.shape;i=v.x,r=v.y,o=a=v.radius,s=n=0}else if(t.type===cs.ELIP){let v=t.shape;i=v.x,r=v.y,o=v.width,a=v.height,s=n=0}else{let v=t.shape,E=v.width/2,b=v.height/2;i=v.x+E,r=v.y+b,o=a=Math.max(0,Math.min(v.radius,Math.min(E,b))),s=E-o,n=b-a}if(!(o>=0&&a>=0&&s>=0&&n>=0)){e.length=0;return}let l=Math.ceil(2.3*Math.sqrt(o+a)),c=l*8+(s?4:0)+(n?4:0);if(e.length=c,c===0)return;if(l===0){e.length=8,e[0]=e[6]=i+s,e[1]=e[3]=r+n,e[2]=e[4]=i-s,e[5]=e[7]=r-n;return}let d=0,m=l*4+(s?2:0)+2,g=m,_=c;{let v=s+o,E=n,b=i+v,T=i-v,A=r+E;if(e[d++]=b,e[d++]=A,e[--m]=A,e[--m]=T,n){let M=r-E;e[g++]=T,e[g++]=M,e[--_]=M,e[--_]=b}}for(let v=1;v<l;v++){let E=Math.PI/2*(v/l),b=s+Math.cos(E)*o,T=n+Math.sin(E)*a,A=i+b,M=i-b,k=r+T,F=r-T;e[d++]=A,e[d++]=k,e[--m]=k,e[--m]=M,e[g++]=M,e[g++]=F,e[--_]=F,e[--_]=A}{let v=s,E=n+a,b=i+v,T=i-v,A=r+E,M=r-E;e[d++]=b,e[d++]=A,e[--_]=M,e[--_]=b,s&&(e[d++]=T,e[d++]=A,e[--_]=M,e[--_]=T)}},triangulate(t,e){let i=t.points,r=e.points,s=e.indices;if(i.length===0)return;let n=r.length/2,o=n,a,l;if(t.type!==cs.RREC){let d=t.shape;a=d.x,l=d.y}else{let d=t.shape;a=d.x+d.width/2,l=d.y+d.height/2}let c=t.matrix;r.push(t.matrix?c.a*a+c.c*l+c.tx:a,t.matrix?c.b*a+c.d*l+c.ty:l),n++,r.push(i[0],i[1]);for(let d=2;d<i.length;d+=2)r.push(i[d],i[d+1]),s.push(n++,o,n);s.push(o+1,o,n)}};function bD(t,e=!1){let i=t.length;if(i<6)return;let r=0;for(let s=0,n=t[i-2],o=t[i-1];s<i;s+=2){let a=t[s],l=t[s+1];r+=(a-n)*(l+o),n=a,o=l}if(!e&&r>0||e&&r<=0){let s=i/2;for(let n=s+s%2;n<i;n+=2){let o=i-n-2,a=i-n-1,l=n,c=n+1;[t[o],t[l]]=[t[l],t[o]],[t[a],t[c]]=[t[c],t[a]]}}}var Sd={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let i=t.points,r=t.holes,s=e.points,n=e.indices;if(i.length>=6){bD(i,!1);let o=[];for(let c=0;c<r.length;c++){let d=r[c];bD(d.points,!0),o.push(i.length/2),i=i.concat(d.points)}let a=St.earcut(i,o,2);if(!a)return;let l=s.length/2;for(let c=0;c<a.length;c+=3)n.push(a[c]+l),n.push(a[c+1]+l),n.push(a[c+2]+l);for(let c=0;c<i.length;c++)s.push(i[c])}}};var j5={build(t){let e=t.shape,i=e.x,r=e.y,s=e.width,n=e.height,o=t.points;o.length=0,s>=0&&n>=0&&o.push(i,r,i+s,r,i+s,r+n,i,r+n)},triangulate(t,e){let i=t.points,r=e.points;if(i.length===0)return;let s=r.length/2;r.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),e.indices.push(s,s+1,s+2,s+1,s+2,s+3)}};var X5={build(t){Xu.build(t)},triangulate(t,e){Xu.triangulate(t,e)}};var zr=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(zr||{}),Ui=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(Ui||{}),El={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let i=Math.ceil(t/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}};var lh=class{static curveTo(e,i,r,s,n,o){let a=o[o.length-2],c=o[o.length-1]-i,d=a-e,m=s-i,g=r-e,_=Math.abs(c*g-d*m);if(_<1e-8||n===0)return(o[o.length-2]!==e||o[o.length-1]!==i)&&o.push(e,i),null;let v=c*c+d*d,E=m*m+g*g,b=c*m+d*g,T=n*Math.sqrt(v)/_,A=n*Math.sqrt(E)/_,M=T*b/v,k=A*b/E,F=T*g+A*d,O=T*m+A*c,B=d*(A+M),U=c*(A+M),z=g*(T+k),Z=m*(T+k),W=Math.atan2(U-O,B-F),q=Math.atan2(Z-O,z-F);return{cx:F+e,cy:O+i,radius:n,startAngle:W,endAngle:q,anticlockwise:d*m>g*c}}static arc(e,i,r,s,n,o,a,l,c){let d=a-o,m=El._segmentsCount(Math.abs(d)*n,Math.ceil(Math.abs(d)/Q1)*40),g=d/(m*2),_=g*2,v=Math.cos(g),E=Math.sin(g),b=m-1,T=b%1/b;for(let A=0;A<=b;++A){let M=A+T*A,k=g+o+_*M,F=Math.cos(k),O=-Math.sin(k);c.push((v*F+E*O)*n+r,(v*-O+E*F)*n+s)}}};var Ad=class{constructor(){this.reset()}begin(e,i,r){this.reset(),this.style=e,this.start=i,this.attribStart=r}end(e,i){this.attribSize=i-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}};var Cd=class t{static curveLength(e,i,r,s,n,o,a,l){let d=0,m=0,g=0,_=0,v=0,E=0,b=0,T=0,A=0,M=0,k=0,F=e,O=i;for(let B=1;B<=10;++B)m=B/10,g=m*m,_=g*m,v=1-m,E=v*v,b=E*v,T=b*e+3*E*m*r+3*v*g*n+_*a,A=b*i+3*E*m*s+3*v*g*o+_*l,M=F-T,k=O-A,F=T,O=A,d+=Math.sqrt(M*M+k*k);return d}static curveTo(e,i,r,s,n,o,a){let l=a[a.length-2],c=a[a.length-1];a.length-=2;let d=El._segmentsCount(t.curveLength(l,c,e,i,r,s,n,o)),m=0,g=0,_=0,v=0,E=0;a.push(l,c);for(let b=1,T=0;b<=d;++b)T=b/d,m=1-T,g=m*m,_=g*m,v=T*T,E=v*T,a.push(_*l+3*g*T*e+3*m*v*r+E*n,_*c+3*g*T*i+3*m*v*s+E*o)}};function wD(t,e,i,r,s,n,o,a){let l=t-i*s,c=e-r*s,d=t+i*n,m=e+r*n,g,_;o?(g=r,_=-i):(g=-r,_=i);let v=l+g,E=c+_,b=d+g,T=m+_;return a.push(v,E,b,T),2}function Id(t,e,i,r,s,n,o,a){let l=i-t,c=r-e,d=Math.atan2(l,c),m=Math.atan2(s-t,n-e);a&&d<m?d+=Math.PI*2:!a&&d>m&&(m+=Math.PI*2);let g=d,_=m-d,v=Math.abs(_),E=Math.sqrt(l*l+c*c),b=(15*v*Math.sqrt(E)/Math.PI>>0)+1,T=_/b;if(g+=T,a){o.push(t,e,i,r);for(let A=1,M=g;A<b;A++,M+=T)o.push(t,e,t+Math.sin(M)*E,e+Math.cos(M)*E);o.push(t,e,s,n)}else{o.push(i,r,t,e);for(let A=1,M=g;A<b;A++,M+=T)o.push(t+Math.sin(M)*E,e+Math.cos(M)*E,t,e);o.push(s,n,t,e)}return b*2}function WX(t,e){let i=t.shape,r=t.points||i.points.slice(),s=e.closePointEps;if(r.length===0)return;let n=t.lineStyle,o=new ei(r[0],r[1]),a=new ei(r[r.length-2],r[r.length-1]),l=i.type!==cs.POLY||i.closeStroke,c=Math.abs(o.x-a.x)<s&&Math.abs(o.y-a.y)<s;if(l){r=r.slice(),c&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));let ne=(o.x+a.x)*.5,ee=(a.y+o.y)*.5;r.unshift(ne,ee),r.push(ne,ee)}let d=e.points,m=r.length/2,g=r.length,_=d.length/2,v=n.width/2,E=v*v,b=n.miterLimit*n.miterLimit,T=r[0],A=r[1],M=r[2],k=r[3],F=0,O=0,B=-(A-k),U=T-M,z=0,Z=0,W=Math.sqrt(B*B+U*U);B/=W,U/=W,B*=v,U*=v;let q=n.alignment,Q=(1-q)*2,V=q*2;l||(n.cap===Ui.ROUND?g+=Id(T-B*(Q-V)*.5,A-U*(Q-V)*.5,T-B*Q,A-U*Q,T+B*V,A+U*V,d,!0)+2:n.cap===Ui.SQUARE&&(g+=wD(T,A,B,U,Q,V,!0,d))),d.push(T-B*Q,A-U*Q,T+B*V,A+U*V);for(let ne=1;ne<m-1;++ne){T=r[(ne-1)*2],A=r[(ne-1)*2+1],M=r[ne*2],k=r[ne*2+1],F=r[(ne+1)*2],O=r[(ne+1)*2+1],B=-(A-k),U=T-M,W=Math.sqrt(B*B+U*U),B/=W,U/=W,B*=v,U*=v,z=-(k-O),Z=M-F,W=Math.sqrt(z*z+Z*Z),z/=W,Z/=W,z*=v,Z*=v;let ee=M-T,re=A-k,te=M-F,ie=O-k,oe=ee*te+re*ie,fe=re*te-ie*ee,Re=fe<0;if(Math.abs(fe)<.001*Math.abs(oe)){d.push(M-B*Q,k-U*Q,M+B*V,k+U*V),oe>=0&&(n.join===zr.ROUND?g+=Id(M,k,M-B*Q,k-U*Q,M-z*Q,k-Z*Q,d,!1)+4:g+=2,d.push(M-z*V,k-Z*V,M+z*Q,k+Z*Q));continue}let He=(-B+T)*(-U+k)-(-B+M)*(-U+A),Je=(-z+F)*(-Z+k)-(-z+M)*(-Z+O),ot=(ee*Je-te*He)/fe,yt=(ie*He-re*Je)/fe,bt=(ot-M)*(ot-M)+(yt-k)*(yt-k),at=M+(ot-M)*Q,Te=k+(yt-k)*Q,Ze=M-(ot-M)*V,xt=k-(yt-k)*V,It=Math.min(ee*ee+re*re,te*te+ie*ie),Bt=Re?Q:V,Mi=It+Bt*Bt*E,je=bt<=Mi,be=n.join;if(be===zr.MITER&&bt/E>b&&(be=zr.BEVEL),je)switch(be){case zr.MITER:{d.push(at,Te,Ze,xt);break}case zr.BEVEL:{Re?d.push(at,Te,M+B*V,k+U*V,at,Te,M+z*V,k+Z*V):d.push(M-B*Q,k-U*Q,Ze,xt,M-z*Q,k-Z*Q,Ze,xt),g+=2;break}case zr.ROUND:{Re?(d.push(at,Te,M+B*V,k+U*V),g+=Id(M,k,M+B*V,k+U*V,M+z*V,k+Z*V,d,!0)+4,d.push(at,Te,M+z*V,k+Z*V)):(d.push(M-B*Q,k-U*Q,Ze,xt),g+=Id(M,k,M-B*Q,k-U*Q,M-z*Q,k-Z*Q,d,!1)+4,d.push(M-z*Q,k-Z*Q,Ze,xt));break}}else{switch(d.push(M-B*Q,k-U*Q,M+B*V,k+U*V),be){case zr.MITER:{Re?d.push(Ze,xt,Ze,xt):d.push(at,Te,at,Te),g+=2;break}case zr.ROUND:{Re?g+=Id(M,k,M+B*V,k+U*V,M+z*V,k+Z*V,d,!0)+2:g+=Id(M,k,M-B*Q,k-U*Q,M-z*Q,k-Z*Q,d,!1)+2;break}}d.push(M-z*Q,k-Z*Q,M+z*V,k+Z*V),g+=2}}T=r[(m-2)*2],A=r[(m-2)*2+1],M=r[(m-1)*2],k=r[(m-1)*2+1],B=-(A-k),U=T-M,W=Math.sqrt(B*B+U*U),B/=W,U/=W,B*=v,U*=v,d.push(M-B*Q,k-U*Q,M+B*V,k+U*V),l||(n.cap===Ui.ROUND?g+=Id(M-B*(Q-V)*.5,k-U*(Q-V)*.5,M-B*Q,k-U*Q,M+B*V,k+U*V,d,!1)+2:n.cap===Ui.SQUARE&&(g+=wD(M,k,B,U,Q,V,!1,d)));let le=e.indices,de=El.epsilon*El.epsilon;for(let ne=_;ne<g+_-2;++ne)T=d[ne*2],A=d[ne*2+1],M=d[(ne+1)*2],k=d[(ne+1)*2+1],F=d[(ne+2)*2],O=d[(ne+2)*2+1],!(Math.abs(T*(k-O)+M*(O-A)+F*(A-k))<de)&&le.push(ne,ne+1,ne+2)}function qX(t,e){let i=0,r=t.shape,s=t.points||r.points,n=r.type!==cs.POLY||r.closeStroke;if(s.length===0)return;let o=e.points,a=e.indices,l=s.length/2,c=o.length/2,d=c;for(o.push(s[0],s[1]),i=1;i<l;i++)o.push(s[i*2],s[i*2+1]),a.push(d,d+1),d++;n&&a.push(d,c)}function I2(t,e){t.lineStyle.native?qX(t,e):WX(t,e)}var kd=class t{static curveLength(e,i,r,s,n,o){let a=e-2*r+n,l=i-2*s+o,c=2*r-2*e,d=2*s-2*i,m=4*(a*a+l*l),g=4*(a*c+l*d),_=c*c+d*d,v=2*Math.sqrt(m+g+_),E=Math.sqrt(m),b=2*m*E,T=2*Math.sqrt(_),A=g/E;return(b*v+E*g*(v-T)+(4*_*m-g*g)*Math.log((2*E+A+v)/(A+T)))/(4*b)}static curveTo(e,i,r,s,n){let o=n[n.length-2],a=n[n.length-1],l=El._segmentsCount(t.curveLength(o,a,e,i,r,s)),c=0,d=0;for(let m=1;m<=l;++m){let g=m/l;c=o+(e-o)*g,d=a+(i-a)*g,n.push(c+(e+(r-e)*g-c)*g,d+(i+(s-i)*g-d)*g)}}};var k2={[cs.POLY]:Sd,[cs.CIRC]:Xu,[cs.ELIP]:Xu,[cs.RECT]:j5,[cs.RREC]:X5},W5=[],Md=[];var M2=class t{constructor(e,i=null,r=null,s=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=r,this.fillStyle=i,this.matrix=s,this.type=e.type}clone(){return new t(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}};var P2=new ei,ED=class extends hd{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Bc,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Md.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){let e=this.batches[t];e.reset(),W5.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,i=null,r=null){let s=new M2(t,e,i,r);return this.graphicsData.push(s),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;let i=new M2(t,null,null,e),r=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=r.lineStyle,r.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){let e=this.graphicsData;for(let i=0;i<e.length;++i){let r=e[i];if(r.fillStyle.visible&&r.shape&&(r.matrix?r.matrix.applyInverse(t,P2):P2.copyFrom(t),r.shape.contains(P2.x,P2.y))){let s=!1;if(r.holes){for(let n=0;n<r.holes.length;n++)if(r.holes[n].shape.contains(P2.x,P2.y)){s=!0;break}}if(!s)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;let t=this.uvs,e=this.graphicsData,i=null,r=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],r=i.style);for(let a=this.shapeIndex;a<e.length;a++){this.shapeIndex++;let l=e[a],c=l.fillStyle,d=l.lineStyle;k2[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(c.visible||d.visible)&&this.processHoles(l.holes);for(let g=0;g<2;g++){let _=g===0?c:d;if(!_.visible)continue;let v=_.texture.baseTexture,E=this.indices.length,b=this.points.length/2;v.wrapMode=_a.REPEAT,g===0?this.processFill(l):this.processLine(l);let T=this.points.length/2-b;T!==0&&(i&&!this._compareStyles(r,_)&&(i.end(E,b),i=null),i||(i=W5.pop()||new Ad,i.begin(_,E,b),this.batches.push(i),r=_),this.addUvs(this.points,t,_.texture,b,T,_.matrix))}}let s=this.indices.length,n=this.points.length/2;if(i&&i.end(s,n),this.batches.length===0){this.batchable=!0;return}let o=n>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){let i=this.graphicsData[t],r=i.fillStyle,s=i.lineStyle;if(r&&!r.texture.baseTexture.valid||s&&!s.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);let t=this.batches;for(let e=0,i=t.length;e<i;e++){let r=t[e];for(let s=0;s<r.size;s++){let n=r.start+s;this.indicesUint16[n]=this.indicesUint16[n]-r.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;let t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<ED.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++ui._globalBatch;for(let d=0;d<this.drawCalls.length;d++)this.drawCalls[d].texArray.clear(),Md.push(this.drawCalls[d]);this.drawCalls.length=0;let e=this.colors,i=this.textureIds,r=Md.pop();r||(r=new Z1,r.texArray=new J1),r.texArray.count=0,r.start=0,r.size=0,r.type=ya.TRIANGLES;let s=0,n=null,o=0,a=!1,l=ya.TRIANGLES,c=0;this.drawCalls.push(r);for(let d=0;d<this.batches.length;d++){let m=this.batches[d],g=8,_=m.style,v=_.texture.baseTexture;a!==!!_.native&&(a=!!_.native,l=a?ya.LINES:ya.TRIANGLES,n=null,s=g,t++),n!==v&&(n=v,v._batchEnabled!==t&&(s===g&&(t++,s=0,r.size>0&&(r=Md.pop(),r||(r=new Z1,r.texArray=new J1),this.drawCalls.push(r)),r.start=c,r.size=0,r.texArray.count=0,r.type=l),v.touched=1,v._batchEnabled=t,v._batchLocation=s,v.wrapMode=_a.REPEAT,r.texArray.elements[r.texArray.count++]=v,s++)),r.size+=m.size,c+=m.size,o=v._batchLocation,this.addColors(e,_.color,_.alpha,m.attribSize,m.attribStart),this.addTextureIds(i,o,m.attribSize,m.attribStart)}ui._globalBatch=t,this.packAttributes()}packAttributes(){let t=this.points,e=this.uvs,i=this.colors,r=this.textureIds,s=new ArrayBuffer(t.length*3*4),n=new Float32Array(s),o=new Uint32Array(s),a=0;for(let l=0;l<t.length/2;l++)n[a++]=t[l*2],n[a++]=t[l*2+1],n[a++]=e[l*2],n[a++]=e[l*2+1],o[a++]=i[l],n[a++]=r[l];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?Sd.triangulate(t,this):k2[t.type].triangulate(t,this)}processLine(t){I2(t,this);for(let e=0;e<t.holes.length;e++)I2(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){let i=t[e];k2[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){let t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let i=0;i<t.length/2;i++){let r=t[i*2],s=t[i*2+1];t[i*2]=e.a*r+e.c*s+e.tx,t[i*2+1]=e.b*r+e.d*s+e.ty}}addColors(t,e,i,r,s=0){let n=mi.shared.setValue(e).toLittleEndianNumber(),o=mi.shared.setValue(n).toPremultiplied(i);t.length=Math.max(t.length,s+r);for(let a=0;a<r;a++)t[s+a]=o}addTextureIds(t,e,i,r=0){t.length=Math.max(t.length,r+i);for(let s=0;s<i;s++)t[r+s]=e}addUvs(t,e,i,r,s,n=null){let o=0,a=e.length,l=i.frame;for(;o<s;){let d=t[(r+o)*2],m=t[(r+o)*2+1];if(n){let g=n.a*d+n.c*m+n.tx;m=n.b*d+n.d*m+n.ty,d=g}o++,e.push(d/l.width,m/l.height)}let c=i.baseTexture;(l.width<c.width||l.height<c.height)&&this.adjustUvs(e,i,a,s)}adjustUvs(t,e,i,r){let s=e.baseTexture,n=1e-6,o=i+r*2,a=e.frame,l=a.width/s.width,c=a.height/s.height,d=a.x/a.width,m=a.y/a.height,g=Math.floor(t[i]+n),_=Math.floor(t[i+1]+n);for(let v=i+2;v<o;v+=2)g=Math.min(g,Math.floor(t[v]+n)),_=Math.min(_,Math.floor(t[v+1]+n));d-=g,m-=_;for(let v=i;v<o;v+=2)t[v]=(t[v]+d)*l,t[v+1]=(t[v+1]+m)*c}},Fg=ED;Fg.BATCHABLE_SIZE=100;var Pd=class t{constructor(){this.color=16777215,this.alpha=1,this.texture=Yt.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){let e=new t;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=Yt.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}};var q5=class t extends Pd{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Ui.BUTT,this.join=zr.MITER,this.miterLimit=10}clone(){let e=new t;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}};var OE={},Lg=class extends Qi{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Pd,this._lineStyle=new q5,this._matrix=null,this._holeMode=!1,this.state=ro.for2d(),this._geometry=t||new Fg,this._geometry.refCount++,this._transformID=-1,this._tintColor=new mi(16777215),this.blendMode=ki.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Lg(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,i,r=.5,s=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:i,alignment:r,native:s}),this.lineTextureStyle(t)}lineTextureStyle(t){let e={width:0,texture:Yt.WHITE,color:t!=null&&t.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Ui.BUTT,join:zr.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();let i=t.width>0&&t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:i},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){let t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new so,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new so,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);let i=this.currentPath.points,r=i[i.length-2],s=i[i.length-1];return(r!==t||s!==e)&&i.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,i,r){this._initCurve();let s=this.currentPath.points;return s.length===0&&this.moveTo(0,0),kd.curveTo(t,e,i,r,s),this}bezierCurveTo(t,e,i,r,s,n){return this._initCurve(),Cd.curveTo(t,e,i,r,s,n,this.currentPath.points),this}arcTo(t,e,i,r,s){this._initCurve(t,e);let n=this.currentPath.points,o=lh.curveTo(t,e,i,r,s,n);if(o){let{cx:a,cy:l,radius:c,startAngle:d,endAngle:m,anticlockwise:g}=o;this.arc(a,l,c,d,m,g)}return this}arc(t,e,i,r,s,n=!1){if(r===s)return this;if(!n&&s<=r?s+=Q1:n&&r<=s&&(r+=Q1),s-r===0)return this;let a=t+Math.cos(r)*i,l=e+Math.sin(r)*i,c=this._geometry.closePointEps,d=this.currentPath?this.currentPath.points:null;if(d){let m=Math.abs(d[d.length-2]-a),g=Math.abs(d[d.length-1]-l);m<c&&g<c||d.push(a,l)}else this.moveTo(a,l),d=this.currentPath.points;return lh.arc(a,l,t,e,i,r,s,n,d),this}beginFill(t=0,e){return this.beginTextureFill({texture:Yt.WHITE,color:t,alpha:e})}normalizeColor(t){var i,r;let e=mi.shared.setValue((i=t.color)!=null?i:0);t.color=e.toNumber(),(r=t.alpha)!=null||(t.alpha=e.alpha)}beginTextureFill(t){let e={texture:Yt.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();let i=t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:i},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,i,r){return this.drawShape(new ri(t,e,i,r))}drawRoundedRect(t,e,i,r,s){return this.drawShape(new p5(t,e,i,r,s))}drawCircle(t,e,i){return this.drawShape(new K1(t,e,i))}drawEllipse(t,e,i,r){return this.drawShape(new f5(t,e,i,r))}drawPolygon(...t){let e,i=!0,r=t[0];r.points?(i=r.closeStroke,e=r.points):Array.isArray(t[0])?e=t[0]:e=t;let s=new so(e);return s.closeStroke=i,this.drawShape(s),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){let t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===cs.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();let e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){let t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(let r=0;r<i;r++){let s=t.batches[r],n=s.style.color,o=new Float32Array(this.vertexData.buffer,s.attribStart*4*2,s.attribSize*2),a=new Float32Array(t.uvsFloat32.buffer,s.attribStart*4*2,s.attribSize*2),l=new Uint16Array(t.indicesUint16.buffer,s.start*2,s.size),c={vertexData:o,blendMode:e,indices:l,uvs:a,_batchRGB:mi.shared.setValue(n).toRgbArray(),_tintRGB:n,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[r]=c}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,i=this.batches.length;e<i;e++){let r=this.batches[e];r.worldAlpha=this.worldAlpha*r.alpha,t.plugins[this.pluginName].render(r)}}}_renderDirect(t){let e=this._resolveDirectShader(t),i=this._geometry,r=this.worldAlpha,s=e.uniforms,n=i.drawCalls;s.translationMatrix=this.transform.worldTransform,mi.shared.setValue(this._tintColor).premultiply(r).toArray(s.tint),t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(let o=0,a=n.length;o<a;o++)this._renderDrawCallDirect(t,i.drawCalls[o])}_renderDrawCallDirect(t,e){let{texArray:i,type:r,size:s,start:n}=e,o=i.count;for(let a=0;a<o;a++)t.texture.bind(i.elements[a],a);t.geometry.draw(r,s,n)}_resolveDirectShader(t){let e=this.shader,i=this.pluginName;if(!e){if(!OE[i]){let{maxTextures:r}=t.plugins[i],s=new Int32Array(r);for(let a=0;a<r;a++)s[a]=a;let n={tint:new Float32Array([1,1,1,1]),translationMatrix:new fr,default:Jo.from({uSamplers:s},!0)},o=t.plugins[i]._shader.program;OE[i]=new no(o,n)}e=OE[i]}return e}_calculateBounds(){this.finishPoly();let t=this._geometry;if(!t.graphicsData.length)return;let{minX:e,minY:i,maxX:r,maxY:s}=t.bounds;this._bounds.addFrame(this.transform,e,i,r,s)}containsPoint(t){return this.worldTransform.applyInverse(t,Lg._TEMP_POINT),this._geometry.containsPoint(Lg._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){let e=this.batches[t];e._tintRGB=mi.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){let t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;let e=this.transform.worldTransform,i=e.a,r=e.b,s=e.c,n=e.d,o=e.tx,a=e.ty,l=this._geometry.points,c=this.vertexData,d=0;for(let m=0;m<l.length;m+=2){let g=l[m],_=l[m+1];c[d++]=i*g+s*_+o,c[d++]=n*_+r*g+a}}closePath(){let t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}},Hi=Lg;Hi.curves=El;Hi._TEMP_POINT=new ei;var TD={buildPoly:Sd,buildCircle:Xu,buildRectangle:j5,buildRoundedRectangle:X5,buildLine:I2,ArcUtils:lh,BezierUtils:Cd,QuadraticUtils:kd,BatchPart:Ad,FILL_COMMANDS:k2,BATCH_POOL:W5,DRAW_CALL_POOL:Md};var Y5=class{constructor(e,i){this.uvBuffer=e,this.uvMatrix=i,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;let i=this.uvBuffer.data;(!this.data||this.data.length!==i.length)&&(this.data=new Float32Array(i.length)),this.uvMatrix.multiplyUvs(i,this.data),this._updateID++}};var BE=new ei,SD=new so,AD=class extends Qi{constructor(t,e,i,r=ya.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=i||ro.for2d(),this.drawMode=r,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=ht.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){let e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===ya.TRIANGLES&&e.length<AD.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){let e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){let e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;let r=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[r]),t.plugins[r].render(this)}calculateVertices(){let e=this.geometry.buffers[0],i=e.data,r=e._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==i.length&&(this.vertexData=new Float32Array(i.length));let s=this.transform.worldTransform,n=s.a,o=s.b,a=s.c,l=s.d,c=s.tx,d=s.ty,m=this.vertexData;for(let g=0;g<m.length/2;g++){let _=i[g*2],v=i[g*2+1];m[g*2]=n*_+a*v+c,m[g*2+1]=o*_+l*v+d}if(this._roundPixels){let g=ht.RESOLUTION;for(let _=0;_<m.length;++_)m[_]=Math.round(m[_]*g)/g}this.vertexDirty=r}calculateUvs(){let t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Y5(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,BE);let e=this.geometry.getBuffer("aVertexPosition").data,i=SD.points,r=this.geometry.getIndex().data,s=r.length,n=this.drawMode===4?3:1;for(let o=0;o+2<s;o+=n){let a=r[o]*2,l=r[o+1]*2,c=r[o+2]*2;if(i[0]=e[a],i[1]=e[a+1],i[2]=e[l],i[3]=e[l+1],i[4]=e[c],i[5]=e[c+1],SD.contains(BE.x,BE.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}},lc=AD;lc.BATCHABLE_SIZE=100;var Wu=class extends Qo{constructor(e,i,r){super();let s=new is(e),n=new is(i,!0),o=new is(r,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,yi.FLOAT).addAttribute("aTextureCoord",n,2,!1,yi.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}};var CD=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`;var ID=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;var Tl=class extends no{constructor(e,i){let r={uSampler:e,alpha:1,uTextureMatrix:fr.IDENTITY,uColor:new Float32Array([1,1,1,1])};i=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},i),i.uniforms&&Object.assign(r,i.uniforms),super(i.program||qn.from(ID,CD),r),this._colorDirty=!1,this.uvMatrix=new rh(e),this.batchable=i.program===void 0,this.pluginName=i.pluginName,this._tintColor=new mi(i.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=i.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this.tint&&(this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;let i=this.texture.baseTexture.alphaMode;mi.shared.setValue(this._tintColor).premultiply(this._alpha,i).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}};var Z5=class extends Wu{constructor(e=200,i,r=0){super(new Float32Array(i.length*4),new Float32Array(i.length*4),new Uint16Array((i.length-1)*6)),this.points=i,this._width=e,this.textureScale=r,this.build()}get width(){return this._width}build(){let e=this.points;if(!e)return;let i=this.getBuffer("aVertexPosition"),r=this.getBuffer("aTextureCoord"),s=this.getIndex();if(e.length<1)return;i.data.length/4!==e.length&&(i.data=new Float32Array(e.length*4),r.data=new Float32Array(e.length*4),s.data=new Uint16Array((e.length-1)*6));let n=r.data,o=s.data;n[0]=0,n[1]=0,n[2]=0,n[3]=1;let a=0,l=e[0],c=this._width*this.textureScale,d=e.length;for(let g=0;g<d;g++){let _=g*4;if(this.textureScale>0){let v=l.x-e[g].x,E=l.y-e[g].y,b=Math.sqrt(v*v+E*E);l=e[g],a+=b/c}else a=g/(d-1);n[_]=a,n[_+1]=0,n[_+2]=a,n[_+3]=1}let m=0;for(let g=0;g<d-1;g++){let _=g*2;o[m++]=_,o[m++]=_+1,o[m++]=_+2,o[m++]=_+2,o[m++]=_+1,o[m++]=_+3}r.update(),s.update(),this.updateVertices()}updateVertices(){let e=this.points;if(e.length<1)return;let i=e[0],r,s=0,n=0,o=this.buffers[0].data,a=e.length,l=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let c=0;c<a;c++){let d=e[c],m=c*4;c<e.length-1?r=e[c+1]:r=d,n=-(r.x-i.x),s=r.y-i.y;let g=(1-c/(a-1))*10;g>1&&(g=1);let _=Math.sqrt(s*s+n*n);_<1e-6?(s=0,n=0):(s/=_,n/=_,s*=l,n*=l),o[m]=d.x+s,o[m+1]=d.y+n,o[m+2]=d.x-s,o[m+3]=d.y-n,i=d}this.buffers[0].update()}update(){this.textureScale>0?this.build():this.updateVertices()}};var Q5=class extends lc{constructor(e,i,r=0){let s=new Z5(e.height,i,r),n=new Tl(e);r>0&&(e.baseTexture.wrapMode=_a.REPEAT),super(s,n),this.autoUpdate=!0}_render(e){let i=this.geometry;(this.autoUpdate||i._width!==this.shader.texture.height)&&(i._width=this.shader.texture.height,i.update()),super._render(e)}};var K5=class extends Qi{constructor(e=1500,i,r=16384,s=!1){super();let n=16384;r>n&&(r=n),this._properties=[!1,!0,!1,!1,!1],this._maxSize=e,this._batchSize=r,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=ki.NORMAL,this.autoResize=s,this.roundPixels=!0,this.baseTexture=null,this.setProperties(i),this._tintColor=new mi(0),this.tintRgb=new Float32Array(3),this.tint=16777215}setProperties(e){e&&(this._properties[0]="vertices"in e||"scale"in e?!!e.vertices||!!e.scale:this._properties[0],this._properties[1]="position"in e?!!e.position:this._properties[1],this._properties[2]="rotation"in e?!!e.rotation:this._properties[2],this._properties[3]="uvs"in e?!!e.uvs:this._properties[3],this._properties[4]="tint"in e||"alpha"in e?!!e.tint||!!e.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintColor.toRgbArray(this.tintRgb)}render(e){!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",()=>this.onChildrenChange(0))),e.batch.setObjectRenderer(e.plugins.particle),e.plugins.particle.render(this))}onChildrenChange(e){let i=Math.floor(e/this._batchSize);for(;this._bufferUpdateIDs.length<i;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[i]=++this._updateID}dispose(){if(this._buffers){for(let e=0;e<this._buffers.length;++e)this._buffers[e].destroy();this._buffers=null}}destroy(e){super.destroy(e),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}};var J5=class{constructor(e,i,r){this.geometry=new Qo,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<e.length;++s){let n=e[s];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||yi.FLOAT,offset:n.offset},i[s]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){let e=this.geometry,i=0;this.indexBuffer=new is(St.createIndicesForQuads(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){let a=this.dynamicProperties[o];a.offset=i,i+=a.size,this.dynamicStride+=a.size}let r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new is(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){let a=this.staticProperties[o];a.offset=s,s+=a.size,this.staticStride+=a.size}let n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new is(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){let a=this.dynamicProperties[o];e.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===yi.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let o=0;o<this.staticProperties.length;++o){let a=this.staticProperties[o];e.addAttribute(a.attributeName,this.staticBuffer,0,a.type===yi.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(e,i,r){for(let s=0;s<this.dynamicProperties.length;s++){let n=this.dynamicProperties[s];n.uploadFunction(e,i,r,n.type===yi.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,i,r){for(let s=0;s<this.staticProperties.length;s++){let n=this.staticProperties[s];n.uploadFunction(e,i,r,n.type===yi.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}};var kD=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`;var MD=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;var em=class extends rc{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new fr,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:yi.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=no.from(MD,kD,{}),this.state=ro.for2d()}render(e){let i=e.children,r=e._maxSize,s=e._batchSize,n=this.renderer,o=i.length;if(o===0)return;o>r&&!e.autoResize&&(o=r);let a=e._buffers;a||(a=e._buffers=this.generateBuffers(e));let l=i[0]._texture.baseTexture,c=l.alphaMode>0;this.state.blendMode=St.correctBlendMode(e.blendMode,c),n.state.set(this.state);let d=n.gl,m=e.worldTransform.copyTo(this.tempMatrix);m.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=m.toArray(!0),this.shader.uniforms.uColor=mi.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,c).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let g=!1;for(let _=0,v=0;_<o;_+=s,v+=1){let E=o-_;E>s&&(E=s),v>=a.length&&a.push(this._generateOneMoreBuffer(e));let b=a[v];b.uploadDynamic(i,_,E);let T=e._bufferUpdateIDs[v]||0;g=g||b._updateID<T,g&&(b._updateID=e._updateID,b.uploadStatic(i,_,E)),n.geometry.bind(b.geometry),d.drawElements(d.TRIANGLES,E*6,d.UNSIGNED_SHORT,0)}}generateBuffers(e){let i=[],r=e._maxSize,s=e._batchSize,n=e._properties;for(let o=0;o<r;o+=s)i.push(new J5(this.properties,n,s));return i}_generateOneMoreBuffer(e){let i=e._batchSize,r=e._properties;return new J5(this.properties,r,i)}uploadVertices(e,i,r,s,n,o){let a=0,l=0,c=0,d=0;for(let m=0;m<r;++m){let g=e[i+m],_=g._texture,v=g.scale.x,E=g.scale.y,b=_.trim,T=_.orig;b?(l=b.x-g.anchor.x*T.width,a=l+b.width,d=b.y-g.anchor.y*T.height,c=d+b.height):(a=T.width*(1-g.anchor.x),l=T.width*-g.anchor.x,c=T.height*(1-g.anchor.y),d=T.height*-g.anchor.y),s[o]=l*v,s[o+1]=d*E,s[o+n]=a*v,s[o+n+1]=d*E,s[o+n*2]=a*v,s[o+n*2+1]=c*E,s[o+n*3]=l*v,s[o+n*3+1]=c*E,o+=n*4}}uploadPosition(e,i,r,s,n,o){for(let a=0;a<r;a++){let l=e[i+a].position;s[o]=l.x,s[o+1]=l.y,s[o+n]=l.x,s[o+n+1]=l.y,s[o+n*2]=l.x,s[o+n*2+1]=l.y,s[o+n*3]=l.x,s[o+n*3+1]=l.y,o+=n*4}}uploadRotation(e,i,r,s,n,o){for(let a=0;a<r;a++){let l=e[i+a].rotation;s[o]=l,s[o+n]=l,s[o+n*2]=l,s[o+n*3]=l,o+=n*4}}uploadUvs(e,i,r,s,n,o){for(let a=0;a<r;++a){let l=e[i+a]._texture._uvs;l?(s[o]=l.x0,s[o+1]=l.y0,s[o+n]=l.x1,s[o+n+1]=l.y1,s[o+n*2]=l.x2,s[o+n*2+1]=l.y2,s[o+n*3]=l.x3,s[o+n*3+1]=l.y3,o+=n*4):(s[o]=0,s[o+1]=0,s[o+n]=0,s[o+n+1]=0,s[o+n*2]=0,s[o+n*2+1]=0,s[o+n*3]=0,s[o+n*3+1]=0,o+=n*4)}}uploadTint(e,i,r,s,n,o){for(let a=0;a<r;++a){let l=e[i+a],c=mi.shared.setValue(l._tintRGB).toPremultiplied(l.alpha,l.texture.baseTexture.alphaMode>0);s[o]=c,s[o+n]=c,s[o+n*2]=c,s[o+n*3]=c,o+=n*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}};em.extension={name:"particle",type:gt.RendererPlugin};Tt.add(em);var ch=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(ch||{});var Ng={willReadFrequently:!0},Si=class{static get experimentalLetterSpacingSupported(){let t=Si._experimentalLetterSpacingSupported;if(t!==void 0){let e=ht.ADAPTER.getCanvasRenderingContext2D().prototype;t=Si._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,r,s,n,o,a,l){this.text=t,this.style=e,this.width=i,this.height=r,this.lines=s,this.lineWidths=n,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=l}static measureText(t,e,i,r=Si._canvas){i=i==null?e.wordWrap:i;let s=e.toFontString(),n=Si.measureFont(s);n.fontSize===0&&(n.fontSize=e.fontSize,n.ascent=e.fontSize);let o=r.getContext("2d",Ng);o.font=s;let l=(i?Si.wordWrap(t,e,r):t).split(/(?:\r\n|\r|\n)/),c=new Array(l.length),d=0;for(let v=0;v<l.length;v++){let E=Si._measureText(l[v],e.letterSpacing,o);c[v]=E,d=Math.max(d,E)}let m=d+e.strokeThickness;e.dropShadow&&(m+=e.dropShadowDistance);let g=e.lineHeight||n.fontSize+e.strokeThickness,_=Math.max(g,n.fontSize+e.strokeThickness*2)+(l.length-1)*(g+e.leading);return e.dropShadow&&(_+=e.dropShadowDistance),new Si(t,e,m,_,l,c,g+e.leading,d,n)}static _measureText(t,e,i){let r=!1;Si.experimentalLetterSpacingSupported&&(Si.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,r=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let s=i.measureText(t).width;return s>0&&(r?s-=e:s+=(Si.graphemeSegmenter(t).length-1)*e),s}static wordWrap(t,e,i=Si._canvas){let r=i.getContext("2d",Ng),s=0,n="",o="",a=Object.create(null),{letterSpacing:l,whiteSpace:c}=e,d=Si.collapseSpaces(c),m=Si.collapseNewlines(c),g=!d,_=e.wordWrapWidth+l,v=Si.tokenize(t);for(let E=0;E<v.length;E++){let b=v[E];if(Si.isNewline(b)){if(!m){o+=Si.addLine(n),g=!d,n="",s=0;continue}b=" "}if(d){let A=Si.isBreakingSpace(b),M=Si.isBreakingSpace(n[n.length-1]);if(A&&M)continue}let T=Si.getFromCache(b,l,a,r);if(T>_)if(n!==""&&(o+=Si.addLine(n),n="",s=0),Si.canBreakWords(b,e.breakWords)){let A=Si.wordWrapSplit(b);for(let M=0;M<A.length;M++){let k=A[M],F=k,O=1;for(;A[M+O];){let U=A[M+O];if(!Si.canBreakChars(F,U,b,M,e.breakWords))k+=U;else break;F=U,O++}M+=O-1;let B=Si.getFromCache(k,l,a,r);B+s>_&&(o+=Si.addLine(n),g=!1,n="",s=0),n+=k,s+=B}}else{n.length>0&&(o+=Si.addLine(n),n="",s=0);let A=E===v.length-1;o+=Si.addLine(b,!A),g=!1,n="",s=0}else T+s>_&&(g=!1,o+=Si.addLine(n),n="",s=0),(n.length>0||!Si.isBreakingSpace(b)||g)&&(n+=b,s+=T)}return o+=Si.addLine(n,!1),o}static addLine(t,e=!0){return t=Si.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,i,r){let s=i[t];return typeof s!="number"&&(s=Si._measureText(t,e,r)+e,i[t]=s),s}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){let i=t[e];if(!Si.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:Si._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:Si._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){let e=[],i="";if(typeof t!="string")return e;for(let r=0;r<t.length;r++){let s=t[r],n=t[r+1];if(Si.isBreakingSpace(s,n)||Si.isNewline(s)){i!==""&&(e.push(i),i=""),e.push(s);continue}i+=s}return i!==""&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,r,s){return!0}static wordWrapSplit(t){return Si.graphemeSegmenter(t)}static measureFont(t){if(Si._fonts[t])return Si._fonts[t];let e={ascent:0,descent:0,fontSize:0},i=Si._canvas,r=Si._context;r.font=t;let s=Si.METRICS_STRING+Si.BASELINE_SYMBOL,n=Math.ceil(r.measureText(s).width),o=Math.ceil(r.measureText(Si.BASELINE_SYMBOL).width),a=Math.ceil(Si.HEIGHT_MULTIPLIER*o);if(o=o*Si.BASELINE_MULTIPLIER|0,n===0||a===0)return Si._fonts[t]=e,e;i.width=n,i.height=a,r.fillStyle="#f00",r.fillRect(0,0,n,a),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(s,0,o);let l=r.getImageData(0,0,n,a).data,c=l.length,d=n*4,m=0,g=0,_=!1;for(m=0;m<o;++m){for(let v=0;v<d;v+=4)if(l[g+v]!==255){_=!0;break}if(!_)g+=d;else break}for(e.ascent=o-m,g=c-d,_=!1,m=a;m>o;--m){for(let v=0;v<d;v+=4)if(l[g+v]!==255){_=!0;break}if(!_)g-=d;else break}return e.descent=m-o,e.fontSize=e.ascent+e.descent,Si._fonts[t]=e,e}static clearMetrics(t=""){t?delete Si._fonts[t]:Si._fonts={}}static get _canvas(){if(!Si.__canvas){let t;try{let e=new OffscreenCanvas(0,0),i=e.getContext("2d",Ng);if(i!=null&&i.measureText)return Si.__canvas=e,e;t=ht.ADAPTER.createCanvas()}catch(e){t=ht.ADAPTER.createCanvas()}t.width=t.height=10,Si.__canvas=t}return Si.__canvas}static get _context(){return Si.__context||(Si.__context=Si._canvas.getContext("2d",Ng)),Si.__context}},mn=Si;mn.METRICS_STRING="|\xC9q\xC5";mn.BASELINE_SYMBOL="M";mn.BASELINE_MULTIPLIER=1.4;mn.HEIGHT_MULTIPLIER=2;mn.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){let t=new Intl.Segmenter;return e=>[...t.segment(e)].map(i=>i.segment)}return t=>[...t]})();mn.experimentalLetterSpacing=!1;mn._fonts={};mn._newlines=[10,13];mn._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var QX=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],tm=class{constructor(t){this.styleID=0,this.reset(),zE(this,t,t)}clone(){let t={};return zE(t,this,tm.defaultStyle),new tm(t)}reset(){zE(this,tm.defaultStyle,tm.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){let e=UE(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){let e=UE(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){KX(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){let e=UE(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){let t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let r=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&!QX.includes(r)&&(r=`"${r}"`),e[i]=r}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}},Ln=tm;Ln.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:ch.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};function UE(t){let e=mi.shared;return Array.isArray(t)?t.map(i=>e.setValue(i).toHex()):e.setValue(t).toHex()}function KX(t,e){if(!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}function zE(t,e,i){for(let r in i)Array.isArray(e[r])?t[r]=e[r].slice():t[r]=e[r]}var JX={texture:!0,children:!1,baseTexture:!0},GE=class extends rs{constructor(t,e,i){var n;let r=!1;i||(i=ht.ADAPTER.createCanvas(),r=!0),i.width=3,i.height=3;let s=Yt.from(i);s.orig=new ri,s.trim=new ri,super(s),this._ownCanvas=r,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=(n=GE.defaultResolution)!=null?n:ht.RESOLUTION,this._autoResolution=GE.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return mn.experimentalLetterSpacing}static set experimentalLetterSpacing(t){St.deprecation("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),mn.experimentalLetterSpacing=t}updateText(t){let e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();let i=this.context,r=mn.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=r.width,n=r.height,o=r.lines,a=r.lineHeight,l=r.lineWidths,c=r.maxLineWidth,d=r.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,s)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,n)+e.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;let m,g,_=e.dropShadow?2:1;for(let v=0;v<_;++v){let E=e.dropShadow&&v===0,b=E?Math.ceil(Math.max(1,n)+e.padding*2):0,T=b*this._resolution;if(E){i.fillStyle="black",i.strokeStyle="black";let M=e.dropShadowColor,k=e.dropShadowBlur*this._resolution,F=e.dropShadowDistance*this._resolution;i.shadowColor=mi.shared.setValue(M).setAlpha(e.dropShadowAlpha).toRgbaString(),i.shadowBlur=k,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*F,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*F+T}else i.fillStyle=this._generateFillStyle(e,o,r),i.strokeStyle=e.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let A=(a-d.fontSize)/2;a-d.fontSize<0&&(A=0);for(let M=0;M<o.length;M++)m=e.strokeThickness/2,g=e.strokeThickness/2+M*a+d.ascent+A,e.align==="right"?m+=c-l[M]:e.align==="center"&&(m+=(c-l[M])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[M],m+e.padding,g+e.padding-b,!0),e.fill&&this.drawLetterSpacing(o[M],m+e.padding,g+e.padding-b)}this.updateTexture()}drawLetterSpacing(t,e,i,r=!1){let n=this._style.letterSpacing,o=!1;if(mn.experimentalLetterSpacingSupported&&(mn.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),n===0||o){r?this.context.strokeText(t,e,i):this.context.fillText(t,e,i);return}let a=e,l=mn.graphemeSegmenter(t),c=this.context.measureText(t).width,d=0;for(let m=0;m<l.length;++m){let g=l[m];r?this.context.strokeText(g,a,i):this.context.fillText(g,a,i);let _="";for(let v=m+1;v<l.length;++v)_+=l[v];d=this.context.measureText(_).width,a+=c-d+n,c=d}}updateTexture(){let t=this.canvas;if(this._style.trim){let n=St.trimCanvas(t);n.data&&(t.width=n.width,t.height=n.height,this.context.putImageData(n.data,0,0))}let e=this._texture,i=this._style,r=i.trim?0:i.padding,s=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-r,e.trim.y=-r,e.orig.width=e._frame.width-r*2,e.orig.height=e._frame.height-r*2,this._onTextureUpdate(),s.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,i){let r=t.fill;if(Array.isArray(r)){if(r.length===1)return r[0]}else return r;let s,n=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,a=this.canvas.width/this._resolution-n-o*2,l=this.canvas.height/this._resolution-n-o*2,c=r.slice(),d=t.fillGradientStops.slice();if(!d.length){let m=c.length+1;for(let g=1;g<m;++g)d.push(g/m)}if(c.unshift(r[0]),d.unshift(0),c.push(r[r.length-1]),d.push(1),t.fillGradientType===ch.LINEAR_VERTICAL){s=this.context.createLinearGradient(a/2,o,a/2,l+o);let m=i.fontProperties.fontSize+t.strokeThickness;for(let g=0;g<e.length;g++){let _=i.lineHeight*(g-1)+m,v=i.lineHeight*g,E=v;g>0&&_>v&&(E=(v+_)/2);let b=v+m,T=i.lineHeight*(g+1),A=b;g+1<e.length&&T<b&&(A=(b+T)/2);let M=(A-E)/l;for(let k=0;k<c.length;k++){let F=0;typeof d[k]=="number"?F=d[k]:F=k/c.length;let O=Math.min(1,Math.max(0,E/l+F*M));O=Number(O.toFixed(5)),s.addColorStop(O,c[k])}}}else{s=this.context.createLinearGradient(o,l/2,a+o,l/2);let m=c.length+1,g=1;for(let _=0;_<c.length;_++){let v;typeof d[_]=="number"?v=d[_]:v=g/m,s.addColorStop(v,c[_]),g++}}return s}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},JX,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);let e=St.sign(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);let e=St.sign(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof Ln?this._style=t:this._style=new Ln(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t==null?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}},Rd=GE;Rd.defaultAutoResolution=!0;var im=class{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}};function eW(t,e){var r;let i=!1;if((r=t==null?void 0:t._textures)!=null&&r.length){for(let s=0;s<t._textures.length;s++)if(t._textures[s]instanceof Yt){let n=t._textures[s].baseTexture;e.includes(n)||(e.push(n),i=!0)}}return i}function tW(t,e){if(t.baseTexture instanceof ui){let i=t.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function iW(t,e){if(t._texture&&t._texture instanceof Yt){let i=t._texture.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function rW(t,e){return e instanceof Rd?(e.updateText(!0),!0):!1}function sW(t,e){if(e instanceof Ln){let i=e.toFontString();return mn.measureFont(i),!0}return!1}function nW(t,e){if(t instanceof Rd){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);let i=t._texture.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function oW(t,e){return t instanceof Ln?(e.includes(t)||e.push(t),!0):!1}var PD=class{constructor(t){this.limiter=new im(PD.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(nW),this.registerFindHook(oW),this.registerFindHook(eW),this.registerFindHook(tW),this.registerFindHook(iW),this.registerUploadHook(rW),this.registerUploadHook(sW)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Hs.system.addOnce(this.tick,this,Xa.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){let t=this.queue[0],e=!1;if(t&&!t._destroyed){for(let i=0,r=this.uploadHooks.length;i<r;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)Hs.system.addOnce(this.tick,this,Xa.UTILITY);else{this.ticking=!1;let t=this.completes.slice(0);this.completes.length=0;for(let e=0,i=t.length;e<i;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Qi)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Hs.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}},Dd=PD;Dd.uploadsPerFrame=4;Object.defineProperties(ht,{UPLOADS_PER_FRAME:{get(){return Dd.uploadsPerFrame},set(t){St.deprecation("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Dd.uploadsPerFrame=t}}});function RD(t,e){return e instanceof ui?(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0):!1}function aW(t,e){if(!(e instanceof Hi))return!1;let{geometry:i}=e;e.finishPoly(),i.updateBatches();let{batches:r}=i;for(let s=0;s<r.length;s++){let{texture:n}=r[s].style;n&&RD(t,n.baseTexture)}return i.batchable||t.geometry.bind(i,e._resolveDirectShader(t)),!0}function lW(t,e){return t instanceof Hi?(e.push(t),!0):!1}var rm=class extends Dd{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(lW),this.registerUploadHook(RD),this.registerUploadHook(aW)}};rm.extension={name:"prepare",type:gt.RendererSystem};Tt.add(rm);var Dbe=new ei;var DD=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`;var FD=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`;var LD=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`;var $E=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`;var ND=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;var Og=new fr,sm=class extends rc{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new yd,this.state=ro.for2d()}contextChange(){let e=this.renderer,i={globals:e.globalUniforms};this.simpleShader=no.from($E,ND,i),this.shader=e.context.webGLVersion>1?no.from(FD,DD,i):no.from($E,LD,i)}render(e){let i=this.renderer,r=this.quad,s=r.vertices;s[0]=s[6]=e._width*-e.anchor.x,s[1]=s[3]=e._height*-e.anchor.y,s[2]=s[4]=e._width*(1-e.anchor.x),s[5]=s[7]=e._height*(1-e.anchor.y);let n=e.uvRespectAnchor?e.anchor.x:0,o=e.uvRespectAnchor?e.anchor.y:0;s=r.uvs,s[0]=s[6]=-n,s[1]=s[3]=-o,s[2]=s[4]=1-n,s[5]=s[7]=1-o,r.invalidate();let a=e._texture,l=a.baseTexture,c=l.alphaMode>0,d=e.tileTransform.localTransform,m=e.uvMatrix,g=l.isPowerOfTwo&&a.frame.width===l.width&&a.frame.height===l.height;g&&(l._glTextures[i.CONTEXT_UID]?g=l.wrapMode!==_a.CLAMP:l.wrapMode===_a.CLAMP&&(l.wrapMode=_a.REPEAT));let _=g?this.simpleShader:this.shader,v=a.width,E=a.height,b=e._width,T=e._height;Og.set(d.a*v/b,d.b*v/T,d.c*E/b,d.d*E/T,d.tx/b,d.ty/T),Og.invert(),g?Og.prepend(m.mapCoord):(_.uniforms.uMapCoord=m.mapCoord.toArray(!0),_.uniforms.uClampFrame=m.uClampFrame,_.uniforms.uClampOffset=m.uClampOffset),_.uniforms.uTransform=Og.toArray(!0),_.uniforms.uColor=mi.shared.setValue(e.tint).premultiply(e.worldAlpha,c).toArray(_.uniforms.uColor),_.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),_.uniforms.uSampler=a,i.shader.bind(_),i.geometry.bind(r),this.state.blendMode=St.correctBlendMode(e.blendMode,c),i.state.set(this.state),i.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}};sm.extension={name:"tilingSprite",type:gt.RendererPlugin};Tt.add(sm);var nm=class{constructor(t,e,i=null){this.linkedSheets=[],this._texture=t instanceof Yt?t:null,this.baseTexture=t instanceof ui?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;let r=this.baseTexture.resource;this.resolution=this._updateResolution(i||(r?r.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){let{scale:e}=this.data.meta,i=St.getResolutionOfUrl(t,null);return i===null&&(i=parseFloat(e!=null?e:"1")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=nm.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t,i=nm.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){let r=this._frameKeys[e],s=this._frames[r],n=s.frame;if(n){let o=null,a=null,l=s.trimmed!==!1&&s.sourceSize?s.sourceSize:s.frame,c=new ri(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);s.rotated?o=new ri(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):o=new ri(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),s.trimmed!==!1&&s.spriteSourceSize&&(a=new ri(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[r]=new Yt(this.baseTexture,o,c,a,s.rotated?2:0,s.anchor,s.borders),Yt.addToCache(this.textures[r],r)}e++}}_processAnimations(){let t=this.data.animations||{};for(let e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){let r=t[e][i];this.animations[e].push(this.textures[r])}}}_parseComplete(){let t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*nm.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*nm.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(let i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}},om=nm;om.BATCH_SIZE=1e3;var cW=["jpg","png","jpeg","avif","webp"];function OD(t,e,i){let r={};if(t.forEach(s=>{r[s]=e}),Object.keys(e.textures).forEach(s=>{r[s]=e.textures[s]}),!i){let s=St.path.dirname(t[0]);e.linkedSheets.forEach((n,o)=>{let a=OD([`${s}/${e.data.meta.related_multi_packs[o]}`],n,!0);Object.assign(r,a)})}return r}var BD={extension:gt.Asset,cache:{test:t=>t instanceof om,getCacheableAssets:(t,e)=>OD(t,e,!1)},resolver:{test:t=>{let i=t.split("?")[0].split("."),r=i.pop(),s=i.pop();return r==="json"&&cW.includes(s)},parse:t=>{var i,r;let e=t.split(".");return{resolution:parseFloat((r=(i=ht.RETINA_PREFIX.exec(t))==null?void 0:i[1])!=null?r:"1"),format:e[e.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:gt.LoadParser,priority:pn.Normal},testParse(t,e){return ii(this,null,function*(){return St.path.extname(e.src).toLowerCase()===".json"&&!!t.frames})},parse(t,e,i){return ii(this,null,function*(){var c,d;let r=St.path.dirname(e.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");let s=r+t.meta.image;s=Td(s,e.src);let o=(yield i.load([s]))[s],a=new om(o.baseTexture,t,e.src);yield a.parse();let l=(c=t==null?void 0:t.meta)==null?void 0:c.related_multi_packs;if(Array.isArray(l)){let m=[];for(let _ of l){if(typeof _!="string")continue;let v=r+_;(d=e.data)!=null&&d.ignoreMultiPack||(v=Td(v,e.src),m.push(i.load({src:v,data:{ignoreMultiPack:!0}})))}let g=yield Promise.all(m);a.linkedSheets=g,g.forEach(_=>{_.linkedSheets=[a].concat(a.linkedSheets.filter(v=>v!==_))})}return a})},unload(t){t.destroy(!0)}}};Tt.add(BD);var $c=class{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}};var Hc=class{static test(e){return typeof e=="string"&&e.startsWith("info face=")}static parse(e){let i=e.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(let n in i){let o=i[n].match(/^[a-z]+/gm)[0],a=i[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(let c in a){let d=a[c].split("="),m=d[0],g=d[1].replace(/"/gm,""),_=parseFloat(g),v=isNaN(_)?g:_;l[m]=v}r[o].push(l)}let s=new $c;return r.info.forEach(n=>s.info.push({face:n.face,size:parseInt(n.size,10)})),r.common.forEach(n=>s.common.push({lineHeight:parseInt(n.lineHeight,10)})),r.page.forEach(n=>s.page.push({id:parseInt(n.id,10),file:n.file})),r.char.forEach(n=>s.char.push({id:parseInt(n.id,10),page:parseInt(n.page,10),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10),xoffset:parseInt(n.xoffset,10),yoffset:parseInt(n.yoffset,10),xadvance:parseInt(n.xadvance,10)})),r.kerning.forEach(n=>s.kerning.push({first:parseInt(n.first,10),second:parseInt(n.second,10),amount:parseInt(n.amount,10)})),r.distanceField.forEach(n=>s.distanceField.push({distanceRange:parseInt(n.distanceRange,10),fieldType:n.fieldType})),s}};var qu=class{static test(e){let i=e;return"getElementsByTagName"in i&&i.getElementsByTagName("page").length&&i.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(e){let i=new $c,r=e.getElementsByTagName("info"),s=e.getElementsByTagName("common"),n=e.getElementsByTagName("page"),o=e.getElementsByTagName("char"),a=e.getElementsByTagName("kerning"),l=e.getElementsByTagName("distanceField");for(let c=0;c<r.length;c++)i.info.push({face:r[c].getAttribute("face"),size:parseInt(r[c].getAttribute("size"),10)});for(let c=0;c<s.length;c++)i.common.push({lineHeight:parseInt(s[c].getAttribute("lineHeight"),10)});for(let c=0;c<n.length;c++)i.page.push({id:parseInt(n[c].getAttribute("id"),10)||0,file:n[c].getAttribute("file")});for(let c=0;c<o.length;c++){let d=o[c];i.char.push({id:parseInt(d.getAttribute("id"),10),page:parseInt(d.getAttribute("page"),10)||0,x:parseInt(d.getAttribute("x"),10),y:parseInt(d.getAttribute("y"),10),width:parseInt(d.getAttribute("width"),10),height:parseInt(d.getAttribute("height"),10),xoffset:parseInt(d.getAttribute("xoffset"),10),yoffset:parseInt(d.getAttribute("yoffset"),10),xadvance:parseInt(d.getAttribute("xadvance"),10)})}for(let c=0;c<a.length;c++)i.kerning.push({first:parseInt(a[c].getAttribute("first"),10),second:parseInt(a[c].getAttribute("second"),10),amount:parseInt(a[c].getAttribute("amount"),10)});for(let c=0;c<l.length;c++)i.distanceField.push({fieldType:l[c].getAttribute("fieldType"),distanceRange:parseInt(l[c].getAttribute("distanceRange"),10)});return i}};var Yu=class{static test(e){return typeof e=="string"&&e.includes("<font>")?qu.test(ht.ADAPTER.parseXML(e)):!1}static parse(e){return qu.parse(ht.ADAPTER.parseXML(e))}};var HE=[Hc,qu,Yu];function VE(t){for(let e=0;e<HE.length;e++)if(HE[e].test(t))return HE[e];return null}function jE(t,e,i,r,s,n){let o=i.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let a,l=i.dropShadow?i.dropShadowDistance:0,c=i.padding||0,d=t.width/r-l-c*2,m=t.height/r-l-c*2,g=o.slice(),_=i.fillGradientStops.slice();if(!_.length){let v=g.length+1;for(let E=1;E<v;++E)_.push(E/v)}if(g.unshift(o[0]),_.unshift(0),g.push(o[o.length-1]),_.push(1),i.fillGradientType===ch.LINEAR_VERTICAL){a=e.createLinearGradient(d/2,c,d/2,m+c);let v=0,b=(n.fontProperties.fontSize+i.strokeThickness)/m;for(let T=0;T<s.length;T++){let A=n.lineHeight*T;for(let M=0;M<g.length;M++){let k=0;typeof _[M]=="number"?k=_[M]:k=M/g.length;let F=A/m+k*b,O=Math.max(v,F);O=Math.min(O,1),a.addColorStop(O,g[M]),v=O}}}else{a=e.createLinearGradient(c,m/2,d+c,m/2);let v=g.length+1,E=1;for(let b=0;b<g.length;b++){let T;typeof _[b]=="number"?T=_[b]:T=E/v,a.addColorStop(T,g[b]),E++}}return a}function XE(t,e,i,r,s,n,o){let a=i.text,l=i.fontProperties;e.translate(r,s),e.scale(n,n);let c=o.strokeThickness/2,d=-(o.strokeThickness/2);if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=jE(t,e,o,n,[a],i),e.strokeStyle=o.stroke,o.dropShadow){let m=o.dropShadowColor,g=o.dropShadowBlur*n,_=o.dropShadowDistance*n;e.shadowColor=mi.shared.setValue(m).setAlpha(o.dropShadowAlpha).toRgbaString(),e.shadowBlur=g,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*_,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*_}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,c,d+i.lineHeight-l.descent),o.fill&&e.fillText(a,c,d+i.lineHeight-l.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function Fd(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}function am(t){return Array.from?Array.from(t):t.split("")}function WE(t){typeof t=="string"&&(t=[t]);let e=[];for(let i=0,r=t.length;i<r;i++){let s=t[i];if(Array.isArray(s)){if(s.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);let n=s[0].charCodeAt(0),o=s[1].charCodeAt(0);if(o<n)throw new Error("[BitmapFont]: Invalid character range.");for(let a=n,l=o;a<=l;a++)e.push(String.fromCharCode(a))}else e.push(...am(s))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}var cc=class{constructor(t,e,i){var c,d;let[r]=t.info,[s]=t.common,[n]=t.page,[o]=t.distanceField,a=St.getResolutionOfUrl(n.file),l={};this._ownsTextures=i,this.font=r.face,this.size=r.size,this.lineHeight=s.lineHeight/a,this.chars={},this.pageTextures=l;for(let m=0;m<t.page.length;m++){let{id:g,file:_}=t.page[m];l[g]=e instanceof Array?e[m]:e[_],o!=null&&o.fieldType&&o.fieldType!=="none"&&(l[g].baseTexture.alphaMode=tn.NO_PREMULTIPLIED_ALPHA,l[g].baseTexture.mipmap=An.OFF)}for(let m=0;m<t.char.length;m++){let{id:g,page:_}=t.char[m],{x:v,y:E,width:b,height:T,xoffset:A,yoffset:M,xadvance:k}=t.char[m];v/=a,E/=a,b/=a,T/=a,A/=a,M/=a,k/=a;let F=new ri(v+l[_].frame.x/a,E+l[_].frame.y/a,b,T);this.chars[g]={xOffset:A,yOffset:M,xAdvance:k,kerning:{},texture:new Yt(l[_].baseTexture,F),page:_}}for(let m=0;m<t.kerning.length;m++){let{first:g,second:_,amount:v}=t.kerning[m];g/=a,_/=a,v/=a,this.chars[_]&&(this.chars[_].kerning[g]=v)}this.distanceFieldRange=o==null?void 0:o.distanceRange,this.distanceFieldType=(d=(c=o==null?void 0:o.fieldType)==null?void 0:c.toLowerCase())!=null?d:"none"}destroy(){for(let t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(let t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,i){let r;if(t instanceof $c)r=t;else{let n=VE(t);if(!n)throw new Error("Unrecognized data format for font.");r=n.parse(t)}e instanceof Yt&&(e=[e]);let s=new cc(r,e,i);return cc.available[s.font]=s,s}static uninstall(t){let e=cc.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete cc.available[t]}static from(t,e,i){if(!t)throw new Error("[BitmapFont] Property `name` is required.");let O=Object.assign({},cc.defaultOptions,i),{chars:r,padding:s,resolution:n,textureWidth:o,textureHeight:a}=O,l=df(O,["chars","padding","resolution","textureWidth","textureHeight"]),c=WE(r),d=e instanceof Ln?e:new Ln(e),m=o,g=new $c;g.info[0]={face:d.fontFamily,size:d.fontSize},g.common[0]={lineHeight:d.fontSize};let _=0,v=0,E,b,T,A=0,M=[],k=[];for(let B=0;B<c.length;B++){E||(E=ht.ADAPTER.createCanvas(),E.width=o,E.height=a,b=E.getContext("2d"),T=new ui(E,di({resolution:n},l)),M.push(T),k.push(new Yt(T)),g.page.push({id:k.length-1,file:""}));let U=c[B],z=mn.measureText(U,d,!1,E),Z=z.width,W=Math.ceil(z.height),q=Math.ceil((d.fontStyle==="italic"?2:1)*Z);if(v>=a-W*n){if(v===0)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${U}')`);--B,E=null,b=null,T=null,v=0,_=0,A=0;continue}if(A=Math.max(W+z.fontProperties.descent,A),q*n+_>=m){if(_===0)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${U}')`);--B,v+=A*n,v=Math.ceil(v),_=0,A=0;continue}XE(E,b,z,_,v,n,d);let Q=Fd(z.text);g.char.push({id:Q,page:k.length-1,x:_/n,y:v/n,width:q,height:W,xoffset:0,yoffset:0,xadvance:Z-(d.dropShadow?d.dropShadowDistance:0)-(d.stroke?d.strokeThickness:0)}),_+=(q+2*s)*n,_=Math.ceil(_)}for(let B=0,U=c.length;B<U;B++){let z=c[B];for(let Z=0;Z<U;Z++){let W=c[Z],q=b.measureText(z).width,Q=b.measureText(W).width,le=b.measureText(z+W).width-(q+Q);le&&g.kerning.push({first:Fd(z),second:Fd(W),amount:le})}}let F=new cc(g,k,!0);return cc.available[t]!==void 0&&cc.uninstall(t),cc.available[t]=F,F}},Vs=cc;Vs.ALPHA=[["a","z"],["A","Z"]," "];Vs.NUMERIC=[["0","9"]];Vs.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];Vs.ASCII=[[" ","~"]];Vs.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:cc.ALPHANUMERIC};Vs.available={};var UD=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`;var zD=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;var GD=[],$D=[],HD=[],VD=class extends Qi{constructor(t,e={}){super();let{align:i,tint:r,maxWidth:s,letterSpacing:n,fontName:o,fontSize:a}=Object.assign({},VD.styleDefaults,e);if(!Vs.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new mi(r),this._font=void 0,this._fontName=o,this._fontSize=a,this.text=t,this._maxWidth=s,this._maxLineHeight=0,this._letterSpacing=n,this._anchor=new Ko(()=>{this.dirty=!0},this,0,0),this._roundPixels=ht.ROUND_PIXELS,this.dirty=!0,this._resolution=ht.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var Z;let t=Vs.available[this._fontName],e=this.fontSize,i=e/t.size,r=new ei,s=[],n=[],o=[],a=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",l=am(a),c=this._maxWidth*t.size/e,d=t.distanceFieldType==="none"?GD:$D,m=null,g=0,_=0,v=0,E=-1,b=0,T=0,A=0,M=0;for(let W=0;W<l.length;W++){let q=l[W],Q=Fd(q);if(/(?:\s)/.test(q)&&(E=W,b=g,M++),q==="\r"||q===`
`){n.push(g),o.push(-1),_=Math.max(_,g),++v,++T,r.x=0,r.y+=t.lineHeight,m=null,M=0;continue}let V=t.chars[Q];if(!V)continue;m&&V.kerning[m]&&(r.x+=V.kerning[m]);let le=HD.pop()||{texture:Yt.EMPTY,line:0,charCode:0,prevSpaces:0,position:new ei};le.texture=V.texture,le.line=v,le.charCode=Q,le.position.x=Math.round(r.x+V.xOffset+this._letterSpacing/2),le.position.y=Math.round(r.y+V.yOffset),le.prevSpaces=M,s.push(le),g=le.position.x+Math.max(V.xAdvance-V.xOffset,V.texture.orig.width),r.x+=V.xAdvance+this._letterSpacing,A=Math.max(A,V.yOffset+V.texture.height),m=Q,E!==-1&&c>0&&r.x>c&&(++T,St.removeItems(s,1+E-T,1+W-E),W=E,E=-1,n.push(b),o.push(s.length>0?s[s.length-1].prevSpaces:0),_=Math.max(_,b),v++,r.x=0,r.y+=t.lineHeight,m=null,M=0)}let k=l[l.length-1];k!=="\r"&&k!==`
`&&(/(?:\s)/.test(k)&&(g=b),n.push(g),_=Math.max(_,g),o.push(-1));let F=[];for(let W=0;W<=v;W++){let q=0;this._align==="right"?q=_-n[W]:this._align==="center"?q=(_-n[W])/2:this._align==="justify"&&(q=o[W]<0?0:(_-n[W])/o[W]),F.push(q)}let O=s.length,B={},U=[],z=this._activePagesMeshData;d.push(...z);for(let W=0;W<O;W++){let q=s[W].texture,Q=q.baseTexture.uid;if(!B[Q]){let V=d.pop();if(!V){let de=new Wu,ne,ee;t.distanceFieldType==="none"?(ne=new Tl(Yt.EMPTY),ee=ki.NORMAL):(ne=new Tl(Yt.EMPTY,{program:qn.from(zD,UD),uniforms:{uFWidth:0}}),ee=ki.NORMAL_NPM);let re=new lc(de,ne);re.blendMode=ee,V={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:re,vertices:null,uvs:null,indices:null}}V.index=0,V.indexCount=0,V.vertexCount=0,V.uvsCount=0,V.total=0;let{_textureCache:le}=this;le[Q]=le[Q]||new Yt(q.baseTexture),V.mesh.texture=le[Q],V.mesh.tint=this._tintColor.value,U.push(V),B[Q]=V}B[Q].total++}for(let W=0;W<z.length;W++)U.includes(z[W])||this.removeChild(z[W].mesh);for(let W=0;W<U.length;W++)U[W].mesh.parent!==this&&this.addChild(U[W].mesh);this._activePagesMeshData=U;for(let W in B){let q=B[W],Q=q.total;if(!(((Z=q.indices)==null?void 0:Z.length)>6*Q)||q.vertices.length<lc.BATCHABLE_SIZE*2)q.vertices=new Float32Array(4*2*Q),q.uvs=new Float32Array(4*2*Q),q.indices=new Uint16Array(6*Q);else{let V=q.total,le=q.vertices;for(let de=V*4*2;de<le.length;de++)le[de]=0}q.mesh.size=6*Q}for(let W=0;W<O;W++){let q=s[W],Q=q.position.x+F[q.line]*(this._align==="justify"?q.prevSpaces:1);this._roundPixels&&(Q=Math.round(Q));let V=Q*i,le=q.position.y*i,de=q.texture,ne=B[de.baseTexture.uid],ee=de.frame,re=de._uvs,te=ne.index++;ne.indices[te*6+0]=0+te*4,ne.indices[te*6+1]=1+te*4,ne.indices[te*6+2]=2+te*4,ne.indices[te*6+3]=0+te*4,ne.indices[te*6+4]=2+te*4,ne.indices[te*6+5]=3+te*4,ne.vertices[te*8+0]=V,ne.vertices[te*8+1]=le,ne.vertices[te*8+2]=V+ee.width*i,ne.vertices[te*8+3]=le,ne.vertices[te*8+4]=V+ee.width*i,ne.vertices[te*8+5]=le+ee.height*i,ne.vertices[te*8+6]=V,ne.vertices[te*8+7]=le+ee.height*i,ne.uvs[te*8+0]=re.x0,ne.uvs[te*8+1]=re.y0,ne.uvs[te*8+2]=re.x1,ne.uvs[te*8+3]=re.y1,ne.uvs[te*8+4]=re.x2,ne.uvs[te*8+5]=re.y2,ne.uvs[te*8+6]=re.x3,ne.uvs[te*8+7]=re.y3}this._textWidth=_*i,this._textHeight=(r.y+t.lineHeight)*i;for(let W in B){let q=B[W];if(this.anchor.x!==0||this.anchor.y!==0){let de=0,ne=this._textWidth*this.anchor.x,ee=this._textHeight*this.anchor.y;for(let re=0;re<q.total;re++)q.vertices[de++]-=ne,q.vertices[de++]-=ee,q.vertices[de++]-=ne,q.vertices[de++]-=ee,q.vertices[de++]-=ne,q.vertices[de++]-=ee,q.vertices[de++]-=ne,q.vertices[de++]-=ee}this._maxLineHeight=A*i;let Q=q.mesh.geometry.getBuffer("aVertexPosition"),V=q.mesh.geometry.getBuffer("aTextureCoord"),le=q.mesh.geometry.getIndex();Q.data=q.vertices,V.data=q.uvs,le.data=q.indices,Q.update(),V.update(),le.update()}for(let W=0;W<s.length;W++)HD.push(s[W]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);let{distanceFieldRange:e,distanceFieldType:i,size:r}=Vs.available[this._fontName];if(i!=="none"){let{a:s,b:n,c:o,d:a}=this.worldTransform,l=Math.sqrt(s*s+n*n),c=Math.sqrt(o*o+a*a),d=(Math.abs(l)+Math.abs(c))/2,m=this.fontSize/r,g=t._view.resolution;for(let _ of this._activePagesMeshData)_.mesh.shader.uniforms.uFWidth=d*e*m*g}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){let t=Vs.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!Vs.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){var t;return(t=this._fontSize)!=null?t:Vs.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t==null?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){let{_textureCache:e}=this,r=Vs.available[this._fontName].distanceFieldType==="none"?GD:$D;r.push(...this._activePagesMeshData);for(let s of this._activePagesMeshData)this.removeChild(s.mesh);this._activePagesMeshData=[],r.filter(s=>e[s.mesh.texture.baseTexture.uid]).forEach(s=>{s.mesh.texture=Yt.EMPTY});for(let s in e)e[s].destroy(),delete e[s];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}},R2=VD;R2.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};var uW=[".xml",".fnt"],jD={extension:{type:gt.LoadParser,priority:pn.Normal},name:"loadBitmapFont",test(t){return uW.includes(St.path.extname(t).toLowerCase())},testParse(t){return ii(this,null,function*(){return Hc.test(t)||Yu.test(t)})},parse(t,e,i){return ii(this,null,function*(){let r=Hc.test(t)?Hc.parse(t):Yu.parse(t),{src:s}=e,{page:n}=r,o=[];for(let c=0;c<n.length;++c){let d=n[c].file,m=St.path.join(St.path.dirname(s),d);m=Td(m,s),o.push(m)}let a=yield i.load(o),l=o.map(c=>a[c]);return Vs.install(r,l,!0)})},load(t,e){return ii(this,null,function*(){return(yield ht.ADAPTER.fetch(t)).text()})},unload(t){t.destroy()}};Tt.add(jD);var D2=class extends Ln{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new D2(Object.keys(D2.defaultOptions).reduce((e,i)=>Tn(di({},e),{[i]:t[i]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete D2.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){let{availableFonts:i}=D2;if(i[t]){let r=i[t];return this._fonts.push(r),r.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return ht.ADAPTER.fetch(t).then(r=>r.blob()).then(r=>ii(this,null,function*(){return new Promise((s,n)=>{let o=URL.createObjectURL(r),a=new FileReader;a.onload=()=>s([o,a.result]),a.onerror=n,a.readAsDataURL(r)})})).then(n=>ii(this,[n],function*([r,s]){let o=Object.assign({family:St.path.basename(t,St.path.extname(t)),weight:"normal",style:"normal",src:r,dataSrc:s,refs:1,originalUrl:t,fontFace:null},e);i[t]=o,this._fonts.push(o),this.styleID++;let a=new FontFace(o.family,`url(${o.src})`,{weight:o.weight,style:o.style});o.fontFace=a,yield a.load(),document.fonts.add(a),yield document.fonts.ready,this.styleID++,this.fontsDirty=!0}))}addOverride(...t){let e=t.filter(i=>!this._overrides.includes(i));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){let e=t.filter(i=>this._overrides.includes(i));e.length>0&&(this._overrides=this._overrides.filter(i=>!e.includes(i)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style}; 
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=St.rgb2hex(t)),typeof t=="number"?St.hex2string(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor),e=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),r=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));let s=`${i}px ${r}px`;return this.dropShadowBlur>0?`text-shadow: ${s} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${s} ${t}`}reset(){Object.assign(this,D2.defaultOptions)}onBeforeDraw(){let{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){let{userAgent:t}=ht.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}},Ld=D2;Ld.availableFonts={};Ld.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};var F2=class extends rs{constructor(t="",e={}){var d;super(Yt.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;let i=new Image,r=Yt.from(i,{scaleMode:ht.SCALE_MODE,resourceOptions:{autoLoad:!1}});r.orig=new ri,r.trim=new ri,this.texture=r;let s="http://www.w3.org/2000/svg",n="http://www.w3.org/1999/xhtml",o=document.createElementNS(s,"svg"),a=document.createElementNS(s,"foreignObject"),l=document.createElementNS(n,"div"),c=document.createElementNS(n,"style");a.setAttribute("width","10000"),a.setAttribute("height","10000"),a.style.overflow="hidden",o.appendChild(a),this.maxWidth=F2.defaultMaxWidth,this.maxHeight=F2.defaultMaxHeight,this._domElement=l,this._styleElement=c,this._svgRoot=o,this._foreignObject=a,this._foreignObject.appendChild(c),this._foreignObject.appendChild(l),this._image=i,this._loadImage=new Image,this._autoResolution=F2.defaultAutoResolution,this._resolution=(d=F2.defaultResolution)!=null?d:ht.RESOLUTION,this.text=t,this.style=e}measureText(t){var a,l;let{text:e,style:i,resolution:r}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:i.toCSS(r)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);let s=this._domElement.getBoundingClientRect();this._svgRoot.remove();let n=Math.min(this.maxWidth,Math.ceil(s.width)),o=Math.min(this.maxHeight,Math.ceil(s.height));return this._svgRoot.setAttribute("width",n.toString()),this._svgRoot.setAttribute("height",o.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:(a=this._style)==null?void 0:a.toCSS(r)}),this._styleElement.textContent=(l=this._style)==null?void 0:l.toGlobalCSS()),{width:n+i.padding*2,height:o+i.padding*2}}updateText(t=!0){return ii(this,null,function*(){let{style:e,_image:i,_loadImage:r}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;let{width:s,height:n}=this.measureText();i.width=r.width=Math.ceil(Math.max(1,s)),i.height=r.height=Math.ceil(Math.max(1,n)),this._loading||(this._loading=!0,yield new Promise(o=>{r.onload=()=>ii(this,null,function*(){yield e.onBeforeDraw(),this._loading=!1,i.src=r.src,r.onload=null,r.src="",this.updateTexture(),o()});let a=new XMLSerializer().serializeToString(this._svgRoot);r.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(a)}`}))})}get source(){return this._image}updateTexture(){let{style:t,texture:e,_image:i,resolution:r}=this,{padding:s}=t,{baseTexture:n}=e;e.trim.width=e._frame.width=i.width/r,e.trim.height=e._frame.height=i.height/r,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-s*2,e.orig.height=e._frame.height-s*2,this._onTextureUpdate(),n.setRealSize(i.width,i.height,r),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){var i,r,s,n,o;typeof t=="boolean"&&(t={children:t}),t=Object.assign({},F2.defaultDestroyOptions,t),super.destroy(t);let e=null;this.ownsStyle&&((i=this._style)==null||i.cleanFonts()),this._style=e,(r=this._svgRoot)==null||r.remove(),this._svgRoot=e,(s=this._domElement)==null||s.remove(),this._domElement=e,(n=this._foreignObject)==null||n.remove(),this._foreignObject=e,(o=this._styleElement)==null||o.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);let e=St.sign(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);let e=St.sign(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof Ld?(this.ownsStyle=!1,this._style=t):t instanceof Ln?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=Ld.from(t)):(this.ownsStyle=!0,this._style=new Ld(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}},lm=F2;lm.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0};lm.defaultMaxWidth=2024;lm.defaultMaxHeight=2024;lm.defaultAutoResolution=!0;function kr(t,e){return t.reduce(function(i,r){let s=typeof r=="string"?e.hasEntity(r):r;if(s){let n=s.extent(e);i.min=[Math.min(i.min[0],n.min[0]),Math.min(i.min[1],n.min[1])],i.max=[Math.max(i.max[0],n.max[0]),Math.max(i.max[1],n.max[1])]}return i},new mt)}function qE(t){let e=[];for(let i=0;i<t.length;i+=2)e.push(new ei(t[i],t[i+1]));return e}function Ki(t,e,i){let r=i.scene();e?t.forEach(s=>r.classData("osm",s,"highlighted")):r.clearClass("highlighted"),i.systems.map.immediateRedraw()}function Sl(t,e,i,r,s){let n=`translate3d(${e}px,${i}px,0)`,o=r?` scale(${r})`:"",a=s?` rotate(${s}deg)`:"";return t.style("transform",`${n}${o}${a}`)}function cm(t){let e=t.getBoundingClientRect(),i=e.left,r=e.top,s=+t.clientLeft,n=+t.clientTop;return function(o){return[o.clientX-i-s,o.clientY-r-n]}}function L2(t,e){return t<0&&(t+=Math.ceil(-t/e)*e),t%e}function ss(t){return typeof t=="function"?t:()=>t}function Ri(t){let e=t.size()&&t.node().tagName.toLowerCase()==="textarea";return t.attr("autocomplete","new-password").attr("autocorrect","off").attr("autocapitalize","off").attr("spellcheck",e?"true":"false")}var um=class extends Error{constructor(e){let i=e.status+" "+e.statusText;super(i),this.name="FetchError",this.status=e.status,this.statusText=e.statusText,this.response=e}};function Ai(t){if(!t.ok)throw new um(t);let e=(t.headers.get("content-type")||"").split(";")[0];if(!e)switch((new URL(t.url).pathname.split("/").at(-1)||"").toLowerCase().split(".").at(-1)||""){case"geojson":case"json":e="application/json";break;case"htm":case"html":e="text/html";break;case"svg":e="image/svg+xml";break;case"gpx":case"kml":case"xml":e="application/xml";break;case"mvt":case"pb":case"pbf":case"pmtiles":case"proto":e="application/protobuf";break;default:e="text/plain"}switch(e){case"application/geo+json":case"application/json":case"application/vnd.geo+json":case"text/x-json":return t.status===204||t.status===205?void 0:t.json();case"application/xhtml+xml":case"application/xml":case"image/svg+xml":case"text/html":case"text/xml":return t.text().then(i=>new window.DOMParser().parseFromString(i,e));case"application/octet-stream":case"application/protobuf":case"application/vnd.google.protobuf":case"application/vnd.mapbox-vector-tile":case"application/x-protobuf":return t.arrayBuffer();default:return t.text()}}function si(t,e){function i(r){function s(){delete this.value}function n(){this.value!==r&&(this.value=r)}function o(){var a=r.apply(this,arguments);a==null?delete this.value:this.value!==a&&(this.value=a)}return r==null?s:typeof r=="function"?o:n}return arguments.length===1?t.property("value"):t.each(i(e))}function $i(t){var e={};function i(o,a){var l=!1,c=Object.keys(e).map(function(_){return e[_]}),d,m;for(d=0;d<c.length;d++)if(m=c[d],!!m.event.modifiers.shiftKey&&!!m.capture===a&&g(o,m,!0)){m.callback(o),l=!0;break}if(l)return;for(d=0;d<c.length;d++)if(m=c[d],!m.event.modifiers.shiftKey&&!!m.capture===a&&g(o,m,!1)){m.callback(o);break}function g(_,v,E){var b=_,T=!1,A=!0;return b.key!==void 0&&(A=b.key.charCodeAt(0)>255,T=!0,v.event.key===void 0?T=!1:Array.isArray(v.event.key)?v.event.key.map(function(M){return M.toLowerCase()}).indexOf(b.key.toLowerCase())===-1&&(T=!1):b.key.toLowerCase()!==v.event.key.toLowerCase()&&(T=!1)),!T&&A&&(T=b.keyCode===v.event.keyCode),!(!T||!(b.ctrlKey&&b.altKey)&&(b.ctrlKey!==v.event.modifiers.ctrlKey||b.altKey!==v.event.modifiers.altKey)||b.metaKey!==v.event.modifiers.metaKey||E&&b.shiftKey!==v.event.modifiers.shiftKey)}}function r(o){i(o,!0)}function s(o){var a=ye(o.target).node().tagName;a==="INPUT"||a==="SELECT"||a==="TEXTAREA"||i(o,!1)}function n(o){return o=o||ye(document),o.on("keydown.capture."+t,r,!0),o.on("keydown.bubble."+t,s,!1),n}return n.unbind=function(o){return e=[],o=o||ye(document),o.on("keydown.capture."+t,null),o.on("keydown.bubble."+t,null),n},n.clear=function(){return e={},n},n.off=function(o,a){for(var l=Ei([].concat(o)),c=0;c<l.length;c++){var d=l[c]+(a?"-capture":"-bubble");delete e[d]}return n},n.on=function(o,a,l){if(typeof a!="function")return n.off(o,l);for(var c=Ei([].concat(o)),d=0;d<c.length;d++){var m=c[d]+(l?"-capture":"-bubble"),g={id:m,capture:l,callback:a,event:{key:void 0,keyCode:0,modifiers:{shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1}}};e[m]&&console.warn('warning: duplicate keybinding for "'+m+'"'),e[m]=g;for(var _=c[d].toLowerCase().match(/(?:(?:[^+])+|[]|\+\+|^\+$)/g),v=0;v<_.length;v++)if(_[v]==="++"&&(_[v]="+"),_[v]in $i.modifierCodes){var E=$i.modifierProperties[$i.modifierCodes[_[v]]];g.event.modifiers[E]=!0}else g.event.key=$i.keys[_[v]]||_[v],_[v]in $i.keyCodes&&(g.event.keyCode=$i.keyCodes[_[v]])}return n},n}$i.modifierCodes={"\u21E7":16,shift:16,"\u2303":17,ctrl:17,"\u2325":18,alt:18,option:18,"\u2318":91,meta:91,cmd:91,super:91,win:91};$i.modifierProperties={16:"shiftKey",17:"ctrlKey",18:"altKey",91:"metaKey"};$i.plusKeys=["plus","ffplus","=","ffequals","\u2260","\xB1"];$i.minusKeys=["_","-","ffminus","dash","\u2013","\u2014"];$i.keys={"\u232B":"Backspace",backspace:"Backspace","\u21E5":"Tab","\u21C6":"Tab",tab:"Tab","\u21A9":"Enter","\u21B5":"Enter","\u23CE":"Enter",return:"Enter",enter:"Enter","\u2305":"Enter",pause:"Pause","pause-break":"Pause","\u21EA":"CapsLock",caps:"CapsLock","caps-lock":"CapsLock","\u238B":["Escape","Esc"],escape:["Escape","Esc"],esc:["Escape","Esc"],space:[" ","Spacebar"],"\u2196":"PageUp",pgup:"PageUp","page-up":"PageUp","\u2198":"PageDown",pgdown:"PageDown","page-down":"PageDown","\u21DF":"End",end:"End","\u21DE":"Home",home:"Home",ins:"Insert",insert:"Insert","\u2326":["Delete","Del"],del:["Delete","Del"],delete:["Delete","Del"],"\u2190":["ArrowLeft","Left"],left:["ArrowLeft","Left"],"arrow-left":["ArrowLeft","Left"],"\u2191":["ArrowUp","Up"],up:["ArrowUp","Up"],"arrow-up":["ArrowUp","Up"],"\u2192":["ArrowRight","Right"],right:["ArrowRight","Right"],"arrow-right":["ArrowRight","Right"],"\u2193":["ArrowDown","Down"],down:["ArrowDown","Down"],"arrow-down":["ArrowDown","Down"],"*":["*","Multiply"],star:["*","Multiply"],asterisk:["*","Multiply"],multiply:["*","Multiply"],"+":["+","Add"],plus:["+","Add"],"-":["-","Subtract"],subtract:["-","Subtract"],dash:["-","Subtract"],semicolon:";",equals:"=",comma:",",period:".","full-stop":".",slash:"/","forward-slash":"/",tick:"`","back-quote":"`","open-bracket":"[","back-slash":"\\","close-bracket":"]",quote:"'",apostrophe:"'","num-0":"0","num-1":"1","num-2":"2","num-3":"3","num-4":"4","num-5":"5","num-6":"6","num-7":"7","num-8":"8","num-9":"9",f1:"F1",f2:"F2",f3:"F3",f4:"F4",f5:"F5",f6:"F6",f7:"F7",f8:"F8",f9:"F9",f10:"F10",f11:"F11",f12:"F12",f13:"F13",f14:"F14",f15:"F15",f16:"F16",f17:"F17",f18:"F18",f19:"F19",f20:"F20",f21:"F21",f22:"F22",f23:"F23",f24:"F24",f25:"F25"};$i.keyCodes={"\u232B":8,backspace:8,"\u21E5":9,"\u21C6":9,tab:9,"\u21A9":13,"\u21B5":13,"\u23CE":13,return:13,enter:13,"\u2305":13,pause:19,"pause-break":19,"\u21EA":20,caps:20,"caps-lock":20,"\u238B":27,escape:27,esc:27,space:32,"\u2196":33,pgup:33,"page-up":33,"\u2198":34,pgdown:34,"page-down":34,"\u21DF":35,end:35,"\u21DE":36,home:36,ins:45,insert:45,"\u2326":46,del:46,delete:46,"\u2190":37,left:37,"arrow-left":37,"\u2191":38,up:38,"arrow-up":38,"\u2192":39,right:39,"arrow-right":39,"\u2193":40,down:40,"arrow-down":40,ffequals:61,"*":106,star:106,asterisk:106,multiply:106,"+":107,plus:107,"-":109,subtract:109,"|":124,ffplus:171,ffminus:173,";":186,semicolon:186,"=":187,equals:187,",":188,comma:188,dash:189,".":190,period:190,"full-stop":190,"/":191,slash:191,"forward-slash":191,"`":192,tick:192,"back-quote":192,"[":219,"open-bracket":219,"\\":220,"back-slash":220,"]":221,"close-bracket":221,"'":222,quote:222,apostrophe:222};var Al=95,uh=0;for(;++Al<106;)$i.keyCodes["num-"+uh]=Al,++uh;Al=47;uh=0;for(;++Al<58;)$i.keyCodes[uh]=Al,++uh;Al=111;uh=1;for(;++Al<136;)$i.keyCodes["f"+uh]=Al,++uh;Al=64;for(;++Al<91;)$i.keyCodes[String.fromCharCode(Al).toLowerCase()]=Al;function $t(t,e){for(var i=1,r=arguments.length,s;++i<r;)t[s=arguments[i]]=hW(t,e,e[s]);return t}function hW(t,e,i){return function(){var r=i.apply(e,arguments);return r===e?t:r}}function N2(t,e){t.each(function(){var i=document.createEvent("HTMLEvents");i.initEvent(e,!0,!0),this.dispatchEvent(i)})}function Mr(){if(this instanceof Mr)arguments.length&&this.initialize(arguments);else return new Mr().initialize(arguments)}Dt.way=Mr;Mr.prototype=Object.create(Dt.prototype);Object.assign(Mr.prototype,{type:"way",nodes:[],copy:function(t,e){if(e[this.id])return e[this.id];var i=Dt.prototype.copy.call(this,t,e),r=this.nodes.map(function(s){return t.entity(s).copy(t,e).id});return i=i.update({nodes:r}),e[this.id]=i,i},extent:function(t){return t.transient(this,"extent",function(){return kr(this.nodes,t)})},first:function(){return this.nodes[0]},last:function(){return this.nodes[this.nodes.length-1]},contains:function(t){return this.nodes.indexOf(t)>=0},affix:function(t){if(this.nodes[0]===t)return"prefix";if(this.nodes[this.nodes.length-1]===t)return"suffix"},layer:function(){return isFinite(this.tags.layer)?Math.max(-10,Math.min(+this.tags.layer,10)):this.tags.covered==="yes"?-1:this.tags.location==="overground"?1:this.tags.location==="underground"?-1:this.tags.location==="underwater"?-10:this.tags.power==="line"||this.tags.power==="minor_line"||this.tags.aerialway?10:this.tags.bridge?1:this.tags.cutting||this.tags.tunnel||this.tags.waterway?-1:this.tags.man_made==="pipeline"||this.tags.boundary?-10:0},impliedLineWidthMeters:function(){var t={highway:{motorway:5,motorway_link:5,trunk:4.5,trunk_link:4.5,primary:4,secondary:4,tertiary:4,primary_link:4,secondary_link:4,tertiary_link:4,unclassified:4,road:4,living_street:4,bus_guideway:4,pedestrian:4,residential:3.5,service:3.5,track:3,cycleway:2.5,bridleway:2,corridor:2,steps:2,path:1.5,footway:1.5},railway:{rail:2.5,light_rail:2.5,tram:2.5,subway:2.5,monorail:2.5,funicular:2.5,disused:2.5,preserved:2.5,miniature:1.5,narrow_gauge:1.5},waterway:{river:50,canal:25,stream:5,tidal_channel:5,fish_pass:2.5,drain:2.5,ditch:1.5}};for(var e in t)if(this.tags[e]&&t[e][this.tags[e]]){var i=t[e][this.tags[e]];if(e==="highway"){var r=this.tags.lanes&&parseInt(this.tags.lanes,10);return r||(r=this.isOneWay()?1:2),i*r}return i}return null},isOneWay:function(){var t={yes:!0,1:!0,"-1":!0,reversible:!0,alternating:!0,no:!1,0:!1};if(t[this.tags.oneway]!==void 0)return t[this.tags.oneway];for(var e in this.tags)if(e in O1&&this.tags[e]in O1[e])return!0;return!1},sidednessIdentifier:function(){for(let t in this.tags){let e=this.tags[t],i=g3(t);if(i in y3&&e in y3[i])return y3[i][e]===!0?i:y3[i][e]}return null},isSided:function(){return this.tags.two_sided==="yes"?!1:this.sidednessIdentifier()!==null},lanes:function(){return N8(this)},isClosed:function(){return this.nodes.length>1&&this.first()===this.last()},isConvex:function(t){if(!this.isClosed()||this.isDegenerate())return null;for(var e=Ei(t.childNodes(this)),i=e.map(function(d){return d.loc}),r=0,s=0,n=0;n<i.length;n++){var o=i[(n+1)%i.length],a=i[n],l=i[(n+2)%i.length],c=Q3(a,l,o);if(r=c>0?1:c<0?-1:0,r!==0){if(s&&r!==s)return!1;s=r}}return!0},tagSuggestingArea:function(){return L1(this.tags)},isArea:function(){return this.tags.area==="yes"?!0:!this.isClosed()||this.tags.area==="no"?!1:this.tagSuggestingArea()!==null},isDegenerate:function(){return new Set(this.nodes).size<(this.isArea()?3:2)},areAdjacent:function(t,e){for(var i=0;i<this.nodes.length;i++)if(this.nodes[i]===t&&(this.nodes[i-1]===e||this.nodes[i+1]===e))return!0;return!1},geometry:function(t){return t.transient(this,"geometry",function(){return this.isArea()?"area":"line"})},segments:function(t){function e(i){var r=i.hasEntity(this.nodes[0]),s=i.hasEntity(this.nodes[1]);return r&&s&&new mt([Math.min(r.loc[0],s.loc[0]),Math.min(r.loc[1],s.loc[1])],[Math.max(r.loc[0],s.loc[0]),Math.max(r.loc[1],s.loc[1])])}return t.transient(this,"segments",function(){for(var i=[],r=0;r<this.nodes.length-1;r++)i.push({id:this.id+"-"+r,wayId:this.id,index:r,nodes:[this.nodes[r],this.nodes[r+1]],extent:e});return i})},close:function(){if(this.isClosed()||!this.nodes.length)return this;var t=this.nodes.slice();return t=t.filter(O2),t.push(t[0]),this.update({nodes:t})},unclose:function(){if(!this.isClosed())return this;for(var t=this.nodes.slice(),e=this.first(),i=t.length-1;i>0&&t.length>1&&t[i]===e;)t.splice(i,1),i=t.length-1;return t=t.filter(O2),this.update({nodes:t})},addNode:function(t,e){var i=this.nodes.slice(),r=this.isClosed(),s=r?i.length-1:i.length;if(e===void 0&&(e=s),e<0||e>s)throw new RangeError("index "+e+" out of range 0.."+s);if(r){for(var n=this.first(),o=1;o<i.length&&i.length>2&&i[o]===n;)i.splice(o,1),e>o&&e--;for(o=i.length-1;o>0&&i.length>1&&i[o]===n;)i.splice(o,1),e>o&&e--,o=i.length-1}return i.splice(e,0,t),i=i.filter(O2),r&&(i.length===1||i[0]!==i[i.length-1])&&i.push(i[0]),this.update({nodes:i})},updateNode:function(t,e){var i=this.nodes.slice(),r=this.isClosed(),s=i.length-1;if(e===void 0||e<0||e>s)throw new RangeError("index "+e+" out of range 0.."+s);if(r){for(var n=this.first(),o=1;o<i.length&&i.length>2&&i[o]===n;)i.splice(o,1),e>o&&e--;for(o=i.length-1;o>0&&i.length>1&&i[o]===n;)i.splice(o,1),e===o&&(e=0),o=i.length-1}return i.splice(e,1,t),i=i.filter(O2),r&&(i.length===1||i[0]!==i[i.length-1])&&i.push(i[0]),this.update({nodes:i})},replaceNode:function(t,e){for(var i=this.nodes.slice(),r=this.isClosed(),s=0;s<i.length;s++)i[s]===t&&(i[s]=e);return i=i.filter(O2),r&&(i.length===1||i[0]!==i[i.length-1])&&i.push(i[0]),this.update({nodes:i})},removeNode:function(t){var e=this.nodes.slice(),i=this.isClosed();return e=e.filter(function(r){return r!==t}).filter(O2),i&&(e.length===1||e[0]!==e[e.length-1])&&e.push(e[0]),this.update({nodes:e})},asJXON:function(t){var e={way:{"@id":this.osmId(),"@version":this.version||0,nd:this.nodes.map(function(i){return{keyAttributes:{ref:Dt.id.toOSM(i)}}},this),tag:Object.keys(this.tags).map(function(i){return{keyAttributes:{k:i,v:this.tags[i]}}},this)}};return t&&(e.way["@changeset"]=t),e},asGeoJSON:function(t){return t.transient(this,"GeoJSON",function(){var e=t.childNodes(this).map(function(i){return i.loc});return this.isArea()&&this.isClosed()?{type:"Polygon",coordinates:[e]}:{type:"LineString",coordinates:e}})},area:function(t){return t.transient(this,"area",function(){var e=t.childNodes(this),i={type:"Polygon",coordinates:[e.map(function(s){return s.loc})]};!this.isClosed()&&e.length&&i.coordinates[0].push(e[0].loc);var r=Mc(i);return r>2*Math.PI&&(i.coordinates[0]=i.coordinates[0].reverse(),r=Mc(i)),isNaN(r)?0:r})}});function O2(t,e,i){return e===0||t!==i[e-1]}function B2(t,e){if(t.type!=="relation"||!t.isMultipolygon()||Object.keys(t.tags).filter(No).length>1)return!1;var i;for(var r in t.members){var s=t.members[r];if((!s.role||s.role==="outer")&&(i||s.type!=="way"||!e.hasEntity(s.id)||(i=e.entity(s.id),Object.keys(i.tags).filter(No).length===0)))return!1}return i}function U2(t,e){if(t.type!=="way"||Object.keys(t.tags).filter(No).length===0)return!1;var i=e.parentRelations(t);if(i.length!==1)return!1;var r=i[0];if(!r.isMultipolygon()||Object.keys(r.tags).filter(No).length>1)return!1;for(var s=r.members,n,o=0;o<s.length;o++)if(n=s[o],n.id===t.id&&n.role&&n.role!=="outer"||n.id!==t.id&&(!n.role||n.role==="outer"))return!1;return r}function XD(t,e){if(t.type!=="way")return!1;var i=e.parentRelations(t);if(i.length!==1)return!1;var r=i[0];if(!r.isMultipolygon()||Object.keys(r.tags).filter(No).length>1)return!1;for(var s=r.members,n,o,a=0;a<s.length;a++)if(n=s[a],!n.role||n.role==="outer"){if(o)return!1;o=n}if(!o)return!1;var l=e.hasEntity(o.id);return!l||!Object.keys(l.tags).filter(No).length?!1:l}function wa(t,e){function i(v){return e.childNodes(e.entity(v.id))}function r(v){var E=pl(v.id,{reverseOneway:!0});return o.actions.push(E),v instanceof Mr?E(e).entity(v.id):v}t=t.filter(function(v){return v.type==="way"&&e.hasEntity(v.id)});var s,n=!0;for(s=0;s<t.length;s++)if(t[s]instanceof Mr){n=!1;break}var o=[];for(o.actions=[];t.length;){for(var a=t.shift(),l=[a],c=i(a).slice();t.length;){var d=c[0],m=c[c.length-1],g=null,_=null;for(s=0;s<t.length;s++)if(a=t[s],_=i(a),n&&l.length===1&&_[0]!==m&&_[_.length-1]!==m&&(_[_.length-1]===d||_[0]===d)&&(l[0]=r(l[0]),c.reverse(),d=c[0],m=c[c.length-1]),_[0]===m){g=c.push,_=_.slice(1);break}else if(_[_.length-1]===m){g=c.push,_=_.slice(0,-1).reverse(),a=r(a);break}else if(_[_.length-1]===d){g=c.unshift,_=_.slice(0,-1);break}else if(_[0]===d){g=c.unshift,_=_.slice(1).reverse(),a=r(a);break}else g=_=null;if(!_)break;g.apply(l,[a]),g.apply(c,_),t.splice(s,1)}l.nodes=c,o.push(l)}return o}function Nd(t,e,i,r){return function(o){var a=o.entity(t),l=/stop|platform/.test(e.role);return(isNaN(i)||r)&&e.type==="way"&&!l?o=s(a,o):(l&&isNaN(i)&&(i=0),o=o.replace(a.addMember(e,i))),o};function s(n,o){var a,l,c,d,m,g,_=[],v=[];for(d=0;d<n.members.length;d++){var E=n.members[d];/stop|platform/.test(E.role)?_.push(E):v.push(E)}if(n=n.update({members:v}),r){l=Mr({id:"wTemp",nodes:r.nodes}),o=o.replace(l);var b={id:l.id,type:"way",role:e.role},T=n.replaceMember({id:r.originalID},b,!0);a=ds(T.members,"type"),a.way=a.way||[]}else a=ds(n.members,"type"),a.way=a.way||[],a.way.push(e);v=Z(a.way);var A=wa(v,o);for(d=0;d<A.length;d++){var M=A[d],k=M.nodes.slice(),F=M[0].index;for(m=0;m<v.length&&v[m].index!==F;m++);for(g=0;g<M.length;g++){c=M[g];var O=o.entity(c.id);l&&c.id===l.id&&(k[0].id===r.nodes[0]?c.pair=[{id:r.originalID,type:"way",role:c.role},{id:r.insertedID,type:"way",role:c.role}]:c.pair=[{id:r.insertedID,type:"way",role:c.role},{id:r.originalID,type:"way",role:c.role}]),g>0&&(m+g>=v.length||c.index!==v[m+g].index)&&z(v,c.index,m+g),k.splice(0,O.nodes.length-1)}}l&&(o=o.remove(l));var B=[];for(d=0;d<v.length;d++)c=v[d],c.index!==-1&&(c.pair?(B.push(c.pair[0]),B.push(c.pair[1])):B.push(dn(c,["index"])));var U=_.concat(a.node||[],B,a.relation||[]);return o.replace(n.update({members:U}));function z(W,q,Q){var V;for(V=0;V<W.length&&W[V].index!==q;V++);var le=Object.assign({},W[V]);W[V].index=-1,le.index=Q,W.splice(Q,0,le)}function Z(W){for(var q=new Array(W.length),Q=0;Q<W.length;Q++)q[Q]=Object.assign({},W[Q]),q[Q].index=Q;return q}}}function nn(t,e){return function(i){i=i.replace(e.move(t.loc));var r=eo(i.parentWays(i.entity(t.edge[0])),i.parentWays(i.entity(t.edge[1])));return r.forEach(function(s){for(var n=0;n<s.nodes.length-1;n++)if(fP([s.nodes[n],s.nodes[n+1]],t.edge)){i=i.replace(i.entity(s.id).addNode(e.id,n+1));return}}),i}}function To(t,e,i){return function(r){return r.replace(r.entity(t).addNode(e,i))}}function hh(t,e,i){return function(r){return r.replace(r.entity(t).updateMember(e,i))}}function qa(t,e,i,r){return function(n){let o=n.entity(t),a=o.geometry(n),l=o.tags;return e&&(l=e.unsetTags(l,a,i&&i.addTags?Object.keys(i.addTags):null)),i&&(l=i.setTags(l,a,r)),n.replace(o.update({tags:l}))}}function Xr(t,e){return function(i){let r=i.entity(t);return i.replace(r.update({tags:e}))}}function vi(){if(this instanceof vi)arguments.length&&this.initialize(arguments);else return new vi().initialize(arguments)}Dt.node=vi;vi.prototype=Object.create(Dt.prototype);Object.assign(vi.prototype,{type:"node",loc:[9999,9999],extent:function(){return new mt(this.loc)},geometry:function(t){return t.transient(this,"geometry",function(){return t.isPoi(this)?"point":"vertex"})},move:function(t){return this.update({loc:t})},isDegenerate:function(){return!(Array.isArray(this.loc)&&this.loc.length===2&&this.loc[0]>=-180&&this.loc[0]<=180&&this.loc[1]>=-90&&this.loc[1]<=90)},directions:function(t,e){var i,r;if(this.isHighwayIntersection(t)&&(this.tags.stop||"").toLowerCase()==="all")i="all";else{i=(this.tags.direction||"").toLowerCase();var s=/:direction$/i,n=Object.keys(this.tags);for(r=0;r<n.length;r++)if(s.test(n[r])){i=this.tags[n[r]].toLowerCase();break}}if(i==="")return[];var o={north:0,n:0,northnortheast:22,nne:22,northeast:45,ne:45,eastnortheast:67,ene:67,east:90,e:90,eastsoutheast:112,ese:112,southeast:135,se:135,southsoutheast:157,sse:157,south:180,s:180,southsouthwest:202,ssw:202,southwest:225,sw:225,westsouthwest:247,wsw:247,west:270,w:270,westnorthwest:292,wnw:292,northwest:315,nw:315,northnorthwest:337,nnw:337},a=i.split(";"),l=[];return a.forEach(function(c){if(o[c]!==void 0&&(c=o[c]),c!==""&&!isNaN(+c)){l.push(+c);return}var d=this.tags["traffic_sign:backward"]||c==="backward"||c==="both"||c==="all",m=this.tags["traffic_sign:forward"]||c==="forward"||c==="both"||c==="all";if(!(!m&&!d)){var g={};t.parentWays(this).forEach(function(_){var v=_.nodes;for(r=0;r<v.length;r++)v[r]===this.id&&(m&&r>0&&(g[v[r-1]]=!0),d&&r<v.length-1&&(g[v[r+1]]=!0))},this),Object.keys(g).forEach(function(_){var v=e.project(this.loc),E=e.project(t.entity(_).loc);l.push(fs(v,E)*180/Math.PI+90)},this)}},this),Ei(l)},isCrossing:function(){return this.tags.highway==="crossing"||this.tags.railway&&this.tags.railway.indexOf("crossing")!==-1},isEndpoint:function(t){return t.transient(this,"isEndpoint",function(){var e=this.id;return t.parentWays(this).filter(function(i){return!i.isClosed()&&!!i.affix(e)}).length>0})},isConnected:function(t){return t.transient(this,"isConnected",function(){var e=t.parentWays(this);if(e.length>1){for(var i in e)if(e[i].geometry(t)==="line"&&e[i].hasInterestingTags())return!0}else if(e.length===1){var r=e[0],s=r.nodes.slice();return r.isClosed()&&s.pop(),s.indexOf(this.id)!==s.lastIndexOf(this.id)}return!1})},parentIntersectionWays:function(t){return t.transient(this,"parentIntersectionWays",function(){return t.parentWays(this).filter(function(e){return(e.tags.highway||e.tags.waterway||e.tags.railway||e.tags.aeroway)&&e.geometry(t)==="line"})})},isIntersection:function(t){return this.parentIntersectionWays(t).length>1},isHighwayIntersection:function(t){return t.transient(this,"isHighwayIntersection",function(){return t.parentWays(this).filter(function(e){return e.tags.highway&&e.geometry(t)==="line"}).length>1})},isOnAddressLine:function(t){return t.transient(this,"isOnAddressLine",function(){return t.parentWays(this).filter(function(e){return e.tags.hasOwnProperty("addr:interpolation")&&e.geometry(t)==="line"}).length>0})},asJXON:function(t){var e={node:{"@id":this.osmId(),"@lon":this.loc[0],"@lat":this.loc[1],"@version":this.version||0,tag:Object.keys(this.tags).map(function(i){return{keyAttributes:{k:i,v:this.tags[i]}}},this)}};return t&&(e.node["@changeset"]=t),e},asGeoJSON:function(){return{type:"Point",coordinates:this.loc}}});function Bg(t,e,i){i=(i||20)*Math.PI/180;var r=function(s,n){(n===null||!isFinite(n))&&(n=1),n=Math.min(Math.max(+n,0),1);var o=s.entity(t),a={};s.childNodes(o).forEach(function(Mi){a[Mi.id]||(a[Mi.id]=Mi)}),o.isConvex(s)||(s=r.makeConvex(s));var l=Ei(s.childNodes(o)),c=l.filter(function(Mi){return s.parentWays(Mi).length!==1}),d=l.map(function(Mi){return e.project(Mi.loc)}),m=c.map(function(Mi){return e.project(Mi.loc)}),g=d.length===2?yr(d[0],d[1],.5):ma(d),_=$9(d,function(Mi){return Xi(g,Mi)}),v=Af(d)>0?1:-1,E,b,T,A;if(c.length||(c=[l[0]],m=[d[0]]),c.length===1){var M=l.indexOf(c[0]),k=Math.floor((M+l.length/2)%l.length);c.push(l[k]),m.push(d[k])}for(b=0;b<m.length;b++){var F=(b+1)%c.length,O=c[b],B=c[F],U=l.indexOf(O),z=l.indexOf(B),Z=-1,W=z-U,q={},Q=[],V,le,de,ne,ee,re,te,ie;W<0&&(W+=l.length);var oe=Xi(g,m[b])||1e-4;m[b]=[g[0]+(m[b][0]-g[0])/oe*_,g[1]+(m[b][1]-g[1])/oe*_],re=e.invert(m[b]),te=c[b],ie=a[te.id],te=te.move(yr(ie.loc,re,n)),s=s.replace(te),V=Math.atan2(m[b][1]-g[1],m[b][0]-g[0]),le=Math.atan2(m[F][1]-g[1],m[F][0]-g[0]),de=le-V,de*v>0&&(de=-v*(2*Math.PI-Math.abs(de)));do Z++,ne=de/(W+Z);while(Math.abs(ne)>i);for(T=1;T<W;T++)ee=V+T*ne,re=e.invert([g[0]+Math.cos(ee)*_,g[1]+Math.sin(ee)*_]),te=l[(T+U)%l.length],ie=a[te.id],q[te.id]=ee,te=te.move(yr(ie.loc,re,n)),s=s.replace(te);for(T=0;T<Z;T++){ee=V+(W+T)*ne,re=e.invert([g[0]+Math.cos(ee)*_,g[1]+Math.sin(ee)*_]);var fe=1/0;for(var Re in q){var He=q[Re],Je=Math.abs(He-ee);Je<fe&&(fe=Je,ie=a[Re])}te=vi({loc:yr(ie.loc,re,n)}),s=s.replace(te),l.splice(z+T,0,te),Q.push(te.id)}if(W===1&&Q.length){var ot=o.nodes.lastIndexOf(O.id),yt=o.nodes.lastIndexOf(B.id),bt=yt-ot;bt<-1&&(bt=1);var at=s.parentWays(c[b]);for(T=0;T<at.length;T++){var Te=at[T];if(Te!==o&&Te.areAdjacent(O.id,B.id)){var Ze=Te.nodes.lastIndexOf(O.id),xt=Te.nodes.lastIndexOf(B.id),It=xt-Ze,Bt=xt;for(It<-1&&(It=1),bt!==It&&(Q.reverse(),Bt=Ze),A=0;A<Q.length;A++)Te=Te.addNode(Q[A],Bt+A);s=s.replace(Te)}}}}return E=l.map(function(Mi){return Mi.id}),E.push(E[0]),o=o.update({nodes:E}),s=s.replace(o),s};return r.makeConvex=function(s){var n=s.entity(t),o=Ei(s.childNodes(n)),a=o.map(function(T){return e.project(T.loc)}),l=Af(a)>0?1:-1,c=Ql(a),d,m;for(l===-1&&(o.reverse(),a.reverse()),d=0;d<c.length-1;d++){var g=a.indexOf(c[d]),_=a.indexOf(c[d+1]),v=_-g;for(v<0&&(v+=o.length),m=1;m<v;m++){var E=yr(c[d],c[d+1],m/v),b=o[(m+g)%o.length].move(e.invert(E));s=s.replace(b)}}return s},r.disabled=function(s){if(!s.entity(t).isClosed())return"not_closed";var n=s.entity(t),o=Ei(s.childNodes(n)),a=o.map(function(k){return e.project(k.loc)}),l=Ql(a),c=Math.PI/180;if(l.length!==a.length||l.length<3)return!1;var d=ma(a),m=uw(d,a[0]),g,_;for(g=0;g<l.length;g++){_=l[g];var v=uw(_,d),E=Math.abs(v-m);if(E>.05*m)return!1}for(g=0;g<l.length;g++){_=l[g];var b=l[(g+1)%l.length],T=Math.atan2(_[1]-d[1],_[0]-d[0]),A=Math.atan2(b[1]-d[1],b[0]-d[0]),M=A-T;if(M<0&&(M=-M),M>Math.PI&&(M=2*Math.PI-M),M>i+c)return!1}return"already_circular"},r.transitionable=!0,r}function Cl(t){function e(r,s){if(s.parentWays(r).length||s.parentRelations(r).length)return!1;var n=N1(r.tags);return n.point?!1:n.vertex?!0:!r.hasInterestingTags()}var i=function(r){var s=r.entity(t);return r.parentRelations(s).forEach(function(n){n=n.removeMembersWithID(t),r=r.replace(n),n.isDegenerate()&&(r=gn(n.id)(r))}),new Set(s.nodes).forEach(function(n){r=r.replace(s.removeNode(n));var o=r.entity(n);e(o,r)&&(r=r.remove(o))}),r.remove(s)};return i}function Zu(t){var e={way:Cl,node:Vc,relation:gn},i=function(r){return t.forEach(function(s){r.hasEntity(s)&&(r=e[r.entity(s).type](s)(r))}),r};return i}function gn(t,e){function i(s,n){return!n.parentWays(s).length&&!n.parentRelations(s).length&&!s.hasInterestingTags()&&!e}var r=function(s){var n=s.entity(t);s.parentRelations(n).forEach(function(a){a=a.removeMembersWithID(t),s=s.replace(a),a.isDegenerate()&&(s=gn(a.id)(s))});var o=Ei(n.members.map(function(a){return a.id}));return o.forEach(function(a){s=s.replace(n.removeMembersWithID(a));var l=s.entity(a);i(l,s)&&(s=Zu([a])(s))}),s.remove(n)};return r}function Vc(t){var e=function(i){var r=i.entity(t);return i.parentWays(r).forEach(function(s){s=s.removeNode(t),i=i.replace(s),s.isDegenerate()&&(i=Cl(s.id)(i))}),i.parentRelations(r).forEach(function(s){s=s.removeMembersWithID(t),i=i.replace(s),s.isDegenerate()&&(i=gn(s.id)(i))}),i.remove(r)};return e}function Od(t){var e=function(i){var r,s,n,o,a;for(o=0;o<t.length&&(r=i.entity(t[o]),!r.version);o++);for(o=0;o<t.length;o++)if(s=i.entity(t[o]),s.id!==r.id){for(n=i.parentWays(s),a=0;a<n.length;a++)i=i.replace(n[a].replaceNode(s.id,r.id));for(n=i.parentRelations(s),a=0;a<n.length;a++)i=i.replace(n[a].replaceMember(s,r));r=r.mergeTags(s.tags),i=Vc(s.id)(i)}for(i=i.replace(r),n=i.parentWays(r),o=0;o<n.length;o++)n[o].isDegenerate()&&(i=Cl(n[o].id)(i));return i};return e.disabled=function(i){var r={},s=[],n,o,a,l,c,d,m,g,_;for(m=0;m<t.length&&(n=i.entity(t[m]),!n.version);m++);for(m=0;m<t.length;m++)for(o=i.entity(t[m]),l=i.parentRelations(o),g=0;g<l.length;g++){if(c=l[g],d=c.memberById(o.id).role||"",c.hasFromViaTo()&&s.push(c.id),r[c.id]!==void 0&&r[c.id]!==d)return"relation";r[c.id]=d}for(m=0;m<t.length;m++){o=i.entity(t[m]);var v=i.parentWays(o);for(g=0;g<v.length;g++){var E=v[g];for(l=i.parentRelations(E),_=0;_<l.length;_++)c=l[_],c.hasFromViaTo()&&s.push(c.id)}}for(s=Ei(s),m=0;m<s.length;m++)if(c=i.entity(s[m]),!!c.isComplete(i)){var b=c.members.filter(function(ee){return ee.type==="way"}).map(function(ee){return i.entity(ee.id)});b=Ei(b);var T=c.memberByRole("from"),A=c.memberByRole("to"),M=T.id===A.id,k={from:[],via:[],to:[],keyfrom:[],keyto:[]};for(g=0;g<c.members.length;g++)ne(c.members[g],k);k.keyfrom=Ei(k.keyfrom.filter(le)),k.keyto=Ei(k.keyto.filter(le));var F=de(k.keyfrom,k.keyto);k.from=k.from.filter(F),k.via=k.via.filter(F),k.to=k.to.filter(F);var O=!1,B=!1,U=!1,z=!1,Z=!1;for(g=0;g<t.length;g++){var W=t[g];k.from.indexOf(W)!==-1&&(O=!0),k.via.indexOf(W)!==-1&&(B=!0),k.to.indexOf(W)!==-1&&(U=!0),k.keyfrom.indexOf(W)!==-1&&(z=!0),k.keyto.indexOf(W)!==-1&&(Z=!0)}if(O&&U&&!M||O&&B||U&&B)return"restriction";if(z||Z){if(t.length!==2)return"restriction";var q=null,Q=null;for(g=0;g<b.length;g++)a=b[g],a.contains(t[0])&&(q=t[0]),a.contains(t[1])&&(Q=t[1]);if(q&&Q){var V=!1;for(g=0;g<b.length;g++)if(a=b[g],a.areAdjacent(q,Q)){V=!0;break}if(!V)return"restriction"}}for(g=0;g<b.length;g++){for(a=b[g].update({}),_=0;_<t.length;_++)t[_]!==n.id&&(a.areAdjacent(t[_],n.id)?a=a.removeNode(t[_]):a=a.replaceNode(t[_],n.id));if(a.isDegenerate())return"restriction"}}return!1;function le(ee,re,te){return te.indexOf(ee)!==te.lastIndexOf(ee)}function de(ee,re){return function(te){return ee.indexOf(te)===-1&&re.indexOf(te)===-1}}function ne(ee,re){var te=i.hasEntity(ee.id);if(te){var ie=ee.role||"";re[ie]||(re[ie]=[]),ee.type==="node"?(re[ie].push(ee.id),ie==="via"&&(re.keyfrom.push(ee.id),re.keyto.push(ee.id))):ee.type==="way"&&(re[ie].push.apply(re[ie],te.nodes),(ie==="from"||ie==="via")&&(re.keyfrom.push(te.first()),re.keyfrom.push(te.last())),(ie==="to"||ie==="via")&&(re.keyto.push(te.first()),re.keyto.push(te.last())))}}},e}function z2(t,e){var i={},r=function(s){t.forEach(function(o){e.entity(o).copy(e,i)});for(var n in i)s=s.replace(i[n]);return s};return r.copies=function(){return i},r}function dh(t,e){return function(i){var r=i.entity(t).removeMember(e);return i=i.replace(r),r.isDegenerate()&&(i=gn(r.id)(i)),i}}function Qu(t,e){return e=e||{},i=>{return t.modified().forEach(r),t.created().forEach(r),i;function r(s){let n=Object.keys(s.tags),o=!1,a={};for(let l=0;l<n.length;l++){let c=n[l];e[c]||!s.tags[c]?o=!0:a[c]=s.tags[c]}o&&(i=i.replace(s.update({tags:a})))}}}function hm(t,e){var i,r=function(s){var n=s.entity(t),o=r.connections(s);return o.forEach(function(a){var l=s.entity(a.wayID),c=vi({id:e,loc:n.loc,tags:n.tags});s=s.replace(c),a.index===0&&l.isArea()?s=s.replace(l.replaceNode(l.nodes[0],c.id)):l.isClosed()&&a.index===l.nodes.length-1?s=s.replace(l.unclose().addNode(c.id)):s=s.replace(l.updateNode(c.id,a.index))}),s};return r.connections=function(s){for(var n=[],o=!1,a=s.parentWays(s.entity(t)),l,c,d=0;d<a.length;d++){if(l=a[d],i&&i.indexOf(l.id)===-1){o=!0;continue}if(l.isArea()&&l.nodes[0]===t)n.push({wayID:l.id,index:0});else for(var m=0;m<l.nodes.length;m++)if(c=l.nodes[m],c===t){if(l.isClosed()&&a.length>1&&i&&i.indexOf(l.id)!==-1&&m===l.nodes.length-1)continue;n.push({wayID:l.id,index:m})}}if(o)return n;if(t[1]!=="-"&&n.length>1&&n[0].wayID[1]==="-"){for(var g=1;g<n.length;g++)if(n[g].wayID[1]!=="-")return n.splice(g,1),n}return n.slice(1)},r.disabled=function(s){var n=r.connections(s);if(n.length===0)return"not_connected";var o=s.parentWays(s.entity(t)),a={},l;if(o.forEach(function(c){var d=s.parentRelations(c);d.forEach(function(m){m.id in a?i?(i.indexOf(c.id)!==-1||i.indexOf(a[m.id])!==-1)&&(l=m):l=m:a[m.id]=c.id})}),l)return"relation"},r.limitWays=function(s){return arguments.length?(i=s,r):i},r}function G2(t,e){let i,r=function(o){let a=o.entity(t);return a.type==="node"?s(a,o):n(a,o)};function s(o,a){i=o.id;let l=vi({loc:o.loc});a=a.replace(l);for(let c of a.parentWays(o))a=a.replace(c.replaceNode(t,l.id));for(let c of a.parentRelations(o))a=a.replace(c.replaceMember(o,l));return a}function n(o,a){let l=o.geometry(a),c=["source","wheelchair"],d=["area"],m=/architect|building|height|layer|nycdoitt:bin|roof/i,g=o.asGeoJSON(a),v=(g.type==="LineString"?g.coordinates:g.type==="Polygon"?g.coordinates[0]:g.type==="MultiPolygon"?g.coordinates[0][0]:[]).map(B=>e.project(B)),E;if(v.length)v.length===1?E=v[0]:v.length===2?E=yr(v[0],v[1],.5):E=ma(v);else return a;let b=e.invert(E);(!b||!isFinite(b[0])||!isFinite(b[1]))&&(b=o.extent(a).center());let T={area:!0,corridor:!0,elevator:!0,level:!0,room:!0},A=o.tags.building&&o.tags.building!=="no"||o.tags["building:part"]&&o.tags["building:part"]!=="no",M=l==="area"&&o.tags.indoor&&T[o.tags.indoor],k=Object.assign({},o.tags),F={};for(let B in k)o.type==="relation"&&B==="type"||d.indexOf(B)===-1&&(M&&B==="indoor"||A&&m.test(B)||(F[B]=k[B],!(c.indexOf(B)!==-1||B.match(/^addr:.{1,}/))&&(M&&B==="level"||delete k[B])));!A&&!M&&l==="area"&&(k.area="yes");let O=vi({loc:b,tags:F});return a=a.replace(O),i=O.id,a.replace(o.update({tags:k}))}return r.getExtractedNodeID=function(){return i},r}function Ug(t,e={}){function i(s){var n=t.map(function(o){return s.entity(o)});return Object.assign({line:[]},ds(n,function(o){return o.geometry(s)}))}var r=function(s){var n=t.map(s.entity,s);n.sort(function(g,_){var v=g.isSided(),E=_.isSided();return v&&!E?-1:E&&!v?1:0});let o=(n.filter(g=>!g.isNew()).sort((g,_)=>+g.osmId()-+_.osmId())[0]||n[0]).id;var a=wa(n,s),l=a[0];s=a.actions.reduce(function(g,_){return _(g)},s);var c=s.entity(o);if(c=c.update({nodes:l.nodes.map(function(g){return g.id})}),s=s.replace(c),l.forEach(function(g){g.id!==o&&(s.parentRelations(g).forEach(function(_){s=s.replace(_.replaceMember(g,c))}),c=c.mergeTags(g.tags),s=s.replace(c),s=Cl(g.id)(s))}),e.tagnosticRoadCombine&&n.length&&n[0].tags.highway){var d=Object.assign({},c.tags);d.highway=n[0].tags.highway,c=c.update({tags:d}),s=s.replace(c)}function m(){if(c.isClosed()){var g=s.parentMultipolygons(c).filter(function(b){return b.members.length===1});if(g.length===1){var _=g[0];for(var v in c.tags)if(_.tags[v]&&_.tags[v]!==c.tags[v])return;c=c.mergeTags(_.tags),s=s.replace(c),s=gn(_.id,!0)(s);var E=Object.assign({},c.tags);c.geometry(s)!=="area"&&(E.area="yes"),delete E.type,c=c.update({tags:E}),s=s.replace(c)}}}return m(),s};return r.resultingWayNodesLength=function(s){return t.reduce(function(n,o){return n+s.entity(o).nodes.length},0)-t.length-1},r.disabled=function(s){var n=i(s);if(t.length<2||t.length!==n.line.length)return"not_eligible";var o=wa(t.map(s.entity,s),s);if(o.length>1)return"not_adjacent";var a,l=function(k){return s.parentRelations(s.entity(k)).filter(F=>!F.isRestriction()&&!F.isConnectivity()).sort((F,O)=>F.id-O.id)},c=l(t[0]);for(a=1;a<t.length;a++){var d=l(t[a]);if(!jn(c,d))return"conflicting_relations"}for(a=0;a<t.length-1;a++)for(var m=a+1;m<t.length;m++){var g=s.childNodes(s.entity(t[a])).map(function(k){return k.loc}),_=s.childNodes(s.entity(t[m])).map(function(k){return k.loc}),v=D8(g,_),E=eo(o[0].nodes.map(function(k){return k.loc.toString()}),v.map(function(k){return k.toString()}));if(E.length!==v.length)return"paths_intersect"}var b=o[0].nodes.map(function(k){return k.id}).slice(1,-1),T,A={},M=!1;if(o[0].forEach(function(k){var F=s.parentRelations(k);F.forEach(function(B){(B.isRestriction()||B.isConnectivity())&&B.members.some(function(U){return b.indexOf(U.id)>=0})&&(T=B)});for(var O in k.tags)O in A?A[O]&&No(O)&&A[O]!==k.tags[O]&&(M=!0,O==="highway"&&e.tagnosticRoadCombine&&!window.mocha&&(M=!1)):A[O]=k.tags[O]}),T)return T.isRestriction()?"restriction":"connectivity";if(M)return"conflicting_tags"},r}function zg(t){function e(r){var s=t.map(function(n){return r.entity(n)});return Object.assign({point:[],area:[],line:[],relation:[]},ds(s,function(n){return n.geometry(r)}))}var i=function(r){var s=e(r),n=s.area[0]||s.line[0],o=s.point;if(o.forEach(function(l){n=n.mergeTags(l.tags),r=r.replace(n),r.parentRelations(l).forEach(function(_){r=r.replace(_.replaceMember(l,n))});for(var c=Ei(r.childNodes(n)),d=l,m=0;m<c.length;m++){var g=c[m];if(!(r.parentWays(g).length>1||r.parentRelations(g).length||g.hasInterestingTags())){r=r.replace(l.update({tags:{},loc:g.loc})),n=n.replaceNode(g.id,l.id),r=r.replace(n),d=g;break}}r=r.remove(d)}),n.tags.area==="yes"){var a=Object.assign({},n.tags);delete a.area,L1(a)&&(n=n.update({tags:a}),r=r.replace(n))}return r};return i.disabled=function(r){var s=e(r);if(s.point.length===0||s.area.length+s.line.length!==1||s.relation.length!==0)return"not_eligible"},i}function Ya(t,e){function i(s){if(!t.length)return null;for(var n=[0,0],o=0,a,l=0;l<t.length;l++){var c=s.entity(t[l]);c.hasInterestingTags()&&(a=++o===1?c.loc:null),n=Ir(n,c.loc)}return a||$o(n,1/t.length)}var r=function(s){if(t.length<2)return s;var n=e;n||(n=i(s));for(var o=0;o<t.length;o++){var a=s.entity(t[o]);a.loc!==n&&(s=s.replace(a.move(n)))}return Od(t)(s)};return r.disabled=function(s){if(t.length<2)return"not_eligible";for(var n=0;n<t.length;n++){var o=s.entity(t[n]);if(o.type!=="node")return"not_eligible"}return Od(t).disabled(s)},r}function ia(){if(this instanceof ia)arguments.length&&this.initialize(arguments);else return new ia().initialize(arguments)}Dt.changeset=ia;ia.prototype=Object.create(Dt.prototype);Object.assign(ia.prototype,{type:"changeset",extent:function(){return new new mt()},geometry:function(){return"changeset"},asJXON:function(){return{osm:{changeset:{tag:Object.keys(this.tags).map(function(t){return{"@k":t,"@v":this.tags[t]}},this),"@version":.6,"@generator":"Rapid"}}}},osmChangeJXON:function(t){var e=this.id;function i(n,o){for(var a={},l=0;l<n.length;l++){var c=Object.keys(n[l])[0];a[c]||(a[c]=[]),a[c].push(n[l][c])}var d={};return o.forEach(function(m){a[m]&&(d[m]=a[m])}),d}function r(n){function o(E){return d.find(function(b){return E.keyAttributes.type==="relation"&&E.keyAttributes.ref===b["@id"]})}function a(E){return!c[E["@id"]]&&!l.find(function(b){return b["@id"]===E["@id"]})}var l=[],c={},d=n.relation;if(!d)return n;for(var m=0;m<d.length;m++){var g=d[m];for(c[g["@id"]]||l.push(g);l.length>0;){var _=l[0],v=_.member.map(o).filter(Boolean).filter(a);v.length===0?(c[_["@id"]]=_,l.shift()):l=v.concat(l)}}return n.relation=Object.values(c),n}function s(n){return n.asJXON(e)}return{osmChange:{"@version":.6,"@generator":"Rapid",create:r(i(t.created.map(s),["node","way","relation"])),modify:i(t.modified.map(s),["node","way","relation"]),delete:Object.assign(i(t.deleted.map(s),["relation","way","node"]),{"@if-unused":!0})}}},asGeoJSON:function(){return{}}});function Nr(){if(this instanceof Nr)arguments.length&&this.initialize(arguments);else return new Nr().initialize(arguments)}Nr.id=function(){return Nr.id.next--};Nr.id.next=-1;Object.assign(Nr.prototype,{type:"note",initialize:function(t){for(var e=0;e<t.length;++e){var i=t[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(i[r]===void 0?delete this[r]:this[r]=i[r])}return this.id||(this.id=Nr.id().toString()),this},extent:function(){return new mt(this.loc)},update:function(t){return Nr(this,t)},isNew:function(){return this.id<0},move:function(t){return this.update({loc:t})}});function Ms(){if(this instanceof Ms)arguments.length&&this.initialize(arguments);else return new Ms().initialize(arguments)}Dt.relation=Ms;Ms.prototype=Object.create(Dt.prototype);Ms.creationOrder=function(t,e){var i=parseInt(Dt.id.toOSM(t.id),10),r=parseInt(Dt.id.toOSM(e.id),10);return i<0||r<0?i-r:r-i};Object.assign(Ms.prototype,{type:"relation",members:[],copy:function(t,e){if(e[this.id])return e[this.id];var i=Dt.prototype.copy.call(this,t,e),r=this.members.map(function(s){return Object.assign({},s,{id:t.entity(s.id).copy(t,e).id})});return i=i.update({members:r}),e[this.id]=i,i},extent:function(t,e){return t.transient(this,"extent",function(){if(e&&e[this.id])return new mt;e=e||{},e[this.id]=!0;for(var i=new mt,r=0;r<this.members.length;r++){var s=t.hasEntity(this.members[r].id);s&&(i=i.extend(s.extent(t,e)))}return i})},geometry:function(t){return t.transient(this,"geometry",function(){return this.isMultipolygon()?"area":"relation"})},isDegenerate:function(){return this.members.length===0},indexedMembers:function(){for(var t=new Array(this.members.length),e=0;e<this.members.length;e++)t[e]=Object.assign({},this.members[e],{index:e});return t},memberByRole:function(t){for(var e=0;e<this.members.length;e++)if(this.members[e].role===t)return Object.assign({},this.members[e],{index:e})},membersByRole:function(t){for(var e=[],i=0;i<this.members.length;i++)this.members[i].role===t&&e.push(Object.assign({},this.members[i],{index:i}));return e},memberById:function(t){for(var e=0;e<this.members.length;e++)if(this.members[e].id===t)return Object.assign({},this.members[e],{index:e})},memberByIdAndRole:function(t,e){for(var i=0;i<this.members.length;i++)if(this.members[i].id===t&&this.members[i].role===e)return Object.assign({},this.members[i],{index:i})},addMember:function(t,e){var i=this.members.slice();return i.splice(e===void 0?i.length:e,0,t),this.update({members:i})},updateMember:function(t,e){var i=this.members.slice();return i.splice(e,1,Object.assign({},i[e],t)),this.update({members:i})},removeMember:function(t){var e=this.members.slice();return e.splice(t,1),this.update({members:e})},removeMembersWithID:function(t){var e=this.members.filter(function(i){return i.id!==t});return this.update({members:e})},moveMember:function(t,e){var i=this.members.slice();return i.splice(e,0,i.splice(t,1)[0]),this.update({members:i})},replaceMember:function(t,e,i){if(!this.memberById(t.id))return this;for(var r=[],s=0;s<this.members.length;s++){var n=this.members[s];n.id!==t.id?r.push(n):(i||!this.memberByIdAndRole(e.id,n.role))&&r.push({id:e.id,type:e.type,role:n.role})}return this.update({members:r})},asJXON:function(t){var e={relation:{"@id":this.osmId(),"@version":this.version||0,member:this.members.map(function(i){return{keyAttributes:{type:i.type,role:i.role,ref:Dt.id.toOSM(i.id)}}},this),tag:Object.keys(this.tags).map(function(i){return{keyAttributes:{k:i,v:this.tags[i]}}},this)}};return t&&(e.relation["@changeset"]=t),e},asGeoJSON:function(t){return t.transient(this,"GeoJSON",function(){return this.isMultipolygon()?{type:"MultiPolygon",coordinates:this.multipolygon(t)}:{type:"FeatureCollection",properties:this.tags,features:this.members.map(function(e){return Object.assign({role:e.role},t.entity(e.id).asGeoJSON(t))})}})},area:function(t){return t.transient(this,"area",function(){return Mc(this.asGeoJSON(t))})},isMultipolygon:function(){return this.tags.type==="multipolygon"},isComplete:function(t){for(var e=0;e<this.members.length;e++)if(!t.hasEntity(this.members[e].id))return!1;return!0},hasFromViaTo:function(){return this.members.some(function(t){return t.role==="from"})&&this.members.some(function(t){return t.role==="via"})&&this.members.some(function(t){return t.role==="to"})},isRestriction:function(){return!!(this.tags.type&&this.tags.type.match(/^restriction:?/))},isValidRestriction:function(){if(!this.isRestriction())return!1;var t=this.members.filter(function(r){return r.role==="from"}),e=this.members.filter(function(r){return r.role==="via"}),i=this.members.filter(function(r){return r.role==="to"});return!(t.length!==1&&this.tags.restriction!=="no_entry"||t.some(function(r){return r.type!=="way"})||i.length!==1&&this.tags.restriction!=="no_exit"||i.some(function(r){return r.type!=="way"})||e.length===0||e.length>1&&e.some(function(r){return r.type!=="way"}))},isConnectivity:function(){return!!(this.tags.type&&this.tags.type.match(/^connectivity:?/))},multipolygon:function(t){var e=this.members.filter(function(c){return(c.role||"outer")==="outer"}),i=this.members.filter(function(c){return c.role==="inner"});e=wa(e,t),i=wa(i,t);var r=function(c){return c.nodes.length>2&&c.nodes[0]!==c.nodes[c.nodes.length-1]&&c.nodes.push(c.nodes[0]),c.nodes.map(function(d){return d.loc})};e=e.map(r),i=i.map(r);var s=e.map(function(c){return[Mc({type:"Polygon",coordinates:[c]})>2*Math.PI?c.reverse():c]});function n(c){var d,m;for(d=0;d<e.length;d++)if(m=e[d],F8(m,c))return d;for(d=0;d<e.length;d++)if(m=e[d],pP(m,c,!1))return d}for(var o=0;o<i.length;o++){var a=i[o];Mc({type:"Polygon",coordinates:[a]})<2*Math.PI&&(a=a.reverse());var l=n(i[o]);l!==void 0?s[l].push(i[o]):s.push([i[o]])}return s}});var Er=class t{constructor(e,i,r,s,n){this.loc=e,this.service=i.id,this.itemType=r,this.id=s||`${t.id()}`,this.update(n),i&&typeof i.getIcon=="function"&&(this.icon=i.getIcon(r))}update(e){let{loc:i,service:r,itemType:s,id:n}=this;return Object.keys(e).forEach(o=>this[o]=e[o]),this.loc=i,this.service=r,this.itemType=s,this.id=n,this}static id(){return this.nextId--}};Er.nextId=-1;function Ku(t,e){typeof t=="string"&&(t=[t]);var i,r="longest",s=[];function n(d,m,g){var _=d.entity(m).loc,v=d.entity(g).loc,E=1e-6;return _&&v?mr(_,v):E}function o(d,m,g){var _=new Array(d.length),v,E,b=0,T;function A(k){return L2(k,d.length)}for(v=0,E=A(m+1);E!==m;E=A(E+1))v+=n(g,d[E],d[A(E-1)]),_[E]=v;for(v=0,E=A(m-1);E!==m;E=A(E-1))v+=n(g,d[E],d[A(E+1)]),v<_[E]&&(_[E]=v);for(E=0;E<d.length;E++){var M=_[E]/n(g,d[m],d[E]);M>b&&(T=E,b=M)}return T}function a(d,m){for(var g=0,_=0;_<m.length-1;_++)g+=n(d,m[_],m[_+1]);return g}function l(d,m,g,_){var v=Mr({id:_,tags:g.tags}),E=g.nodes.slice(),b,T,A=g.isArea(),M=U2(g,d);if(g.isClosed()){var k=g.nodes.slice(0,-1),F=k.indexOf(m),O=o(k,F,d);O<F?(b=k.slice(F).concat(k.slice(0,O+1)),T=k.slice(O,F+1)):(b=k.slice(F,O+1),T=k.slice(O).concat(k.slice(0,F+1)))}else{var B=g.nodes.indexOf(m,1);b=g.nodes.slice(0,B+1),T=g.nodes.slice(B)}var U=a(d,b),z=a(d,T);if(r==="longest"&&z>U){g=g.update({nodes:T}),v=v.update({nodes:b});var Z=U;U=z,z=Z}else g=g.update({nodes:b}),v=v.update({nodes:T});if(g.tags.step_count){var W=parseFloat(g.tags.step_count);if(W&&isFinite(W)&&W>0&&Math.round(W)===W){var q=Object.assign({},g.tags),Q=Object.assign({},v.tags),V=U/(U+z),le=Math.round(W*V);q.step_count=le.toString(),Q.step_count=(W-le).toString(),g=g.update({tags:q}),v=v.update({tags:Q})}}if(d=d.replace(g),d=d.replace(v),d.parentRelations(g).forEach(function(ne){var ee;if(ne.hasFromViaTo()){var re=ne.memberByRole("from"),te=ne.membersByRole("via"),ie=ne.memberByRole("to"),oe;if(re.id===g.id||ie.id===g.id){var fe=!1;if(te.length===1&&te[0].type==="node")fe=v.contains(te[0].id);else for(oe=0;oe<te.length;oe++)if(te[oe].type==="way"){var Re=d.hasEntity(te[oe].id);if(Re&&eo(v.nodes,Re.nodes).length){fe=!0;break}}fe&&(ne=ne.replaceMember(g,v),d=d.replace(ne))}else for(oe=0;oe<te.length;oe++)if(te[oe].type==="way"&&te[oe].id===g.id){ee={id:v.id,type:"way",role:"via"},d=Nd(ne.id,ee,te[oe].index+1)(d);break}}else{ne===M&&(d=d.replace(ne.mergeTags(g.tags)),d=d.replace(g.update({tags:{}})),d=d.replace(v.update({tags:{}}))),ee={id:v.id,type:"way",role:ne.memberById(g.id).role};var He={originalID:g.id,insertedID:v.id,nodes:E};d=Nd(ne.id,ee,void 0,He)(d)}}),!M&&A){var de=Ms({tags:Object.assign({},g.tags,{type:"multipolygon"}),members:[{id:g.id,role:"outer",type:"way"},{id:v.id,role:"outer",type:"way"}]});d=d.replace(de),d=d.replace(g.update({tags:{}})),d=d.replace(v.update({tags:{}}))}return s.push(v.id),d}var c=function(d){s=[];for(var m=0,g=0;g<t.length;g++)for(var _=t[g],v=c.waysForNode(_,d),E=0;E<v.length;E++)d=l(d,_,v[E],e&&e[m]),m+=1;return d};return c.getCreatedWayIDs=function(){return s},c.waysForNode=function(d,m){var g=m.entity(d),_=m.parentWays(g).filter(E);if(!i){var v=_.some(function(b){return b.geometry(m)==="line"});if(v)return _.filter(function(b){return b.geometry(m)==="line"})}return _;function E(b){if(i&&i.indexOf(b.id)===-1)return!1;if(b.isClosed())return!0;for(var T=1;T<b.nodes.length-1;T++)if(b.nodes[T]===d)return!0;return!1}},c.ways=function(d){return Ei([].concat.apply([],t.map(function(m){return c.waysForNode(m,d)})))},c.disabled=function(d){for(var m=0;m<t.length;m++){var g=t[m],_=c.waysForNode(g,d);if(_.length===0||i&&i.length!==_.length)return"not_eligible"}},c.limitWays=function(d){return arguments.length?(i=d,c):i},c.keepHistoryOn=function(d){return arguments.length?(r=d,c):r},c}var dW=50,jc=class t{constructor(e,i){this.context=e,this.array=i,this._memo=new Map}item(e){let i=this._memo.get(e);return i||(i=this.array.find(r=>r.id===e),i&&this._memo.set(e,i),i)}index(e){return this.array.findIndex(i=>i.id===e)}matchGeometry(e){let i=this.array.filter(r=>r.matchGeometry(e));return new t(this.context,i)}matchAllGeometry(e){let i=this.array.filter(r=>r&&r.matchAllGeometry(e));return new t(this.context,i)}fallback(e){let i=e;return i==="vertex"&&(i="point"),this.item(i)}search(e,i,r){if(!e)return this;e=e.toLowerCase().trim();function s(F){let O=F.indexOf(e);return O===0||F[O-1]===" "}function n(F){return F.indexOf(e)===0}function o(F){return function(B,U){let z=B[F](),Z=U[F]();if(e===z)return-1;if(e===Z)return 1;let W=U.orig.matchScore-B.orig.matchScore;return W!==0||(W=z.indexOf(e)-Z.indexOf(e),W!==0)?W:z.length-Z.length}}let a=this.array;if(Array.isArray(r)){let O=this.context.systems.locations.locationSetsAt(r);a=a.filter(B=>!B.locationSetID||O[B.locationSetID])}let l=a.filter(F=>F.searchable!==!1&&F.suggestion!==!0),c=a.filter(F=>F.suggestion===!0),d=l.filter(F=>s(F.searchName())).sort(o("searchName")),m=c.filter(F=>n(F.searchName())).sort(o("searchName")),g=l.filter(F=>s(F.searchNameStripped())).sort(o("searchNameStripped")),_=c.filter(F=>n(F.searchNameStripped())).sort(o("searchNameStripped")),v=l.filter(F=>(F.terms()||[]).some(s)),E=c.filter(F=>(F.terms()||[]).some(s)),b=l.filter(F=>Object.values(F.tags||{}).filter(O=>O!=="*").some(s)),T=l.map(F=>({preset:F,dist:D9(e,F.searchName())})).filter(F=>F.dist+Math.min(e.length-F.preset.searchName().length,0)<3).sort((F,O)=>F.dist-O.dist).map(F=>F.preset),A=c.map(F=>({preset:F,dist:D9(e,F.searchName())})).filter(F=>F.dist+Math.min(e.length-F.preset.searchName().length,0)<1).sort((F,O)=>F.dist-O.dist).map(F=>F.preset),M=l.filter(F=>(F.terms()||[]).some(O=>D9(e,O)+Math.min(e.length-O.length,0)<3)),k=d.concat(m,g,_,v,E,b,T,A,M).slice(0,dW-1);if(typeof i=="string"){let F=this.fallback(i);F&&k.push(F)}return new t(this.context,Ei(k))}};var $2=class{constructor(e,i,r,s={}){var o,a;this.context=e,this.id=i,this.safeid=Jh(i),this.allPresets=s,this.orig={},this.orig.name=(o=r.name)!=null?o:"",this.orig.icon=r.icon,this.orig.matchScore=-1,this.orig.members=(a=r.members)!=null?a:[],Object.assign(this,dn(this.orig,["name","matchScore","members"]));let n=this.orig.members.map(l=>s[l]).filter(Boolean);this.members=new jc(e,n),this.geometry=n.reduce((l,c)=>{for(let d in c.geometry){let m=c.geometry[d];l.indexOf(m)===-1&&l.push(m)}return l},[]),this._searchName=null,this._searchNameStripped=null}matchGeometry(e){return this.geometry.includes(e)}matchAllGeometry(e){return this.members.array.some(i=>i.matchAllGeometry(e))}matchScore(){return-1}name(){return this.context.systems.l10n.t(`_tagging.presets.categories.${this.id}.name`,{default:this.id})}nameLabel(){return this.context.systems.l10n.tHtml(`_tagging.presets.categories.${this.id}.name`,{default:this.id})}terms(){return[]}searchName(){return this._searchName||(this._searchName=this.name().toLowerCase()),this._searchName}searchNameStripped(){return this._searchNameStripped||(this._searchNameStripped=this._stripDiacritics(this.searchName())),this._searchNameStripped}searchAliases(){return[]}searchAliasesStripped(){return[]}isFallback(){return!1}_stripDiacritics(e){return e.normalize&&(e=e.normalize("NFD")),e=e.replace(/[\u0300-\u036f]/g,""),e}};var dm=Yi(H2(),1);var Za=class{constructor(e,i){this._base=e,this._head=i,this._changes=new Map,this.didChange={};let r=new Set([...i.local.entities.keys(),...e.local.entities.keys()]);for(let s of r){let n=i.hasEntity(s),o=e.hasEntity(s);if(n!==o){if(o&&!n){this._changes.set(s,{base:o,head:n}),this.didChange.deletion=!0;continue}if(!o&&n){this._changes.set(s,{base:o,head:n}),this.didChange.addition=!0;continue}if(n&&o){if(n.members&&o.members&&!(0,dm.default)(n.members,o.members)){this._changes.set(s,{base:o,head:n}),this.didChange.geometry=!0,this.didChange.properties=!0;continue}n.loc&&o.loc&&!Zi(n.loc,o.loc)&&(this._changes.set(s,{base:o,head:n}),this.didChange.geometry=!0),n.nodes&&o.nodes&&!(0,dm.default)(n.nodes,o.nodes)&&(this._changes.set(s,{base:o,head:n}),this.didChange.geometry=!0),n.tags&&o.tags&&!(0,dm.default)(n.tags,o.tags)&&(this._changes.set(s,{base:o,head:n}),this.didChange.properties=!0)}}}}get changes(){return this._changes}modified(){let e=[];for(let i of this._changes.values())i.base&&i.head&&e.push(i.head);return e}created(){let e=[];for(let i of this._changes.values())!i.base&&i.head&&e.push(i.head);return e}deleted(){let e=[];for(let i of this._changes.values())i.base&&!i.head&&e.push(i.base);return e}summary(){let e=this._base,i=this._head,r=new Map;for(let n of this._changes.values()){let o=n.head,a=n.base;if(o&&o.geometry(i)!=="vertex")s(o,i,a?"modified":"created");else if(a&&a.geometry(e)!=="vertex")s(a,e,"deleted");else if(a&&o){let l=!Zi(a.loc,o.loc),c=!(0,dm.default)(a.tags,o.tags);if(l)for(let d of i.parentWays(o))r.has(d.id)||s(d,i,"modified");(c||l&&o.hasInterestingTags())&&s(o,i,"modified")}else o&&o.hasInterestingTags()?s(o,i,"created"):a&&a.hasInterestingTags()&&s(a,e,"deleted")}return r;function s(n,o,a){r.set(n.id,{entity:n,graph:o,changeType:a})}}complete(){let e=this._head,i=new Map;for(let[s,n]of this._changes){let o=n.head,a=n.base,l=o||a;if(i.set(s,o),l.type==="way"){let c=o?o.nodes:[],d=a?a.nodes:[];for(let m of as(c,d))i.set(m,e.hasEntity(m))}if(l.type==="relation"&&l.isMultipolygon()){let c=o?o.members.map(m=>m.id):[],d=a?a.members.map(m=>m.id):[];for(let m of as(c,d)){let g=e.hasEntity(m);g&&i.set(m,g)}}r(e.parentWays(l),i),r(e.parentRelations(l),i)}return i;function r(s){for(let n of s)i.has(n.id)||(i.set(n.id,n),r(e.parentRelations(n)))}}};var Il=class{constructor(e,i){this.context=e,this._id=i.id,this._idtx=i.id.replace(/\./g,"<TX_DOT>"),this._name=i.name,this._description=i.description,this._template=i.encrypted?BI(i.template):i.template,this.best=!!i.best,this.endDate=i.endDate,this.icon=i.icon,this.overlay=i.overlay,this.overzoom=i.overzoom!==!1,this.polygon=i.polygon,this.projection=i.projection,this.startDate=i.startDate,this.terms_html=i.terms_html,this.terms_text=i.terms_text,this.terms_url=i.terms_url,this.tileSize=i.tileSize||256,this.type=i.type,this.zoomExtent=i.zoomExtent||[0,22],this.isBlocked=!1,this.offset=[0,0]}get id(){return this._id}get idtx(){return this._idtx}get name(){return this.context.systems.l10n.t(`imagery.${this._idtx}.name`,{default:this._name})}get label(){return this.context.systems.l10n.tHtml(`imagery.${this._idtx}.name`,{default:this._name})}get description(){return this.context.systems.l10n.tHtml(`imagery.${this._idtx}.description`,{default:this._description})}get imageryUsed(){return this._name||this._id}get template(){return this._template}get area(){if(!this.polygon)return Number.MAX_VALUE;let e=Mc({type:"MultiPolygon",coordinates:[this.polygon]});return isNaN(e)?0:e}validZoom(e){return this.zoomExtent[0]<=e&&(this.overzoom||this.zoomExtent[1]>e)}isLocatorOverlay(){return this._id==="mapbox_locator_overlay"}copyrightNotices(){}getMetadata(e,i,r){let s={start:this._localeDateString(this.startDate),end:this._localeDateString(this.endDate)};s.range=this._vintageRange(s),r(null,{vintage:s})}nudge(e,i){return this.offset[0]+=e[0]/Math.pow(2,i),this.offset[1]+=e[1]/Math.pow(2,i),this}url(e){let i=this._template;if(i==="")return i;function r(s,n,o,a){let l=Math.pow(2,a),c=n/l*Math.PI*2-Math.PI,d=Math.atan(Math.sinh(Math.PI*(1-2*o/l))),m;switch(s){case"EPSG:4326":return{x:c*180/Math.PI,y:d*180/Math.PI};default:return m=Sf(c,d),{x:2003750834e-2/Math.PI*m[0],y:2003750834e-2/Math.PI*m[1]}}}if(this.type||(/SERVICE=WMS|\{(proj|wkid|bbox)\}/.test(this._template)?(this.type="wms",this.projection="EPSG:3857"):/\{(x|y)\}/.test(this._template)?this.type="tms":/\{u\}/.test(this._template)&&(this.type="bing")),this.type==="wms"){let s=this.tileSize,n=this.projection,o=r(n,e[0],e[1],e[2]),a=r(n,e[0]+1,e[1]+1,e[2]);i=i.replace(/\{(\w+)\}/g,(l,c)=>{switch(c){case"width":case"height":return s;case"proj":return n;case"wkid":return n.replace(/^EPSG:/,"");case"bbox":return n==="EPSG:4326"&&/VERSION=1.3|CRS={proj}/.test(this._template.toUpperCase())?a.y+","+o.x+","+o.y+","+a.x:o.x+","+a.y+","+a.x+","+o.y;case"w":return o.x;case"s":return a.y;case"n":return a.x;case"e":return o.y;default:return l}})}else if(this.type==="tms"){let s=window.devicePixelRatio&&window.devicePixelRatio>=2;i=i.replace("{x}",e[0]).replace("{y}",e[1]).replace(/\{[t-]y\}/,Math.pow(2,e[2])-e[1]-1).replace(/\{z(oom)?\}/,e[2]).replace(/\{@2x\}|\{r\}/,s?"@2x":"")}else this.type==="bing"&&(i=i.replace("{u}",()=>{let s="";for(let n=e[2];n>0;n--){let o=0,a=1<<n-1;e[0]&a&&o++,e[1]&a&&(o+=2),s+=o.toString()}return s}));return i=i.replace(/\{switch:([^}]+)\}/,(s,n)=>{let o=n.split(",");return o[(e[0]+e[1])%o.length]}),i}_localeDateString(e){if(!e)return null;let i={day:"numeric",month:"short",year:"numeric"},r=new Date(e);if(isNaN(r.getTime()))return null;let s=this.context.localizationSystem.localeCode();return r.toLocaleDateString(s,i)}_vintageRange(e){let i;return(e.start||e.end)&&(i=e.start||"?",e.start!==e.end&&(i+=" - "+(e.end||"?"))),i}},V2=class extends Il{constructor(e){super(e,{id:"none",template:""})}get name(){return this.context.systems.l10n.t("background.none")}get label(){return this.context.systems.l10n.tHtml("background.none")}get area(){return-1}get imageryUsed(){return null}},j2=class extends Il{constructor(e,i=""){super(e,{id:"custom",template:i})}get name(){return this.context.systems.l10n.t("background.custom")}get label(){return this.context.systems.l10n.tHtml("background.custom")}get area(){return-2}get imageryUsed(){let e=this._template;if(e.indexOf("?")!==-1){let i=e.split("?",2),r=Kh(i[1]);["access_token","connectId","token"].forEach(s=>{r[s]&&(r[s]="{apikey}")}),e=i[0]+"?"+lr(r,!0)}return e=e.replace(/token\/(\w+)/,"token/{apikey}"),`Custom (${e} )`}set template(e){this._template=e}get template(){return this._template}},X2=class extends Il{constructor(e,i){super(e,i),this._template="https://ecn.t{switch:0,1,2,3}.tiles.virtualearth.net/tiles/a{u}.jpeg?g=1&pr=odbl&n=z",this.terms_url="https://blog.openstreetmap.org/2010/11/30/microsoft-imagery-details"}},W2=class extends Il{constructor(e,i){super(e,i),/blankTile/.test(this._template)||(this._template+="?blankTile=false"),this._cache={},this._inflight={},this._prevCenter=null}fetchTilemap(e){if(this._prevCenter&&mr(e,this._prevCenter)<5e3)return;this._prevCenter=e;let i=this.url([1,2,3]),r=20,s=Math.floor((e[0]+180)/360*Math.pow(2,r)),n=Math.floor((1-Math.log(Math.tan(e[1]*Math.PI/180)+1/Math.cos(e[1]*Math.PI/180))/Math.PI)/2*Math.pow(2,r)),o=i.replace(/tile\/[0-9]+\/[0-9]+\/[0-9]+\?blankTile=false/,"tilemap")+"/"+r+"/"+n+"/"+s+"/8/8";fetch(o).then(Ai).then(a=>{if(!a)throw new Error("Unknown Error");let l=!0;for(let c=0;c<a.data.length;c++)if(!a.data[c]){l=!1;break}this.zoomExtent[1]=l?22:19}).catch(a=>console.error(a))}getMetadata(e,i,r){let s=i.slice(0,3).join("/"),n=Math.min(i[2],this.zoomExtent[1]),o=e[0]+","+e[1],a=this.context.systems.l10n.t("info_panels.background.unknown");if(this._inflight[s])return;let l;switch(!0){case(n>=20&&this._id==="EsriWorldImageryClarity"):l=4;break;case n>=19:l=3;break;case n>=17:l=2;break;case n>=13:l=0;break;default:l=99}let c;if(this._id==="EsriWorldImagery")c="https://services.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/";else if(this._id==="EsriWorldImageryClarity")c="https://serviceslab.arcgisonline.com/arcgis/rest/services/Clarity_World_Imagery/MapServer/";else return;if(c+=l+"/query?returnGeometry=false&geometry="+o+"&inSR=4326&geometryType=esriGeometryPoint&outFields=*&f=json",this._cache[s]||(this._cache[s]={}),this._cache[s]&&this._cache[s].metadata)return r(null,this._cache[s].metadata);let d={},m={};l===99?(d={start:null,end:null,range:null},m={vintage:null,source:a,description:a,resolution:a,accuracy:a},r(null,m)):(this._inflight[s]=!0,fetch(c).then(Ai).then(_=>{if(delete this._inflight[s],_){if(_.features&&_.features.length<1)throw new Error("No Results");if(_.error&&_.error.message)throw new Error(_.error.message)}else throw new Error("Unknown Error");let v=this._localeDateString(_.features[0].attributes.SRC_DATE2);d={start:v,end:v,range:v},m={vintage:d,source:g(_.features[0].attributes.NICE_NAME),description:g(_.features[0].attributes.NICE_DESC),resolution:g(+parseFloat(_.features[0].attributes.SRC_RES).toFixed(4)),accuracy:g(+parseFloat(_.features[0].attributes.SRC_ACC).toFixed(4))},isFinite(m.resolution)&&(m.resolution+=" m"),isFinite(m.accuracy)&&(m.accuracy+=" m"),this._cache[s].metadata=m,r&&r(null,m)}).catch(_=>{delete this._inflight[s],r&&r(_.message)}));function g(_){return String(_).trim()||a}}};var q2=class{constructor(e,i,r,s={}){var n,o,a,l,c,d,m,g,_,v;this.context=e,this.id=i,this.safeid=Jh(i),this.allFields=s,this.orig={},this.orig.autoSuggestions=(n=r.autoSuggestions)!=null?n:!0,this.orig.caseSensitive=(o=r.caseSensitive)!=null?o:!1,this.orig.customValues=(a=r.customValues)!=null?a:!0,this.orig.default=r.default,this.orig.geometry=r.geometry,this.orig.icon=r.icon,this.orig.increment=(l=r.increment)!=null?l:1,this.orig.key=r.key,this.orig.keys=(c=r.keys)!=null?c:[r.key],this.orig.label=(d=r.label)!=null?d:"",this.orig.locationSet=r.locationSet,this.orig.maxValue=r.maxValue,this.orig.minValue=r.minValue,this.orig.options=r.options,this.orig.pattern=r.pattern,this.orig.placeholder=(m=r.placeholder)!=null?m:"",this.orig.prerequisiteTag=r.prerequisiteTag,this.orig.reference=r.reference,this.orig.snake_case=(g=r.snake_case)!=null?g:!0,this.orig.strings=r.strings,this.orig.terms=((_=r.terms)!=null?_:[]).join(),this.orig.type=r.type,this.orig.universal=(v=r.universal)!=null?v:!1,this.orig.urlFormat=r.urlFormat,this.orig.usage=r.usage,Object.assign(this,dn(this.orig,["increment","label","placeholder","terms"])),this.title=this.title.bind(this),this.label=this.label.bind(this),this.placeholder=this.placeholder.bind(this),this.terms=this.terms.bind(this)}increment(){return this.type==="number"?this.increment:void 0}title(){return this._resolveReference("label").t("label",{default:this.id})}label(){return this._resolveReference("label").tHtml("label",{default:this.id})}placeholder(){return this._resolveReference("placeholder").t("placeholder",{default:this.orig.placeholder})}terms(){return this._resolveReference("terms").t("terms",{default:this.orig.terms}).toLowerCase().trim().split(/\s*,+\s*/)}matchGeometry(e){return!this.geometry||this.geometry.indexOf(e)!==-1}matchAllGeometry(e){return!this.geometry||e.every(i=>this.geometry.indexOf(i)!==-1)}t(e,i){return this.context.systems.l10n.t(`_tagging.presets.fields.${this.id}.${e}`,i)}tHtml(e,i){return this.context.systems.l10n.tHtml(`_tagging.presets.fields.${this.id}.${e}`,i)}tAppend(e,i){return this.context.systems.l10n.tAppend(`_tagging.presets.fields.${this.id}.${e}`,i)}hasTextForStringID(e){return this.context.systems.l10n.hasTextForStringID(`_tagging.presets.fields.${this.id}.${e}`)}_resolveReference(e){let r=(this.orig[e]||"").match(/^\{(.*)\}$/);if(r){let s=this.allFields[r[1]];if(s)return s;console.error(`Unable to resolve referenced field: ${r[1]}`)}return this}};var Cn=class t{constructor(e,i){e instanceof t?(this._base=e._base,this._local={entities:new Map(e._local.entities),parentWays:new Map(e._local.parentWays),parentRels:new Map(e._local.parentRels)}):(this._base={entities:new Map,parentWays:new Map,parentRels:new Map},this._local={entities:new Map,parentWays:new Map,parentRels:new Map},this.rebase(e||[],[this])),this._transients=new Map,this._childNodes=new Map,this._frozen=!i}get base(){return this._base}get local(){return this._local}get frozen(){return this._frozen}hasEntity(e){let i=this._base.entities,r=this._local.entities;return r.has(e)?r.get(e):i.get(e)}entity(e){let i=this.hasEntity(e);if(!i)throw new Error(`Entity ${e} not found`);return i}geometry(e){return this.entity(e).geometry(this)}transient(e,i,r){let s=e.id,n=this._transients.get(s);n||(n=new Map,this._transients.set(s,n));let o=n.get(i);return o!==void 0||(o=r.call(e),n.set(i,o)),o}isPoi(e){var n,o;if(e.type!=="node")return!1;let i=this._base.parentWays;return((o=(n=this._local.parentWays.get(e.id))!=null?n:i.get(e.id))!=null?o:new Set).size===0}isShared(e){var l,c;if(e.type!=="node")return!1;let i=this._base.parentWays,s=(c=(l=this._local.parentWays.get(e.id))!=null?l:i.get(e.id))!=null?c:new Set;if(s.size===0)return!1;if(s.size>1)return!0;let n=[...s][0],o=this.entity(n),a=o.isClosed()?o.nodes.length-1:o.nodes.length;for(let d=0,m=0;d<a;d++)if(e.id===o.nodes[d]&&m++,m>1)return!0;return!1}parentWays(e){var n,o;let i=this._base.parentWays,s=(o=(n=this._local.parentWays.get(e.id))!=null?n:i.get(e.id))!=null?o:new Set;return Array.from(s).map(a=>this.entity(a))}parentRelations(e){var n,o;let i=this._base.parentRels,s=(o=(n=this._local.parentRels.get(e.id))!=null?n:i.get(e.id))!=null?o:new Set;return Array.from(s).map(a=>this.entity(a))}parentMultipolygons(e){return this.parentRelations(e).filter(i=>i.isMultipolygon())}childNodes(e){if(!e.nodes)return[];let i=this._childNodes.get(e.id);if(i)return i;i=new Array(e.nodes.length);for(let r=0;r<e.nodes.length;++r)i[r]=this.entity(e.nodes[r]);return this._childNodes.set(e.id,i),i}rebase(e,i,r){let s=this._base,n=i[i.length-1]._local.entities,o=new Set;for(let a of e)if(!(!a.visible||!r&&s.entities.has(a.id))&&(s.entities.set(a.id,a),this._updateCalculated(void 0,a,s.parentWays,s.parentRels),a.type==="way"))for(let l of a.nodes)n.has(l)&&n.get(l)===void 0&&o.add(l);for(let a of i){let l=a._local.entities;for(let c of o)l.has(c)&&l.get(c)===void 0&&l.delete(c);a._updateRebased()}}_updateRebased(){let e=this._base,i=this._local;for(let[r,s]of i.parentWays){let n=e.parentWays.get(r);if(n)for(let o of n)i.entities.has(o)||s.add(o)}for(let[r,s]of i.parentRels){let n=e.parentRels.get(r);if(n)for(let o of n)i.entities.has(o)||s.add(o)}this._transients=new Map}_updateCalculated(e,i,r,s){var d,m,g,_,v,E,b,T;let n=this._base,o=this._local;r=r||o.parentWays,s=s||o.parentRels;let a=i!=null?i:e;if(!a)return;let l,c;if(a.type==="way"){e&&i?(l=Sn(e.nodes,i.nodes),c=Sn(i.nodes,e.nodes)):e?(l=e.nodes,c=[]):i&&(l=[],c=i.nodes);for(let A of l){let M=new Set((m=(d=o.parentWays.get(A))!=null?d:n.parentWays.get(A))!=null?m:[]);M.delete(a.id),r.set(A,M)}for(let A of c){let M=new Set((_=(g=o.parentWays.get(A))!=null?g:n.parentWays.get(A))!=null?_:[]);M.add(a.id),r.set(A,M)}}else if(a.type==="relation"){let A=e?e.members.map(k=>k.id):[],M=i?i.members.map(k=>k.id):[];e&&i?(l=Sn(A,M),c=Sn(M,A)):e?(l=A,c=[]):i&&(l=[],c=M);for(let k of l){let F=new Set((E=(v=o.parentRels.get(k))!=null?v:n.parentRels.get(k))!=null?E:[]);F.delete(a.id),s.set(k,F)}for(let k of c){let F=new Set((T=(b=o.parentRels.get(k))!=null?b:n.parentRels.get(k))!=null?T:[]);F.add(a.id),s.set(k,F)}}}replace(e){let i=e.id,r=this.hasEntity(i);return r===e?this:this.update(function(){this._updateCalculated(r,e),this._local.entities.set(i,e)})}remove(e){let i=e.id,r=this.hasEntity(i);return r?this.update(function(){this._updateCalculated(r,void 0),this._local.entities.set(i,void 0)}):this}revert(e){let i=this._base.entities.get(e),r=this.hasEntity(e);return r===i?this:this.update(function(){this._updateCalculated(r,i),this._local.entities.delete(e)})}update(...e){let i=this._frozen?new t(this,!0):this;for(let r of e)r.call(i,i);return this._frozen&&(i._frozen=!0),i}load(e){let i=this._base,r=this._local;r.entities=new Map;for(let[s,n]of Object.entries(e)){let o=i.entities.get(s);r.entities.set(s,n),this._updateCalculated(o,n)}return this}};var Xc=class{constructor(e,i,r,s={},n={}){var o,a,l,c,d,m,g,_,v,E,b,T,A,M,k;this.context=e,this.id=i,this.safeid=Jh(i),this.allFields=s,this.allPresets=n,this.orig={},this.orig.addTags=(a=(o=r.addTags)!=null?o:r.tags)!=null?a:{},this.orig.aliases=(l=r.aliases)!=null?l:[],this.orig.fields=(c=r.fields)!=null?c:[],this.orig.geometry=(d=r.geometry)!=null?d:[],this.orig.icon=r.icon,this.orig.imageURL=r.imageURL,this.orig.locationSet=r.locationSet,this.orig.matchScore=(m=r.matchScore)!=null?m:1,this.orig.moreFields=(g=r.moreFields)!=null?g:[],this.orig.name=(_=r.name)!=null?_:"",this.orig.reference=(v=r.reference)!=null?v:{},this.orig.removeTags=(T=(b=(E=r.removeTags)!=null?E:r.addTags)!=null?b:r.tags)!=null?T:{},this.orig.replacement=r.replacement,this.orig.searchable=(A=r.searchable)!=null?A:!0,this.orig.suggestion=r.suggestion,this.orig.tags=(M=r.tags)!=null?M:{},this.orig.terms=((k=r.terms)!=null?k:[]).join(),Object.assign(this,dn(this.orig,["aliases","fields","matchScore","moreFields","name","reference","terms"])),this._resolved={fields:null,moreFields:null},this._searchName=null,this._searchNameStripped=null,this._searchAliases=null,this._searchAliasesStripped=null}aliases(){return this._resolveName("name").t("aliases",{default:this.orig.aliases}).trim().split(/\s*[\r\n]+\s*/)}name(){return this._resolveName("name").t("name",{default:this.orig.name||this.id})}nameLabel(){return this._resolveName("name").tHtml("name",{default:this.orig.name||this.id})}fields(){return this._resolved.fields||(this._resolved.fields=this._resolveFields("fields"))}moreFields(){return this._resolved.moreFields||(this._resolved.moreFields=this._resolveFields("moreFields"))}resetFields(){return this._resolved={fields:null,moreFields:null}}matchGeometry(e){return this.geometry.includes(e)}matchAllGeometry(e){return e.every(i=>this.matchGeometry(i))}matchScore(e){let i=this.tags,r={},s=0;for(let o in i)if(r[o]=!0,e[o]===i[o])s+=this.orig.matchScore;else if(i[o]==="*"&&o in e)s+=this.orig.matchScore/2;else return-1;let n=this.addTags;for(let o in n)!r[o]&&e[o]===n[o]&&(s+=this.orig.matchScore);return s}t(e,i){return this.context.t(`_tagging.presets.presets.${this.id}.${e}`,i)}tHtml(e,i){return this.context.tHtml(`_tagging.presets.presets.${this.id}.${e}`,i)}tAppend(e,i){return this.context.tAppend(`_tagging.presets.presets.${this.id}.${e}`,i)}subtitle(){if(this.suggestion){let e=this.id.split("/");return e.pop(),this.context.t("_tagging.presets.presets."+e.join("/")+".name")}return null}subtitleLabel(){if(this.suggestion){let e=this.id.split("/");return e.pop(),this.context.tHtml("_tagging.presets.presets."+e.join("/")+".name")}return null}terms(){return this._resolveName("name").t("terms",{default:this.orig.terms}).toLowerCase().trim().split(/\s*,+\s*/)}searchName(){return this._searchName||(this._searchName=(this.suggestion?this.orig.name:this.name()).toLowerCase()),this._searchName}searchNameStripped(){return this._searchNameStripped||(this._searchNameStripped=this._stripDiacritics(this.searchName())),this._searchNameStripped}searchAliases(){return this._searchAliases||(this._searchAliases=this.aliases().map(e=>e.toLowerCase())),this._searchAliases}searchAliasesStripped(){return this._searchAliasesStripped||(this._searchAliasesStripped=this.searchAliases().map(this._stripDiacritics)),this._searchAliasesStripped}isFallback(){return["point","line","area","relation"].includes(this.id)}reference(){let e=this.tags.wikidata||this.tags["flag:wikidata"]||this.tags["brand:wikidata"]||this.tags["network:wikidata"]||this.tags["operator:wikidata"];if(e)return{qid:e};let i=this.orig.reference.key||Object.keys(dn(this.tags,"name"))[0],r=this.orig.reference.value||this.tags[i];return r==="*"?{key:i}:{key:i,value:r}}unsetTags(e,i,r,s){let n=r?dn(this.removeTags,r):this.removeTags;return e=dn(e,Object.keys(n)),i&&!s&&this.fields().forEach(o=>{o.matchGeometry(i)&&o.key&&o.default===e[o.key]&&delete e[o.key]}),delete e.area,e}setTags(e,i,r){let s=this.addTags;e=Object.assign({},e);for(let n in s)s[n]==="*"?(this.tags[n]||!e[n]||e[n]==="no")&&(e[n]="yes"):e[n]=s[n];if(!s.hasOwnProperty("area")&&(delete e.area,i==="area")){let n=!0;if(this.geometry.indexOf("line")===-1){for(let o in s)if(o in ed){n=!1;break}}n&&(e.area="yes")}return i&&!r&&this.fields().forEach(n=>{n.matchGeometry(i)&&n.key&&!e[n.key]&&n.default&&(e[n.key]=n.default)}),e}_stripDiacritics(e){return e.normalize&&(e=e.normalize("NFD")),e=e.replace(/[\u0300-\u036f]/g,""),e}_resolveName(e){let r=(this.orig[e]||"").match(/^\{(.*)\}$/);if(r){let s=this.allPresets[r[1]];if(s)return s;console.warn(`Unable to resolve referenced preset: ${r[1]}.${e}`)}return this}_resolveFields(e){let i=this.orig[e]||"",r=this,s=[];for(let a of i){let l=a.match(/^\{(.*)\}$/);l!==null?s=s.concat(n(l[1],e)):this.allFields[a]?s.push(this.allFields[a]):console.warn(`Cannot resolve "${a}" found in ${this.id}.${e}`)}if(!s.length){let a=this.id.lastIndexOf("/"),l=a&&this.id.substring(0,a);l&&(s=n(l,e))}return Ei(s);function n(a,l){let c=r.allPresets[a];return c?l==="fields"?c.fields().filter(o):l==="moreFields"?c.moreFields():[]:[]}function o(a){return!(a.key&&r.tags[a.key]!==void 0&&a.type!=="multiCombo"&&a.type!=="semiCombo"&&a.type!=="manyCombo"&&a.type!=="check")}}};var QE=Yi(kl(),1);var Qa=class{constructor(e){this._current=e,this._entityRBush=new QE.default,this._entityBoxes=new Map,this._entitySegments=new Map,this._segmentRBush=new QE.default,this._segmentBoxes=new Map}_removeEntity(e){var s;let i=this._entityBoxes.get(e);i&&(this._entityRBush.remove(i),this._entityBoxes.delete(e));let r=(s=this._entitySegments.get(e))!=null?s:[];for(let n of r){let o=n.id,a=this._segmentBoxes.get(o);a&&(this._segmentRBush.remove(a),this._segmentBoxes.delete(o))}this._entitySegments.delete(e)}_loadEntities(e){var n;let i=this._current,r=[],s=[];for(let[o,a]of e){let l=a.extent(i);if(!l)continue;let c=l.bbox();if(c.id=o,this._entityBoxes.set(o,c),r.push(c),typeof a.segments!="function")continue;let d=(n=a.segments(i))!=null?n:[];this._entitySegments.set(o,d);for(let m of d){let g=m.id,_=m.extent(i);if(!_)continue;let v=_.bbox();v.id=g,v.segment=m,this._segmentBoxes.set(g,v),s.push(v)}}r.length&&this._entityRBush.load(r),s.length&&this._segmentRBush.load(s)}_includeParents(e,i,r){let s=this._current,n=e.id;if(r||(r=new Set),!r.has(n)){r.add(n);for(let o of s.parentWays(e))this._entityBoxes.has(o.id)&&(this._removeEntity(o.id),i.set(o.id,o)),this._includeParents(o,i,r);for(let o of s.parentRelations(e))this._entityBoxes.has(o.id)&&(this._removeEntity(o.id),i.set(o.id,o)),this._includeParents(o,i,r)}}_setCurrentGraph(e){if(e===this._current)return;let i=new Za(this._current,e);this._current=e;let r=i.didChange;if(!r.addition&&!r.deletion&&!r.geometry)return;let s=new Map;if(r.deletion)for(let n of i.deleted())this._removeEntity(n.id);if(r.geometry)for(let n of i.modified())this._removeEntity(n.id),s.set(n.id,n),this._includeParents(n,s);if(r.addition)for(let n of i.created())s.set(n.id,n);this._loadEntities(s)}rebase(e,i){let s=this._current.local,n=new Map;for(let o of e){if(!o.visible)continue;let a=o.id;s.entities.has(a)&&s.entities.get(a)===void 0||this._entityBoxes.has(a)&&!i||(this._removeEntity(a),n.set(a,o),this._includeParents(o,n))}this._loadEntities(n)}intersects(e,i){return this._setCurrentGraph(i),this._entityRBush.search(e.bbox()).map(r=>i.entity(r.id))}waySegments(e,i){return this._setCurrentGraph(i),this._segmentRBush.search(e.bbox()).map(r=>r.segment)}};var Ti=class{constructor(e){this.title=e.title,this.onClick=e.onClick,this.disabledReason=e.disabledReason,this.icon=e.icon,this.entityIds=e.entityIds||[],this.issue=null}};var or=class{constructor(e,i){this.context=e,this.type=i.type,this.subtype=i.subtype,this.severity=i.severity,this.message=i.message,this.reference=i.reference,this.entityIds=i.entityIds,this.loc=i.loc,this.data=i.data,this.dynamicFixes=i.dynamicFixes,this.hash=i.hash,this.id=this._generateID(),this.key=this._generateKey(),this.autoArgs=i.autoArgs,this.autoFix=null}extent(e){return this.loc?new mt(this.loc):this.entityIds&&this.entityIds.length?kr(this.entityIds,e):null}fixes(){let e=typeof this.dynamicFixes=="function"?this.dynamicFixes():[];this.severity==="warning"&&e.push(new Ti({title:this.context.tHtml("issues.fix.ignore_issue.title"),icon:"rapid-icon-close",onClick:()=>{this.context.systems.validator.ignoreIssue(this.id)}}));for(let i of e)i.id=i.title,i.issue=this;return e}_generateID(){let e=[this.type];if(this.hash&&e.push(this.hash),this.subtype&&e.push(this.subtype),this.entityIds){let i=this.entityIds.slice().sort();e.push.apply(e,i)}return e.join(":")}_generateKey(){return this.id+":"+Date.now().toString()}};function fm(t){if(!(this instanceof fm))return new fm(t);Object.assign(this,t)}function qD(t,e,i){i=i||30;var r=new Cn,s,n,o;function a(oe){return t.parentRelations(oe).some(function(fe){return fe.isRestriction()})}function l(oe){if(oe.isArea()||oe.isDegenerate())return!1;var fe={motorway:!0,motorway_link:!0,trunk:!0,trunk_link:!0,primary:!0,primary_link:!0,secondary:!0,secondary_link:!0,tertiary:!0,tertiary_link:!0,residential:!0,unclassified:!0,living_street:!0,service:!0,road:!0,track:!0};return fe[oe.tags.highway]}for(var c=t.entity(e),d=[c],m,g=[],_=[],v,E=[],b=[],T,A=[],M,k=[],F,O=[];d.length;){v=d.pop(),m=t.parentWays(v);var B=!1;for(s=0;s<m.length;s++)if(T=m[s],!(!l(T)&&!a(T))){for(E.push(T),B=!0,A=Ei(t.childNodes(T)),n=0;n<A.length;n++)if(M=A[n],M!==v&&g.indexOf(M)===-1&&!(mr(M.loc,c.loc)>i)){var U=!1;for(k=t.parentWays(M),o=0;o<k.length;o++)if(F=k[o],F!==T&&E.indexOf(F)===-1&&l(F)){U=!0;break}U&&d.push(M)}}B&&g.push(v)}g=Ei(g),E=Ei(E),E.forEach(function(oe){t.childNodes(oe).forEach(function(fe){r=r.replace(fe)}),r=r.replace(oe),t.parentRelations(oe).forEach(function(fe){fe.isRestriction()&&(fe.isValidRestriction(t)?r=r.replace(fe):fe.isComplete(t)&&O.push(gn(fe.id)))})}),E.forEach(function(oe){var fe=r.entity(oe.id);if(fe.tags.oneway==="-1"){var Re=pl(fe.id,{reverseOneway:!0});O.push(Re),r=Re(r)}});var z=Dt.id.next.way;g.forEach(function(oe){var fe=Ku([oe.id]).keepHistoryOn("first");fe.disabled(r)||fe.ways(r).forEach(function(Re){var He=Ku([oe.id]).limitWays([Re.id]).keepHistoryOn("first");O.push(He),r=He(r)})}),Dt.id.next.way=z,_=g.map(function(oe){return oe.id}),g=[],E=[],_.forEach(function(oe){var fe=r.entity(oe),Re=r.parentWays(fe);g.push(fe),E=E.concat(Re)}),g=Ei(g),E=Ei(E),_=g.map(function(oe){return oe.id}),b=E.map(function(oe){return oe.id});function Z(oe,fe){var Re=oe.isOneWay(),He=fe.indexOf(oe.first())!==-1,Je=fe.indexOf(oe.last())!==-1,ot=He&&Je,yt=He&&!Re||Je,bt=He||Je&&!Re;return oe.update({__first:He,__last:Je,__from:yt,__via:ot,__to:bt,__oneWay:Re})}E=[],b.forEach(function(oe){var fe=Z(r.entity(oe),_);r=r.replace(fe),E.push(fe)});var W,q=[],Q=[];do for(W=!1,d=_.slice(),s=0;s<d.length;s++){var V=d[s];if(v=r.hasEntity(V),!v){_.indexOf(V)!==-1&&_.splice(_.indexOf(V),1),Q.push(V);continue}if(k=r.parentWays(v),k.length<3&&_.indexOf(V)!==-1&&_.splice(_.indexOf(V),1),k.length===2){var le=k[0],de=k[1],ne=le&&!le.__via,ee=de&&!de.__via,re,te;ne&&!ee?(re=le,te=de):!ne&&ee&&(re=de,te=le),re&&te&&(te=Z(te,_),r=r.replace(te).remove(re),q.push(re.id),W=!0)}k=r.parentWays(v),k.length<2&&(_.indexOf(V)!==-1&&_.splice(_.indexOf(V),1),Q.push(V),W=!0),k.length<1&&(r=r.remove(v))}while(W);g=g.filter(function(oe){return Q.indexOf(oe.id)===-1}).map(function(oe){return r.entity(oe.id)}),E=E.filter(function(oe){return q.indexOf(oe.id)===-1}).map(function(oe){return r.entity(oe.id)});var ie={graph:r,actions:O,vertices:g,ways:E};return ie.turns=function(oe,fe){if(!oe)return[];fe||(fe=0);var Re=ie.graph,He=ie.vertices.map(function(Te){return Te.id}),Je=Re.entity(oe);if(!Je||!(Je.__from||Je.__via))return[];var ot=fe*2+3,yt=[];return bt(Je),yt;function bt(Te,Ze,xt,It){if(Ze=(Ze||[]).slice(),!(Ze.length>=ot)){Ze.push(Te.id),xt=(xt||[]).slice();var Bt,Mi;if(Te.type==="node"){var je=Re.parentWays(Te),be=[];for(Bt=0;Bt<je.length;Bt++){var ge=je[Bt];if(!(ge.__oneWay&&ge.nodes[0]!==Te.id)&&!(Ze.indexOf(ge.id)!==-1&&Ze.length>=3)){var xe=null;for(Mi=0;Mi<xt.length;Mi++){var Me=xt[Mi],Oe=Me.memberByRole("from"),De=Me.membersByRole("via"),rt=Me.memberByRole("to"),ct=/^only_/.test(Me.tags.restriction),Vt=Oe.id===oe,ti=!1,lt=!1;if(rt.id===ge.id)if(De.length===1&&De[0].type==="node")ti=De[0].id===Te.id&&(Vt&&Ze.length===2||!Vt&&Ze.length>2);else{var Nt=[];for(o=2;o<Ze.length;o+=2)Nt.push(Ze[o]);var Lt=[];for(o=0;o<De.length;o++)De[o].type==="way"&&Lt.push(De[o].id);var qi=Sn(Nt,Lt);ti=!qi.length}else if(ct){for(o=0;o<De.length;o++)if(De[o].type==="way"&&De[o].id===ge.id){lt=!0;break}}if(ti?ct?xe={id:Me.id,direct:Vt,from:Oe.id,only:!0,end:!0}:xe={id:Me.id,direct:Vt,from:Oe.id,no:!0,end:!0}:lt?xe={id:Me.id,direct:!1,from:Oe.id,only:!0,end:!1}:ct&&(xe={id:Me.id,direct:!1,from:Oe.id,no:!0,end:!0}),xe&&xe.direct)break}be.push({way:ge,restrict:xe})}}be.forEach(function(Oi){bt(Oi.way,Ze,xt,Oi.restrict)})}else{if(Ze.length>=3){var Vi=Ze.slice();if(It&&It.direct===!1){for(Bt=0;Bt<Vi.length;Bt++)if(Vi[Bt]===It.from){Vi=Vi.slice(Bt);break}}var Ke=at(Vi);if(Ke&&(It&&(Ke.restrictionID=It.id,Ke.no=It.no,Ke.only=It.only,Ke.direct=It.direct),yt.push(fm(Ke))),Ze[0]===Ze[2])return}if(It&&It.end)return;var dt=Re.entity(Te.first()),kt=Re.entity(Te.last()),Zt=mr(dt.loc,kt.loc),Qt=[];if(Ze.length>1&&(Zt>i||!Te.__via))return;!Te.__oneWay&&He.indexOf(dt.id)!==-1&&Ze.indexOf(dt.id)===-1&&Qt.push(dt),He.indexOf(kt.id)!==-1&&Ze.indexOf(kt.id)===-1&&Qt.push(kt),Qt.forEach(function(Oi){var gr=Re.parentRelations(Te).filter(function(Ji){if(!Ji.isRestriction())return!1;var ys=Ji.memberByRole("from");if(!ys||ys.id!==Te.id)return!1;var hs=/^only_/.test(Ji.tags.restriction);if(!hs)return!0;var ke=!1,he=Ji.membersByRole("via");if(he.length===1&&he[0].type==="node")ke=he[0].id===Oi.id;else for(var me=0;me<he.length;me++)if(he[me].type==="way"){var Ee=Re.entity(he[me].id);if(Ee.first()===Oi.id||Ee.last()===Oi.id){ke=!0;break}}return ke});bt(Oi,Ze,xt.concat(gr),!1)})}}}function at(Te){if(Te.length<3)return;var Ze,xt,It,Bt,Mi,je,be,ge,xe;if(Ze=Te[0],Bt=Te[Te.length-1],Te.length===3&&Ze===Bt){var Me=Re.entity(Ze);if(Me.__oneWay)return null;xe=!0,ge=It=je=Te[1],xt=Mi=Oe(Ze,ge)}else xe=!1,It=Te[1],xt=Oe(Ze,It),je=Te[Te.length-2],Mi=Oe(Bt,je),Te.length===3?ge=Te[1]:(be=Te.filter(function(De){return De[0]==="w"}),be=be.slice(1,be.length-1));return{key:Te.join("_"),path:Te,from:{node:xt,way:Ze,vertex:It},via:{node:ge,ways:be},to:{node:Mi,way:Bt,vertex:je},u:xe};function Oe(De,rt){var ct=Re.entity(De).nodes;return rt===ct[0]?ct[1]:ct[ct.length-2]}}},ie}function YD(t,e,i){for(var r=t.entity(e.from.way),s=t.entity(e.from.node),n=t.entity(e.from.vertex),o=t.entity(e.to.way),a=t.entity(e.to.node),l=t.entity(e.to.vertex),c=r.tags.oneway==="yes",d=o.tags.oneway==="yes",m=(fs(i.project(n.loc),i.project(s.loc))-fs(i.project(l.loc),i.project(a.loc)))*(180/Math.PI);m<0;)m+=360;return s===a||(m<23||m>336)&&c&&d||(m<40||m>319)&&c&&d&&e.from.vertex!==e.to.vertex?"no_u_turn":m<158?"no_right_turn":m>202?"no_left_turn":"no_straight_on"}function Gg(t,e){function i(s){var n=t.map(function(a){return s.entity(a)}),o=ds(n,function(a){return a.type==="way"&&a.isClosed()?"closedWay":a.type==="relation"&&a.isMultipolygon()?"multipolygon":"other"});return Object.assign({closedWay:[],multipolygon:[],other:[]},o)}var r=function(s){for(var n=i(s),o=n.multipolygon.reduce(function(v,E){return v.concat(wa(E.members,s))},[]).concat(n.closedWay.map(function(v){var E=[{id:v.id}];return E.nodes=s.childNodes(v),E})),a=o.map(function(v,E){return o.map(function(b,T){return E===T?null:F8(b.nodes.map(function(A){return A.loc}),v.nodes.map(function(A){return A.loc}))})}),l=[],c=!0;o.length;)g(o),o=o.filter(d),a=a.filter(d).map(m);function d(v,E){return a[E].some(function(b){return b})}function m(v){return v.filter(d)}function g(v){v.forEach(function(E,b){d(E,b)||E.forEach(function(T){l.push({type:"way",id:T.id,role:c?"outer":"inner"})})}),c=!c}var _=n.multipolygon[0]||Ms({id:e,tags:{type:"multipolygon"}});return n.multipolygon.slice(1).forEach(function(v){_=_.mergeTags(v.tags),s=s.remove(v)}),n.closedWay.forEach(function(v){function E(b){return b.id===v.id&&b.role!=="inner"}l.some(E)&&(_=_.mergeTags(v.tags),s=s.replace(v.update({tags:{}})))}),s.replace(_.update({members:l,tags:dn(_.tags,["area"])}))};return r.disabled=function(s){var n=i(s);if(n.other.length>0||n.closedWay.length+n.multipolygon.length<2)return"not_eligible";if(!n.multipolygon.every(function(a){return a.isComplete(s)}))return"incomplete_relation";if(n.multipolygon.length){if(n.closedWay.some(function(a){return eo(s.parentMultipolygons(a),n.multipolygon).length}))return"not_eligible"}else{var o=[];if(n.closedWay.forEach(function(a,l){l===0?o=s.parentMultipolygons(a):o=eo(o,s.parentMultipolygons(a))}),o=o.filter(function(a){return a.members.length===n.closedWay.length}),o.length)return"not_eligible"}},r}var Y2=Yi(H2(),1);function fW(t,e){let i={};for(let n=0;n<e.length;n++){let o=e[n];i[o]?i[o].push(n):i[o]=[n]}let s=[{buffer1index:-1,buffer2index:-1,chain:null}];for(let n=0;n<t.length;n++){let o=t[n],a=i[o]||[],l=0,c=s[0];for(let d=0;d<a.length;d++){let m=a[d],g;for(g=l;g<s.length&&!(s[g].buffer2index<m&&(g===s.length-1||s[g+1].buffer2index>m));g++);if(g<s.length){let _={buffer1index:n,buffer2index:m,chain:s[g]};if(l===s.length?s.push(c):s[l]=c,l=g+1,c=_,l===s.length)break}}s[l]=c}return s[s.length-1]}function ZD(t,e){let i=fW(t,e),r=[],s=t.length,n=e.length;for(let o=i;o!==null;o=o.chain){let a=s-o.buffer1index-1,l=n-o.buffer2index-1;s=o.buffer1index,n=o.buffer2index,(a||l)&&r.push({buffer1:[s+1,a],buffer1Content:t.slice(s+1,s+1+a),buffer2:[n+1,l],buffer2Content:e.slice(n+1,n+1+l)})}return r.reverse(),r}function pW(t,e,i){let r=[];function s(l,c){r.push({ab:c,oStart:l.buffer1[0],oLength:l.buffer1[1],abStart:l.buffer2[0],abLength:l.buffer2[1]})}ZD(e,t).forEach(l=>s(l,"a")),ZD(e,i).forEach(l=>s(l,"b")),r.sort((l,c)=>l.oStart-c.oStart);let n=[],o=0;function a(l){l>o&&(n.push({stable:!0,buffer:"o",bufferStart:o,bufferLength:l-o,bufferContent:e.slice(o,l)}),o=l)}for(;r.length;){let l=r.shift(),c=l.oStart,d=l.oStart+l.oLength,m=[l];for(a(c);r.length;){let g=r[0],_=g.oStart;if(_>d)break;d=Math.max(d,_+g.oLength),m.push(r.shift())}if(m.length===1){if(l.abLength>0){let g=l.ab==="a"?t:i;n.push({stable:!0,buffer:l.ab,bufferStart:l.abStart,bufferLength:l.abLength,bufferContent:g.slice(l.abStart,l.abStart+l.abLength)})}}else{let g={a:[t.length,-1,e.length,-1],b:[i.length,-1,e.length,-1]};for(;m.length;){l=m.shift();let A=l.oStart,M=A+l.oLength,k=l.abStart,F=k+l.abLength,O=g[l.ab];O[0]=Math.min(k,O[0]),O[1]=Math.max(F,O[1]),O[2]=Math.min(A,O[2]),O[3]=Math.max(M,O[3])}let _=g.a[0]+(c-g.a[2]),v=g.a[1]+(d-g.a[3]),E=g.b[0]+(c-g.b[2]),b=g.b[1]+(d-g.b[3]),T={stable:!1,aStart:_,aLength:v-_,aContent:t.slice(_,v),oStart:c,oLength:d-c,oContent:e.slice(c,d),bStart:E,bLength:b-E,bContent:i.slice(E,b)};n.push(T)}o=d}return a(e.length),n}function QD(t,e,i,r){r=Object.assign({excludeFalseConflicts:!0,stringSeparator:/\s+/},r),typeof t=="string"&&(t=t.split(r.stringSeparator)),typeof e=="string"&&(e=e.split(r.stringSeparator)),typeof i=="string"&&(i=i.split(r.stringSeparator));let n=[],o=pW(t,e,i),a=[];function l(){a.length&&n.push({ok:a}),a=[]}function c(d,m){if(d.length!==m.length)return!1;for(let g=0;g<d.length;g++)if(d[g]!==m[g])return!1;return!0}return o.forEach(d=>{d.stable?a.push(...d.bufferContent):r.excludeFalseConflicts&&c(d.aContent,d.bContent)?a.push(...d.aContent):(l(),n.push({conflict:{a:d.aContent,aIndex:d.aStart,o:d.oContent,oIndex:d.oStart,b:d.bContent,bIndex:d.bStart}}))}),l(),n}function Z2(t,e={}){var b,T,A,M;let i=e.localGraph,r=e.remoteGraph,s=(b=e.discardTags)!=null?b:{},n=(T=e.formatUser)!=null?T:k=>k,o=(A=e.localize)!=null?A:k=>k,a=(M=e.strategy)!=null?M:"safe",l=[];function c(k,F){return a==="force_local"||Zi(F.loc,k.loc,1e-6)?F:a==="force_remote"?F.update({loc:k.loc}):(l.push(o("merge_remote_changes.conflict.location",{user:n(k.user)})),F)}function d(k,F,O){if(a==="force_local"||(0,Y2.default)(O.nodes,F.nodes))return O;if(a==="force_remote")return O.update({nodes:F.nodes});let B=l.length,U=k.nodes||[],z=O.nodes||[],Z=F.nodes||[],W=QD(z,U,Z,{excludeFalseConflicts:!0}),q=[];for(let Q of W)if(Q.ok)q.push.apply(q,Q.ok);else{let V=Q.conflict;if((0,Y2.default)(V.o,V.a))q.push.apply(q,V.b);else if((0,Y2.default)(V.o,V.b))q.push.apply(q,V.a);else{l.push(o("merge_remote_changes.conflict.nodelist",{user:n(F.user)}));break}}return l.length===B?O.update({nodes:q}):O}function m(k,F,O,B){function U(Z,W){let q=B.parentWays(Z).some(Q=>Q.id!==W.id);return Z.hasInterestingTags()||q||B.parentRelations(Z).length>0}let z=l.length;for(let Z of F){let W=B.hasEntity(Z);if(k.nodes.indexOf(Z)===-1){W&&!U(W,k)&&O.removeIDs.push(Z);continue}let q=i.hasEntity(Z),Q=r.hasEntity(Z),V;if(a==="force_remote"&&Q&&Q.visible)O.replacements.push(Q);else if(a==="force_local"&&q)V=Dt(q),Q&&(V=V.update({version:Q.version})),O.replacements.push(V);else if(a==="safe"&&q&&Q&&q.version!==Q.version){if(V=Dt(q,{version:Q.version}),Q.visible?V=c(Q,V):l.push(o("merge_remote_changes.conflict.deleted",{user:n(Q.user)})),l.length!==z)break;O.replacements.push(V)}}return k}function g(k,F){for(let O of k.replacements)F=F.replace(O);return k.removeIDs.length&&(F=Zu(k.removeIDs)(F)),F}function _(k,F){return a==="force_local"||(0,Y2.default)(F.members,k.members)?F:a==="force_remote"?F.update({members:k.members}):(l.push(o("merge_remote_changes.conflict.memberlist",{user:n(k.user)})),F)}function v(k,F,O){var de,ne,ee;if(a==="force_local"||(0,Y2.default)(O.tags,F.tags))return O;if(a==="force_remote")return O.update({tags:F.tags});let B=l.length,U=(de=k.tags)!=null?de:{},z=(ne=O.tags)!=null?ne:{},Z=(ee=F.tags)!=null?ee:{},W=as(as(Object.keys(U),Object.keys(z)),Object.keys(Z)).filter(function(re){return!s[re]}),q=Object.assign({},z),Q=!1;for(var V=0;V<W.length;V++){var le=W[V];U[le]!==Z[le]&&z[le]!==Z[le]&&(U[le]!==z[le]?l.push(o("merge_remote_changes.conflict.tags",{tag:le,local:z[le],remote:Z[le],user:n(F.user)})):(Z.hasOwnProperty(le)?q[le]=Z[le]:delete q[le],Q=!0))}return Q&&l.length===B?O.update({tags:q}):O}let E=function(k){let F={replacements:[],removeIDs:[]},O=k.base.entities.get(t),B=i.entity(t),U=r.entity(t),z=Dt(B,{version:U.version});return U.visible?(z.type==="node"?z=c(U,z):z.type==="way"?(k.rebase(r.childNodes(U),[k],!1),z=d(O,U,z),z=m(z,as(B.nodes,U.nodes),F,k)):z.type==="relation"&&(z=_(U,z)),z=v(O,U,z),l.length||(k=g(F,k).replace(z)),k):a==="force_remote"?Zu([t])(k):a==="force_local"?(z.type==="way"&&(z=m(z,Ei(B.nodes),F,k),k=g(F,k)),k.replace(z)):(l.push(o("merge_remote_changes.conflict.deleted",{user:n(U.user)})),k)};return E.conflicts=function(){return l},E}function js(t,e,i,r){for(var s=Xi,n=t.map(function(T){return i.project(T.loc)}),o=t.map(function(T){return T.id}),a=1/0,l,c,d=0;d<n.length-1;d++)if(!(o[d]===r||o[d+1]===r)){var m=n[d],g=sr(n[d+1],m),_=sr(e,m),v=_l(_,g)/_l(g,g),E;v<0?E=m:v>1?E=n[d+1]:E=[m[0]+v*g[0],m[1]+v*g[1]];var b=s(E,e);b<a&&(a=b,l=d+1,c=i.invert(E))}return l!==void 0?{index:l,distance:a,loc:c}:null}function KD(t,e,i){var r=[],s=[],n,o,a,l,c;for(n=0;n<t.length-1;n++)a=t[n],l=t[n+1],c=[a.loc,l.loc],(a.id===i||l.id===i)&&r.push(c);for(n=0;n<e.length-1;n++)a=e[n],l=e[n+1],c=[a.loc,l.loc],s.push(c);for(n=0;n<r.length;n++)for(o=0;o<s.length;o++){var d=r[n],m=s[o],g=Ru(d,m);if(g)return!0}return!1}function Bd(t,e){var i=[],r=[],s,n;for(s=0;s<t.length-1;s++){var o=t[s],a=t[s+1],l=[o.loc,a.loc];o.id===e||a.id===e?i.push(l):r.push(l)}for(s=0;s<i.length;s++)for(n=0;n<r.length;n++){var c=i[s],d=r[n];if(!(Zi(c[1],d[0])||Zi(c[0],d[1])||Zi(c[0],d[0])||Zi(c[1],d[1]))){var m=Ru(c,d);if(m){var g=1e-8;if(Zi(c[1],m,g)||Zi(c[0],m,g)||Zi(d[1],m,g)||Zi(d[0],m,g))continue;return!0}}}return!1}function Ud(t,e,i){return Zi(i,t)||Zi(i,e)?1:R8(t,e,i)}function JD(t,e,i,r,s){var n=Math.abs(t);return n<e||s&&Math.abs(n-1)<e?0:n<i||n>r?t:null}function $g(t,e,i,r){for(var s=0,n=e?0:1,o=e?t.length:t.length-1,a=t.map(function(E){return E.coord}),l=Math.cos((90-r)*Math.PI/180),c=Math.cos(r*Math.PI/180),d=n;d<o;d++){var m=a[(d-1+a.length)%a.length],g=a[d],_=a[(d+1)%a.length],v=JD(Ud(m,_,g),i,l,c);v!==null&&(s=s+2*Math.min(Math.abs(v-1),Math.min(Math.abs(v),Math.abs(v+1))))}return s}function eF(t,e,i){for(var r=-1/0,s=e?0:1,n=e?t.length:t.length-1,o=s;o<n;o++){var a=t[(o-1+t.length)%t.length],l=t[o],c=t[(o+1)%t.length],d=Ud(a,c,l),m=Math.acos(Math.abs(d))*180/Math.PI;m>45&&(m=90-m),!(m>=i)&&m>r&&(r=m)}return r===-1/0?null:r}function Q2(t,e,i,r,s){for(var n=null,o=e?0:1,a=e?t.length:t.length-1,l=Math.cos((90-r)*Math.PI/180),c=Math.cos(r*Math.PI/180),d=o;d<a;d++){var m=t[(d-1+t.length)%t.length],g=t[d],_=t[(d+1)%t.length],v=JD(Ud(m,_,g),i,l,c,s);if(v!==null){if(Math.abs(v)>0)return 1;n=0}}return n}function Wc(t,e,i,r){var s=e;function n(g){function _(b){if(t.indexOf(b)!==-1)return!0;var T=g.parentWays(g.entity(b));if(T.length<3)return!0;var A=T.every(function(M){return r.moving[M.id]});return A||delete r.moving[b],A}function v(b){for(var T=0;T<b.length;T++){var A=b[T];if(!r.moving[A]){r.moving[A]=!0;var M=g.hasEntity(A);M&&(M.type==="node"?(r.nodes.push(A),r.startLoc[A]=M.loc):M.type==="way"?(r.ways.push(A),v(M.nodes)):v(M.members.map(function(k){return k.id})))}}}function E(b){function T(q,Q){return!q.isClosed()&&!!q.affix(Q)}for(var A=0;A<b.length;A++)for(var M=b[A],k=g.childNodes(g.entity(M)),F=0;F<k.length;F++){var O=k[F],B=g.parentWays(O);if(B.length===2){for(var U=g.entity(M),z=null,Z=0;Z<B.length;Z++){var W=B[Z];if(!r.moving[W.id]){z=W;break}}z&&(eo(U.nodes,z.nodes).length>2||U.isArea()||z.isArea()||r.intersections.push({nodeId:O.id,movedId:U.id,unmovedId:z.id,movedIsEP:T(U,O.id),unmovedIsEP:T(z,O.id)}))}}}r||(r={}),r.ok||(r.moving={},r.intersections=[],r.replacedVertex={},r.startLoc={},r.nodes=[],r.ways=[],v(t),E(r.ways),r.nodes=r.nodes.filter(_),r.ok=!0)}function o(g,_,v,E){var b=v.entity(_),T=v.entity(g),A=b.nodes.indexOf(g),M,k,F;b.isClosed()?(M=b.nodes.length-1,k=(A+M-1)%M,F=(A+M+1)%M):(M=b.nodes.length,k=A-1,F=A+1);var O=v.hasEntity(b.nodes[k]),B=v.hasEntity(b.nodes[F]);if(!O||!B)return v;var U=_+"_"+g,z=r.replacedVertex[U];z||(z=vi(),r.replacedVertex[U]=z,r.startLoc[z.id]=r.startLoc[g]);var Z,W;E?(Z=i.project(r.startLoc[g]),W=i.invert(Ir(Z,E))):W=r.startLoc[g],z=z.move(W);var q=i.project(z.loc),Q=i.project(O.loc),V=i.project(B.loc),le=Math.abs(fs(q,Q)-fs(q,V))*(180/Math.PI);if(le>175&&le<185)return v;var de=[O.loc,z.loc,T.loc,B.loc].map(ie=>i.project(ie)),ne=[O.loc,T.loc,z.loc,B.loc].map(ie=>i.project(ie)),ee=hw(de),re=hw(ne),te=ee<=re?A:F;return b.isClosed()&&te===0&&(te=M),b=b.addNode(z.id,te),v.replace(z).replace(b)}function a(g,_){var v=_.entity(g),E=1e-6,b,T;function A(k,F){return F.parentWays(k).length>1||F.parentRelations(k).length||k.hasInterestingTags()}for(var M=0;M<v.nodes.length;M++)T=_.entity(v.nodes[M]),b&&T&&Zi(b.loc,T.loc,E)&&(A(b,_)?A(T,_)||(v=v.removeNode(T.id),_=_.replace(v).remove(T)):(v=v.removeNode(b.id),_=_.replace(v).remove(b))),b=T;return _}function l(g,_){var v=_.entity(g.nodeId),E=_.entity(g.movedId),b=_.entity(g.unmovedId),T=g.movedIsEP,A=g.unmovedIsEP;if(T&&A)return _;var M=_.childNodes(E).filter(function(W){return W!==v}),k=_.childNodes(b).filter(function(W){return W!==v});E.isClosed()&&E.first()===v.id&&M.push(M[0]),b.isClosed()&&b.first()===v.id&&k.push(k[0]);var F=!T&&js(M,i.project(v.loc),i),O=!A&&js(k,i.project(v.loc),i),B;if(!T&&!A)for(var U=1e-6,z=10,Z=0;Z<z&&(B=yr(F.loc,O.loc,.5),F=js(M,i.project(B),i),O=js(k,i.project(B),i),!(Math.abs(F.distance-O.distance)<U));Z++);else T?B=O.loc:B=F.loc;return _=_.replace(v.move(B)),!T&&F.index!==E.nodes.indexOf(v.id)&&(E=E.removeNode(v.id).addNode(v.id,F.index),_=_.replace(E)),!A&&O.index!==b.nodes.indexOf(v.id)&&(b=b.removeNode(v.id).addNode(v.id,O.index),_=_.replace(b)),_}function c(g){for(var _=0;_<r.intersections.length;_++){var v=r.intersections[_];g=o(v.nodeId,v.movedId,g,s),g=o(v.nodeId,v.unmovedId,g,null),g=l(v,g),g=a(v.movedId,g),g=a(v.unmovedId,g)}return g}function d(g){function _(Z){return Ir(i.project(Z),s)}for(var v=0;v<r.intersections.length;v++){var E=r.intersections[v];if(!(E.movedIsEP&&E.unmovedIsEP)&&E.movedIsEP){for(var b=g.entity(E.nodeId),T=i.project(b.loc),A=Ir(T,s),M=g.childNodes(g.entity(E.movedId)),k=M.map(function(Z){return _(Z.loc)}),F=g.childNodes(g.entity(E.unmovedId)),O=F.map(function(Z){return i.project(Z.loc)}),B=D8(k,O),U=0;v<B.length;v++)if(!Zi(B[U],A)){var z=js(F,A,i);s=sr(i.project(z.loc),T)}}}}var m=function(g){if(s[0]===0&&s[1]===0)return g;n(g),r.intersections.length&&d(g);for(var _=0;_<r.nodes.length;_++){var v=g.entity(r.nodes[_]),E=i.project(v.loc),b=Ir(E,s);g=g.replace(v.move(i.invert(b)))}return r.intersections.length&&(g=c(g)),g};return m.delta=function(){return s},m}function Hg(t,e,i){return function(r){return r.replace(r.entity(t).moveMember(e,i))}}function qc(t,e){var i=function(r,s){(s===null||!isFinite(s))&&(s=1),s=Math.min(Math.max(+s,0),1);var n=r.entity(t);return r.replace(n.move(yr(n.loc,e,s)))};return i.transitionable=!0,i}function us(){return function(t){return t}}function fh(t,e,i,r,s){var n=s||1e-4,o=r||13,a=Math.cos((90-o)*Math.PI/180),l=Math.cos(o*Math.PI/180),c=function(m,g){(g===null||!isFinite(g))&&(g=1),g=Math.min(Math.max(+g,0),1);var _=m.entity(t);if(_=_.removeNode(""),_.tags.nonsquare){var v=Object.assign({},_.tags);delete v.nonsquare,_=_.update({tags:v})}m=m.replace(_);var E=_.isClosed(),b=m.childNodes(_).slice();if(E&&b.pop(),i!==void 0&&(b=d(b,i,E),b.length!==3))return m;var T={},A=[],M={i:0,dotp:1},k,F,O,B,U,z,Z;for(z=0;z<b.length;z++)k=b[z],T[k.id]=(T[k.id]||0)+1,A.push({id:k.id,coord:e.project(k.loc)});if(A.length===3){for(z=0;z<1e3&&(U=A.map(oe),A[M.i].coord=Ir(A[M.i].coord,U[M.i]),B=M.dotp,!(B<n));z++);k=m.entity(b[M.i].id),O=e.invert(A[M.i].coord),m=m.replace(k.move(yr(k.loc,O,g)))}else{var W=[],q=[];for(z=0;z<A.length;z++){F=A[z];var Q=0;if(E||z>0&&z<A.length-1){var V=A[(z-1+A.length)%A.length],le=A[(z+1)%A.length];Q=Math.abs(Ud(V.coord,le.coord,F.coord))}Q>l?W.push(F):q.push(F)}var de=ie(q),ne=ie(q);for(B=1/0,z=0;z<1e3;z++){for(U=q.map(oe),Z=0;Z<U.length;Z++)q[Z].coord=Ir(q[Z].coord,U[Z]);var ee=$g(q,E,n,o);if(ee<B&&(de=ie(q),B=ee),B<n)break}var re=de.map(function(fe){return fe.coord});for(E&&re.push(re[0]),z=0;z<de.length;z++)F=de[z],Zi(ne[z].coord,F.coord)||(k=m.entity(F.id),O=e.invert(F.coord),m=m.replace(k.move(yr(k.loc,O,g))));for(z=0;z<W.length;z++)if(F=W[z],!(T[F.id]>1))if(k=m.entity(F.id),g===1&&m.parentWays(k).length===1&&m.parentRelations(k).length===0&&!k.hasInterestingTags())m=Vc(k.id)(m);else{var te=dP(F.coord,re);te&&(O=e.invert(te.target),m=m.replace(k.move(yr(k.loc,O,g))))}}return m;function ie(fe){return fe.map(function(Re){return{id:Re.id,coord:[Re.coord[0],Re.coord[1]]}})}function oe(fe,Re,He){if(!E&&(Re===0||Re===He.length-1))return[0,0];if(T[He[Re].id]>1)return[0,0];var Je=He[(Re-1+He.length)%He.length].coord,ot=fe.coord,yt=He[(Re+1)%He.length].coord,bt=sr(Je,ot),at=sr(yt,ot),Te=2*Math.min(Xi(bt),Xi(at));bt=Lf(bt),at=Lf(at);var Ze=bt[0]*at[0]+bt[1]*at[1],xt=Math.abs(Ze);if(xt<a){M.i=Re,M.dotp=xt;var It=Lf(Ir(bt,at));return $o(It,.1*Ze*Te)}return[0,0]}};function d(m,g,_){for(var v=_?0:1,E=_?m.length:m.length-1,b=v;b<E;b++)if(m[b].id===g)return[m[(b-1+m.length)%m.length],m[b],m[(b+1)%m.length]];return[]}return c.disabled=function(m){var g=m.entity(t);g=g.removeNode(""),m=m.replace(g);var _=g.isClosed(),v=m.childNodes(g).slice();_&&v.pop();var E=!1;if(i!==void 0&&(E=!0,v=d(v,i,_),v.length!==3))return"end_vertex";var b=v.map(function(A){return e.project(A.loc)}),T=Q2(b,_,n,o,E);return T===null?"not_squarish":T===0?"square_enough":!1},c.transitionable=!0,c}function tF(t,e,i){return function(r){var s=r.entity(t.from.way),n=r.entity(t.to.way),o=t.via.node&&r.entity(t.via.node),a=t.via.ways&&t.via.ways.map(function(c){return r.entity(c)}),l=[];return l.push({id:s.id,type:"way",role:"from"}),o?l.push({id:o.id,type:"node",role:"via"}):a&&a.forEach(function(c){l.push({id:c.id,type:"way",role:"via"})}),l.push({id:n.id,type:"way",role:"to"}),r.replace(Ms({id:i,tags:{type:"restriction",restriction:e},members:l}))}}function pm(t){var e=function(i){var r=i.hasEntity(t),s=i.base.entities.get(t);return r&&!s&&(r.type==="node"&&i.parentWays(r).forEach(function(n){n=n.removeNode(t),i=i.replace(n),n.isDegenerate()&&(i=Cl(n.id)(i))}),i.parentRelations(r).forEach(function(n){n=n.removeMembersWithID(t),i=i.replace(n),n.isDegenerate()&&(i=gn(n.id)(i))})),i.revert(t)};return e}function Vg(t,e,i,r){var s=function(n){return n.update(function(o){ls(t,o).forEach(function(a){var l=Pu([r.project(a.loc)],i,e)[0];o=o.replace(a.move(r.invert(l)))})})};return s}function iF(t,e,i,r){return function(s){return s.update(function(n){let o,a;ls(t,n).forEach(function(l){o=r.project(l.loc),a=[o[0]-e[0],o[1]-e[1]],o=[e[0]+i*a[0],e[1]+i*a[1]],n=n.replace(l.move(r.invert(o)))})})}}function jg(t,e){function i(n,o,a){return _l(n,a,o)/_l(a,a,o)}function r(n){var o=Of(n),a=[(o.poly[0][0]+o.poly[1][0])/2,(o.poly[0][1]+o.poly[1][1])/2],l=[(o.poly[2][0]+o.poly[3][0])/2,(o.poly[2][1]+o.poly[3][1])/2],c=[(o.poly[3][0]+o.poly[4][0])/2,(o.poly[3][1]+o.poly[4][1])/2],d=[(o.poly[1][0]+o.poly[2][0])/2,(o.poly[1][1]+o.poly[2][1])/2],m=Xi(a,l)>Xi(c,d);return m?[a,l]:[c,d]}var s=function(n,o){(o===null||!isFinite(o))&&(o=1),o=Math.min(Math.max(+o,0),1);for(var a=t.map(function(A){return n.entity(A)}),l=a.map(function(A){return e.project(A.loc)}),c=r(l),d=c[0],m=c[1],g=0;g<l.length;g++){var _=a[g],v=l[g],E=i(v,d,m),b=yr(d,m,E),T=e.invert(b);n=n.replace(_.move(yr(_.loc,T,o)))}return n};return s.disabled=function(n){for(var o=t.map(function(T){return n.entity(T)}),a=o.map(function(T){return e.project(T.loc)}),l=r(a),c=l[0],d=l[1],m=0,g=0;g<a.length;g++){var _=a[g],v=i(_,c,d),E=yr(c,d,v),b=Xi(E,_);!isNaN(b)&&b>m&&(m=b)}if(m<1e-4)return"straight_enough"},s.transitionable=!0,s}function Xg(t,e){function i(o,a,l){return _l(o,l,a)/_l(l,l,a)}function r(o){for(var a=[],l=[],c=[],d=[],m=t.filter(function(F){return o.entity(F).type==="way"}),g=t.filter(function(F){return o.entity(F).type==="node"}),_=0;_<m.length;_++){var v=o.entity(m[_]);a=v.nodes.slice(0),d.push(a),l.push(a[0]),c.push(a[a.length-1])}l=l.filter(function(F){return l.indexOf(F)===l.lastIndexOf(F)}),c=c.filter(function(F){return c.indexOf(F)===c.lastIndexOf(F)});var E=Sn(l,c).concat(Sn(c,l))[0],b=[];a=[];for(var T=function(F,O){return O.filter(function(B){return B[0]===F||B[B.length-1]===F})[0]};d.length;)b=T(E,d),d=Sn(d,[b]),b[0]!==E&&b.reverse(),a=a.concat(b),E=a[a.length-1];if(g.length===2){var A=a.indexOf(g[0]),M=a.indexOf(g[1]),k=[A,M];k.sort(function(F,O){return F-O}),a=a.slice(k[0],k[1]+1)}return a.map(function(F){return o.entity(F)})}function s(o,a){return a.parentWays(o).length>1||a.parentRelations(o).length||o.hasInterestingTags()}var n=function(o,a){(a===null||!isFinite(a))&&(a=1),a=Math.min(Math.max(+a,0),1);var l=r(o),c=l.map(function(M){return e.project(M.loc)}),d=c[0],m=c[c.length-1],g=[],_;for(_=1;_<c.length-1;_++){var v=l[_],E=c[_];if(a<1||s(v,o)){var b=i(E,d,m),T=yr(d,m,b),A=e.invert(T);o=o.replace(v.move(yr(v.loc,A,a)))}else g.indexOf(v)===-1&&g.push(v)}for(_=0;_<g.length;_++)o=Vc(g[_].id)(o);return o};return n.disabled=function(o){var a=r(o),l=a.map(function(M){return e.project(M.loc)}),c=l[0],d=l[l.length-1],m=.2*Xi(c,d),g;if(m===0)return"too_bendy";var _=0;for(g=1;g<l.length-1;g++){var v=l[g],E=i(v,c,d),b=yr(c,d,E),T=Xi(b,v);if(isNaN(T)||T>m)return"too_bendy";T>_&&(_=T)}var A=a.every(function(M,k){return k===0||k===a.length-1||s(M,o)});if(_<1e-4&&A)return"straight_enough"},n.transitionable=!0,n}function rF(t){return function(e){return gn(t.restrictionID)(e)}}function Wg(t,e){var i=!0,r=function(s,n){(n===null||!isFinite(n))&&(n=1),n=Math.min(Math.max(+n,0),1);var o=ls(t,s),a=o.map(function(z){return e.project(z.loc)}),l=Of(a),c=[(l.poly[0][0]+l.poly[1][0])/2,(l.poly[0][1]+l.poly[1][1])/2],d=[(l.poly[2][0]+l.poly[3][0])/2,(l.poly[2][1]+l.poly[3][1])/2],m=[(l.poly[3][0]+l.poly[4][0])/2,(l.poly[3][1]+l.poly[4][1])/2],g=[(l.poly[1][0]+l.poly[2][0])/2,(l.poly[1][1]+l.poly[2][1])/2],_,v,E=Xi(c,d)>Xi(m,g);i&&E||!i&&!E?(_=c,v=d):(_=m,v=g);for(var b=v[0]-_[0],T=v[1]-_[1],A=(b*b-T*T)/(b*b+T*T),M=2*b*T/(b*b+T*T),k=0;k<o.length;k++){var F=o[k],O=e.project(F.loc),B=[A*(O[0]-_[0])+M*(O[1]-_[1])+_[0],M*(O[0]-_[0])-A*(O[1]-_[1])+_[1]],U=e.invert(B);F=F.move(yr(F.loc,U,n)),s=s.replace(F)}return s};return r.useLongAxis=function(s){return arguments.length?(i=s,r):i},r.transitionable=!0,r}function qg(t,e,i){return function(r){var s=r.entity(t),n=Object.assign({},s.tags),o,a;for(var l in e)if(l in n)if(e[l]==="*")o=n[l],delete n[l];else if(e[l]===n[l])delete n[l];else{var c=n[l].split(";").filter(Boolean),d=c.indexOf(e[l]);c.length===1||d===-1?delete n[l]:(i&&i[l]&&(a=d),c.splice(d,1),n[l]=c.join(";"))}if(i)for(var m in i){var g=i[m];if(g==="*"){if(n[m]&&n[m]!=="no")continue;n[m]="yes"}else if(g==="$1")n[m]=o;else if(n[m]&&e[m]&&a!==void 0){var _=n[m].split(";").filter(Boolean);_.indexOf(g)===-1&&(_.splice(a,0,g),n[m]=_.join(";"))}else n[m]=g}return r.replace(s.update({tags:n}))}}function mW(t,e,i,r,s){var n=Math.abs(r.loc[0]-s.loc[0])>Math.abs(r.loc[1]-s.loc[1]),o=n?function(b,T){return r.loc[0]<s.loc[0]?b.loc[0]-T.loc[0]:T.loc[0]-b.loc[0]}:function(b,T){return r.loc[1]<s.loc[1]?b.loc[1]-T.loc[1]:T.loc[1]-b.loc[1]},a=i.nodes,l=a.indexOf(r.id),c=a.indexOf(s.id);if(l===-1||c===-1||l>=c||o(r,s)>=0)return null;for(var d=l+1;d<c&&o(e,t.entity(a[d]))>0;)d++;var m=t.entity(a[d-1]).loc,g=t.entity(a[d]).loc,_=e.loc,v=Math.abs(m[0]-g[0])>Math.abs(m[1]-g[1])?(_[0]-m[0])/(g[0]-m[0]):(_[1]-m[1])/(g[1]-m[1]),E=yr(m,g,v);return{insertIdx:d,interpLoc:E}}function KE(t,e){return Math.abs(t[0]-e[0])>2e-5||Math.abs(t[1]-e[1])>2e-5}function Yg(t){delete t.__fbid__,delete t.__origid__,delete t.__service__,delete t.__datasetid__,delete t.tags.conn,delete t.tags.dupe}function Zg(t,e){return function(i){var r={},s=e.entity(t);return s.type==="node"?n(s):s.type==="way"?o(s):s.type==="relation"&&a(s),i;function n(l){var c=vi(l);return c.tags=Object.assign({},c.tags),Yg(c),i=i.replace(c),c}function o(l){var c=Mr(l);c.nodes=l.nodes.slice(),c.tags=Object.assign({},c.tags),Yg(c);var d=c.nodes.map(function(m){var g=vi(e.entity(m));g.tags=Object.assign({},g.tags);var _=g.tags.conn&&g.tags.conn.split(","),v=g.tags.dupe;if(Yg(g),v&&i.hasEntity(v)&&!KE(i.entity(v).loc,g.loc)?g=i.entity(v):i.hasEntity(g.id)&&KE(i.entity(g.id).loc,g.loc)&&(g=vi({loc:g.loc})),_&&i.hasEntity(_[0])){var E=i.hasEntity(_[0]),b=i.hasEntity(_[1]),T=i.hasEntity(_[2]);if(E&&b&&T){var A=mW(i,g,E,b,T);A&&!KE(A.interpLoc,g.loc)&&(g.loc=A.interpLoc,i=i.replace(E.addNode(g.id,A.insertIdx)))}}return i=i.replace(g),g.id});return c=c.update({nodes:d}),i=i.replace(c),c}function a(l){var c=r[l.id];if(c)return c;var d=Ms(l);d.members=l.members.slice(),d.tags=Object.assign({},l.tags),Yg(d);var m=d.members.map(function(g){var _=e.entity(g.id),v;return _.type==="node"?v=n(_):_.type==="way"?v=o(_):_.type==="relation"&&(v=a(_)),Object.assign(g,{id:v.id})});return d=d.update({members:m}),i=i.replace(d),r[l.id]=d,d}}}var on=class extends sn.default{constructor(e){super(),this.context=e,this.id="",this._enabled=!1}enable(){this._enabled||(this._enabled=!0)}disable(){this._enabled&&(this._enabled=!1)}get enabled(){return this._enabled}_getEventData(e){var n,o;let i={id:(o=(n=e.pointerId)!=null?n:e.pointerType)!=null?o:"unknown",event:e,originalEvent:e.originalEvent,coord:[e.global.x,e.global.y],time:e.timeStamp,isCancelled:!1,target:null};if(!e.target)return i;let r=e.target,s=r==null?void 0:r.__feature__;return s?(i.target={displayObject:r,feature:s,featureID:s.id,layer:s.layer,layerID:s.layer.id,data:s.data,dataID:s.dataID},i):(r=e.target.parent,s=r==null?void 0:r.__feature__,s?(i.target={displayObject:r,feature:s,featureID:s.id,layer:s.layer,layerID:s.layer.id,data:s.data,dataID:s.dataID},i):(i.target={displayObject:e.target,feature:null,featureID:null,layer:null,layerID:null,data:null,dataID:null},i))}};var gW=1,yW=4,mm=class extends on{constructor(e){super(e),this.id="drag",this.dragTarget=null,this.lastDown=null,this.lastMove=null,this._doMove=this._doMove.bind(this),this._pointercancel=this._pointercancel.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.lastDown=null,this.lastMove=null,this.dragTarget=null;let e=this.context.systems.map.renderer.events;e.on("modifierchange",this._doMove),e.on("pointerover",this._doMove),e.on("pointerout",this._doMove),e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup),e.on("pointercancel",this._pointercancel)}disable(){if(!this._enabled)return;let e=this.lastMove;e&&this.dragTarget&&(e.target=null,this.dragTarget.feature.active=!1,this.emit("cancel",e)),this._enabled=!1,this.lastDown=null,this.lastMove=null,this.dragTarget=null;let i=this.context.systems.map.renderer.events;i.off("modifierchange",this._doMove),i.off("pointerover",this._doMove),i.off("pointerout",this._doMove),i.off("pointerdown",this._pointerdown),i.off("pointermove",this._pointermove),i.off("pointerup",this._pointerup),i.off("pointercancel",this._pointercancel)}_pointerdown(e){var o,a,l,c;if(this.lastDown||e.pointerType==="mouse"&&e.button!==0)return;let i=this._getEventData(e),r=((o=i.target)==null?void 0:o.data)instanceof vi,s=((l=(a=i.target)==null?void 0:a.data)==null?void 0:l.type)==="midpoint";(r||s)&&((c=i.target)==null?void 0:c.layerID)==="osm"&&(this.lastDown=i,this.lastMove=null,this.dragTarget=null)}_pointermove(e){let i=this.context.systems.map;if(i.supersurface.select(".edit-menu").size()){this._pointercancel(e);return}if(!i.renderer.events.pointerOverRenderer)return;let n=this.lastDown,o=this._getEventData(e);if(!(!n||n.id!==o.id)){if(this.lastMove=o,this.dragTarget)this._doMove();else if(n.target){let a=Xi(n.coord,o.coord),l=e.pointerType==="pen"?yW:gW;if(a>=l){let c=Object.assign({},n.target);this.dragTarget=c,c.feature.active=!0;let d=new Map().set(c.data.id,c.data),m=this.context.selectedIDs();this.context.enter("drag-node",{selection:d,reselectIDs:m}),this.emit("start",n)}}}}_pointerup(e){let i=this.lastDown,r=this._getEventData(e);!i||i.id!==r.id||(this.dragTarget&&(this._snappingDisabled()?r.target=null:r.target=Object.assign({},r.target)),this.lastDown=null,this.lastMove=null,this.dragTarget&&(this.dragTarget.feature.active=!1,this.dragTarget=null,this.emit("end",r)))}_pointercancel(e){let i=this._getEventData(e);this.lastDown=null,this.lastMove=null,this.dragTarget&&(this.dragTarget.feature.active=!1,this.dragTarget=null,this.emit("cancel",i))}_snappingDisabled(){let e=this.context.systems.map.renderer.events;if(!e.pointerOverRenderer)return!1;let i=e.modifierKeys;return i.has("Alt")||i.has("Control")||i.has("Meta")}_doMove(){if(!this._enabled||!this.lastMove)return;let e=Object.assign({},this.lastMove);this._snappingDisabled()&&(e.target=null),this.emit("move",e)}};var sF=4,nF=12,gm=class extends on{constructor(e){super(e),this.id="draw",this._spaceClickDisabled=!1,this.lastDown=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._doClick=this._doClick.bind(this),this._doMove=this._doMove.bind(this),this._keydown=this._keydown.bind(this),this._keyup=this._keyup.bind(this),this._pointercancel=this._pointercancel.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.lastDown=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._spaceClickDisabled=!1;let e=this.context.systems.map.renderer.events;e.on("keydown",this._keydown),e.on("keyup",this._keyup),e.on("modifierchange",this._doMove),e.on("pointerover",this._doMove),e.on("pointerout",this._doMove),e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup),e.on("pointercancel",this._pointercancel)}disable(){if(!this._enabled)return;this._enabled=!1,this.lastDown=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._spaceClickDisabled=!1;let e=this.context.systems.map.renderer.events;e.off("keydown",this._keydown),e.off("keyup",this._keyup),e.off("modifierchange",this._doMove),e.off("pointerover",this._doMove),e.off("pointerout",this._doMove),e.off("pointerdown",this._pointerdown),e.off("pointermove",this._pointermove),e.off("pointerup",this._pointerup),e.off("pointercancel",this._pointercancel)}_keydown(e){["Enter","Escape","Esc"].includes(e.key)?(e.preventDefault(),this.emit("finish")):["Backspace","Delete","Del"].includes(e.key)?(e.preventDefault(),this.emit("cancel")):!this._spaceClickDisabled&&[" ","Spacebar"].includes(e.key)&&(e.preventDefault(),e.stopPropagation(),this._spacebar())}_keyup(e){this._spaceClickDisabled&&[" ","Spacebar"].includes(e.key)&&(e.preventDefault(),e.stopPropagation(),this._spaceClickDisabled=!1)}_pointerdown(e){if(this.lastDown)return;let i=this._getEventData(e);this.lastDown=i,this.lastClick=null,this.emit("down",i)}_pointermove(e){let i=this._getEventData(e);this.lastMove=i,this._spaceClickDisabled&&this.lastSpace&&Xi(i.coord,this.lastSpace.coord)>nF&&(this._spaceClickDisabled=!1);let r=this.lastDown;r&&!r.isCancelled&&r.id===i.id&&Xi(r.coord,i.coord)>=sF&&(r.isCancelled=!0),this._doMove()}_pointerup(e){let i=this.lastDown,r=this._getEventData(e);if(!i||i.id!==r.id||(this.lastDown=null,i.isCancelled))return;let s=Xi(i.coord,r.coord);(s<sF||s<nF&&r.time-i.time<500)&&(this.lastClick=r,this._doClick())}_pointercancel(){this.lastDown=null}_spacebar(){this._spaceClickDisabled||this.lastMove&&(this._spaceClickDisabled=!0,this.lastSpace=this.lastMove,this.lastClick=this.lastMove,this._doClick())}_doMove(){if(!this._enabled||!this.lastMove)return;let i=this.context.systems.map.renderer.events;if(!i.pointerOverRenderer)return;let r=i.modifierKeys,s=r.has("Alt")||r.has("Control")||r.has("Meta"),n=Object.assign({},this.lastMove);(s||!1)&&(n.target=null),this.emit("move",n)}_doClick(){if(!this._enabled||!this.lastClick)return;let r=this.context.systems.map.renderer.events.modifierKeys,s=r.has("Alt")||r.has("Control")||r.has("Meta"),n=Object.assign({},this.lastClick);(s||!1)&&(n.target=null),this.emit("click",n)}};var ym=class extends on{constructor(e){super(e),this.id="hover",this.lastMove=null,this.hoverTarget=null,this._doHover=this._doHover.bind(this),this._pointermove=this._pointermove.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.lastMove=null,this.hoverTarget=null;let e=this.context.systems.map.renderer.events;e.on("modifierchange",this._doHover),e.on("pointerover",this._doHover),e.on("pointerout",this._doHover),e.on("pointermove",this._pointermove)}disable(){if(!this._enabled)return;let e=this.lastMove;this.hoverTarget&&e&&(e.target=null,this._doHover()),this._enabled=!1,this.lastMove=null,this.hoverTarget=null;let i=this.context.systems.map.renderer.events;i.off("modifierchange",this._doHover),i.off("pointerover",this._doHover),i.off("pointerout",this._doHover),i.off("pointermove",this._pointermove)}_pointermove(e){this._enabled&&(this.lastMove=this._getEventData(e),this._doHover())}_doHover(){var d,m;if(!this._enabled||!this.lastMove||this.context.behaviors["map-interaction"].gesture)return;let r=this.context.systems.map.renderer.events,s=r.modifierKeys,n=s.has("Alt")||s.has("Control")||s.has("Meta"),o=Object.assign({},this.lastMove);(n||!1||!r.pointerOverRenderer)&&(o.target=null);let l=((d=this.hoverTarget)==null?void 0:d.featureID)||null,c=((m=o==null?void 0:o.target)==null?void 0:m.featureID)||null;l!==c&&(this.hoverTarget=Object.assign({},o.target),this.emit("hoverchange",o))}};var Ar=class extends on{constructor(e,i){super(e),this.id=`key-${i.id}`,this._operation=i,window.mocha||(this._keybinding=this.context.keybinding()),this._keydown=this._keydown.bind(this)}enable(){if(this._enabled)return;let e=this._operation;e.available()&&e.keys&&(this._keybinding.on(e.keys,this._keydown),this._enabled=!0)}disable(){if(!this._enabled)return;this._enabled=!1;let e=this._operation;e.keys&&this._keybinding.off(e.keys)}_keydown(e){let i=this.context,r=this._operation;if(r.availableForKeypress&&!r.availableForKeypress())return;e.preventDefault(),r.disabled()?i.systems.ui.flash.duration(4e3).iconName(`#rapid-operation-${r.id}`).iconClass("operation disabled").label(r.tooltip)():(i.systems.ui.flash.duration(2e3).iconName(`#rapid-operation-${r.id}`).iconClass("operation").label(r.annotation()||r.title)(),r.point&&r.point(null),r())}};var _m=class extends on{constructor(e){super(e),this.id="lasso",this._lassoing=!1,this._extent=null,this._coords=[],this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this._lassoing=!1,this._extent=null;let e=this.context.systems.map.renderer.events;e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup)}disable(){if(!this._enabled)return;this._enabled=!1,this._lassoing=!1,this._extent=null;let e=this.context.systems.map.renderer.events;e.off("pointerdown",this._pointerdown),e.off("pointermove",this._pointermove),e.off("pointerup",this._pointerup)}_pointerdown(){let e=this.context.systems.map.renderer.events;if(!e.pointerOverRenderer)return;if(e.modifierKeys.has("Shift")){this._lassoing=!0;let s=this.context.systems.map.mouseLoc();this._extent=new mt(s),this._coords.push(s)}}_pointermove(){if(!this._lassoing||!this.context.systems.map.renderer.events.pointerOverRenderer)return;let i=this.context.systems.map.mouseLoc();this._extent=this._extent.extend(new mt(i)),this._coords.push(i);let r=this.context.scene().layers.get("map-ui");r.lassoPolygonData=this._coords,this.context.systems.map.immediateRedraw()}_pointerup(){if(!this._lassoing)return;this._lassoing=!1;let e=this.context.scene().layers.get("map-ui"),i=this._lassoed();this._coords=[],e.lassoPolygonData=this._coords,this._extent=null,i.length&&this.context.enter("select-osm",{selectedIDs:i})}_normalize(e,i){return[[Math.min(e[0],i[0]),Math.min(e[1],i[1])],[Math.max(e[0],i[0]),Math.max(e[1],i[1])]]}_lassoed(){let e=this.context.graph(),i=this.context,r=this._coords,s=i.systems.locations;if(!this.context.editable())return[];let n=this.context.systems.edits.intersects(this._extent).filter(o=>o.type==="node"&&Nf(o.loc,r)&&!i.systems.filters.isHidden(o,e,o.geometry(e))&&!s.blocksAt(o.loc).length);return n.sort(function(o,a){let l=e.parentWays(o),c=e.parentWays(a);if(l.length&&c.length){let d=eo(l,c);if(d.length){let m=d[0].nodes;return m.indexOf(o.id)-m.indexOf(a.id)}else return parseFloat(l[0].id.slice(1))-parseFloat(c[0].id.slice(1))}else if(l.length||c.length)return l.length-c.length;return o.loc[0]-a.loc[0]}),n.map(o=>o.id)}};var lF=256,_W=2,xW=24,oF=Fn(_W,lF),aF=Fn(xW,lF),vW=1,bW=4,xm=class extends on{constructor(e){super(e),this.id="map-interaction",this.lastDown=null,this.gesture=null,this.doubleClickEnabled=!0,this._click=this._click.bind(this),this._keydown=this._keydown.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this),this._pointercancel=this._pointercancel.bind(this),this._wheel=this._wheel.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.lastDown=null,this.gesture=null;let e=this.context.systems.map.renderer.events;e.on("click",this._click),e.on("keydown",this._keydown),e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup),e.on("pointercancel",this._pointercancel),e.on("wheel",this._wheel)}disable(){if(!this._enabled)return;this._enabled=!1,this.lastDown=null,this.gesture=null;let e=this.context.systems.map.renderer.events;e.off("click",this._click),e.off("keydown",this._keydown),e.off("pointerdown",this._pointerdown),e.off("pointermove",this._pointermove),e.off("pointerup",this._pointerup),e.off("pointercancel",this._pointercancel),e.off("wheel",this._wheel)}_keydown(e){var o,a;if(((a=(o=document.activeElement)==null?void 0:o.tagName)!=null?a:"BODY")!=="BODY")return;let s=this.context.systems.map,n=100;if(!e.shiftKey){let[c,d]=s.dimensions,m=e.altKey||e.metaKey||e.ctrlKey,g;e.key==="ArrowLeft"?g=m?[c/2,0]:[80,0]:e.key==="ArrowRight"?g=m?[-c/2,0]:[-80,0]:e.key==="ArrowUp"?g=m?[0,d/2]:[0,80]:e.key==="ArrowDown"&&(g=m?[0,-d/2]:[0,-80]),g&&(e.preventDefault(),s.pan(g,n))}}_click(e){if(!this.doubleClickEnabled||e.detail!==2||e.pointerType==="mouse"&&e.button!==0)return;function i(m,g,_){return Math.max(g,Math.min(m,_))}let[r,s]=[e.global.x,e.global.y],n=this.context.projection.transform(),o=e.getModifierState("Shift"),a=[(r-n.x)/n.k,(s-n.y)/n.k],l=n.k*(o?.5:2);l=i(l,oF,aF);let c=r-a[0]*l,d=s-a[1]*l;this.context.systems.map.transformEase({x:c,y:d,k:l})}_pointerdown(e){var n,o;if(this.lastDown)return;let i=this.context.systems.map.renderer.events;if(i.modifierKeys.has("Shift"))return;let r=this._getEventData(e);((n=r.target)==null?void 0:n.data)instanceof vi&&((o=r.target)==null?void 0:o.layerID)==="osm"&&e.pointerType==="mouse"&&e.button===0||(this.lastDown=r,this.gesture=null,i.setCursor("grabbing"))}_pointermove(e){let i=this.lastDown,r=this._getEventData(e);if(!(!i||i.id!==r.id)){if(!this.gesture){let s=Xi(i.coord,r.coord),n=i.originalEvent.pointerType==="pen"?bW:vW;this.was=[r.originalEvent.clientX,r.originalEvent.clientY],s>=n&&(this.gesture="pan")}if(this.gesture==="pan"){let s=r.originalEvent,n=this.context.projection.transform(),o=s.clientX-this.was[0],a=s.clientY-this.was[1];this.was=[s.clientX,s.clientY];let l={x:n.x+o,y:n.y+a,k:n.k};this.context.systems.map.transform(l)}}}_pointerup(e){let i=this.lastDown,r=this._getEventData(e);if(!i||i.id!==r.id)return;this.lastDown=null,this.gesture=null,this.context.systems.map.renderer.events.setCursor("inherit")}_pointercancel(){this.lastDown=null,this.gesture=null,this.context.systems.map.renderer.events.setCursor("inherit")}_wheel(e){let[i,r]=[e.offsetX,e.offsetY],[s,n]=[e._normalizedDeltaX,e._normalizedDeltaY],o=this.context.projection.transform(),a;function l(c,d,m){return Math.max(d,Math.min(c,m))}if(e._gesture==="zoom"){let c=(i-o.x)/o.k,d=(r-o.y)/o.k,m=o.k*Math.pow(2,-n/500);m=l(m,oF,aF);let g=i-c*m,_=r-d*m;a={x:g,y:_,k:m}}else a={x:o.x-s,y:o.y-n,k:o.k};this.context.systems.map.transform(a)}};var cF=.1,vm=class extends on{constructor(e){super(e),this.id="map-nudging",this._pointermove=this._pointermove.bind(this)}enable(){if(this._enabled)return;this.context.systems.map.renderer.events.on("pointermove",this._pointermove)}allow(){this._enabled=!0}disable(){if(!this._enabled)return;this._enabled=!1,this.context.systems.map.renderer.events.off("pointermove",this._pointermove)}_pointermove(e){if(!this._enabled)return;let i=[e.global.x,e.global.y],r=L8(i,this.context.systems.map.dimensions);if(r){let[s,n]=[r[0]*cF,r[1]*cF],o=this.context.projection.transform(),a={x:o.x+s,y:o.y+n,k:o.k};this.context.systems.map.transform(a)}}};var uF=Gs().os==="mac",bm=class extends on{constructor(e){super(e),this.id="paste",this._keydown=this._keydown.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.context.systems.map.renderer.events.on("keydown",this._keydown)}disable(){if(!this._enabled)return;this._enabled=!1,this.context.systems.map.renderer.events.off("keydown",this._keydown)}_keydown(e){(uF&&e.metaKey||!uF&&e.ctrlKey)&&e.key==="v"&&this._doPaste(e)}_doPaste(e){let i=this.context,r=i.copyIDs;if(!r.length)return;let s=i.systems.map.renderer.events;if(!s.pointerOverRenderer)return;e.preventDefault(),e.stopPropagation();let n=i.copyGraph,o=i.projection,a=z2(r,n);i.perform(a);let l=a.copies(),c=new mt,d=new Set,m=new Set;Object.values(l).forEach(A=>m.add(A.id));for(let A in l){let M=n.entity(A),k=l[A];c=c.extend(M.extent(n)),i.graph().parentWays(k).some(B=>m.has(B.id))||d.add(k.id)}let g=i.copyLoc,_=g&&o.project(g)||o.project(c.center()),v=s.coord||i.systems.map.centerPoint(),E=sr(v,_),b=i.t("operations.paste.annotation",{n:d.size});i.perform(Wc(Array.from(d),E,o),b);let T=new Map;for(let A of d)T.set(A,i.entity(A));i.enter("move",{selection:T})}};var JE=4,hF=12,wm=class extends on{constructor(e){super(e),this.id="select",this._multiSelection=new Set,this._spaceClickDisabled=!1,this._longPressTimeout=null,this._showsMenu=!1,this.lastDown=null,this.lastUp=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._cancelLongPress=this._cancelLongPress.bind(this),this._doLongPress=this._doLongPress.bind(this),this._keydown=this._keydown.bind(this),this._keyup=this._keyup.bind(this),this._pointercancel=this._pointercancel.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this._multiSelection.clear(),this._spaceClickDisabled=!1,this._longPressTimeout=null,this._showsMenu=!1,this.lastDown=null,this.lastUp=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null;let e=this.context.systems.map.renderer.events;e.on("keydown",this._keydown),e.on("keyup",this._keyup),e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup),e.on("pointercancel",this._pointercancel)}disable(){if(!this._enabled)return;this._enabled=!1,this._multiSelection.clear(),this._spaceClickDisabled=!1,this._longPressTimeout=null,this._showsMenu=!1,this.lastDown=null,this.lastUp=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._cancelLongPress();let e=this.context.systems.map.renderer.events;e.off("keydown",this._keydown),e.off("keyup",this._keyup),e.off("pointerdown",this._pointerdown),e.off("pointermove",this._pointermove),e.off("pointerup",this._pointerup),e.off("pointercancel",this._pointercancel)}_keydown(e){if(this._cancelLongPress(),e.key==="ContextMenu"){e.preventDefault(),this._doContextMenu();return}else if(!this._spaceClickDisabled&&[" ","Spacebar"].includes(e.key)){let i=document.activeElement;if(i&&new Set(["INPUT","TEXTAREA"]).has(i.nodeName))return;e.preventDefault(),e.stopPropagation(),this._spacebar()}}_keyup(e){this._spaceClickDisabled&&[" ","Spacebar"].includes(e.key)&&(e.preventDefault(),e.stopPropagation(),this._spaceClickDisabled=!1)}_pointerdown(e){if(this.lastDown)return;this.context.systems.ui.closeEditMenu(),this._showsMenu=!1;let i=this._getEventData(e);this.lastDown=i,this.lastClick=null,this._cancelLongPress(),e.pointerType==="touch"&&(this._longPressTimeout=window.setTimeout(this._doLongPress,750,i))}_pointermove(e){let i=this._getEventData(e);this.lastMove=i,this._spaceClickDisabled&&this.lastSpace&&Xi(i.coord,this.lastSpace.coord)>hF&&(this._spaceClickDisabled=!1);let r=this.lastDown;r&&!r.isCancelled&&r.id===i.id&&Xi(r.coord,i.coord)>=JE&&(r.isCancelled=!0)}_pointerup(e){var a,l,c,d,m;let i=this.lastDown,r=this._getEventData(e);if(!i||i.id!==r.id||(this.lastDown=null,i.isCancelled))return;let s=Xi(i.coord,r.coord),n=Xi(r.coord,this.lastUp?this.lastUp.coord:0);r.event.button===0&&((l=(a=this.lastUp)==null?void 0:a.target)!=null&&l.dataID)&&n<JE&&((d=(c=this.lastUp)==null?void 0:c.target)==null?void 0:d.dataID)===((m=r.target)==null?void 0:m.dataID)&&r.time-(this.lastUp?this.lastUp.time:0)<500?(this.lastClick=this.lastUp=r,this._doDoubleClick()):(s<JE||s<hF&&r.time-i.time<500)&&(this.lastClick=this.lastUp=r,i.originalEvent.button===2?(this.context.selectedIDs().includes(i.target.dataID)||this._doSelect(),this._doContextMenu()):this._doSelect())}_pointercancel(){this.lastDown=null}_spacebar(){this._spaceClickDisabled||this.lastMove&&(this._spaceClickDisabled=!0,this.lastSpace=this.lastMove,this.lastClick=this.lastMove,this._doSelect())}_doSelect(){var d;if(!this._enabled||!this.lastClick)return;this._cancelLongPress();let e=this.context,r=e.systems.map.renderer.events.modifierKeys,s=r.has("Alt")||r.has("Control")||r.has("Meta"),n=r.has("Shift"),o=Object.assign({},this.lastClick);s&&(o.target=null);let a=o.target,l=a==null?void 0:a.data,c=a==null?void 0:a.dataID;if(l){let m=this.context.behaviors["map-interaction"];m.doubleClickEnabled=!1,window.setTimeout(()=>m.doubleClickEnabled=!0,500)}if((l==null?void 0:l.type)==="midpoint"&&(l=l.way,c=l.id),!l){e.systems.photos.selectPhoto(null),((d=e.mode)==null?void 0:d.id)!=="browse"&&!this._multiSelection.size&&e.enter("browse");return}if(l.__fbid__||l.__featurehash__||l instanceof Nr||l instanceof Er){let m=new Map().set(c,l);e.enter("select",{selection:m});return}if(l instanceof Dt){let m=e.selectedIDs();n?m.includes(c)?this._showsMenu||(m=m.filter(g=>g!==c),e.enter("select-osm",{selectedIDs:m})):(m.push(c),e.enter("select-osm",{selectedIDs:m})):(!this._showsMenu||m.length<=1||!m.includes(c))&&e.enter("select-osm",{selectedIDs:[c]})}if(l.captured_at){let m=a.layerID;e.systems.map.centerEase(l.loc),e.systems.photos.selectPhoto(m,c)}if(l.first_seen_at){let m=e.services.mapillary;if(!(m!=null&&m.started))return;e.systems.map.centerEase(event.loc);let g=m.getActiveImage()&&m.getActiveImage().id;m.getDetectionsAsync(c).then(_=>{if(!_.length)return;let v=_[0].image.id;e.systems.photos.selectPhoto("mapillary",v)})}}_cancelLongPress(){this._longPressTimeout&&(window.clearTimeout(this._longPressTimeout),this._longPressTimeout=null,this._showsMenu=!1)}_doLongPress(e){this._longPressTimeout=null,this.lastDown===e&&!e.isCancelled&&(this.lastClick=e,e.isCancelled=!0,this._doSelect(),this._doContextMenu())}_doDoubleClick(){var o;if(!this._enabled||!this.lastUp)return;let e=this.context,i=this.lastUp.coord,r=(o=this.lastUp.target)==null?void 0:o.data,s=r instanceof Mr&&!r.__fbid__,n=r.type==="midpoint";if(s){let a=e.graph(),l=e.projection,c=l.invert(i),d=js(a.childNodes(r),i,l),m=[r.nodes[d.index-1],r.nodes[d.index]];e.perform(nn({loc:c,edge:m},vi()),e.t("operations.add.annotation.vertex")),e.systems.validator.validate()}else if(n){let a=[r.a.id,r.b.id];e.perform(nn({loc:r.loc,edge:a},vi()),e.t("operations.add.annotation.vertex")),e.systems.validator.validate()}}_doContextMenu(){if(!this._enabled||!this.lastClick)return;let e=this.context,r=e.systems.map.renderer.events.modifierKeys,s=r.has("Alt")||r.has("Control")||r.has("Meta"),n=Object.assign({},this.lastClick);s&&(n.target=null),this._showsMenu?(e.systems.ui.closeEditMenu(),this._showsMenu=!1):(this._showsMenu=!0,e.systems.ui.showEditMenu(n.coord))}};var uc={available:new Map};uc.available.set("drag",mm);uc.available.set("draw",gm);uc.available.set("hover",ym);uc.available.set("lasso",_m);uc.available.set("map-interaction",xm);uc.available.set("map-nudging",vm);uc.available.set("paste",bm);uc.available.set("select",wm);var fi=class extends sn.default{constructor(e){super(),this.context=e,this.id="",this.dependencies=new Set,this.autoStart=!0,this._started=!1}get started(){return this._started}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}};var Em=class extends fi{constructor(e){super(e),this.id="data",this.dependencies=new Set;let i=new Map;if(i.set("address_formats","data/address_formats.min.json"),i.set("deprecated","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.4/dist/deprecated.min.json"),i.set("discarded","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.4/dist/discarded.min.json"),i.set("imagery","data/imagery.min.json"),i.set("intro_graph","data/intro_graph.min.json"),i.set("intro_rapid_graph","data/intro_rapid_graph.min.json"),i.set("keepRight","data/keepRight.min.json"),i.set("languages","data/languages.min.json"),i.set("locales","locales/index.min.json"),i.set("oci_defaults","https://cdn.jsdelivr.net/npm/osm-community-index@5.6/dist/defaults.min.json"),i.set("oci_features","https://cdn.jsdelivr.net/npm/osm-community-index@5.6/dist/featureCollection.min.json"),i.set("oci_resources","https://cdn.jsdelivr.net/npm/osm-community-index@5.6/dist/resources.min.json"),i.set("phone_formats","data/phone_formats.min.json"),i.set("preset_categories","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.4/dist/preset_categories.min.json"),i.set("preset_defaults","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.4/dist/preset_defaults.min.json"),i.set("preset_fields","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.4/dist/fields.min.json"),i.set("preset_presets","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.4/dist/presets.min.json"),i.set("qa_data","data/qa_data.min.json"),i.set("shortcuts","data/shortcuts.min.json"),i.set("territory_languages","data/territory_languages.min.json"),i.set("wmf_sitematrix","https://cdn.jsdelivr.net/npm/wmf-sitematrix@0.1/wikipedia.min.json"),this.fileMap=i,this._cachedData={},this._inflight={},window.mocha){let r=this._cachedData;r.address_formats=[{format:[["housenumber","street"],["city","postcode"]]}],r.deprecated=[{old:{highway:"no"}},{old:{highway:"ford"},replace:{ford:"*"}}],r.discarded={},r.imagery=[],r.keepRight={},r.languages={de:{nativeName:"Deutsch"},en:{nativeName:"English"}},r.locales={en:{rtl:!1,pct:1}},r.locale_general_en={en:{}},r.locale_tagging_en={en:{}},r.locales_index_general={en:{rtl:!1,pct:1}},r.locales_index_tagging={en:{rtl:!1,pct:1}},r.phone_formats={},r.preset_categories={},r.preset_defaults={},r.preset_fields={},r.preset_presets={},r.qa_data={improveOSM:{},osmose:{}},r.shortcuts=[],r.territory_languages={},r.wmf_sitematrix=[["English","English","en"],["German","Deutsch","de"]]}}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}getDataAsync(e){if(this._cachedData[e])return Promise.resolve(this._cachedData[e]);let i=this.fileMap.get(e),r=i&&this.context.asset(i);if(!r)return Promise.reject(`Unknown data file for "${e}"`);let s=this._inflight[r];return s||(this._inflight[r]=s=fetch(r).then(Ai).then(n=>{if(delete this._inflight[r],!n)throw new Error(`No data loaded for "${e}"`);return this._cachedData[e]=n,n}).catch(n=>{throw delete this._inflight[r],n})),s}};function Ye(t,e=""){let i=t.replace("#","");return function(s){s.selectAll(`svg.icon-${i}`).data([i],n=>n).enter().append("svg").attr("class",`icon icon-${i}`+(e?` ${e}`:"")).append("use").attr("xlink:href",t)}}function Ts(t,e){let i=$i("modal"),r=t.select("div.modal"),s=r.empty();r.transition().duration(200).style("opacity",0).remove();let n=t.append("div").attr("class","shaded").style("opacity",0);n.close=()=>{n.transition().duration(200).style("opacity",0).remove(),o.transition().duration(200).style("top","0px"),ye(document).call(i.unbind)};let o=n.append("div").attr("class","modal fillL");return o.append("input").attr("class","keytrap keytrap-first").on("focus.keytrap",l),e||(n.on("click.remove-modal",c=>{c.target===this&&n.close()}),o.append("button").attr("class","close").on("click",n.close).call(Ye("#rapid-icon-close")),i.on("\u232B",n.close).on("\u238B",n.close),ye(document).call(i)),o.append("div").attr("class","content"),o.append("input").attr("class","keytrap keytrap-last").on("focus.keytrap",a),s?n.transition().style("opacity",1):n.style("opacity",1),n;function a(){let c=o.select("a, button, input:not(.keytrap), select, textarea").node();c?c.focus():ye(this).node().blur()}function l(){let c=o.selectAll("a, button, input:not(.keytrap), select, textarea").nodes();c.length?c[c.length-1].focus():ye(this).node().blur()}}function Yc(t){let e=ye(null),i="",r=!1,s=n=>{e=Ts(n,r);let o=e.select(".content").classed("loading-modal",!0).append("div").attr("class","modal-section fillL");return o.append("img").attr("class","loader").attr("src",t.asset("img/loader-white.gif")),o.append("h3").html(i),e.select("button.close").attr("class","hide"),s};return s.message=function(n){return arguments.length?(i=n,s):i},s.blocking=function(n){return arguments.length?(r=n,s):r},s.close=()=>{e.remove()},s.isShown=()=>e&&!e.empty()&&e.node().parentNode,s}var wW=150,Tm=class extends fi{constructor(e){super(e),this.id="edits",this.dependencies=new Set(["storage","map","rapid"]),this._mutex=GI("lock"),this._hasRestorableChanges=!1,this._imageryUsed=[],this._photosUsed=[],this._checkpoints={},this._pausedGraph=!1,this._stack=[],this._tree=null,this._index=0,this._initPromise=null,this.graph=this.graph.bind(this),this.pauseChangeDispatch=this.pauseChangeDispatch.bind(this),this.resumeChangeDispatch=this.resumeChangeDispatch.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let r of this.dependencies)if(!this.context.systems[r])return Promise.reject(`Cannot init:  ${this.id} requires ${r}`);this.reset();let e=this.context.systems.storage,i=e.initAsync();return this._initPromise=i.then(()=>{this._hasRestorableChanges=this._mutex.lock()&&e.hasItem(this._historyKey())})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this.reset(),Promise.resolve()}reset(){ye(document).interrupt("editTransition");let e=new Cn;this._stack=[{graph:e}],this._tree=new Qa(e),this._index=0,this._checkpoints={}}graph(){return this._stack[this._index].graph}tree(){return this._tree}base(){return this._stack[0].graph}peekAnnotation(){return this._stack[this._index].annotation}peekAllAnnotations(){let e=[];for(let i=0;i<=this._index;i++)this._stack[i].annotation&&e.push(this._stack[i].annotation);return e}merge(e,i){let r=this.base(),s=this.graph();i instanceof Set||(i=new Set(e.map(a=>a.id)));let n=new Set;for(let a of e)r.hasEntity(a.id)||n.add(a.id);for(let a of i){let l=s.hasEntity(a);if((l==null?void 0:l.type)==="relation")for(let c of l.members)n.has(c.id)&&l.touch()}let o=this._stack.map(a=>a.graph);r.rebase(e,o,!1),this._tree.rebase(e,!1),this.emit("merge",i)}perform(...e){ye(document).interrupt("editTransition");let i=e[0],r=!1;if((e.length===1||e.length===2&&typeof e[1]!="function")&&(r=!!i.transitionable),r)ye(document).transition("editTransition").duration(wW).ease(q3).tween("history.tween",()=>s=>{s<1&&this._overwrite([i],s)}).on("start",()=>{this._perform([i],0)}).on("end interrupt",()=>{this._overwrite(e,1)});else return this._perform(e)}replace(...e){return ye(document).interrupt("editTransition"),this._replace(e,1)}overwrite(...e){return ye(document).interrupt("editTransition"),this._overwrite(e,1)}pop(e){ye(document).interrupt("editTransition");let i=this._stack[this._index].graph;for((isNaN(+e)||+e<0)&&(e=1);e-- >0&&this._index>0;)this._index--,this._stack.pop();return this._change(i)}undo(){ye(document).interrupt("editTransition");let e=this._stack[this._index];for(;this._index>0&&(this._index--,!this._stack[this._index].annotation););return this.emit("undone",this._stack[this._index],e),this._change(e.graph)}redo(){ye(document).interrupt("editTransition");let e=this._stack[this._index],i=this._index;for(;i<this._stack.length-1;)if(i++,this._stack[i].annotation){this._index=i,this.emit("redone",this._stack[this._index],e);break}return this._change(e.graph)}pauseChangeDispatch(){this._pausedGraph||(this._pausedGraph=this._stack[this._index].graph)}resumeChangeDispatch(){if(this._pausedGraph){let e=this._pausedGraph;return this._pausedGraph=null,this._change(e)}}undoAnnotation(){let e=this._index;for(;e>=0;){if(this._stack[e].annotation)return this._stack[e].annotation;e--}}redoAnnotation(){let e=this._index+1;for(;e<=this._stack.length-1;){if(this._stack[e].annotation)return this._stack[e].annotation;e++}}intersects(e){return this._tree.intersects(e,this._stack[this._index].graph)}difference(){let e=this._stack[0].graph,i=this._stack[this._index].graph;return new Za(e,i)}changes(e){let i=this._stack[0].graph,r=this._stack[this._index].graph;e&&(r=e(r));let s=new Za(i,r);return{modified:s.modified(),created:s.created(),deleted:s.deleted()}}hasChanges(){return this.difference().changes.size>0}imageryUsed(e){if(e!==void 0)return this._imageryUsed=e,this;{let i=new Set;return this._stack.slice(1,this._index+1).forEach(function(r){var s;for(let n of(s=r.imageryUsed)!=null?s:[])n!=="Custom"&&i.add(n)}),Array.from(i)}}photosUsed(e){if(e!==void 0)return this._photosUsed=e,this;{let i=new Set;return this._stack.slice(1,this._index+1).forEach(function(r){var s;for(let n of(s=r.photosUsed)!=null?s:[])i.add(n)}),Array.from(i)}}setCheckpoint(e){return ye(document).interrupt("editTransition"),this._checkpoints[e]={stack:this._stack,index:this._index},this}resetToCheckpoint(e){if(ye(document).interrupt("editTransition"),e!==void 0&&this._checkpoints.hasOwnProperty(e)){let i=this._stack[this._index].graph;this._stack=this._checkpoints[e].stack,this._index=this._checkpoints[e].index;let r=this._stack[this._index].graph,s=new Za(i,r);this.emit("change",s)}}toIntroGraph(){let e={n:0,r:0,w:0},i={},r=this.graph(),s=new Map;for(let a of r.base.entities.values()){let l=o(a);s.set(l.id,l)}for(let[a,l]of r.local.entities)if(l){let c=o(l);s.set(c.id,c)}else s.delete(a);for(let a of s.values())Array.isArray(a.nodes)&&(a.nodes=a.nodes.map(l=>{var c;return(c=i[l])!=null?c:l})),Array.isArray(a.members)&&(a.members=a.members.map(l=>(l.id=i[l.id]||l.id,l)));let n={};for(let[a,l]of s)n[a]=l;return JSON.stringify({dataIntroGraph:n});function o(a){let l=dn(a,["type","user","v","version","visible"]);l.tags&&!Object.keys(l.tags)&&delete l.tags,Array.isArray(l.loc)&&(l.loc[0]=+l.loc[0].toFixed(6),l.loc[1]=+l.loc[1].toFixed(6));let c=a.id.match(/([nrw])-\d*/);if(c!==null){let d=c[1],m;do m=d+ ++e[d];while(s.has(m));i[a.id]=m,l.id=m}return l}}toJSON(){if(!this.hasChanges())return;let e=this.base(),i=new Map,r=new Map,s=[];for(let n of this._stack){let o=n.graph,a=[],l=[];for(let[d,m]of o.local.entities){if(m){let _=Dt.key(m);i.set(_,m),a.push(_)}else l.push(d);let g=e.hasEntity(d);if(g&&!r.has(d)&&r.set(d,g),m&&m.nodes)for(let _ of m.nodes){let v=e.hasEntity(_);v&&!r.has(v.id)&&r.set(v.id,v)}if(g)for(let _ of e.parentWays(g))r.has(_.id)||r.set(_.id,_)}let c={};a.length&&(c.modified=a),l.length&&(c.deleted=l),n.imageryUsed&&(c.imageryUsed=n.imageryUsed),n.photosUsed&&(c.photosUsed=n.photosUsed),n.annotation&&(c.annotation=n.annotation),n.transform&&(c.transform=n.transform),n.selectedIDs&&(c.selectedIDs=n.selectedIDs),s.push(c)}return JSON.stringify({version:3,entities:[...i.values()],baseEntities:[...r.values()],stack:s,nextIDs:Dt.id.next,index:this._index,timestamp:new Date().getTime()})}fromJSON(e,i){let r=this.context,s=r.systems.rapid,n=r.systems.map,o=this.base(),a=JSON.parse(e),l=!0;if(Dt.id.next=a.nextIDs,this._index=a.index,a.version!==2&&a.version!==3)throw new Error(`History version ${a.version} not supported.`);let c=new Map;for(let m of a.entities)c.set(Dt.key(m),Dt(m));if(a.version>=3){let m=a.baseEntities.map(_=>Dt(_)),g=this._stack.map(_=>_.graph);if(o.rebase(m,g,!0),this._tree.rebase(m,!0),i){let _=r.services.osm,b=m.filter(T=>T.type==="way").reduce(function(T,A){return as(T,A.nodes)},[]).filter(T=>!o.hasEntity(T));if(b.length&&_){l=!1,n.redrawEnabled=!1;let T=Yc(r).blocking(!0);r.container().call(T);let A=function(M,k){if(!M){let F=ds(k.data,"visible"),O=F.true||[],B=F.false||[];if(O.length){let U=O.map(Z=>Z.id),z=this._stack.map(Z=>Z.graph);b=Sn(b,U),o.rebase(O,z,!0),this._tree.rebase(O,!0)}B.forEach(function(U){_.loadEntityVersion(U.id,+U.version-1,A)})}(M||!b.length)&&(T.close(),n.redrawEnabled=!0,this.emit("change"),this.emit("restore"))};_.loadMultiple(b,A)}}}this._stack=a.stack.map((m,g)=>{var v;if(g===0)return this._stack[0];let _={};if(Array.isArray(m.modified)&&m.modified.forEach(E=>{let b=c.get(E);_[b.id]=b}),Array.isArray(m.deleted)&&m.deleted.forEach(E=>{_[E]=void 0}),s&&((v=m.annotation)==null?void 0:v.type)==="rapid_accept_feature"){let E=m.annotation.source;s.sources.add("mapwithai"),E&&/^esri/.test(E)&&s.sources.add("esri")}return{graph:new Cn(o).load(_),annotation:m.annotation,imageryUsed:m.imageryUsed,photosUsed:m.photosUsed,transform:m.transform,selectedIDs:m.selectedIDs}});let d=this._stack[this._index].transform;return d&&n.transform(d),l&&(this.emit("change"),this.emit("restore")),this}lock(){return this._mutex.lock()}unlock(){return this._mutex.unlock()}save(){if(!this._mutex.locked()||this._hasRestorableChanges)return;let e=this.context.systems.storage,i=this.toJSON();i?e.setItem(this._historyKey(),i)||this.emit("storage_error"):e.removeItem(this._historyKey())}clearSaved(){if(this.context.debouncedSave.cancel(),!this._mutex.locked())return;this._hasRestorableChanges=!1;let e=this.context.systems.storage;e.removeItem(this._historyKey()),e.removeItem("comment"),e.removeItem("hashtags"),e.removeItem("source")}savedHistoryJSON(){return this.context.systems.storage.getItem(this._historyKey())}hasRestorableChanges(){return this._hasRestorableChanges}restore(){if(this._mutex.locked()){this._hasRestorableChanges=!1;let e=this.savedHistoryJSON();e&&this.fromJSON(e,!0)}}_historyKey(){return"Rapid_"+window.location.origin+"_saved_history"}_act(e,i){let r=e.slice(),s;typeof r.at(-1)!="function"&&(s=r.pop());let n=this._stack[this._index].graph;for(let o of r)n=o(n,i);return{graph:n,annotation:s,imageryUsed:this._imageryUsed,photosUsed:this._photosUsed,transform:this.context.projection.transform(),selectedIDs:this.context.selectedIDs()}}_perform(e,i){let r=this._stack[this._index].graph;this._stack=this._stack.slice(0,this._index+1);let s=this._act(e,i);return this._stack.push(s),this._index++,this._change(r)}_replace(e,i){let r=this._stack[this._index].graph,s=this._act(e,i);return this._stack[this._index]=s,this._change(r)}_overwrite(e,i){let r=this._stack[this._index].graph;this._index>0&&(this._index--,this._stack.pop()),this._stack=this._stack.slice(0,this._index+1);let s=this._act(e,i);return this._stack.push(s),this._index++,this._change(r)}_change(e){let i=new Za(e,this.graph());return this._pausedGraph||this.emit("change",i),i}};var Qg={motorway:!0,motorway_link:!0,trunk:!0,trunk_link:!0,primary:!0,primary_link:!0,secondary:!0,secondary_link:!0,tertiary:!0,tertiary_link:!0,residential:!0,unclassified:!0,living_street:!0},Kg={busway:!0,service:!0,road:!0,track:!0},Jg={path:!0,footway:!0,cycleway:!0,bridleway:!0,steps:!0,pedestrian:!0},Yn=class{constructor(e){this.filter=e,this.enabled=!0,this.count=0}},Sm=class extends fi{constructor(e){super(e),this.id="filters",this.dependencies=new Set(["storage","urlhash"]),this._rules=new Map,this._hidden=new Set,this._forceVisible=new Set,this._cache={},this._initPromise=null,this._hashchange=this._hashchange.bind(this),this._rules.set("points",new Yn(this._isPoint.bind(this))),this._rules.set("traffic_roads",new Yn(this._isTrafficRoad.bind(this))),this._rules.set("service_roads",new Yn(this._isServiceRoad.bind(this))),this._rules.set("paths",new Yn(this._isPath.bind(this))),this._rules.set("buildings",new Yn(this._isBuilding.bind(this))),this._rules.set("building_parts",new Yn(this._isBuildingPart.bind(this))),this._rules.set("indoor",new Yn(this._isIndoor.bind(this))),this._rules.set("landuse",new Yn(this._isLanduse.bind(this))),this._rules.set("boundaries",new Yn(this._isBoundary.bind(this))),this._rules.set("water",new Yn(this._isWater.bind(this))),this._rules.set("rail",new Yn(this._isRail.bind(this))),this._rules.set("pistes",new Yn(this._isPiste.bind(this))),this._rules.set("aerialways",new Yn(this._isAerialway.bind(this))),this._rules.set("power",new Yn(this._isPower.bind(this))),this._rules.set("past_future",new Yn(this._isPastFuture.bind(this))),this._rules.set("others",new Yn(this._isOther.bind(this)))}initAsync(){if(this._initPromise)return this._initPromise;for(let s of this.dependencies)if(!this.context.systems[s])return Promise.reject(`Cannot init:  ${this.id} requires ${s}`);let e=this.context.systems.storage,i=this.context.systems.urlhash,r=Promise.all([e.initAsync(),i.initAsync()]);return this._initPromise=r.then(()=>{var n;i.on("hashchange",this._hashchange);let s=(n=i.getParam("disable_features"))!=null?n:e.getItem("disabled-features");if(s){let o=s.replace(/;/g,",").split(",").map(a=>a.trim()).filter(Boolean);for(let a of o){this._hidden.add(a);let l=this._rules.get(a);l.enabled=!1}}})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this._cache={},this._forceVisible.clear(),Promise.resolve()}get keys(){return[...this._rules.keys()]}get hidden(){return this._hidden}isEnabled(e){let i=this._rules.get(e);return i==null?void 0:i.enabled}enable(e){let i=this._rules.get(e);i&&!i.enabled&&(i.enabled=!0,this._update())}enableAll(){let e=!1;for(let i of this._rules.values())i.enabled||(e=!0,i.enabled=!0);e&&this._update()}disable(e){let i=this._rules.get(e);i&&i.enabled&&(i.enabled=!1,this._update())}disableAll(){let e=!1;for(let i of this._rules.values())i.enabled&&(e=!0,i.enabled=!1);e&&this._update()}toggle(e){let i=this._rules.get(e);i&&(i.enabled=!i.enabled,this._update())}resetStats(){for(let e of this._rules.values())e.count=0;this.emit("filterchange")}gatherStats(e,i){let r=ds(e,"type"),s=[].concat(r.relation||[],r.way||[],r.node||[]);for(let n of this._rules.values())n.count=0;for(let n of s){let o=n.geometry(i),a=Object.keys(this.getMatches(n,i,o));for(let l of a){let c=this._rules.get(l);c.count++}}}stats(){let e={};for(let[i,r]of this._rules)e[i]=r.count;return e}clear(e){for(let i of e)this.clearEntity(i)}clearEntity(e){let i=Dt.key(e);delete this._cache[i]}getMatches(e,i,r){if(r==="vertex")return{};if(r==="relation"&&e.tags.type!=="boundary")return{};let s=Dt.key(e);if(this._cache[s]||(this._cache[s]={}),!this._cache[s].matches){let n={},o=!1;for(let[a,l]of this._rules){if(a==="others"){if(o)continue;if(e.type==="way"){let c=this.getParents(e,i,r);if(c.length===1&&c[0].isMultipolygon()||c.length>0&&c.every(d=>d.tags.type==="boundary")){let d=Dt.key(c[0]);if(this._cache[d]&&this._cache[d].matches){n=Object.assign({},this._cache[d].matches);continue}}}}l.filter(e.tags,r)&&(n[a]=o=!0)}this._cache[s].matches=n}return this._cache[s].matches}getParents(e,i,r){if(r==="point")return[];let s=Dt.key(e);if(this._cache[s]||(this._cache[s]={}),!this._cache[s].parents){let n;r==="vertex"?n=i.parentWays(e):n=i.parentRelations(e),this._cache[s].parents=n}return this._cache[s].parents}isHiddenPreset(e,i){if(!this._hidden.size||!e.tags)return!1;let r=e.setTags({},i);for(let[s,n]of this._rules)if(n.filter(r,i))return this._hidden.has(s)?s:!1;return!1}isHiddenFeature(e,i,r){if(!this._hidden.size||!e.version||this._forceVisible.has(e.id))return!1;let s=Object.keys(this.getMatches(e,i,r));return s.length&&s.every(n=>this._hidden.has(n))}isHiddenChild(e,i,r){if(!this._hidden.size||!e.version||r==="point"||this._forceVisible.has(e.id))return!1;let s=this.getParents(e,i,r);if(!s.length)return!1;for(let n of s)if(!this.isHidden(n,i,n.geometry(i)))return!1;return!0}hasHiddenConnections(e,i){if(!this._hidden.size)return!1;let r,s;return e.type==="midpoint"?(r=[i.entity(e.edge[0]),i.entity(e.edge[1])],s=[]):(r=e.nodes?i.childNodes(e):[],s=this.getParents(e,i,e.geometry(i))),s=r.reduce((n,o)=>i.isShared(o)?as(n,i.parentWays(o)):n,s),s.some(n=>this.isHidden(n,i,n.geometry(i)))}isHidden(e,i,r){return!this._hidden.size||!e.version?!1:r==="vertex"?this.isHiddenChild(e,i,r):this.isHiddenFeature(e,i,r)}filter(e,i){if(!this._hidden.size)return e;var r=[];for(let s of e)this.isHidden(s,i,s.geometry(i))||r.push(s);return r}forceVisible(e){this._forceVisible=new Set;for(let i of e){this._forceVisible.add(i);let r=this.context.hasEntity(i);if((r==null?void 0:r.type)==="relation")for(let s of r.members)this._forceVisible.add(s.id)}}_hashchange(e,i){let r=e.get("disable_features"),s=i.get("disable_features");if(r!==s){let n=new Set;typeof r=="string"&&(n=new Set(r.replace(/;/g,",").split(",")));let o=!1;for(let[a,l]of this._rules)l.enabled&&n.has(a)?(l.enabled=!1,o=!0):!l.enabled&&!n.has(a)&&(l.enabled=!0,o=!0);o&&this._update()}}_update(){this._hidden=new Set;for(let[s,n]of this._rules)n.enabled||this._hidden.add(s);let e=[...this._hidden].join(",");this.context.systems.urlhash.setParam("disable_features",e.length?e:null),this.context.systems.storage.setItem("disabled-features",e),this.emit("filterchange")}_isPoint(e,i){return i==="point"}_isTrafficRoad(e){return Qg[e.highway]}_isServiceRoad(e){return Kg[e.highway]}_isPath(e){return Jg[e.highway]}_isBuilding(e){return!!e.building&&e.building!=="no"||e.parking==="multi-storey"||e.parking==="sheds"||e.parking==="carports"||e.parking==="garage_boxes"}_isBuildingPart(e){return e["building:part"]}_isIndoor(e){return e.indoor}_isLanduse(e,i){return i==="area"&&!this._isBuilding(e)&&!this._isBuildingPart(e)&&!this._isIndoor(e)&&!this._isWater(e)&&!this._isAerialway(e)}_isBoundary(e){return!!e.boundary&&!(Qg[e.highway]||Kg[e.highway]||Jg[e.highway]||e.waterway||e.railway||e.landuse||e.natural||e.building||e.power)}_isWater(e){return!!e.waterway||e.natural==="water"||e.natural==="coastline"||e.natural==="bay"||e.landuse==="pond"||e.landuse==="basin"||e.landuse==="reservoir"||e.landuse==="salt_pond"}_isRail(e){return(!!e.railway||e.landuse==="railway")&&!(Qg[e.highway]||Kg[e.highway]||Jg[e.highway])}_isPiste(e){return e["piste:type"]}_isAerialway(e){return e.aerialway&&e.aerialway!=="yes"&&e.aerialway!=="station"}_isPower(e){return!!e.power}_isPastFuture(e){if(Qg[e.highway]||Kg[e.highway]||Jg[e.highway])return!1;for(let i of Object.keys(e))if(F1[i]||F1[e[i]])return!0;return!1}_isOther(e,i){return i==="line"||i==="area"}};var wF=Yi(km(),1);var Mm=class extends fi{constructor(e){super(e),this.id="imagery",this.dependencies=new Set(["data","edits","l10n","map","urlhash"]),this._initPromise=null,this._imageryIndex=null,this._baseLayer=null,this._overlayLayers=new Map,this._checkedBlocklists=[],this._isValid=!0,this._brightness=1,this._contrast=1,this._saturation=1,this._sharpness=1,this._numGridSplits=0,this._hashchange=this._hashchange.bind(this),this.updateImagery=this.updateImagery.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let a of this.dependencies)if(!this.context.systems[a])return Promise.reject(`Cannot init:  ${this.id} requires ${a}`);let e=this.context,i=e.systems.data,r=e.systems.map,s=e.systems.storage,n=e.systems.urlhash,o=Promise.all([r.initAsync(),i.initAsync(),s.initAsync(),n.initAsync()]);return this._initPromise=o.then(()=>n.on("hashchange",this._hashchange)).then(()=>i.getDataAsync("imagery")).then(a=>this._initImageryIndex(a))}_initImageryIndex(e){let i=this.context;this._imageryIndex={features:new Map,sources:new Map,query:null};let r=e.map(l=>{if(!l.polygon)return null;let c=l.polygon.map(m=>[m]),d={type:"Feature",properties:{id:l.id},geometry:{type:"MultiPolygon",coordinates:c}};return this._imageryIndex.features.set(l.id.toLowerCase(),d),d}).filter(Boolean);this._imageryIndex.query=(0,wF.default)({type:"FeatureCollection",features:r});for(let l of e){let c;l.type==="bing"?c=new X2(i,l):/^EsriWorldImagery/.test(l.id)?c=new W2(i,l):c=new Il(i,l),this._imageryIndex.sources.set(l.id.toLowerCase(),c)}let s=new V2(i);this._imageryIndex.sources.set(s.id,s);let n=new j2(i),o=this.context.systems.storage;n.template=o.getItem("background-custom-template")||"",this._imageryIndex.sources.set(n.id,n);let a=this._imageryIndex.sources.get("mapbox_locator_overlay");a&&this.toggleOverlayLayer(a)}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context.systems.map,i=e.startAsync();return this._startPromise=i.then(()=>{e.scene.on("layerchange",this.updateImagery),this._started=!0})}resetAsync(){return Promise.resolve()}_hashchange(e,i){let r=e.get("background"),s=i.get("background");if(!r||r!==s){let c;typeof r=="string"&&(c=this.getSource(r)),c||(c=this.chooseDefaultSource()),this.baseLayerSource(c)}let n=e.get("overlays"),o=i.get("overlays");if(n!==o){let c=new Set;if(typeof n=="string"){let d=n.split(",").map(m=>m.trim().toLowerCase()).filter(Boolean);c=new Set(d)}this.enableOverlayLayers(c)}let a=e.get("offset"),l=i.get("offset");if(a!==l){let c,d;typeof a=="string"&&([c,d]=a.replace(/;/g,",").split(",").map(m=>m.trim()).map(Number)),(isNaN(c)||!isFinite(c))&&(c=0),(isNaN(d)||!isFinite(d))&&(d=0),this.offset=k8([c,d])}}updateImagery(){let e=this._baseLayer;if(this.context.inIntro||!e)return;let i=[],r=[],s=e.imageryUsed;s&&this._isValid&&i.push(s);let n=e.id;n==="custom"&&(n=`custom:${e.template}`);for(let m of this._overlayLayers.values())m.isLocatorOverlay()||(r.push(m.id),i.push(m.imageryUsed));this.context.systems.edits.imageryUsed(i);let o=this.context.systems.urlhash;o.setParam("background",n),o.setParam("overlays",r.length?r.join(","):null);let a=M8(e.offset),l=.01,c=+a[0].toFixed(2),d=+a[1].toFixed(2);o.setParam("offset",Math.abs(c)>l||Math.abs(d)>l?`${c},${d}`:null)}sources(e,i){var c;if(!this._imageryIndex)return[];let r=new Set;(this._imageryIndex.query.bbox(e.rectangle(),!0)||[]).forEach(d=>r.add(d.id));let s=this._baseLayer,n=[...this._imageryIndex.sources.values()],o=this.context.services.osm,a=(c=o==null?void 0:o.imageryBlocklists)!=null?c:[];if(a.length!==this._checkedBlocklists.length||a.some((d,m)=>String(d)!==this._checkedBlocklists[m])){for(let d of n)d.isBlocked=a.some(m=>m.test(d.template));this._checkedBlocklists=a.map(d=>String(d))}return n.filter(d=>s===d?!0:d.isBlocked?!1:d.polygon?i&&i<6?!1:r.has(d.id):!0)}baseLayerSource(e){var l;if(!arguments.length)return this._baseLayer;let i=this.context.services.osm;if(!i)return this;let r=(l=i==null?void 0:i.imageryBlocklists)!=null?l:[],s=e.template,n=!1,o=0,a;for(a of r)if(n=a.test(s),o++,n)break;return o||(a=/.*\.google(apis)?\..*\/(vt|kh)[\?\/].*([xyz]=.*){3}.*/,n=a.test(s)),this._baseLayer=n?this.getSource("none"):e,this.updateImagery(),this.emit("imagerychange"),this}chooseDefaultSource(){let e=this.context.systems.map,i=this.sources(e.extent(),e.zoom()),r=i[0],s=i.find(l=>l.best),o=this.context.systems.storage.getItem("background-last-used")||"none",a=o!=="none"&&this.getSource(o);return s||a||this.getSource("Bing")||r||this.getSource("none")}getSource(e){return this._imageryIndex?this._imageryIndex.sources.get(e.toLowerCase()):null}showsLayer(e){let i=this._baseLayer;return!e||!i?!1:e.id===i.id||this._overlayLayers.has(e.id)}overlayLayerSources(){return[...this._overlayLayers.values()]}toggleOverlayLayer(e){this._overlayLayers.has(e.id)?this._overlayLayers.delete(e.id):this._overlayLayers.set(e.id,e),this.updateImagery(),this.emit("imagerychange")}enableOverlayLayers(e){for(let[i,r]of this._overlayLayers)r.isLocatorOverlay()||this._overlayLayers.delete(i);for(let i of e){let r=this.getSource(i);r&&this._overlayLayers.set(r.id,r)}this.updateImagery(),this.emit("imagerychange")}nudge(e,i){this._baseLayer&&(this._baseLayer.nudge(e,i),this.updateImagery(),this.emit("imagerychange"))}get offset(){var e;return((e=this._baseLayer)==null?void 0:e.offset)||[0,0]}set offset([e,i]=[0,0]){var n;let[r,s]=((n=this._baseLayer)==null?void 0:n.offset)||[0,0];e===r&&i===s||this._baseLayer&&(this._baseLayer.offset=[e,i],this.updateImagery(),this.emit("imagerychange"))}get brightness(){return this._brightness}set brightness(e=1){var i;e!==this._brightness&&(this._brightness=e,(i=this.context.scene().layers.get("background"))==null||i.setBrightness(e),this.emit("imagerychange"))}get contrast(){return this._contrast}set contrast(e=1){var i;e!==this._contrast&&(this._contrast=e,(i=this.context.scene().layers.get("background"))==null||i.setContrast(e),this.emit("imagerychange"))}get saturation(){return this._saturation}set saturation(e=1){var i;e!==this._saturation&&(this._saturation=e,(i=this.context.scene().layers.get("background"))==null||i.setSaturation(e),this.emit("imagerychange"))}get sharpness(){return this._sharpness}set sharpness(e=1){var i;e!==this._sharpness&&(this._sharpness=e,(i=this.context.scene().layers.get("background"))==null||i.setSharpness(e),this.emit("imagerychange"))}get numGridSplits(){return this._numGridSplits}set numGridSplits(e=0){e!==this._numGridSplits&&(this._numGridSplits=e,this.emit("imagerychange"))}};function EF(t,e,i){let r=i-e;return((t-e)%r+r)%r+e}function TF(t,e,i){return Math.max(e,Math.min(t,i))}var Pm=class extends fi{constructor(e){super(e),this.id="l10n",this.dependencies=new Set(["data","presets","urlhash"]),this._supportedLanguages={},this._supportedLocales={},this._cache={},this._initPromise=null,this._preferredLocaleCodes=[],this._currLocaleCode="en-US",this._currLocaleCodes=["en-US","en"],this._currLanguageCode="en",this._currTextDirection="ltr",this._currIsMetric=!1,this._languageNames={},this._scriptNames={},this.t=this.t.bind(this),this.tHtml=this.tHtml.bind(this),this.tAppend=this.tAppend.bind(this)}localeCode(){return this._currLocaleCode}localeCodes(){return this._currLocaleCodes}languageCode(){return this._currLanguageCode}textDirection(){return this._currTextDirection}usesMetric(){return this._currIsMetric}languageNames(){return this._languageNames}scriptNames(){return this._scriptNames}isRTL(){return this._currTextDirection==="rtl"}set preferredLocaleCodes(e){typeof e=="string"?this._preferredLocaleCodes=e.split(/,|;| /gi).filter(Boolean):this._preferredLocaleCodes=e||[]}get preferredLocaleCodes(){return this._preferredLocaleCodes}initAsync(){if(this._initPromise)return this._initPromise;for(let n of this.dependencies)if(!this.context.systems[n])return Promise.reject(`Cannot init:  ${this.id} requires ${n}`);let e={general:"locales",tagging:"https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.4/dist/translations"},i=this.context.systems.data,r=this.context.systems.urlhash,s=Promise.all([i.initAsync(),r.initAsync()]);return this._initPromise=s.then(()=>{let n=["languages","locales"],o=i.fileMap;for(let a in e){let l=`locales_index_${a}`;o.has(l)||o.set(l,e[a]+"/index.min.json"),n.push(l)}return Promise.all(n.map(a=>i.getDataAsync(a)))}).then(n=>{this._supportedLanguages=n[0],this._supportedLocales=n[1];let o=r.initialHashParams.get("locale");o&&(this._preferredLocaleCodes=o.split(",").map(d=>d.trim()).filter(Boolean));let a=n.slice(2),l=(this._preferredLocaleCodes||[]).concat(Gs().browserLocales).concat(["en"]);this._currLocaleCodes=this._localesToUseFrom(l),this._currLocaleCode=this._currLocaleCodes[0];let c=[];return a.forEach((d,m)=>{this._currLocaleCodes.forEach(g=>{let _=Object.keys(e)[m],v=Object.values(e)[m];d[g]&&c.push(this.loadLocaleAsync(g,_,v))})}),Promise.all(c)}).then(()=>this._updateForCurrentLocale()).catch(n=>console.error(n))}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}loadLocaleAsync(e,i,r){if(e.toLowerCase()==="en-us"&&(e="en"),this._cache[i]&&this._cache[i][e])return Promise.resolve(e);let s=this.context.systems.data,n=s.fileMap,o=`locale_${i}_${e}`;return n.has(o)||n.set(o,`${r}/${e}.min.json`),s.getDataAsync(o).then(a=>(this._cache[i]||(this._cache[i]={}),this._cache[i][e]=a[e],e))}pluralRule(e,i=this._currLocaleCode){let r="Intl"in window&&Intl.PluralRules&&new Intl.PluralRules(i);return r?r.select(e):e===1?"one":"other"}_getString(e,i,r){let s=e.trim(),n="general";if(s[0]==="_"){let m=s.split(".");n=m[0].slice(1),s=m.slice(1).join(".")}r=r||this._currLocaleCode;let o=s.split(".").map(m=>m.replace(/<TX_DOT>/g,".")).reverse(),a=r;a.toLowerCase()==="en-us"&&(a="en");let l=this._cache[n]&&this._cache[n][a];for(;l!==void 0&&o.length;)l=l[o.pop()];if(l!==void 0){if(i){if(typeof l=="object"&&Object.keys(l).length){let m=Object.values(i).find(g=>typeof g=="number");if(m!==void 0){let g=this.pluralRule(m,r);l[g]?l=l[g]:l=Object.values(l)[0]}}if(typeof l=="string")for(let m in i){let g=i[m];typeof g=="number"&&(g.toLocaleString?g=g.toLocaleString(r,{style:"decimal",useGrouping:!0,minimumFractionDigits:0}):g=g.toString());let _=`{${m}}`,v=new RegExp(_,"g");l=l.replace(v,g)}}if(typeof l=="string")return{text:l,locale:r}}let c=this._currLocaleCodes.indexOf(r);if(c>=0&&c<this._currLocaleCodes.length-1){let m=this._currLocaleCodes[c+1];return this._getString(e,i,m)}if(i&&"default"in i)return{text:i.default,locale:null};let d=`Missing ${r} translation: ${e}`;return typeof console!="undefined"&&console.error(d),{text:d,locale:"en"}}hasTextForStringID(e){return!!this._getString(e,{default:"nothing found"}).locale}t(e,i,r){return this._getString(e,i,r).text}tHtml(e,i,r){let s=this._getString(e,i,r);return s.text?this.htmlForLocalizedText(s.text,s.locale):""}tAppend(e,i,r){let s=function(n){let o=this._getString(e,i,r);return n.append("span").attr("class","localized-text").attr("lang",o.locale||"und").text(((i==null?void 0:i.prefix)||"")+o.text+((i==null?void 0:i.suffix)||""))};return s.stringID=e,s}htmlForLocalizedText(e,i){return`<span class="localized-text" lang="${i||"unknown"}">${e}</span>`}languageName(e,i){if(this._languageNames[e])return this._languageNames[e];if(i&&i.localOnly)return null;let r=this._supportedLanguages[e];if(r){if(r.nativeName)return this.t("translate.language_and_code",{language:r.nativeName,code:e});if(r.base&&r.script){let s=r.base;if(this._languageNames[s]){let n=r.script,o=this._scriptNames[n]||n;return this.t("translate.language_and_code",{language:this._languageNames[s],code:o})}else if(this._supportedLanguages[s]&&this._supportedLanguages[s].nativeName)return this.t("translate.language_and_code",{language:this._supportedLanguages[s].nativeName,code:e})}}return e}displayName(e,i){var l,c,d;let r=this._currLanguageCode.toLowerCase(),s=e.route,n=(c=(l=e[`name:${r}`])!=null?l:e.name)!=null?c:"",o={name:n,direction:e.direction,from:e.from,network:i?void 0:(d=e.cycle_network)!=null?d:e.network,ref:e.ref,to:e.to,via:e.via};if(s&&o.ref&&o.name)return o.network?this.t("inspector.display_name.network_ref_name",o):this.t("inspector.display_name.ref_name",o);if(n)return n;let a=[];return o.network&&a.push("network"),o.ref&&a.push("ref"),s&&(o.direction?a.push("direction"):o.from&&o.to&&(a.push("from"),a.push("to"),o.via&&a.push("via"))),a.length?this.t("inspector.display_name."+a.join("_"),o):""}displayPOIName(e){var r,s,n,o,a,l;let i=this._currLanguageCode.toLowerCase();return(l=(a=(o=(n=(s=(r=e[`name:${i}`])!=null?r:e.name)!=null?s:e[`brand:${i}`])!=null?n:e.brand)!=null?o:e[`operator:${i}`])!=null?a:e.operator)!=null?l:""}displayType(e){return{n:this.t("inspector.node"),w:this.t("inspector.way"),r:this.t("inspector.relation")}[e.charAt(0)]}displayLabel(e,i,r){let s=this.displayName(e.tags),n=this.context.systems.presets,o=typeof i=="string"?n.matchTags(e.tags,i):n.match(e,i),a=o&&(o.suggestion?o.subtitle():o.name()),l;return r?l=[a,s].filter(Boolean).join(" "):l=s||a,l!=null?l:this.displayType(e.id)}displayLength(e,i){let r=this._currLocaleCode,s=e*(i?3.28084:1),n;return i?s>=5280?(s/=5280,n="miles"):n="feet":s>=1e3?(s/=1e3,n="kilometers"):n="meters",this.t(`units.${n}`,{quantity:s.toLocaleString(r,{maximumSignificantDigits:4})})}displayArea(e,i){let r=this._currLocaleCode,s=e*(i?10.7639111056:1),n,o,a,l;i?(s>=6969600?(n=s/27878400,a="square_miles"):(n=s,a="square_feet"),s>4356&&s<4356e4&&(o=s/43560,l="acres")):(s>=25e4?(n=s/1e6,a="square_kilometers"):(n=s,a="square_meters"),s>1e3&&s<1e7&&(o=s/1e4,l="hectares"));let c=this.t(`units.${a}`,{quantity:n.toLocaleString(r,{maximumSignificantDigits:4})});if(l){let d=this.t(`units.${l}`,{quantity:o.toLocaleString(r,{maximumSignificantDigits:2})});return this.t("units.area_pair",{area1:c,area2:d})}else return c}dmsCoordinatePair(e){return this.t("units.coordinate_pair",{latitude:this._displayCoordinate(TF(e[1],-90,90),"north","south"),longitude:this._displayCoordinate(EF(e[0],-180,180),"east","west")})}decimalCoordinatePair(e){return this.t("units.coordinate_pair",{latitude:TF(e[1],-90,90).toFixed(7),longitude:EF(e[0],-180,180).toFixed(7)})}_displayCoordinate(e,i,r){let s=this._currLocaleCode,n=(Math.abs(e)-Math.floor(Math.abs(e)))*60,o=(n-Math.floor(n))*60,a=this.t("units.arcdegrees",{quantity:Math.floor(Math.abs(e)).toLocaleString(s)}),l;return Math.floor(o)>0?l=a+this.t("units.arcminutes",{quantity:Math.floor(n).toLocaleString(s)})+this.t("units.arcseconds",{quantity:Math.round(o).toLocaleString(s)}):Math.floor(n)>0?l=a+this.t("units.arcminutes",{quantity:Math.round(n).toLocaleString(s)}):l=this.t("units.arcdegrees",{quantity:Math.round(Math.abs(e)).toLocaleString(s)}),e===0?l:this.t("units.coordinate",{coordinate:l,direction:this.t("units."+(e>0?i:r))})}_localesToUseFrom(e){let i=new Set;return e.forEach(r=>{if(this._supportedLocales[r]&&i.add(r),r.includes("-")){let s=r.split("-")[0];this._supportedLocales[s]&&i.add(s)}}),Array.from(i)}_updateForCurrentLocale(){if(!this._currLocaleCode)return;let[e,i]=this._currLocaleCode.toLowerCase().split("-",2);this._currLanguageCode=e,this._currIsMetric=i!=="us";let s=this.context.systems.urlhash.initialHashParams.get("rtl");if(s==="true")this._currTextDirection="rtl";else if(s==="false")this._currTextDirection="ltr";else{let o=this._supportedLocales[this._currLocaleCode]||this._supportedLocales[this._currLanguageCode];this._currTextDirection=o&&o.rtl?"rtl":"ltr"}let n=this._currLocaleCode;n.toLowerCase()==="en-us"&&(n="en"),this._languageNames=this._cache.general[n].languageNames,this._scriptNames=this._cache.general[n].scriptNames}};var SF=Yi(km(),1),DW={type:"FeatureCollection",features:[{type:"Feature",properties:{wikidata:"Q21",nameEn:"England",aliases:["GB-ENG"],country:"GB",groups:["Q23666","Q3336843","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44"]},geometry:{type:"MultiPolygon",coordinates:[[[[-6.03913,51.13217],[-7.74976,48.64773],[1.17405,50.74239],[2.18458,51.52087],[2.56575,51.85301],[.792,57.56437],[-2.30613,55.62698],[-2.17058,55.45916],[-2.6095,55.28488],[-2.63532,55.19452],[-3.02906,55.04606],[-3.09361,54.94924],[-3.38407,54.94278],[-4.1819,54.57861],[-3.5082,53.54318],[-3.08228,53.25526],[-3.03675,53.25092],[-2.92329,53.19383],[-2.92022,53.17685],[-2.98598,53.15589],[-2.90649,53.10964],[-2.87469,53.12337],[-2.89131,53.09374],[-2.83133,52.99184],[-2.7251,52.98389],[-2.72221,52.92969],[-2.80549,52.89428],[-2.85897,52.94487],[-2.92401,52.93836],[-2.97243,52.9651],[-3.13576,52.895],[-3.15744,52.84947],[-3.16105,52.79599],[-3.08734,52.77504],[-3.01001,52.76636],[-2.95581,52.71794],[-3.01724,52.72083],[-3.04398,52.65435],[-3.13648,52.58208],[-3.12926,52.5286],[-3.09746,52.53077],[-3.08662,52.54811],[-3.00929,52.57774],[-2.99701,52.551],[-3.03603,52.49969],[-3.13359,52.49174],[-3.22971,52.45344],[-3.22754,52.42526],[-3.04687,52.34504],[-2.95364,52.3501],[-2.99701,52.323],[-3.00785,52.2753],[-3.09289,52.20546],[-3.12638,52.08114],[-2.97111,51.90456],[-2.8818,51.93196],[-2.78742,51.88833],[-2.74277,51.84367],[-2.66234,51.83555],[-2.66336,51.59504],[-3.20563,51.31615],[-6.03913,51.13217]]]]}},{type:"Feature",properties:{wikidata:"Q22",nameEn:"Scotland",aliases:["GB-SCT"],country:"GB",groups:["Q23666","Q3336843","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44"]},geometry:{type:"MultiPolygon",coordinates:[[[[.792,57.56437],[-.3751,61.32236],[-14.78497,57.60709],[-6.82333,55.83103],[-4.69044,54.3629],[-3.38407,54.94278],[-3.09361,54.94924],[-3.02906,55.04606],[-2.63532,55.19452],[-2.6095,55.28488],[-2.17058,55.45916],[-2.30613,55.62698],[.792,57.56437]]]]}},{type:"Feature",properties:{wikidata:"Q25",nameEn:"Wales",aliases:["GB-WLS"],country:"GB",groups:["Q23666","Q3336843","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44"]},geometry:{type:"MultiPolygon",coordinates:[[[[-3.5082,53.54318],[-5.37267,53.63269],[-6.03913,51.13217],[-3.20563,51.31615],[-2.66336,51.59504],[-2.66234,51.83555],[-2.74277,51.84367],[-2.78742,51.88833],[-2.8818,51.93196],[-2.97111,51.90456],[-3.12638,52.08114],[-3.09289,52.20546],[-3.00785,52.2753],[-2.99701,52.323],[-2.95364,52.3501],[-3.04687,52.34504],[-3.22754,52.42526],[-3.22971,52.45344],[-3.13359,52.49174],[-3.03603,52.49969],[-2.99701,52.551],[-3.00929,52.57774],[-3.08662,52.54811],[-3.09746,52.53077],[-3.12926,52.5286],[-3.13648,52.58208],[-3.04398,52.65435],[-3.01724,52.72083],[-2.95581,52.71794],[-3.01001,52.76636],[-3.08734,52.77504],[-3.16105,52.79599],[-3.15744,52.84947],[-3.13576,52.895],[-2.97243,52.9651],[-2.92401,52.93836],[-2.85897,52.94487],[-2.80549,52.89428],[-2.72221,52.92969],[-2.7251,52.98389],[-2.83133,52.99184],[-2.89131,53.09374],[-2.87469,53.12337],[-2.90649,53.10964],[-2.98598,53.15589],[-2.92022,53.17685],[-2.92329,53.19383],[-3.03675,53.25092],[-3.08228,53.25526],[-3.5082,53.54318]]]]}},{type:"Feature",properties:{wikidata:"Q26",nameEn:"Northern Ireland",aliases:["GB-NIR"],country:"GB",groups:["Q22890","Q3336843","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44"]},geometry:{type:"MultiPolygon",coordinates:[[[[-6.34755,55.49206],[-7.2471,55.06933],[-7.34464,55.04688],[-7.4033,55.00391],[-7.40004,54.94498],[-7.44404,54.9403],[-7.4473,54.87003],[-7.47626,54.83084],[-7.54508,54.79401],[-7.54671,54.74606],[-7.64449,54.75265],[-7.75041,54.7103],[-7.83352,54.73854],[-7.93293,54.66603],[-7.70315,54.62077],[-7.8596,54.53671],[-7.99812,54.54427],[-8.04538,54.48941],[-8.179,54.46763],[-8.04555,54.36292],[-7.87101,54.29299],[-7.8596,54.21779],[-7.81397,54.20159],[-7.69501,54.20731],[-7.55812,54.12239],[-7.4799,54.12239],[-7.44567,54.1539],[-7.32834,54.11475],[-7.30553,54.11869],[-7.34005,54.14698],[-7.29157,54.17191],[-7.28017,54.16714],[-7.29687,54.1354],[-7.29493,54.12013],[-7.26316,54.13863],[-7.25012,54.20063],[-7.14908,54.22732],[-7.19145,54.31296],[-7.02034,54.4212],[-6.87775,54.34682],[-6.85179,54.29176],[-6.81583,54.22791],[-6.74575,54.18788],[-6.70175,54.20218],[-6.6382,54.17071],[-6.66264,54.0666],[-6.62842,54.03503],[-6.47849,54.06947],[-6.36605,54.07234],[-6.36279,54.11248],[-6.32694,54.09337],[-6.29003,54.11278],[-6.26218,54.09785],[-5.83481,53.87749],[-4.69044,54.3629],[-6.34755,55.49206]]]]}},{type:"Feature",properties:{wikidata:"Q35",nameEn:"Denmark",country:"DK",groups:["EU","154","150","UN"],callingCodes:["45"]},geometry:{type:"MultiPolygon",coordinates:[[[[12.16597,56.60205],[10.40861,58.38489],[7.28637,57.35913],[8.02459,55.09613],[8.45719,55.06747],[8.55769,54.91837],[8.63979,54.91069],[8.76387,54.8948],[8.81178,54.90518],[8.92795,54.90452],[9.04629,54.87249],[9.14275,54.87421],[9.20571,54.85841],[9.24631,54.84726],[9.23445,54.83432],[9.2474,54.8112],[9.32771,54.80602],[9.33849,54.80233],[9.36496,54.81749],[9.38532,54.83968],[9.41213,54.84254],[9.43155,54.82586],[9.4659,54.83131],[9.58937,54.88785],[9.62734,54.88057],[9.61187,54.85548],[9.73563,54.8247],[9.89314,54.84171],[10.16755,54.73883],[10.31111,54.65968],[11.00303,54.63689],[11.90309,54.38543],[12.85844,54.82438],[13.93395,54.84044],[15.36991,54.73263],[15.79951,55.54655],[14.89259,55.5623],[14.28399,55.1553],[12.84405,55.13257],[12.60345,55.42675],[12.88472,55.63369],[12.6372,55.91371],[12.65312,56.04345],[12.07466,56.29488],[12.16597,56.60205]]]]}},{type:"Feature",properties:{wikidata:"Q55",nameEn:"Netherlands",country:"NL",groups:["EU","155","150","UN"],callingCodes:["31"]},geometry:{type:"MultiPolygon",coordinates:[[[[5.45168,54.20039],[2.56575,51.85301],[3.36263,51.37112],[3.38696,51.33436],[3.35847,51.31572],[3.38289,51.27331],[3.41704,51.25933],[3.43488,51.24135],[3.52698,51.2458],[3.51502,51.28697],[3.58939,51.30064],[3.78999,51.25766],[3.78783,51.2151],[3.90125,51.20371],[3.97889,51.22537],[4.01957,51.24504],[4.05165,51.24171],[4.16721,51.29348],[4.24024,51.35371],[4.21923,51.37443],[4.33265,51.37687],[4.34086,51.35738],[4.39292,51.35547],[4.43777,51.36989],[4.38064,51.41965],[4.39747,51.43316],[4.38122,51.44905],[4.47736,51.4778],[4.5388,51.48184],[4.54675,51.47265],[4.52846,51.45002],[4.53521,51.4243],[4.57489,51.4324],[4.65442,51.42352],[4.72935,51.48424],[4.74578,51.48937],[4.77321,51.50529],[4.78803,51.50284],[4.84139,51.4799],[4.82409,51.44736],[4.82946,51.4213],[4.78314,51.43319],[4.76577,51.43046],[4.77229,51.41337],[4.78941,51.41102],[4.84988,51.41502],[4.90016,51.41404],[4.92152,51.39487],[5.00393,51.44406],[5.0106,51.47167],[5.03281,51.48679],[5.04774,51.47022],[5.07891,51.4715],[5.10456,51.43163],[5.07102,51.39469],[5.13105,51.34791],[5.13377,51.31592],[5.16222,51.31035],[5.2002,51.32243],[5.24244,51.30495],[5.22542,51.26888],[5.23814,51.26064],[5.26461,51.26693],[5.29716,51.26104],[5.33886,51.26314],[5.347,51.27502],[5.41672,51.26248],[5.4407,51.28169],[5.46519,51.2849],[5.48476,51.30053],[5.515,51.29462],[5.5569,51.26544],[5.5603,51.22249],[5.65145,51.19788],[5.65528,51.18736],[5.70344,51.1829],[5.74617,51.18928],[5.77735,51.17845],[5.77697,51.1522],[5.82564,51.16753],[5.85508,51.14445],[5.80798,51.11661],[5.8109,51.10861],[5.83226,51.10585],[5.82921,51.09328],[5.79903,51.09371],[5.79835,51.05834],[5.77258,51.06196],[5.75961,51.03113],[5.77688,51.02483],[5.76242,50.99703],[5.71864,50.96092],[5.72875,50.95428],[5.74752,50.96202],[5.75927,50.95601],[5.74644,50.94723],[5.72545,50.92312],[5.72644,50.91167],[5.71626,50.90796],[5.69858,50.91046],[5.67886,50.88142],[5.64504,50.87107],[5.64009,50.84742],[5.65259,50.82309],[5.70118,50.80764],[5.68995,50.79641],[5.70107,50.7827],[5.68091,50.75804],[5.69469,50.75529],[5.72216,50.76398],[5.73904,50.75674],[5.74356,50.7691],[5.76533,50.78159],[5.77513,50.78308],[5.80673,50.7558],[5.84548,50.76542],[5.84888,50.75448],[5.88734,50.77092],[5.89129,50.75125],[5.89132,50.75124],[5.95942,50.7622],[5.97545,50.75441],[6.01976,50.75398],[6.02624,50.77453],[5.97497,50.79992],[5.98404,50.80988],[6.00462,50.80065],[6.02328,50.81694],[6.01921,50.84435],[6.05623,50.8572],[6.05702,50.85179],[6.07431,50.84674],[6.07693,50.86025],[6.08805,50.87223],[6.07486,50.89307],[6.09297,50.92066],[6.01615,50.93367],[6.02697,50.98303],[5.95282,50.98728],[5.90296,50.97356],[5.90493,51.00198],[5.87849,51.01969],[5.86735,51.05182],[5.9134,51.06736],[5.9541,51.03496],[5.98292,51.07469],[6.16706,51.15677],[6.17384,51.19589],[6.07889,51.17038],[6.07889,51.24432],[6.16977,51.33169],[6.22674,51.36135],[6.22641,51.39948],[6.20654,51.40049],[6.21724,51.48568],[6.18017,51.54096],[6.09055,51.60564],[6.11759,51.65609],[6.02767,51.6742],[6.04091,51.71821],[5.95003,51.7493],[5.98665,51.76944],[5.94568,51.82786],[5.99848,51.83195],[6.06705,51.86136],[6.10337,51.84829],[6.16902,51.84094],[6.11551,51.89769],[6.15349,51.90439],[6.21443,51.86801],[6.29872,51.86801],[6.30593,51.84998],[6.40704,51.82771],[6.38815,51.87257],[6.47179,51.85395],[6.50231,51.86313],[6.58556,51.89386],[6.68386,51.91861],[6.72319,51.89518],[6.82357,51.96711],[6.83035,51.9905],[6.68128,52.05052],[6.76117,52.11895],[6.83984,52.11728],[6.97189,52.20329],[6.9897,52.2271],[7.03729,52.22695],[7.06365,52.23789],[7.02703,52.27941],[7.07044,52.37805],[7.03417,52.40237],[6.99041,52.47235],[6.94293,52.43597],[6.69507,52.488],[6.71641,52.62905],[6.77307,52.65375],[7.04557,52.63318],[7.07253,52.81083],[7.21694,53.00742],[7.17898,53.13817],[7.22681,53.18165],[7.21679,53.20058],[7.19052,53.31866],[7.00198,53.32672],[6.91025,53.44221],[5.45168,54.20039]],[[4.93295,51.44945],[4.95244,51.45207],[4.9524,51.45014],[4.93909,51.44632],[4.93295,51.44945]],[[4.91493,51.4353],[4.91935,51.43634],[4.92227,51.44252],[4.91811,51.44621],[4.92287,51.44741],[4.92811,51.4437],[4.92566,51.44273],[4.92815,51.43856],[4.92879,51.44161],[4.93544,51.44634],[4.94025,51.44193],[4.93416,51.44185],[4.93471,51.43861],[4.94265,51.44003],[4.93986,51.43064],[4.92952,51.42984],[4.92652,51.43329],[4.91493,51.4353]]]]}},{type:"Feature",properties:{wikidata:"Q782",nameEn:"Hawaii",aliases:["US-HI"],country:"US",groups:["Q35657","061","009","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-177.8563,29.18961],[-179.49839,27.86265],[-151.6784,9.55515],[-154.05867,45.51124],[-177.5224,27.7635],[-177.8563,29.18961]]]]}},{type:"Feature",properties:{wikidata:"Q797",nameEn:"Alaska",aliases:["US-AK"],country:"US",groups:["Q35657","021","003","019","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[169.34848,52.47228],[180,51.0171],[179.84401,55.10087],[169.34848,52.47228]]],[[[-168.95635,65.98512],[-169.03888,65.48473],[-172.76104,63.77445],[-179.55295,57.62081],[-179.55295,50.81807],[-133.92876,54.62289],[-130.61931,54.70835],[-130.64499,54.76912],[-130.44184,54.85377],[-130.27203,54.97174],[-130.18765,55.07744],[-130.08035,55.21556],[-129.97513,55.28029],[-130.15373,55.74895],[-130.00857,55.91344],[-130.00093,56.00325],[-130.10173,56.12178],[-130.33965,56.10849],[-130.77769,56.36185],[-131.8271,56.62247],[-133.38523,58.42773],[-133.84645,58.73543],[-134.27175,58.8634],[-134.48059,59.13231],[-134.55699,59.1297],[-134.7047,59.2458],[-135.00267,59.28745],[-135.03069,59.56208],[-135.48007,59.79937],[-136.31566,59.59083],[-136.22381,59.55526],[-136.33727,59.44466],[-136.47323,59.46617],[-136.52365,59.16752],[-136.82619,59.16198],[-137.4925,58.89415],[-137.60623,59.24465],[-138.62145,59.76431],[-138.71149,59.90728],[-139.05365,59.99655],[-139.20603,60.08896],[-139.05831,60.35205],[-139.68991,60.33693],[-139.98024,60.18027],[-140.45648,60.30919],[-140.5227,60.22077],[-141.00116,60.30648],[-140.97446,84.39275],[-168.25765,71.99091],[-168.95635,65.98512]]]]}},{type:"Feature",properties:{wikidata:"Q3492",nameEn:"Sumatra",aliases:["ID-SM"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[109.82788,2.86812],[110.90339,7.52694],[105.01437,3.24936],[104.56723,1.44271],[104.34728,1.33529],[104.12282,1.27714],[104.03085,1.26954],[103.74084,1.12902],[103.66049,1.18825],[103.56591,1.19719],[103.03657,1.30383],[96.11174,6.69841],[74.28481,-3.17525],[102.92489,-8.17146],[106.32259,-5.50116],[106.38511,-5.16715],[109.17017,-4.07401],[109.3962,-2.07276],[108.50935,-2.01066],[107.94791,1.06924],[109.82788,2.86812]]]]}},{type:"Feature",properties:{wikidata:"Q3757",nameEn:"Java",aliases:["ID-JW"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[109.17017,-4.07401],[106.38511,-5.16715],[106.32259,-5.50116],[102.92489,-8.17146],[116.22542,-10.49172],[114.39575,-8.2889],[114.42235,-8.09762],[114.92859,-7.49253],[116.33992,-7.56171],[116.58433,-5.30385],[109.17017,-4.07401]]]]}},{type:"Feature",properties:{wikidata:"Q3795",nameEn:"Kalimantan",aliases:["ID-KA"],country:"ID",groups:["Q36117","035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[120.02464,2.83703],[118.06469,4.16638],[117.67641,4.16535],[117.47313,4.18857],[117.25801,4.35108],[115.90217,4.37708],[115.58276,3.93499],[115.53713,3.14776],[115.11343,2.82879],[115.1721,2.49671],[114.80706,2.21665],[114.80706,1.92351],[114.57892,1.5],[114.03788,1.44787],[113.64677,1.23933],[113.01448,1.42832],[113.021,1.57819],[112.48648,1.56516],[112.2127,1.44135],[112.15679,1.17004],[111.94553,1.12016],[111.82846,.99349],[111.55434,.97864],[111.22979,1.08326],[110.62374,.873],[110.49182,.88088],[110.35354,.98869],[109.66397,1.60425],[109.66397,1.79972],[109.57923,1.80624],[109.53794,1.91771],[109.62558,1.99182],[109.82788,2.86812],[107.94791,1.06924],[108.50935,-2.01066],[109.3962,-2.07276],[109.17017,-4.07401],[116.58433,-5.30385],[120.02464,2.83703]]]]}},{type:"Feature",properties:{wikidata:"Q3803",nameEn:"Lesser Sunda Islands",aliases:["ID-NU"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[116.96967,-8.01483],[114.92859,-7.49253],[114.42235,-8.09762],[114.39575,-8.2889],[116.22542,-10.49172],[122.14954,-11.52517],[125.68138,-9.85176],[125.09025,-9.46406],[124.97892,-9.19281],[125.04044,-9.17093],[125.09434,-9.19669],[125.18907,-9.16434],[125.18632,-9.03142],[125.11764,-8.96359],[124.97742,-9.08128],[124.94011,-8.85617],[124.46701,-9.13002],[124.45971,-9.30263],[124.38554,-9.3582],[124.35258,-9.43002],[124.3535,-9.48493],[124.28115,-9.50453],[124.28115,-9.42189],[124.21247,-9.36904],[124.14517,-9.42324],[124.10539,-9.41206],[124.04286,-9.34243],[124.04628,-9.22671],[124.33472,-9.11416],[124.92337,-8.75859],[125.87688,-7.49892],[116.96967,-8.01483]]]]}},{type:"Feature",properties:{wikidata:"Q3812",nameEn:"Sulawesi",aliases:["ID-SL"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[128.34321,3.90322],[126.69413,6.02692],[119.56457,.90759],[116.58433,-5.30385],[116.33992,-7.56171],[116.96967,-8.01483],[125.87688,-7.49892],[123.78965,-.86805],[128.34321,3.90322]]]]}},{type:"Feature",properties:{wikidata:"Q3827",nameEn:"Maluku Islands",aliases:["ID-ML"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[129.63187,2.21409],[128.34321,3.90322],[123.78965,-.86805],[125.87688,-7.49892],[125.58506,-7.95311],[125.87691,-8.31789],[127.42116,-8.22471],[127.55165,-9.05052],[135.49042,-9.2276],[135.35517,-5.01442],[132.8312,-4.70282],[130.8468,-2.61103],[128.40647,-2.30349],[129.71519,-.24692],[129.63187,2.21409]]]]}},{type:"Feature",properties:{wikidata:"Q3845",nameEn:"Western New Guinea",aliases:["ID-PP"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[135.49042,-9.2276],[141.01842,-9.35091],[141.01763,-6.90181],[140.90448,-6.85033],[140.85295,-6.72996],[140.99813,-6.3233],[141.02352,.08993],[129.63187,2.21409],[129.71519,-.24692],[128.40647,-2.30349],[130.8468,-2.61103],[132.8312,-4.70282],[135.35517,-5.01442],[135.49042,-9.2276]]]]}},{type:"Feature",properties:{wikidata:"Q5765",nameEn:"Balearic Islands",aliases:["ES-IB"],country:"ES",groups:["EU","039","150","UN"],callingCodes:["34 971"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.27707,35.35051],[5.10072,39.89531],[3.75438,42.33445],[-2.27707,35.35051]]]]}},{type:"Feature",properties:{wikidata:"Q5823",nameEn:"Ceuta",aliases:["ES-CE"],country:"ES",groups:["EA","EU","015","002","UN"],level:"subterritory",callingCodes:["34"]},geometry:{type:"MultiPolygon",coordinates:[[[[-5.38491,35.92591],[-5.37338,35.88417],[-5.35844,35.87375],[-5.34379,35.8711],[-5.21179,35.90091],[-5.38491,35.92591]]]]}},{type:"Feature",properties:{wikidata:"Q5831",nameEn:"Melilla",aliases:["ES-ML"],country:"ES",groups:["EA","EU","015","002","UN"],level:"subterritory",callingCodes:["34"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.91909,35.33927],[-2.96038,35.31609],[-2.96648,35.30475],[-2.96978,35.29459],[-2.97035,35.28852],[-2.96507,35.28801],[-2.96826,35.28296],[-2.96516,35.27967],[-2.95431,35.2728],[-2.95065,35.26576],[-2.93893,35.26737],[-2.92272,35.27509],[-2.91909,35.33927]]]]}},{type:"Feature",properties:{wikidata:"Q7835",nameEn:"Crimea",country:"RU",groups:["151","150","UN"],level:"subterritory",callingCodes:["7"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.5,44],[36.4883,45.0488],[36.475,45.2411],[36.5049,45.3136],[36.6545,45.3417],[36.6645,45.4514],[35.0498,45.7683],[34.9601,45.7563],[34.7991,45.8101],[34.8015,45.9005],[34.7548,45.907],[34.6668,45.9714],[34.6086,45.9935],[34.5589,45.9935],[34.5201,45.951],[34.4873,45.9427],[34.4415,45.9599],[34.4122,46.0025],[34.3391,46.0611],[34.2511,46.0532],[34.181,46.068],[34.1293,46.1049],[34.0731,46.1177],[34.0527,46.1084],[33.9155,46.1594],[33.8523,46.1986],[33.7972,46.2048],[33.7405,46.1855],[33.646,46.2303],[33.6152,46.2261],[33.6385,46.1415],[33.6147,46.1356],[33.5732,46.1032],[33.5909,46.0601],[33.5597,46.0307],[31.5,45.5],[33.5,44]]]]}},{type:"Feature",properties:{wikidata:"Q12837",nameEn:"Iberia",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q14056",nameEn:"Jan Mayen",aliases:["NO-22"],country:"NO",groups:["SJ","154","150","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[-9.18243,72.23144],[-10.71459,70.09565],[-5.93364,70.76368],[-9.18243,72.23144]]]]}},{type:"Feature",properties:{wikidata:"Q19188",nameEn:"Mainland China",country:"CN",groups:["030","142","UN"],callingCodes:["86"]},geometry:{type:"MultiPolygon",coordinates:[[[[125.6131,53.07229],[125.17522,53.20225],[124.46078,53.21881],[123.86158,53.49391],[123.26989,53.54843],[122.85966,53.47395],[122.35063,53.49565],[121.39213,53.31888],[120.85633,53.28499],[120.0451,52.7359],[120.04049,52.58773],[120.46454,52.63811],[120.71673,52.54099],[120.61346,52.32447],[120.77337,52.20805],[120.65907,51.93544],[120.10963,51.671],[119.13553,50.37412],[119.38598,50.35162],[119.27996,50.13348],[119.11003,50.00276],[118.61623,49.93809],[117.82343,49.52696],[117.48208,49.62324],[117.27597,49.62544],[116.71193,49.83813],[116.03781,48.87014],[116.06565,48.81716],[115.78876,48.51781],[115.811,48.25699],[115.52082,48.15367],[115.57128,47.91988],[115.94296,47.67741],[116.21879,47.88505],[116.4465,47.83662],[116.67405,47.89039],[116.9723,47.87285],[117.37875,47.63627],[117.50181,47.77216],[117.80196,48.01661],[118.03676,48.00982],[118.11009,48.04],[118.22677,48.03853],[118.29654,48.00246],[118.55766,47.99277],[118.7564,47.76947],[119.12343,47.66458],[119.13995,47.53997],[119.35892,47.48104],[119.31964,47.42617],[119.54918,47.29505],[119.56019,47.24874],[119.62403,47.24575],[119.71209,47.19192],[119.85518,46.92196],[119.91242,46.90091],[119.89261,46.66423],[119.80455,46.67631],[119.77373,46.62947],[119.68127,46.59015],[119.65265,46.62342],[119.42827,46.63783],[119.32827,46.61433],[119.24978,46.64761],[119.10448,46.65516],[119.00541,46.74273],[118.92616,46.72765],[118.89974,46.77139],[118.8337,46.77742],[118.78747,46.68689],[118.30534,46.73519],[117.69554,46.50991],[117.60748,46.59771],[117.41782,46.57862],[117.36609,46.36335],[116.83166,46.38637],[116.75551,46.33083],[116.58612,46.30211],[116.26678,45.96479],[116.24012,45.8778],[116.27366,45.78637],[116.16989,45.68603],[115.60329,45.44717],[114.94546,45.37377],[114.74612,45.43585],[114.54801,45.38337],[114.5166,45.27189],[113.70918,44.72891],[112.74662,44.86297],[112.4164,45.06858],[111.98695,45.09074],[111.76275,44.98032],[111.40498,44.3461],[111.96289,43.81596],[111.93776,43.68709],[111.79758,43.6637],[111.59087,43.51207],[111.0149,43.3289],[110.4327,42.78293],[110.08401,42.6411],[109.89402,42.63111],[109.452,42.44842],[109.00679,42.45302],[108.84489,42.40246],[107.57258,42.40898],[107.49681,42.46221],[107.29755,42.41395],[107.24774,42.36107],[106.76517,42.28741],[105.0123,41.63188],[104.51667,41.66113],[104.52258,41.8706],[103.92804,41.78246],[102.72403,42.14675],[102.07645,42.22519],[101.80515,42.50074],[100.84979,42.67087],[100.33297,42.68231],[99.50671,42.56535],[97.1777,42.7964],[96.37926,42.72055],[96.35658,42.90363],[95.89543,43.2528],[95.52594,43.99353],[95.32891,44.02407],[95.39772,44.2805],[95.01191,44.25274],[94.71959,44.35284],[94.10003,44.71016],[93.51161,44.95964],[91.64048,45.07408],[90.89169,45.19667],[90.65114,45.49314],[90.70907,45.73437],[91.03026,46.04194],[90.99672,46.14207],[90.89639,46.30711],[91.07696,46.57315],[91.0147,46.58171],[91.03649,46.72916],[90.84035,46.99525],[90.76108,46.99399],[90.48542,47.30438],[90.48854,47.41826],[90.33598,47.68303],[90.10871,47.7375],[90.06512,47.88177],[89.76624,47.82745],[89.55453,48.0423],[89.0711,47.98528],[88.93186,48.10263],[88.8011,48.11302],[88.58316,48.21893],[88.58939,48.34531],[87.96361,48.58478],[88.0788,48.71436],[87.73822,48.89582],[87.88171,48.95853],[87.81333,49.17354],[87.48983,49.13794],[87.478,49.07403],[87.28386,49.11626],[86.87238,49.12432],[86.73568,48.99918],[86.75343,48.70331],[86.38069,48.46064],[85.73581,48.3939],[85.5169,48.05493],[85.61067,47.49753],[85.69696,47.2898],[85.54294,47.06171],[85.22443,47.04816],[84.93995,46.87399],[84.73077,47.01394],[83.92184,46.98912],[83.04622,47.19053],[82.21792,45.56619],[82.58474,45.40027],[82.51374,45.1755],[81.73278,45.3504],[80.11169,45.03352],[79.8987,44.89957],[80.38384,44.63073],[80.40229,44.23319],[80.40031,44.10986],[80.75156,43.44948],[80.69718,43.32589],[80.77771,43.30065],[80.78817,43.14235],[80.62913,43.141],[80.3735,43.01557],[80.58999,42.9011],[80.38169,42.83142],[80.26886,42.8366],[80.16892,42.61137],[80.26841,42.23797],[80.17807,42.21166],[80.17842,42.03211],[79.92977,42.04113],[78.3732,41.39603],[78.15757,41.38565],[78.12873,41.23091],[77.81287,41.14307],[77.76206,41.01574],[77.52723,41.00227],[77.3693,41.0375],[77.28004,41.0033],[76.99302,41.0696],[76.75681,40.95354],[76.5261,40.46114],[76.33659,40.3482],[75.96168,40.38064],[75.91361,40.2948],[75.69663,40.28642],[75.5854,40.66874],[75.22834,40.45382],[75.08243,40.43945],[74.82013,40.52197],[74.78168,40.44886],[74.85996,40.32857],[74.69875,40.34668],[74.35063,40.09742],[74.25533,40.13191],[73.97049,40.04378],[73.83006,39.76136],[73.9051,39.75073],[73.92354,39.69565],[73.94683,39.60733],[73.87018,39.47879],[73.59831,39.46425],[73.59241,39.40843],[73.5004,39.38402],[73.55396,39.3543],[73.54572,39.27567],[73.60638,39.24534],[73.75823,39.023],[73.81728,39.04007],[73.82964,38.91517],[73.7445,38.93867],[73.7033,38.84782],[73.80656,38.66449],[73.79806,38.61106],[73.97933,38.52945],[74.17022,38.65504],[74.51217,38.47034],[74.69619,38.42947],[74.69894,38.22155],[74.80331,38.19889],[74.82665,38.07359],[74.9063,38.03033],[74.92416,37.83428],[75.00935,37.77486],[74.8912,37.67576],[74.94338,37.55501],[75.06011,37.52779],[75.15899,37.41443],[75.09719,37.37297],[75.12328,37.31839],[74.88887,37.23275],[74.80605,37.21565],[74.49981,37.24518],[74.56453,37.03023],[75.13839,37.02622],[75.40481,36.95382],[75.45562,36.71971],[75.72737,36.7529],[75.92391,36.56986],[76.0324,36.41198],[76.00906,36.17511],[75.93028,36.13136],[76.15325,35.9264],[76.14913,35.82848],[76.33453,35.84296],[76.50961,35.8908],[76.77323,35.66062],[76.84539,35.67356],[76.96624,35.5932],[77.44277,35.46132],[77.70232,35.46244],[77.80532,35.52058],[78.11664,35.48022],[78.03466,35.3785],[78.00033,35.23954],[78.22692,34.88771],[78.18435,34.7998],[78.27781,34.61484],[78.54964,34.57283],[78.56475,34.50835],[78.74465,34.45174],[79.05364,34.32482],[78.99802,34.3027],[78.91769,34.15452],[78.66225,34.08858],[78.65657,34.03195],[78.73367,34.01121],[78.77349,33.73871],[78.67599,33.66445],[78.73636,33.56521],[79.15252,33.17156],[79.14016,33.02545],[79.46562,32.69668],[79.26768,32.53277],[79.13174,32.47766],[79.0979,32.38051],[78.99322,32.37948],[78.96713,32.33655],[78.7831,32.46873],[78.73916,32.69438],[78.38897,32.53938],[78.4645,32.45367],[78.49609,32.2762],[78.68754,32.10256],[78.74404,32.00384],[78.78036,31.99478],[78.69933,31.78723],[78.84516,31.60631],[78.71032,31.50197],[78.77898,31.31209],[78.89344,31.30481],[79.01931,31.42817],[79.14016,31.43403],[79.30694,31.17357],[79.59884,30.93943],[79.93255,30.88288],[80.20721,30.58541],[80.54504,30.44936],[80.83343,30.32023],[81.03953,30.20059],[81.12842,30.01395],[81.24362,30.0126],[81.29032,30.08806],[81.2623,30.14596],[81.33355,30.15303],[81.39928,30.21862],[81.41018,30.42153],[81.5459,30.37688],[81.62033,30.44703],[81.99082,30.33423],[82.10135,30.35439],[82.10757,30.23745],[82.19475,30.16884],[82.16984,30.0692],[82.38622,30.02608],[82.5341,29.9735],[82.73024,29.81695],[83.07116,29.61957],[83.28131,29.56813],[83.44787,29.30513],[83.63156,29.16249],[83.82303,29.30513],[83.97559,29.33091],[84.18107,29.23451],[84.24801,29.02783],[84.2231,28.89571],[84.47528,28.74023],[84.62317,28.73887],[84.85511,28.58041],[85.06059,28.68562],[85.19135,28.62825],[85.18668,28.54076],[85.10729,28.34092],[85.38127,28.28336],[85.4233,28.32996],[85.59765,28.30529],[85.60854,28.25045],[85.69105,28.38475],[85.71907,28.38064],[85.74864,28.23126],[85.84672,28.18187],[85.90743,28.05144],[85.97813,27.99023],[85.94946,27.9401],[86.06309,27.90021],[86.12069,27.93047],[86.08333,28.02121],[86.088,28.09264],[86.18607,28.17364],[86.22966,27.9786],[86.42736,27.91122],[86.51609,27.96623],[86.56265,28.09569],[86.74181,28.10638],[86.75582,28.04182],[87.03757,27.94835],[87.11696,27.84104],[87.56996,27.84517],[87.72718,27.80938],[87.82681,27.95248],[88.13378,27.88015],[88.1278,27.95417],[88.25332,27.9478],[88.54858,28.06057],[88.63235,28.12356],[88.83559,28.01936],[88.88091,27.85192],[88.77517,27.45415],[88.82981,27.38814],[88.91901,27.32483],[88.93678,27.33777],[88.96947,27.30319],[89.00216,27.32532],[88.95355,27.4106],[88.97213,27.51671],[89.0582,27.60985],[89.12825,27.62502],[89.59525,28.16433],[89.79762,28.23979],[90.13387,28.19178],[90.58842,28.02838],[90.69894,28.07784],[91.20019,27.98715],[91.25779,28.07509],[91.46327,28.0064],[91.48973,27.93903],[91.5629,27.84823],[91.6469,27.76358],[91.84722,27.76325],[91.87057,27.7195],[92.27432,27.89077],[92.32101,27.79363],[92.42538,27.80092],[92.7275,27.98662],[92.73025,28.05814],[92.65472,28.07632],[92.67486,28.15018],[92.93075,28.25671],[93.14635,28.37035],[93.18069,28.50319],[93.44621,28.67189],[93.72797,28.68821],[94.35897,29.01965],[94.2752,29.11687],[94.69318,29.31739],[94.81353,29.17804],[95.0978,29.14446],[95.11291,29.09527],[95.2214,29.10727],[95.26122,29.07727],[95.3038,29.13847],[95.41091,29.13007],[95.50842,29.13487],[95.72086,29.20797],[95.75149,29.32063],[95.84899,29.31464],[96.05361,29.38167],[96.31316,29.18643],[96.18682,29.11087],[96.20467,29.02325],[96.3626,29.10607],[96.61391,28.72742],[96.40929,28.51526],[96.48895,28.42955],[96.6455,28.61657],[96.85561,28.4875],[96.88445,28.39452],[96.98882,28.32564],[97.1289,28.3619],[97.34547,28.21385],[97.41729,28.29783],[97.47085,28.2688],[97.50518,28.49716],[97.56835,28.55628],[97.70705,28.5056],[97.79632,28.33168],[97.90069,28.3776],[98.15337,28.12114],[98.13964,27.9478],[98.32641,27.51385],[98.42529,27.55404],[98.43353,27.67086],[98.69582,27.56499],[98.7333,26.85615],[98.77547,26.61994],[98.72741,26.36183],[98.67797,26.24487],[98.7329,26.17218],[98.66884,26.09165],[98.63128,26.15492],[98.57085,26.11547],[98.60763,26.01512],[98.70818,25.86241],[98.63128,25.79937],[98.54064,25.85129],[98.40606,25.61129],[98.31268,25.55307],[98.25774,25.6051],[98.16848,25.62739],[98.18084,25.56298],[98.12591,25.50722],[98.14925,25.41547],[97.92541,25.20815],[97.83614,25.2715],[97.77023,25.11492],[97.72216,25.08508],[97.72903,24.91332],[97.79949,24.85655],[97.76481,24.8289],[97.73127,24.83015],[97.70181,24.84557],[97.64354,24.79171],[97.56648,24.76475],[97.56383,24.75535],[97.5542,24.74943],[97.54675,24.74202],[97.56525,24.72838],[97.56286,24.54535],[97.52757,24.43748],[97.60029,24.4401],[97.66998,24.45288],[97.7098,24.35658],[97.65624,24.33781],[97.66723,24.30027],[97.71941,24.29652],[97.76799,24.26365],[97.72998,24.2302],[97.72799,24.18883],[97.75305,24.16902],[97.72903,24.12606],[97.62363,24.00506],[97.5247,23.94032],[97.64667,23.84574],[97.72302,23.89288],[97.79456,23.94836],[97.79416,23.95663],[97.84328,23.97603],[97.86545,23.97723],[97.88811,23.97446],[97.8955,23.97758],[97.89676,23.97931],[97.89683,23.98389],[97.88814,23.98605],[97.88414,23.99405],[97.88616,24.00463],[97.90998,24.02094],[97.93951,24.01953],[97.98691,24.03897],[97.99583,24.04932],[98.04709,24.07616],[98.05302,24.07408],[98.05671,24.07961],[98.0607,24.07812],[98.06703,24.08028],[98.07806,24.07988],[98.20666,24.11406],[98.54476,24.13119],[98.59256,24.08371],[98.85319,24.13042],[98.87998,24.15624],[98.89632,24.10612],[98.67797,23.9644],[98.68209,23.80492],[98.79607,23.77947],[98.82933,23.72921],[98.81775,23.694],[98.88396,23.59555],[98.80294,23.5345],[98.82877,23.47908],[98.87683,23.48995],[98.92104,23.36946],[98.87573,23.33038],[98.93958,23.31414],[98.92515,23.29535],[98.88597,23.18656],[99.05975,23.16382],[99.04601,23.12215],[99.25741,23.09025],[99.34127,23.13099],[99.52214,23.08218],[99.54218,22.90014],[99.43537,22.94086],[99.45654,22.85726],[99.31243,22.73893],[99.38247,22.57544],[99.37972,22.50188],[99.28771,22.4105],[99.17318,22.18025],[99.19176,22.16983],[99.1552,22.15874],[99.33166,22.09656],[99.47585,22.13345],[99.85351,22.04183],[99.96612,22.05965],[99.99084,21.97053],[99.94003,21.82782],[99.98654,21.71064],[100.04956,21.66843],[100.12679,21.70539],[100.17486,21.65306],[100.10757,21.59945],[100.12542,21.50365],[100.1625,21.48704],[100.18447,21.51898],[100.25863,21.47043],[100.35201,21.53176],[100.42892,21.54325],[100.4811,21.46148],[100.57861,21.45637],[100.72143,21.51898],[100.87265,21.67396],[101.11744,21.77659],[101.15156,21.56129],[101.2124,21.56422],[101.19349,21.41959],[101.26912,21.36482],[101.2229,21.23271],[101.29326,21.17254],[101.54563,21.25668],[101.6068,21.23329],[101.59491,21.18621],[101.60886,21.17947],[101.66977,21.20004],[101.70548,21.14911],[101.7622,21.14813],[101.79266,21.19025],[101.76745,21.21571],[101.83887,21.20983],[101.84412,21.25291],[101.74014,21.30967],[101.74224,21.48276],[101.7727,21.51794],[101.7475,21.5873],[101.80001,21.57461],[101.83257,21.61562],[101.74555,21.72852],[101.7791,21.83019],[101.62566,21.96574],[101.57525,22.13026],[101.60675,22.13513],[101.53638,22.24794],[101.56789,22.28876],[101.61306,22.27515],[101.68973,22.46843],[101.7685,22.50337],[101.86828,22.38397],[101.90714,22.38688],[101.91344,22.44417],[101.98487,22.42766],[102.03633,22.46164],[102.1245,22.43372],[102.14099,22.40092],[102.16621,22.43336],[102.26428,22.41321],[102.25339,22.4607],[102.41061,22.64184],[102.38415,22.67919],[102.42618,22.69212],[102.46665,22.77108],[102.51802,22.77969],[102.57095,22.7036],[102.60675,22.73376],[102.8636,22.60735],[102.9321,22.48659],[103.0722,22.44775],[103.07843,22.50097],[103.17961,22.55705],[103.15782,22.59873],[103.18895,22.64471],[103.28079,22.68063],[103.32282,22.8127],[103.43179,22.75816],[103.43646,22.70648],[103.52675,22.59155],[103.57812,22.65764],[103.56255,22.69499],[103.64506,22.79979],[103.87904,22.56683],[103.93286,22.52703],[103.94513,22.52553],[103.95191,22.5134],[103.96352,22.50584],[103.96783,22.51173],[103.97384,22.50634],[103.99247,22.51958],[104.01088,22.51823],[104.03734,22.72945],[104.11384,22.80363],[104.27084,22.8457],[104.25683,22.76534],[104.35593,22.69353],[104.47225,22.75813],[104.58122,22.85571],[104.60457,22.81841],[104.65283,22.83419],[104.72755,22.81984],[104.77114,22.90017],[104.84942,22.93631],[104.86765,22.95178],[104.8334,23.01484],[104.79478,23.12934],[104.87382,23.12854],[104.87992,23.17141],[104.91435,23.18666],[104.9486,23.17235],[104.96532,23.20463],[104.98712,23.19176],[105.07002,23.26248],[105.11672,23.25247],[105.17276,23.28679],[105.22569,23.27249],[105.32376,23.39684],[105.40782,23.28107],[105.42805,23.30824],[105.49966,23.20669],[105.56037,23.16806],[105.57594,23.075],[105.72382,23.06641],[105.8726,22.92756],[105.90119,22.94168],[105.99568,22.94178],[106.00179,22.99049],[106.19705,22.98475],[106.27022,22.87722],[106.34961,22.86718],[106.49749,22.91164],[106.51306,22.94891],[106.55976,22.92311],[106.60179,22.92884],[106.6516,22.86862],[106.6734,22.89587],[106.71387,22.88296],[106.71128,22.85982],[106.78422,22.81532],[106.81271,22.8226],[106.83685,22.8098],[106.82404,22.7881],[106.76293,22.73491],[106.72321,22.63606],[106.71698,22.58432],[106.65316,22.5757],[106.61269,22.60301],[106.58395,22.474],[106.55665,22.46498],[106.57221,22.37],[106.55976,22.34841],[106.6516,22.33977],[106.69986,22.22309],[106.67495,22.1885],[106.6983,22.15102],[106.70142,22.02409],[106.68274,21.99811],[106.69276,21.96013],[106.72551,21.97923],[106.74345,22.00965],[106.81038,21.97934],[106.9178,21.97357],[106.92714,21.93459],[106.97228,21.92592],[106.99252,21.95191],[107.05634,21.92303],[107.06101,21.88982],[107.00964,21.85948],[107.02615,21.81981],[107.10771,21.79879],[107.20734,21.71493],[107.24625,21.7077],[107.29296,21.74674],[107.35834,21.6672],[107.35989,21.60063],[107.38636,21.59774],[107.41593,21.64839],[107.47197,21.6672],[107.49532,21.62958],[107.49065,21.59774],[107.54047,21.5934],[107.56537,21.61945],[107.66967,21.60787],[107.80355,21.66141],[107.86114,21.65128],[107.90006,21.5905],[107.92652,21.58906],[107.95232,21.5388],[107.96774,21.53601],[107.97074,21.54072],[107.97383,21.53961],[107.97932,21.54503],[108.02926,21.54997],[108.0569,21.53604],[108.10003,21.47338],[108.00365,17.98159],[111.60491,13.57105],[118.41371,24.06775],[118.11703,24.39734],[118.28244,24.51231],[118.35291,24.51645],[118.42453,24.54644],[118.6333,24.46259],[119.42295,25.0886],[119.98511,25.37624],[119.78816,26.2348],[120.0693,26.3959],[120.5128,26.536],[121.03532,26.8787],[123.5458,31.01942],[122.29378,31.76513],[122.80525,33.30571],[123.85601,37.49093],[123.90497,38.79949],[124.17532,39.8232],[124.23201,39.9248],[124.35029,39.95639],[124.37089,40.03004],[124.3322,40.05573],[124.38556,40.11047],[124.40719,40.13655],[124.86913,40.45387],[125.71172,40.85223],[125.76869,40.87908],[126.00335,40.92835],[126.242,41.15454],[126.53189,41.35206],[126.60631,41.65565],[126.90729,41.79955],[127.17841,41.59714],[127.29712,41.49473],[127.92943,41.44291],[128.02633,41.42103],[128.03311,41.39232],[128.12967,41.37931],[128.18546,41.41279],[128.20061,41.40895],[128.30716,41.60322],[128.15119,41.74568],[128.04487,42.01769],[128.94007,42.03537],[128.96068,42.06657],[129.15178,42.17224],[129.22285,42.26491],[129.22423,42.3553],[129.28541,42.41574],[129.42882,42.44702],[129.54701,42.37254],[129.60482,42.44461],[129.72541,42.43739],[129.75294,42.59409],[129.77183,42.69435],[129.7835,42.76521],[129.80719,42.79218],[129.83277,42.86746],[129.85261,42.96494],[129.8865,43.00395],[129.95082,43.01051],[129.96409,42.97306],[130.12957,42.98361],[130.09764,42.91425],[130.26095,42.9027],[130.23068,42.80125],[130.2385,42.71127],[130.41826,42.6011],[130.44361,42.54849],[130.50123,42.61636],[130.55143,42.52158],[130.62107,42.58413],[130.56576,42.68925],[130.40213,42.70788],[130.44361,42.76205],[130.66524,42.84753],[131.02438,42.86518],[131.02668,42.91246],[131.135,42.94114],[131.10274,43.04734],[131.20414,43.13654],[131.19031,43.21385],[131.30324,43.39498],[131.29402,43.46695],[131.19492,43.53047],[131.21105,43.82383],[131.26176,43.94011],[131.23583,43.96085],[131.25484,44.03131],[131.30365,44.04262],[131.1108,44.70266],[130.95639,44.85154],[131.48415,44.99513],[131.68466,45.12374],[131.66852,45.2196],[131.76532,45.22609],[131.86903,45.33636],[131.99417,45.2567],[132.83978,45.05916],[132.96373,45.0212],[133.12293,45.1332],[133.09279,45.25693],[133.19419,45.51913],[133.41083,45.57723],[133.48457,45.86203],[133.60442,45.90053],[133.67569,45.9759],[133.72695,46.05576],[133.68047,46.14697],[133.88097,46.25066],[133.91496,46.4274],[133.84104,46.46681],[134.03538,46.75668],[134.20016,47.33458],[134.50898,47.4812],[134.7671,47.72051],[134.55508,47.98651],[134.67098,48.1564],[134.75328,48.36763],[134.49516,48.42884],[132.66989,47.96491],[132.57309,47.71741],[131.90448,47.68011],[131.2635,47.73325],[131.09871,47.6852],[130.95985,47.6957],[130.90915,47.90623],[130.65103,48.10052],[130.84462,48.30942],[130.52147,48.61745],[130.66946,48.88251],[130.43232,48.90844],[130.2355,48.86741],[129.85416,49.11067],[129.67598,49.29596],[129.50685,49.42398],[129.40398,49.44194],[129.35317,49.3481],[129.23232,49.40353],[129.11153,49.36813],[128.72896,49.58676],[127.83476,49.5748],[127.53516,49.84306],[127.49299,50.01251],[127.60515,50.23503],[127.37384,50.28393],[127.36009,50.43787],[127.28765,50.46585],[127.36335,50.58306],[127.28165,50.72075],[127.14586,50.91152],[126.93135,51.0841],[126.90369,51.3238],[126.68349,51.70607],[126.44606,51.98254],[126.558,52.13738],[125.6131,53.07229]],[[113.56865,22.20973],[113.57123,22.20416],[113.60504,22.20464],[113.63011,22.10782],[113.57191,22.07696],[113.54839,22.10909],[113.54942,22.14519],[113.54093,22.15497],[113.52659,22.18271],[113.53552,22.20607],[113.53301,22.21235],[113.53591,22.21369],[113.54093,22.21314],[113.54333,22.21688],[113.5508,22.21672],[113.56865,22.20973]],[[114.50148,22.15017],[113.92195,22.13873],[113.83338,22.1826],[113.81621,22.2163],[113.86771,22.42972],[114.03113,22.5065],[114.05438,22.5026],[114.05729,22.51104],[114.06272,22.51617],[114.07267,22.51855],[114.07817,22.52997],[114.08606,22.53276],[114.09048,22.53716],[114.09692,22.53435],[114.1034,22.5352],[114.11181,22.52878],[114.11656,22.53415],[114.12665,22.54003],[114.13823,22.54319],[114.1482,22.54091],[114.15123,22.55163],[114.1597,22.56041],[114.17247,22.55944],[114.18338,22.55444],[114.20655,22.55706],[114.22185,22.55343],[114.22888,22.5436],[114.25154,22.55977],[114.44998,22.55977],[114.50148,22.15017]]]]}},{type:"Feature",properties:{wikidata:"Q22890",nameEn:"Ireland",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q23666",nameEn:"Great Britain",country:"GB",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q23681",nameEn:"Northern Cyprus",groups:["Q644636","145","142"],driveSide:"left",callingCodes:["90 392"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.67678,35.03866],[33.67742,35.05963],[33.68474,35.06602],[33.69095,35.06237],[33.70861,35.07644],[33.7161,35.07279],[33.70209,35.04882],[33.71482,35.03722],[33.73824,35.05321],[33.76106,35.04253],[33.78581,35.05104],[33.82067,35.07826],[33.84168,35.06823],[33.8541,35.07201],[33.87479,35.08881],[33.87097,35.09389],[33.87622,35.10457],[33.87224,35.12293],[33.88561,35.12449],[33.88943,35.12007],[33.88737,35.11408],[33.89853,35.11377],[33.91789,35.08688],[33.91299,35.07579],[33.90247,35.07686],[33.89485,35.06873],[33.88367,35.07877],[33.85261,35.0574],[33.8355,35.05777],[33.82051,35.0667],[33.8012,35.04786],[33.81524,35.04192],[33.83055,35.02865],[33.82875,35.01685],[33.84045,35.00616],[33.85216,35.00579],[33.85891,35.001],[33.85621,34.98956],[33.83505,34.98108],[33.84811,34.97075],[33.86432,34.97592],[33.90075,34.96623],[33.98684,34.76642],[35.48515,34.70851],[35.51152,36.10954],[32.82353,35.70297],[32.46489,35.48584],[32.60361,35.16647],[32.64864,35.19967],[32.70947,35.18328],[32.70779,35.14127],[32.85733,35.07742],[32.86406,35.1043],[32.94471,35.09422],[33.01192,35.15639],[33.08249,35.17319],[33.11105,35.15639],[33.15138,35.19504],[33.27068,35.16815],[33.3072,35.16816],[33.31955,35.18096],[33.35056,35.18328],[33.34964,35.17803],[33.35596,35.17942],[33.35612,35.17402],[33.36569,35.17479],[33.3717,35.1788],[33.37248,35.18698],[33.38575,35.2018],[33.4076,35.20062],[33.41675,35.16325],[33.46813,35.10564],[33.48136,35.0636],[33.47825,35.04103],[33.45178,35.02078],[33.45256,35.00288],[33.47666,35.00701],[33.48915,35.06594],[33.53975,35.08151],[33.57478,35.06049],[33.567,35.04803],[33.59658,35.03635],[33.61215,35.0527],[33.63765,35.03869],[33.67678,35.03866]]]]}},{type:"Feature",properties:{wikidata:"Q25231",nameEn:"Svalbard",aliases:["NO-21"],country:"NO",groups:["SJ","154","150","UN"],level:"subterritory",callingCodes:["47 79"]},geometry:{type:"MultiPolygon",coordinates:[[[[-7.49892,77.24208],[32.07813,72.01005],[36.85549,84.09565],[-7.49892,77.24208]]]]}},{type:"Feature",properties:{wikidata:"Q25263",nameEn:"Azores",aliases:["PT-20"],country:"PT",groups:["Q3320166","Q2914565","Q105472","EU","039","150","UN"],callingCodes:["351"]},geometry:{type:"MultiPolygon",coordinates:[[[[-23.12984,40.26428],[-36.43765,41.39418],[-22.54767,33.34416],[-23.12984,40.26428]]]]}},{type:"Feature",properties:{wikidata:"Q25359",nameEn:"Navassa Island",aliases:["UM-76"],country:"US",groups:["UM","Q1352230","029","003","419","019","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-74.7289,18.71009],[-75.71816,18.46438],[-74.76465,18.06252],[-74.7289,18.71009]]]]}},{type:"Feature",properties:{wikidata:"Q25396",nameEn:"Bonaire",aliases:["BQ-BO","NL-BQ1"],country:"NL",groups:["Q1451600","BQ","029","003","419","019","UN"],level:"subterritory",callingCodes:["599 7"]},geometry:{type:"MultiPolygon",coordinates:[[[[-67.89186,12.4116],[-68.90012,12.62309],[-68.33524,11.78151],[-68.01417,11.77722],[-67.89186,12.4116]]]]}},{type:"Feature",properties:{wikidata:"Q25528",nameEn:"Saba",aliases:["BQ-SA","NL-BQ2"],country:"NL",groups:["Q1451600","BQ","029","003","419","019","UN"],level:"subterritory",callingCodes:["599 4"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.07669,17.79659],[-63.81314,17.95045],[-63.22932,17.32592],[-63.07669,17.79659]]]]}},{type:"Feature",properties:{wikidata:"Q26180",nameEn:"Sint Eustatius",aliases:["BQ-SE","NL-BQ3"],country:"NL",groups:["Q1451600","BQ","029","003","419","019","UN"],level:"subterritory",callingCodes:["599 3"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.07669,17.79659],[-63.34999,16.94218],[-62.76692,17.64353],[-63.07669,17.79659]]]]}},{type:"Feature",properties:{wikidata:"Q26253",nameEn:"Madeira",aliases:["PT-30"],country:"PT",groups:["Q3320166","Q2914565","Q105472","EU","039","150","UN"],callingCodes:["351"]},geometry:{type:"MultiPolygon",coordinates:[[[[-19.30302,33.65304],[-16.04789,29.65076],[-11.68307,33.12333],[-19.30302,33.65304]]]]}},{type:"Feature",properties:{wikidata:"Q26927",nameEn:"Lakshadweep",aliases:["IN-LD"],country:"IN",groups:["034","142","UN"],driveSide:"left",callingCodes:["91"]},geometry:{type:"MultiPolygon",coordinates:[[[[67.64074,11.57295],[76.59015,5.591],[72.67494,13.58102],[67.64074,11.57295]]]]}},{type:"Feature",properties:{wikidata:"Q27329",nameEn:"Asian Russia",country:"RU",groups:["142","UN"],callingCodes:["7"]},geometry:{type:"MultiPolygon",coordinates:[[[[-179.99933,64.74703],[-172.76104,63.77445],[-169.03888,65.48473],[-168.95635,65.98512],[-168.25765,71.99091],[-179.9843,71.90735],[-179.99933,64.74703]]],[[[59.99809,51.98263],[60.19925,51.99173],[60.48915,52.15175],[60.72581,52.15538],[60.78201,52.22067],[61.05417,52.35096],[60.98021,52.50068],[60.84709,52.52228],[60.84118,52.63912],[60.71693,52.66245],[60.71989,52.75923],[61.05842,52.92217],[61.23462,53.03227],[62.0422,52.96105],[62.12799,52.99133],[62.14574,53.09626],[61.19024,53.30536],[61.14291,53.41481],[61.29082,53.50992],[61.37957,53.45887],[61.57185,53.50112],[61.55706,53.57144],[60.90626,53.62937],[61.22574,53.80268],[61.14283,53.90063],[60.99796,53.93699],[61.26863,53.92797],[61.3706,54.08464],[61.47603,54.08048],[61.56941,53.95703],[61.65318,54.02445],[62.03913,53.94768],[62.00966,54.04134],[62.38535,54.03961],[62.45931,53.90737],[62.56876,53.94047],[62.58651,54.05871],[63.80604,54.27079],[63.91224,54.20013],[64.02715,54.22679],[63.97686,54.29763],[64.97216,54.4212],[65.11033,54.33028],[65.24663,54.35721],[65.20174,54.55216],[68.21308,54.98645],[68.26661,55.09226],[68.19206,55.18823],[68.90865,55.38148],[69.34224,55.36344],[69.74917,55.35545],[70.19179,55.1476],[70.76493,55.3027],[70.96009,55.10558],[71.08288,54.71253],[71.24185,54.64965],[71.08706,54.33376],[71.10379,54.13326],[71.96141,54.17736],[72.17477,54.36303],[72.43415,53.92685],[72.71026,54.1161],[73.37963,53.96132],[73.74778,54.07194],[73.68921,53.86522],[73.25412,53.61532],[73.39218,53.44623],[75.07405,53.80831],[75.43398,53.98652],[75.3668,54.07439],[76.91052,54.4677],[76.82266,54.1798],[76.44076,54.16017],[76.54243,53.99329],[77.90383,53.29807],[79.11255,52.01171],[80.08138,50.77658],[80.4127,50.95581],[80.44819,51.20855],[80.80318,51.28262],[81.16999,51.15662],[81.06091,50.94833],[81.41248,50.97524],[81.46581,50.77658],[81.94999,50.79307],[82.55443,50.75412],[83.14607,51.00796],[83.8442,50.87375],[84.29385,50.27257],[84.99198,50.06793],[85.24047,49.60239],[86.18709,49.50259],[86.63674,49.80136],[86.79056,49.74787],[86.61307,49.60239],[86.82606,49.51796],[87.03071,49.25142],[87.31465,49.23603],[87.28386,49.11626],[87.478,49.07403],[87.48983,49.13794],[87.81333,49.17354],[87.98977,49.18147],[88.15543,49.30314],[88.17223,49.46934],[88.42449,49.48821],[88.82499,49.44808],[89.70687,49.72535],[89.59711,49.90851],[91.86048,50.73734],[92.07173,50.69585],[92.44714,50.78762],[93.01109,50.79001],[92.99595,50.63183],[94.30823,50.57498],[94.39258,50.22193],[94.49477,50.17832],[94.6121,50.04239],[94.97166,50.04725],[95.02465,49.96941],[95.74757,49.97915],[95.80056,50.04239],[96.97388,49.88413],[97.24639,49.74737],[97.56811,49.84265],[97.56432,49.92801],[97.76871,49.99861],[97.85197,49.91339],[98.29481,50.33561],[98.31373,50.4996],[98.06393,50.61262],[97.9693,50.78044],[98.01472,50.86652],[97.83305,51.00248],[98.05257,51.46696],[98.22053,51.46579],[98.33222,51.71832],[98.74142,51.8637],[98.87768,52.14563],[99.27888,51.96876],[99.75578,51.90108],[99.89203,51.74903],[100.61116,51.73028],[101.39085,51.45753],[101.5044,51.50467],[102.14032,51.35566],[102.32194,50.67982],[102.71178,50.38873],[103.70343,50.13952],[105.32528,50.4648],[106.05562,50.40582],[106.07865,50.33474],[106.47156,50.31909],[106.49628,50.32436],[106.51122,50.34408],[106.58373,50.34044],[106.80326,50.30177],[107.00007,50.1977],[107.1174,50.04239],[107.36407,49.97612],[107.96116,49.93191],[107.95387,49.66659],[108.27937,49.53167],[108.53969,49.32325],[109.18017,49.34709],[109.51325,49.22859],[110.24373,49.16676],[110.39891,49.25083],[110.64493,49.1816],[113.02647,49.60772],[113.20216,49.83356],[114.325,50.28098],[114.9703,50.19254],[115.26068,49.97367],[115.73602,49.87688],[116.22402,50.04477],[116.62502,49.92919],[116.71193,49.83813],[117.27597,49.62544],[117.48208,49.62324],[117.82343,49.52696],[118.61623,49.93809],[119.11003,50.00276],[119.27996,50.13348],[119.38598,50.35162],[119.13553,50.37412],[120.10963,51.671],[120.65907,51.93544],[120.77337,52.20805],[120.61346,52.32447],[120.71673,52.54099],[120.46454,52.63811],[120.04049,52.58773],[120.0451,52.7359],[120.85633,53.28499],[121.39213,53.31888],[122.35063,53.49565],[122.85966,53.47395],[123.26989,53.54843],[123.86158,53.49391],[124.46078,53.21881],[125.17522,53.20225],[125.6131,53.07229],[126.558,52.13738],[126.44606,51.98254],[126.68349,51.70607],[126.90369,51.3238],[126.93135,51.0841],[127.14586,50.91152],[127.28165,50.72075],[127.36335,50.58306],[127.28765,50.46585],[127.36009,50.43787],[127.37384,50.28393],[127.60515,50.23503],[127.49299,50.01251],[127.53516,49.84306],[127.83476,49.5748],[128.72896,49.58676],[129.11153,49.36813],[129.23232,49.40353],[129.35317,49.3481],[129.40398,49.44194],[129.50685,49.42398],[129.67598,49.29596],[129.85416,49.11067],[130.2355,48.86741],[130.43232,48.90844],[130.66946,48.88251],[130.52147,48.61745],[130.84462,48.30942],[130.65103,48.10052],[130.90915,47.90623],[130.95985,47.6957],[131.09871,47.6852],[131.2635,47.73325],[131.90448,47.68011],[132.57309,47.71741],[132.66989,47.96491],[134.49516,48.42884],[134.75328,48.36763],[134.67098,48.1564],[134.55508,47.98651],[134.7671,47.72051],[134.50898,47.4812],[134.20016,47.33458],[134.03538,46.75668],[133.84104,46.46681],[133.91496,46.4274],[133.88097,46.25066],[133.68047,46.14697],[133.72695,46.05576],[133.67569,45.9759],[133.60442,45.90053],[133.48457,45.86203],[133.41083,45.57723],[133.19419,45.51913],[133.09279,45.25693],[133.12293,45.1332],[132.96373,45.0212],[132.83978,45.05916],[131.99417,45.2567],[131.86903,45.33636],[131.76532,45.22609],[131.66852,45.2196],[131.68466,45.12374],[131.48415,44.99513],[130.95639,44.85154],[131.1108,44.70266],[131.30365,44.04262],[131.25484,44.03131],[131.23583,43.96085],[131.26176,43.94011],[131.21105,43.82383],[131.19492,43.53047],[131.29402,43.46695],[131.30324,43.39498],[131.19031,43.21385],[131.20414,43.13654],[131.10274,43.04734],[131.135,42.94114],[131.02668,42.91246],[131.02438,42.86518],[130.66524,42.84753],[130.44361,42.76205],[130.40213,42.70788],[130.56576,42.68925],[130.62107,42.58413],[130.55143,42.52158],[130.56835,42.43281],[130.60805,42.4317],[130.64181,42.41422],[130.66367,42.38024],[130.65022,42.32281],[131.95041,41.5445],[140.9182,45.92937],[145.82343,44.571],[145.23667,43.76813],[153.94307,38.42848],[180,62.52334],[180,71.53642],[155.31937,81.93282],[76.13964,83.37843],[64.18965,69.94255],[66.1708,67.61252],[61.98014,65.72191],[60.74386,64.95767],[59.63945,64.78384],[59.80579,64.13948],[59.24834,63.01859],[59.61398,62.44915],[59.36223,61.3882],[59.50685,60.91162],[58.3853,59.487],[59.15636,59.14682],[59.40376,58.45822],[58.71104,58.07475],[58.81412,57.71602],[58.13789,57.68097],[58.07604,57.08308],[57.28024,56.87898],[57.51527,56.08729],[59.28419,56.15739],[59.49035,55.60486],[58.81825,55.03378],[57.25137,55.26262],[57.14829,54.84204],[57.95234,54.39672],[59.95217,54.85853],[59.70487,54.14846],[58.94336,53.953],[58.79644,52.43392],[59.22409,52.28437],[59.25033,52.46803],[60.17516,52.39457],[60.17253,52.25814],[59.91279,52.06924],[59.99809,51.98263]]]]}},{type:"Feature",properties:{wikidata:"Q34366",nameEn:"Tasmania",aliases:["AU-TAS"],country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[123.64533,-39.13605],[159.69067,-56.28945],[159.74028,-39.1978],[123.64533,-39.13605]]]]}},{type:"Feature",properties:{wikidata:"Q34497",nameEn:"Saint Helena",aliases:["SH-HL"],country:"GB",groups:["SH","BOTS","011","202","002","UN"],level:"subterritory",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["290"]},geometry:{type:"MultiPolygon",coordinates:[[[[-8.3824,-13.9131],[-6.17428,-19.07236],[-3.29308,-15.22647],[-8.3824,-13.9131]]]]}},{type:"Feature",properties:{wikidata:"Q35657",nameEn:"US States",country:"US",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q36117",nameEn:"Borneo",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q36678",nameEn:"West Bank",country:"PS",groups:["145","142"],callingCodes:["970"]},geometry:{type:"MultiPolygon",coordinates:[[[[35.47672,31.49578],[35.55941,31.76535],[35.52758,31.9131],[35.54375,31.96587],[35.52012,32.04076],[35.57111,32.21877],[35.55807,32.38674],[35.42078,32.41562],[35.41048,32.43706],[35.41598,32.45593],[35.42034,32.46009],[35.40224,32.50136],[35.35212,32.52047],[35.30685,32.51024],[35.29306,32.50947],[35.25049,32.52453],[35.2244,32.55289],[35.15937,32.50466],[35.10882,32.4757],[35.10024,32.47856],[35.09236,32.47614],[35.08564,32.46948],[35.07059,32.4585],[35.05423,32.41754],[35.05311,32.4024],[35.0421,32.38242],[35.05142,32.3667],[35.04243,32.35008],[35.01772,32.33863],[35.01119,32.28684],[35.02939,32.2671],[35.01841,32.23981],[34.98885,32.20758],[34.95703,32.19522],[34.96009,32.17503],[34.99039,32.14626],[34.98507,32.12606],[34.99437,32.10962],[34.9863,32.09551],[35.00261,32.027],[34.98682,31.96935],[35.00124,31.93264],[35.03489,31.92448],[35.03978,31.89276],[35.03489,31.85919],[34.99712,31.85569],[34.9724,31.83352],[35.01978,31.82944],[35.05617,31.85685],[35.07677,31.85627],[35.14174,31.81325],[35.18603,31.80901],[35.18169,31.82542],[35.19461,31.82687],[35.21469,31.81835],[35.216,31.83894],[35.21128,31.863],[35.20381,31.86716],[35.20673,31.88151],[35.20791,31.8821],[35.20945,31.8815],[35.21016,31.88237],[35.21276,31.88153],[35.2136,31.88241],[35.22014,31.88264],[35.22294,31.87889],[35.22567,31.86745],[35.22817,31.8638],[35.2249,31.85433],[35.2304,31.84222],[35.24816,31.8458],[35.25753,31.8387],[35.251,31.83085],[35.26404,31.82567],[35.25573,31.81362],[35.26058,31.79064],[35.25225,31.7678],[35.26319,31.74846],[35.25182,31.73945],[35.24981,31.72543],[35.2438,31.7201],[35.24315,31.71244],[35.23972,31.70896],[35.22392,31.71899],[35.21937,31.71578],[35.20538,31.72388],[35.18023,31.72067],[35.16478,31.73242],[35.15474,31.73352],[35.15119,31.73634],[35.13931,31.73012],[35.12933,31.7325],[35.11895,31.71454],[35.10782,31.71594],[35.08226,31.69107],[35.00879,31.65426],[34.95249,31.59813],[34.9415,31.55601],[34.94356,31.50743],[34.93258,31.47816],[34.89756,31.43891],[34.87833,31.39321],[34.88932,31.37093],[34.92571,31.34337],[35.02459,31.35979],[35.13033,31.3551],[35.22921,31.37445],[35.39675,31.49572],[35.47672,31.49578]]]]}},{type:"Feature",properties:{wikidata:"Q37362",nameEn:"Akrotiri and Dhekelia",aliases:["SBA"],country:"GB"},geometry:null},{type:"Feature",properties:{wikidata:"Q38095",nameEn:"Gal\xE1pagos Islands",aliases:["EC-W"],country:"EC",groups:["005","419","019","UN"],callingCodes:["593"]},geometry:{type:"MultiPolygon",coordinates:[[[[-93.12365,2.64343],[-92.46744,-2.52874],[-87.07749,-.8849],[-93.12365,2.64343]]]]}},{type:"Feature",properties:{wikidata:"Q39760",nameEn:"Gaza Strip",country:"PS",groups:["145","142"],callingCodes:["970"]},geometry:{type:"MultiPolygon",coordinates:[[[[34.052,31.46619],[34.21853,31.32363],[34.23572,31.2966],[34.24012,31.29591],[34.26742,31.21998],[34.29417,31.24194],[34.36523,31.28963],[34.37381,31.30598],[34.36505,31.36404],[34.40077,31.40926],[34.48892,31.48365],[34.56797,31.54197],[34.48681,31.59711],[34.29262,31.70393],[34.052,31.46619]]]]}},{type:"Feature",properties:{wikidata:"Q40888",nameEn:"Andaman and Nicobar Islands",aliases:["IN-AN"],country:"IN",groups:["034","142","UN"],driveSide:"left",callingCodes:["91"]},geometry:{type:"MultiPolygon",coordinates:[[[[94.42132,5.96581],[94.6371,13.81803],[86.7822,13.41052],[94.42132,5.96581]]]]}},{type:"Feature",properties:{wikidata:"Q41684",nameEn:"Stewart Island",country:"NZ",groups:["053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[166.59185,-47.61313],[169.70504,-47.56021],[167.52103,-46.41337],[166.59185,-47.61313]]]]}},{type:"Feature",properties:{wikidata:"Q43296",nameEn:"Wake Island",aliases:["WK","WAK","WKUM","872","UM-79"],country:"US",groups:["UM","Q1352230","057","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[167.34779,18.97692],[166.67967,20.14834],[165.82549,18.97692],[167.34779,18.97692]]]]}},{type:"Feature",properties:{wikidata:"Q46275",nameEn:"New Zealand Subantarctic Islands",country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left"},geometry:{type:"MultiPolygon",coordinates:[[[[164.30551,-47.88072],[161.96603,-56.07661],[179.49541,-50.04657],[179.49541,-47.2902],[169.91032,-47.66283],[164.30551,-47.88072]]]]}},{type:"Feature",properties:{wikidata:"Q46395",nameEn:"British Overseas Territories",aliases:["BOTS","UKOTS"],country:"GB",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q46772",nameEn:"Kerguelen Islands",country:"FR",groups:["EU","TF","Q1451600","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[61.9216,-49.39746],[70.67507,-51.14192],[74.25129,-45.45074],[61.9216,-49.39746]]]]}},{type:"Feature",properties:{wikidata:"Q46879",nameEn:"Baker Island",aliases:["UM-81"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-175.33482,-1.40631],[-175.31323,.5442],[-177.91421,.39582],[-175.33482,-1.40631]]]]}},{type:"Feature",properties:{wikidata:"Q47863",nameEn:"Midway Atoll",aliases:["MI","MID","MIUM","488","UM-71"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-176.29741,29.09786],[-177.77531,29.29793],[-177.5224,27.7635],[-176.29741,29.09786]]]]}},{type:"Feature",properties:{wikidata:"Q62218",nameEn:"Jarvis Island",aliases:["UM-86"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-160.42921,-1.4364],[-159.12443,.19975],[-160.38779,.30331],[-160.42921,-1.4364]]]]}},{type:"Feature",properties:{wikidata:"Q105472",nameEn:"Macaronesia",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q114935",nameEn:"Kermadec Islands",country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[-174.40891,-29.09438],[-180,-24.21376],[-179.96512,-35.00791],[-174.40891,-29.09438]]]]}},{type:"Feature",properties:{wikidata:"Q115459",nameEn:"Chatham Islands",aliases:["NZ-CIT"],country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[-179.93224,-45.18423],[-172.47015,-45.17912],[-176.30998,-41.38382],[-179.93224,-45.18423]]]]}},{type:"Feature",properties:{wikidata:"Q118863",nameEn:"North Island",country:"NZ",groups:["053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[179.49541,-47.2902],[179.49541,-36.79303],[174.17679,-32.62487],[170.27492,-36.38133],[174.58663,-40.80446],[174.46634,-41.55028],[179.49541,-47.2902]]]]}},{type:"Feature",properties:{wikidata:"Q120755",nameEn:"South Island",country:"NZ",groups:["053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[169.70504,-47.56021],[179.49541,-47.2902],[174.46634,-41.55028],[174.58663,-40.80446],[170.27492,-36.38133],[166.56976,-39.94841],[164.8365,-46.0205],[167.52103,-46.41337],[169.70504,-47.56021]]]]}},{type:"Feature",properties:{wikidata:"Q123076",nameEn:"Palmyra Atoll",aliases:["UM-95"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-161.06795,5.2462],[-161.0731,7.1291],[-163.24478,5.24198],[-161.06795,5.2462]]]]}},{type:"Feature",properties:{wikidata:"Q130574",nameEn:"Chafarinas Islands",country:"ES",groups:["EU","Q191011","015","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[-2.40316,35.16893],[-2.43262,35.20652],[-2.45965,35.16527],[-2.40316,35.16893]]]]}},{type:"Feature",properties:{wikidata:"Q130895",nameEn:"Kingman Reef",aliases:["UM-89"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-161.0731,7.1291],[-163.16627,7.15036],[-163.24478,5.24198],[-161.0731,7.1291]]]]}},{type:"Feature",properties:{wikidata:"Q131008",nameEn:"Johnston Atoll",aliases:["JT","JTN","JTUM","396","UM-67"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-170.65691,16.57199],[-168.87689,16.01159],[-169.2329,17.4933],[-170.65691,16.57199]]]]}},{type:"Feature",properties:{wikidata:"Q131305",nameEn:"Howland Island",aliases:["UM-84"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-177.91421,.39582],[-175.31323,.5442],[-176.74464,2.28109],[-177.91421,.39582]]]]}},{type:"Feature",properties:{wikidata:"Q133888",nameEn:"Ashmore and Cartier Islands",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[123.7463,-11.1783],[120.6877,-13.59408],[125.29076,-12.33139],[123.7463,-11.1783]]]]}},{type:"Feature",properties:{wikidata:"Q153732",nameEn:"Mariana Islands",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q172216",nameEn:"Coral Sea Islands",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[159.77159,-28.41151],[156.73836,-14.50464],[145.2855,-9.62524],[147.69992,-17.5933],[152.93188,-20.92631],[154.02855,-24.43238],[159.77159,-28.41151]]]]}},{type:"Feature",properties:{wikidata:"Q179313",nameEn:"Alderney",country:"GB",groups:["GG","830","Q185086","154","150","UN"],level:"subterritory",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01481"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.36485,49.48223],[-2.09454,49.46288],[-2.02963,49.91866],[-2.49556,49.79012],[-2.36485,49.48223]]]]}},{type:"Feature",properties:{wikidata:"Q185086",nameEn:"Crown Dependencies",country:"GB",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q190571",nameEn:"Scattered Islands",country:"FR",groups:["EU","TF","Q1451600","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[53.53458,-16.36909],[54.96649,-16.28353],[54.61476,-15.02273],[53.53458,-16.36909]]],[[[38.55969,-20.75596],[40.68027,-23.38889],[43.52893,-15.62903],[38.55969,-20.75596]]],[[[47.03092,-11.05648],[47.11593,-12.08552],[47.96702,-11.46447],[47.03092,-11.05648]]]]}},{type:"Feature",properties:{wikidata:"Q191011",nameEn:"Plazas de soberan\xEDa",country:"ES"},geometry:null},{type:"Feature",properties:{wikidata:"Q191146",nameEn:"Pe\xF1\xF3n de V\xE9lez de la Gomera",country:"ES",groups:["EU","Q191011","015","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[-4.30191,35.17419],[-4.30112,35.17058],[-4.29436,35.17149],[-4.30191,35.17419]]]]}},{type:"Feature",properties:{wikidata:"Q201698",nameEn:"Crozet Islands",country:"FR",groups:["EU","TF","Q1451600","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[55.03425,-43.65017],[46.31615,-46.28749],[54.5587,-47.93013],[55.03425,-43.65017]]]]}},{type:"Feature",properties:{wikidata:"Q578170",nameEn:"Contiguous United States",aliases:["CONUS"],country:"US",groups:["Q35657","021","003","019","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-97.13927,25.96583],[-96.92418,25.97377],[-80.57035,24.0565],[-78.91214,27.76553],[-61.98255,37.34815],[-67.16117,44.20069],[-66.93432,44.82597],[-66.96824,44.83078],[-66.98249,44.87071],[-66.96824,44.90965],[-67.0216,44.95333],[-67.11316,45.11176],[-67.15965,45.16179],[-67.19603,45.16771],[-67.20349,45.1722],[-67.22751,45.16344],[-67.27039,45.1934],[-67.29748,45.18173],[-67.29754,45.14865],[-67.34927,45.122],[-67.48201,45.27351],[-67.42394,45.37969],[-67.50578,45.48971],[-67.42144,45.50584],[-67.43815,45.59162],[-67.6049,45.60725],[-67.80705,45.69528],[-67.80653,45.80022],[-67.75654,45.82324],[-67.80961,45.87531],[-67.75196,45.91814],[-67.78111,45.9392],[-67.78578,47.06473],[-67.87993,47.10377],[-67.94843,47.1925],[-68.23244,47.35712],[-68.37458,47.35851],[-68.38332,47.28723],[-68.57914,47.28431],[-68.60575,47.24659],[-68.70125,47.24399],[-68.89222,47.1807],[-69.05039,47.2456],[-69.05073,47.30076],[-69.05148,47.42012],[-69.22119,47.46461],[-69.99966,46.69543],[-70.05812,46.41768],[-70.18547,46.35357],[-70.29078,46.18832],[-70.23855,46.1453],[-70.31025,45.96424],[-70.24694,45.95138],[-70.25976,45.89675],[-70.41523,45.79497],[-70.38934,45.73215],[-70.54019,45.67291],[-70.68516,45.56964],[-70.72651,45.49771],[-70.62518,45.42286],[-70.65383,45.37592],[-70.78372,45.43269],[-70.82638,45.39828],[-70.80236,45.37444],[-70.84816,45.22698],[-70.89864,45.2398],[-70.91169,45.29849],[-70.95193,45.33895],[-71.0107,45.34819],[-71.01866,45.31573],[-71.08364,45.30623],[-71.14568,45.24128],[-71.19723,45.25438],[-71.22338,45.25184],[-71.29371,45.29996],[-71.37133,45.24624],[-71.44252,45.2361],[-71.40364,45.21382],[-71.42778,45.12624],[-71.48735,45.07784],[-71.50067,45.01357],[-73.35025,45.00942],[-74.32699,44.99029],[-74.66689,45.00646],[-74.8447,45.00606],[-74.99101,44.98051],[-75.01363,44.95608],[-75.2193,44.87821],[-75.41441,44.76614],[-75.76813,44.51537],[-75.8217,44.43176],[-75.95947,44.34463],[-76.00018,44.34896],[-76.16285,44.28262],[-76.1664,44.23051],[-76.244,44.19643],[-76.31222,44.19894],[-76.35324,44.13493],[-76.43859,44.09393],[-76.79706,43.63099],[-79.25796,43.54052],[-79.06921,43.26183],[-79.05512,43.25375],[-79.05544,43.21224],[-79.05002,43.20133],[-79.05384,43.17418],[-79.04652,43.16396],[-79.0427,43.13934],[-79.06881,43.12029],[-79.05671,43.10937],[-79.07486,43.07845],[-79.01055,43.06659],[-78.99941,43.05612],[-79.02424,43.01983],[-79.02074,42.98444],[-78.98126,42.97],[-78.96312,42.95509],[-78.93224,42.95229],[-78.90905,42.93022],[-78.90712,42.89733],[-78.93684,42.82887],[-82.67862,41.67615],[-83.11184,41.95671],[-83.14962,42.04089],[-83.12724,42.2376],[-83.09837,42.28877],[-83.07837,42.30978],[-83.02253,42.33045],[-82.82964,42.37355],[-82.64242,42.55594],[-82.58873,42.54984],[-82.57583,42.5718],[-82.51858,42.611],[-82.51063,42.66025],[-82.46613,42.76615],[-82.4826,42.8068],[-82.45331,42.93139],[-82.4253,42.95423],[-82.4146,42.97626],[-82.42469,42.992],[-82.48419,45.30225],[-83.59589,45.82131],[-83.43746,45.99749],[-83.57017,46.105],[-83.83329,46.12169],[-83.90453,46.05922],[-83.95399,46.05634],[-84.1096,46.23987],[-84.09756,46.25512],[-84.11615,46.2681],[-84.11254,46.32329],[-84.13451,46.39218],[-84.11196,46.50248],[-84.12885,46.53068],[-84.17723,46.52753],[-84.1945,46.54061],[-84.2264,46.53337],[-84.26351,46.49508],[-84.29893,46.49127],[-84.34174,46.50683],[-84.42101,46.49853],[-84.4481,46.48972],[-84.47607,46.45225],[-84.55635,46.45974],[-84.85871,46.88881],[-88.37033,48.30586],[-89.48837,48.01412],[-89.57972,48.00023],[-89.77248,48.02607],[-89.89974,47.98109],[-90.07418,48.11043],[-90.56312,48.09488],[-90.56444,48.12184],[-90.75045,48.09143],[-90.87588,48.2484],[-91.08016,48.18096],[-91.25025,48.08522],[-91.43248,48.04912],[-91.45829,48.07454],[-91.58025,48.04339],[-91.55649,48.10611],[-91.70451,48.11805],[-91.71231,48.19875],[-91.86125,48.21278],[-91.98929,48.25409],[-92.05339,48.35958],[-92.14732,48.36578],[-92.202,48.35252],[-92.26662,48.35651],[-92.30939,48.31251],[-92.27167,48.25046],[-92.37185,48.22259],[-92.48147,48.36609],[-92.45588,48.40624],[-92.50712,48.44921],[-92.65606,48.43471],[-92.71323,48.46081],[-92.69927,48.49573],[-92.62747,48.50278],[-92.6342,48.54133],[-92.7287,48.54005],[-92.94973,48.60866],[-93.25391,48.64266],[-93.33946,48.62787],[-93.3712,48.60599],[-93.39758,48.60364],[-93.40693,48.60948],[-93.44472,48.59147],[-93.47022,48.54357],[-93.66382,48.51845],[-93.79267,48.51631],[-93.80939,48.52439],[-93.80676,48.58232],[-93.83288,48.62745],[-93.85769,48.63284],[-94.23215,48.65202],[-94.25104,48.65729],[-94.25172,48.68404],[-94.27153,48.70232],[-94.4174,48.71049],[-94.44258,48.69223],[-94.53826,48.70216],[-94.54885,48.71543],[-94.58903,48.71803],[-94.69335,48.77883],[-94.69669,48.80918],[-94.70486,48.82365],[-94.70087,48.8339],[-94.687,48.84077],[-94.75017,49.09931],[-94.77355,49.11998],[-94.82487,49.29483],[-94.8159,49.32299],[-94.85381,49.32492],[-94.95681,49.37035],[-94.99532,49.36579],[-95.01419,49.35647],[-95.05825,49.35311],[-95.12903,49.37056],[-95.15357,49.384],[-95.15355,48.9996],[-123.32163,49.00419],[-123.0093,48.83186],[-123.0093,48.76586],[-123.26565,48.6959],[-123.15614,48.35395],[-123.50039,48.21223],[-125.03842,48.53282],[-133.98258,38.06389],[-118.48109,32.5991],[-117.1243,32.53427],[-115.88053,32.63624],[-114.71871,32.71894],[-114.76736,32.64094],[-114.80584,32.62028],[-114.81141,32.55543],[-114.79524,32.55731],[-114.82011,32.49609],[-111.07523,31.33232],[-108.20979,31.33316],[-108.20899,31.78534],[-106.529,31.784],[-106.52266,31.77509],[-106.51251,31.76922],[-106.50962,31.76155],[-106.50111,31.75714],[-106.48815,31.74769],[-106.47298,31.75054],[-106.46726,31.75998],[-106.45244,31.76523],[-106.43419,31.75478],[-106.41773,31.75196],[-106.38003,31.73151],[-106.3718,31.71165],[-106.34864,31.69663],[-106.33419,31.66303],[-106.30305,31.62154],[-106.28084,31.56173],[-106.24612,31.54193],[-106.23711,31.51262],[-106.20346,31.46305],[-106.09025,31.40569],[-106.00363,31.39181],[-104.77674,30.4236],[-104.5171,29.64671],[-104.3969,29.57105],[-104.39363,29.55396],[-104.37752,29.54255],[-103.15787,28.93865],[-102.60596,29.8192],[-101.47277,29.7744],[-101.05686,29.44738],[-101.01128,29.36947],[-100.96725,29.3477],[-100.94579,29.34523],[-100.94056,29.33371],[-100.87982,29.296],[-100.79696,29.24688],[-100.67294,29.09744],[-100.63689,28.90812],[-100.59809,28.88197],[-100.52313,28.75598],[-100.5075,28.74066],[-100.51222,28.70679],[-100.50029,28.66117],[-99.55409,27.61314],[-99.51478,27.55836],[-99.52955,27.49747],[-99.50208,27.50021],[-99.48045,27.49016],[-99.482,27.47128],[-99.49744,27.43746],[-99.53573,27.30926],[-99.08477,26.39849],[-99.03053,26.41249],[-99.00546,26.3925],[-98.35126,26.15129],[-98.30491,26.10475],[-98.27075,26.09457],[-98.24603,26.07191],[-97.97017,26.05232],[-97.95155,26.0625],[-97.66511,26.01708],[-97.52025,25.88518],[-97.49828,25.89877],[-97.45669,25.86874],[-97.42511,25.83969],[-97.37332,25.83854],[-97.35946,25.92189],[-97.13927,25.96583]]]]}},{type:"Feature",properties:{wikidata:"Q620634",nameEn:"Bir Tawil",groups:["015","002"],level:"territory"},geometry:{type:"MultiPolygon",coordinates:[[[[33.17563,22.00405],[33.57251,21.72406],[33.99686,21.76784],[34.0765,22.00501],[33.17563,22.00405]]]]}},{type:"Feature",properties:{wikidata:"Q639185",nameEn:"Peros Banhos",country:"GB",groups:["IO","BOTS","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[72.12587,-4.02588],[70.1848,-6.37445],[72.09518,-5.61768],[72.12587,-4.02588]]]]}},{type:"Feature",properties:{wikidata:"Q644636",nameEn:"Cyprus",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q851132",nameEn:"New Zealand Outlying Islands",country:"NZ",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q875134",nameEn:"European Russia",country:"RU",groups:["151","150","UN"],callingCodes:["7"]},geometry:{type:"MultiPolygon",coordinates:[[[[18.57853,55.25302],[19.64312,54.45423],[19.8038,54.44203],[20.63871,54.3706],[21.41123,54.32395],[22.79705,54.36264],[22.7253,54.41732],[22.70208,54.45312],[22.67788,54.532],[22.71293,54.56454],[22.68021,54.58486],[22.7522,54.63525],[22.74225,54.64339],[22.75467,54.6483],[22.73397,54.66604],[22.73631,54.72952],[22.87317,54.79492],[22.85083,54.88711],[22.76422,54.92521],[22.68723,54.9811],[22.65451,54.97037],[22.60075,55.01863],[22.58907,55.07085],[22.47688,55.04408],[22.31562,55.0655],[22.14267,55.05345],[22.11697,55.02131],[22.06087,55.02935],[22.02582,55.05078],[22.03984,55.07888],[21.99543,55.08691],[21.96505,55.07353],[21.85521,55.09493],[21.64954,55.1791],[21.55605,55.20311],[21.51095,55.18507],[21.46766,55.21115],[21.38446,55.29348],[21.35465,55.28427],[21.26425,55.24456],[20.95181,55.27994],[20.60454,55.40986],[18.57853,55.25302]]],[[[26.32936,60.00121],[26.90044,59.63819],[27.85643,59.58538],[28.04187,59.47017],[28.19061,59.39962],[28.21137,59.38058],[28.20537,59.36491],[28.19284,59.35791],[28.14215,59.28934],[28.00689,59.28351],[27.90911,59.24353],[27.87978,59.18097],[27.80482,59.1116],[27.74429,58.98351],[27.36366,58.78381],[27.55489,58.39525],[27.48541,58.22615],[27.62393,58.09462],[27.67282,57.92627],[27.81841,57.89244],[27.78526,57.83963],[27.56689,57.83356],[27.50171,57.78842],[27.52615,57.72843],[27.3746,57.66834],[27.40393,57.62125],[27.31919,57.57672],[27.34698,57.52242],[27.56832,57.53728],[27.52453,57.42826],[27.86101,57.29402],[27.66511,56.83921],[27.86101,56.88204],[28.04768,56.59004],[28.13526,56.57989],[28.10069,56.524],[28.19057,56.44637],[28.16599,56.37806],[28.23716,56.27588],[28.15217,56.16964],[28.30571,56.06035],[28.36888,56.05805],[28.37987,56.11399],[28.43068,56.09407],[28.5529,56.11705],[28.68337,56.10173],[28.63668,56.07262],[28.73418,55.97131],[29.08299,56.03427],[29.21717,55.98971],[29.44692,55.95978],[29.3604,55.75862],[29.51283,55.70294],[29.61446,55.77716],[29.80672,55.79569],[29.97975,55.87281],[30.12136,55.8358],[30.27776,55.86819],[30.30987,55.83592],[30.48257,55.81066],[30.51346,55.78982],[30.51037,55.76568],[30.63344,55.73079],[30.67464,55.64176],[30.72957,55.66268],[30.7845,55.58514],[30.86003,55.63169],[30.93419,55.6185],[30.95204,55.50667],[30.90123,55.46621],[30.93144,55.3914],[30.8257,55.3313],[30.81946,55.27931],[30.87944,55.28223],[30.97369,55.17134],[31.02071,55.06167],[31.00972,55.02783],[30.94243,55.03964],[30.9081,55.02232],[30.95754,54.98609],[30.93144,54.9585],[30.81759,54.94064],[30.8264,54.90062],[30.75165,54.80699],[30.95479,54.74346],[30.97127,54.71967],[31.0262,54.70698],[30.98226,54.68872],[30.99187,54.67046],[31.19339,54.66947],[31.21399,54.63113],[31.08543,54.50361],[31.22945,54.46585],[31.3177,54.34067],[31.30791,54.25315],[31.57002,54.14535],[31.89599,54.0837],[31.88744,54.03653],[31.85019,53.91801],[31.77028,53.80015],[31.89137,53.78099],[32.12621,53.81586],[32.36663,53.7166],[32.45717,53.74039],[32.50112,53.68594],[32.40499,53.6656],[32.47777,53.5548],[32.74968,53.45597],[32.73257,53.33494],[32.51725,53.28431],[32.40773,53.18856],[32.15368,53.07594],[31.82373,53.10042],[31.787,53.18033],[31.62496,53.22886],[31.56316,53.19432],[31.40523,53.21406],[31.36403,53.13504],[31.3915,53.09712],[31.33519,53.08805],[31.32283,53.04101],[31.24147,53.031],[31.35667,52.97854],[31.592,52.79011],[31.57277,52.71613],[31.50406,52.69707],[31.63869,52.55361],[31.56316,52.51518],[31.61397,52.48843],[31.62084,52.33849],[31.57971,52.32146],[31.70735,52.26711],[31.6895,52.1973],[31.77877,52.18636],[31.7822,52.11406],[31.81722,52.09955],[31.85018,52.11305],[31.96141,52.08015],[31.92159,52.05144],[32.08813,52.03319],[32.23331,52.08085],[32.2777,52.10266],[32.34044,52.1434],[32.33083,52.23685],[32.38988,52.24946],[32.3528,52.32842],[32.54781,52.32423],[32.69475,52.25535],[32.85405,52.27888],[32.89937,52.2461],[33.18913,52.3754],[33.51323,52.35779],[33.48027,52.31499],[33.55718,52.30324],[33.78789,52.37204],[34.05239,52.20132],[34.11199,52.14087],[34.09413,52.00835],[34.41136,51.82793],[34.42922,51.72852],[34.07765,51.67065],[34.17599,51.63253],[34.30562,51.5205],[34.22048,51.4187],[34.33446,51.363],[34.23009,51.26429],[34.31661,51.23936],[34.38802,51.2746],[34.6613,51.25053],[34.6874,51.18],[34.82472,51.17483],[34.97304,51.2342],[35.14058,51.23162],[35.12685,51.16191],[35.20375,51.04723],[35.31774,51.08434],[35.40837,51.04119],[35.32598,50.94524],[35.39307,50.92145],[35.41367,50.80227],[35.47704,50.77274],[35.48116,50.66405],[35.39464,50.64751],[35.47463,50.49247],[35.58003,50.45117],[35.61711,50.35707],[35.73659,50.35489],[35.80388,50.41356],[35.8926,50.43829],[36.06893,50.45205],[36.20763,50.3943],[36.30101,50.29088],[36.47817,50.31457],[36.58371,50.28563],[36.56655,50.2413],[36.64571,50.218],[36.69377,50.26982],[36.91762,50.34963],[37.08468,50.34935],[37.48204,50.46079],[37.47243,50.36277],[37.62486,50.29966],[37.62879,50.24481],[37.61113,50.21976],[37.75807,50.07896],[37.79515,50.08425],[37.90776,50.04194],[38.02999,49.94482],[38.02999,49.90592],[38.21675,49.98104],[38.18517,50.08161],[38.32524,50.08866],[38.35408,50.00664],[38.65688,49.97176],[38.68677,50.00904],[38.73311,49.90238],[38.90477,49.86787],[38.9391,49.79524],[39.1808,49.88911],[39.27968,49.75976],[39.44496,49.76067],[39.59142,49.73758],[39.65047,49.61761],[39.84548,49.56064],[40.13249,49.61672],[40.16683,49.56865],[40.03636,49.52321],[40.03087,49.45452],[40.1141,49.38798],[40.14912,49.37681],[40.18331,49.34996],[40.22176,49.25683],[40.01988,49.1761],[39.93437,49.05709],[39.6836,49.05121],[39.6683,48.99454],[39.71353,48.98959],[39.72649,48.9754],[39.74874,48.98675],[39.78368,48.91596],[39.98967,48.86901],[40.03636,48.91957],[40.08168,48.87443],[39.97182,48.79398],[39.79466,48.83739],[39.73104,48.7325],[39.71765,48.68673],[39.67226,48.59368],[39.79764,48.58668],[39.84548,48.57821],[39.86196,48.46633],[39.88794,48.44226],[39.94847,48.35055],[39.84136,48.33321],[39.84273,48.30947],[39.90041,48.3049],[39.91465,48.26743],[39.95248,48.29972],[39.9693,48.29904],[39.97325,48.31399],[39.99241,48.31768],[40.00752,48.22445],[39.94847,48.22811],[39.83724,48.06501],[39.88256,48.04482],[39.77544,48.04206],[39.82213,47.96396],[39.73935,47.82876],[38.87979,47.87719],[38.79628,47.81109],[38.76379,47.69346],[38.35062,47.61631],[38.28679,47.53552],[38.28954,47.39255],[38.22225,47.30788],[38.33074,47.30508],[38.32112,47.2585],[38.23049,47.2324],[38.22955,47.12069],[38.3384,46.98085],[38.12112,46.86078],[37.62608,46.82615],[35.23066,45.79231],[35.04991,45.76827],[36.6645,45.4514],[36.6545,45.3417],[36.5049,45.3136],[36.475,45.2411],[36.4883,45.0488],[33.5943,44.03313],[39.81147,43.06294],[40.0078,43.38551],[40.00853,43.40578],[40.01552,43.42025],[40.01007,43.42411],[40.03312,43.44262],[40.04445,43.47776],[40.10657,43.57344],[40.65957,43.56212],[41.64935,43.22331],[42.40563,43.23226],[42.66667,43.13917],[42.75889,43.19651],[43.03322,43.08883],[43.0419,43.02413],[43.81453,42.74297],[43.73119,42.62043],[43.95517,42.55396],[44.54202,42.75699],[44.70002,42.74679],[44.80941,42.61277],[44.88754,42.74934],[45.15318,42.70598],[45.36501,42.55268],[45.78692,42.48358],[45.61676,42.20768],[46.42738,41.91323],[46.5332,41.87389],[46.58924,41.80547],[46.75269,41.8623],[46.8134,41.76252],[47.00955,41.63583],[46.99554,41.59743],[47.03757,41.55434],[47.10762,41.59044],[47.34579,41.27884],[47.49004,41.26366],[47.54504,41.20275],[47.62288,41.22969],[47.75831,41.19455],[47.87973,41.21798],[48.07587,41.49957],[48.22064,41.51472],[48.2878,41.56221],[48.40277,41.60441],[48.42301,41.65444],[48.55078,41.77917],[48.5867,41.84306],[48.80971,41.95365],[49.2134,44.84989],[49.88945,46.04554],[49.32259,46.26944],[49.16518,46.38542],[48.54988,46.56267],[48.51142,46.69268],[49.01136,46.72716],[48.52326,47.4102],[48.45173,47.40818],[48.15348,47.74545],[47.64973,47.76559],[47.41689,47.83687],[47.38731,47.68176],[47.12107,47.83687],[47.11516,48.27188],[46.49011,48.43019],[46.78392,48.95352],[47.00857,49.04921],[47.04658,49.19834],[46.78398,49.34026],[46.9078,49.86707],[47.18319,49.93721],[47.34589,50.09308],[47.30448,50.30894],[47.58551,50.47867],[48.10044,50.09242],[48.24519,49.86099],[48.42564,49.82283],[48.68352,49.89546],[48.90782,50.02281],[48.57946,50.63278],[48.86936,50.61589],[49.12673,50.78639],[49.41959,50.85927],[49.39001,51.09396],[49.76866,51.11067],[49.97277,51.2405],[50.26859,51.28677],[50.59695,51.61859],[51.26254,51.68466],[51.301,51.48799],[51.77431,51.49536],[51.8246,51.67916],[52.36119,51.74161],[52.54329,51.48444],[53.46165,51.49445],[53.69299,51.23466],[54.12248,51.11542],[54.46331,50.85554],[54.41894,50.61214],[54.55797,50.52006],[54.71476,50.61214],[54.56685,51.01958],[54.72067,51.03261],[55.67774,50.54508],[56.11398,50.7471],[56.17906,50.93204],[57.17302,51.11253],[57.44221,50.88354],[57.74986,50.93017],[57.75578,51.13852],[58.3208,51.15151],[58.87974,50.70852],[59.48928,50.64216],[59.51886,50.49937],[59.81172,50.54451],[60.01288,50.8163],[60.17262,50.83312],[60.31914,50.67705],[60.81833,50.6629],[61.4431,50.80679],[61.56889,51.23679],[61.6813,51.25716],[61.55114,51.32746],[61.50677,51.40687],[60.95655,51.48615],[60.92401,51.61124],[60.5424,51.61675],[60.36787,51.66815],[60.50986,51.7964],[60.09867,51.87135],[59.99809,51.98263],[59.91279,52.06924],[60.17253,52.25814],[60.17516,52.39457],[59.25033,52.46803],[59.22409,52.28437],[58.79644,52.43392],[58.94336,53.953],[59.70487,54.14846],[59.95217,54.85853],[57.95234,54.39672],[57.14829,54.84204],[57.25137,55.26262],[58.81825,55.03378],[59.49035,55.60486],[59.28419,56.15739],[57.51527,56.08729],[57.28024,56.87898],[58.07604,57.08308],[58.13789,57.68097],[58.81412,57.71602],[58.71104,58.07475],[59.40376,58.45822],[59.15636,59.14682],[58.3853,59.487],[59.50685,60.91162],[59.36223,61.3882],[59.61398,62.44915],[59.24834,63.01859],[59.80579,64.13948],[59.63945,64.78384],[60.74386,64.95767],[61.98014,65.72191],[66.1708,67.61252],[64.18965,69.94255],[76.13964,83.37843],[36.85549,84.09565],[32.07813,72.01005],[31.59909,70.16571],[30.84095,69.80584],[30.95011,69.54699],[30.52662,69.54699],[30.16363,69.65244],[29.97205,69.41623],[29.27631,69.2811],[29.26623,69.13794],[29.0444,69.0119],[28.91738,69.04774],[28.45957,68.91417],[28.78224,68.86696],[28.43941,68.53366],[28.62982,68.19816],[29.34179,68.06655],[29.66955,67.79872],[30.02041,67.67523],[29.91155,67.51507],[28.9839,66.94139],[29.91155,66.13863],[30.16363,65.66935],[29.97205,65.70256],[29.74013,65.64025],[29.84096,65.56945],[29.68972,65.31803],[29.61914,65.23791],[29.8813,65.22101],[29.84096,65.1109],[29.61914,65.05993],[29.68972,64.80789],[30.05271,64.79072],[30.12329,64.64862],[30.01238,64.57513],[30.06279,64.35782],[30.4762,64.25728],[30.55687,64.09036],[30.25437,63.83364],[29.98213,63.75795],[30.49637,63.46666],[31.23244,63.22239],[31.29294,63.09035],[31.58535,62.91642],[31.38369,62.66284],[31.10136,62.43042],[29.01829,61.17448],[28.82816,61.1233],[28.47974,60.93365],[27.77352,60.52722],[27.71177,60.3893],[27.44953,60.22766],[26.32936,60.00121]]]]}},{type:"Feature",properties:{wikidata:"Q1083368",nameEn:"Mainland Finland",country:"FI",groups:["EU","154","150","UN"],callingCodes:["358"]},geometry:{type:"MultiPolygon",coordinates:[[[[29.12697,69.69193],[28.36883,69.81658],[28.32849,69.88605],[27.97558,69.99671],[27.95542,70.0965],[27.57226,70.06215],[27.05802,69.92069],[26.64461,69.96565],[26.40261,69.91377],[25.96904,69.68397],[25.69679,69.27039],[25.75729,68.99383],[25.61613,68.89602],[25.42455,68.90328],[25.12206,68.78684],[25.10189,68.63307],[24.93048,68.61102],[24.90023,68.55579],[24.74898,68.65143],[24.18432,68.73936],[24.02299,68.81601],[23.781,68.84514],[23.68017,68.70276],[23.13064,68.64684],[22.53321,68.74393],[22.38367,68.71561],[22.27276,68.89514],[21.63833,69.27485],[21.27827,69.31281],[21.00732,69.22755],[20.98641,69.18809],[21.11099,69.10291],[21.05775,69.0356],[20.72171,69.11874],[20.55258,69.06069],[20.78802,69.03087],[20.91658,68.96764],[20.85104,68.93142],[20.90649,68.89696],[21.03001,68.88969],[22.00429,68.50692],[22.73028,68.40881],[23.10336,68.26551],[23.15377,68.14759],[23.26469,68.15134],[23.40081,68.05545],[23.65793,67.9497],[23.45627,67.85297],[23.54701,67.59306],[23.39577,67.46974],[23.75372,67.43688],[23.75372,67.29914],[23.54701,67.25435],[23.58735,67.20752],[23.56214,67.17038],[23.98563,66.84149],[23.98059,66.79585],[23.89488,66.772],[23.85959,66.56434],[23.63776,66.43568],[23.67591,66.3862],[23.64982,66.30603],[23.71339,66.21299],[23.90497,66.15802],[24.15791,65.85385],[24.14798,65.83466],[24.15107,65.81427],[24.14112,65.39731],[20.15877,63.06556],[19.23413,60.61414],[20.96741,60.71528],[21.15143,60.54555],[21.08159,60.20167],[21.02509,60.12142],[21.35468,59.67511],[20.5104,59.15546],[26.32936,60.00121],[27.44953,60.22766],[27.71177,60.3893],[27.77352,60.52722],[28.47974,60.93365],[28.82816,61.1233],[29.01829,61.17448],[31.10136,62.43042],[31.38369,62.66284],[31.58535,62.91642],[31.29294,63.09035],[31.23244,63.22239],[30.49637,63.46666],[29.98213,63.75795],[30.25437,63.83364],[30.55687,64.09036],[30.4762,64.25728],[30.06279,64.35782],[30.01238,64.57513],[30.12329,64.64862],[30.05271,64.79072],[29.68972,64.80789],[29.61914,65.05993],[29.84096,65.1109],[29.8813,65.22101],[29.61914,65.23791],[29.68972,65.31803],[29.84096,65.56945],[29.74013,65.64025],[29.97205,65.70256],[30.16363,65.66935],[29.91155,66.13863],[28.9839,66.94139],[29.91155,67.51507],[30.02041,67.67523],[29.66955,67.79872],[29.34179,68.06655],[28.62982,68.19816],[28.43941,68.53366],[28.78224,68.86696],[28.45957,68.91417],[28.91738,69.04774],[28.81248,69.11997],[28.8629,69.22395],[29.31664,69.47994],[29.12697,69.69193]]]]}},{type:"Feature",properties:{wikidata:"Q1184963",nameEn:"Alhucemas Islands",country:"ES",groups:["EU","Q191011","015","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[-3.90602,35.21494],[-3.88372,35.20767],[-3.89343,35.22728],[-3.90602,35.21494]]]]}},{type:"Feature",properties:{wikidata:"Q1298289",nameEn:"Egmont Islands",country:"GB",groups:["IO","BOTS","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[70.1848,-6.37445],[70.67958,-8.2663],[72.17991,-6.68509],[70.1848,-6.37445]]]]}},{type:"Feature",properties:{wikidata:"Q1352230",nameEn:"US Territories",country:"US",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q1451600",nameEn:"Overseas Countries and Territories of the EU",aliases:["OCT"],level:"subunion"},geometry:null},{type:"Feature",properties:{wikidata:"Q1544253",nameEn:"Great Chagos Bank",country:"GB",groups:["IO","BOTS","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[70.1848,-6.37445],[72.17991,-6.68509],[73.20573,-5.20727],[70.1848,-6.37445]]]]}},{type:"Feature",properties:{wikidata:"Q1585511",nameEn:"Salomon Atoll",country:"GB",groups:["IO","BOTS","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[72.09518,-5.61768],[73.20573,-5.20727],[72.12587,-4.02588],[72.09518,-5.61768]]]]}},{type:"Feature",properties:{wikidata:"Q1681727",nameEn:"Saint-Paul and Amsterdam",country:"FR",groups:["EU","TF","Q1451600","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[76.31747,-42.16264],[80.15867,-36.04977],[71.22311,-38.75287],[76.31747,-42.16264]]]]}},{type:"Feature",properties:{wikidata:"Q1901211",nameEn:"East Malaysia",country:"MY",groups:["Q36117","035","142","UN"],driveSide:"left",callingCodes:["60"]},geometry:{type:"MultiPolygon",coordinates:[[[[110.90339,7.52694],[109.82788,2.86812],[109.62558,1.99182],[109.53794,1.91771],[109.57923,1.80624],[109.66397,1.79972],[109.66397,1.60425],[110.35354,.98869],[110.49182,.88088],[110.62374,.873],[111.22979,1.08326],[111.55434,.97864],[111.82846,.99349],[111.94553,1.12016],[112.15679,1.17004],[112.2127,1.44135],[112.48648,1.56516],[113.021,1.57819],[113.01448,1.42832],[113.64677,1.23933],[114.03788,1.44787],[114.57892,1.5],[114.80706,1.92351],[114.80706,2.21665],[115.1721,2.49671],[115.11343,2.82879],[115.53713,3.14776],[115.58276,3.93499],[115.90217,4.37708],[117.25801,4.35108],[117.47313,4.18857],[117.67641,4.16535],[118.06469,4.16638],[118.93936,4.09009],[119.52945,5.35672],[117.98544,6.27477],[117.93857,6.89845],[117.17735,7.52841],[116.79524,7.43869],[115.02521,5.35005],[115.16236,5.01011],[115.15092,4.87604],[115.20737,4.8256],[115.27819,4.63661],[115.2851,4.42295],[115.36346,4.33563],[115.31275,4.30806],[115.09978,4.39123],[115.07737,4.53418],[115.04064,4.63706],[115.02278,4.74137],[115.02955,4.82087],[115.05038,4.90275],[114.99417,4.88201],[114.96982,4.81146],[114.88841,4.81905],[114.8266,4.75062],[114.77303,4.72871],[114.83189,4.42387],[114.88039,4.4257],[114.78539,4.12205],[114.64211,4.00694],[114.49922,4.13108],[114.4416,4.27588],[114.32176,4.2552],[114.32176,4.34942],[114.26876,4.49878],[114.15813,4.57],[114.07448,4.58441],[114.10166,4.76112],[110.90339,7.52694]]]]}},{type:"Feature",properties:{wikidata:"Q1973345",nameEn:"Peninsular Malaysia",country:"MY",groups:["035","142","UN"],driveSide:"left",callingCodes:["60"]},geometry:{type:"MultiPolygon",coordinates:[[[[102.46318,7.22462],[102.09086,6.23546],[102.08127,6.22679],[102.07732,6.193],[102.09182,6.14161],[102.01835,6.05407],[101.99209,6.04075],[101.97114,6.01992],[101.9714,6.00575],[101.94712,5.98421],[101.92819,5.85511],[101.91776,5.84269],[101.89188,5.8386],[101.80144,5.74505],[101.75074,5.79091],[101.69773,5.75881],[101.58019,5.93534],[101.25524,5.78633],[101.25755,5.71065],[101.14062,5.61613],[100.98815,5.79464],[101.02708,5.91013],[101.087,5.9193],[101.12388,6.11411],[101.06165,6.14161],[101.12618,6.19431],[101.10313,6.25617],[100.85884,6.24929],[100.81045,6.45086],[100.74822,6.46231],[100.74361,6.50811],[100.66986,6.45086],[100.43027,6.52389],[100.42351,6.51762],[100.41791,6.5189],[100.41152,6.52299],[100.35413,6.54932],[100.31929,6.65413],[100.32607,6.65933],[100.32671,6.66526],[100.31884,6.66423],[100.31618,6.66781],[100.30828,6.66462],[100.29651,6.68439],[100.19511,6.72559],[100.12,6.42105],[100.0756,6.4045],[99.91873,6.50233],[99.50117,6.44501],[99.31854,5.99868],[99.75778,3.86466],[103.03657,1.30383],[103.56591,1.19719],[103.62738,1.35255],[103.67468,1.43166],[103.7219,1.46108],[103.74161,1.4502],[103.76395,1.45183],[103.81181,1.47953],[103.86383,1.46288],[103.89565,1.42841],[103.93384,1.42926],[104.00131,1.42405],[104.02277,1.4438],[104.04622,1.44691],[104.07348,1.43322],[104.08871,1.42015],[104.09162,1.39694],[104.08072,1.35998],[104.12282,1.27714],[104.34728,1.33529],[104.56723,1.44271],[105.01437,3.24936],[102.46318,7.22462]]]]}},{type:"Feature",properties:{wikidata:"Q2093907",nameEn:"Three Kings Islands",country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left"},geometry:{type:"MultiPolygon",coordinates:[[[[174.17679,-32.62487],[170.93268,-32.97889],[171.97383,-34.64644],[174.17679,-32.62487]]]]}},{type:"Feature",properties:{wikidata:"Q2298216",nameEn:"Solander Islands",country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left"},geometry:{type:"MultiPolygon",coordinates:[[[[167.39068,-46.49187],[166.5534,-46.39484],[166.84561,-46.84889],[167.39068,-46.49187]]]]}},{type:"Feature",properties:{wikidata:"Q2872203",nameEn:"Mainland Australia",country:"AU",groups:["053","009","UN"],level:"subcountryGroup",driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[88.16419,-23.49578],[123.64533,-39.13605],[159.74028,-39.1978],[159.76765,-29.76946],[154.02855,-24.43238],[152.93188,-20.92631],[147.69992,-17.5933],[145.2855,-9.62524],[143.87386,-9.02382],[143.29772,-9.33993],[142.48658,-9.36754],[142.19246,-9.15378],[141.88934,-9.36111],[141.01842,-9.35091],[135.49042,-9.2276],[127.55165,-9.05052],[125.29076,-12.33139],[88.16419,-23.49578]]]]}},{type:"Feature",properties:{wikidata:"Q2914565",nameEn:"Autonomous Regions of Portugal",country:"PT",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q2915956",nameEn:"Mainland Portugal",country:"PT",groups:["Q12837","EU","039","150","UN"],level:"subcountryGroup",callingCodes:["351"]},geometry:{type:"MultiPolygon",coordinates:[[[[-10.39881,36.12218],[-7.37282,36.96896],[-7.39769,37.16868],[-7.41133,37.20314],[-7.41854,37.23813],[-7.43227,37.25152],[-7.43974,37.38913],[-7.46878,37.47127],[-7.51759,37.56119],[-7.41981,37.75729],[-7.33441,37.81193],[-7.27314,37.90145],[-7.24544,37.98884],[-7.12648,38.00296],[-7.10366,38.04404],[-7.05966,38.01966],[-7.00375,38.01914],[-6.93418,38.21454],[-7.09389,38.17227],[-7.15581,38.27597],[-7.32529,38.44336],[-7.265,38.61674],[-7.26174,38.72107],[-7.03848,38.87221],[-7.051,38.907],[-6.95211,39.0243],[-6.97004,39.07619],[-7.04011,39.11919],[-7.10692,39.10275],[-7.14929,39.11287],[-7.12811,39.17101],[-7.23566,39.20132],[-7.23403,39.27579],[-7.3149,39.34857],[-7.2927,39.45847],[-7.49477,39.58794],[-7.54121,39.66717],[-7.33507,39.64569],[-7.24707,39.66576],[-7.01613,39.66877],[-6.97492,39.81488],[-6.91463,39.86618],[-6.86737,40.01986],[-6.94233,40.10716],[-7.00589,40.12087],[-7.02544,40.18564],[-7.00426,40.23169],[-6.86085,40.26776],[-6.86085,40.2976],[-6.80218,40.33239],[-6.78426,40.36468],[-6.84618,40.42177],[-6.84944,40.46394],[-6.7973,40.51723],[-6.80218,40.55067],[-6.84292,40.56801],[-6.79567,40.65955],[-6.82826,40.74603],[-6.82337,40.84472],[-6.79892,40.84842],[-6.80707,40.88047],[-6.84292,40.89771],[-6.8527,40.93958],[-6.9357,41.02888],[-6.913,41.03922],[-6.88843,41.03027],[-6.84781,41.02692],[-6.80942,41.03629],[-6.79241,41.05397],[-6.75655,41.10187],[-6.77319,41.13049],[-6.69711,41.1858],[-6.68286,41.21641],[-6.65046,41.24725],[-6.55937,41.24417],[-6.38551,41.35274],[-6.38553,41.38655],[-6.3306,41.37677],[-6.26777,41.48796],[-6.19128,41.57638],[-6.29863,41.66432],[-6.44204,41.68258],[-6.49907,41.65823],[-6.54633,41.68623],[-6.56426,41.74219],[-6.51374,41.8758],[-6.56752,41.88429],[-6.5447,41.94371],[-6.58544,41.96674],[-6.61967,41.94008],[-6.75004,41.94129],[-6.76959,41.98734],[-6.81196,41.99097],[-6.82174,41.94493],[-6.94396,41.94403],[-6.95537,41.96553],[-6.98144,41.9728],[-7.01078,41.94977],[-7.07596,41.94977],[-7.08574,41.97401],[-7.14115,41.98855],[-7.18549,41.97515],[-7.18677,41.88793],[-7.32366,41.8406],[-7.37092,41.85031],[-7.42864,41.80589],[-7.42854,41.83262],[-7.44759,41.84451],[-7.45566,41.86488],[-7.49803,41.87095],[-7.52737,41.83939],[-7.62188,41.83089],[-7.58603,41.87944],[-7.65774,41.88308],[-7.69848,41.90977],[-7.84188,41.88065],[-7.88055,41.84571],[-7.88751,41.92553],[-7.90707,41.92432],[-7.92336,41.8758],[-7.9804,41.87337],[-8.01136,41.83453],[-8.0961,41.81024],[-8.16455,41.81753],[-8.16944,41.87944],[-8.19551,41.87459],[-8.2185,41.91237],[-8.16232,41.9828],[-8.08796,42.01398],[-8.08847,42.05767],[-8.11729,42.08537],[-8.18178,42.06436],[-8.19406,42.12141],[-8.18947,42.13853],[-8.1986,42.15402],[-8.22406,42.1328],[-8.24681,42.13993],[-8.2732,42.12396],[-8.29809,42.106],[-8.32161,42.10218],[-8.33912,42.08358],[-8.36353,42.09065],[-8.38323,42.07683],[-8.40143,42.08052],[-8.42512,42.07199],[-8.44123,42.08218],[-8.48185,42.0811],[-8.52837,42.07658],[-8.5252,42.06264],[-8.54563,42.0537],[-8.58086,42.05147],[-8.59493,42.05708],[-8.63791,42.04691],[-8.64626,42.03668],[-8.65832,42.02972],[-8.6681,41.99703],[-8.69071,41.98862],[-8.7478,41.96282],[-8.74606,41.9469],[-8.75712,41.92833],[-8.81794,41.90375],[-8.87157,41.86488],[-11.19304,41.83075],[-10.39881,36.12218]]]]}},{type:"Feature",properties:{wikidata:"Q3311985",nameEn:"Guernsey",country:"GB",groups:["GG","830","Q185086","154","150","UN"],level:"subterritory",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01481"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.49556,49.79012],[-3.28154,49.57329],[-2.65349,49.15373],[-2.36485,49.48223],[-2.49556,49.79012]]]]}},{type:"Feature",properties:{wikidata:"Q3320166",nameEn:"Outermost Regions of the EU",aliases:["OMR"],level:"subunion"},geometry:null},{type:"Feature",properties:{wikidata:"Q3336843",nameEn:"Countries of the United Kingdom",aliases:["GB-UKM"],country:"GB",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q6736667",nameEn:"Mainland India",country:"IN",groups:["034","142","UN"],driveSide:"left",callingCodes:["91"]},geometry:{type:"MultiPolygon",coordinates:[[[[89.08044,21.41871],[89.07114,22.15335],[88.9367,22.58527],[88.94614,22.66941],[88.9151,22.75228],[88.96713,22.83346],[88.87063,22.95235],[88.88327,23.03885],[88.86377,23.08759],[88.99148,23.21134],[88.71133,23.2492],[88.79254,23.46028],[88.79351,23.50535],[88.74841,23.47361],[88.56507,23.64044],[88.58087,23.87105],[88.66189,23.87607],[88.73743,23.91751],[88.6976,24.14703],[88.74841,24.1959],[88.68801,24.31464],[88.50934,24.32474],[88.12296,24.51301],[88.08786,24.63232],[88.00683,24.66477],[88.15515,24.85806],[88.14004,24.93529],[88.21832,24.96642],[88.27325,24.88796],[88.33917,24.86803],[88.46277,25.07468],[88.44766,25.20149],[88.94067,25.18534],[89.00463,25.26583],[89.01105,25.30303],[88.85278,25.34679],[88.81296,25.51546],[88.677,25.46959],[88.4559,25.59227],[88.45103,25.66245],[88.242,25.80811],[88.13138,25.78773],[88.08804,25.91334],[88.16581,26.0238],[88.1844,26.14417],[88.34757,26.22216],[88.35153,26.29123],[88.51649,26.35923],[88.48749,26.45855],[88.36938,26.48683],[88.35153,26.45241],[88.33093,26.48929],[88.41196,26.63837],[88.4298,26.54489],[88.62144,26.46783],[88.69485,26.38353],[88.67837,26.26291],[88.78961,26.31093],[88.85004,26.23211],[89.05328,26.2469],[88.91321,26.37984],[88.92357,26.40711],[88.95612,26.4564],[89.08899,26.38845],[89.15869,26.13708],[89.35953,26.0077],[89.53515,26.00382],[89.57101,25.9682],[89.63968,26.22595],[89.70201,26.15138],[89.73581,26.15818],[89.77865,26.08387],[89.77728,26.04254],[89.86592,25.93115],[89.80585,25.82489],[89.84388,25.70042],[89.86129,25.61714],[89.81208,25.37244],[89.84086,25.31854],[89.83371,25.29548],[89.87629,25.28337],[89.90478,25.31038],[90.1155,25.22686],[90.40034,25.1534],[90.65042,25.17788],[90.87427,25.15799],[91.25517,25.20677],[91.63648,25.12846],[92.0316,25.1834],[92.33957,25.07593],[92.39147,25.01471],[92.49887,24.88796],[92.38626,24.86055],[92.25854,24.9191],[92.15796,24.54435],[92.11662,24.38997],[91.96603,24.3799],[91.89258,24.14674],[91.82596,24.22345],[91.76004,24.23848],[91.73257,24.14703],[91.65292,24.22095],[91.63782,24.1132],[91.55542,24.08687],[91.37414,24.10693],[91.35741,23.99072],[91.29587,24.0041],[91.22308,23.89616],[91.25192,23.83463],[91.15579,23.6599],[91.28293,23.37538],[91.36453,23.06612],[91.40848,23.07117],[91.4035,23.27522],[91.46615,23.2328],[91.54993,23.01051],[91.61571,22.93929],[91.7324,23.00043],[91.81634,23.08001],[91.76417,23.26619],[91.84789,23.42235],[91.95642,23.47361],[91.95093,23.73284],[92.04706,23.64229],[92.15417,23.73409],[92.26541,23.70392],[92.38214,23.28705],[92.37665,22.9435],[92.5181,22.71441],[92.60029,22.1522],[92.56616,22.13554],[92.60949,21.97638],[92.67532,22.03547],[92.70416,22.16017],[92.86208,22.05456],[92.89504,21.95143],[92.93899,22.02656],[92.99804,21.98964],[92.99255,22.05965],[93.04885,22.20595],[93.15734,22.18687],[93.14224,22.24535],[93.19991,22.25425],[93.18206,22.43716],[93.13537,22.45873],[93.11477,22.54374],[93.134,22.59573],[93.09417,22.69459],[93.134,22.92498],[93.12988,23.05772],[93.2878,23.00464],[93.38478,23.13698],[93.36862,23.35426],[93.38781,23.36139],[93.39981,23.38828],[93.38805,23.4728],[93.43475,23.68299],[93.3908,23.7622],[93.3908,23.92925],[93.36059,23.93176],[93.32351,24.04468],[93.34735,24.10151],[93.41415,24.07854],[93.46633,23.97067],[93.50616,23.94432],[93.62871,24.00922],[93.75952,24.0003],[93.80279,23.92549],[93.92089,23.95812],[94.14081,23.83333],[94.30215,24.23752],[94.32362,24.27692],[94.45279,24.56656],[94.50729,24.59281],[94.5526,24.70764],[94.60204,24.70889],[94.73937,25.00545],[94.74212,25.13606],[94.57458,25.20318],[94.68032,25.47003],[94.80117,25.49359],[95.18556,26.07338],[95.11428,26.1019],[95.12801,26.38397],[95.05798,26.45408],[95.23513,26.68499],[95.30339,26.65372],[95.437,26.7083],[95.81603,27.01335],[95.93002,27.04149],[96.04949,27.19428],[96.15591,27.24572],[96.40779,27.29818],[96.55761,27.29928],[96.73888,27.36638],[96.88445,27.25046],[96.85287,27.2065],[96.89132,27.17474],[97.14675,27.09041],[97.17422,27.14052],[96.91431,27.45752],[96.90112,27.62149],[97.29919,27.92233],[97.35824,27.87256],[97.38845,28.01329],[97.35412,28.06663],[97.31292,28.06784],[97.34547,28.21385],[97.1289,28.3619],[96.98882,28.32564],[96.88445,28.39452],[96.85561,28.4875],[96.6455,28.61657],[96.48895,28.42955],[96.40929,28.51526],[96.61391,28.72742],[96.3626,29.10607],[96.20467,29.02325],[96.18682,29.11087],[96.31316,29.18643],[96.05361,29.38167],[95.84899,29.31464],[95.75149,29.32063],[95.72086,29.20797],[95.50842,29.13487],[95.41091,29.13007],[95.3038,29.13847],[95.26122,29.07727],[95.2214,29.10727],[95.11291,29.09527],[95.0978,29.14446],[94.81353,29.17804],[94.69318,29.31739],[94.2752,29.11687],[94.35897,29.01965],[93.72797,28.68821],[93.44621,28.67189],[93.18069,28.50319],[93.14635,28.37035],[92.93075,28.25671],[92.67486,28.15018],[92.65472,28.07632],[92.73025,28.05814],[92.7275,27.98662],[92.42538,27.80092],[92.32101,27.79363],[92.27432,27.89077],[91.87057,27.7195],[91.84722,27.76325],[91.6469,27.76358],[91.55819,27.6144],[91.65007,27.48287],[92.01132,27.47352],[92.12019,27.27829],[92.04702,27.26861],[92.03457,27.07334],[92.11863,26.893],[92.05523,26.8692],[91.83181,26.87318],[91.50067,26.79223],[90.67715,26.77215],[90.48504,26.8594],[90.39271,26.90704],[90.30402,26.85098],[90.04535,26.72422],[89.86124,26.73307],[89.63369,26.74402],[89.42349,26.83727],[89.3901,26.84225],[89.38319,26.85963],[89.37913,26.86224],[89.1926,26.81329],[89.12825,26.81661],[89.09554,26.89089],[88.95807,26.92668],[88.92301,26.99286],[88.8714,26.97488],[88.86984,27.10937],[88.74219,27.144],[88.91901,27.32483],[88.82981,27.38814],[88.77517,27.45415],[88.88091,27.85192],[88.83559,28.01936],[88.63235,28.12356],[88.54858,28.06057],[88.25332,27.9478],[88.1278,27.95417],[88.13378,27.88015],[88.1973,27.85067],[88.19107,27.79285],[88.04008,27.49223],[88.07277,27.43007],[88.01646,27.21612],[88.01587,27.21388],[87.9887,27.11045],[88.11719,26.98758],[88.13422,26.98705],[88.12302,26.95324],[88.19107,26.75516],[88.1659,26.68177],[88.16452,26.64111],[88.09963,26.54195],[88.09414,26.43732],[88.00895,26.36029],[87.90115,26.44923],[87.89085,26.48565],[87.84193,26.43663],[87.7918,26.46737],[87.76004,26.40711],[87.67893,26.43501],[87.66803,26.40294],[87.59175,26.38342],[87.55274,26.40596],[87.51571,26.43106],[87.46566,26.44058],[87.37314,26.40815],[87.34568,26.34787],[87.26568,26.37294],[87.26587,26.40592],[87.24682,26.4143],[87.18863,26.40558],[87.14751,26.40542],[87.09147,26.45039],[87.0707,26.58571],[87.04691,26.58685],[87.01559,26.53228],[86.95912,26.52076],[86.94543,26.52076],[86.82898,26.43919],[86.76797,26.45892],[86.74025,26.42386],[86.69124,26.45169],[86.62686,26.46891],[86.61313,26.48658],[86.57073,26.49825],[86.54258,26.53819],[86.49726,26.54218],[86.31564,26.61925],[86.26235,26.61886],[86.22513,26.58863],[86.13596,26.60651],[86.02729,26.66756],[85.8492,26.56667],[85.85126,26.60866],[85.83126,26.61134],[85.76907,26.63076],[85.72315,26.67471],[85.73483,26.79613],[85.66239,26.84822],[85.61621,26.86721],[85.59461,26.85161],[85.5757,26.85955],[85.56471,26.84133],[85.47752,26.79292],[85.34302,26.74954],[85.21159,26.75933],[85.18046,26.80519],[85.19291,26.86909],[85.15883,26.86966],[85.02635,26.85381],[85.05592,26.88991],[85.00536,26.89523],[84.97186,26.9149],[84.96687,26.95599],[84.85754,26.98984],[84.82913,27.01989],[84.793,26.9968],[84.64496,27.04669],[84.69166,27.21294],[84.62161,27.33885],[84.29315,27.39],[84.25735,27.44941],[84.21376,27.45218],[84.10791,27.52399],[84.02229,27.43836],[83.93306,27.44939],[83.86182,27.4241],[83.85595,27.35797],[83.61288,27.47013],[83.39495,27.4798],[83.38872,27.39276],[83.35136,27.33885],[83.29999,27.32778],[83.2673,27.36235],[83.27197,27.38309],[83.19413,27.45632],[82.94938,27.46036],[82.93261,27.50328],[82.74119,27.49838],[82.70378,27.72122],[82.46405,27.6716],[82.06554,27.92222],[81.97214,27.93322],[81.91223,27.84995],[81.47867,28.08303],[81.48179,28.12148],[81.38683,28.17638],[81.32923,28.13521],[81.19847,28.36284],[81.03471,28.40054],[80.55142,28.69182],[80.50575,28.6706],[80.52443,28.54897],[80.44504,28.63098],[80.37188,28.63371],[80.12125,28.82346],[80.06957,28.82763],[80.05743,28.91479],[80.18085,29.13649],[80.23178,29.11626],[80.26602,29.13938],[80.24112,29.21414],[80.28626,29.20327],[80.31428,29.30784],[80.24322,29.44299],[80.37939,29.57098],[80.41858,29.63581],[80.38428,29.68513],[80.36803,29.73865],[80.41554,29.79451],[80.43458,29.80466],[80.48997,29.79566],[80.56247,29.86661],[80.57179,29.91422],[80.60226,29.95732],[80.67076,29.95732],[80.8778,30.13384],[80.86673,30.17321],[80.91143,30.22173],[80.92547,30.17193],[81.03953,30.20059],[80.83343,30.32023],[80.54504,30.44936],[80.20721,30.58541],[79.93255,30.88288],[79.59884,30.93943],[79.30694,31.17357],[79.14016,31.43403],[79.01931,31.42817],[78.89344,31.30481],[78.77898,31.31209],[78.71032,31.50197],[78.84516,31.60631],[78.69933,31.78723],[78.78036,31.99478],[78.74404,32.00384],[78.68754,32.10256],[78.49609,32.2762],[78.4645,32.45367],[78.38897,32.53938],[78.73916,32.69438],[78.7831,32.46873],[78.96713,32.33655],[78.99322,32.37948],[79.0979,32.38051],[79.13174,32.47766],[79.26768,32.53277],[79.46562,32.69668],[79.14016,33.02545],[79.15252,33.17156],[78.73636,33.56521],[78.67599,33.66445],[78.77349,33.73871],[78.73367,34.01121],[78.65657,34.03195],[78.66225,34.08858],[78.91769,34.15452],[78.99802,34.3027],[79.05364,34.32482],[78.74465,34.45174],[78.56475,34.50835],[78.54964,34.57283],[78.27781,34.61484],[78.18435,34.7998],[78.22692,34.88771],[78.00033,35.23954],[78.03466,35.3785],[78.11664,35.48022],[77.80532,35.52058],[77.70232,35.46244],[77.44277,35.46132],[76.96624,35.5932],[76.84539,35.67356],[76.77323,35.66062],[76.75475,35.52617],[76.85088,35.39754],[76.93465,35.39866],[77.11796,35.05419],[76.99251,34.93349],[76.87193,34.96906],[76.74514,34.92488],[76.74377,34.84039],[76.67648,34.76371],[76.47186,34.78965],[76.15463,34.6429],[76.04614,34.67566],[75.75438,34.51827],[75.38009,34.55021],[75.01479,34.64629],[74.6663,34.703],[74.58083,34.77386],[74.31239,34.79626],[74.12897,34.70073],[73.96423,34.68244],[73.93401,34.63386],[73.93951,34.57169],[73.89419,34.54568],[73.88732,34.48911],[73.74999,34.3781],[73.74862,34.34183],[73.8475,34.32935],[73.90517,34.35317],[73.98208,34.2522],[73.90677,34.10504],[73.88732,34.05105],[73.91341,34.01235],[74.21554,34.03853],[74.25262,34.01577],[74.26086,33.92237],[74.14001,33.83002],[74.05898,33.82089],[74.00891,33.75437],[73.96423,33.73071],[73.98968,33.66155],[73.97367,33.64061],[74.03576,33.56718],[74.10115,33.56392],[74.18121,33.4745],[74.17983,33.3679],[74.08782,33.26232],[74.01366,33.25199],[74.02144,33.18908],[74.15374,33.13477],[74.17571,33.07495],[74.31854,33.02891],[74.34875,32.97823],[74.31227,32.92795],[74.41467,32.90563],[74.45312,32.77755],[74.6289,32.75561],[74.64675,32.82604],[74.7113,32.84219],[74.65345,32.71225],[74.69542,32.66792],[74.64424,32.60985],[74.65251,32.56416],[74.67431,32.56676],[74.68362,32.49298],[74.84725,32.49075],[74.97634,32.45367],[75.03265,32.49538],[75.28259,32.36556],[75.38046,32.26836],[75.25649,32.10187],[75.00793,32.03786],[74.9269,32.0658],[74.86236,32.04485],[74.79919,31.95983],[74.58907,31.87824],[74.47771,31.72227],[74.57498,31.60382],[74.61517,31.55698],[74.59319,31.50197],[74.64713,31.45605],[74.59773,31.4136],[74.53223,31.30321],[74.51629,31.13829],[74.56023,31.08303],[74.60281,31.10419],[74.60006,31.13711],[74.6852,31.12771],[74.67971,31.05479],[74.5616,31.04153],[73.88993,30.36305],[73.95736,30.28466],[73.97225,30.19829],[73.80299,30.06969],[73.58665,30.01848],[73.3962,29.94707],[73.28094,29.56646],[73.05886,29.1878],[73.01337,29.16422],[72.94272,29.02487],[72.40402,28.78283],[72.29495,28.66367],[72.20329,28.3869],[71.9244,28.11555],[71.89921,27.96035],[70.79054,27.68423],[70.60927,28.02178],[70.37307,28.01208],[70.12502,27.8057],[70.03136,27.56627],[69.58519,27.18109],[69.50904,26.74892],[69.88555,26.56836],[70.05584,26.60398],[70.17532,26.55362],[70.17532,26.24118],[70.08193,26.08094],[70.0985,25.93238],[70.2687,25.71156],[70.37444,25.67443],[70.53649,25.68928],[70.60378,25.71898],[70.67382,25.68186],[70.66695,25.39314],[70.89148,25.15064],[70.94002,24.92843],[71.09405,24.69017],[70.97594,24.60904],[71.00341,24.46038],[71.12838,24.42662],[71.04461,24.34657],[70.94985,24.3791],[70.85784,24.30903],[70.88393,24.27398],[70.71502,24.23517],[70.57906,24.27774],[70.5667,24.43787],[70.11712,24.30915],[70.03428,24.172],[69.73335,24.17007],[69.59579,24.29777],[69.29778,24.28712],[69.19341,24.25646],[69.07806,24.29777],[68.97781,24.26021],[68.90914,24.33156],[68.7416,24.31904],[68.74643,23.97027],[68.39339,23.96838],[68.20763,23.85849],[68.11329,23.53945],[76.59015,5.591],[79.50447,8.91876],[79.42124,9.80115],[80.48418,10.20786],[89.08044,21.41871]]]]}},{type:"Feature",properties:{wikidata:"Q9143535",nameEn:"Akrotiri",country:"GB",groups:["Q644636","Q37362","BOTS","145","142","UN"],level:"subterritory",driveSide:"left",callingCodes:["357"]},geometry:{type:"MultiPolygon",coordinates:[[[[32.86014,34.70585],[32.82717,34.70622],[32.79433,34.67883],[32.76136,34.68318],[32.75515,34.64985],[32.74412,34.43926],[33.26744,34.49942],[33.0138,34.64424],[32.96968,34.64046],[32.96718,34.63446],[32.95891,34.62919],[32.95323,34.64075],[32.95471,34.64528],[32.94976,34.65204],[32.94796,34.6587],[32.95325,34.66462],[32.97079,34.66112],[32.97736,34.65277],[32.99014,34.65518],[32.98668,34.67268],[32.99135,34.68061],[32.95539,34.68471],[32.94683,34.67907],[32.94379,34.67111],[32.93693,34.67027],[32.93449,34.66241],[32.92807,34.66736],[32.93043,34.67091],[32.91398,34.67343],[32.9068,34.66102],[32.86167,34.68734],[32.86014,34.70585]]]]}},{type:"Feature",properties:{wikidata:"Q9206745",nameEn:"Dhekelia",country:"GB",groups:["Q644636","Q37362","BOTS","145","142","UN"],level:"subterritory",driveSide:"left",callingCodes:["357"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.70575,34.97947],[33.83531,34.73974],[33.98684,34.76642],[33.90075,34.96623],[33.86432,34.97592],[33.84811,34.97075],[33.83505,34.98108],[33.85621,34.98956],[33.85891,35.001],[33.85216,35.00579],[33.84045,35.00616],[33.82875,35.01685],[33.83055,35.02865],[33.81524,35.04192],[33.8012,35.04786],[33.82051,35.0667],[33.8355,35.05777],[33.85261,35.0574],[33.88367,35.07877],[33.89485,35.06873],[33.90247,35.07686],[33.91299,35.07579],[33.91789,35.08688],[33.89853,35.11377],[33.88737,35.11408],[33.88943,35.12007],[33.88561,35.12449],[33.87224,35.12293],[33.87622,35.10457],[33.87097,35.09389],[33.87479,35.08881],[33.8541,35.07201],[33.84168,35.06823],[33.82067,35.07826],[33.78581,35.05104],[33.76106,35.04253],[33.73824,35.05321],[33.71482,35.03722],[33.70209,35.04882],[33.7161,35.07279],[33.70861,35.07644],[33.69095,35.06237],[33.68474,35.06602],[33.67742,35.05963],[33.67678,35.03866],[33.69938,35.03123],[33.69731,35.01754],[33.71514,35.00294],[33.70639,34.99303],[33.70575,34.97947]],[[33.77312,34.9976],[33.77553,34.99518],[33.78516,34.99582],[33.79191,34.98914],[33.78917,34.98854],[33.78571,34.98951],[33.78318,34.98699],[33.78149,34.98854],[33.77843,34.988],[33.7778,34.98981],[33.76738,34.99188],[33.76605,34.99543],[33.75682,34.99916],[33.75994,35.00113],[33.77312,34.9976]],[[33.74144,35.01053],[33.7343,35.01178],[33.73781,35.02181],[33.74265,35.02329],[33.74983,35.02274],[33.7492,35.01319],[33.74144,35.01053]]]]}},{type:"Feature",properties:{wikidata:"Q16390686",nameEn:"Peninsular Spain",country:"ES",groups:["Q12837","EU","039","150","UN"],callingCodes:["34"]},geometry:{type:"MultiPolygon",coordinates:[[[[3.75438,42.33445],[3.17156,42.43545],[3.11379,42.43646],[3.10027,42.42621],[3.08167,42.42748],[3.03734,42.47363],[2.96518,42.46692],[2.94283,42.48174],[2.92107,42.4573],[2.88413,42.45938],[2.86983,42.46843],[2.85675,42.45444],[2.84335,42.45724],[2.77464,42.41046],[2.75497,42.42578],[2.72056,42.42298],[2.65311,42.38771],[2.6747,42.33974],[2.57934,42.35808],[2.55516,42.35351],[2.54382,42.33406],[2.48457,42.33933],[2.43508,42.37568],[2.43299,42.39423],[2.38504,42.39977],[2.25551,42.43757],[2.20578,42.41633],[2.16599,42.42314],[2.12789,42.41291],[2.11621,42.38393],[2.06241,42.35906],[2.00488,42.35399],[1.96482,42.37787],[1.9574,42.42401],[1.94084,42.43039],[1.94061,42.43333],[1.94292,42.44316],[1.93663,42.45439],[1.88853,42.4501],[1.83037,42.48395],[1.76335,42.48863],[1.72515,42.50338],[1.70571,42.48867],[1.66826,42.50779],[1.65674,42.47125],[1.58933,42.46275],[1.57953,42.44957],[1.55937,42.45808],[1.55073,42.43299],[1.5127,42.42959],[1.44529,42.43724],[1.43838,42.47848],[1.41648,42.48315],[1.46661,42.50949],[1.44759,42.54431],[1.41245,42.53539],[1.4234,42.55959],[1.44529,42.56722],[1.42512,42.58292],[1.44197,42.60217],[1.35562,42.71944],[1.15928,42.71407],[1.0804,42.78569],[.98292,42.78754],[.96166,42.80629],[.93089,42.79154],[.711,42.86372],[.66121,42.84021],[.65421,42.75872],[.67873,42.69458],[.40214,42.69779],[.36251,42.72282],[.29407,42.67431],[.25336,42.7174],[.17569,42.73424],[-.02468,42.68513],[-.10519,42.72761],[-.16141,42.79535],[-.17939,42.78974],[-.3122,42.84788],[-.38833,42.80132],[-.41319,42.80776],[-.44334,42.79939],[-.50863,42.82713],[-.55497,42.77846],[-.67637,42.88303],[-.69837,42.87945],[-.72608,42.89318],[-.73422,42.91228],[-.72037,42.92541],[-.75478,42.96916],[-.81652,42.95166],[-.97133,42.96239],[-1.00963,42.99279],[-1.10333,43.0059],[-1.22881,43.05534],[-1.25244,43.04164],[-1.30531,43.06859],[-1.30052,43.09581],[-1.27118,43.11961],[-1.32209,43.1127],[-1.34419,43.09665],[-1.35272,43.02658],[-1.44067,43.047],[-1.47555,43.08372],[-1.41562,43.12815],[-1.3758,43.24511],[-1.40942,43.27272],[-1.45289,43.27049],[-1.50992,43.29481],[-1.55963,43.28828],[-1.57674,43.25269],[-1.61341,43.25269],[-1.63052,43.28591],[-1.62481,43.30726],[-1.69407,43.31378],[-1.73074,43.29481],[-1.7397,43.32979],[-1.75079,43.3317],[-1.75334,43.34107],[-1.77068,43.34396],[-1.78714,43.35476],[-1.78332,43.36399],[-1.79319,43.37497],[-1.77289,43.38957],[-1.81005,43.59738],[-10.14298,44.17365],[-11.19304,41.83075],[-8.87157,41.86488],[-8.81794,41.90375],[-8.75712,41.92833],[-8.74606,41.9469],[-8.7478,41.96282],[-8.69071,41.98862],[-8.6681,41.99703],[-8.65832,42.02972],[-8.64626,42.03668],[-8.63791,42.04691],[-8.59493,42.05708],[-8.58086,42.05147],[-8.54563,42.0537],[-8.5252,42.06264],[-8.52837,42.07658],[-8.48185,42.0811],[-8.44123,42.08218],[-8.42512,42.07199],[-8.40143,42.08052],[-8.38323,42.07683],[-8.36353,42.09065],[-8.33912,42.08358],[-8.32161,42.10218],[-8.29809,42.106],[-8.2732,42.12396],[-8.24681,42.13993],[-8.22406,42.1328],[-8.1986,42.15402],[-8.18947,42.13853],[-8.19406,42.12141],[-8.18178,42.06436],[-8.11729,42.08537],[-8.08847,42.05767],[-8.08796,42.01398],[-8.16232,41.9828],[-8.2185,41.91237],[-8.19551,41.87459],[-8.16944,41.87944],[-8.16455,41.81753],[-8.0961,41.81024],[-8.01136,41.83453],[-7.9804,41.87337],[-7.92336,41.8758],[-7.90707,41.92432],[-7.88751,41.92553],[-7.88055,41.84571],[-7.84188,41.88065],[-7.69848,41.90977],[-7.65774,41.88308],[-7.58603,41.87944],[-7.62188,41.83089],[-7.52737,41.83939],[-7.49803,41.87095],[-7.45566,41.86488],[-7.44759,41.84451],[-7.42854,41.83262],[-7.42864,41.80589],[-7.37092,41.85031],[-7.32366,41.8406],[-7.18677,41.88793],[-7.18549,41.97515],[-7.14115,41.98855],[-7.08574,41.97401],[-7.07596,41.94977],[-7.01078,41.94977],[-6.98144,41.9728],[-6.95537,41.96553],[-6.94396,41.94403],[-6.82174,41.94493],[-6.81196,41.99097],[-6.76959,41.98734],[-6.75004,41.94129],[-6.61967,41.94008],[-6.58544,41.96674],[-6.5447,41.94371],[-6.56752,41.88429],[-6.51374,41.8758],[-6.56426,41.74219],[-6.54633,41.68623],[-6.49907,41.65823],[-6.44204,41.68258],[-6.29863,41.66432],[-6.19128,41.57638],[-6.26777,41.48796],[-6.3306,41.37677],[-6.38553,41.38655],[-6.38551,41.35274],[-6.55937,41.24417],[-6.65046,41.24725],[-6.68286,41.21641],[-6.69711,41.1858],[-6.77319,41.13049],[-6.75655,41.10187],[-6.79241,41.05397],[-6.80942,41.03629],[-6.84781,41.02692],[-6.88843,41.03027],[-6.913,41.03922],[-6.9357,41.02888],[-6.8527,40.93958],[-6.84292,40.89771],[-6.80707,40.88047],[-6.79892,40.84842],[-6.82337,40.84472],[-6.82826,40.74603],[-6.79567,40.65955],[-6.84292,40.56801],[-6.80218,40.55067],[-6.7973,40.51723],[-6.84944,40.46394],[-6.84618,40.42177],[-6.78426,40.36468],[-6.80218,40.33239],[-6.86085,40.2976],[-6.86085,40.26776],[-7.00426,40.23169],[-7.02544,40.18564],[-7.00589,40.12087],[-6.94233,40.10716],[-6.86737,40.01986],[-6.91463,39.86618],[-6.97492,39.81488],[-7.01613,39.66877],[-7.24707,39.66576],[-7.33507,39.64569],[-7.54121,39.66717],[-7.49477,39.58794],[-7.2927,39.45847],[-7.3149,39.34857],[-7.23403,39.27579],[-7.23566,39.20132],[-7.12811,39.17101],[-7.14929,39.11287],[-7.10692,39.10275],[-7.04011,39.11919],[-6.97004,39.07619],[-6.95211,39.0243],[-7.051,38.907],[-7.03848,38.87221],[-7.26174,38.72107],[-7.265,38.61674],[-7.32529,38.44336],[-7.15581,38.27597],[-7.09389,38.17227],[-6.93418,38.21454],[-7.00375,38.01914],[-7.05966,38.01966],[-7.10366,38.04404],[-7.12648,38.00296],[-7.24544,37.98884],[-7.27314,37.90145],[-7.33441,37.81193],[-7.41981,37.75729],[-7.51759,37.56119],[-7.46878,37.47127],[-7.43974,37.38913],[-7.43227,37.25152],[-7.41854,37.23813],[-7.41133,37.20314],[-7.39769,37.16868],[-7.37282,36.96896],[-7.2725,35.73269],[-5.10878,36.05227],[-2.27707,35.35051],[3.75438,42.33445]],[[-5.27801,36.14942],[-5.34064,36.03744],[-5.40526,36.15488],[-5.34536,36.15501],[-5.33822,36.15272],[-5.27801,36.14942]]],[[[1.99838,42.44682],[2.01564,42.45171],[1.99216,42.46208],[1.98579,42.47486],[1.99766,42.4858],[1.98916,42.49351],[1.98022,42.49569],[1.97697,42.48568],[1.97227,42.48487],[1.97003,42.48081],[1.96215,42.47854],[1.95606,42.45785],[1.96125,42.45364],[1.98378,42.44697],[1.99838,42.44682]]]]}},{type:"Feature",properties:{wikidata:"Q98059339",nameEn:"Mainland Norway",country:"NO",groups:["154","150","UN"],callingCodes:["47"]},geometry:{type:"MultiPolygon",coordinates:[[[[10.40861,58.38489],[10.64958,58.89391],[11.08911,58.98745],[11.15367,59.07862],[11.34459,59.11672],[11.4601,58.99022],[11.45199,58.89604],[11.65732,58.90177],[11.8213,59.24985],[11.69297,59.59442],[11.92112,59.69531],[11.87121,59.86039],[12.15641,59.8926],[12.36317,59.99259],[12.52003,60.13846],[12.59133,60.50559],[12.2277,61.02442],[12.69115,61.06584],[12.86939,61.35427],[12.57707,61.56547],[12.40595,61.57226],[12.14746,61.7147],[12.29187,62.25699],[12.07085,62.6297],[12.19919,63.00104],[11.98529,63.27487],[12.19919,63.47935],[12.14928,63.59373],[12.74105,64.02171],[13.23411,64.09087],[13.98222,64.00953],[14.16051,64.18725],[14.11117,64.46674],[13.64276,64.58402],[14.50926,65.31786],[14.53778,66.12399],[15.05113,66.15572],[15.49318,66.28509],[15.37197,66.48217],[16.35589,67.06419],[16.39154,67.21653],[16.09922,67.4364],[16.12774,67.52106],[16.38441,67.52923],[16.7409,67.91037],[17.30416,68.11591],[17.90787,67.96537],[18.13836,68.20874],[18.1241,68.53721],[18.39503,68.58672],[18.63032,68.50849],[18.97255,68.52416],[19.93508,68.35911],[20.22027,68.48759],[19.95647,68.55546],[20.22027,68.67246],[20.33435,68.80174],[20.28444,68.93283],[20.0695,69.04469],[20.55258,69.06069],[20.72171,69.11874],[21.05775,69.0356],[21.11099,69.10291],[20.98641,69.18809],[21.00732,69.22755],[21.27827,69.31281],[21.63833,69.27485],[22.27276,68.89514],[22.38367,68.71561],[22.53321,68.74393],[23.13064,68.64684],[23.68017,68.70276],[23.781,68.84514],[24.02299,68.81601],[24.18432,68.73936],[24.74898,68.65143],[24.90023,68.55579],[24.93048,68.61102],[25.10189,68.63307],[25.12206,68.78684],[25.42455,68.90328],[25.61613,68.89602],[25.75729,68.99383],[25.69679,69.27039],[25.96904,69.68397],[26.40261,69.91377],[26.64461,69.96565],[27.05802,69.92069],[27.57226,70.06215],[27.95542,70.0965],[27.97558,69.99671],[28.32849,69.88605],[28.36883,69.81658],[29.12697,69.69193],[29.31664,69.47994],[28.8629,69.22395],[28.81248,69.11997],[28.91738,69.04774],[29.0444,69.0119],[29.26623,69.13794],[29.27631,69.2811],[29.97205,69.41623],[30.16363,69.65244],[30.52662,69.54699],[30.95011,69.54699],[30.84095,69.80584],[31.59909,70.16571],[32.07813,72.01005],[-11.60274,67.73467],[7.28637,57.35913],[10.40861,58.38489]]]]}},{type:"Feature",properties:{wikidata:"Q98543636",nameEn:"Mainland Ecuador",country:"EC",groups:["005","419","019","UN"],callingCodes:["593"]},geometry:{type:"MultiPolygon",coordinates:[[[[-84.52388,-3.36941],[-80.30602,-3.39149],[-80.20647,-3.431],[-80.24123,-3.46124],[-80.24586,-3.48677],[-80.23651,-3.48652],[-80.22629,-3.501],[-80.20535,-3.51667],[-80.21642,-3.5888],[-80.19848,-3.59249],[-80.18741,-3.63994],[-80.19926,-3.68894],[-80.13232,-3.90317],[-80.46386,-4.01342],[-80.4822,-4.05477],[-80.45023,-4.20938],[-80.32114,-4.21323],[-80.46386,-4.41516],[-80.39256,-4.48269],[-80.13945,-4.29786],[-79.79722,-4.47558],[-79.59402,-4.46848],[-79.26248,-4.95167],[-79.1162,-4.97774],[-79.01659,-5.01481],[-78.85149,-4.66795],[-78.68394,-4.60754],[-78.34362,-3.38633],[-78.24589,-3.39907],[-78.22642,-3.51113],[-78.14324,-3.47653],[-78.19369,-3.36431],[-77.94147,-3.05454],[-76.6324,-2.58397],[-76.05203,-2.12179],[-75.57429,-1.55961],[-75.3872,-.9374],[-75.22862,-.95588],[-75.22862,-.60048],[-75.53615,-.19213],[-75.60169,-.18708],[-75.61997,-.10012],[-75.40192,-.17196],[-75.25764,-.11943],[-75.82927,.09578],[-76.23441,.42294],[-76.41215,.38228],[-76.4094,.24015],[-76.89177,.24736],[-77.52001,.40782],[-77.49984,.64476],[-77.67815,.73863],[-77.66416,.81604],[-77.68613,.83029],[-77.7148,.85003],[-77.85677,.80197],[-78.42749,1.15389],[-78.87137,1.47457],[-82.12561,4.00341],[-84.52388,-3.36941]]]]}},{type:"Feature",properties:{m49:"001",wikidata:"Q2",nameEn:"World",aliases:["Earth","Planet"],level:"world"},geometry:null},{type:"Feature",properties:{m49:"002",wikidata:"Q15",nameEn:"Africa",level:"region"},geometry:null},{type:"Feature",properties:{m49:"003",wikidata:"Q49",nameEn:"North America",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"005",wikidata:"Q18",nameEn:"South America",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"009",wikidata:"Q538",nameEn:"Oceania",level:"region"},geometry:null},{type:"Feature",properties:{m49:"011",wikidata:"Q4412",nameEn:"Western Africa",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"013",wikidata:"Q27611",nameEn:"Central America",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"014",wikidata:"Q27407",nameEn:"Eastern Africa",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"015",wikidata:"Q27381",nameEn:"Northern Africa",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"017",wikidata:"Q27433",nameEn:"Middle Africa",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"018",wikidata:"Q27394",nameEn:"Southern Africa",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"019",wikidata:"Q828",nameEn:"Americas",level:"region"},geometry:null},{type:"Feature",properties:{m49:"021",wikidata:"Q2017699",nameEn:"Northern America",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"029",wikidata:"Q664609",nameEn:"Caribbean",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"030",wikidata:"Q27231",nameEn:"Eastern Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"034",wikidata:"Q771405",nameEn:"Southern Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"035",wikidata:"Q11708",nameEn:"South-eastern Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"039",wikidata:"Q27449",nameEn:"Southern Europe",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"053",wikidata:"Q45256",nameEn:"Australia and New Zealand",aliases:["Australasia"],level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"054",wikidata:"Q37394",nameEn:"Melanesia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"057",wikidata:"Q3359409",nameEn:"Micronesia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"061",wikidata:"Q35942",nameEn:"Polynesia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"142",wikidata:"Q48",nameEn:"Asia",level:"region"},geometry:null},{type:"Feature",properties:{m49:"143",wikidata:"Q27275",nameEn:"Central Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"145",wikidata:"Q27293",nameEn:"Western Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"150",wikidata:"Q46",nameEn:"Europe",level:"region"},geometry:null},{type:"Feature",properties:{m49:"151",wikidata:"Q27468",nameEn:"Eastern Europe",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"154",wikidata:"Q27479",nameEn:"Northern Europe",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"155",wikidata:"Q27496",nameEn:"Western Europe",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"202",wikidata:"Q132959",nameEn:"Sub-Saharan Africa",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"419",wikidata:"Q72829598",nameEn:"Latin America and the Caribbean",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"680",wikidata:"Q3405693",nameEn:"Sark",country:"GB",groups:["GG","830","Q185086","154","150","UN"],level:"subterritory",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01481"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.36485,49.48223],[-2.65349,49.15373],[-2.09454,49.46288],[-2.36485,49.48223]]]]}},{type:"Feature",properties:{m49:"830",wikidata:"Q42314",nameEn:"Channel Islands",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{iso1A2:"AC",iso1A3:"ASC",wikidata:"Q46197",nameEn:"Ascension Island",aliases:["SH-AC"],country:"GB",groups:["SH","BOTS","011","202","002","UN"],isoStatus:"excRes",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["247"]},geometry:{type:"MultiPolygon",coordinates:[[[[-14.82771,-8.70814],[-13.33271,-8.07391],[-14.91926,-6.63386],[-14.82771,-8.70814]]]]}},{type:"Feature",properties:{iso1A2:"AD",iso1A3:"AND",iso1N3:"020",wikidata:"Q228",nameEn:"Andorra",groups:["Q12837","039","150","UN"],callingCodes:["376"]},geometry:{type:"MultiPolygon",coordinates:[[[[1.72515,42.50338],[1.73683,42.55492],[1.7858,42.57698],[1.72588,42.59098],[1.73452,42.61515],[1.68267,42.62533],[1.6625,42.61982],[1.63485,42.62957],[1.60085,42.62703],[1.55418,42.65669],[1.50867,42.64483],[1.48043,42.65203],[1.46718,42.63296],[1.47986,42.61346],[1.44197,42.60217],[1.42512,42.58292],[1.44529,42.56722],[1.4234,42.55959],[1.41245,42.53539],[1.44759,42.54431],[1.46661,42.50949],[1.41648,42.48315],[1.43838,42.47848],[1.44529,42.43724],[1.5127,42.42959],[1.55073,42.43299],[1.55937,42.45808],[1.57953,42.44957],[1.58933,42.46275],[1.65674,42.47125],[1.66826,42.50779],[1.70571,42.48867],[1.72515,42.50338]]]]}},{type:"Feature",properties:{iso1A2:"AE",iso1A3:"ARE",iso1N3:"784",wikidata:"Q878",nameEn:"United Arab Emirates",groups:["145","142","UN"],callingCodes:["971"]},geometry:{type:"MultiPolygon",coordinates:[[[[56.26534,25.62825],[56.25341,25.61443],[56.26636,25.60643],[56.25365,25.60211],[56.20473,25.61119],[56.18363,25.65508],[56.14826,25.66351],[56.13579,25.73524],[56.17416,25.77239],[56.13963,25.82765],[56.19334,25.9795],[56.15498,26.06828],[56.08666,26.05038],[55.81777,26.18798],[55.14145,25.62624],[53.97892,24.64436],[52.82259,25.51697],[52.35509,25.00368],[52.02277,24.75635],[51.83108,24.71675],[51.58834,24.66608],[51.41644,24.39615],[51.58871,24.27256],[51.59617,24.12041],[52.56622,22.94341],[55.13599,22.63334],[55.2137,22.71065],[55.22634,23.10378],[55.57358,23.669],[55.48677,23.94946],[55.73301,24.05994],[55.8308,24.01633],[56.01799,24.07426],[55.95472,24.2172],[55.83367,24.20193],[55.77658,24.23476],[55.76558,24.23227],[55.75257,24.23466],[55.75382,24.2466],[55.75939,24.26114],[55.76781,24.26209],[55.79145,24.27914],[55.80747,24.31069],[55.83395,24.32776],[55.83271,24.41521],[55.76461,24.5287],[55.83271,24.68567],[55.83408,24.77858],[55.81348,24.80102],[55.81116,24.9116],[55.85094,24.96858],[55.90849,24.96771],[55.96316,25.00857],[56.05715,24.95727],[56.05106,24.87461],[55.97467,24.89639],[55.97836,24.87673],[56.03535,24.81161],[56.06128,24.74457],[56.13684,24.73699],[56.20062,24.78565],[56.20568,24.85063],[56.30269,24.88334],[56.34873,24.93205],[56.3227,24.97284],[56.86325,25.03856],[56.82555,25.7713],[56.26534,25.62825]],[[56.26062,25.33108],[56.3005,25.31815],[56.3111,25.30107],[56.35172,25.30681],[56.34438,25.26653],[56.27628,25.23404],[56.24341,25.22867],[56.20872,25.24104],[56.20838,25.25668],[56.24465,25.27505],[56.25008,25.28843],[56.23362,25.31253],[56.26062,25.33108]]],[[[56.28423,25.26344],[56.29379,25.2754],[56.28102,25.28486],[56.2716,25.27916],[56.27086,25.26128],[56.28423,25.26344]]]]}},{type:"Feature",properties:{iso1A2:"AF",iso1A3:"AFG",iso1N3:"004",wikidata:"Q889",nameEn:"Afghanistan",groups:["034","142","UN"],callingCodes:["93"]},geometry:{type:"MultiPolygon",coordinates:[[[[70.61526,38.34774],[70.60407,38.28046],[70.54673,38.24541],[70.4898,38.12546],[70.17206,37.93276],[70.1863,37.84296],[70.27694,37.81258],[70.28243,37.66706],[70.15015,37.52519],[69.95971,37.5659],[69.93362,37.61378],[69.84435,37.60616],[69.80041,37.5746],[69.51888,37.5844],[69.44954,37.4869],[69.36645,37.40462],[69.45022,37.23315],[69.39529,37.16752],[69.25152,37.09426],[69.03274,37.25174],[68.96407,37.32603],[68.88168,37.33368],[68.91189,37.26704],[68.80889,37.32494],[68.81438,37.23862],[68.6798,37.27906],[68.61851,37.19815],[68.41888,37.13906],[68.41201,37.10402],[68.29253,37.10621],[68.27605,37.00977],[68.18542,37.02074],[68.02194,36.91923],[67.87917,37.0591],[67.7803,37.08978],[67.78329,37.1834],[67.51868,37.26102],[67.2581,37.17216],[67.2224,37.24545],[67.13039,37.27168],[67.08232,37.35469],[66.95598,37.40162],[66.64699,37.32958],[66.55743,37.35409],[66.30993,37.32409],[65.72274,37.55438],[65.64137,37.45061],[65.64263,37.34388],[65.51778,37.23881],[64.97945,37.21913],[64.61141,36.6351],[64.62514,36.44311],[64.57295,36.34362],[64.43288,36.24401],[64.05385,36.10433],[63.98519,36.03773],[63.56496,35.95106],[63.53475,35.90881],[63.29579,35.85985],[63.12276,35.86208],[63.10318,35.81782],[63.23262,35.67487],[63.10079,35.63024],[63.12276,35.53196],[63.0898,35.43131],[62.90853,35.37086],[62.74098,35.25432],[62.62288,35.22067],[62.48006,35.28796],[62.29878,35.13312],[62.29191,35.25964],[62.15871,35.33278],[62.05709,35.43803],[61.97743,35.4604],[61.77693,35.41341],[61.58742,35.43803],[61.27371,35.61482],[61.18187,35.30249],[61.0991,35.27845],[61.12831,35.09938],[61.06926,34.82139],[61.00197,34.70631],[60.99922,34.63064],[60.72316,34.52857],[60.91321,34.30411],[60.66502,34.31539],[60.50209,34.13992],[60.5838,33.80793],[60.5485,33.73422],[60.57762,33.59772],[60.69573,33.56054],[60.91133,33.55596],[60.88908,33.50219],[60.56485,33.12944],[60.86191,32.22565],[60.84541,31.49561],[61.70929,31.37391],[61.80569,31.16167],[61.80957,31.12576],[61.83257,31.0452],[61.8335,30.97669],[61.78268,30.92724],[61.80829,30.84224],[60.87231,29.86514],[62.47751,29.40782],[63.5876,29.50456],[64.12966,29.39157],[64.19796,29.50407],[64.62116,29.58903],[65.04005,29.53957],[66.24175,29.85181],[66.36042,29.9583],[66.23609,30.06321],[66.34869,30.404],[66.28413,30.57001],[66.39194,30.9408],[66.42645,30.95309],[66.58175,30.97532],[66.68166,31.07597],[66.72561,31.20526],[66.83273,31.26867],[67.04147,31.31561],[67.03323,31.24519],[67.29964,31.19586],[67.78854,31.33203],[67.7748,31.4188],[67.62374,31.40473],[67.58323,31.52772],[67.72056,31.52304],[67.86887,31.63536],[68.00071,31.6564],[68.1655,31.82691],[68.25614,31.80357],[68.27605,31.75863],[68.44222,31.76446],[68.57475,31.83158],[68.6956,31.75687],[68.79997,31.61665],[68.91078,31.59687],[68.95995,31.64822],[69.00939,31.62249],[69.11514,31.70782],[69.20577,31.85957],[69.3225,31.93186],[69.27032,32.14141],[69.27932,32.29119],[69.23599,32.45946],[69.2868,32.53938],[69.38155,32.56601],[69.44747,32.6678],[69.43649,32.7302],[69.38018,32.76601],[69.47082,32.85834],[69.5436,32.8768],[69.49854,32.88843],[69.49004,33.01509],[69.57656,33.09911],[69.71526,33.09911],[69.79766,33.13247],[69.85259,33.09451],[70.02563,33.14282],[70.07369,33.22557],[70.13686,33.21064],[70.32775,33.34496],[70.17062,33.53535],[70.20141,33.64387],[70.14785,33.6553],[70.14236,33.71701],[70.00503,33.73528],[69.85671,33.93719],[69.87307,33.9689],[69.90203,34.04194],[70.54336,33.9463],[70.88119,33.97933],[71.07345,34.06242],[71.06933,34.10564],[71.09307,34.11961],[71.09453,34.13524],[71.13078,34.16503],[71.12815,34.26619],[71.17662,34.36769],[71.02401,34.44835],[71.0089,34.54568],[71.11602,34.63047],[71.08718,34.69034],[71.28356,34.80882],[71.29472,34.87728],[71.50329,34.97328],[71.49917,35.00478],[71.55273,35.02615],[71.52938,35.09023],[71.67495,35.21262],[71.5541,35.28776],[71.54294,35.31037],[71.65435,35.4479],[71.49917,35.6267],[71.55273,35.71483],[71.37969,35.95865],[71.19505,36.04134],[71.60491,36.39429],[71.80267,36.49924],[72.18135,36.71838],[72.6323,36.84601],[73.82685,36.91421],[74.04856,36.82648],[74.43389,37.00977],[74.53739,36.96224],[74.56453,37.03023],[74.49981,37.24518],[74.80605,37.21565],[74.88887,37.23275],[74.8294,37.3435],[74.68383,37.3948],[74.56161,37.37734],[74.41055,37.3948],[74.23339,37.41116],[74.20308,37.34208],[73.8564,37.26158],[73.82552,37.22659],[73.64974,37.23643],[73.61129,37.27469],[73.76647,37.33913],[73.77197,37.4417],[73.29633,37.46495],[73.06884,37.31729],[72.79693,37.22222],[72.66381,37.02014],[72.54095,37.00007],[72.31676,36.98115],[71.83229,36.68084],[71.67083,36.67346],[71.57195,36.74943],[71.51502,36.89128],[71.48481,36.93218],[71.46923,36.99925],[71.45578,37.03094],[71.43097,37.05855],[71.44127,37.11856],[71.4494,37.18137],[71.4555,37.21418],[71.47386,37.2269],[71.48339,37.23937],[71.4824,37.24921],[71.48536,37.26017],[71.50674,37.31502],[71.49821,37.31975],[71.4862,37.33405],[71.47685,37.40281],[71.49612,37.4279],[71.5256,37.47971],[71.50616,37.50733],[71.49693,37.53527],[71.5065,37.60912],[71.51972,37.61945],[71.54186,37.69691],[71.55234,37.73209],[71.53053,37.76534],[71.54324,37.77104],[71.55752,37.78677],[71.59255,37.79956],[71.58843,37.92425],[71.51565,37.95349],[71.32871,37.88564],[71.296,37.93403],[71.2809,37.91995],[71.24969,37.93031],[71.27278,37.96496],[71.27622,37.99946],[71.28922,38.01272],[71.29878,38.04429],[71.36444,38.15358],[71.37803,38.25641],[71.33869,38.27335],[71.33114,38.30339],[71.21291,38.32797],[71.1451,38.40106],[71.10957,38.40671],[71.10592,38.42077],[71.09542,38.42517],[71.0556,38.40176],[71.03545,38.44779],[70.98693,38.48862],[70.92728,38.43021],[70.88719,38.46826],[70.84376,38.44688],[70.82538,38.45394],[70.81697,38.44507],[70.80521,38.44447],[70.79766,38.44944],[70.78702,38.45031],[70.78581,38.45502],[70.77132,38.45548],[70.75455,38.4252],[70.72485,38.4131],[70.69807,38.41861],[70.67438,38.40597],[70.6761,38.39144],[70.69189,38.37031],[70.64966,38.34999],[70.61526,38.34774]]]]}},{type:"Feature",properties:{iso1A2:"AG",iso1A3:"ATG",iso1N3:"028",wikidata:"Q781",nameEn:"Antigua and Barbuda",groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 268"]},geometry:{type:"MultiPolygon",coordinates:[[[[-61.66959,18.6782],[-62.58307,16.68909],[-62.1023,16.97277],[-61.23098,16.62484],[-61.66959,18.6782]]]]}},{type:"Feature",properties:{iso1A2:"AI",iso1A3:"AIA",iso1N3:"660",wikidata:"Q25228",nameEn:"Anguilla",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 264"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.79029,19.11219],[-63.35989,18.06012],[-62.62718,18.26185],[-63.79029,19.11219]]]]}},{type:"Feature",properties:{iso1A2:"AL",iso1A3:"ALB",iso1N3:"008",wikidata:"Q222",nameEn:"Albania",groups:["039","150","UN"],callingCodes:["355"]},geometry:{type:"MultiPolygon",coordinates:[[[[20.07761,42.55582],[20.01834,42.54622],[20.00842,42.5109],[19.9324,42.51699],[19.82333,42.46581],[19.76549,42.50237],[19.74731,42.57422],[19.77375,42.58517],[19.73244,42.66299],[19.65972,42.62774],[19.4836,42.40831],[19.42352,42.36546],[19.42,42.33019],[19.28623,42.17745],[19.40687,42.10024],[19.37548,42.06835],[19.36867,42.02564],[19.37691,41.96977],[19.34601,41.95675],[19.33812,41.90669],[19.37451,41.8842],[19.37597,41.84849],[19.26406,41.74971],[19.0384,40.35325],[19.95905,39.82857],[19.97622,39.78684],[19.92466,39.69533],[19.98042,39.6504],[20.00957,39.69227],[20.05189,39.69112],[20.12956,39.65805],[20.15988,39.652],[20.22376,39.64532],[20.22707,39.67459],[20.27412,39.69884],[20.31961,39.72799],[20.29152,39.80421],[20.30804,39.81563],[20.38572,39.78516],[20.41475,39.81437],[20.41546,39.82832],[20.31135,39.99438],[20.37911,39.99058],[20.42373,40.06777],[20.48487,40.06271],[20.51297,40.08168],[20.55593,40.06524],[20.61081,40.07866],[20.62566,40.0897],[20.67162,40.09433],[20.71789,40.27739],[20.78234,40.35803],[20.7906,40.42726],[20.83688,40.47882],[20.94925,40.46625],[20.96908,40.51526],[21.03932,40.56299],[21.05833,40.66586],[20.98134,40.76046],[20.95752,40.76982],[20.98396,40.79109],[20.97887,40.85475],[20.97693,40.90103],[20.94305,40.92399],[20.83671,40.92752],[20.81567,40.89662],[20.73504,40.9081],[20.71634,40.91781],[20.65558,41.08009],[20.63454,41.0889],[20.59832,41.09066],[20.58546,41.11179],[20.59715,41.13644],[20.51068,41.2323],[20.49432,41.33679],[20.52119,41.34381],[20.55976,41.4087],[20.51301,41.442],[20.49039,41.49277],[20.45331,41.51436],[20.45809,41.5549],[20.52103,41.56473],[20.55508,41.58113],[20.51769,41.65975],[20.52937,41.69292],[20.51301,41.72433],[20.53405,41.78099],[20.57144,41.7897],[20.55976,41.87068],[20.59524,41.8818],[20.57946,41.91593],[20.63069,41.94913],[20.59434,42.03879],[20.55633,42.08173],[20.56955,42.12097],[20.48857,42.25444],[20.3819,42.3029],[20.34479,42.32656],[20.24399,42.32168],[20.21797,42.41237],[20.17127,42.50469],[20.07761,42.55582]]]]}},{type:"Feature",properties:{iso1A2:"AM",iso1A3:"ARM",iso1N3:"051",wikidata:"Q399",nameEn:"Armenia",groups:["145","142","UN"],callingCodes:["374"]},geometry:{type:"MultiPolygon",coordinates:[[[[45.0133,41.29747],[44.93493,41.25685],[44.81437,41.30371],[44.80053,41.25949],[44.81749,41.23488],[44.84358,41.23088],[44.89911,41.21366],[44.87887,41.20195],[44.82084,41.21513],[44.72814,41.20338],[44.61462,41.24018],[44.59322,41.1933],[44.46791,41.18204],[44.34417,41.2382],[44.34337,41.20312],[44.32139,41.2079],[44.18148,41.24644],[44.16591,41.19141],[43.84835,41.16329],[43.74717,41.1117],[43.67712,41.13398],[43.4717,41.12611],[43.44984,41.0988],[43.47319,41.02251],[43.58683,40.98961],[43.67712,40.93084],[43.67712,40.84846],[43.74872,40.7365],[43.7425,40.66805],[43.63664,40.54159],[43.54791,40.47413],[43.60862,40.43267],[43.59928,40.34019],[43.71136,40.16673],[43.65221,40.14889],[43.65688,40.11199],[43.92307,40.01787],[44.1057,40.03555],[44.1778,40.02845],[44.26973,40.04866],[44.46635,39.97733],[44.61845,39.8281],[44.75779,39.7148],[44.88354,39.74432],[44.92869,39.72157],[45.06604,39.79277],[45.18554,39.67846],[45.17464,39.58614],[45.21784,39.58074],[45.23535,39.61373],[45.30385,39.61373],[45.29606,39.57654],[45.46992,39.49888],[45.70547,39.60174],[45.80804,39.56716],[45.83,39.46487],[45.79225,39.3695],[45.99774,39.28931],[46.02303,39.09978],[46.06973,39.0744],[46.14785,38.84206],[46.20601,38.85262],[46.34059,38.92076],[46.53497,38.86548],[46.51805,38.94982],[46.54296,39.07078],[46.44022,39.19636],[46.52584,39.18912],[46.54141,39.15895],[46.58032,39.21204],[46.63481,39.23013],[46.56476,39.24942],[46.50093,39.33736],[46.43244,39.35181],[46.37795,39.42039],[46.4013,39.45405],[46.53051,39.47809],[46.51027,39.52373],[46.57721,39.54414],[46.57098,39.56694],[46.52117,39.58734],[46.42465,39.57534],[46.40286,39.63651],[46.18493,39.60533],[45.96543,39.78859],[45.82533,39.82925],[45.7833,39.9475],[45.60895,39.97733],[45.59806,40.0131],[45.78642,40.03218],[45.83779,39.98925],[45.97944,40.181],[45.95609,40.27846],[45.65098,40.37696],[45.42994,40.53804],[45.45484,40.57707],[45.35366,40.65979],[45.4206,40.7424],[45.55914,40.78366],[45.60584,40.87436],[45.40814,40.97904],[45.44083,41.01663],[45.39725,41.02603],[45.35677,40.99784],[45.28859,41.03757],[45.26162,41.0228],[45.25897,41.0027],[45.1994,41.04518],[45.16493,41.05068],[45.1634,41.08082],[45.1313,41.09369],[45.12923,41.06059],[45.06784,41.05379],[45.08028,41.10917],[45.19942,41.13299],[45.1969,41.168],[45.11811,41.19967],[45.05201,41.19211],[45.02932,41.2101],[45.05497,41.2464],[45.0133,41.29747]],[[45.21324,40.9817],[45.21219,40.99001],[45.20518,40.99348],[45.19312,40.98998],[45.18382,41.0066],[45.20625,41.01484],[45.23487,41.00226],[45.23095,40.97828],[45.21324,40.9817]],[[45.00864,41.03411],[44.9903,41.05657],[44.96031,41.06345],[44.95383,41.07553],[44.97169,41.09176],[45.00864,41.09407],[45.03406,41.07931],[45.04517,41.06653],[45.03792,41.03938],[45.00864,41.03411]]],[[[45.50279,40.58424],[45.56071,40.64765],[45.51825,40.67382],[45.47927,40.65023],[45.50279,40.58424]]]]}},{type:"Feature",properties:{iso1A2:"AO",iso1A3:"AGO",iso1N3:"024",wikidata:"Q916",nameEn:"Angola",groups:["017","202","002","UN"],callingCodes:["244"]},geometry:{type:"MultiPolygon",coordinates:[[[[16.55507,-5.85631],[13.04371,-5.87078],[12.42245,-6.07585],[11.95767,-5.94705],[12.20376,-5.76338],[12.26557,-5.74031],[12.52318,-5.74353],[12.52301,-5.17481],[12.53599,-5.1618],[12.53586,-5.14658],[12.51589,-5.1332],[12.49815,-5.14058],[12.46297,-5.09408],[12.60251,-5.01715],[12.63465,-4.94632],[12.70868,-4.95505],[12.8733,-4.74346],[13.11195,-4.67745],[13.09648,-4.63739],[12.91489,-4.47907],[12.87096,-4.40315],[12.76844,-4.38709],[12.64835,-4.55937],[12.40964,-4.60609],[12.32324,-4.78415],[12.25587,-4.79437],[12.20901,-4.75642],[12.16068,-4.90089],[12.00924,-5.02627],[11.50888,-5.33417],[10.5065,-17.25284],[11.75063,-17.25013],[12.07076,-17.15165],[12.52111,-17.24495],[12.97145,-16.98567],[13.36212,-16.98048],[13.95896,-17.43141],[14.28743,-17.38814],[18.39229,-17.38927],[18.84226,-17.80375],[21.14283,-17.94318],[21.42741,-18.02787],[23.47474,-17.62877],[23.20038,-17.47563],[22.17217,-16.50269],[22.00323,-16.18028],[21.97988,-13.00148],[24.03339,-12.99091],[23.90937,-12.844],[24.06672,-12.29058],[23.98804,-12.13149],[24.02603,-11.15368],[24.00027,-10.89356],[23.86868,-11.02856],[23.45631,-10.946],[23.16602,-11.10577],[22.54205,-11.05784],[22.25951,-11.24911],[22.17954,-10.85884],[22.32604,-10.76291],[22.19039,-9.94628],[21.84856,-9.59871],[21.79824,-7.29628],[20.56263,-7.28566],[20.61689,-6.90876],[20.31846,-6.91953],[20.30218,-6.98955],[19.5469,-7.00195],[19.33698,-7.99743],[18.33635,-8.00126],[17.5828,-8.13784],[16.96282,-7.21787],[16.55507,-5.85631]]]]}},{type:"Feature",properties:{iso1A2:"AQ",iso1A3:"ATA",iso1N3:"010",wikidata:"Q51",nameEn:"Antarctica",level:"region",callingCodes:["672"]},geometry:{type:"MultiPolygon",coordinates:[[[[180,-60],[-180,-60],[-180,-90],[180,-90],[180,-60]]]]}},{type:"Feature",properties:{iso1A2:"AR",iso1A3:"ARG",iso1N3:"032",wikidata:"Q414",nameEn:"Argentina",aliases:["RA"],groups:["005","419","019","UN"],callingCodes:["54"]},geometry:{type:"MultiPolygon",coordinates:[[[[-72.31343,-50.58411],[-72.33873,-51.59954],[-71.99889,-51.98018],[-69.97824,-52.00845],[-68.41683,-52.33516],[-68.60702,-52.65781],[-68.60733,-54.9125],[-68.01394,-54.8753],[-67.46182,-54.92205],[-67.11046,-54.94199],[-66.07313,-55.19618],[-63.67376,-55.11859],[-54.78916,-36.21945],[-57.83001,-34.69099],[-58.34425,-34.15035],[-58.44442,-33.84033],[-58.40475,-33.11777],[-58.1224,-32.98842],[-58.22362,-32.52416],[-58.10036,-32.25338],[-58.20252,-31.86966],[-58.00076,-31.65016],[-58.0023,-31.53084],[-58.07569,-31.44916],[-57.98127,-31.3872],[-57.9908,-31.34924],[-57.86729,-31.06352],[-57.89476,-30.95994],[-57.8024,-30.77193],[-57.89115,-30.49572],[-57.64859,-30.35095],[-57.61478,-30.25165],[-57.65132,-30.19229],[-57.09386,-29.74211],[-56.81251,-29.48154],[-56.62789,-29.18073],[-56.57295,-29.11357],[-56.54171,-29.11447],[-56.05265,-28.62651],[-56.00458,-28.60421],[-56.01729,-28.51223],[-55.65418,-28.18304],[-55.6262,-28.17124],[-55.33303,-27.94661],[-55.16872,-27.86224],[-55.1349,-27.89759],[-54.90805,-27.73149],[-54.90159,-27.63132],[-54.67657,-27.57214],[-54.50416,-27.48232],[-54.41888,-27.40882],[-54.19268,-27.30751],[-54.19062,-27.27639],[-54.15978,-27.2889],[-53.80144,-27.09844],[-53.73372,-26.6131],[-53.68269,-26.33359],[-53.64505,-26.28089],[-53.64186,-26.25976],[-53.64632,-26.24798],[-53.63881,-26.25075],[-53.63739,-26.2496],[-53.65237,-26.23289],[-53.65018,-26.19501],[-53.73968,-26.10012],[-53.73391,-26.07006],[-53.7264,-26.0664],[-53.73086,-26.05842],[-53.73511,-26.04211],[-53.83691,-25.94849],[-53.90831,-25.55513],[-54.52926,-25.62846],[-54.5502,-25.58915],[-54.59398,-25.59224],[-54.62063,-25.91213],[-54.60664,-25.9691],[-54.67359,-25.98607],[-54.69333,-26.37705],[-54.70732,-26.45099],[-54.80868,-26.55669],[-55.00584,-26.78754],[-55.06351,-26.80195],[-55.16948,-26.96068],[-55.25243,-26.93808],[-55.39611,-26.97679],[-55.62322,-27.1941],[-55.59094,-27.32444],[-55.74475,-27.44485],[-55.89195,-27.3467],[-56.18313,-27.29851],[-56.85337,-27.5165],[-58.04205,-27.2387],[-58.59549,-27.29973],[-58.65321,-27.14028],[-58.3198,-26.83443],[-58.1188,-26.16704],[-57.87176,-25.93604],[-57.57431,-25.47269],[-57.80821,-25.13863],[-58.25492,-24.92528],[-58.33055,-24.97099],[-59.33886,-24.49935],[-59.45482,-24.34787],[-60.03367,-24.00701],[-60.28163,-24.04436],[-60.99754,-23.80934],[-61.0782,-23.62932],[-61.9756,-23.0507],[-62.22768,-22.55807],[-62.51761,-22.37684],[-62.64455,-22.25091],[-62.8078,-22.12534],[-62.81124,-21.9987],[-63.66482,-21.99918],[-63.68113,-22.0544],[-63.70963,-21.99934],[-63.93287,-21.99934],[-64.22918,-22.55807],[-64.31489,-22.88824],[-64.35108,-22.73282],[-64.4176,-22.67692],[-64.58888,-22.25035],[-64.67174,-22.18957],[-64.90014,-22.12136],[-64.99524,-22.08255],[-65.47435,-22.08908],[-65.57743,-22.07675],[-65.58694,-22.09794],[-65.61166,-22.09504],[-65.7467,-22.10105],[-65.9261,-21.93335],[-66.04832,-21.9187],[-66.03836,-21.84829],[-66.24077,-21.77837],[-66.29714,-22.08741],[-66.7298,-22.23644],[-67.18382,-22.81525],[-66.99632,-22.99839],[-67.33563,-24.04237],[-68.24825,-24.42596],[-68.56909,-24.69831],[-68.38372,-25.08636],[-68.57622,-25.32505],[-68.38372,-26.15353],[-68.56909,-26.28146],[-68.59048,-26.49861],[-68.27677,-26.90626],[-68.43363,-27.08414],[-68.77586,-27.16029],[-69.22504,-27.95042],[-69.66709,-28.44055],[-69.80969,-29.07185],[-69.99507,-29.28351],[-69.8596,-30.26131],[-70.14479,-30.36595],[-70.55832,-31.51559],[-69.88099,-33.34489],[-69.87386,-34.13344],[-70.49416,-35.24145],[-70.38008,-36.02375],[-70.95047,-36.4321],[-71.24279,-37.20264],[-70.89532,-38.6923],[-71.37826,-38.91474],[-71.92726,-40.72714],[-71.74901,-42.11711],[-72.15541,-42.15941],[-72.14828,-42.85321],[-71.64206,-43.64774],[-71.81318,-44.38097],[-71.16436,-44.46244],[-71.26418,-44.75684],[-72.06985,-44.81756],[-71.35687,-45.22075],[-71.75614,-45.61611],[-71.68577,-46.55385],[-71.94152,-47.13595],[-72.50478,-47.80586],[-72.27662,-48.28727],[-72.54042,-48.52392],[-72.56894,-48.81116],[-73.09655,-49.14342],[-73.45156,-49.79461],[-73.55259,-49.92488],[-73.15765,-50.78337],[-72.31343,-50.58411]]]]}},{type:"Feature",properties:{iso1A2:"AS",iso1A3:"ASM",iso1N3:"016",wikidata:"Q16641",nameEn:"American Samoa",aliases:["US-AS"],country:"US",groups:["Q1352230","061","009","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 684"]},geometry:{type:"MultiPolygon",coordinates:[[[[-171.39864,-10.21587],[-170.99605,-15.1275],[-166.32598,-15.26169],[-171.39864,-10.21587]]]]}},{type:"Feature",properties:{iso1A2:"AT",iso1A3:"AUT",iso1N3:"040",wikidata:"Q40",nameEn:"Austria",groups:["EU","155","150","UN"],callingCodes:["43"]},geometry:{type:"MultiPolygon",coordinates:[[[[15.34823,48.98444],[15.28305,48.98831],[15.26177,48.95766],[15.16358,48.94278],[15.15534,48.99056],[14.99878,49.01444],[14.97612,48.96983],[14.98917,48.90082],[14.95072,48.79101],[14.98032,48.77959],[14.9782,48.7766],[14.98112,48.77524],[14.9758,48.76857],[14.95641,48.75915],[14.94773,48.76268],[14.81545,48.7874],[14.80821,48.77711],[14.80584,48.73489],[14.72756,48.69502],[14.71794,48.59794],[14.66762,48.58215],[14.60808,48.62881],[14.56139,48.60429],[14.4587,48.64695],[14.43076,48.58855],[14.33909,48.55852],[14.20691,48.5898],[14.09104,48.5943],[14.01482,48.63788],[14.06151,48.66873],[13.84023,48.76988],[13.82266,48.75544],[13.81863,48.73257],[13.79337,48.71375],[13.81791,48.69832],[13.81283,48.68426],[13.81901,48.6761],[13.82609,48.62345],[13.80038,48.59487],[13.80519,48.58026],[13.76921,48.55324],[13.7513,48.5624],[13.74816,48.53058],[13.72802,48.51208],[13.66113,48.53558],[13.65186,48.55092],[13.62508,48.55501],[13.59705,48.57013],[13.57535,48.55912],[13.51291,48.59023],[13.50131,48.58091],[13.50663,48.57506],[13.46967,48.55157],[13.45214,48.56472],[13.43695,48.55776],[13.45727,48.51092],[13.42527,48.45711],[13.43929,48.43386],[13.40709,48.37292],[13.30897,48.31575],[13.26039,48.29422],[13.18093,48.29577],[13.126,48.27867],[13.0851,48.27711],[13.02083,48.25689],[12.95306,48.20629],[12.87126,48.20318],[12.84475,48.16556],[12.836,48.1647],[12.8362,48.15876],[12.82673,48.15245],[12.80676,48.14979],[12.78595,48.12445],[12.7617,48.12796],[12.74973,48.10885],[12.76141,48.07373],[12.8549,48.01122],[12.87476,47.96195],[12.91683,47.95647],[12.9211,47.95135],[12.91985,47.94069],[12.92668,47.93879],[12.93419,47.94063],[12.93642,47.94436],[12.93886,47.94046],[12.94163,47.92927],[13.00588,47.84374],[12.98543,47.82896],[12.96311,47.79957],[12.93202,47.77302],[12.94371,47.76281],[12.9353,47.74788],[12.91711,47.74026],[12.90274,47.72513],[12.91333,47.7178],[12.92969,47.71094],[12.98578,47.7078],[13.01382,47.72116],[13.07692,47.68814],[13.09562,47.63304],[13.06407,47.60075],[13.06641,47.58577],[13.04537,47.58183],[13.05355,47.56291],[13.03252,47.53373],[13.04537,47.49426],[12.9998,47.46267],[12.98344,47.48716],[12.9624,47.47452],[12.85256,47.52741],[12.84672,47.54556],[12.80699,47.54477],[12.77427,47.58025],[12.82101,47.61493],[12.76492,47.64485],[12.77777,47.66689],[12.7357,47.6787],[12.6071,47.6741],[12.57438,47.63238],[12.53816,47.63553],[12.50076,47.62293],[12.44117,47.6741],[12.43883,47.6977],[12.37222,47.68433],[12.336,47.69534],[12.27991,47.68827],[12.26004,47.67725],[12.24017,47.69534],[12.26238,47.73544],[12.2542,47.7433],[12.22571,47.71776],[12.18303,47.70065],[12.16217,47.70105],[12.16769,47.68167],[12.18347,47.66663],[12.18507,47.65984],[12.19895,47.64085],[12.20801,47.61082],[12.20398,47.60667],[12.18568,47.6049],[12.17737,47.60121],[12.18145,47.61019],[12.17824,47.61506],[12.13734,47.60639],[12.05788,47.61742],[12.02282,47.61033],[12.0088,47.62451],[11.85572,47.60166],[11.84052,47.58354],[11.63934,47.59202],[11.60681,47.57881],[11.58811,47.55515],[11.58578,47.52281],[11.52618,47.50939],[11.4362,47.51413],[11.38128,47.47465],[11.4175,47.44621],[11.33804,47.44937],[11.29597,47.42566],[11.27844,47.39956],[11.22002,47.3964],[11.25157,47.43277],[11.20482,47.43198],[11.12536,47.41222],[11.11835,47.39719],[10.97111,47.39561],[10.97111,47.41617],[10.98513,47.42882],[10.92437,47.46991],[10.93839,47.48018],[10.90918,47.48571],[10.87061,47.4786],[10.86945,47.5015],[10.91268,47.51334],[10.88814,47.53701],[10.77596,47.51729],[10.7596,47.53228],[10.6965,47.54253],[10.68832,47.55752],[10.63456,47.5591],[10.60337,47.56755],[10.56912,47.53584],[10.48849,47.54057],[10.47329,47.58552],[10.43473,47.58394],[10.44992,47.5524],[10.4324,47.50111],[10.44291,47.48453],[10.46278,47.47901],[10.47446,47.43318],[10.4359,47.41183],[10.4324,47.38494],[10.39851,47.37623],[10.33424,47.30813],[10.23257,47.27088],[10.17531,47.27167],[10.17648,47.29149],[10.2147,47.31014],[10.19998,47.32832],[10.23757,47.37609],[10.22774,47.38904],[10.2127,47.38019],[10.17648,47.38889],[10.16362,47.36674],[10.11805,47.37228],[10.09819,47.35724],[10.06897,47.40709],[10.1052,47.4316],[10.09001,47.46005],[10.07131,47.45531],[10.03859,47.48927],[10.00003,47.48216],[9.96029,47.53899],[9.92407,47.53111],[9.87733,47.54688],[9.87499,47.52953],[9.8189,47.54688],[9.82591,47.58158],[9.80254,47.59419],[9.76748,47.5934],[9.72736,47.53457],[9.55125,47.53629],[9.56312,47.49495],[9.58208,47.48344],[9.59482,47.46305],[9.60205,47.46165],[9.60484,47.46358],[9.60841,47.47178],[9.62158,47.45858],[9.62475,47.45685],[9.6423,47.45599],[9.65728,47.45383],[9.65863,47.44847],[9.64483,47.43842],[9.6446,47.43233],[9.65043,47.41937],[9.65136,47.40504],[9.6629,47.39591],[9.67334,47.39191],[9.67445,47.38429],[9.6711,47.37824],[9.66243,47.37136],[9.65427,47.36824],[9.62476,47.36639],[9.59978,47.34671],[9.58513,47.31334],[9.55857,47.29919],[9.54773,47.2809],[9.53116,47.27029],[9.56766,47.24281],[9.55176,47.22585],[9.56981,47.21926],[9.58264,47.20673],[9.56539,47.17124],[9.62623,47.14685],[9.63395,47.08443],[9.61216,47.07732],[9.60717,47.06091],[9.87935,47.01337],[9.88266,46.93343],[9.98058,46.91434],[10.10715,46.84296],[10.22675,46.86942],[10.24128,46.93147],[10.30031,46.92093],[10.36933,47.00212],[10.48376,46.93891],[10.47197,46.85698],[10.54783,46.84505],[10.66405,46.87614],[10.75753,46.82258],[10.72974,46.78972],[11.00764,46.76896],[11.10618,46.92966],[11.33355,46.99862],[11.50739,47.00644],[11.74789,46.98484],[12.19254,47.09331],[12.21781,47.03996],[12.11675,47.01241],[12.2006,46.88854],[12.27591,46.88651],[12.38708,46.71529],[12.59992,46.6595],[12.94445,46.60401],[13.27627,46.56059],[13.64088,46.53438],[13.7148,46.5222],[13.89837,46.52331],[14.00422,46.48474],[14.04002,46.49117],[14.12097,46.47724],[14.15989,46.43327],[14.28326,46.44315],[14.314,46.43327],[14.42608,46.44614],[14.45877,46.41717],[14.52176,46.42617],[14.56463,46.37208],[14.5942,46.43434],[14.66892,46.44936],[14.72185,46.49974],[14.81836,46.51046],[14.83549,46.56614],[14.86419,46.59411],[14.87129,46.61],[14.92283,46.60848],[14.96002,46.63459],[14.98024,46.6009],[15.01451,46.641],[15.14215,46.66131],[15.23711,46.63994],[15.41235,46.65556],[15.45514,46.63697],[15.46906,46.61321],[15.54431,46.6312],[15.55333,46.64988],[15.54533,46.66985],[15.59826,46.68908],[15.62317,46.67947],[15.63255,46.68069],[15.6365,46.6894],[15.6543,46.69228],[15.6543,46.70616],[15.67411,46.70735],[15.69523,46.69823],[15.72279,46.69548],[15.73823,46.70011],[15.76771,46.69863],[15.78518,46.70712],[15.8162,46.71897],[15.87691,46.7211],[15.94864,46.68769],[15.98512,46.68463],[15.99988,46.67947],[16.04036,46.6549],[16.04347,46.68694],[16.02808,46.71094],[15.99769,46.7266],[15.98432,46.74991],[15.99126,46.78199],[15.99054,46.82772],[16.05786,46.83927],[16.10983,46.867],[16.19904,46.94134],[16.22403,46.939],[16.27594,46.9643],[16.28202,47.00159],[16.51369,47.00084],[16.43936,47.03548],[16.52176,47.05747],[16.46134,47.09395],[16.52863,47.13974],[16.44932,47.14418],[16.46442,47.16845],[16.4523,47.18812],[16.42801,47.18422],[16.41739,47.20649],[16.43663,47.21127],[16.44142,47.25079],[16.47782,47.25918],[16.45104,47.41181],[16.49908,47.39416],[16.52414,47.41007],[16.57152,47.40868],[16.6718,47.46139],[16.64821,47.50155],[16.71059,47.52692],[16.64193,47.63114],[16.58699,47.61772],[16.4222,47.66537],[16.55129,47.72268],[16.53514,47.73837],[16.54779,47.75074],[16.61183,47.76171],[16.65679,47.74197],[16.72089,47.73469],[16.7511,47.67878],[16.82938,47.68432],[16.86509,47.72268],[16.87538,47.68895],[17.08893,47.70928],[17.05048,47.79377],[17.07039,47.81129],[17.00997,47.86245],[17.08275,47.87719],[17.11022,47.92461],[17.09786,47.97336],[17.16001,48.00636],[17.07039,48.0317],[17.09168,48.09366],[17.05735,48.14179],[17.02919,48.13996],[16.97701,48.17385],[16.89461,48.31332],[16.90903,48.32519],[16.84243,48.35258],[16.83317,48.38138],[16.83588,48.3844],[16.8497,48.38321],[16.85204,48.44968],[16.94611,48.53614],[16.93955,48.60371],[16.90354,48.71541],[16.79779,48.70998],[16.71883,48.73806],[16.68518,48.7281],[16.67008,48.77699],[16.46134,48.80865],[16.40915,48.74576],[16.37345,48.729],[16.06034,48.75436],[15.84404,48.86921],[15.78087,48.87644],[15.75341,48.8516],[15.6921,48.85973],[15.61622,48.89541],[15.51357,48.91549],[15.48027,48.94481],[15.34823,48.98444]]]]}},{type:"Feature",properties:{iso1A2:"AU",iso1A3:"AUS",iso1N3:"036",wikidata:"Q408",nameEn:"Australia"},geometry:null},{type:"Feature",properties:{iso1A2:"AW",iso1A3:"ABW",iso1N3:"533",wikidata:"Q21203",nameEn:"Aruba",aliases:["NL-AW"],country:"NL",groups:["Q1451600","029","003","419","019","UN"],callingCodes:["297"]},geometry:{type:"MultiPolygon",coordinates:[[[[-70.00823,12.98375],[-70.35625,12.58277],[-69.60231,12.17],[-70.00823,12.98375]]]]}},{type:"Feature",properties:{iso1A2:"AX",iso1A3:"ALA",iso1N3:"248",wikidata:"Q5689",nameEn:"\xC5land Islands",country:"FI",groups:["EU","154","150","UN"],callingCodes:["358 18","358 457"]},geometry:{type:"MultiPolygon",coordinates:[[[[19.08191,60.19152],[20.5104,59.15546],[21.35468,59.67511],[21.02509,60.12142],[21.08159,60.20167],[21.15143,60.54555],[20.96741,60.71528],[19.23413,60.61414],[19.08191,60.19152]]]]}},{type:"Feature",properties:{iso1A2:"AZ",iso1A3:"AZE",iso1N3:"031",wikidata:"Q227",nameEn:"Azerbaijan",groups:["145","142","UN"],callingCodes:["994"]},geometry:{type:"MultiPolygon",coordinates:[[[[46.42738,41.91323],[46.3984,41.84399],[46.30863,41.79133],[46.23962,41.75811],[46.20538,41.77205],[46.17891,41.72094],[46.19759,41.62327],[46.24429,41.59883],[46.26531,41.63339],[46.28182,41.60089],[46.3253,41.60912],[46.34039,41.5947],[46.34126,41.57454],[46.29794,41.5724],[46.33925,41.4963],[46.40307,41.48464],[46.4669,41.43331],[46.63658,41.37727],[46.72375,41.28609],[46.66148,41.20533],[46.63969,41.09515],[46.55096,41.1104],[46.48558,41.0576],[46.456,41.09984],[46.37661,41.10805],[46.27698,41.19011],[46.13221,41.19479],[45.95786,41.17956],[45.80842,41.2229],[45.69946,41.29545],[45.75705,41.35157],[45.71035,41.36208],[45.68389,41.3539],[45.45973,41.45898],[45.4006,41.42402],[45.31352,41.47168],[45.26285,41.46433],[45.1797,41.42231],[45.09867,41.34065],[45.0133,41.29747],[45.05497,41.2464],[45.02932,41.2101],[45.05201,41.19211],[45.11811,41.19967],[45.1969,41.168],[45.19942,41.13299],[45.08028,41.10917],[45.06784,41.05379],[45.12923,41.06059],[45.1313,41.09369],[45.1634,41.08082],[45.16493,41.05068],[45.1994,41.04518],[45.25897,41.0027],[45.26162,41.0228],[45.28859,41.03757],[45.35677,40.99784],[45.39725,41.02603],[45.44083,41.01663],[45.40814,40.97904],[45.60584,40.87436],[45.55914,40.78366],[45.4206,40.7424],[45.35366,40.65979],[45.45484,40.57707],[45.42994,40.53804],[45.65098,40.37696],[45.95609,40.27846],[45.97944,40.181],[45.83779,39.98925],[45.78642,40.03218],[45.59806,40.0131],[45.60895,39.97733],[45.7833,39.9475],[45.82533,39.82925],[45.96543,39.78859],[46.18493,39.60533],[46.40286,39.63651],[46.42465,39.57534],[46.52117,39.58734],[46.57098,39.56694],[46.57721,39.54414],[46.51027,39.52373],[46.53051,39.47809],[46.4013,39.45405],[46.37795,39.42039],[46.43244,39.35181],[46.50093,39.33736],[46.56476,39.24942],[46.63481,39.23013],[46.58032,39.21204],[46.54141,39.15895],[46.52584,39.18912],[46.44022,39.19636],[46.54296,39.07078],[46.51805,38.94982],[46.53497,38.86548],[46.75752,39.03231],[46.83822,39.13143],[46.92539,39.16644],[46.95341,39.13505],[47.05771,39.20143],[47.05927,39.24846],[47.31301,39.37492],[47.38978,39.45999],[47.50099,39.49615],[47.84774,39.66285],[47.98977,39.70999],[48.34264,39.42935],[48.37385,39.37584],[48.15984,39.30028],[48.12404,39.25208],[48.15361,39.19419],[48.31239,39.09278],[48.33884,39.03022],[48.28437,38.97186],[48.08627,38.94434],[48.07734,38.91616],[48.01409,38.90333],[48.02581,38.82705],[48.24773,38.71883],[48.3146,38.59958],[48.45084,38.61013],[48.58793,38.45076],[48.62217,38.40198],[48.70001,38.40564],[48.78979,38.45026],[48.81072,38.44853],[48.84969,38.45015],[48.88288,38.43975],[52.39847,39.43556],[48.80971,41.95365],[48.5867,41.84306],[48.55078,41.77917],[48.42301,41.65444],[48.40277,41.60441],[48.2878,41.56221],[48.22064,41.51472],[48.07587,41.49957],[47.87973,41.21798],[47.75831,41.19455],[47.62288,41.22969],[47.54504,41.20275],[47.49004,41.26366],[47.34579,41.27884],[47.10762,41.59044],[47.03757,41.55434],[46.99554,41.59743],[47.00955,41.63583],[46.8134,41.76252],[46.75269,41.8623],[46.58924,41.80547],[46.5332,41.87389],[46.42738,41.91323]],[[45.50279,40.58424],[45.47927,40.65023],[45.51825,40.67382],[45.56071,40.64765],[45.50279,40.58424]]],[[[45.00864,41.03411],[45.03792,41.03938],[45.04517,41.06653],[45.03406,41.07931],[45.00864,41.09407],[44.97169,41.09176],[44.95383,41.07553],[44.96031,41.06345],[44.9903,41.05657],[45.00864,41.03411]]],[[[45.21324,40.9817],[45.23095,40.97828],[45.23487,41.00226],[45.20625,41.01484],[45.18382,41.0066],[45.19312,40.98998],[45.20518,40.99348],[45.21219,40.99001],[45.21324,40.9817]]],[[[45.46992,39.49888],[45.29606,39.57654],[45.30385,39.61373],[45.23535,39.61373],[45.21784,39.58074],[45.17464,39.58614],[45.18554,39.67846],[45.06604,39.79277],[44.92869,39.72157],[44.88354,39.74432],[44.75779,39.7148],[44.80977,39.65768],[44.81043,39.62677],[44.88916,39.59653],[44.96746,39.42998],[45.05932,39.36435],[45.08751,39.35052],[45.16168,39.21952],[45.30489,39.18333],[45.40148,39.09007],[45.40452,39.07224],[45.44811,39.04927],[45.44966,38.99243],[45.6131,38.964],[45.6155,38.94304],[45.65172,38.95199],[45.83883,38.90768],[45.90266,38.87739],[45.94624,38.89072],[46.00228,38.87376],[46.06766,38.87861],[46.14785,38.84206],[46.06973,39.0744],[46.02303,39.09978],[45.99774,39.28931],[45.79225,39.3695],[45.83,39.46487],[45.80804,39.56716],[45.70547,39.60174],[45.46992,39.49888]]]]}},{type:"Feature",properties:{iso1A2:"BA",iso1A3:"BIH",iso1N3:"070",wikidata:"Q225",nameEn:"Bosnia and Herzegovina",groups:["039","150","UN"],callingCodes:["387"]},geometry:{type:"MultiPolygon",coordinates:[[[[17.84826,45.04489],[17.66571,45.13408],[17.59104,45.10816],[17.51469,45.10791],[17.47589,45.12656],[17.45615,45.12523],[17.4498,45.16119],[17.41229,45.13335],[17.33573,45.14521],[17.32092,45.16246],[17.26815,45.18444],[17.25131,45.14957],[17.24325,45.146],[17.18438,45.14764],[17.0415,45.20759],[16.9385,45.22742],[16.92405,45.27607],[16.83804,45.18951],[16.81137,45.18434],[16.78219,45.19002],[16.74845,45.20393],[16.64962,45.20714],[16.60194,45.23042],[16.56559,45.22307],[16.5501,45.2212],[16.52982,45.22713],[16.49155,45.21153],[16.4634,45.14522],[16.40023,45.1147],[16.38309,45.05955],[16.38219,45.05139],[16.3749,45.05206],[16.35863,45.03529],[16.35404,45.00241],[16.29036,44.99732],[16.12153,45.09616],[15.98412,45.23088],[15.83512,45.22459],[15.76371,45.16508],[15.78842,45.11519],[15.74585,45.0638],[15.78568,44.97401],[15.74723,44.96818],[15.76096,44.87045],[15.79472,44.8455],[15.72584,44.82334],[15.8255,44.71501],[15.89348,44.74964],[16.05828,44.61538],[16.00884,44.58605],[16.03012,44.55572],[16.10566,44.52586],[16.16814,44.40679],[16.12969,44.38275],[16.21346,44.35231],[16.18688,44.27012],[16.36864,44.08263],[16.43662,44.07523],[16.43629,44.02826],[16.50528,44.0244],[16.55472,43.95326],[16.70922,43.84887],[16.75316,43.77157],[16.80736,43.76011],[17.00585,43.58037],[17.15828,43.49376],[17.24411,43.49376],[17.29699,43.44542],[17.25579,43.40353],[17.286,43.33065],[17.46986,43.16559],[17.64268,43.08595],[17.70879,42.97223],[17.5392,42.92787],[17.6444,42.88641],[17.68151,42.92725],[17.7948,42.89556],[17.80854,42.9182],[17.88201,42.83668],[18.24318,42.6112],[18.36197,42.61423],[18.43735,42.55921],[18.49778,42.58409],[18.53751,42.57376],[18.55504,42.58409],[18.52232,42.62279],[18.57373,42.64429],[18.54841,42.68328],[18.54603,42.69171],[18.55221,42.69045],[18.56789,42.72074],[18.47324,42.74992],[18.45921,42.81682],[18.47633,42.85829],[18.4935,42.86433],[18.49661,42.89306],[18.49076,42.95553],[18.52232,43.01451],[18.66254,43.03928],[18.64735,43.14766],[18.66605,43.2056],[18.71747,43.2286],[18.6976,43.25243],[18.76538,43.29838],[18.85342,43.32426],[18.84794,43.33735],[18.83912,43.34795],[18.90911,43.36383],[18.95819,43.32899],[18.95001,43.29327],[19.00844,43.24988],[19.04233,43.30008],[19.08206,43.29668],[19.08673,43.31453],[19.04071,43.397],[19.01078,43.43854],[18.96053,43.45042],[18.95469,43.49367],[18.91379,43.50299],[19.01078,43.55806],[19.04934,43.50384],[19.13933,43.5282],[19.15685,43.53943],[19.22807,43.5264],[19.24774,43.53061],[19.2553,43.5938],[19.33426,43.58833],[19.36653,43.60921],[19.41941,43.54056],[19.42696,43.57987],[19.50455,43.58385],[19.5176,43.71403],[19.3986,43.79668],[19.23465,43.98764],[19.24363,44.01502],[19.38439,43.96611],[19.52515,43.95573],[19.56498,43.99922],[19.61836,44.01464],[19.61991,44.05254],[19.57467,44.04716],[19.55999,44.06894],[19.51167,44.08158],[19.47321,44.1193],[19.48386,44.14332],[19.47338,44.15034],[19.43905,44.13088],[19.40927,44.16722],[19.3588,44.18353],[19.34773,44.23244],[19.32464,44.27185],[19.26945,44.26957],[19.23306,44.26097],[19.20508,44.2917],[19.18328,44.28383],[19.16741,44.28648],[19.13332,44.31492],[19.13556,44.338],[19.11547,44.34218],[19.1083,44.3558],[19.11865,44.36712],[19.10298,44.36924],[19.10365,44.37795],[19.10704,44.38249],[19.10749,44.39421],[19.11785,44.40313],[19.14681,44.41463],[19.14837,44.45253],[19.12278,44.50132],[19.13369,44.52521],[19.16699,44.52197],[19.26388,44.65412],[19.32543,44.74058],[19.36722,44.88164],[19.18183,44.92055],[19.01994,44.85493],[18.8704,44.85097],[18.76347,44.90669],[18.76369,44.93707],[18.80661,44.93561],[18.78357,44.97741],[18.65723,45.07544],[18.47939,45.05871],[18.41896,45.11083],[18.32077,45.1021],[18.24387,45.13699],[18.1624,45.07654],[18.03121,45.12632],[18.01594,45.15163],[17.99479,45.14958],[17.97834,45.13831],[17.97336,45.12245],[17.93706,45.08016],[17.87148,45.04645],[17.84826,45.04489]]]]}},{type:"Feature",properties:{iso1A2:"BB",iso1A3:"BRB",iso1N3:"052",wikidata:"Q244",nameEn:"Barbados",groups:["029","003","419","019","UN"],driveSide:"left",callingCodes:["1 246"]},geometry:{type:"MultiPolygon",coordinates:[[[[-58.56442,13.24471],[-59.80731,13.87556],[-59.82929,12.70644],[-58.56442,13.24471]]]]}},{type:"Feature",properties:{iso1A2:"BD",iso1A3:"BGD",iso1N3:"050",wikidata:"Q902",nameEn:"Bangladesh",groups:["034","142","UN"],driveSide:"left",callingCodes:["880"]},geometry:{type:"MultiPolygon",coordinates:[[[[89.15869,26.13708],[89.08899,26.38845],[88.95612,26.4564],[88.92357,26.40711],[88.91321,26.37984],[89.05328,26.2469],[88.85004,26.23211],[88.78961,26.31093],[88.67837,26.26291],[88.69485,26.38353],[88.62144,26.46783],[88.4298,26.54489],[88.41196,26.63837],[88.33093,26.48929],[88.35153,26.45241],[88.36938,26.48683],[88.48749,26.45855],[88.51649,26.35923],[88.35153,26.29123],[88.34757,26.22216],[88.1844,26.14417],[88.16581,26.0238],[88.08804,25.91334],[88.13138,25.78773],[88.242,25.80811],[88.45103,25.66245],[88.4559,25.59227],[88.677,25.46959],[88.81296,25.51546],[88.85278,25.34679],[89.01105,25.30303],[89.00463,25.26583],[88.94067,25.18534],[88.44766,25.20149],[88.46277,25.07468],[88.33917,24.86803],[88.27325,24.88796],[88.21832,24.96642],[88.14004,24.93529],[88.15515,24.85806],[88.00683,24.66477],[88.08786,24.63232],[88.12296,24.51301],[88.50934,24.32474],[88.68801,24.31464],[88.74841,24.1959],[88.6976,24.14703],[88.73743,23.91751],[88.66189,23.87607],[88.58087,23.87105],[88.56507,23.64044],[88.74841,23.47361],[88.79351,23.50535],[88.79254,23.46028],[88.71133,23.2492],[88.99148,23.21134],[88.86377,23.08759],[88.88327,23.03885],[88.87063,22.95235],[88.96713,22.83346],[88.9151,22.75228],[88.94614,22.66941],[88.9367,22.58527],[89.07114,22.15335],[89.08044,21.41871],[92.47409,20.38654],[92.26071,21.05697],[92.17752,21.17445],[92.20087,21.337],[92.37939,21.47764],[92.43158,21.37025],[92.55105,21.3856],[92.60187,21.24615],[92.68152,21.28454],[92.59775,21.6092],[92.62187,21.87037],[92.60949,21.97638],[92.56616,22.13554],[92.60029,22.1522],[92.5181,22.71441],[92.37665,22.9435],[92.38214,23.28705],[92.26541,23.70392],[92.15417,23.73409],[92.04706,23.64229],[91.95093,23.73284],[91.95642,23.47361],[91.84789,23.42235],[91.76417,23.26619],[91.81634,23.08001],[91.7324,23.00043],[91.61571,22.93929],[91.54993,23.01051],[91.46615,23.2328],[91.4035,23.27522],[91.40848,23.07117],[91.36453,23.06612],[91.28293,23.37538],[91.15579,23.6599],[91.25192,23.83463],[91.22308,23.89616],[91.29587,24.0041],[91.35741,23.99072],[91.37414,24.10693],[91.55542,24.08687],[91.63782,24.1132],[91.65292,24.22095],[91.73257,24.14703],[91.76004,24.23848],[91.82596,24.22345],[91.89258,24.14674],[91.96603,24.3799],[92.11662,24.38997],[92.15796,24.54435],[92.25854,24.9191],[92.38626,24.86055],[92.49887,24.88796],[92.39147,25.01471],[92.33957,25.07593],[92.0316,25.1834],[91.63648,25.12846],[91.25517,25.20677],[90.87427,25.15799],[90.65042,25.17788],[90.40034,25.1534],[90.1155,25.22686],[89.90478,25.31038],[89.87629,25.28337],[89.83371,25.29548],[89.84086,25.31854],[89.81208,25.37244],[89.86129,25.61714],[89.84388,25.70042],[89.80585,25.82489],[89.86592,25.93115],[89.77728,26.04254],[89.77865,26.08387],[89.73581,26.15818],[89.70201,26.15138],[89.63968,26.22595],[89.57101,25.9682],[89.53515,26.00382],[89.35953,26.0077],[89.15869,26.13708]]]]}},{type:"Feature",properties:{iso1A2:"BE",iso1A3:"BEL",iso1N3:"056",wikidata:"Q31",nameEn:"Belgium",groups:["EU","155","150","UN"],callingCodes:["32"]},geometry:{type:"MultiPolygon",coordinates:[[[[4.93295,51.44945],[4.93909,51.44632],[4.9524,51.45014],[4.95244,51.45207],[4.93295,51.44945]]],[[[4.91493,51.4353],[4.92652,51.43329],[4.92952,51.42984],[4.93986,51.43064],[4.94265,51.44003],[4.93471,51.43861],[4.93416,51.44185],[4.94025,51.44193],[4.93544,51.44634],[4.92879,51.44161],[4.92815,51.43856],[4.92566,51.44273],[4.92811,51.4437],[4.92287,51.44741],[4.91811,51.44621],[4.92227,51.44252],[4.91935,51.43634],[4.91493,51.4353]]],[[[4.82946,51.4213],[4.82409,51.44736],[4.84139,51.4799],[4.78803,51.50284],[4.77321,51.50529],[4.74578,51.48937],[4.72935,51.48424],[4.65442,51.42352],[4.57489,51.4324],[4.53521,51.4243],[4.52846,51.45002],[4.54675,51.47265],[4.5388,51.48184],[4.47736,51.4778],[4.38122,51.44905],[4.39747,51.43316],[4.38064,51.41965],[4.43777,51.36989],[4.39292,51.35547],[4.34086,51.35738],[4.33265,51.37687],[4.21923,51.37443],[4.24024,51.35371],[4.16721,51.29348],[4.05165,51.24171],[4.01957,51.24504],[3.97889,51.22537],[3.90125,51.20371],[3.78783,51.2151],[3.78999,51.25766],[3.58939,51.30064],[3.51502,51.28697],[3.52698,51.2458],[3.43488,51.24135],[3.41704,51.25933],[3.38289,51.27331],[3.35847,51.31572],[3.38696,51.33436],[3.36263,51.37112],[2.56575,51.85301],[2.18458,51.52087],[2.55904,51.07014],[2.57551,51.00326],[2.63074,50.94746],[2.59093,50.91751],[2.63331,50.81457],[2.71165,50.81295],[2.81056,50.71773],[2.8483,50.72276],[2.86985,50.7033],[2.87937,50.70298],[2.88504,50.70656],[2.90069,50.69263],[2.91036,50.6939],[2.90873,50.702],[2.95019,50.75138],[2.96778,50.75242],[3.00537,50.76588],[3.04314,50.77674],[3.09163,50.77717],[3.10614,50.78303],[3.11206,50.79416],[3.11987,50.79188],[3.1257,50.78603],[3.15017,50.79031],[3.16476,50.76843],[3.18339,50.74981],[3.18811,50.74025],[3.20064,50.73547],[3.19017,50.72569],[3.20845,50.71662],[3.22042,50.71019],[3.24593,50.71389],[3.26063,50.70086],[3.26141,50.69151],[3.2536,50.68977],[3.264,50.67668],[3.23951,50.6585],[3.2729,50.60718],[3.28575,50.52724],[3.37693,50.49538],[3.44629,50.51009],[3.47385,50.53397],[3.51564,50.5256],[3.49509,50.48885],[3.5683,50.50192],[3.58361,50.49049],[3.61014,50.49568],[3.64426,50.46275],[3.66153,50.45165],[3.67494,50.40239],[3.67262,50.38663],[3.65709,50.36873],[3.66976,50.34563],[3.71009,50.30305],[3.70987,50.3191],[3.73911,50.34809],[3.84314,50.35219],[3.90781,50.32814],[3.96771,50.34989],[4.0268,50.35793],[4.0689,50.3254],[4.10237,50.31247],[4.10957,50.30234],[4.11954,50.30425],[4.13665,50.25609],[4.16808,50.25786],[4.15524,50.2833],[4.17347,50.28838],[4.17861,50.27443],[4.20651,50.27333],[4.21945,50.25539],[4.15524,50.21103],[4.16014,50.19239],[4.13561,50.13078],[4.20147,50.13535],[4.23101,50.06945],[4.16294,50.04719],[4.13508,50.01976],[4.14239,49.98034],[4.20532,49.95803],[4.31963,49.97043],[4.35051,49.95315],[4.43488,49.94122],[4.51098,49.94659],[4.5414,49.96911],[4.68695,49.99685],[4.70064,50.09384],[4.75237,50.11314],[4.82438,50.16878],[4.83279,50.15331],[4.88602,50.15182],[4.8382,50.06738],[4.78827,49.95609],[4.88529,49.9236],[4.85134,49.86457],[4.86965,49.82271],[4.85464,49.78995],[4.96714,49.79872],[5.09249,49.76193],[5.14545,49.70287],[5.26232,49.69456],[5.31465,49.66846],[5.33039,49.6555],[5.30214,49.63055],[5.3137,49.61225],[5.33851,49.61599],[5.34837,49.62889],[5.3974,49.61596],[5.43713,49.5707],[5.46734,49.52648],[5.46541,49.49825],[5.55001,49.52729],[5.60909,49.51228],[5.64505,49.55146],[5.75649,49.54321],[5.7577,49.55915],[5.77435,49.56298],[5.79195,49.55228],[5.81838,49.54777],[5.84143,49.5533],[5.84692,49.55663],[5.8424,49.56082],[5.87256,49.57539],[5.86986,49.58756],[5.84971,49.58674],[5.84826,49.5969],[5.8762,49.60898],[5.87609,49.62047],[5.88393,49.62802],[5.88552,49.63507],[5.90599,49.63853],[5.90164,49.6511],[5.9069,49.66377],[5.86175,49.67862],[5.86527,49.69291],[5.88677,49.70951],[5.86503,49.72739],[5.84193,49.72161],[5.82562,49.72395],[5.83149,49.74729],[5.82245,49.75048],[5.78871,49.7962],[5.75409,49.79239],[5.74953,49.81428],[5.74364,49.82058],[5.74844,49.82435],[5.7404,49.83452],[5.74076,49.83823],[5.74975,49.83933],[5.74953,49.84709],[5.75884,49.84811],[5.74567,49.85368],[5.75861,49.85631],[5.75269,49.8711],[5.78415,49.87922],[5.73621,49.89796],[5.77314,49.93646],[5.77291,49.96056],[5.80833,49.96451],[5.81163,49.97142],[5.83467,49.97823],[5.83968,49.9892],[5.82331,49.99662],[5.81866,50.01286],[5.8551,50.02683],[5.86904,50.04614],[5.85474,50.06342],[5.8857,50.07824],[5.89488,50.11476],[5.95929,50.13295],[5.96453,50.17259],[6.02488,50.18283],[6.03093,50.16362],[6.06406,50.15344],[6.08577,50.17246],[6.12028,50.16374],[6.1137,50.13668],[6.1379,50.12964],[6.15298,50.14126],[6.14132,50.14971],[6.14588,50.17106],[6.18739,50.1822],[6.18364,50.20815],[6.16853,50.2234],[6.208,50.25179],[6.28797,50.27458],[6.29949,50.30887],[6.32488,50.32333],[6.35701,50.31139],[6.40641,50.32425],[6.40785,50.33557],[6.3688,50.35898],[6.34406,50.37994],[6.36852,50.40776],[6.37219,50.45397],[6.34005,50.46083],[6.3465,50.48833],[6.30809,50.50058],[6.26637,50.50272],[6.22335,50.49578],[6.20599,50.52089],[6.19193,50.5212],[6.18716,50.52653],[6.19579,50.5313],[6.19735,50.53576],[6.17802,50.54179],[6.17739,50.55875],[6.20281,50.56952],[6.22581,50.5907],[6.24005,50.58732],[6.24888,50.59869],[6.2476,50.60392],[6.26957,50.62444],[6.17852,50.6245],[6.11707,50.72231],[6.04428,50.72861],[6.0406,50.71848],[6.0326,50.72647],[6.03889,50.74618],[6.01976,50.75398],[5.97545,50.75441],[5.95942,50.7622],[5.89132,50.75124],[5.89129,50.75125],[5.88734,50.77092],[5.84888,50.75448],[5.84548,50.76542],[5.80673,50.7558],[5.77513,50.78308],[5.76533,50.78159],[5.74356,50.7691],[5.73904,50.75674],[5.72216,50.76398],[5.69469,50.75529],[5.68091,50.75804],[5.70107,50.7827],[5.68995,50.79641],[5.70118,50.80764],[5.65259,50.82309],[5.64009,50.84742],[5.64504,50.87107],[5.67886,50.88142],[5.69858,50.91046],[5.71626,50.90796],[5.72644,50.91167],[5.72545,50.92312],[5.74644,50.94723],[5.75927,50.95601],[5.74752,50.96202],[5.72875,50.95428],[5.71864,50.96092],[5.76242,50.99703],[5.77688,51.02483],[5.75961,51.03113],[5.77258,51.06196],[5.79835,51.05834],[5.79903,51.09371],[5.82921,51.09328],[5.83226,51.10585],[5.8109,51.10861],[5.80798,51.11661],[5.85508,51.14445],[5.82564,51.16753],[5.77697,51.1522],[5.77735,51.17845],[5.74617,51.18928],[5.70344,51.1829],[5.65528,51.18736],[5.65145,51.19788],[5.5603,51.22249],[5.5569,51.26544],[5.515,51.29462],[5.48476,51.30053],[5.46519,51.2849],[5.4407,51.28169],[5.41672,51.26248],[5.347,51.27502],[5.33886,51.26314],[5.29716,51.26104],[5.26461,51.26693],[5.23814,51.26064],[5.22542,51.26888],[5.24244,51.30495],[5.2002,51.32243],[5.16222,51.31035],[5.13377,51.31592],[5.13105,51.34791],[5.07102,51.39469],[5.10456,51.43163],[5.07891,51.4715],[5.04774,51.47022],[5.03281,51.48679],[5.0106,51.47167],[5.00393,51.44406],[4.92152,51.39487],[4.90016,51.41404],[4.84988,51.41502],[4.78941,51.41102],[4.77229,51.41337],[4.76577,51.43046],[4.78314,51.43319],[4.82946,51.4213]]]]}},{type:"Feature",properties:{iso1A2:"BF",iso1A3:"BFA",iso1N3:"854",wikidata:"Q965",nameEn:"Burkina Faso",groups:["011","202","002","UN"],callingCodes:["226"]},geometry:{type:"MultiPolygon",coordinates:[[[[.23859,15.00135],[.06588,14.96961],[-.24673,15.07805],[-.72004,15.08655],[-1.05875,14.7921],[-1.32166,14.72774],[-1.68083,14.50023],[-1.97945,14.47709],[-1.9992,14.19011],[-2.10223,14.14878],[-2.47587,14.29671],[-2.66175,14.14713],[-2.84667,14.05532],[-2.90831,13.81174],[-2.88189,13.64921],[-3.26407,13.70699],[-3.28396,13.5422],[-3.23599,13.29035],[-3.43507,13.27272],[-3.4313,13.1588],[-3.54454,13.1781],[-3.7911,13.36665],[-3.96282,13.38164],[-3.90558,13.44375],[-3.96501,13.49778],[-4.34477,13.12927],[-4.21819,12.95722],[-4.238,12.71467],[-4.47356,12.71252],[-4.41412,12.31922],[-4.57703,12.19875],[-4.54841,12.1385],[-4.62546,12.13204],[-4.62987,12.06531],[-4.70692,12.06746],[-4.72893,12.01579],[-5.07897,11.97918],[-5.26389,11.84778],[-5.40258,11.8327],[-5.26389,11.75728],[-5.29251,11.61715],[-5.22867,11.60421],[-5.20665,11.43811],[-5.25509,11.36905],[-5.25949,11.24816],[-5.32553,11.21578],[-5.32994,11.13371],[-5.49284,11.07538],[-5.41579,10.84628],[-5.47083,10.75329],[-5.46643,10.56074],[-5.51058,10.43177],[-5.39602,10.2929],[-5.12465,10.29788],[-4.96453,9.99923],[-4.96621,9.89132],[-4.6426,9.70696],[-4.31392,9.60062],[-4.25999,9.76012],[-3.69703,9.94279],[-3.31779,9.91125],[-3.27228,9.84981],[-3.19306,9.93781],[-3.16609,9.85147],[-3.00765,9.74019],[-2.93012,9.57403],[-2.76494,9.40778],[-2.68802,9.49343],[-2.76534,9.56589],[-2.74174,9.83172],[-2.83108,10.40252],[-2.94232,10.64281],[-2.83373,11.0067],[-.67143,10.99811],[-.61937,10.91305],[-.44298,11.04292],[-.42391,11.11661],[-.38219,11.12596],[-.35955,11.07801],[-.28566,11.12713],[-.27374,11.17157],[-.13493,11.14075],[.50388,11.01011],[.48852,10.98561],[.50521,10.98035],[.4958,10.93269],[.66104,10.99964],[.91245,10.99597],[.9813,11.08876],[1.03409,11.04719],[1.42823,11.46822],[2.00988,11.42227],[2.29983,11.68254],[2.39723,11.89473],[2.05785,12.35539],[2.26349,12.41915],[.99167,13.10727],[.99253,13.37515],[1.18873,13.31771],[1.21217,13.37853],[1.24516,13.33968],[1.28509,13.35488],[1.24429,13.39373],[1.20088,13.38951],[1.02813,13.46635],[.99514,13.5668],[.77637,13.64442],[.77377,13.6866],[.61924,13.68491],[.38051,14.05575],[.16936,14.51654],[.23859,15.00135]]]]}},{type:"Feature",properties:{iso1A2:"BG",iso1A3:"BGR",iso1N3:"100",wikidata:"Q219",nameEn:"Bulgaria",groups:["EU","151","150","UN"],callingCodes:["359"]},geometry:{type:"MultiPolygon",coordinates:[[[[23.05288,43.79494],[22.85314,43.84452],[22.83753,43.88055],[22.87873,43.9844],[23.01674,44.01946],[23.04988,44.07694],[22.67173,44.21564],[22.61711,44.16938],[22.61688,44.06534],[22.41449,44.00514],[22.35558,43.81281],[22.41043,43.69566],[22.47582,43.6558],[22.53397,43.47225],[22.82036,43.33665],[22.89727,43.22417],[23.00806,43.19279],[22.98104,43.11199],[22.89521,43.03625],[22.78397,42.98253],[22.74826,42.88701],[22.54302,42.87774],[22.43309,42.82057],[22.4997,42.74144],[22.43983,42.56851],[22.55669,42.50144],[22.51961,42.3991],[22.47498,42.3915],[22.45919,42.33822],[22.34773,42.31725],[22.38136,42.30339],[22.47251,42.20393],[22.50289,42.19527],[22.51224,42.15457],[22.67701,42.06614],[22.86749,42.02275],[22.90254,41.87587],[22.96682,41.77137],[23.01239,41.76527],[23.03342,41.71034],[22.95513,41.63265],[22.96331,41.35782],[22.93334,41.34104],[23.1833,41.31755],[23.21953,41.33773],[23.22771,41.37106],[23.31301,41.40525],[23.33639,41.36317],[23.40416,41.39999],[23.52453,41.40262],[23.63203,41.37632],[23.67644,41.41139],[23.76525,41.40175],[23.80148,41.43943],[23.89613,41.45257],[23.91483,41.47971],[23.96975,41.44118],[24.06908,41.46132],[24.06323,41.53222],[24.10063,41.54796],[24.18126,41.51735],[24.27124,41.57682],[24.30513,41.51297],[24.52599,41.56808],[24.61129,41.42278],[24.71529,41.41928],[24.8041,41.34913],[24.82514,41.4035],[24.86136,41.39298],[24.90928,41.40876],[24.942,41.38685],[25.11611,41.34212],[25.28322,41.23411],[25.48187,41.28506],[25.52394,41.2798],[25.55082,41.31667],[25.61042,41.30614],[25.66183,41.31316],[25.70507,41.29209],[25.8266,41.34563],[25.87919,41.30526],[26.12926,41.35878],[26.16548,41.42278],[26.20288,41.43943],[26.14796,41.47533],[26.176,41.50072],[26.17951,41.55409],[26.14328,41.55496],[26.15146,41.60828],[26.07083,41.64584],[26.06148,41.70345],[26.16841,41.74858],[26.21325,41.73223],[26.22888,41.74139],[26.2654,41.71544],[26.30255,41.70925],[26.35957,41.71149],[26.32952,41.73637],[26.33589,41.76802],[26.36952,41.82265],[26.53968,41.82653],[26.57961,41.90024],[26.56051,41.92995],[26.62996,41.97644],[26.79143,41.97386],[26.95638,42.00741],[27.03277,42.0809],[27.08486,42.08735],[27.19251,42.06028],[27.22376,42.10152],[27.27411,42.10409],[27.45478,41.96591],[27.52379,41.93756],[27.55191,41.90928],[27.69949,41.97515],[27.81235,41.94803],[27.83492,41.99709],[27.91479,41.97902],[28.02971,41.98066],[28.32297,41.98371],[29.24336,43.70874],[28.23293,43.76],[27.99558,43.84193],[27.92008,44.00761],[27.73468,43.95326],[27.64542,44.04958],[27.60834,44.01206],[27.39757,44.0141],[27.26845,44.12602],[26.95141,44.13555],[26.62712,44.05698],[26.38764,44.04356],[26.10115,43.96908],[26.05584,43.90925],[25.94911,43.85745],[25.72792,43.69263],[25.39528,43.61866],[25.17144,43.70261],[25.10718,43.6831],[24.96682,43.72693],[24.73542,43.68523],[24.62281,43.74082],[24.50264,43.76314],[24.35364,43.70211],[24.18149,43.68218],[23.73978,43.80627],[23.61687,43.79289],[23.4507,43.84936],[23.26772,43.84843],[23.05288,43.79494]]]]}},{type:"Feature",properties:{iso1A2:"BH",iso1A3:"BHR",iso1N3:"048",wikidata:"Q398",nameEn:"Bahrain",groups:["145","142","UN"],callingCodes:["973"]},geometry:{type:"MultiPolygon",coordinates:[[[[50.93865,26.30758],[50.71771,26.73086],[50.38162,26.53976],[50.26923,26.08243],[50.302,25.87592],[50.57069,25.57887],[50.80824,25.54641],[50.7801,25.595],[50.86149,25.6965],[50.81266,25.88946],[50.93865,26.30758]]]]}},{type:"Feature",properties:{iso1A2:"BI",iso1A3:"BDI",iso1N3:"108",wikidata:"Q967",nameEn:"Burundi",groups:["014","202","002","UN"],callingCodes:["257"]},geometry:{type:"MultiPolygon",coordinates:[[[[30.54501,-2.41404],[30.42933,-2.31064],[30.14034,-2.43626],[29.95911,-2.33348],[29.88237,-2.75105],[29.36805,-2.82933],[29.32234,-2.6483],[29.0562,-2.58632],[29.04081,-2.7416],[29.00167,-2.78523],[29.00404,-2.81978],[29.0505,-2.81774],[29.09119,-2.87871],[29.09797,-2.91935],[29.16037,-2.95457],[29.17258,-2.99385],[29.25633,-3.05471],[29.21463,-3.3514],[29.23708,-3.75856],[29.43673,-4.44845],[29.63827,-4.44681],[29.75109,-4.45836],[29.77289,-4.41733],[29.82885,-4.36153],[29.88172,-4.35743],[30.03323,-4.26631],[30.22042,-4.01738],[30.45915,-3.56532],[30.84165,-3.25152],[30.83823,-2.97837],[30.6675,-2.98987],[30.57926,-2.89791],[30.4987,-2.9573],[30.40662,-2.86151],[30.52747,-2.65841],[30.41789,-2.66266],[30.54501,-2.41404]]]]}},{type:"Feature",properties:{iso1A2:"BJ",iso1A3:"BEN",iso1N3:"204",wikidata:"Q962",nameEn:"Benin",aliases:["DY"],groups:["011","202","002","UN"],callingCodes:["229"]},geometry:{type:"MultiPolygon",coordinates:[[[[3.59375,11.70269],[3.48187,11.86092],[3.31613,11.88495],[3.25352,12.01467],[2.83978,12.40585],[2.6593,12.30631],[2.37783,12.24804],[2.39657,12.10952],[2.45824,11.98672],[2.39723,11.89473],[2.29983,11.68254],[2.00988,11.42227],[1.42823,11.46822],[1.03409,11.04719],[.9813,11.08876],[.91245,10.99597],[.8804,10.803],[.80358,10.71459],[.77666,10.37665],[1.35507,9.99525],[1.36624,9.5951],[1.33675,9.54765],[1.41746,9.3226],[1.5649,9.16941],[1.61838,9.0527],[1.64249,6.99562],[1.55877,6.99737],[1.61812,6.74843],[1.58105,6.68619],[1.76906,6.43189],[1.79826,6.28221],[1.62913,6.24075],[1.67336,6.02702],[2.74181,6.13349],[2.70566,6.38038],[2.70464,6.50831],[2.74334,6.57291],[2.7325,6.64057],[2.78204,6.70514],[2.78823,6.76356],[2.73405,6.78508],[2.74024,6.92802],[2.71702,6.95722],[2.76965,7.13543],[2.74489,7.42565],[2.79442,7.43486],[2.78668,7.5116],[2.73405,7.5423],[2.73095,7.7755],[2.67523,7.87825],[2.77907,9.06924],[3.08017,9.10006],[3.14147,9.28375],[3.13928,9.47167],[3.25093,9.61632],[3.34726,9.70696],[3.32099,9.78032],[3.35383,9.83641],[3.54429,9.87739],[3.66908,10.18136],[3.57275,10.27185],[3.6844,10.46351],[3.78292,10.40538],[3.84243,10.59316],[3.71505,11.13015],[3.49175,11.29765],[3.59375,11.70269]]]]}},{type:"Feature",properties:{iso1A2:"BL",iso1A3:"BLM",iso1N3:"652",wikidata:"Q25362",nameEn:"Saint-Barth\xE9lemy",country:"FR",groups:["EU","Q1451600","029","003","419","019","UN"],callingCodes:["590"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.62718,18.26185],[-63.1055,17.86651],[-62.34423,17.49165],[-62.62718,18.26185]]]]}},{type:"Feature",properties:{iso1A2:"BM",iso1A3:"BMU",iso1N3:"060",wikidata:"Q23635",nameEn:"Bermuda",country:"GB",groups:["BOTS","021","003","019","UN"],driveSide:"left",callingCodes:["1 441"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.20987,32.6953],[-65.31453,32.68437],[-65.63955,31.43417],[-63.20987,32.6953]]]]}},{type:"Feature",properties:{iso1A2:"BN",iso1A3:"BRN",iso1N3:"096",wikidata:"Q921",nameEn:"Brunei",groups:["Q36117","035","142","UN"],driveSide:"left",callingCodes:["673"]},geometry:{type:"MultiPolygon",coordinates:[[[[115.16236,5.01011],[115.02521,5.35005],[114.10166,4.76112],[114.07448,4.58441],[114.15813,4.57],[114.26876,4.49878],[114.32176,4.34942],[114.32176,4.2552],[114.4416,4.27588],[114.49922,4.13108],[114.64211,4.00694],[114.78539,4.12205],[114.88039,4.4257],[114.83189,4.42387],[114.77303,4.72871],[114.8266,4.75062],[114.88841,4.81905],[114.96982,4.81146],[114.99417,4.88201],[115.05038,4.90275],[115.02955,4.82087],[115.02278,4.74137],[115.04064,4.63706],[115.07737,4.53418],[115.09978,4.39123],[115.31275,4.30806],[115.36346,4.33563],[115.2851,4.42295],[115.27819,4.63661],[115.20737,4.8256],[115.15092,4.87604],[115.16236,5.01011]]]]}},{type:"Feature",properties:{iso1A2:"BO",iso1A3:"BOL",iso1N3:"068",wikidata:"Q750",nameEn:"Bolivia",groups:["005","419","019","UN"],callingCodes:["591"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.90248,-12.52544],[-64.22539,-12.45267],[-64.30708,-12.46398],[-64.99778,-11.98604],[-65.30027,-11.48749],[-65.28141,-10.86289],[-65.35402,-10.78685],[-65.37923,-10.35141],[-65.29019,-9.86253],[-65.40615,-9.63894],[-65.56244,-9.84266],[-65.68343,-9.75323],[-67.17784,-10.34016],[-68.71533,-11.14749],[-68.7651,-11.0496],[-68.75179,-11.03688],[-68.75265,-11.02383],[-68.74802,-11.00891],[-69.42792,-10.93451],[-69.47839,-10.95254],[-69.57156,-10.94555],[-68.98115,-11.8979],[-68.65044,-12.50689],[-68.85615,-12.87769],[-68.8864,-13.40792],[-69.05265,-13.68546],[-68.88135,-14.18639],[-69.36254,-14.94634],[-69.14856,-15.23478],[-69.40336,-15.61358],[-69.20291,-16.16668],[-69.09986,-16.22693],[-68.96238,-16.194],[-68.79464,-16.33272],[-68.98358,-16.42165],[-69.04027,-16.57214],[-69.00853,-16.66769],[-69.16896,-16.72233],[-69.62883,-17.28142],[-69.46863,-17.37466],[-69.46897,-17.4988],[-69.46623,-17.60518],[-69.34126,-17.72753],[-69.28671,-17.94844],[-69.07496,-18.03715],[-69.14807,-18.16893],[-69.07432,-18.28259],[-68.94987,-18.93302],[-68.87082,-19.06003],[-68.80602,-19.08355],[-68.61989,-19.27584],[-68.41218,-19.40499],[-68.66761,-19.72118],[-68.54611,-19.84651],[-68.57132,-20.03134],[-68.74273,-20.08817],[-68.7276,-20.46178],[-68.44023,-20.62701],[-68.55383,-20.7355],[-68.53957,-20.91542],[-68.40403,-20.94562],[-68.18816,-21.28614],[-67.85114,-22.87076],[-67.54284,-22.89771],[-67.18382,-22.81525],[-66.7298,-22.23644],[-66.29714,-22.08741],[-66.24077,-21.77837],[-66.03836,-21.84829],[-66.04832,-21.9187],[-65.9261,-21.93335],[-65.7467,-22.10105],[-65.61166,-22.09504],[-65.58694,-22.09794],[-65.57743,-22.07675],[-65.47435,-22.08908],[-64.99524,-22.08255],[-64.90014,-22.12136],[-64.67174,-22.18957],[-64.58888,-22.25035],[-64.4176,-22.67692],[-64.35108,-22.73282],[-64.31489,-22.88824],[-64.22918,-22.55807],[-63.93287,-21.99934],[-63.70963,-21.99934],[-63.68113,-22.0544],[-63.66482,-21.99918],[-62.81124,-21.9987],[-62.8078,-22.12534],[-62.64455,-22.25091],[-62.2757,-21.06657],[-62.26883,-20.55311],[-61.93912,-20.10053],[-61.73723,-19.63958],[-60.00638,-19.2981],[-59.06965,-19.29148],[-58.23216,-19.80058],[-58.16225,-20.16193],[-57.8496,-19.98346],[-58.14215,-19.76276],[-57.78463,-19.03259],[-57.71113,-19.03161],[-57.69134,-19.00544],[-57.71995,-18.97546],[-57.71995,-18.89573],[-57.76764,-18.90087],[-57.56807,-18.25655],[-57.48237,-18.24219],[-57.69877,-17.8431],[-57.73949,-17.56095],[-57.90082,-17.44555],[-57.99661,-17.5273],[-58.32935,-17.28195],[-58.5058,-16.80958],[-58.30918,-16.3699],[-58.32431,-16.25861],[-58.41506,-16.32636],[-60.16069,-16.26479],[-60.23797,-15.50267],[-60.58224,-15.09887],[-60.23968,-15.09515],[-60.27887,-14.63021],[-60.46037,-14.22496],[-60.48053,-13.77981],[-61.05527,-13.50054],[-61.81151,-13.49564],[-63.76259,-12.42952],[-63.90248,-12.52544]]]]}},{type:"Feature",properties:{iso1A2:"BQ",iso1A3:"BES",iso1N3:"535",wikidata:"Q27561",nameEn:"Caribbean Netherlands",country:"NL"},geometry:null},{type:"Feature",properties:{iso1A2:"BR",iso1A3:"BRA",iso1N3:"076",wikidata:"Q155",nameEn:"Brazil",groups:["005","419","019","UN"],callingCodes:["55"]},geometry:{type:"MultiPolygon",coordinates:[[[[-59.69361,4.34069],[-59.78878,4.45637],[-60.15953,4.53456],[-60.04189,4.69801],[-59.98129,5.07097],[-60.20944,5.28754],[-60.32352,5.21299],[-60.73204,5.20931],[-60.5802,4.94312],[-60.86539,4.70512],[-60.98303,4.54167],[-61.15703,4.49839],[-61.31457,4.54167],[-61.29675,4.44216],[-61.48569,4.43149],[-61.54629,4.2822],[-62.13094,4.08309],[-62.44822,4.18621],[-62.57656,4.04754],[-62.74411,4.03331],[-62.7655,3.73099],[-62.98296,3.59935],[-63.21111,3.96219],[-63.4464,3.9693],[-63.42233,3.89995],[-63.50611,3.83592],[-63.67099,4.01731],[-63.70218,3.91417],[-63.86082,3.94796],[-63.99183,3.90172],[-64.14512,4.12932],[-64.57648,4.12576],[-64.72977,4.28931],[-64.84028,4.24665],[-64.48379,3.7879],[-64.02908,2.79797],[-64.0257,2.48156],[-63.39114,2.4317],[-63.39827,2.16098],[-64.06135,1.94722],[-64.08274,1.64792],[-64.34654,1.35569],[-64.38932,1.5125],[-65.11657,1.12046],[-65.57288,.62856],[-65.50158,.92086],[-65.6727,1.01353],[-66.28507,.74585],[-66.85795,1.22998],[-67.08222,1.17441],[-67.15784,1.80439],[-67.299,1.87494],[-67.40488,2.22258],[-67.9292,1.82455],[-68.18632,2.00091],[-68.26699,1.83463],[-68.18128,1.72881],[-69.38621,1.70865],[-69.53746,1.76408],[-69.83491,1.69353],[-69.82987,1.07864],[-69.26017,1.06856],[-69.14422,.84172],[-69.20976,.57958],[-69.47696,.71065],[-70.04162,.55437],[-70.03658,-.19681],[-69.603,-.51947],[-69.59796,-.75136],[-69.4215,-1.01853],[-69.43395,-1.42219],[-69.94708,-4.2431],[-70.00888,-4.37833],[-70.11305,-4.27281],[-70.19582,-4.3607],[-70.33236,-4.15214],[-70.77601,-4.15717],[-70.96814,-4.36915],[-71.87003,-4.51661],[-72.64391,-5.0391],[-72.83973,-5.14765],[-73.24579,-6.05764],[-73.12983,-6.43852],[-73.73986,-6.87919],[-73.77011,-7.28944],[-73.96938,-7.58465],[-73.65485,-7.77897],[-73.76576,-7.89884],[-72.92886,-9.04074],[-73.21498,-9.40904],[-72.72216,-9.41397],[-72.31883,-9.5184],[-72.14742,-9.98049],[-71.23394,-9.9668],[-70.53373,-9.42628],[-70.58453,-9.58303],[-70.55429,-9.76692],[-70.62487,-9.80666],[-70.64134,-11.0108],[-70.51395,-10.92249],[-70.38791,-11.07096],[-69.90896,-10.92744],[-69.57835,-10.94051],[-69.57156,-10.94555],[-69.47839,-10.95254],[-69.42792,-10.93451],[-68.74802,-11.00891],[-68.75265,-11.02383],[-68.75179,-11.03688],[-68.7651,-11.0496],[-68.71533,-11.14749],[-67.17784,-10.34016],[-65.68343,-9.75323],[-65.56244,-9.84266],[-65.40615,-9.63894],[-65.29019,-9.86253],[-65.37923,-10.35141],[-65.35402,-10.78685],[-65.28141,-10.86289],[-65.30027,-11.48749],[-64.99778,-11.98604],[-64.30708,-12.46398],[-64.22539,-12.45267],[-63.90248,-12.52544],[-63.76259,-12.42952],[-61.81151,-13.49564],[-61.05527,-13.50054],[-60.48053,-13.77981],[-60.46037,-14.22496],[-60.27887,-14.63021],[-60.23968,-15.09515],[-60.58224,-15.09887],[-60.23797,-15.50267],[-60.16069,-16.26479],[-58.41506,-16.32636],[-58.32431,-16.25861],[-58.30918,-16.3699],[-58.5058,-16.80958],[-58.32935,-17.28195],[-57.99661,-17.5273],[-57.90082,-17.44555],[-57.73949,-17.56095],[-57.69877,-17.8431],[-57.48237,-18.24219],[-57.56807,-18.25655],[-57.76764,-18.90087],[-57.71995,-18.89573],[-57.71995,-18.97546],[-57.69134,-19.00544],[-57.71113,-19.03161],[-57.78463,-19.03259],[-58.14215,-19.76276],[-57.8496,-19.98346],[-58.16225,-20.16193],[-57.84536,-20.93155],[-57.93492,-21.65505],[-57.88239,-21.6868],[-57.94642,-21.73799],[-57.98625,-22.09157],[-56.6508,-22.28387],[-56.5212,-22.11556],[-56.45893,-22.08072],[-56.23206,-22.25347],[-55.8331,-22.29008],[-55.74941,-22.46436],[-55.741,-22.52018],[-55.72366,-22.5519],[-55.6986,-22.56268],[-55.68742,-22.58407],[-55.62493,-22.62765],[-55.63849,-22.95122],[-55.5446,-23.22811],[-55.52288,-23.2595],[-55.5555,-23.28237],[-55.43585,-23.87157],[-55.44117,-23.9185],[-55.41784,-23.9657],[-55.12292,-23.99669],[-55.0518,-23.98666],[-55.02691,-23.97317],[-54.6238,-23.83078],[-54.32807,-24.01865],[-54.28207,-24.07305],[-54.4423,-25.13381],[-54.62033,-25.46026],[-54.60196,-25.48397],[-54.59509,-25.53696],[-54.59398,-25.59224],[-54.5502,-25.58915],[-54.52926,-25.62846],[-53.90831,-25.55513],[-53.83691,-25.94849],[-53.73511,-26.04211],[-53.73086,-26.05842],[-53.7264,-26.0664],[-53.73391,-26.07006],[-53.73968,-26.10012],[-53.65018,-26.19501],[-53.65237,-26.23289],[-53.63739,-26.2496],[-53.63881,-26.25075],[-53.64632,-26.24798],[-53.64186,-26.25976],[-53.64505,-26.28089],[-53.68269,-26.33359],[-53.73372,-26.6131],[-53.80144,-27.09844],[-54.15978,-27.2889],[-54.19062,-27.27639],[-54.19268,-27.30751],[-54.41888,-27.40882],[-54.50416,-27.48232],[-54.67657,-27.57214],[-54.90159,-27.63132],[-54.90805,-27.73149],[-55.1349,-27.89759],[-55.16872,-27.86224],[-55.33303,-27.94661],[-55.6262,-28.17124],[-55.65418,-28.18304],[-56.01729,-28.51223],[-56.00458,-28.60421],[-56.05265,-28.62651],[-56.54171,-29.11447],[-56.57295,-29.11357],[-56.62789,-29.18073],[-56.81251,-29.48154],[-57.09386,-29.74211],[-57.65132,-30.19229],[-57.22502,-30.26121],[-56.90236,-30.02578],[-56.49267,-30.39471],[-56.4795,-30.3899],[-56.4619,-30.38457],[-55.87388,-31.05053],[-55.58866,-30.84117],[-55.5634,-30.8686],[-55.55373,-30.8732],[-55.55218,-30.88193],[-55.54572,-30.89051],[-55.53431,-30.89714],[-55.53276,-30.90218],[-55.52712,-30.89997],[-55.51862,-30.89828],[-55.50841,-30.9027],[-55.50821,-30.91349],[-54.17384,-31.86168],[-53.76024,-32.0751],[-53.39572,-32.58596],[-53.37671,-32.57005],[-53.1111,-32.71147],[-53.53459,-33.16843],[-53.52794,-33.68908],[-53.44031,-33.69344],[-53.39593,-33.75169],[-53.37138,-33.74313],[-52.83257,-34.01481],[-28.34015,-20.99094],[-28.99601,1.86593],[-51.35485,4.8383],[-51.63798,4.51394],[-51.61983,4.14596],[-51.79599,3.89336],[-51.82312,3.85825],[-51.85573,3.83427],[-52.31787,3.17896],[-52.6906,2.37298],[-52.96539,2.1881],[-53.78743,2.34412],[-54.16286,2.10779],[-54.6084,2.32856],[-55.01919,2.564],[-55.71493,2.40342],[-55.96292,2.53188],[-56.13054,2.27723],[-55.92159,2.05236],[-55.89863,1.89861],[-55.99278,1.83137],[-56.47045,1.95135],[-56.7659,1.89509],[-57.07092,1.95304],[-57.09109,2.01854],[-57.23981,1.95808],[-57.35073,1.98327],[-57.55743,1.69605],[-57.77281,1.73344],[-57.97336,1.64566],[-58.01873,1.51966],[-58.33887,1.58014],[-58.4858,1.48399],[-58.53571,1.29154],[-58.84229,1.17749],[-58.92072,1.31293],[-59.25583,1.40559],[-59.74066,1.87596],[-59.7264,2.27497],[-59.91177,2.36759],[-59.99733,2.92312],[-59.79769,3.37162],[-59.86899,3.57089],[-59.51963,3.91951],[-59.73353,4.20399],[-59.69361,4.34069]]]]}},{type:"Feature",properties:{iso1A2:"BS",iso1A3:"BHS",iso1N3:"044",wikidata:"Q778",nameEn:"The Bahamas",groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 242"]},geometry:{type:"MultiPolygon",coordinates:[[[[-72.98446,20.4801],[-71.70065,25.7637],[-78.91214,27.76553],[-80.65727,23.71953],[-72.98446,20.4801]]]]}},{type:"Feature",properties:{iso1A2:"BT",iso1A3:"BTN",iso1N3:"064",wikidata:"Q917",nameEn:"Bhutan",groups:["034","142","UN"],driveSide:"left",callingCodes:["975"]},geometry:{type:"MultiPolygon",coordinates:[[[[91.6469,27.76358],[91.5629,27.84823],[91.48973,27.93903],[91.46327,28.0064],[91.25779,28.07509],[91.20019,27.98715],[90.69894,28.07784],[90.58842,28.02838],[90.13387,28.19178],[89.79762,28.23979],[89.59525,28.16433],[89.12825,27.62502],[89.0582,27.60985],[88.97213,27.51671],[88.95355,27.4106],[89.00216,27.32532],[88.96947,27.30319],[88.93678,27.33777],[88.91901,27.32483],[88.74219,27.144],[88.86984,27.10937],[88.8714,26.97488],[88.92301,26.99286],[88.95807,26.92668],[89.09554,26.89089],[89.12825,26.81661],[89.1926,26.81329],[89.37913,26.86224],[89.38319,26.85963],[89.3901,26.84225],[89.42349,26.83727],[89.63369,26.74402],[89.86124,26.73307],[90.04535,26.72422],[90.30402,26.85098],[90.39271,26.90704],[90.48504,26.8594],[90.67715,26.77215],[91.50067,26.79223],[91.83181,26.87318],[92.05523,26.8692],[92.11863,26.893],[92.03457,27.07334],[92.04702,27.26861],[92.12019,27.27829],[92.01132,27.47352],[91.65007,27.48287],[91.55819,27.6144],[91.6469,27.76358]]]]}},{type:"Feature",properties:{iso1A2:"BV",iso1A3:"BVT",iso1N3:"074",wikidata:"Q23408",nameEn:"Bouvet Island",country:"NO",groups:["005","419","019","UN"]},geometry:{type:"MultiPolygon",coordinates:[[[[4.54042,-54.0949],[2.28941,-54.13089],[3.35353,-55.17558],[4.54042,-54.0949]]]]}},{type:"Feature",properties:{iso1A2:"BW",iso1A3:"BWA",iso1N3:"072",wikidata:"Q963",nameEn:"Botswana",groups:["018","202","002","UN"],driveSide:"left",callingCodes:["267"]},geometry:{type:"MultiPolygon",coordinates:[[[[25.26433,-17.79571],[25.16882,-17.78253],[25.05895,-17.84452],[24.95586,-17.79674],[24.73364,-17.89338],[24.71887,-17.9218],[24.6303,-17.9863],[24.57485,-18.07151],[24.40577,-17.95726],[24.19416,-18.01919],[23.61088,-18.4881],[23.29618,-17.99855],[23.0996,-18.00075],[21.45556,-18.31795],[20.99904,-18.31743],[20.99751,-22.00026],[19.99912,-21.99991],[19.99817,-24.76768],[20.02809,-24.78725],[20.03678,-24.81004],[20.29826,-24.94869],[20.64795,-25.47827],[20.86081,-26.14892],[20.61754,-26.4692],[20.63275,-26.78181],[20.68596,-26.9039],[20.87031,-26.80047],[21.13353,-26.86661],[21.37869,-26.82083],[21.69322,-26.86152],[21.7854,-26.79199],[21.77114,-26.69015],[21.83291,-26.65959],[21.90703,-26.66808],[22.06192,-26.61882],[22.21206,-26.3773],[22.41921,-26.23078],[22.56365,-26.19668],[22.70808,-25.99186],[22.86012,-25.50572],[23.03497,-25.29971],[23.47588,-25.29971],[23.9244,-25.64286],[24.18287,-25.62916],[24.36531,-25.773],[24.44703,-25.73021],[24.67319,-25.81749],[24.8946,-25.80723],[25.01718,-25.72507],[25.12266,-25.75931],[25.33076,-25.76616],[25.58543,-25.6343],[25.6643,-25.4491],[25.69661,-25.29284],[25.72702,-25.25503],[25.88571,-24.87802],[25.84295,-24.78661],[25.8515,-24.75727],[26.39409,-24.63468],[26.46346,-24.60358],[26.51667,-24.47219],[26.84165,-24.24885],[26.99749,-23.65486],[27.33768,-23.40917],[27.52393,-23.37952],[27.6066,-23.21894],[27.74154,-23.2137],[27.93539,-23.04941],[27.93729,-22.96194],[28.04752,-22.90243],[28.04562,-22.8394],[28.34874,-22.5694],[28.63287,-22.55887],[28.91889,-22.44299],[29.0151,-22.22907],[29.10881,-22.21202],[29.15268,-22.21399],[29.18974,-22.18599],[29.21955,-22.17771],[29.37703,-22.19581],[29.3533,-22.18363],[29.24648,-22.05967],[29.1974,-22.07472],[29.14501,-22.07275],[29.08495,-22.04867],[29.04108,-22.00563],[29.02191,-21.95665],[29.02191,-21.90647],[29.04023,-21.85864],[29.07763,-21.81877],[28.58114,-21.63455],[28.49942,-21.66634],[28.29416,-21.59037],[28.01669,-21.57624],[27.91407,-21.31621],[27.69171,-21.08409],[27.72972,-20.51735],[27.69361,-20.48531],[27.28865,-20.49873],[27.29831,-20.28935],[27.21278,-20.08244],[26.72246,-19.92707],[26.17227,-19.53709],[25.96226,-19.08152],[25.99837,-19.02943],[25.94326,-18.90362],[25.82353,-18.82808],[25.79217,-18.6355],[25.68859,-18.56165],[25.53465,-18.39041],[25.39972,-18.12691],[25.31799,-18.07091],[25.23909,-17.90832],[25.26433,-17.79571]]]]}},{type:"Feature",properties:{iso1A2:"BY",iso1A3:"BLR",iso1N3:"112",wikidata:"Q184",nameEn:"Belarus",groups:["151","150","UN"],callingCodes:["375"]},geometry:{type:"MultiPolygon",coordinates:[[[[28.15217,56.16964],[27.97865,56.11849],[27.63065,55.89687],[27.61683,55.78558],[27.3541,55.8089],[27.27804,55.78299],[27.1559,55.85032],[26.97153,55.8102],[26.87448,55.7172],[26.76872,55.67658],[26.71802,55.70645],[26.64888,55.70515],[26.63231,55.67968],[26.63167,55.57887],[26.55094,55.5093],[26.5522,55.40277],[26.44937,55.34832],[26.5709,55.32572],[26.6714,55.33902],[26.80929,55.31642],[26.83266,55.30444],[26.835,55.28182],[26.73017,55.24226],[26.72983,55.21788],[26.68075,55.19787],[26.69243,55.16718],[26.54753,55.14181],[26.51481,55.16051],[26.46249,55.12814],[26.35121,55.1525],[26.30628,55.12536],[26.23202,55.10439],[26.26941,55.08032],[26.20397,54.99729],[26.13386,54.98924],[26.05907,54.94631],[25.99129,54.95705],[25.89462,54.93438],[25.74122,54.80108],[25.75977,54.57252],[25.68045,54.5321],[25.64813,54.48704],[25.62203,54.4656],[25.63371,54.42075],[25.5376,54.33158],[25.55425,54.31591],[25.68513,54.31727],[25.78553,54.23327],[25.78563,54.15747],[25.71084,54.16704],[25.64875,54.1259],[25.54724,54.14925],[25.51452,54.17799],[25.56823,54.25212],[25.509,54.30267],[25.35559,54.26544],[25.22705,54.26271],[25.19199,54.219],[25.0728,54.13419],[24.991,54.14241],[24.96894,54.17589],[24.77131,54.11091],[24.85311,54.02862],[24.74279,53.96663],[24.69185,53.96543],[24.69652,54.01901],[24.62275,54.00217],[24.44411,53.90076],[24.34128,53.90076],[24.19638,53.96405],[23.98837,53.92554],[23.95098,53.9613],[23.81309,53.94205],[23.80543,53.89558],[23.71726,53.93379],[23.61677,53.92691],[23.51284,53.95052],[23.62004,53.60942],[23.81995,53.24131],[23.85657,53.22923],[23.91393,53.16469],[23.87548,53.0831],[23.92184,53.02079],[23.94689,52.95919],[23.91805,52.94016],[23.93763,52.71332],[23.73615,52.6149],[23.58296,52.59868],[23.45112,52.53774],[23.34141,52.44845],[23.18196,52.28812],[23.20071,52.22848],[23.47859,52.18215],[23.54314,52.12148],[23.61,52.11264],[23.64066,52.07626],[23.68733,51.9906],[23.61523,51.92066],[23.62691,51.78208],[23.53198,51.74298],[23.57053,51.55938],[23.56236,51.53673],[23.62751,51.50512],[23.6736,51.50255],[23.60906,51.62122],[23.7766,51.66809],[23.91118,51.63316],[23.8741,51.59734],[23.99907,51.58369],[24.13075,51.66979],[24.3163,51.75063],[24.29021,51.80841],[24.37123,51.88222],[24.98784,51.91273],[25.20228,51.97143],[25.46163,51.92205],[25.73673,51.91973],[25.80574,51.94556],[25.83217,51.92587],[26.00408,51.92967],[26.19084,51.86781],[26.39367,51.87315],[26.46962,51.80501],[26.69759,51.82284],[26.80043,51.75777],[26.9489,51.73788],[26.99422,51.76933],[27.20602,51.77291],[27.20948,51.66713],[27.26613,51.65957],[27.24828,51.60161],[27.47212,51.61184],[27.51058,51.5854],[27.55727,51.63486],[27.71932,51.60672],[27.67125,51.50854],[27.76052,51.47604],[27.85253,51.62293],[27.91844,51.61952],[27.95827,51.56065],[28.10658,51.57857],[28.23452,51.66988],[28.37592,51.54505],[28.47051,51.59734],[28.64429,51.5664],[28.69161,51.44695],[28.73143,51.46236],[28.75615,51.41442],[28.78224,51.45294],[28.76027,51.48802],[28.81795,51.55552],[28.95528,51.59222],[28.99098,51.56833],[29.1187,51.65872],[29.16402,51.64679],[29.20659,51.56918],[29.25603,51.57089],[29.25191,51.49828],[29.32881,51.37843],[29.42357,51.4187],[29.49773,51.39814],[29.54372,51.48372],[29.7408,51.53417],[29.77376,51.4461],[30.17888,51.51025],[30.34642,51.42555],[30.36153,51.33984],[30.56203,51.25655],[30.64992,51.35014],[30.51946,51.59649],[30.68804,51.82806],[30.76443,51.89739],[30.90897,52.00699],[30.95589,52.07775],[31.13332,52.1004],[31.25142,52.04131],[31.38326,52.12991],[31.7822,52.11406],[31.77877,52.18636],[31.6895,52.1973],[31.70735,52.26711],[31.57971,52.32146],[31.62084,52.33849],[31.61397,52.48843],[31.56316,52.51518],[31.63869,52.55361],[31.50406,52.69707],[31.57277,52.71613],[31.592,52.79011],[31.35667,52.97854],[31.24147,53.031],[31.32283,53.04101],[31.33519,53.08805],[31.3915,53.09712],[31.36403,53.13504],[31.40523,53.21406],[31.56316,53.19432],[31.62496,53.22886],[31.787,53.18033],[31.82373,53.10042],[32.15368,53.07594],[32.40773,53.18856],[32.51725,53.28431],[32.73257,53.33494],[32.74968,53.45597],[32.47777,53.5548],[32.40499,53.6656],[32.50112,53.68594],[32.45717,53.74039],[32.36663,53.7166],[32.12621,53.81586],[31.89137,53.78099],[31.77028,53.80015],[31.85019,53.91801],[31.88744,54.03653],[31.89599,54.0837],[31.57002,54.14535],[31.30791,54.25315],[31.3177,54.34067],[31.22945,54.46585],[31.08543,54.50361],[31.21399,54.63113],[31.19339,54.66947],[30.99187,54.67046],[30.98226,54.68872],[31.0262,54.70698],[30.97127,54.71967],[30.95479,54.74346],[30.75165,54.80699],[30.8264,54.90062],[30.81759,54.94064],[30.93144,54.9585],[30.95754,54.98609],[30.9081,55.02232],[30.94243,55.03964],[31.00972,55.02783],[31.02071,55.06167],[30.97369,55.17134],[30.87944,55.28223],[30.81946,55.27931],[30.8257,55.3313],[30.93144,55.3914],[30.90123,55.46621],[30.95204,55.50667],[30.93419,55.6185],[30.86003,55.63169],[30.7845,55.58514],[30.72957,55.66268],[30.67464,55.64176],[30.63344,55.73079],[30.51037,55.76568],[30.51346,55.78982],[30.48257,55.81066],[30.30987,55.83592],[30.27776,55.86819],[30.12136,55.8358],[29.97975,55.87281],[29.80672,55.79569],[29.61446,55.77716],[29.51283,55.70294],[29.3604,55.75862],[29.44692,55.95978],[29.21717,55.98971],[29.08299,56.03427],[28.73418,55.97131],[28.63668,56.07262],[28.68337,56.10173],[28.5529,56.11705],[28.43068,56.09407],[28.37987,56.11399],[28.36888,56.05805],[28.30571,56.06035],[28.15217,56.16964]]]]}},{type:"Feature",properties:{iso1A2:"BZ",iso1A3:"BLZ",iso1N3:"084",wikidata:"Q242",nameEn:"Belize",groups:["013","003","419","019","UN"],roadSpeedUnit:"mph",callingCodes:["501"]},geometry:{type:"MultiPolygon",coordinates:[[[[-88.3268,18.49048],[-88.48242,18.49164],[-88.71505,18.0707],[-88.8716,17.89535],[-89.03839,18.0067],[-89.15105,17.95104],[-89.14985,17.81563],[-89.15025,17.04813],[-89.22683,15.88619],[-89.17418,15.90898],[-89.02415,15.9063],[-88.95358,15.88698],[-88.40779,16.09624],[-86.92368,17.61462],[-87.84815,18.18511],[-87.85693,18.18266],[-87.86657,18.19971],[-87.87604,18.18313],[-87.90671,18.15213],[-88.03165,18.16657],[-88.03238,18.41778],[-88.26593,18.47617],[-88.29909,18.47591],[-88.3268,18.49048]]]]}},{type:"Feature",properties:{iso1A2:"CA",iso1A3:"CAN",iso1N3:"124",wikidata:"Q16",nameEn:"Canada",groups:["021","003","019","UN"],callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-67.20349,45.1722],[-67.19603,45.16771],[-67.15965,45.16179],[-67.11316,45.11176],[-67.0216,44.95333],[-66.96824,44.90965],[-66.98249,44.87071],[-66.96824,44.83078],[-66.93432,44.82597],[-67.16117,44.20069],[-61.98255,37.34815],[-56.27503,47.39728],[-53.12387,41.40385],[-46.37635,57.3249],[-77.52957,77.23408],[-68.21821,80.48551],[-49.33696,84.57952],[-140.97446,84.39275],[-141.00116,60.30648],[-140.5227,60.22077],[-140.45648,60.30919],[-139.98024,60.18027],[-139.68991,60.33693],[-139.05831,60.35205],[-139.20603,60.08896],[-139.05365,59.99655],[-138.71149,59.90728],[-138.62145,59.76431],[-137.60623,59.24465],[-137.4925,58.89415],[-136.82619,59.16198],[-136.52365,59.16752],[-136.47323,59.46617],[-136.33727,59.44466],[-136.22381,59.55526],[-136.31566,59.59083],[-135.48007,59.79937],[-135.03069,59.56208],[-135.00267,59.28745],[-134.7047,59.2458],[-134.55699,59.1297],[-134.48059,59.13231],[-134.27175,58.8634],[-133.84645,58.73543],[-133.38523,58.42773],[-131.8271,56.62247],[-130.77769,56.36185],[-130.33965,56.10849],[-130.10173,56.12178],[-130.00093,56.00325],[-130.00857,55.91344],[-130.15373,55.74895],[-129.97513,55.28029],[-130.08035,55.21556],[-130.18765,55.07744],[-130.27203,54.97174],[-130.44184,54.85377],[-130.64499,54.76912],[-130.61931,54.70835],[-133.92876,54.62289],[-133.36909,48.51151],[-125.03842,48.53282],[-123.50039,48.21223],[-123.15614,48.35395],[-123.26565,48.6959],[-123.0093,48.76586],[-123.0093,48.83186],[-123.32163,49.00419],[-95.15355,48.9996],[-95.15357,49.384],[-95.12903,49.37056],[-95.05825,49.35311],[-95.01419,49.35647],[-94.99532,49.36579],[-94.95681,49.37035],[-94.85381,49.32492],[-94.8159,49.32299],[-94.82487,49.29483],[-94.77355,49.11998],[-94.75017,49.09931],[-94.687,48.84077],[-94.70087,48.8339],[-94.70486,48.82365],[-94.69669,48.80918],[-94.69335,48.77883],[-94.58903,48.71803],[-94.54885,48.71543],[-94.53826,48.70216],[-94.44258,48.69223],[-94.4174,48.71049],[-94.27153,48.70232],[-94.25172,48.68404],[-94.25104,48.65729],[-94.23215,48.65202],[-93.85769,48.63284],[-93.83288,48.62745],[-93.80676,48.58232],[-93.80939,48.52439],[-93.79267,48.51631],[-93.66382,48.51845],[-93.47022,48.54357],[-93.44472,48.59147],[-93.40693,48.60948],[-93.39758,48.60364],[-93.3712,48.60599],[-93.33946,48.62787],[-93.25391,48.64266],[-92.94973,48.60866],[-92.7287,48.54005],[-92.6342,48.54133],[-92.62747,48.50278],[-92.69927,48.49573],[-92.71323,48.46081],[-92.65606,48.43471],[-92.50712,48.44921],[-92.45588,48.40624],[-92.48147,48.36609],[-92.37185,48.22259],[-92.27167,48.25046],[-92.30939,48.31251],[-92.26662,48.35651],[-92.202,48.35252],[-92.14732,48.36578],[-92.05339,48.35958],[-91.98929,48.25409],[-91.86125,48.21278],[-91.71231,48.19875],[-91.70451,48.11805],[-91.55649,48.10611],[-91.58025,48.04339],[-91.45829,48.07454],[-91.43248,48.04912],[-91.25025,48.08522],[-91.08016,48.18096],[-90.87588,48.2484],[-90.75045,48.09143],[-90.56444,48.12184],[-90.56312,48.09488],[-90.07418,48.11043],[-89.89974,47.98109],[-89.77248,48.02607],[-89.57972,48.00023],[-89.48837,48.01412],[-88.37033,48.30586],[-84.85871,46.88881],[-84.55635,46.45974],[-84.47607,46.45225],[-84.4481,46.48972],[-84.42101,46.49853],[-84.34174,46.50683],[-84.29893,46.49127],[-84.26351,46.49508],[-84.2264,46.53337],[-84.1945,46.54061],[-84.17723,46.52753],[-84.12885,46.53068],[-84.11196,46.50248],[-84.13451,46.39218],[-84.11254,46.32329],[-84.11615,46.2681],[-84.09756,46.25512],[-84.1096,46.23987],[-83.95399,46.05634],[-83.90453,46.05922],[-83.83329,46.12169],[-83.57017,46.105],[-83.43746,45.99749],[-83.59589,45.82131],[-82.48419,45.30225],[-82.42469,42.992],[-82.4146,42.97626],[-82.4253,42.95423],[-82.45331,42.93139],[-82.4826,42.8068],[-82.46613,42.76615],[-82.51063,42.66025],[-82.51858,42.611],[-82.57583,42.5718],[-82.58873,42.54984],[-82.64242,42.55594],[-82.82964,42.37355],[-83.02253,42.33045],[-83.07837,42.30978],[-83.09837,42.28877],[-83.12724,42.2376],[-83.14962,42.04089],[-83.11184,41.95671],[-82.67862,41.67615],[-78.93684,42.82887],[-78.90712,42.89733],[-78.90905,42.93022],[-78.93224,42.95229],[-78.96312,42.95509],[-78.98126,42.97],[-79.02074,42.98444],[-79.02424,43.01983],[-78.99941,43.05612],[-79.01055,43.06659],[-79.07486,43.07845],[-79.05671,43.10937],[-79.06881,43.12029],[-79.0427,43.13934],[-79.04652,43.16396],[-79.05384,43.17418],[-79.05002,43.20133],[-79.05544,43.21224],[-79.05512,43.25375],[-79.06921,43.26183],[-79.25796,43.54052],[-76.79706,43.63099],[-76.43859,44.09393],[-76.35324,44.13493],[-76.31222,44.19894],[-76.244,44.19643],[-76.1664,44.23051],[-76.16285,44.28262],[-76.00018,44.34896],[-75.95947,44.34463],[-75.8217,44.43176],[-75.76813,44.51537],[-75.41441,44.76614],[-75.2193,44.87821],[-75.01363,44.95608],[-74.99101,44.98051],[-74.8447,45.00606],[-74.66689,45.00646],[-74.32699,44.99029],[-73.35025,45.00942],[-71.50067,45.01357],[-71.48735,45.07784],[-71.42778,45.12624],[-71.40364,45.21382],[-71.44252,45.2361],[-71.37133,45.24624],[-71.29371,45.29996],[-71.22338,45.25184],[-71.19723,45.25438],[-71.14568,45.24128],[-71.08364,45.30623],[-71.01866,45.31573],[-71.0107,45.34819],[-70.95193,45.33895],[-70.91169,45.29849],[-70.89864,45.2398],[-70.84816,45.22698],[-70.80236,45.37444],[-70.82638,45.39828],[-70.78372,45.43269],[-70.65383,45.37592],[-70.62518,45.42286],[-70.72651,45.49771],[-70.68516,45.56964],[-70.54019,45.67291],[-70.38934,45.73215],[-70.41523,45.79497],[-70.25976,45.89675],[-70.24694,45.95138],[-70.31025,45.96424],[-70.23855,46.1453],[-70.29078,46.18832],[-70.18547,46.35357],[-70.05812,46.41768],[-69.99966,46.69543],[-69.22119,47.46461],[-69.05148,47.42012],[-69.05073,47.30076],[-69.05039,47.2456],[-68.89222,47.1807],[-68.70125,47.24399],[-68.60575,47.24659],[-68.57914,47.28431],[-68.38332,47.28723],[-68.37458,47.35851],[-68.23244,47.35712],[-67.94843,47.1925],[-67.87993,47.10377],[-67.78578,47.06473],[-67.78111,45.9392],[-67.75196,45.91814],[-67.80961,45.87531],[-67.75654,45.82324],[-67.80653,45.80022],[-67.80705,45.69528],[-67.6049,45.60725],[-67.43815,45.59162],[-67.42144,45.50584],[-67.50578,45.48971],[-67.42394,45.37969],[-67.48201,45.27351],[-67.34927,45.122],[-67.29754,45.14865],[-67.29748,45.18173],[-67.27039,45.1934],[-67.22751,45.16344],[-67.20349,45.1722]]]]}},{type:"Feature",properties:{iso1A2:"CC",iso1A3:"CCK",iso1N3:"166",wikidata:"Q36004",nameEn:"Cocos (Keeling) Islands",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[96.61846,-10.82438],[96.02343,-12.68334],[97.93979,-12.33309],[96.61846,-10.82438]]]]}},{type:"Feature",properties:{iso1A2:"CD",iso1A3:"COD",iso1N3:"180",wikidata:"Q974",nameEn:"Democratic Republic of the Congo",aliases:["ZR"],groups:["017","202","002","UN"],callingCodes:["243"]},geometry:{type:"MultiPolygon",coordinates:[[[[27.44012,5.07349],[27.09575,5.22305],[26.93064,5.13535],[26.85579,5.03887],[26.74572,5.10685],[26.48595,5.04984],[26.13371,5.25594],[25.86073,5.19455],[25.53271,5.37431],[25.34558,5.29101],[25.31256,5.03668],[24.71816,4.90509],[24.46719,5.0915],[23.38847,4.60013],[22.94817,4.82392],[22.89094,4.79321],[22.84691,4.69887],[22.78526,4.71423],[22.6928,4.47285],[22.60915,4.48821],[22.5431,4.22041],[22.45504,4.13039],[22.27682,4.11347],[22.10721,4.20723],[21.6405,4.317],[21.55904,4.25553],[21.25744,4.33676],[21.21341,4.29285],[21.11214,4.33895],[21.08793,4.39603],[20.90383,4.44877],[20.60184,4.42394],[18.62755,3.47564],[18.63857,3.19342],[18.10683,2.26876],[18.08034,1.58553],[17.85887,1.04327],[17.86989,.58873],[17.95255,.48128],[17.93877,.32424],[17.81204,.23884],[17.66051,-.26535],[17.72112,-.52707],[17.32438,-.99265],[16.97999,-1.12762],[16.70724,-1.45815],[16.50336,-1.8795],[16.16173,-2.16586],[16.22785,-2.59528],[16.1755,-3.25014],[16.21407,-3.2969],[15.89448,-3.9513],[15.53081,-4.042],[15.48121,-4.22062],[15.41785,-4.28381],[15.32693,-4.27282],[15.25411,-4.31121],[15.1978,-4.32388],[14.83101,-4.80838],[14.67948,-4.92093],[14.5059,-4.84956],[14.41499,-4.8825],[14.37366,-4.56125],[14.47284,-4.42941],[14.3957,-4.36623],[14.40672,-4.28381],[13.9108,-4.50906],[13.81162,-4.41842],[13.71794,-4.44864],[13.70417,-4.72601],[13.50305,-4.77818],[13.41764,-4.89897],[13.11182,-4.5942],[13.09648,-4.63739],[13.11195,-4.67745],[12.8733,-4.74346],[12.70868,-4.95505],[12.63465,-4.94632],[12.60251,-5.01715],[12.46297,-5.09408],[12.49815,-5.14058],[12.51589,-5.1332],[12.53586,-5.14658],[12.53599,-5.1618],[12.52301,-5.17481],[12.52318,-5.74353],[12.26557,-5.74031],[12.20376,-5.76338],[11.95767,-5.94705],[12.42245,-6.07585],[13.04371,-5.87078],[16.55507,-5.85631],[16.96282,-7.21787],[17.5828,-8.13784],[18.33635,-8.00126],[19.33698,-7.99743],[19.5469,-7.00195],[20.30218,-6.98955],[20.31846,-6.91953],[20.61689,-6.90876],[20.56263,-7.28566],[21.79824,-7.29628],[21.84856,-9.59871],[22.19039,-9.94628],[22.32604,-10.76291],[22.17954,-10.85884],[22.25951,-11.24911],[22.54205,-11.05784],[23.16602,-11.10577],[23.45631,-10.946],[23.86868,-11.02856],[24.00027,-10.89356],[24.34528,-11.06816],[24.42612,-11.44975],[25.34069,-11.19707],[25.33058,-11.65767],[26.01777,-11.91488],[26.88687,-12.01868],[27.04351,-11.61312],[27.22541,-11.60323],[27.21025,-11.76157],[27.59932,-12.22123],[28.33199,-12.41375],[29.01918,-13.41353],[29.60531,-13.21685],[29.65078,-13.41844],[29.81551,-13.44683],[29.8139,-12.14898],[29.48404,-12.23604],[29.4992,-12.43843],[29.18592,-12.37921],[28.48357,-11.87532],[28.37241,-11.57848],[28.65032,-10.65133],[28.62795,-9.92942],[28.68532,-9.78],[28.56208,-9.49122],[28.51627,-9.44726],[28.52636,-9.35379],[28.36562,-9.30091],[28.38526,-9.23393],[28.9711,-8.66935],[28.88917,-8.4831],[30.79243,-8.27382],[30.2567,-7.14121],[29.52552,-6.2731],[29.43673,-4.44845],[29.23708,-3.75856],[29.21463,-3.3514],[29.25633,-3.05471],[29.17258,-2.99385],[29.16037,-2.95457],[29.09797,-2.91935],[29.09119,-2.87871],[29.0505,-2.81774],[29.00404,-2.81978],[29.00167,-2.78523],[29.04081,-2.7416],[29.00357,-2.70596],[28.94346,-2.69124],[28.89793,-2.66111],[28.90226,-2.62385],[28.89288,-2.55848],[28.87943,-2.55165],[28.86193,-2.53185],[28.86209,-2.5231],[28.87497,-2.50887],[28.88846,-2.50493],[28.89342,-2.49017],[28.89132,-2.47557],[28.86846,-2.44866],[28.86826,-2.41888],[28.89601,-2.37321],[28.95642,-2.37321],[29.00051,-2.29001],[29.105,-2.27043],[29.17562,-2.12278],[29.11847,-1.90576],[29.24458,-1.69663],[29.24323,-1.66826],[29.36322,-1.50887],[29.45038,-1.5054],[29.53062,-1.40499],[29.59061,-1.39016],[29.58388,-.89821],[29.63006,-.8997],[29.62708,-.71055],[29.67176,-.55714],[29.67474,-.47969],[29.65091,-.46777],[29.72687,-.08051],[29.7224,.07291],[29.77454,.16675],[29.81922,.16824],[29.87284,.39166],[29.97413,.52124],[29.95477,.64486],[29.98307,.84295],[30.1484,.89805],[30.22139,.99635],[30.24671,1.14974],[30.48503,1.21675],[31.30127,2.11006],[31.28042,2.17853],[31.20148,2.2217],[31.1985,2.29462],[31.12104,2.27676],[31.07934,2.30207],[31.06593,2.35862],[30.96911,2.41071],[30.91102,2.33332],[30.83059,2.42559],[30.74271,2.43601],[30.75612,2.5863],[30.8857,2.83923],[30.8574,2.9508],[30.77101,3.04897],[30.84251,3.26908],[30.93486,3.40737],[30.94081,3.50847],[30.85153,3.48867],[30.85997,3.5743],[30.80713,3.60506],[30.78512,3.67097],[30.56277,3.62703],[30.57378,3.74567],[30.55396,3.84451],[30.47691,3.83353],[30.27658,3.95653],[30.22374,3.93896],[30.1621,4.10586],[30.06964,4.13221],[29.79666,4.37809],[29.82087,4.56246],[29.49726,4.7007],[29.43341,4.50101],[29.22207,4.34297],[29.03054,4.48784],[28.8126,4.48784],[28.6651,4.42638],[28.20719,4.35614],[27.79551,4.59976],[27.76469,4.79284],[27.65462,4.89375],[27.56656,4.89375],[27.44012,5.07349]]]]}},{type:"Feature",properties:{iso1A2:"CF",iso1A3:"CAF",iso1N3:"140",wikidata:"Q929",nameEn:"Central African Republic",groups:["017","202","002","UN"],callingCodes:["236"]},geometry:{type:"MultiPolygon",coordinates:[[[[22.87758,10.91915],[22.45889,11.00246],[21.72139,10.64136],[21.71479,10.29932],[21.63553,10.217],[21.52766,10.2105],[21.34934,9.95907],[21.26348,9.97642],[20.82979,9.44696],[20.36748,9.11019],[19.06421,9.00367],[18.86388,8.87971],[19.11044,8.68172],[18.79783,8.25929],[18.67455,8.22226],[18.62612,8.14163],[18.64153,8.08714],[18.6085,8.05009],[18.02731,8.01085],[17.93926,7.95853],[17.67288,7.98905],[16.8143,7.53971],[16.6668,7.67281],[16.658,7.75353],[16.59415,7.76444],[16.58315,7.88657],[16.41583,7.77971],[16.40703,7.68809],[15.79942,7.44149],[15.73118,7.52006],[15.49743,7.52179],[15.23397,7.25135],[15.04717,6.77085],[14.96311,6.75693],[14.79966,6.39043],[14.80122,6.34866],[14.74206,6.26356],[14.56149,6.18928],[14.43073,6.08867],[14.42917,6.00508],[14.49455,5.91683],[14.60974,5.91838],[14.62375,5.70466],[14.58951,5.59777],[14.62531,5.51411],[14.52724,5.28319],[14.57083,5.23979],[14.65489,5.21343],[14.73383,4.6135],[15.00825,4.41458],[15.08609,4.30282],[15.10644,4.1362],[15.17482,4.05131],[15.07686,4.01805],[15.73522,3.24348],[15.77725,3.26835],[16.05449,3.02306],[16.08252,2.45708],[16.19357,2.21537],[16.50126,2.84739],[16.46701,2.92512],[16.57598,3.47999],[16.68283,3.54257],[17.01746,3.55136],[17.35649,3.63045],[17.46876,3.70515],[17.60966,3.63705],[17.83421,3.61068],[17.85842,3.53378],[18.05656,3.56893],[18.14902,3.54476],[18.17323,3.47665],[18.24148,3.50302],[18.2723,3.57992],[18.39558,3.58212],[18.49245,3.63924],[18.58711,3.49423],[18.62755,3.47564],[20.60184,4.42394],[20.90383,4.44877],[21.08793,4.39603],[21.11214,4.33895],[21.21341,4.29285],[21.25744,4.33676],[21.55904,4.25553],[21.6405,4.317],[22.10721,4.20723],[22.27682,4.11347],[22.45504,4.13039],[22.5431,4.22041],[22.60915,4.48821],[22.6928,4.47285],[22.78526,4.71423],[22.84691,4.69887],[22.89094,4.79321],[22.94817,4.82392],[23.38847,4.60013],[24.46719,5.0915],[24.71816,4.90509],[25.31256,5.03668],[25.34558,5.29101],[25.53271,5.37431],[25.86073,5.19455],[26.13371,5.25594],[26.48595,5.04984],[26.74572,5.10685],[26.85579,5.03887],[26.93064,5.13535],[27.09575,5.22305],[27.44012,5.07349],[27.26886,5.25876],[27.23017,5.37167],[27.28621,5.56382],[27.22705,5.62889],[27.22705,5.71254],[26.51721,6.09655],[26.58259,6.1987],[26.32729,6.36272],[26.38022,6.63493],[25.90076,7.09549],[25.37461,7.33024],[25.35281,7.42595],[25.20337,7.50312],[25.20649,7.61115],[25.29214,7.66675],[25.25319,7.8487],[24.98855,7.96588],[24.85156,8.16933],[24.35965,8.26177],[24.13238,8.36959],[24.25691,8.69288],[23.51905,8.71749],[23.59065,8.99743],[23.44744,8.99128],[23.4848,9.16959],[23.56263,9.19418],[23.64358,9.28637],[23.64981,9.44303],[23.62179,9.53823],[23.69155,9.67566],[23.67164,9.86923],[23.3128,10.45214],[23.02221,10.69235],[22.87758,10.91915]]]]}},{type:"Feature",properties:{iso1A2:"CG",iso1A3:"COG",iso1N3:"178",wikidata:"Q971",nameEn:"Republic of the Congo",groups:["017","202","002","UN"],callingCodes:["242"]},geometry:{type:"MultiPolygon",coordinates:[[[[18.62755,3.47564],[18.58711,3.49423],[18.49245,3.63924],[18.39558,3.58212],[18.2723,3.57992],[18.24148,3.50302],[18.17323,3.47665],[18.14902,3.54476],[18.05656,3.56893],[17.85842,3.53378],[17.83421,3.61068],[17.60966,3.63705],[17.46876,3.70515],[17.35649,3.63045],[17.01746,3.55136],[16.68283,3.54257],[16.57598,3.47999],[16.46701,2.92512],[16.50126,2.84739],[16.19357,2.21537],[16.15568,2.18955],[16.08563,2.19733],[16.05294,1.9811],[16.14634,1.70259],[16.02647,1.65591],[16.02959,1.76483],[15.48942,1.98265],[15.34776,1.91264],[15.22634,2.03243],[15.00996,1.98887],[14.61145,2.17866],[13.29457,2.16106],[13.13461,1.57238],[13.25447,1.32339],[13.15519,1.23368],[13.89582,1.4261],[14.25186,1.39842],[14.48179,.9152],[14.26066,.57255],[14.10909,.58563],[13.88648,.26652],[13.90632,-.2287],[14.06862,-.20826],[14.2165,-.38261],[14.41887,-.44799],[14.52569,-.57818],[14.41838,-1.89412],[14.25932,-1.97624],[14.23518,-2.15671],[14.16202,-2.23916],[14.23829,-2.33715],[14.10442,-2.49268],[13.85846,-2.46935],[13.92073,-2.35581],[13.75884,-2.09293],[13.47977,-2.43224],[13.02759,-2.33098],[12.82172,-1.91091],[12.61312,-1.8129],[12.44656,-1.92025],[12.47925,-2.32626],[12.04895,-2.41704],[11.96866,-2.33559],[11.74605,-2.39936],[11.57637,-2.33379],[11.64487,-2.61865],[11.5359,-2.85654],[11.64798,-2.81146],[11.80365,-3.00424],[11.70558,-3.0773],[11.70227,-3.17465],[11.96554,-3.30267],[11.8318,-3.5812],[11.92719,-3.62768],[11.87083,-3.71571],[11.68608,-3.68942],[11.57949,-3.52798],[11.48764,-3.51089],[11.22301,-3.69888],[11.12647,-3.94169],[10.75913,-4.39519],[11.50888,-5.33417],[12.00924,-5.02627],[12.16068,-4.90089],[12.20901,-4.75642],[12.25587,-4.79437],[12.32324,-4.78415],[12.40964,-4.60609],[12.64835,-4.55937],[12.76844,-4.38709],[12.87096,-4.40315],[12.91489,-4.47907],[13.09648,-4.63739],[13.11182,-4.5942],[13.41764,-4.89897],[13.50305,-4.77818],[13.70417,-4.72601],[13.71794,-4.44864],[13.81162,-4.41842],[13.9108,-4.50906],[14.40672,-4.28381],[14.3957,-4.36623],[14.47284,-4.42941],[14.37366,-4.56125],[14.41499,-4.8825],[14.5059,-4.84956],[14.67948,-4.92093],[14.83101,-4.80838],[15.1978,-4.32388],[15.25411,-4.31121],[15.32693,-4.27282],[15.41785,-4.28381],[15.48121,-4.22062],[15.53081,-4.042],[15.89448,-3.9513],[16.21407,-3.2969],[16.1755,-3.25014],[16.22785,-2.59528],[16.16173,-2.16586],[16.50336,-1.8795],[16.70724,-1.45815],[16.97999,-1.12762],[17.32438,-.99265],[17.72112,-.52707],[17.66051,-.26535],[17.81204,.23884],[17.93877,.32424],[17.95255,.48128],[17.86989,.58873],[17.85887,1.04327],[18.08034,1.58553],[18.10683,2.26876],[18.63857,3.19342],[18.62755,3.47564]]]]}},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[8.72809,47.69282],[8.72617,47.69651],[8.73671,47.7169],[8.70543,47.73121],[8.74251,47.75168],[8.71778,47.76571],[8.68985,47.75686],[8.68022,47.78599],[8.65292,47.80066],[8.64425,47.76398],[8.62408,47.7626],[8.61657,47.79998],[8.56415,47.80633],[8.56814,47.78001],[8.48868,47.77215],[8.45771,47.7493],[8.44807,47.72426],[8.40569,47.69855],[8.4211,47.68407],[8.40473,47.67499],[8.41346,47.66676],[8.42264,47.66667],[8.44711,47.65379],[8.4667,47.65747],[8.46605,47.64103],[8.49656,47.64709],[8.5322,47.64687],[8.52801,47.66059],[8.56141,47.67088],[8.57683,47.66158],[8.6052,47.67258],[8.61113,47.66332],[8.62884,47.65098],[8.62049,47.63757],[8.60412,47.63735],[8.61471,47.64514],[8.60701,47.65271],[8.59545,47.64298],[8.60348,47.61204],[8.57586,47.59537],[8.55756,47.62394],[8.51686,47.63476],[8.50747,47.61897],[8.45578,47.60121],[8.46637,47.58389],[8.48949,47.588],[8.49431,47.58107],[8.43235,47.56617],[8.39477,47.57826],[8.38273,47.56608],[8.35512,47.57014],[8.32735,47.57133],[8.30277,47.58607],[8.29524,47.5919],[8.29722,47.60603],[8.2824,47.61225],[8.26313,47.6103],[8.25863,47.61571],[8.23809,47.61204],[8.22577,47.60385],[8.22011,47.6181],[8.20617,47.62141],[8.19378,47.61636],[8.1652,47.5945],[8.14947,47.59558],[8.13823,47.59147],[8.13662,47.58432],[8.11543,47.5841],[8.10395,47.57918],[8.10002,47.56504],[8.08557,47.55768],[8.06663,47.56374],[8.04383,47.55443],[8.02136,47.55096],[8.00113,47.55616],[7.97581,47.55493],[7.95682,47.55789],[7.94494,47.54511],[7.91251,47.55031],[7.90673,47.57674],[7.88664,47.58854],[7.84412,47.5841],[7.81901,47.58798],[7.79486,47.55691],[7.75261,47.54599],[7.71961,47.54219],[7.69642,47.53297],[7.68101,47.53232],[7.6656,47.53752],[7.66174,47.54554],[7.65083,47.54662],[7.63338,47.56256],[7.67655,47.56435],[7.68904,47.57133],[7.67115,47.5871],[7.68486,47.59601],[7.69385,47.60099],[7.68229,47.59905],[7.67395,47.59212],[7.64599,47.59695],[7.64213,47.5944],[7.64309,47.59151],[7.61929,47.57683],[7.60459,47.57869],[7.60523,47.58519],[7.58945,47.59017],[7.58386,47.57536],[7.56684,47.57785],[7.56548,47.57617],[7.55689,47.57232],[7.55652,47.56779],[7.53634,47.55553],[7.52831,47.55347],[7.51723,47.54578],[7.50873,47.54546],[7.49691,47.53821],[7.50588,47.52856],[7.51904,47.53515],[7.53199,47.5284],[7.5229,47.51644],[7.49804,47.51798],[7.51076,47.49651],[7.47534,47.47932],[7.43356,47.49712],[7.42923,47.48628],[7.4583,47.47216],[7.4462,47.46264],[7.43088,47.45846],[7.40308,47.43638],[7.35603,47.43432],[7.33526,47.44186],[7.24669,47.4205],[7.17026,47.44312],[7.19583,47.49455],[7.16249,47.49025],[7.12781,47.50371],[7.07425,47.48863],[7.0231,47.50522],[6.98425,47.49432],[7.0024,47.45264],[6.93953,47.43388],[6.93744,47.40714],[6.88542,47.37262],[6.87959,47.35335],[7.03125,47.36996],[7.0564,47.35134],[7.05305,47.33304],[6.94316,47.28747],[6.95108,47.26428],[6.9508,47.24338],[6.8489,47.15933],[6.76788,47.1208],[6.68823,47.06616],[6.71531,47.0494],[6.43341,46.92703],[6.46456,46.88865],[6.43216,46.80336],[6.45209,46.77502],[6.38351,46.73171],[6.27135,46.68251],[6.11084,46.57649],[6.1567,46.54402],[6.07269,46.46244],[6.08427,46.44305],[6.06407,46.41676],[6.09926,46.40768],[6.15016,46.3778],[6.15985,46.37721],[6.16987,46.36759],[6.15738,46.3491],[6.13876,46.33844],[6.1198,46.31157],[6.11697,46.29547],[6.1013,46.28512],[6.11926,46.2634],[6.12446,46.25059],[6.10071,46.23772],[6.08563,46.24651],[6.07072,46.24085],[6.0633,46.24583],[6.05029,46.23518],[6.04602,46.23127],[6.03342,46.2383],[6.02461,46.23313],[5.97542,46.21525],[5.96515,46.19638],[5.99573,46.18587],[5.98846,46.17046],[5.98188,46.17392],[5.97508,46.15863],[5.9641,46.14412],[5.95781,46.12925],[5.97893,46.13303],[5.9871,46.14499],[6.01791,46.14228],[6.03614,46.13712],[6.04564,46.14031],[6.05203,46.15191],[6.07491,46.14879],[6.09199,46.15191],[6.09926,46.14373],[6.13397,46.1406],[6.15305,46.15194],[6.18116,46.16187],[6.18871,46.16644],[6.18707,46.17999],[6.19552,46.18401],[6.19807,46.18369],[6.20539,46.19163],[6.21114,46.1927],[6.21273,46.19409],[6.21603,46.19507],[6.21844,46.19837],[6.22222,46.19888],[6.22175,46.20045],[6.23544,46.20714],[6.23913,46.20511],[6.24821,46.20531],[6.26007,46.21165],[6.27694,46.21566],[6.29663,46.22688],[6.31041,46.24417],[6.29474,46.26221],[6.26749,46.24745],[6.24952,46.26255],[6.23775,46.27822],[6.25137,46.29014],[6.24826,46.30175],[6.21981,46.31304],[6.25432,46.3632],[6.53358,46.45431],[6.82312,46.42661],[6.8024,46.39171],[6.77152,46.34784],[6.86052,46.28512],[6.78968,46.14058],[6.89321,46.12548],[6.87868,46.03855],[6.93862,46.06502],[7.00946,45.9944],[7.04151,45.92435],[7.10685,45.85653],[7.56343,45.97421],[7.85949,45.91485],[7.9049,45.99945],[7.98881,45.99867],[8.02906,46.10331],[8.11383,46.11577],[8.16866,46.17817],[8.08814,46.26692],[8.31162,46.38044],[8.30648,46.41587],[8.42464,46.46367],[8.46317,46.43712],[8.45032,46.26869],[8.62242,46.12112],[8.75697,46.10395],[8.80778,46.10085],[8.85617,46.0748],[8.79414,46.00913],[8.78585,45.98973],[8.79362,45.99207],[8.8319,45.9879],[8.85121,45.97239],[8.86688,45.96135],[8.88904,45.95465],[8.93649,45.86775],[8.94372,45.86587],[8.93504,45.86245],[8.91129,45.8388],[8.94737,45.84285],[8.9621,45.83707],[8.99663,45.83466],[9.00324,45.82055],[9.0298,45.82127],[9.03279,45.82865],[9.03793,45.83548],[9.03505,45.83976],[9.04059,45.8464],[9.04546,45.84968],[9.06642,45.8761],[9.09065,45.89906],[8.99257,45.9698],[9.01618,46.04928],[9.24503,46.23616],[9.29226,46.32717],[9.25502,46.43743],[9.28136,46.49685],[9.36128,46.5081],[9.40487,46.46621],[9.45936,46.50873],[9.46117,46.37481],[9.57015,46.2958],[9.71273,46.29266],[9.73086,46.35071],[9.95249,46.38045],[10.07055,46.21668],[10.14439,46.22992],[10.17862,46.25626],[10.10506,46.3372],[10.165,46.41051],[10.03715,46.44479],[10.10307,46.61003],[10.23674,46.63484],[10.25309,46.57432],[10.46136,46.53164],[10.49375,46.62049],[10.44686,46.64162],[10.40475,46.63671],[10.38659,46.67847],[10.47197,46.85698],[10.48376,46.93891],[10.36933,47.00212],[10.30031,46.92093],[10.24128,46.93147],[10.22675,46.86942],[10.10715,46.84296],[9.98058,46.91434],[9.88266,46.93343],[9.87935,47.01337],[9.60717,47.06091],[9.55721,47.04762],[9.54041,47.06495],[9.47548,47.05257],[9.47139,47.06402],[9.51362,47.08505],[9.52089,47.10019],[9.51044,47.13727],[9.48774,47.17402],[9.4891,47.19346],[9.50318,47.22153],[9.52406,47.24959],[9.53116,47.27029],[9.54773,47.2809],[9.55857,47.29919],[9.58513,47.31334],[9.59978,47.34671],[9.62476,47.36639],[9.65427,47.36824],[9.66243,47.37136],[9.6711,47.37824],[9.67445,47.38429],[9.67334,47.39191],[9.6629,47.39591],[9.65136,47.40504],[9.65043,47.41937],[9.6446,47.43233],[9.64483,47.43842],[9.65863,47.44847],[9.65728,47.45383],[9.6423,47.45599],[9.62475,47.45685],[9.62158,47.45858],[9.60841,47.47178],[9.60484,47.46358],[9.60205,47.46165],[9.59482,47.46305],[9.58208,47.48344],[9.56312,47.49495],[9.55125,47.53629],[9.25619,47.65939],[9.18203,47.65598],[9.17593,47.65399],[9.1755,47.65584],[9.1705,47.65513],[9.15181,47.66904],[9.13845,47.66389],[9.09891,47.67801],[9.02093,47.6868],[8.94093,47.65596],[8.89946,47.64769],[8.87625,47.65441],[8.87383,47.67045],[8.85065,47.68209],[8.86989,47.70504],[8.82002,47.71458],[8.80663,47.73821],[8.77309,47.72059],[8.76965,47.7075],[8.79966,47.70222],[8.79511,47.67462],[8.75856,47.68969],[8.72809,47.69282]],[[8.95861,45.96485],[8.96668,45.98436],[8.97741,45.98317],[8.97604,45.96151],[8.95861,45.96485]],[[8.70847,47.68904],[8.68985,47.69552],[8.66837,47.68437],[8.65769,47.68928],[8.67508,47.6979],[8.66416,47.71367],[8.70237,47.71453],[8.71773,47.69088],[8.70847,47.68904]]]]},properties:{iso1A2:"CH",iso1A3:"CHE",iso1N3:"756",wikidata:"Q39",nameEn:"Switzerland",groups:["155","150","UN"],callingCodes:["41"]}},{type:"Feature",properties:{iso1A2:"CI",iso1A3:"CIV",iso1N3:"384",wikidata:"Q1008",nameEn:"C\xF4te d'Ivoire",groups:["011","202","002","UN"],callingCodes:["225"]},geometry:{type:"MultiPolygon",coordinates:[[[[-7.52774,3.7105],[-3.34019,4.17519],[-3.10675,5.08515],[-3.11073,5.12675],[-3.063,5.13665],[-2.96554,5.10397],[-2.95261,5.12477],[-2.75502,5.10657],[-2.73074,5.1364],[-2.77625,5.34621],[-2.72737,5.34789],[-2.76614,5.60963],[-2.85378,5.65156],[-2.93132,5.62137],[-2.96671,5.6415],[-2.95323,5.71865],[-3.01896,5.71697],[-3.25999,6.62521],[-3.21954,6.74407],[-3.23327,6.81744],[-2.95438,7.23737],[-2.97822,7.27165],[-2.92339,7.60847],[-2.79467,7.86002],[-2.78395,7.94974],[-2.74819,7.92613],[-2.67787,8.02055],[-2.61232,8.02645],[-2.62901,8.11495],[-2.49037,8.20872],[-2.58243,8.7789],[-2.66357,9.01771],[-2.77799,9.04949],[-2.69814,9.22717],[-2.68802,9.49343],[-2.76494,9.40778],[-2.93012,9.57403],[-3.00765,9.74019],[-3.16609,9.85147],[-3.19306,9.93781],[-3.27228,9.84981],[-3.31779,9.91125],[-3.69703,9.94279],[-4.25999,9.76012],[-4.31392,9.60062],[-4.6426,9.70696],[-4.96621,9.89132],[-4.96453,9.99923],[-5.12465,10.29788],[-5.39602,10.2929],[-5.51058,10.43177],[-5.65135,10.46767],[-5.78124,10.43952],[-5.99478,10.19694],[-6.18851,10.24244],[-6.1731,10.46983],[-6.24795,10.74248],[-6.325,10.68624],[-6.40646,10.69922],[-6.42847,10.5694],[-6.52974,10.59104],[-6.63541,10.66893],[-6.68164,10.35074],[-6.93921,10.35291],[-7.01186,10.25111],[-6.97444,10.21644],[-7.00966,10.15794],[-7.0603,10.14711],[-7.13331,10.24877],[-7.3707,10.24677],[-7.44555,10.44602],[-7.52261,10.4655],[-7.54462,10.40921],[-7.63048,10.46334],[-7.92107,10.15577],[-7.97971,10.17117],[-8.01225,10.1021],[-8.11921,10.04577],[-8.15652,9.94288],[-8.09434,9.86936],[-8.14657,9.55062],[-8.03463,9.39604],[-7.85056,9.41812],[-7.90777,9.20456],[-7.73862,9.08422],[-7.92518,8.99332],[-7.95503,8.81146],[-7.69882,8.66148],[-7.65653,8.36873],[-7.92518,8.50652],[-8.22991,8.48438],[-8.2411,8.24196],[-8.062,8.16071],[-7.98675,8.20134],[-7.99919,8.11023],[-7.94695,8.00925],[-8.06449,8.04989],[-8.13414,7.87991],[-8.09931,7.78626],[-8.21374,7.54466],[-8.4003,7.6285],[-8.47114,7.55676],[-8.41935,7.51203],[-8.37458,7.25794],[-8.29249,7.1691],[-8.31736,6.82837],[-8.59456,6.50612],[-8.48652,6.43797],[-8.45666,6.49977],[-8.38453,6.35887],[-8.3298,6.36381],[-8.17557,6.28222],[-8.00642,6.31684],[-7.90692,6.27728],[-7.83478,6.20309],[-7.8497,6.08932],[-7.79747,6.07696],[-7.78254,5.99037],[-7.70294,5.90625],[-7.67309,5.94337],[-7.48155,5.80974],[-7.46165,5.84934],[-7.43677,5.84687],[-7.43926,5.74787],[-7.37209,5.61173],[-7.43428,5.42355],[-7.36463,5.32944],[-7.46165,5.26256],[-7.48901,5.14118],[-7.55369,5.08667],[-7.53876,4.94294],[-7.59349,4.8909],[-7.53259,4.35145],[-7.52774,3.7105]]]]}},{type:"Feature",properties:{iso1A2:"CK",iso1A3:"COK",iso1N3:"184",wikidata:"Q26988",nameEn:"Cook Islands",country:"NZ",groups:["061","009","UN"],driveSide:"left",callingCodes:["682"]},geometry:{type:"MultiPolygon",coordinates:[[[[-168.15106,-10.26955],[-156.45576,-31.75456],[-156.48634,-15.52824],[-156.50903,-7.4975],[-168.15106,-10.26955]]]]}},{type:"Feature",properties:{iso1A2:"CL",iso1A3:"CHL",iso1N3:"152",wikidata:"Q298",nameEn:"Chile",groups:["005","419","019","UN"],callingCodes:["56"]},geometry:{type:"MultiPolygon",coordinates:[[[[-68.60702,-52.65781],[-68.41683,-52.33516],[-69.97824,-52.00845],[-71.99889,-51.98018],[-72.33873,-51.59954],[-72.31343,-50.58411],[-73.15765,-50.78337],[-73.55259,-49.92488],[-73.45156,-49.79461],[-73.09655,-49.14342],[-72.56894,-48.81116],[-72.54042,-48.52392],[-72.27662,-48.28727],[-72.50478,-47.80586],[-71.94152,-47.13595],[-71.68577,-46.55385],[-71.75614,-45.61611],[-71.35687,-45.22075],[-72.06985,-44.81756],[-71.26418,-44.75684],[-71.16436,-44.46244],[-71.81318,-44.38097],[-71.64206,-43.64774],[-72.14828,-42.85321],[-72.15541,-42.15941],[-71.74901,-42.11711],[-71.92726,-40.72714],[-71.37826,-38.91474],[-70.89532,-38.6923],[-71.24279,-37.20264],[-70.95047,-36.4321],[-70.38008,-36.02375],[-70.49416,-35.24145],[-69.87386,-34.13344],[-69.88099,-33.34489],[-70.55832,-31.51559],[-70.14479,-30.36595],[-69.8596,-30.26131],[-69.99507,-29.28351],[-69.80969,-29.07185],[-69.66709,-28.44055],[-69.22504,-27.95042],[-68.77586,-27.16029],[-68.43363,-27.08414],[-68.27677,-26.90626],[-68.59048,-26.49861],[-68.56909,-26.28146],[-68.38372,-26.15353],[-68.57622,-25.32505],[-68.38372,-25.08636],[-68.56909,-24.69831],[-68.24825,-24.42596],[-67.33563,-24.04237],[-66.99632,-22.99839],[-67.18382,-22.81525],[-67.54284,-22.89771],[-67.85114,-22.87076],[-68.18816,-21.28614],[-68.40403,-20.94562],[-68.53957,-20.91542],[-68.55383,-20.7355],[-68.44023,-20.62701],[-68.7276,-20.46178],[-68.74273,-20.08817],[-68.57132,-20.03134],[-68.54611,-19.84651],[-68.66761,-19.72118],[-68.41218,-19.40499],[-68.61989,-19.27584],[-68.80602,-19.08355],[-68.87082,-19.06003],[-68.94987,-18.93302],[-69.07432,-18.28259],[-69.14807,-18.16893],[-69.07496,-18.03715],[-69.28671,-17.94844],[-69.34126,-17.72753],[-69.46623,-17.60518],[-69.46897,-17.4988],[-69.66483,-17.65083],[-69.79087,-17.65563],[-69.82868,-17.72048],[-69.75305,-17.94605],[-69.81607,-18.12582],[-69.96732,-18.25992],[-70.16394,-18.31737],[-70.31267,-18.31258],[-70.378,-18.3495],[-70.59118,-18.35072],[-113.52687,-26.52828],[-68.11646,-58.14883],[-66.07313,-55.19618],[-67.11046,-54.94199],[-67.46182,-54.92205],[-68.01394,-54.8753],[-68.60733,-54.9125],[-68.60702,-52.65781]]]]}},{type:"Feature",properties:{iso1A2:"CM",iso1A3:"CMR",iso1N3:"120",wikidata:"Q1009",nameEn:"Cameroon",groups:["017","202","002","UN"],callingCodes:["237"]},geometry:{type:"MultiPolygon",coordinates:[[[[14.83314,12.62963],[14.55058,12.78256],[14.56101,12.91036],[14.46881,13.08259],[14.08251,13.0797],[14.20204,12.53405],[14.17523,12.41916],[14.22215,12.36533],[14.4843,12.35223],[14.6474,12.17466],[14.61612,11.7798],[14.55207,11.72001],[14.64591,11.66166],[14.6124,11.51283],[14.17821,11.23831],[13.97489,11.30258],[13.78945,11.00154],[13.7403,11.00593],[13.70753,10.94451],[13.73434,10.9255],[13.54964,10.61236],[13.5705,10.53183],[13.43644,10.13326],[13.34111,10.12299],[13.25025,10.03647],[13.25323,10.00127],[13.286,9.9822],[13.27409,9.93232],[13.24132,9.91031],[13.25025,9.86042],[13.29941,9.8296],[13.25472,9.76795],[13.22642,9.57266],[13.02385,9.49334],[12.85628,9.36698],[12.91958,9.33905],[12.90022,9.11411],[12.81085,8.91992],[12.79,8.75361],[12.71701,8.7595],[12.68722,8.65938],[12.44146,8.6152],[12.4489,8.52536],[12.26123,8.43696],[12.24782,8.17904],[12.19271,8.10826],[12.20909,7.97553],[11.99908,7.67302],[12.01844,7.52981],[11.93205,7.47812],[11.84864,7.26098],[11.87396,7.09398],[11.63117,6.9905],[11.55818,6.86186],[11.57755,6.74059],[11.51499,6.60892],[11.42264,6.5882],[11.42041,6.53789],[11.09495,6.51717],[11.09644,6.68437],[10.94302,6.69325],[10.8179,6.83377],[10.83727,6.9358],[10.60789,7.06885],[10.59746,7.14719],[10.57214,7.16345],[10.53639,6.93432],[10.21466,6.88996],[10.15135,7.03781],[9.86314,6.77756],[9.77824,6.79088],[9.70674,6.51717],[9.51757,6.43874],[8.84209,5.82562],[8.88156,5.78857],[8.83687,5.68483],[8.92029,5.58403],[8.78027,5.1243],[8.60302,4.87353],[8.34397,4.30689],[9.22018,3.72052],[9.81162,2.33797],[9.82123,2.35097],[9.83754,2.32428],[9.83238,2.29079],[9.84716,2.24676],[9.89012,2.20457],[9.90749,2.20049],[9.991,2.16561],[11.3561,2.17217],[11.37116,2.29975],[13.28534,2.25716],[13.29457,2.16106],[14.61145,2.17866],[15.00996,1.98887],[15.22634,2.03243],[15.34776,1.91264],[15.48942,1.98265],[16.02959,1.76483],[16.02647,1.65591],[16.14634,1.70259],[16.05294,1.9811],[16.08563,2.19733],[16.15568,2.18955],[16.19357,2.21537],[16.08252,2.45708],[16.05449,3.02306],[15.77725,3.26835],[15.73522,3.24348],[15.07686,4.01805],[15.17482,4.05131],[15.10644,4.1362],[15.08609,4.30282],[15.00825,4.41458],[14.73383,4.6135],[14.65489,5.21343],[14.57083,5.23979],[14.52724,5.28319],[14.62531,5.51411],[14.58951,5.59777],[14.62375,5.70466],[14.60974,5.91838],[14.49455,5.91683],[14.42917,6.00508],[14.43073,6.08867],[14.56149,6.18928],[14.74206,6.26356],[14.80122,6.34866],[14.79966,6.39043],[14.96311,6.75693],[15.04717,6.77085],[15.23397,7.25135],[15.49743,7.52179],[15.56964,7.58936],[15.59272,7.7696],[15.50743,7.79302],[15.20426,8.50892],[15.09484,8.65982],[14.83566,8.80557],[14.35707,9.19611],[14.37094,9.2954],[13.97544,9.6365],[14.01793,9.73169],[14.1317,9.82413],[14.20411,10.00055],[14.4673,10.00264],[14.80082,9.93818],[14.95722,9.97926],[15.05999,9.94845],[15.14043,9.99246],[15.24618,9.99246],[15.41408,9.92876],[15.68761,9.99344],[15.50535,10.1098],[15.30874,10.31063],[15.23724,10.47764],[15.14936,10.53915],[15.15532,10.62846],[15.06737,10.80921],[15.09127,10.87431],[15.04957,11.02347],[15.10021,11.04101],[15.0585,11.40481],[15.13149,11.5537],[15.06595,11.71126],[15.11579,11.79313],[15.04808,11.8731],[15.05786,12.0608],[15.0349,12.10698],[15.00146,12.1223],[14.96952,12.0925],[14.89019,12.16593],[14.90827,12.3269],[14.83314,12.62963]]]]}},{type:"Feature",properties:{iso1A2:"CN",iso1A3:"CHN",iso1N3:"156",wikidata:"Q148",nameEn:"People's Republic of China"},geometry:null},{type:"Feature",properties:{iso1A2:"CO",iso1A3:"COL",iso1N3:"170",wikidata:"Q739",nameEn:"Colombia",groups:["005","419","019","UN"],callingCodes:["57"]},geometry:{type:"MultiPolygon",coordinates:[[[[-71.19849,12.65801],[-81.58685,18.0025],[-82.06974,14.49418],[-82.56142,11.91792],[-78.79327,9.93766],[-77.58292,9.22278],[-77.32389,8.81247],[-77.45064,8.49991],[-77.17257,7.97422],[-77.57185,7.51147],[-77.72514,7.72348],[-77.72157,7.47612],[-77.81426,7.48319],[-77.89178,7.22681],[-78.06168,7.07793],[-82.12561,4.00341],[-78.87137,1.47457],[-78.42749,1.15389],[-77.85677,.80197],[-77.7148,.85003],[-77.68613,.83029],[-77.66416,.81604],[-77.67815,.73863],[-77.49984,.64476],[-77.52001,.40782],[-76.89177,.24736],[-76.4094,.24015],[-76.41215,.38228],[-76.23441,.42294],[-75.82927,.09578],[-75.25764,-.11943],[-75.18513,-.0308],[-74.42701,-.50218],[-74.26675,-.97229],[-73.65312,-1.26222],[-72.92587,-2.44514],[-71.75223,-2.15058],[-70.94377,-2.23142],[-70.04609,-2.73906],[-70.71396,-3.7921],[-70.52393,-3.87553],[-70.3374,-3.79505],[-69.94708,-4.2431],[-69.43395,-1.42219],[-69.4215,-1.01853],[-69.59796,-.75136],[-69.603,-.51947],[-70.03658,-.19681],[-70.04162,.55437],[-69.47696,.71065],[-69.20976,.57958],[-69.14422,.84172],[-69.26017,1.06856],[-69.82987,1.07864],[-69.83491,1.69353],[-69.53746,1.76408],[-69.38621,1.70865],[-68.18128,1.72881],[-68.26699,1.83463],[-68.18632,2.00091],[-67.9292,1.82455],[-67.40488,2.22258],[-67.299,1.87494],[-67.15784,1.80439],[-67.08222,1.17441],[-66.85795,1.22998],[-67.21967,2.35778],[-67.65696,2.81691],[-67.85862,2.79173],[-67.85862,2.86727],[-67.30945,3.38393],[-67.50067,3.75812],[-67.62671,3.74303],[-67.85358,4.53249],[-67.83341,5.31104],[-67.59141,5.5369],[-67.63914,5.64963],[-67.58558,5.84537],[-67.43513,5.98835],[-67.4625,6.20625],[-67.60654,6.2891],[-69.41843,6.1072],[-70.10716,6.96516],[-70.7596,7.09799],[-71.03941,6.98163],[-71.37234,7.01588],[-71.42212,7.03854],[-71.44118,7.02116],[-71.82441,7.04314],[-72.04895,7.03837],[-72.19437,7.37034],[-72.43132,7.40034],[-72.47415,7.48928],[-72.45321,7.57232],[-72.47827,7.65604],[-72.46763,7.79518],[-72.44454,7.86031],[-72.46183,7.90682],[-72.45806,7.91141],[-72.47042,7.92306],[-72.48183,7.92909],[-72.48801,7.94329],[-72.47213,7.96106],[-72.39137,8.03534],[-72.35163,8.01163],[-72.36987,8.19976],[-72.4042,8.36513],[-72.65474,8.61428],[-72.77415,9.10165],[-72.94052,9.10663],[-73.02119,9.27584],[-73.36905,9.16636],[-72.98085,9.85253],[-72.88002,10.44309],[-72.4767,11.1117],[-72.24983,11.14138],[-71.9675,11.65536],[-71.3275,11.85],[-70.92579,11.96275],[-71.19849,12.65801]]]]}},{type:"Feature",properties:{iso1A2:"CP",iso1A3:"CPT",wikidata:"Q161258",nameEn:"Clipperton Island",country:"FR",groups:["EU","013","003","019","UN"],isoStatus:"excRes"},geometry:{type:"MultiPolygon",coordinates:[[[[-110.36279,9.79626],[-108.755,9.84085],[-109.04145,11.13245],[-110.36279,9.79626]]]]}},{type:"Feature",properties:{iso1A2:"CR",iso1A3:"CRI",iso1N3:"188",wikidata:"Q800",nameEn:"Costa Rica",groups:["013","003","419","019","UN"],callingCodes:["506"]},geometry:{type:"MultiPolygon",coordinates:[[[[-83.68276,11.01562],[-83.66597,10.79916],[-83.90838,10.71161],[-84.68197,11.07568],[-84.92439,10.9497],[-85.60529,11.22607],[-85.71223,11.06868],[-86.14524,11.09059],[-87.41779,5.02401],[-82.94503,7.93865],[-82.89978,8.04083],[-82.89137,8.05755],[-82.88641,8.10219],[-82.9388,8.26634],[-83.05209,8.33394],[-82.93056,8.43465],[-82.8679,8.44042],[-82.8382,8.48117],[-82.83322,8.52464],[-82.83975,8.54755],[-82.82739,8.60153],[-82.8794,8.6981],[-82.92068,8.74832],[-82.91377,8.774],[-82.88253,8.83331],[-82.72126,8.97125],[-82.93516,9.07687],[-82.93516,9.46741],[-82.84871,9.4973],[-82.87919,9.62645],[-82.77206,9.59573],[-82.66667,9.49746],[-82.61345,9.49881],[-82.56507,9.57279],[-82.51044,9.65379],[-83.54024,10.96805],[-83.68276,11.01562]]]]}},{type:"Feature",properties:{iso1A2:"CU",iso1A3:"CUB",iso1N3:"192",wikidata:"Q241",nameEn:"Cuba",groups:["029","003","419","019","UN"],callingCodes:["53"]},geometry:{type:"MultiPolygon",coordinates:[[[[-73.62304,20.6935],[-82.02215,24.23074],[-85.77883,21.92705],[-74.81171,18.82201],[-73.62304,20.6935]]]]}},{type:"Feature",properties:{iso1A2:"CV",iso1A3:"CPV",iso1N3:"132",wikidata:"Q1011",nameEn:"Cape Verde",groups:["Q105472","011","202","002","UN"],callingCodes:["238"]},geometry:{type:"MultiPolygon",coordinates:[[[[-28.81604,14.57305],[-20.39702,14.12816],[-23.37101,19.134],[-28.81604,14.57305]]]]}},{type:"Feature",properties:{iso1A2:"CW",iso1A3:"CUW",iso1N3:"531",wikidata:"Q25279",nameEn:"Cura\xE7ao",aliases:["NL-CW"],country:"NL",groups:["Q1451600","029","003","419","019","UN"],callingCodes:["599"]},geometry:{type:"MultiPolygon",coordinates:[[[[-68.90012,12.62309],[-69.59009,12.46019],[-68.99639,11.79035],[-68.33524,11.78151],[-68.90012,12.62309]]]]}},{type:"Feature",properties:{iso1A2:"CX",iso1A3:"CXR",iso1N3:"162",wikidata:"Q31063",nameEn:"Christmas Island",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[105.66835,-9.31927],[104.67494,-11.2566],[106.66176,-11.14349],[105.66835,-9.31927]]]]}},{type:"Feature",properties:{iso1A2:"CY",iso1A3:"CYP",iso1N3:"196",wikidata:"Q229",nameEn:"Republic of Cyprus",groups:["Q644636","EU","145","142","UN"],driveSide:"left",callingCodes:["357"]},geometry:{type:"MultiPolygon",coordinates:[[[[32.46489,35.48584],[30.15137,34.08517],[32.74412,34.43926],[32.75515,34.64985],[32.76136,34.68318],[32.79433,34.67883],[32.82717,34.70622],[32.86014,34.70585],[32.86167,34.68734],[32.9068,34.66102],[32.91398,34.67343],[32.93043,34.67091],[32.92807,34.66736],[32.93449,34.66241],[32.93693,34.67027],[32.94379,34.67111],[32.94683,34.67907],[32.95539,34.68471],[32.99135,34.68061],[32.98668,34.67268],[32.99014,34.65518],[32.97736,34.65277],[32.97079,34.66112],[32.95325,34.66462],[32.94796,34.6587],[32.94976,34.65204],[32.95471,34.64528],[32.95323,34.64075],[32.95891,34.62919],[32.96718,34.63446],[32.96968,34.64046],[33.0138,34.64424],[33.26744,34.49942],[33.83531,34.73974],[33.70575,34.97947],[33.70639,34.99303],[33.71514,35.00294],[33.69731,35.01754],[33.69938,35.03123],[33.67678,35.03866],[33.63765,35.03869],[33.61215,35.0527],[33.59658,35.03635],[33.567,35.04803],[33.57478,35.06049],[33.53975,35.08151],[33.48915,35.06594],[33.47666,35.00701],[33.45256,35.00288],[33.45178,35.02078],[33.47825,35.04103],[33.48136,35.0636],[33.46813,35.10564],[33.41675,35.16325],[33.4076,35.20062],[33.38575,35.2018],[33.37248,35.18698],[33.3717,35.1788],[33.36569,35.17479],[33.35612,35.17402],[33.35596,35.17942],[33.34964,35.17803],[33.35056,35.18328],[33.31955,35.18096],[33.3072,35.16816],[33.27068,35.16815],[33.15138,35.19504],[33.11105,35.15639],[33.08249,35.17319],[33.01192,35.15639],[32.94471,35.09422],[32.86406,35.1043],[32.85733,35.07742],[32.70779,35.14127],[32.70947,35.18328],[32.64864,35.19967],[32.60361,35.16647],[32.46489,35.48584]]],[[[33.74144,35.01053],[33.7492,35.01319],[33.74983,35.02274],[33.74265,35.02329],[33.73781,35.02181],[33.7343,35.01178],[33.74144,35.01053]]],[[[33.77312,34.9976],[33.75994,35.00113],[33.75682,34.99916],[33.76605,34.99543],[33.76738,34.99188],[33.7778,34.98981],[33.77843,34.988],[33.78149,34.98854],[33.78318,34.98699],[33.78571,34.98951],[33.78917,34.98854],[33.79191,34.98914],[33.78516,34.99582],[33.77553,34.99518],[33.77312,34.9976]]]]}},{type:"Feature",properties:{iso1A2:"CZ",iso1A3:"CZE",iso1N3:"203",wikidata:"Q213",nameEn:"Czechia",groups:["EU","151","150","UN"],callingCodes:["420"]},geometry:{type:"MultiPolygon",coordinates:[[[[14.82803,50.86966],[14.79139,50.81438],[14.70661,50.84096],[14.61993,50.86049],[14.63434,50.8883],[14.65259,50.90513],[14.64802,50.93241],[14.58024,50.91443],[14.56374,50.922],[14.59702,50.96148],[14.59908,50.98685],[14.58215,50.99306],[14.56432,51.01008],[14.53438,51.00374],[14.53321,51.01679],[14.49873,51.02242],[14.50809,51.0427],[14.49991,51.04692],[14.49154,51.04382],[14.49202,51.02286],[14.45827,51.03712],[14.41335,51.02086],[14.30098,51.05515],[14.25665,50.98935],[14.28776,50.97718],[14.32353,50.98556],[14.32793,50.97379],[14.30251,50.96606],[14.31422,50.95243],[14.39848,50.93866],[14.38691,50.89907],[14.30098,50.88448],[14.27123,50.89386],[14.24314,50.88761],[14.22331,50.86049],[14.02982,50.80662],[13.98864,50.8177],[13.89113,50.78533],[13.89444,50.74142],[13.82942,50.7251],[13.76316,50.73487],[13.70204,50.71771],[13.65977,50.73096],[13.52474,50.70394],[13.53748,50.67654],[13.5226,50.64721],[13.49742,50.63133],[13.46413,50.60102],[13.42189,50.61243],[13.37485,50.64931],[13.37805,50.627],[13.32264,50.60317],[13.32594,50.58009],[13.29454,50.57904],[13.25158,50.59268],[13.19043,50.50237],[13.13424,50.51709],[13.08301,50.50132],[13.0312,50.50944],[13.02038,50.4734],[13.02147,50.44763],[12.98433,50.42016],[12.94058,50.40944],[12.82465,50.45738],[12.73476,50.43237],[12.73044,50.42268],[12.70731,50.39948],[12.67261,50.41949],[12.51356,50.39694],[12.48747,50.37278],[12.49214,50.35228],[12.48256,50.34784],[12.46643,50.35527],[12.43722,50.33774],[12.43371,50.32506],[12.39924,50.32302],[12.40158,50.29521],[12.36594,50.28289],[12.35425,50.23993],[12.33263,50.24367],[12.32445,50.20442],[12.33847,50.19432],[12.32596,50.17146],[12.29232,50.17524],[12.28063,50.19544],[12.28755,50.22429],[12.23943,50.24594],[12.24791,50.25525],[12.26953,50.25189],[12.25119,50.27079],[12.20823,50.2729],[12.18013,50.32146],[12.10907,50.32041],[12.13716,50.27396],[12.09287,50.25032],[12.19335,50.19997],[12.21484,50.16399],[12.1917,50.13434],[12.2073,50.10315],[12.23709,50.10213],[12.27433,50.0771],[12.26111,50.06331],[12.30798,50.05719],[12.49908,49.97305],[12.47264,49.94222],[12.55197,49.92094],[12.48256,49.83575],[12.46603,49.78882],[12.40489,49.76321],[12.4462,49.70233],[12.52553,49.68415],[12.53544,49.61888],[12.56188,49.6146],[12.60155,49.52887],[12.64782,49.52565],[12.64121,49.47628],[12.669,49.42935],[12.71227,49.42363],[12.75854,49.3989],[12.78168,49.34618],[12.88414,49.33541],[12.88249,49.35479],[12.94859,49.34079],[13.03618,49.30417],[13.02957,49.27399],[13.05883,49.26259],[13.17665,49.16713],[13.17019,49.14339],[13.20405,49.12303],[13.23689,49.11412],[13.28242,49.1228],[13.39479,49.04812],[13.40802,48.98851],[13.50221,48.93752],[13.50552,48.97441],[13.58319,48.96899],[13.61624,48.9462],[13.67739,48.87886],[13.73854,48.88538],[13.76994,48.83537],[13.78977,48.83319],[13.8096,48.77877],[13.84023,48.76988],[14.06151,48.66873],[14.01482,48.63788],[14.09104,48.5943],[14.20691,48.5898],[14.33909,48.55852],[14.43076,48.58855],[14.4587,48.64695],[14.56139,48.60429],[14.60808,48.62881],[14.66762,48.58215],[14.71794,48.59794],[14.72756,48.69502],[14.80584,48.73489],[14.80821,48.77711],[14.81545,48.7874],[14.94773,48.76268],[14.95641,48.75915],[14.9758,48.76857],[14.98112,48.77524],[14.9782,48.7766],[14.98032,48.77959],[14.95072,48.79101],[14.98917,48.90082],[14.97612,48.96983],[14.99878,49.01444],[15.15534,48.99056],[15.16358,48.94278],[15.26177,48.95766],[15.28305,48.98831],[15.34823,48.98444],[15.48027,48.94481],[15.51357,48.91549],[15.61622,48.89541],[15.6921,48.85973],[15.75341,48.8516],[15.78087,48.87644],[15.84404,48.86921],[16.06034,48.75436],[16.37345,48.729],[16.40915,48.74576],[16.46134,48.80865],[16.67008,48.77699],[16.68518,48.7281],[16.71883,48.73806],[16.79779,48.70998],[16.90354,48.71541],[16.93955,48.60371],[17.00215,48.70887],[17.11202,48.82925],[17.19355,48.87602],[17.29054,48.85546],[17.3853,48.80936],[17.45671,48.85004],[17.5295,48.81117],[17.7094,48.86721],[17.73126,48.87885],[17.77944,48.92318],[17.87831,48.92679],[17.91814,49.01784],[18.06885,49.03157],[18.1104,49.08624],[18.15022,49.24518],[18.18456,49.28909],[18.36446,49.3267],[18.4139,49.36517],[18.4084,49.40003],[18.44686,49.39467],[18.54848,49.47059],[18.53063,49.49022],[18.57183,49.51162],[18.6144,49.49824],[18.67757,49.50895],[18.74761,49.492],[18.84521,49.51672],[18.84786,49.5446],[18.80479,49.6815],[18.72838,49.68163],[18.69817,49.70473],[18.62676,49.71983],[18.62943,49.74603],[18.62645,49.75002],[18.61368,49.75426],[18.61278,49.7618],[18.57183,49.83334],[18.60341,49.86256],[18.57045,49.87849],[18.57697,49.91565],[18.54299,49.92537],[18.54495,49.9079],[18.53423,49.89906],[18.41604,49.93498],[18.33562,49.94747],[18.33278,49.92415],[18.31914,49.91565],[18.27794,49.93863],[18.27107,49.96779],[18.21752,49.97309],[18.20241,49.99958],[18.10628,50.00223],[18.07898,50.04535],[18.03212,50.06574],[18.00396,50.04954],[18.04585,50.03311],[18.04585,50.01194],[18.00191,50.01723],[17.86886,49.97452],[17.77669,50.02253],[17.7506,50.07896],[17.6888,50.12037],[17.66683,50.10275],[17.59404,50.16437],[17.70528,50.18812],[17.76296,50.23382],[17.72176,50.25665],[17.74648,50.29966],[17.69292,50.32859],[17.67764,50.28977],[17.58889,50.27837],[17.3702,50.28123],[17.34548,50.2628],[17.34273,50.32947],[17.27681,50.32246],[17.19991,50.3654],[17.19579,50.38817],[17.14498,50.38117],[17.1224,50.39494],[16.89229,50.45117],[16.85933,50.41093],[16.90877,50.38642],[16.94448,50.31281],[16.99803,50.30316],[17.02138,50.27772],[16.99803,50.25753],[17.02825,50.23118],[17.00353,50.21449],[16.98018,50.24172],[16.8456,50.20834],[16.7014,50.09659],[16.63137,50.1142],[16.55446,50.16613],[16.56407,50.21009],[16.42674,50.32509],[16.39379,50.3207],[16.3622,50.34875],[16.36495,50.37679],[16.30289,50.38292],[16.28118,50.36891],[16.22821,50.41054],[16.21585,50.40627],[16.19526,50.43291],[16.31413,50.50274],[16.34572,50.49575],[16.44597,50.58041],[16.33611,50.66579],[16.23174,50.67101],[16.20839,50.63096],[16.10265,50.66405],[16.02437,50.60046],[15.98317,50.61528],[16.0175,50.63009],[15.97219,50.69799],[15.87331,50.67188],[15.81683,50.75666],[15.73186,50.73885],[15.43798,50.80833],[15.3803,50.77187],[15.36656,50.83956],[15.2773,50.8907],[15.27043,50.97724],[15.2361,50.99886],[15.1743,50.9833],[15.16744,51.01959],[15.11937,50.99021],[15.10152,51.01095],[15.06218,51.02269],[15.03895,51.0123],[15.02433,51.0242],[14.96419,50.99108],[15.01088,50.97984],[14.99852,50.86817],[14.82803,50.86966]]]]}},{type:"Feature",properties:{iso1A2:"DE",iso1A3:"DEU",iso1N3:"276",wikidata:"Q183",nameEn:"Germany",groups:["EU","155","150","UN"],callingCodes:["49"]},geometry:{type:"MultiPolygon",coordinates:[[[[8.70847,47.68904],[8.71773,47.69088],[8.70237,47.71453],[8.66416,47.71367],[8.67508,47.6979],[8.65769,47.68928],[8.66837,47.68437],[8.68985,47.69552],[8.70847,47.68904]]],[[[8.72617,47.69651],[8.72809,47.69282],[8.75856,47.68969],[8.79511,47.67462],[8.79966,47.70222],[8.76965,47.7075],[8.77309,47.72059],[8.80663,47.73821],[8.82002,47.71458],[8.86989,47.70504],[8.85065,47.68209],[8.87383,47.67045],[8.87625,47.65441],[8.89946,47.64769],[8.94093,47.65596],[9.02093,47.6868],[9.09891,47.67801],[9.13845,47.66389],[9.15181,47.66904],[9.1705,47.65513],[9.1755,47.65584],[9.17593,47.65399],[9.18203,47.65598],[9.25619,47.65939],[9.55125,47.53629],[9.72736,47.53457],[9.76748,47.5934],[9.80254,47.59419],[9.82591,47.58158],[9.8189,47.54688],[9.87499,47.52953],[9.87733,47.54688],[9.92407,47.53111],[9.96029,47.53899],[10.00003,47.48216],[10.03859,47.48927],[10.07131,47.45531],[10.09001,47.46005],[10.1052,47.4316],[10.06897,47.40709],[10.09819,47.35724],[10.11805,47.37228],[10.16362,47.36674],[10.17648,47.38889],[10.2127,47.38019],[10.22774,47.38904],[10.23757,47.37609],[10.19998,47.32832],[10.2147,47.31014],[10.17648,47.29149],[10.17531,47.27167],[10.23257,47.27088],[10.33424,47.30813],[10.39851,47.37623],[10.4324,47.38494],[10.4359,47.41183],[10.47446,47.43318],[10.46278,47.47901],[10.44291,47.48453],[10.4324,47.50111],[10.44992,47.5524],[10.43473,47.58394],[10.47329,47.58552],[10.48849,47.54057],[10.56912,47.53584],[10.60337,47.56755],[10.63456,47.5591],[10.68832,47.55752],[10.6965,47.54253],[10.7596,47.53228],[10.77596,47.51729],[10.88814,47.53701],[10.91268,47.51334],[10.86945,47.5015],[10.87061,47.4786],[10.90918,47.48571],[10.93839,47.48018],[10.92437,47.46991],[10.98513,47.42882],[10.97111,47.41617],[10.97111,47.39561],[11.11835,47.39719],[11.12536,47.41222],[11.20482,47.43198],[11.25157,47.43277],[11.22002,47.3964],[11.27844,47.39956],[11.29597,47.42566],[11.33804,47.44937],[11.4175,47.44621],[11.38128,47.47465],[11.4362,47.51413],[11.52618,47.50939],[11.58578,47.52281],[11.58811,47.55515],[11.60681,47.57881],[11.63934,47.59202],[11.84052,47.58354],[11.85572,47.60166],[12.0088,47.62451],[12.02282,47.61033],[12.05788,47.61742],[12.13734,47.60639],[12.17824,47.61506],[12.18145,47.61019],[12.17737,47.60121],[12.18568,47.6049],[12.20398,47.60667],[12.20801,47.61082],[12.19895,47.64085],[12.18507,47.65984],[12.18347,47.66663],[12.16769,47.68167],[12.16217,47.70105],[12.18303,47.70065],[12.22571,47.71776],[12.2542,47.7433],[12.26238,47.73544],[12.24017,47.69534],[12.26004,47.67725],[12.27991,47.68827],[12.336,47.69534],[12.37222,47.68433],[12.43883,47.6977],[12.44117,47.6741],[12.50076,47.62293],[12.53816,47.63553],[12.57438,47.63238],[12.6071,47.6741],[12.7357,47.6787],[12.77777,47.66689],[12.76492,47.64485],[12.82101,47.61493],[12.77427,47.58025],[12.80699,47.54477],[12.84672,47.54556],[12.85256,47.52741],[12.9624,47.47452],[12.98344,47.48716],[12.9998,47.46267],[13.04537,47.49426],[13.03252,47.53373],[13.05355,47.56291],[13.04537,47.58183],[13.06641,47.58577],[13.06407,47.60075],[13.09562,47.63304],[13.07692,47.68814],[13.01382,47.72116],[12.98578,47.7078],[12.92969,47.71094],[12.91333,47.7178],[12.90274,47.72513],[12.91711,47.74026],[12.9353,47.74788],[12.94371,47.76281],[12.93202,47.77302],[12.96311,47.79957],[12.98543,47.82896],[13.00588,47.84374],[12.94163,47.92927],[12.93886,47.94046],[12.93642,47.94436],[12.93419,47.94063],[12.92668,47.93879],[12.91985,47.94069],[12.9211,47.95135],[12.91683,47.95647],[12.87476,47.96195],[12.8549,48.01122],[12.76141,48.07373],[12.74973,48.10885],[12.7617,48.12796],[12.78595,48.12445],[12.80676,48.14979],[12.82673,48.15245],[12.8362,48.15876],[12.836,48.1647],[12.84475,48.16556],[12.87126,48.20318],[12.95306,48.20629],[13.02083,48.25689],[13.0851,48.27711],[13.126,48.27867],[13.18093,48.29577],[13.26039,48.29422],[13.30897,48.31575],[13.40709,48.37292],[13.43929,48.43386],[13.42527,48.45711],[13.45727,48.51092],[13.43695,48.55776],[13.45214,48.56472],[13.46967,48.55157],[13.50663,48.57506],[13.50131,48.58091],[13.51291,48.59023],[13.57535,48.55912],[13.59705,48.57013],[13.62508,48.55501],[13.65186,48.55092],[13.66113,48.53558],[13.72802,48.51208],[13.74816,48.53058],[13.7513,48.5624],[13.76921,48.55324],[13.80519,48.58026],[13.80038,48.59487],[13.82609,48.62345],[13.81901,48.6761],[13.81283,48.68426],[13.81791,48.69832],[13.79337,48.71375],[13.81863,48.73257],[13.82266,48.75544],[13.84023,48.76988],[13.8096,48.77877],[13.78977,48.83319],[13.76994,48.83537],[13.73854,48.88538],[13.67739,48.87886],[13.61624,48.9462],[13.58319,48.96899],[13.50552,48.97441],[13.50221,48.93752],[13.40802,48.98851],[13.39479,49.04812],[13.28242,49.1228],[13.23689,49.11412],[13.20405,49.12303],[13.17019,49.14339],[13.17665,49.16713],[13.05883,49.26259],[13.02957,49.27399],[13.03618,49.30417],[12.94859,49.34079],[12.88249,49.35479],[12.88414,49.33541],[12.78168,49.34618],[12.75854,49.3989],[12.71227,49.42363],[12.669,49.42935],[12.64121,49.47628],[12.64782,49.52565],[12.60155,49.52887],[12.56188,49.6146],[12.53544,49.61888],[12.52553,49.68415],[12.4462,49.70233],[12.40489,49.76321],[12.46603,49.78882],[12.48256,49.83575],[12.55197,49.92094],[12.47264,49.94222],[12.49908,49.97305],[12.30798,50.05719],[12.26111,50.06331],[12.27433,50.0771],[12.23709,50.10213],[12.2073,50.10315],[12.1917,50.13434],[12.21484,50.16399],[12.19335,50.19997],[12.09287,50.25032],[12.13716,50.27396],[12.10907,50.32041],[12.18013,50.32146],[12.20823,50.2729],[12.25119,50.27079],[12.26953,50.25189],[12.24791,50.25525],[12.23943,50.24594],[12.28755,50.22429],[12.28063,50.19544],[12.29232,50.17524],[12.32596,50.17146],[12.33847,50.19432],[12.32445,50.20442],[12.33263,50.24367],[12.35425,50.23993],[12.36594,50.28289],[12.40158,50.29521],[12.39924,50.32302],[12.43371,50.32506],[12.43722,50.33774],[12.46643,50.35527],[12.48256,50.34784],[12.49214,50.35228],[12.48747,50.37278],[12.51356,50.39694],[12.67261,50.41949],[12.70731,50.39948],[12.73044,50.42268],[12.73476,50.43237],[12.82465,50.45738],[12.94058,50.40944],[12.98433,50.42016],[13.02147,50.44763],[13.02038,50.4734],[13.0312,50.50944],[13.08301,50.50132],[13.13424,50.51709],[13.19043,50.50237],[13.25158,50.59268],[13.29454,50.57904],[13.32594,50.58009],[13.32264,50.60317],[13.37805,50.627],[13.37485,50.64931],[13.42189,50.61243],[13.46413,50.60102],[13.49742,50.63133],[13.5226,50.64721],[13.53748,50.67654],[13.52474,50.70394],[13.65977,50.73096],[13.70204,50.71771],[13.76316,50.73487],[13.82942,50.7251],[13.89444,50.74142],[13.89113,50.78533],[13.98864,50.8177],[14.02982,50.80662],[14.22331,50.86049],[14.24314,50.88761],[14.27123,50.89386],[14.30098,50.88448],[14.38691,50.89907],[14.39848,50.93866],[14.31422,50.95243],[14.30251,50.96606],[14.32793,50.97379],[14.32353,50.98556],[14.28776,50.97718],[14.25665,50.98935],[14.30098,51.05515],[14.41335,51.02086],[14.45827,51.03712],[14.49202,51.02286],[14.49154,51.04382],[14.49991,51.04692],[14.50809,51.0427],[14.49873,51.02242],[14.53321,51.01679],[14.53438,51.00374],[14.56432,51.01008],[14.58215,50.99306],[14.59908,50.98685],[14.59702,50.96148],[14.56374,50.922],[14.58024,50.91443],[14.64802,50.93241],[14.65259,50.90513],[14.63434,50.8883],[14.61993,50.86049],[14.70661,50.84096],[14.79139,50.81438],[14.82803,50.86966],[14.81664,50.88148],[14.89681,50.9422],[14.89252,50.94999],[14.92942,50.99744],[14.95529,51.04552],[14.97938,51.07742],[14.98229,51.11354],[14.99689,51.12205],[14.99079,51.14284],[14.99646,51.14365],[15.00083,51.14974],[14.99414,51.15813],[14.99311,51.16249],[15.0047,51.16874],[15.01242,51.21285],[15.04288,51.28387],[14.98008,51.33449],[14.96899,51.38367],[14.9652,51.44793],[14.94749,51.47155],[14.73219,51.52922],[14.72652,51.53902],[14.73047,51.54606],[14.71125,51.56209],[14.7727,51.61263],[14.75759,51.62318],[14.75392,51.67445],[14.69065,51.70842],[14.66386,51.73282],[14.64625,51.79472],[14.60493,51.80473],[14.59089,51.83302],[14.6588,51.88359],[14.6933,51.9044],[14.70601,51.92944],[14.7177,51.94048],[14.72163,51.95188],[14.71836,51.95606],[14.7139,51.95643],[14.70488,51.97679],[14.71339,52.00337],[14.76026,52.06624],[14.72971,52.09167],[14.6917,52.10283],[14.67683,52.13936],[14.70616,52.16927],[14.68344,52.19612],[14.71319,52.22144],[14.70139,52.25038],[14.58149,52.28007],[14.56378,52.33838],[14.55228,52.35264],[14.54423,52.42568],[14.63056,52.48993],[14.60081,52.53116],[14.6289,52.57136],[14.61073,52.59847],[14.22071,52.81175],[14.13806,52.82392],[14.12256,52.84311],[14.15873,52.87715],[14.14056,52.95786],[14.25954,53.00264],[14.35044,53.05829],[14.38679,53.13669],[14.36696,53.16444],[14.37853,53.20405],[14.40662,53.21098],[14.45125,53.26241],[14.44133,53.27427],[14.4215,53.27724],[14.35209,53.49506],[14.3273,53.50587],[14.30416,53.55499],[14.31904,53.61581],[14.2853,53.63392],[14.28477,53.65955],[14.27133,53.66613],[14.2836,53.67721],[14.26782,53.69866],[14.27249,53.74464],[14.21323,53.8664],[14.20823,53.90776],[14.18544,53.91258],[14.20647,53.91671],[14.22634,53.9291],[14.20811,54.12784],[13.93395,54.84044],[12.85844,54.82438],[11.90309,54.38543],[11.00303,54.63689],[10.31111,54.65968],[10.16755,54.73883],[9.89314,54.84171],[9.73563,54.8247],[9.61187,54.85548],[9.62734,54.88057],[9.58937,54.88785],[9.4659,54.83131],[9.43155,54.82586],[9.41213,54.84254],[9.38532,54.83968],[9.36496,54.81749],[9.33849,54.80233],[9.32771,54.80602],[9.2474,54.8112],[9.23445,54.83432],[9.24631,54.84726],[9.20571,54.85841],[9.14275,54.87421],[9.04629,54.87249],[8.92795,54.90452],[8.81178,54.90518],[8.76387,54.8948],[8.63979,54.91069],[8.55769,54.91837],[8.45719,55.06747],[8.02459,55.09613],[5.45168,54.20039],[6.91025,53.44221],[7.00198,53.32672],[7.19052,53.31866],[7.21679,53.20058],[7.22681,53.18165],[7.17898,53.13817],[7.21694,53.00742],[7.07253,52.81083],[7.04557,52.63318],[6.77307,52.65375],[6.71641,52.62905],[6.69507,52.488],[6.94293,52.43597],[6.99041,52.47235],[7.03417,52.40237],[7.07044,52.37805],[7.02703,52.27941],[7.06365,52.23789],[7.03729,52.22695],[6.9897,52.2271],[6.97189,52.20329],[6.83984,52.11728],[6.76117,52.11895],[6.68128,52.05052],[6.83035,51.9905],[6.82357,51.96711],[6.72319,51.89518],[6.68386,51.91861],[6.58556,51.89386],[6.50231,51.86313],[6.47179,51.85395],[6.38815,51.87257],[6.40704,51.82771],[6.30593,51.84998],[6.29872,51.86801],[6.21443,51.86801],[6.15349,51.90439],[6.11551,51.89769],[6.16902,51.84094],[6.10337,51.84829],[6.06705,51.86136],[5.99848,51.83195],[5.94568,51.82786],[5.98665,51.76944],[5.95003,51.7493],[6.04091,51.71821],[6.02767,51.6742],[6.11759,51.65609],[6.09055,51.60564],[6.18017,51.54096],[6.21724,51.48568],[6.20654,51.40049],[6.22641,51.39948],[6.22674,51.36135],[6.16977,51.33169],[6.07889,51.24432],[6.07889,51.17038],[6.17384,51.19589],[6.16706,51.15677],[5.98292,51.07469],[5.9541,51.03496],[5.9134,51.06736],[5.86735,51.05182],[5.87849,51.01969],[5.90493,51.00198],[5.90296,50.97356],[5.95282,50.98728],[6.02697,50.98303],[6.01615,50.93367],[6.09297,50.92066],[6.07486,50.89307],[6.08805,50.87223],[6.07693,50.86025],[6.07431,50.84674],[6.05702,50.85179],[6.05623,50.8572],[6.01921,50.84435],[6.02328,50.81694],[6.00462,50.80065],[5.98404,50.80988],[5.97497,50.79992],[6.02624,50.77453],[6.01976,50.75398],[6.03889,50.74618],[6.0326,50.72647],[6.0406,50.71848],[6.04428,50.72861],[6.11707,50.72231],[6.17852,50.6245],[6.26957,50.62444],[6.2476,50.60392],[6.24888,50.59869],[6.24005,50.58732],[6.22581,50.5907],[6.20281,50.56952],[6.17739,50.55875],[6.17802,50.54179],[6.19735,50.53576],[6.19579,50.5313],[6.18716,50.52653],[6.19193,50.5212],[6.20599,50.52089],[6.22335,50.49578],[6.26637,50.50272],[6.30809,50.50058],[6.3465,50.48833],[6.34005,50.46083],[6.37219,50.45397],[6.36852,50.40776],[6.34406,50.37994],[6.3688,50.35898],[6.40785,50.33557],[6.40641,50.32425],[6.35701,50.31139],[6.32488,50.32333],[6.29949,50.30887],[6.28797,50.27458],[6.208,50.25179],[6.16853,50.2234],[6.18364,50.20815],[6.18739,50.1822],[6.14588,50.17106],[6.14132,50.14971],[6.15298,50.14126],[6.1379,50.12964],[6.12055,50.09171],[6.11274,50.05916],[6.13458,50.04141],[6.13044,50.02929],[6.14666,50.02207],[6.13794,50.01466],[6.13273,50.02019],[6.1295,50.01849],[6.13806,50.01056],[6.14948,50.00908],[6.14147,49.99563],[6.1701,49.98518],[6.16466,49.97086],[6.17872,49.9537],[6.18554,49.95622],[6.18045,49.96611],[6.19089,49.96991],[6.19856,49.95053],[6.22094,49.94955],[6.22608,49.929],[6.21882,49.92403],[6.22926,49.92096],[6.23496,49.89972],[6.26146,49.88203],[6.28874,49.87592],[6.29692,49.86685],[6.30963,49.87021],[6.32303,49.85133],[6.32098,49.83728],[6.33585,49.83785],[6.34267,49.84974],[6.36576,49.85032],[6.40022,49.82029],[6.42521,49.81591],[6.42905,49.81091],[6.44131,49.81443],[6.45425,49.81164],[6.47111,49.82263],[6.48718,49.81267],[6.50647,49.80916],[6.51215,49.80124],[6.52121,49.81338],[6.53122,49.80666],[6.52169,49.79787],[6.50534,49.78952],[6.51669,49.78336],[6.51056,49.77515],[6.51828,49.76855],[6.51646,49.75961],[6.50174,49.75292],[6.50193,49.73291],[6.51805,49.72425],[6.51397,49.72058],[6.50261,49.72718],[6.49535,49.72645],[6.49694,49.72205],[6.5042,49.71808],[6.50647,49.71353],[6.49785,49.71118],[6.48014,49.69767],[6.46048,49.69092],[6.44654,49.67799],[6.42937,49.66857],[6.42726,49.66078],[6.43768,49.66021],[6.4413,49.65722],[6.41861,49.61723],[6.39822,49.60081],[6.385,49.59946],[6.37464,49.58886],[6.38342,49.5799],[6.38024,49.57593],[6.36676,49.57813],[6.35825,49.57053],[6.38228,49.55855],[6.38072,49.55171],[6.35666,49.52931],[6.36788,49.50377],[6.36907,49.48931],[6.36778,49.46937],[6.38352,49.46463],[6.39168,49.4667],[6.40274,49.46546],[6.42432,49.47683],[6.55404,49.42464],[6.533,49.40748],[6.60091,49.36864],[6.58807,49.35358],[6.572,49.35027],[6.60186,49.31055],[6.66583,49.28065],[6.69274,49.21661],[6.71843,49.2208],[6.73256,49.20486],[6.71137,49.18808],[6.73765,49.16375],[6.78265,49.16793],[6.83385,49.15162],[6.84703,49.15734],[6.86225,49.18185],[6.85016,49.19354],[6.85119,49.20038],[6.83555,49.21249],[6.85939,49.22376],[6.89298,49.20863],[6.91875,49.22261],[6.93831,49.2223],[6.94028,49.21641],[6.95963,49.203],[6.97273,49.2099],[7.01318,49.19018],[7.03459,49.19096],[7.0274,49.17042],[7.03178,49.15734],[7.04662,49.13724],[7.04409,49.12123],[7.04843,49.11422],[7.05548,49.11185],[7.06642,49.11415],[7.07162,49.1255],[7.09007,49.13094],[7.07859,49.15031],[7.10715,49.15631],[7.10384,49.13787],[7.12504,49.14253],[7.1358,49.1282],[7.1593,49.1204],[7.23473,49.12971],[7.29514,49.11426],[7.3195,49.14231],[7.35995,49.14399],[7.3662,49.17308],[7.44052,49.18354],[7.44455,49.16765],[7.49473,49.17],[7.49172,49.13915],[7.53012,49.09818],[7.56416,49.08136],[7.62575,49.07654],[7.63618,49.05428],[7.75948,49.04562],[7.79557,49.06583],[7.86386,49.03499],[7.93641,49.05544],[7.97783,49.03161],[8.14189,48.97833],[8.22604,48.97352],[8.20031,48.95856],[8.19989,48.95825],[8.12813,48.87985],[8.10253,48.81829],[8.06802,48.78957],[8.0326,48.79017],[8.01534,48.76085],[7.96994,48.75606],[7.96812,48.72491],[7.89002,48.66317],[7.84098,48.64217],[7.80057,48.5857],[7.80167,48.54758],[7.80647,48.51239],[7.76833,48.48945],[7.73109,48.39192],[7.74562,48.32736],[7.69022,48.30018],[7.6648,48.22219],[7.57137,48.12292],[7.56966,48.03265],[7.62302,47.97898],[7.55673,47.87371],[7.52921,47.77747],[7.54761,47.72912],[7.53722,47.71635],[7.51266,47.70197],[7.51915,47.68335],[7.52067,47.66437],[7.53384,47.65115],[7.5591,47.63849],[7.57423,47.61628],[7.58851,47.60794],[7.59301,47.60058],[7.58945,47.59017],[7.60523,47.58519],[7.60459,47.57869],[7.61929,47.57683],[7.64309,47.59151],[7.64213,47.5944],[7.64599,47.59695],[7.67395,47.59212],[7.68229,47.59905],[7.69385,47.60099],[7.68486,47.59601],[7.67115,47.5871],[7.68904,47.57133],[7.67655,47.56435],[7.63338,47.56256],[7.65083,47.54662],[7.66174,47.54554],[7.6656,47.53752],[7.68101,47.53232],[7.69642,47.53297],[7.71961,47.54219],[7.75261,47.54599],[7.79486,47.55691],[7.81901,47.58798],[7.84412,47.5841],[7.88664,47.58854],[7.90673,47.57674],[7.91251,47.55031],[7.94494,47.54511],[7.95682,47.55789],[7.97581,47.55493],[8.00113,47.55616],[8.02136,47.55096],[8.04383,47.55443],[8.06663,47.56374],[8.08557,47.55768],[8.10002,47.56504],[8.10395,47.57918],[8.11543,47.5841],[8.13662,47.58432],[8.13823,47.59147],[8.14947,47.59558],[8.1652,47.5945],[8.19378,47.61636],[8.20617,47.62141],[8.22011,47.6181],[8.22577,47.60385],[8.23809,47.61204],[8.25863,47.61571],[8.26313,47.6103],[8.2824,47.61225],[8.29722,47.60603],[8.29524,47.5919],[8.30277,47.58607],[8.32735,47.57133],[8.35512,47.57014],[8.38273,47.56608],[8.39477,47.57826],[8.43235,47.56617],[8.49431,47.58107],[8.48949,47.588],[8.46637,47.58389],[8.45578,47.60121],[8.50747,47.61897],[8.51686,47.63476],[8.55756,47.62394],[8.57586,47.59537],[8.60348,47.61204],[8.59545,47.64298],[8.60701,47.65271],[8.61471,47.64514],[8.60412,47.63735],[8.62049,47.63757],[8.62884,47.65098],[8.61113,47.66332],[8.6052,47.67258],[8.57683,47.66158],[8.56141,47.67088],[8.52801,47.66059],[8.5322,47.64687],[8.49656,47.64709],[8.46605,47.64103],[8.4667,47.65747],[8.44711,47.65379],[8.42264,47.66667],[8.41346,47.66676],[8.40473,47.67499],[8.4211,47.68407],[8.40569,47.69855],[8.44807,47.72426],[8.45771,47.7493],[8.48868,47.77215],[8.56814,47.78001],[8.56415,47.80633],[8.61657,47.79998],[8.62408,47.7626],[8.64425,47.76398],[8.65292,47.80066],[8.68022,47.78599],[8.68985,47.75686],[8.71778,47.76571],[8.74251,47.75168],[8.70543,47.73121],[8.73671,47.7169],[8.72617,47.69651]]]]}},{type:"Feature",properties:{iso1A2:"DG",iso1A3:"DGA",wikidata:"Q184851",nameEn:"Diego Garcia",country:"GB",groups:["IO","BOTS","014","202","002","UN"],isoStatus:"excRes",callingCodes:["246"]},geometry:{type:"MultiPolygon",coordinates:[[[[73.14823,-7.76302],[73.09982,-6.07324],[71.43792,-7.73904],[73.14823,-7.76302]]]]}},{type:"Feature",properties:{iso1A2:"DJ",iso1A3:"DJI",iso1N3:"262",wikidata:"Q977",nameEn:"Djibouti",groups:["014","202","002","UN"],callingCodes:["253"]},geometry:{type:"MultiPolygon",coordinates:[[[[43.90659,12.3823],[43.90659,12.3823],[43.32909,12.59711],[43.29075,12.79154],[42.86195,12.58747],[42.7996,12.42629],[42.6957,12.36201],[42.46941,12.52661],[42.4037,12.46478],[41.95461,11.81157],[41.82878,11.72361],[41.77727,11.49902],[41.8096,11.33606],[41.80056,10.97127],[42.06302,10.92599],[42.13691,10.97586],[42.42669,10.98493],[42.62989,11.09711],[42.75111,11.06992],[42.79037,10.98493],[42.95776,10.98533],[43.90659,12.3823]]]]}},{type:"Feature",properties:{iso1A2:"DK",iso1A3:"DNK",iso1N3:"208",wikidata:"Q756617",nameEn:"Kingdom of Denmark"},geometry:null},{type:"Feature",properties:{iso1A2:"DM",iso1A3:"DMA",iso1N3:"212",wikidata:"Q784",nameEn:"Dominica",groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 767"]},geometry:{type:"MultiPolygon",coordinates:[[[[-61.32485,14.91445],[-60.86656,15.82603],[-61.95646,15.5094],[-61.32485,14.91445]]]]}},{type:"Feature",properties:{iso1A2:"DO",iso1A3:"DOM",iso1N3:"214",wikidata:"Q786",nameEn:"Dominican Republic",groups:["029","003","419","019","UN"],callingCodes:["1 809","1 829","1 849"]},geometry:{type:"MultiPolygon",coordinates:[[[[-67.87844,21.7938],[-72.38946,20.27111],[-71.77419,19.73128],[-71.75865,19.70231],[-71.7429,19.58445],[-71.71449,19.55364],[-71.71268,19.53374],[-71.6802,19.45008],[-71.69448,19.37866],[-71.77766,19.33823],[-71.73229,19.26686],[-71.62642,19.21212],[-71.65337,19.11759],[-71.69938,19.10916],[-71.71088,19.08353],[-71.74088,19.0437],[-71.88102,18.95007],[-71.77766,18.95007],[-71.72624,18.87802],[-71.71885,18.78423],[-71.82556,18.62551],[-71.95412,18.64939],[-72.00201,18.62312],[-71.88102,18.50125],[-71.90875,18.45821],[-71.69952,18.34101],[-71.78271,18.18302],[-71.75465,18.14405],[-71.74994,18.11115],[-71.73783,18.07177],[-71.75671,18.03456],[-72.29523,17.48026],[-68.39466,16.14167],[-67.87844,21.7938]]]]}},{type:"Feature",properties:{iso1A2:"DZ",iso1A3:"DZA",iso1N3:"012",wikidata:"Q262",nameEn:"Algeria",groups:["015","002","UN"],callingCodes:["213"]},geometry:{type:"MultiPolygon",coordinates:[[[[8.59123,37.14286],[5.10072,39.89531],[-2.27707,35.35051],[-2.21248,35.08532],[-2.21445,35.04378],[-2.04734,34.93218],[-1.97833,34.93218],[-1.97469,34.886],[-1.73707,34.74226],[-1.84569,34.61907],[-1.69788,34.48056],[-1.78042,34.39018],[-1.64666,34.10405],[-1.73494,33.71721],[-1.59508,33.59929],[-1.67067,33.27084],[-1.46249,33.0499],[-1.54244,32.95499],[-1.37794,32.73628],[-.9912,32.52467],[-1.24998,32.32993],[-1.24453,32.1917],[-1.15735,32.12096],[-1.22829,32.07832],[-2.46166,32.16603],[-2.93873,32.06557],[-2.82784,31.79459],[-3.66314,31.6339],[-3.66386,31.39202],[-3.77647,31.31912],[-3.77103,31.14984],[-3.54944,31.0503],[-3.65418,30.85566],[-3.64735,30.67539],[-4.31774,30.53229],[-4.6058,30.28343],[-5.21671,29.95253],[-5.58831,29.48103],[-5.72121,29.52322],[-5.75616,29.61407],[-6.69965,29.51623],[-6.78351,29.44634],[-6.95824,29.50924],[-7.61585,29.36252],[-8.6715,28.71194],[-8.66879,27.6666],[-8.66674,27.31569],[-4.83423,24.99935],[1.15698,21.12843],[1.20992,20.73533],[3.24648,19.81703],[3.12501,19.1366],[3.36082,18.9745],[4.26651,19.14224],[5.8153,19.45101],[7.38361,20.79165],[7.48273,20.87258],[11.96886,23.51735],[11.62498,24.26669],[11.41061,24.21456],[10.85323,24.5595],[10.33159,24.5465],[10.02432,24.98124],[10.03146,25.35635],[9.38834,26.19288],[9.51696,26.39148],[9.89569,26.57696],[9.78136,29.40961],[9.3876,30.16738],[9.55544,30.23971],[9.07483,32.07865],[8.35999,32.50101],[8.31895,32.83483],[8.1179,33.05086],[8.11433,33.10175],[7.83028,33.18851],[7.73687,33.42114],[7.54088,33.7726],[7.52851,34.06493],[7.66174,34.20167],[7.74207,34.16492],[7.81242,34.21841],[7.86264,34.3987],[8.20482,34.57575],[8.29655,34.72798],[8.25189,34.92009],[8.30727,34.95378],[8.3555,35.10007],[8.47318,35.23376],[8.30329,35.29884],[8.36086,35.47774],[8.35371,35.66373],[8.26472,35.73669],[8.2626,35.91733],[8.40731,36.42208],[8.18936,36.44939],[8.16167,36.48817],[8.47609,36.66607],[8.46537,36.7706],[8.57613,36.78062],[8.67706,36.8364],[8.62972,36.86499],[8.64044,36.9401],[8.59123,37.14286]]]]}},{type:"Feature",properties:{iso1A2:"EA",wikidata:"Q28868874",nameEn:"Ceuta, Melilla",country:"ES",level:"territory",isoStatus:"excRes"},geometry:null},{type:"Feature",properties:{iso1A2:"EC",iso1A3:"ECU",iso1N3:"218",wikidata:"Q736",nameEn:"Ecuador"},geometry:null},{type:"Feature",properties:{iso1A2:"EE",iso1A3:"EST",iso1N3:"233",wikidata:"Q191",nameEn:"Estonia",aliases:["EW"],groups:["EU","154","150","UN"],callingCodes:["372"]},geometry:{type:"MultiPolygon",coordinates:[[[[26.32936,60.00121],[20.5104,59.15546],[19.84909,57.57876],[22.80496,57.87798],[23.20055,57.56697],[24.26221,57.91787],[24.3579,57.87471],[25.19484,58.0831],[25.28237,57.98539],[25.29581,58.08288],[25.73499,57.90193],[26.05949,57.84744],[26.0324,57.79037],[26.02456,57.78342],[26.027,57.78158],[26.0266,57.77441],[26.02069,57.77169],[26.02415,57.76865],[26.03332,57.7718],[26.0543,57.76105],[26.08098,57.76619],[26.2029,57.7206],[26.1866,57.6849],[26.29253,57.59244],[26.46527,57.56885],[26.54675,57.51813],[26.90364,57.62823],[27.34698,57.52242],[27.31919,57.57672],[27.40393,57.62125],[27.3746,57.66834],[27.52615,57.72843],[27.50171,57.78842],[27.56689,57.83356],[27.78526,57.83963],[27.81841,57.89244],[27.67282,57.92627],[27.62393,58.09462],[27.48541,58.22615],[27.55489,58.39525],[27.36366,58.78381],[27.74429,58.98351],[27.80482,59.1116],[27.87978,59.18097],[27.90911,59.24353],[28.00689,59.28351],[28.14215,59.28934],[28.19284,59.35791],[28.20537,59.36491],[28.21137,59.38058],[28.19061,59.39962],[28.04187,59.47017],[27.85643,59.58538],[26.90044,59.63819],[26.32936,60.00121]]]]}},{type:"Feature",properties:{iso1A2:"EG",iso1A3:"EGY",iso1N3:"818",wikidata:"Q79",nameEn:"Egypt",groups:["015","002","UN"],callingCodes:["20"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.62659,31.82938],[26.92891,33.39516],[24.8458,31.39877],[25.01077,30.73861],[24.71117,30.17441],[24.99968,29.24574],[24.99885,21.99535],[33.17563,22.00405],[34.0765,22.00501],[37.8565,22.00903],[34.4454,27.91479],[34.8812,29.36878],[34.92298,29.45305],[34.26742,31.21998],[34.24012,31.29591],[34.23572,31.2966],[34.21853,31.32363],[34.052,31.46619],[33.62659,31.82938]]]]}},{type:"Feature",properties:{iso1A2:"EH",iso1A3:"ESH",iso1N3:"732",wikidata:"Q6250",nameEn:"Western Sahara",groups:["015","002"],callingCodes:["212"]},geometry:{type:"MultiPolygon",coordinates:[[[[-8.66879,27.6666],[-8.77527,27.66663],[-8.71787,26.9898],[-9.08698,26.98639],[-9.56957,26.90042],[-9.81998,26.71379],[-10.68417,26.90984],[-11.35695,26.8505],[-11.23622,26.72023],[-11.38635,26.611],[-11.62052,26.05229],[-12.06001,26.04442],[-12.12281,25.13682],[-12.92147,24.39502],[-13.00628,24.01923],[-13.75627,23.77231],[-14.10361,22.75501],[-14.1291,22.41636],[-14.48112,22.00886],[-14.47329,21.63839],[-14.78487,21.36587],[-16.44269,21.39745],[-16.9978,21.36239],[-17.02707,21.34022],[-17.21511,21.34226],[-17.35589,20.80492],[-17.0471,20.76408],[-17.0695,20.85742],[-17.06781,20.92697],[-17.0396,20.9961],[-17.0357,21.05368],[-16.99806,21.12142],[-16.95474,21.33997],[-13.01525,21.33343],[-13.08438,22.53866],[-13.15313,22.75649],[-13.10753,22.89493],[-13.00412,23.02297],[-12.5741,23.28975],[-12.36213,23.3187],[-12.14969,23.41935],[-12.00251,23.4538],[-12.0002,25.9986],[-8.66721,25.99918],[-8.66674,27.31569],[-8.66879,27.6666]]]]}},{type:"Feature",properties:{iso1A2:"ER",iso1A3:"ERI",iso1N3:"232",wikidata:"Q986",nameEn:"Eritrea",groups:["014","202","002","UN"],callingCodes:["291"]},geometry:{type:"MultiPolygon",coordinates:[[[[40.99158,15.81743],[39.63762,18.37348],[38.57727,17.98125],[38.45916,17.87167],[38.37133,17.66269],[38.13362,17.53906],[37.50967,17.32199],[37.42694,17.04041],[36.99777,17.07172],[36.92193,16.23451],[36.76371,15.80831],[36.69761,15.75323],[36.54276,15.23478],[36.44337,15.14963],[36.54376,14.25597],[36.56536,14.26177],[36.55659,14.28237],[36.63364,14.31172],[36.85787,14.32201],[37.01622,14.2561],[37.09486,14.27155],[37.13206,14.40746],[37.3106,14.44657],[37.47319,14.2149],[37.528,14.18413],[37.91287,14.89447],[38.0364,14.72745],[38.25562,14.67287],[38.3533,14.51323],[38.45748,14.41445],[38.78306,14.4754],[38.98058,14.54895],[39.02834,14.63717],[39.16074,14.65187],[39.14772,14.61827],[39.19547,14.56996],[39.23888,14.56365],[39.26927,14.48801],[39.2302,14.44598],[39.2519,14.40393],[39.37685,14.54402],[39.52756,14.49011],[39.50585,14.55735],[39.58182,14.60987],[39.76632,14.54264],[39.9443,14.41024],[40.07236,14.54264],[40.14649,14.53969],[40.21128,14.39342],[40.25686,14.41445],[40.9167,14.11152],[41.25097,13.60787],[41.62864,13.38626],[42.05841,12.80912],[42.21469,12.75832],[42.2798,12.6355],[42.4037,12.46478],[42.46941,12.52661],[42.6957,12.36201],[42.7996,12.42629],[42.86195,12.58747],[43.29075,12.79154],[40.99158,15.81743]]]]}},{type:"Feature",properties:{iso1A2:"ES",iso1A3:"ESP",iso1N3:"724",wikidata:"Q29",nameEn:"Spain"},geometry:null},{type:"Feature",properties:{iso1A2:"ET",iso1A3:"ETH",iso1N3:"231",wikidata:"Q115",nameEn:"Ethiopia",groups:["014","202","002","UN"],callingCodes:["251"]},geometry:{type:"MultiPolygon",coordinates:[[[[42.4037,12.46478],[42.2798,12.6355],[42.21469,12.75832],[42.05841,12.80912],[41.62864,13.38626],[41.25097,13.60787],[40.9167,14.11152],[40.25686,14.41445],[40.21128,14.39342],[40.14649,14.53969],[40.07236,14.54264],[39.9443,14.41024],[39.76632,14.54264],[39.58182,14.60987],[39.50585,14.55735],[39.52756,14.49011],[39.37685,14.54402],[39.2519,14.40393],[39.2302,14.44598],[39.26927,14.48801],[39.23888,14.56365],[39.19547,14.56996],[39.14772,14.61827],[39.16074,14.65187],[39.02834,14.63717],[38.98058,14.54895],[38.78306,14.4754],[38.45748,14.41445],[38.3533,14.51323],[38.25562,14.67287],[38.0364,14.72745],[37.91287,14.89447],[37.528,14.18413],[37.47319,14.2149],[37.3106,14.44657],[37.13206,14.40746],[37.09486,14.27155],[37.01622,14.2561],[36.85787,14.32201],[36.63364,14.31172],[36.55659,14.28237],[36.56536,14.26177],[36.54376,14.25597],[36.44653,13.95666],[36.48824,13.83954],[36.38993,13.56459],[36.24545,13.36759],[36.13374,12.92665],[36.16651,12.88019],[36.14268,12.70879],[36.01458,12.72478],[35.70476,12.67101],[35.24302,11.91132],[35.11492,11.85156],[35.05832,11.71158],[35.09556,11.56278],[34.95704,11.24448],[35.01215,11.19626],[34.93172,10.95946],[34.97789,10.91559],[34.97491,10.86147],[34.86916,10.78832],[34.86618,10.74588],[34.77532,10.69027],[34.77383,10.74588],[34.59062,10.89072],[34.4372,10.781],[34.2823,10.53508],[34.34783,10.23914],[34.32102,10.11599],[34.22718,10.02506],[34.20484,9.9033],[34.13186,9.7492],[34.08717,9.55243],[34.10229,9.50238],[34.14304,9.04654],[34.14453,8.60204],[34.01346,8.50041],[33.89579,8.4842],[33.87195,8.41938],[33.71407,8.3678],[33.66938,8.44442],[33.54575,8.47094],[33.3119,8.45474],[33.19721,8.40317],[33.1853,8.29264],[33.18083,8.13047],[33.08401,8.05822],[33.0006,7.90333],[33.04944,7.78989],[33.24637,7.77939],[33.32531,7.71297],[33.44745,7.7543],[33.71407,7.65983],[33.87642,7.5491],[34.02984,7.36449],[34.03878,7.27437],[34.01495,7.25664],[34.19369,7.12807],[34.19369,7.04382],[34.35753,6.91963],[34.47669,6.91076],[34.53925,6.82794],[34.53776,6.74808],[34.65096,6.72589],[34.77459,6.5957],[34.87736,6.60161],[35.01738,6.46991],[34.96227,6.26415],[35.00546,5.89387],[35.12611,5.68937],[35.13058,5.62118],[35.31188,5.50106],[35.29938,5.34042],[35.50792,5.42431],[35.8576,5.33413],[35.81968,5.10757],[35.82118,4.77382],[35.9419,4.61933],[35.95449,4.53244],[36.03924,4.44406],[36.84474,4.44518],[37.07724,4.33503],[38.14168,3.62487],[38.45812,3.60445],[38.52336,3.62551],[38.91938,3.51198],[39.07736,3.5267],[39.19954,3.47834],[39.49444,3.45521],[39.51551,3.40895],[39.55132,3.39634],[39.58339,3.47434],[39.76808,3.67058],[39.86043,3.86974],[40.77498,4.27683],[41.1754,3.94079],[41.89488,3.97375],[42.07619,4.17667],[42.55853,4.20518],[42.84526,4.28357],[42.97746,4.44032],[43.04177,4.57923],[43.40263,4.79289],[44.02436,4.9451],[44.98104,4.91821],[47.97917,8.00124],[47.92477,8.00111],[46.99339,7.9989],[44.19222,8.93028],[43.32613,9.59205],[43.23518,9.84605],[43.0937,9.90579],[42.87643,10.18441],[42.69452,10.62672],[42.95776,10.98533],[42.79037,10.98493],[42.75111,11.06992],[42.62989,11.09711],[42.42669,10.98493],[42.13691,10.97586],[42.06302,10.92599],[41.80056,10.97127],[41.8096,11.33606],[41.77727,11.49902],[41.82878,11.72361],[41.95461,11.81157],[42.4037,12.46478]]]]}},{type:"Feature",properties:{iso1A2:"EU",iso1A3:"EUE",wikidata:"Q458",nameEn:"European Union",level:"union",isoStatus:"excRes"},geometry:null},{type:"Feature",properties:{iso1A2:"FI",iso1A3:"FIN",iso1N3:"246",wikidata:"Q33",nameEn:"Finland",aliases:["SF"]},geometry:null},{type:"Feature",properties:{iso1A2:"FJ",iso1A3:"FJI",iso1N3:"242",wikidata:"Q712",nameEn:"Fiji",groups:["054","009","UN"],driveSide:"left",callingCodes:["679"]},geometry:{type:"MultiPolygon",coordinates:[[[[174.245,-23.1974],[179.99999,-22.5],[179.99999,-11.5],[174,-11.5],[174.245,-23.1974]]],[[[-176.76826,-14.95183],[-180,-14.96041],[-180,-22.90585],[-176.74538,-22.89767],[-176.76826,-14.95183]]]]}},{type:"Feature",properties:{iso1A2:"FK",iso1A3:"FLK",iso1N3:"238",wikidata:"Q9648",nameEn:"Falkland Islands",country:"GB",groups:["BOTS","005","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["500"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.67376,-55.11859],[-54.56126,-51.26248],[-61.26735,-50.63919],[-63.67376,-55.11859]]]]}},{type:"Feature",properties:{iso1A2:"FM",iso1A3:"FSM",iso1N3:"583",wikidata:"Q702",nameEn:"Federated States of Micronesia",groups:["057","009","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["691"]},geometry:{type:"MultiPolygon",coordinates:[[[[138.20583,13.3783],[136.27107,6.73747],[156.88247,-1.39237],[165.19726,6.22546],[138.20583,13.3783]]]]}},{type:"Feature",properties:{iso1A2:"FO",iso1A3:"FRO",iso1N3:"234",wikidata:"Q4628",nameEn:"Faroe Islands",country:"DK",groups:["154","150","UN"],callingCodes:["298"]},geometry:{type:"MultiPolygon",coordinates:[[[[-8.51774,62.35338],[-6.51083,60.95272],[-5.70102,62.77194],[-8.51774,62.35338]]]]}},{type:"Feature",properties:{iso1A2:"FR",iso1A3:"FRA",iso1N3:"250",wikidata:"Q142",nameEn:"France"},geometry:null},{type:"Feature",properties:{iso1A2:"FX",iso1A3:"FXX",iso1N3:"249",wikidata:"Q212429",nameEn:"Metropolitan France",country:"FR",groups:["EU","155","150","UN"],isoStatus:"excRes",callingCodes:["33"]},geometry:{type:"MultiPolygon",coordinates:[[[[2.55904,51.07014],[2.18458,51.52087],[1.17405,50.74239],[-2.02963,49.91866],[-2.09454,49.46288],[-1.83944,49.23037],[-2.00491,48.86706],[-2.65349,49.15373],[-6.28985,48.93406],[-1.81005,43.59738],[-1.77289,43.38957],[-1.79319,43.37497],[-1.78332,43.36399],[-1.78714,43.35476],[-1.77068,43.34396],[-1.75334,43.34107],[-1.75079,43.3317],[-1.7397,43.32979],[-1.73074,43.29481],[-1.69407,43.31378],[-1.62481,43.30726],[-1.63052,43.28591],[-1.61341,43.25269],[-1.57674,43.25269],[-1.55963,43.28828],[-1.50992,43.29481],[-1.45289,43.27049],[-1.40942,43.27272],[-1.3758,43.24511],[-1.41562,43.12815],[-1.47555,43.08372],[-1.44067,43.047],[-1.35272,43.02658],[-1.34419,43.09665],[-1.32209,43.1127],[-1.27118,43.11961],[-1.30052,43.09581],[-1.30531,43.06859],[-1.25244,43.04164],[-1.22881,43.05534],[-1.10333,43.0059],[-1.00963,42.99279],[-.97133,42.96239],[-.81652,42.95166],[-.75478,42.96916],[-.72037,42.92541],[-.73422,42.91228],[-.72608,42.89318],[-.69837,42.87945],[-.67637,42.88303],[-.55497,42.77846],[-.50863,42.82713],[-.44334,42.79939],[-.41319,42.80776],[-.38833,42.80132],[-.3122,42.84788],[-.17939,42.78974],[-.16141,42.79535],[-.10519,42.72761],[-.02468,42.68513],[.17569,42.73424],[.25336,42.7174],[.29407,42.67431],[.36251,42.72282],[.40214,42.69779],[.67873,42.69458],[.65421,42.75872],[.66121,42.84021],[.711,42.86372],[.93089,42.79154],[.96166,42.80629],[.98292,42.78754],[1.0804,42.78569],[1.15928,42.71407],[1.35562,42.71944],[1.44197,42.60217],[1.47986,42.61346],[1.46718,42.63296],[1.48043,42.65203],[1.50867,42.64483],[1.55418,42.65669],[1.60085,42.62703],[1.63485,42.62957],[1.6625,42.61982],[1.68267,42.62533],[1.73452,42.61515],[1.72588,42.59098],[1.7858,42.57698],[1.73683,42.55492],[1.72515,42.50338],[1.76335,42.48863],[1.83037,42.48395],[1.88853,42.4501],[1.93663,42.45439],[1.94292,42.44316],[1.94061,42.43333],[1.94084,42.43039],[1.9574,42.42401],[1.96482,42.37787],[2.00488,42.35399],[2.06241,42.35906],[2.11621,42.38393],[2.12789,42.41291],[2.16599,42.42314],[2.20578,42.41633],[2.25551,42.43757],[2.38504,42.39977],[2.43299,42.39423],[2.43508,42.37568],[2.48457,42.33933],[2.54382,42.33406],[2.55516,42.35351],[2.57934,42.35808],[2.6747,42.33974],[2.65311,42.38771],[2.72056,42.42298],[2.75497,42.42578],[2.77464,42.41046],[2.84335,42.45724],[2.85675,42.45444],[2.86983,42.46843],[2.88413,42.45938],[2.92107,42.4573],[2.94283,42.48174],[2.96518,42.46692],[3.03734,42.47363],[3.08167,42.42748],[3.10027,42.42621],[3.11379,42.43646],[3.17156,42.43545],[3.75438,42.33445],[7.60802,41.05927],[10.09675,41.44089],[9.56115,43.20816],[7.50102,43.51859],[7.42422,43.72209],[7.40903,43.7296],[7.41113,43.73156],[7.41291,43.73168],[7.41298,43.73311],[7.41233,43.73439],[7.42062,43.73977],[7.42299,43.74176],[7.42443,43.74087],[7.42809,43.74396],[7.43013,43.74895],[7.43624,43.75014],[7.43708,43.75197],[7.4389,43.75151],[7.4379,43.74963],[7.47823,43.73341],[7.53006,43.78405],[7.50423,43.84345],[7.49355,43.86551],[7.51162,43.88301],[7.56075,43.89932],[7.56858,43.94506],[7.60771,43.95772],[7.65266,43.9763],[7.66848,43.99943],[7.6597,44.03009],[7.72508,44.07578],[7.66878,44.12795],[7.68694,44.17487],[7.63245,44.17877],[7.62155,44.14881],[7.36364,44.11882],[7.34547,44.14359],[7.27827,44.1462],[7.16929,44.20352],[7.00764,44.23736],[6.98221,44.28289],[6.89171,44.36637],[6.88784,44.42043],[6.94504,44.43112],[6.86233,44.49834],[6.85507,44.53072],[6.96042,44.62129],[6.95133,44.66264],[7.00582,44.69364],[7.07484,44.68073],[7.00401,44.78782],[7.02217,44.82519],[6.93499,44.8664],[6.90774,44.84322],[6.75518,44.89915],[6.74519,44.93661],[6.74791,45.01939],[6.66981,45.02324],[6.62803,45.11175],[6.7697,45.16044],[6.85144,45.13226],[6.96706,45.20841],[7.07074,45.21228],[7.13115,45.25386],[7.10572,45.32924],[7.18019,45.40071],[7.00037,45.509],[6.98948,45.63869],[6.80785,45.71864],[6.80785,45.83265],[6.95315,45.85163],[7.04151,45.92435],[7.00946,45.9944],[6.93862,46.06502],[6.87868,46.03855],[6.89321,46.12548],[6.78968,46.14058],[6.86052,46.28512],[6.77152,46.34784],[6.8024,46.39171],[6.82312,46.42661],[6.53358,46.45431],[6.25432,46.3632],[6.21981,46.31304],[6.24826,46.30175],[6.25137,46.29014],[6.23775,46.27822],[6.24952,46.26255],[6.26749,46.24745],[6.29474,46.26221],[6.31041,46.24417],[6.29663,46.22688],[6.27694,46.21566],[6.26007,46.21165],[6.24821,46.20531],[6.23913,46.20511],[6.23544,46.20714],[6.22175,46.20045],[6.22222,46.19888],[6.21844,46.19837],[6.21603,46.19507],[6.21273,46.19409],[6.21114,46.1927],[6.20539,46.19163],[6.19807,46.18369],[6.19552,46.18401],[6.18707,46.17999],[6.18871,46.16644],[6.18116,46.16187],[6.15305,46.15194],[6.13397,46.1406],[6.09926,46.14373],[6.09199,46.15191],[6.07491,46.14879],[6.05203,46.15191],[6.04564,46.14031],[6.03614,46.13712],[6.01791,46.14228],[5.9871,46.14499],[5.97893,46.13303],[5.95781,46.12925],[5.9641,46.14412],[5.97508,46.15863],[5.98188,46.17392],[5.98846,46.17046],[5.99573,46.18587],[5.96515,46.19638],[5.97542,46.21525],[6.02461,46.23313],[6.03342,46.2383],[6.04602,46.23127],[6.05029,46.23518],[6.0633,46.24583],[6.07072,46.24085],[6.08563,46.24651],[6.10071,46.23772],[6.12446,46.25059],[6.11926,46.2634],[6.1013,46.28512],[6.11697,46.29547],[6.1198,46.31157],[6.13876,46.33844],[6.15738,46.3491],[6.16987,46.36759],[6.15985,46.37721],[6.15016,46.3778],[6.09926,46.40768],[6.06407,46.41676],[6.08427,46.44305],[6.07269,46.46244],[6.1567,46.54402],[6.11084,46.57649],[6.27135,46.68251],[6.38351,46.73171],[6.45209,46.77502],[6.43216,46.80336],[6.46456,46.88865],[6.43341,46.92703],[6.71531,47.0494],[6.68823,47.06616],[6.76788,47.1208],[6.8489,47.15933],[6.9508,47.24338],[6.95108,47.26428],[6.94316,47.28747],[7.05305,47.33304],[7.0564,47.35134],[7.03125,47.36996],[6.87959,47.35335],[6.88542,47.37262],[6.93744,47.40714],[6.93953,47.43388],[7.0024,47.45264],[6.98425,47.49432],[7.0231,47.50522],[7.07425,47.48863],[7.12781,47.50371],[7.16249,47.49025],[7.19583,47.49455],[7.17026,47.44312],[7.24669,47.4205],[7.33526,47.44186],[7.35603,47.43432],[7.40308,47.43638],[7.43088,47.45846],[7.4462,47.46264],[7.4583,47.47216],[7.42923,47.48628],[7.43356,47.49712],[7.47534,47.47932],[7.51076,47.49651],[7.49804,47.51798],[7.5229,47.51644],[7.53199,47.5284],[7.51904,47.53515],[7.50588,47.52856],[7.49691,47.53821],[7.50873,47.54546],[7.51723,47.54578],[7.52831,47.55347],[7.53634,47.55553],[7.55652,47.56779],[7.55689,47.57232],[7.56548,47.57617],[7.56684,47.57785],[7.58386,47.57536],[7.58945,47.59017],[7.59301,47.60058],[7.58851,47.60794],[7.57423,47.61628],[7.5591,47.63849],[7.53384,47.65115],[7.52067,47.66437],[7.51915,47.68335],[7.51266,47.70197],[7.53722,47.71635],[7.54761,47.72912],[7.52921,47.77747],[7.55673,47.87371],[7.62302,47.97898],[7.56966,48.03265],[7.57137,48.12292],[7.6648,48.22219],[7.69022,48.30018],[7.74562,48.32736],[7.73109,48.39192],[7.76833,48.48945],[7.80647,48.51239],[7.80167,48.54758],[7.80057,48.5857],[7.84098,48.64217],[7.89002,48.66317],[7.96812,48.72491],[7.96994,48.75606],[8.01534,48.76085],[8.0326,48.79017],[8.06802,48.78957],[8.10253,48.81829],[8.12813,48.87985],[8.19989,48.95825],[8.20031,48.95856],[8.22604,48.97352],[8.14189,48.97833],[7.97783,49.03161],[7.93641,49.05544],[7.86386,49.03499],[7.79557,49.06583],[7.75948,49.04562],[7.63618,49.05428],[7.62575,49.07654],[7.56416,49.08136],[7.53012,49.09818],[7.49172,49.13915],[7.49473,49.17],[7.44455,49.16765],[7.44052,49.18354],[7.3662,49.17308],[7.35995,49.14399],[7.3195,49.14231],[7.29514,49.11426],[7.23473,49.12971],[7.1593,49.1204],[7.1358,49.1282],[7.12504,49.14253],[7.10384,49.13787],[7.10715,49.15631],[7.07859,49.15031],[7.09007,49.13094],[7.07162,49.1255],[7.06642,49.11415],[7.05548,49.11185],[7.04843,49.11422],[7.04409,49.12123],[7.04662,49.13724],[7.03178,49.15734],[7.0274,49.17042],[7.03459,49.19096],[7.01318,49.19018],[6.97273,49.2099],[6.95963,49.203],[6.94028,49.21641],[6.93831,49.2223],[6.91875,49.22261],[6.89298,49.20863],[6.85939,49.22376],[6.83555,49.21249],[6.85119,49.20038],[6.85016,49.19354],[6.86225,49.18185],[6.84703,49.15734],[6.83385,49.15162],[6.78265,49.16793],[6.73765,49.16375],[6.71137,49.18808],[6.73256,49.20486],[6.71843,49.2208],[6.69274,49.21661],[6.66583,49.28065],[6.60186,49.31055],[6.572,49.35027],[6.58807,49.35358],[6.60091,49.36864],[6.533,49.40748],[6.55404,49.42464],[6.42432,49.47683],[6.40274,49.46546],[6.39168,49.4667],[6.38352,49.46463],[6.36778,49.46937],[6.3687,49.4593],[6.28818,49.48465],[6.27875,49.503],[6.25029,49.50609],[6.2409,49.51408],[6.19543,49.50536],[6.17386,49.50934],[6.15366,49.50226],[6.16115,49.49297],[6.14321,49.48796],[6.12814,49.49365],[6.12346,49.4735],[6.10325,49.4707],[6.09845,49.46351],[6.10072,49.45268],[6.08373,49.45594],[6.07887,49.46399],[6.05553,49.46663],[6.04176,49.44801],[6.02743,49.44845],[6.02648,49.45451],[5.97693,49.45513],[5.96876,49.49053],[5.94224,49.49608],[5.94128,49.50034],[5.86571,49.50015],[5.83389,49.52152],[5.83467,49.52717],[5.84466,49.53027],[5.83648,49.5425],[5.81664,49.53775],[5.80871,49.5425],[5.81838,49.54777],[5.79195,49.55228],[5.77435,49.56298],[5.7577,49.55915],[5.75649,49.54321],[5.64505,49.55146],[5.60909,49.51228],[5.55001,49.52729],[5.46541,49.49825],[5.46734,49.52648],[5.43713,49.5707],[5.3974,49.61596],[5.34837,49.62889],[5.33851,49.61599],[5.3137,49.61225],[5.30214,49.63055],[5.33039,49.6555],[5.31465,49.66846],[5.26232,49.69456],[5.14545,49.70287],[5.09249,49.76193],[4.96714,49.79872],[4.85464,49.78995],[4.86965,49.82271],[4.85134,49.86457],[4.88529,49.9236],[4.78827,49.95609],[4.8382,50.06738],[4.88602,50.15182],[4.83279,50.15331],[4.82438,50.16878],[4.75237,50.11314],[4.70064,50.09384],[4.68695,49.99685],[4.5414,49.96911],[4.51098,49.94659],[4.43488,49.94122],[4.35051,49.95315],[4.31963,49.97043],[4.20532,49.95803],[4.14239,49.98034],[4.13508,50.01976],[4.16294,50.04719],[4.23101,50.06945],[4.20147,50.13535],[4.13561,50.13078],[4.16014,50.19239],[4.15524,50.21103],[4.21945,50.25539],[4.20651,50.27333],[4.17861,50.27443],[4.17347,50.28838],[4.15524,50.2833],[4.16808,50.25786],[4.13665,50.25609],[4.11954,50.30425],[4.10957,50.30234],[4.10237,50.31247],[4.0689,50.3254],[4.0268,50.35793],[3.96771,50.34989],[3.90781,50.32814],[3.84314,50.35219],[3.73911,50.34809],[3.70987,50.3191],[3.71009,50.30305],[3.66976,50.34563],[3.65709,50.36873],[3.67262,50.38663],[3.67494,50.40239],[3.66153,50.45165],[3.64426,50.46275],[3.61014,50.49568],[3.58361,50.49049],[3.5683,50.50192],[3.49509,50.48885],[3.51564,50.5256],[3.47385,50.53397],[3.44629,50.51009],[3.37693,50.49538],[3.28575,50.52724],[3.2729,50.60718],[3.23951,50.6585],[3.264,50.67668],[3.2536,50.68977],[3.26141,50.69151],[3.26063,50.70086],[3.24593,50.71389],[3.22042,50.71019],[3.20845,50.71662],[3.19017,50.72569],[3.20064,50.73547],[3.18811,50.74025],[3.18339,50.74981],[3.16476,50.76843],[3.15017,50.79031],[3.1257,50.78603],[3.11987,50.79188],[3.11206,50.79416],[3.10614,50.78303],[3.09163,50.77717],[3.04314,50.77674],[3.00537,50.76588],[2.96778,50.75242],[2.95019,50.75138],[2.90873,50.702],[2.91036,50.6939],[2.90069,50.69263],[2.88504,50.70656],[2.87937,50.70298],[2.86985,50.7033],[2.8483,50.72276],[2.81056,50.71773],[2.71165,50.81295],[2.63331,50.81457],[2.59093,50.91751],[2.63074,50.94746],[2.57551,51.00326],[2.55904,51.07014]],[[1.99838,42.44682],[1.98378,42.44697],[1.96125,42.45364],[1.95606,42.45785],[1.96215,42.47854],[1.97003,42.48081],[1.97227,42.48487],[1.97697,42.48568],[1.98022,42.49569],[1.98916,42.49351],[1.99766,42.4858],[1.98579,42.47486],[1.99216,42.46208],[2.01564,42.45171],[1.99838,42.44682]]]]}},{type:"Feature",properties:{iso1A2:"GA",iso1A3:"GAB",iso1N3:"266",wikidata:"Q1000",nameEn:"Gabon",groups:["017","202","002","UN"],callingCodes:["241"]},geometry:{type:"MultiPolygon",coordinates:[[[[13.29457,2.16106],[13.28534,2.25716],[11.37116,2.29975],[11.3561,2.17217],[11.35307,1.00251],[9.79648,1.0019],[9.75065,1.06753],[9.66433,1.06723],[7.24416,-.64092],[10.75913,-4.39519],[11.12647,-3.94169],[11.22301,-3.69888],[11.48764,-3.51089],[11.57949,-3.52798],[11.68608,-3.68942],[11.87083,-3.71571],[11.92719,-3.62768],[11.8318,-3.5812],[11.96554,-3.30267],[11.70227,-3.17465],[11.70558,-3.0773],[11.80365,-3.00424],[11.64798,-2.81146],[11.5359,-2.85654],[11.64487,-2.61865],[11.57637,-2.33379],[11.74605,-2.39936],[11.96866,-2.33559],[12.04895,-2.41704],[12.47925,-2.32626],[12.44656,-1.92025],[12.61312,-1.8129],[12.82172,-1.91091],[13.02759,-2.33098],[13.47977,-2.43224],[13.75884,-2.09293],[13.92073,-2.35581],[13.85846,-2.46935],[14.10442,-2.49268],[14.23829,-2.33715],[14.16202,-2.23916],[14.23518,-2.15671],[14.25932,-1.97624],[14.41838,-1.89412],[14.52569,-.57818],[14.41887,-.44799],[14.2165,-.38261],[14.06862,-.20826],[13.90632,-.2287],[13.88648,.26652],[14.10909,.58563],[14.26066,.57255],[14.48179,.9152],[14.25186,1.39842],[13.89582,1.4261],[13.15519,1.23368],[13.25447,1.32339],[13.13461,1.57238],[13.29457,2.16106]]]]}},{type:"Feature",properties:{iso1A2:"GB",iso1A3:"GBR",iso1N3:"826",wikidata:"Q145",ccTLD:".uk",nameEn:"United Kingdom",aliases:["UK"]},geometry:null},{type:"Feature",properties:{iso1A2:"GD",iso1A3:"GRD",iso1N3:"308",wikidata:"Q769",nameEn:"Grenada",aliases:["WG"],groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 473"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.64026,12.69984],[-61.77886,11.36496],[-59.94058,12.34011],[-62.64026,12.69984]]]]}},{type:"Feature",properties:{iso1A2:"GE",iso1A3:"GEO",iso1N3:"268",wikidata:"Q230",nameEn:"Georgia",groups:["145","142","UN"],callingCodes:["995"]},geometry:{type:"MultiPolygon",coordinates:[[[[46.42738,41.91323],[45.61676,42.20768],[45.78692,42.48358],[45.36501,42.55268],[45.15318,42.70598],[44.88754,42.74934],[44.80941,42.61277],[44.70002,42.74679],[44.54202,42.75699],[43.95517,42.55396],[43.73119,42.62043],[43.81453,42.74297],[43.0419,43.02413],[43.03322,43.08883],[42.75889,43.19651],[42.66667,43.13917],[42.40563,43.23226],[41.64935,43.22331],[40.65957,43.56212],[40.10657,43.57344],[40.04445,43.47776],[40.03312,43.44262],[40.01007,43.42411],[40.01552,43.42025],[40.00853,43.40578],[40.0078,43.38551],[39.81147,43.06294],[40.89217,41.72528],[41.54366,41.52185],[41.7148,41.4932],[41.7124,41.47417],[41.81939,41.43621],[41.95134,41.52466],[42.26387,41.49346],[42.51772,41.43606],[42.59202,41.58183],[42.72794,41.59714],[42.84471,41.58912],[42.78995,41.50126],[42.84899,41.47265],[42.8785,41.50516],[43.02956,41.37891],[43.21707,41.30331],[43.13373,41.25503],[43.1945,41.25242],[43.23096,41.17536],[43.36118,41.2028],[43.44973,41.17666],[43.4717,41.12611],[43.67712,41.13398],[43.74717,41.1117],[43.84835,41.16329],[44.16591,41.19141],[44.18148,41.24644],[44.32139,41.2079],[44.34337,41.20312],[44.34417,41.2382],[44.46791,41.18204],[44.59322,41.1933],[44.61462,41.24018],[44.72814,41.20338],[44.82084,41.21513],[44.87887,41.20195],[44.89911,41.21366],[44.84358,41.23088],[44.81749,41.23488],[44.80053,41.25949],[44.81437,41.30371],[44.93493,41.25685],[45.0133,41.29747],[45.09867,41.34065],[45.1797,41.42231],[45.26285,41.46433],[45.31352,41.47168],[45.4006,41.42402],[45.45973,41.45898],[45.68389,41.3539],[45.71035,41.36208],[45.75705,41.35157],[45.69946,41.29545],[45.80842,41.2229],[45.95786,41.17956],[46.13221,41.19479],[46.27698,41.19011],[46.37661,41.10805],[46.456,41.09984],[46.48558,41.0576],[46.55096,41.1104],[46.63969,41.09515],[46.66148,41.20533],[46.72375,41.28609],[46.63658,41.37727],[46.4669,41.43331],[46.40307,41.48464],[46.33925,41.4963],[46.29794,41.5724],[46.34126,41.57454],[46.34039,41.5947],[46.3253,41.60912],[46.28182,41.60089],[46.26531,41.63339],[46.24429,41.59883],[46.19759,41.62327],[46.17891,41.72094],[46.20538,41.77205],[46.23962,41.75811],[46.30863,41.79133],[46.3984,41.84399],[46.42738,41.91323]]]]}},{type:"Feature",properties:{iso1A2:"GF",iso1A3:"GUF",iso1N3:"254",wikidata:"Q3769",nameEn:"French Guiana",country:"FR",groups:["Q3320166","EU","005","419","019","UN"],callingCodes:["594"]},geometry:{type:"MultiPolygon",coordinates:[[[[-51.35485,4.8383],[-53.7094,6.2264],[-54.01074,5.68785],[-54.01877,5.52789],[-54.26916,5.26909],[-54.4717,4.91964],[-54.38444,4.13222],[-54.19367,3.84387],[-54.05128,3.63557],[-53.98914,3.627],[-53.9849,3.58697],[-54.28534,2.67798],[-54.42864,2.42442],[-54.6084,2.32856],[-54.16286,2.10779],[-53.78743,2.34412],[-52.96539,2.1881],[-52.6906,2.37298],[-52.31787,3.17896],[-51.85573,3.83427],[-51.82312,3.85825],[-51.79599,3.89336],[-51.61983,4.14596],[-51.63798,4.51394],[-51.35485,4.8383]]]]}},{type:"Feature",properties:{iso1A2:"GG",iso1A3:"GGY",iso1N3:"831",wikidata:"Q25230",nameEn:"Bailiwick of Guernsey",country:"GB"},geometry:null},{type:"Feature",properties:{iso1A2:"GH",iso1A3:"GHA",iso1N3:"288",wikidata:"Q117",nameEn:"Ghana",groups:["011","202","002","UN"],callingCodes:["233"]},geometry:{type:"MultiPolygon",coordinates:[[[[-.13493,11.14075],[-.27374,11.17157],[-.28566,11.12713],[-.35955,11.07801],[-.38219,11.12596],[-.42391,11.11661],[-.44298,11.04292],[-.61937,10.91305],[-.67143,10.99811],[-2.83373,11.0067],[-2.94232,10.64281],[-2.83108,10.40252],[-2.74174,9.83172],[-2.76534,9.56589],[-2.68802,9.49343],[-2.69814,9.22717],[-2.77799,9.04949],[-2.66357,9.01771],[-2.58243,8.7789],[-2.49037,8.20872],[-2.62901,8.11495],[-2.61232,8.02645],[-2.67787,8.02055],[-2.74819,7.92613],[-2.78395,7.94974],[-2.79467,7.86002],[-2.92339,7.60847],[-2.97822,7.27165],[-2.95438,7.23737],[-3.23327,6.81744],[-3.21954,6.74407],[-3.25999,6.62521],[-3.01896,5.71697],[-2.95323,5.71865],[-2.96671,5.6415],[-2.93132,5.62137],[-2.85378,5.65156],[-2.76614,5.60963],[-2.72737,5.34789],[-2.77625,5.34621],[-2.73074,5.1364],[-2.75502,5.10657],[-2.95261,5.12477],[-2.96554,5.10397],[-3.063,5.13665],[-3.11073,5.12675],[-3.10675,5.08515],[-3.34019,4.17519],[1.07031,5.15655],[1.27574,5.93551],[1.19771,6.11522],[1.19966,6.17069],[1.09187,6.17074],[1.05969,6.22998],[1.03108,6.24064],[.99652,6.33779],[.89283,6.33779],[.71048,6.53083],[.74862,6.56517],[.63659,6.63857],[.6497,6.73682],[.58176,6.76049],[.57406,6.80348],[.52853,6.82921],[.56508,6.92971],[.52098,6.94391],[.52217,6.9723],[.59606,7.01252],[.65327,7.31643],[.62943,7.41099],[.57223,7.39326],[.52455,7.45354],[.51979,7.58706],[.58295,7.62368],[.62943,7.85751],[.58891,8.12779],[.6056,8.13959],[.61156,8.18324],[.5913,8.19622],[.63897,8.25873],[.73432,8.29529],[.64731,8.48866],[.47211,8.59945],[.37319,8.75262],[.52455,8.87746],[.45424,9.04581],[.56388,9.40697],[.49118,9.48339],[.36485,9.49749],[.33148,9.44812],[.25758,9.42696],[.2254,9.47869],[.31241,9.50337],[.30406,9.521],[.2409,9.52335],[.23851,9.57389],[.38153,9.58682],[.36008,9.6256],[.29334,9.59387],[.26712,9.66437],[.28261,9.69022],[.32313,9.6491],[.34816,9.66907],[.34816,9.71607],[.32075,9.72781],[.36366,10.03309],[.41252,10.02018],[.41371,10.06361],[.35293,10.09412],[.39584,10.31112],[.33028,10.30408],[.29453,10.41546],[.18846,10.4096],[.12886,10.53149],[-.05945,10.63458],[-.09141,10.7147],[-.07327,10.71845],[-.07183,10.76794],[-.0228,10.81916],[-.02685,10.8783],[-.00908,10.91644],[-.0063,10.96417],[.03355,10.9807],[.02395,11.06229],[.00342,11.08317],[-.00514,11.10763],[-.0275,11.11202],[-.05733,11.08628],[-.14462,11.10811],[-.13493,11.14075]]]]}},{type:"Feature",properties:{iso1A2:"GI",iso1A3:"GIB",iso1N3:"292",wikidata:"Q1410",nameEn:"Gibraltar",country:"GB",groups:["Q12837","BOTS","039","150","UN"],callingCodes:["350"]},geometry:{type:"MultiPolygon",coordinates:[[[[-5.34064,36.03744],[-5.27801,36.14942],[-5.33822,36.15272],[-5.34536,36.15501],[-5.40526,36.15488],[-5.34064,36.03744]]]]}},{type:"Feature",properties:{iso1A2:"GL",iso1A3:"GRL",iso1N3:"304",wikidata:"Q223",nameEn:"Greenland",country:"DK",groups:["Q1451600","021","003","019","UN"],callingCodes:["299"]},geometry:{type:"MultiPolygon",coordinates:[[[[-49.33696,84.57952],[-68.21821,80.48551],[-77.52957,77.23408],[-46.37635,57.3249],[-9.68082,72.73731],[-5.7106,84.28058],[-49.33696,84.57952]]]]}},{type:"Feature",properties:{iso1A2:"GM",iso1A3:"GMB",iso1N3:"270",wikidata:"Q1005",nameEn:"The Gambia",groups:["011","202","002","UN"],callingCodes:["220"]},geometry:{type:"MultiPolygon",coordinates:[[[[-15.14917,13.57989],[-14.36795,13.23033],[-13.79409,13.34472],[-13.8955,13.59126],[-14.34721,13.46578],[-14.93719,13.80173],[-15.36504,13.79313],[-15.47902,13.58758],[-17.43598,13.59273],[-17.43966,13.04579],[-16.74676,13.06025],[-16.69343,13.16791],[-15.80355,13.16729],[-15.80478,13.34832],[-15.26908,13.37768],[-15.14917,13.57989]]]]}},{type:"Feature",properties:{iso1A2:"GN",iso1A3:"GIN",iso1N3:"324",wikidata:"Q1006",nameEn:"Guinea",groups:["011","202","002","UN"],callingCodes:["224"]},geometry:{type:"MultiPolygon",coordinates:[[[[-11.37536,12.40788],[-11.46267,12.44559],[-11.91331,12.42008],[-12.35415,12.32758],[-12.87336,12.51892],[-13.06603,12.49342],[-13.05296,12.64003],[-13.70523,12.68013],[-13.7039,12.60313],[-13.65089,12.49515],[-13.64168,12.42764],[-13.70851,12.24978],[-13.92745,12.24077],[-13.94589,12.16869],[-13.7039,12.00869],[-13.7039,11.70195],[-14.09799,11.63649],[-14.26623,11.67486],[-14.31513,11.60713],[-14.51173,11.49708],[-14.66677,11.51188],[-14.77786,11.36323],[-14.95993,10.99244],[-15.07174,10.89557],[-15.96748,10.162],[-14.36218,8.64107],[-13.29911,9.04245],[-13.18586,9.0925],[-13.08953,9.0409],[-12.94095,9.26335],[-12.76788,9.3133],[-12.47254,9.86834],[-12.24262,9.92386],[-12.12634,9.87203],[-11.91023,9.93927],[-11.89624,9.99763],[-11.2118,10.00098],[-10.6534,9.29919],[-10.74484,9.07998],[-10.5783,9.06386],[-10.56197,8.81225],[-10.47707,8.67669],[-10.61422,8.5314],[-10.70565,8.29235],[-10.63934,8.35326],[-10.54891,8.31174],[-10.37257,8.48941],[-10.27575,8.48711],[-10.203,8.47991],[-10.14579,8.52665],[-10.05375,8.50697],[-10.05873,8.42578],[-9.77763,8.54633],[-9.47415,8.35195],[-9.50898,8.18455],[-9.41445,8.02448],[-9.44928,7.9284],[-9.35724,7.74111],[-9.37465,7.62032],[-9.48161,7.37122],[-9.41943,7.41809],[-9.305,7.42056],[-9.20798,7.38109],[-9.18311,7.30461],[-9.09107,7.1985],[-8.93435,7.2824],[-8.85724,7.26019],[-8.8448,7.35149],[-8.72789,7.51429],[-8.67814,7.69428],[-8.55874,7.70167],[-8.55874,7.62525],[-8.47114,7.55676],[-8.4003,7.6285],[-8.21374,7.54466],[-8.09931,7.78626],[-8.13414,7.87991],[-8.06449,8.04989],[-7.94695,8.00925],[-7.99919,8.11023],[-7.98675,8.20134],[-8.062,8.16071],[-8.2411,8.24196],[-8.22991,8.48438],[-7.92518,8.50652],[-7.65653,8.36873],[-7.69882,8.66148],[-7.95503,8.81146],[-7.92518,8.99332],[-7.73862,9.08422],[-7.90777,9.20456],[-7.85056,9.41812],[-8.03463,9.39604],[-8.14657,9.55062],[-8.09434,9.86936],[-8.15652,9.94288],[-8.11921,10.04577],[-8.01225,10.1021],[-7.97971,10.17117],[-7.9578,10.2703],[-8.10207,10.44649],[-8.22711,10.41722],[-8.32614,10.69273],[-8.2667,10.91762],[-8.35083,11.06234],[-8.66923,10.99397],[-8.40058,11.37466],[-8.80854,11.66715],[-8.94784,12.34842],[-9.13689,12.50875],[-9.38067,12.48446],[-9.32097,12.29009],[-9.63938,12.18312],[-9.714,12.0226],[-10.30604,12.24634],[-10.71897,11.91552],[-10.80355,12.1053],[-10.99758,12.24634],[-11.24136,12.01286],[-11.50006,12.17826],[-11.37536,12.40788]]]]}},{type:"Feature",properties:{iso1A2:"GP",iso1A3:"GLP",iso1N3:"312",wikidata:"Q17012",nameEn:"Guadeloupe",country:"FR",groups:["Q3320166","EU","029","003","419","019","UN"],callingCodes:["590"]},geometry:{type:"MultiPolygon",coordinates:[[[[-60.03183,16.1129],[-61.60296,16.73066],[-63.00549,15.26166],[-60.03183,16.1129]]]]}},{type:"Feature",properties:{iso1A2:"GQ",iso1A3:"GNQ",iso1N3:"226",wikidata:"Q983",nameEn:"Equatorial Guinea",groups:["017","202","002","UN"],callingCodes:["240"]},geometry:{type:"MultiPolygon",coordinates:[[[[9.22018,3.72052],[8.34397,4.30689],[7.71762,.6674],[3.35016,-3.29031],[9.66433,1.06723],[9.75065,1.06753],[9.79648,1.0019],[11.35307,1.00251],[11.3561,2.17217],[9.991,2.16561],[9.90749,2.20049],[9.89012,2.20457],[9.84716,2.24676],[9.83238,2.29079],[9.83754,2.32428],[9.82123,2.35097],[9.81162,2.33797],[9.22018,3.72052]]]]}},{type:"Feature",properties:{iso1A2:"GR",iso1A3:"GRC",iso1N3:"300",wikidata:"Q41",nameEn:"Greece",aliases:["EL"],groups:["EU","039","150","UN"],callingCodes:["30"]},geometry:{type:"MultiPolygon",coordinates:[[[[26.03489,40.73051],[26.0754,40.72772],[26.08638,40.73214],[26.12495,40.74283],[26.12854,40.77339],[26.15685,40.80709],[26.21351,40.83298],[26.20856,40.86048],[26.26169,40.9168],[26.29441,40.89119],[26.28623,40.93005],[26.32259,40.94042],[26.35894,40.94292],[26.33297,40.98388],[26.3606,41.02027],[26.31928,41.07386],[26.32259,41.24929],[26.39861,41.25053],[26.5209,41.33993],[26.5837,41.32131],[26.62997,41.34613],[26.61767,41.42281],[26.59742,41.48058],[26.59196,41.60491],[26.5209,41.62592],[26.47958,41.67037],[26.35957,41.71149],[26.30255,41.70925],[26.2654,41.71544],[26.22888,41.74139],[26.21325,41.73223],[26.16841,41.74858],[26.06148,41.70345],[26.07083,41.64584],[26.15146,41.60828],[26.14328,41.55496],[26.17951,41.55409],[26.176,41.50072],[26.14796,41.47533],[26.20288,41.43943],[26.16548,41.42278],[26.12926,41.35878],[25.87919,41.30526],[25.8266,41.34563],[25.70507,41.29209],[25.66183,41.31316],[25.61042,41.30614],[25.55082,41.31667],[25.52394,41.2798],[25.48187,41.28506],[25.28322,41.23411],[25.11611,41.34212],[24.942,41.38685],[24.90928,41.40876],[24.86136,41.39298],[24.82514,41.4035],[24.8041,41.34913],[24.71529,41.41928],[24.61129,41.42278],[24.52599,41.56808],[24.30513,41.51297],[24.27124,41.57682],[24.18126,41.51735],[24.10063,41.54796],[24.06323,41.53222],[24.06908,41.46132],[23.96975,41.44118],[23.91483,41.47971],[23.89613,41.45257],[23.80148,41.43943],[23.76525,41.40175],[23.67644,41.41139],[23.63203,41.37632],[23.52453,41.40262],[23.40416,41.39999],[23.33639,41.36317],[23.31301,41.40525],[23.22771,41.37106],[23.21953,41.33773],[23.1833,41.31755],[22.93334,41.34104],[22.81199,41.3398],[22.76408,41.32225],[22.74538,41.16321],[22.71266,41.13945],[22.65306,41.18168],[22.62852,41.14385],[22.58295,41.11568],[22.5549,41.13065],[22.42285,41.11921],[22.26744,41.16409],[22.17629,41.15969],[22.1424,41.12449],[22.06527,41.15617],[21.90869,41.09191],[21.91102,41.04786],[21.7556,40.92525],[21.69601,40.9429],[21.57448,40.86076],[21.53007,40.90759],[21.41555,40.9173],[21.35595,40.87578],[21.25779,40.86165],[21.21105,40.8855],[21.15262,40.85546],[20.97887,40.85475],[20.98396,40.79109],[20.95752,40.76982],[20.98134,40.76046],[21.05833,40.66586],[21.03932,40.56299],[20.96908,40.51526],[20.94925,40.46625],[20.83688,40.47882],[20.7906,40.42726],[20.78234,40.35803],[20.71789,40.27739],[20.67162,40.09433],[20.62566,40.0897],[20.61081,40.07866],[20.55593,40.06524],[20.51297,40.08168],[20.48487,40.06271],[20.42373,40.06777],[20.37911,39.99058],[20.31135,39.99438],[20.41546,39.82832],[20.41475,39.81437],[20.38572,39.78516],[20.30804,39.81563],[20.29152,39.80421],[20.31961,39.72799],[20.27412,39.69884],[20.22707,39.67459],[20.22376,39.64532],[20.15988,39.652],[20.12956,39.65805],[20.05189,39.69112],[20.00957,39.69227],[19.98042,39.6504],[19.92466,39.69533],[19.97622,39.78684],[19.95905,39.82857],[19.0384,40.35325],[19.20409,39.7532],[22.5213,33.45682],[29.73302,35.92555],[29.69611,36.10365],[29.61805,36.14179],[29.61002,36.1731],[29.48192,36.18377],[29.30783,36.01033],[28.23708,36.56812],[27.95037,36.46155],[27.89482,36.69898],[27.46117,36.53789],[27.24613,36.71622],[27.45627,36.9008],[27.20312,36.94571],[27.14757,37.32],[26.95583,37.64989],[26.99377,37.69034],[27.16428,37.72343],[27.05537,37.9131],[26.21136,38.17558],[26.24183,38.44695],[26.32173,38.48731],[26.21136,38.65436],[26.61814,38.81372],[26.70773,39.0312],[26.43357,39.43096],[25.94257,39.39358],[25.61285,40.17161],[26.04292,40.3958],[25.94795,40.72797],[26.03489,40.73051]]]]}},{type:"Feature",properties:{iso1A2:"GS",iso1A3:"SGS",iso1N3:"239",wikidata:"Q35086",nameEn:"South Georgia and South Sandwich Islands",country:"GB",groups:["BOTS","005","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["500"]},geometry:{type:"MultiPolygon",coordinates:[[[[-35.26394,-43.68272],[-53.39656,-59.87088],[-22.31757,-59.85974],[-35.26394,-43.68272]]]]}},{type:"Feature",properties:{iso1A2:"GT",iso1A3:"GTM",iso1N3:"320",wikidata:"Q774",nameEn:"Guatemala",groups:["013","003","419","019","UN"],callingCodes:["502"]},geometry:{type:"MultiPolygon",coordinates:[[[[-89.14985,17.81563],[-90.98678,17.81655],[-90.99199,17.25192],[-91.43809,17.25373],[-91.04436,16.92175],[-90.69064,16.70697],[-90.61212,16.49832],[-90.40499,16.40524],[-90.44567,16.07573],[-91.73182,16.07371],[-92.20983,15.26077],[-92.0621,15.07406],[-92.1454,14.98143],[-92.1423,14.88647],[-92.18161,14.84147],[-92.1454,14.6804],[-92.2261,14.53423],[-92.37213,14.39277],[-90.55276,12.8866],[-90.11344,13.73679],[-90.10505,13.85104],[-89.88937,14.0396],[-89.81807,14.07073],[-89.76103,14.02923],[-89.73251,14.04133],[-89.75569,14.07073],[-89.70756,14.1537],[-89.61844,14.21937],[-89.52397,14.22628],[-89.50614,14.26084],[-89.58814,14.33165],[-89.57441,14.41637],[-89.39028,14.44561],[-89.34776,14.43013],[-89.35189,14.47553],[-89.23719,14.58046],[-89.15653,14.57802],[-89.13132,14.71582],[-89.23467,14.85596],[-89.15149,14.97775],[-89.18048,14.99967],[-89.15149,15.07392],[-88.97343,15.14039],[-88.32467,15.63665],[-88.31459,15.66942],[-88.24022,15.69247],[-88.22552,15.72294],[-88.20359,16.03858],[-88.40779,16.09624],[-88.95358,15.88698],[-89.02415,15.9063],[-89.17418,15.90898],[-89.22683,15.88619],[-89.15025,17.04813],[-89.14985,17.81563]]]]}},{type:"Feature",properties:{iso1A2:"GU",iso1A3:"GUM",iso1N3:"316",wikidata:"Q16635",nameEn:"Guam",aliases:["US-GU"],country:"US",groups:["Q1352230","Q153732","057","009","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 671"]},geometry:{type:"MultiPolygon",coordinates:[[[[146.25931,13.85876],[143.82485,13.92273],[144.61642,12.82462],[146.25931,13.85876]]]]}},{type:"Feature",properties:{iso1A2:"GW",iso1A3:"GNB",iso1N3:"624",wikidata:"Q1007",nameEn:"Guinea-Bissau",groups:["011","202","002","UN"],callingCodes:["245"]},geometry:{type:"MultiPolygon",coordinates:[[[[-14.31513,11.60713],[-14.26623,11.67486],[-14.09799,11.63649],[-13.7039,11.70195],[-13.7039,12.00869],[-13.94589,12.16869],[-13.92745,12.24077],[-13.70851,12.24978],[-13.64168,12.42764],[-13.65089,12.49515],[-13.7039,12.60313],[-13.70523,12.68013],[-15.17582,12.6847],[-15.67302,12.42974],[-16.20591,12.46157],[-16.38191,12.36449],[-16.70562,12.34803],[-17.4623,11.92379],[-15.96748,10.162],[-15.07174,10.89557],[-14.95993,10.99244],[-14.77786,11.36323],[-14.66677,11.51188],[-14.51173,11.49708],[-14.31513,11.60713]]]]}},{type:"Feature",properties:{iso1A2:"GY",iso1A3:"GUY",iso1N3:"328",wikidata:"Q734",nameEn:"Guyana",groups:["005","419","019","UN"],driveSide:"left",callingCodes:["592"]},geometry:{type:"MultiPolygon",coordinates:[[[[-56.84822,6.73257],[-59.54058,8.6862],[-59.98508,8.53046],[-59.85562,8.35213],[-59.80661,8.28906],[-59.83156,8.23261],[-59.97059,8.20791],[-60.02407,8.04557],[-60.38056,7.8302],[-60.51959,7.83373],[-60.64793,7.56877],[-60.71923,7.55817],[-60.59802,7.33194],[-60.63367,7.25061],[-60.54098,7.14804],[-60.44116,7.20817],[-60.28074,7.1162],[-60.39419,6.94847],[-60.54873,6.8631],[-61.13632,6.70922],[-61.20762,6.58174],[-61.15058,6.19558],[-61.4041,5.95304],[-60.73204,5.20931],[-60.32352,5.21299],[-60.20944,5.28754],[-59.98129,5.07097],[-60.04189,4.69801],[-60.15953,4.53456],[-59.78878,4.45637],[-59.69361,4.34069],[-59.73353,4.20399],[-59.51963,3.91951],[-59.86899,3.57089],[-59.79769,3.37162],[-59.99733,2.92312],[-59.91177,2.36759],[-59.7264,2.27497],[-59.74066,1.87596],[-59.25583,1.40559],[-58.92072,1.31293],[-58.84229,1.17749],[-58.53571,1.29154],[-58.4858,1.48399],[-58.33887,1.58014],[-58.01873,1.51966],[-57.97336,1.64566],[-57.77281,1.73344],[-57.55743,1.69605],[-57.35073,1.98327],[-57.23981,1.95808],[-57.09109,2.01854],[-57.07092,1.95304],[-56.7659,1.89509],[-56.47045,1.95135],[-56.55439,2.02003],[-56.70519,2.02964],[-57.35891,3.32121],[-58.0307,3.95513],[-57.8699,4.89394],[-57.37442,5.0208],[-57.22536,5.15605],[-57.31629,5.33714],[-56.84822,6.73257]]]]}},{type:"Feature",properties:{iso1A2:"HK",iso1A3:"HKG",iso1N3:"344",wikidata:"Q8646",nameEn:"Hong Kong",country:"CN",groups:["030","142","UN"],driveSide:"left",callingCodes:["852"]},geometry:{type:"MultiPolygon",coordinates:[[[[113.92195,22.13873],[114.50148,22.15017],[114.44998,22.55977],[114.25154,22.55977],[114.22888,22.5436],[114.22185,22.55343],[114.20655,22.55706],[114.18338,22.55444],[114.17247,22.55944],[114.1597,22.56041],[114.15123,22.55163],[114.1482,22.54091],[114.13823,22.54319],[114.12665,22.54003],[114.11656,22.53415],[114.11181,22.52878],[114.1034,22.5352],[114.09692,22.53435],[114.09048,22.53716],[114.08606,22.53276],[114.07817,22.52997],[114.07267,22.51855],[114.06272,22.51617],[114.05729,22.51104],[114.05438,22.5026],[114.03113,22.5065],[113.86771,22.42972],[113.81621,22.2163],[113.83338,22.1826],[113.92195,22.13873]]]]}},{type:"Feature",properties:{iso1A2:"HM",iso1A3:"HMD",iso1N3:"334",wikidata:"Q131198",nameEn:"Heard Island and McDonald Islands",country:"AU",groups:["053","009","UN"],driveSide:"left"},geometry:{type:"MultiPolygon",coordinates:[[[[71.08716,-53.87687],[75.44182,-53.99822],[72.87012,-51.48322],[71.08716,-53.87687]]]]}},{type:"Feature",properties:{iso1A2:"HN",iso1A3:"HND",iso1N3:"340",wikidata:"Q783",nameEn:"Honduras",groups:["013","003","419","019","UN"],callingCodes:["504"]},geometry:{type:"MultiPolygon",coordinates:[[[[-83.86109,17.73736],[-88.20359,16.03858],[-88.22552,15.72294],[-88.24022,15.69247],[-88.31459,15.66942],[-88.32467,15.63665],[-88.97343,15.14039],[-89.15149,15.07392],[-89.18048,14.99967],[-89.15149,14.97775],[-89.23467,14.85596],[-89.13132,14.71582],[-89.15653,14.57802],[-89.23719,14.58046],[-89.35189,14.47553],[-89.34776,14.43013],[-89.04187,14.33644],[-88.94608,14.20207],[-88.85785,14.17763],[-88.815,14.11652],[-88.73182,14.10919],[-88.70661,14.04317],[-88.49738,13.97224],[-88.48982,13.86458],[-88.25791,13.91108],[-88.23018,13.99915],[-88.07641,13.98447],[-88.00331,13.86948],[-87.7966,13.91353],[-87.68821,13.80829],[-87.73106,13.75443],[-87.78148,13.52906],[-87.71657,13.50577],[-87.72115,13.46083],[-87.73841,13.44169],[-87.77354,13.45767],[-87.83467,13.44655],[-87.84675,13.41078],[-87.80177,13.35689],[-87.73714,13.32715],[-87.69751,13.25228],[-87.55124,13.12523],[-87.37107,12.98646],[-87.06306,13.00892],[-87.03785,12.98682],[-86.93197,13.05313],[-86.93383,13.18677],[-86.87066,13.30641],[-86.71267,13.30348],[-86.76812,13.79605],[-86.35219,13.77157],[-86.14801,14.04317],[-86.00685,14.08474],[-86.03458,13.99181],[-85.75477,13.8499],[-85.73964,13.9698],[-85.45762,14.11304],[-85.32149,14.2562],[-85.18602,14.24929],[-85.1575,14.53934],[-84.90082,14.80489],[-84.82596,14.82212],[-84.70119,14.68078],[-84.48373,14.63249],[-84.10584,14.76353],[-83.89551,14.76697],[-83.62101,14.89448],[-83.49268,15.01158],[-83.13724,15.00002],[-83.04763,15.03256],[-82.06974,14.49418],[-81.58685,18.0025],[-83.86109,17.73736]]]]}},{type:"Feature",properties:{iso1A2:"HR",iso1A3:"HRV",iso1N3:"191",wikidata:"Q224",nameEn:"Croatia",groups:["EU","039","150","UN"],callingCodes:["385"]},geometry:{type:"MultiPolygon",coordinates:[[[[17.6444,42.88641],[17.5392,42.92787],[17.70879,42.97223],[17.64268,43.08595],[17.46986,43.16559],[17.286,43.33065],[17.25579,43.40353],[17.29699,43.44542],[17.24411,43.49376],[17.15828,43.49376],[17.00585,43.58037],[16.80736,43.76011],[16.75316,43.77157],[16.70922,43.84887],[16.55472,43.95326],[16.50528,44.0244],[16.43629,44.02826],[16.43662,44.07523],[16.36864,44.08263],[16.18688,44.27012],[16.21346,44.35231],[16.12969,44.38275],[16.16814,44.40679],[16.10566,44.52586],[16.03012,44.55572],[16.00884,44.58605],[16.05828,44.61538],[15.89348,44.74964],[15.8255,44.71501],[15.72584,44.82334],[15.79472,44.8455],[15.76096,44.87045],[15.74723,44.96818],[15.78568,44.97401],[15.74585,45.0638],[15.78842,45.11519],[15.76371,45.16508],[15.83512,45.22459],[15.98412,45.23088],[16.12153,45.09616],[16.29036,44.99732],[16.35404,45.00241],[16.35863,45.03529],[16.3749,45.05206],[16.38219,45.05139],[16.38309,45.05955],[16.40023,45.1147],[16.4634,45.14522],[16.49155,45.21153],[16.52982,45.22713],[16.5501,45.2212],[16.56559,45.22307],[16.60194,45.23042],[16.64962,45.20714],[16.74845,45.20393],[16.78219,45.19002],[16.81137,45.18434],[16.83804,45.18951],[16.92405,45.27607],[16.9385,45.22742],[17.0415,45.20759],[17.18438,45.14764],[17.24325,45.146],[17.25131,45.14957],[17.26815,45.18444],[17.32092,45.16246],[17.33573,45.14521],[17.41229,45.13335],[17.4498,45.16119],[17.45615,45.12523],[17.47589,45.12656],[17.51469,45.10791],[17.59104,45.10816],[17.66571,45.13408],[17.84826,45.04489],[17.87148,45.04645],[17.93706,45.08016],[17.97336,45.12245],[17.97834,45.13831],[17.99479,45.14958],[18.01594,45.15163],[18.03121,45.12632],[18.1624,45.07654],[18.24387,45.13699],[18.32077,45.1021],[18.41896,45.11083],[18.47939,45.05871],[18.65723,45.07544],[18.78357,44.97741],[18.80661,44.93561],[18.76369,44.93707],[18.76347,44.90669],[18.8704,44.85097],[19.01994,44.85493],[18.98957,44.90645],[19.02871,44.92541],[19.06853,44.89915],[19.15573,44.95409],[19.05205,44.97692],[19.1011,45.01191],[19.07952,45.14668],[19.14063,45.12972],[19.19144,45.17863],[19.43589,45.17137],[19.41941,45.23475],[19.28208,45.23813],[19.10774,45.29547],[18.97446,45.37528],[18.99918,45.49333],[19.08364,45.48804],[19.07471,45.53086],[18.94562,45.53712],[18.88776,45.57253],[18.96691,45.66731],[18.90305,45.71863],[18.85783,45.85493],[18.81394,45.91329],[18.80211,45.87995],[18.6792,45.92057],[18.57483,45.80772],[18.44368,45.73972],[18.12439,45.78905],[18.08869,45.76511],[17.99805,45.79671],[17.87377,45.78522],[17.66545,45.84207],[17.56821,45.93728],[17.35672,45.95209],[17.14592,46.16697],[16.8903,46.28122],[16.8541,46.36255],[16.7154,46.39523],[16.6639,46.45203],[16.59527,46.47524],[16.52604,46.47831],[16.5007,46.49644],[16.44036,46.5171],[16.38771,46.53608],[16.37193,46.55008],[16.29793,46.5121],[16.26733,46.51505],[16.26759,46.50566],[16.23961,46.49653],[16.25124,46.48067],[16.27398,46.42875],[16.27329,46.41467],[16.30162,46.40437],[16.30233,46.37837],[16.18824,46.38282],[16.14859,46.40547],[16.05281,46.39141],[16.05065,46.3833],[16.07314,46.36458],[16.07616,46.3463],[15.97965,46.30652],[15.79284,46.25811],[15.78817,46.21719],[15.75479,46.20336],[15.75436,46.21969],[15.67395,46.22478],[15.6434,46.21396],[15.64904,46.19229],[15.59909,46.14761],[15.6083,46.11992],[15.62317,46.09103],[15.72977,46.04682],[15.71246,46.01196],[15.70327,46.00015],[15.70636,45.92116],[15.67967,45.90455],[15.68383,45.88867],[15.68232,45.86819],[15.70411,45.8465],[15.66662,45.84085],[15.64185,45.82915],[15.57952,45.84953],[15.52234,45.82195],[15.47325,45.8253],[15.47531,45.79802],[15.40836,45.79491],[15.25423,45.72275],[15.30872,45.69014],[15.34919,45.71623],[15.4057,45.64727],[15.38952,45.63682],[15.34214,45.64702],[15.34695,45.63382],[15.31027,45.6303],[15.27747,45.60504],[15.29837,45.5841],[15.30249,45.53224],[15.38188,45.48752],[15.33051,45.45258],[15.27758,45.46678],[15.16862,45.42309],[15.05187,45.49079],[15.02385,45.48533],[14.92266,45.52788],[14.90554,45.47769],[14.81992,45.45913],[14.80124,45.49515],[14.71718,45.53442],[14.68605,45.53006],[14.69694,45.57366],[14.59576,45.62812],[14.60977,45.66403],[14.57397,45.67165],[14.53816,45.6205],[14.5008,45.60852],[14.49769,45.54424],[14.36693,45.48642],[14.32487,45.47142],[14.27681,45.4902],[14.26611,45.48239],[14.24239,45.50607],[14.22371,45.50388],[14.20348,45.46896],[14.07116,45.48752],[14.00578,45.52352],[13.96063,45.50825],[13.99488,45.47551],[13.97309,45.45258],[13.90771,45.45149],[13.88124,45.42637],[13.81742,45.43729],[13.7785,45.46787],[13.67398,45.4436],[13.62902,45.45898],[13.56979,45.4895],[13.45644,45.59464],[13.05142,45.33128],[13.12821,44.48877],[16.15283,42.18525],[18.45131,42.21682],[18.54128,42.39171],[18.52152,42.42302],[18.43588,42.48556],[18.44307,42.51077],[18.43735,42.55921],[18.36197,42.61423],[18.24318,42.6112],[17.88201,42.83668],[17.80854,42.9182],[17.7948,42.89556],[17.68151,42.92725],[17.6444,42.88641]]]]}},{type:"Feature",properties:{iso1A2:"HT",iso1A3:"HTI",iso1N3:"332",wikidata:"Q790",nameEn:"Haiti",aliases:["RH"],groups:["029","003","419","019","UN"],callingCodes:["509"]},geometry:{type:"MultiPolygon",coordinates:[[[[-71.71885,18.78423],[-71.72624,18.87802],[-71.77766,18.95007],[-71.88102,18.95007],[-71.74088,19.0437],[-71.71088,19.08353],[-71.69938,19.10916],[-71.65337,19.11759],[-71.62642,19.21212],[-71.73229,19.26686],[-71.77766,19.33823],[-71.69448,19.37866],[-71.6802,19.45008],[-71.71268,19.53374],[-71.71449,19.55364],[-71.7429,19.58445],[-71.75865,19.70231],[-71.77419,19.73128],[-72.38946,20.27111],[-73.37289,20.43199],[-74.7289,18.71009],[-74.76465,18.06252],[-72.29523,17.48026],[-71.75671,18.03456],[-71.73783,18.07177],[-71.74994,18.11115],[-71.75465,18.14405],[-71.78271,18.18302],[-71.69952,18.34101],[-71.90875,18.45821],[-71.88102,18.50125],[-72.00201,18.62312],[-71.95412,18.64939],[-71.82556,18.62551],[-71.71885,18.78423]]]]}},{type:"Feature",properties:{iso1A2:"HU",iso1A3:"HUN",iso1N3:"348",wikidata:"Q28",nameEn:"Hungary",groups:["EU","151","150","UN"],callingCodes:["36"]},geometry:{type:"MultiPolygon",coordinates:[[[[21.72525,48.34628],[21.67134,48.3989],[21.6068,48.50365],[21.44063,48.58456],[21.11516,48.49546],[20.83248,48.5824],[20.5215,48.53336],[20.29943,48.26104],[20.24312,48.2784],[19.92452,48.1283],[19.63338,48.25006],[19.52489,48.19791],[19.47957,48.09437],[19.28182,48.08336],[19.23924,48.0595],[19.01952,48.07052],[18.82176,48.04206],[18.76134,47.97499],[18.76821,47.87469],[18.8506,47.82308],[18.74074,47.8157],[18.66521,47.76772],[18.56496,47.76588],[18.29305,47.73541],[18.02938,47.75665],[17.71215,47.7548],[17.23699,48.02094],[17.16001,48.00636],[17.09786,47.97336],[17.11022,47.92461],[17.08275,47.87719],[17.00997,47.86245],[17.07039,47.81129],[17.05048,47.79377],[17.08893,47.70928],[16.87538,47.68895],[16.86509,47.72268],[16.82938,47.68432],[16.7511,47.67878],[16.72089,47.73469],[16.65679,47.74197],[16.61183,47.76171],[16.54779,47.75074],[16.53514,47.73837],[16.55129,47.72268],[16.4222,47.66537],[16.58699,47.61772],[16.64193,47.63114],[16.71059,47.52692],[16.64821,47.50155],[16.6718,47.46139],[16.57152,47.40868],[16.52414,47.41007],[16.49908,47.39416],[16.45104,47.41181],[16.47782,47.25918],[16.44142,47.25079],[16.43663,47.21127],[16.41739,47.20649],[16.42801,47.18422],[16.4523,47.18812],[16.46442,47.16845],[16.44932,47.14418],[16.52863,47.13974],[16.46134,47.09395],[16.52176,47.05747],[16.43936,47.03548],[16.51369,47.00084],[16.28202,47.00159],[16.27594,46.9643],[16.22403,46.939],[16.19904,46.94134],[16.10983,46.867],[16.14365,46.8547],[16.15711,46.85434],[16.21892,46.86961],[16.2365,46.87775],[16.2941,46.87137],[16.34547,46.83836],[16.3408,46.80641],[16.31303,46.79838],[16.30966,46.7787],[16.37816,46.69975],[16.42641,46.69228],[16.41863,46.66238],[16.38594,46.6549],[16.39217,46.63673],[16.50139,46.56684],[16.52885,46.53303],[16.52604,46.5051],[16.59527,46.47524],[16.6639,46.45203],[16.7154,46.39523],[16.8541,46.36255],[16.8903,46.28122],[17.14592,46.16697],[17.35672,45.95209],[17.56821,45.93728],[17.66545,45.84207],[17.87377,45.78522],[17.99805,45.79671],[18.08869,45.76511],[18.12439,45.78905],[18.44368,45.73972],[18.57483,45.80772],[18.6792,45.92057],[18.80211,45.87995],[18.81394,45.91329],[18.99712,45.93537],[19.01284,45.96529],[19.0791,45.96458],[19.10388,46.04015],[19.14543,45.9998],[19.28826,45.99694],[19.52473,46.1171],[19.56113,46.16824],[19.66007,46.19005],[19.81491,46.1313],[19.93508,46.17553],[20.01816,46.17696],[20.03533,46.14509],[20.09713,46.17315],[20.26068,46.12332],[20.28324,46.1438],[20.35573,46.16629],[20.45377,46.14405],[20.49718,46.18721],[20.63863,46.12728],[20.76085,46.21002],[20.74574,46.25467],[20.86797,46.28884],[21.06572,46.24897],[21.16872,46.30118],[21.28061,46.44941],[21.26929,46.4993],[21.33214,46.63035],[21.43926,46.65109],[21.5151,46.72147],[21.48935,46.7577],[21.52028,46.84118],[21.59307,46.86935],[21.59581,46.91628],[21.68645,46.99595],[21.648,47.03902],[21.78395,47.11104],[21.94463,47.38046],[22.01055,47.37767],[22.03389,47.42508],[22.00917,47.50492],[22.31816,47.76126],[22.41979,47.7391],[22.46559,47.76583],[22.67247,47.7871],[22.76617,47.8417],[22.77991,47.87211],[22.89849,47.95851],[22.84276,47.98602],[22.87847,48.04665],[22.81804,48.11363],[22.73427,48.12005],[22.66835,48.09162],[22.58733,48.10813],[22.59007,48.15121],[22.49806,48.25189],[22.38133,48.23726],[22.2083,48.42534],[22.14689,48.4005],[21.83339,48.36242],[21.8279,48.33321],[21.72525,48.34628]]]]}},{type:"Feature",properties:{iso1A2:"IC",wikidata:"Q5813",nameEn:"Canary Islands",country:"ES",groups:["Q3320166","Q105472","EU","039","150","UN"],isoStatus:"excRes",callingCodes:["34"]},geometry:{type:"MultiPolygon",coordinates:[[[[-12.00985,30.24121],[-25.3475,27.87574],[-14.43883,27.02969],[-12.00985,30.24121]]]]}},{type:"Feature",properties:{iso1A2:"ID",iso1A3:"IDN",iso1N3:"360",wikidata:"Q252",nameEn:"Indonesia",aliases:["RI"]},geometry:null},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-6.26218,54.09785],[-6.29003,54.11278],[-6.32694,54.09337],[-6.36279,54.11248],[-6.36605,54.07234],[-6.47849,54.06947],[-6.62842,54.03503],[-6.66264,54.0666],[-6.6382,54.17071],[-6.70175,54.20218],[-6.74575,54.18788],[-6.81583,54.22791],[-6.85179,54.29176],[-6.87775,54.34682],[-7.02034,54.4212],[-7.19145,54.31296],[-7.14908,54.22732],[-7.25012,54.20063],[-7.26316,54.13863],[-7.29493,54.12013],[-7.29687,54.1354],[-7.28017,54.16714],[-7.29157,54.17191],[-7.34005,54.14698],[-7.30553,54.11869],[-7.32834,54.11475],[-7.44567,54.1539],[-7.4799,54.12239],[-7.55812,54.12239],[-7.69501,54.20731],[-7.81397,54.20159],[-7.8596,54.21779],[-7.87101,54.29299],[-8.04555,54.36292],[-8.179,54.46763],[-8.04538,54.48941],[-7.99812,54.54427],[-7.8596,54.53671],[-7.70315,54.62077],[-7.93293,54.66603],[-7.83352,54.73854],[-7.75041,54.7103],[-7.64449,54.75265],[-7.54671,54.74606],[-7.54508,54.79401],[-7.47626,54.83084],[-7.4473,54.87003],[-7.44404,54.9403],[-7.40004,54.94498],[-7.4033,55.00391],[-7.34464,55.04688],[-7.2471,55.06933],[-6.34755,55.49206],[-7.75229,55.93854],[-11.75,54],[-11,51],[-6.03913,51.13217],[-5.37267,53.63269],[-6.26218,54.09785]]]]},properties:{iso1A2:"IE",iso1A3:"IRL",iso1N3:"372",wikidata:"Q27",nameEn:"Republic of Ireland",groups:["EU","Q22890","154","150","UN"],driveSide:"left",callingCodes:["353"]}},{type:"Feature",properties:{iso1A2:"IL",iso1A3:"ISR",iso1N3:"376",wikidata:"Q801",nameEn:"Israel",groups:["145","142","UN"],callingCodes:["972"]},geometry:{type:"MultiPolygon",coordinates:[[[[34.052,31.46619],[34.29262,31.70393],[34.48681,31.59711],[34.56797,31.54197],[34.48892,31.48365],[34.40077,31.40926],[34.36505,31.36404],[34.37381,31.30598],[34.36523,31.28963],[34.29417,31.24194],[34.26742,31.21998],[34.92298,29.45305],[34.97718,29.54294],[34.98207,29.58147],[35.02147,29.66343],[35.14108,30.07374],[35.19183,30.34636],[35.16218,30.43535],[35.19595,30.50297],[35.21379,30.60401],[35.29311,30.71365],[35.33456,30.81224],[35.33984,30.8802],[35.41371,30.95565],[35.43658,31.12444],[35.40316,31.25535],[35.47672,31.49578],[35.39675,31.49572],[35.22921,31.37445],[35.13033,31.3551],[35.02459,31.35979],[34.92571,31.34337],[34.88932,31.37093],[34.87833,31.39321],[34.89756,31.43891],[34.93258,31.47816],[34.94356,31.50743],[34.9415,31.55601],[34.95249,31.59813],[35.00879,31.65426],[35.08226,31.69107],[35.10782,31.71594],[35.11895,31.71454],[35.12933,31.7325],[35.13931,31.73012],[35.15119,31.73634],[35.15474,31.73352],[35.16478,31.73242],[35.18023,31.72067],[35.20538,31.72388],[35.21937,31.71578],[35.22392,31.71899],[35.23972,31.70896],[35.24315,31.71244],[35.2438,31.7201],[35.24981,31.72543],[35.25182,31.73945],[35.26319,31.74846],[35.25225,31.7678],[35.26058,31.79064],[35.25573,31.81362],[35.26404,31.82567],[35.251,31.83085],[35.25753,31.8387],[35.24816,31.8458],[35.2304,31.84222],[35.2249,31.85433],[35.22817,31.8638],[35.22567,31.86745],[35.22294,31.87889],[35.22014,31.88264],[35.2136,31.88241],[35.21276,31.88153],[35.21016,31.88237],[35.20945,31.8815],[35.20791,31.8821],[35.20673,31.88151],[35.20381,31.86716],[35.21128,31.863],[35.216,31.83894],[35.21469,31.81835],[35.19461,31.82687],[35.18169,31.82542],[35.18603,31.80901],[35.14174,31.81325],[35.07677,31.85627],[35.05617,31.85685],[35.01978,31.82944],[34.9724,31.83352],[34.99712,31.85569],[35.03489,31.85919],[35.03978,31.89276],[35.03489,31.92448],[35.00124,31.93264],[34.98682,31.96935],[35.00261,32.027],[34.9863,32.09551],[34.99437,32.10962],[34.98507,32.12606],[34.99039,32.14626],[34.96009,32.17503],[34.95703,32.19522],[34.98885,32.20758],[35.01841,32.23981],[35.02939,32.2671],[35.01119,32.28684],[35.01772,32.33863],[35.04243,32.35008],[35.05142,32.3667],[35.0421,32.38242],[35.05311,32.4024],[35.05423,32.41754],[35.07059,32.4585],[35.08564,32.46948],[35.09236,32.47614],[35.10024,32.47856],[35.10882,32.4757],[35.15937,32.50466],[35.2244,32.55289],[35.25049,32.52453],[35.29306,32.50947],[35.30685,32.51024],[35.35212,32.52047],[35.40224,32.50136],[35.42034,32.46009],[35.41598,32.45593],[35.41048,32.43706],[35.42078,32.41562],[35.55807,32.38674],[35.55494,32.42687],[35.57485,32.48669],[35.56614,32.64393],[35.59813,32.65159],[35.61669,32.67999],[35.66527,32.681],[35.68467,32.70715],[35.75983,32.74803],[35.78745,32.77938],[35.83758,32.82817],[35.84021,32.8725],[35.87012,32.91976],[35.89298,32.9456],[35.87188,32.98028],[35.84802,33.1031],[35.81911,33.11077],[35.81911,33.1336],[35.84285,33.16673],[35.83846,33.19397],[35.81647,33.2028],[35.81295,33.24841],[35.77513,33.27342],[35.813,33.3172],[35.77477,33.33609],[35.62019,33.27278],[35.62283,33.24226],[35.58502,33.26653],[35.58326,33.28381],[35.56523,33.28969],[35.55555,33.25844],[35.54544,33.25513],[35.54808,33.236],[35.5362,33.23196],[35.54228,33.19865],[35.52573,33.11921],[35.50335,33.114],[35.50272,33.09056],[35.448,33.09264],[35.43059,33.06659],[35.35223,33.05617],[35.31429,33.10515],[35.1924,33.08743],[35.10645,33.09318],[34.78515,33.20368],[33.62659,31.82938],[34.052,31.46619]]]]}},{type:"Feature",properties:{iso1A2:"IM",iso1A3:"IMN",iso1N3:"833",wikidata:"Q9676",nameEn:"Isle of Man",country:"GB",groups:["Q185086","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01624","44 07624","44 07524","44 07924"]},geometry:{type:"MultiPolygon",coordinates:[[[[-3.98763,54.07351],[-4.1819,54.57861],[-5.6384,53.81157],[-3.98763,54.07351]]]]}},{type:"Feature",properties:{iso1A2:"IN",iso1A3:"IND",iso1N3:"356",wikidata:"Q668",nameEn:"India"},geometry:null},{type:"Feature",properties:{iso1A2:"IO",iso1A3:"IOT",iso1N3:"086",wikidata:"Q43448",nameEn:"British Indian Ocean Territory",country:"GB"},geometry:null},{type:"Feature",properties:{iso1A2:"IQ",iso1A3:"IRQ",iso1N3:"368",wikidata:"Q796",nameEn:"Iraq",groups:["145","142","UN"],callingCodes:["964"]},geometry:{type:"MultiPolygon",coordinates:[[[[42.78887,37.38615],[42.56725,37.14878],[42.35724,37.10998],[42.36697,37.0627],[41.81736,36.58782],[41.40058,36.52502],[41.28864,36.35368],[41.2564,36.06012],[41.37027,35.84095],[41.38184,35.62502],[41.26569,35.42708],[41.21654,35.1508],[41.2345,34.80049],[41.12388,34.65742],[40.97676,34.39788],[40.64314,34.31604],[38.79171,33.37328],[39.08202,32.50304],[38.98762,32.47694],[39.04251,32.30203],[39.26157,32.35555],[39.29903,32.23259],[40.01521,32.05667],[42.97601,30.72204],[42.97796,30.48295],[44.72255,29.19736],[46.42415,29.05947],[46.5527,29.10283],[46.89695,29.50584],[47.15166,30.01044],[47.37192,30.10421],[47.7095,30.10453],[48.01114,29.98906],[48.06782,30.02906],[48.17332,30.02448],[48.40479,29.85763],[48.59531,29.66815],[48.83867,29.78572],[48.61441,29.93675],[48.51011,29.96238],[48.44785,30.00148],[48.4494,30.04456],[48.43384,30.08233],[48.38869,30.11062],[48.38714,30.13485],[48.41671,30.17254],[48.41117,30.19846],[48.26393,30.3408],[48.24385,30.33846],[48.21279,30.31644],[48.19425,30.32796],[48.18321,30.39703],[48.14585,30.44133],[48.02443,30.4789],[48.03221,30.9967],[47.68219,31.00004],[47.6804,31.39086],[47.86337,31.78422],[47.64771,32.07666],[47.52474,32.15972],[47.57144,32.20583],[47.37529,32.47808],[47.17218,32.45393],[46.46788,32.91992],[46.32298,32.9731],[46.17198,32.95612],[46.09103,32.98354],[46.15175,33.07229],[46.03966,33.09577],[46.05367,33.13097],[46.11905,33.11924],[46.20623,33.20395],[45.99919,33.5082],[45.86687,33.49263],[45.96183,33.55751],[45.89801,33.63661],[45.77814,33.60938],[45.50261,33.94968],[45.42789,33.9458],[45.41077,33.97421],[45.47264,34.03099],[45.56176,34.15088],[45.58667,34.30147],[45.53552,34.35148],[45.49171,34.3439],[45.46697,34.38221],[45.43879,34.45949],[45.51883,34.47692],[45.53219,34.60441],[45.59074,34.55558],[45.60224,34.55057],[45.73923,34.54416],[45.70031,34.69277],[45.65672,34.7222],[45.68284,34.76624],[45.70031,34.82322],[45.73641,34.83975],[45.79682,34.85133],[45.78904,34.91135],[45.86532,34.89858],[45.89477,34.95805],[45.87864,35.03441],[45.92173,35.0465],[45.92203,35.09538],[45.93108,35.08148],[45.94756,35.09188],[46.06508,35.03699],[46.07747,35.0838],[46.11763,35.07551],[46.19116,35.11097],[46.15642,35.1268],[46.16229,35.16984],[46.19738,35.18536],[46.18457,35.22561],[46.11367,35.23729],[46.15474,35.2883],[46.13152,35.32548],[46.05358,35.38568],[45.98453,35.49848],[46.01518,35.52012],[45.97584,35.58132],[46.03028,35.57416],[46.01307,35.59756],[46.0165,35.61501],[45.99452,35.63574],[46.0117,35.65059],[46.01631,35.69139],[46.23736,35.71414],[46.34166,35.78363],[46.32921,35.82655],[46.17198,35.8013],[46.08325,35.8581],[45.94711,35.82218],[45.89784,35.83708],[45.81442,35.82107],[45.76145,35.79898],[45.6645,35.92872],[45.60018,35.96069],[45.55245,35.99943],[45.46594,36.00042],[45.38275,35.97156],[45.33916,35.99424],[45.37652,36.06222],[45.37312,36.09917],[45.32235,36.17383],[45.30038,36.27769],[45.26261,36.3001],[45.27394,36.35846],[45.23953,36.43257],[45.11811,36.40751],[45.00759,36.5402],[45.06985,36.62645],[45.06985,36.6814],[45.01537,36.75128],[44.84725,36.77622],[44.83479,36.81362],[44.90173,36.86096],[44.91199,36.91468],[44.89862,37.01897],[44.81611,37.04383],[44.75229,37.11958],[44.78319,37.1431],[44.76698,37.16162],[44.63179,37.19229],[44.42631,37.05825],[44.38117,37.05825],[44.35315,37.04955],[44.35937,37.02843],[44.30645,36.97373],[44.25975,36.98119],[44.18503,37.09551],[44.22239,37.15756],[44.27998,37.16501],[44.2613,37.25055],[44.13521,37.32486],[44.02002,37.33229],[43.90949,37.22453],[43.84878,37.22205],[43.82699,37.19477],[43.8052,37.22825],[43.7009,37.23692],[43.63085,37.21957],[43.56702,37.25675],[43.50787,37.24436],[43.33508,37.33105],[43.30083,37.30629],[43.11403,37.37436],[42.93705,37.32015],[42.78887,37.38615]]]]}},{type:"Feature",properties:{iso1A2:"IR",iso1A3:"IRN",iso1N3:"364",wikidata:"Q794",nameEn:"Iran",groups:["034","142","UN"],callingCodes:["98"]},geometry:{type:"MultiPolygon",coordinates:[[[[44.96746,39.42998],[44.88916,39.59653],[44.81043,39.62677],[44.71806,39.71124],[44.65422,39.72163],[44.6137,39.78393],[44.47298,39.68788],[44.48111,39.61579],[44.41849,39.56659],[44.42832,39.4131],[44.37921,39.4131],[44.29818,39.378],[44.22452,39.4169],[44.03667,39.39223],[44.1043,39.19842],[44.20946,39.13975],[44.18863,38.93881],[44.30322,38.81581],[44.26155,38.71427],[44.28065,38.6465],[44.32058,38.62752],[44.3207,38.49799],[44.3119,38.37887],[44.38309,38.36117],[44.44386,38.38295],[44.50115,38.33939],[44.42476,38.25763],[44.22509,37.88859],[44.3883,37.85433],[44.45948,37.77065],[44.55498,37.783],[44.62096,37.71985],[44.56887,37.6429],[44.61401,37.60165],[44.58449,37.45018],[44.81021,37.2915],[44.75986,37.21549],[44.7868,37.16644],[44.78319,37.1431],[44.75229,37.11958],[44.81611,37.04383],[44.89862,37.01897],[44.91199,36.91468],[44.90173,36.86096],[44.83479,36.81362],[44.84725,36.77622],[45.01537,36.75128],[45.06985,36.6814],[45.06985,36.62645],[45.00759,36.5402],[45.11811,36.40751],[45.23953,36.43257],[45.27394,36.35846],[45.26261,36.3001],[45.30038,36.27769],[45.32235,36.17383],[45.37312,36.09917],[45.37652,36.06222],[45.33916,35.99424],[45.38275,35.97156],[45.46594,36.00042],[45.55245,35.99943],[45.60018,35.96069],[45.6645,35.92872],[45.76145,35.79898],[45.81442,35.82107],[45.89784,35.83708],[45.94711,35.82218],[46.08325,35.8581],[46.17198,35.8013],[46.32921,35.82655],[46.34166,35.78363],[46.23736,35.71414],[46.01631,35.69139],[46.0117,35.65059],[45.99452,35.63574],[46.0165,35.61501],[46.01307,35.59756],[46.03028,35.57416],[45.97584,35.58132],[46.01518,35.52012],[45.98453,35.49848],[46.05358,35.38568],[46.13152,35.32548],[46.15474,35.2883],[46.11367,35.23729],[46.18457,35.22561],[46.19738,35.18536],[46.16229,35.16984],[46.15642,35.1268],[46.19116,35.11097],[46.11763,35.07551],[46.07747,35.0838],[46.06508,35.03699],[45.94756,35.09188],[45.93108,35.08148],[45.92203,35.09538],[45.92173,35.0465],[45.87864,35.03441],[45.89477,34.95805],[45.86532,34.89858],[45.78904,34.91135],[45.79682,34.85133],[45.73641,34.83975],[45.70031,34.82322],[45.68284,34.76624],[45.65672,34.7222],[45.70031,34.69277],[45.73923,34.54416],[45.60224,34.55057],[45.59074,34.55558],[45.53219,34.60441],[45.51883,34.47692],[45.43879,34.45949],[45.46697,34.38221],[45.49171,34.3439],[45.53552,34.35148],[45.58667,34.30147],[45.56176,34.15088],[45.47264,34.03099],[45.41077,33.97421],[45.42789,33.9458],[45.50261,33.94968],[45.77814,33.60938],[45.89801,33.63661],[45.96183,33.55751],[45.86687,33.49263],[45.99919,33.5082],[46.20623,33.20395],[46.11905,33.11924],[46.05367,33.13097],[46.03966,33.09577],[46.15175,33.07229],[46.09103,32.98354],[46.17198,32.95612],[46.32298,32.9731],[46.46788,32.91992],[47.17218,32.45393],[47.37529,32.47808],[47.57144,32.20583],[47.52474,32.15972],[47.64771,32.07666],[47.86337,31.78422],[47.6804,31.39086],[47.68219,31.00004],[48.03221,30.9967],[48.02443,30.4789],[48.14585,30.44133],[48.18321,30.39703],[48.19425,30.32796],[48.21279,30.31644],[48.24385,30.33846],[48.26393,30.3408],[48.41117,30.19846],[48.41671,30.17254],[48.38714,30.13485],[48.38869,30.11062],[48.43384,30.08233],[48.4494,30.04456],[48.44785,30.00148],[48.51011,29.96238],[48.61441,29.93675],[48.83867,29.78572],[49.98877,27.87827],[50.37726,27.89227],[54.39838,25.68383],[55.14145,25.62624],[55.81777,26.18798],[56.2644,26.58649],[56.68954,26.76645],[56.79239,26.41236],[56.82555,25.7713],[56.86325,25.03856],[61.46682,24.57869],[61.6433,25.27541],[61.683,25.66638],[61.83968,25.7538],[61.83831,26.07249],[61.89391,26.26251],[62.05117,26.31647],[62.21304,26.26601],[62.31484,26.528],[62.77352,26.64099],[63.1889,26.65072],[63.18688,26.83844],[63.25005,26.84212],[63.25005,27.08692],[63.32283,27.14437],[63.19649,27.25674],[62.80604,27.22412],[62.79684,27.34381],[62.84905,27.47627],[62.7638,28.02992],[62.79412,28.28108],[62.59499,28.24842],[62.40259,28.42703],[61.93581,28.55284],[61.65978,28.77937],[61.53765,29.00507],[61.31508,29.38903],[60.87231,29.86514],[61.80829,30.84224],[61.78268,30.92724],[61.8335,30.97669],[61.83257,31.0452],[61.80957,31.12576],[61.80569,31.16167],[61.70929,31.37391],[60.84541,31.49561],[60.86191,32.22565],[60.56485,33.12944],[60.88908,33.50219],[60.91133,33.55596],[60.69573,33.56054],[60.57762,33.59772],[60.5485,33.73422],[60.5838,33.80793],[60.50209,34.13992],[60.66502,34.31539],[60.91321,34.30411],[60.72316,34.52857],[60.99922,34.63064],[61.00197,34.70631],[61.06926,34.82139],[61.12831,35.09938],[61.0991,35.27845],[61.18187,35.30249],[61.27371,35.61482],[61.22719,35.67038],[61.26152,35.80749],[61.22444,35.92879],[61.12007,35.95992],[61.22719,36.12759],[61.1393,36.38782],[61.18187,36.55348],[61.14516,36.64644],[60.34767,36.63214],[60.00768,37.04102],[59.74678,37.12499],[59.55178,37.13594],[59.39385,37.34257],[59.39797,37.47892],[59.33507,37.53146],[59.22905,37.51161],[58.9338,37.67374],[58.6921,37.64548],[58.5479,37.70526],[58.47786,37.6433],[58.39959,37.63134],[58.22999,37.6856],[58.21399,37.77281],[57.79534,37.89299],[57.35042,37.98546],[57.37236,38.09321],[57.21169,38.28965],[57.03453,38.18717],[56.73928,38.27887],[56.62255,38.24005],[56.43303,38.26054],[56.32454,38.18502],[56.33278,38.08132],[55.97847,38.08024],[55.76561,38.12238],[55.44152,38.08564],[55.13412,37.94705],[54.851,37.75739],[54.77684,37.62264],[54.81804,37.61285],[54.77822,37.51597],[54.67247,37.43532],[54.58664,37.45809],[54.36211,37.34912],[54.24565,37.32047],[53.89734,37.3464],[48.88288,38.43975],[48.84969,38.45015],[48.81072,38.44853],[48.78979,38.45026],[48.70001,38.40564],[48.62217,38.40198],[48.58793,38.45076],[48.45084,38.61013],[48.3146,38.59958],[48.24773,38.71883],[48.02581,38.82705],[48.01409,38.90333],[48.07734,38.91616],[48.08627,38.94434],[48.28437,38.97186],[48.33884,39.03022],[48.31239,39.09278],[48.15361,39.19419],[48.12404,39.25208],[48.15984,39.30028],[48.37385,39.37584],[48.34264,39.42935],[47.98977,39.70999],[47.84774,39.66285],[47.50099,39.49615],[47.38978,39.45999],[47.31301,39.37492],[47.05927,39.24846],[47.05771,39.20143],[46.95341,39.13505],[46.92539,39.16644],[46.83822,39.13143],[46.75752,39.03231],[46.53497,38.86548],[46.34059,38.92076],[46.20601,38.85262],[46.14785,38.84206],[46.06766,38.87861],[46.00228,38.87376],[45.94624,38.89072],[45.90266,38.87739],[45.83883,38.90768],[45.65172,38.95199],[45.6155,38.94304],[45.6131,38.964],[45.44966,38.99243],[45.44811,39.04927],[45.40452,39.07224],[45.40148,39.09007],[45.30489,39.18333],[45.16168,39.21952],[45.08751,39.35052],[45.05932,39.36435],[44.96746,39.42998]]]]}},{type:"Feature",properties:{iso1A2:"IS",iso1A3:"ISL",iso1N3:"352",wikidata:"Q189",nameEn:"Iceland",groups:["154","150","UN"],callingCodes:["354"]},geometry:{type:"MultiPolygon",coordinates:[[[[-33.15676,62.62995],[-8.25539,63.0423],[-15.70914,69.67442],[-33.15676,62.62995]]]]}},{type:"Feature",properties:{iso1A2:"IT",iso1A3:"ITA",iso1N3:"380",wikidata:"Q38",nameEn:"Italy",groups:["EU","039","150","UN"],callingCodes:["39"]},geometry:{type:"MultiPolygon",coordinates:[[[[8.95861,45.96485],[8.97604,45.96151],[8.97741,45.98317],[8.96668,45.98436],[8.95861,45.96485]]],[[[7.63035,43.57419],[9.56115,43.20816],[10.09675,41.44089],[7.60802,41.05927],[7.89009,38.19924],[11.2718,37.6713],[12.13667,34.20326],[14.02721,36.53141],[17.67657,35.68918],[18.83516,40.36999],[16.15283,42.18525],[13.12821,44.48877],[13.05142,45.33128],[13.45644,45.59464],[13.6076,45.64761],[13.7198,45.59352],[13.74587,45.59811],[13.78445,45.5825],[13.84106,45.58185],[13.86771,45.59898],[13.8695,45.60835],[13.9191,45.6322],[13.87933,45.65207],[13.83422,45.68703],[13.83332,45.70855],[13.8235,45.7176],[13.66986,45.79955],[13.59784,45.8072],[13.58858,45.83503],[13.57563,45.8425],[13.58644,45.88173],[13.59565,45.89446],[13.60857,45.89907],[13.61931,45.91782],[13.63815,45.93607],[13.6329,45.94894],[13.64307,45.98326],[13.63458,45.98947],[13.62074,45.98388],[13.58903,45.99009],[13.56759,45.96991],[13.52963,45.96588],[13.50104,45.98078],[13.47474,46.00546],[13.49702,46.01832],[13.50998,46.04498],[13.49568,46.04839],[13.50104,46.05986],[13.57072,46.09022],[13.64053,46.13587],[13.66472,46.17392],[13.64451,46.18966],[13.56682,46.18703],[13.56114,46.2054],[13.47587,46.22725],[13.42218,46.20758],[13.37671,46.29668],[13.44808,46.33507],[13.43418,46.35992],[13.47019,46.3621],[13.5763,46.40915],[13.5763,46.42613],[13.59777,46.44137],[13.68684,46.43881],[13.7148,46.5222],[13.64088,46.53438],[13.27627,46.56059],[12.94445,46.60401],[12.59992,46.6595],[12.38708,46.71529],[12.27591,46.88651],[12.2006,46.88854],[12.11675,47.01241],[12.21781,47.03996],[12.19254,47.09331],[11.74789,46.98484],[11.50739,47.00644],[11.33355,46.99862],[11.10618,46.92966],[11.00764,46.76896],[10.72974,46.78972],[10.75753,46.82258],[10.66405,46.87614],[10.54783,46.84505],[10.47197,46.85698],[10.38659,46.67847],[10.40475,46.63671],[10.44686,46.64162],[10.49375,46.62049],[10.46136,46.53164],[10.25309,46.57432],[10.23674,46.63484],[10.10307,46.61003],[10.03715,46.44479],[10.165,46.41051],[10.10506,46.3372],[10.17862,46.25626],[10.14439,46.22992],[10.07055,46.21668],[9.95249,46.38045],[9.73086,46.35071],[9.71273,46.29266],[9.57015,46.2958],[9.46117,46.37481],[9.45936,46.50873],[9.40487,46.46621],[9.36128,46.5081],[9.28136,46.49685],[9.25502,46.43743],[9.29226,46.32717],[9.24503,46.23616],[9.01618,46.04928],[8.99257,45.9698],[9.09065,45.89906],[9.06642,45.8761],[9.04546,45.84968],[9.04059,45.8464],[9.03505,45.83976],[9.03793,45.83548],[9.03279,45.82865],[9.0298,45.82127],[9.00324,45.82055],[8.99663,45.83466],[8.9621,45.83707],[8.94737,45.84285],[8.91129,45.8388],[8.93504,45.86245],[8.94372,45.86587],[8.93649,45.86775],[8.88904,45.95465],[8.86688,45.96135],[8.85121,45.97239],[8.8319,45.9879],[8.79362,45.99207],[8.78585,45.98973],[8.79414,46.00913],[8.85617,46.0748],[8.80778,46.10085],[8.75697,46.10395],[8.62242,46.12112],[8.45032,46.26869],[8.46317,46.43712],[8.42464,46.46367],[8.30648,46.41587],[8.31162,46.38044],[8.08814,46.26692],[8.16866,46.17817],[8.11383,46.11577],[8.02906,46.10331],[7.98881,45.99867],[7.9049,45.99945],[7.85949,45.91485],[7.56343,45.97421],[7.10685,45.85653],[7.04151,45.92435],[6.95315,45.85163],[6.80785,45.83265],[6.80785,45.71864],[6.98948,45.63869],[7.00037,45.509],[7.18019,45.40071],[7.10572,45.32924],[7.13115,45.25386],[7.07074,45.21228],[6.96706,45.20841],[6.85144,45.13226],[6.7697,45.16044],[6.62803,45.11175],[6.66981,45.02324],[6.74791,45.01939],[6.74519,44.93661],[6.75518,44.89915],[6.90774,44.84322],[6.93499,44.8664],[7.02217,44.82519],[7.00401,44.78782],[7.07484,44.68073],[7.00582,44.69364],[6.95133,44.66264],[6.96042,44.62129],[6.85507,44.53072],[6.86233,44.49834],[6.94504,44.43112],[6.88784,44.42043],[6.89171,44.36637],[6.98221,44.28289],[7.00764,44.23736],[7.16929,44.20352],[7.27827,44.1462],[7.34547,44.14359],[7.36364,44.11882],[7.62155,44.14881],[7.63245,44.17877],[7.68694,44.17487],[7.66878,44.12795],[7.72508,44.07578],[7.6597,44.03009],[7.66848,43.99943],[7.65266,43.9763],[7.60771,43.95772],[7.56858,43.94506],[7.56075,43.89932],[7.51162,43.88301],[7.49355,43.86551],[7.50423,43.84345],[7.53006,43.78405],[7.63035,43.57419]],[[12.45181,41.90056],[12.44834,41.90095],[12.44582,41.90194],[12.44815,41.90326],[12.44984,41.90545],[12.45091,41.90625],[12.45543,41.90738],[12.45561,41.90629],[12.45762,41.9058],[12.45755,41.9033],[12.45826,41.90281],[12.45834,41.90174],[12.4577,41.90115],[12.45691,41.90125],[12.45626,41.90172],[12.45435,41.90143],[12.45446,41.90028],[12.45181,41.90056]],[[12.45648,43.89369],[12.44184,43.90498],[12.41641,43.89991],[12.40935,43.9024],[12.41233,43.90956],[12.40733,43.92379],[12.41551,43.92984],[12.41165,43.93769],[12.40506,43.94325],[12.40415,43.95485],[12.41414,43.95273],[12.42005,43.9578],[12.43662,43.95698],[12.44684,43.96597],[12.46205,43.97463],[12.47853,43.98052],[12.49406,43.98492],[12.50678,43.99113],[12.51463,43.99122],[12.5154,43.98508],[12.51064,43.98165],[12.51109,43.97201],[12.50622,43.97131],[12.50875,43.96198],[12.50655,43.95796],[12.51427,43.94897],[12.51553,43.94096],[12.50496,43.93017],[12.50269,43.92363],[12.49724,43.92248],[12.49247,43.91774],[12.49429,43.90973],[12.48771,43.89706],[12.45648,43.89369]]]]}},{type:"Feature",properties:{iso1A2:"JE",iso1A3:"JEY",iso1N3:"832",wikidata:"Q785",nameEn:"Bailiwick of Jersey",country:"GB",groups:["830","Q185086","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01534"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.00491,48.86706],[-1.83944,49.23037],[-2.09454,49.46288],[-2.65349,49.15373],[-2.00491,48.86706]]]]}},{type:"Feature",properties:{iso1A2:"JM",iso1A3:"JAM",iso1N3:"388",wikidata:"Q766",nameEn:"Jamaica",aliases:["JA"],groups:["029","003","419","019","UN"],driveSide:"left",callingCodes:["1 876","1 658"]},geometry:{type:"MultiPolygon",coordinates:[[[[-74.09729,17.36817],[-78.9741,19.59515],[-78.34606,16.57862],[-74.09729,17.36817]]]]}},{type:"Feature",properties:{iso1A2:"JO",iso1A3:"JOR",iso1N3:"400",wikidata:"Q810",nameEn:"Jordan",groups:["145","142","UN"],callingCodes:["962"]},geometry:{type:"MultiPolygon",coordinates:[[[[39.04251,32.30203],[38.98762,32.47694],[39.08202,32.50304],[38.79171,33.37328],[36.83946,32.31293],[36.40959,32.37908],[36.23948,32.50108],[36.20875,32.49529],[36.20379,32.52751],[36.08074,32.51463],[36.02239,32.65911],[35.96633,32.66237],[35.93307,32.71966],[35.88405,32.71321],[35.75983,32.74803],[35.68467,32.70715],[35.66527,32.681],[35.61669,32.67999],[35.59813,32.65159],[35.56614,32.64393],[35.57485,32.48669],[35.55494,32.42687],[35.55807,32.38674],[35.57111,32.21877],[35.52012,32.04076],[35.54375,31.96587],[35.52758,31.9131],[35.55941,31.76535],[35.47672,31.49578],[35.40316,31.25535],[35.43658,31.12444],[35.41371,30.95565],[35.33984,30.8802],[35.33456,30.81224],[35.29311,30.71365],[35.21379,30.60401],[35.19595,30.50297],[35.16218,30.43535],[35.19183,30.34636],[35.14108,30.07374],[35.02147,29.66343],[34.98207,29.58147],[34.97718,29.54294],[34.92298,29.45305],[34.8812,29.36878],[36.07081,29.18469],[36.50005,29.49696],[36.75083,29.86903],[37.4971,29.99949],[37.66395,30.33245],[37.99354,30.49998],[36.99791,31.50081],[38.99233,31.99721],[39.29903,32.23259],[39.26157,32.35555],[39.04251,32.30203]]]]}},{type:"Feature",properties:{iso1A2:"JP",iso1A3:"JPN",iso1N3:"392",wikidata:"Q17",nameEn:"Japan",groups:["030","142","UN"],driveSide:"left",callingCodes:["81"]},geometry:{type:"MultiPolygon",coordinates:[[[[145.82361,43.38904],[145.23667,43.76813],[145.82343,44.571],[140.9182,45.92937],[133.61399,37.41],[129.2669,34.87122],[122.26612,25.98197],[123.92912,17.8782],[155.16731,23.60141],[145.82361,43.38904]]]]}},{type:"Feature",properties:{iso1A2:"KE",iso1A3:"KEN",iso1N3:"404",wikidata:"Q114",nameEn:"Kenya",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["254"]},geometry:{type:"MultiPolygon",coordinates:[[[[35.9419,4.61933],[35.51424,4.61643],[35.42366,4.76969],[35.47843,4.91872],[35.30992,4.90402],[35.34151,5.02364],[34.47601,4.72162],[33.9873,4.23316],[34.06046,4.15235],[34.15429,3.80464],[34.45815,3.67385],[34.44922,3.51627],[34.39112,3.48802],[34.41794,3.44342],[34.40006,3.37949],[34.45815,3.18319],[34.56242,3.11478],[34.60114,2.93034],[34.65774,2.8753],[34.73967,2.85447],[34.78137,2.76223],[34.77244,2.70272],[34.95267,2.47209],[34.90947,2.42447],[34.98692,1.97348],[34.9899,1.6668],[34.92734,1.56109],[34.87819,1.5596],[34.7918,1.36752],[34.82606,1.30944],[34.82606,1.26626],[34.80223,1.22754],[34.67562,1.21265],[34.58029,1.14712],[34.57427,1.09868],[34.52369,1.10692],[34.43349,.85254],[34.40041,.80266],[34.31516,.75693],[34.27345,.63182],[34.20196,.62289],[34.13493,.58118],[34.11408,.48884],[34.08727,.44713],[34.10067,.36372],[33.90936,.10581],[33.98449,-.13079],[33.9264,-.54188],[33.93107,-.99298],[34.02286,-1.00779],[34.03084,-1.05101],[34.0824,-1.02264],[37.67199,-3.06222],[37.71745,-3.304],[37.5903,-3.42735],[37.63099,-3.50723],[37.75036,-3.54243],[37.81321,-3.69179],[39.21631,-4.67835],[39.44306,-4.93877],[39.62121,-4.68136],[41.75542,-1.85308],[41.56362,-1.66375],[41.56,-1.59812],[41.00099,-.83068],[40.98767,2.82959],[41.31368,3.14314],[41.89488,3.97375],[41.1754,3.94079],[40.77498,4.27683],[39.86043,3.86974],[39.76808,3.67058],[39.58339,3.47434],[39.55132,3.39634],[39.51551,3.40895],[39.49444,3.45521],[39.19954,3.47834],[39.07736,3.5267],[38.91938,3.51198],[38.52336,3.62551],[38.45812,3.60445],[38.14168,3.62487],[37.07724,4.33503],[36.84474,4.44518],[36.03924,4.44406],[35.95449,4.53244],[35.9419,4.61933]]]]}},{type:"Feature",properties:{iso1A2:"KG",iso1A3:"KGZ",iso1N3:"417",wikidata:"Q813",nameEn:"Kyrgyzstan",groups:["143","142","UN"],callingCodes:["996"]},geometry:{type:"MultiPolygon",coordinates:[[[[74.88756,42.98612],[74.75,42.99029],[74.70331,43.02519],[74.64615,43.05881],[74.57491,43.13702],[74.22489,43.24657],[73.55634,43.03071],[73.50992,42.82356],[73.44393,42.43098],[71.88792,42.83578],[71.62405,42.76613],[71.53272,42.8014],[71.2724,42.77853],[71.22785,42.69248],[71.17807,42.67381],[71.15232,42.60486],[70.97717,42.50147],[70.85973,42.30188],[70.94483,42.26238],[71.13263,42.28356],[71.28719,42.18033],[70.69777,41.92554],[70.17682,41.5455],[70.48909,41.40335],[70.67586,41.47953],[70.78572,41.36419],[70.77885,41.24813],[70.86263,41.23833],[70.9615,41.16393],[71.02193,41.19494],[71.11806,41.15359],[71.25813,41.18796],[71.27187,41.11015],[71.34877,41.16807],[71.40198,41.09436],[71.46148,41.13958],[71.43814,41.19644],[71.46688,41.31883],[71.57227,41.29175],[71.6787,41.42111],[71.65914,41.49599],[71.73054,41.54713],[71.71132,41.43012],[71.76625,41.4466],[71.83914,41.3546],[71.91457,41.2982],[71.85964,41.19081],[72.07249,41.11739],[72.10745,41.15483],[72.16433,41.16483],[72.17594,41.15522],[72.14864,41.13363],[72.1792,41.10621],[72.21061,41.05607],[72.17594,41.02377],[72.18339,40.99571],[72.324,41.03381],[72.34026,41.04539],[72.34757,41.06104],[72.36138,41.04384],[72.38511,41.02785],[72.45206,41.03018],[72.48742,40.97136],[72.55109,40.96046],[72.59136,40.86947],[72.68157,40.84942],[72.84291,40.85512],[72.94454,40.8094],[73.01869,40.84681],[73.13267,40.83512],[73.13412,40.79122],[73.0612,40.76678],[72.99133,40.76457],[72.93296,40.73089],[72.8722,40.71111],[72.85372,40.7116],[72.84754,40.67229],[72.80137,40.67856],[72.74866,40.60873],[72.74894,40.59592],[72.75982,40.57273],[72.74862,40.57131],[72.74768,40.58051],[72.73995,40.58409],[72.69579,40.59778],[72.66713,40.59076],[72.66713,40.5219],[72.47795,40.5532],[72.40517,40.61917],[72.34406,40.60144],[72.41714,40.55736],[72.38384,40.51535],[72.41513,40.50856],[72.44191,40.48222],[72.40346,40.4007],[72.24368,40.46091],[72.18648,40.49893],[71.96401,40.31907],[72.05464,40.27586],[71.85002,40.25647],[71.82646,40.21872],[71.73054,40.14818],[71.71719,40.17886],[71.69621,40.18492],[71.70569,40.20391],[71.68386,40.26984],[71.61931,40.26775],[71.61725,40.20615],[71.51549,40.22986],[71.51215,40.26943],[71.4246,40.28619],[71.36663,40.31593],[71.13042,40.34106],[71.05901,40.28765],[70.95789,40.28761],[70.9818,40.22392],[70.80495,40.16813],[70.7928,40.12797],[70.65827,40.0981],[70.65946,39.9878],[70.58912,39.95211],[70.55033,39.96619],[70.47557,39.93216],[70.57384,39.99394],[70.58297,40.00891],[70.01283,40.23288],[69.67001,40.10639],[69.64704,40.12165],[69.57615,40.10524],[69.55555,40.12296],[69.53794,40.11833],[69.53855,40.0887],[69.5057,40.03277],[69.53615,39.93991],[69.43557,39.92877],[69.43134,39.98431],[69.35649,40.01994],[69.26938,39.8127],[69.3594,39.52516],[69.68677,39.59281],[69.87491,39.53882],[70.11111,39.58223],[70.2869,39.53141],[70.44757,39.60128],[70.64087,39.58792],[70.7854,39.38933],[71.06418,39.41586],[71.08752,39.50704],[71.49814,39.61397],[71.55856,39.57588],[71.5517,39.45722],[71.62688,39.44056],[71.76816,39.45456],[71.80164,39.40631],[71.7522,39.32031],[71.79202,39.27355],[71.90601,39.27674],[72.04059,39.36704],[72.09689,39.26823],[72.17242,39.2661],[72.23834,39.17248],[72.33173,39.33093],[72.62027,39.39696],[72.85934,39.35116],[73.18454,39.35536],[73.31912,39.38615],[73.45096,39.46677],[73.59831,39.46425],[73.87018,39.47879],[73.94683,39.60733],[73.92354,39.69565],[73.9051,39.75073],[73.83006,39.76136],[73.97049,40.04378],[74.25533,40.13191],[74.35063,40.09742],[74.69875,40.34668],[74.85996,40.32857],[74.78168,40.44886],[74.82013,40.52197],[75.08243,40.43945],[75.22834,40.45382],[75.5854,40.66874],[75.69663,40.28642],[75.91361,40.2948],[75.96168,40.38064],[76.33659,40.3482],[76.5261,40.46114],[76.75681,40.95354],[76.99302,41.0696],[77.28004,41.0033],[77.3693,41.0375],[77.52723,41.00227],[77.76206,41.01574],[77.81287,41.14307],[78.12873,41.23091],[78.15757,41.38565],[78.3732,41.39603],[79.92977,42.04113],[80.17842,42.03211],[80.17807,42.21166],[79.97364,42.42816],[79.52921,42.44778],[79.19763,42.804],[78.91502,42.76839],[78.48469,42.89649],[75.82823,42.94848],[75.72174,42.79672],[75.29966,42.86183],[75.22619,42.85528],[74.88756,42.98612]],[[70.74189,39.86319],[70.63105,39.77923],[70.59667,39.83542],[70.54998,39.85137],[70.52631,39.86989],[70.53651,39.89155],[70.74189,39.86319]],[[71.86463,39.98598],[71.84316,39.95582],[71.7504,39.93701],[71.71511,39.96348],[71.78838,40.01404],[71.86463,39.98598]],[[71.21139,40.03369],[71.1427,39.95026],[71.23067,39.93581],[71.16101,39.88423],[71.10531,39.91354],[71.04979,39.89808],[71.10501,39.95568],[71.09063,39.99],[71.11668,39.99291],[71.11037,40.01984],[71.01035,40.05481],[71.00236,40.18154],[71.06305,40.1771],[71.12218,40.03052],[71.21139,40.03369]]]]}},{type:"Feature",properties:{iso1A2:"KH",iso1A3:"KHM",iso1N3:"116",wikidata:"Q424",nameEn:"Cambodia",groups:["035","142","UN"],callingCodes:["855"]},geometry:{type:"MultiPolygon",coordinates:[[[[105.87328,11.55953],[105.81645,11.56876],[105.80867,11.60536],[105.8507,11.66635],[105.88962,11.67854],[105.95188,11.63738],[106.00792,11.7197],[106.02038,11.77457],[106.06708,11.77761],[106.13158,11.73283],[106.18539,11.75171],[106.26478,11.72122],[106.30525,11.67549],[106.37219,11.69836],[106.44691,11.66787],[106.45158,11.68616],[106.41577,11.76999],[106.44535,11.8279],[106.44068,11.86294],[106.4687,11.86751],[106.4111,11.97413],[106.70687,11.96956],[106.79405,12.0807],[106.92325,12.06548],[106.99953,12.08983],[107.15831,12.27547],[107.34511,12.33327],[107.42917,12.24657],[107.4463,12.29373],[107.55059,12.36824],[107.5755,12.52177],[107.55993,12.7982],[107.49611,12.88926],[107.49144,13.01215],[107.62843,13.3668],[107.61909,13.52577],[107.53503,13.73908],[107.45252,13.78897],[107.46498,13.91593],[107.44318,13.99751],[107.38247,13.99147],[107.35757,14.02319],[107.37158,14.07906],[107.33577,14.11832],[107.40427,14.24509],[107.39493,14.32655],[107.44941,14.41552],[107.48521,14.40346],[107.52569,14.54665],[107.52102,14.59034],[107.55371,14.628],[107.54361,14.69092],[107.47238,14.61523],[107.44435,14.52785],[107.37897,14.54443],[107.3276,14.58812],[107.29803,14.58963],[107.26534,14.54292],[107.256,14.48716],[107.21241,14.48716],[107.17038,14.41782],[107.09722,14.3937],[107.03962,14.45099],[107.04585,14.41782],[106.98825,14.36806],[106.9649,14.3198],[106.90574,14.33639],[106.8497,14.29416],[106.80767,14.31226],[106.73762,14.42687],[106.63333,14.44194],[106.59908,14.50977],[106.57106,14.50525],[106.54148,14.59565],[106.50723,14.58963],[106.45898,14.55045],[106.47766,14.50977],[106.43874,14.52032],[106.40916,14.45249],[106.32355,14.44043],[106.25194,14.48415],[106.21302,14.36203],[106.00131,14.36957],[105.99509,14.32734],[106.02311,14.30623],[106.04801,14.20363],[106.10872,14.18401],[106.11962,14.11307],[106.18656,14.06324],[106.16632,14.01794],[106.10094,13.98471],[106.10405,13.9137],[105.90791,13.92881],[105.78182,14.02247],[105.78338,14.08438],[105.5561,14.15684],[105.44869,14.10703],[105.36775,14.09948],[105.2759,14.17496],[105.20894,14.34967],[105.17748,14.34432],[105.14012,14.23873],[105.08408,14.20402],[105.02804,14.23722],[104.97667,14.38806],[104.69335,14.42726],[104.55014,14.36091],[104.27616,14.39861],[103.93836,14.3398],[103.70175,14.38052],[103.71109,14.4348],[103.53518,14.42575],[103.39353,14.35639],[103.16469,14.33075],[102.93275,14.19044],[102.91251,14.01531],[102.77864,13.93374],[102.72727,13.77806],[102.56848,13.69366],[102.5481,13.6589],[102.58635,13.6286],[102.62483,13.60883],[102.57573,13.60461],[102.5358,13.56933],[102.44601,13.5637],[102.36859,13.57488],[102.33828,13.55613],[102.361,13.50551],[102.35563,13.47307],[102.35692,13.38274],[102.34611,13.35618],[102.36001,13.31142],[102.36146,13.26006],[102.43422,13.09061],[102.46011,13.08057],[102.52275,12.99813],[102.48694,12.97537],[102.49335,12.92711],[102.53053,12.77506],[102.4994,12.71736],[102.51963,12.66117],[102.57567,12.65358],[102.7796,12.43781],[102.78116,12.40284],[102.73134,12.37091],[102.70176,12.1686],[102.77026,12.06815],[102.78427,11.98746],[102.83957,11.8519],[102.90973,11.75613],[102.91449,11.65512],[102.52395,11.25257],[102.47649,9.66162],[103.99198,10.48391],[104.43778,10.42386],[104.47963,10.43046],[104.49869,10.4057],[104.59018,10.53073],[104.87933,10.52833],[104.95094,10.64003],[105.09571,10.72722],[105.02722,10.89236],[105.08326,10.95656],[105.11449,10.96332],[105.34011,10.86179],[105.42884,10.96878],[105.50045,10.94586],[105.77751,11.03671],[105.86376,10.89839],[105.84603,10.85873],[105.93403,10.83853],[105.94535,10.9168],[106.06708,10.8098],[106.18539,10.79451],[106.14301,10.98176],[106.20095,10.97795],[106.1757,11.07301],[106.1527,11.10476],[106.10444,11.07879],[105.86782,11.28343],[105.88962,11.43605],[105.87328,11.55953]]]]}},{type:"Feature",properties:{iso1A2:"KI",iso1A3:"KIR",iso1N3:"296",wikidata:"Q710",nameEn:"Kiribati",groups:["057","009","UN"],driveSide:"left",callingCodes:["686"]},geometry:{type:"MultiPolygon",coordinates:[[[[169,3.9],[169,-3.5],[178,-3.5],[178,3.9],[169,3.9]]],[[[-161.06795,5.2462],[-158.12991,-1.86122],[-175.33482,-1.40631],[-175.31804,-7.54825],[-156.50903,-7.4975],[-156.48634,-15.52824],[-135.59706,-4.70473],[-161.06795,5.2462]]]]}},{type:"Feature",properties:{iso1A2:"KM",iso1A3:"COM",iso1N3:"174",wikidata:"Q970",nameEn:"Comoros",groups:["014","202","002","UN"],callingCodes:["269"]},geometry:{type:"MultiPolygon",coordinates:[[[[42.63904,-10.02522],[43.28731,-13.97126],[45.4971,-11.75965],[42.63904,-10.02522]]]]}},{type:"Feature",properties:{iso1A2:"KN",iso1A3:"KNA",iso1N3:"659",wikidata:"Q763",nameEn:"St. Kitts and Nevis",groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 869"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.29333,17.43155],[-62.76692,17.64353],[-63.09677,17.21372],[-62.63813,16.65446],[-62.29333,17.43155]]]]}},{type:"Feature",properties:{iso1A2:"KP",iso1A3:"PRK",iso1N3:"408",wikidata:"Q423",nameEn:"North Korea",groups:["030","142","UN"],callingCodes:["850"]},geometry:{type:"MultiPolygon",coordinates:[[[[130.26095,42.9027],[130.09764,42.91425],[130.12957,42.98361],[129.96409,42.97306],[129.95082,43.01051],[129.8865,43.00395],[129.85261,42.96494],[129.83277,42.86746],[129.80719,42.79218],[129.7835,42.76521],[129.77183,42.69435],[129.75294,42.59409],[129.72541,42.43739],[129.60482,42.44461],[129.54701,42.37254],[129.42882,42.44702],[129.28541,42.41574],[129.22423,42.3553],[129.22285,42.26491],[129.15178,42.17224],[128.96068,42.06657],[128.94007,42.03537],[128.04487,42.01769],[128.15119,41.74568],[128.30716,41.60322],[128.20061,41.40895],[128.18546,41.41279],[128.12967,41.37931],[128.03311,41.39232],[128.02633,41.42103],[127.92943,41.44291],[127.29712,41.49473],[127.17841,41.59714],[126.90729,41.79955],[126.60631,41.65565],[126.53189,41.35206],[126.242,41.15454],[126.00335,40.92835],[125.76869,40.87908],[125.71172,40.85223],[124.86913,40.45387],[124.40719,40.13655],[124.38556,40.11047],[124.3322,40.05573],[124.37089,40.03004],[124.35029,39.95639],[124.23201,39.9248],[124.17532,39.8232],[123.90497,38.79949],[123.85601,37.49093],[124.67666,38.05679],[124.84224,37.977],[124.87921,37.80827],[125.06408,37.66334],[125.37112,37.62643],[125.81159,37.72949],[126.13074,37.70512],[126.18776,37.74728],[126.19097,37.81462],[126.24402,37.83113],[126.43239,37.84095],[126.46818,37.80873],[126.56709,37.76857],[126.59918,37.76364],[126.66067,37.7897],[126.68793,37.83728],[126.68793,37.9175],[126.67023,37.95852],[126.84961,38.0344],[126.88106,38.10246],[126.95887,38.1347],[126.95338,38.17735],[127.04479,38.25518],[127.15749,38.30722],[127.38727,38.33227],[127.49672,38.30647],[127.55013,38.32257],[128.02917,38.31861],[128.27652,38.41657],[128.31105,38.58462],[128.37487,38.62345],[128.65655,38.61914],[131.95041,41.5445],[130.65022,42.32281],[130.66367,42.38024],[130.64181,42.41422],[130.60805,42.4317],[130.56835,42.43281],[130.55143,42.52158],[130.50123,42.61636],[130.44361,42.54849],[130.41826,42.6011],[130.2385,42.71127],[130.23068,42.80125],[130.26095,42.9027]]]]}},{type:"Feature",properties:{iso1A2:"KR",iso1A3:"KOR",iso1N3:"410",wikidata:"Q884",nameEn:"South Korea",groups:["030","142","UN"],callingCodes:["82"]},geometry:{type:"MultiPolygon",coordinates:[[[[133.11729,37.53115],[128.65655,38.61914],[128.37487,38.62345],[128.31105,38.58462],[128.27652,38.41657],[128.02917,38.31861],[127.55013,38.32257],[127.49672,38.30647],[127.38727,38.33227],[127.15749,38.30722],[127.04479,38.25518],[126.95338,38.17735],[126.95887,38.1347],[126.88106,38.10246],[126.84961,38.0344],[126.67023,37.95852],[126.68793,37.9175],[126.68793,37.83728],[126.66067,37.7897],[126.59918,37.76364],[126.56709,37.76857],[126.46818,37.80873],[126.43239,37.84095],[126.24402,37.83113],[126.19097,37.81462],[126.18776,37.74728],[126.13074,37.70512],[125.81159,37.72949],[125.37112,37.62643],[125.06408,37.66334],[124.87921,37.80827],[124.84224,37.977],[124.67666,38.05679],[123.85601,37.49093],[122.80525,33.30571],[125.99728,32.63328],[129.2669,34.87122],[133.11729,37.53115]]]]}},{type:"Feature",properties:{iso1A2:"KW",iso1A3:"KWT",iso1N3:"414",wikidata:"Q817",nameEn:"Kuwait",groups:["145","142","UN"],callingCodes:["965"]},geometry:{type:"MultiPolygon",coordinates:[[[[49.00421,28.81495],[48.59531,29.66815],[48.40479,29.85763],[48.17332,30.02448],[48.06782,30.02906],[48.01114,29.98906],[47.7095,30.10453],[47.37192,30.10421],[47.15166,30.01044],[46.89695,29.50584],[46.5527,29.10283],[47.46202,29.0014],[47.58376,28.83382],[47.59863,28.66798],[47.70561,28.5221],[48.42991,28.53628],[49.00421,28.81495]]]]}},{type:"Feature",properties:{iso1A2:"KY",iso1A3:"CYM",iso1N3:"136",wikidata:"Q5785",nameEn:"Cayman Islands",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 345"]},geometry:{type:"MultiPolygon",coordinates:[[[[-82.11509,19.60401],[-80.36068,18.11751],[-79.32727,20.06742],[-82.11509,19.60401]]]]}},{type:"Feature",properties:{iso1A2:"KZ",iso1A3:"KAZ",iso1N3:"398",wikidata:"Q232",nameEn:"Kazakhstan",groups:["143","142","UN"],callingCodes:["7"]},geometry:{type:"MultiPolygon",coordinates:[[[[68.90865,55.38148],[68.19206,55.18823],[68.26661,55.09226],[68.21308,54.98645],[65.20174,54.55216],[65.24663,54.35721],[65.11033,54.33028],[64.97216,54.4212],[63.97686,54.29763],[64.02715,54.22679],[63.91224,54.20013],[63.80604,54.27079],[62.58651,54.05871],[62.56876,53.94047],[62.45931,53.90737],[62.38535,54.03961],[62.00966,54.04134],[62.03913,53.94768],[61.65318,54.02445],[61.56941,53.95703],[61.47603,54.08048],[61.3706,54.08464],[61.26863,53.92797],[60.99796,53.93699],[61.14283,53.90063],[61.22574,53.80268],[60.90626,53.62937],[61.55706,53.57144],[61.57185,53.50112],[61.37957,53.45887],[61.29082,53.50992],[61.14291,53.41481],[61.19024,53.30536],[62.14574,53.09626],[62.12799,52.99133],[62.0422,52.96105],[61.23462,53.03227],[61.05842,52.92217],[60.71989,52.75923],[60.71693,52.66245],[60.84118,52.63912],[60.84709,52.52228],[60.98021,52.50068],[61.05417,52.35096],[60.78201,52.22067],[60.72581,52.15538],[60.48915,52.15175],[60.19925,51.99173],[59.99809,51.98263],[60.09867,51.87135],[60.50986,51.7964],[60.36787,51.66815],[60.5424,51.61675],[60.92401,51.61124],[60.95655,51.48615],[61.50677,51.40687],[61.55114,51.32746],[61.6813,51.25716],[61.56889,51.23679],[61.4431,50.80679],[60.81833,50.6629],[60.31914,50.67705],[60.17262,50.83312],[60.01288,50.8163],[59.81172,50.54451],[59.51886,50.49937],[59.48928,50.64216],[58.87974,50.70852],[58.3208,51.15151],[57.75578,51.13852],[57.74986,50.93017],[57.44221,50.88354],[57.17302,51.11253],[56.17906,50.93204],[56.11398,50.7471],[55.67774,50.54508],[54.72067,51.03261],[54.56685,51.01958],[54.71476,50.61214],[54.55797,50.52006],[54.41894,50.61214],[54.46331,50.85554],[54.12248,51.11542],[53.69299,51.23466],[53.46165,51.49445],[52.54329,51.48444],[52.36119,51.74161],[51.8246,51.67916],[51.77431,51.49536],[51.301,51.48799],[51.26254,51.68466],[50.59695,51.61859],[50.26859,51.28677],[49.97277,51.2405],[49.76866,51.11067],[49.39001,51.09396],[49.41959,50.85927],[49.12673,50.78639],[48.86936,50.61589],[48.57946,50.63278],[48.90782,50.02281],[48.68352,49.89546],[48.42564,49.82283],[48.24519,49.86099],[48.10044,50.09242],[47.58551,50.47867],[47.30448,50.30894],[47.34589,50.09308],[47.18319,49.93721],[46.9078,49.86707],[46.78398,49.34026],[47.04658,49.19834],[47.00857,49.04921],[46.78392,48.95352],[46.49011,48.43019],[47.11516,48.27188],[47.12107,47.83687],[47.38731,47.68176],[47.41689,47.83687],[47.64973,47.76559],[48.15348,47.74545],[48.45173,47.40818],[48.52326,47.4102],[49.01136,46.72716],[48.51142,46.69268],[48.54988,46.56267],[49.16518,46.38542],[49.32259,46.26944],[49.88945,46.04554],[49.2134,44.84989],[52.26048,41.69249],[52.47884,41.78034],[52.97575,42.1308],[54.20635,42.38477],[54.95182,41.92424],[55.45471,41.25609],[56.00314,41.32584],[55.97584,44.99322],[55.97584,44.99328],[55.97584,44.99338],[55.97584,44.99343],[55.97584,44.99348],[55.97584,44.99353],[55.97584,44.99359],[55.97584,44.99369],[55.97584,44.99374],[55.97584,44.99384],[55.97584,44.9939],[55.97584,44.994],[55.97584,44.99405],[55.97584,44.99415],[55.97584,44.99421],[55.97584,44.99426],[55.97584,44.99431],[55.97584,44.99436],[55.97584,44.99441],[55.97594,44.99446],[55.97605,44.99452],[55.97605,44.99457],[55.97605,44.99462],[55.97605,44.99467],[55.97605,44.99477],[55.97615,44.99477],[55.97615,44.99483],[55.97615,44.99493],[55.97615,44.99498],[55.97615,44.99503],[55.97615,44.99508],[55.97625,44.99514],[55.97636,44.99519],[55.97636,44.99524],[55.97646,44.99529],[55.97646,44.99534],[55.97656,44.99539],[55.97667,44.99545],[55.97677,44.9955],[55.97677,44.99555],[55.97677,44.9956],[55.97687,44.9956],[55.97698,44.99565],[55.97698,44.9957],[55.97708,44.99576],[55.97718,44.99581],[55.97729,44.99586],[55.97739,44.99586],[55.97739,44.99591],[55.97749,44.99591],[55.9776,44.99591],[55.9777,44.99596],[55.9777,44.99601],[55.9778,44.99607],[55.97791,44.99607],[55.97801,44.99607],[55.97801,44.99612],[55.97811,44.99617],[55.97822,44.99617],[55.97832,44.99622],[55.97842,44.99622],[58.59711,45.58671],[61.01475,44.41383],[62.01711,43.51008],[63.34656,43.64003],[64.53885,43.56941],[64.96464,43.74748],[65.18666,43.48835],[65.53277,43.31856],[65.85194,42.85481],[66.09482,42.93426],[66.00546,41.94455],[66.53302,41.87388],[66.69129,41.1311],[67.9644,41.14611],[67.98511,41.02794],[68.08273,41.08148],[68.1271,41.0324],[67.96736,40.83798],[68.49983,40.56437],[68.63,40.59358],[68.58444,40.91447],[68.49983,40.99669],[68.62221,41.03019],[68.65662,40.93861],[68.73945,40.96989],[68.7217,41.05025],[69.01308,41.22804],[69.05006,41.36183],[69.15137,41.43078],[69.17701,41.43769],[69.18528,41.45175],[69.20439,41.45391],[69.22671,41.46298],[69.23332,41.45847],[69.25059,41.46693],[69.29778,41.43673],[69.35554,41.47211],[69.37468,41.46555],[69.45081,41.46246],[69.39485,41.51518],[69.45751,41.56863],[69.49545,41.545],[70.94483,42.26238],[70.85973,42.30188],[70.97717,42.50147],[71.15232,42.60486],[71.17807,42.67381],[71.22785,42.69248],[71.2724,42.77853],[71.53272,42.8014],[71.62405,42.76613],[71.88792,42.83578],[73.44393,42.43098],[73.50992,42.82356],[73.55634,43.03071],[74.22489,43.24657],[74.57491,43.13702],[74.64615,43.05881],[74.70331,43.02519],[74.75,42.99029],[74.88756,42.98612],[75.22619,42.85528],[75.29966,42.86183],[75.72174,42.79672],[75.82823,42.94848],[78.48469,42.89649],[78.91502,42.76839],[79.19763,42.804],[79.52921,42.44778],[79.97364,42.42816],[80.17807,42.21166],[80.26841,42.23797],[80.16892,42.61137],[80.26886,42.8366],[80.38169,42.83142],[80.58999,42.9011],[80.3735,43.01557],[80.62913,43.141],[80.78817,43.14235],[80.77771,43.30065],[80.69718,43.32589],[80.75156,43.44948],[80.40031,44.10986],[80.40229,44.23319],[80.38384,44.63073],[79.8987,44.89957],[80.11169,45.03352],[81.73278,45.3504],[82.51374,45.1755],[82.58474,45.40027],[82.21792,45.56619],[83.04622,47.19053],[83.92184,46.98912],[84.73077,47.01394],[84.93995,46.87399],[85.22443,47.04816],[85.54294,47.06171],[85.69696,47.2898],[85.61067,47.49753],[85.5169,48.05493],[85.73581,48.3939],[86.38069,48.46064],[86.75343,48.70331],[86.73568,48.99918],[86.87238,49.12432],[87.28386,49.11626],[87.31465,49.23603],[87.03071,49.25142],[86.82606,49.51796],[86.61307,49.60239],[86.79056,49.74787],[86.63674,49.80136],[86.18709,49.50259],[85.24047,49.60239],[84.99198,50.06793],[84.29385,50.27257],[83.8442,50.87375],[83.14607,51.00796],[82.55443,50.75412],[81.94999,50.79307],[81.46581,50.77658],[81.41248,50.97524],[81.06091,50.94833],[81.16999,51.15662],[80.80318,51.28262],[80.44819,51.20855],[80.4127,50.95581],[80.08138,50.77658],[79.11255,52.01171],[77.90383,53.29807],[76.54243,53.99329],[76.44076,54.16017],[76.82266,54.1798],[76.91052,54.4677],[75.3668,54.07439],[75.43398,53.98652],[75.07405,53.80831],[73.39218,53.44623],[73.25412,53.61532],[73.68921,53.86522],[73.74778,54.07194],[73.37963,53.96132],[72.71026,54.1161],[72.43415,53.92685],[72.17477,54.36303],[71.96141,54.17736],[71.10379,54.13326],[71.08706,54.33376],[71.24185,54.64965],[71.08288,54.71253],[70.96009,55.10558],[70.76493,55.3027],[70.19179,55.1476],[69.74917,55.35545],[69.34224,55.36344],[68.90865,55.38148]]]]}},{type:"Feature",properties:{iso1A2:"LA",iso1A3:"LAO",iso1N3:"418",wikidata:"Q819",nameEn:"Laos",groups:["035","142","UN"],callingCodes:["856"]},geometry:{type:"MultiPolygon",coordinates:[[[[102.1245,22.43372],[102.03633,22.46164],[101.98487,22.42766],[101.91344,22.44417],[101.90714,22.38688],[101.86828,22.38397],[101.7685,22.50337],[101.68973,22.46843],[101.61306,22.27515],[101.56789,22.28876],[101.53638,22.24794],[101.60675,22.13513],[101.57525,22.13026],[101.62566,21.96574],[101.7791,21.83019],[101.74555,21.72852],[101.83257,21.61562],[101.80001,21.57461],[101.7475,21.5873],[101.7727,21.51794],[101.74224,21.48276],[101.74014,21.30967],[101.84412,21.25291],[101.83887,21.20983],[101.76745,21.21571],[101.79266,21.19025],[101.7622,21.14813],[101.70548,21.14911],[101.66977,21.20004],[101.60886,21.17947],[101.59491,21.18621],[101.6068,21.23329],[101.54563,21.25668],[101.29326,21.17254],[101.2229,21.23271],[101.26912,21.36482],[101.19349,21.41959],[101.2124,21.56422],[101.15156,21.56129],[101.16198,21.52808],[101.00234,21.39612],[100.80173,21.2934],[100.72716,21.31786],[100.63578,21.05639],[100.55281,21.02796],[100.50974,20.88574],[100.64628,20.88279],[100.60112,20.8347],[100.51079,20.82194],[100.36375,20.82783],[100.1957,20.68247],[100.08404,20.36626],[100.09999,20.31614],[100.09337,20.26293],[100.11785,20.24787],[100.1712,20.24324],[100.16668,20.2986],[100.22076,20.31598],[100.25769,20.3992],[100.33383,20.4028],[100.37439,20.35156],[100.41473,20.25625],[100.44992,20.23644],[100.4537,20.19971],[100.47567,20.19133],[100.51052,20.14928],[100.55218,20.17741],[100.58808,20.15791],[100.5094,19.87904],[100.398,19.75047],[100.49604,19.53504],[100.58219,19.49164],[100.64606,19.55884],[100.77231,19.48324],[100.90302,19.61901],[101.08928,19.59748],[101.26545,19.59242],[101.26991,19.48324],[101.21347,19.46223],[101.20604,19.35296],[101.24911,19.33334],[101.261,19.12717],[101.35606,19.04716],[101.25803,18.89545],[101.22832,18.73377],[101.27585,18.68875],[101.06047,18.43247],[101.18227,18.34367],[101.15108,18.25624],[101.19118,18.2125],[101.1793,18.0544],[101.02185,17.87637],[100.96541,17.57926],[101.15108,17.47586],[101.44667,17.7392],[101.72294,17.92867],[101.78087,18.07559],[101.88485,18.02474],[102.11359,18.21532],[102.45523,17.97106],[102.59234,17.96127],[102.60971,17.95411],[102.61432,17.92273],[102.5896,17.84889],[102.59485,17.83537],[102.68194,17.80151],[102.69946,17.81686],[102.67543,17.84529],[102.68538,17.86653],[102.75954,17.89561],[102.79044,17.93612],[102.81988,17.94233],[102.86323,17.97531],[102.95812,18.0054],[102.9912,17.9949],[103.01998,17.97095],[103.0566,18.00144],[103.07823,18.03833],[103.07343,18.12351],[103.1493,18.17799],[103.14994,18.23172],[103.17093,18.2618],[103.29757,18.30475],[103.23818,18.34875],[103.24779,18.37807],[103.30977,18.4341],[103.41044,18.4486],[103.47773,18.42841],[103.60957,18.40528],[103.699,18.34125],[103.82449,18.33979],[103.85642,18.28666],[103.93916,18.33914],[103.97725,18.33631],[104.06533,18.21656],[104.10927,18.10826],[104.21776,17.99335],[104.2757,17.86139],[104.35432,17.82871],[104.45404,17.66788],[104.69867,17.53038],[104.80061,17.39367],[104.80716,17.19025],[104.73712,17.01404],[104.7373,16.91125],[104.76442,16.84752],[104.7397,16.81005],[104.76099,16.69302],[104.73349,16.565],[104.88057,16.37311],[105.00262,16.25627],[105.06204,16.09792],[105.42001,16.00657],[105.38508,15.987],[105.34115,15.92737],[105.37959,15.84074],[105.42285,15.76971],[105.46573,15.74742],[105.61756,15.68792],[105.60446,15.53301],[105.58191,15.41031],[105.47635,15.3796],[105.4692,15.33709],[105.50662,15.32054],[105.58043,15.32724],[105.46661,15.13132],[105.61162,15.00037],[105.5121,14.80802],[105.53864,14.55731],[105.43783,14.43865],[105.20894,14.34967],[105.2759,14.17496],[105.36775,14.09948],[105.44869,14.10703],[105.5561,14.15684],[105.78338,14.08438],[105.78182,14.02247],[105.90791,13.92881],[106.10405,13.9137],[106.10094,13.98471],[106.16632,14.01794],[106.18656,14.06324],[106.11962,14.11307],[106.10872,14.18401],[106.04801,14.20363],[106.02311,14.30623],[105.99509,14.32734],[106.00131,14.36957],[106.21302,14.36203],[106.25194,14.48415],[106.32355,14.44043],[106.40916,14.45249],[106.43874,14.52032],[106.47766,14.50977],[106.45898,14.55045],[106.50723,14.58963],[106.54148,14.59565],[106.57106,14.50525],[106.59908,14.50977],[106.63333,14.44194],[106.73762,14.42687],[106.80767,14.31226],[106.8497,14.29416],[106.90574,14.33639],[106.9649,14.3198],[106.98825,14.36806],[107.04585,14.41782],[107.03962,14.45099],[107.09722,14.3937],[107.17038,14.41782],[107.21241,14.48716],[107.256,14.48716],[107.26534,14.54292],[107.29803,14.58963],[107.3276,14.58812],[107.37897,14.54443],[107.44435,14.52785],[107.47238,14.61523],[107.54361,14.69092],[107.51579,14.79282],[107.59285,14.87795],[107.48277,14.93751],[107.46516,15.00982],[107.61486,15.0566],[107.61926,15.13949],[107.58844,15.20111],[107.62587,15.2266],[107.60605,15.37524],[107.62367,15.42193],[107.53341,15.40496],[107.50699,15.48771],[107.3815,15.49832],[107.34408,15.62345],[107.27583,15.62769],[107.27143,15.71459],[107.21859,15.74638],[107.21419,15.83747],[107.34188,15.89464],[107.39471,15.88829],[107.46296,16.01106],[107.44975,16.08511],[107.33968,16.05549],[107.25822,16.13587],[107.14595,16.17816],[107.15035,16.26271],[107.09091,16.3092],[107.02597,16.31132],[106.97385,16.30204],[106.96638,16.34938],[106.88067,16.43594],[106.88727,16.52671],[106.84104,16.55415],[106.74418,16.41904],[106.65832,16.47816],[106.66052,16.56892],[106.61477,16.60713],[106.58267,16.6012],[106.59013,16.62259],[106.55485,16.68704],[106.55265,16.86831],[106.52183,16.87884],[106.51963,16.92097],[106.54824,16.92729],[106.55045,17.0031],[106.50862,16.9673],[106.43597,17.01362],[106.31929,17.20509],[106.29287,17.3018],[106.24444,17.24714],[106.18991,17.28227],[106.09019,17.36399],[105.85744,17.63221],[105.76612,17.67147],[105.60381,17.89356],[105.64784,17.96687],[105.46292,18.22008],[105.38366,18.15315],[105.15942,18.38691],[105.10408,18.43533],[105.1327,18.58355],[105.19654,18.64196],[105.12829,18.70453],[104.64617,18.85668],[104.5361,18.97747],[103.87125,19.31854],[104.06058,19.43484],[104.10832,19.51575],[104.05617,19.61743],[104.06498,19.66926],[104.23229,19.70242],[104.41281,19.70035],[104.53169,19.61743],[104.64837,19.62365],[104.68359,19.72729],[104.8355,19.80395],[104.8465,19.91783],[104.9874,20.09573],[104.91695,20.15567],[104.86852,20.14121],[104.61315,20.24452],[104.62195,20.36633],[104.72102,20.40554],[104.66158,20.47774],[104.47886,20.37459],[104.40621,20.3849],[104.38199,20.47155],[104.63957,20.6653],[104.27412,20.91433],[104.11121,20.96779],[103.98024,20.91531],[103.82282,20.8732],[103.73478,20.6669],[103.68633,20.66324],[103.45737,20.82382],[103.38032,20.79501],[103.21497,20.89832],[103.12055,20.89994],[103.03469,21.05821],[102.97745,21.05821],[102.89825,21.24707],[102.80794,21.25736],[102.88939,21.3107],[102.94223,21.46034],[102.86297,21.4255],[102.98846,21.58936],[102.97965,21.74076],[102.86077,21.71213],[102.85637,21.84501],[102.81894,21.83888],[102.82115,21.73667],[102.74189,21.66713],[102.67145,21.65894],[102.62301,21.91447],[102.49092,21.99002],[102.51734,22.02676],[102.18712,22.30403],[102.14099,22.40092],[102.1245,22.43372]]]]}},{type:"Feature",properties:{iso1A2:"LB",iso1A3:"LBN",iso1N3:"422",wikidata:"Q822",nameEn:"Lebanon",aliases:["RL"],groups:["145","142","UN"],callingCodes:["961"]},geometry:{type:"MultiPolygon",coordinates:[[[[35.94816,33.47886],[35.94465,33.52774],[36.05723,33.57904],[35.9341,33.6596],[36.06778,33.82927],[36.14517,33.85118],[36.3967,33.83365],[36.38263,33.86579],[36.28589,33.91981],[36.41078,34.05253],[36.50576,34.05982],[36.5128,34.09916],[36.62537,34.20251],[36.59195,34.2316],[36.58667,34.27667],[36.60778,34.31009],[36.56556,34.31881],[36.53039,34.3798],[36.55853,34.41609],[36.46179,34.46541],[36.4442,34.50165],[36.34745,34.5002],[36.3369,34.52629],[36.39846,34.55672],[36.41429,34.61175],[36.45299,34.59438],[36.46003,34.6378],[36.42941,34.62505],[36.35384,34.65447],[36.35135,34.68516],[36.32399,34.69334],[36.29165,34.62991],[35.98718,34.64977],[35.97386,34.63322],[35.48515,34.70851],[34.78515,33.20368],[35.10645,33.09318],[35.1924,33.08743],[35.31429,33.10515],[35.35223,33.05617],[35.43059,33.06659],[35.448,33.09264],[35.50272,33.09056],[35.50335,33.114],[35.52573,33.11921],[35.54228,33.19865],[35.5362,33.23196],[35.54808,33.236],[35.54544,33.25513],[35.55555,33.25844],[35.56523,33.28969],[35.58326,33.28381],[35.58502,33.26653],[35.62283,33.24226],[35.62019,33.27278],[35.77477,33.33609],[35.81324,33.36354],[35.82577,33.40479],[35.88668,33.43183],[35.94816,33.47886]]]]}},{type:"Feature",properties:{iso1A2:"LC",iso1A3:"LCA",iso1N3:"662",wikidata:"Q760",nameEn:"St. Lucia",aliases:["WL"],groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 758"]},geometry:{type:"MultiPolygon",coordinates:[[[[-59.95997,14.20285],[-61.69315,14.26451],[-59.94058,12.34011],[-59.95997,14.20285]]]]}},{type:"Feature",properties:{iso1A2:"LI",iso1A3:"LIE",iso1N3:"438",wikidata:"Q347",nameEn:"Liechtenstein",aliases:["FL"],groups:["155","150","UN"],callingCodes:["423"]},geometry:{type:"MultiPolygon",coordinates:[[[[9.60717,47.06091],[9.61216,47.07732],[9.63395,47.08443],[9.62623,47.14685],[9.56539,47.17124],[9.58264,47.20673],[9.56981,47.21926],[9.55176,47.22585],[9.56766,47.24281],[9.53116,47.27029],[9.52406,47.24959],[9.50318,47.22153],[9.4891,47.19346],[9.48774,47.17402],[9.51044,47.13727],[9.52089,47.10019],[9.51362,47.08505],[9.47139,47.06402],[9.47548,47.05257],[9.54041,47.06495],[9.55721,47.04762],[9.60717,47.06091]]]]}},{type:"Feature",properties:{iso1A2:"LK",iso1A3:"LKA",iso1N3:"144",wikidata:"Q854",nameEn:"Sri Lanka",groups:["034","142","UN"],driveSide:"left",callingCodes:["94"]},geometry:{type:"MultiPolygon",coordinates:[[[[76.59015,5.591],[85.15017,5.21497],[80.48418,10.20786],[79.42124,9.80115],[79.50447,8.91876],[76.59015,5.591]]]]}},{type:"Feature",properties:{iso1A2:"LR",iso1A3:"LBR",iso1N3:"430",wikidata:"Q1014",nameEn:"Liberia",groups:["011","202","002","UN"],callingCodes:["231"]},geometry:{type:"MultiPolygon",coordinates:[[[[-8.47114,7.55676],[-8.55874,7.62525],[-8.55874,7.70167],[-8.67814,7.69428],[-8.72789,7.51429],[-8.8448,7.35149],[-8.85724,7.26019],[-8.93435,7.2824],[-9.09107,7.1985],[-9.18311,7.30461],[-9.20798,7.38109],[-9.305,7.42056],[-9.41943,7.41809],[-9.48161,7.37122],[-9.37465,7.62032],[-9.35724,7.74111],[-9.44928,7.9284],[-9.41445,8.02448],[-9.50898,8.18455],[-9.47415,8.35195],[-9.77763,8.54633],[-10.05873,8.42578],[-10.05375,8.50697],[-10.14579,8.52665],[-10.203,8.47991],[-10.27575,8.48711],[-10.30084,8.30008],[-10.31635,8.28554],[-10.29839,8.21283],[-10.35227,8.15223],[-10.45023,8.15627],[-10.51554,8.1393],[-10.57523,8.04829],[-10.60492,8.04072],[-10.60422,7.7739],[-11.29417,7.21576],[-11.4027,6.97746],[-11.50429,6.92704],[-12.15048,6.15992],[-7.52774,3.7105],[-7.53259,4.35145],[-7.59349,4.8909],[-7.53876,4.94294],[-7.55369,5.08667],[-7.48901,5.14118],[-7.46165,5.26256],[-7.36463,5.32944],[-7.43428,5.42355],[-7.37209,5.61173],[-7.43926,5.74787],[-7.43677,5.84687],[-7.46165,5.84934],[-7.48155,5.80974],[-7.67309,5.94337],[-7.70294,5.90625],[-7.78254,5.99037],[-7.79747,6.07696],[-7.8497,6.08932],[-7.83478,6.20309],[-7.90692,6.27728],[-8.00642,6.31684],[-8.17557,6.28222],[-8.3298,6.36381],[-8.38453,6.35887],[-8.45666,6.49977],[-8.48652,6.43797],[-8.59456,6.50612],[-8.31736,6.82837],[-8.29249,7.1691],[-8.37458,7.25794],[-8.41935,7.51203],[-8.47114,7.55676]]]]}},{type:"Feature",properties:{iso1A2:"LS",iso1A3:"LSO",iso1N3:"426",wikidata:"Q1013",nameEn:"Lesotho",groups:["018","202","002","UN"],driveSide:"left",callingCodes:["266"]},geometry:{type:"MultiPolygon",coordinates:[[[[29.33204,-29.45598],[29.44883,-29.3772],[29.40524,-29.21246],[28.68043,-28.58744],[28.65091,-28.57025],[28.40612,-28.6215],[28.30518,-28.69531],[28.2348,-28.69471],[28.1317,-28.7293],[28.02503,-28.85991],[27.98675,-28.8787],[27.9392,-28.84864],[27.88933,-28.88156],[27.8907,-28.91612],[27.75458,-28.89839],[27.55974,-29.18954],[27.5158,-29.2261],[27.54258,-29.25575],[27.48679,-29.29349],[27.45125,-29.29708],[27.47254,-29.31968],[27.4358,-29.33465],[27.33464,-29.48161],[27.01016,-29.65439],[27.09489,-29.72796],[27.22719,-30.00718],[27.29603,-30.05473],[27.32555,-30.14785],[27.40778,-30.14577],[27.37293,-30.19401],[27.36649,-30.27246],[27.38108,-30.33456],[27.45452,-30.32239],[27.56901,-30.42504],[27.56781,-30.44562],[27.62137,-30.50509],[27.6521,-30.51707],[27.67819,-30.53437],[27.69467,-30.55862],[27.74814,-30.60635],[28.12073,-30.68072],[28.2319,-30.28476],[28.399,-30.1592],[28.68627,-30.12885],[28.80222,-30.10579],[28.9338,-30.05072],[29.16548,-29.91706],[29.12553,-29.76266],[29.28545,-29.58456],[29.33204,-29.45598]]]]}},{type:"Feature",properties:{iso1A2:"LT",iso1A3:"LTU",iso1N3:"440",wikidata:"Q37",nameEn:"Lithuania",groups:["EU","154","150","UN"],callingCodes:["370"]},geometry:{type:"MultiPolygon",coordinates:[[[[24.89005,56.46666],[24.83686,56.41565],[24.70022,56.40483],[24.57353,56.31525],[24.58143,56.29125],[24.42746,56.26522],[24.32334,56.30226],[24.13139,56.24881],[24.02657,56.3231],[23.75726,56.37282],[23.49803,56.34307],[23.40486,56.37689],[23.31606,56.3827],[23.17312,56.36795],[23.09531,56.30511],[22.96988,56.41213],[22.83048,56.367],[22.69354,56.36284],[22.56441,56.39305],[22.3361,56.4016],[22.09728,56.42851],[22.00548,56.41508],[21.74558,56.33181],[21.57888,56.31406],[21.49736,56.29106],[21.24644,56.16917],[21.15016,56.07818],[20.68447,56.04073],[20.60454,55.40986],[20.95181,55.27994],[21.26425,55.24456],[21.35465,55.28427],[21.38446,55.29348],[21.46766,55.21115],[21.51095,55.18507],[21.55605,55.20311],[21.64954,55.1791],[21.85521,55.09493],[21.96505,55.07353],[21.99543,55.08691],[22.03984,55.07888],[22.02582,55.05078],[22.06087,55.02935],[22.11697,55.02131],[22.14267,55.05345],[22.31562,55.0655],[22.47688,55.04408],[22.58907,55.07085],[22.60075,55.01863],[22.65451,54.97037],[22.68723,54.9811],[22.76422,54.92521],[22.85083,54.88711],[22.87317,54.79492],[22.73631,54.72952],[22.73397,54.66604],[22.75467,54.6483],[22.74225,54.64339],[22.7522,54.63525],[22.68021,54.58486],[22.71293,54.56454],[22.67788,54.532],[22.70208,54.45312],[22.7253,54.41732],[22.79705,54.36264],[22.83756,54.40827],[23.00584,54.38514],[22.99649,54.35927],[23.05726,54.34565],[23.04323,54.31567],[23.104,54.29794],[23.13905,54.31567],[23.15526,54.31076],[23.15938,54.29894],[23.24656,54.25701],[23.3494,54.25155],[23.39525,54.21672],[23.42418,54.17911],[23.45223,54.17775],[23.49196,54.14764],[23.52702,54.04622],[23.48261,53.98855],[23.51284,53.95052],[23.61677,53.92691],[23.71726,53.93379],[23.80543,53.89558],[23.81309,53.94205],[23.95098,53.9613],[23.98837,53.92554],[24.19638,53.96405],[24.34128,53.90076],[24.44411,53.90076],[24.62275,54.00217],[24.69652,54.01901],[24.69185,53.96543],[24.74279,53.96663],[24.85311,54.02862],[24.77131,54.11091],[24.96894,54.17589],[24.991,54.14241],[25.0728,54.13419],[25.19199,54.219],[25.22705,54.26271],[25.35559,54.26544],[25.509,54.30267],[25.56823,54.25212],[25.51452,54.17799],[25.54724,54.14925],[25.64875,54.1259],[25.71084,54.16704],[25.78563,54.15747],[25.78553,54.23327],[25.68513,54.31727],[25.55425,54.31591],[25.5376,54.33158],[25.63371,54.42075],[25.62203,54.4656],[25.64813,54.48704],[25.68045,54.5321],[25.75977,54.57252],[25.74122,54.80108],[25.89462,54.93438],[25.99129,54.95705],[26.05907,54.94631],[26.13386,54.98924],[26.20397,54.99729],[26.26941,55.08032],[26.23202,55.10439],[26.30628,55.12536],[26.35121,55.1525],[26.46249,55.12814],[26.51481,55.16051],[26.54753,55.14181],[26.69243,55.16718],[26.68075,55.19787],[26.72983,55.21788],[26.73017,55.24226],[26.835,55.28182],[26.83266,55.30444],[26.80929,55.31642],[26.6714,55.33902],[26.5709,55.32572],[26.44937,55.34832],[26.5522,55.40277],[26.55094,55.5093],[26.63167,55.57887],[26.63231,55.67968],[26.58248,55.6754],[26.46661,55.70375],[26.39561,55.71156],[26.18509,55.86813],[26.03815,55.95884],[25.90047,56.0013],[25.85893,56.00188],[25.81773,56.05444],[25.69246,56.08892],[25.68588,56.14725],[25.53621,56.16663],[25.39751,56.15707],[25.23099,56.19147],[25.09325,56.1878],[25.05762,56.26742],[24.89005,56.46666]]]]}},{type:"Feature",properties:{iso1A2:"LU",iso1A3:"LUX",iso1N3:"442",wikidata:"Q32",nameEn:"Luxembourg",groups:["EU","155","150","UN"],callingCodes:["352"]},geometry:{type:"MultiPolygon",coordinates:[[[[6.1379,50.12964],[6.1137,50.13668],[6.12028,50.16374],[6.08577,50.17246],[6.06406,50.15344],[6.03093,50.16362],[6.02488,50.18283],[5.96453,50.17259],[5.95929,50.13295],[5.89488,50.11476],[5.8857,50.07824],[5.85474,50.06342],[5.86904,50.04614],[5.8551,50.02683],[5.81866,50.01286],[5.82331,49.99662],[5.83968,49.9892],[5.83467,49.97823],[5.81163,49.97142],[5.80833,49.96451],[5.77291,49.96056],[5.77314,49.93646],[5.73621,49.89796],[5.78415,49.87922],[5.75269,49.8711],[5.75861,49.85631],[5.74567,49.85368],[5.75884,49.84811],[5.74953,49.84709],[5.74975,49.83933],[5.74076,49.83823],[5.7404,49.83452],[5.74844,49.82435],[5.74364,49.82058],[5.74953,49.81428],[5.75409,49.79239],[5.78871,49.7962],[5.82245,49.75048],[5.83149,49.74729],[5.82562,49.72395],[5.84193,49.72161],[5.86503,49.72739],[5.88677,49.70951],[5.86527,49.69291],[5.86175,49.67862],[5.9069,49.66377],[5.90164,49.6511],[5.90599,49.63853],[5.88552,49.63507],[5.88393,49.62802],[5.87609,49.62047],[5.8762,49.60898],[5.84826,49.5969],[5.84971,49.58674],[5.86986,49.58756],[5.87256,49.57539],[5.8424,49.56082],[5.84692,49.55663],[5.84143,49.5533],[5.81838,49.54777],[5.80871,49.5425],[5.81664,49.53775],[5.83648,49.5425],[5.84466,49.53027],[5.83467,49.52717],[5.83389,49.52152],[5.86571,49.50015],[5.94128,49.50034],[5.94224,49.49608],[5.96876,49.49053],[5.97693,49.45513],[6.02648,49.45451],[6.02743,49.44845],[6.04176,49.44801],[6.05553,49.46663],[6.07887,49.46399],[6.08373,49.45594],[6.10072,49.45268],[6.09845,49.46351],[6.10325,49.4707],[6.12346,49.4735],[6.12814,49.49365],[6.14321,49.48796],[6.16115,49.49297],[6.15366,49.50226],[6.17386,49.50934],[6.19543,49.50536],[6.2409,49.51408],[6.25029,49.50609],[6.27875,49.503],[6.28818,49.48465],[6.3687,49.4593],[6.36778,49.46937],[6.36907,49.48931],[6.36788,49.50377],[6.35666,49.52931],[6.38072,49.55171],[6.38228,49.55855],[6.35825,49.57053],[6.36676,49.57813],[6.38024,49.57593],[6.38342,49.5799],[6.37464,49.58886],[6.385,49.59946],[6.39822,49.60081],[6.41861,49.61723],[6.4413,49.65722],[6.43768,49.66021],[6.42726,49.66078],[6.42937,49.66857],[6.44654,49.67799],[6.46048,49.69092],[6.48014,49.69767],[6.49785,49.71118],[6.50647,49.71353],[6.5042,49.71808],[6.49694,49.72205],[6.49535,49.72645],[6.50261,49.72718],[6.51397,49.72058],[6.51805,49.72425],[6.50193,49.73291],[6.50174,49.75292],[6.51646,49.75961],[6.51828,49.76855],[6.51056,49.77515],[6.51669,49.78336],[6.50534,49.78952],[6.52169,49.79787],[6.53122,49.80666],[6.52121,49.81338],[6.51215,49.80124],[6.50647,49.80916],[6.48718,49.81267],[6.47111,49.82263],[6.45425,49.81164],[6.44131,49.81443],[6.42905,49.81091],[6.42521,49.81591],[6.40022,49.82029],[6.36576,49.85032],[6.34267,49.84974],[6.33585,49.83785],[6.32098,49.83728],[6.32303,49.85133],[6.30963,49.87021],[6.29692,49.86685],[6.28874,49.87592],[6.26146,49.88203],[6.23496,49.89972],[6.22926,49.92096],[6.21882,49.92403],[6.22608,49.929],[6.22094,49.94955],[6.19856,49.95053],[6.19089,49.96991],[6.18045,49.96611],[6.18554,49.95622],[6.17872,49.9537],[6.16466,49.97086],[6.1701,49.98518],[6.14147,49.99563],[6.14948,50.00908],[6.13806,50.01056],[6.1295,50.01849],[6.13273,50.02019],[6.13794,50.01466],[6.14666,50.02207],[6.13044,50.02929],[6.13458,50.04141],[6.11274,50.05916],[6.12055,50.09171],[6.1379,50.12964]]]]}},{type:"Feature",properties:{iso1A2:"LV",iso1A3:"LVA",iso1N3:"428",wikidata:"Q211",nameEn:"Latvia",groups:["EU","154","150","UN"],callingCodes:["371"]},geometry:{type:"MultiPolygon",coordinates:[[[[27.34698,57.52242],[26.90364,57.62823],[26.54675,57.51813],[26.46527,57.56885],[26.29253,57.59244],[26.1866,57.6849],[26.2029,57.7206],[26.08098,57.76619],[26.0543,57.76105],[26.03332,57.7718],[26.02415,57.76865],[26.02069,57.77169],[26.0266,57.77441],[26.027,57.78158],[26.02456,57.78342],[26.0324,57.79037],[26.05949,57.84744],[25.73499,57.90193],[25.29581,58.08288],[25.28237,57.98539],[25.19484,58.0831],[24.3579,57.87471],[24.26221,57.91787],[23.20055,57.56697],[22.80496,57.87798],[19.84909,57.57876],[19.64795,57.06466],[20.68447,56.04073],[21.15016,56.07818],[21.24644,56.16917],[21.49736,56.29106],[21.57888,56.31406],[21.74558,56.33181],[22.00548,56.41508],[22.09728,56.42851],[22.3361,56.4016],[22.56441,56.39305],[22.69354,56.36284],[22.83048,56.367],[22.96988,56.41213],[23.09531,56.30511],[23.17312,56.36795],[23.31606,56.3827],[23.40486,56.37689],[23.49803,56.34307],[23.75726,56.37282],[24.02657,56.3231],[24.13139,56.24881],[24.32334,56.30226],[24.42746,56.26522],[24.58143,56.29125],[24.57353,56.31525],[24.70022,56.40483],[24.83686,56.41565],[24.89005,56.46666],[25.05762,56.26742],[25.09325,56.1878],[25.23099,56.19147],[25.39751,56.15707],[25.53621,56.16663],[25.68588,56.14725],[25.69246,56.08892],[25.81773,56.05444],[25.85893,56.00188],[25.90047,56.0013],[26.03815,55.95884],[26.18509,55.86813],[26.39561,55.71156],[26.46661,55.70375],[26.58248,55.6754],[26.63231,55.67968],[26.64888,55.70515],[26.71802,55.70645],[26.76872,55.67658],[26.87448,55.7172],[26.97153,55.8102],[27.1559,55.85032],[27.27804,55.78299],[27.3541,55.8089],[27.61683,55.78558],[27.63065,55.89687],[27.97865,56.11849],[28.15217,56.16964],[28.23716,56.27588],[28.16599,56.37806],[28.19057,56.44637],[28.10069,56.524],[28.13526,56.57989],[28.04768,56.59004],[27.86101,56.88204],[27.66511,56.83921],[27.86101,57.29402],[27.52453,57.42826],[27.56832,57.53728],[27.34698,57.52242]]]]}},{type:"Feature",properties:{iso1A2:"LY",iso1A3:"LBY",iso1N3:"434",wikidata:"Q1016",nameEn:"Libya",groups:["015","002","UN"],callingCodes:["218"]},geometry:{type:"MultiPolygon",coordinates:[[[[26.92891,33.39516],[11.58941,33.36891],[11.55852,33.1409],[11.51549,33.09826],[11.46037,32.6307],[11.57828,32.48013],[11.53898,32.4138],[11.04234,32.2145],[10.7315,31.97235],[10.62788,31.96629],[10.48497,31.72956],[10.31364,31.72648],[10.12239,31.42098],[10.29516,30.90337],[9.88152,30.34074],[9.76848,30.34366],[9.55544,30.23971],[9.3876,30.16738],[9.78136,29.40961],[9.89569,26.57696],[9.51696,26.39148],[9.38834,26.19288],[10.03146,25.35635],[10.02432,24.98124],[10.33159,24.5465],[10.85323,24.5595],[11.41061,24.21456],[11.62498,24.26669],[11.96886,23.51735],[13.5631,23.16574],[14.22918,22.61719],[14.99751,23.00539],[15.99566,23.49639],[23.99539,19.49944],[23.99715,20.00038],[24.99794,19.99661],[24.99885,21.99535],[24.99968,29.24574],[24.71117,30.17441],[25.01077,30.73861],[24.8458,31.39877],[26.92891,33.39516]]]]}},{type:"Feature",properties:{iso1A2:"MA",iso1A3:"MAR",iso1N3:"504",wikidata:"Q1028",nameEn:"Morocco",groups:["015","002","UN"],callingCodes:["212"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.27707,35.35051],[-5.10878,36.05227],[-7.2725,35.73269],[-14.43883,27.02969],[-17.27295,21.93519],[-17.21511,21.34226],[-17.02707,21.34022],[-16.9978,21.36239],[-16.44269,21.39745],[-14.78487,21.36587],[-14.47329,21.63839],[-14.48112,22.00886],[-14.1291,22.41636],[-14.10361,22.75501],[-13.75627,23.77231],[-13.00628,24.01923],[-12.92147,24.39502],[-12.12281,25.13682],[-12.06001,26.04442],[-11.62052,26.05229],[-11.38635,26.611],[-11.23622,26.72023],[-11.35695,26.8505],[-10.68417,26.90984],[-9.81998,26.71379],[-9.56957,26.90042],[-9.08698,26.98639],[-8.71787,26.9898],[-8.77527,27.66663],[-8.66879,27.6666],[-8.6715,28.71194],[-7.61585,29.36252],[-6.95824,29.50924],[-6.78351,29.44634],[-6.69965,29.51623],[-5.75616,29.61407],[-5.72121,29.52322],[-5.58831,29.48103],[-5.21671,29.95253],[-4.6058,30.28343],[-4.31774,30.53229],[-3.64735,30.67539],[-3.65418,30.85566],[-3.54944,31.0503],[-3.77103,31.14984],[-3.77647,31.31912],[-3.66386,31.39202],[-3.66314,31.6339],[-2.82784,31.79459],[-2.93873,32.06557],[-2.46166,32.16603],[-1.22829,32.07832],[-1.15735,32.12096],[-1.24453,32.1917],[-1.24998,32.32993],[-.9912,32.52467],[-1.37794,32.73628],[-1.54244,32.95499],[-1.46249,33.0499],[-1.67067,33.27084],[-1.59508,33.59929],[-1.73494,33.71721],[-1.64666,34.10405],[-1.78042,34.39018],[-1.69788,34.48056],[-1.84569,34.61907],[-1.73707,34.74226],[-1.97469,34.886],[-1.97833,34.93218],[-2.04734,34.93218],[-2.21445,35.04378],[-2.21248,35.08532],[-2.27707,35.35051]],[[-2.91909,35.33927],[-2.92272,35.27509],[-2.93893,35.26737],[-2.95065,35.26576],[-2.95431,35.2728],[-2.96516,35.27967],[-2.96826,35.28296],[-2.96507,35.28801],[-2.97035,35.28852],[-2.96978,35.29459],[-2.96648,35.30475],[-2.96038,35.31609],[-2.91909,35.33927]],[[-3.90602,35.21494],[-3.89343,35.22728],[-3.88372,35.20767],[-3.90602,35.21494]],[[-4.30191,35.17419],[-4.29436,35.17149],[-4.30112,35.17058],[-4.30191,35.17419]],[[-2.40316,35.16893],[-2.45965,35.16527],[-2.43262,35.20652],[-2.40316,35.16893]],[[-5.38491,35.92591],[-5.21179,35.90091],[-5.34379,35.8711],[-5.35844,35.87375],[-5.37338,35.88417],[-5.38491,35.92591]]]]}},{type:"Feature",properties:{iso1A2:"MC",iso1A3:"MCO",iso1N3:"492",wikidata:"Q235",nameEn:"Monaco",groups:["155","150","UN"],callingCodes:["377"]},geometry:{type:"MultiPolygon",coordinates:[[[[7.47823,43.73341],[7.4379,43.74963],[7.4389,43.75151],[7.43708,43.75197],[7.43624,43.75014],[7.43013,43.74895],[7.42809,43.74396],[7.42443,43.74087],[7.42299,43.74176],[7.42062,43.73977],[7.41233,43.73439],[7.41298,43.73311],[7.41291,43.73168],[7.41113,43.73156],[7.40903,43.7296],[7.42422,43.72209],[7.47823,43.73341]]]]}},{type:"Feature",properties:{iso1A2:"MD",iso1A3:"MDA",iso1N3:"498",wikidata:"Q217",nameEn:"Moldova",groups:["151","150","UN"],callingCodes:["373"]},geometry:{type:"MultiPolygon",coordinates:[[[[27.74422,48.45926],[27.6658,48.44034],[27.59027,48.46311],[27.5889,48.49224],[27.46942,48.454],[27.44333,48.41209],[27.37741,48.41026],[27.37604,48.44398],[27.32159,48.4434],[27.27855,48.37534],[27.13434,48.37288],[27.08078,48.43214],[27.0231,48.42485],[27.03821,48.37653],[26.93384,48.36558],[26.85556,48.41095],[26.71274,48.40388],[26.82809,48.31629],[26.79239,48.29071],[26.6839,48.35828],[26.62823,48.25804],[26.81161,48.25049],[26.87708,48.19919],[26.94265,48.1969],[26.98042,48.15752],[26.96119,48.13003],[27.04118,48.12522],[27.02985,48.09083],[27.15622,47.98538],[27.1618,47.92391],[27.29069,47.73722],[27.25519,47.71366],[27.32202,47.64009],[27.3979,47.59473],[27.47942,47.48113],[27.55731,47.46637],[27.60263,47.32507],[27.68706,47.28962],[27.73172,47.29248],[27.81892,47.1381],[28.09095,46.97621],[28.12173,46.82283],[28.24808,46.64305],[28.22281,46.50481],[28.25769,46.43334],[28.18902,46.35283],[28.19864,46.31869],[28.10937,46.22852],[28.13684,46.18099],[28.08612,46.01105],[28.13111,45.92819],[28.16568,45.6421],[28.08927,45.6051],[28.18741,45.47358],[28.21139,45.46895],[28.30201,45.54744],[28.41836,45.51715],[28.43072,45.48538],[28.51449,45.49982],[28.49252,45.56716],[28.54196,45.58062],[28.51587,45.6613],[28.47879,45.66994],[28.52823,45.73803],[28.70401,45.78019],[28.69852,45.81753],[28.78503,45.83475],[28.74383,45.96664],[28.98004,46.00385],[29.00613,46.04962],[28.94643,46.09176],[29.06656,46.19716],[28.94953,46.25852],[28.98478,46.31803],[29.004,46.31495],[28.9306,46.45699],[29.01241,46.46177],[29.02409,46.49582],[29.23547,46.55435],[29.24886,46.37912],[29.35357,46.49505],[29.49914,46.45889],[29.5939,46.35472],[29.6763,46.36041],[29.66359,46.4215],[29.74496,46.45605],[29.88329,46.35851],[29.94114,46.40114],[30.09103,46.38694],[30.16794,46.40967],[30.02511,46.45132],[29.88916,46.54302],[29.94409,46.56002],[29.9743,46.75325],[29.94522,46.80055],[29.98814,46.82358],[29.87405,46.88199],[29.75458,46.8604],[29.72986,46.92234],[29.57056,46.94766],[29.62137,47.05069],[29.61038,47.09932],[29.53044,47.07851],[29.49732,47.12878],[29.57696,47.13581],[29.54996,47.24962],[29.59665,47.25521],[29.5733,47.36508],[29.48678,47.36043],[29.47854,47.30366],[29.39889,47.30179],[29.3261,47.44664],[29.18603,47.43387],[29.11743,47.55001],[29.22414,47.60012],[29.22242,47.73607],[29.27255,47.79953],[29.20663,47.80367],[29.27804,47.88893],[29.19839,47.89261],[29.1723,47.99013],[28.9306,47.96255],[28.8414,48.03392],[28.85232,48.12506],[28.69896,48.13106],[28.53921,48.17453],[28.48428,48.0737],[28.42454,48.12047],[28.43701,48.15832],[28.38712,48.17567],[28.34009,48.13147],[28.30609,48.14018],[28.30586,48.1597],[28.34912,48.1787],[28.36996,48.20543],[28.35519,48.24957],[28.32508,48.23384],[28.2856,48.23202],[28.19314,48.20749],[28.17666,48.25963],[28.07504,48.23494],[28.09873,48.3124],[28.04527,48.32661],[27.95883,48.32368],[27.88391,48.36699],[27.87533,48.4037],[27.81902,48.41874],[27.79225,48.44244],[27.74422,48.45926]]]]}},{type:"Feature",properties:{iso1A2:"ME",iso1A3:"MNE",iso1N3:"499",wikidata:"Q236",nameEn:"Montenegro",groups:["039","150","UN"],callingCodes:["382"]},geometry:{type:"MultiPolygon",coordinates:[[[[19.22807,43.5264],[19.15685,43.53943],[19.13933,43.5282],[19.04934,43.50384],[19.01078,43.55806],[18.91379,43.50299],[18.95469,43.49367],[18.96053,43.45042],[19.01078,43.43854],[19.04071,43.397],[19.08673,43.31453],[19.08206,43.29668],[19.04233,43.30008],[19.00844,43.24988],[18.95001,43.29327],[18.95819,43.32899],[18.90911,43.36383],[18.83912,43.34795],[18.84794,43.33735],[18.85342,43.32426],[18.76538,43.29838],[18.6976,43.25243],[18.71747,43.2286],[18.66605,43.2056],[18.64735,43.14766],[18.66254,43.03928],[18.52232,43.01451],[18.49076,42.95553],[18.49661,42.89306],[18.4935,42.86433],[18.47633,42.85829],[18.45921,42.81682],[18.47324,42.74992],[18.56789,42.72074],[18.55221,42.69045],[18.54603,42.69171],[18.54841,42.68328],[18.57373,42.64429],[18.52232,42.62279],[18.55504,42.58409],[18.53751,42.57376],[18.49778,42.58409],[18.43735,42.55921],[18.44307,42.51077],[18.43588,42.48556],[18.52152,42.42302],[18.54128,42.39171],[18.45131,42.21682],[19.26406,41.74971],[19.37597,41.84849],[19.37451,41.8842],[19.33812,41.90669],[19.34601,41.95675],[19.37691,41.96977],[19.36867,42.02564],[19.37548,42.06835],[19.40687,42.10024],[19.28623,42.17745],[19.42,42.33019],[19.42352,42.36546],[19.4836,42.40831],[19.65972,42.62774],[19.73244,42.66299],[19.77375,42.58517],[19.74731,42.57422],[19.76549,42.50237],[19.82333,42.46581],[19.9324,42.51699],[20.00842,42.5109],[20.01834,42.54622],[20.07761,42.55582],[20.0969,42.65559],[20.02915,42.71147],[20.02088,42.74789],[20.04898,42.77701],[20.2539,42.76245],[20.27869,42.81945],[20.35692,42.8335],[20.34528,42.90676],[20.16415,42.97177],[20.14896,42.99058],[20.12325,42.96237],[20.05431,42.99571],[20.04729,43.02732],[19.98887,43.0538],[19.96549,43.11098],[19.92576,43.08539],[19.79255,43.11951],[19.76918,43.16044],[19.64063,43.19027],[19.62661,43.2286],[19.54598,43.25158],[19.52962,43.31623],[19.48171,43.32644],[19.44315,43.38846],[19.22229,43.47926],[19.22807,43.5264]]]]}},{type:"Feature",properties:{iso1A2:"MF",iso1A3:"MAF",iso1N3:"663",wikidata:"Q126125",nameEn:"Saint-Martin",country:"FR",groups:["Q3320166","EU","029","003","419","019","UN"],callingCodes:["590"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.93924,18.02904],[-62.62718,18.26185],[-63.35989,18.06012],[-63.33064,17.9615],[-63.13502,18.05445],[-63.11042,18.05339],[-63.09686,18.04608],[-63.07759,18.04943],[-63.0579,18.06614],[-63.04039,18.05619],[-63.02323,18.05757],[-62.93924,18.02904]]]]}},{type:"Feature",properties:{iso1A2:"MG",iso1A3:"MDG",iso1N3:"450",wikidata:"Q1019",nameEn:"Madagascar",aliases:["RM"],groups:["014","202","002","UN"],callingCodes:["261"]},geometry:{type:"MultiPolygon",coordinates:[[[[51.93891,-10.85085],[45.84651,-12.77177],[42.14681,-19.63341],[45.80092,-33.00974],[51.93891,-10.85085]]]]}},{type:"Feature",properties:{iso1A2:"MH",iso1A3:"MHL",iso1N3:"584",wikidata:"Q709",nameEn:"Marshall Islands",groups:["057","009","UN"],roadSpeedUnit:"mph",callingCodes:["692"]},geometry:{type:"MultiPolygon",coordinates:[[[[169,3.9],[173.53711,5.70687],[169.29099,15.77133],[159.04653,10.59067],[169,3.9]]]]}},{type:"Feature",properties:{iso1A2:"MK",iso1A3:"MKD",iso1N3:"807",wikidata:"Q221",nameEn:"North Macedonia",groups:["039","150","UN"],callingCodes:["389"]},geometry:{type:"MultiPolygon",coordinates:[[[[22.34773,42.31725],[22.29275,42.34913],[22.29605,42.37477],[22.16384,42.32103],[22.02908,42.29848],[21.94405,42.34669],[21.91595,42.30392],[21.84654,42.3247],[21.77176,42.2648],[21.70111,42.23789],[21.58992,42.25915],[21.52145,42.24465],[21.50823,42.27156],[21.43882,42.2789],[21.43882,42.23609],[21.38428,42.24465],[21.30496,42.1418],[21.29913,42.13954],[21.31983,42.10993],[21.22728,42.08909],[21.16614,42.19815],[21.11491,42.20794],[20.75464,42.05229],[20.76786,41.91839],[20.68523,41.85318],[20.59524,41.8818],[20.55976,41.87068],[20.57144,41.7897],[20.53405,41.78099],[20.51301,41.72433],[20.52937,41.69292],[20.51769,41.65975],[20.55508,41.58113],[20.52103,41.56473],[20.45809,41.5549],[20.45331,41.51436],[20.49039,41.49277],[20.51301,41.442],[20.55976,41.4087],[20.52119,41.34381],[20.49432,41.33679],[20.51068,41.2323],[20.59715,41.13644],[20.58546,41.11179],[20.59832,41.09066],[20.63454,41.0889],[20.65558,41.08009],[20.71634,40.91781],[20.73504,40.9081],[20.81567,40.89662],[20.83671,40.92752],[20.94305,40.92399],[20.97693,40.90103],[20.97887,40.85475],[21.15262,40.85546],[21.21105,40.8855],[21.25779,40.86165],[21.35595,40.87578],[21.41555,40.9173],[21.53007,40.90759],[21.57448,40.86076],[21.69601,40.9429],[21.7556,40.92525],[21.91102,41.04786],[21.90869,41.09191],[22.06527,41.15617],[22.1424,41.12449],[22.17629,41.15969],[22.26744,41.16409],[22.42285,41.11921],[22.5549,41.13065],[22.58295,41.11568],[22.62852,41.14385],[22.65306,41.18168],[22.71266,41.13945],[22.74538,41.16321],[22.76408,41.32225],[22.81199,41.3398],[22.93334,41.34104],[22.96331,41.35782],[22.95513,41.63265],[23.03342,41.71034],[23.01239,41.76527],[22.96682,41.77137],[22.90254,41.87587],[22.86749,42.02275],[22.67701,42.06614],[22.51224,42.15457],[22.50289,42.19527],[22.47251,42.20393],[22.38136,42.30339],[22.34773,42.31725]]]]}},{type:"Feature",properties:{iso1A2:"ML",iso1A3:"MLI",iso1N3:"466",wikidata:"Q912",nameEn:"Mali",groups:["011","202","002","UN"],callingCodes:["223"]},geometry:{type:"MultiPolygon",coordinates:[[[[-4.83423,24.99935],[-6.57191,25.0002],[-5.60725,16.49919],[-5.33435,16.33354],[-5.50165,15.50061],[-9.32979,15.50032],[-9.31106,15.69412],[-9.33314,15.7044],[-9.44673,15.60553],[-9.40447,15.4396],[-10.71721,15.4223],[-10.90932,15.11001],[-11.43483,15.62339],[-11.70705,15.51558],[-11.94903,14.76143],[-12.23936,14.76324],[-11.93043,13.84505],[-12.06897,13.71049],[-11.83345,13.33333],[-11.63025,13.39174],[-11.39935,12.97808],[-11.37536,12.40788],[-11.50006,12.17826],[-11.24136,12.01286],[-10.99758,12.24634],[-10.80355,12.1053],[-10.71897,11.91552],[-10.30604,12.24634],[-9.714,12.0226],[-9.63938,12.18312],[-9.32097,12.29009],[-9.38067,12.48446],[-9.13689,12.50875],[-8.94784,12.34842],[-8.80854,11.66715],[-8.40058,11.37466],[-8.66923,10.99397],[-8.35083,11.06234],[-8.2667,10.91762],[-8.32614,10.69273],[-8.22711,10.41722],[-8.10207,10.44649],[-7.9578,10.2703],[-7.97971,10.17117],[-7.92107,10.15577],[-7.63048,10.46334],[-7.54462,10.40921],[-7.52261,10.4655],[-7.44555,10.44602],[-7.3707,10.24677],[-7.13331,10.24877],[-7.0603,10.14711],[-7.00966,10.15794],[-6.97444,10.21644],[-7.01186,10.25111],[-6.93921,10.35291],[-6.68164,10.35074],[-6.63541,10.66893],[-6.52974,10.59104],[-6.42847,10.5694],[-6.40646,10.69922],[-6.325,10.68624],[-6.24795,10.74248],[-6.1731,10.46983],[-6.18851,10.24244],[-5.99478,10.19694],[-5.78124,10.43952],[-5.65135,10.46767],[-5.51058,10.43177],[-5.46643,10.56074],[-5.47083,10.75329],[-5.41579,10.84628],[-5.49284,11.07538],[-5.32994,11.13371],[-5.32553,11.21578],[-5.25949,11.24816],[-5.25509,11.36905],[-5.20665,11.43811],[-5.22867,11.60421],[-5.29251,11.61715],[-5.26389,11.75728],[-5.40258,11.8327],[-5.26389,11.84778],[-5.07897,11.97918],[-4.72893,12.01579],[-4.70692,12.06746],[-4.62987,12.06531],[-4.62546,12.13204],[-4.54841,12.1385],[-4.57703,12.19875],[-4.41412,12.31922],[-4.47356,12.71252],[-4.238,12.71467],[-4.21819,12.95722],[-4.34477,13.12927],[-3.96501,13.49778],[-3.90558,13.44375],[-3.96282,13.38164],[-3.7911,13.36665],[-3.54454,13.1781],[-3.4313,13.1588],[-3.43507,13.27272],[-3.23599,13.29035],[-3.28396,13.5422],[-3.26407,13.70699],[-2.88189,13.64921],[-2.90831,13.81174],[-2.84667,14.05532],[-2.66175,14.14713],[-2.47587,14.29671],[-2.10223,14.14878],[-1.9992,14.19011],[-1.97945,14.47709],[-1.68083,14.50023],[-1.32166,14.72774],[-1.05875,14.7921],[-.72004,15.08655],[-.24673,15.07805],[.06588,14.96961],[.23859,15.00135],[.72632,14.95898],[.96711,14.98275],[1.31275,15.27978],[3.01806,15.34571],[3.03134,15.42221],[3.50368,15.35934],[4.19893,16.39923],[4.21787,17.00118],[4.26762,17.00432],[4.26651,19.14224],[3.36082,18.9745],[3.12501,19.1366],[3.24648,19.81703],[1.20992,20.73533],[1.15698,21.12843],[-4.83423,24.99935]]]]}},{type:"Feature",properties:{iso1A2:"MM",iso1A3:"MMR",iso1N3:"104",wikidata:"Q836",nameEn:"Myanmar",aliases:["Burma","BU"],groups:["035","142","UN"],callingCodes:["95"]},geometry:{type:"MultiPolygon",coordinates:[[[[92.62187,21.87037],[92.59775,21.6092],[92.68152,21.28454],[92.60187,21.24615],[92.55105,21.3856],[92.43158,21.37025],[92.37939,21.47764],[92.20087,21.337],[92.17752,21.17445],[92.26071,21.05697],[92.47409,20.38654],[92.61042,13.76986],[94.6371,13.81803],[97.63455,9.60854],[98.12555,9.44056],[98.33094,9.91973],[98.47298,9.95782],[98.52291,9.92389],[98.55174,9.92804],[98.7391,10.31488],[98.81944,10.52761],[98.77275,10.62548],[98.78511,10.68351],[98.86819,10.78336],[99.0069,10.85485],[98.99701,10.92962],[99.02337,10.97217],[99.06938,10.94857],[99.32756,11.28545],[99.31573,11.32081],[99.39485,11.3925],[99.47598,11.62434],[99.5672,11.62732],[99.64108,11.78948],[99.64891,11.82699],[99.53424,12.02317],[99.56445,12.14805],[99.47519,12.1353],[99.409,12.60603],[99.29254,12.68921],[99.18905,12.84799],[99.18748,12.9898],[99.10646,13.05804],[99.12225,13.19847],[99.20617,13.20575],[99.16695,13.72621],[98.97356,14.04868],[98.56762,14.37701],[98.24874,14.83013],[98.18821,15.13125],[98.22,15.21327],[98.30446,15.30667],[98.40522,15.25268],[98.41906,15.27103],[98.39351,15.34177],[98.4866,15.39154],[98.56027,15.33471],[98.58598,15.46821],[98.541,15.65406],[98.59853,15.87197],[98.57019,16.04578],[98.69585,16.13353],[98.8376,16.11706],[98.92656,16.36425],[98.84485,16.42354],[98.68074,16.27068],[98.63817,16.47424],[98.57912,16.55983],[98.5695,16.62826],[98.51113,16.64503],[98.51833,16.676],[98.51472,16.68521],[98.51579,16.69433],[98.51043,16.70107],[98.49713,16.69022],[98.50253,16.7139],[98.46994,16.73613],[98.53833,16.81934],[98.49603,16.8446],[98.52624,16.89979],[98.39441,17.06266],[98.34566,17.04822],[98.10439,17.33847],[98.11185,17.36829],[97.91829,17.54504],[97.76407,17.71595],[97.66794,17.88005],[97.73723,17.97912],[97.60841,18.23846],[97.64116,18.29778],[97.56219,18.33885],[97.50383,18.26844],[97.34522,18.54596],[97.36444,18.57138],[97.5258,18.4939],[97.76752,18.58097],[97.73836,18.88478],[97.66487,18.9371],[97.73654,18.9812],[97.73797,19.04261],[97.83479,19.09972],[97.84024,19.22217],[97.78606,19.26769],[97.84186,19.29526],[97.78769,19.39429],[97.88423,19.5041],[97.84715,19.55782],[98.04364,19.65755],[98.03314,19.80941],[98.13829,19.78541],[98.24884,19.67876],[98.51182,19.71303],[98.56065,19.67807],[98.83661,19.80931],[98.98679,19.7419],[99.0735,20.10298],[99.20328,20.12877],[99.416,20.08614],[99.52943,20.14811],[99.5569,20.20676],[99.46077,20.36198],[99.46008,20.39673],[99.68255,20.32077],[99.81096,20.33687],[99.86383,20.44371],[99.88211,20.44488],[99.88451,20.44596],[99.89168,20.44548],[99.89301,20.44311],[99.89692,20.44789],[99.90499,20.4487],[99.91616,20.44986],[99.95721,20.46301],[100.08404,20.36626],[100.1957,20.68247],[100.36375,20.82783],[100.51079,20.82194],[100.60112,20.8347],[100.64628,20.88279],[100.50974,20.88574],[100.55281,21.02796],[100.63578,21.05639],[100.72716,21.31786],[100.80173,21.2934],[101.00234,21.39612],[101.16198,21.52808],[101.15156,21.56129],[101.11744,21.77659],[100.87265,21.67396],[100.72143,21.51898],[100.57861,21.45637],[100.4811,21.46148],[100.42892,21.54325],[100.35201,21.53176],[100.25863,21.47043],[100.18447,21.51898],[100.1625,21.48704],[100.12542,21.50365],[100.10757,21.59945],[100.17486,21.65306],[100.12679,21.70539],[100.04956,21.66843],[99.98654,21.71064],[99.94003,21.82782],[99.99084,21.97053],[99.96612,22.05965],[99.85351,22.04183],[99.47585,22.13345],[99.33166,22.09656],[99.1552,22.15874],[99.19176,22.16983],[99.17318,22.18025],[99.28771,22.4105],[99.37972,22.50188],[99.38247,22.57544],[99.31243,22.73893],[99.45654,22.85726],[99.43537,22.94086],[99.54218,22.90014],[99.52214,23.08218],[99.34127,23.13099],[99.25741,23.09025],[99.04601,23.12215],[99.05975,23.16382],[98.88597,23.18656],[98.92515,23.29535],[98.93958,23.31414],[98.87573,23.33038],[98.92104,23.36946],[98.87683,23.48995],[98.82877,23.47908],[98.80294,23.5345],[98.88396,23.59555],[98.81775,23.694],[98.82933,23.72921],[98.79607,23.77947],[98.68209,23.80492],[98.67797,23.9644],[98.89632,24.10612],[98.87998,24.15624],[98.85319,24.13042],[98.59256,24.08371],[98.54476,24.13119],[98.20666,24.11406],[98.07806,24.07988],[98.06703,24.08028],[98.0607,24.07812],[98.05671,24.07961],[98.05302,24.07408],[98.04709,24.07616],[97.99583,24.04932],[97.98691,24.03897],[97.93951,24.01953],[97.90998,24.02094],[97.88616,24.00463],[97.88414,23.99405],[97.88814,23.98605],[97.89683,23.98389],[97.89676,23.97931],[97.8955,23.97758],[97.88811,23.97446],[97.86545,23.97723],[97.84328,23.97603],[97.79416,23.95663],[97.79456,23.94836],[97.72302,23.89288],[97.64667,23.84574],[97.5247,23.94032],[97.62363,24.00506],[97.72903,24.12606],[97.75305,24.16902],[97.72799,24.18883],[97.72998,24.2302],[97.76799,24.26365],[97.71941,24.29652],[97.66723,24.30027],[97.65624,24.33781],[97.7098,24.35658],[97.66998,24.45288],[97.60029,24.4401],[97.52757,24.43748],[97.56286,24.54535],[97.56525,24.72838],[97.54675,24.74202],[97.5542,24.74943],[97.56383,24.75535],[97.56648,24.76475],[97.64354,24.79171],[97.70181,24.84557],[97.73127,24.83015],[97.76481,24.8289],[97.79949,24.85655],[97.72903,24.91332],[97.72216,25.08508],[97.77023,25.11492],[97.83614,25.2715],[97.92541,25.20815],[98.14925,25.41547],[98.12591,25.50722],[98.18084,25.56298],[98.16848,25.62739],[98.25774,25.6051],[98.31268,25.55307],[98.40606,25.61129],[98.54064,25.85129],[98.63128,25.79937],[98.70818,25.86241],[98.60763,26.01512],[98.57085,26.11547],[98.63128,26.15492],[98.66884,26.09165],[98.7329,26.17218],[98.67797,26.24487],[98.72741,26.36183],[98.77547,26.61994],[98.7333,26.85615],[98.69582,27.56499],[98.43353,27.67086],[98.42529,27.55404],[98.32641,27.51385],[98.13964,27.9478],[98.15337,28.12114],[97.90069,28.3776],[97.79632,28.33168],[97.70705,28.5056],[97.56835,28.55628],[97.50518,28.49716],[97.47085,28.2688],[97.41729,28.29783],[97.34547,28.21385],[97.31292,28.06784],[97.35412,28.06663],[97.38845,28.01329],[97.35824,27.87256],[97.29919,27.92233],[96.90112,27.62149],[96.91431,27.45752],[97.17422,27.14052],[97.14675,27.09041],[96.89132,27.17474],[96.85287,27.2065],[96.88445,27.25046],[96.73888,27.36638],[96.55761,27.29928],[96.40779,27.29818],[96.15591,27.24572],[96.04949,27.19428],[95.93002,27.04149],[95.81603,27.01335],[95.437,26.7083],[95.30339,26.65372],[95.23513,26.68499],[95.05798,26.45408],[95.12801,26.38397],[95.11428,26.1019],[95.18556,26.07338],[94.80117,25.49359],[94.68032,25.47003],[94.57458,25.20318],[94.74212,25.13606],[94.73937,25.00545],[94.60204,24.70889],[94.5526,24.70764],[94.50729,24.59281],[94.45279,24.56656],[94.32362,24.27692],[94.30215,24.23752],[94.14081,23.83333],[93.92089,23.95812],[93.80279,23.92549],[93.75952,24.0003],[93.62871,24.00922],[93.50616,23.94432],[93.46633,23.97067],[93.41415,24.07854],[93.34735,24.10151],[93.32351,24.04468],[93.36059,23.93176],[93.3908,23.92925],[93.3908,23.7622],[93.43475,23.68299],[93.38805,23.4728],[93.39981,23.38828],[93.38781,23.36139],[93.36862,23.35426],[93.38478,23.13698],[93.2878,23.00464],[93.12988,23.05772],[93.134,22.92498],[93.09417,22.69459],[93.134,22.59573],[93.11477,22.54374],[93.13537,22.45873],[93.18206,22.43716],[93.19991,22.25425],[93.14224,22.24535],[93.15734,22.18687],[93.04885,22.20595],[92.99255,22.05965],[92.99804,21.98964],[92.93899,22.02656],[92.89504,21.95143],[92.86208,22.05456],[92.70416,22.16017],[92.67532,22.03547],[92.60949,21.97638],[92.62187,21.87037]]]]}},{type:"Feature",properties:{iso1A2:"MN",iso1A3:"MNG",iso1N3:"496",wikidata:"Q711",nameEn:"Mongolia",groups:["030","142","UN"],callingCodes:["976"]},geometry:{type:"MultiPolygon",coordinates:[[[[102.14032,51.35566],[101.5044,51.50467],[101.39085,51.45753],[100.61116,51.73028],[99.89203,51.74903],[99.75578,51.90108],[99.27888,51.96876],[98.87768,52.14563],[98.74142,51.8637],[98.33222,51.71832],[98.22053,51.46579],[98.05257,51.46696],[97.83305,51.00248],[98.01472,50.86652],[97.9693,50.78044],[98.06393,50.61262],[98.31373,50.4996],[98.29481,50.33561],[97.85197,49.91339],[97.76871,49.99861],[97.56432,49.92801],[97.56811,49.84265],[97.24639,49.74737],[96.97388,49.88413],[95.80056,50.04239],[95.74757,49.97915],[95.02465,49.96941],[94.97166,50.04725],[94.6121,50.04239],[94.49477,50.17832],[94.39258,50.22193],[94.30823,50.57498],[92.99595,50.63183],[93.01109,50.79001],[92.44714,50.78762],[92.07173,50.69585],[91.86048,50.73734],[89.59711,49.90851],[89.70687,49.72535],[88.82499,49.44808],[88.42449,49.48821],[88.17223,49.46934],[88.15543,49.30314],[87.98977,49.18147],[87.81333,49.17354],[87.88171,48.95853],[87.73822,48.89582],[88.0788,48.71436],[87.96361,48.58478],[88.58939,48.34531],[88.58316,48.21893],[88.8011,48.11302],[88.93186,48.10263],[89.0711,47.98528],[89.55453,48.0423],[89.76624,47.82745],[90.06512,47.88177],[90.10871,47.7375],[90.33598,47.68303],[90.48854,47.41826],[90.48542,47.30438],[90.76108,46.99399],[90.84035,46.99525],[91.03649,46.72916],[91.0147,46.58171],[91.07696,46.57315],[90.89639,46.30711],[90.99672,46.14207],[91.03026,46.04194],[90.70907,45.73437],[90.65114,45.49314],[90.89169,45.19667],[91.64048,45.07408],[93.51161,44.95964],[94.10003,44.71016],[94.71959,44.35284],[95.01191,44.25274],[95.39772,44.2805],[95.32891,44.02407],[95.52594,43.99353],[95.89543,43.2528],[96.35658,42.90363],[96.37926,42.72055],[97.1777,42.7964],[99.50671,42.56535],[100.33297,42.68231],[100.84979,42.67087],[101.80515,42.50074],[102.07645,42.22519],[102.72403,42.14675],[103.92804,41.78246],[104.52258,41.8706],[104.51667,41.66113],[105.0123,41.63188],[106.76517,42.28741],[107.24774,42.36107],[107.29755,42.41395],[107.49681,42.46221],[107.57258,42.40898],[108.84489,42.40246],[109.00679,42.45302],[109.452,42.44842],[109.89402,42.63111],[110.08401,42.6411],[110.4327,42.78293],[111.0149,43.3289],[111.59087,43.51207],[111.79758,43.6637],[111.93776,43.68709],[111.96289,43.81596],[111.40498,44.3461],[111.76275,44.98032],[111.98695,45.09074],[112.4164,45.06858],[112.74662,44.86297],[113.70918,44.72891],[114.5166,45.27189],[114.54801,45.38337],[114.74612,45.43585],[114.94546,45.37377],[115.60329,45.44717],[116.16989,45.68603],[116.27366,45.78637],[116.24012,45.8778],[116.26678,45.96479],[116.58612,46.30211],[116.75551,46.33083],[116.83166,46.38637],[117.36609,46.36335],[117.41782,46.57862],[117.60748,46.59771],[117.69554,46.50991],[118.30534,46.73519],[118.78747,46.68689],[118.8337,46.77742],[118.89974,46.77139],[118.92616,46.72765],[119.00541,46.74273],[119.10448,46.65516],[119.24978,46.64761],[119.32827,46.61433],[119.42827,46.63783],[119.65265,46.62342],[119.68127,46.59015],[119.77373,46.62947],[119.80455,46.67631],[119.89261,46.66423],[119.91242,46.90091],[119.85518,46.92196],[119.71209,47.19192],[119.62403,47.24575],[119.56019,47.24874],[119.54918,47.29505],[119.31964,47.42617],[119.35892,47.48104],[119.13995,47.53997],[119.12343,47.66458],[118.7564,47.76947],[118.55766,47.99277],[118.29654,48.00246],[118.22677,48.03853],[118.11009,48.04],[118.03676,48.00982],[117.80196,48.01661],[117.50181,47.77216],[117.37875,47.63627],[116.9723,47.87285],[116.67405,47.89039],[116.4465,47.83662],[116.21879,47.88505],[115.94296,47.67741],[115.57128,47.91988],[115.52082,48.15367],[115.811,48.25699],[115.78876,48.51781],[116.06565,48.81716],[116.03781,48.87014],[116.71193,49.83813],[116.62502,49.92919],[116.22402,50.04477],[115.73602,49.87688],[115.26068,49.97367],[114.9703,50.19254],[114.325,50.28098],[113.20216,49.83356],[113.02647,49.60772],[110.64493,49.1816],[110.39891,49.25083],[110.24373,49.16676],[109.51325,49.22859],[109.18017,49.34709],[108.53969,49.32325],[108.27937,49.53167],[107.95387,49.66659],[107.96116,49.93191],[107.36407,49.97612],[107.1174,50.04239],[107.00007,50.1977],[106.80326,50.30177],[106.58373,50.34044],[106.51122,50.34408],[106.49628,50.32436],[106.47156,50.31909],[106.07865,50.33474],[106.05562,50.40582],[105.32528,50.4648],[103.70343,50.13952],[102.71178,50.38873],[102.32194,50.67982],[102.14032,51.35566]]]]}},{type:"Feature",properties:{iso1A2:"MO",iso1A3:"MAC",iso1N3:"446",wikidata:"Q14773",nameEn:"Macau",aliases:["Macao"],country:"CN",groups:["030","142","UN"],driveSide:"left",callingCodes:["853"]},geometry:{type:"MultiPolygon",coordinates:[[[[113.54942,22.14519],[113.54839,22.10909],[113.57191,22.07696],[113.63011,22.10782],[113.60504,22.20464],[113.57123,22.20416],[113.56865,22.20973],[113.5508,22.21672],[113.54333,22.21688],[113.54093,22.21314],[113.53593,22.2137],[113.53301,22.21235],[113.53552,22.20607],[113.52659,22.18271],[113.54093,22.15497],[113.54942,22.14519]]]]}},{type:"Feature",properties:{iso1A2:"MP",iso1A3:"MNP",iso1N3:"580",wikidata:"Q16644",nameEn:"Northern Mariana Islands",aliases:["US-MP"],country:"US",groups:["Q1352230","Q153732","057","009","UN"],roadSpeedUnit:"mph",callingCodes:["1 670"]},geometry:{type:"MultiPolygon",coordinates:[[[[135.52896,14.32623],[152.19114,13.63487],[145.05972,21.28731],[135.52896,14.32623]]]]}},{type:"Feature",properties:{iso1A2:"MQ",iso1A3:"MTQ",iso1N3:"474",wikidata:"Q17054",nameEn:"Martinique",country:"FR",groups:["Q3320166","EU","029","003","419","019","UN"],callingCodes:["596"]},geometry:{type:"MultiPolygon",coordinates:[[[[-59.95997,14.20285],[-61.07821,15.25109],[-61.69315,14.26451],[-59.95997,14.20285]]]]}},{type:"Feature",properties:{iso1A2:"MR",iso1A3:"MRT",iso1N3:"478",wikidata:"Q1025",nameEn:"Mauritania",groups:["011","202","002","UN"],callingCodes:["222"]},geometry:{type:"MultiPolygon",coordinates:[[[[-5.60725,16.49919],[-6.57191,25.0002],[-4.83423,24.99935],[-8.66674,27.31569],[-8.66721,25.99918],[-12.0002,25.9986],[-12.00251,23.4538],[-12.14969,23.41935],[-12.36213,23.3187],[-12.5741,23.28975],[-13.00412,23.02297],[-13.10753,22.89493],[-13.15313,22.75649],[-13.08438,22.53866],[-13.01525,21.33343],[-16.95474,21.33997],[-16.99806,21.12142],[-17.0357,21.05368],[-17.0396,20.9961],[-17.06781,20.92697],[-17.0695,20.85742],[-17.0471,20.76408],[-17.15288,16.07139],[-16.50854,16.09032],[-16.48967,16.0496],[-16.44814,16.09753],[-16.4429,16.20605],[-16.27016,16.51565],[-15.6509,16.50315],[-15.00557,16.64997],[-14.32144,16.61495],[-13.80075,16.13961],[-13.43135,16.09022],[-13.11029,15.52116],[-12.23936,14.76324],[-11.94903,14.76143],[-11.70705,15.51558],[-11.43483,15.62339],[-10.90932,15.11001],[-10.71721,15.4223],[-9.40447,15.4396],[-9.44673,15.60553],[-9.33314,15.7044],[-9.31106,15.69412],[-9.32979,15.50032],[-5.50165,15.50061],[-5.33435,16.33354],[-5.60725,16.49919]]]]}},{type:"Feature",properties:{iso1A2:"MS",iso1A3:"MSR",iso1N3:"500",wikidata:"Q13353",nameEn:"Montserrat",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 664"]},geometry:{type:"MultiPolygon",coordinates:[[[[-61.91508,16.51165],[-62.1023,16.97277],[-62.58307,16.68909],[-61.91508,16.51165]]]]}},{type:"Feature",properties:{iso1A2:"MT",iso1A3:"MLT",iso1N3:"470",wikidata:"Q233",nameEn:"Malta",groups:["EU","039","150","UN"],driveSide:"left",callingCodes:["356"]},geometry:{type:"MultiPolygon",coordinates:[[[[15.70991,35.79901],[14.07544,36.41525],[13.27636,35.20764],[15.70991,35.79901]]]]}},{type:"Feature",properties:{iso1A2:"MU",iso1A3:"MUS",iso1N3:"480",wikidata:"Q1027",nameEn:"Mauritius",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["230"]},geometry:{type:"MultiPolygon",coordinates:[[[[56.09755,-9.55401],[57.50644,-31.92637],[68.4673,-19.15185],[56.09755,-9.55401]]]]}},{type:"Feature",properties:{iso1A2:"MV",iso1A3:"MDV",iso1N3:"462",wikidata:"Q826",nameEn:"Maldives",groups:["034","142","UN"],driveSide:"left",callingCodes:["960"]},geometry:{type:"MultiPolygon",coordinates:[[[[71.9161,8.55531],[72.57428,-3.7623],[76.59015,5.591],[71.9161,8.55531]]]]}},{type:"Feature",properties:{iso1A2:"MW",iso1A3:"MWI",iso1N3:"454",wikidata:"Q1020",nameEn:"Malawi",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["265"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.48052,-9.62442],[33.31581,-9.48554],[33.14925,-9.49322],[32.99397,-9.36712],[32.95389,-9.40138],[33.00476,-9.5133],[33.00256,-9.63053],[33.05485,-9.61316],[33.10163,-9.66525],[33.12144,-9.58929],[33.2095,-9.61099],[33.31517,-9.82364],[33.36581,-9.81063],[33.37902,-9.9104],[33.31297,-10.05133],[33.53863,-10.20148],[33.54797,-10.36077],[33.70675,-10.56896],[33.47636,-10.78465],[33.28022,-10.84428],[33.25998,-10.88862],[33.39697,-11.15296],[33.29267,-11.3789],[33.29267,-11.43536],[33.23663,-11.40637],[33.24252,-11.59302],[33.32692,-11.59248],[33.33937,-11.91252],[33.25998,-12.14242],[33.3705,-12.34931],[33.47636,-12.32498],[33.54485,-12.35996],[33.37517,-12.54085],[33.28177,-12.54692],[33.18837,-12.61377],[33.05917,-12.59554],[32.94397,-12.76868],[32.96733,-12.88251],[33.02181,-12.88707],[32.98289,-13.12671],[33.0078,-13.19492],[32.86113,-13.47292],[32.84176,-13.52794],[32.73683,-13.57682],[32.68436,-13.55769],[32.66468,-13.60019],[32.68654,-13.64268],[32.7828,-13.64805],[32.84528,-13.71576],[32.76962,-13.77224],[32.79015,-13.80755],[32.88985,-13.82956],[32.99042,-13.95689],[33.02977,-14.05022],[33.07568,-13.98447],[33.16749,-13.93992],[33.24249,-14.00019],[33.66677,-14.61306],[33.7247,-14.4989],[33.88503,-14.51652],[33.92898,-14.47929],[34.08588,-14.48893],[34.18733,-14.43823],[34.22355,-14.43607],[34.34453,-14.3985],[34.35843,-14.38652],[34.39277,-14.39467],[34.4192,-14.43191],[34.44641,-14.47746],[34.45053,-14.49873],[34.47628,-14.53363],[34.48932,-14.53646],[34.49636,-14.55091],[34.52366,-14.5667],[34.53962,-14.59776],[34.55112,-14.64494],[34.53516,-14.67782],[34.52057,-14.68263],[34.54503,-14.74672],[34.567,-14.77345],[34.61522,-14.99583],[34.57503,-15.30619],[34.43126,-15.44778],[34.44981,-15.60864],[34.25195,-15.90321],[34.43126,-16.04737],[34.40344,-16.20923],[35.04805,-16.83167],[35.13771,-16.81687],[35.17017,-16.93521],[35.04805,-17.00027],[35.0923,-17.13235],[35.3062,-17.1244],[35.27065,-16.93817],[35.30929,-16.82871],[35.27219,-16.69402],[35.14235,-16.56812],[35.25828,-16.4792],[35.30157,-16.2211],[35.43355,-16.11371],[35.52365,-16.15414],[35.70107,-16.10147],[35.80487,-16.03907],[35.85303,-15.41913],[35.78799,-15.17428],[35.91812,-14.89514],[35.87212,-14.89478],[35.86945,-14.67481],[35.5299,-14.27714],[35.47989,-14.15594],[34.86229,-13.48958],[34.60253,-13.48487],[34.37831,-12.17408],[34.46088,-12.0174],[34.70739,-12.15652],[34.82903,-12.04837],[34.57917,-11.87849],[34.64241,-11.57499],[34.96296,-11.57354],[34.91153,-11.39799],[34.79375,-11.32245],[34.63305,-11.11731],[34.61161,-11.01611],[34.67047,-10.93796],[34.65946,-10.6828],[34.57581,-10.56271],[34.51911,-10.12279],[34.54499,-10.0678],[34.03865,-9.49398],[33.95829,-9.54066],[33.9638,-9.62206],[33.93298,-9.71647],[33.76677,-9.58516],[33.48052,-9.62442]]]]}},{type:"Feature",properties:{iso1A2:"MX",iso1A3:"MEX",iso1N3:"484",wikidata:"Q96",nameEn:"Mexico",groups:["013","003","419","019","UN"],callingCodes:["52"]},geometry:{type:"MultiPolygon",coordinates:[[[[-117.1243,32.53427],[-118.48109,32.5991],[-120.12904,18.41089],[-92.37213,14.39277],[-92.2261,14.53423],[-92.1454,14.6804],[-92.18161,14.84147],[-92.1423,14.88647],[-92.1454,14.98143],[-92.0621,15.07406],[-92.20983,15.26077],[-91.73182,16.07371],[-90.44567,16.07573],[-90.40499,16.40524],[-90.61212,16.49832],[-90.69064,16.70697],[-91.04436,16.92175],[-91.43809,17.25373],[-90.99199,17.25192],[-90.98678,17.81655],[-89.14985,17.81563],[-89.15105,17.95104],[-89.03839,18.0067],[-88.8716,17.89535],[-88.71505,18.0707],[-88.48242,18.49164],[-88.3268,18.49048],[-88.29909,18.47591],[-88.26593,18.47617],[-88.03238,18.41778],[-88.03165,18.16657],[-87.90671,18.15213],[-87.87604,18.18313],[-87.86657,18.19971],[-87.85693,18.18266],[-87.84815,18.18511],[-86.92368,17.61462],[-85.9092,21.8218],[-96.92418,25.97377],[-97.13927,25.96583],[-97.35946,25.92189],[-97.37332,25.83854],[-97.42511,25.83969],[-97.45669,25.86874],[-97.49828,25.89877],[-97.52025,25.88518],[-97.66511,26.01708],[-97.95155,26.0625],[-97.97017,26.05232],[-98.24603,26.07191],[-98.27075,26.09457],[-98.30491,26.10475],[-98.35126,26.15129],[-99.00546,26.3925],[-99.03053,26.41249],[-99.08477,26.39849],[-99.53573,27.30926],[-99.49744,27.43746],[-99.482,27.47128],[-99.48045,27.49016],[-99.50208,27.50021],[-99.52955,27.49747],[-99.51478,27.55836],[-99.55409,27.61314],[-100.50029,28.66117],[-100.51222,28.70679],[-100.5075,28.74066],[-100.52313,28.75598],[-100.59809,28.88197],[-100.63689,28.90812],[-100.67294,29.09744],[-100.79696,29.24688],[-100.87982,29.296],[-100.94056,29.33371],[-100.94579,29.34523],[-100.96725,29.3477],[-101.01128,29.36947],[-101.05686,29.44738],[-101.47277,29.7744],[-102.60596,29.8192],[-103.15787,28.93865],[-104.37752,29.54255],[-104.39363,29.55396],[-104.3969,29.57105],[-104.5171,29.64671],[-104.77674,30.4236],[-106.00363,31.39181],[-106.09025,31.40569],[-106.20346,31.46305],[-106.23711,31.51262],[-106.24612,31.54193],[-106.28084,31.56173],[-106.30305,31.62154],[-106.33419,31.66303],[-106.34864,31.69663],[-106.3718,31.71165],[-106.38003,31.73151],[-106.41773,31.75196],[-106.43419,31.75478],[-106.45244,31.76523],[-106.46726,31.75998],[-106.47298,31.75054],[-106.48815,31.74769],[-106.50111,31.75714],[-106.50962,31.76155],[-106.51251,31.76922],[-106.52266,31.77509],[-106.529,31.784],[-108.20899,31.78534],[-108.20979,31.33316],[-111.07523,31.33232],[-114.82011,32.49609],[-114.79524,32.55731],[-114.81141,32.55543],[-114.80584,32.62028],[-114.76736,32.64094],[-114.71871,32.71894],[-115.88053,32.63624],[-117.1243,32.53427]]]]}},{type:"Feature",properties:{iso1A2:"MY",iso1A3:"MYS",iso1N3:"458",wikidata:"Q833",nameEn:"Malaysia"},geometry:null},{type:"Feature",properties:{iso1A2:"MZ",iso1A3:"MOZ",iso1N3:"508",wikidata:"Q1029",nameEn:"Mozambique",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["258"]},geometry:{type:"MultiPolygon",coordinates:[[[[40.74206,-10.25691],[40.44265,-10.4618],[40.00295,-10.80255],[39.58249,-10.96043],[39.24395,-11.17433],[38.88996,-11.16978],[38.47258,-11.4199],[38.21598,-11.27289],[37.93618,-11.26228],[37.8388,-11.3123],[37.76614,-11.53352],[37.3936,-11.68949],[36.80309,-11.56836],[36.62068,-11.72884],[36.19094,-11.70008],[36.19094,-11.57593],[35.82767,-11.41081],[35.63599,-11.55927],[34.96296,-11.57354],[34.64241,-11.57499],[34.57917,-11.87849],[34.82903,-12.04837],[34.70739,-12.15652],[34.46088,-12.0174],[34.37831,-12.17408],[34.60253,-13.48487],[34.86229,-13.48958],[35.47989,-14.15594],[35.5299,-14.27714],[35.86945,-14.67481],[35.87212,-14.89478],[35.91812,-14.89514],[35.78799,-15.17428],[35.85303,-15.41913],[35.80487,-16.03907],[35.70107,-16.10147],[35.52365,-16.15414],[35.43355,-16.11371],[35.30157,-16.2211],[35.25828,-16.4792],[35.14235,-16.56812],[35.27219,-16.69402],[35.30929,-16.82871],[35.27065,-16.93817],[35.3062,-17.1244],[35.0923,-17.13235],[35.04805,-17.00027],[35.17017,-16.93521],[35.13771,-16.81687],[35.04805,-16.83167],[34.40344,-16.20923],[34.43126,-16.04737],[34.25195,-15.90321],[34.44981,-15.60864],[34.43126,-15.44778],[34.57503,-15.30619],[34.61522,-14.99583],[34.567,-14.77345],[34.54503,-14.74672],[34.52057,-14.68263],[34.53516,-14.67782],[34.55112,-14.64494],[34.53962,-14.59776],[34.52366,-14.5667],[34.49636,-14.55091],[34.48932,-14.53646],[34.47628,-14.53363],[34.45053,-14.49873],[34.44641,-14.47746],[34.4192,-14.43191],[34.39277,-14.39467],[34.35843,-14.38652],[34.34453,-14.3985],[34.22355,-14.43607],[34.18733,-14.43823],[34.08588,-14.48893],[33.92898,-14.47929],[33.88503,-14.51652],[33.7247,-14.4989],[33.66677,-14.61306],[33.24249,-14.00019],[30.22098,-14.99447],[30.41902,-15.62269],[30.42568,-15.9962],[30.91597,-15.99924],[30.97761,-16.05848],[31.13171,-15.98019],[31.30563,-16.01193],[31.42451,-16.15154],[31.67988,-16.19595],[31.90223,-16.34388],[31.91324,-16.41569],[32.02772,-16.43892],[32.28529,-16.43892],[32.42838,-16.4727],[32.71017,-16.59932],[32.69917,-16.66893],[32.78943,-16.70267],[32.97655,-16.70689],[32.91051,-16.89446],[32.84113,-16.92259],[32.96554,-17.11971],[33.00517,-17.30477],[33.0426,-17.3468],[32.96554,-17.48964],[32.98536,-17.55891],[33.0492,-17.60298],[32.94133,-17.99705],[33.03159,-18.35054],[33.02278,-18.4696],[32.88629,-18.51344],[32.88629,-18.58023],[32.95013,-18.69079],[32.9017,-18.7992],[32.82465,-18.77419],[32.70137,-18.84712],[32.73439,-18.92628],[32.69917,-18.94293],[32.72118,-19.02204],[32.84006,-19.0262],[32.87088,-19.09279],[32.85107,-19.29238],[32.77966,-19.36098],[32.78282,-19.47513],[32.84446,-19.48343],[32.84666,-19.68462],[32.95013,-19.67219],[33.06461,-19.77787],[33.01178,-20.02007],[32.93032,-20.03868],[32.85987,-20.16686],[32.85987,-20.27841],[32.66174,-20.56106],[32.55167,-20.56312],[32.48122,-20.63319],[32.51644,-20.91929],[32.37115,-21.133],[32.48236,-21.32873],[32.41234,-21.31246],[31.38336,-22.36919],[31.30611,-22.422],[31.55779,-23.176],[31.56539,-23.47268],[31.67942,-23.60858],[31.70223,-23.72695],[31.77445,-23.90082],[31.87707,-23.95293],[31.90368,-24.18892],[31.9835,-24.29983],[32.03196,-25.10785],[32.01676,-25.38117],[31.97875,-25.46356],[32.00631,-25.65044],[31.92649,-25.84216],[31.974,-25.95387],[32.00916,-25.999],[32.08599,-26.00978],[32.10435,-26.15656],[32.07352,-26.40185],[32.13409,-26.5317],[32.13315,-26.84345],[32.19409,-26.84032],[32.22302,-26.84136],[32.29584,-26.852],[32.35222,-26.86027],[34.51034,-26.91792],[42.99868,-12.65261],[40.74206,-10.25691]]]]}},{type:"Feature",properties:{iso1A2:"NA",iso1A3:"NAM",iso1N3:"516",wikidata:"Q1030",nameEn:"Namibia",groups:["018","202","002","UN"],driveSide:"left",callingCodes:["264"]},geometry:{type:"MultiPolygon",coordinates:[[[[14.28743,-17.38814],[13.95896,-17.43141],[13.36212,-16.98048],[12.97145,-16.98567],[12.52111,-17.24495],[12.07076,-17.15165],[11.75063,-17.25013],[10.5065,-17.25284],[12.51595,-32.27486],[16.45332,-28.63117],[16.46592,-28.57126],[16.59922,-28.53246],[16.90446,-28.057],[17.15405,-28.08573],[17.4579,-28.68718],[18.99885,-28.89165],[19.99882,-28.42622],[19.99817,-24.76768],[19.99912,-21.99991],[20.99751,-22.00026],[20.99904,-18.31743],[21.45556,-18.31795],[23.0996,-18.00075],[23.29618,-17.99855],[23.61088,-18.4881],[24.19416,-18.01919],[24.40577,-17.95726],[24.57485,-18.07151],[24.6303,-17.9863],[24.71887,-17.9218],[24.73364,-17.89338],[24.95586,-17.79674],[25.05895,-17.84452],[25.16882,-17.78253],[25.26433,-17.79571],[25.00198,-17.58221],[24.70864,-17.49501],[24.5621,-17.52963],[24.38712,-17.46818],[24.32811,-17.49082],[24.23619,-17.47489],[23.47474,-17.62877],[21.42741,-18.02787],[21.14283,-17.94318],[18.84226,-17.80375],[18.39229,-17.38927],[14.28743,-17.38814]]]]}},{type:"Feature",properties:{iso1A2:"NC",iso1A3:"NCL",iso1N3:"540",wikidata:"Q33788",nameEn:"New Caledonia",country:"FR",groups:["EU","Q1451600","054","009","UN"],callingCodes:["687"]},geometry:{type:"MultiPolygon",coordinates:[[[[159.77159,-28.41151],[174.245,-23.1974],[156.73836,-14.50464],[159.77159,-28.41151]]]]}},{type:"Feature",properties:{iso1A2:"NE",iso1A3:"NER",iso1N3:"562",wikidata:"Q1032",nameEn:"Niger",aliases:["RN"],groups:["011","202","002","UN"],callingCodes:["227"]},geometry:{type:"MultiPolygon",coordinates:[[[[14.22918,22.61719],[13.5631,23.16574],[11.96886,23.51735],[7.48273,20.87258],[7.38361,20.79165],[5.8153,19.45101],[4.26651,19.14224],[4.26762,17.00432],[4.21787,17.00118],[4.19893,16.39923],[3.50368,15.35934],[3.03134,15.42221],[3.01806,15.34571],[1.31275,15.27978],[.96711,14.98275],[.72632,14.95898],[.23859,15.00135],[.16936,14.51654],[.38051,14.05575],[.61924,13.68491],[.77377,13.6866],[.77637,13.64442],[.99514,13.5668],[1.02813,13.46635],[1.20088,13.38951],[1.24429,13.39373],[1.28509,13.35488],[1.24516,13.33968],[1.21217,13.37853],[1.18873,13.31771],[.99253,13.37515],[.99167,13.10727],[2.26349,12.41915],[2.05785,12.35539],[2.39723,11.89473],[2.45824,11.98672],[2.39657,12.10952],[2.37783,12.24804],[2.6593,12.30631],[2.83978,12.40585],[3.25352,12.01467],[3.31613,11.88495],[3.48187,11.86092],[3.59375,11.70269],[3.61075,11.69181],[3.67988,11.75429],[3.67122,11.80865],[3.63063,11.83042],[3.61955,11.91847],[3.67775,11.97599],[3.63136,12.11826],[3.66364,12.25884],[3.65111,12.52223],[3.94339,12.74979],[4.10006,12.98862],[4.14367,13.17189],[4.14186,13.47586],[4.23456,13.47725],[4.4668,13.68286],[4.87425,13.78],[4.9368,13.7345],[5.07396,13.75052],[5.21026,13.73627],[5.27797,13.75474],[5.35437,13.83567],[5.52957,13.8845],[6.15771,13.64564],[6.27411,13.67835],[6.43053,13.6006],[6.69617,13.34057],[6.94445,12.99825],[7.0521,13.00076],[7.12676,13.02445],[7.22399,13.1293],[7.39241,13.09717],[7.81085,13.34902],[8.07997,13.30847],[8.25185,13.20369],[8.41853,13.06166],[8.49493,13.07519],[8.60431,13.01768],[8.64251,12.93985],[8.97413,12.83661],[9.65995,12.80614],[10.00373,13.18171],[10.19993,13.27129],[10.46731,13.28819],[10.66004,13.36422],[11.4535,13.37773],[11.88236,13.2527],[12.04209,13.14452],[12.16189,13.10056],[12.19315,13.12423],[12.47095,13.06673],[12.58033,13.27805],[12.6793,13.29157],[12.87376,13.48919],[13.05085,13.53984],[13.19844,13.52802],[13.33213,13.71195],[13.6302,13.71094],[13.47559,14.40881],[13.48259,14.46704],[13.68573,14.55276],[13.67878,14.64013],[13.809,14.72915],[13.78991,14.87519],[13.86301,15.04043],[14.37425,15.72591],[15.50373,16.89649],[15.6032,18.77402],[15.75098,19.93002],[15.99632,20.35364],[15.6721,20.70069],[15.59841,20.74039],[15.56004,20.79488],[15.55382,20.86507],[15.57248,20.92138],[15.62515,20.95395],[15.28332,21.44557],[15.20213,21.49365],[15.19692,21.99339],[14.99751,23.00539],[14.22918,22.61719]]]]}},{type:"Feature",properties:{iso1A2:"NF",iso1A3:"NFK",iso1N3:"574",wikidata:"Q31057",nameEn:"Norfolk Island",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["672 3"]},geometry:{type:"MultiPolygon",coordinates:[[[[169.82316,-28.16667],[166.29505,-28.29175],[167.94076,-30.60745],[169.82316,-28.16667]]]]}},{type:"Feature",properties:{iso1A2:"NG",iso1A3:"NGA",iso1N3:"566",wikidata:"Q1033",nameEn:"Nigeria",groups:["011","202","002","UN"],callingCodes:["234"]},geometry:{type:"MultiPolygon",coordinates:[[[[6.15771,13.64564],[5.52957,13.8845],[5.35437,13.83567],[5.27797,13.75474],[5.21026,13.73627],[5.07396,13.75052],[4.9368,13.7345],[4.87425,13.78],[4.4668,13.68286],[4.23456,13.47725],[4.14186,13.47586],[4.14367,13.17189],[4.10006,12.98862],[3.94339,12.74979],[3.65111,12.52223],[3.66364,12.25884],[3.63136,12.11826],[3.67775,11.97599],[3.61955,11.91847],[3.63063,11.83042],[3.67122,11.80865],[3.67988,11.75429],[3.61075,11.69181],[3.59375,11.70269],[3.49175,11.29765],[3.71505,11.13015],[3.84243,10.59316],[3.78292,10.40538],[3.6844,10.46351],[3.57275,10.27185],[3.66908,10.18136],[3.54429,9.87739],[3.35383,9.83641],[3.32099,9.78032],[3.34726,9.70696],[3.25093,9.61632],[3.13928,9.47167],[3.14147,9.28375],[3.08017,9.10006],[2.77907,9.06924],[2.67523,7.87825],[2.73095,7.7755],[2.73405,7.5423],[2.78668,7.5116],[2.79442,7.43486],[2.74489,7.42565],[2.76965,7.13543],[2.71702,6.95722],[2.74024,6.92802],[2.73405,6.78508],[2.78823,6.76356],[2.78204,6.70514],[2.7325,6.64057],[2.74334,6.57291],[2.70464,6.50831],[2.70566,6.38038],[2.74181,6.13349],[5.87055,3.78489],[8.34397,4.30689],[8.60302,4.87353],[8.78027,5.1243],[8.92029,5.58403],[8.83687,5.68483],[8.88156,5.78857],[8.84209,5.82562],[9.51757,6.43874],[9.70674,6.51717],[9.77824,6.79088],[9.86314,6.77756],[10.15135,7.03781],[10.21466,6.88996],[10.53639,6.93432],[10.57214,7.16345],[10.59746,7.14719],[10.60789,7.06885],[10.83727,6.9358],[10.8179,6.83377],[10.94302,6.69325],[11.09644,6.68437],[11.09495,6.51717],[11.42041,6.53789],[11.42264,6.5882],[11.51499,6.60892],[11.57755,6.74059],[11.55818,6.86186],[11.63117,6.9905],[11.87396,7.09398],[11.84864,7.26098],[11.93205,7.47812],[12.01844,7.52981],[11.99908,7.67302],[12.20909,7.97553],[12.19271,8.10826],[12.24782,8.17904],[12.26123,8.43696],[12.4489,8.52536],[12.44146,8.6152],[12.68722,8.65938],[12.71701,8.7595],[12.79,8.75361],[12.81085,8.91992],[12.90022,9.11411],[12.91958,9.33905],[12.85628,9.36698],[13.02385,9.49334],[13.22642,9.57266],[13.25472,9.76795],[13.29941,9.8296],[13.25025,9.86042],[13.24132,9.91031],[13.27409,9.93232],[13.286,9.9822],[13.25323,10.00127],[13.25025,10.03647],[13.34111,10.12299],[13.43644,10.13326],[13.5705,10.53183],[13.54964,10.61236],[13.73434,10.9255],[13.70753,10.94451],[13.7403,11.00593],[13.78945,11.00154],[13.97489,11.30258],[14.17821,11.23831],[14.6124,11.51283],[14.64591,11.66166],[14.55207,11.72001],[14.61612,11.7798],[14.6474,12.17466],[14.4843,12.35223],[14.22215,12.36533],[14.17523,12.41916],[14.20204,12.53405],[14.08251,13.0797],[13.6302,13.71094],[13.33213,13.71195],[13.19844,13.52802],[13.05085,13.53984],[12.87376,13.48919],[12.6793,13.29157],[12.58033,13.27805],[12.47095,13.06673],[12.19315,13.12423],[12.16189,13.10056],[12.04209,13.14452],[11.88236,13.2527],[11.4535,13.37773],[10.66004,13.36422],[10.46731,13.28819],[10.19993,13.27129],[10.00373,13.18171],[9.65995,12.80614],[8.97413,12.83661],[8.64251,12.93985],[8.60431,13.01768],[8.49493,13.07519],[8.41853,13.06166],[8.25185,13.20369],[8.07997,13.30847],[7.81085,13.34902],[7.39241,13.09717],[7.22399,13.1293],[7.12676,13.02445],[7.0521,13.00076],[6.94445,12.99825],[6.69617,13.34057],[6.43053,13.6006],[6.27411,13.67835],[6.15771,13.64564]]]]}},{type:"Feature",properties:{iso1A2:"NI",iso1A3:"NIC",iso1N3:"558",wikidata:"Q811",nameEn:"Nicaragua",groups:["013","003","419","019","UN"],callingCodes:["505"]},geometry:{type:"MultiPolygon",coordinates:[[[[-83.13724,15.00002],[-83.49268,15.01158],[-83.62101,14.89448],[-83.89551,14.76697],[-84.10584,14.76353],[-84.48373,14.63249],[-84.70119,14.68078],[-84.82596,14.82212],[-84.90082,14.80489],[-85.1575,14.53934],[-85.18602,14.24929],[-85.32149,14.2562],[-85.45762,14.11304],[-85.73964,13.9698],[-85.75477,13.8499],[-86.03458,13.99181],[-86.00685,14.08474],[-86.14801,14.04317],[-86.35219,13.77157],[-86.76812,13.79605],[-86.71267,13.30348],[-86.87066,13.30641],[-86.93383,13.18677],[-86.93197,13.05313],[-87.03785,12.98682],[-87.06306,13.00892],[-87.37107,12.98646],[-87.55124,13.12523],[-87.7346,13.13228],[-88.11443,12.63306],[-86.14524,11.09059],[-85.71223,11.06868],[-85.60529,11.22607],[-84.92439,10.9497],[-84.68197,11.07568],[-83.90838,10.71161],[-83.66597,10.79916],[-83.68276,11.01562],[-82.56142,11.91792],[-82.06974,14.49418],[-83.04763,15.03256],[-83.13724,15.00002]]]]}},{type:"Feature",properties:{iso1A2:"NL",iso1A3:"NLD",iso1N3:"528",wikidata:"Q29999",nameEn:"Kingdom of the Netherlands"},geometry:null},{type:"Feature",properties:{iso1A2:"NO",iso1A3:"NOR",iso1N3:"578",wikidata:"Q20",nameEn:"Norway"},geometry:null},{type:"Feature",properties:{iso1A2:"NP",iso1A3:"NPL",iso1N3:"524",wikidata:"Q837",nameEn:"Nepal",groups:["034","142","UN"],driveSide:"left",callingCodes:["977"]},geometry:{type:"MultiPolygon",coordinates:[[[[88.13378,27.88015],[87.82681,27.95248],[87.72718,27.80938],[87.56996,27.84517],[87.11696,27.84104],[87.03757,27.94835],[86.75582,28.04182],[86.74181,28.10638],[86.56265,28.09569],[86.51609,27.96623],[86.42736,27.91122],[86.22966,27.9786],[86.18607,28.17364],[86.088,28.09264],[86.08333,28.02121],[86.12069,27.93047],[86.06309,27.90021],[85.94946,27.9401],[85.97813,27.99023],[85.90743,28.05144],[85.84672,28.18187],[85.74864,28.23126],[85.71907,28.38064],[85.69105,28.38475],[85.60854,28.25045],[85.59765,28.30529],[85.4233,28.32996],[85.38127,28.28336],[85.10729,28.34092],[85.18668,28.54076],[85.19135,28.62825],[85.06059,28.68562],[84.85511,28.58041],[84.62317,28.73887],[84.47528,28.74023],[84.2231,28.89571],[84.24801,29.02783],[84.18107,29.23451],[83.97559,29.33091],[83.82303,29.30513],[83.63156,29.16249],[83.44787,29.30513],[83.28131,29.56813],[83.07116,29.61957],[82.73024,29.81695],[82.5341,29.9735],[82.38622,30.02608],[82.16984,30.0692],[82.19475,30.16884],[82.10757,30.23745],[82.10135,30.35439],[81.99082,30.33423],[81.62033,30.44703],[81.5459,30.37688],[81.41018,30.42153],[81.39928,30.21862],[81.33355,30.15303],[81.2623,30.14596],[81.29032,30.08806],[81.24362,30.0126],[81.12842,30.01395],[81.03953,30.20059],[80.92547,30.17193],[80.91143,30.22173],[80.86673,30.17321],[80.8778,30.13384],[80.67076,29.95732],[80.60226,29.95732],[80.57179,29.91422],[80.56247,29.86661],[80.48997,29.79566],[80.43458,29.80466],[80.41554,29.79451],[80.36803,29.73865],[80.38428,29.68513],[80.41858,29.63581],[80.37939,29.57098],[80.24322,29.44299],[80.31428,29.30784],[80.28626,29.20327],[80.24112,29.21414],[80.26602,29.13938],[80.23178,29.11626],[80.18085,29.13649],[80.05743,28.91479],[80.06957,28.82763],[80.12125,28.82346],[80.37188,28.63371],[80.44504,28.63098],[80.52443,28.54897],[80.50575,28.6706],[80.55142,28.69182],[81.03471,28.40054],[81.19847,28.36284],[81.32923,28.13521],[81.38683,28.17638],[81.48179,28.12148],[81.47867,28.08303],[81.91223,27.84995],[81.97214,27.93322],[82.06554,27.92222],[82.46405,27.6716],[82.70378,27.72122],[82.74119,27.49838],[82.93261,27.50328],[82.94938,27.46036],[83.19413,27.45632],[83.27197,27.38309],[83.2673,27.36235],[83.29999,27.32778],[83.35136,27.33885],[83.38872,27.39276],[83.39495,27.4798],[83.61288,27.47013],[83.85595,27.35797],[83.86182,27.4241],[83.93306,27.44939],[84.02229,27.43836],[84.10791,27.52399],[84.21376,27.45218],[84.25735,27.44941],[84.29315,27.39],[84.62161,27.33885],[84.69166,27.21294],[84.64496,27.04669],[84.793,26.9968],[84.82913,27.01989],[84.85754,26.98984],[84.96687,26.95599],[84.97186,26.9149],[85.00536,26.89523],[85.05592,26.88991],[85.02635,26.85381],[85.15883,26.86966],[85.19291,26.86909],[85.18046,26.80519],[85.21159,26.75933],[85.34302,26.74954],[85.47752,26.79292],[85.56471,26.84133],[85.5757,26.85955],[85.59461,26.85161],[85.61621,26.86721],[85.66239,26.84822],[85.73483,26.79613],[85.72315,26.67471],[85.76907,26.63076],[85.83126,26.61134],[85.85126,26.60866],[85.8492,26.56667],[86.02729,26.66756],[86.13596,26.60651],[86.22513,26.58863],[86.26235,26.61886],[86.31564,26.61925],[86.49726,26.54218],[86.54258,26.53819],[86.57073,26.49825],[86.61313,26.48658],[86.62686,26.46891],[86.69124,26.45169],[86.74025,26.42386],[86.76797,26.45892],[86.82898,26.43919],[86.94543,26.52076],[86.95912,26.52076],[87.01559,26.53228],[87.04691,26.58685],[87.0707,26.58571],[87.09147,26.45039],[87.14751,26.40542],[87.18863,26.40558],[87.24682,26.4143],[87.26587,26.40592],[87.26568,26.37294],[87.34568,26.34787],[87.37314,26.40815],[87.46566,26.44058],[87.51571,26.43106],[87.55274,26.40596],[87.59175,26.38342],[87.66803,26.40294],[87.67893,26.43501],[87.76004,26.40711],[87.7918,26.46737],[87.84193,26.43663],[87.89085,26.48565],[87.90115,26.44923],[88.00895,26.36029],[88.09414,26.43732],[88.09963,26.54195],[88.16452,26.64111],[88.1659,26.68177],[88.19107,26.75516],[88.12302,26.95324],[88.13422,26.98705],[88.11719,26.98758],[87.9887,27.11045],[88.01587,27.21388],[88.01646,27.21612],[88.07277,27.43007],[88.04008,27.49223],[88.19107,27.79285],[88.1973,27.85067],[88.13378,27.88015]]]]}},{type:"Feature",properties:{iso1A2:"NR",iso1A3:"NRU",iso1N3:"520",wikidata:"Q697",nameEn:"Nauru",groups:["057","009","UN"],driveSide:"left",callingCodes:["674"]},geometry:{type:"MultiPolygon",coordinates:[[[[166.95155,.14829],[166.21778,-.7977],[167.60042,-.88259],[166.95155,.14829]]]]}},{type:"Feature",properties:{iso1A2:"NU",iso1A3:"NIU",iso1N3:"570",wikidata:"Q34020",nameEn:"Niue",country:"NZ",groups:["061","009","UN"],driveSide:"left",callingCodes:["683"]},geometry:{type:"MultiPolygon",coordinates:[[[[-170.83899,-18.53439],[-170.82274,-20.44429],[-168.63096,-18.60489],[-170.83899,-18.53439]]]]}},{type:"Feature",properties:{iso1A2:"NZ",iso1A3:"NZL",iso1N3:"554",wikidata:"Q664",nameEn:"New Zealand"},geometry:null},{type:"Feature",properties:{iso1A2:"OM",iso1A3:"OMN",iso1N3:"512",wikidata:"Q842",nameEn:"Oman",groups:["145","142","UN"],callingCodes:["968"]},geometry:{type:"MultiPolygon",coordinates:[[[[56.82555,25.7713],[56.79239,26.41236],[56.68954,26.76645],[56.2644,26.58649],[55.81777,26.18798],[56.08666,26.05038],[56.15498,26.06828],[56.19334,25.9795],[56.13963,25.82765],[56.17416,25.77239],[56.13579,25.73524],[56.14826,25.66351],[56.18363,25.65508],[56.20473,25.61119],[56.25365,25.60211],[56.26636,25.60643],[56.25341,25.61443],[56.26534,25.62825],[56.82555,25.7713]]],[[[56.26062,25.33108],[56.23362,25.31253],[56.25008,25.28843],[56.24465,25.27505],[56.20838,25.25668],[56.20872,25.24104],[56.24341,25.22867],[56.27628,25.23404],[56.34438,25.26653],[56.35172,25.30681],[56.3111,25.30107],[56.3005,25.31815],[56.26062,25.33108]],[[56.28423,25.26344],[56.27086,25.26128],[56.2716,25.27916],[56.28102,25.28486],[56.29379,25.2754],[56.28423,25.26344]]],[[[61.45114,22.55394],[56.86325,25.03856],[56.3227,24.97284],[56.34873,24.93205],[56.30269,24.88334],[56.20568,24.85063],[56.20062,24.78565],[56.13684,24.73699],[56.06128,24.74457],[56.03535,24.81161],[55.97836,24.87673],[55.97467,24.89639],[56.05106,24.87461],[56.05715,24.95727],[55.96316,25.00857],[55.90849,24.96771],[55.85094,24.96858],[55.81116,24.9116],[55.81348,24.80102],[55.83408,24.77858],[55.83271,24.68567],[55.76461,24.5287],[55.83271,24.41521],[55.83395,24.32776],[55.80747,24.31069],[55.79145,24.27914],[55.76781,24.26209],[55.75939,24.26114],[55.75382,24.2466],[55.75257,24.23466],[55.76558,24.23227],[55.77658,24.23476],[55.83367,24.20193],[55.95472,24.2172],[56.01799,24.07426],[55.8308,24.01633],[55.73301,24.05994],[55.48677,23.94946],[55.57358,23.669],[55.22634,23.10378],[55.2137,22.71065],[55.66469,21.99658],[54.99756,20.00083],[52.00311,19.00083],[52.78009,17.35124],[52.74267,17.29519],[52.81185,17.28568],[57.49095,8.14549],[61.45114,22.55394]]]]}},{type:"Feature",properties:{iso1A2:"PA",iso1A3:"PAN",iso1N3:"591",wikidata:"Q804",nameEn:"Panama",groups:["013","003","419","019","UN"],callingCodes:["507"]},geometry:{type:"MultiPolygon",coordinates:[[[[-77.32389,8.81247],[-77.58292,9.22278],[-78.79327,9.93766],[-82.51044,9.65379],[-82.56507,9.57279],[-82.61345,9.49881],[-82.66667,9.49746],[-82.77206,9.59573],[-82.87919,9.62645],[-82.84871,9.4973],[-82.93516,9.46741],[-82.93516,9.07687],[-82.72126,8.97125],[-82.88253,8.83331],[-82.91377,8.774],[-82.92068,8.74832],[-82.8794,8.6981],[-82.82739,8.60153],[-82.83975,8.54755],[-82.83322,8.52464],[-82.8382,8.48117],[-82.8679,8.44042],[-82.93056,8.43465],[-83.05209,8.33394],[-82.9388,8.26634],[-82.88641,8.10219],[-82.89137,8.05755],[-82.89978,8.04083],[-82.94503,7.93865],[-82.13751,6.97312],[-78.06168,7.07793],[-77.89178,7.22681],[-77.81426,7.48319],[-77.72157,7.47612],[-77.72514,7.72348],[-77.57185,7.51147],[-77.17257,7.97422],[-77.45064,8.49991],[-77.32389,8.81247]]]]}},{type:"Feature",properties:{iso1A2:"PE",iso1A3:"PER",iso1N3:"604",wikidata:"Q419",nameEn:"Peru",groups:["005","419","019","UN"],callingCodes:["51"]},geometry:{type:"MultiPolygon",coordinates:[[[[-74.26675,-.97229],[-74.42701,-.50218],[-75.18513,-.0308],[-75.25764,-.11943],[-75.40192,-.17196],[-75.61997,-.10012],[-75.60169,-.18708],[-75.53615,-.19213],[-75.22862,-.60048],[-75.22862,-.95588],[-75.3872,-.9374],[-75.57429,-1.55961],[-76.05203,-2.12179],[-76.6324,-2.58397],[-77.94147,-3.05454],[-78.19369,-3.36431],[-78.14324,-3.47653],[-78.22642,-3.51113],[-78.24589,-3.39907],[-78.34362,-3.38633],[-78.68394,-4.60754],[-78.85149,-4.66795],[-79.01659,-5.01481],[-79.1162,-4.97774],[-79.26248,-4.95167],[-79.59402,-4.46848],[-79.79722,-4.47558],[-80.13945,-4.29786],[-80.39256,-4.48269],[-80.46386,-4.41516],[-80.32114,-4.21323],[-80.45023,-4.20938],[-80.4822,-4.05477],[-80.46386,-4.01342],[-80.13232,-3.90317],[-80.19926,-3.68894],[-80.18741,-3.63994],[-80.19848,-3.59249],[-80.21642,-3.5888],[-80.20535,-3.51667],[-80.22629,-3.501],[-80.23651,-3.48652],[-80.24586,-3.48677],[-80.24123,-3.46124],[-80.20647,-3.431],[-80.30602,-3.39149],[-84.52388,-3.36941],[-85.71054,-21.15413],[-70.59118,-18.35072],[-70.378,-18.3495],[-70.31267,-18.31258],[-70.16394,-18.31737],[-69.96732,-18.25992],[-69.81607,-18.12582],[-69.75305,-17.94605],[-69.82868,-17.72048],[-69.79087,-17.65563],[-69.66483,-17.65083],[-69.46897,-17.4988],[-69.46863,-17.37466],[-69.62883,-17.28142],[-69.16896,-16.72233],[-69.00853,-16.66769],[-69.04027,-16.57214],[-68.98358,-16.42165],[-68.79464,-16.33272],[-68.96238,-16.194],[-69.09986,-16.22693],[-69.20291,-16.16668],[-69.40336,-15.61358],[-69.14856,-15.23478],[-69.36254,-14.94634],[-68.88135,-14.18639],[-69.05265,-13.68546],[-68.8864,-13.40792],[-68.85615,-12.87769],[-68.65044,-12.50689],[-68.98115,-11.8979],[-69.57156,-10.94555],[-69.57835,-10.94051],[-69.90896,-10.92744],[-70.38791,-11.07096],[-70.51395,-10.92249],[-70.64134,-11.0108],[-70.62487,-9.80666],[-70.55429,-9.76692],[-70.58453,-9.58303],[-70.53373,-9.42628],[-71.23394,-9.9668],[-72.14742,-9.98049],[-72.31883,-9.5184],[-72.72216,-9.41397],[-73.21498,-9.40904],[-72.92886,-9.04074],[-73.76576,-7.89884],[-73.65485,-7.77897],[-73.96938,-7.58465],[-73.77011,-7.28944],[-73.73986,-6.87919],[-73.12983,-6.43852],[-73.24579,-6.05764],[-72.83973,-5.14765],[-72.64391,-5.0391],[-71.87003,-4.51661],[-70.96814,-4.36915],[-70.77601,-4.15717],[-70.33236,-4.15214],[-70.19582,-4.3607],[-70.11305,-4.27281],[-70.00888,-4.37833],[-69.94708,-4.2431],[-70.3374,-3.79505],[-70.52393,-3.87553],[-70.71396,-3.7921],[-70.04609,-2.73906],[-70.94377,-2.23142],[-71.75223,-2.15058],[-72.92587,-2.44514],[-73.65312,-1.26222],[-74.26675,-.97229]]]]}},{type:"Feature",properties:{iso1A2:"PF",iso1A3:"PYF",iso1N3:"258",wikidata:"Q30971",nameEn:"French Polynesia",country:"FR",groups:["EU","Q1451600","061","009","UN"],callingCodes:["689"]},geometry:{type:"MultiPolygon",coordinates:[[[[-135.59706,-4.70473],[-156.48634,-15.52824],[-156.45576,-31.75456],[-133.59543,-28.4709],[-135.59706,-4.70473]]]]}},{type:"Feature",properties:{iso1A2:"PG",iso1A3:"PNG",iso1N3:"598",wikidata:"Q691",nameEn:"Papua New Guinea",groups:["054","009","UN"],driveSide:"left",callingCodes:["675"]},geometry:{type:"MultiPolygon",coordinates:[[[[141.03157,2.12829],[140.99813,-6.3233],[140.85295,-6.72996],[140.90448,-6.85033],[141.01763,-6.90181],[141.01842,-9.35091],[141.88934,-9.36111],[142.19246,-9.15378],[142.48658,-9.36754],[143.29772,-9.33993],[143.87386,-9.02382],[145.2855,-9.62524],[156.73836,-14.50464],[154.74815,-7.33315],[155.60735,-6.92266],[155.69784,-6.92661],[155.92557,-6.84664],[156.03993,-6.65703],[156.03296,-6.55528],[160.43769,-4.17974],[141.03157,2.12829]]]]}},{type:"Feature",properties:{iso1A2:"PH",iso1A3:"PHL",iso1N3:"608",wikidata:"Q928",nameEn:"Philippines",aliases:["PI","RP"],groups:["035","142","UN"],callingCodes:["63"]},geometry:{type:"MultiPolygon",coordinates:[[[[129.19694,7.84182],[121.8109,21.77688],[120.69238,21.52331],[118.82252,14.67191],[115.39742,10.92666],[116.79524,7.43869],[117.17735,7.52841],[117.93857,6.89845],[117.98544,6.27477],[119.52945,5.35672],[118.93936,4.09009],[118.06469,4.16638],[121.14448,2.12444],[129.19694,7.84182]]]]}},{type:"Feature",properties:{iso1A2:"PK",iso1A3:"PAK",iso1N3:"586",wikidata:"Q843",nameEn:"Pakistan",groups:["034","142","UN"],driveSide:"left",callingCodes:["92"]},geometry:{type:"MultiPolygon",coordinates:[[[[75.72737,36.7529],[75.45562,36.71971],[75.40481,36.95382],[75.13839,37.02622],[74.56453,37.03023],[74.53739,36.96224],[74.43389,37.00977],[74.04856,36.82648],[73.82685,36.91421],[72.6323,36.84601],[72.18135,36.71838],[71.80267,36.49924],[71.60491,36.39429],[71.19505,36.04134],[71.37969,35.95865],[71.55273,35.71483],[71.49917,35.6267],[71.65435,35.4479],[71.54294,35.31037],[71.5541,35.28776],[71.67495,35.21262],[71.52938,35.09023],[71.55273,35.02615],[71.49917,35.00478],[71.50329,34.97328],[71.29472,34.87728],[71.28356,34.80882],[71.08718,34.69034],[71.11602,34.63047],[71.0089,34.54568],[71.02401,34.44835],[71.17662,34.36769],[71.12815,34.26619],[71.13078,34.16503],[71.09453,34.13524],[71.09307,34.11961],[71.06933,34.10564],[71.07345,34.06242],[70.88119,33.97933],[70.54336,33.9463],[69.90203,34.04194],[69.87307,33.9689],[69.85671,33.93719],[70.00503,33.73528],[70.14236,33.71701],[70.14785,33.6553],[70.20141,33.64387],[70.17062,33.53535],[70.32775,33.34496],[70.13686,33.21064],[70.07369,33.22557],[70.02563,33.14282],[69.85259,33.09451],[69.79766,33.13247],[69.71526,33.09911],[69.57656,33.09911],[69.49004,33.01509],[69.49854,32.88843],[69.5436,32.8768],[69.47082,32.85834],[69.38018,32.76601],[69.43649,32.7302],[69.44747,32.6678],[69.38155,32.56601],[69.2868,32.53938],[69.23599,32.45946],[69.27932,32.29119],[69.27032,32.14141],[69.3225,31.93186],[69.20577,31.85957],[69.11514,31.70782],[69.00939,31.62249],[68.95995,31.64822],[68.91078,31.59687],[68.79997,31.61665],[68.6956,31.75687],[68.57475,31.83158],[68.44222,31.76446],[68.27605,31.75863],[68.25614,31.80357],[68.1655,31.82691],[68.00071,31.6564],[67.86887,31.63536],[67.72056,31.52304],[67.58323,31.52772],[67.62374,31.40473],[67.7748,31.4188],[67.78854,31.33203],[67.29964,31.19586],[67.03323,31.24519],[67.04147,31.31561],[66.83273,31.26867],[66.72561,31.20526],[66.68166,31.07597],[66.58175,30.97532],[66.42645,30.95309],[66.39194,30.9408],[66.28413,30.57001],[66.34869,30.404],[66.23609,30.06321],[66.36042,29.9583],[66.24175,29.85181],[65.04005,29.53957],[64.62116,29.58903],[64.19796,29.50407],[64.12966,29.39157],[63.5876,29.50456],[62.47751,29.40782],[60.87231,29.86514],[61.31508,29.38903],[61.53765,29.00507],[61.65978,28.77937],[61.93581,28.55284],[62.40259,28.42703],[62.59499,28.24842],[62.79412,28.28108],[62.7638,28.02992],[62.84905,27.47627],[62.79684,27.34381],[62.80604,27.22412],[63.19649,27.25674],[63.32283,27.14437],[63.25005,27.08692],[63.25005,26.84212],[63.18688,26.83844],[63.1889,26.65072],[62.77352,26.64099],[62.31484,26.528],[62.21304,26.26601],[62.05117,26.31647],[61.89391,26.26251],[61.83831,26.07249],[61.83968,25.7538],[61.683,25.66638],[61.6433,25.27541],[61.46682,24.57869],[68.11329,23.53945],[68.20763,23.85849],[68.39339,23.96838],[68.74643,23.97027],[68.7416,24.31904],[68.90914,24.33156],[68.97781,24.26021],[69.07806,24.29777],[69.19341,24.25646],[69.29778,24.28712],[69.59579,24.29777],[69.73335,24.17007],[70.03428,24.172],[70.11712,24.30915],[70.5667,24.43787],[70.57906,24.27774],[70.71502,24.23517],[70.88393,24.27398],[70.85784,24.30903],[70.94985,24.3791],[71.04461,24.34657],[71.12838,24.42662],[71.00341,24.46038],[70.97594,24.60904],[71.09405,24.69017],[70.94002,24.92843],[70.89148,25.15064],[70.66695,25.39314],[70.67382,25.68186],[70.60378,25.71898],[70.53649,25.68928],[70.37444,25.67443],[70.2687,25.71156],[70.0985,25.93238],[70.08193,26.08094],[70.17532,26.24118],[70.17532,26.55362],[70.05584,26.60398],[69.88555,26.56836],[69.50904,26.74892],[69.58519,27.18109],[70.03136,27.56627],[70.12502,27.8057],[70.37307,28.01208],[70.60927,28.02178],[70.79054,27.68423],[71.89921,27.96035],[71.9244,28.11555],[72.20329,28.3869],[72.29495,28.66367],[72.40402,28.78283],[72.94272,29.02487],[73.01337,29.16422],[73.05886,29.1878],[73.28094,29.56646],[73.3962,29.94707],[73.58665,30.01848],[73.80299,30.06969],[73.97225,30.19829],[73.95736,30.28466],[73.88993,30.36305],[74.5616,31.04153],[74.67971,31.05479],[74.6852,31.12771],[74.60006,31.13711],[74.60281,31.10419],[74.56023,31.08303],[74.51629,31.13829],[74.53223,31.30321],[74.59773,31.4136],[74.64713,31.45605],[74.59319,31.50197],[74.61517,31.55698],[74.57498,31.60382],[74.47771,31.72227],[74.58907,31.87824],[74.79919,31.95983],[74.86236,32.04485],[74.9269,32.0658],[75.00793,32.03786],[75.25649,32.10187],[75.38046,32.26836],[75.28259,32.36556],[75.03265,32.49538],[74.97634,32.45367],[74.84725,32.49075],[74.68362,32.49298],[74.67431,32.56676],[74.65251,32.56416],[74.64424,32.60985],[74.69542,32.66792],[74.65345,32.71225],[74.7113,32.84219],[74.64675,32.82604],[74.6289,32.75561],[74.45312,32.77755],[74.41467,32.90563],[74.31227,32.92795],[74.34875,32.97823],[74.31854,33.02891],[74.17571,33.07495],[74.15374,33.13477],[74.02144,33.18908],[74.01366,33.25199],[74.08782,33.26232],[74.17983,33.3679],[74.18121,33.4745],[74.10115,33.56392],[74.03576,33.56718],[73.97367,33.64061],[73.98968,33.66155],[73.96423,33.73071],[74.00891,33.75437],[74.05898,33.82089],[74.14001,33.83002],[74.26086,33.92237],[74.25262,34.01577],[74.21554,34.03853],[73.91341,34.01235],[73.88732,34.05105],[73.90677,34.10504],[73.98208,34.2522],[73.90517,34.35317],[73.8475,34.32935],[73.74862,34.34183],[73.74999,34.3781],[73.88732,34.48911],[73.89419,34.54568],[73.93951,34.57169],[73.93401,34.63386],[73.96423,34.68244],[74.12897,34.70073],[74.31239,34.79626],[74.58083,34.77386],[74.6663,34.703],[75.01479,34.64629],[75.38009,34.55021],[75.75438,34.51827],[76.04614,34.67566],[76.15463,34.6429],[76.47186,34.78965],[76.67648,34.76371],[76.74377,34.84039],[76.74514,34.92488],[76.87193,34.96906],[76.99251,34.93349],[77.11796,35.05419],[76.93465,35.39866],[76.85088,35.39754],[76.75475,35.52617],[76.77323,35.66062],[76.50961,35.8908],[76.33453,35.84296],[76.14913,35.82848],[76.15325,35.9264],[75.93028,36.13136],[76.00906,36.17511],[76.0324,36.41198],[75.92391,36.56986],[75.72737,36.7529]]]]}},{type:"Feature",properties:{iso1A2:"PL",iso1A3:"POL",iso1N3:"616",wikidata:"Q36",nameEn:"Poland",groups:["EU","151","150","UN"],callingCodes:["48"]},geometry:{type:"MultiPolygon",coordinates:[[[[18.57853,55.25302],[14.20811,54.12784],[14.22634,53.9291],[14.20647,53.91671],[14.18544,53.91258],[14.20823,53.90776],[14.21323,53.8664],[14.27249,53.74464],[14.26782,53.69866],[14.2836,53.67721],[14.27133,53.66613],[14.28477,53.65955],[14.2853,53.63392],[14.31904,53.61581],[14.30416,53.55499],[14.3273,53.50587],[14.35209,53.49506],[14.4215,53.27724],[14.44133,53.27427],[14.45125,53.26241],[14.40662,53.21098],[14.37853,53.20405],[14.36696,53.16444],[14.38679,53.13669],[14.35044,53.05829],[14.25954,53.00264],[14.14056,52.95786],[14.15873,52.87715],[14.12256,52.84311],[14.13806,52.82392],[14.22071,52.81175],[14.61073,52.59847],[14.6289,52.57136],[14.60081,52.53116],[14.63056,52.48993],[14.54423,52.42568],[14.55228,52.35264],[14.56378,52.33838],[14.58149,52.28007],[14.70139,52.25038],[14.71319,52.22144],[14.68344,52.19612],[14.70616,52.16927],[14.67683,52.13936],[14.6917,52.10283],[14.72971,52.09167],[14.76026,52.06624],[14.71339,52.00337],[14.70488,51.97679],[14.7139,51.95643],[14.71836,51.95606],[14.72163,51.95188],[14.7177,51.94048],[14.70601,51.92944],[14.6933,51.9044],[14.6588,51.88359],[14.59089,51.83302],[14.60493,51.80473],[14.64625,51.79472],[14.66386,51.73282],[14.69065,51.70842],[14.75392,51.67445],[14.75759,51.62318],[14.7727,51.61263],[14.71125,51.56209],[14.73047,51.54606],[14.72652,51.53902],[14.73219,51.52922],[14.94749,51.47155],[14.9652,51.44793],[14.96899,51.38367],[14.98008,51.33449],[15.04288,51.28387],[15.01242,51.21285],[15.0047,51.16874],[14.99311,51.16249],[14.99414,51.15813],[15.00083,51.14974],[14.99646,51.14365],[14.99079,51.14284],[14.99689,51.12205],[14.98229,51.11354],[14.97938,51.07742],[14.95529,51.04552],[14.92942,50.99744],[14.89252,50.94999],[14.89681,50.9422],[14.81664,50.88148],[14.82803,50.86966],[14.99852,50.86817],[15.01088,50.97984],[14.96419,50.99108],[15.02433,51.0242],[15.03895,51.0123],[15.06218,51.02269],[15.10152,51.01095],[15.11937,50.99021],[15.16744,51.01959],[15.1743,50.9833],[15.2361,50.99886],[15.27043,50.97724],[15.2773,50.8907],[15.36656,50.83956],[15.3803,50.77187],[15.43798,50.80833],[15.73186,50.73885],[15.81683,50.75666],[15.87331,50.67188],[15.97219,50.69799],[16.0175,50.63009],[15.98317,50.61528],[16.02437,50.60046],[16.10265,50.66405],[16.20839,50.63096],[16.23174,50.67101],[16.33611,50.66579],[16.44597,50.58041],[16.34572,50.49575],[16.31413,50.50274],[16.19526,50.43291],[16.21585,50.40627],[16.22821,50.41054],[16.28118,50.36891],[16.30289,50.38292],[16.36495,50.37679],[16.3622,50.34875],[16.39379,50.3207],[16.42674,50.32509],[16.56407,50.21009],[16.55446,50.16613],[16.63137,50.1142],[16.7014,50.09659],[16.8456,50.20834],[16.98018,50.24172],[17.00353,50.21449],[17.02825,50.23118],[16.99803,50.25753],[17.02138,50.27772],[16.99803,50.30316],[16.94448,50.31281],[16.90877,50.38642],[16.85933,50.41093],[16.89229,50.45117],[17.1224,50.39494],[17.14498,50.38117],[17.19579,50.38817],[17.19991,50.3654],[17.27681,50.32246],[17.34273,50.32947],[17.34548,50.2628],[17.3702,50.28123],[17.58889,50.27837],[17.67764,50.28977],[17.69292,50.32859],[17.74648,50.29966],[17.72176,50.25665],[17.76296,50.23382],[17.70528,50.18812],[17.59404,50.16437],[17.66683,50.10275],[17.6888,50.12037],[17.7506,50.07896],[17.77669,50.02253],[17.86886,49.97452],[18.00191,50.01723],[18.04585,50.01194],[18.04585,50.03311],[18.00396,50.04954],[18.03212,50.06574],[18.07898,50.04535],[18.10628,50.00223],[18.20241,49.99958],[18.21752,49.97309],[18.27107,49.96779],[18.27794,49.93863],[18.31914,49.91565],[18.33278,49.92415],[18.33562,49.94747],[18.41604,49.93498],[18.53423,49.89906],[18.54495,49.9079],[18.54299,49.92537],[18.57697,49.91565],[18.57045,49.87849],[18.60341,49.86256],[18.57183,49.83334],[18.61278,49.7618],[18.61368,49.75426],[18.62645,49.75002],[18.62943,49.74603],[18.62676,49.71983],[18.69817,49.70473],[18.72838,49.68163],[18.80479,49.6815],[18.84786,49.5446],[18.84521,49.51672],[18.94536,49.52143],[18.97283,49.49914],[18.9742,49.39557],[19.18019,49.41165],[19.25435,49.53391],[19.36009,49.53747],[19.37795,49.574],[19.45348,49.61583],[19.52626,49.57311],[19.53313,49.52856],[19.57845,49.46077],[19.64162,49.45184],[19.6375,49.40897],[19.72127,49.39288],[19.78581,49.41701],[19.82237,49.27806],[19.75286,49.20751],[19.86409,49.19316],[19.90529,49.23532],[19.98494,49.22904],[20.08238,49.1813],[20.13738,49.31685],[20.21977,49.35265],[20.31453,49.34817],[20.31728,49.39914],[20.39939,49.3896],[20.46422,49.41612],[20.5631,49.375],[20.61666,49.41791],[20.72274,49.41813],[20.77971,49.35383],[20.9229,49.29626],[20.98733,49.30774],[21.09799,49.37176],[21.041,49.41791],[21.12477,49.43666],[21.19756,49.4054],[21.27858,49.45988],[21.43376,49.41433],[21.62328,49.4447],[21.77983,49.35443],[21.82927,49.39467],[21.96385,49.3437],[22.04427,49.22136],[22.56155,49.08865],[22.89122,49.00725],[22.86336,49.10513],[22.72009,49.20288],[22.748,49.32759],[22.69444,49.49378],[22.64534,49.53094],[22.78304,49.65543],[22.80261,49.69098],[22.83179,49.69875],[22.99329,49.84249],[23.28221,50.0957],[23.67635,50.33385],[23.71382,50.38248],[23.79445,50.40481],[23.99563,50.41289],[24.03668,50.44507],[24.07048,50.5071],[24.0996,50.60752],[24.0595,50.71625],[23.95925,50.79271],[23.99254,50.83847],[24.0952,50.83262],[24.14524,50.86128],[24.04576,50.90196],[23.92217,51.00836],[23.90376,51.07697],[23.80678,51.18405],[23.63858,51.32182],[23.69905,51.40871],[23.62751,51.50512],[23.56236,51.53673],[23.57053,51.55938],[23.53198,51.74298],[23.62691,51.78208],[23.61523,51.92066],[23.68733,51.9906],[23.64066,52.07626],[23.61,52.11264],[23.54314,52.12148],[23.47859,52.18215],[23.20071,52.22848],[23.18196,52.28812],[23.34141,52.44845],[23.45112,52.53774],[23.58296,52.59868],[23.73615,52.6149],[23.93763,52.71332],[23.91805,52.94016],[23.94689,52.95919],[23.92184,53.02079],[23.87548,53.0831],[23.91393,53.16469],[23.85657,53.22923],[23.81995,53.24131],[23.62004,53.60942],[23.51284,53.95052],[23.48261,53.98855],[23.52702,54.04622],[23.49196,54.14764],[23.45223,54.17775],[23.42418,54.17911],[23.39525,54.21672],[23.3494,54.25155],[23.24656,54.25701],[23.15938,54.29894],[23.15526,54.31076],[23.13905,54.31567],[23.104,54.29794],[23.04323,54.31567],[23.05726,54.34565],[22.99649,54.35927],[23.00584,54.38514],[22.83756,54.40827],[22.79705,54.36264],[21.41123,54.32395],[20.63871,54.3706],[19.8038,54.44203],[19.64312,54.45423],[18.57853,55.25302]]]]}},{type:"Feature",properties:{iso1A2:"PM",iso1A3:"SPM",iso1N3:"666",wikidata:"Q34617",nameEn:"Saint Pierre and Miquelon",country:"FR",groups:["EU","Q1451600","021","003","019","UN"],callingCodes:["508"]},geometry:{type:"MultiPolygon",coordinates:[[[[-56.72993,46.65575],[-55.90758,46.6223],[-56.27503,47.39728],[-56.72993,46.65575]]]]}},{type:"Feature",properties:{iso1A2:"PN",iso1A3:"PCN",iso1N3:"612",wikidata:"Q35672",nameEn:"Pitcairn Islands",country:"GB",groups:["BOTS","061","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[-133.59543,-28.4709],[-122.0366,-24.55017],[-133.61511,-21.93325],[-133.59543,-28.4709]]]]}},{type:"Feature",properties:{iso1A2:"PR",iso1A3:"PRI",iso1N3:"630",wikidata:"Q1183",nameEn:"Puerto Rico",aliases:["US-PR"],country:"US",groups:["Q1352230","029","003","419","019","UN"],roadSpeedUnit:"mph",callingCodes:["1 787","1 939"]},geometry:{type:"MultiPolygon",coordinates:[[[[-65.27974,17.56928],[-65.02435,18.73231],[-67.99519,18.97186],[-68.23894,17.84663],[-65.27974,17.56928]]]]}},{type:"Feature",properties:{iso1A2:"PS",iso1A3:"PSE",iso1N3:"275",wikidata:"Q219060",nameEn:"Palestine"},geometry:null},{type:"Feature",properties:{iso1A2:"PT",iso1A3:"PRT",iso1N3:"620",wikidata:"Q45",nameEn:"Portugal"},geometry:null},{type:"Feature",properties:{iso1A2:"PW",iso1A3:"PLW",iso1N3:"585",wikidata:"Q695",nameEn:"Palau",groups:["057","009","UN"],roadSpeedUnit:"mph",callingCodes:["680"]},geometry:{type:"MultiPolygon",coordinates:[[[[128.97621,3.08804],[136.39296,1.54187],[136.04605,12.45908],[128.97621,3.08804]]]]}},{type:"Feature",properties:{iso1A2:"PY",iso1A3:"PRY",iso1N3:"600",wikidata:"Q733",nameEn:"Paraguay",groups:["005","419","019","UN"],callingCodes:["595"]},geometry:{type:"MultiPolygon",coordinates:[[[[-58.16225,-20.16193],[-58.23216,-19.80058],[-59.06965,-19.29148],[-60.00638,-19.2981],[-61.73723,-19.63958],[-61.93912,-20.10053],[-62.26883,-20.55311],[-62.2757,-21.06657],[-62.64455,-22.25091],[-62.51761,-22.37684],[-62.22768,-22.55807],[-61.9756,-23.0507],[-61.0782,-23.62932],[-60.99754,-23.80934],[-60.28163,-24.04436],[-60.03367,-24.00701],[-59.45482,-24.34787],[-59.33886,-24.49935],[-58.33055,-24.97099],[-58.25492,-24.92528],[-57.80821,-25.13863],[-57.57431,-25.47269],[-57.87176,-25.93604],[-58.1188,-26.16704],[-58.3198,-26.83443],[-58.65321,-27.14028],[-58.59549,-27.29973],[-58.04205,-27.2387],[-56.85337,-27.5165],[-56.18313,-27.29851],[-55.89195,-27.3467],[-55.74475,-27.44485],[-55.59094,-27.32444],[-55.62322,-27.1941],[-55.39611,-26.97679],[-55.25243,-26.93808],[-55.16948,-26.96068],[-55.06351,-26.80195],[-55.00584,-26.78754],[-54.80868,-26.55669],[-54.70732,-26.45099],[-54.69333,-26.37705],[-54.67359,-25.98607],[-54.60664,-25.9691],[-54.62063,-25.91213],[-54.59398,-25.59224],[-54.59509,-25.53696],[-54.60196,-25.48397],[-54.62033,-25.46026],[-54.4423,-25.13381],[-54.28207,-24.07305],[-54.32807,-24.01865],[-54.6238,-23.83078],[-55.02691,-23.97317],[-55.0518,-23.98666],[-55.12292,-23.99669],[-55.41784,-23.9657],[-55.44117,-23.9185],[-55.43585,-23.87157],[-55.5555,-23.28237],[-55.52288,-23.2595],[-55.5446,-23.22811],[-55.63849,-22.95122],[-55.62493,-22.62765],[-55.68742,-22.58407],[-55.6986,-22.56268],[-55.72366,-22.5519],[-55.741,-22.52018],[-55.74941,-22.46436],[-55.8331,-22.29008],[-56.23206,-22.25347],[-56.45893,-22.08072],[-56.5212,-22.11556],[-56.6508,-22.28387],[-57.98625,-22.09157],[-57.94642,-21.73799],[-57.88239,-21.6868],[-57.93492,-21.65505],[-57.84536,-20.93155],[-58.16225,-20.16193]]]]}},{type:"Feature",properties:{iso1A2:"QA",iso1A3:"QAT",iso1N3:"634",wikidata:"Q846",nameEn:"Qatar",groups:["145","142","UN"],callingCodes:["974"]},geometry:{type:"MultiPolygon",coordinates:[[[[50.92992,24.54396],[51.09638,24.46907],[51.29972,24.50747],[51.39468,24.62785],[51.58834,24.66608],[51.83108,24.71675],[51.83682,26.70231],[50.93865,26.30758],[50.81266,25.88946],[50.86149,25.6965],[50.7801,25.595],[50.80824,25.54641],[50.57069,25.57887],[50.8133,24.74049],[50.92992,24.54396]]]]}},{type:"Feature",properties:{iso1A2:"RE",iso1A3:"REU",iso1N3:"638",wikidata:"Q17070",nameEn:"R\xE9union",country:"FR",groups:["Q3320166","EU","014","202","002","UN"],callingCodes:["262"]},geometry:{type:"MultiPolygon",coordinates:[[[[53.37984,-21.23941],[56.73473,-21.9174],[56.62373,-20.2711],[53.37984,-21.23941]]]]}},{type:"Feature",properties:{iso1A2:"RO",iso1A3:"ROU",iso1N3:"642",wikidata:"Q218",nameEn:"Romania",groups:["EU","151","150","UN"],callingCodes:["40"]},geometry:{type:"MultiPolygon",coordinates:[[[[27.15622,47.98538],[27.02985,48.09083],[27.04118,48.12522],[26.96119,48.13003],[26.98042,48.15752],[26.94265,48.1969],[26.87708,48.19919],[26.81161,48.25049],[26.62823,48.25804],[26.55202,48.22445],[26.33504,48.18418],[26.17711,47.99246],[26.05901,47.9897],[25.77723,47.93919],[25.63878,47.94924],[25.23778,47.89403],[25.11144,47.75203],[24.88896,47.7234],[24.81893,47.82031],[24.70632,47.84428],[24.61994,47.95062],[24.43578,47.97131],[24.34926,47.9244],[24.22566,47.90231],[24.11281,47.91487],[24.06466,47.95317],[24.02999,47.95087],[24.00801,47.968],[23.98553,47.96076],[23.96337,47.96672],[23.94192,47.94868],[23.89352,47.94512],[23.8602,47.9329],[23.80904,47.98142],[23.75188,47.99705],[23.66262,47.98786],[23.63894,48.00293],[23.5653,48.00499],[23.52803,48.01818],[23.4979,47.96858],[23.33577,48.0237],[23.27397,48.08245],[23.15999,48.12188],[23.1133,48.08061],[23.08858,48.00716],[23.0158,47.99338],[22.92241,48.02002],[22.94301,47.96672],[22.89849,47.95851],[22.77991,47.87211],[22.76617,47.8417],[22.67247,47.7871],[22.46559,47.76583],[22.41979,47.7391],[22.31816,47.76126],[22.00917,47.50492],[22.03389,47.42508],[22.01055,47.37767],[21.94463,47.38046],[21.78395,47.11104],[21.648,47.03902],[21.68645,46.99595],[21.59581,46.91628],[21.59307,46.86935],[21.52028,46.84118],[21.48935,46.7577],[21.5151,46.72147],[21.43926,46.65109],[21.33214,46.63035],[21.26929,46.4993],[21.28061,46.44941],[21.16872,46.30118],[21.06572,46.24897],[20.86797,46.28884],[20.74574,46.25467],[20.76085,46.21002],[20.63863,46.12728],[20.49718,46.18721],[20.45377,46.14405],[20.35573,46.16629],[20.28324,46.1438],[20.26068,46.12332],[20.35862,45.99356],[20.54818,45.89939],[20.65645,45.82801],[20.70069,45.7493],[20.77416,45.75601],[20.78446,45.78522],[20.82364,45.77738],[20.80361,45.65875],[20.76798,45.60969],[20.83321,45.53567],[20.77217,45.49788],[20.86026,45.47295],[20.87948,45.42743],[21.09894,45.30144],[21.17612,45.32566],[21.20392,45.2677],[21.29398,45.24148],[21.48278,45.19557],[21.51299,45.15345],[21.4505,45.04294],[21.35855,45.01941],[21.54938,44.9327],[21.56328,44.89502],[21.48202,44.87199],[21.44013,44.87613],[21.35643,44.86364],[21.38802,44.78133],[21.55007,44.77304],[21.60019,44.75208],[21.61942,44.67059],[21.67504,44.67107],[21.71692,44.65349],[21.7795,44.66165],[21.99364,44.63395],[22.08016,44.49844],[22.13234,44.47444],[22.18315,44.48179],[22.30844,44.6619],[22.45301,44.7194],[22.61917,44.61489],[22.69196,44.61587],[22.76749,44.54446],[22.70981,44.51852],[22.61368,44.55719],[22.56493,44.53419],[22.54021,44.47836],[22.45436,44.47258],[22.56012,44.30712],[22.68166,44.28206],[22.67173,44.21564],[23.04988,44.07694],[23.01674,44.01946],[22.87873,43.9844],[22.83753,43.88055],[22.85314,43.84452],[23.05288,43.79494],[23.26772,43.84843],[23.4507,43.84936],[23.61687,43.79289],[23.73978,43.80627],[24.18149,43.68218],[24.35364,43.70211],[24.50264,43.76314],[24.62281,43.74082],[24.73542,43.68523],[24.96682,43.72693],[25.10718,43.6831],[25.17144,43.70261],[25.39528,43.61866],[25.72792,43.69263],[25.94911,43.85745],[26.05584,43.90925],[26.10115,43.96908],[26.38764,44.04356],[26.62712,44.05698],[26.95141,44.13555],[27.26845,44.12602],[27.39757,44.0141],[27.60834,44.01206],[27.64542,44.04958],[27.73468,43.95326],[27.92008,44.00761],[27.99558,43.84193],[28.23293,43.76],[29.24336,43.70874],[30.04414,45.08461],[29.69272,45.19227],[29.65428,45.25629],[29.68175,45.26885],[29.59798,45.38857],[29.42632,45.44545],[29.24779,45.43388],[28.96077,45.33164],[28.94292,45.28045],[28.81383,45.3384],[28.78911,45.24179],[28.71358,45.22631],[28.5735,45.24759],[28.34554,45.32102],[28.28504,45.43907],[28.21139,45.46895],[28.18741,45.47358],[28.08927,45.6051],[28.16568,45.6421],[28.13111,45.92819],[28.08612,46.01105],[28.13684,46.18099],[28.10937,46.22852],[28.19864,46.31869],[28.18902,46.35283],[28.25769,46.43334],[28.22281,46.50481],[28.24808,46.64305],[28.12173,46.82283],[28.09095,46.97621],[27.81892,47.1381],[27.73172,47.29248],[27.68706,47.28962],[27.60263,47.32507],[27.55731,47.46637],[27.47942,47.48113],[27.3979,47.59473],[27.32202,47.64009],[27.25519,47.71366],[27.29069,47.73722],[27.1618,47.92391],[27.15622,47.98538]]]]}},{type:"Feature",properties:{iso1A2:"RS",iso1A3:"SRB",iso1N3:"688",wikidata:"Q403",nameEn:"Serbia",groups:["039","150","UN"],callingCodes:["381"]},geometry:{type:"MultiPolygon",coordinates:[[[[19.66007,46.19005],[19.56113,46.16824],[19.52473,46.1171],[19.28826,45.99694],[19.14543,45.9998],[19.10388,46.04015],[19.0791,45.96458],[19.01284,45.96529],[18.99712,45.93537],[18.81394,45.91329],[18.85783,45.85493],[18.90305,45.71863],[18.96691,45.66731],[18.88776,45.57253],[18.94562,45.53712],[19.07471,45.53086],[19.08364,45.48804],[18.99918,45.49333],[18.97446,45.37528],[19.10774,45.29547],[19.28208,45.23813],[19.41941,45.23475],[19.43589,45.17137],[19.19144,45.17863],[19.14063,45.12972],[19.07952,45.14668],[19.1011,45.01191],[19.05205,44.97692],[19.15573,44.95409],[19.06853,44.89915],[19.02871,44.92541],[18.98957,44.90645],[19.01994,44.85493],[19.18183,44.92055],[19.36722,44.88164],[19.32543,44.74058],[19.26388,44.65412],[19.16699,44.52197],[19.13369,44.52521],[19.12278,44.50132],[19.14837,44.45253],[19.14681,44.41463],[19.11785,44.40313],[19.10749,44.39421],[19.10704,44.38249],[19.10365,44.37795],[19.10298,44.36924],[19.11865,44.36712],[19.1083,44.3558],[19.11547,44.34218],[19.13556,44.338],[19.13332,44.31492],[19.16741,44.28648],[19.18328,44.28383],[19.20508,44.2917],[19.23306,44.26097],[19.26945,44.26957],[19.32464,44.27185],[19.34773,44.23244],[19.3588,44.18353],[19.40927,44.16722],[19.43905,44.13088],[19.47338,44.15034],[19.48386,44.14332],[19.47321,44.1193],[19.51167,44.08158],[19.55999,44.06894],[19.57467,44.04716],[19.61991,44.05254],[19.61836,44.01464],[19.56498,43.99922],[19.52515,43.95573],[19.38439,43.96611],[19.24363,44.01502],[19.23465,43.98764],[19.3986,43.79668],[19.5176,43.71403],[19.50455,43.58385],[19.42696,43.57987],[19.41941,43.54056],[19.36653,43.60921],[19.33426,43.58833],[19.2553,43.5938],[19.24774,43.53061],[19.22807,43.5264],[19.22229,43.47926],[19.44315,43.38846],[19.48171,43.32644],[19.52962,43.31623],[19.54598,43.25158],[19.62661,43.2286],[19.64063,43.19027],[19.76918,43.16044],[19.79255,43.11951],[19.92576,43.08539],[19.96549,43.11098],[19.98887,43.0538],[20.04729,43.02732],[20.05431,42.99571],[20.12325,42.96237],[20.14896,42.99058],[20.16415,42.97177],[20.34528,42.90676],[20.35692,42.8335],[20.40594,42.84853],[20.43734,42.83157],[20.53484,42.8885],[20.48692,42.93208],[20.59929,43.01067],[20.64557,43.00826],[20.69515,43.09641],[20.59929,43.20492],[20.68688,43.21335],[20.73811,43.25068],[20.82145,43.26769],[20.88685,43.21697],[20.83727,43.17842],[20.96287,43.12416],[21.00749,43.13984],[21.05378,43.10707],[21.08952,43.13471],[21.14465,43.11089],[21.16734,42.99694],[21.2041,43.02277],[21.23877,43.00848],[21.23534,42.95523],[21.2719,42.8994],[21.32974,42.90424],[21.36941,42.87397],[21.44047,42.87276],[21.39045,42.74888],[21.47498,42.74695],[21.59154,42.72643],[21.58755,42.70418],[21.6626,42.67813],[21.75025,42.70125],[21.79413,42.65923],[21.75672,42.62695],[21.7327,42.55041],[21.70522,42.54176],[21.7035,42.51899],[21.62556,42.45106],[21.64209,42.41081],[21.62887,42.37664],[21.59029,42.38042],[21.57021,42.3647],[21.53467,42.36809],[21.5264,42.33634],[21.56772,42.30946],[21.58992,42.25915],[21.70111,42.23789],[21.77176,42.2648],[21.84654,42.3247],[21.91595,42.30392],[21.94405,42.34669],[22.02908,42.29848],[22.16384,42.32103],[22.29605,42.37477],[22.29275,42.34913],[22.34773,42.31725],[22.45919,42.33822],[22.47498,42.3915],[22.51961,42.3991],[22.55669,42.50144],[22.43983,42.56851],[22.4997,42.74144],[22.43309,42.82057],[22.54302,42.87774],[22.74826,42.88701],[22.78397,42.98253],[22.89521,43.03625],[22.98104,43.11199],[23.00806,43.19279],[22.89727,43.22417],[22.82036,43.33665],[22.53397,43.47225],[22.47582,43.6558],[22.41043,43.69566],[22.35558,43.81281],[22.41449,44.00514],[22.61688,44.06534],[22.61711,44.16938],[22.67173,44.21564],[22.68166,44.28206],[22.56012,44.30712],[22.45436,44.47258],[22.54021,44.47836],[22.56493,44.53419],[22.61368,44.55719],[22.70981,44.51852],[22.76749,44.54446],[22.69196,44.61587],[22.61917,44.61489],[22.45301,44.7194],[22.30844,44.6619],[22.18315,44.48179],[22.13234,44.47444],[22.08016,44.49844],[21.99364,44.63395],[21.7795,44.66165],[21.71692,44.65349],[21.67504,44.67107],[21.61942,44.67059],[21.60019,44.75208],[21.55007,44.77304],[21.38802,44.78133],[21.35643,44.86364],[21.44013,44.87613],[21.48202,44.87199],[21.56328,44.89502],[21.54938,44.9327],[21.35855,45.01941],[21.4505,45.04294],[21.51299,45.15345],[21.48278,45.19557],[21.29398,45.24148],[21.20392,45.2677],[21.17612,45.32566],[21.09894,45.30144],[20.87948,45.42743],[20.86026,45.47295],[20.77217,45.49788],[20.83321,45.53567],[20.76798,45.60969],[20.80361,45.65875],[20.82364,45.77738],[20.78446,45.78522],[20.77416,45.75601],[20.70069,45.7493],[20.65645,45.82801],[20.54818,45.89939],[20.35862,45.99356],[20.26068,46.12332],[20.09713,46.17315],[20.03533,46.14509],[20.01816,46.17696],[19.93508,46.17553],[19.81491,46.1313],[19.66007,46.19005]]]]}},{type:"Feature",properties:{iso1A2:"RU",iso1A3:"RUS",iso1N3:"643",wikidata:"Q159",nameEn:"Russia"},geometry:null},{type:"Feature",properties:{iso1A2:"RW",iso1A3:"RWA",iso1N3:"646",wikidata:"Q1037",nameEn:"Rwanda",groups:["014","202","002","UN"],callingCodes:["250"]},geometry:{type:"MultiPolygon",coordinates:[[[[30.47194,-1.0555],[30.35212,-1.06896],[30.16369,-1.34303],[29.912,-1.48269],[29.82657,-1.31187],[29.59061,-1.39016],[29.53062,-1.40499],[29.45038,-1.5054],[29.36322,-1.50887],[29.24323,-1.66826],[29.24458,-1.69663],[29.11847,-1.90576],[29.17562,-2.12278],[29.105,-2.27043],[29.00051,-2.29001],[28.95642,-2.37321],[28.89601,-2.37321],[28.86826,-2.41888],[28.86846,-2.44866],[28.89132,-2.47557],[28.89342,-2.49017],[28.88846,-2.50493],[28.87497,-2.50887],[28.86209,-2.5231],[28.86193,-2.53185],[28.87943,-2.55165],[28.89288,-2.55848],[28.90226,-2.62385],[28.89793,-2.66111],[28.94346,-2.69124],[29.00357,-2.70596],[29.04081,-2.7416],[29.0562,-2.58632],[29.32234,-2.6483],[29.36805,-2.82933],[29.88237,-2.75105],[29.95911,-2.33348],[30.14034,-2.43626],[30.42933,-2.31064],[30.54501,-2.41404],[30.83915,-2.35795],[30.89303,-2.08223],[30.80802,-1.91477],[30.84079,-1.64652],[30.71974,-1.43244],[30.57123,-1.33264],[30.50889,-1.16412],[30.45116,-1.10641],[30.47194,-1.0555]]]]}},{type:"Feature",properties:{iso1A2:"SA",iso1A3:"SAU",iso1N3:"682",wikidata:"Q851",nameEn:"Saudi Arabia",groups:["145","142","UN"],callingCodes:["966"]},geometry:{type:"MultiPolygon",coordinates:[[[[40.01521,32.05667],[39.29903,32.23259],[38.99233,31.99721],[36.99791,31.50081],[37.99354,30.49998],[37.66395,30.33245],[37.4971,29.99949],[36.75083,29.86903],[36.50005,29.49696],[36.07081,29.18469],[34.8812,29.36878],[34.4454,27.91479],[37.8565,22.00903],[39.63762,18.37348],[40.99158,15.81743],[42.15205,16.40211],[42.76801,16.40371],[42.94625,16.39721],[42.94351,16.49467],[42.97215,16.51093],[43.11601,16.53166],[43.15274,16.67248],[43.22066,16.65179],[43.21325,16.74416],[43.25857,16.75304],[43.26303,16.79479],[43.24801,16.80613],[43.22956,16.80613],[43.22012,16.83932],[43.18338,16.84852],[43.1398,16.90696],[43.19328,16.94703],[43.1813,16.98438],[43.18233,17.02673],[43.23967,17.03428],[43.17787,17.14717],[43.20156,17.25901],[43.32653,17.31179],[43.22533,17.38343],[43.29185,17.53224],[43.43005,17.56148],[43.70631,17.35762],[44.50126,17.47475],[46.31018,17.20464],[46.76494,17.29151],[47.00571,16.94765],[47.48245,17.10808],[47.58351,17.50366],[48.19996,18.20584],[49.04884,18.59899],[52.00311,19.00083],[54.99756,20.00083],[55.66469,21.99658],[55.2137,22.71065],[55.13599,22.63334],[52.56622,22.94341],[51.59617,24.12041],[51.58871,24.27256],[51.41644,24.39615],[51.58834,24.66608],[51.39468,24.62785],[51.29972,24.50747],[51.09638,24.46907],[50.92992,24.54396],[50.8133,24.74049],[50.57069,25.57887],[50.302,25.87592],[50.26923,26.08243],[50.38162,26.53976],[50.71771,26.73086],[50.37726,27.89227],[49.98877,27.87827],[49.00421,28.81495],[48.42991,28.53628],[47.70561,28.5221],[47.59863,28.66798],[47.58376,28.83382],[47.46202,29.0014],[46.5527,29.10283],[46.42415,29.05947],[44.72255,29.19736],[42.97796,30.48295],[42.97601,30.72204],[40.01521,32.05667]]]]}},{type:"Feature",properties:{iso1A2:"SB",iso1A3:"SLB",iso1N3:"090",wikidata:"Q685",nameEn:"Solomon Islands",groups:["054","009","UN"],driveSide:"left",callingCodes:["677"]},geometry:{type:"MultiPolygon",coordinates:[[[[172.71443,-12.01327],[160.43769,-4.17974],[156.03296,-6.55528],[156.03993,-6.65703],[155.92557,-6.84664],[155.69784,-6.92661],[155.60735,-6.92266],[154.74815,-7.33315],[156.73836,-14.50464],[172.71443,-12.01327]]]]}},{type:"Feature",properties:{iso1A2:"SC",iso1A3:"SYC",iso1N3:"690",wikidata:"Q1042",nameEn:"Seychelles",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["248"]},geometry:{type:"MultiPolygon",coordinates:[[[[43.75112,-10.38913],[54.83239,-10.93575],[66.3222,5.65313],[43.75112,-10.38913]]]]}},{type:"Feature",properties:{iso1A2:"SD",iso1A3:"SDN",iso1N3:"729",wikidata:"Q1049",nameEn:"Sudan",groups:["015","002","UN"],callingCodes:["249"]},geometry:{type:"MultiPolygon",coordinates:[[[[37.8565,22.00903],[34.0765,22.00501],[33.99686,21.76784],[33.57251,21.72406],[33.17563,22.00405],[24.99885,21.99535],[24.99794,19.99661],[23.99715,20.00038],[23.99539,19.49944],[23.99997,15.69575],[23.62785,15.7804],[23.38812,15.69649],[23.10792,15.71297],[22.93201,15.55107],[22.92579,15.47007],[22.99584,15.40105],[22.99584,15.22989],[22.66115,14.86308],[22.70474,14.69149],[22.38562,14.58907],[22.44944,14.24986],[22.55997,14.23024],[22.5553,14.11704],[22.22995,13.96754],[22.08674,13.77863],[22.29689,13.3731],[22.1599,13.19281],[22.02914,13.13976],[21.94819,13.05637],[21.81432,12.81362],[21.89371,12.68001],[21.98711,12.63292],[22.15679,12.66634],[22.22684,12.74682],[22.46345,12.61925],[22.38873,12.45514],[22.50548,12.16769],[22.48369,12.02766],[22.64092,12.07485],[22.54907,11.64372],[22.7997,11.40424],[22.93124,11.41645],[22.97249,11.21955],[22.87758,10.91915],[23.02221,10.69235],[23.3128,10.45214],[23.67164,9.86923],[23.69155,9.67566],[24.09319,9.66572],[24.12744,9.73784],[24.49389,9.79962],[24.84653,9.80643],[24.97739,9.9081],[25.05688,10.06776],[25.0918,10.33718],[25.78141,10.42599],[25.93163,10.38159],[25.93241,10.17941],[26.21338,9.91545],[26.35815,9.57946],[26.70685,9.48735],[27.14427,9.62858],[27.90704,9.61323],[28.99983,9.67155],[29.06988,9.74826],[29.53844,9.75133],[29.54,10.07949],[29.94629,10.29245],[30.00389,10.28633],[30.53005,9.95992],[30.82893,9.71451],[30.84605,9.7498],[31.28504,9.75287],[31.77539,10.28939],[31.99177,10.65065],[32.46967,11.04662],[32.39358,11.18207],[32.39578,11.70208],[32.10079,11.95203],[32.73921,11.95203],[32.73921,12.22757],[33.25876,12.22111],[33.13988,11.43248],[33.26977,10.83632],[33.24645,10.77913],[33.52294,10.64382],[33.66604,10.44254],[33.80913,10.32994],[33.90159,10.17179],[33.96984,10.15446],[33.99185,9.99623],[33.96323,9.80972],[33.9082,9.762],[33.87958,9.49937],[34.10229,9.50238],[34.08717,9.55243],[34.13186,9.7492],[34.20484,9.9033],[34.22718,10.02506],[34.32102,10.11599],[34.34783,10.23914],[34.2823,10.53508],[34.4372,10.781],[34.59062,10.89072],[34.77383,10.74588],[34.77532,10.69027],[34.86618,10.74588],[34.86916,10.78832],[34.97491,10.86147],[34.97789,10.91559],[34.93172,10.95946],[35.01215,11.19626],[34.95704,11.24448],[35.09556,11.56278],[35.05832,11.71158],[35.11492,11.85156],[35.24302,11.91132],[35.70476,12.67101],[36.01458,12.72478],[36.14268,12.70879],[36.16651,12.88019],[36.13374,12.92665],[36.24545,13.36759],[36.38993,13.56459],[36.48824,13.83954],[36.44653,13.95666],[36.54376,14.25597],[36.44337,15.14963],[36.54276,15.23478],[36.69761,15.75323],[36.76371,15.80831],[36.92193,16.23451],[36.99777,17.07172],[37.42694,17.04041],[37.50967,17.32199],[38.13362,17.53906],[38.37133,17.66269],[38.45916,17.87167],[38.57727,17.98125],[39.63762,18.37348],[37.8565,22.00903]]]]}},{type:"Feature",properties:{iso1A2:"SE",iso1A3:"SWE",iso1N3:"752",wikidata:"Q34",nameEn:"Sweden",groups:["EU","154","150","UN"],callingCodes:["46"]},geometry:{type:"MultiPolygon",coordinates:[[[[24.15791,65.85385],[23.90497,66.15802],[23.71339,66.21299],[23.64982,66.30603],[23.67591,66.3862],[23.63776,66.43568],[23.85959,66.56434],[23.89488,66.772],[23.98059,66.79585],[23.98563,66.84149],[23.56214,67.17038],[23.58735,67.20752],[23.54701,67.25435],[23.75372,67.29914],[23.75372,67.43688],[23.39577,67.46974],[23.54701,67.59306],[23.45627,67.85297],[23.65793,67.9497],[23.40081,68.05545],[23.26469,68.15134],[23.15377,68.14759],[23.10336,68.26551],[22.73028,68.40881],[22.00429,68.50692],[21.03001,68.88969],[20.90649,68.89696],[20.85104,68.93142],[20.91658,68.96764],[20.78802,69.03087],[20.55258,69.06069],[20.0695,69.04469],[20.28444,68.93283],[20.33435,68.80174],[20.22027,68.67246],[19.95647,68.55546],[20.22027,68.48759],[19.93508,68.35911],[18.97255,68.52416],[18.63032,68.50849],[18.39503,68.58672],[18.1241,68.53721],[18.13836,68.20874],[17.90787,67.96537],[17.30416,68.11591],[16.7409,67.91037],[16.38441,67.52923],[16.12774,67.52106],[16.09922,67.4364],[16.39154,67.21653],[16.35589,67.06419],[15.37197,66.48217],[15.49318,66.28509],[15.05113,66.15572],[14.53778,66.12399],[14.50926,65.31786],[13.64276,64.58402],[14.11117,64.46674],[14.16051,64.18725],[13.98222,64.00953],[13.23411,64.09087],[12.74105,64.02171],[12.14928,63.59373],[12.19919,63.47935],[11.98529,63.27487],[12.19919,63.00104],[12.07085,62.6297],[12.29187,62.25699],[12.14746,61.7147],[12.40595,61.57226],[12.57707,61.56547],[12.86939,61.35427],[12.69115,61.06584],[12.2277,61.02442],[12.59133,60.50559],[12.52003,60.13846],[12.36317,59.99259],[12.15641,59.8926],[11.87121,59.86039],[11.92112,59.69531],[11.69297,59.59442],[11.8213,59.24985],[11.65732,58.90177],[11.45199,58.89604],[11.4601,58.99022],[11.34459,59.11672],[11.15367,59.07862],[11.08911,58.98745],[10.64958,58.89391],[10.40861,58.38489],[12.16597,56.60205],[12.07466,56.29488],[12.65312,56.04345],[12.6372,55.91371],[12.88472,55.63369],[12.60345,55.42675],[12.84405,55.13257],[14.28399,55.1553],[14.89259,55.5623],[15.79951,55.54655],[19.64795,57.06466],[19.84909,57.57876],[20.5104,59.15546],[19.08191,60.19152],[19.23413,60.61414],[20.15877,63.06556],[24.14112,65.39731],[24.15107,65.81427],[24.14798,65.83466],[24.15791,65.85385]]]]}},{type:"Feature",properties:{iso1A2:"SG",iso1A3:"SGP",iso1N3:"702",wikidata:"Q334",nameEn:"Singapore",groups:["035","142","UN"],driveSide:"left",callingCodes:["65"]},geometry:{type:"MultiPolygon",coordinates:[[[[104.00131,1.42405],[103.93384,1.42926],[103.89565,1.42841],[103.86383,1.46288],[103.81181,1.47953],[103.76395,1.45183],[103.74161,1.4502],[103.7219,1.46108],[103.67468,1.43166],[103.62738,1.35255],[103.56591,1.19719],[103.66049,1.18825],[103.74084,1.12902],[104.03085,1.26954],[104.12282,1.27714],[104.08072,1.35998],[104.09162,1.39694],[104.08871,1.42015],[104.07348,1.43322],[104.04622,1.44691],[104.02277,1.4438],[104.00131,1.42405]]]]}},{type:"Feature",properties:{iso1A2:"SH",iso1A3:"SHN",iso1N3:"654",wikidata:"Q192184",nameEn:"Saint Helena, Ascension and Tristan da Cunha",country:"GB"},geometry:null},{type:"Feature",properties:{iso1A2:"SI",iso1A3:"SVN",iso1N3:"705",wikidata:"Q215",nameEn:"Slovenia",groups:["EU","039","150","UN"],callingCodes:["386"]},geometry:{type:"MultiPolygon",coordinates:[[[[16.50139,46.56684],[16.39217,46.63673],[16.38594,46.6549],[16.41863,46.66238],[16.42641,46.69228],[16.37816,46.69975],[16.30966,46.7787],[16.31303,46.79838],[16.3408,46.80641],[16.34547,46.83836],[16.2941,46.87137],[16.2365,46.87775],[16.21892,46.86961],[16.15711,46.85434],[16.14365,46.8547],[16.10983,46.867],[16.05786,46.83927],[15.99054,46.82772],[15.99126,46.78199],[15.98432,46.74991],[15.99769,46.7266],[16.02808,46.71094],[16.04347,46.68694],[16.04036,46.6549],[15.99988,46.67947],[15.98512,46.68463],[15.94864,46.68769],[15.87691,46.7211],[15.8162,46.71897],[15.78518,46.70712],[15.76771,46.69863],[15.73823,46.70011],[15.72279,46.69548],[15.69523,46.69823],[15.67411,46.70735],[15.6543,46.70616],[15.6543,46.69228],[15.6365,46.6894],[15.63255,46.68069],[15.62317,46.67947],[15.59826,46.68908],[15.54533,46.66985],[15.55333,46.64988],[15.54431,46.6312],[15.46906,46.61321],[15.45514,46.63697],[15.41235,46.65556],[15.23711,46.63994],[15.14215,46.66131],[15.01451,46.641],[14.98024,46.6009],[14.96002,46.63459],[14.92283,46.60848],[14.87129,46.61],[14.86419,46.59411],[14.83549,46.56614],[14.81836,46.51046],[14.72185,46.49974],[14.66892,46.44936],[14.5942,46.43434],[14.56463,46.37208],[14.52176,46.42617],[14.45877,46.41717],[14.42608,46.44614],[14.314,46.43327],[14.28326,46.44315],[14.15989,46.43327],[14.12097,46.47724],[14.04002,46.49117],[14.00422,46.48474],[13.89837,46.52331],[13.7148,46.5222],[13.68684,46.43881],[13.59777,46.44137],[13.5763,46.42613],[13.5763,46.40915],[13.47019,46.3621],[13.43418,46.35992],[13.44808,46.33507],[13.37671,46.29668],[13.42218,46.20758],[13.47587,46.22725],[13.56114,46.2054],[13.56682,46.18703],[13.64451,46.18966],[13.66472,46.17392],[13.64053,46.13587],[13.57072,46.09022],[13.50104,46.05986],[13.49568,46.04839],[13.50998,46.04498],[13.49702,46.01832],[13.47474,46.00546],[13.50104,45.98078],[13.52963,45.96588],[13.56759,45.96991],[13.58903,45.99009],[13.62074,45.98388],[13.63458,45.98947],[13.64307,45.98326],[13.6329,45.94894],[13.63815,45.93607],[13.61931,45.91782],[13.60857,45.89907],[13.59565,45.89446],[13.58644,45.88173],[13.57563,45.8425],[13.58858,45.83503],[13.59784,45.8072],[13.66986,45.79955],[13.8235,45.7176],[13.83332,45.70855],[13.83422,45.68703],[13.87933,45.65207],[13.9191,45.6322],[13.8695,45.60835],[13.86771,45.59898],[13.84106,45.58185],[13.78445,45.5825],[13.74587,45.59811],[13.7198,45.59352],[13.6076,45.64761],[13.45644,45.59464],[13.56979,45.4895],[13.62902,45.45898],[13.67398,45.4436],[13.7785,45.46787],[13.81742,45.43729],[13.88124,45.42637],[13.90771,45.45149],[13.97309,45.45258],[13.99488,45.47551],[13.96063,45.50825],[14.00578,45.52352],[14.07116,45.48752],[14.20348,45.46896],[14.22371,45.50388],[14.24239,45.50607],[14.26611,45.48239],[14.27681,45.4902],[14.32487,45.47142],[14.36693,45.48642],[14.49769,45.54424],[14.5008,45.60852],[14.53816,45.6205],[14.57397,45.67165],[14.60977,45.66403],[14.59576,45.62812],[14.69694,45.57366],[14.68605,45.53006],[14.71718,45.53442],[14.80124,45.49515],[14.81992,45.45913],[14.90554,45.47769],[14.92266,45.52788],[15.02385,45.48533],[15.05187,45.49079],[15.16862,45.42309],[15.27758,45.46678],[15.33051,45.45258],[15.38188,45.48752],[15.30249,45.53224],[15.29837,45.5841],[15.27747,45.60504],[15.31027,45.6303],[15.34695,45.63382],[15.34214,45.64702],[15.38952,45.63682],[15.4057,45.64727],[15.34919,45.71623],[15.30872,45.69014],[15.25423,45.72275],[15.40836,45.79491],[15.47531,45.79802],[15.47325,45.8253],[15.52234,45.82195],[15.57952,45.84953],[15.64185,45.82915],[15.66662,45.84085],[15.70411,45.8465],[15.68232,45.86819],[15.68383,45.88867],[15.67967,45.90455],[15.70636,45.92116],[15.70327,46.00015],[15.71246,46.01196],[15.72977,46.04682],[15.62317,46.09103],[15.6083,46.11992],[15.59909,46.14761],[15.64904,46.19229],[15.6434,46.21396],[15.67395,46.22478],[15.75436,46.21969],[15.75479,46.20336],[15.78817,46.21719],[15.79284,46.25811],[15.97965,46.30652],[16.07616,46.3463],[16.07314,46.36458],[16.05065,46.3833],[16.05281,46.39141],[16.14859,46.40547],[16.18824,46.38282],[16.30233,46.37837],[16.30162,46.40437],[16.27329,46.41467],[16.27398,46.42875],[16.25124,46.48067],[16.23961,46.49653],[16.26759,46.50566],[16.26733,46.51505],[16.29793,46.5121],[16.37193,46.55008],[16.38771,46.53608],[16.44036,46.5171],[16.5007,46.49644],[16.52604,46.47831],[16.59527,46.47524],[16.52604,46.5051],[16.52885,46.53303],[16.50139,46.56684]]]]}},{type:"Feature",properties:{iso1A2:"SJ",iso1A3:"SJM",iso1N3:"744",wikidata:"Q842829",nameEn:"Svalbard and Jan Mayen",country:"NO"},geometry:null},{type:"Feature",properties:{iso1A2:"SK",iso1A3:"SVK",iso1N3:"703",wikidata:"Q214",nameEn:"Slovakia",groups:["EU","151","150","UN"],callingCodes:["421"]},geometry:{type:"MultiPolygon",coordinates:[[[[19.82237,49.27806],[19.78581,49.41701],[19.72127,49.39288],[19.6375,49.40897],[19.64162,49.45184],[19.57845,49.46077],[19.53313,49.52856],[19.52626,49.57311],[19.45348,49.61583],[19.37795,49.574],[19.36009,49.53747],[19.25435,49.53391],[19.18019,49.41165],[18.9742,49.39557],[18.97283,49.49914],[18.94536,49.52143],[18.84521,49.51672],[18.74761,49.492],[18.67757,49.50895],[18.6144,49.49824],[18.57183,49.51162],[18.53063,49.49022],[18.54848,49.47059],[18.44686,49.39467],[18.4084,49.40003],[18.4139,49.36517],[18.36446,49.3267],[18.18456,49.28909],[18.15022,49.24518],[18.1104,49.08624],[18.06885,49.03157],[17.91814,49.01784],[17.87831,48.92679],[17.77944,48.92318],[17.73126,48.87885],[17.7094,48.86721],[17.5295,48.81117],[17.45671,48.85004],[17.3853,48.80936],[17.29054,48.85546],[17.19355,48.87602],[17.11202,48.82925],[17.00215,48.70887],[16.93955,48.60371],[16.94611,48.53614],[16.85204,48.44968],[16.8497,48.38321],[16.83588,48.3844],[16.83317,48.38138],[16.84243,48.35258],[16.90903,48.32519],[16.89461,48.31332],[16.97701,48.17385],[17.02919,48.13996],[17.05735,48.14179],[17.09168,48.09366],[17.07039,48.0317],[17.16001,48.00636],[17.23699,48.02094],[17.71215,47.7548],[18.02938,47.75665],[18.29305,47.73541],[18.56496,47.76588],[18.66521,47.76772],[18.74074,47.8157],[18.8506,47.82308],[18.76821,47.87469],[18.76134,47.97499],[18.82176,48.04206],[19.01952,48.07052],[19.23924,48.0595],[19.28182,48.08336],[19.47957,48.09437],[19.52489,48.19791],[19.63338,48.25006],[19.92452,48.1283],[20.24312,48.2784],[20.29943,48.26104],[20.5215,48.53336],[20.83248,48.5824],[21.11516,48.49546],[21.44063,48.58456],[21.6068,48.50365],[21.67134,48.3989],[21.72525,48.34628],[21.8279,48.33321],[21.83339,48.36242],[22.14689,48.4005],[22.16023,48.56548],[22.21379,48.6218],[22.34151,48.68893],[22.42934,48.92857],[22.48296,48.99172],[22.54338,49.01424],[22.56155,49.08865],[22.04427,49.22136],[21.96385,49.3437],[21.82927,49.39467],[21.77983,49.35443],[21.62328,49.4447],[21.43376,49.41433],[21.27858,49.45988],[21.19756,49.4054],[21.12477,49.43666],[21.041,49.41791],[21.09799,49.37176],[20.98733,49.30774],[20.9229,49.29626],[20.77971,49.35383],[20.72274,49.41813],[20.61666,49.41791],[20.5631,49.375],[20.46422,49.41612],[20.39939,49.3896],[20.31728,49.39914],[20.31453,49.34817],[20.21977,49.35265],[20.13738,49.31685],[20.08238,49.1813],[19.98494,49.22904],[19.90529,49.23532],[19.86409,49.19316],[19.75286,49.20751],[19.82237,49.27806]]]]}},{type:"Feature",properties:{iso1A2:"SL",iso1A3:"SLE",iso1N3:"694",wikidata:"Q1044",nameEn:"Sierra Leone",groups:["011","202","002","UN"],callingCodes:["232"]},geometry:{type:"MultiPolygon",coordinates:[[[[-10.27575,8.48711],[-10.37257,8.48941],[-10.54891,8.31174],[-10.63934,8.35326],[-10.70565,8.29235],[-10.61422,8.5314],[-10.47707,8.67669],[-10.56197,8.81225],[-10.5783,9.06386],[-10.74484,9.07998],[-10.6534,9.29919],[-11.2118,10.00098],[-11.89624,9.99763],[-11.91023,9.93927],[-12.12634,9.87203],[-12.24262,9.92386],[-12.47254,9.86834],[-12.76788,9.3133],[-12.94095,9.26335],[-13.08953,9.0409],[-13.18586,9.0925],[-13.29911,9.04245],[-14.36218,8.64107],[-12.15048,6.15992],[-11.50429,6.92704],[-11.4027,6.97746],[-11.29417,7.21576],[-10.60422,7.7739],[-10.60492,8.04072],[-10.57523,8.04829],[-10.51554,8.1393],[-10.45023,8.15627],[-10.35227,8.15223],[-10.29839,8.21283],[-10.31635,8.28554],[-10.30084,8.30008],[-10.27575,8.48711]]]]}},{type:"Feature",properties:{iso1A2:"SM",iso1A3:"SMR",iso1N3:"674",wikidata:"Q238",nameEn:"San Marino",groups:["039","150","UN"],callingCodes:["378"]},geometry:{type:"MultiPolygon",coordinates:[[[[12.45648,43.89369],[12.48771,43.89706],[12.49429,43.90973],[12.49247,43.91774],[12.49724,43.92248],[12.50269,43.92363],[12.50496,43.93017],[12.51553,43.94096],[12.51427,43.94897],[12.50655,43.95796],[12.50875,43.96198],[12.50622,43.97131],[12.51109,43.97201],[12.51064,43.98165],[12.5154,43.98508],[12.51463,43.99122],[12.50678,43.99113],[12.49406,43.98492],[12.47853,43.98052],[12.46205,43.97463],[12.44684,43.96597],[12.43662,43.95698],[12.42005,43.9578],[12.41414,43.95273],[12.40415,43.95485],[12.40506,43.94325],[12.41165,43.93769],[12.41551,43.92984],[12.40733,43.92379],[12.41233,43.90956],[12.40935,43.9024],[12.41641,43.89991],[12.44184,43.90498],[12.45648,43.89369]]]]}},{type:"Feature",properties:{iso1A2:"SN",iso1A3:"SEN",iso1N3:"686",wikidata:"Q1041",nameEn:"Senegal",groups:["011","202","002","UN"],callingCodes:["221"]},geometry:{type:"MultiPolygon",coordinates:[[[[-14.32144,16.61495],[-15.00557,16.64997],[-15.6509,16.50315],[-16.27016,16.51565],[-16.4429,16.20605],[-16.44814,16.09753],[-16.48967,16.0496],[-16.50854,16.09032],[-17.15288,16.07139],[-18.35085,14.63444],[-17.43598,13.59273],[-15.47902,13.58758],[-15.36504,13.79313],[-14.93719,13.80173],[-14.34721,13.46578],[-13.8955,13.59126],[-13.79409,13.34472],[-14.36795,13.23033],[-15.14917,13.57989],[-15.26908,13.37768],[-15.80478,13.34832],[-15.80355,13.16729],[-16.69343,13.16791],[-16.74676,13.06025],[-17.43966,13.04579],[-17.4623,11.92379],[-16.70562,12.34803],[-16.38191,12.36449],[-16.20591,12.46157],[-15.67302,12.42974],[-15.17582,12.6847],[-13.70523,12.68013],[-13.05296,12.64003],[-13.06603,12.49342],[-12.87336,12.51892],[-12.35415,12.32758],[-11.91331,12.42008],[-11.46267,12.44559],[-11.37536,12.40788],[-11.39935,12.97808],[-11.63025,13.39174],[-11.83345,13.33333],[-12.06897,13.71049],[-11.93043,13.84505],[-12.23936,14.76324],[-13.11029,15.52116],[-13.43135,16.09022],[-13.80075,16.13961],[-14.32144,16.61495]]]]}},{type:"Feature",properties:{iso1A2:"SO",iso1A3:"SOM",iso1N3:"706",wikidata:"Q1045",nameEn:"Somalia",groups:["014","202","002","UN"],callingCodes:["252"]},geometry:{type:"MultiPolygon",coordinates:[[[[51.12877,12.56479],[43.90659,12.3823],[42.95776,10.98533],[42.69452,10.62672],[42.87643,10.18441],[43.0937,9.90579],[43.23518,9.84605],[43.32613,9.59205],[44.19222,8.93028],[46.99339,7.9989],[47.92477,8.00111],[47.97917,8.00124],[44.98104,4.91821],[44.02436,4.9451],[43.40263,4.79289],[43.04177,4.57923],[42.97746,4.44032],[42.84526,4.28357],[42.55853,4.20518],[42.07619,4.17667],[41.89488,3.97375],[41.31368,3.14314],[40.98767,2.82959],[41.00099,-.83068],[41.56,-1.59812],[41.56362,-1.66375],[41.75542,-1.85308],[57.49095,8.14549],[51.12877,12.56479]]]]}},{type:"Feature",properties:{iso1A2:"SR",iso1A3:"SUR",iso1N3:"740",wikidata:"Q730",nameEn:"Suriname",groups:["005","419","019","UN"],driveSide:"left",callingCodes:["597"]},geometry:{type:"MultiPolygon",coordinates:[[[[-54.26916,5.26909],[-54.01877,5.52789],[-54.01074,5.68785],[-53.7094,6.2264],[-56.84822,6.73257],[-57.31629,5.33714],[-57.22536,5.15605],[-57.37442,5.0208],[-57.8699,4.89394],[-58.0307,3.95513],[-57.35891,3.32121],[-56.70519,2.02964],[-56.55439,2.02003],[-56.47045,1.95135],[-55.99278,1.83137],[-55.89863,1.89861],[-55.92159,2.05236],[-56.13054,2.27723],[-55.96292,2.53188],[-55.71493,2.40342],[-55.01919,2.564],[-54.6084,2.32856],[-54.42864,2.42442],[-54.28534,2.67798],[-53.9849,3.58697],[-53.98914,3.627],[-54.05128,3.63557],[-54.19367,3.84387],[-54.38444,4.13222],[-54.4717,4.91964],[-54.26916,5.26909]]]]}},{type:"Feature",properties:{iso1A2:"SS",iso1A3:"SSD",iso1N3:"728",wikidata:"Q958",nameEn:"South Sudan",groups:["014","202","002","UN"],callingCodes:["211"]},geometry:{type:"MultiPolygon",coordinates:[[[[34.10229,9.50238],[33.87958,9.49937],[33.9082,9.762],[33.96323,9.80972],[33.99185,9.99623],[33.96984,10.15446],[33.90159,10.17179],[33.80913,10.32994],[33.66604,10.44254],[33.52294,10.64382],[33.24645,10.77913],[33.26977,10.83632],[33.13988,11.43248],[33.25876,12.22111],[32.73921,12.22757],[32.73921,11.95203],[32.10079,11.95203],[32.39578,11.70208],[32.39358,11.18207],[32.46967,11.04662],[31.99177,10.65065],[31.77539,10.28939],[31.28504,9.75287],[30.84605,9.7498],[30.82893,9.71451],[30.53005,9.95992],[30.00389,10.28633],[29.94629,10.29245],[29.54,10.07949],[29.53844,9.75133],[29.06988,9.74826],[28.99983,9.67155],[27.90704,9.61323],[27.14427,9.62858],[26.70685,9.48735],[26.35815,9.57946],[26.21338,9.91545],[25.93241,10.17941],[25.93163,10.38159],[25.78141,10.42599],[25.0918,10.33718],[25.05688,10.06776],[24.97739,9.9081],[24.84653,9.80643],[24.49389,9.79962],[24.12744,9.73784],[24.09319,9.66572],[23.69155,9.67566],[23.62179,9.53823],[23.64981,9.44303],[23.64358,9.28637],[23.56263,9.19418],[23.4848,9.16959],[23.44744,8.99128],[23.59065,8.99743],[23.51905,8.71749],[24.25691,8.69288],[24.13238,8.36959],[24.35965,8.26177],[24.85156,8.16933],[24.98855,7.96588],[25.25319,7.8487],[25.29214,7.66675],[25.20649,7.61115],[25.20337,7.50312],[25.35281,7.42595],[25.37461,7.33024],[25.90076,7.09549],[26.38022,6.63493],[26.32729,6.36272],[26.58259,6.1987],[26.51721,6.09655],[27.22705,5.71254],[27.22705,5.62889],[27.28621,5.56382],[27.23017,5.37167],[27.26886,5.25876],[27.44012,5.07349],[27.56656,4.89375],[27.65462,4.89375],[27.76469,4.79284],[27.79551,4.59976],[28.20719,4.35614],[28.6651,4.42638],[28.8126,4.48784],[29.03054,4.48784],[29.22207,4.34297],[29.43341,4.50101],[29.49726,4.7007],[29.82087,4.56246],[29.79666,4.37809],[30.06964,4.13221],[30.1621,4.10586],[30.22374,3.93896],[30.27658,3.95653],[30.47691,3.83353],[30.55396,3.84451],[30.57378,3.74567],[30.56277,3.62703],[30.78512,3.67097],[30.80713,3.60506],[30.85997,3.5743],[30.85153,3.48867],[30.97601,3.693],[31.16666,3.79853],[31.29476,3.8015],[31.50478,3.67814],[31.50776,3.63652],[31.72075,3.74354],[31.81459,3.82083],[31.86821,3.78664],[31.96205,3.6499],[31.95907,3.57408],[32.05187,3.589],[32.08491,3.56287],[32.08866,3.53543],[32.19888,3.50867],[32.20782,3.6053],[32.41337,3.748],[32.72021,3.77327],[32.89746,3.81339],[33.02852,3.89296],[33.18356,3.77812],[33.51264,3.75068],[33.9873,4.23316],[34.47601,4.72162],[35.34151,5.02364],[35.30992,4.90402],[35.47843,4.91872],[35.42366,4.76969],[35.51424,4.61643],[35.9419,4.61933],[35.82118,4.77382],[35.81968,5.10757],[35.8576,5.33413],[35.50792,5.42431],[35.29938,5.34042],[35.31188,5.50106],[35.13058,5.62118],[35.12611,5.68937],[35.00546,5.89387],[34.96227,6.26415],[35.01738,6.46991],[34.87736,6.60161],[34.77459,6.5957],[34.65096,6.72589],[34.53776,6.74808],[34.53925,6.82794],[34.47669,6.91076],[34.35753,6.91963],[34.19369,7.04382],[34.19369,7.12807],[34.01495,7.25664],[34.03878,7.27437],[34.02984,7.36449],[33.87642,7.5491],[33.71407,7.65983],[33.44745,7.7543],[33.32531,7.71297],[33.24637,7.77939],[33.04944,7.78989],[33.0006,7.90333],[33.08401,8.05822],[33.18083,8.13047],[33.1853,8.29264],[33.19721,8.40317],[33.3119,8.45474],[33.54575,8.47094],[33.66938,8.44442],[33.71407,8.3678],[33.87195,8.41938],[33.89579,8.4842],[34.01346,8.50041],[34.14453,8.60204],[34.14304,9.04654],[34.10229,9.50238]]]]}},{type:"Feature",properties:{iso1A2:"ST",iso1A3:"STP",iso1N3:"678",wikidata:"Q1039",nameEn:"S\xE3o Tom\xE9 and Principe",groups:["017","202","002","UN"],callingCodes:["239"]},geometry:{type:"MultiPolygon",coordinates:[[[[4.34149,1.91417],[6.6507,-.28606],[7.9035,1.92304],[4.34149,1.91417]]]]}},{type:"Feature",properties:{iso1A2:"SV",iso1A3:"SLV",iso1N3:"222",wikidata:"Q792",nameEn:"El Salvador",groups:["013","003","419","019","UN"],callingCodes:["503"]},geometry:{type:"MultiPolygon",coordinates:[[[[-89.34776,14.43013],[-89.39028,14.44561],[-89.57441,14.41637],[-89.58814,14.33165],[-89.50614,14.26084],[-89.52397,14.22628],[-89.61844,14.21937],[-89.70756,14.1537],[-89.75569,14.07073],[-89.73251,14.04133],[-89.76103,14.02923],[-89.81807,14.07073],[-89.88937,14.0396],[-90.10505,13.85104],[-90.11344,13.73679],[-90.55276,12.8866],[-88.11443,12.63306],[-87.7346,13.13228],[-87.55124,13.12523],[-87.69751,13.25228],[-87.73714,13.32715],[-87.80177,13.35689],[-87.84675,13.41078],[-87.83467,13.44655],[-87.77354,13.45767],[-87.73841,13.44169],[-87.72115,13.46083],[-87.71657,13.50577],[-87.78148,13.52906],[-87.73106,13.75443],[-87.68821,13.80829],[-87.7966,13.91353],[-88.00331,13.86948],[-88.07641,13.98447],[-88.23018,13.99915],[-88.25791,13.91108],[-88.48982,13.86458],[-88.49738,13.97224],[-88.70661,14.04317],[-88.73182,14.10919],[-88.815,14.11652],[-88.85785,14.17763],[-88.94608,14.20207],[-89.04187,14.33644],[-89.34776,14.43013]]]]}},{type:"Feature",properties:{iso1A2:"SX",iso1A3:"SXM",iso1N3:"534",wikidata:"Q26273",nameEn:"Sint Maarten",aliases:["NL-SX"],country:"NL",groups:["Q1451600","029","003","419","019","UN"],callingCodes:["1 721"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.33064,17.9615],[-63.1055,17.86651],[-62.93924,18.02904],[-63.02323,18.05757],[-63.04039,18.05619],[-63.0579,18.06614],[-63.07759,18.04943],[-63.09686,18.04608],[-63.11042,18.05339],[-63.13502,18.05445],[-63.33064,17.9615]]]]}},{type:"Feature",properties:{iso1A2:"SY",iso1A3:"SYR",iso1N3:"760",wikidata:"Q858",nameEn:"Syria",groups:["145","142","UN"],callingCodes:["963"]},geometry:{type:"MultiPolygon",coordinates:[[[[42.23683,37.2863],[42.21548,37.28026],[42.20454,37.28715],[42.22381,37.30238],[42.22257,37.31395],[42.2112,37.32491],[42.19301,37.31323],[42.18225,37.28569],[42.00894,37.17209],[41.515,37.08084],[41.21937,37.07665],[40.90856,37.13147],[40.69136,37.0996],[39.81589,36.75538],[39.21538,36.66834],[39.03217,36.70911],[38.74042,36.70629],[38.55908,36.84429],[38.38859,36.90064],[38.21064,36.91842],[37.81974,36.76055],[37.68048,36.75065],[37.49103,36.66904],[37.47253,36.63243],[37.21988,36.6736],[37.16177,36.66069],[37.10894,36.6704],[37.08279,36.63495],[37.02088,36.66422],[37.01647,36.69512],[37.04619,36.71101],[37.04399,36.73483],[36.99886,36.74012],[36.99557,36.75997],[36.66727,36.82901],[36.61581,36.74629],[36.62681,36.71189],[36.57398,36.65186],[36.58829,36.58295],[36.54206,36.49539],[36.6081,36.33772],[36.65653,36.33861],[36.68672,36.23677],[36.6125,36.22592],[36.50463,36.2419],[36.4617,36.20461],[36.39206,36.22088],[36.37474,36.01163],[36.33956,35.98687],[36.30099,36.00985],[36.28338,36.00273],[36.29769,35.96086],[36.27678,35.94839],[36.25366,35.96264],[36.19973,35.95195],[36.17441,35.92076],[36.1623,35.80925],[36.14029,35.81015],[36.13919,35.83692],[36.11827,35.85923],[35.99829,35.88242],[36.01844,35.92403],[36.00514,35.94113],[35.98499,35.94107],[35.931,35.92109],[35.51152,36.10954],[35.48515,34.70851],[35.97386,34.63322],[35.98718,34.64977],[36.29165,34.62991],[36.32399,34.69334],[36.35135,34.68516],[36.35384,34.65447],[36.42941,34.62505],[36.46003,34.6378],[36.45299,34.59438],[36.41429,34.61175],[36.39846,34.55672],[36.3369,34.52629],[36.34745,34.5002],[36.4442,34.50165],[36.46179,34.46541],[36.55853,34.41609],[36.53039,34.3798],[36.56556,34.31881],[36.60778,34.31009],[36.58667,34.27667],[36.59195,34.2316],[36.62537,34.20251],[36.5128,34.09916],[36.50576,34.05982],[36.41078,34.05253],[36.28589,33.91981],[36.38263,33.86579],[36.3967,33.83365],[36.14517,33.85118],[36.06778,33.82927],[35.9341,33.6596],[36.05723,33.57904],[35.94465,33.52774],[35.94816,33.47886],[35.88668,33.43183],[35.82577,33.40479],[35.81324,33.36354],[35.77477,33.33609],[35.813,33.3172],[35.77513,33.27342],[35.81295,33.24841],[35.81647,33.2028],[35.83846,33.19397],[35.84285,33.16673],[35.81911,33.1336],[35.81911,33.11077],[35.84802,33.1031],[35.87188,32.98028],[35.89298,32.9456],[35.87012,32.91976],[35.84021,32.8725],[35.83758,32.82817],[35.78745,32.77938],[35.75983,32.74803],[35.88405,32.71321],[35.93307,32.71966],[35.96633,32.66237],[36.02239,32.65911],[36.08074,32.51463],[36.20379,32.52751],[36.20875,32.49529],[36.23948,32.50108],[36.40959,32.37908],[36.83946,32.31293],[38.79171,33.37328],[40.64314,34.31604],[40.97676,34.39788],[41.12388,34.65742],[41.2345,34.80049],[41.21654,35.1508],[41.26569,35.42708],[41.38184,35.62502],[41.37027,35.84095],[41.2564,36.06012],[41.28864,36.35368],[41.40058,36.52502],[41.81736,36.58782],[42.36697,37.0627],[42.35724,37.10998],[42.32313,37.17814],[42.34735,37.22548],[42.2824,37.2798],[42.26039,37.27017],[42.23683,37.2863]]]]}},{type:"Feature",properties:{iso1A2:"SZ",iso1A3:"SWZ",iso1N3:"748",wikidata:"Q1050",nameEn:"Eswatini",aliases:["Swaziland"],groups:["018","202","002","UN"],driveSide:"left",callingCodes:["268"]},geometry:{type:"MultiPolygon",coordinates:[[[[31.86881,-25.99973],[31.4175,-25.71886],[31.31237,-25.7431],[31.13073,-25.91558],[30.95819,-26.26303],[30.78927,-26.48271],[30.81101,-26.84722],[30.88826,-26.79622],[30.97757,-26.92706],[30.96088,-27.0245],[31.15027,-27.20151],[31.49834,-27.31549],[31.97592,-27.31675],[31.97463,-27.11057],[32.00893,-26.8096],[32.09664,-26.80721],[32.13315,-26.84345],[32.13409,-26.5317],[32.07352,-26.40185],[32.10435,-26.15656],[32.08599,-26.00978],[32.00916,-25.999],[31.974,-25.95387],[31.86881,-25.99973]]]]}},{type:"Feature",properties:{iso1A2:"TA",iso1A3:"TAA",wikidata:"Q220982",nameEn:"Tristan da Cunha",aliases:["SH-TA"],country:"GB",groups:["SH","BOTS","011","202","002","UN"],isoStatus:"excRes",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["290 8","44 20"]},geometry:{type:"MultiPolygon",coordinates:[[[[-13.38232,-34.07258],[-16.67337,-41.9188],[-5.88482,-41.4829],[-13.38232,-34.07258]]]]}},{type:"Feature",properties:{iso1A2:"TC",iso1A3:"TCA",iso1N3:"796",wikidata:"Q18221",nameEn:"Turks and Caicos Islands",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 649"]},geometry:{type:"MultiPolygon",coordinates:[[[[-71.70065,25.7637],[-72.98446,20.4801],[-69.80718,21.35956],[-71.70065,25.7637]]]]}},{type:"Feature",properties:{iso1A2:"TD",iso1A3:"TCD",iso1N3:"148",wikidata:"Q657",nameEn:"Chad",groups:["017","202","002","UN"],callingCodes:["235"]},geometry:{type:"MultiPolygon",coordinates:[[[[23.99539,19.49944],[15.99566,23.49639],[14.99751,23.00539],[15.19692,21.99339],[15.20213,21.49365],[15.28332,21.44557],[15.62515,20.95395],[15.57248,20.92138],[15.55382,20.86507],[15.56004,20.79488],[15.59841,20.74039],[15.6721,20.70069],[15.99632,20.35364],[15.75098,19.93002],[15.6032,18.77402],[15.50373,16.89649],[14.37425,15.72591],[13.86301,15.04043],[13.78991,14.87519],[13.809,14.72915],[13.67878,14.64013],[13.68573,14.55276],[13.48259,14.46704],[13.47559,14.40881],[13.6302,13.71094],[14.08251,13.0797],[14.46881,13.08259],[14.56101,12.91036],[14.55058,12.78256],[14.83314,12.62963],[14.90827,12.3269],[14.89019,12.16593],[14.96952,12.0925],[15.00146,12.1223],[15.0349,12.10698],[15.05786,12.0608],[15.04808,11.8731],[15.11579,11.79313],[15.06595,11.71126],[15.13149,11.5537],[15.0585,11.40481],[15.10021,11.04101],[15.04957,11.02347],[15.09127,10.87431],[15.06737,10.80921],[15.15532,10.62846],[15.14936,10.53915],[15.23724,10.47764],[15.30874,10.31063],[15.50535,10.1098],[15.68761,9.99344],[15.41408,9.92876],[15.24618,9.99246],[15.14043,9.99246],[15.05999,9.94845],[14.95722,9.97926],[14.80082,9.93818],[14.4673,10.00264],[14.20411,10.00055],[14.1317,9.82413],[14.01793,9.73169],[13.97544,9.6365],[14.37094,9.2954],[14.35707,9.19611],[14.83566,8.80557],[15.09484,8.65982],[15.20426,8.50892],[15.50743,7.79302],[15.59272,7.7696],[15.56964,7.58936],[15.49743,7.52179],[15.73118,7.52006],[15.79942,7.44149],[16.40703,7.68809],[16.41583,7.77971],[16.58315,7.88657],[16.59415,7.76444],[16.658,7.75353],[16.6668,7.67281],[16.8143,7.53971],[17.67288,7.98905],[17.93926,7.95853],[18.02731,8.01085],[18.6085,8.05009],[18.64153,8.08714],[18.62612,8.14163],[18.67455,8.22226],[18.79783,8.25929],[19.11044,8.68172],[18.86388,8.87971],[19.06421,9.00367],[20.36748,9.11019],[20.82979,9.44696],[21.26348,9.97642],[21.34934,9.95907],[21.52766,10.2105],[21.63553,10.217],[21.71479,10.29932],[21.72139,10.64136],[22.45889,11.00246],[22.87758,10.91915],[22.97249,11.21955],[22.93124,11.41645],[22.7997,11.40424],[22.54907,11.64372],[22.64092,12.07485],[22.48369,12.02766],[22.50548,12.16769],[22.38873,12.45514],[22.46345,12.61925],[22.22684,12.74682],[22.15679,12.66634],[21.98711,12.63292],[21.89371,12.68001],[21.81432,12.81362],[21.94819,13.05637],[22.02914,13.13976],[22.1599,13.19281],[22.29689,13.3731],[22.08674,13.77863],[22.22995,13.96754],[22.5553,14.11704],[22.55997,14.23024],[22.44944,14.24986],[22.38562,14.58907],[22.70474,14.69149],[22.66115,14.86308],[22.99584,15.22989],[22.99584,15.40105],[22.92579,15.47007],[22.93201,15.55107],[23.10792,15.71297],[23.38812,15.69649],[23.62785,15.7804],[23.99997,15.69575],[23.99539,19.49944]]]]}},{type:"Feature",properties:{iso1A2:"TF",iso1A3:"ATF",iso1N3:"260",wikidata:"Q129003",nameEn:"French Southern Territories",country:"FR",groups:["EU","UN"]},geometry:null},{type:"Feature",properties:{iso1A2:"TG",iso1A3:"TGO",iso1N3:"768",wikidata:"Q945",nameEn:"Togo",groups:["011","202","002","UN"],callingCodes:["228"]},geometry:{type:"MultiPolygon",coordinates:[[[[.50388,11.01011],[-.13493,11.14075],[-.14462,11.10811],[-.05733,11.08628],[-.0275,11.11202],[-.00514,11.10763],[.00342,11.08317],[.02395,11.06229],[.03355,10.9807],[-.0063,10.96417],[-.00908,10.91644],[-.02685,10.8783],[-.0228,10.81916],[-.07183,10.76794],[-.07327,10.71845],[-.09141,10.7147],[-.05945,10.63458],[.12886,10.53149],[.18846,10.4096],[.29453,10.41546],[.33028,10.30408],[.39584,10.31112],[.35293,10.09412],[.41371,10.06361],[.41252,10.02018],[.36366,10.03309],[.32075,9.72781],[.34816,9.71607],[.34816,9.66907],[.32313,9.6491],[.28261,9.69022],[.26712,9.66437],[.29334,9.59387],[.36008,9.6256],[.38153,9.58682],[.23851,9.57389],[.2409,9.52335],[.30406,9.521],[.31241,9.50337],[.2254,9.47869],[.25758,9.42696],[.33148,9.44812],[.36485,9.49749],[.49118,9.48339],[.56388,9.40697],[.45424,9.04581],[.52455,8.87746],[.37319,8.75262],[.47211,8.59945],[.64731,8.48866],[.73432,8.29529],[.63897,8.25873],[.5913,8.19622],[.61156,8.18324],[.6056,8.13959],[.58891,8.12779],[.62943,7.85751],[.58295,7.62368],[.51979,7.58706],[.52455,7.45354],[.57223,7.39326],[.62943,7.41099],[.65327,7.31643],[.59606,7.01252],[.52217,6.9723],[.52098,6.94391],[.56508,6.92971],[.52853,6.82921],[.57406,6.80348],[.58176,6.76049],[.6497,6.73682],[.63659,6.63857],[.74862,6.56517],[.71048,6.53083],[.89283,6.33779],[.99652,6.33779],[1.03108,6.24064],[1.05969,6.22998],[1.09187,6.17074],[1.19966,6.17069],[1.19771,6.11522],[1.27574,5.93551],[1.67336,6.02702],[1.62913,6.24075],[1.79826,6.28221],[1.76906,6.43189],[1.58105,6.68619],[1.61812,6.74843],[1.55877,6.99737],[1.64249,6.99562],[1.61838,9.0527],[1.5649,9.16941],[1.41746,9.3226],[1.33675,9.54765],[1.36624,9.5951],[1.35507,9.99525],[.77666,10.37665],[.80358,10.71459],[.8804,10.803],[.91245,10.99597],[.66104,10.99964],[.4958,10.93269],[.50521,10.98035],[.48852,10.98561],[.50388,11.01011]]]]}},{type:"Feature",properties:{iso1A2:"TH",iso1A3:"THA",iso1N3:"764",wikidata:"Q869",nameEn:"Thailand",groups:["035","142","UN"],driveSide:"left",callingCodes:["66"]},geometry:{type:"MultiPolygon",coordinates:[[[[100.08404,20.36626],[99.95721,20.46301],[99.91616,20.44986],[99.90499,20.4487],[99.89692,20.44789],[99.89301,20.44311],[99.89168,20.44548],[99.88451,20.44596],[99.88211,20.44488],[99.86383,20.44371],[99.81096,20.33687],[99.68255,20.32077],[99.46008,20.39673],[99.46077,20.36198],[99.5569,20.20676],[99.52943,20.14811],[99.416,20.08614],[99.20328,20.12877],[99.0735,20.10298],[98.98679,19.7419],[98.83661,19.80931],[98.56065,19.67807],[98.51182,19.71303],[98.24884,19.67876],[98.13829,19.78541],[98.03314,19.80941],[98.04364,19.65755],[97.84715,19.55782],[97.88423,19.5041],[97.78769,19.39429],[97.84186,19.29526],[97.78606,19.26769],[97.84024,19.22217],[97.83479,19.09972],[97.73797,19.04261],[97.73654,18.9812],[97.66487,18.9371],[97.73836,18.88478],[97.76752,18.58097],[97.5258,18.4939],[97.36444,18.57138],[97.34522,18.54596],[97.50383,18.26844],[97.56219,18.33885],[97.64116,18.29778],[97.60841,18.23846],[97.73723,17.97912],[97.66794,17.88005],[97.76407,17.71595],[97.91829,17.54504],[98.11185,17.36829],[98.10439,17.33847],[98.34566,17.04822],[98.39441,17.06266],[98.52624,16.89979],[98.49603,16.8446],[98.53833,16.81934],[98.46994,16.73613],[98.50253,16.7139],[98.49713,16.69022],[98.51043,16.70107],[98.51579,16.69433],[98.51472,16.68521],[98.51833,16.676],[98.51113,16.64503],[98.5695,16.62826],[98.57912,16.55983],[98.63817,16.47424],[98.68074,16.27068],[98.84485,16.42354],[98.92656,16.36425],[98.8376,16.11706],[98.69585,16.13353],[98.57019,16.04578],[98.59853,15.87197],[98.541,15.65406],[98.58598,15.46821],[98.56027,15.33471],[98.4866,15.39154],[98.39351,15.34177],[98.41906,15.27103],[98.40522,15.25268],[98.30446,15.30667],[98.22,15.21327],[98.18821,15.13125],[98.24874,14.83013],[98.56762,14.37701],[98.97356,14.04868],[99.16695,13.72621],[99.20617,13.20575],[99.12225,13.19847],[99.10646,13.05804],[99.18748,12.9898],[99.18905,12.84799],[99.29254,12.68921],[99.409,12.60603],[99.47519,12.1353],[99.56445,12.14805],[99.53424,12.02317],[99.64891,11.82699],[99.64108,11.78948],[99.5672,11.62732],[99.47598,11.62434],[99.39485,11.3925],[99.31573,11.32081],[99.32756,11.28545],[99.06938,10.94857],[99.02337,10.97217],[98.99701,10.92962],[99.0069,10.85485],[98.86819,10.78336],[98.78511,10.68351],[98.77275,10.62548],[98.81944,10.52761],[98.7391,10.31488],[98.55174,9.92804],[98.52291,9.92389],[98.47298,9.95782],[98.33094,9.91973],[98.12555,9.44056],[97.63455,9.60854],[97.19814,8.18901],[99.31854,5.99868],[99.50117,6.44501],[99.91873,6.50233],[100.0756,6.4045],[100.12,6.42105],[100.19511,6.72559],[100.29651,6.68439],[100.30828,6.66462],[100.31618,6.66781],[100.31884,6.66423],[100.32671,6.66526],[100.32607,6.65933],[100.31929,6.65413],[100.35413,6.54932],[100.41152,6.52299],[100.41791,6.5189],[100.42351,6.51762],[100.43027,6.52389],[100.66986,6.45086],[100.74361,6.50811],[100.74822,6.46231],[100.81045,6.45086],[100.85884,6.24929],[101.10313,6.25617],[101.12618,6.19431],[101.06165,6.14161],[101.12388,6.11411],[101.087,5.9193],[101.02708,5.91013],[100.98815,5.79464],[101.14062,5.61613],[101.25755,5.71065],[101.25524,5.78633],[101.58019,5.93534],[101.69773,5.75881],[101.75074,5.79091],[101.80144,5.74505],[101.89188,5.8386],[101.91776,5.84269],[101.92819,5.85511],[101.94712,5.98421],[101.9714,6.00575],[101.97114,6.01992],[101.99209,6.04075],[102.01835,6.05407],[102.09182,6.14161],[102.07732,6.193],[102.08127,6.22679],[102.09086,6.23546],[102.46318,7.22462],[102.47649,9.66162],[102.52395,11.25257],[102.91449,11.65512],[102.90973,11.75613],[102.83957,11.8519],[102.78427,11.98746],[102.77026,12.06815],[102.70176,12.1686],[102.73134,12.37091],[102.78116,12.40284],[102.7796,12.43781],[102.57567,12.65358],[102.51963,12.66117],[102.4994,12.71736],[102.53053,12.77506],[102.49335,12.92711],[102.48694,12.97537],[102.52275,12.99813],[102.46011,13.08057],[102.43422,13.09061],[102.36146,13.26006],[102.36001,13.31142],[102.34611,13.35618],[102.35692,13.38274],[102.35563,13.47307],[102.361,13.50551],[102.33828,13.55613],[102.36859,13.57488],[102.44601,13.5637],[102.5358,13.56933],[102.57573,13.60461],[102.62483,13.60883],[102.58635,13.6286],[102.5481,13.6589],[102.56848,13.69366],[102.72727,13.77806],[102.77864,13.93374],[102.91251,14.01531],[102.93275,14.19044],[103.16469,14.33075],[103.39353,14.35639],[103.53518,14.42575],[103.71109,14.4348],[103.70175,14.38052],[103.93836,14.3398],[104.27616,14.39861],[104.55014,14.36091],[104.69335,14.42726],[104.97667,14.38806],[105.02804,14.23722],[105.08408,14.20402],[105.14012,14.23873],[105.17748,14.34432],[105.20894,14.34967],[105.43783,14.43865],[105.53864,14.55731],[105.5121,14.80802],[105.61162,15.00037],[105.46661,15.13132],[105.58043,15.32724],[105.50662,15.32054],[105.4692,15.33709],[105.47635,15.3796],[105.58191,15.41031],[105.60446,15.53301],[105.61756,15.68792],[105.46573,15.74742],[105.42285,15.76971],[105.37959,15.84074],[105.34115,15.92737],[105.38508,15.987],[105.42001,16.00657],[105.06204,16.09792],[105.00262,16.25627],[104.88057,16.37311],[104.73349,16.565],[104.76099,16.69302],[104.7397,16.81005],[104.76442,16.84752],[104.7373,16.91125],[104.73712,17.01404],[104.80716,17.19025],[104.80061,17.39367],[104.69867,17.53038],[104.45404,17.66788],[104.35432,17.82871],[104.2757,17.86139],[104.21776,17.99335],[104.10927,18.10826],[104.06533,18.21656],[103.97725,18.33631],[103.93916,18.33914],[103.85642,18.28666],[103.82449,18.33979],[103.699,18.34125],[103.60957,18.40528],[103.47773,18.42841],[103.41044,18.4486],[103.30977,18.4341],[103.24779,18.37807],[103.23818,18.34875],[103.29757,18.30475],[103.17093,18.2618],[103.14994,18.23172],[103.1493,18.17799],[103.07343,18.12351],[103.07823,18.03833],[103.0566,18.00144],[103.01998,17.97095],[102.9912,17.9949],[102.95812,18.0054],[102.86323,17.97531],[102.81988,17.94233],[102.79044,17.93612],[102.75954,17.89561],[102.68538,17.86653],[102.67543,17.84529],[102.69946,17.81686],[102.68194,17.80151],[102.59485,17.83537],[102.5896,17.84889],[102.61432,17.92273],[102.60971,17.95411],[102.59234,17.96127],[102.45523,17.97106],[102.11359,18.21532],[101.88485,18.02474],[101.78087,18.07559],[101.72294,17.92867],[101.44667,17.7392],[101.15108,17.47586],[100.96541,17.57926],[101.02185,17.87637],[101.1793,18.0544],[101.19118,18.2125],[101.15108,18.25624],[101.18227,18.34367],[101.06047,18.43247],[101.27585,18.68875],[101.22832,18.73377],[101.25803,18.89545],[101.35606,19.04716],[101.261,19.12717],[101.24911,19.33334],[101.20604,19.35296],[101.21347,19.46223],[101.26991,19.48324],[101.26545,19.59242],[101.08928,19.59748],[100.90302,19.61901],[100.77231,19.48324],[100.64606,19.55884],[100.58219,19.49164],[100.49604,19.53504],[100.398,19.75047],[100.5094,19.87904],[100.58808,20.15791],[100.55218,20.17741],[100.51052,20.14928],[100.47567,20.19133],[100.4537,20.19971],[100.44992,20.23644],[100.41473,20.25625],[100.37439,20.35156],[100.33383,20.4028],[100.25769,20.3992],[100.22076,20.31598],[100.16668,20.2986],[100.1712,20.24324],[100.11785,20.24787],[100.09337,20.26293],[100.09999,20.31614],[100.08404,20.36626]]]]}},{type:"Feature",properties:{iso1A2:"TJ",iso1A3:"TJK",iso1N3:"762",wikidata:"Q863",nameEn:"Tajikistan",groups:["143","142","UN"],callingCodes:["992"]},geometry:{type:"MultiPolygon",coordinates:[[[[70.45251,41.04438],[70.38028,41.02014],[70.36655,40.90296],[69.69434,40.62615],[69.59441,40.70181],[69.53021,40.77621],[69.38327,40.7918],[69.32834,40.70233],[69.3455,40.57988],[69.2643,40.57506],[69.21063,40.54469],[69.27066,40.49274],[69.28525,40.41894],[69.30774,40.36102],[69.33794,40.34819],[69.32833,40.29794],[69.30808,40.2821],[69.24817,40.30357],[69.25229,40.26362],[69.30104,40.24502],[69.30448,40.18774],[69.2074,40.21488],[69.15659,40.2162],[69.04544,40.22904],[68.85832,40.20885],[68.84357,40.18604],[68.79276,40.17555],[68.77902,40.20492],[68.5332,40.14826],[68.52771,40.11676],[68.62796,40.07789],[69.01523,40.15771],[69.01935,40.11466],[68.96579,40.06949],[68.84906,40.04952],[68.93695,39.91167],[68.88889,39.87163],[68.63071,39.85265],[68.61972,39.68905],[68.54166,39.53929],[68.12053,39.56317],[67.70992,39.66156],[67.62889,39.60234],[67.44899,39.57799],[67.46547,39.53564],[67.39681,39.52505],[67.46822,39.46146],[67.45998,39.315],[67.36522,39.31287],[67.33226,39.23739],[67.67833,39.14479],[67.68915,39.00775],[68.09704,39.02589],[68.19743,38.85985],[68.06948,38.82115],[68.12877,38.73677],[68.05598,38.71641],[68.0807,38.64136],[68.05873,38.56087],[68.11366,38.47169],[68.06274,38.39435],[68.13289,38.40822],[68.40343,38.19484],[68.27159,37.91477],[68.12635,37.93],[67.81566,37.43107],[67.8474,37.31594],[67.78329,37.1834],[67.7803,37.08978],[67.87917,37.0591],[68.02194,36.91923],[68.18542,37.02074],[68.27605,37.00977],[68.29253,37.10621],[68.41201,37.10402],[68.41888,37.13906],[68.61851,37.19815],[68.6798,37.27906],[68.81438,37.23862],[68.80889,37.32494],[68.91189,37.26704],[68.88168,37.33368],[68.96407,37.32603],[69.03274,37.25174],[69.25152,37.09426],[69.39529,37.16752],[69.45022,37.23315],[69.36645,37.40462],[69.44954,37.4869],[69.51888,37.5844],[69.80041,37.5746],[69.84435,37.60616],[69.93362,37.61378],[69.95971,37.5659],[70.15015,37.52519],[70.28243,37.66706],[70.27694,37.81258],[70.1863,37.84296],[70.17206,37.93276],[70.4898,38.12546],[70.54673,38.24541],[70.60407,38.28046],[70.61526,38.34774],[70.64966,38.34999],[70.69189,38.37031],[70.6761,38.39144],[70.67438,38.40597],[70.69807,38.41861],[70.72485,38.4131],[70.75455,38.4252],[70.77132,38.45548],[70.78581,38.45502],[70.78702,38.45031],[70.79766,38.44944],[70.80521,38.44447],[70.81697,38.44507],[70.82538,38.45394],[70.84376,38.44688],[70.88719,38.46826],[70.92728,38.43021],[70.98693,38.48862],[71.03545,38.44779],[71.0556,38.40176],[71.09542,38.42517],[71.10592,38.42077],[71.10957,38.40671],[71.1451,38.40106],[71.21291,38.32797],[71.33114,38.30339],[71.33869,38.27335],[71.37803,38.25641],[71.36444,38.15358],[71.29878,38.04429],[71.28922,38.01272],[71.27622,37.99946],[71.27278,37.96496],[71.24969,37.93031],[71.2809,37.91995],[71.296,37.93403],[71.32871,37.88564],[71.51565,37.95349],[71.58843,37.92425],[71.59255,37.79956],[71.55752,37.78677],[71.54324,37.77104],[71.53053,37.76534],[71.55234,37.73209],[71.54186,37.69691],[71.51972,37.61945],[71.5065,37.60912],[71.49693,37.53527],[71.50616,37.50733],[71.5256,37.47971],[71.49612,37.4279],[71.47685,37.40281],[71.4862,37.33405],[71.49821,37.31975],[71.50674,37.31502],[71.48536,37.26017],[71.4824,37.24921],[71.48339,37.23937],[71.47386,37.2269],[71.4555,37.21418],[71.4494,37.18137],[71.44127,37.11856],[71.43097,37.05855],[71.45578,37.03094],[71.46923,36.99925],[71.48481,36.93218],[71.51502,36.89128],[71.57195,36.74943],[71.67083,36.67346],[71.83229,36.68084],[72.31676,36.98115],[72.54095,37.00007],[72.66381,37.02014],[72.79693,37.22222],[73.06884,37.31729],[73.29633,37.46495],[73.77197,37.4417],[73.76647,37.33913],[73.61129,37.27469],[73.64974,37.23643],[73.82552,37.22659],[73.8564,37.26158],[74.20308,37.34208],[74.23339,37.41116],[74.41055,37.3948],[74.56161,37.37734],[74.68383,37.3948],[74.8294,37.3435],[74.88887,37.23275],[75.12328,37.31839],[75.09719,37.37297],[75.15899,37.41443],[75.06011,37.52779],[74.94338,37.55501],[74.8912,37.67576],[75.00935,37.77486],[74.92416,37.83428],[74.9063,38.03033],[74.82665,38.07359],[74.80331,38.19889],[74.69894,38.22155],[74.69619,38.42947],[74.51217,38.47034],[74.17022,38.65504],[73.97933,38.52945],[73.79806,38.61106],[73.80656,38.66449],[73.7033,38.84782],[73.7445,38.93867],[73.82964,38.91517],[73.81728,39.04007],[73.75823,39.023],[73.60638,39.24534],[73.54572,39.27567],[73.55396,39.3543],[73.5004,39.38402],[73.59241,39.40843],[73.59831,39.46425],[73.45096,39.46677],[73.31912,39.38615],[73.18454,39.35536],[72.85934,39.35116],[72.62027,39.39696],[72.33173,39.33093],[72.23834,39.17248],[72.17242,39.2661],[72.09689,39.26823],[72.04059,39.36704],[71.90601,39.27674],[71.79202,39.27355],[71.7522,39.32031],[71.80164,39.40631],[71.76816,39.45456],[71.62688,39.44056],[71.5517,39.45722],[71.55856,39.57588],[71.49814,39.61397],[71.08752,39.50704],[71.06418,39.41586],[70.7854,39.38933],[70.64087,39.58792],[70.44757,39.60128],[70.2869,39.53141],[70.11111,39.58223],[69.87491,39.53882],[69.68677,39.59281],[69.3594,39.52516],[69.26938,39.8127],[69.35649,40.01994],[69.43134,39.98431],[69.43557,39.92877],[69.53615,39.93991],[69.5057,40.03277],[69.53855,40.0887],[69.53794,40.11833],[69.55555,40.12296],[69.57615,40.10524],[69.64704,40.12165],[69.67001,40.10639],[70.01283,40.23288],[70.58297,40.00891],[70.57384,39.99394],[70.47557,39.93216],[70.55033,39.96619],[70.58912,39.95211],[70.65946,39.9878],[70.65827,40.0981],[70.7928,40.12797],[70.80495,40.16813],[70.9818,40.22392],[70.8607,40.217],[70.62342,40.17396],[70.56394,40.26421],[70.57149,40.3442],[70.37511,40.38605],[70.32626,40.45174],[70.49871,40.52503],[70.80009,40.72825],[70.45251,41.04438]]],[[[70.68112,40.90612],[70.6158,40.97661],[70.56077,41.00642],[70.54223,40.98787],[70.57501,40.98941],[70.6721,40.90555],[70.68112,40.90612]]],[[[70.74189,39.86319],[70.53651,39.89155],[70.52631,39.86989],[70.54998,39.85137],[70.59667,39.83542],[70.63105,39.77923],[70.74189,39.86319]]]]}},{type:"Feature",properties:{iso1A2:"TK",iso1A3:"TKL",iso1N3:"772",wikidata:"Q36823",nameEn:"Tokelau",country:"NZ",groups:["061","009","UN"],driveSide:"left",callingCodes:["690"]},geometry:{type:"MultiPolygon",coordinates:[[[[-168.251,-9.44289],[-174.18635,-7.80441],[-174.17993,-10.13616],[-168.251,-9.44289]]]]}},{type:"Feature",properties:{iso1A2:"TL",iso1A3:"TLS",iso1N3:"626",wikidata:"Q574",nameEn:"East Timor",aliases:["Timor-Leste","TP"],groups:["035","142","UN"],driveSide:"left",callingCodes:["670"]},geometry:{type:"MultiPolygon",coordinates:[[[[124.46701,-9.13002],[124.94011,-8.85617],[124.97742,-9.08128],[125.11764,-8.96359],[125.18632,-9.03142],[125.18907,-9.16434],[125.09434,-9.19669],[125.04044,-9.17093],[124.97892,-9.19281],[125.09025,-9.46406],[125.68138,-9.85176],[127.55165,-9.05052],[127.42116,-8.22471],[125.87691,-8.31789],[125.58506,-7.95311],[124.92337,-8.75859],[124.33472,-9.11416],[124.04628,-9.22671],[124.04286,-9.34243],[124.10539,-9.41206],[124.14517,-9.42324],[124.21247,-9.36904],[124.28115,-9.42189],[124.28115,-9.50453],[124.3535,-9.48493],[124.35258,-9.43002],[124.38554,-9.3582],[124.45971,-9.30263],[124.46701,-9.13002]]]]}},{type:"Feature",properties:{iso1A2:"TM",iso1A3:"TKM",iso1N3:"795",wikidata:"Q874",nameEn:"Turkmenistan",groups:["143","142","UN"],callingCodes:["993"]},geometry:{type:"MultiPolygon",coordinates:[[[[60.5078,41.21694],[60.06581,41.4363],[60.18117,41.60082],[60.06032,41.76287],[60.08504,41.80997],[60.33223,41.75058],[59.95046,41.97966],[60.0356,42.01028],[60.04659,42.08982],[59.96419,42.1428],[60.00539,42.212],[59.94633,42.27655],[59.4341,42.29738],[59.2955,42.37064],[59.17317,42.52248],[58.93422,42.5407],[58.6266,42.79314],[58.57991,42.64988],[58.27504,42.69632],[58.14321,42.62159],[58.29427,42.56497],[58.51674,42.30348],[58.40688,42.29535],[58.3492,42.43335],[57.99214,42.50021],[57.90975,42.4374],[57.92897,42.24047],[57.84932,42.18555],[57.6296,42.16519],[57.30275,42.14076],[57.03633,41.92043],[56.96218,41.80383],[57.03359,41.41777],[57.13796,41.36625],[57.03423,41.25435],[56.00314,41.32584],[55.45471,41.25609],[54.95182,41.92424],[54.20635,42.38477],[52.97575,42.1308],[52.47884,41.78034],[52.26048,41.69249],[51.7708,40.29239],[53.89734,37.3464],[54.24565,37.32047],[54.36211,37.34912],[54.58664,37.45809],[54.67247,37.43532],[54.77822,37.51597],[54.81804,37.61285],[54.77684,37.62264],[54.851,37.75739],[55.13412,37.94705],[55.44152,38.08564],[55.76561,38.12238],[55.97847,38.08024],[56.33278,38.08132],[56.32454,38.18502],[56.43303,38.26054],[56.62255,38.24005],[56.73928,38.27887],[57.03453,38.18717],[57.21169,38.28965],[57.37236,38.09321],[57.35042,37.98546],[57.79534,37.89299],[58.21399,37.77281],[58.22999,37.6856],[58.39959,37.63134],[58.47786,37.6433],[58.5479,37.70526],[58.6921,37.64548],[58.9338,37.67374],[59.22905,37.51161],[59.33507,37.53146],[59.39797,37.47892],[59.39385,37.34257],[59.55178,37.13594],[59.74678,37.12499],[60.00768,37.04102],[60.34767,36.63214],[61.14516,36.64644],[61.18187,36.55348],[61.1393,36.38782],[61.22719,36.12759],[61.12007,35.95992],[61.22444,35.92879],[61.26152,35.80749],[61.22719,35.67038],[61.27371,35.61482],[61.58742,35.43803],[61.77693,35.41341],[61.97743,35.4604],[62.05709,35.43803],[62.15871,35.33278],[62.29191,35.25964],[62.29878,35.13312],[62.48006,35.28796],[62.62288,35.22067],[62.74098,35.25432],[62.90853,35.37086],[63.0898,35.43131],[63.12276,35.53196],[63.10079,35.63024],[63.23262,35.67487],[63.10318,35.81782],[63.12276,35.86208],[63.29579,35.85985],[63.53475,35.90881],[63.56496,35.95106],[63.98519,36.03773],[64.05385,36.10433],[64.43288,36.24401],[64.57295,36.34362],[64.62514,36.44311],[64.61141,36.6351],[64.97945,37.21913],[65.51778,37.23881],[65.64263,37.34388],[65.64137,37.45061],[65.72274,37.55438],[66.30993,37.32409],[66.55743,37.35409],[66.52303,37.39827],[66.65761,37.45497],[66.52852,37.58568],[66.53676,37.80084],[66.67684,37.96776],[66.56697,38.0435],[66.41042,38.02403],[66.24013,38.16238],[65.83913,38.25733],[65.55873,38.29052],[64.32576,38.98691],[64.19086,38.95561],[63.70778,39.22349],[63.6913,39.27666],[62.43337,39.98528],[62.34273,40.43206],[62.11751,40.58242],[61.87856,41.12257],[61.4446,41.29407],[61.39732,41.19873],[61.33199,41.14946],[61.22212,41.14946],[61.03261,41.25691],[60.5078,41.21694]]]]}},{type:"Feature",properties:{iso1A2:"TN",iso1A3:"TUN",iso1N3:"788",wikidata:"Q948",nameEn:"Tunisia",groups:["015","002","UN"],callingCodes:["216"]},geometry:{type:"MultiPolygon",coordinates:[[[[11.2718,37.6713],[7.89009,38.19924],[8.59123,37.14286],[8.64044,36.9401],[8.62972,36.86499],[8.67706,36.8364],[8.57613,36.78062],[8.46537,36.7706],[8.47609,36.66607],[8.16167,36.48817],[8.18936,36.44939],[8.40731,36.42208],[8.2626,35.91733],[8.26472,35.73669],[8.35371,35.66373],[8.36086,35.47774],[8.30329,35.29884],[8.47318,35.23376],[8.3555,35.10007],[8.30727,34.95378],[8.25189,34.92009],[8.29655,34.72798],[8.20482,34.57575],[7.86264,34.3987],[7.81242,34.21841],[7.74207,34.16492],[7.66174,34.20167],[7.52851,34.06493],[7.54088,33.7726],[7.73687,33.42114],[7.83028,33.18851],[8.11433,33.10175],[8.1179,33.05086],[8.31895,32.83483],[8.35999,32.50101],[9.07483,32.07865],[9.55544,30.23971],[9.76848,30.34366],[9.88152,30.34074],[10.29516,30.90337],[10.12239,31.42098],[10.31364,31.72648],[10.48497,31.72956],[10.62788,31.96629],[10.7315,31.97235],[11.04234,32.2145],[11.53898,32.4138],[11.57828,32.48013],[11.46037,32.6307],[11.51549,33.09826],[11.55852,33.1409],[11.58941,33.36891],[11.2718,37.6713]]]]}},{type:"Feature",properties:{iso1A2:"TO",iso1A3:"TON",iso1N3:"776",wikidata:"Q678",nameEn:"Tonga",groups:["061","009","UN"],driveSide:"left",callingCodes:["676"]},geometry:{type:"MultiPolygon",coordinates:[[[[-176.74538,-22.89767],[-180,-22.90585],[-180,-24.21376],[-173.10761,-24.19665],[-173.13438,-14.94228],[-176.76826,-14.95183],[-176.74538,-22.89767]]]]}},{type:"Feature",properties:{iso1A2:"TR",iso1A3:"TUR",iso1N3:"792",wikidata:"Q43",nameEn:"Turkey",groups:["145","142","UN"],callingCodes:["90"]},geometry:{type:"MultiPolygon",coordinates:[[[[41.54366,41.52185],[40.89217,41.72528],[34.8305,42.4581],[28.32297,41.98371],[28.02971,41.98066],[27.91479,41.97902],[27.83492,41.99709],[27.81235,41.94803],[27.69949,41.97515],[27.55191,41.90928],[27.52379,41.93756],[27.45478,41.96591],[27.27411,42.10409],[27.22376,42.10152],[27.19251,42.06028],[27.08486,42.08735],[27.03277,42.0809],[26.95638,42.00741],[26.79143,41.97386],[26.62996,41.97644],[26.56051,41.92995],[26.57961,41.90024],[26.53968,41.82653],[26.36952,41.82265],[26.33589,41.76802],[26.32952,41.73637],[26.35957,41.71149],[26.47958,41.67037],[26.5209,41.62592],[26.59196,41.60491],[26.59742,41.48058],[26.61767,41.42281],[26.62997,41.34613],[26.5837,41.32131],[26.5209,41.33993],[26.39861,41.25053],[26.32259,41.24929],[26.31928,41.07386],[26.3606,41.02027],[26.33297,40.98388],[26.35894,40.94292],[26.32259,40.94042],[26.28623,40.93005],[26.29441,40.89119],[26.26169,40.9168],[26.20856,40.86048],[26.21351,40.83298],[26.15685,40.80709],[26.12854,40.77339],[26.12495,40.74283],[26.08638,40.73214],[26.0754,40.72772],[26.03489,40.73051],[25.94795,40.72797],[26.04292,40.3958],[25.61285,40.17161],[25.94257,39.39358],[26.43357,39.43096],[26.70773,39.0312],[26.61814,38.81372],[26.21136,38.65436],[26.32173,38.48731],[26.24183,38.44695],[26.21136,38.17558],[27.05537,37.9131],[27.16428,37.72343],[26.99377,37.69034],[26.95583,37.64989],[27.14757,37.32],[27.20312,36.94571],[27.45627,36.9008],[27.24613,36.71622],[27.46117,36.53789],[27.89482,36.69898],[27.95037,36.46155],[28.23708,36.56812],[29.30783,36.01033],[29.48192,36.18377],[29.61002,36.1731],[29.61805,36.14179],[29.69611,36.10365],[29.73302,35.92555],[32.82353,35.70297],[35.51152,36.10954],[35.931,35.92109],[35.98499,35.94107],[36.00514,35.94113],[36.01844,35.92403],[35.99829,35.88242],[36.11827,35.85923],[36.13919,35.83692],[36.14029,35.81015],[36.1623,35.80925],[36.17441,35.92076],[36.19973,35.95195],[36.25366,35.96264],[36.27678,35.94839],[36.29769,35.96086],[36.28338,36.00273],[36.30099,36.00985],[36.33956,35.98687],[36.37474,36.01163],[36.39206,36.22088],[36.4617,36.20461],[36.50463,36.2419],[36.6125,36.22592],[36.68672,36.23677],[36.65653,36.33861],[36.6081,36.33772],[36.54206,36.49539],[36.58829,36.58295],[36.57398,36.65186],[36.62681,36.71189],[36.61581,36.74629],[36.66727,36.82901],[36.99557,36.75997],[36.99886,36.74012],[37.04399,36.73483],[37.04619,36.71101],[37.01647,36.69512],[37.02088,36.66422],[37.08279,36.63495],[37.10894,36.6704],[37.16177,36.66069],[37.21988,36.6736],[37.47253,36.63243],[37.49103,36.66904],[37.68048,36.75065],[37.81974,36.76055],[38.21064,36.91842],[38.38859,36.90064],[38.55908,36.84429],[38.74042,36.70629],[39.03217,36.70911],[39.21538,36.66834],[39.81589,36.75538],[40.69136,37.0996],[40.90856,37.13147],[41.21937,37.07665],[41.515,37.08084],[42.00894,37.17209],[42.18225,37.28569],[42.19301,37.31323],[42.2112,37.32491],[42.22257,37.31395],[42.22381,37.30238],[42.20454,37.28715],[42.21548,37.28026],[42.23683,37.2863],[42.26039,37.27017],[42.2824,37.2798],[42.34735,37.22548],[42.32313,37.17814],[42.35724,37.10998],[42.56725,37.14878],[42.78887,37.38615],[42.93705,37.32015],[43.11403,37.37436],[43.30083,37.30629],[43.33508,37.33105],[43.50787,37.24436],[43.56702,37.25675],[43.63085,37.21957],[43.7009,37.23692],[43.8052,37.22825],[43.82699,37.19477],[43.84878,37.22205],[43.90949,37.22453],[44.02002,37.33229],[44.13521,37.32486],[44.2613,37.25055],[44.27998,37.16501],[44.22239,37.15756],[44.18503,37.09551],[44.25975,36.98119],[44.30645,36.97373],[44.35937,37.02843],[44.35315,37.04955],[44.38117,37.05825],[44.42631,37.05825],[44.63179,37.19229],[44.76698,37.16162],[44.78319,37.1431],[44.7868,37.16644],[44.75986,37.21549],[44.81021,37.2915],[44.58449,37.45018],[44.61401,37.60165],[44.56887,37.6429],[44.62096,37.71985],[44.55498,37.783],[44.45948,37.77065],[44.3883,37.85433],[44.22509,37.88859],[44.42476,38.25763],[44.50115,38.33939],[44.44386,38.38295],[44.38309,38.36117],[44.3119,38.37887],[44.3207,38.49799],[44.32058,38.62752],[44.28065,38.6465],[44.26155,38.71427],[44.30322,38.81581],[44.18863,38.93881],[44.20946,39.13975],[44.1043,39.19842],[44.03667,39.39223],[44.22452,39.4169],[44.29818,39.378],[44.37921,39.4131],[44.42832,39.4131],[44.41849,39.56659],[44.48111,39.61579],[44.47298,39.68788],[44.6137,39.78393],[44.65422,39.72163],[44.71806,39.71124],[44.81043,39.62677],[44.80977,39.65768],[44.75779,39.7148],[44.61845,39.8281],[44.46635,39.97733],[44.26973,40.04866],[44.1778,40.02845],[44.1057,40.03555],[43.92307,40.01787],[43.65688,40.11199],[43.65221,40.14889],[43.71136,40.16673],[43.59928,40.34019],[43.60862,40.43267],[43.54791,40.47413],[43.63664,40.54159],[43.7425,40.66805],[43.74872,40.7365],[43.67712,40.84846],[43.67712,40.93084],[43.58683,40.98961],[43.47319,41.02251],[43.44984,41.0988],[43.4717,41.12611],[43.44973,41.17666],[43.36118,41.2028],[43.23096,41.17536],[43.1945,41.25242],[43.13373,41.25503],[43.21707,41.30331],[43.02956,41.37891],[42.8785,41.50516],[42.84899,41.47265],[42.78995,41.50126],[42.84471,41.58912],[42.72794,41.59714],[42.59202,41.58183],[42.51772,41.43606],[42.26387,41.49346],[41.95134,41.52466],[41.81939,41.43621],[41.7124,41.47417],[41.7148,41.4932],[41.54366,41.52185]]]]}},{type:"Feature",properties:{iso1A2:"TT",iso1A3:"TTO",iso1N3:"780",wikidata:"Q754",nameEn:"Trinidad and Tobago",groups:["029","003","419","019","UN"],driveSide:"left",callingCodes:["1 868"]},geometry:{type:"MultiPolygon",coordinates:[[[[-61.62505,11.18974],[-62.08693,10.04435],[-60.89962,9.81445],[-60.07172,11.77667],[-61.62505,11.18974]]]]}},{type:"Feature",properties:{iso1A2:"TV",iso1A3:"TUV",iso1N3:"798",wikidata:"Q672",nameEn:"Tuvalu",groups:["061","009","UN"],driveSide:"left",callingCodes:["688"]},geometry:{type:"MultiPolygon",coordinates:[[[[174,-5],[174,-11.5],[179.99999,-11.5],[179.99999,-5],[174,-5]]]]}},{type:"Feature",properties:{iso1A2:"TW",iso1A3:"TWN",iso1N3:"158",wikidata:"Q865",nameEn:"Taiwan",aliases:["RC"],groups:["030","142"],callingCodes:["886"]},geometry:{type:"MultiPolygon",coordinates:[[[[121.8109,21.77688],[122.26612,25.98197],[120.5128,26.536],[120.0693,26.3959],[119.78816,26.2348],[119.98511,25.37624],[119.42295,25.0886],[118.6333,24.46259],[118.42453,24.54644],[118.35291,24.51645],[118.28244,24.51231],[118.11703,24.39734],[120.69238,21.52331],[121.8109,21.77688]]]]}},{type:"Feature",properties:{iso1A2:"TZ",iso1A3:"TZA",iso1N3:"834",wikidata:"Q924",nameEn:"Tanzania",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["255"]},geometry:{type:"MultiPolygon",coordinates:[[[[30.80408,-.99911],[30.76635,-.9852],[30.70631,-1.01175],[30.64166,-1.06601],[30.47194,-1.0555],[30.45116,-1.10641],[30.50889,-1.16412],[30.57123,-1.33264],[30.71974,-1.43244],[30.84079,-1.64652],[30.80802,-1.91477],[30.89303,-2.08223],[30.83915,-2.35795],[30.54501,-2.41404],[30.41789,-2.66266],[30.52747,-2.65841],[30.40662,-2.86151],[30.4987,-2.9573],[30.57926,-2.89791],[30.6675,-2.98987],[30.83823,-2.97837],[30.84165,-3.25152],[30.45915,-3.56532],[30.22042,-4.01738],[30.03323,-4.26631],[29.88172,-4.35743],[29.82885,-4.36153],[29.77289,-4.41733],[29.75109,-4.45836],[29.63827,-4.44681],[29.43673,-4.44845],[29.52552,-6.2731],[30.2567,-7.14121],[30.79243,-8.27382],[31.00796,-8.58615],[31.37533,-8.60769],[31.57147,-8.70619],[31.57147,-8.81388],[31.71158,-8.91386],[31.81587,-8.88618],[31.94663,-8.93846],[31.94196,-9.02303],[31.98866,-9.07069],[32.08206,-9.04609],[32.16146,-9.05993],[32.25486,-9.13371],[32.43543,-9.11988],[32.49147,-9.14754],[32.53661,-9.24281],[32.75611,-9.28583],[32.76233,-9.31963],[32.95389,-9.40138],[32.99397,-9.36712],[33.14925,-9.49322],[33.31581,-9.48554],[33.48052,-9.62442],[33.76677,-9.58516],[33.93298,-9.71647],[33.9638,-9.62206],[33.95829,-9.54066],[34.03865,-9.49398],[34.54499,-10.0678],[34.51911,-10.12279],[34.57581,-10.56271],[34.65946,-10.6828],[34.67047,-10.93796],[34.61161,-11.01611],[34.63305,-11.11731],[34.79375,-11.32245],[34.91153,-11.39799],[34.96296,-11.57354],[35.63599,-11.55927],[35.82767,-11.41081],[36.19094,-11.57593],[36.19094,-11.70008],[36.62068,-11.72884],[36.80309,-11.56836],[37.3936,-11.68949],[37.76614,-11.53352],[37.8388,-11.3123],[37.93618,-11.26228],[38.21598,-11.27289],[38.47258,-11.4199],[38.88996,-11.16978],[39.24395,-11.17433],[39.58249,-10.96043],[40.00295,-10.80255],[40.44265,-10.4618],[40.74206,-10.25691],[40.14328,-4.64201],[39.62121,-4.68136],[39.44306,-4.93877],[39.21631,-4.67835],[37.81321,-3.69179],[37.75036,-3.54243],[37.63099,-3.50723],[37.5903,-3.42735],[37.71745,-3.304],[37.67199,-3.06222],[34.0824,-1.02264],[34.03084,-1.05101],[34.02286,-1.00779],[33.93107,-.99298],[30.80408,-.99911]]]]}},{type:"Feature",properties:{iso1A2:"UA",iso1A3:"UKR",iso1N3:"804",wikidata:"Q212",nameEn:"Ukraine",groups:["151","150","UN"],callingCodes:["380"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.57318,46.10317],[33.61467,46.13561],[33.63854,46.14147],[33.61517,46.22615],[33.646,46.23028],[33.74047,46.18555],[33.79715,46.20482],[33.85234,46.19863],[33.91549,46.15938],[34.05272,46.10838],[34.07311,46.11769],[34.12929,46.10494],[34.181,46.06804],[34.25111,46.0532],[34.33912,46.06114],[34.41221,46.00245],[34.44155,45.95995],[34.48729,45.94267],[34.52011,45.95097],[34.55889,45.99347],[34.60861,45.99347],[34.66679,45.97136],[34.75479,45.90705],[34.80153,45.90047],[34.79905,45.81009],[34.96015,45.75634],[35.23066,45.79231],[37.62608,46.82615],[38.12112,46.86078],[38.3384,46.98085],[38.22955,47.12069],[38.23049,47.2324],[38.32112,47.2585],[38.33074,47.30508],[38.22225,47.30788],[38.28954,47.39255],[38.28679,47.53552],[38.35062,47.61631],[38.76379,47.69346],[38.79628,47.81109],[38.87979,47.87719],[39.73935,47.82876],[39.82213,47.96396],[39.77544,48.04206],[39.88256,48.04482],[39.83724,48.06501],[39.94847,48.22811],[40.00752,48.22445],[39.99241,48.31768],[39.97325,48.31399],[39.9693,48.29904],[39.95248,48.29972],[39.91465,48.26743],[39.90041,48.3049],[39.84273,48.30947],[39.84136,48.33321],[39.94847,48.35055],[39.88794,48.44226],[39.86196,48.46633],[39.84548,48.57821],[39.79764,48.58668],[39.67226,48.59368],[39.71765,48.68673],[39.73104,48.7325],[39.79466,48.83739],[39.97182,48.79398],[40.08168,48.87443],[40.03636,48.91957],[39.98967,48.86901],[39.78368,48.91596],[39.74874,48.98675],[39.72649,48.9754],[39.71353,48.98959],[39.6683,48.99454],[39.6836,49.05121],[39.93437,49.05709],[40.01988,49.1761],[40.22176,49.25683],[40.18331,49.34996],[40.14912,49.37681],[40.1141,49.38798],[40.03087,49.45452],[40.03636,49.52321],[40.16683,49.56865],[40.13249,49.61672],[39.84548,49.56064],[39.65047,49.61761],[39.59142,49.73758],[39.44496,49.76067],[39.27968,49.75976],[39.1808,49.88911],[38.9391,49.79524],[38.90477,49.86787],[38.73311,49.90238],[38.68677,50.00904],[38.65688,49.97176],[38.35408,50.00664],[38.32524,50.08866],[38.18517,50.08161],[38.21675,49.98104],[38.02999,49.90592],[38.02999,49.94482],[37.90776,50.04194],[37.79515,50.08425],[37.75807,50.07896],[37.61113,50.21976],[37.62879,50.24481],[37.62486,50.29966],[37.47243,50.36277],[37.48204,50.46079],[37.08468,50.34935],[36.91762,50.34963],[36.69377,50.26982],[36.64571,50.218],[36.56655,50.2413],[36.58371,50.28563],[36.47817,50.31457],[36.30101,50.29088],[36.20763,50.3943],[36.06893,50.45205],[35.8926,50.43829],[35.80388,50.41356],[35.73659,50.35489],[35.61711,50.35707],[35.58003,50.45117],[35.47463,50.49247],[35.39464,50.64751],[35.48116,50.66405],[35.47704,50.77274],[35.41367,50.80227],[35.39307,50.92145],[35.32598,50.94524],[35.40837,51.04119],[35.31774,51.08434],[35.20375,51.04723],[35.12685,51.16191],[35.14058,51.23162],[34.97304,51.2342],[34.82472,51.17483],[34.6874,51.18],[34.6613,51.25053],[34.38802,51.2746],[34.31661,51.23936],[34.23009,51.26429],[34.33446,51.363],[34.22048,51.4187],[34.30562,51.5205],[34.17599,51.63253],[34.07765,51.67065],[34.42922,51.72852],[34.41136,51.82793],[34.09413,52.00835],[34.11199,52.14087],[34.05239,52.20132],[33.78789,52.37204],[33.55718,52.30324],[33.48027,52.31499],[33.51323,52.35779],[33.18913,52.3754],[32.89937,52.2461],[32.85405,52.27888],[32.69475,52.25535],[32.54781,52.32423],[32.3528,52.32842],[32.38988,52.24946],[32.33083,52.23685],[32.34044,52.1434],[32.2777,52.10266],[32.23331,52.08085],[32.08813,52.03319],[31.92159,52.05144],[31.96141,52.08015],[31.85018,52.11305],[31.81722,52.09955],[31.7822,52.11406],[31.38326,52.12991],[31.25142,52.04131],[31.13332,52.1004],[30.95589,52.07775],[30.90897,52.00699],[30.76443,51.89739],[30.68804,51.82806],[30.51946,51.59649],[30.64992,51.35014],[30.56203,51.25655],[30.36153,51.33984],[30.34642,51.42555],[30.17888,51.51025],[29.77376,51.4461],[29.7408,51.53417],[29.54372,51.48372],[29.49773,51.39814],[29.42357,51.4187],[29.32881,51.37843],[29.25191,51.49828],[29.25603,51.57089],[29.20659,51.56918],[29.16402,51.64679],[29.1187,51.65872],[28.99098,51.56833],[28.95528,51.59222],[28.81795,51.55552],[28.76027,51.48802],[28.78224,51.45294],[28.75615,51.41442],[28.73143,51.46236],[28.69161,51.44695],[28.64429,51.5664],[28.47051,51.59734],[28.37592,51.54505],[28.23452,51.66988],[28.10658,51.57857],[27.95827,51.56065],[27.91844,51.61952],[27.85253,51.62293],[27.76052,51.47604],[27.67125,51.50854],[27.71932,51.60672],[27.55727,51.63486],[27.51058,51.5854],[27.47212,51.61184],[27.24828,51.60161],[27.26613,51.65957],[27.20948,51.66713],[27.20602,51.77291],[26.99422,51.76933],[26.9489,51.73788],[26.80043,51.75777],[26.69759,51.82284],[26.46962,51.80501],[26.39367,51.87315],[26.19084,51.86781],[26.00408,51.92967],[25.83217,51.92587],[25.80574,51.94556],[25.73673,51.91973],[25.46163,51.92205],[25.20228,51.97143],[24.98784,51.91273],[24.37123,51.88222],[24.29021,51.80841],[24.3163,51.75063],[24.13075,51.66979],[23.99907,51.58369],[23.8741,51.59734],[23.91118,51.63316],[23.7766,51.66809],[23.60906,51.62122],[23.6736,51.50255],[23.62751,51.50512],[23.69905,51.40871],[23.63858,51.32182],[23.80678,51.18405],[23.90376,51.07697],[23.92217,51.00836],[24.04576,50.90196],[24.14524,50.86128],[24.0952,50.83262],[23.99254,50.83847],[23.95925,50.79271],[24.0595,50.71625],[24.0996,50.60752],[24.07048,50.5071],[24.03668,50.44507],[23.99563,50.41289],[23.79445,50.40481],[23.71382,50.38248],[23.67635,50.33385],[23.28221,50.0957],[22.99329,49.84249],[22.83179,49.69875],[22.80261,49.69098],[22.78304,49.65543],[22.64534,49.53094],[22.69444,49.49378],[22.748,49.32759],[22.72009,49.20288],[22.86336,49.10513],[22.89122,49.00725],[22.56155,49.08865],[22.54338,49.01424],[22.48296,48.99172],[22.42934,48.92857],[22.34151,48.68893],[22.21379,48.6218],[22.16023,48.56548],[22.14689,48.4005],[22.2083,48.42534],[22.38133,48.23726],[22.49806,48.25189],[22.59007,48.15121],[22.58733,48.10813],[22.66835,48.09162],[22.73427,48.12005],[22.81804,48.11363],[22.87847,48.04665],[22.84276,47.98602],[22.89849,47.95851],[22.94301,47.96672],[22.92241,48.02002],[23.0158,47.99338],[23.08858,48.00716],[23.1133,48.08061],[23.15999,48.12188],[23.27397,48.08245],[23.33577,48.0237],[23.4979,47.96858],[23.52803,48.01818],[23.5653,48.00499],[23.63894,48.00293],[23.66262,47.98786],[23.75188,47.99705],[23.80904,47.98142],[23.8602,47.9329],[23.89352,47.94512],[23.94192,47.94868],[23.96337,47.96672],[23.98553,47.96076],[24.00801,47.968],[24.02999,47.95087],[24.06466,47.95317],[24.11281,47.91487],[24.22566,47.90231],[24.34926,47.9244],[24.43578,47.97131],[24.61994,47.95062],[24.70632,47.84428],[24.81893,47.82031],[24.88896,47.7234],[25.11144,47.75203],[25.23778,47.89403],[25.63878,47.94924],[25.77723,47.93919],[26.05901,47.9897],[26.17711,47.99246],[26.33504,48.18418],[26.55202,48.22445],[26.62823,48.25804],[26.6839,48.35828],[26.79239,48.29071],[26.82809,48.31629],[26.71274,48.40388],[26.85556,48.41095],[26.93384,48.36558],[27.03821,48.37653],[27.0231,48.42485],[27.08078,48.43214],[27.13434,48.37288],[27.27855,48.37534],[27.32159,48.4434],[27.37604,48.44398],[27.37741,48.41026],[27.44333,48.41209],[27.46942,48.454],[27.5889,48.49224],[27.59027,48.46311],[27.6658,48.44034],[27.74422,48.45926],[27.79225,48.44244],[27.81902,48.41874],[27.87533,48.4037],[27.88391,48.36699],[27.95883,48.32368],[28.04527,48.32661],[28.09873,48.3124],[28.07504,48.23494],[28.17666,48.25963],[28.19314,48.20749],[28.2856,48.23202],[28.32508,48.23384],[28.35519,48.24957],[28.36996,48.20543],[28.34912,48.1787],[28.30586,48.1597],[28.30609,48.14018],[28.34009,48.13147],[28.38712,48.17567],[28.43701,48.15832],[28.42454,48.12047],[28.48428,48.0737],[28.53921,48.17453],[28.69896,48.13106],[28.85232,48.12506],[28.8414,48.03392],[28.9306,47.96255],[29.1723,47.99013],[29.19839,47.89261],[29.27804,47.88893],[29.20663,47.80367],[29.27255,47.79953],[29.22242,47.73607],[29.22414,47.60012],[29.11743,47.55001],[29.18603,47.43387],[29.3261,47.44664],[29.39889,47.30179],[29.47854,47.30366],[29.48678,47.36043],[29.5733,47.36508],[29.59665,47.25521],[29.54996,47.24962],[29.57696,47.13581],[29.49732,47.12878],[29.53044,47.07851],[29.61038,47.09932],[29.62137,47.05069],[29.57056,46.94766],[29.72986,46.92234],[29.75458,46.8604],[29.87405,46.88199],[29.98814,46.82358],[29.94522,46.80055],[29.9743,46.75325],[29.94409,46.56002],[29.88916,46.54302],[30.02511,46.45132],[30.16794,46.40967],[30.09103,46.38694],[29.94114,46.40114],[29.88329,46.35851],[29.74496,46.45605],[29.66359,46.4215],[29.6763,46.36041],[29.5939,46.35472],[29.49914,46.45889],[29.35357,46.49505],[29.24886,46.37912],[29.23547,46.55435],[29.02409,46.49582],[29.01241,46.46177],[28.9306,46.45699],[29.004,46.31495],[28.98478,46.31803],[28.94953,46.25852],[29.06656,46.19716],[28.94643,46.09176],[29.00613,46.04962],[28.98004,46.00385],[28.74383,45.96664],[28.78503,45.83475],[28.69852,45.81753],[28.70401,45.78019],[28.52823,45.73803],[28.47879,45.66994],[28.51587,45.6613],[28.54196,45.58062],[28.49252,45.56716],[28.51449,45.49982],[28.43072,45.48538],[28.41836,45.51715],[28.30201,45.54744],[28.21139,45.46895],[28.28504,45.43907],[28.34554,45.32102],[28.5735,45.24759],[28.71358,45.22631],[28.78911,45.24179],[28.81383,45.3384],[28.94292,45.28045],[28.96077,45.33164],[29.24779,45.43388],[29.42632,45.44545],[29.59798,45.38857],[29.68175,45.26885],[29.65428,45.25629],[29.69272,45.19227],[30.04414,45.08461],[31.62627,45.50633],[33.54017,46.0123],[33.59087,46.06013],[33.57318,46.10317]]]]}},{type:"Feature",properties:{iso1A2:"UG",iso1A3:"UGA",iso1N3:"800",wikidata:"Q1036",nameEn:"Uganda",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["256"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.93107,-.99298],[33.9264,-.54188],[33.98449,-.13079],[33.90936,.10581],[34.10067,.36372],[34.08727,.44713],[34.11408,.48884],[34.13493,.58118],[34.20196,.62289],[34.27345,.63182],[34.31516,.75693],[34.40041,.80266],[34.43349,.85254],[34.52369,1.10692],[34.57427,1.09868],[34.58029,1.14712],[34.67562,1.21265],[34.80223,1.22754],[34.82606,1.26626],[34.82606,1.30944],[34.7918,1.36752],[34.87819,1.5596],[34.92734,1.56109],[34.9899,1.6668],[34.98692,1.97348],[34.90947,2.42447],[34.95267,2.47209],[34.77244,2.70272],[34.78137,2.76223],[34.73967,2.85447],[34.65774,2.8753],[34.60114,2.93034],[34.56242,3.11478],[34.45815,3.18319],[34.40006,3.37949],[34.41794,3.44342],[34.39112,3.48802],[34.44922,3.51627],[34.45815,3.67385],[34.15429,3.80464],[34.06046,4.15235],[33.9873,4.23316],[33.51264,3.75068],[33.18356,3.77812],[33.02852,3.89296],[32.89746,3.81339],[32.72021,3.77327],[32.41337,3.748],[32.20782,3.6053],[32.19888,3.50867],[32.08866,3.53543],[32.08491,3.56287],[32.05187,3.589],[31.95907,3.57408],[31.96205,3.6499],[31.86821,3.78664],[31.81459,3.82083],[31.72075,3.74354],[31.50776,3.63652],[31.50478,3.67814],[31.29476,3.8015],[31.16666,3.79853],[30.97601,3.693],[30.85153,3.48867],[30.94081,3.50847],[30.93486,3.40737],[30.84251,3.26908],[30.77101,3.04897],[30.8574,2.9508],[30.8857,2.83923],[30.75612,2.5863],[30.74271,2.43601],[30.83059,2.42559],[30.91102,2.33332],[30.96911,2.41071],[31.06593,2.35862],[31.07934,2.30207],[31.12104,2.27676],[31.1985,2.29462],[31.20148,2.2217],[31.28042,2.17853],[31.30127,2.11006],[30.48503,1.21675],[30.24671,1.14974],[30.22139,.99635],[30.1484,.89805],[29.98307,.84295],[29.95477,.64486],[29.97413,.52124],[29.87284,.39166],[29.81922,.16824],[29.77454,.16675],[29.7224,.07291],[29.72687,-.08051],[29.65091,-.46777],[29.67474,-.47969],[29.67176,-.55714],[29.62708,-.71055],[29.63006,-.8997],[29.58388,-.89821],[29.59061,-1.39016],[29.82657,-1.31187],[29.912,-1.48269],[30.16369,-1.34303],[30.35212,-1.06896],[30.47194,-1.0555],[30.64166,-1.06601],[30.70631,-1.01175],[30.76635,-.9852],[30.80408,-.99911],[33.93107,-.99298]]]]}},{type:"Feature",properties:{iso1A2:"UM",iso1A3:"UMI",iso1N3:"581",wikidata:"Q16645",nameEn:"United States Minor Outlying Islands",country:"US"},geometry:null},{type:"Feature",properties:{iso1A2:"UN",wikidata:"Q1065",nameEn:"United Nations",level:"unitedNations",isoStatus:"excRes"},geometry:null},{type:"Feature",properties:{iso1A2:"US",iso1A3:"USA",iso1N3:"840",wikidata:"Q30",nameEn:"United States of America"},geometry:null},{type:"Feature",properties:{iso1A2:"UY",iso1A3:"URY",iso1N3:"858",wikidata:"Q77",nameEn:"Uruguay",groups:["005","419","019","UN"],callingCodes:["598"]},geometry:{type:"MultiPolygon",coordinates:[[[[-57.65132,-30.19229],[-57.61478,-30.25165],[-57.64859,-30.35095],[-57.89115,-30.49572],[-57.8024,-30.77193],[-57.89476,-30.95994],[-57.86729,-31.06352],[-57.9908,-31.34924],[-57.98127,-31.3872],[-58.07569,-31.44916],[-58.0023,-31.53084],[-58.00076,-31.65016],[-58.20252,-31.86966],[-58.10036,-32.25338],[-58.22362,-32.52416],[-58.1224,-32.98842],[-58.40475,-33.11777],[-58.44442,-33.84033],[-58.34425,-34.15035],[-57.83001,-34.69099],[-54.78916,-36.21945],[-52.83257,-34.01481],[-53.37138,-33.74313],[-53.39593,-33.75169],[-53.44031,-33.69344],[-53.52794,-33.68908],[-53.53459,-33.16843],[-53.1111,-32.71147],[-53.37671,-32.57005],[-53.39572,-32.58596],[-53.76024,-32.0751],[-54.17384,-31.86168],[-55.50821,-30.91349],[-55.50841,-30.9027],[-55.51862,-30.89828],[-55.52712,-30.89997],[-55.53276,-30.90218],[-55.53431,-30.89714],[-55.54572,-30.89051],[-55.55218,-30.88193],[-55.55373,-30.8732],[-55.5634,-30.8686],[-55.58866,-30.84117],[-55.87388,-31.05053],[-56.4619,-30.38457],[-56.4795,-30.3899],[-56.49267,-30.39471],[-56.90236,-30.02578],[-57.22502,-30.26121],[-57.65132,-30.19229]]]]}},{type:"Feature",properties:{iso1A2:"UZ",iso1A3:"UZB",iso1N3:"860",wikidata:"Q265",nameEn:"Uzbekistan",groups:["143","142","UN"],callingCodes:["998"]},geometry:{type:"MultiPolygon",coordinates:[[[[65.85194,42.85481],[65.53277,43.31856],[65.18666,43.48835],[64.96464,43.74748],[64.53885,43.56941],[63.34656,43.64003],[62.01711,43.51008],[61.01475,44.41383],[58.59711,45.58671],[55.97842,44.99622],[55.97832,44.99622],[55.97822,44.99617],[55.97811,44.99617],[55.97801,44.99612],[55.97801,44.99607],[55.97791,44.99607],[55.9778,44.99607],[55.9777,44.99601],[55.9777,44.99596],[55.9776,44.99591],[55.97749,44.99591],[55.97739,44.99591],[55.97739,44.99586],[55.97729,44.99586],[55.97718,44.99581],[55.97708,44.99576],[55.97698,44.9957],[55.97698,44.99565],[55.97687,44.9956],[55.97677,44.9956],[55.97677,44.99555],[55.97677,44.9955],[55.97667,44.99545],[55.97656,44.99539],[55.97646,44.99534],[55.97646,44.99529],[55.97636,44.99524],[55.97636,44.99519],[55.97625,44.99514],[55.97615,44.99508],[55.97615,44.99503],[55.97615,44.99498],[55.97615,44.99493],[55.97615,44.99483],[55.97615,44.99477],[55.97605,44.99477],[55.97605,44.99467],[55.97605,44.99462],[55.97605,44.99457],[55.97605,44.99452],[55.97594,44.99446],[55.97584,44.99441],[55.97584,44.99436],[55.97584,44.99431],[55.97584,44.99426],[55.97584,44.99421],[55.97584,44.99415],[55.97584,44.99405],[55.97584,44.994],[55.97584,44.9939],[55.97584,44.99384],[55.97584,44.99374],[55.97584,44.99369],[55.97584,44.99359],[55.97584,44.99353],[55.97584,44.99348],[55.97584,44.99343],[55.97584,44.99338],[55.97584,44.99328],[55.97584,44.99322],[56.00314,41.32584],[57.03423,41.25435],[57.13796,41.36625],[57.03359,41.41777],[56.96218,41.80383],[57.03633,41.92043],[57.30275,42.14076],[57.6296,42.16519],[57.84932,42.18555],[57.92897,42.24047],[57.90975,42.4374],[57.99214,42.50021],[58.3492,42.43335],[58.40688,42.29535],[58.51674,42.30348],[58.29427,42.56497],[58.14321,42.62159],[58.27504,42.69632],[58.57991,42.64988],[58.6266,42.79314],[58.93422,42.5407],[59.17317,42.52248],[59.2955,42.37064],[59.4341,42.29738],[59.94633,42.27655],[60.00539,42.212],[59.96419,42.1428],[60.04659,42.08982],[60.0356,42.01028],[59.95046,41.97966],[60.33223,41.75058],[60.08504,41.80997],[60.06032,41.76287],[60.18117,41.60082],[60.06581,41.4363],[60.5078,41.21694],[61.03261,41.25691],[61.22212,41.14946],[61.33199,41.14946],[61.39732,41.19873],[61.4446,41.29407],[61.87856,41.12257],[62.11751,40.58242],[62.34273,40.43206],[62.43337,39.98528],[63.6913,39.27666],[63.70778,39.22349],[64.19086,38.95561],[64.32576,38.98691],[65.55873,38.29052],[65.83913,38.25733],[66.24013,38.16238],[66.41042,38.02403],[66.56697,38.0435],[66.67684,37.96776],[66.53676,37.80084],[66.52852,37.58568],[66.65761,37.45497],[66.52303,37.39827],[66.55743,37.35409],[66.64699,37.32958],[66.95598,37.40162],[67.08232,37.35469],[67.13039,37.27168],[67.2224,37.24545],[67.2581,37.17216],[67.51868,37.26102],[67.78329,37.1834],[67.8474,37.31594],[67.81566,37.43107],[68.12635,37.93],[68.27159,37.91477],[68.40343,38.19484],[68.13289,38.40822],[68.06274,38.39435],[68.11366,38.47169],[68.05873,38.56087],[68.0807,38.64136],[68.05598,38.71641],[68.12877,38.73677],[68.06948,38.82115],[68.19743,38.85985],[68.09704,39.02589],[67.68915,39.00775],[67.67833,39.14479],[67.33226,39.23739],[67.36522,39.31287],[67.45998,39.315],[67.46822,39.46146],[67.39681,39.52505],[67.46547,39.53564],[67.44899,39.57799],[67.62889,39.60234],[67.70992,39.66156],[68.12053,39.56317],[68.54166,39.53929],[68.61972,39.68905],[68.63071,39.85265],[68.88889,39.87163],[68.93695,39.91167],[68.84906,40.04952],[68.96579,40.06949],[69.01935,40.11466],[69.01523,40.15771],[68.62796,40.07789],[68.52771,40.11676],[68.5332,40.14826],[68.77902,40.20492],[68.79276,40.17555],[68.84357,40.18604],[68.85832,40.20885],[69.04544,40.22904],[69.15659,40.2162],[69.2074,40.21488],[69.30448,40.18774],[69.30104,40.24502],[69.25229,40.26362],[69.24817,40.30357],[69.30808,40.2821],[69.32833,40.29794],[69.33794,40.34819],[69.30774,40.36102],[69.28525,40.41894],[69.27066,40.49274],[69.21063,40.54469],[69.2643,40.57506],[69.3455,40.57988],[69.32834,40.70233],[69.38327,40.7918],[69.53021,40.77621],[69.59441,40.70181],[69.69434,40.62615],[70.36655,40.90296],[70.38028,41.02014],[70.45251,41.04438],[70.80009,40.72825],[70.49871,40.52503],[70.32626,40.45174],[70.37511,40.38605],[70.57149,40.3442],[70.56394,40.26421],[70.62342,40.17396],[70.8607,40.217],[70.9818,40.22392],[70.95789,40.28761],[71.05901,40.28765],[71.13042,40.34106],[71.36663,40.31593],[71.4246,40.28619],[71.51215,40.26943],[71.51549,40.22986],[71.61725,40.20615],[71.61931,40.26775],[71.68386,40.26984],[71.70569,40.20391],[71.69621,40.18492],[71.71719,40.17886],[71.73054,40.14818],[71.82646,40.21872],[71.85002,40.25647],[72.05464,40.27586],[71.96401,40.31907],[72.18648,40.49893],[72.24368,40.46091],[72.40346,40.4007],[72.44191,40.48222],[72.41513,40.50856],[72.38384,40.51535],[72.41714,40.55736],[72.34406,40.60144],[72.40517,40.61917],[72.47795,40.5532],[72.66713,40.5219],[72.66713,40.59076],[72.69579,40.59778],[72.73995,40.58409],[72.74768,40.58051],[72.74862,40.57131],[72.75982,40.57273],[72.74894,40.59592],[72.74866,40.60873],[72.80137,40.67856],[72.84754,40.67229],[72.85372,40.7116],[72.8722,40.71111],[72.93296,40.73089],[72.99133,40.76457],[73.0612,40.76678],[73.13412,40.79122],[73.13267,40.83512],[73.01869,40.84681],[72.94454,40.8094],[72.84291,40.85512],[72.68157,40.84942],[72.59136,40.86947],[72.55109,40.96046],[72.48742,40.97136],[72.45206,41.03018],[72.38511,41.02785],[72.36138,41.04384],[72.34757,41.06104],[72.34026,41.04539],[72.324,41.03381],[72.18339,40.99571],[72.17594,41.02377],[72.21061,41.05607],[72.1792,41.10621],[72.14864,41.13363],[72.17594,41.15522],[72.16433,41.16483],[72.10745,41.15483],[72.07249,41.11739],[71.85964,41.19081],[71.91457,41.2982],[71.83914,41.3546],[71.76625,41.4466],[71.71132,41.43012],[71.73054,41.54713],[71.65914,41.49599],[71.6787,41.42111],[71.57227,41.29175],[71.46688,41.31883],[71.43814,41.19644],[71.46148,41.13958],[71.40198,41.09436],[71.34877,41.16807],[71.27187,41.11015],[71.25813,41.18796],[71.11806,41.15359],[71.02193,41.19494],[70.9615,41.16393],[70.86263,41.23833],[70.77885,41.24813],[70.78572,41.36419],[70.67586,41.47953],[70.48909,41.40335],[70.17682,41.5455],[70.69777,41.92554],[71.28719,42.18033],[71.13263,42.28356],[70.94483,42.26238],[69.49545,41.545],[69.45751,41.56863],[69.39485,41.51518],[69.45081,41.46246],[69.37468,41.46555],[69.35554,41.47211],[69.29778,41.43673],[69.25059,41.46693],[69.23332,41.45847],[69.22671,41.46298],[69.20439,41.45391],[69.18528,41.45175],[69.17701,41.43769],[69.15137,41.43078],[69.05006,41.36183],[69.01308,41.22804],[68.7217,41.05025],[68.73945,40.96989],[68.65662,40.93861],[68.62221,41.03019],[68.49983,40.99669],[68.58444,40.91447],[68.63,40.59358],[68.49983,40.56437],[67.96736,40.83798],[68.1271,41.0324],[68.08273,41.08148],[67.98511,41.02794],[67.9644,41.14611],[66.69129,41.1311],[66.53302,41.87388],[66.00546,41.94455],[66.09482,42.93426],[65.85194,42.85481]],[[70.68112,40.90612],[70.6721,40.90555],[70.57501,40.98941],[70.54223,40.98787],[70.56077,41.00642],[70.6158,40.97661],[70.68112,40.90612]]],[[[71.21139,40.03369],[71.12218,40.03052],[71.06305,40.1771],[71.00236,40.18154],[71.01035,40.05481],[71.11037,40.01984],[71.11668,39.99291],[71.09063,39.99],[71.10501,39.95568],[71.04979,39.89808],[71.10531,39.91354],[71.16101,39.88423],[71.23067,39.93581],[71.1427,39.95026],[71.21139,40.03369]]],[[[71.86463,39.98598],[71.78838,40.01404],[71.71511,39.96348],[71.7504,39.93701],[71.84316,39.95582],[71.86463,39.98598]]]]}},{type:"Feature",properties:{iso1A2:"VA",iso1A3:"VAT",iso1N3:"336",wikidata:"Q237",nameEn:"Vatican City",aliases:["Holy See"],groups:["039","150"],callingCodes:["379","39 06"]},geometry:{type:"MultiPolygon",coordinates:[[[[12.45181,41.90056],[12.45446,41.90028],[12.45435,41.90143],[12.45626,41.90172],[12.45691,41.90125],[12.4577,41.90115],[12.45834,41.90174],[12.45826,41.90281],[12.45755,41.9033],[12.45762,41.9058],[12.45561,41.90629],[12.45543,41.90738],[12.45091,41.90625],[12.44984,41.90545],[12.44815,41.90326],[12.44582,41.90194],[12.44834,41.90095],[12.45181,41.90056]]]]}},{type:"Feature",properties:{iso1A2:"VC",iso1A3:"VCT",iso1N3:"670",wikidata:"Q757",nameEn:"St. Vincent and the Grenadines",aliases:["WV"],groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 784"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.64026,12.69984],[-59.94058,12.34011],[-61.69315,14.26451],[-62.64026,12.69984]]]]}},{type:"Feature",properties:{iso1A2:"VE",iso1A3:"VEN",iso1N3:"862",wikidata:"Q717",nameEn:"Venezuela",aliases:["YV"],groups:["005","419","019","UN"],callingCodes:["58"]},geometry:{type:"MultiPolygon",coordinates:[[[[-71.22331,13.01387],[-70.92579,11.96275],[-71.3275,11.85],[-71.9675,11.65536],[-72.24983,11.14138],[-72.4767,11.1117],[-72.88002,10.44309],[-72.98085,9.85253],[-73.36905,9.16636],[-73.02119,9.27584],[-72.94052,9.10663],[-72.77415,9.10165],[-72.65474,8.61428],[-72.4042,8.36513],[-72.36987,8.19976],[-72.35163,8.01163],[-72.39137,8.03534],[-72.47213,7.96106],[-72.48801,7.94329],[-72.48183,7.92909],[-72.47042,7.92306],[-72.45806,7.91141],[-72.46183,7.90682],[-72.44454,7.86031],[-72.46763,7.79518],[-72.47827,7.65604],[-72.45321,7.57232],[-72.47415,7.48928],[-72.43132,7.40034],[-72.19437,7.37034],[-72.04895,7.03837],[-71.82441,7.04314],[-71.44118,7.02116],[-71.42212,7.03854],[-71.37234,7.01588],[-71.03941,6.98163],[-70.7596,7.09799],[-70.10716,6.96516],[-69.41843,6.1072],[-67.60654,6.2891],[-67.4625,6.20625],[-67.43513,5.98835],[-67.58558,5.84537],[-67.63914,5.64963],[-67.59141,5.5369],[-67.83341,5.31104],[-67.85358,4.53249],[-67.62671,3.74303],[-67.50067,3.75812],[-67.30945,3.38393],[-67.85862,2.86727],[-67.85862,2.79173],[-67.65696,2.81691],[-67.21967,2.35778],[-66.85795,1.22998],[-66.28507,.74585],[-65.6727,1.01353],[-65.50158,.92086],[-65.57288,.62856],[-65.11657,1.12046],[-64.38932,1.5125],[-64.34654,1.35569],[-64.08274,1.64792],[-64.06135,1.94722],[-63.39827,2.16098],[-63.39114,2.4317],[-64.0257,2.48156],[-64.02908,2.79797],[-64.48379,3.7879],[-64.84028,4.24665],[-64.72977,4.28931],[-64.57648,4.12576],[-64.14512,4.12932],[-63.99183,3.90172],[-63.86082,3.94796],[-63.70218,3.91417],[-63.67099,4.01731],[-63.50611,3.83592],[-63.42233,3.89995],[-63.4464,3.9693],[-63.21111,3.96219],[-62.98296,3.59935],[-62.7655,3.73099],[-62.74411,4.03331],[-62.57656,4.04754],[-62.44822,4.18621],[-62.13094,4.08309],[-61.54629,4.2822],[-61.48569,4.43149],[-61.29675,4.44216],[-61.31457,4.54167],[-61.15703,4.49839],[-60.98303,4.54167],[-60.86539,4.70512],[-60.5802,4.94312],[-60.73204,5.20931],[-61.4041,5.95304],[-61.15058,6.19558],[-61.20762,6.58174],[-61.13632,6.70922],[-60.54873,6.8631],[-60.39419,6.94847],[-60.28074,7.1162],[-60.44116,7.20817],[-60.54098,7.14804],[-60.63367,7.25061],[-60.59802,7.33194],[-60.71923,7.55817],[-60.64793,7.56877],[-60.51959,7.83373],[-60.38056,7.8302],[-60.02407,8.04557],[-59.97059,8.20791],[-59.83156,8.23261],[-59.80661,8.28906],[-59.85562,8.35213],[-59.98508,8.53046],[-59.54058,8.6862],[-60.89962,9.81445],[-62.08693,10.04435],[-61.62505,11.18974],[-63.73917,11.92623],[-63.19938,16.44103],[-67.89186,12.4116],[-68.01417,11.77722],[-68.33524,11.78151],[-68.99639,11.79035],[-71.22331,13.01387]]]]}},{type:"Feature",properties:{iso1A2:"VG",iso1A3:"VGB",iso1N3:"092",wikidata:"Q25305",nameEn:"British Virgin Islands",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 284"]},geometry:{type:"MultiPolygon",coordinates:[[[[-64.47127,17.55688],[-63.88746,19.15706],[-65.02435,18.73231],[-64.86027,18.39056],[-64.64673,18.36549],[-64.47127,17.55688]]]]}},{type:"Feature",properties:{iso1A2:"VI",iso1A3:"VIR",iso1N3:"850",wikidata:"Q11703",nameEn:"United States Virgin Islands",aliases:["US-VI"],country:"US",groups:["Q1352230","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 340"]},geometry:{type:"MultiPolygon",coordinates:[[[[-65.02435,18.73231],[-65.27974,17.56928],[-64.47127,17.55688],[-64.64673,18.36549],[-64.86027,18.39056],[-65.02435,18.73231]]]]}},{type:"Feature",properties:{iso1A2:"VN",iso1A3:"VNM",iso1N3:"704",wikidata:"Q881",nameEn:"Vietnam",groups:["035","142","UN"],callingCodes:["84"]},geometry:{type:"MultiPolygon",coordinates:[[[[108.10003,21.47338],[108.0569,21.53604],[108.02926,21.54997],[107.97932,21.54503],[107.97383,21.53961],[107.97074,21.54072],[107.96774,21.53601],[107.95232,21.5388],[107.92652,21.58906],[107.90006,21.5905],[107.86114,21.65128],[107.80355,21.66141],[107.66967,21.60787],[107.56537,21.61945],[107.54047,21.5934],[107.49065,21.59774],[107.49532,21.62958],[107.47197,21.6672],[107.41593,21.64839],[107.38636,21.59774],[107.35989,21.60063],[107.35834,21.6672],[107.29296,21.74674],[107.24625,21.7077],[107.20734,21.71493],[107.10771,21.79879],[107.02615,21.81981],[107.00964,21.85948],[107.06101,21.88982],[107.05634,21.92303],[106.99252,21.95191],[106.97228,21.92592],[106.92714,21.93459],[106.9178,21.97357],[106.81038,21.97934],[106.74345,22.00965],[106.72551,21.97923],[106.69276,21.96013],[106.68274,21.99811],[106.70142,22.02409],[106.6983,22.15102],[106.67495,22.1885],[106.69986,22.22309],[106.6516,22.33977],[106.55976,22.34841],[106.57221,22.37],[106.55665,22.46498],[106.58395,22.474],[106.61269,22.60301],[106.65316,22.5757],[106.71698,22.58432],[106.72321,22.63606],[106.76293,22.73491],[106.82404,22.7881],[106.83685,22.8098],[106.81271,22.8226],[106.78422,22.81532],[106.71128,22.85982],[106.71387,22.88296],[106.6734,22.89587],[106.6516,22.86862],[106.60179,22.92884],[106.55976,22.92311],[106.51306,22.94891],[106.49749,22.91164],[106.34961,22.86718],[106.27022,22.87722],[106.19705,22.98475],[106.00179,22.99049],[105.99568,22.94178],[105.90119,22.94168],[105.8726,22.92756],[105.72382,23.06641],[105.57594,23.075],[105.56037,23.16806],[105.49966,23.20669],[105.42805,23.30824],[105.40782,23.28107],[105.32376,23.39684],[105.22569,23.27249],[105.17276,23.28679],[105.11672,23.25247],[105.07002,23.26248],[104.98712,23.19176],[104.96532,23.20463],[104.9486,23.17235],[104.91435,23.18666],[104.87992,23.17141],[104.87382,23.12854],[104.79478,23.12934],[104.8334,23.01484],[104.86765,22.95178],[104.84942,22.93631],[104.77114,22.90017],[104.72755,22.81984],[104.65283,22.83419],[104.60457,22.81841],[104.58122,22.85571],[104.47225,22.75813],[104.35593,22.69353],[104.25683,22.76534],[104.27084,22.8457],[104.11384,22.80363],[104.03734,22.72945],[104.01088,22.51823],[103.99247,22.51958],[103.97384,22.50634],[103.96783,22.51173],[103.96352,22.50584],[103.95191,22.5134],[103.94513,22.52553],[103.93286,22.52703],[103.87904,22.56683],[103.64506,22.79979],[103.56255,22.69499],[103.57812,22.65764],[103.52675,22.59155],[103.43646,22.70648],[103.43179,22.75816],[103.32282,22.8127],[103.28079,22.68063],[103.18895,22.64471],[103.15782,22.59873],[103.17961,22.55705],[103.07843,22.50097],[103.0722,22.44775],[102.9321,22.48659],[102.8636,22.60735],[102.60675,22.73376],[102.57095,22.7036],[102.51802,22.77969],[102.46665,22.77108],[102.42618,22.69212],[102.38415,22.67919],[102.41061,22.64184],[102.25339,22.4607],[102.26428,22.41321],[102.16621,22.43336],[102.14099,22.40092],[102.18712,22.30403],[102.51734,22.02676],[102.49092,21.99002],[102.62301,21.91447],[102.67145,21.65894],[102.74189,21.66713],[102.82115,21.73667],[102.81894,21.83888],[102.85637,21.84501],[102.86077,21.71213],[102.97965,21.74076],[102.98846,21.58936],[102.86297,21.4255],[102.94223,21.46034],[102.88939,21.3107],[102.80794,21.25736],[102.89825,21.24707],[102.97745,21.05821],[103.03469,21.05821],[103.12055,20.89994],[103.21497,20.89832],[103.38032,20.79501],[103.45737,20.82382],[103.68633,20.66324],[103.73478,20.6669],[103.82282,20.8732],[103.98024,20.91531],[104.11121,20.96779],[104.27412,20.91433],[104.63957,20.6653],[104.38199,20.47155],[104.40621,20.3849],[104.47886,20.37459],[104.66158,20.47774],[104.72102,20.40554],[104.62195,20.36633],[104.61315,20.24452],[104.86852,20.14121],[104.91695,20.15567],[104.9874,20.09573],[104.8465,19.91783],[104.8355,19.80395],[104.68359,19.72729],[104.64837,19.62365],[104.53169,19.61743],[104.41281,19.70035],[104.23229,19.70242],[104.06498,19.66926],[104.05617,19.61743],[104.10832,19.51575],[104.06058,19.43484],[103.87125,19.31854],[104.5361,18.97747],[104.64617,18.85668],[105.12829,18.70453],[105.19654,18.64196],[105.1327,18.58355],[105.10408,18.43533],[105.15942,18.38691],[105.38366,18.15315],[105.46292,18.22008],[105.64784,17.96687],[105.60381,17.89356],[105.76612,17.67147],[105.85744,17.63221],[106.09019,17.36399],[106.18991,17.28227],[106.24444,17.24714],[106.29287,17.3018],[106.31929,17.20509],[106.43597,17.01362],[106.50862,16.9673],[106.55045,17.0031],[106.54824,16.92729],[106.51963,16.92097],[106.52183,16.87884],[106.55265,16.86831],[106.55485,16.68704],[106.59013,16.62259],[106.58267,16.6012],[106.61477,16.60713],[106.66052,16.56892],[106.65832,16.47816],[106.74418,16.41904],[106.84104,16.55415],[106.88727,16.52671],[106.88067,16.43594],[106.96638,16.34938],[106.97385,16.30204],[107.02597,16.31132],[107.09091,16.3092],[107.15035,16.26271],[107.14595,16.17816],[107.25822,16.13587],[107.33968,16.05549],[107.44975,16.08511],[107.46296,16.01106],[107.39471,15.88829],[107.34188,15.89464],[107.21419,15.83747],[107.21859,15.74638],[107.27143,15.71459],[107.27583,15.62769],[107.34408,15.62345],[107.3815,15.49832],[107.50699,15.48771],[107.53341,15.40496],[107.62367,15.42193],[107.60605,15.37524],[107.62587,15.2266],[107.58844,15.20111],[107.61926,15.13949],[107.61486,15.0566],[107.46516,15.00982],[107.48277,14.93751],[107.59285,14.87795],[107.51579,14.79282],[107.54361,14.69092],[107.55371,14.628],[107.52102,14.59034],[107.52569,14.54665],[107.48521,14.40346],[107.44941,14.41552],[107.39493,14.32655],[107.40427,14.24509],[107.33577,14.11832],[107.37158,14.07906],[107.35757,14.02319],[107.38247,13.99147],[107.44318,13.99751],[107.46498,13.91593],[107.45252,13.78897],[107.53503,13.73908],[107.61909,13.52577],[107.62843,13.3668],[107.49144,13.01215],[107.49611,12.88926],[107.55993,12.7982],[107.5755,12.52177],[107.55059,12.36824],[107.4463,12.29373],[107.42917,12.24657],[107.34511,12.33327],[107.15831,12.27547],[106.99953,12.08983],[106.92325,12.06548],[106.79405,12.0807],[106.70687,11.96956],[106.4111,11.97413],[106.4687,11.86751],[106.44068,11.86294],[106.44535,11.8279],[106.41577,11.76999],[106.45158,11.68616],[106.44691,11.66787],[106.37219,11.69836],[106.30525,11.67549],[106.26478,11.72122],[106.18539,11.75171],[106.13158,11.73283],[106.06708,11.77761],[106.02038,11.77457],[106.00792,11.7197],[105.95188,11.63738],[105.88962,11.67854],[105.8507,11.66635],[105.80867,11.60536],[105.81645,11.56876],[105.87328,11.55953],[105.88962,11.43605],[105.86782,11.28343],[106.10444,11.07879],[106.1527,11.10476],[106.1757,11.07301],[106.20095,10.97795],[106.14301,10.98176],[106.18539,10.79451],[106.06708,10.8098],[105.94535,10.9168],[105.93403,10.83853],[105.84603,10.85873],[105.86376,10.89839],[105.77751,11.03671],[105.50045,10.94586],[105.42884,10.96878],[105.34011,10.86179],[105.11449,10.96332],[105.08326,10.95656],[105.02722,10.89236],[105.09571,10.72722],[104.95094,10.64003],[104.87933,10.52833],[104.59018,10.53073],[104.49869,10.4057],[104.47963,10.43046],[104.43778,10.42386],[103.99198,10.48391],[102.47649,9.66162],[104.81582,8.03101],[109.55486,8.10026],[111.60491,13.57105],[108.00365,17.98159],[108.10003,21.47338]]]]}},{type:"Feature",properties:{iso1A2:"VU",iso1A3:"VUT",iso1N3:"548",wikidata:"Q686",nameEn:"Vanuatu",groups:["054","009","UN"],callingCodes:["678"]},geometry:{type:"MultiPolygon",coordinates:[[[[156.73836,-14.50464],[174.245,-23.1974],[172.71443,-12.01327],[156.73836,-14.50464]]]]}},{type:"Feature",properties:{iso1A2:"WF",iso1A3:"WLF",iso1N3:"876",wikidata:"Q35555",nameEn:"Wallis and Futuna",country:"FR",groups:["EU","Q1451600","061","009","UN"],callingCodes:["681"]},geometry:{type:"MultiPolygon",coordinates:[[[[-178.66551,-14.32452],[-176.76826,-14.95183],[-175.59809,-12.61507],[-178.66551,-14.32452]]]]}},{type:"Feature",properties:{iso1A2:"WS",iso1A3:"WSM",iso1N3:"882",wikidata:"Q683",nameEn:"Samoa",groups:["061","009","UN"],driveSide:"left",callingCodes:["685"]},geometry:{type:"MultiPolygon",coordinates:[[[[-173.74402,-14.26669],[-170.99605,-15.1275],[-171.39864,-10.21587],[-173.74402,-14.26669]]]]}},{type:"Feature",properties:{iso1A2:"XK",iso1A3:"XKX",wikidata:"Q1246",nameEn:"Kosovo",aliases:["KV"],groups:["039","150"],isoStatus:"usrAssn",callingCodes:["383"]},geometry:{type:"MultiPolygon",coordinates:[[[[21.39045,42.74888],[21.44047,42.87276],[21.36941,42.87397],[21.32974,42.90424],[21.2719,42.8994],[21.23534,42.95523],[21.23877,43.00848],[21.2041,43.02277],[21.16734,42.99694],[21.14465,43.11089],[21.08952,43.13471],[21.05378,43.10707],[21.00749,43.13984],[20.96287,43.12416],[20.83727,43.17842],[20.88685,43.21697],[20.82145,43.26769],[20.73811,43.25068],[20.68688,43.21335],[20.59929,43.20492],[20.69515,43.09641],[20.64557,43.00826],[20.59929,43.01067],[20.48692,42.93208],[20.53484,42.8885],[20.43734,42.83157],[20.40594,42.84853],[20.35692,42.8335],[20.27869,42.81945],[20.2539,42.76245],[20.04898,42.77701],[20.02088,42.74789],[20.02915,42.71147],[20.0969,42.65559],[20.07761,42.55582],[20.17127,42.50469],[20.21797,42.41237],[20.24399,42.32168],[20.34479,42.32656],[20.3819,42.3029],[20.48857,42.25444],[20.56955,42.12097],[20.55633,42.08173],[20.59434,42.03879],[20.63069,41.94913],[20.57946,41.91593],[20.59524,41.8818],[20.68523,41.85318],[20.76786,41.91839],[20.75464,42.05229],[21.11491,42.20794],[21.16614,42.19815],[21.22728,42.08909],[21.31983,42.10993],[21.29913,42.13954],[21.30496,42.1418],[21.38428,42.24465],[21.43882,42.23609],[21.43882,42.2789],[21.50823,42.27156],[21.52145,42.24465],[21.58992,42.25915],[21.56772,42.30946],[21.5264,42.33634],[21.53467,42.36809],[21.57021,42.3647],[21.59029,42.38042],[21.62887,42.37664],[21.64209,42.41081],[21.62556,42.45106],[21.7035,42.51899],[21.70522,42.54176],[21.7327,42.55041],[21.75672,42.62695],[21.79413,42.65923],[21.75025,42.70125],[21.6626,42.67813],[21.58755,42.70418],[21.59154,42.72643],[21.47498,42.74695],[21.39045,42.74888]]]]}},{type:"Feature",properties:{iso1A2:"YE",iso1A3:"YEM",iso1N3:"887",wikidata:"Q805",nameEn:"Yemen",groups:["145","142","UN"],callingCodes:["967"]},geometry:{type:"MultiPolygon",coordinates:[[[[57.49095,8.14549],[52.81185,17.28568],[52.74267,17.29519],[52.78009,17.35124],[52.00311,19.00083],[49.04884,18.59899],[48.19996,18.20584],[47.58351,17.50366],[47.48245,17.10808],[47.00571,16.94765],[46.76494,17.29151],[46.31018,17.20464],[44.50126,17.47475],[43.70631,17.35762],[43.43005,17.56148],[43.29185,17.53224],[43.22533,17.38343],[43.32653,17.31179],[43.20156,17.25901],[43.17787,17.14717],[43.23967,17.03428],[43.18233,17.02673],[43.1813,16.98438],[43.19328,16.94703],[43.1398,16.90696],[43.18338,16.84852],[43.22012,16.83932],[43.22956,16.80613],[43.24801,16.80613],[43.26303,16.79479],[43.25857,16.75304],[43.21325,16.74416],[43.22066,16.65179],[43.15274,16.67248],[43.11601,16.53166],[42.97215,16.51093],[42.94351,16.49467],[42.94625,16.39721],[42.76801,16.40371],[42.15205,16.40211],[40.99158,15.81743],[43.29075,12.79154],[43.32909,12.59711],[43.90659,12.3823],[51.12877,12.56479],[57.49095,8.14549]]]]}},{type:"Feature",properties:{iso1A2:"YT",iso1A3:"MYT",iso1N3:"175",wikidata:"Q17063",nameEn:"Mayotte",country:"FR",groups:["Q3320166","EU","014","202","002","UN"],callingCodes:["262"]},geometry:{type:"MultiPolygon",coordinates:[[[[43.28731,-13.97126],[45.54824,-13.22353],[45.4971,-11.75965],[43.28731,-13.97126]]]]}},{type:"Feature",properties:{iso1A2:"ZA",iso1A3:"ZAF",iso1N3:"710",wikidata:"Q258",nameEn:"South Africa",groups:["018","202","002","UN"],driveSide:"left",callingCodes:["27"]},geometry:{type:"MultiPolygon",coordinates:[[[[31.30611,-22.422],[31.16344,-22.32599],[31.08932,-22.34884],[30.86696,-22.28907],[30.6294,-22.32599],[30.48686,-22.31368],[30.38614,-22.34533],[30.28351,-22.35587],[30.2265,-22.2961],[30.13147,-22.30841],[29.92242,-22.19408],[29.76848,-22.14128],[29.64609,-22.12917],[29.37703,-22.19581],[29.21955,-22.17771],[29.18974,-22.18599],[29.15268,-22.21399],[29.10881,-22.21202],[29.0151,-22.22907],[28.91889,-22.44299],[28.63287,-22.55887],[28.34874,-22.5694],[28.04562,-22.8394],[28.04752,-22.90243],[27.93729,-22.96194],[27.93539,-23.04941],[27.74154,-23.2137],[27.6066,-23.21894],[27.52393,-23.37952],[27.33768,-23.40917],[26.99749,-23.65486],[26.84165,-24.24885],[26.51667,-24.47219],[26.46346,-24.60358],[26.39409,-24.63468],[25.8515,-24.75727],[25.84295,-24.78661],[25.88571,-24.87802],[25.72702,-25.25503],[25.69661,-25.29284],[25.6643,-25.4491],[25.58543,-25.6343],[25.33076,-25.76616],[25.12266,-25.75931],[25.01718,-25.72507],[24.8946,-25.80723],[24.67319,-25.81749],[24.44703,-25.73021],[24.36531,-25.773],[24.18287,-25.62916],[23.9244,-25.64286],[23.47588,-25.29971],[23.03497,-25.29971],[22.86012,-25.50572],[22.70808,-25.99186],[22.56365,-26.19668],[22.41921,-26.23078],[22.21206,-26.3773],[22.06192,-26.61882],[21.90703,-26.66808],[21.83291,-26.65959],[21.77114,-26.69015],[21.7854,-26.79199],[21.69322,-26.86152],[21.37869,-26.82083],[21.13353,-26.86661],[20.87031,-26.80047],[20.68596,-26.9039],[20.63275,-26.78181],[20.61754,-26.4692],[20.86081,-26.14892],[20.64795,-25.47827],[20.29826,-24.94869],[20.03678,-24.81004],[20.02809,-24.78725],[19.99817,-24.76768],[19.99882,-28.42622],[18.99885,-28.89165],[17.4579,-28.68718],[17.15405,-28.08573],[16.90446,-28.057],[16.59922,-28.53246],[16.46592,-28.57126],[16.45332,-28.63117],[12.51595,-32.27486],[38.88176,-48.03306],[34.51034,-26.91792],[32.35222,-26.86027],[32.29584,-26.852],[32.22302,-26.84136],[32.19409,-26.84032],[32.13315,-26.84345],[32.09664,-26.80721],[32.00893,-26.8096],[31.97463,-27.11057],[31.97592,-27.31675],[31.49834,-27.31549],[31.15027,-27.20151],[30.96088,-27.0245],[30.97757,-26.92706],[30.88826,-26.79622],[30.81101,-26.84722],[30.78927,-26.48271],[30.95819,-26.26303],[31.13073,-25.91558],[31.31237,-25.7431],[31.4175,-25.71886],[31.86881,-25.99973],[31.974,-25.95387],[31.92649,-25.84216],[32.00631,-25.65044],[31.97875,-25.46356],[32.01676,-25.38117],[32.03196,-25.10785],[31.9835,-24.29983],[31.90368,-24.18892],[31.87707,-23.95293],[31.77445,-23.90082],[31.70223,-23.72695],[31.67942,-23.60858],[31.56539,-23.47268],[31.55779,-23.176],[31.30611,-22.422]],[[29.33204,-29.45598],[29.28545,-29.58456],[29.12553,-29.76266],[29.16548,-29.91706],[28.9338,-30.05072],[28.80222,-30.10579],[28.68627,-30.12885],[28.399,-30.1592],[28.2319,-30.28476],[28.12073,-30.68072],[27.74814,-30.60635],[27.69467,-30.55862],[27.67819,-30.53437],[27.6521,-30.51707],[27.62137,-30.50509],[27.56781,-30.44562],[27.56901,-30.42504],[27.45452,-30.32239],[27.38108,-30.33456],[27.36649,-30.27246],[27.37293,-30.19401],[27.40778,-30.14577],[27.32555,-30.14785],[27.29603,-30.05473],[27.22719,-30.00718],[27.09489,-29.72796],[27.01016,-29.65439],[27.33464,-29.48161],[27.4358,-29.33465],[27.47254,-29.31968],[27.45125,-29.29708],[27.48679,-29.29349],[27.54258,-29.25575],[27.5158,-29.2261],[27.55974,-29.18954],[27.75458,-28.89839],[27.8907,-28.91612],[27.88933,-28.88156],[27.9392,-28.84864],[27.98675,-28.8787],[28.02503,-28.85991],[28.1317,-28.7293],[28.2348,-28.69471],[28.30518,-28.69531],[28.40612,-28.6215],[28.65091,-28.57025],[28.68043,-28.58744],[29.40524,-29.21246],[29.44883,-29.3772],[29.33204,-29.45598]]]]}},{type:"Feature",properties:{iso1A2:"ZM",iso1A3:"ZMB",iso1N3:"894",wikidata:"Q953",nameEn:"Zambia",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["260"]},geometry:{type:"MultiPolygon",coordinates:[[[[32.95389,-9.40138],[32.76233,-9.31963],[32.75611,-9.28583],[32.53661,-9.24281],[32.49147,-9.14754],[32.43543,-9.11988],[32.25486,-9.13371],[32.16146,-9.05993],[32.08206,-9.04609],[31.98866,-9.07069],[31.94196,-9.02303],[31.94663,-8.93846],[31.81587,-8.88618],[31.71158,-8.91386],[31.57147,-8.81388],[31.57147,-8.70619],[31.37533,-8.60769],[31.00796,-8.58615],[30.79243,-8.27382],[28.88917,-8.4831],[28.9711,-8.66935],[28.38526,-9.23393],[28.36562,-9.30091],[28.52636,-9.35379],[28.51627,-9.44726],[28.56208,-9.49122],[28.68532,-9.78],[28.62795,-9.92942],[28.65032,-10.65133],[28.37241,-11.57848],[28.48357,-11.87532],[29.18592,-12.37921],[29.4992,-12.43843],[29.48404,-12.23604],[29.8139,-12.14898],[29.81551,-13.44683],[29.65078,-13.41844],[29.60531,-13.21685],[29.01918,-13.41353],[28.33199,-12.41375],[27.59932,-12.22123],[27.21025,-11.76157],[27.22541,-11.60323],[27.04351,-11.61312],[26.88687,-12.01868],[26.01777,-11.91488],[25.33058,-11.65767],[25.34069,-11.19707],[24.42612,-11.44975],[24.34528,-11.06816],[24.00027,-10.89356],[24.02603,-11.15368],[23.98804,-12.13149],[24.06672,-12.29058],[23.90937,-12.844],[24.03339,-12.99091],[21.97988,-13.00148],[22.00323,-16.18028],[22.17217,-16.50269],[23.20038,-17.47563],[23.47474,-17.62877],[24.23619,-17.47489],[24.32811,-17.49082],[24.38712,-17.46818],[24.5621,-17.52963],[24.70864,-17.49501],[25.00198,-17.58221],[25.26433,-17.79571],[25.51646,-17.86232],[25.6827,-17.81987],[25.85738,-17.91403],[25.85892,-17.97726],[26.08925,-17.98168],[26.0908,-17.93021],[26.21601,-17.88608],[26.55918,-17.99638],[26.68403,-18.07411],[26.74314,-18.0199],[26.89926,-17.98756],[27.14196,-17.81398],[27.30736,-17.60487],[27.61377,-17.34378],[27.62795,-17.24365],[27.83141,-16.96274],[28.73725,-16.5528],[28.76199,-16.51575],[28.81454,-16.48611],[28.8501,-16.04537],[28.9243,-15.93987],[29.01298,-15.93805],[29.21955,-15.76589],[29.4437,-15.68702],[29.8317,-15.6126],[30.35574,-15.6513],[30.41902,-15.62269],[30.22098,-14.99447],[33.24249,-14.00019],[33.16749,-13.93992],[33.07568,-13.98447],[33.02977,-14.05022],[32.99042,-13.95689],[32.88985,-13.82956],[32.79015,-13.80755],[32.76962,-13.77224],[32.84528,-13.71576],[32.7828,-13.64805],[32.68654,-13.64268],[32.66468,-13.60019],[32.68436,-13.55769],[32.73683,-13.57682],[32.84176,-13.52794],[32.86113,-13.47292],[33.0078,-13.19492],[32.98289,-13.12671],[33.02181,-12.88707],[32.96733,-12.88251],[32.94397,-12.76868],[33.05917,-12.59554],[33.18837,-12.61377],[33.28177,-12.54692],[33.37517,-12.54085],[33.54485,-12.35996],[33.47636,-12.32498],[33.3705,-12.34931],[33.25998,-12.14242],[33.33937,-11.91252],[33.32692,-11.59248],[33.24252,-11.59302],[33.23663,-11.40637],[33.29267,-11.43536],[33.29267,-11.3789],[33.39697,-11.15296],[33.25998,-10.88862],[33.28022,-10.84428],[33.47636,-10.78465],[33.70675,-10.56896],[33.54797,-10.36077],[33.53863,-10.20148],[33.31297,-10.05133],[33.37902,-9.9104],[33.36581,-9.81063],[33.31517,-9.82364],[33.2095,-9.61099],[33.12144,-9.58929],[33.10163,-9.66525],[33.05485,-9.61316],[33.00256,-9.63053],[33.00476,-9.5133],[32.95389,-9.40138]]]]}},{type:"Feature",properties:{iso1A2:"ZW",iso1A3:"ZWE",iso1N3:"716",wikidata:"Q954",nameEn:"Zimbabwe",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["263"]},geometry:{type:"MultiPolygon",coordinates:[[[[30.41902,-15.62269],[30.35574,-15.6513],[29.8317,-15.6126],[29.4437,-15.68702],[29.21955,-15.76589],[29.01298,-15.93805],[28.9243,-15.93987],[28.8501,-16.04537],[28.81454,-16.48611],[28.76199,-16.51575],[28.73725,-16.5528],[27.83141,-16.96274],[27.62795,-17.24365],[27.61377,-17.34378],[27.30736,-17.60487],[27.14196,-17.81398],[26.89926,-17.98756],[26.74314,-18.0199],[26.68403,-18.07411],[26.55918,-17.99638],[26.21601,-17.88608],[26.0908,-17.93021],[26.08925,-17.98168],[25.85892,-17.97726],[25.85738,-17.91403],[25.6827,-17.81987],[25.51646,-17.86232],[25.26433,-17.79571],[25.23909,-17.90832],[25.31799,-18.07091],[25.39972,-18.12691],[25.53465,-18.39041],[25.68859,-18.56165],[25.79217,-18.6355],[25.82353,-18.82808],[25.94326,-18.90362],[25.99837,-19.02943],[25.96226,-19.08152],[26.17227,-19.53709],[26.72246,-19.92707],[27.21278,-20.08244],[27.29831,-20.28935],[27.28865,-20.49873],[27.69361,-20.48531],[27.72972,-20.51735],[27.69171,-21.08409],[27.91407,-21.31621],[28.01669,-21.57624],[28.29416,-21.59037],[28.49942,-21.66634],[28.58114,-21.63455],[29.07763,-21.81877],[29.04023,-21.85864],[29.02191,-21.90647],[29.02191,-21.95665],[29.04108,-22.00563],[29.08495,-22.04867],[29.14501,-22.07275],[29.1974,-22.07472],[29.24648,-22.05967],[29.3533,-22.18363],[29.37703,-22.19581],[29.64609,-22.12917],[29.76848,-22.14128],[29.92242,-22.19408],[30.13147,-22.30841],[30.2265,-22.2961],[30.28351,-22.35587],[30.38614,-22.34533],[30.48686,-22.31368],[30.6294,-22.32599],[30.86696,-22.28907],[31.08932,-22.34884],[31.16344,-22.32599],[31.30611,-22.422],[31.38336,-22.36919],[32.41234,-21.31246],[32.48236,-21.32873],[32.37115,-21.133],[32.51644,-20.91929],[32.48122,-20.63319],[32.55167,-20.56312],[32.66174,-20.56106],[32.85987,-20.27841],[32.85987,-20.16686],[32.93032,-20.03868],[33.01178,-20.02007],[33.06461,-19.77787],[32.95013,-19.67219],[32.84666,-19.68462],[32.84446,-19.48343],[32.78282,-19.47513],[32.77966,-19.36098],[32.85107,-19.29238],[32.87088,-19.09279],[32.84006,-19.0262],[32.72118,-19.02204],[32.69917,-18.94293],[32.73439,-18.92628],[32.70137,-18.84712],[32.82465,-18.77419],[32.9017,-18.7992],[32.95013,-18.69079],[32.88629,-18.58023],[32.88629,-18.51344],[33.02278,-18.4696],[33.03159,-18.35054],[32.94133,-17.99705],[33.0492,-17.60298],[32.98536,-17.55891],[32.96554,-17.48964],[33.0426,-17.3468],[33.00517,-17.30477],[32.96554,-17.11971],[32.84113,-16.92259],[32.91051,-16.89446],[32.97655,-16.70689],[32.78943,-16.70267],[32.69917,-16.66893],[32.71017,-16.59932],[32.42838,-16.4727],[32.28529,-16.43892],[32.02772,-16.43892],[31.91324,-16.41569],[31.90223,-16.34388],[31.67988,-16.19595],[31.42451,-16.15154],[31.30563,-16.01193],[31.13171,-15.98019],[30.97761,-16.05848],[30.91597,-15.99924],[30.42568,-15.9962],[30.41902,-15.62269]]]]}}]},FW=DW,oT={},an={},LW=/(?=(?!^(and|the|of|el|la|de)$))(\b(and|the|of|el|la|de)\b)|[-_ .,'()&[\]/]/gi;function AF(t){let e=t||"";return e.charAt(0)==="."?e.toUpperCase():e.replace(LW,"").toUpperCase()}var Ju=["subterritory","territory","subcountryGroup","country","sharedLandform","intermediateRegion","subregion","region","subunion","union","unitedNations","world"];NW(FW);function NW(t){let e=["iso1A2","iso1A3","m49","wikidata","emojiFlag","ccTLD","nameEn"],i=[];for(let T of t.features){let A=T.properties;A.id=A.iso1A2||A.m49||A.wikidata,n(T),o(T),a(T),l(T),s(T),v(T),b(T),T.geometry&&i.push(T)}for(let T of t.features)T.properties.groups=T.properties.groups.map(A=>an[A].properties.id),E(T);for(let T of t.features)d(T),m(T),g(T),_(T),c(T);for(let T of t.features)T.properties.groups.sort((A,M)=>Ju.indexOf(an[A].properties.level)-Ju.indexOf(an[M].properties.level)),T.properties.members&&T.properties.members.sort((A,M)=>{let k=Ju.indexOf(an[A].properties.level)-Ju.indexOf(an[M].properties.level);return k===0?t.features.indexOf(an[A])-t.features.indexOf(an[M]):k});oT=(0,SF.default)({type:"FeatureCollection",features:i});function s(T){let A=T.properties;A.groups||(A.groups=[]),T.geometry&&A.country&&A.groups.push(A.country),A.m49!=="001"&&A.groups.push("001")}function n(T){let A=T.properties;!A.m49&&A.iso1N3&&(A.m49=A.iso1N3)}function o(T){let A=T.properties;A.level!=="unitedNations"&&!A.ccTLD&&A.iso1A2&&(A.ccTLD="."+A.iso1A2.toLowerCase())}function a(T){let A=T.properties;!A.isoStatus&&A.iso1A2&&(A.isoStatus="official")}function l(T){let A=T.properties;A.level||(A.country?!A.iso1A2||A.isoStatus==="official"?A.level="territory":A.level="subterritory":A.level="country")}function c(T){let A=T.properties;if(T.geometry||!A.members)return;let M=Ju.indexOf(A.level),k=[];A.members.forEach((F,O)=>{let U=an[F].properties.groups.filter(z=>z!==T.properties.id&&M<Ju.indexOf(an[z].properties.level));O===0?k=U:k=k.filter(z=>U.indexOf(z)!==-1)}),A.groups=A.groups.concat(k.filter(F=>A.groups.indexOf(F)===-1));for(let F of k){let O=an[F];O.properties.members.indexOf(A.id)===-1&&O.properties.members.push(A.id)}}function d(T){let A=T.properties;if(T.geometry)A.roadSpeedUnit||(A.roadSpeedUnit="km/h");else if(A.members){let M=Array.from(new Set(A.members.map(k=>{let F=an[k];if(F.geometry)return F.properties.roadSpeedUnit||"km/h"}).filter(Boolean)));M.length===1&&(A.roadSpeedUnit=M[0])}}function m(T){let A=T.properties;if(T.geometry)A.roadHeightUnit||(A.roadHeightUnit="m");else if(A.members){let M=Array.from(new Set(A.members.map(k=>{let F=an[k];if(F.geometry)return F.properties.roadHeightUnit||"m"}).filter(Boolean)));M.length===1&&(A.roadHeightUnit=M[0])}}function g(T){let A=T.properties;if(T.geometry)A.driveSide||(A.driveSide="right");else if(A.members){let M=Array.from(new Set(A.members.map(k=>{let F=an[k];if(F.geometry)return F.properties.driveSide||"right"}).filter(Boolean)));M.length===1&&(A.driveSide=M[0])}}function _(T){let A=T.properties;!T.geometry&&A.members&&(A.callingCodes=Array.from(new Set(A.members.reduce((M,k)=>{let F=an[k];return F.geometry&&F.properties.callingCodes?M.concat(F.properties.callingCodes):M},[]))))}function v(T){if(!T.properties.iso1A2)return;let A=T.properties.iso1A2.replace(/./g,function(M){return String.fromCodePoint(M.charCodeAt(0)+127397)});T.properties.emojiFlag=A}function E(T){for(let A of T.properties.groups){let M=an[A];M.properties.members||(M.properties.members=[]),M.properties.members.push(T.properties.id)}}function b(T){let A=[];for(let M of e){let k=T.properties[M];k&&A.push(k)}for(let M of T.properties.aliases||[])A.push(M);for(let M of A){let k=AF(M);an[k]=T}}}function OW(t){return Array.isArray(t)?t:t.coordinates?t.coordinates:t.geometry.coordinates}function CF(t){let e=OW(t),i=oT(e);return i?an[i.id]:null}function BW(t){let e=CF(t);if(!e)return null;let i=e.properties.country||e.properties.iso1A2;return an[i]||null}var IF={level:void 0,maxLevel:void 0,withProp:void 0};function UW(t,e){let i=e.level||"country",r=e.maxLevel||"world",s=e.withProp,n=Ju.indexOf(i);if(n===-1)return null;let o=Ju.indexOf(r);if(o===-1||o<n)return null;if(i==="country"){let c=BW(t);if(c&&(!s||c.properties[s]))return c}return GW(t).find(c=>{let d=Ju.indexOf(c.properties.level);return(c.properties.level===i||d>n&&d<=o)&&(!s||c.properties[s])?c:!1})||null}function aT(t){let e;return typeof t=="number"?(e=t.toString(),e.length===1?e="00"+e:e.length===2&&(e="0"+e)):e=AF(t),an[e]||null}function zW(t){return oT.bbox(t).map(e=>an[e.id])}function kF(t){return typeof t=="object"?CF(t):aT(t)}function Rm(t,e=IF){return typeof t=="object"?UW(t,e):aT(t)}function ph(t,e=IF){e.withProp="iso1A2";let i=Rm(t,e);return i&&i.properties.iso1A2||null}function GW(t,e){let i;if(Array.isArray(t)&&t.length===4)i=zW(t);else{let s=kF(t);i=s?[s]:[]}if(!i.length)return[];let r;!e||typeof t=="object"?r=i.slice():r=[];for(let s of i){let n=s.properties;for(let o of n.groups){let a=an[o];r.indexOf(a)===-1&&r.push(a)}}return r}function $W(t,e){let i=aT(t);if(!i)return[];let r=[];e||r.push(i);let s=i.properties;for(let n of s.members||[])r.push(an[n]);return r}function MF(t){var r;let e=$W(t,!1);if(e.length===0)return null;let i=[];for(let s of e)((r=s.geometry)==null?void 0:r.type)==="MultiPolygon"&&s.geometry.coordinates&&(i=i.concat(s.geometry.coordinates));return{type:"Feature",properties:e[0].properties,geometry:{type:"MultiPolygon",coordinates:i}}}function PF(t){let e=kF(t);return e&&e.properties.roadSpeedUnit||null}var Dm=Yi(hT(),1),aL=Yi(eL(),1),xT=Yi(yT(),1),lL=Yi(tL(),1),cL=Yi(sL(),1),ay=class{constructor(t){this._cache={},this._strict=!0,t&&t.type==="FeatureCollection"&&Array.isArray(t.features)&&t.features.forEach(i=>{i.properties=i.properties||{};let r=i.properties,s=i.id||r.id;if(!(!s||!/^\S+\.geojson$/i.test(s))){if(s=s.toLowerCase(),i.id=s,r.id=s,!r.area){let n=Dm.default.geometry(i.geometry)/1e6;r.area=Number(n.toFixed(2))}this._cache[s]=i}});let e=nL(Rm("Q2"));e.geometry={type:"Polygon",coordinates:[[[-180,-90],[180,-90],[180,90],[-180,90],[-180,-90]]]},e.id="Q2",e.properties.id="Q2",e.properties.area=Dm.default.geometry(e.geometry)/1e6,this._cache.Q2=e}validateLocation(t){if(Array.isArray(t)&&(t.length===2||t.length===3)){let e=t[0],i=t[1],r=t[2];if(Number.isFinite(e)&&e>=-180&&e<=180&&Number.isFinite(i)&&i>=-90&&i<=90&&(t.length===2||Number.isFinite(r)&&r>0)){let s="["+t.toString()+"]";return{type:"point",location:t,id:s}}}else if(typeof t=="string"&&/^\S+\.geojson$/i.test(t)){let e=t.toLowerCase();if(this._cache[e])return{type:"geojson",location:t,id:e}}else if(typeof t=="string"||typeof t=="number"){let e=Rm(t);if(e){let i=e.properties.wikidata;return{type:"countrycoder",location:t,id:i}}}if(this._strict)throw new Error(`validateLocation:  Invalid location: "${t}".`);return null}resolveLocation(t){let e=this.validateLocation(t);if(!e)return null;let i=e.id;if(this._cache[i])return Object.assign(e,{feature:this._cache[i]});if(e.type==="point"){let r=t[0],s=t[1],n=t[2]||25,o=10,a=3,l=Math.PI*n*n,c=this._cache[i]=(0,lL.default)({type:"Feature",id:i,properties:{id:i,area:Number(l.toFixed(2))},geometry:(0,aL.default)([r,s],n*1e3,o)},a);return Object.assign(e,{feature:c})}else if(e.type!=="geojson"){if(e.type==="countrycoder"){let r=nL(Rm(i)),s=r.properties;if(Array.isArray(s.members)){let n=MF(i);n.geometry.coordinates=oy([n],"UNION").geometry.coordinates,r.geometry=n.geometry}if(!s.area){let n=Dm.default.geometry(r.geometry)/1e6;s.area=Number(n.toFixed(2))}return r.id=i,s.id=i,this._cache[i]=r,Object.assign(e,{feature:r})}}if(this._strict)throw new Error(`resolveLocation:  Couldn't resolve location "${t}".`);return null}validateLocationSet(t){t=t||{};let e=this.validateLocation.bind(this),i=(t.include||[]).map(e).filter(Boolean),r=(t.exclude||[]).map(e).filter(Boolean);if(!i.length){if(this._strict)throw new Error("validateLocationSet:  LocationSet includes nothing.");t.include=["Q2"],i=[{type:"countrycoder",location:"Q2",id:"Q2"}]}i.sort(oL);let s="+["+i.map(n=>n.id).join(",")+"]";return r.length&&(r.sort(oL),s+="-["+r.map(n=>n.id).join(",")+"]"),{type:"locationset",locationSet:t,id:s}}resolveLocationSet(t){t=t||{};let e=this.validateLocationSet(t);if(!e)return null;let i=e.id;if(this._cache[i])return Object.assign(e,{feature:this._cache[i]});let r=this.resolveLocation.bind(this),s=(t.include||[]).map(r).filter(Boolean),n=(t.exclude||[]).map(r).filter(Boolean);if(s.length===1&&n.length===0)return Object.assign(e,{feature:s[0].feature});let o=oy(s.map(d=>d.feature),"UNION"),a=oy(n.map(d=>d.feature),"UNION"),l=a?oy([o,a],"DIFFERENCE"):o,c=Dm.default.geometry(l.geometry)/1e6;return l.id=i,l.properties={id:i,area:Number(c.toFixed(2))},this._cache[i]=l,Object.assign(e,{feature:l})}strict(t){return t===void 0?this._strict:(this._strict=t,this)}cache(){return this._cache}stringify(t,e){return(0,cL.default)(t,e)}};function oy(t,e){if(!Array.isArray(t)||!t.length)return null;let i={UNION:xT.default.union,DIFFERENCE:xT.default.difference}[e],r=t.map(o=>o.geometry.coordinates),s=i.apply(null,r);return{type:"Feature",properties:{},geometry:{type:n(s),coordinates:s}};function n(o){return Array.isArray(o)&&Array.isArray(o[0])&&Array.isArray(o[0][0])&&Array.isArray(o[0][0][0])?"MultiPolygon":"Polygon"}}function nL(t){return JSON.parse(JSON.stringify(t))}function oL(t,e){let i={countrycoder:1,geojson:2,point:3},r=i[t.type],s=i[e.type];return r>s?1:r<s?-1:t.id.localeCompare(e.id)}var vT=Yi(km(),1),uL=Yi(hT(),1);var e1=new ay,Fm=class extends fi{constructor(e){super(e),this.id="locations",this.dependencies=new Set,this._wp=null,this._resolved=new Map,this._knownLocationSets=new Map,this._locationIncludedIn=new Map,this._locationExcludedIn=new Map,this._blocks=[{locationSet:{include:["Q7835","ua"]},text:"Editing has been blocked in this region per request of the OSM Ukrainian community.",url:"https://wiki.openstreetmap.org/wiki/Russian%E2%80%93Ukrainian_war"}];let i=this._blocks.map(s=>{this._resolveLocationSet(s);let n=this._resolved.get(s.locationSetID);return Object.assign(n.properties,s),n});this._wpblocks=(0,vT.default)({type:"FeatureCollection",features:i});let r={locationSet:{include:["Q2"]}};this._resolveLocationSet(r),this._rebuildIndex()}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}_validateLocationSet(e){if(!e.locationSetID)try{let i=e.locationSet;if(!i)throw new Error("object missing locationSet property");i.include||(i.include=["Q2"]);let r=e1.validateLocationSet(i).id;if(e.locationSetID=r,this._knownLocationSets.has(r))return;let s=0;(i.include||[]).forEach(n=>{let o=e1.validateLocation(n).id,a=this._resolved.get(o);a||(a=e1.resolveLocation(n).feature,this._resolved.set(o,a)),s+=a.properties.area;let l=this._locationIncludedIn.get(o);l||(l=new Set,this._locationIncludedIn.set(o,l)),l.add(r)}),(i.exclude||[]).forEach(n=>{let o=e1.validateLocation(n).id,a=this._resolved.get(o);a||(a=e1.resolveLocation(n).feature,this._resolved.set(o,a)),s-=a.properties.area;let l=this._locationExcludedIn.get(o);l||(l=new Set,this._locationExcludedIn.set(o,l)),l.add(r)}),this._knownLocationSets.set(r,s)}catch(i){e.locationSet={include:["Q2"]},e.locationSetID="+[Q2]"}}_resolveLocationSet(e){if(this._validateLocationSet(e),!this._resolved.has(e.locationSetID))try{let i=e1.resolveLocationSet(e.locationSet),r=i.id;if(e.locationSetID=r,!i.feature.geometry.coordinates.length||!i.feature.properties.area)throw new Error(`locationSet ${r} resolves to an empty feature.`);let s=JSON.parse(JSON.stringify(i.feature));s.id=r,s.properties.id=r,this._resolved.set(r,s)}catch(i){e.locationSet={include:["Q2"]},e.locationSetID="+[Q2]"}}_rebuildIndex(){this._wp=(0,vT.default)({features:[...this._resolved.values()]}),this.emit("locationchange")}mergeCustomGeoJSON(e){!e||e.type!=="FeatureCollection"||!Array.isArray(e.features)||e.features.forEach(i=>{i.properties=i.properties||{};let r=i.properties,s=i.id||r.id;if(!(!s||!/^\S+\.geojson$/i.test(s))){if(s=s.toLowerCase(),i.id=s,r.id=s,!r.area){let n=uL.default.geometry(i.geometry)/1e6;r.area=Number(n.toFixed(2))}e1._cache[s]=i}})}mergeLocationSets(e){return Array.isArray(e)?(e.forEach(i=>this._validateLocationSet(i)),this._rebuildIndex(),Promise.resolve(e)):Promise.reject("nothing to do")}locationSetID(e){let i;try{i=e1.validateLocationSet(e).id}catch(r){i="+[Q2]"}return i}feature(e="+[Q2]"){return this._resolved.get(e)||this._resolved.get("+[Q2]")}locationSetsAt(e){let i={},r=this._wp(e,!0)||[],s=this;return r.forEach(n=>{if(n.id[0]!=="+")return;let o=n.id,a=s._knownLocationSets.get(o);a&&(i[o]=a)}),r.forEach(n=>{if(n.id[0]==="+")return;let o=n.id;(s._locationIncludedIn.get(o)||[]).forEach(l=>{let c=s._knownLocationSets.get(l);c&&(i[l]=c)})}),r.forEach(n=>{if(n.id[0]==="+")return;let o=n.id;(s._locationExcludedIn.get(o)||[]).forEach(l=>{delete i[l]})}),i}blocksAt(e){return this._blocks.length?this._wpblocks(e,!0)||[]:[]}loco(){return e1}wpblocks(){return this._wpblocks}};var ly=class extends sn.default{constructor(e){super(),this._enabled=!1,this.renderer=e,this.context=e.context,this.pointerOverRenderer=!1,this.modifierKeys=new Set,this.coord=[0,0],this._wheelDefault=Gs().os==="mac"?"auto":"zoom",this._click=this._click.bind(this),this._keydown=this._keydown.bind(this),this._keyup=this._keyup.bind(this),this._pointercancel=this._pointercancel.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerout=this._pointerout.bind(this),this._pointerover=this._pointerover.bind(this),this._pointerup=this._pointerup.bind(this),this._wheel=this._wheel.bind(this),this.enable()}get enabled(){return this._enabled}enable(){if(this._enabled)return;this._enabled=!0,this.modifierKeys.clear(),window.addEventListener("keydown",this._keydown),window.addEventListener("keyup",this._keyup),this.renderer.supersurface.node().addEventListener("wheel",this._wheel,{passive:!1});let i=this.context.pixi.view;i.addEventListener("pointerover",this._pointerover),i.addEventListener("pointerout",this._pointerout);let r=this.context.pixi.stage;r.addEventListener("click",this._click),r.addEventListener("pointerdown",this._pointerdown),r.addEventListener("pointermove",this._pointermove),r.addEventListener("pointerup",this._pointerup),r.addEventListener("pointerupoutside",this._pointercancel),r.addEventListener("pointercancel",this._pointercancel)}disable(){if(!this._enabled)return;this._enabled=!1,this.modifierKeys.clear(),window.removeEventListener("keydown",this._keydown),window.removeEventListener("keyup",this._keyup),this.renderer.supersurface.node().removeEventListener("wheel",this._wheel);let i=this.context.pixi.view;i.removeEventListener("pointerover",this._pointerover),i.removeEventListener("pointerout",this._pointerout);let r=this.context.pixi.stage;r.removeEventListener("click",this._click),r.removeEventListener("pointerdown",this._pointerdown),r.removeEventListener("pointermove",this._pointermove),r.removeEventListener("pointerup",this._pointerup),r.removeEventListener("pointerupoutside",this._pointercancel),r.removeEventListener("pointercancel",this._pointercancel)}setCursor(e){this.renderer.stage.cursor=e,this.renderer.pixi.view.style.cursor=e}_observeModifierKeys(e){let i=this.modifierKeys,r=["Alt","Control","Meta","Shift"],s=!1;for(let n of r){let o=e.getModifierState(n),a=i.has(n);o&&!a?(i.add(n),s=!0):!o&&a&&(i.delete(n),s=!0)}s&&this.emit("modifierchange",i)}_keydown(e){this._observeModifierKeys(e),this.emit("keydown",e)}_keyup(e){this._observeModifierKeys(e),this.emit("keyup",e)}_pointerover(e){this._observeModifierKeys(e),this.pointerOverRenderer=!0,this.emit("pointerover",e)}_pointerout(e){this._observeModifierKeys(e),this.pointerOverRenderer=!1,this.emit("pointerout",e)}_pointerdown(e){this._observeModifierKeys(e),this.coord=[e.global.x,e.global.y],this.emit("pointerdown",e)}_pointermove(e){this._observeModifierKeys(e),this.coord=[e.global.x,e.global.y],this.emit("pointermove",e)}_pointerup(e){this._observeModifierKeys(e),this.coord=[e.global.x,e.global.y],this.emit("pointerup",e)}_pointercancel(e){this.emit("pointercancel",e)}_click(e){this.emit("click",e)}_wheel(e){var l;e.preventDefault(),e.stopImmediatePropagation();let[i,r]=this._normalizeWheelDelta(e);this.coord=[e.offsetX,e.offsetY];let s=typeof r=="number"&&isFinite(r)&&Math.floor(r)===r,n=!s&&e.ctrlKey&&!this.modifierKeys.has("Control"),o="zoom",a=3;if(n)o="zoom",a=6;else if(e.shiftKey)o="zoom",a=3;else{let d=(l=this.context.systems.storage.getItem("prefs.mouse_wheel.interaction"))!=null?l:this._wheelDefault;d==="pan"||d==="auto"&&(i||s)?(o="pan",a=1):(o="zoom",a=3)}e._gesture=o,e._normalizedDeltaX=i*a,e._normalizedDeltaY=r*a,this.emit("wheel",e)}_normalizeWheelDelta(e){let[i,r]=[e.deltaX,e.deltaY];r===0&&e.shiftKey&&([i,r]=[e.deltaY,e.deltaX]);let[s,n]=[Math.sign(i),Math.sign(r)],[o,a]=[Math.abs(i),Math.abs(r)],l=typeof a=="number"&&isFinite(o)&&Math.floor(o)===o,c=typeof a=="number"&&isFinite(a)&&Math.floor(a)===a,d=l?0:.001,m=c?0:.001;if(e.deltaMode!==WheelEvent.DOM_DELTA_PIXEL){let E;e.deltaMode===WheelEvent.DOM_DELTA_LINE?E=8:e.deltaMode===WheelEvent.DOM_DELTA_PAGE?E=24:E=1,o*=E,a*=E}let g=40,_=s*(Math.min(g,o)+d),v=n*(Math.min(g,a)+m);return[_,v]}};var tq=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,iq=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform float gamma;
uniform float contrast;
uniform float saturation;
uniform float brightness;
uniform float red;
uniform float green;
uniform float blue;
uniform float alpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (c.a > 0.0) {
        c.rgb /= c.a;

        vec3 rgb = pow(c.rgb, vec3(1. / gamma));
        rgb = mix(vec3(.5), mix(vec3(dot(vec3(.2125, .7154, .0721), rgb)), rgb, saturation), contrast);
        rgb.r *= red;
        rgb.g *= green;
        rgb.b *= blue;
        c.rgb = rgb * brightness;

        c.rgb *= c.a;
    }

    gl_FragColor = c * alpha;
}
`,cy=class extends Wt{constructor(e){super(tq,iq),this.gamma=1,this.saturation=1,this.contrast=1,this.brightness=1,this.red=1,this.green=1,this.blue=1,this.alpha=1,Object.assign(this,e)}apply(e,i,r,s){this.uniforms.gamma=Math.max(this.gamma,1e-4),this.uniforms.saturation=this.saturation,this.uniforms.contrast=this.contrast,this.uniforms.brightness=this.brightness,this.uniforms.red=this.red,this.uniforms.green=this.green,this.uniforms.blue=this.blue,this.uniforms.alpha=this.alpha,e.applyFilter(this,i,r,s)}};var rq=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,sq=`
varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec2 uOffset;

void main(void)
{
    vec4 color = vec4(0.0);

    // Sample top left pixel
    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y));

    // Sample top right pixel
    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y));

    // Sample bottom right pixel
    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y));

    // Sample bottom left pixel
    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y));

    // Average
    color *= 0.25;

    gl_FragColor = color;
}`,nq=`
varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec2 uOffset;
uniform vec4 filterClamp;

void main(void)
{
    vec4 color = vec4(0.0);

    // Sample top left pixel
    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));

    // Sample top right pixel
    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));

    // Sample bottom right pixel
    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));

    // Sample bottom left pixel
    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));

    // Average
    color *= 0.25;

    gl_FragColor = color;
}
`,mh=class extends Wt{constructor(e=4,i=3,r=!1){super(rq,r?nq:sq),this._kernels=[],this._blur=4,this._quality=3,this.uniforms.uOffset=new Float32Array(2),this._pixelSize=new ei,this.pixelSize=1,this._clamp=r,Array.isArray(e)?this.kernels=e:(this._blur=e,this.quality=i)}apply(e,i,r,s){let n=this._pixelSize.x/i._frame.width,o=this._pixelSize.y/i._frame.height,a;if(this._quality===1||this._blur===0)a=this._kernels[0]+.5,this.uniforms.uOffset[0]=a*n,this.uniforms.uOffset[1]=a*o,e.applyFilter(this,i,r,s);else{let l=e.getFilterTexture(),c=i,d=l,m,g=this._quality-1;for(let _=0;_<g;_++)a=this._kernels[_]+.5,this.uniforms.uOffset[0]=a*n,this.uniforms.uOffset[1]=a*o,e.applyFilter(this,c,d,1),m=c,c=d,d=m;a=this._kernels[g]+.5,this.uniforms.uOffset[0]=a*n,this.uniforms.uOffset[1]=a*o,e.applyFilter(this,c,r,s),e.returnFilterTexture(l)}}_updatePadding(){this.padding=Math.ceil(this._kernels.reduce((e,i)=>e+i+.5,0))}_generateKernels(){let e=this._blur,i=this._quality,r=[e];if(e>0){let s=e,n=e/i;for(let o=1;o<i;o++)s-=n,r.push(s)}this._kernels=r,this._updatePadding()}get kernels(){return this._kernels}set kernels(e){Array.isArray(e)&&e.length>0?(this._kernels=e,this._quality=e.length,this._blur=Math.max(...e)):(this._kernels=[0],this._quality=1)}get clamp(){return this._clamp}set pixelSize(e){typeof e=="number"?(this._pixelSize.x=e,this._pixelSize.y=e):Array.isArray(e)?(this._pixelSize.x=e[0],this._pixelSize.y=e[1]):e instanceof ei?(this._pixelSize.x=e.x,this._pixelSize.y=e.y):(this._pixelSize.x=1,this._pixelSize.y=1)}get pixelSize(){return this._pixelSize}get quality(){return this._quality}set quality(e){this._quality=Math.max(1,Math.round(e)),this._generateKernels()}get blur(){return this._blur}set blur(e){this._blur=e,this._generateKernels()}};var hL=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,oq=`
uniform sampler2D uSampler;
varying vec2 vTextureCoord;

uniform float threshold;

void main() {
    vec4 color = texture2D(uSampler, vTextureCoord);

    // A simple & fast algorithm for getting brightness.
    // It's inaccuracy , but good enought for this feature.
    float _max = max(max(color.r, color.g), color.b);
    float _min = min(min(color.r, color.g), color.b);
    float brightness = (_max + _min) * 0.5;

    if(brightness > threshold) {
        gl_FragColor = color;
    } else {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
    }
}
`,bT=class extends Wt{constructor(e=.5){super(hL,oq),this.threshold=e}get threshold(){return this.uniforms.threshold}set threshold(e){this.uniforms.threshold=e}},aq=`uniform sampler2D uSampler;
varying vec2 vTextureCoord;

uniform sampler2D bloomTexture;
uniform float bloomScale;
uniform float brightness;

void main() {
    vec4 color = texture2D(uSampler, vTextureCoord);
    color.rgb *= brightness;
    vec4 bloomColor = vec4(texture2D(bloomTexture, vTextureCoord).rgb, 0.0);
    bloomColor.rgb *= bloomScale;
    gl_FragColor = color + bloomColor;
}
`,dL=class extends Wt{constructor(t){super(hL,aq),this.bloomScale=1,this.brightness=1,this._resolution=ht.FILTER_RESOLUTION,typeof t=="number"&&(t={threshold:t});let e=Object.assign(dL.defaults,t);this.bloomScale=e.bloomScale,this.brightness=e.brightness;let{kernels:i,blur:r,quality:s,pixelSize:n,resolution:o}=e;this._extractFilter=new bT(e.threshold),this._extractFilter.resolution=o,this._blurFilter=i?new mh(i):new mh(r,s),this.pixelSize=n,this.resolution=o}apply(t,e,i,r,s){let n=t.getFilterTexture();this._extractFilter.apply(t,e,n,1,s);let o=t.getFilterTexture();this._blurFilter.apply(t,n,o,1),this.uniforms.bloomScale=this.bloomScale,this.uniforms.brightness=this.brightness,this.uniforms.bloomTexture=o,t.applyFilter(this,e,i,r),t.returnFilterTexture(o),t.returnFilterTexture(n)}get resolution(){return this._resolution}set resolution(t){this._resolution=t,this._extractFilter&&(this._extractFilter.resolution=t),this._blurFilter&&(this._blurFilter.resolution=t)}get threshold(){return this._extractFilter.threshold}set threshold(t){this._extractFilter.threshold=t}get kernels(){return this._blurFilter.kernels}set kernels(t){this._blurFilter.kernels=t}get blur(){return this._blurFilter.blur}set blur(t){this._blurFilter.blur=t}get quality(){return this._blurFilter.quality}set quality(t){this._blurFilter.quality=t}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(t){this._blurFilter.pixelSize=t}},lq=dL;lq.defaults={threshold:.5,bloomScale:1,brightness:1,kernels:null,blur:8,quality:4,pixelSize:1,resolution:ht.FILTER_RESOLUTION};var Ka=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(Ka||{}),wT=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS",t))(wT||{}),uy=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(uy||{}),Wi=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(Wi||{}),i4=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(i4||{}),ni=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(ni||{}),t1=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(t1||{}),_r=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(_r||{}),hy=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(hy||{}),Ml=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(Ml||{}),Lm=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(Lm||{}),hc=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(hc||{}),Ea=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(Ea||{}),gh=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(gh||{}),dy=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(dy||{}),ra=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(ra||{}),In=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(In||{});var Qr=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(Qr||{}),Ta=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(Ta||{});var ET={createCanvas:(t,e)=>{let i=document.createElement("canvas");return i.width=t,i.height=e,i},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>{var t;return(t=document.baseURI)!=null?t:window.location.href},getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>new DOMParser().parseFromString(t,"text/xml")};var Di={ADAPTER:ET,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var fL,cq=(fL=X1.default)!=null?fL:X1,dc=cq(globalThis.navigator);Di.RETINA_PREFIX=/@([0-9\.]+)x/;Di.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var $d=Yi(vw(),1),mq=Yi(Sw(),1);var r4=Yi(kw(),1),TT={parse:r4.parse,format:r4.format,resolve:r4.resolve};var pL={};function Tr(t,e,i=3){if(pL[e])return;let r=new Error().stack;typeof r=="undefined"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${t}`):(r=r.split(`
`).splice(i).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${t}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${t}`),console.warn(r))),pL[e]=!0}var ST;function AT(){return typeof ST=="undefined"&&(ST=function(){var i;let e={stencil:!0,failIfMajorPerformanceCaveat:Di.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Di.ADAPTER.getWebGLRenderingContext())return!1;let r=Di.ADAPTER.createCanvas(),s=r.getContext("webgl",e)||r.getContext("experimental-webgl",e),n=!!((i=s==null?void 0:s.getContextAttributes())!=null&&i.stencil);if(s){let o=s.getExtension("WEBGL_lose_context");o&&o.loseContext()}return s=null,n}catch(r){return!1}}()),ST}Xf([Wf]);var s4=class{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof s4)this._value=t._value,this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");this._value!==t&&(this.normalize(t),this._value=t)}}get value(){return this._value}toRgba(){let[t,e,i,r]=this._components;return{r:t,g:e,b:i,a:r}}toRgb(){let[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){let[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){let[e,i,r]=this._components;return t=t!=null?t:[],t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(r*255),t}toRgbArray(t){t=t!=null?t:[];let[e,i,r]=this._components;return t[0]=e,t[1]=i,t[2]=r,t}toNumber(){return this._int}toLittleEndianNumber(){let t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){let[e,i,r,s]=s4.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=r,this._components[3]*=s,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t){if(t===1)return(t*255<<24)+this._int;if(t===0)return 0;let e=this._int>>16&255,i=this._int>>8&255,r=this._int&255;return e=e*t+.5|0,i=i*t+.5|0,r=r*t+.5|0,(t*255<<24)+(e<<16)+(i<<8)+r}toHex(){let t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){let e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(t){return this._components[3]=t,this}round(t){let[e,i,r]=this._components;return this._components.set([Math.min(255,e/t*t),Math.min(255,i/t*t),Math.min(255,r/t*t)]),this.refreshInt(),this._value=null,this}toArray(t){t=t!=null?t:[];let[e,i,r,s]=this._components;return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}normalize(t){let e;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){let i=t;e=[(i>>16&255)/255,(i>>8&255)/255,(i&255)/255,1]}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4&&t.every(i=>i<=1&&i>=0)){let[i,r,s,n=1]=t;e=[i,r,s,n]}else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4){let[i,r,s,n=255]=t;e=[i/255,r/255,s/255,n/255]}else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){let r=s4.HEX_PATTERN.exec(t);r&&(t=`#${r[2]}`)}let i=qo(t);if(i.isValid()){let{r,g:s,b:n,a:o}=i.rgba;e=[r/255,s/255,n/255,o]}}if(e)this._components.set(e),this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){let[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}},Sa=s4;Sa.shared=new s4;Sa.temp=new s4;Sa.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;function uq(){let t=[],e=[];for(let r=0;r<32;r++)t[r]=r,e[r]=r;t[Wi.NORMAL_NPM]=Wi.NORMAL,t[Wi.ADD_NPM]=Wi.ADD,t[Wi.SCREEN_NPM]=Wi.SCREEN,e[Wi.NORMAL]=Wi.NORMAL_NPM,e[Wi.ADD]=Wi.ADD_NPM,e[Wi.SCREEN]=Wi.SCREEN_NPM;let i=[];return i.push(e),i.push(t),i}var CT=uq();function n4(t){if(t.BYTES_PER_ELEMENT===4)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(t.BYTES_PER_ELEMENT===2){if(t instanceof Uint16Array)return"Uint16Array"}else if(t.BYTES_PER_ELEMENT===1&&t instanceof Uint8Array)return"Uint8Array";return null}function Gd(t){return t+=t===0?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t+1}function fy(t){return!(t&t-1)&&!!t}function py(t){let e=(t>65535?1:0)<<4;t>>>=e;let i=(t>255?1:0)<<3;return t>>>=i,e|=i,i=(t>15?1:0)<<2,t>>>=i,e|=i,i=(t>3?1:0)<<1,t>>>=i,e|=i,e|t>>1}function IT(t,e,i){let r=t.length,s;if(e>=r||i===0)return;i=e+i>r?r-e:i;let n=r-i;for(s=e;s<n;++s)t[s]=t[s+i];t.length=n}var hq=0;function i1(){return++hq}var mL=class{constructor(t,e,i,r){this.left=t,this.top=e,this.right=i,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}},kT=mL;kT.EMPTY=new mL(0,0,0,0);var my={},Ja=Object.create(null),Zc=Object.create(null);var gy;function MT(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location,gy||(gy=document.createElement("a")),gy.href=t;let i=TT.parse(gy.href),r=!i.port&&e.port===""||i.port===e.port;return i.hostname!==e.hostname||!r||i.protocol!==e.protocol?"anonymous":""}function yy(t,e=1){var r;let i=(r=Di.RETINA_PREFIX)==null?void 0:r.exec(t);return i?parseFloat(i[1]):e}var bi=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(bi||{}),PT=t=>{if(typeof t=="function"||typeof t=="object"&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");let e=typeof t.extension!="object"?{type:t.extension}:t.extension;t=Tn(di({},e),{ref:t})}if(typeof t=="object")t=di({},t);else throw new Error("Invalid extension type");return typeof t.type=="string"&&(t.type=[t.type]),t},gL=(t,e)=>{var i;return(i=PT(t).priority)!=null?i:e},Ni={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(PT).forEach(e=>{e.type.forEach(i=>{var r,s;return(s=(r=this._removeHandlers)[i])==null?void 0:s.call(r,e)})}),this},add(...t){return t.map(PT).forEach(e=>{e.type.forEach(i=>{let r=this._addHandlers,s=this._queue;r[i]?r[i](e):(s[i]=s[i]||[],s[i].push(e))})}),this},handle(t,e,i){let r=this._addHandlers,s=this._removeHandlers;if(r[t]||s[t])throw new Error(`Extension type ${t} already has a handler`);r[t]=e,s[t]=i;let n=this._queue;return n[t]&&(n[t].forEach(o=>e(o)),delete n[t]),this},handleByMap(t,e){return this.handle(t,i=>{e[i.name]=i.ref},i=>{delete e[i.name]})},handleByList(t,e,i=-1){return this.handle(t,r=>{e.includes(r.ref)||(e.push(r.ref),e.sort((s,n)=>gL(n,i)-gL(s,i)))},r=>{let s=e.indexOf(r.ref);s!==-1&&e.splice(s,1)})}};var Nm=class{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}};var gq=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function yq(t){let e="";for(let i=0;i<t;++i)i>0&&(e+=`
else `),i<t-1&&(e+=`if(test == ${i}.0){}`);return e}function _y(t,e){if(t===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");let i=e.createShader(e.FRAGMENT_SHADER);for(;;){let r=gq.replace(/%forloop%/gi,yq(t));if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))t=t/2|0;else break}return t}var RT=0,DT=1,FT=2,LT=3,NT=4,OT=5,r1=class t{constructor(){this.data=0,this.blendMode=Wi.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<RT)}set blend(e){!!(this.data&1<<RT)!==e&&(this.data^=1<<RT)}get offsets(){return!!(this.data&1<<DT)}set offsets(e){!!(this.data&1<<DT)!==e&&(this.data^=1<<DT)}get culling(){return!!(this.data&1<<FT)}set culling(e){!!(this.data&1<<FT)!==e&&(this.data^=1<<FT)}get depthTest(){return!!(this.data&1<<LT)}set depthTest(e){!!(this.data&1<<LT)!==e&&(this.data^=1<<LT)}get depthMask(){return!!(this.data&1<<OT)}set depthMask(e){!!(this.data&1<<OT)!==e&&(this.data^=1<<OT)}get clockwiseFrontFace(){return!!(this.data&1<<NT)}set clockwiseFrontFace(e){!!(this.data&1<<NT)!==e&&(this.data^=1<<NT)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==Wi.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){let e=new t;return e.depthTest=!1,e.blend=!0,e}};var o4=[];function a4(t,e){if(!t)return null;let i="";if(typeof t=="string"){let r=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);r&&(i=r[1].toLowerCase())}for(let r=o4.length-1;r>=0;--r){let s=o4[r];if(s.test&&s.test(t,i))return new s(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}var yn=class{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,i,r,s,n,o,a,l){if(arguments.length>8)throw new Error("max arguments reached");let{name:c,items:d}=this;this._aliasCount++;for(let m=0,g=d.length;m<g;m++)d[m][c](e,i,r,s,n,o,a,l);return d===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){let i=this.items.indexOf(e);return i!==-1&&(this.ensureNonAliasedItems(),this.items.splice(i,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}};Object.defineProperties(yn.prototype,{dispatch:{value:yn.prototype.emit},run:{value:yn.prototype.emit}});var el=class{constructor(e=0,i=0){this._width=e,this._height=i,this.destroyed=!1,this.internal=!1,this.onResize=new yn("setRealSize"),this.onUpdate=new yn("update"),this.onError=new yn("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,i){(e!==this._width||i!==this._height)&&(this._width=e,this._height=i,this.onResize.emit(e,i))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,i,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,i){return!1}};var Qc=class extends el{constructor(e,i){let{width:r,height:s}=i||{};if(!r||!s)throw new Error("BufferResource width or height invalid");super(r,s),this.data=e}upload(e,i,r){let s=e.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===Ea.UNPACK);let n=i.realWidth,o=i.realHeight;return r.width===n&&r.height===o?s.texSubImage2D(i.target,0,0,0,n,o,i.format,r.type,this.data):(r.width=n,r.height=o,s.texImage2D(i.target,0,r.internalFormat,n,o,0,i.format,r.type,this.data)),!0}dispose(){this.data=null}static test(e){return e instanceof Float32Array||e instanceof Uint8Array||e instanceof Uint32Array}};var _q={scaleMode:Ml.NEAREST,format:ni.RGBA,alphaMode:Ea.NPM},l4=class extends $d.default{constructor(t=null,e=null){super(),e=Object.assign({},l4.defaultOptions,e);let{alphaMode:i,mipmap:r,anisotropicLevel:s,scaleMode:n,width:o,height:a,wrapMode:l,format:c,type:d,target:m,resolution:g,resourceOptions:_}=e;t&&!(t instanceof el)&&(t=a4(t,_),t.internal=!0),this.resolution=g||Di.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=s,this._wrapMode=l,this._scaleMode=n,this.format=c,this.type=d,this.target=m,this.alphaMode=i,this.uid=i1(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=fy(this.realWidth)&&fy(this.realHeight)}setResolution(t){let e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Zc[this.cacheId],delete Ja[this.cacheId],this.cacheId=null),this.dispose(),l4.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,i=Di.STRICT_TEXTURE_CACHE){let r=typeof t=="string",s=null;if(r)s=t;else{if(!t._pixiId){let o=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${o}_${i1()}`}s=t._pixiId}let n=Zc[s];if(r&&i&&!n)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return n||(n=new l4(t,e),n.cacheId=s,l4.addToCache(n,s)),n}static fromBuffer(t,e,i,r){t=t||new Float32Array(e*i*4);let s=new Qc(t,{width:e,height:i}),n=t instanceof Float32Array?_r.FLOAT:_r.UNSIGNED_BYTE;return new l4(s,Object.assign({},_q,r||{width:e,height:i,type:n}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Zc[e]&&Zc[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Zc[e]=t)}static removeFromCache(t){if(typeof t=="string"){let e=Zc[t];if(e){let i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Zc[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Zc[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}},br=l4;br.defaultOptions={mipmap:hc.POW2,anisotropicLevel:0,scaleMode:Ml.LINEAR,wrapMode:Lm.CLAMP,alphaMode:Ea.UNPACK,target:t1.TEXTURE_2D,format:ni.RGBA,type:_r.UNSIGNED_BYTE};br._globalBatch=0;var Om=class{constructor(){this.texArray=null,this.blend=0,this.type=i4.TRIANGLES,this.start=0,this.size=0,this.data=null}};var xq=0,kn=class t{constructor(e,i=!0,r=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=i,this.id=xq++,this.disposeRunner=new yn("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?Ta.ELEMENT_ARRAY_BUFFER:Ta.ARRAY_BUFFER}get index(){return this.type===Ta.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new t(e)}};var c4=class t{constructor(e,i=0,r=!1,s=_r.FLOAT,n,o,a,l=1){this.buffer=e,this.size=i,this.normalized=r,this.type=s,this.stride=n,this.start=o,this.instance=a,this.divisor=l}destroy(){this.buffer=null}static from(e,i,r,s,n){return new t(e,i,r,s,n)}};var vq={Float32Array,Uint32Array,Int32Array,Uint8Array};function yL(t,e){let i=0,r=0,s={};for(let l=0;l<t.length;l++)r+=e[l],i+=t[l].length;let n=new ArrayBuffer(i*4),o=null,a=0;for(let l=0;l<t.length;l++){let c=e[l],d=t[l],m=n4(d);s[m]||(s[m]=new vq[m](n)),o=s[m];for(let g=0;g<d.length;g++){let _=(g/c|0)*r+a,v=g%c;o[_+v]=d[g]}a+=c}return new Float32Array(n)}var _L={5126:4,5123:2,5121:1},bq=0,wq={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},s1=class t{constructor(e=[],i={}){this.buffers=e,this.indexBuffer=null,this.attributes=i,this.glVertexArrayObjects={},this.id=bq++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new yn("disposeGeometry"),this.refCount=0}addAttribute(e,i,r=0,s=!1,n,o,a,l=!1){if(!i)throw new Error("You must pass a buffer when creating an attribute");i instanceof kn||(i instanceof Array&&(i=new Float32Array(i)),i=new kn(i));let c=e.split("|");if(c.length>1){for(let m=0;m<c.length;m++)this.addAttribute(c[m],i,r,s,n);return this}let d=this.buffers.indexOf(i);return d===-1&&(this.buffers.push(i),d=this.buffers.length-1),this.attributes[e]=new c4(d,r,s,n,o,a,l),this.instanced=this.instanced||l,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof kn||(e instanceof Array&&(e=new Uint16Array(e)),e=new kn(e)),e.type=Ta.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;let e=[],i=[],r=new kn,s;for(s in this.attributes){let n=this.attributes[s],o=this.buffers[n.buffer];e.push(o.data),i.push(n.size*_L[n.type]/4),n.buffer=0}for(r.data=yL(e,i),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(let e in this.attributes){let i=this.attributes[e];return this.buffers[i.buffer].data.length/(i.stride/4||i.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){let e=new t;for(let i=0;i<this.buffers.length;i++)e.buffers[i]=new kn(this.buffers[i].data.slice(0));for(let i in this.attributes){let r=this.attributes[i];e.attributes[i]=new c4(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=Ta.ELEMENT_ARRAY_BUFFER),e}static merge(e){let i=new t,r=[],s=[],n=[],o;for(let a=0;a<e.length;a++){o=e[a];for(let l=0;l<o.buffers.length;l++)s[l]=s[l]||0,s[l]+=o.buffers[l].data.length,n[l]=0}for(let a=0;a<o.buffers.length;a++)r[a]=new wq[n4(o.buffers[a].data)](s[a]),i.buffers[a]=new kn(r[a]);for(let a=0;a<e.length;a++){o=e[a];for(let l=0;l<o.buffers.length;l++)r[l].set(o.buffers[l].data,n[l]),n[l]+=o.buffers[l].data.length}if(i.attributes=o.attributes,o.indexBuffer){i.indexBuffer=i.buffers[o.buffers.indexOf(o.indexBuffer)],i.indexBuffer.type=Ta.ELEMENT_ARRAY_BUFFER;let a=0,l=0,c=0,d=0;for(let m=0;m<o.buffers.length;m++)if(o.buffers[m]!==o.indexBuffer){d=m;break}for(let m in o.attributes){let g=o.attributes[m];(g.buffer|0)===d&&(l+=g.size*_L[g.type]/4)}for(let m=0;m<e.length;m++){let g=e[m].indexBuffer.data;for(let _=0;_<g.length;_++)i.indexBuffer.data[_+c]+=a;a+=e[m].buffers[d].data.length/l,c+=g.length}}return i}};var Bm=class extends s1{constructor(e=!1){super(),this._buffer=new kn(null,e,!1),this._indexBuffer=new kn(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,_r.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,_r.FLOAT).addAttribute("aColor",this._buffer,4,!0,_r.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,_r.FLOAT).addIndex(this._indexBuffer)}};var BT=Math.PI*2,Eq=180/Math.PI,Tq=Math.PI/180,yh=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(yh||{});var Mn=class t{constructor(e=0,i=0){this.x=0,this.y=0,this.x=e,this.y=i}clone(){return new t(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,i=e){return this.x=e,this.y=i,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}};var xy=[new Mn,new Mn,new Mn,new Mn],Kr=class t{constructor(e=0,i=0,r=0,s=0){this.x=Number(e),this.y=Number(i),this.width=Number(r),this.height=Number(s),this.type=yh.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new t(0,0,0,0)}clone(){return new t(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,i){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&i>=this.y&&i<this.y+this.height}intersects(e,i){if(!i){let U=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=U)return!1;let Z=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>Z}let r=this.left,s=this.right,n=this.top,o=this.bottom;if(s<=r||o<=n)return!1;let a=xy[0].set(e.left,e.top),l=xy[1].set(e.left,e.bottom),c=xy[2].set(e.right,e.top),d=xy[3].set(e.right,e.bottom);if(c.x<=a.x||l.y<=a.y)return!1;let m=Math.sign(i.a*i.d-i.b*i.c);if(m===0||(i.apply(a,a),i.apply(l,l),i.apply(c,c),i.apply(d,d),Math.max(a.x,l.x,c.x,d.x)<=r||Math.min(a.x,l.x,c.x,d.x)>=s||Math.max(a.y,l.y,c.y,d.y)<=n||Math.min(a.y,l.y,c.y,d.y)>=o))return!1;let g=m*(l.y-a.y),_=m*(a.x-l.x),v=g*r+_*n,E=g*s+_*n,b=g*r+_*o,T=g*s+_*o;if(Math.max(v,E,b,T)<=g*a.x+_*a.y||Math.min(v,E,b,T)>=g*d.x+_*d.y)return!1;let A=m*(a.y-c.y),M=m*(c.x-a.x),k=A*r+M*n,F=A*s+M*n,O=A*r+M*o,B=A*s+M*o;return!(Math.max(k,F,O,B)<=A*a.x+M*a.y||Math.min(k,F,O,B)>=A*d.x+M*d.y)}pad(e=0,i=e){return this.x-=e,this.y-=i,this.width+=e*2,this.height+=i*2,this}fit(e){let i=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),s=Math.max(this.y,e.y),n=Math.min(this.y+this.height,e.y+e.height);return this.x=i,this.width=Math.max(r-i,0),this.y=s,this.height=Math.max(n-s,0),this}ceil(e=1,i=.001){let r=Math.ceil((this.x+this.width-i)*e)/e,s=Math.ceil((this.y+this.height-i)*e)/e;return this.x=Math.floor((this.x+i)*e)/e,this.y=Math.floor((this.y+i)*e)/e,this.width=r-this.x,this.height=s-this.y,this}enlarge(e){let i=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),s=Math.min(this.y,e.y),n=Math.max(this.y+this.height,e.y+e.height);return this.x=i,this.width=r-i,this.y=s,this.height=n-s,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}};var ps=class t{constructor(e=1,i=0,r=0,s=1,n=0,o=0){this.array=null,this.a=e,this.b=i,this.c=r,this.d=s,this.tx=n,this.ty=o}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,i,r,s,n,o){return this.a=e,this.b=i,this.c=r,this.d=s,this.tx=n,this.ty=o,this}toArray(e,i){this.array||(this.array=new Float32Array(9));let r=i||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(e,i){i=i||new Mn;let r=e.x,s=e.y;return i.x=this.a*r+this.c*s+this.tx,i.y=this.b*r+this.d*s+this.ty,i}applyInverse(e,i){i=i||new Mn;let r=1/(this.a*this.d+this.c*-this.b),s=e.x,n=e.y;return i.x=this.d*r*s+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,i.y=this.a*r*n+-this.b*r*s+(-this.ty*this.a+this.tx*this.b)*r,i}translate(e,i){return this.tx+=e,this.ty+=i,this}scale(e,i){return this.a*=e,this.d*=i,this.c*=e,this.b*=i,this.tx*=e,this.ty*=i,this}rotate(e){let i=Math.cos(e),r=Math.sin(e),s=this.a,n=this.c,o=this.tx;return this.a=s*i-this.b*r,this.b=s*r+this.b*i,this.c=n*i-this.d*r,this.d=n*r+this.d*i,this.tx=o*i-this.ty*r,this.ty=o*r+this.ty*i,this}append(e){let i=this.a,r=this.b,s=this.c,n=this.d;return this.a=e.a*i+e.b*s,this.b=e.a*r+e.b*n,this.c=e.c*i+e.d*s,this.d=e.c*r+e.d*n,this.tx=e.tx*i+e.ty*s+this.tx,this.ty=e.tx*r+e.ty*n+this.ty,this}setTransform(e,i,r,s,n,o,a,l,c){return this.a=Math.cos(a+c)*n,this.b=Math.sin(a+c)*n,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=e-(r*this.a+s*this.c),this.ty=i-(r*this.b+s*this.d),this}prepend(e){let i=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){let r=this.a,s=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=s*e.a+this.d*e.c,this.d=s*e.b+this.d*e.d}return this.tx=i*e.a+this.ty*e.c+e.tx,this.ty=i*e.b+this.ty*e.d+e.ty,this}decompose(e){let i=this.a,r=this.b,s=this.c,n=this.d,o=e.pivot,a=-Math.atan2(-s,n),l=Math.atan2(r,i),c=Math.abs(a+l);return c<1e-5||Math.abs(BT-c)<1e-5?(e.rotation=l,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=a,e.skew.y=l),e.scale.x=Math.sqrt(i*i+r*r),e.scale.y=Math.sqrt(s*s+n*n),e.position.x=this.tx+(o.x*i+o.y*s),e.position.y=this.ty+(o.x*r+o.y*n),e}invert(){let e=this.a,i=this.b,r=this.c,s=this.d,n=this.tx,o=e*s-i*r;return this.a=s/o,this.b=-i/o,this.c=-r/o,this.d=e/o,this.tx=(r*this.ty-s*n)/o,this.ty=-(e*this.ty-i*n)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){let e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new t}static get TEMP_MATRIX(){return new t}};var Hd=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Vd=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],jd=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Xd=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],UT=[],xL=[],vy=Math.sign;function Sq(){for(let t=0;t<16;t++){let e=[];UT.push(e);for(let i=0;i<16;i++){let r=vy(Hd[t]*Hd[i]+jd[t]*Vd[i]),s=vy(Vd[t]*Hd[i]+Xd[t]*Vd[i]),n=vy(Hd[t]*jd[i]+jd[t]*Xd[i]),o=vy(Vd[t]*jd[i]+Xd[t]*Xd[i]);for(let a=0;a<16;a++)if(Hd[a]===r&&Vd[a]===s&&jd[a]===n&&Xd[a]===o){e.push(a);break}}}for(let t=0;t<16;t++){let e=new ps;e.set(Hd[t],Vd[t],jd[t],Xd[t],0,0),xL.push(e)}}Sq();var Ss={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>Hd[t],uY:t=>Vd[t],vX:t=>jd[t],vY:t=>Xd[t],inv:t=>t&8?t&15:-t&7,add:(t,e)=>UT[t][e],sub:(t,e)=>UT[t][Ss.inv(e)],rotate180:t=>t^4,isVertical:t=>(t&3)===2,byDirection:(t,e)=>Math.abs(t)*2<=Math.abs(e)?e>=0?Ss.S:Ss.N:Math.abs(e)*2<=Math.abs(t)?t>0?Ss.E:Ss.W:e>0?t>0?Ss.SE:Ss.SW:t>0?Ss.NE:Ss.NW,matrixAppendRotationInv:(t,e,i=0,r=0)=>{let s=xL[Ss.inv(e)];s.tx=i,s.ty=r,t.append(s)}};var _h=class t{constructor(e,i,r=0,s=0){this._x=r,this._y=s,this.cb=e,this.scope=i}clone(e=this.cb,i=this.scope){return new t(e,i,this._x,this._y)}set(e=0,i=e){return(this._x!==e||this._y!==i)&&(this._x=e,this._y=i,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}};var vL=class{constructor(){this.worldTransform=new ps,this.localTransform=new ps,this.position=new _h(this.onChange,this,0,0),this.scale=new _h(this.onChange,this,1,1),this.pivot=new _h(this.onChange,this,0,0),this.skew=new _h(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){let t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){let e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){let i=t.worldTransform,r=this.worldTransform;r.a=e.a*i.a+e.b*i.c,r.b=e.a*i.b+e.b*i.d,r.c=e.c*i.a+e.d*i.c,r.d=e.c*i.b+e.d*i.d,r.tx=e.tx*i.a+e.ty*i.c+i.tx,r.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}},by=vL;by.IDENTITY=new vL;var bL=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`;var wL=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function wy(t,e,i){let r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}function zT(t){let e=new Array(t);for(let i=0;i<e.length;i++)e[i]=!1;return e}function Um(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return zT(2*e);case"bvec3":return zT(3*e);case"bvec4":return zT(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var Kc=[{test:t=>t.type==="float"&&t.size===1&&!t.isArray,code:t=>`
            if(uv["${t}"] !== ud["${t}"].value)
            {
                ud["${t}"].value = uv["${t}"]
                gl.uniform1f(ud["${t}"].location, uv["${t}"])
            }
            `},{test:(t,e)=>(t.type==="sampler2D"||t.type==="samplerCube"||t.type==="sampler2DArray")&&t.size===1&&!t.isArray&&(e==null||e.castToBaseTexture!==void 0),code:t=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${t}"], t);

            if(ud["${t}"].value !== t)
            {
                ud["${t}"].value = t;
                gl.uniform1i(ud["${t}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(t,e)=>t.type==="mat3"&&t.size===1&&!t.isArray&&e.a!==void 0,code:t=>`
            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));
            `,codeUbo:t=>`
                var ${t}_matrix = uv.${t}.toArray(true);

                data[offset] = ${t}_matrix[0];
                data[offset+1] = ${t}_matrix[1];
                data[offset+2] = ${t}_matrix[2];
        
                data[offset + 4] = ${t}_matrix[3];
                data[offset + 5] = ${t}_matrix[4];
                data[offset + 6] = ${t}_matrix[5];
        
                data[offset + 8] = ${t}_matrix[6];
                data[offset + 9] = ${t}_matrix[7];
                data[offset + 10] = ${t}_matrix[8];
            `},{test:(t,e)=>t.type==="vec2"&&t.size===1&&!t.isArray&&e.x!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${t}"].location, v.x, v.y);
                }`,codeUbo:t=>`
                v = uv.${t};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:t=>t.type==="vec2"&&t.size===1&&!t.isArray,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);
                }
            `},{test:(t,e)=>t.type==="vec4"&&t.size===1&&!t.isArray&&e.width!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:t=>`
                    v = uv.${t};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(t,e)=>t.type==="vec4"&&t.size===1&&!t.isArray&&e.red!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:t=>`
                    v = uv.${t};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(t,e)=>t.type==="vec3"&&t.size===1&&!t.isArray&&e.red!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)
                }`,codeUbo:t=>`
                    v = uv.${t};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:t=>t.type==="vec4"&&t.size===1&&!t.isArray,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])
                }`}];var Aq={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},Cq={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function GT(t,e){var r;let i=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(let s in t.uniforms){let n=e[s];if(!n){(r=t.uniforms[s])!=null&&r.group&&(t.uniforms[s].ubo?i.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${s}, '${s}');
                    `):i.push(`
                        renderer.shader.syncUniformGroup(uv.${s}, syncData);
                    `));continue}let o=t.uniforms[s],a=!1;for(let l=0;l<Kc.length;l++)if(Kc[l].test(n,o)){i.push(Kc[l].code(s,o)),a=!0;break}if(!a){let c=(n.size===1&&!n.isArray?Aq:Cq)[n.type].replace("location",`ud["${s}"].location`);i.push(`
            cu = ud["${s}"];
            cv = cu.value;
            v = uv["${s}"];
            ${c};`)}}return new Function("ud","uv","renderer","syncData",i.join(`
`))}var EL={},u4=EL;function Ey(){if(u4===EL||u4!=null&&u4.isContextLost()){let t=Di.ADAPTER.createCanvas(),e;Di.PREFER_ENV>=Ka.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),u4=e}return u4}var Ty;function $T(){if(!Ty){Ty=ra.MEDIUM;let t=Ey();t&&t.getShaderPrecisionFormat&&(Ty=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision?ra.HIGH:ra.MEDIUM)}return Ty}function TL(t,e){let i=t.getShaderSource(e).split(`
`).map((c,d)=>`${d}: ${c}`),r=t.getShaderInfoLog(e),s=r.split(`
`),n={},o=s.map(c=>parseFloat(c.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(c=>c&&!n[c]?(n[c]=!0,!0):!1),a=[""];o.forEach(c=>{i[c-1]=`%c${i[c-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});let l=i.join(`
`);a[0]=l,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function HT(t,e,i,r){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(i,t.COMPILE_STATUS)||TL(t,i),t.getShaderParameter(r,t.COMPILE_STATUS)||TL(t,r),console.error("PixiJS Error: Could not initialize shader."),t.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}var Iq={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function zm(t){return Iq[t]}var Sy=null,SL={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Gm(t,e){if(!Sy){let i=Object.keys(SL);Sy={};for(let r=0;r<i.length;++r){let s=i[r];Sy[t[s]]=SL[s]}}return Sy[e]}function Ay(t,e,i){if(t.substring(0,9)!=="precision"){let r=e;return e===ra.HIGH&&i!==ra.HIGH&&(r=ra.MEDIUM),`precision ${r} float;
${t}`}else if(i!==ra.HIGH&&t.substring(0,15)==="precision highp")return t.replace("precision highp","precision mediump");return t}var $m;function Cy(){if(typeof $m=="boolean")return $m;try{$m=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch(t){$m=!1}return $m}var kq=0,Iy={},h4=class{constructor(t,e,i="pixi-shader",r={}){this.extra={},this.id=kq++,this.vertexSrc=t||h4.defaultVertexSrc,this.fragmentSrc=e||h4.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=r,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),Iy[i]?(Iy[i]++,i+=`-${Iy[i]}`):Iy[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=Ay(this.vertexSrc,h4.defaultVertexPrecision,ra.HIGH),this.fragmentSrc=Ay(this.fragmentSrc,h4.defaultFragmentPrecision,$T())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return wL}static get defaultFragmentSrc(){return bL}static from(t,e,i){let r=t+e,s=my[r];return s||(my[r]=s=new h4(t,e,i)),s}},Aa=h4;Aa.defaultVertexPrecision=ra.HIGH;Aa.defaultFragmentPrecision=dc.apple.device?ra.HIGH:ra.MEDIUM;var Mq=0,tl=class t{constructor(e,i,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Mq++,this.static=!!i,this.ubo=!!r,e instanceof kn?(this.buffer=e,this.buffer.type=Ta.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new kn(new Float32Array(1)),this.buffer.type=Ta.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,i,r){if(!this.ubo)this.uniforms[e]=new t(i,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(e,i,r){return new t(e,i,r)}static uboFrom(e,i){return new t(e,i!=null?i:!0,!0)}};var Wd=class t{constructor(e,i){this.uniformBindCount=0,this.program=e,i?i instanceof tl?this.uniformGroup=i:this.uniformGroup=new tl(i):this.uniformGroup=new tl({}),this.disposeRunner=new yn("disposeShader")}checkUniformExists(e,i){if(i.uniforms[e])return!0;for(let r in i.uniforms){let s=i.uniforms[r];if(s.group&&this.checkUniformExists(e,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,i,r){let s=Aa.from(e,i);return new t(s,r)}};var Hm=class{constructor(e,i){if(this.vertexSrc=e,this.fragTemplate=i,this.programCache={},this.defaultGroupCache={},!i.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!i.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){let r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=n;this.defaultGroupCache[e]=tl.from({uSamplers:r},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${e}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new Aa(this.vertexSrc,s)}let i={tint:new Float32Array([1,1,1,1]),translationMatrix:new ps,default:this.defaultGroupCache[e]};return new Wd(this.programCache[e],i)}generateSampleSrc(e){let i="";i+=`
`,i+=`
`;for(let r=0;r<e;r++)r>0&&(i+=`
else `),r<e-1&&(i+=`if(vTextureId < ${r}.5)`),i+=`
{`,i+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,i+=`
}`;return i+=`
`,i+=`
`,i}};var Vm=class{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}};function AL(){return!dc.apple.device}function CL(t){let e=!0,i=Di.ADAPTER.getNavigator();if(dc.tablet||dc.phone){if(dc.apple.device){let r=i.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(e=!1)}if(dc.android.device){let r=i.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(e=!1)}}return e?t:4}var qd=class{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}};var IL=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`;var kL=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;var fc=class extends qd{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=Bm,this.vertexSize=6,this.state=r1.for2d(),this.size=fc.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){var t;return this._defaultMaxTextures=(t=this._defaultMaxTextures)!=null?t:CL(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){var t;return this._canUploadSameBuffer=(t=this._canUploadSameBuffer)!=null?t:AL(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return Tr("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return kL}static get defaultFragmentTemplate(){return IL}setShaderGenerator({vertex:t=fc.defaultVertexSrc,fragment:e=fc.defaultFragmentTemplate}={}){this.shaderGenerator=new Hm(t,e)}contextChange(){let t=this.renderer.gl;Di.PREFER_ENV===Ka.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),fc.defaultMaxTextures),this.maxTextures=_y(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){let{_drawCallPool:t,_textureArrayPool:e}=fc,i=this.size/4,r=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new Om);for(;e.length<r;)e.push(new Vm);for(let s=0;s<this.maxTextures;s++)this._tempBoundTextures[s]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){let{_bufferedTextures:t,maxTextures:e}=this,i=fc._textureArrayPool,r=this.renderer.batch,s=this._tempBoundTextures,n=this.renderer.textureGC.count,o=++br._globalBatch,a=0,l=i[0],c=0;r.copyBoundTextures(s,e);for(let d=0;d<this._bufferSize;++d){let m=t[d];t[d]=null,m._batchEnabled!==o&&(l.count>=e&&(r.boundArray(l,s,o,e),this.buildDrawCalls(l,c,d),c=d,l=i[++a],++o),m._batchEnabled=o,m.touched=n,l.elements[l.count++]=m)}l.count>0&&(r.boundArray(l,s,o,e),this.buildDrawCalls(l,c,this._bufferSize),++a,++o);for(let d=0;d<s.length;d++)s[d]=null;br._globalBatch=o}buildDrawCalls(t,e,i){let{_bufferedElements:r,_attributeBuffer:s,_indexBuffer:n,vertexSize:o}=this,a=fc._drawCallPool,l=this._dcIndex,c=this._aIndex,d=this._iIndex,m=a[l];m.start=this._iIndex,m.texArray=t;for(let g=e;g<i;++g){let _=r[g],v=_._texture.baseTexture,E=CT[v.alphaMode?1:0][_.blendMode];r[g]=null,e<g&&m.blend!==E&&(m.size=d-m.start,e=g,m=a[++l],m.texArray=t,m.start=d),this.packInterleavedGeometry(_,s,n,c,d),c+=_.vertexData.length/2*o,d+=_.indices.length,m.blend=E}e<i&&(m.size=d-m.start,++l),this._dcIndex=l,this._aIndex=c,this._iIndex=d}bindAndClearTexArray(t){let e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){let{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:i}=this;fc.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){let t=this._dcIndex,{gl:e,state:i}=this.renderer,r=fc._drawCallPool,s=null;for(let n=0;n<t;n++){let{texArray:o,type:a,size:l,start:c,blend:d}=r[n];s!==o&&(s=o,this.bindAndClearTexArray(o)),this.state.blendMode=d,i.set(this.state),e.drawElements(a,l,e.UNSIGNED_SHORT,c*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),fc.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){let e=Gd(Math.ceil(t/8)),i=py(e),r=e*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._aBuffers[r];return s||(this._aBuffers[r]=s=new Nm(r*this.vertexSize*4)),s}getIndexBuffer(t){let e=Gd(Math.ceil(t/12)),i=py(e),r=e*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._iBuffers[i];return s||(this._iBuffers[i]=s=new Uint16Array(r)),s}packInterleavedGeometry(t,e,i,r,s){let{uint32View:n,float32View:o}=e,a=r/this.vertexSize,l=t.uvs,c=t.indices,d=t.vertexData,m=t._texture.baseTexture._batchLocation,g=Math.min(t.worldAlpha,1),_=Sa.shared.setValue(t._tintRGB).toPremultiplied(g);for(let v=0;v<d.length;v+=2)o[r++]=d[v],o[r++]=d[v+1],o[r++]=l[v],o[r++]=l[v+1],n[r++]=_,o[r++]=m;for(let v=0;v<c.length;v++)i[s++]=a+c[v]}},il=fc;il.defaultBatchSize=4096;il.extension={name:"batch",type:bi.RendererPlugin};il._drawCallPool=[];il._textureArrayPool=[];Ni.add(il);var ML=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`;var PL=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var jm=class extends Wd{constructor(t,e,i){let r=Aa.from(t||jm.defaultVertexSrc,e||jm.defaultFragmentSrc);super(r,i),this.padding=0,this.resolution=jm.defaultResolution,this.multisample=jm.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new r1}apply(t,e,i,r,s){t.applyFilter(this,e,i,r)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return PL}static get defaultFragmentSrc(){return ML}},rl=jm;rl.defaultResolution=1;rl.defaultMultisample=Qr.NONE;var n1=class{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Sa(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;let{backgroundColor:i,background:r,backgroundAlpha:s}=e,n=r!=null?r:i;n!==void 0&&(this.color=n),this.alpha=s}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}};n1.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};n1.extension={type:[bi.RendererSystem,bi.CanvasRendererSystem],name:"background"};Ni.add(n1);var d4=class{constructor(e){this.renderer=e,this.emptyRenderer=new qd(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,i){let{boundTextures:r}=this.renderer.texture;for(let s=i-1;s>=0;--s)e[s]=r[s]||null,e[s]&&(e[s]._batchLocation=s)}boundArray(e,i,r,s){let{elements:n,ids:o,count:a}=e,l=0;for(let c=0;c<a;c++){let d=n[c],m=d._batchLocation;if(m>=0&&m<s&&i[m]===d){o[c]=m;continue}for(;l<s;){let g=i[l];if(g&&g._batchEnabled===r&&g._batchLocation===l){l++;continue}o[c]=l,d._batchLocation=l,i[l]=d;break}}}destroy(){this.renderer=null}};d4.extension={type:bi.RendererSystem,name:"batch"};Ni.add(d4);var RL=0,o1=class{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=RL++}init(e){if(e.context)this.initFromContext(e.context);else{let i=this.renderer.background.alpha<1,r=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:i,premultipliedAlpha:r,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=RL++,this.renderer.runners.contextChange.emit(e);let i=this.renderer.view;i.addEventListener!==void 0&&(i.addEventListener("webglcontextlost",this.handleContextLost,!1),i.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){let i=this.createContext(this.renderer.view,e);this.initFromContext(i)}createContext(e,i){let r;if(Di.PREFER_ENV>=Ka.WEBGL2&&(r=e.getContext("webgl2",i)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=e.getContext("webgl",i)||e.getContext("experimental-webgl",i),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){let{gl:e}=this,i={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,i,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,i,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){let e=this.renderer.view;this.renderer=null,e.removeEventListener!==void 0&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){let i=e.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),i&&!i.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");let s=r||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}};o1.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"};o1.extension={type:bi.RendererSystem,name:"context"};Ni.add(o1);var ky=class extends Qc{upload(e,i,r){let s=e.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===Ea.UNPACK);let n=i.realWidth,o=i.realHeight;return r.width===n&&r.height===o?s.texSubImage2D(i.target,0,0,0,n,o,i.format,r.type,this.data):(r.width=n,r.height=o,s.texImage2D(i.target,0,r.internalFormat,n,o,0,i.format,r.type,this.data)),!0}};var xh=class{constructor(e,i){this.width=Math.round(e||100),this.height=Math.round(i||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new yn("disposeFramebuffer"),this.multisample=Qr.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,i){return this.colorTextures[e]=i||new br(null,{scaleMode:Ml.NEAREST,resolution:1,mipmap:hc.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new br(new ky(null,{width:this.width,height:this.height}),{scaleMode:Ml.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:hc.OFF,format:ni.DEPTH_COMPONENT,type:_r.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,i){if(e=Math.round(e),i=Math.round(i),!(e===this.width&&i===this.height)){this.width=e,this.height=i,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){let s=this.colorTextures[r],n=s.resolution;s.setSize(e/n,i/n)}if(this.depthTexture){let r=this.depthTexture.resolution;this.depthTexture.setSize(e/r,i/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}};var Yd=class extends br{constructor(e={}){var i;if(typeof e=="number"){let r=arguments[0],s=arguments[1],n=arguments[2],o=arguments[3];e={width:r,height:s,scaleMode:n,resolution:o}}e.width=e.width||100,e.height=e.height||100,(i=e.multisample)!=null||(e.multisample=Qr.NONE),super(null,e),this.mipmap=hc.OFF,this.valid=!0,this._clear=new Sa([0,0,0,0]),this.framebuffer=new xh(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(e,i){this.framebuffer.resize(e*this.resolution,i*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}};var ao=class extends el{constructor(e){let i=e,r=i.naturalWidth||i.videoWidth||i.width,s=i.naturalHeight||i.videoHeight||i.height;super(r,s),this.source=e,this.noSubImage=!1}static crossOrigin(e,i,r){r===void 0&&!i.startsWith("data:")?e.crossOrigin=MT(i):r!==!1&&(e.crossOrigin=typeof r=="string"?r:"anonymous")}upload(e,i,r,s){let n=e.gl,o=i.realWidth,a=i.realHeight;if(s=s||this.source,typeof HTMLImageElement!="undefined"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement!="undefined"&&s instanceof HTMLVideoElement&&s.readyState<=1&&s.buffered.length===0)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===Ea.UNPACK),!this.noSubImage&&i.target===n.TEXTURE_2D&&r.width===o&&r.height===a?n.texSubImage2D(n.TEXTURE_2D,0,0,0,i.format,r.type,s):(r.width=o,r.height=a,n.texImage2D(i.target,0,r.internalFormat,i.format,r.type,s)),!0}update(){if(this.destroyed)return;let e=this.source,i=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;this.resize(i,r),super.update()}dispose(){this.source=null}};var vh=class extends ao{constructor(e,i){var r;if(i=i||{},typeof e=="string"){let s=new Image;ao.crossOrigin(s,e,i.crossorigin),s.src=e,e=s}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=((r=i.createBitmap)!=null?r:Di.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,this.bitmap=null,this._load=null,i.autoLoad!==!1&&this.load()}load(e){return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise((i,r)=>{let s=this.source;this.url=s.src;let n=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.resize(s.width,s.height),this._load=null,this.createBitmap?i(this.process()):i(this))};s.complete&&s.src?n():(s.onload=n,s.onerror=o=>{r(o),this.onError.emit(o)})}),this._load)}process(){let e=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);let i=globalThis.createImageBitmap,r=!e.crossOrigin||e.crossOrigin==="anonymous";return this._process=fetch(e.src,{mode:r?"cors":"no-cors"}).then(s=>s.blob()).then(s=>i(s,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ea.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,i,r){if(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,i,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,i,r,this.bitmap),!this.preserveBitmap){let s=!0,n=i._glTextures;for(let o in n){let a=n[o];if(a!==r&&a.dirtyId!==i.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement!="undefined"&&(typeof e=="string"||e instanceof HTMLImageElement)}};var f4=class{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,i,r){let s=i.width,n=i.height;if(r){let o=e.width/2/s,a=e.height/2/n,l=e.x/s+o,c=e.y/n+a;r=Ss.add(r,Ss.NW),this.x0=l+o*Ss.uX(r),this.y0=c+a*Ss.uY(r),r=Ss.add(r,2),this.x1=l+o*Ss.uX(r),this.y1=c+a*Ss.uY(r),r=Ss.add(r,2),this.x2=l+o*Ss.uX(r),this.y2=c+a*Ss.uY(r),r=Ss.add(r,2),this.x3=l+o*Ss.uX(r),this.y3=c+a*Ss.uY(r)}else this.x0=e.x/s,this.y0=e.y/n,this.x1=(e.x+e.width)/s,this.y1=e.y/n,this.x2=(e.x+e.width)/s,this.y2=(e.y+e.height)/n,this.x3=e.x/s,this.y3=(e.y+e.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}};var DL=new f4;function My(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}var Xm=class t extends $d.default{constructor(e,i,r,s,n,o,a){if(super(),this.noFrame=!1,i||(this.noFrame=!0,i=new Kr(0,0,1,1)),e instanceof t&&(e=e.baseTexture),this.baseTexture=e,this._frame=i,this.trim=s,this.valid=!1,this._uvs=DL,this.uvMatrix=null,this.orig=r||i,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new Mn(o.x,o.y):new Mn(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=i:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){let{resource:i}=this.baseTexture;i!=null&&i.url&&Ja[i.url]&&t.removeFromCache(i.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,t.removeFromCache(this),this.textureCacheIds=null}clone(){var s;let e=this._frame.clone(),i=this._frame===this.orig?e:this.orig.clone(),r=new t(this.baseTexture,!this.noFrame&&e,i,(s=this.trim)==null?void 0:s.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=e),r}updateUvs(){this._uvs===DL&&(this._uvs=new f4),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,i={},r=Di.STRICT_TEXTURE_CACHE){let s=typeof e=="string",n=null;if(s)n=e;else if(e instanceof br){if(!e.cacheId){let a=(i==null?void 0:i.pixiIdPrefix)||"pixiid";e.cacheId=`${a}-${i1()}`,br.addToCache(e,e.cacheId)}n=e.cacheId}else{if(!e._pixiId){let a=(i==null?void 0:i.pixiIdPrefix)||"pixiid";e._pixiId=`${a}_${i1()}`}n=e._pixiId}let o=Ja[n];if(s&&r&&!o)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!o&&!(e instanceof br)?(i.resolution||(i.resolution=yy(e)),o=new t(new br(e,i)),o.baseTexture.cacheId=n,br.addToCache(o.baseTexture,n),t.addToCache(o,n)):!o&&e instanceof br&&(o=new t(e),t.addToCache(o,n)),o}static fromURL(e,i){let r=Object.assign({autoLoad:!1},i==null?void 0:i.resourceOptions),s=t.from(e,Object.assign({resourceOptions:r},i),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then(()=>Promise.resolve(s))}static fromBuffer(e,i,r,s){return new t(br.fromBuffer(e,i,r,s))}static fromLoader(e,i,r,s){let n=new br(e,Object.assign({scaleMode:br.defaultOptions.scaleMode,resolution:yy(i)},s)),{resource:o}=n;o instanceof vh&&(o.url=i);let a=new t(n);return r||(r=i),br.addToCache(a.baseTexture,r),t.addToCache(a,r),r!==i&&(br.addToCache(a.baseTexture,i),t.addToCache(a,i)),a.baseTexture.valid?Promise.resolve(a):new Promise(l=>{a.baseTexture.once("loaded",()=>l(a))})}static addToCache(e,i){i&&(e.textureCacheIds.includes(i)||e.textureCacheIds.push(i),Ja[i]&&Ja[i]!==e&&console.warn(`Texture added to the cache with an id [${i}] that already had an entry`),Ja[i]=e)}static removeFromCache(e){if(typeof e=="string"){let i=Ja[e];if(i){let r=i.textureCacheIds.indexOf(e);return r>-1&&i.textureCacheIds.splice(r,1),delete Ja[e],i}}else if(e!=null&&e.textureCacheIds){for(let i=0;i<e.textureCacheIds.length;++i)Ja[e.textureCacheIds[i]]===e&&delete Ja[e.textureCacheIds[i]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;let{x:i,y:r,width:s,height:n}=e,o=i+s>this.baseTexture.width,a=r+n>this.baseTexture.height;if(o||a){let l=o&&a?"and":"or",c=`X: ${i} + ${s} = ${i+s} > ${this.baseTexture.width}`,d=`Y: ${r} + ${n} = ${r+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${c} ${l} ${d}`)}this.valid=s&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return t._EMPTY||(t._EMPTY=new t(new br),My(t._EMPTY),My(t._EMPTY.baseTexture)),t._EMPTY}static get WHITE(){if(!t._WHITE){let e=Di.ADAPTER.createCanvas(16,16),i=e.getContext("2d");e.width=16,e.height=16,i.fillStyle="white",i.fillRect(0,0,16,16),t._WHITE=new t(br.from(e)),My(t._WHITE),My(t._WHITE.baseTexture)}return t._WHITE}};var Zd=class t extends Xm{constructor(e,i){super(e,i),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,i,r=!0){let s=this.baseTexture.resolution,n=Math.round(e*s)/s,o=Math.round(i*s)/s;this.valid=n>0&&o>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=o,r&&this.baseTexture.resize(n,o),this.updateUvs()}setResolution(e){let{baseTexture:i}=this;i.resolution!==e&&(i.setResolution(e),this.resize(i.width,i.height,!1))}static create(e){return new t(new Yd(e))}};var p4=class{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,i,r=Qr.NONE){let s=new Yd(Object.assign({width:e,height:i,resolution:1,multisample:r},this.textureOptions));return new Zd(s)}getOptimalTexture(e,i,r=1,s=Qr.NONE){let n;e=Math.ceil(e*r-1e-6),i=Math.ceil(i*r-1e-6),!this.enableFullScreen||e!==this._pixelsWidth||i!==this._pixelsHeight?(e=Gd(e),i=Gd(i),n=((e&65535)<<16|i&65535)>>>0,s>1&&(n+=s*4294967296)):n=s>1?-s:-1,this.texturePool[n]||(this.texturePool[n]=[]);let o=this.texturePool[n].pop();return o||(o=this.createTexture(e,i,s)),o.filterPoolKey=n,o.setResolution(r),o}getFilterTexture(e,i,r){let s=this.getOptimalTexture(e.width,e.height,i||e.resolution,r||Qr.NONE);return s.filterFrame=e.filterFrame,s}returnTexture(e){let i=e.filterPoolKey;e.filterFrame=null,this.texturePool[i].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=e!==!1,e)for(let i in this.texturePool){let r=this.texturePool[i];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0)}this.texturePool={}}setScreenSize(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(let i in this.texturePool){if(!(Number(i)<0))continue;let r=this.texturePool[i];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0);this.texturePool[i]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}};p4.SCREEN_KEY=-1;var Wm=class extends s1{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}};var qm=class extends s1{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new kn(this.vertices),this.uvBuffer=new kn(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,i){let r=0,s=0;return this.uvs[0]=r,this.uvs[1]=s,this.uvs[2]=r+i.width/e.width,this.uvs[3]=s,this.uvs[4]=r+i.width/e.width,this.uvs[5]=s+i.height/e.height,this.uvs[6]=r,this.uvs[7]=s+i.height/e.height,r=i.x,s=i.y,this.vertices[0]=r,this.vertices[1]=s,this.vertices[2]=r+i.width,this.vertices[3]=s,this.vertices[4]=r+i.width,this.vertices[5]=s+i.height,this.vertices[6]=r,this.vertices[7]=s+i.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}};var Ym=class{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Qr.NONE,this.sourceFrame=new Kr,this.destinationFrame=new Kr,this.bindingSourceFrame=new Kr,this.bindingDestinationFrame=new Kr,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}};var Py=[new Mn,new Mn,new Mn,new Mn],VT=new ps,m4=class{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new p4,this.statePool=[],this.quad=new Wm,this.quadUv=new qm,this.tempRect=new Kr,this.activeState={},this.globalUniforms=new tl({outputFrame:new Kr,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,i){var v,E;let r=this.renderer,s=this.defaultFilterStack,n=this.statePool.pop()||new Ym,o=this.renderer.renderTexture,a=i[0].resolution,l=i[0].multisample,c=i[0].padding,d=i[0].autoFit,m=(v=i[0].legacy)!=null?v:!0;for(let b=1;b<i.length;b++){let T=i[b];a=Math.min(a,T.resolution),l=Math.min(l,T.multisample),c=this.useMaxPadding?Math.max(c,T.padding):c+T.padding,d=d&&T.autoFit,m=m||((E=T.legacy)!=null?E:!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),s.push(n),n.resolution=a,n.multisample=l,n.legacy=m,n.target=e,n.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),n.sourceFrame.pad(c);let g=this.tempRect.copyFrom(o.sourceFrame);r.projection.transform&&this.transformAABB(VT.copyFrom(r.projection.transform).invert(),g),d?(n.sourceFrame.fit(g),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(g)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,o.current?o.current.resolution:r.resolution,o.sourceFrame,o.destinationFrame,r.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,a,l),n.filters=i,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;let _=this.tempRect;_.x=0,_.y=0,_.width=n.sourceFrame.width,_.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(o.sourceFrame),n.bindingDestinationFrame.copyFrom(o.destinationFrame),n.transform=r.projection.transform,r.projection.transform=null,o.bind(n.renderTexture,n.sourceFrame,_),r.framebuffer.clear(0,0,0,0)}pop(){let e=this.defaultFilterStack,i=e.pop(),r=i.filters;this.activeState=i;let s=this.globalUniforms.uniforms;s.outputFrame=i.sourceFrame,s.resolution=i.resolution;let n=s.inputSize,o=s.inputPixel,a=s.inputClamp;if(n[0]=i.destinationFrame.width,n[1]=i.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=Math.round(n[0]*i.resolution),o[1]=Math.round(n[1]*i.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=i.sourceFrame.width*n[2]-.5*o[2],a[3]=i.sourceFrame.height*n[3]-.5*o[3],i.legacy){let c=s.filterArea;c[0]=i.destinationFrame.width,c[1]=i.destinationFrame.height,c[2]=i.sourceFrame.x,c[3]=i.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();let l=e[e.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,i.renderTexture,l.renderTexture,gh.BLEND,i),this.returnFilterTexture(i.renderTexture);else{let c=i.renderTexture,d=this.getOptimalFilterTexture(c.width,c.height,i.resolution);d.filterFrame=c.filterFrame;let m=0;for(m=0;m<r.length-1;++m){m===1&&i.multisample>1&&(d=this.getOptimalFilterTexture(c.width,c.height,i.resolution),d.filterFrame=c.filterFrame),r[m].apply(this,c,d,gh.CLEAR,i);let g=c;c=d,d=g}r[m].apply(this,c,l.renderTexture,gh.BLEND,i),m>1&&i.multisample>1&&this.returnFilterTexture(i.renderTexture),this.returnFilterTexture(c),this.returnFilterTexture(d)}i.clear(),this.statePool.push(i)}bindAndClear(e,i=gh.CLEAR){let{renderTexture:r,state:s}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e!=null&&e.filterFrame){let o=this.tempRect;o.x=0,o.y=0,o.width=e.filterFrame.width,o.height=e.filterFrame.height,r.bind(e,e.filterFrame,o)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);let n=s.stateId&1||this.forceClear;(i===gh.CLEAR||i===gh.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,i,r,s){let n=this.renderer;n.state.set(e.state),this.bindAndClear(r,s),e.uniforms.uSampler=i,e.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(i._frame,i.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(i4.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(i4.TRIANGLE_STRIP))}calculateSpriteMatrix(e,i){let{sourceFrame:r,destinationFrame:s}=this.activeState,{orig:n}=i._texture,o=e.set(s.width,0,0,s.height,r.x,r.y),a=i.worldTransform.copyTo(ps.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/n.width,1/n.height),o.translate(i.anchor.x,i.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,i,r=1,s=Qr.NONE){return this.texturePool.getOptimalTexture(e,i,r,s)}getFilterTexture(e,i,r){if(typeof e=="number"){let n=e;e=i,i=n}e=e||this.activeState.renderTexture;let s=this.texturePool.getOptimalTexture(e.width,e.height,i||e.resolution,r||Qr.NONE);return s.filterFrame=e.filterFrame,s}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,i){let r=Py[0],s=Py[1],n=Py[2],o=Py[3];r.set(i.left,i.top),s.set(i.left,i.bottom),n.set(i.right,i.top),o.set(i.right,i.bottom),e.apply(r,r),e.apply(s,s),e.apply(n,n),e.apply(o,o);let a=Math.min(r.x,s.x,n.x,o.x),l=Math.min(r.y,s.y,n.y,o.y),c=Math.max(r.x,s.x,n.x,o.x),d=Math.max(r.y,s.y,n.y,o.y);i.x=a,i.y=l,i.width=c-a,i.height=d-l}roundFrame(e,i,r,s,n){if(!(e.width<=0||e.height<=0||r.width<=0||r.height<=0)){if(n){let{a:o,b:a,c:l,d:c}=n;if((Math.abs(a)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(c)>1e-4))return}n=n?VT.copyFrom(n):VT.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.transformAABB(n,e),e.ceil(i),this.transformAABB(n.invert(),e)}}};m4.extension={type:bi.RendererSystem,name:"filter"};Ni.add(m4);var Zm=class{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Qr.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}};var Pq=new Kr,g4=class{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new xh(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);let e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Kr,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let i=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;Di.PREFER_ENV===Ka.WEBGL_LEGACY&&(i=null,r=null),i?e.drawBuffers=s=>i.drawBuffersWEBGL(s):(this.hasMRT=!1,e.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,i,r=0){let{gl:s}=this;if(e){let n=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(e.dirtyId++,e.dirtyFormat++,n.mipLevel=r),n.dirtyId!==e.dirtyId&&(n.dirtyId=e.dirtyId,n.dirtyFormat!==e.dirtyFormat?(n.dirtyFormat=e.dirtyFormat,n.dirtySize=e.dirtySize,this.updateFramebuffer(e,r)):n.dirtySize!==e.dirtySize&&(n.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let o=0;o<e.colorTextures.length;o++){let a=e.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),i){let o=i.width>>r,a=i.height>>r,l=o/i.width;this.setViewport(i.x*l,i.y*l,o,a)}else{let o=e.width>>r,a=e.height>>r;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),i?this.setViewport(i.x,i.y,i.width,i.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,i,r,s){let n=this.viewport;e=Math.round(e),i=Math.round(i),r=Math.round(r),s=Math.round(s),(n.width!==r||n.height!==s||n.x!==e||n.y!==i)&&(n.x=e,n.y=i,n.width=r,n.height=s,this.gl.viewport(e,i,r,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,i,r,s,n=uy.COLOR|uy.DEPTH){let{gl:o}=this;o.clearColor(e,i,r,s),o.clear(n)}initFramebuffer(e){let{gl:i}=this,r=new Zm(i.createFramebuffer());return r.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(e),e.disposeRunner.add(this),r}resizeFramebuffer(e){let{gl:i}=this,r=e.glFramebuffers[this.CONTEXT_UID];r.stencil&&(i.bindRenderbuffer(i.RENDERBUFFER,r.stencil),r.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.DEPTH24_STENCIL8,e.width,e.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e.width,e.height));let s=e.colorTextures,n=s.length;i.drawBuffers||(n=Math.min(n,1));for(let o=0;o<n;o++){let a=s[o],l=a.parentTextureArray||a;this.renderer.texture.bind(l,0),o===0&&r.msaaBuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,r.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,i){let{gl:r}=this,s=e.glFramebuffers[this.CONTEXT_UID],n=e.colorTextures,o=n.length;r.drawBuffers||(o=Math.min(o,1)),s.multisample>1&&this.canMultisampleFramebuffer(e)?s.msaaBuffer=s.msaaBuffer||r.createRenderbuffer():s.msaaBuffer&&(r.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));let a=[];for(let l=0;l<o;l++){let c=n[l],d=c.parentTextureArray||c;this.renderer.texture.bind(d,0),l===0&&s.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,s.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,d._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,s.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+l,c.target,d._glTextures[this.CONTEXT_UID].texture,i),a.push(r.COLOR_ATTACHMENT0+l))}if(a.length>1&&r.drawBuffers(a),e.depthTexture&&this.writeDepthTexture){let c=e.depthTexture;this.renderer.texture.bind(c,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,c._glTextures[this.CONTEXT_UID].texture,i)}(e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)?(s.stencil=s.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,s.stencil),s.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,r.DEPTH24_STENCIL8,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,s.stencil)):s.stencil&&(r.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){let{msaaSamples:i}=this,r=Qr.NONE;if(e<=1||i===null)return r;for(let s=0;s<i.length;s++)if(i[s]<=e){r=i[s];break}return r===1&&(r=Qr.NONE),r}blit(e,i,r){let{current:s,renderer:n,gl:o,CONTEXT_UID:a}=this;if(n.context.webGLVersion!==2||!s)return;let l=s.glFramebuffers[a];if(!l)return;if(!e){if(!l.msaaBuffer)return;let d=s.colorTextures[0];if(!d)return;l.blitFramebuffer||(l.blitFramebuffer=new xh(s.width,s.height),l.blitFramebuffer.addColorTexture(0,d)),e=l.blitFramebuffer,e.colorTextures[0]!==d&&(e.colorTextures[0]=d,e.dirtyId++,e.dirtyFormat++),(e.width!==s.width||e.height!==s.height)&&(e.width=s.width,e.height=s.height,e.dirtyId++,e.dirtySize++)}i||(i=Pq,i.width=s.width,i.height=s.height),r||(r=i);let c=i.width===r.width&&i.height===r.height;this.bind(e),o.bindFramebuffer(o.READ_FRAMEBUFFER,l.framebuffer),o.blitFramebuffer(i.left,i.top,i.right,i.bottom,r.left,r.top,r.right,r.bottom,o.COLOR_BUFFER_BIT,c?o.NEAREST:o.LINEAR)}disposeFramebuffer(e,i){let r=e.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!r)return;delete e.glFramebuffers[this.CONTEXT_UID];let n=this.managedFramebuffers.indexOf(e);n>=0&&this.managedFramebuffers.splice(n,1),e.disposeRunner.remove(this),i||(s.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&s.deleteRenderbuffer(r.msaaBuffer),r.stencil&&s.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,i)}disposeAll(e){let i=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<i.length;r++)this.disposeFramebuffer(i[r],e)}forceStencil(){let e=this.current;if(!e)return;let i=e.glFramebuffers[this.CONTEXT_UID];if(!i||i.stencil)return;e.stencil=!0;let r=e.width,s=e.height,n=this.gl,o=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o),i.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,i.multisample,n.DEPTH24_STENCIL8,r,s):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,r,s),i.stencil=o,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Kr}destroy(){this.renderer=null}};g4.extension={type:bi.RendererSystem,name:"framebuffer"};Ni.add(g4);var jT={5126:4,5123:2,5121:1},y4=class{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);let e=this.gl=this.renderer.gl,i=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,i.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;Di.PREFER_ENV===Ka.WEBGL_LEGACY&&(r=null),r?(e.createVertexArray=()=>r.createVertexArrayOES(),e.bindVertexArray=s=>r.bindVertexArrayOES(s),e.deleteVertexArray=s=>r.deleteVertexArrayOES(s)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(i.webGLVersion!==2){let r=e.getExtension("ANGLE_instanced_arrays");r?(e.vertexAttribDivisor=(s,n)=>r.vertexAttribDivisorANGLE(s,n),e.drawElementsInstanced=(s,n,o,a,l)=>r.drawElementsInstancedANGLE(s,n,o,a,l),e.drawArraysInstanced=(s,n,o,a)=>r.drawArraysInstancedANGLE(s,n,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=i.webGLVersion===2||!!i.extensions.uint32ElementIndex}bind(e,i){i=i||this.renderer.shader.shader;let{gl:r}=this,s=e.glVertexArrayObjects[this.CONTEXT_UID],n=!1;s||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=s={},n=!0);let o=s[i.program.id]||this.initGeometryVao(e,i,n);this._activeGeometry=e,this._activeVao!==o&&(this._activeVao=o,this.hasVao?r.bindVertexArray(o):this.activateVao(e,i.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){let e=this._activeGeometry,i=this.renderer.buffer;for(let r=0;r<e.buffers.length;r++){let s=e.buffers[r];i.update(s)}}checkCompatibility(e,i){let r=e.attributes,s=i.attributeData;for(let n in s)if(!r[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(e,i){let r=e.attributes,s=i.attributeData,n=["g",e.id];for(let o in r)s[o]&&n.push(o,s[o].location);return n.join("-")}initGeometryVao(e,i,r=!0){let s=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,a=i.program;a.glPrograms[n]||this.renderer.shader.generateProgram(i),this.checkCompatibility(e,a);let l=this.getSignature(e,a),c=e.glVertexArrayObjects[this.CONTEXT_UID],d=c[l];if(d)return c[a.id]=d,d;let m=e.buffers,g=e.attributes,_={},v={};for(let E in m)_[E]=0,v[E]=0;for(let E in g)!g[E].size&&a.attributeData[E]?g[E].size=a.attributeData[E].size:g[E].size||console.warn(`PIXI Geometry attribute '${E}' size cannot be determined (likely the bound shader does not have the attribute)`),_[g[E].buffer]+=g[E].size*jT[g[E].type];for(let E in g){let b=g[E],T=b.size;b.stride===void 0&&(_[b.buffer]===T*jT[b.type]?b.stride=0:b.stride=_[b.buffer]),b.start===void 0&&(b.start=v[b.buffer],v[b.buffer]+=T*jT[b.type])}d=s.createVertexArray(),s.bindVertexArray(d);for(let E=0;E<m.length;E++){let b=m[E];o.bind(b),r&&b._glBuffers[n].refCount++}return this.activateVao(e,a),c[a.id]=d,c[l]=d,s.bindVertexArray(null),o.unbind(Ta.ARRAY_BUFFER),d}disposeGeometry(e,i){var a;if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];let r=e.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,n=e.buffers,o=(a=this.renderer)==null?void 0:a.buffer;if(e.disposeRunner.remove(this),!!r){if(o)for(let l=0;l<n.length;l++){let c=n[l]._glBuffers[this.CONTEXT_UID];c&&(c.refCount--,c.refCount===0&&!i&&o.dispose(n[l],i))}if(!i){for(let l in r)if(l[0]==="g"){let c=r[l];this._activeVao===c&&this.unbind(),s.deleteVertexArray(c)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){let i=Object.keys(this.managedGeometries);for(let r=0;r<i.length;r++)this.disposeGeometry(this.managedGeometries[i[r]],e)}activateVao(e,i){let r=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,o=e.buffers,a=e.attributes;e.indexBuffer&&n.bind(e.indexBuffer);let l=null;for(let c in a){let d=a[c],m=o[d.buffer],g=m._glBuffers[s];if(i.attributeData[c]){l!==g&&(n.bind(m),l=g);let _=i.attributeData[c].location;if(r.enableVertexAttribArray(_),r.vertexAttribPointer(_,d.size,d.type||r.FLOAT,d.normalized,d.stride,d.start),d.instance)if(this.hasInstance)r.vertexAttribDivisor(_,d.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,i,r,s){let{gl:n}=this,o=this._activeGeometry;if(o.indexBuffer){let a=o.indexBuffer.data.BYTES_PER_ELEMENT,l=a===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(e,i||o.indexBuffer.data.length,l,(r||0)*a,s||1):n.drawElements(e,i||o.indexBuffer.data.length,l,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(e,r,i||o.getSize(),s||1):n.drawArrays(e,r,i||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}};y4.extension={type:bi.RendererSystem,name:"geometry"};Ni.add(y4);var FL=new ps,Qm=class{constructor(e,i){this._texture=e,this.mapCoord=new ps,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof i=="undefined"?.5:i,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,i){i===void 0&&(i=e);let r=this.mapCoord;for(let s=0;s<e.length;s+=2){let n=e[s],o=e[s+1];i[s]=n*r.a+o*r.c+r.tx,i[s+1]=n*r.b+o*r.d+r.ty}return i}update(e){let i=this._texture;if(!i||!i.valid||!e&&this._textureID===i._updateID)return!1;this._textureID=i._updateID,this._updateID++;let r=i._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);let s=i.orig,n=i.trim;n&&(FL.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(FL));let o=i.baseTexture,a=this.uClampFrame,l=this.clampMargin/o.resolution,c=this.clampOffset;return a[0]=(i._frame.x+l+c)/o.width,a[1]=(i._frame.y+l+c)/o.height,a[2]=(i._frame.x+i._frame.width-l+c)/o.width,a[3]=(i._frame.y+i._frame.height-l+c)/o.height,this.uClampOffset[0]=c/o.realWidth,this.uClampOffset[1]=c/o.realHeight,this.isSimple=i._frame.width===o.width&&i._frame.height===o.height&&i.rotate===0,!0}};var LL=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`;var NL=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;var Km=class extends rl{constructor(e,i,r){let s=null;typeof e!="string"&&i===void 0&&r===void 0&&(s=e,e=void 0,i=void 0,r=void 0),super(e||NL,i||LL,r),this.maskSprite=s,this.maskMatrix=new ps}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,i,r,s){let n=this._maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new Qm(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,e.applyFilter(this,i,r,s))}};var Jm=class{constructor(e=null){this.type=In.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=rl.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=In.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}};var _4=class{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,i){let r=i;if(!r.isMaskData){let n=this.maskDataPool.pop()||new Jm;n.pooled=!0,n.maskObject=i,r=n}let s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(s),r._colorMask=s?s._colorMask:15,r.autoDetect&&this.detect(r),r._target=e,r.type!==In.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case In.SCISSOR:this.renderer.scissor.push(r);break;case In.STENCIL:this.renderer.stencil.push(r);break;case In.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case In.COLOR:this.pushColorMask(r);break;default:break}r.type===In.SPRITE&&this.maskStack.push(r)}pop(e){let i=this.maskStack.pop();if(!(!i||i._target!==e)){if(i.enabled)switch(i.type){case In.SCISSOR:this.renderer.scissor.pop(i);break;case In.STENCIL:this.renderer.stencil.pop(i.maskObject);break;case In.SPRITE:this.popSpriteMask(i);break;case In.COLOR:this.popColorMask(i);break;default:break}if(i.reset(),i.pooled&&this.maskDataPool.push(i),this.maskStack.length!==0){let r=this.maskStack[this.maskStack.length-1];r.type===In.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(e){let i=e.maskObject;i?i.isSprite?e.type=In.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=In.SCISSOR:e.type=In.STENCIL:e.type=In.COLOR}pushSpriteMask(e){var d,m;let{maskObject:i}=e,r=e._target,s=e._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new Km]));let n=this.renderer,o=n.renderTexture,a,l;if(o.current){let g=o.current;a=e.resolution||g.resolution,l=(d=e.multisample)!=null?d:g.multisample}else a=e.resolution||n.resolution,l=(m=e.multisample)!=null?m:n.multisample;s[0].resolution=a,s[0].multisample=l,s[0].maskSprite=i;let c=r.filterArea;r.filterArea=i.getBounds(!0),n.filter.push(r,s),r.filterArea=c,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){let i=e._colorMask,r=e._colorMask=i&e.colorMask;r!==i&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(e){let i=e._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==i&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}};_4.extension={type:bi.RendererSystem,name:"mask"};Ni.add(_4);var x4=class{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){let{gl:i}=this.renderer,r=this.getStackLength();this.maskStack=e;let s=this.getStackLength();s!==r&&(s===0?i.disable(this.glConst):(i.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}};var OL=new ps,BL=[],Ry=class extends x4{constructor(t){super(t),this.glConst=Di.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){let t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){var o;if(t._scissorRectLocal)return;let e=t._scissorRect,{maskObject:i}=t,{renderer:r}=this,s=r.renderTexture,n=i.getBounds(!0,(o=BL.pop())!=null?o:new Kr);this.roundFrameToPixels(n,s.current?s.current.resolution:r.resolution,s.sourceFrame,s.destinationFrame,r.projection.transform),e&&n.fit(e),t._scissorRectLocal=n}static isMatrixRotated(t){if(!t)return!1;let{a:e,b:i,c:r,d:s}=t;return(Math.abs(i)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(s)>1e-4)}testScissor(t){let{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||Ry.isMatrixRotated(e.worldTransform)||Ry.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);let i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,e,i,r,s){Ry.isMatrixRotated(s)||(s=s?OL.copyFrom(s):OL.identity(),s.translate(-i.x,-i.y).scale(r.width/i.width,r.height/i.height).translate(r.x,r.y),this.renderer.filter.transformAABB(s,t),t.fit(r),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);let{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){let{gl:e}=this.renderer;t&&BL.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){let t=this.maskStack[this.maskStack.length-1]._scissorRect,e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}},Dy=Ry;Dy.extension={type:bi.RendererSystem,name:"scissor"};Ni.add(Dy);var v4=class extends x4{constructor(e){super(e),this.glConst=Di.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){let e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){let i=e.maskObject,{gl:r}=this.renderer,s=e._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),e._stencilCounter++;let n=e._colorMask;n!==0&&(e._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,s,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),i.renderable=!0,i.render(this.renderer),this.renderer.batch.flush(),i.renderable=!1,n!==0&&(e._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(e){let i=this.renderer.gl;if(this.getStackLength()===0)i.disable(i.STENCIL_TEST);else{let r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=r?r._colorMask:15;s!==0&&(r._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilOp(i.KEEP,i.KEEP,i.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(r._colorMask=s,i.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){let e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}};v4.extension={type:bi.RendererSystem,name:"stencil"};Ni.add(v4);var b4=class{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return Tr("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract}},prepare:{enumerable:!1,get(){return Tr("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare}},interaction:{enumerable:!1,get(){return Tr("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events}}})}init(){let e=this.rendererPlugins;for(let i in e)this.plugins[i]=new e[i](this.renderer)}destroy(){for(let e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}};b4.extension={type:[bi.RendererSystem,bi.CanvasRendererSystem],name:"_plugin"};Ni.add(b4);var w4=class{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new ps,this.transform=null}update(e,i,r,s){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=i||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,s),this.transform&&this.projectionMatrix.append(this.transform);let n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(e,i,r,s){let n=this.projectionMatrix,o=s?-1:1;n.identity(),n.a=1/i.width*2,n.d=o*(1/i.height*2),n.tx=-1-i.x*n.a,n.ty=-o-i.y*n.d}setTransform(e){}destroy(){this.renderer=null}};w4.extension={type:bi.RendererSystem,name:"projection"};Ni.add(w4);var Rq=new by,E4=class{constructor(e){this.renderer=e,this._tempMatrix=new ps}generateTexture(e,i){let l=i||{},{region:r}=l,s=df(l,["region"]),n=r||e.getLocalBounds(null,!0);n.width===0&&(n.width=1),n.height===0&&(n.height=1);let o=Zd.create(di({width:n.width,height:n.height},s));this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;let a=e.transform;return e.transform=Rq,this.renderer.render(e,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=a,o}destroy(){}};E4.extension={type:[bi.RendererSystem,bi.CanvasRendererSystem],name:"textureGenerator"};Ni.add(E4);var Qd=new Kr,e6=new Kr,T4=class{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Kr,this.destinationFrame=new Kr,this.viewportFrame=new Kr}bind(e=null,i,r){let s=this.renderer;this.current=e;let n,o,a;e?(n=e.baseTexture,a=n.resolution,i||(Qd.width=e.frame.width,Qd.height=e.frame.height,i=Qd),r||(e6.x=e.frame.x,e6.y=e.frame.y,e6.width=i.width,e6.height=i.height,r=e6),o=n.framebuffer):(a=s.resolution,i||(Qd.width=s._view.screen.width,Qd.height=s._view.screen.height,i=Qd),r||(r=Qd,r.width=i.width,r.height=i.height));let l=this.viewportFrame;l.x=r.x*a,l.y=r.y*a,l.width=r.width*a,l.height=r.height*a,e||(l.y=s.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(o,l),this.renderer.projection.update(r,i,a,!o),e?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(i),this.destinationFrame.copyFrom(r)}clear(e,i){let r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=e?Sa.shared.setValue(e):r,n=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=n.width!==o.width||n.height!==o.height;if(a){let{x:l,y:c,width:d,height:m}=this.viewportFrame;l=Math.round(l),c=Math.round(c),d=Math.round(d),m=Math.round(m),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,c,d,m)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,i),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}};T4.extension={type:bi.RendererSystem,name:"renderTexture"};Ni.add(T4);var t6=class{constructor(e,i){this.program=e,this.uniformData=i,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}};function UL(t,e){let i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){let n=e.getActiveAttrib(t,s);if(n.name.startsWith("gl_"))continue;let o=Gm(e,n.type),a={type:o,name:n.name,size:zm(o),location:e.getAttribLocation(t,n.name)};i[n.name]=a}return i}function zL(t,e){let i={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<r;s++){let n=e.getActiveUniform(t,s),o=n.name.replace(/\[.*?\]$/,""),a=!!n.name.match(/\[.*?\]$/),l=Gm(e,n.type);i[o]={name:o,index:s,type:l,size:n.size,isArray:a,value:Um(l,n.size)}}return i}function XT(t,e){var l;let i=wy(t,t.VERTEX_SHADER,e.vertexSrc),r=wy(t,t.FRAGMENT_SHADER,e.fragmentSrc),s=t.createProgram();t.attachShader(s,i),t.attachShader(s,r);let n=(l=e.extra)==null?void 0:l.transformFeedbackVaryings;if(n&&(typeof t.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):t.transformFeedbackVaryings(s,n.names,n.bufferMode==="separate"?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||HT(t,s,i,r),e.attributeData=UL(s,t),e.uniformData=zL(s,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){let c=Object.keys(e.attributeData);c.sort((d,m)=>d>m?1:-1);for(let d=0;d<c.length;d++)e.attributeData[c[d]].location=d,t.bindAttribLocation(s,d,c[d]);t.linkProgram(s)}t.deleteShader(i),t.deleteShader(r);let o={};for(let c in e.uniformData){let d=e.uniformData[c];o[c]={location:t.getUniformLocation(s,c),value:Um(d.type,d.size)}}return new t6(s,o)}function Dq(t,e,i,r,s){i.buffer.update(s)}var Fq={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},GL={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function $L(t){let e=t.map(n=>({data:n,offset:0,dataLen:0,dirty:0})),i=0,r=0,s=0;for(let n=0;n<e.length;n++){let o=e[n];if(i=GL[o.data.type],o.data.size>1&&(i=Math.max(i,16)*o.data.size),o.dataLen=i,r%i!==0&&r<16){let a=r%i%16;r+=a,s+=a}r+i>16?(s=Math.ceil(s/16)*16,o.offset=s,s+=i,r=i):(o.offset=s,r+=i,s+=i)}return s=Math.ceil(s/16)*16,{uboElements:e,size:s}}function HL(t,e){let i=[];for(let r in t)e[r]&&i.push(e[r]);return i.sort((r,s)=>r.index-s.index),i}function WT(t,e){if(!t.autoManage)return{size:0,syncFunc:Dq};let i=HL(t.uniforms,e),{uboElements:r,size:s}=$L(i),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<r.length;o++){let a=r[o],l=t.uniforms[a.data.name],c=a.data.name,d=!1;for(let m=0;m<Kc.length;m++){let g=Kc[m];if(g.codeUbo&&g.test(a.data,l)){n.push(`offset = ${a.offset/4};`,Kc[m].codeUbo(a.data.name,l)),d=!0;break}}if(!d)if(a.data.size>1){let m=zm(a.data.type),g=Math.max(GL[a.data.type]/16,1),_=m/g,v=(4-_%4)%4;n.push(`
                cv = ud.${c}.value;
                v = uv.${c};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*g}; i++)
                {
                    for(var j = 0; j < ${_}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${v};
                }

                `)}else{let m=Fq[a.data.type];n.push(`
                cv = ud.${c}.value;
                v = uv.${c};
                offset = ${a.offset/4};
                ${m};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}var Lq=0,Fy={textureCount:0,uboCount:0},S4=class{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Lq++}systemCheck(){if(!Cy())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,i){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;let r=e.program,s=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==r&&(this.program=r,this.gl.useProgram(s.program)),i||(Fy.textureCount=0,Fy.uboCount=0,this.syncUniformGroup(e.uniformGroup,Fy)),s}setUniforms(e){let i=this.shader.program,r=i.glPrograms[this.renderer.CONTEXT_UID];i.syncUniforms(r.uniformData,e,this.renderer)}syncUniformGroup(e,i){let r=this.getGlProgram();(!e.static||e.dirtyId!==r.uniformDirtyGroups[e.id])&&(r.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,r,i))}syncUniforms(e,i,r){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(i.uniformData,e.uniforms,this.renderer,r)}createSyncGroups(e){let i=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[i]||(this.cache[i]=GT(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[i],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,i){let r=this.getGlProgram();if(!e.static||e.dirtyId!==0||!r.uniformGroups[e.id]){e.dirtyId=0;let s=r.uniformGroups[e.id]||this.createSyncBufferGroup(e,r,i);e.buffer.update(),s(r.uniformData,e.uniforms,this.renderer,Fy,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,r.uniformBufferBindings[i])}createSyncBufferGroup(e,i,r){let{gl:s}=this.renderer;this.renderer.buffer.bind(e.buffer);let n=this.gl.getUniformBlockIndex(i.program,r);i.uniformBufferBindings[r]=this.shader.uniformBindCount,s.uniformBlockBinding(i.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;let o=this.getSignature(e,this.shader.program.uniformData,"ubo"),a=this._uboCache[o];if(a||(a=this._uboCache[o]=WT(e,this.shader.program.uniformData)),e.autoManage){let l=new Float32Array(a.size/4);e.buffer.update(l)}return i.uniformGroups[e.id]=a.syncFunc,i.uniformGroups[e.id]}getSignature(e,i,r){let s=e.uniforms,n=[`${r}-`];for(let o in s)n.push(o),i[o]&&n.push(i[o].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){let i=this.gl,r=e.program,s=XT(i,r);return r.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}};S4.extension={type:bi.RendererSystem,name:"shader"};Ni.add(S4);var a1=class{constructor(e){this.renderer=e}run(e){let{renderer:i}=this;i.runners.init.emit(i.options),e.hello&&console.log(`PixiJS 7.2.1 - ${i.rendererLogId} - https://pixijs.com`),i.resize(i.screen.width,i.screen.height)}destroy(){}};a1.defaultOptions={hello:!1};a1.extension={type:[bi.RendererSystem,bi.CanvasRendererSystem],name:"startup"};Ni.add(a1);function VL(t,e=[]){return e[Wi.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.ADD]=[t.ONE,t.ONE],e[Wi.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.NONE]=[0,0],e[Wi.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[Wi.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Wi.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[Wi.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[Wi.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[Wi.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[Wi.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[Wi.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[Wi.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[Wi.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[Wi.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}var Nq=0,Oq=1,Bq=2,Uq=3,zq=4,Gq=5,qT=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=Wi.NONE,this._blendEq=!1,this.map=[],this.map[Nq]=this.setBlend,this.map[Oq]=this.setOffset,this.map[Bq]=this.setCullFace,this.map[Uq]=this.setDepthTest,this.map[zq]=this.setFrontFace,this.map[Gq]=this.setDepthMask,this.checks=[],this.defaultState=new r1,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=VL(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)e&1&&this.map[i].call(this,!!(t.data&1<<i)),e=e>>1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(qT.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(qT.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;let e=this.blendModes[t],i=this.gl;e.length===2?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){let i=this.checks.indexOf(t);e&&i===-1?this.checks.push(t):!e&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}},Ly=qT;Ly.extension={type:bi.RendererSystem,name:"state"};Ni.add(Ly);var A4=class extends $d.default{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){var s;this.addRunners(...e.runners);let i=((s=e.priority)!=null?s:[]).filter(n=>e.systems[n]),r=[...i,...Object.keys(e.systems).filter(n=>!i.includes(n))];for(let n of r)this.addSystem(e.systems[n],n)}addRunners(...e){e.forEach(i=>{this.runners[i]=new yn(i)})}addSystem(e,i){let r=new e(this);if(this[i])throw new Error(`Whoops! The name "${i}" is already in use`);this[i]=r,this._systemsHash[i]=r;for(let s in this.runners)this.runners[s].add(r);return this}emitWithCustomOptions(e,i){let r=Object.keys(this._systemsHash);e.items.forEach(s=>{let n=r.find(o=>this._systemsHash[o]===s);s[e.name](i[n])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}};var Ny=class{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Ny.defaultMaxIdle,this.checkCountMax=Ny.defaultCheckCountMax,this.mode=Ny.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==dy.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){let t=this.renderer.texture,e=t.managedTextures,i=!1;for(let r=0;r<e.length;r++){let s=e[r];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[r]=null,i=!0)}if(i){let r=0;for(let s=0;s<e.length;s++)e[s]!==null&&(e[r++]=e[s]);e.length=r}}unload(t){let e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let r=t.children.length-1;r>=0;r--)this.unload(t.children[r])}destroy(){this.renderer=null}},Ca=Ny;Ca.defaultMode=dy.AUTO;Ca.defaultMaxIdle=60*60;Ca.defaultCheckCountMax=60*10;Ca.extension={type:bi.RendererSystem,name:"textureGC"};Ni.add(Ca);var Kd=class{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=_r.UNSIGNED_BYTE,this.internalFormat=ni.RGBA,this.samplerType=0}};function jL(t){let e;return"WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?e={[_r.UNSIGNED_BYTE]:{[ni.RGBA]:t.RGBA8,[ni.RGB]:t.RGB8,[ni.RG]:t.RG8,[ni.RED]:t.R8,[ni.RGBA_INTEGER]:t.RGBA8UI,[ni.RGB_INTEGER]:t.RGB8UI,[ni.RG_INTEGER]:t.RG8UI,[ni.RED_INTEGER]:t.R8UI,[ni.ALPHA]:t.ALPHA,[ni.LUMINANCE]:t.LUMINANCE,[ni.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[_r.BYTE]:{[ni.RGBA]:t.RGBA8_SNORM,[ni.RGB]:t.RGB8_SNORM,[ni.RG]:t.RG8_SNORM,[ni.RED]:t.R8_SNORM,[ni.RGBA_INTEGER]:t.RGBA8I,[ni.RGB_INTEGER]:t.RGB8I,[ni.RG_INTEGER]:t.RG8I,[ni.RED_INTEGER]:t.R8I},[_r.UNSIGNED_SHORT]:{[ni.RGBA_INTEGER]:t.RGBA16UI,[ni.RGB_INTEGER]:t.RGB16UI,[ni.RG_INTEGER]:t.RG16UI,[ni.RED_INTEGER]:t.R16UI,[ni.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[_r.SHORT]:{[ni.RGBA_INTEGER]:t.RGBA16I,[ni.RGB_INTEGER]:t.RGB16I,[ni.RG_INTEGER]:t.RG16I,[ni.RED_INTEGER]:t.R16I},[_r.UNSIGNED_INT]:{[ni.RGBA_INTEGER]:t.RGBA32UI,[ni.RGB_INTEGER]:t.RGB32UI,[ni.RG_INTEGER]:t.RG32UI,[ni.RED_INTEGER]:t.R32UI,[ni.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[_r.INT]:{[ni.RGBA_INTEGER]:t.RGBA32I,[ni.RGB_INTEGER]:t.RGB32I,[ni.RG_INTEGER]:t.RG32I,[ni.RED_INTEGER]:t.R32I},[_r.FLOAT]:{[ni.RGBA]:t.RGBA32F,[ni.RGB]:t.RGB32F,[ni.RG]:t.RG32F,[ni.RED]:t.R32F,[ni.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[_r.HALF_FLOAT]:{[ni.RGBA]:t.RGBA16F,[ni.RGB]:t.RGB16F,[ni.RG]:t.RG16F,[ni.RED]:t.R16F},[_r.UNSIGNED_SHORT_5_6_5]:{[ni.RGB]:t.RGB565},[_r.UNSIGNED_SHORT_4_4_4_4]:{[ni.RGBA]:t.RGBA4},[_r.UNSIGNED_SHORT_5_5_5_1]:{[ni.RGBA]:t.RGB5_A1},[_r.UNSIGNED_INT_2_10_10_10_REV]:{[ni.RGBA]:t.RGB10_A2,[ni.RGBA_INTEGER]:t.RGB10_A2UI},[_r.UNSIGNED_INT_10F_11F_11F_REV]:{[ni.RGB]:t.R11F_G11F_B10F},[_r.UNSIGNED_INT_5_9_9_9_REV]:{[ni.RGB]:t.RGB9_E5},[_r.UNSIGNED_INT_24_8]:{[ni.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[_r.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[ni.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:e={[_r.UNSIGNED_BYTE]:{[ni.RGBA]:t.RGBA,[ni.RGB]:t.RGB,[ni.ALPHA]:t.ALPHA,[ni.LUMINANCE]:t.LUMINANCE,[ni.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[_r.UNSIGNED_SHORT_5_6_5]:{[ni.RGB]:t.RGB},[_r.UNSIGNED_SHORT_4_4_4_4]:{[ni.RGBA]:t.RGBA},[_r.UNSIGNED_SHORT_5_5_5_1]:{[ni.RGBA]:t.RGBA}},e}var C4=class{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new br,this.hasIntegerTextures=!1}contextChange(){let e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=jL(e);let i=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=i;for(let s=0;s<i;s++)this.boundTextures[s]=null;this.emptyTextures={};let r=new Kd(e.createTexture());e.bindTexture(e.TEXTURE_2D,r.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=r,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new Kd(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(e,i=0){let{gl:r}=this;if(e=e==null?void 0:e.castToBaseTexture(),e!=null&&e.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;let s=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[i]!==e&&(this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),r.bindTexture(e.target,s.texture)),s.dirtyId!==e.dirtyId?(this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),this.updateTexture(e)):s.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[i]=e}else this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[i]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){let{gl:i,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<r.length;s++)r[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<r.length;s++)r[s]===e&&(this.currentLocation!==s&&(i.activeTexture(i.TEXTURE0+s),this.currentLocation=s),i.bindTexture(e.target,this.emptyTextures[e.target].texture),r[s]=null)}ensureSamplerType(e){let{boundTextures:i,hasIntegerTextures:r,CONTEXT_UID:s}=this;if(r)for(let n=e-1;n>=0;--n){let o=i[n];o&&o._glTextures[s].samplerType!==hy.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(e){let i=new Kd(this.gl.createTexture());return i.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=i,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),i}initTextureType(e,i){var r,s;i.internalFormat=(s=(r=this.internalFormats[e.type])==null?void 0:r[e.format])!=null?s:e.format,this.webGLVersion===2&&e.type===_r.HALF_FLOAT?i.type=this.gl.HALF_FLOAT:i.type=e.type}updateTexture(e){var s;let i=e._glTextures[this.CONTEXT_UID];if(!i)return;let r=this.renderer;if(this.initTextureType(e,i),(s=e.resource)!=null&&s.upload(r,e,i))i.samplerType!==hy.FLOAT&&(this.hasIntegerTextures=!0);else{let n=e.realWidth,o=e.realHeight,a=r.gl;(i.width!==n||i.height!==o||i.dirtyId<0)&&(i.width=n,i.height=o,a.texImage2D(e.target,0,i.internalFormat,n,o,0,e.format,i.type,null))}e.dirtyStyleId!==i.dirtyStyleId&&this.updateTextureStyle(e),i.dirtyId=e.dirtyId}destroyTexture(e,i){let{gl:r}=this;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),r.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!i)){let s=this.managedTextures.indexOf(e);s!==-1&&IT(this.managedTextures,s,1)}}updateTextureStyle(e){var r;let i=e._glTextures[this.CONTEXT_UID];i&&((e.mipmap===hc.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?i.mipmap=!1:i.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?i.wrapMode=Lm.CLAMP:i.wrapMode=e.wrapMode,(r=e.resource)!=null&&r.style(this.renderer,e,i)||this.setStyle(e,i),i.dirtyStyleId=e.dirtyStyleId)}setStyle(e,i){let r=this.gl;if(i.mipmap&&e.mipmap!==hc.ON_MANUAL&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,i.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,i.wrapMode),i.mipmap){r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===Ml.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);let s=this.renderer.context.extensions.anisotropicFiltering;if(s&&e.anisotropicLevel>0&&e.scaleMode===Ml.LINEAR){let n=Math.min(e.anisotropicLevel,r.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(e.target,s.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===Ml.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode===Ml.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}};C4.extension={type:bi.RendererSystem,name:"texture"};Ni.add(C4);var I4=class{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){let{gl:i,CONTEXT_UID:r}=this,s=e._glTransformFeedbacks[r]||this.createGLTransformFeedback(e);i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,s)}unbind(){let{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,i){let{gl:r,renderer:s}=this;i&&s.shader.bind(i),r.beginTransformFeedback(e)}endTransformFeedback(){let{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){let{gl:i,renderer:r,CONTEXT_UID:s}=this,n=i.createTransformFeedback();e._glTransformFeedbacks[s]=n,i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,n);for(let o=0;o<e.buffers.length;o++){let a=e.buffers[o];a&&(r.buffer.update(a),a._glBuffers[s].refCount++,i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[s].buffer||null))}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),n}disposeTransformFeedback(e,i){let r=e._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this);let n=this.renderer.buffer;if(n)for(let o=0;o<e.buffers.length;o++){let a=e.buffers[o];if(!a)continue;let l=a._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!i&&n.dispose(a,i))}r&&(i||s.deleteTransformFeedback(r),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}};I4.extension={type:bi.RendererSystem,name:"transformFeedback"};Ni.add(I4);var l1=class{constructor(e){this.renderer=e}init(e){this.screen=new Kr(0,0,e.width,e.height),this.element=e.view||Di.ADAPTER.createCanvas(),this.resolution=e.resolution||Di.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,i){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(i*this.resolution);let r=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=r,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",r,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){var i;e&&((i=this.element.parentNode)==null||i.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}};l1.defaultOptions={width:800,height:600,resolution:Di.RESOLUTION,autoDensity:!1};l1.extension={type:[bi.RendererSystem,bi.CanvasRendererSystem],name:"_view"};Ni.add(l1);Di.PREFER_ENV=Ka.WEBGL2;Di.STRICT_TEXTURE_CACHE=!1;Di.RENDER_OPTIONS=di(di(di(di({},o1.defaultOptions),n1.defaultOptions),l1.defaultOptions),a1.defaultOptions);Object.defineProperties(Di,{WRAP_MODE:{get(){return br.defaultOptions.wrapMode},set(t){Tr("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),br.defaultOptions.wrapMode=t}},SCALE_MODE:{get(){return br.defaultOptions.scaleMode},set(t){Tr("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),br.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get(){return br.defaultOptions.mipmap},set(t){Tr("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),br.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get(){return br.defaultOptions.anisotropicLevel},set(t){Tr("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),br.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get(){return Tr("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),rl.defaultResolution},set(t){rl.defaultResolution=t}},FILTER_MULTISAMPLE:{get(){return Tr("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),rl.defaultMultisample},set(t){rl.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get(){return il.defaultMaxTextures},set(t){Tr("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),il.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get(){return il.defaultBatchSize},set(t){Tr("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),il.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get(){return il.canUploadSameBuffer},set(t){Tr("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),il.canUploadSameBuffer=t}},GC_MODE:{get(){return Ca.defaultMode},set(t){Tr("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Ca.defaultMode=t}},GC_MAX_IDLE:{get(){return Ca.defaultMaxIdle},set(t){Tr("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Ca.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get(){return Ca.defaultCheckCountMax},set(t){Tr("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Ca.defaultCheckCountMax=t}},PRECISION_VERTEX:{get(){return Aa.defaultVertexPrecision},set(t){Tr("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Aa.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get(){return Aa.defaultFragmentPrecision},set(t){Tr("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Aa.defaultFragmentPrecision=t}}});var Jd=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(Jd||{});var k4=class{constructor(e,i=null,r=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=i,this.priority=r,this.once=s}match(e,i=null){return this.fn===e&&this.context===i}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));let i=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),i}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);let i=this.next;return this.next=e?null:i,this.previous=null,i}};var sl=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new k4(null,null,1/0),this.deltaMS=1/sl.targetFPMS,this.elapsedMS=1/sl.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=Jd.NORMAL){return this._addListener(new k4(t,e,i))}addOnce(t,e,i=Jd.NORMAL){return this._addListener(new k4(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){let s=t-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=t-s%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*sl.targetFPMS;let i=this._head,r=i.next;for(;r;)r=r.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){let e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,sl.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{let e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!sl._shared){let t=sl._shared=new sl;t.autoStart=!0,t._protected=!0}return sl._shared}static get system(){if(!sl._system){let t=sl._system=new sl;t.autoStart=!0,t._protected=!0}return sl._system}},sa=sl;sa.targetFPMS=.06;Object.defineProperties(Di,{TARGET_FPMS:{get(){return sa.targetFPMS},set(t){Tr("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),sa.targetFPMS=t}}});var i6=class{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(i){this._ticker&&this._ticker.remove(this.render,this),this._ticker=i,i&&i.add(this.render,this,Jd.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?sa.shared:new sa,e.autoStart&&this.start()}static destroy(){if(this._ticker){let e=this._ticker;this.ticker=null,e.destroy()}}};i6.extension=bi.Application;Ni.add(i6);var $q=[];Ni.handleByList(bi.Renderer,$q);var r6=class{constructor(e){this.renderer=e}contextChange(e){let i;if(this.renderer.context.webGLVersion===1){let r=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),i=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,r)}else{let r=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),i=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,r)}i>=Qr.HIGH?this.multisample=Qr.HIGH:i>=Qr.MEDIUM?this.multisample=Qr.MEDIUM:i>=Qr.LOW?this.multisample=Qr.LOW:this.multisample=Qr.NONE}destroy(){}};r6.extension={type:bi.RendererSystem,name:"_multisample"};Ni.add(r6);var Oy=class{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}};var s6=class{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){let{gl:i,CONTEXT_UID:r}=this,s=e._glBuffers[r]||this.createGLBuffer(e);i.bindBuffer(e.type,s.buffer)}unbind(e){let{gl:i}=this;i.bindBuffer(e,null)}bindBufferBase(e,i){let{gl:r,CONTEXT_UID:s}=this;if(this.boundBufferBases[i]!==e){let n=e._glBuffers[s]||this.createGLBuffer(e);this.boundBufferBases[i]=e,r.bindBufferBase(r.UNIFORM_BUFFER,i,n.buffer)}}bindBufferRange(e,i,r){let{gl:s,CONTEXT_UID:n}=this;r=r||0;let o=e._glBuffers[n]||this.createGLBuffer(e);s.bindBufferRange(s.UNIFORM_BUFFER,i||0,o.buffer,r*256,256)}update(e){let{gl:i,CONTEXT_UID:r}=this,s=e._glBuffers[r]||this.createGLBuffer(e);if(e._updateID!==s.updateID)if(s.updateID=e._updateID,i.bindBuffer(e.type,s.buffer),s.byteLength>=e.data.byteLength)i.bufferSubData(e.type,0,e.data);else{let n=e.static?i.STATIC_DRAW:i.DYNAMIC_DRAW;s.byteLength=e.data.byteLength,i.bufferData(e.type,e.data,n)}}dispose(e,i){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];let r=e._glBuffers[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this),r&&(i||s.deleteBuffer(r.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){let i=Object.keys(this.managedBuffers);for(let r=0;r<i.length;r++)this.dispose(this.managedBuffers[i[r]],e)}createGLBuffer(e){let{CONTEXT_UID:i,gl:r}=this;return e._glBuffers[i]=new Oy(r.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[i]}};s6.extension={type:bi.RendererSystem,name:"buffer"};Ni.add(s6);var n6=class{constructor(e){this.renderer=e}render(e,i){let r=this.renderer,s,n,o,a;if(i&&(s=i.renderTexture,n=i.clear,o=i.transform,a=i.skipUpdateTransform),this.renderingToScreen=!s,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=o,!r.context.isLost){if(s||(this.lastObjectRendered=e),!a){let l=e.enableTempParent();e.updateTransform(),e.disableTempParent(l)}r.renderTexture.bind(s),r.batch.currentRenderer.start(),(n!=null?n:r.background.clearBeforeRender)&&r.renderTexture.clear(),e.render(r),r.batch.currentRenderer.flush(),s&&(i.blit&&r.framebuffer.blit(),s.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}};n6.extension={type:bi.RendererSystem,name:"objectRenderer"};Ni.add(n6);var YT=class extends A4{constructor(t){super(),this.type=wT.WEBGL,t=Object.assign({},Di.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new tl({projectionMatrix:new ps},!0);let e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:YT.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(Tr("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=YT.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t!=null&&t.forceCanvas?!1:AT()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Tr("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Tr("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Tr("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Tr("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){Tr("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return Tr("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){Tr("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return Tr("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}},e0=YT;e0.extension={type:bi.Renderer,priority:1};e0.__plugins={};e0.__systems={};Ni.handleByMap(bi.RendererPlugin,e0.__plugins);Ni.handleByMap(bi.RendererSystem,e0.__systems);Ni.add(e0);var bh=class extends el{constructor(e,i){let{width:r,height:s}=i||{};super(r,s),this.items=[],this.itemDirtyIds=[];for(let n=0;n<e;n++){let o=new br;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,i){for(let r=0;r<this.length;r++)e[r]&&(e[r].castToBaseTexture?this.addBaseTextureAt(e[r].castToBaseTexture(),r):e[r]instanceof el?this.addResourceAt(e[r],r):this.addResourceAt(a4(e[r],i),r))}dispose(){for(let e=0,i=this.length;e<i;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,i){if(!this.items[i])throw new Error(`Index ${i} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[i].setResource(e),this}bind(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let i=0;i<this.length;i++)this.items[i].parentTextureArray=e,this.items[i].on("update",e.update,e)}unbind(e){super.unbind(e);for(let i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",e.update,e)}load(){if(this._load)return this._load;let i=this.items.map(r=>r.resource).filter(r=>r).map(r=>r.load());return this._load=Promise.all(i).then(()=>{let{realWidth:r,realHeight:s}=this.items[0];return this.resize(r,s),Promise.resolve(this)}),this._load}};var M4=class extends bh{constructor(e,i){let{width:r,height:s}=i||{},n,o;Array.isArray(e)?(n=e,o=e.length):o=e,super(o,{width:r,height:s}),n&&this.initFromArray(n,i)}addBaseTextureAt(e,i){if(e.resource)this.addResourceAt(e.resource,i);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(e){super.bind(e),e.target=t1.TEXTURE_2D_ARRAY}upload(e,i,r){let{length:s,itemDirtyIds:n,items:o}=this,{gl:a}=e;r.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,s,0,i.format,r.type,null);for(let l=0;l<s;l++){let c=o[l];n[l]<c.dirtyId&&(n[l]=c.dirtyId,c.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,l,c.resource.width,c.resource.height,1,i.format,r.type,c.resource.source))}return!0}};var P4=class extends ao{constructor(e){super(e)}static test(e){let{OffscreenCanvas:i}=globalThis;return i&&e instanceof i?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}};var o6=class extends bh{constructor(t,e){let{width:i,height:r,autoLoad:s,linkBaseTexture:n}=e||{};if(t&&t.length!==o6.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:r});for(let o=0;o<o6.SIDES;o++)this.items[o].target=t1.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=n!==!1,t&&this.initFromArray(t,e),s!==!1&&this.load()}bind(t){super.bind(t),t.target=t1.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=t1.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,i){let r=this.itemDirtyIds;for(let s=0;s<o6.SIDES;s++){let n=this.items[s];(r[s]<n.dirtyId||i.dirtyId<e.dirtyId)&&(n.valid&&n.resource?(n.resource.upload(t,n,i),r[s]=n.dirtyId):r[s]<-1&&(t.gl.texImage2D(n.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),r[s]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===o6.SIDES}},a6=o6;a6.SIDES=6;var R4=class t extends ao{constructor(e,i){var n;i=i||{};let r,s;typeof e=="string"?(r=t.EMPTY,s=e):(r=e,s=null),super(r),this.url=s,this.crossOrigin=(n=i.crossOrigin)!=null?n:!0,this.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,this._load=null,i.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise((e,i)=>ii(this,null,function*(){if(this.url===null){e(this);return}try{let r=yield Di.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;let s=yield r.blob();if(this.destroyed)return;let n=yield createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ea.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=n,this.update(),e(this)}catch(r){if(this.destroyed)return;i(r),this.onError.emit(r)}})),this._load)}upload(e,i,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),super.upload(e,i,r)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap!="undefined"&&(typeof e=="string"||e instanceof ImageBitmap)}static get EMPTY(){var e;return t._EMPTY=(e=t._EMPTY)!=null?e:Di.ADAPTER.createCanvas(0,0),t._EMPTY}};var By=class extends ao{constructor(t,e){e=e||{},super(Di.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),t(this)},By.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){let t=new Image;ao.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;let e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=e*this.scale,s=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/i*e,s=this._overrideHeight||this._overrideWidth/e*i),r=Math.round(r),s=Math.round(s);let n=this.source;n.width=r,n.height=s,n._pixiId=`canvas_${i1()}`,n.getContext("2d").drawImage(t,0,0,e,i,0,0,r,s),this._resolve(),this._resolve=null}}static getSize(t){let e=By.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&By.SVG_XML.test(t)}},D4=By;D4.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;D4.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var ZT=class extends ao{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){let i=document.createElement("video");i.setAttribute("preload","auto"),i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline",""),typeof t=="string"&&(t=[t]);let r=t[0].src||t[0];ao.crossOrigin(i,r,e.crossorigin);for(let s=0;s<t.length;++s){let n=document.createElement("source"),{src:o,mime:a}=t[s];o=o||t[s];let l=o.split("?").shift().toLowerCase(),c=l.slice(l.lastIndexOf(".")+1);a=a||ZT.MIME_TYPES[c]||`video/${c}`,n.src=o,n.type=a,i.appendChild(n)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){let e=sa.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;let t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise(e=>{this.valid?e(this):(this._resolve=e,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)}_isSourcePlaying(){let t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(sa.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(sa.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){let t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);let e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._isConnectedToTicker&&(sa.shared.remove(this.update,this),this._isConnectedToTicker=!1);let t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(sa.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(sa.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t)}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||ZT.TYPES.includes(e)}},F4=ZT;F4.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];F4.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};o4.push(R4,vh,P4,F4,D4,Qc,a6,M4);var Hq=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Vq=`uniform float radius;
uniform float strength;
uniform vec2 center;
uniform sampler2D uSampler;
varying vec2 vTextureCoord;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec2 dimensions;

void main()
{
    vec2 coord = vTextureCoord * filterArea.xy;
    coord -= center * dimensions.xy;
    float distance = length(coord);
    if (distance < radius) {
        float percent = distance / radius;
        if (strength > 0.0) {
            coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);
        } else {
            coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);
        }
    }
    coord += center * dimensions.xy;
    coord /= filterArea.xy;
    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);
    vec4 color = texture2D(uSampler, clampedCoord);
    if (coord != clampedCoord) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    gl_FragColor = color;
}
`,XL=class extends Wt{constructor(t){super(Hq,Vq),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,XL.defaults,t)}apply(t,e,i,r){let{width:s,height:n}=e.filterFrame;this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,t.applyFilter(this,e,i,r)}get radius(){return this.uniforms.radius}set radius(t){this.uniforms.radius=t}get strength(){return this.uniforms.strength}set strength(t){this.uniforms.strength=t}get center(){return this.uniforms.center}set center(t){this.uniforms.center=t}},jq=XL;jq.defaults={center:[.5,.5],radius:100,strength:1};var Xq=`const float PI = 3.1415926538;
const float PI_2 = PI*2.;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;
uniform sampler2D uSampler;

const int TYPE_LINEAR = 0;
const int TYPE_RADIAL = 1;
const int TYPE_CONIC = 2;
const int MAX_STOPS = 32;

uniform int uNumStops;
uniform float uAlphas[3*MAX_STOPS];
uniform vec3 uColors[MAX_STOPS];
uniform float uOffsets[MAX_STOPS];
uniform int uType;
uniform float uAngle;
uniform float uAlpha;
uniform int uMaxColors;

struct ColorStop {
    float offset;
    vec3 color;
    float alpha;
};

mat2 rotate2d(float angle){
    return mat2(cos(angle), -sin(angle),
    sin(angle), cos(angle));
}

float projectLinearPosition(vec2 pos, float angle){
    vec2 center = vec2(0.5);
    vec2 result = pos - center;
    result = rotate2d(angle) * result;
    result = result + center;
    return clamp(result.x, 0., 1.);
}

float projectRadialPosition(vec2 pos) {
    float r = distance(vFilterCoord, vec2(0.5));
    return clamp(2.*r, 0., 1.);
}

float projectAnglePosition(vec2 pos, float angle) {
    vec2 center = pos - vec2(0.5);
    float polarAngle=atan(-center.y, center.x);
    return mod(polarAngle + angle, PI_2) / PI_2;
}

float projectPosition(vec2 pos, int type, float angle) {
    if (type == TYPE_LINEAR) {
        return projectLinearPosition(pos, angle);
    } else if (type == TYPE_RADIAL) {
        return projectRadialPosition(pos);
    } else if (type == TYPE_CONIC) {
        return projectAnglePosition(pos, angle);
    }

    return pos.y;
}

void main(void) {
    // current/original color
    vec4 currentColor = texture2D(uSampler, vTextureCoord);

    // skip calculations if gradient alpha is 0
    if (0.0 == uAlpha) {
        gl_FragColor = currentColor;
        return;
    }

    // project position
    float y = projectPosition(vFilterCoord, uType, radians(uAngle));

    // check gradient bounds
    float offsetMin = uOffsets[0];
    float offsetMax = 0.0;

    for (int i = 0; i < MAX_STOPS; i++) {
        if (i == uNumStops-1){ // last index
            offsetMax = uOffsets[i];
        }
    }

    if (y  < offsetMin || y > offsetMax) {
        gl_FragColor = currentColor;
        return;
    }

    // limit colors
    if (uMaxColors > 0) {
        float stepSize = 1./float(uMaxColors);
        float stepNumber = float(floor(y/stepSize));
        y = stepSize * (stepNumber + 0.5);// offset by 0.5 to use color from middle of segment
    }

    // find color stops
    ColorStop from;
    ColorStop to;

    for (int i = 0; i < MAX_STOPS; i++) {
        if (y >= uOffsets[i]) {
            from = ColorStop(uOffsets[i], uColors[i], uAlphas[i]);
            to = ColorStop(uOffsets[i+1], uColors[i+1], uAlphas[i+1]);
        }

        if (i == uNumStops-1){ // last index
            break;
        }
    }

    // mix colors from stops
    vec4 colorFrom = vec4(from.color * from.alpha, from.alpha);
    vec4 colorTo = vec4(to.color * to.alpha, to.alpha);

    float segmentHeight = to.offset - from.offset;
    float relativePos = y - from.offset;// position from 0 to [segmentHeight]
    float relativePercent = relativePos / segmentHeight;// position in percent between [from.offset] and [to.offset].

    float gradientAlpha = uAlpha * currentColor.a;
    vec4 gradientColor = mix(colorFrom, colorTo, relativePercent) * gradientAlpha;

    // mix resulting color with current color
    gl_FragColor = gradientColor + currentColor*(1.-gradientColor.a);
}
`,Wq=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform vec4 inputSize;
uniform vec4 outputFrame;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
    vFilterCoord = vTextureCoord * inputSize.xy / outputFrame.zw;
}
`,t0=t0||{};t0.stringify=function(){var t={"visit_linear-gradient":function(e){return t.visit_gradient(e)},"visit_repeating-linear-gradient":function(e){return t.visit_gradient(e)},"visit_radial-gradient":function(e){return t.visit_gradient(e)},"visit_repeating-radial-gradient":function(e){return t.visit_gradient(e)},visit_gradient:function(e){var i=t.visit(e.orientation);return i&&(i+=", "),e.type+"("+i+t.visit(e.colorStops)+")"},visit_shape:function(e){var i=e.value,r=t.visit(e.at),s=t.visit(e.style);return s&&(i+=" "+s),r&&(i+=" at "+r),i},"visit_default-radial":function(e){var i="",r=t.visit(e.at);return r&&(i+=r),i},"visit_extent-keyword":function(e){var i=e.value,r=t.visit(e.at);return r&&(i+=" at "+r),i},"visit_position-keyword":function(e){return e.value},visit_position:function(e){return t.visit(e.value.x)+" "+t.visit(e.value.y)},"visit_%":function(e){return e.value+"%"},visit_em:function(e){return e.value+"em"},visit_px:function(e){return e.value+"px"},visit_literal:function(e){return t.visit_color(e.value,e)},visit_hex:function(e){return t.visit_color("#"+e.value,e)},visit_rgb:function(e){return t.visit_color("rgb("+e.value.join(", ")+")",e)},visit_rgba:function(e){return t.visit_color("rgba("+e.value.join(", ")+")",e)},visit_color:function(e,i){var r=e,s=t.visit(i.length);return s&&(r+=" "+s),r},visit_angular:function(e){return e.value+"deg"},visit_directional:function(e){return"to "+e.value},visit_array:function(e){var i="",r=e.length;return e.forEach(function(s,n){i+=t.visit(s),n<r-1&&(i+=", ")}),i},visit:function(e){if(!e)return"";var i="";if(e instanceof Array)return t.visit_array(e,i);if(e.type){var r=t["visit_"+e.type];if(r)return r(e);throw Error("Missing visitor visit_"+e.type)}else throw Error("Invalid node.")}};return function(e){return t.visit(e)}}();var t0=t0||{};t0.parse=function(){var t={linearGradient:/^(\-(webkit|o|ms|moz)\-)?(linear\-gradient)/i,repeatingLinearGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-linear\-gradient)/i,radialGradient:/^(\-(webkit|o|ms|moz)\-)?(radial\-gradient)/i,repeatingRadialGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-radial\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/^\#([0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^rgb/i,rgbaColor:/^rgba/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/},e="";function i(ne){var ee=new Error(e+": "+ne);throw ee.source=e,ee}function r(){var ne=s();return e.length>0&&i("Invalid input not EOF"),ne}function s(){return M(n)}function n(){return o("linear-gradient",t.linearGradient,l)||o("repeating-linear-gradient",t.repeatingLinearGradient,l)||o("radial-gradient",t.radialGradient,m)||o("repeating-radial-gradient",t.repeatingRadialGradient,m)}function o(ne,ee,re){return a(ee,function(te){var ie=re();return ie&&(le(t.comma)||i("Missing comma before color stops")),{type:ne,orientation:ie,colorStops:M(k)}})}function a(ne,ee){var re=le(ne);if(re){le(t.startCall)||i("Missing (");var te=ee(re);return le(t.endCall)||i("Missing )"),te}}function l(){return c()||d()}function c(){return V("directional",t.sideOrCorner,1)}function d(){return V("angular",t.angleValue,1)}function m(){var ne,ee=g(),re;return ee&&(ne=[],ne.push(ee),re=e,le(t.comma)&&(ee=g(),ee?ne.push(ee):e=re)),ne}function g(){var ne=_()||v();if(ne)ne.at=b();else{var ee=E();if(ee){ne=ee;var re=b();re&&(ne.at=re)}else{var te=T();te&&(ne={type:"default-radial",at:te})}}return ne}function _(){var ne=V("shape",/^(circle)/i,0);return ne&&(ne.style=Q()||E()),ne}function v(){var ne=V("shape",/^(ellipse)/i,0);return ne&&(ne.style=W()||E()),ne}function E(){return V("extent-keyword",t.extentKeywords,1)}function b(){if(V("position",/^at/,0)){var ne=T();return ne||i("Missing positioning value"),ne}}function T(){var ne=A();if(ne.x||ne.y)return{type:"position",value:ne}}function A(){return{x:W(),y:W()}}function M(ne){var ee=ne(),re=[];if(ee)for(re.push(ee);le(t.comma);)ee=ne(),ee?re.push(ee):i("One extra comma");return re}function k(){var ne=F();return ne||i("Expected color definition"),ne.length=W(),ne}function F(){return B()||z()||U()||O()}function O(){return V("literal",t.literalColor,0)}function B(){return V("hex",t.hexColor,1)}function U(){return a(t.rgbColor,function(){return{type:"rgb",value:M(Z)}})}function z(){return a(t.rgbaColor,function(){return{type:"rgba",value:M(Z)}})}function Z(){return le(t.number)[1]}function W(){return V("%",t.percentageValue,1)||q()||Q()}function q(){return V("position-keyword",t.positionKeywords,1)}function Q(){return V("px",t.pixelValue,1)||V("em",t.emValue,1)}function V(ne,ee,re){var te=le(ee);if(te)return{type:ne,value:te[re]}}function le(ne){var ee,re;return re=/^[\n\r\t\s]+/.exec(e),re&&de(re[0].length),ee=ne.exec(e),ee&&de(ee[0].length),ee}function de(ne){e=e.substr(ne)}return function(ne){return e=ne.toString(),r()}}();var qq=t0.parse;t0.stringify;var WL={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},qL={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Yq(t){var e,i=[],r=1,s;if(typeof t=="string")if(WL[t])i=WL[t].slice(),s="rgb";else if(t==="transparent")r=0,s="rgb",i=[0,0,0];else if(/^#[A-Fa-f0-9]+$/.test(t)){var n=t.slice(1),o=n.length,a=o<=4;r=1,a?(i=[parseInt(n[0]+n[0],16),parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16)],o===4&&(r=parseInt(n[3]+n[3],16)/255)):(i=[parseInt(n[0]+n[1],16),parseInt(n[2]+n[3],16),parseInt(n[4]+n[5],16)],o===8&&(r=parseInt(n[6]+n[7],16)/255)),i[0]||(i[0]=0),i[1]||(i[1]=0),i[2]||(i[2]=0),s="rgb"}else if(e=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(t)){var l=e[1],c=l==="rgb",n=l.replace(/a$/,"");s=n;var o=n==="cmyk"?4:n==="gray"?1:3;i=e[2].trim().split(/\s*[,\/]\s*|\s+/).map(function(g,_){if(/%$/.test(g))return _===o?parseFloat(g)/100:n==="rgb"?parseFloat(g)*255/100:parseFloat(g);if(n[_]==="h"){if(/deg$/.test(g))return parseFloat(g);if(qL[g]!==void 0)return qL[g]}return parseFloat(g)}),l===n&&i.push(1),r=c||i[o]===void 0?1:i[o],i=i.slice(0,o)}else t.length>10&&/[0-9](?:\s|\/)/.test(t)&&(i=t.match(/([0-9]+)/g).map(function(d){return parseFloat(d)}),s=t.match(/([a-z])/ig).join("").toLowerCase());else isNaN(t)?Array.isArray(t)||t.length?(i=[t[0],t[1],t[2]],s="rgb",r=t.length===4?t[3]:1):t instanceof Object&&(t.r!=null||t.red!=null||t.R!=null?(s="rgb",i=[t.r||t.red||t.R||0,t.g||t.green||t.G||0,t.b||t.blue||t.B||0]):(s="hsl",i=[t.h||t.hue||t.H||0,t.s||t.saturation||t.S||0,t.l||t.lightness||t.L||t.b||t.brightness]),r=t.a||t.alpha||t.opacity||1,t.opacity!=null&&(r/=100)):(s="rgb",i=[t>>>16,(t&65280)>>>8,t&255]);return{space:s,values:i,alpha:r}}var JT={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]},QT={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(t){var e=t[0]/360,i=t[1]/100,r=t[2]/100,s,n,o,a,l;if(i===0)return l=r*255,[l,l,l];r<.5?n=r*(1+i):n=r+i-r*i,s=2*r-n,a=[0,0,0];for(var c=0;c<3;c++)o=e+1/3*-(c-1),o<0?o++:o>1&&o--,6*o<1?l=s+(n-s)*6*o:2*o<1?l=n:3*o<2?l=s+(n-s)*(2/3-o)*6:l=s,a[c]=l*255;return a}};JT.hsl=function(t){var e=t[0]/255,i=t[1]/255,r=t[2]/255,s=Math.min(e,i,r),n=Math.max(e,i,r),o=n-s,a,l,c;return n===s?a=0:e===n?a=(i-r)/o:i===n?a=2+(r-e)/o:r===n&&(a=4+(e-i)/o),a=Math.min(a*60,360),a<0&&(a+=360),c=(s+n)/2,n===s?l=0:c<=.5?l=o/(n+s):l=o/(2-n-s),[a,l*100,c*100]};function Zq(t){Array.isArray(t)&&t.raw&&(t=String.raw(...arguments));var e,i=Yq(t);if(!i.space)return[];let r=i.space[0]==="h"?QT.min:JT.min,s=i.space[0]==="h"?QT.max:JT.max;return e=Array(3),e[0]=Math.min(Math.max(i.values[0],r[0]),s[0]),e[1]=Math.min(Math.max(i.values[1],r[1]),s[1]),e[2]=Math.min(Math.max(i.values[2],r[2]),s[2]),i.space[0]==="h"&&(e=QT.rgb(e)),e.push(Math.min(Math.max(i.alpha,0),1)),e}function KL(t){switch(typeof t){case"string":return Qq(t);case"number":return St.hex2rgb(t);default:return t}}function Qq(t){let e=Zq(t);if(!e)throw new Error(`Unable to parse color "${t}" as RGBA.`);return[e[0]/255,e[1]/255,e[2]/255,e[3]]}function Kq(t){let e=qq(aY(t));if(e.length===0)throw new Error("Invalid CSS gradient.");if(e.length!==1)throw new Error("Unsupported CSS gradient (multiple gradients is not supported).");let i=e[0],r=Jq(i.type),s=eY(i.colorStops),n=nY(i.orientation);return{type:r,stops:s,angle:n}}function Jq(t){let e={"linear-gradient":0,"radial-gradient":1};if(!(t in e))throw new Error(`Unsupported gradient type "${t}"`);return e[t]}function eY(t){let e=rY(t),i=[];for(let r=0;r<t.length;r++){let s=tY(t[r]);i.push({offset:e[r],color:s.slice(0,3),alpha:s[3]})}return i}function tY(t){return KL(iY(t))}function iY(t){switch(t.type){case"hex":return`#${t.value}`;case"literal":return t.value;default:return`${t.type}(${t.value.join(",")})`}}function rY(t){let e=[];for(let s=0;s<t.length;s++){let n=t[s],o=-1;n.type==="literal"&&n.length&&"type"in n.length&&n.length.type==="%"&&"value"in n.length&&(o=parseFloat(n.length.value)/100),e.push(o)}let i=s=>{for(let n=s;n<e.length;n++)if(e[n]!==-1)return{indexDelta:n-s,offset:e[n]};return{indexDelta:e.length-1-s,offset:1}},r=0;for(let s=0;s<e.length;s++){let n=e[s];if(n!==-1)r=n;else if(s===0)e[s]=0;else if(s+1===e.length)e[s]=1;else{let o=i(s),a=(o.offset-r)/(1+o.indexDelta);for(let l=0;l<=o.indexDelta;l++)e[s+l]=r+(l+1)*a;s+=o.indexDelta,r=e[s]}}return e.map(sY)}function sY(t){return t.toString().length>6?parseFloat(t.toString().substring(0,6)):t}function nY(t){if(typeof t=="undefined")return 0;if("type"in t&&"value"in t)switch(t.type){case"angular":return parseFloat(t.value);case"directional":return oY(t.value)}return 0}function oY(t){let e={left:270,top:0,bottom:180,right:90,"left top":315,"top left":315,"left bottom":225,"bottom left":225,"right top":45,"top right":45,"right bottom":135,"bottom right":135};if(!(t in e))throw new Error(`Unsupported directional value "${t}"`);return e[t]}function aY(t){let e=t.replace(/\s{2,}/gu," ");return e=e.replace(/;/g,""),e=e.replace(/ ,/g,","),e=e.replace(/\( /g,"("),e=e.replace(/ \)/g,")"),e.trim()}var lY=Object.defineProperty,cY=Object.defineProperties,uY=Object.getOwnPropertyDescriptors,YL=Object.getOwnPropertySymbols,hY=Object.prototype.hasOwnProperty,dY=Object.prototype.propertyIsEnumerable,ZL=(t,e,i)=>e in t?lY(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,KT=(t,e)=>{for(var i in e||(e={}))hY.call(e,i)&&ZL(t,i,e[i]);if(YL)for(var i of YL(e))dY.call(e,i)&&ZL(t,i,e[i]);return t},fY=(t,e)=>cY(t,uY(e)),QL=90;function pY(t){return[...t].sort((e,i)=>e.offset-i.offset)}var eS=class extends Wt{constructor(t){t&&"css"in t&&(t=fY(KT({},Kq(t.css||"")),{alpha:t.alpha,maxColors:t.maxColors}));let e=KT(KT({},eS.defaults),t);if(!e.stops||e.stops.length<2)throw new Error("ColorGradientFilter requires at least 2 color stops.");super(Wq,Xq),this._stops=[],this.autoFit=!1,Object.assign(this,e)}get stops(){return this._stops}set stops(t){let e=pY(t),i=new Float32Array(e.length*3),r=0,s=1,n=2;for(let o=0;o<e.length;o++){let a=KL(e[o].color),l=o*3;i[l+r]=a[r],i[l+s]=a[s],i[l+n]=a[n]}this.uniforms.uColors=i,this.uniforms.uOffsets=e.map(o=>o.offset),this.uniforms.uAlphas=e.map(o=>o.alpha),this.uniforms.uNumStops=e.length,this._stops=e}set type(t){this.uniforms.uType=t}get type(){return this.uniforms.uType}set angle(t){this.uniforms.uAngle=t-QL}get angle(){return this.uniforms.uAngle+QL}set alpha(t){this.uniforms.uAlpha=t}get alpha(){return this.uniforms.uAlpha}set maxColors(t){this.uniforms.uMaxColors=t}get maxColors(){return this.uniforms.uMaxColors}},Uy=eS;Uy.LINEAR=0,Uy.RADIAL=1,Uy.CONIC=2,Uy.defaults={type:eS.LINEAR,stops:[{offset:0,color:16711680,alpha:1},{offset:1,color:255,alpha:1}],alpha:1,angle:90,maxColors:0};var mY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,gY=`precision mediump float;

varying mediump vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec2 texelSize;
uniform float matrix[9];

void main(void)
{
   vec4 c11 = texture2D(uSampler, vTextureCoord - texelSize); // top left
   vec4 c12 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - texelSize.y)); // top center
   vec4 c13 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y - texelSize.y)); // top right

   vec4 c21 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y)); // mid left
   vec4 c22 = texture2D(uSampler, vTextureCoord); // mid center
   vec4 c23 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y)); // mid right

   vec4 c31 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y + texelSize.y)); // bottom left
   vec4 c32 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + texelSize.y)); // bottom center
   vec4 c33 = texture2D(uSampler, vTextureCoord + texelSize); // bottom right

   gl_FragColor =
       c11 * matrix[0] + c12 * matrix[1] + c13 * matrix[2] +
       c21 * matrix[3] + c22 * matrix[4] + c23 * matrix[5] +
       c31 * matrix[6] + c32 * matrix[7] + c33 * matrix[8];

   gl_FragColor.a = c22.a;
}
`,zy=class extends Wt{constructor(e,i=200,r=200){super(mY,gY),this.uniforms.texelSize=new Float32Array(2),this.uniforms.matrix=new Float32Array(9),e!==void 0&&(this.matrix=e),this.width=i,this.height=r}get matrix(){return this.uniforms.matrix}set matrix(e){e.forEach((i,r)=>{this.uniforms.matrix[r]=i})}get width(){return 1/this.uniforms.texelSize[0]}set width(e){this.uniforms.texelSize[0]=1/e}get height(){return 1/this.uniforms.texelSize[1]}set height(e){this.uniforms.texelSize[1]=1/e}};var yY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,_Y=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec4 filterArea;
uniform vec2 dimensions;

const float SQRT_2 = 1.414213;

const float light = 1.0;

uniform float curvature;
uniform float lineWidth;
uniform float lineContrast;
uniform bool verticalLine;
uniform float noise;
uniform float noiseSize;

uniform float vignetting;
uniform float vignettingAlpha;
uniform float vignettingBlur;

uniform float seed;
uniform float time;

float rand(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main(void)
{
    vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;
    vec2 dir = vec2(vTextureCoord.xy * filterArea.xy / dimensions - vec2(0.5, 0.5));
    
    gl_FragColor = texture2D(uSampler, vTextureCoord);
    vec3 rgb = gl_FragColor.rgb;

    if (noise > 0.0 && noiseSize > 0.0)
    {
        pixelCoord.x = floor(pixelCoord.x / noiseSize);
        pixelCoord.y = floor(pixelCoord.y / noiseSize);
        float _noise = rand(pixelCoord * noiseSize * seed) - 0.5;
        rgb += _noise * noise;
    }

    if (lineWidth > 0.0)
    {
        float _c = curvature > 0. ? curvature : 1.;
        float k = curvature > 0. ?(length(dir * dir) * 0.25 * _c * _c + 0.935 * _c) : 1.;
        vec2 uv = dir * k;

        float v = (verticalLine ? uv.x * dimensions.x : uv.y * dimensions.y) * min(1.0, 2.0 / lineWidth ) / _c;
        float j = 1. + cos(v * 1.2 - time) * 0.5 * lineContrast;
        rgb *= j;
        float segment = verticalLine ? mod((dir.x + .5) * dimensions.x, 4.) : mod((dir.y + .5) * dimensions.y, 4.);
        rgb *= 0.99 + ceil(segment) * 0.015;
    }

    if (vignetting > 0.0)
    {
        float outter = SQRT_2 - vignetting * SQRT_2;
        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignettingBlur * SQRT_2), 0.0, 1.0);
        rgb *= darker + (1.0 - darker) * (1.0 - vignettingAlpha);
    }

    gl_FragColor.rgb = rgb;
}
`,JL=class extends Wt{constructor(t){super(yY,_Y),this.time=0,this.seed=0,this.uniforms.dimensions=new Float32Array(2),Object.assign(this,JL.defaults,t)}apply(t,e,i,r){let{width:s,height:n}=e.filterFrame;this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,this.uniforms.seed=this.seed,this.uniforms.time=this.time,t.applyFilter(this,e,i,r)}set curvature(t){this.uniforms.curvature=t}get curvature(){return this.uniforms.curvature}set lineWidth(t){this.uniforms.lineWidth=t}get lineWidth(){return this.uniforms.lineWidth}set lineContrast(t){this.uniforms.lineContrast=t}get lineContrast(){return this.uniforms.lineContrast}set verticalLine(t){this.uniforms.verticalLine=t}get verticalLine(){return this.uniforms.verticalLine}set noise(t){this.uniforms.noise=t}get noise(){return this.uniforms.noise}set noiseSize(t){this.uniforms.noiseSize=t}get noiseSize(){return this.uniforms.noiseSize}set vignetting(t){this.uniforms.vignetting=t}get vignetting(){return this.uniforms.vignetting}set vignettingAlpha(t){this.uniforms.vignettingAlpha=t}get vignettingAlpha(){return this.uniforms.vignettingAlpha}set vignettingBlur(t){this.uniforms.vignettingBlur=t}get vignettingBlur(){return this.uniforms.vignettingBlur}},xY=JL;xY.defaults={curvature:1,lineWidth:1,lineContrast:.25,verticalLine:!1,noise:0,noiseSize:1,seed:0,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3,time:0};var vY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,bY=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float alpha;
uniform vec3 color;

uniform vec2 shift;
uniform vec4 inputSize;

void main(void){
    vec4 sample = texture2D(uSampler, vTextureCoord - shift * inputSize.zw);

    // Premultiply alpha
    sample.rgb = color.rgb * sample.a;

    // alpha user alpha
    sample *= alpha;

    gl_FragColor = sample;
}`,wY=Object.defineProperty,eN=Object.getOwnPropertySymbols,EY=Object.prototype.hasOwnProperty,TY=Object.prototype.propertyIsEnumerable,tN=(t,e,i)=>e in t?wY(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,iN=(t,e)=>{for(var i in e||(e={}))EY.call(e,i)&&tN(t,i,e[i]);if(eN)for(var i of eN(e))TY.call(e,i)&&tN(t,i,e[i]);return t},tS=class extends Wt{constructor(t){super(),this.angle=45,this._distance=5,this._resolution=ht.FILTER_RESOLUTION;let e=t?iN(iN({},tS.defaults),t):tS.defaults,{kernels:i,blur:r,quality:s,pixelSize:n,resolution:o}=e;this._offset=new Ko(this._updatePadding,this),this._tintFilter=new Wt(vY,bY),this._tintFilter.uniforms.color=new Float32Array(4),this._tintFilter.uniforms.shift=this._offset,this._tintFilter.resolution=o,this._blurFilter=i?new mh(i):new mh(r,s),this.pixelSize=n,this.resolution=o;let{shadowOnly:a,rotation:l,distance:c,offset:d,alpha:m,color:g}=e;this.shadowOnly=a,l!==void 0&&c!==void 0?(this.rotation=l,this.distance=c):this.offset=d,this.alpha=m,this.color=g}apply(t,e,i,r){let s=t.getFilterTexture();this._tintFilter.apply(t,e,s,1),this._blurFilter.apply(t,s,i,r),this.shadowOnly!==!0&&t.applyFilter(this,e,i,0),t.returnFilterTexture(s)}_updatePadding(){let t=Math.max(Math.abs(this._offset.x),Math.abs(this._offset.y));this.padding=t+this.blur*2}_updateShift(){this._tintFilter.uniforms.shift.set(this.distance*Math.cos(this.angle),this.distance*Math.sin(this.angle))}set offset(t){this._offset.copyFrom(t),this._updatePadding()}get offset(){return this._offset}get resolution(){return this._resolution}set resolution(t){this._resolution=t,this._tintFilter&&(this._tintFilter.resolution=t),this._blurFilter&&(this._blurFilter.resolution=t)}get distance(){return this._distance}set distance(t){St.deprecation("5.3.0","DropShadowFilter distance is deprecated, use offset"),this._distance=t,this._updatePadding(),this._updateShift()}get rotation(){return this.angle/ic}set rotation(t){St.deprecation("5.3.0","DropShadowFilter rotation is deprecated, use offset"),this.angle=t*ic,this._updateShift()}get alpha(){return this._tintFilter.uniforms.alpha}set alpha(t){this._tintFilter.uniforms.alpha=t}get color(){return St.rgb2hex(this._tintFilter.uniforms.color)}set color(t){St.hex2rgb(t,this._tintFilter.uniforms.color)}get kernels(){return this._blurFilter.kernels}set kernels(t){this._blurFilter.kernels=t}get blur(){return this._blurFilter.blur}set blur(t){this._blurFilter.blur=t,this._updatePadding()}get quality(){return this._blurFilter.quality}set quality(t){this._blurFilter.quality=t}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(t){this._blurFilter.pixelSize=t}},SY=tS;SY.defaults={offset:{x:4,y:4},color:0,alpha:.5,shadowOnly:!1,kernels:null,blur:2,quality:3,pixelSize:1,resolution:ht.FILTER_RESOLUTION};var AY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,CY=`// precision highp float;

varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec2 dimensions;
uniform float aspect;

uniform sampler2D displacementMap;
uniform float offset;
uniform float sinDir;
uniform float cosDir;
uniform int fillMode;

uniform float seed;
uniform vec2 red;
uniform vec2 green;
uniform vec2 blue;

const int TRANSPARENT = 0;
const int ORIGINAL = 1;
const int LOOP = 2;
const int CLAMP = 3;
const int MIRROR = 4;

void main(void)
{
    vec2 coord = (vTextureCoord * filterArea.xy) / dimensions;

    if (coord.x > 1.0 || coord.y > 1.0) {
        return;
    }

    float cx = coord.x - 0.5;
    float cy = (coord.y - 0.5) * aspect;
    float ny = (-sinDir * cx + cosDir * cy) / aspect + 0.5;

    // displacementMap: repeat
    // ny = ny > 1.0 ? ny - 1.0 : (ny < 0.0 ? 1.0 + ny : ny);

    // displacementMap: mirror
    ny = ny > 1.0 ? 2.0 - ny : (ny < 0.0 ? -ny : ny);

    vec4 dc = texture2D(displacementMap, vec2(0.5, ny));

    float displacement = (dc.r - dc.g) * (offset / filterArea.x);

    coord = vTextureCoord + vec2(cosDir * displacement, sinDir * displacement * aspect);

    if (fillMode == CLAMP) {
        coord = clamp(coord, filterClamp.xy, filterClamp.zw);
    } else {
        if( coord.x > filterClamp.z ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.x -= filterClamp.z;
            } else if (fillMode == MIRROR) {
                coord.x = filterClamp.z * 2.0 - coord.x;
            }
        } else if( coord.x < filterClamp.x ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.x += filterClamp.z;
            } else if (fillMode == MIRROR) {
                coord.x *= -filterClamp.z;
            }
        }

        if( coord.y > filterClamp.w ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.y -= filterClamp.w;
            } else if (fillMode == MIRROR) {
                coord.y = filterClamp.w * 2.0 - coord.y;
            }
        } else if( coord.y < filterClamp.y ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.y += filterClamp.w;
            } else if (fillMode == MIRROR) {
                coord.y *= -filterClamp.w;
            }
        }
    }

    gl_FragColor.r = texture2D(uSampler, coord + red * (1.0 - seed * 0.4) / filterArea.xy).r;
    gl_FragColor.g = texture2D(uSampler, coord + green * (1.0 - seed * 0.3) / filterArea.xy).g;
    gl_FragColor.b = texture2D(uSampler, coord + blue * (1.0 - seed * 0.2) / filterArea.xy).b;
    gl_FragColor.a = texture2D(uSampler, coord).a;
}
`,iS=class extends Wt{constructor(t){super(AY,CY),this.offset=100,this.fillMode=iS.TRANSPARENT,this.average=!1,this.seed=0,this.minSize=8,this.sampleSize=512,this._slices=0,this._offsets=new Float32Array(1),this._sizes=new Float32Array(1),this._direction=-1,this.uniforms.dimensions=new Float32Array(2),this._canvas=document.createElement("canvas"),this._canvas.width=4,this._canvas.height=this.sampleSize,this.texture=Yt.from(this._canvas,{scaleMode:io.NEAREST}),Object.assign(this,iS.defaults,t)}apply(t,e,i,r){let{width:s,height:n}=e.filterFrame;this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,this.uniforms.aspect=n/s,this.uniforms.seed=this.seed,this.uniforms.offset=this.offset,this.uniforms.fillMode=this.fillMode,t.applyFilter(this,e,i,r)}_randomizeSizes(){let t=this._sizes,e=this._slices-1,i=this.sampleSize,r=Math.min(this.minSize/i,.9/this._slices);if(this.average){let s=this._slices,n=1;for(let o=0;o<e;o++){let a=n/(s-o),l=Math.max(a*(1-Math.random()*.6),r);t[o]=l,n-=l}t[e]=n}else{let s=1,n=Math.sqrt(1/this._slices);for(let o=0;o<e;o++){let a=Math.max(n*s*Math.random(),r);t[o]=a,s-=a}t[e]=s}this.shuffle()}shuffle(){let t=this._sizes,e=this._slices-1;for(let i=e;i>0;i--){let r=Math.random()*i>>0,s=t[i];t[i]=t[r],t[r]=s}}_randomizeOffsets(){for(let t=0;t<this._slices;t++)this._offsets[t]=Math.random()*(Math.random()<.5?-1:1)}refresh(){this._randomizeSizes(),this._randomizeOffsets(),this.redraw()}redraw(){let t=this.sampleSize,e=this.texture,i=this._canvas.getContext("2d");i.clearRect(0,0,8,t);let r,s=0;for(let n=0;n<this._slices;n++){r=Math.floor(this._offsets[n]*256);let o=this._sizes[n]*t,a=r>0?r:0,l=r<0?-r:0;i.fillStyle=`rgba(${a}, ${l}, 0, 1)`,i.fillRect(0,s>>0,t,o+1>>0),s+=o}e.baseTexture.update(),this.uniforms.displacementMap=e}set sizes(t){let e=Math.min(this._slices,t.length);for(let i=0;i<e;i++)this._sizes[i]=t[i]}get sizes(){return this._sizes}set offsets(t){let e=Math.min(this._slices,t.length);for(let i=0;i<e;i++)this._offsets[i]=t[i]}get offsets(){return this._offsets}get slices(){return this._slices}set slices(t){this._slices!==t&&(this._slices=t,this.uniforms.slices=t,this._sizes=this.uniforms.slicesWidth=new Float32Array(t),this._offsets=this.uniforms.slicesOffset=new Float32Array(t),this.refresh())}get direction(){return this._direction}set direction(t){if(this._direction===t)return;this._direction=t;let e=t*ic;this.uniforms.sinDir=Math.sin(e),this.uniforms.cosDir=Math.cos(e)}get red(){return this.uniforms.red}set red(t){this.uniforms.red=t}get green(){return this.uniforms.green}set green(t){this.uniforms.green=t}get blue(){return this.uniforms.blue}set blue(t){this.uniforms.blue=t}destroy(){var t;(t=this.texture)==null||t.destroy(!0),this.texture=this._canvas=this.red=this.green=this.blue=this._sizes=this._offsets=null}},L4=iS;L4.defaults={slices:5,offset:100,direction:0,fillMode:0,average:!1,seed:0,red:[0,0],green:[0,0],blue:[0,0],minSize:8,sampleSize:512},L4.TRANSPARENT=0,L4.ORIGINAL=1,L4.LOOP=2,L4.CLAMP=3,L4.MIRROR=4;var IY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,kY=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

uniform float outerStrength;
uniform float innerStrength;

uniform vec4 glowColor;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform bool knockout;
uniform float alpha;

const float PI = 3.14159265358979323846264;

const float DIST = __DIST__;
const float ANGLE_STEP_SIZE = min(__ANGLE_STEP_SIZE__, PI * 2.0);
const float ANGLE_STEP_NUM = ceil(PI * 2.0 / ANGLE_STEP_SIZE);

const float MAX_TOTAL_ALPHA = ANGLE_STEP_NUM * DIST * (DIST + 1.0) / 2.0;

void main(void) {
    vec2 px = vec2(1.0 / filterArea.x, 1.0 / filterArea.y);

    float totalAlpha = 0.0;

    vec2 direction;
    vec2 displaced;
    vec4 curColor;

    for (float angle = 0.0; angle < PI * 2.0; angle += ANGLE_STEP_SIZE) {
       direction = vec2(cos(angle), sin(angle)) * px;

       for (float curDistance = 0.0; curDistance < DIST; curDistance++) {
           displaced = clamp(vTextureCoord + direction * 
                   (curDistance + 1.0), filterClamp.xy, filterClamp.zw);

           curColor = texture2D(uSampler, displaced);

           totalAlpha += (DIST - curDistance) * curColor.a;
       }
    }
    
    curColor = texture2D(uSampler, vTextureCoord);

    float alphaRatio = (totalAlpha / MAX_TOTAL_ALPHA);

    float innerGlowAlpha = (1.0 - alphaRatio) * innerStrength * curColor.a;
    float innerGlowStrength = min(1.0, innerGlowAlpha);
    
    vec4 innerColor = mix(curColor, glowColor, innerGlowStrength);

    float outerGlowAlpha = alphaRatio * outerStrength * (1. - curColor.a);
    float outerGlowStrength = min(1.0 - innerColor.a, outerGlowAlpha);

    if (knockout) {
      float resultAlpha = (outerGlowAlpha + innerGlowAlpha) * alpha;
      gl_FragColor = vec4(glowColor.rgb * resultAlpha, resultAlpha);
    }
    else {
      vec4 outerGlowColor = outerGlowStrength * glowColor.rgba * alpha;
      gl_FragColor = innerColor + outerGlowColor;
    }
}
`,rN=class extends Wt{constructor(t){let e=Object.assign({},rN.defaults,t),{outerStrength:i,innerStrength:r,color:s,knockout:n,quality:o,alpha:a}=e,l=Math.round(e.distance);super(IY,kY.replace(/__ANGLE_STEP_SIZE__/gi,`${(1/o/l).toFixed(7)}`).replace(/__DIST__/gi,`${l.toFixed(0)}.0`)),this.uniforms.glowColor=new Float32Array([0,0,0,1]),this.uniforms.alpha=1,Object.assign(this,{color:s,outerStrength:i,innerStrength:r,padding:l,knockout:n,alpha:a})}get color(){return St.rgb2hex(this.uniforms.glowColor)}set color(t){St.hex2rgb(t,this.uniforms.glowColor)}get outerStrength(){return this.uniforms.outerStrength}set outerStrength(t){this.uniforms.outerStrength=t}get innerStrength(){return this.uniforms.innerStrength}set innerStrength(t){this.uniforms.innerStrength=t}get knockout(){return this.uniforms.knockout}set knockout(t){this.uniforms.knockout=t}get alpha(){return this.uniforms.alpha}set alpha(t){this.uniforms.alpha=t}},Jc=rN;Jc.defaults={distance:10,outerStrength:4,innerStrength:0,color:16777215,quality:.1,knockout:!1,alpha:1};var MY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,PY=`vec3 mod289(vec3 x)
{
    return x - floor(x * (1.0 / 289.0)) * 289.0;
}
vec4 mod289(vec4 x)
{
    return x - floor(x * (1.0 / 289.0)) * 289.0;
}
vec4 permute(vec4 x)
{
    return mod289(((x * 34.0) + 1.0) * x);
}
vec4 taylorInvSqrt(vec4 r)
{
    return 1.79284291400159 - 0.85373472095314 * r;
}
vec3 fade(vec3 t)
{
    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);
}
// Classic Perlin noise, periodic variant
float pnoise(vec3 P, vec3 rep)
{
    vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period
    vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period
    Pi0 = mod289(Pi0);
    Pi1 = mod289(Pi1);
    vec3 Pf0 = fract(P); // Fractional part for interpolation
    vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
    vec4 iy = vec4(Pi0.yy, Pi1.yy);
    vec4 iz0 = Pi0.zzzz;
    vec4 iz1 = Pi1.zzzz;
    vec4 ixy = permute(permute(ix) + iy);
    vec4 ixy0 = permute(ixy + iz0);
    vec4 ixy1 = permute(ixy + iz1);
    vec4 gx0 = ixy0 * (1.0 / 7.0);
    vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
    gx0 = fract(gx0);
    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
    vec4 sz0 = step(gz0, vec4(0.0));
    gx0 -= sz0 * (step(0.0, gx0) - 0.5);
    gy0 -= sz0 * (step(0.0, gy0) - 0.5);
    vec4 gx1 = ixy1 * (1.0 / 7.0);
    vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
    gx1 = fract(gx1);
    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
    vec4 sz1 = step(gz1, vec4(0.0));
    gx1 -= sz1 * (step(0.0, gx1) - 0.5);
    gy1 -= sz1 * (step(0.0, gy1) - 0.5);
    vec3 g000 = vec3(gx0.x, gy0.x, gz0.x);
    vec3 g100 = vec3(gx0.y, gy0.y, gz0.y);
    vec3 g010 = vec3(gx0.z, gy0.z, gz0.z);
    vec3 g110 = vec3(gx0.w, gy0.w, gz0.w);
    vec3 g001 = vec3(gx1.x, gy1.x, gz1.x);
    vec3 g101 = vec3(gx1.y, gy1.y, gz1.y);
    vec3 g011 = vec3(gx1.z, gy1.z, gz1.z);
    vec3 g111 = vec3(gx1.w, gy1.w, gz1.w);
    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
    g000 *= norm0.x;
    g010 *= norm0.y;
    g100 *= norm0.z;
    g110 *= norm0.w;
    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
    g001 *= norm1.x;
    g011 *= norm1.y;
    g101 *= norm1.z;
    g111 *= norm1.w;
    float n000 = dot(g000, Pf0);
    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
    float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
    float n111 = dot(g111, Pf1);
    vec3 fade_xyz = fade(Pf0);
    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);
    return 2.2 * n_xyz;
}
float turb(vec3 P, vec3 rep, float lacunarity, float gain)
{
    float sum = 0.0;
    float sc = 1.0;
    float totalgain = 1.0;
    for (float i = 0.0; i < 6.0; i++)
    {
        sum += totalgain * pnoise(P * sc, rep);
        sc *= lacunarity;
        totalgain *= gain;
    }
    return abs(sum);
}
`,RY=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterArea;
uniform vec2 dimensions;

uniform vec2 light;
uniform bool parallel;
uniform float aspect;

uniform float gain;
uniform float lacunarity;
uniform float time;
uniform float alpha;

\${perlin}

void main(void) {
    vec2 coord = vTextureCoord * filterArea.xy / dimensions.xy;

    float d;

    if (parallel) {
        float _cos = light.x;
        float _sin = light.y;
        d = (_cos * coord.x) + (_sin * coord.y * aspect);
    } else {
        float dx = coord.x - light.x / dimensions.x;
        float dy = (coord.y - light.y / dimensions.y) * aspect;
        float dis = sqrt(dx * dx + dy * dy) + 0.00001;
        d = dy / dis;
    }

    vec3 dir = vec3(d, d, 0.0);

    float noise = turb(dir + vec3(time, 0.0, 62.1 + time) * 0.05, vec3(480.0, 320.0, 480.0), lacunarity, gain);
    noise = mix(noise, 0.0, 0.3);
    //fade vertically.
    vec4 mist = vec4(noise, noise, noise, 1.0) * (1.0 - coord.y);
    mist.a = 1.0;
    // apply user alpha
    mist *= alpha;

    gl_FragColor = texture2D(uSampler, vTextureCoord) + mist;

}
`,sN=class extends Wt{constructor(t){super(MY,RY.replace("${perlin}",PY)),this.parallel=!0,this.time=0,this._angle=0,this.uniforms.dimensions=new Float32Array(2);let e=Object.assign(sN.defaults,t);this._angleLight=new ei,this.angle=e.angle,this.gain=e.gain,this.lacunarity=e.lacunarity,this.alpha=e.alpha,this.parallel=e.parallel,this.center=e.center,this.time=e.time}apply(t,e,i,r){let{width:s,height:n}=e.filterFrame;this.uniforms.light=this.parallel?this._angleLight:this.center,this.uniforms.parallel=this.parallel,this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,this.uniforms.aspect=n/s,this.uniforms.time=this.time,this.uniforms.alpha=this.alpha,t.applyFilter(this,e,i,r)}get angle(){return this._angle}set angle(t){this._angle=t;let e=t*ic;this._angleLight.x=Math.cos(e),this._angleLight.y=Math.sin(e)}get gain(){return this.uniforms.gain}set gain(t){this.uniforms.gain=t}get lacunarity(){return this.uniforms.lacunarity}set lacunarity(t){this.uniforms.lacunarity=t}get alpha(){return this.uniforms.alpha}set alpha(t){this.uniforms.alpha=t}},DY=sN;DY.defaults={angle:30,gain:.5,lacunarity:2.5,time:0,parallel:!0,center:[0,0],alpha:1};var FY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,LY=`precision mediump float;

varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float uHue;
uniform float uAlpha;
uniform bool uColorize;
uniform float uSaturation;
uniform float uLightness;

// https://en.wikipedia.org/wiki/Luma_(video)
const vec3 weight = vec3(0.299, 0.587, 0.114);

float getWeightedAverage(vec3 rgb) {
    return rgb.r * weight.r + rgb.g * weight.g + rgb.b * weight.b;
}

// https://gist.github.com/mairod/a75e7b44f68110e1576d77419d608786?permalink_comment_id=3195243#gistcomment-3195243
const vec3 k = vec3(0.57735, 0.57735, 0.57735);

vec3 hueShift(vec3 color, float angle) {
    float cosAngle = cos(angle);
    return vec3(
    color * cosAngle +
    cross(k, color) * sin(angle) +
    k * dot(k, color) * (1.0 - cosAngle)
    );
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    vec4 result = color;

    // colorize
    if (uColorize) {
        result.rgb = vec3(getWeightedAverage(result.rgb), 0., 0.);
    }

    // hue
    result.rgb = hueShift(result.rgb, uHue);

    // saturation
    // https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/huesaturation.js
    float average = (result.r + result.g + result.b) / 3.0;

    if (uSaturation > 0.) {
        result.rgb += (average - result.rgb) * (1. - 1. / (1.001 - uSaturation));
    } else {
        result.rgb -= (average - result.rgb) * uSaturation;
    }

    // lightness
    result.rgb = mix(result.rgb, vec3(ceil(uLightness)) * color.a, abs(uLightness));

    // alpha
    gl_FragColor = mix(color, result, uAlpha);
}
`,nN=class extends Wt{constructor(t){super(FY,LY),this._hue=0;let e=Object.assign({},nN.defaults,t);Object.assign(this,e)}get hue(){return this._hue}set hue(t){this._hue=t,this.uniforms.uHue=this._hue*(Math.PI/180)}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}get colorize(){return this.uniforms.uColorize}set colorize(t){this.uniforms.uColorize=t}get lightness(){return this.uniforms.uLightness}set lightness(t){this.uniforms.uLightness=t}get saturation(){return this.uniforms.uSaturation}set saturation(t){this.uniforms.uSaturation=t}},NY=nN;NY.defaults={hue:0,saturation:0,lightness:0,colorize:!1,alpha:1};var OY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,BY=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterArea;
uniform vec2 dimensions;

uniform float sepia;
uniform float noise;
uniform float noiseSize;
uniform float scratch;
uniform float scratchDensity;
uniform float scratchWidth;
uniform float vignetting;
uniform float vignettingAlpha;
uniform float vignettingBlur;
uniform float seed;

const float SQRT_2 = 1.414213;
const vec3 SEPIA_RGB = vec3(112.0 / 255.0, 66.0 / 255.0, 20.0 / 255.0);

float rand(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

vec3 Overlay(vec3 src, vec3 dst)
{
    // if (dst <= 0.5) then: 2 * src * dst
    // if (dst > 0.5) then: 1 - 2 * (1 - dst) * (1 - src)
    return vec3((dst.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)),
                (dst.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)),
                (dst.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)));
}


void main()
{
    gl_FragColor = texture2D(uSampler, vTextureCoord);
    vec3 color = gl_FragColor.rgb;

    if (sepia > 0.0)
    {
        float gray = (color.x + color.y + color.z) / 3.0;
        vec3 grayscale = vec3(gray);

        color = Overlay(SEPIA_RGB, grayscale);

        color = grayscale + sepia * (color - grayscale);
    }

    vec2 coord = vTextureCoord * filterArea.xy / dimensions.xy;

    if (vignetting > 0.0)
    {
        float outter = SQRT_2 - vignetting * SQRT_2;
        vec2 dir = vec2(vec2(0.5, 0.5) - coord);
        dir.y *= dimensions.y / dimensions.x;
        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignettingBlur * SQRT_2), 0.0, 1.0);
        color.rgb *= darker + (1.0 - darker) * (1.0 - vignettingAlpha);
    }

    if (scratchDensity > seed && scratch != 0.0)
    {
        float phase = seed * 256.0;
        float s = mod(floor(phase), 2.0);
        float dist = 1.0 / scratchDensity;
        float d = distance(coord, vec2(seed * dist, abs(s - seed * dist)));
        if (d < seed * 0.6 + 0.4)
        {
            highp float period = scratchDensity * 10.0;

            float xx = coord.x * period + phase;
            float aa = abs(mod(xx, 0.5) * 4.0);
            float bb = mod(floor(xx / 0.5), 2.0);
            float yy = (1.0 - bb) * aa + bb * (2.0 - aa);

            float kk = 2.0 * period;
            float dw = scratchWidth / dimensions.x * (0.75 + seed);
            float dh = dw * kk;

            float tine = (yy - (2.0 - dh));

            if (tine > 0.0) {
                float _sign = sign(scratch);

                tine = s * tine / period + scratch + 0.1;
                tine = clamp(tine + 1.0, 0.5 + _sign * 0.5, 1.5 + _sign * 0.5);

                color.rgb *= tine;
            }
        }
    }

    if (noise > 0.0 && noiseSize > 0.0)
    {
        vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;
        pixelCoord.x = floor(pixelCoord.x / noiseSize);
        pixelCoord.y = floor(pixelCoord.y / noiseSize);
        // vec2 d = pixelCoord * noiseSize * vec2(1024.0 + seed * 512.0, 1024.0 - seed * 512.0);
        // float _noise = snoise(d) * 0.5;
        float _noise = rand(pixelCoord * noiseSize * seed) - 0.5;
        color += _noise * noise;
    }

    gl_FragColor.rgb = color;
}
`,oN=class extends Wt{constructor(t,e=0){super(OY,BY),this.seed=0,this.uniforms.dimensions=new Float32Array(2),typeof t=="number"?(this.seed=t,t=void 0):this.seed=e,Object.assign(this,oN.defaults,t)}apply(t,e,i,r){var s,n;this.uniforms.dimensions[0]=(s=e.filterFrame)==null?void 0:s.width,this.uniforms.dimensions[1]=(n=e.filterFrame)==null?void 0:n.height,this.uniforms.seed=this.seed,t.applyFilter(this,e,i,r)}set sepia(t){this.uniforms.sepia=t}get sepia(){return this.uniforms.sepia}set noise(t){this.uniforms.noise=t}get noise(){return this.uniforms.noise}set noiseSize(t){this.uniforms.noiseSize=t}get noiseSize(){return this.uniforms.noiseSize}set scratch(t){this.uniforms.scratch=t}get scratch(){return this.uniforms.scratch}set scratchDensity(t){this.uniforms.scratchDensity=t}get scratchDensity(){return this.uniforms.scratchDensity}set scratchWidth(t){this.uniforms.scratchWidth=t}get scratchWidth(){return this.uniforms.scratchWidth}set vignetting(t){this.uniforms.vignetting=t}get vignetting(){return this.uniforms.vignetting}set vignettingAlpha(t){this.uniforms.vignettingAlpha=t}get vignettingAlpha(){return this.uniforms.vignettingAlpha}set vignettingBlur(t){this.uniforms.vignettingBlur=t}get vignettingBlur(){return this.uniforms.vignettingBlur}},UY=oN;UY.defaults={sepia:.3,noise:.3,noiseSize:1,scratch:.5,scratchDensity:.3,scratchWidth:1,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3};var zY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,GY=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterClamp;

uniform float uAlpha;
uniform vec2 uThickness;
uniform vec4 uColor;
uniform bool uKnockout;

const float DOUBLE_PI = 2. * 3.14159265358979323846264;
const float ANGLE_STEP = \${angleStep};

float outlineMaxAlphaAtPos(vec2 pos) {
    if (uThickness.x == 0. || uThickness.y == 0.) {
        return 0.;
    }

    vec4 displacedColor;
    vec2 displacedPos;
    float maxAlpha = 0.;

    for (float angle = 0.; angle <= DOUBLE_PI; angle += ANGLE_STEP) {
        displacedPos.x = vTextureCoord.x + uThickness.x * cos(angle);
        displacedPos.y = vTextureCoord.y + uThickness.y * sin(angle);
        displacedColor = texture2D(uSampler, clamp(displacedPos, filterClamp.xy, filterClamp.zw));
        maxAlpha = max(maxAlpha, displacedColor.a);
    }

    return maxAlpha;
}

void main(void) {
    vec4 sourceColor = texture2D(uSampler, vTextureCoord);
    vec4 contentColor = sourceColor * float(!uKnockout);
    float outlineAlpha = uAlpha * outlineMaxAlphaAtPos(vTextureCoord.xy) * (1.-sourceColor.a);
    vec4 outlineColor = vec4(vec3(uColor) * outlineAlpha, outlineAlpha);
    gl_FragColor = contentColor + outlineColor;
}
`,Gy=class extends Wt{constructor(t=1,e=0,i=.1,r=1,s=!1){super(zY,GY.replace(/\$\{angleStep\}/,Gy.getAngleStep(i))),this._thickness=1,this._alpha=1,this._knockout=!1,this.uniforms.uThickness=new Float32Array([0,0]),this.uniforms.uColor=new Float32Array([0,0,0,1]),this.uniforms.uAlpha=r,this.uniforms.uKnockout=s,Object.assign(this,{thickness:t,color:e,quality:i,alpha:r,knockout:s})}static getAngleStep(t){let e=Math.max(t*Gy.MAX_SAMPLES,Gy.MIN_SAMPLES);return(Math.PI*2/e).toFixed(7)}apply(t,e,i,r){this.uniforms.uThickness[0]=this._thickness/e._frame.width,this.uniforms.uThickness[1]=this._thickness/e._frame.height,this.uniforms.uAlpha=this._alpha,this.uniforms.uKnockout=this._knockout,t.applyFilter(this,e,i,r)}get alpha(){return this._alpha}set alpha(t){this._alpha=t}get color(){return St.rgb2hex(this.uniforms.uColor)}set color(t){St.hex2rgb(t,this.uniforms.uColor)}get knockout(){return this._knockout}set knockout(t){this._knockout=t}get thickness(){return this._thickness}set thickness(t){this._thickness=t,this.padding=t}},aN=Gy;aN.MIN_SAMPLES=1,aN.MAX_SAMPLES=100;var $Y=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,HY=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec2 dimensions;

uniform bool mirror;
uniform float boundary;
uniform vec2 amplitude;
uniform vec2 waveLength;
uniform vec2 alpha;
uniform float time;

float rand(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main(void)
{
    vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;
    vec2 coord = pixelCoord / dimensions;

    if (coord.y < boundary) {
        gl_FragColor = texture2D(uSampler, vTextureCoord);
        return;
    }

    float k = (coord.y - boundary) / (1. - boundary + 0.0001);
    float areaY = boundary * dimensions.y / filterArea.y;
    float v = areaY + areaY - vTextureCoord.y;
    float y = mirror ? v : vTextureCoord.y;

    float _amplitude = ((amplitude.y - amplitude.x) * k + amplitude.x ) / filterArea.x;
    float _waveLength = ((waveLength.y - waveLength.x) * k + waveLength.x) / filterArea.y;
    float _alpha = (alpha.y - alpha.x) * k + alpha.x;

    float x = vTextureCoord.x + cos(v * 6.28 / _waveLength - time) * _amplitude;
    x = clamp(x, filterClamp.x, filterClamp.z);

    vec4 color = texture2D(uSampler, vec2(x, y));

    gl_FragColor = color * _alpha;
}
`,lN=class extends Wt{constructor(t){super($Y,HY),this.time=0,this.uniforms.amplitude=new Float32Array(2),this.uniforms.waveLength=new Float32Array(2),this.uniforms.alpha=new Float32Array(2),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,lN.defaults,t)}apply(t,e,i,r){var s,n;this.uniforms.dimensions[0]=(s=e.filterFrame)==null?void 0:s.width,this.uniforms.dimensions[1]=(n=e.filterFrame)==null?void 0:n.height,this.uniforms.time=this.time,t.applyFilter(this,e,i,r)}set mirror(t){this.uniforms.mirror=t}get mirror(){return this.uniforms.mirror}set boundary(t){this.uniforms.boundary=t}get boundary(){return this.uniforms.boundary}set amplitude(t){this.uniforms.amplitude[0]=t[0],this.uniforms.amplitude[1]=t[1]}get amplitude(){return this.uniforms.amplitude}set waveLength(t){this.uniforms.waveLength[0]=t[0],this.uniforms.waveLength[1]=t[1]}get waveLength(){return this.uniforms.waveLength}set alpha(t){this.uniforms.alpha[0]=t[0],this.uniforms.alpha[1]=t[1]}get alpha(){return this.uniforms.alpha}},VY=lN;VY.defaults={mirror:!0,boundary:.5,amplitude:[0,20],waveLength:[30,100],alpha:[1,1],time:0};var jY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,XY=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterArea;
uniform vec4 filterClamp;

uniform vec2 center;

uniform float amplitude;
uniform float wavelength;
// uniform float power;
uniform float brightness;
uniform float speed;
uniform float radius;

uniform float time;

const float PI = 3.14159;

void main()
{
    float halfWavelength = wavelength * 0.5 / filterArea.x;
    float maxRadius = radius / filterArea.x;
    float currentRadius = time * speed / filterArea.x;

    float fade = 1.0;

    if (maxRadius > 0.0) {
        if (currentRadius > maxRadius) {
            gl_FragColor = texture2D(uSampler, vTextureCoord);
            return;
        }
        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);
    }

    vec2 dir = vec2(vTextureCoord - center / filterArea.xy);
    dir.y *= filterArea.y / filterArea.x;
    float dist = length(dir);

    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {
        gl_FragColor = texture2D(uSampler, vTextureCoord);
        return;
    }

    vec2 diffUV = normalize(dir);

    float diff = (dist - currentRadius) / halfWavelength;

    float p = 1.0 - pow(abs(diff), 2.0);

    // float powDiff = diff * pow(p, 2.0) * ( amplitude * fade );
    float powDiff = 1.25 * sin(diff * PI) * p * ( amplitude * fade );

    vec2 offset = diffUV * powDiff / filterArea.xy;

    // Do clamp :
    vec2 coord = vTextureCoord + offset;
    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);
    vec4 color = texture2D(uSampler, clampedCoord);
    if (coord != clampedCoord) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    // No clamp :
    // gl_FragColor = texture2D(uSampler, vTextureCoord + offset);

    color.rgb *= 1.0 + (brightness - 1.0) * p * fade;

    gl_FragColor = color;
}
`,cN=class extends Wt{constructor(t=[0,0],e,i=0){super(jY,XY),this.center=t,Object.assign(this,cN.defaults,e),this.time=i}apply(t,e,i,r){this.uniforms.time=this.time,t.applyFilter(this,e,i,r)}get center(){return this.uniforms.center}set center(t){this.uniforms.center=t}get amplitude(){return this.uniforms.amplitude}set amplitude(t){this.uniforms.amplitude=t}get wavelength(){return this.uniforms.wavelength}set wavelength(t){this.uniforms.wavelength=t}get brightness(){return this.uniforms.brightness}set brightness(t){this.uniforms.brightness=t}get speed(){return this.uniforms.speed}set speed(t){this.uniforms.speed=t}get radius(){return this.uniforms.radius}set radius(t){this.uniforms.radius=t}},WY=cN;WY.defaults={amplitude:30,wavelength:160,brightness:1,speed:500,radius:-1};var qY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,YY=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float blur;
uniform float gradientBlur;
uniform vec2 start;
uniform vec2 end;
uniform vec2 delta;
uniform vec2 texSize;

float random(vec3 scale, float seed)
{
    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
}

void main(void)
{
    vec4 color = vec4(0.0);
    float total = 0.0;

    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
    vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));
    float radius = smoothstep(0.0, 1.0, abs(dot(vTextureCoord * texSize - start, normal)) / gradientBlur) * blur;

    for (float t = -30.0; t <= 30.0; t++)
    {
        float percent = (t + offset - 0.5) / 30.0;
        float weight = 1.0 - abs(percent);
        vec4 sample = texture2D(uSampler, vTextureCoord + delta / texSize * percent * radius);
        sample.rgb *= sample.a;
        color += sample * weight;
        total += weight;
    }

    color /= total;
    color.rgb /= color.a + 0.00001;

    gl_FragColor = color;
}
`,$y=class extends Wt{constructor(e){var i,r;super(qY,YY),this.uniforms.blur=e.blur,this.uniforms.gradientBlur=e.gradientBlur,this.uniforms.start=(i=e.start)!=null?i:new ei(0,window.innerHeight/2),this.uniforms.end=(r=e.end)!=null?r:new ei(600,window.innerHeight/2),this.uniforms.delta=new ei(30,30),this.uniforms.texSize=new ei(window.innerWidth,window.innerHeight),this.updateDelta()}updateDelta(){this.uniforms.delta.x=0,this.uniforms.delta.y=0}get blur(){return this.uniforms.blur}set blur(e){this.uniforms.blur=e}get gradientBlur(){return this.uniforms.gradientBlur}set gradientBlur(e){this.uniforms.gradientBlur=e}get start(){return this.uniforms.start}set start(e){this.uniforms.start=e,this.updateDelta()}get end(){return this.uniforms.end}set end(e){this.uniforms.end=e,this.updateDelta()}},rS=class extends $y{updateDelta(){let e=this.uniforms.end.x-this.uniforms.start.x,i=this.uniforms.end.y-this.uniforms.start.y,r=Math.sqrt(e*e+i*i);this.uniforms.delta.x=e/r,this.uniforms.delta.y=i/r}},sS=class extends $y{updateDelta(){let e=this.uniforms.end.x-this.uniforms.start.x,i=this.uniforms.end.y-this.uniforms.start.y,r=Math.sqrt(e*e+i*i);this.uniforms.delta.x=-i/r,this.uniforms.delta.y=e/r}},uN=class extends Wt{constructor(t,e,i,r){super(),typeof t=="number"&&(St.deprecation("5.3.0","TiltShiftFilter constructor arguments is deprecated, use options."),t={blur:t,gradientBlur:e,start:i,end:r}),t=Object.assign({},uN.defaults,t),this.tiltShiftXFilter=new rS(t),this.tiltShiftYFilter=new sS(t)}apply(t,e,i,r){let s=t.getFilterTexture();this.tiltShiftXFilter.apply(t,e,s,1),this.tiltShiftYFilter.apply(t,s,i,r),t.returnFilterTexture(s)}get blur(){return this.tiltShiftXFilter.blur}set blur(t){this.tiltShiftXFilter.blur=this.tiltShiftYFilter.blur=t}get gradientBlur(){return this.tiltShiftXFilter.gradientBlur}set gradientBlur(t){this.tiltShiftXFilter.gradientBlur=this.tiltShiftYFilter.gradientBlur=t}get start(){return this.tiltShiftXFilter.start}set start(t){this.tiltShiftXFilter.start=this.tiltShiftYFilter.start=t}get end(){return this.tiltShiftXFilter.end}set end(t){this.tiltShiftXFilter.end=this.tiltShiftYFilter.end=t}},ZY=uN;ZY.defaults={blur:100,gradientBlur:600,start:void 0,end:void 0};var QY=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,KY=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform vec4 filterArea;

vec2 mapCoord( vec2 coord )
{
    coord *= filterArea.xy;
    coord += filterArea.zw;

    return coord;
}

vec2 unmapCoord( vec2 coord )
{
    coord -= filterArea.zw;
    coord /= filterArea.xy;

    return coord;
}

vec2 twist(vec2 coord)
{
    coord -= offset;

    float dist = length(coord);

    if (dist < radius)
    {
        float ratioDist = (radius - dist) / radius;
        float angleMod = ratioDist * ratioDist * angle;
        float s = sin(angleMod);
        float c = cos(angleMod);
        coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);
    }

    coord += offset;

    return coord;
}

void main(void)
{

    vec2 coord = mapCoord(vTextureCoord);

    coord = twist(coord);

    coord = unmapCoord(coord);

    gl_FragColor = texture2D(uSampler, coord );

}
`,hN=class extends Wt{constructor(t){super(QY,KY),Object.assign(this,hN.defaults,t)}get offset(){return this.uniforms.offset}set offset(t){this.uniforms.offset=t}get radius(){return this.uniforms.radius}set radius(t){this.uniforms.radius=t}get angle(){return this.uniforms.angle}set angle(t){this.uniforms.angle=t}},JY=hN;JY.defaults={radius:200,angle:4,padding:20,offset:new ei};var eZ=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,tZ=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterArea;

uniform vec2 uCenter;
uniform float uStrength;
uniform float uInnerRadius;
uniform float uRadius;

const float MAX_KERNEL_SIZE = \${maxKernelSize};

// author: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/
highp float rand(vec2 co, float seed) {
    const highp float a = 12.9898, b = 78.233, c = 43758.5453;
    highp float dt = dot(co + seed, vec2(a, b)), sn = mod(dt, 3.14159);
    return fract(sin(sn) * c + seed);
}

void main() {

    float minGradient = uInnerRadius * 0.3;
    float innerRadius = (uInnerRadius + minGradient * 0.5) / filterArea.x;

    float gradient = uRadius * 0.3;
    float radius = (uRadius - gradient * 0.5) / filterArea.x;

    float countLimit = MAX_KERNEL_SIZE;

    vec2 dir = vec2(uCenter.xy / filterArea.xy - vTextureCoord);
    float dist = length(vec2(dir.x, dir.y * filterArea.y / filterArea.x));

    float strength = uStrength;

    float delta = 0.0;
    float gap;
    if (dist < innerRadius) {
        delta = innerRadius - dist;
        gap = minGradient;
    } else if (radius >= 0.0 && dist > radius) { // radius < 0 means it's infinity
        delta = dist - radius;
        gap = gradient;
    }

    if (delta > 0.0) {
        float normalCount = gap / filterArea.x;
        delta = (normalCount - delta) / normalCount;
        countLimit *= delta;
        strength *= delta;
        if (countLimit < 1.0)
        {
            gl_FragColor = texture2D(uSampler, vTextureCoord);
            return;
        }
    }

    // randomize the lookup values to hide the fixed number of samples
    float offset = rand(vTextureCoord, 0.0);

    float total = 0.0;
    vec4 color = vec4(0.0);

    dir *= strength;

    for (float t = 0.0; t < MAX_KERNEL_SIZE; t++) {
        float percent = (t + offset) / MAX_KERNEL_SIZE;
        float weight = 4.0 * (percent - percent * percent);
        vec2 p = vTextureCoord + dir * percent;
        vec4 sample = texture2D(uSampler, p);

        // switch to pre-multiplied alpha to correctly blur transparent images
        // sample.rgb *= sample.a;

        color += sample * weight;
        total += weight;

        if (t > countLimit){
            break;
        }
    }

    color /= total;
    // switch back from pre-multiplied alpha
    // color.rgb /= color.a + 0.00001;

    gl_FragColor = color;
}
`,dN=Object.getOwnPropertySymbols,iZ=Object.prototype.hasOwnProperty,rZ=Object.prototype.propertyIsEnumerable,sZ=(t,e)=>{var i={};for(var r in t)iZ.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(t!=null&&dN)for(var r of dN(t))e.indexOf(r)<0&&rZ.call(t,r)&&(i[r]=t[r]);return i},fN=class extends Wt{constructor(t){let e=Object.assign(fN.defaults,t),{maxKernelSize:i}=e,r=sZ(e,["maxKernelSize"]);super(eZ,tZ.replace("${maxKernelSize}",i.toFixed(1))),Object.assign(this,r)}get center(){return this.uniforms.uCenter}set center(t){this.uniforms.uCenter=t}get strength(){return this.uniforms.uStrength}set strength(t){this.uniforms.uStrength=t}get innerRadius(){return this.uniforms.uInnerRadius}set innerRadius(t){this.uniforms.uInnerRadius=t}get radius(){return this.uniforms.uRadius}set radius(t){(t<0||t===1/0)&&(t=-1),this.uniforms.uRadius=t}},nZ=fN;nZ.defaults={strength:.1,center:[0,0],innerRadius:0,radius:-1,maxKernelSize:32};function pN(t){return t instanceof Set?t:new Set(t!==void 0&&[].concat(t))}var Rr=class{constructor(e,i){this.scene=e,this.renderer=e.renderer,this.context=e.context,this.layerID=i,this._enabled=!1,this.features=new Map,this.retained=new Map,this._featureHasData=new Map,this._dataHasFeature=new Map,this._parentHasChildren=new Map,this._childHasParents=new Map,this._dataHasClass=new Map,this._classHasData=new Map}render(){}cull(e){for(let[i,r]of this.features){let s=this.retained.get(i);s!==e&&(r.visible=!1,e-s>20&&r.destroy())}}addFeature(e){this.features.set(e.id,e)}removeFeature(e){this.unbindData(e.id),this.retained.delete(e.id),this.features.delete(e.id)}retainFeature(e,i){e.lod>0&&(e.visible=!0),this.retained.set(e.id,i)}syncFeatureClasses(e){var n;let i=e.id,r=this._featureHasData.get(i);if(!r)return;let s=(n=this._dataHasClass.get(r))!=null?n:new Set;e.selected=s.has("selected"),e.hovered=s.has("hovered"),e.drawing=s.has("drawing"),e.active=s.has("drawing"),e.highlighted=s.has("highlighted")}isDrawing(e){let i=this._dataHasClass.get(e);return i==null?void 0:i.has("drawing")}isHovered(e){let i=this._dataHasClass.get(e);return i==null?void 0:i.has("hovered")}bindData(e,i){this.unbindData(e);let r=this._dataHasFeature.get(i);r||(r=new Set,this._dataHasFeature.set(i,r)),r.add(e),this._featureHasData.set(e,i)}unbindData(e){let i=this._featureHasData.get(e);if(!i)return;let r=this._dataHasFeature.get(i);r&&(r.delete(e),r.size||(this._dataHasFeature.delete(i),this._parentHasChildren.delete(i),this._childHasParents.delete(i))),this._featureHasData.delete(e)}addChildData(e,i){let r=this._parentHasChildren.get(e);r||(r=new Set,this._parentHasChildren.set(e,r)),r.add(i);let s=this._childHasParents.get(i);s||(s=new Set,this._childHasParents.set(i,s)),s.add(e)}removeChildData(e,i){let r=this._parentHasChildren.get(e);r&&(r.delete(i),r.size||this._parentHasChildren.get(i)||this._parentHasChildren.delete(i));let s=this._childHasParents.get(i);s&&(s.delete(i),s.size||this._childHasParents.delete(i))}clearChildData(e){var r;let i=(r=this._parentHasChildren.get(e))!=null?r:new Set;for(let s of i)this.removeChildData(e,s)}getSelfAndDescendants(e,i){var s;i instanceof Set?i.add(e):i=new Set([e]);let r=(s=this._parentHasChildren.get(e))!=null?s:new Set;for(let n of r)i.has(n)||this.getSelfAndDescendants(n,i);return i}getSelfAndAncestors(e,i){var s;i instanceof Set?i.add(e):i=new Set([e]);let r=(s=this._childHasParents.get(e))!=null?s:new Set;for(let n of r)i.has(n)||this.getSelfAndAncestors(n,i);return i}getSelfAndSiblings(e,i){var s,n;i instanceof Set?i.add(e):i=new Set([e]);let r=(s=this._childHasParents.get(e))!=null?s:new Set;for(let o of r){let a=(n=this._parentHasChildren.get(o))!=null?n:new Set;for(let l of a)i.add(l)}return i}classData(e,i){let r=this._dataHasClass.get(e);r||(r=new Set,this._dataHasClass.set(e,r)),r.add(i);let s=this._classHasData.get(i);s||(s=new Set,this._classHasData.set(i,s)),s.add(e)}unclassData(e,i){let r=this._dataHasClass.get(e);r&&(r.delete(i),r.size||this._dataHasClass.delete(e));let s=this._classHasData.get(i);s&&(s.delete(e),s.size||this._classHasData.delete(i))}clearClass(e){var r;let i=(r=this._classHasData.get(e))!=null?r:new Set;for(let s of i)this.unclassData(s,e)}dirtyLayer(){for(let e of this.features.values())e.dirty=!0}dirtyFeatures(e){for(let i of pN(e)){let r=this.features.get(i);r&&(r.dirty=!0)}}dirtyData(e){for(let i of pN(e)){let r=this._dataHasFeature.get(i);r&&this.dirtyFeatures(r)}}get id(){return this.layerID}get supported(){return!0}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,this.dirtyLayer())}};var mN=16776960,oZ=[0,-.0125,0,-.0125,.5,-.0125,0,-.0125,0],N4=class extends Rr{constructor(e,i,r){super(e,i),this.enabled=!0,this.isMinimap=r;let s=this.scene.groups.get("background");s.eventMode="none",this.filters={brightness:1,contrast:1,saturation:1,sharpness:1},this._tileMaps=new Map,this._failed=new Set,this._tiler=new zs}render(e,i){let r=this.context.systems.imagery,s=this.scene.groups.get("background"),n=new Map,o=r.baseLayerSource();o&&o.id!=="none"&&n.set(o.id,o);for(let c of r.overlayLayerSources())n.set(c.id,c);let a=0;for(let[c,d]of n){let m=this.getSourceContainer(c);m.zIndex=c==="mapbox_locator_overlay"?999:a++,!this.isMinimap&&d===o&&this.applyFilters(m);let g=this._tileMaps.get(c);g||(g=new Map,this._tileMaps.set(c,g));let _=window.performance.now();this.renderSource(_,i,d,m,g)}let l=new Set;for(let c of s.children){let d=c.name;n.has(d)||l.add(d)}for(let c of l)this.destroySource(c)}renderSource(e,i,r,s,n){let o=this.context,a=this.renderer.textures,l=o.services.osm;if(isNaN(i._x)||isNaN(i._y))return;let c=!1,d;this.isMinimap||(c=o.getDebug("tile"),d=this.scene.layers.get("map-ui").container.getChildByName("tile-debug"),d.visible=c);let m=r.tileSize||256,g=i.scale(),_=Ga(g,m),v=$o(r.offset,Math.pow(2,_));s.position.set(v[0],v[1]);let E=new Map,b=Math.round(_),T=Math.max(0,b-5);r.overzoom||(b=T=Math.floor(_));let A=!1;for(let M=b;!A&&M>=T;M--){if(!r.validZoom(M))continue;let k=this._tiler.skipNullIsland(!!r.overlay).zoomRange(M).getTiles(this.isMinimap?i:o.projection),F=!1;for(let O of k.tiles){if(!this.isMinimap&&M>=10&&l&&r.id==="mapbox_locator_overlay"){let B=O.wgs84Extent.center();if(l.isDataLoaded(B))continue}O.url=r.url(O.xyz),!O.url||this._failed.has(O.url)?F=!0:E.set(O.id,O)}A=!F}for(let[M,k]of E){if(n.has(M))continue;let F=`${r.id}-${M}`,O=new rs;O.name=F,O.anchor.set(0,1),O.zIndex=k.xyz[2],s.addChild(O),k.sprite=O,n.set(M,k);let B=new Image;B.crossOrigin="anonymous",B.src=k.url,k.image=B,k.loaded=!1,B.onload=()=>{if(this._failed.delete(k.url),!k.sprite||!k.image)return;let U=k.image.naturalWidth,z=k.image.naturalHeight;k.sprite.texture=a.allocate("tile",k.sprite.name,U,z,k.image),k.loaded=!0,k.image=null,o.systems.map.deferredRedraw()},B.onerror=()=>{k.image=null,this._failed.add(k.url),o.systems.map.deferredRedraw()}}for(let[M,k]of n){let F=!1;if(E.has(M)?(F=!0,k.timestamp=e):r.overlay||(F=e-k.timestamp<3e3),F){let[O,B]=i.project(k.wgs84Extent.min);k.sprite.position.set(O,B);let U=m*Math.pow(2,_-k.xyz[2]);if(k.sprite.width=U,k.sprite.height=U,c&&d&&!r.overlay){if(!k.debug){k.debug=new Hi,k.debug.name=`debug-${M}`,k.debug.eventMode="none",k.debug.sortableChildren=!1,d.addChild(k.debug);let z=new R2(M,{fontName:"debug"});z.name=`label-${M}`,z.tint=mN,z.position.set(2,2),k.debug.addChild(z)}k.debug.position.set(O,B-U),k.debug.clear().lineStyle(2,mN).drawRect(0,0,U,U)}}else this.destroyTile(k),n.delete(M)}}destroyAll(){let e=this.scene.groups.get("background"),i=new Set;for(let r of e.children){let s=r.name;i.add(s)}for(let r of i)this.destroySource(r)}destroySource(e){let i=this._tileMaps.get(e);for(let[n,o]of i)this.destroyTile(o),i.delete(n);this._tileMaps.delete(e);let s=this.scene.groups.get("background").getChildByName(e);s&&s.destroy({children:!0})}destroyTile(e){let i=this.renderer.textures;e.sprite&&(e.sprite.texture=null,e.loaded&&i.free("tile",e.sprite.name),e.sprite.destroy({children:!0,texture:!1,baseTexture:!1})),e.debug&&e.debug.destroy({children:!0}),e.image=null,e.sprite=null,e.debug=null}getSourceContainer(e){let i=this.scene.groups.get("background"),r=i.getChildByName(e);return r||(r=new Qi,r.name=e,r.eventMode="none",r.sortableChildren=!0,i.addChild(r)),r}applyFilters(e){let i=new cy({brightness:this.filters.brightness,contrast:this.filters.contrast,saturation:this.filters.saturation});if(e.filters=[i],this.filters.sharpness>1){let r=oZ.map((s,n)=>{if(n===4){let o=en(1,2)(this.filters.sharpness);return s*o}else return s});this.convolutionFilter=new zy(r),e.filters.push(this.convolutionFilter)}else if(this.filters.sharpness<1){let r=en(1,8)(1-this.filters.sharpness);this.blurFilter=new z5.BlurFilter(r,4),e.filters.push(this.blurFilter)}}setBrightness(e){this.filters.brightness=e}setContrast(e){this.filters.contrast=e}setSaturation(e){this.filters.saturation=e}setSharpness(e){this.filters.sharpness=e}};var aZ={dash:[10,5],width:1,color:16777215,alpha:1,scale:1,useTexture:!1,alignment:.5},wh=class{constructor(t,e={}){this.cursor=new ei,this.scale=1,this.graphics=t,e=di(di({},aZ),e),this.dash=e.dash,this.dashSize=this.dash.reduce((i,r)=>i+r),this.useTexture=e.useTexture,this.options=e,this.setLineStyle()}setLineStyle(){let t=this.options;if(this.useTexture){let e=wh.getTexture(t,this.dashSize);this.graphics.lineTextureStyle({width:t.width*t.scale,color:t.color,alpha:t.alpha,texture:e,alignment:t.alignment}),this.activeTexture=e}else this.graphics.lineStyle({width:t.width*t.scale,color:t.color,alpha:t.alpha,cap:t.cap,join:t.join,alignment:t.alignment});this.scale=t.scale}static distance(t,e,i,r){return Math.sqrt(Math.pow(i-t,2)+Math.pow(r-e,2))}moveTo(t,e){return this.lineLength=0,this.cursor.set(t,e),this.start=new ei(t,e),this.graphics.moveTo(this.cursor.x,this.cursor.y),this}lineTo(t,e,i){typeof this.lineLength===void 0&&this.moveTo(0,0);let[r,s]=[this.cursor.x,this.cursor.y],n=wh.distance(r,s,t,e);if(n<1)return this;let o=Math.atan2(e-s,t-r),a=Math.cos(o),l=Math.sin(o),c=i&&t===this.start.x&&e===this.start.y;if(this.useTexture)if(this.graphics.moveTo(r,s),this.adjustLineStyle(o),c&&this.dash.length%2===0){let d=Math.min(this.dash[this.dash.length-1],n);this.graphics.lineTo(t-a*d,e-l*d),this.graphics.closePath()}else this.graphics.lineTo(t,e);else{this.setLineStyle();let d=this.lineLength%(this.dashSize*this.scale),m=0,g=0,_=0;for(let E=0;E<this.dash.length;E++){let b=this.dash[E]*this.scale;if(d<_+b){m=E,g=d-_;break}else _+=b}let v=n;for(;v>1;){let E=this.dash[m]*this.scale-g,b=v>E?E:v;if(c&&wh.distance(r+a*b,s+l*b,this.start.x,this.start.y)<=b){if(m%2===0){let A=wh.distance(r,s,this.start.x,this.start.y)-this.dash[this.dash.length-1]*this.scale;r+=a*A,s+=l*A,this.graphics.lineTo(r,s),this.lineLength+=A,this.cursor.set(r,s)}break}r+=a*b,s+=l*b,m%2?this.graphics.moveTo(r,s):this.graphics.lineTo(r,s),this.lineLength+=b,this.cursor.set(r,s),v-=b,m++,m=m===this.dash.length?0:m,g=0}}return this}closePath(){this.lineTo(this.start.x,this.start.y,!0)}drawCircle(t,e,i,r=80,s){let n=Math.PI*2/r,o=0,a=new ei(t+Math.cos(o)*i,e+Math.sin(o)*i);s?(s.apply(a,a),this.moveTo(a[0],a[1])):this.moveTo(a.x,a.y),o+=n;for(let l=1;l<r+1;l++){let c=l===r?[a.x,a.y]:[t+Math.cos(o)*i,e+Math.sin(o)*i];this.lineTo(c[0],c[1]),o+=n}return this}drawEllipse(t,e,i,r,s=80,n){let o=Math.PI*2/s,a,l=new ei,c=0;for(let d=0;d<Math.PI*2;d+=o){let m=t-i*Math.sin(d),g=e-r*Math.cos(d);n&&(l.set(m,g),n.apply(l,l),m=l.x,g=l.y),d===0?(this.moveTo(m,g),a={x:m,y:g}):this.lineTo(m,g)}return this.lineTo(a.x,a.y,!0),this}drawPolygon(t,e){let i=new ei;if(typeof t[0]=="number")if(e){i.set(t[0],t[1]),e.apply(i,i),this.moveTo(i.x,i.y);for(let r=2;r<t.length;r+=2)i.set(t[r],t[r+1]),e.apply(i,i),this.lineTo(i.x,i.y,r===t.length-2)}else{this.moveTo(t[0],t[1]);for(let r=2;r<t.length;r+=2)this.lineTo(t[r],t[r+1],r===t.length-2)}else if(e){let r=t[0];i.copyFrom(r),e.apply(i,i),this.moveTo(i.x,i.y);for(let s=1;s<t.length;s++){let n=t[s];i.copyFrom(n),e.apply(i,i),this.lineTo(i.x,i.y,s===t.length-1)}}else{let r=t[0];this.moveTo(r.x,r.y);for(let s=1;s<t.length;s++){let n=t[s];this.lineTo(n.x,n.y,s===t.length-1)}}return this}drawRect(t,e,i,r,s){if(s){let n=new ei;n.set(t,e),s.apply(n,n),this.moveTo(n.x,n.y),n.set(t+i,e),s.apply(n,n),this.lineTo(n.x,n.y),n.set(t+i,e+r),s.apply(n,n),this.lineTo(n.x,n.y),n.set(t,e+r),s.apply(n,n),this.lineTo(n.x,n.y),n.set(t,e),s.apply(n,n),this.lineTo(n.x,n.y,!0)}else this.moveTo(t,e).lineTo(t+i,e).lineTo(t+i,e+r).lineTo(t,e+r).lineTo(t,e,!0);return this}adjustLineStyle(t){let e=this.graphics.line;e.matrix=new fr,t&&e.matrix.rotate(t),this.scale!==1&&e.matrix.scale(this.scale,this.scale);let i=-this.lineLength;e.matrix.translate(this.cursor.x+i*Math.cos(t),this.cursor.y+i*Math.sin(t)),this.graphics.lineStyle(e)}static getTexture(t,e){let i=t.dash.toString();if(wh.dashTextureCache[i])return wh.dashTextureCache[i];let r=document.createElement("canvas");r.width=e,r.height=Math.ceil(t.width);let s=r.getContext("2d");if(!s)return console.warn("Did not get context from canvas"),null;s.strokeStyle="white",s.globalAlpha=t.alpha,s.lineWidth=t.width;let n=0,o=t.width/2;s.moveTo(n,o);for(let l=0;l<t.dash.length;l+=2)n+=t.dash[l],s.lineTo(n,o),t.dash.length!==l+1&&(n+=t.dash[l+1],s.moveTo(n,o));s.stroke();let a=wh.dashTextureCache[i]=Yt.from(r);return a.baseTexture.scaleMode=io.NEAREST,a}},Pl=wh;Pl.dashTextureCache={};var xN=Yi(_N(),1),Hy=class{constructor(){this.type=null,this.dirty=!0,this.reset()}destroy(){this.reset()}reset(){this.origCoords=null,this.origExtent=null,this.origHull=null,this.origCentroid=null,this.origPoi=null,this.origSsr=null,this.coords=null,this.extent=null,this.hull=null,this.centroid=null,this.poi=null,this.ssr=null,this.outer=null,this.flatOuter=null,this.holes=null,this.flatHoles=null,this.width=0,this.height=0,this.lod=0}update(e){if(!this.dirty||!this.origCoords||!this.origExtent)return;if(this.dirty=!1,this.coords=null,this.extent=null,this.outer=null,this.flatOuter=null,this.holes=null,this.flatHoles=null,this.hull=null,this.centroid=null,this.poi=null,this.ssr=null,this.type==="point"){this.coords=e.project(this.origCoords),this.extent=new mt(this.coords),this.centroid=this.coords,this.width=0,this.height=0,this.lod=2;return}this.extent=new mt,this.extent.min=e.project([this.origExtent.min[0],this.origExtent.max[1]]),this.extent.max=e.project([this.origExtent.max[0],this.origExtent.min[1]]);let[i,r]=this.extent.min,[s,n]=this.extent.max;if(this.width=s-i,this.height=n-r,this.width<4&&this.height<4){this.lod=0;return}let o=this.type==="line"?[this.origCoords]:this.origCoords,a=new Array(o.length),l=new Array(o.length);for(let c=0;c<o.length;++c){let d=o[c];a[c]=new Array(d.length),l[c]=new Array(d.length*2);for(let m=0;m<d.length;++m){let g=e.project(d[m]);a[c][m]=g,l[c][m*2]=g[0],l[c][m*2+1]=g[1]}}if(this.type==="line"?(this.coords=a[0],this.outer=a[0],this.flatOuter=l[0],this.holes=null,this.flatHoles=null):(this.coords=a,this.outer=a[0],this.flatOuter=l[0],this.holes=a.slice(1),this.flatHoles=l.slice(1)),this.outer.length!==0)if(this.outer.length===1)this.centroid=this.outer[0],this.origCentroid=e.invert(this.centroid),this.poi=this.centroid,this.origPoi=this.origCentroid;else if(this.outer.length===2)this.centroid=yr(this.outer[0],this.outer[1],.5),this.origCentroid=e.invert(this.centroid),this.poi=this.centroid,this.origPoi=this.origCentroid;else{if(this.origHull){this.hull=new Array(this.origHull.length);for(let c=0;c<this.origHull.length;++c)this.hull[c]=e.project(this.origHull[c])}else if(this.hull=Ql(this.outer),this.hull){this.origHull=new Array(this.hull.length);for(let c=0;c<this.origHull.length;++c)this.origHull[c]=e.invert(this.hull[c])}if(this.origCentroid?this.centroid=e.project(this.origCentroid):this.hull&&(this.hull.length===2?this.centroid=yr(this.hull[0],this.hull[1],.5):this.centroid=ma(this.hull),this.origCentroid=e.invert(this.centroid)),this.origPoi?this.poi=e.project(this.origPoi):(this.poi=(0,xN.default)(this.coords),this.origPoi=e.invert(this.poi)),this.origSsr){this.ssr={angle:this.origSsr.angle,poly:new Array(this.origSsr.poly.length)};for(let c=0;c<this.origSsr.poly.length;++c)this.ssr.poly[c]=e.project(this.origSsr.poly[c])}else if(this.hull&&(this.ssr=Of(this.hull),this.ssr)){this.origSsr={angle:this.ssr.angle,poly:new Array(this.ssr.poly.length)};for(let c=0;c<this.ssr.poly.length;++c)this.origSsr.poly[c]=e.invert(this.ssr.poly[c])}}this.lod=2}setCoords(e){let i=this._inferType(e);if(!i)return;this.reset(),this.type=i,this.origCoords=e,this.origExtent=new mt;let r=this.origExtent;if(i==="point")r.min=e,r.max=e,this.origCentroid=e;else{let s=this.type==="line"?[this.origCoords]:this.origCoords;for(let n=0;n<s.length;++n){let o=s[n];for(let a=0;a<o.length;++a){let[l,c]=o[a];r.min=[Math.min(r.min[0],l),Math.min(r.min[1],c)],r.max=[Math.max(r.max[0],l),Math.max(r.max[1],c)]}}}this.dirty=!0}_inferType(e){let i=Array.isArray(e)&&e[0];if(typeof i=="number")return"point";let r=Array.isArray(i)&&i[0];return typeof r=="number"?"line":typeof(Array.isArray(r)&&r[0])=="number"?"polygon":null}};var Th=class{constructor(e,i){this.type="unknown",this.layer=e,this.scene=e.scene,this.renderer=e.renderer,this.context=e.context,this.featureID=i;let r=new Qi;this.container=r,r.__feature__=this,r.name=i,r.sortableChildren=!1,r.visible=!0,this._allowInteraction=!0,this._active=!1,r.eventMode="static",this.v=-1,this.lod=2,this.halo=null,this.geometry=new Hy,this._style=null,this._styleDirty=!0,this._label=null,this._labelDirty=!0,this._dataID=null,this._data=null,this._selected=!1,this._highlighted=!1,this._hovered=!1,this._drawing=!1,this.sceneBounds=new ri,this.layer.addFeature(this),this.scene.addFeature(this)}destroy(){this.layer.removeFeature(this),this.scene.removeFeature(this),this.container.filters=null,this.container.__feature__=null,this.container.destroy({children:!0}),this.container=null,this.layer=null,this.scene=null,this.renderer=null,this.context=null,this.halo&&(this.halo.destroy({children:!0}),this.halo=null),this.geometry.destroy(),this.geometry=null,this._style=null,this._label=null,this._dataID=null,this._data=null,this.sceneBounds=null}update(e,i){this.dirty&&(this.geometry.update(e,i),this._styleDirty=!1)}updateHalo(){}get id(){return this.featureID}get parentContainer(){return this.container.parent}set parentContainer(e){let i=this.container.parent;e&&e!==i?this.container.setParent(e):!e&&i&&i.removeChild(this.container)}get visible(){return this.container.visible}set visible(e){e!==this.container.visible&&(this.container.visible=e,this.updateHalo(),this._labelDirty=!0)}get allowInteraction(){return this._allowInteraction}set allowInteraction(e){e!==this._allowInteraction&&(this._allowInteraction=e,this.container&&(this.container.eventMode=this._allowInteraction&&!this._active?"static":"none"))}get active(){return this._active}set active(e){e!==this._active&&(this._active=e,this.container&&(this.container.eventMode=this._allowInteraction&&!this._active?"static":"none"))}get dirty(){return this.geometry.dirty||this._styleDirty}set dirty(e){this.geometry.dirty=e,this._styleDirty=e,this._labelDirty=e}get hovered(){return this._hovered}set hovered(e){e!==this._hovered&&(this._hovered=e,this._styleDirty=!0)}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._styleDirty=!0,this._labelDirty=!0)}get highlighted(){return this._highlighted}set highlighted(e){e!==this._highlighted&&(this._highlighted=e,this._styleDirty=!0,this._labelDirty=!0)}get drawing(){return this._drawing}set drawing(e){e!==this._drawing&&(this._drawing=e,this._styleDirty=!0)}get style(){return this._style}set style(e){this._style=e,this._styleDirty=!0}get label(){return this._label}set label(e){e!==this._label&&(this._label=e,this._labelDirty=!0)}get data(){return this._data}get dataID(){return this._dataID}setData(e,i){this._dataID=e,this._data=i,this.layer.bindData(this.id,e),this.dirty=!0}addChildData(e,i){this.layer.addChildData(e,i),this.dirty=!0}clearChildData(e){this.layer.clearChildData(e),this.dirty=!0}};function O4(t,e={}){let r=[t[0],t[1]],s=[t[t.length-2],t[t.length-1]],n=Zi(r,s,1e-4),o=new so(t);e.native=!1,o.closeStroke=!1;let a={shape:o,lineStyle:e},l={closePointEps:1e-4,indices:[],points:[],uvs:[]};TD.buildLine(a,l);let c=l.points,d=l.indices,m=new Map,g=[],_=[],v,E,b=0,T=0,A,M,k,F,O,B;for(let q=0;q<d.length;q+=3){let Q=d[q],V=d[q+1],le=d[q+2],de=[c[Q*2],c[Q*2+1]],ne=[c[V*2],c[V*2+1]],ee=[c[le*2],c[le*2+1]];if(q===0)m.set(Q,!0),m.set(V,!1),m.set(le,!0),g.push(de),_.push(ne),g.push(ee),E=ne,v=ee,b=Xi(de,ee);else{let re=m.get(Q),te=m.get(V),ie=m.get(le);re===void 0&&Zi(de,A,1e-4)&&(re=m.get(F),m.set(Q,re)),te===void 0&&Zi(ne,M,1e-4)&&(te=m.get(O),m.set(V,te)),ie===void 0&&Zi(ee,k,1e-4)&&(ie=m.get(B),m.set(le,ie));let oe,fe,Re;re===void 0&&(oe=Q,fe=de,Re=!ie),te===void 0&&(oe=V,fe=ne,Re=!re),ie===void 0&&(oe=le,fe=ee,Re=!te),oe!==void 0&&(m.set(oe,Re),Re===!0?(g.push(fe),b+=Xi(v,fe),v=fe):(_.push(fe),T+=Xi(E,fe),E=fe))}A=de,M=ne,k=ee,F=Q,O=V,B=le}let U={},z=g.length+_.length+1,Z=new Array(z*2),W=0;for(let q=0;q<g.length;++W,++q)Z[W*2]=g[q][0],Z[W*2+1]=g[q][1];_.reverse();for(let q=0;q<_.length;++W,++q)Z[W*2]=_[q][0],Z[W*2+1]=_[q][1];if(Z[Z.length-2]=Z[0],Z[Z.length-1]=Z[1],U.perimeter=Z,n){let q=new Array((g.length+1)*2);for(let V=0;V<g.length;++V)q[V*2]=g[V][0],q[V*2+1]=g[V][1];q[q.length-2]=g[0][0],q[q.length-1]=g[0][1];let Q=new Array((_.length+1)*2);for(let V=0;V<_.length;++V)Q[V*2]=_[V][0],Q[V*2+1]=_[V][1];Q[Q.length-2]=_[0][0],Q[Q.length-1]=_[0][1],b>T?(U.outer=q,U.inner=Q):(U.outer=Q,U.inner=q)}return U}function c6(t,e,i=!1,r=!1){let n=e,o,a=[];for(let l=0;l<t.length;l++){let c=t[l];if(o){let d=Xi(o,c)-n;if(d>=0){let m=fs(o,c),g=e*Math.cos(m),_=e*Math.sin(m),v=0,E=0;i&&(v=7*Math.cos(m+Math.PI/2),E=7*Math.sin(m+Math.PI/2));let b=[o[0]+n*Math.cos(m)+v,o[1]+n*Math.sin(m)+E],T=[o,b];for(r&&d>=e*100&&(e=Math.floor(d/100)),d-=e;d>=0;d-=e)b=Ir(b,[g,_]),T.push(b);T.push(c),a.push({coords:T.slice(1,-1),angle:m+(i?Math.PI/2:0)})}n=-d}o=c}return a}var Vy=32,eu=class extends Th{constructor(e,i){super(e,i),this.type="polygon",this._ssrdata=null;let r=new rs;r.name="lowRes",r.anchor.set(.5,.5),r.visible=!1,r.eventMode="static",this.lowRes=r;let s=new Hi;s.name="fill",s.eventMode="static",s.sortableChildren=!1,this.fill=s;let n=new Hi;n.name="stroke",n.eventMode="none",n.sortableChildren=!1,this.stroke=n;let o=new lc(null,new Tl(Yt.WHITE));o.name="mask",o.eventMode="static",o.visible=!1,this.mask=o,this.container.addChild(r,s,n,o)}destroy(){super.destroy(),this.lowRes=null,this.fill=null,this.mask=null,this._ssrdata&&(delete this._ssrdata.ssr,delete this._ssrdata.origSsr,delete this._ssrdata.origAxis1,delete this._ssrdata.origAxis2,delete this._ssrdata.origCenter,delete this._ssrdata.shapeType,this._ssrdata=null),this._bufferdata&&(this._bufferdata=null)}update(e,i){var O,B;if(!this.dirty)return;let r=this.context.systems.map.wireframeMode;if(this.geometry.dirty){if(this.geometry.update(e,i),this._ssrdata=null,(O=this.geometry.ssr)!=null&&O.poly){let U=this.geometry.ssr.poly,z=[(U[0][0]+U[1][0])/2,(U[0][1]+U[1][1])/2],Z=[(U[2][0]+U[3][0])/2,(U[2][1]+U[3][1])/2],W=[(U[3][0]+U[0][0])/2,(U[3][1]+U[0][1])/2],q=[(U[1][0]+U[2][0])/2,(U[1][1]+U[2][1])/2],Q=[z,Z],V=[W,q],le=[(z[0]+Z[0])/2,(z[1]+Z[1])/2],de=.1,ne,ee,re,te;this.geometry.outer.forEach(oe=>{ne||(ne=Zi(oe,U[0],de)),ee||(ee=Zi(oe,U[1],de)),re||(re=Zi(oe,U[2],de)),te||(te=Zi(oe,U[3],de))});let ie=ne||ee||re||te;this._ssrdata={ssr:this.geometry.ssr,origSsr:this.geometry.origSsr,origAxis1:Q.map(oe=>e.invert(oe)),origAxis2:V.map(oe=>e.invert(oe)),origCenter:e.invert(le),shapeType:ie?"square":"circle"}}if(this._bufferdata=null,this.geometry.flatOuter){let U={alignment:.5,color:0,width:16,alpha:1,join:zr.BEVEL,cap:Ui.BUTT};this._bufferdata=O4(this.geometry.flatOuter,U)}}let[s,n]=this.geometry.extent.min,[o,a]=this.geometry.extent.max,[l,c]=[o-s,a-n];this.sceneBounds.x=s,this.sceneBounds.y=n,this.sceneBounds.width=l,this.sceneBounds.height=c;let d=this._style,m=this.renderer.textures,g=d.fill.color||11184810,_=d.fill.alpha||.3,v=d.fill.pattern,E=d.stroke.dash||null,b=v&&m.getPatternTexture(v)||Yt.WHITE,T,M=(B=this.context.systems.storage.getItem("area-fill"))!=null?B:"partial",k=!d.requireFill&&M==="partial",F=2*Vy+5;if((l<F||c<F)&&(k=!1),(l<Vy||c<Vy)&&(b=Yt.WHITE),l<4&&c<4)this.lod=0,this.visible=!1,this.fill.visible=!1,this.stroke.visible=!1,this.mask.visible=!1,this.lowRes.visible=!1;else if(this._ssrdata&&l<20&&c<20){this.lod=1,this.visible=!0;let U=this._ssrdata;this.fill.visible=!1,this.stroke.visible=!1,this.mask.visible=!1,this.lowRes.visible=!0;let Z=`lowres${r?"-unfilled":""}-${U.shapeType}`,[W,q]=e.project(U.origCenter),Q=U.ssr.angle,V=U.origAxis1.map(ee=>e.project(ee)),le=U.origAxis2.map(ee=>e.project(ee)),de=Xi(V[0],V[1]),ne=Xi(le[0],le[1]);this.lowRes.texture=m.get(Z)||Yt.WHITE,this.lowRes.position.set(W,q),this.lowRes.scale.set(de/10,ne/10),this.lowRes.rotation=Q,this.lowRes.tint=g}else this.lod=2,this.visible=!0,this.fill.visible=!0,this.stroke.visible=!0,this.lowRes.visible=!1,T={outer:new so(this.geometry.flatOuter),holes:(this.geometry.flatHoles||[]).map(U=>new so(U))};if(T&&this.stroke.visible){let U=r?1:d.fill.width||2;if(!E)this.stroke.clear().lineStyle({alpha:1,width:U,color:g}).drawShape(T.outer),T.holes.forEach(z=>this.stroke.drawShape(z));else{let z={alpha:1,dash:E,width:U,color:g};this.stroke.clear();let Z=new Pl(this.stroke,z),W=qE(T.outer.points);Z.drawPolygon(W),T.holes.forEach(q=>Z.drawPolygon(qE(q.points)))}}if(r?(this.fill.visible=!1,this.fill.clear(),this._bufferdata&&(this.container.hitArea=new so(this._bufferdata.perimeter))):this.container.hitArea=null,T&&this.fill.visible)if(this.fill.clear().beginTextureFill({alpha:_,color:g,texture:b}).drawShape(T.outer),T.holes.length&&(this.fill.beginHole(),T.holes.forEach(U=>this.fill.drawShape(U)),this.fill.endHole()),this.fill.endFill(),k){let U=new Hi().clear().lineTextureStyle({alpha:1,alignment:0,color:0,cap:Ui.BUTT,join:zr.BEVEL,width:Vy,texture:Yt.WHITE});U.drawShape(T.outer),T.holes.length&&T.holes.forEach(z=>U.drawShape(z)),U.geometry.updateBatches(!0),this.mask.geometry=new Qo().addAttribute("aVertexPosition",U.geometry.points,2).addAttribute("aTextureCoord",U.geometry.uvs,2).addIndex(U.geometry.indices),this.mask.visible=!0,this.fill.mask=this.mask}else this.mask.visible=!1,this.fill.mask=null;this._styleDirty=!1,this.updateHalo()}updateHalo(){let e=this.context.systems.map.wireframeMode,i=this.visible&&this.hovered,r=this.visible&&this.selected,s=this.visible&&this.highlighted;if(i){if(!this.container.filters){let n=new Jc({distance:15,outerStrength:3,color:16776960});n.resolution=2,this.container.filters=[n]}}else if(s){if(!this.container.filters){let n=new Jc({distance:15,outerStrength:3,color:7377663});n.resolution=2,this.container.filters=[n]}}else this.container.filters&&(this.container.filters=null);if(r){this.halo||(this.halo=new Hi,this.halo.name=`${this.id}-halo`,this.scene.layers.get("map-ui").container.addChild(this.halo));let n={alpha:.9,dash:[6,3],width:2,color:16776960};this.halo.clear();let o=new Pl(this.halo,n);this._bufferdata&&(o.drawPolygon(this._bufferdata.outer),e&&o.drawPolygon(this._bufferdata.inner))}else this.halo&&(this.halo.destroy({children:!0}),this.halo=null)}get style(){return this._style}set style(e){this._style=Object.assign({},pZ,e),this._styleDirty=!0}},pZ={requireFill:!1,lineMarkerName:"",lineMarkerTint:0,labelTint:15658734,fill:{width:2,color:11184810,alpha:.3},casing:{width:5,color:4473924,alpha:1,cap:Ui.ROUND,join:zr.ROUND},stroke:{width:3,color:13421772,alpha:1,cap:Ui.ROUND,join:zr.ROUND}};var mZ=4,jy=class extends Rr{constructor(e,i){super(e,i),this.enabled=!0,this._oldk=0}get enabled(){return!0}set enabled(e){this._enabled=!0}render(e,i,r){let s;if(r>=mZ){let a=this.context.systems.map.extent().rectangle();s=this.context.systems.locations.wpblocks().bbox(a),this.renderEditBlocks(e,i,r,s)}else s=[];let n=this.context.container().select(".main-content > .map-footer").selectAll(".api-status.blocks").data(s,a=>a.id);n.exit().remove();let o=n.enter().insert("div",".api-status").attr("class","api-status blocks error");o.append("span").attr("class","explanation-item").text(a=>a.text),o.append("a").attr("target","_blank").attr("href",a=>a.url).text("More Info")}renderEditBlocks(e,i,r,s){let n=this.context.systems.locations,o=this.scene.groups.get("blocks"),a={requireFill:!0,fill:{pattern:"construction",color:1,alpha:.7}};for(let l of s){let c=n.feature(l.locationSetID).geometry;if(!c)continue;let d=c.type==="Polygon"?[c.coordinates]:c.type==="MultiPolygon"?c.coordinates:[];for(let m=0;m<d.length;++m){let g=d[m],_=`${this.layerID}-${l.locationSetID}-${m}`,v=this.features.get(_);v||(v=new eu(this,_),v.geometry.setCoords(g),v.style=a,v.parentContainer=o,v.container.cursor="not-allowed",v.setData(l.locationSetID,l)),this.syncFeatureClasses(v),v.update(i,r),this.retainFeature(v,e)}}}};var Wr=class extends Th{constructor(e,i){super(e,i),this.type="point",this._viewfieldCount=0,this._isCircular=!1;let r=new rs;r.name="marker",r.eventMode="none",r.sortableChildren=!1,r.visible=!0,this.marker=r;let s=new rs;s.name="icon",s.eventMode="none",s.sortableChildren=!1,s.visible=!1,this.icon=s,this.viewfields=null,this.container.addChild(r,s)}destroy(){super.destroy(),this.marker=null,this.icon=null,this.viewfields=null}update(e,i){if(!this.dirty)return;this.updateGeometry(e,i),this.updateStyle(i);let r=this.container.position;this.sceneBounds=this.container.getLocalBounds().clone(),this.sceneBounds.x+=r.x,this.sceneBounds.y+=r.y,this.updateHitArea(),this.updateHalo()}updateGeometry(e,i){if(!this.geometry.dirty)return;this.geometry.update(e,i);let[r,s]=this.geometry.coords;this.container.position.set(r,s);let n=-this.geometry.origCoords[1];this.container.zIndex=this._viewfieldCount>0?n+1e3:n}updateStyle(e){var m,g,_,v;if(!this._styleDirty)return;let r=this.context.systems.map.wireframeMode,s=this.renderer.textures,n=this._style,o=["pin","boldPin","improveosm","osmose"].includes(n.markerName),a=this.marker,l=this.icon,c=this.geometry.origCoords[1];if(n.markerTexture||n.markerName?(a.alpha=(m=n.markerAlpha)!=null?m:1,a.tint=n.markerTint,a.visible=!0):a.visible=!1,n.iconTexture||n.iconName){l.texture=n.iconTexture||s.get(n.iconName),l.anchor.set(((g=n.anchor)==null?void 0:g.x)||.5,((_=n.anchor)==null?void 0:_.y)||.5);let E=11;l.width=E,l.height=E,l.alpha=(v=n.iconAlpha)!=null?v:1,l.tint=n.iconTint,l.visible=!0}else l.visible=!1;let d=n.viewfieldAngles||[];if(d.length>0){let E=n.viewfieldTexture||s.get(n.viewfieldName)||Yt.WHITE;if(this.container.zIndex=-c+1e3,this.viewfields||(this.viewfields=new Qi,this.viewfields.name="viewfields",this.viewfields.eventMode="none",this.viewfields.sortableChildren=!1,this.viewfields.visible=!0,this.container.addChildAt(this.viewfields,0)),this._viewfieldCount!==d.length){this.viewfields.removeChildren();for(let b=0;b<d.length;b++){let T=new rs(E);T.eventMode="none",T.anchor.set(.5,.5),this.viewfields.addChild(T)}this._viewfieldCount=d.length}for(let b=0;b<d.length;b++){let T=this.viewfields.getChildAt(b);T.tint=n.viewfieldTint||3355443,T.angle=d[b]}}else this.viewfields&&(this.viewfields.destroy({children:!0}),this.viewfields=null,this.container.zIndex=-c,this._viewfieldCount=0);if(e<16)this.lod=0,this.visible=!1;else if(e<17||r){this.lod=1,this.visible=!0,this.container.scale.set(.8,.8),this.viewfields&&(this.viewfields.renderable=!1);let E=o?"largeCircle":n.markerName;this._isCircular=!n.markerTexture&&/(circle|midpoint)$/i.test(E),a.texture=n.markerTexture||s.get(E),a.anchor.set(.5,.5),l.position.set(0,0)}else{this.lod=2,this.visible=!0,this.container.scale.set(1,1),this.viewfields&&(this.viewfields.renderable=!0);let E=o&&d.length?"largeCircle":n.markerName;this._isCircular=!n.markerTexture&&/(circle|midpoint)$/i.test(E),a.texture=n.markerTexture||s.get(E),o&&!this._isCircular?(a.anchor.set(.5,1),l.position.set(0,-14)):(a.anchor.set(.5,.5),l.position.set(0,0))}this._styleDirty=a.texture===Yt.EMPTY||l.texture===Yt.EMPTY}updateHitArea(){if(!this.visible)return;if(this._drawing){this.container.hitArea=null;return}let e=20,i=this.marker.getLocalBounds().clone();if(this._isCircular){let r=i.width/2;r<e/2&&(r=e/2),r=r+2;let s=new K1(0,0,r);this.container.hitArea=s}else i.width<e&&i.pad((e-i.width)/2,0),i.height<e&&i.pad(0,(e-i.height)/2),i.pad(4),this.container.hitArea=i}updateHalo(){let e=this.visible&&this.hovered,i=this.visible&&this.selected&&!this.virtual,r=this.visible&&this.highlighted;if(e){if(!this.container.filters){let s=new Jc({distance:15,outerStrength:3,color:16776960});s.resolution=2,this.container.filters=[s]}}else if(r){if(!this.container.filters){let s=new Jc({distance:15,outerStrength:3,color:7377663});s.resolution=2,this.container.filters=[s]}}else this.container.filters&&(this.container.filters=null);if(i){this.halo||(this.halo=new Hi,this.halo.name=`${this.id}-halo`,this.scene.layers.get("map-ui").container.addChild(this.halo));let s={alpha:.9,dash:[6,3],width:2,color:16776960};this.halo.clear();let n=this.container.hitArea;n instanceof K1?new Pl(this.halo,s).drawCircle(n.x,n.y,n.radius,20):n instanceof ri&&new Pl(this.halo,s).drawRect(n.x,n.y,n.width,n.height),this.halo.position=this.container.position}else this.halo&&(this.halo.destroy({children:!0}),this.halo=null)}get style(){return this._style}set style(e){this._style=Object.assign({},gZ,e),this._styleDirty=!0}},gZ={iconAlpha:1,iconName:"",iconTint:1118481,labelTint:15658734,markerAlpha:1,markerName:"smallCircle",markerTint:16777215,viewfieldAngles:[],viewfieldName:"viewfield",viewfieldTint:16777215};var yZ=12,Xy=class extends Rr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.improveOSM}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.improveOSM.startAsync()))}renderMarkers(e,i,r){let s=this.context.services.improveOSM;if(!(s!=null&&s.started))return;let n=this.scene.groups.get("qa"),o=s.getData();for(let a of o){let l=`${this.layerID}-${a.id}`,c=this.features.get(l);if(!c){let d={markerName:"improveosm",markerTint:s.getColor(a.itemType),iconName:a.icon};c=new Wr(this,l),c.geometry.setCoords(a.loc),c.style=d,c.parentContainer=n,c.setData(a.id,a)}this.syncFeatureClasses(c),c.update(i,r),c._isCircular||c.icon.position.set(0,-17),this.retainFeature(c,e)}}render(e,i,r){let s=this.context.services.improveOSM;!this.enabled||!(s!=null&&s.started)||r<yZ||(s.loadTiles(),this.renderMarkers(e,i,r))}};var _Z=35,xZ=30,Ia=class extends Th{constructor(e,i){super(e,i),this.type="line",this._bufferdata=null;let r=new Hi;r.name="casing",r.eventMode="none",r.sortableChildren=!1,this.casing=r;let s=new Hi;s.name="stroke",s.eventMode="none",s.sortableChildren=!1,this.stroke=s,this.container.addChild(r,s)}destroy(){super.destroy(),this.casing=null,this.stroke=null,this._bufferdata&&(delete this._bufferdata.inner,delete this._bufferdata.outer,delete this._bufferdata.perimeter,this._bufferdata=null)}update(e,i){if(!this.dirty)return;let r=this.context.systems.map.wireframeMode,s=this.renderer.textures,n=this.container,o=this._style;if(this.geometry.dirty){this.geometry.update(e,i);let[l,c]=this.geometry.extent.min,[d,m]=this.geometry.extent.max,[g,_]=[d-l,m-c];this.sceneBounds.x=l,this.sceneBounds.y=c,this.sceneBounds.width=g,this.sceneBounds.height=_,this.updateHitArea()}if(this._styleDirty){let{width:l,height:c}=this.sceneBounds,d=!0;l<4&&c<4?(this.lod=0,this.visible=!1,this.stroke.renderable=!1,this.casing.renderable=!1,d=!1):(this.visible=!0,this.stroke.renderable=!0,i<16?(this.lod=1,this.casing.renderable=!1,d=!1):(this.lod=2,this.casing.renderable=!0,d=!0));let m=n.getChildByName("lineMarkers");if(d&&(o.lineMarkerTexture||o.lineMarkerName||o.sidedMarkerTexture||o.sidedMarkerName)){m||(m=new Qi,m.name="lineMarkers",m.eventMode="none",m.sortableChildren=!1,m.roundPixels=!1,n.addChild(m));let g=o.lineMarkerTexture||s.get(o.lineMarkerName)||Yt.WHITE,_=o.sidedMarkerTexture||s.get(o.sidedMarkerName)||Yt.WHITE,v=o.sidedMarkerName==="sided",E=o.lineMarkerName==="oneway";m.removeChildren(),E&&c6(this.geometry.coords,_Z,!1,!0).forEach(T=>{T.coords.forEach(([A,M])=>{let k=new rs(g);k.eventMode="none",k.sortableChildren=!1,k.anchor.set(.5,.5),k.position.set(A,M),k.rotation=T.angle,k.tint=o.lineMarkerTint,m.addChild(k)})}),v&&c6(this.geometry.coords,xZ,!0,!0).forEach(T=>{T.coords.forEach(([A,M])=>{let k=new rs(_);k.eventMode="none",k.sortableChildren=!1,k.anchor.set(.5,.5),k.position.set(A,M),k.rotation=T.angle,k.tint=o.stroke.color,m.addChild(k)})})}else m&&(n.removeChild(m),m.destroy({children:!0}));this._styleDirty=!1}this.casing.renderable&&a("casing",this.casing,this.geometry.coords,o,r),this.stroke.renderable&&a("stroke",this.stroke,this.geometry.coords,o,r),this.updateHalo();function a(l,c,d,m,g){let _=l==="casing"?3:2,v=m[l].width;i<16?v-=4:i<17&&(v-=2),v<_&&(v=_),g&&(v=1);let E=c.clear();m[l].alpha!==0&&(m[l].dash?E=new Pl(E,{dash:m[l].dash,color:m[l].color,width:v,alpha:m[l].alpha||1,join:m[l].join||zr.ROUND,cap:m[l].cap||Ui.ROUND}):E=E.lineStyle({color:m[l].color,width:v,alpha:m[l].alpha||1,join:m[l].join||zr.ROUND,cap:m[l].cap||Ui.ROUND}),d.forEach(([b,T],A)=>{A===0?E.moveTo(b,T):E.lineTo(b,T)}))}}updateHitArea(){if(!this.geometry.flatOuter){this.container.hitArea=null;return}let i={alignment:.5,color:0,width:Math.max(3,this._style.casing.width||0)+10,alpha:1,join:zr.BEVEL,cap:Ui.BUTT};this._bufferdata=O4(this.geometry.flatOuter,i),this.container.hitArea=new so(this._bufferdata.perimeter)}updateHalo(){let e=this.visible&&this.hovered,i=this.visible&&this.selected,r=this.visible&&this.highlighted;if(e){if(!this.container.filters){let s=new Jc({distance:15,outerStrength:3,color:16776960});s.resolution=2,this.container.filters=[s]}}else if(r){if(!this.container.filters){let s=new Jc({distance:15,outerStrength:3,color:7377663});s.resolution=2,this.container.filters=[s]}}else this.container.filters&&(this.container.filters=null);if(i){this.halo||(this.halo=new Hi,this.halo.name=`${this.id}-halo`,this.scene.layers.get("map-ui").container.addChild(this.halo));let s={alpha:.9,dash:[6,3],width:2,color:16776960};this.halo.clear();let n=new Pl(this.halo,s);this._bufferdata&&(this._bufferdata.outer&&this._bufferdata.inner?(n.drawPolygon(this._bufferdata.outer),n.drawPolygon(this._bufferdata.inner)):n.drawPolygon(this._bufferdata.perimeter))}else this.halo&&(this.halo.destroy({children:!0}),this.halo=null)}get style(){return this._style}set style(e){this._style=Object.assign({},vZ,e),this._styleDirty=!0}},vZ={lineMarkerName:"",lineMarkerTint:0,labelTint:15658734,fill:{width:2,color:11184810,alpha:.3},casing:{width:5,color:4473924,alpha:1,cap:Ui.ROUND,join:zr.ROUND},stroke:{width:3,color:13421772,alpha:1,cap:Ui.ROUND,join:zr.ROUND}};var bZ=12,aS=2147583,wZ={casing:{alpha:0},stroke:{alpha:.9,width:4,color:aS}},EZ={markerName:"mediumCircle",markerTint:aS,viewfieldName:"viewfield",viewfieldTint:aS},Wy=class extends Rr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.kartaview}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.kartaview.startAsync()))}filterImages(e){let i=this.context.systems.photos,r=i.fromDate,s=i.toDate,n=i.usernames;if(r){let o=new Date(r).getTime();e=e.filter(a=>new Date(a.captured_at).getTime()>=o)}if(s){let o=new Date(s).getTime();e=e.filter(a=>new Date(a.captured_at).getTime()<=o)}return n&&(e=e.filter(o=>n.indexOf(o.captured_by)!==-1)),e}filterSequences(e){let i=this.context.systems.photos,r=i.fromDate,s=i.toDate,n=i.usernames;if(r){let o=new Date(r).getTime();e=e.filter(a=>new Date(a.properties.captured_at).getTime()>=o)}if(s){let o=new Date(s).getTime();e=e.filter(a=>new Date(a.properties.captured_at).getTime()<=o)}return n&&(e=e.filter(o=>n.indexOf(o.properties.captured_by)!==-1)),e}renderMarkers(e,i,r){let s=this.context.services.kartaview;if(!(s!=null&&s.started))return;let n=this.scene.groups.get("streetview"),o=s.getImages(),a=s.getSequences(),l=this.filterSequences(a),c=this.filterImages(o);for(let d of l){let m=`${this.layerID}-sequence-${d.properties.id}`,g=d.properties.v||0,_=this.features.get(m);_||(_=new Ia(this,m),_.style=wZ,_.parentContainer=n,_.container.zIndex=-100),_.v!==g&&(_.v=g,_.geometry.setCoords(d.coordinates),_.setData(d.properties.id,d)),this.syncFeatureClasses(_),_.update(i,r),this.retainFeature(_,e)}for(let d of c){let m=`${this.layerID}-photo-${d.id}`,g=this.features.get(m);if(!g){let _=Object.assign({},EZ);Number.isFinite(d.ca)&&(_.viewfieldAngles=[d.ca]),d.isPano&&(_.viewfieldName="pano"),g=new Wr(this,m),g.geometry.setCoords(d.loc),g.style=_,g.parentContainer=n,g.setData(d.id,d),d.sequenceID&&g.addChildData(d.sequenceID,d.id)}this.syncFeatureClasses(g),g.update(i,r),this.retainFeature(g,e)}}render(e,i,r){let s=this.context.services.kartaview;!this.enabled||!(s!=null&&s.started)||r<bZ||(s.loadTiles(),this.renderMarkers(e,i,r))}};var TZ=12,qy=class extends Rr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.keepRight}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.keepRight.startAsync()))}renderMarkers(e,i,r){let s=this.context.services.keepRight;if(!(s!=null&&s.started))return;let n=this.scene.groups.get("qa"),o=s.getData();for(let a of o){let l=`${this.layerID}-${a.id}`,c=this.features.get(l);if(!c){let d={markerName:"keepright",markerTint:s.getColor(a.parentIssueType)};c=new Wr(this,l),c.geometry.setCoords(a.loc),c.style=d,c.parentContainer=n,c.setData(a.id,a)}this.syncFeatureClasses(c),c.update(i,r),this.retainFeature(c,e)}}render(e,i,r){let s=this.context.services.keepRight;!this.enabled||!(s!=null&&s.started)||r<TZ||(s.loadTiles(),this.renderMarkers(e,i,r))}};var bN=Yi(kl(),1);var SZ=12,lS={fill:3355443,fontFamily:"Arial, Helvetica, sans-serif",fontSize:11,fontWeight:600,lineJoin:"round",stroke:16777215,strokeThickness:2.7},vN={fill:3355443,fontFamily:"Arial, Helvetica, sans-serif",fontSize:11,fontStyle:"italic",fontWeight:600,lineJoin:"round",stroke:16777215,strokeThickness:2.7},Yy=class{constructor(e,i,r){this.id=e,this.type=i,this.options=r,this.displayObject=null}},Zy=class extends Rr{constructor(e,i){super(e,i),this.enabled=!0;let r=this.scene.groups.get("labels");r.eventMode="none";let s=new K5(5e4);s.name="debug",s.eventMode="none",s.roundPixels=!1,s.sortableChildren=!1,this.debugContainer=s;let n=new Qi;n.name="labels",n.eventMode="none",n.sortableChildren=!0,this.labelContainer=n,r.addChild(s,n),this._rbush=new bN.default,this._avoidBoxes=new Map,this._labelBoxes=new Map,this._labels=new Map,this._oldk=0,Vs.from("label-normal",lS,{chars:Vs.ASCII,padding:0,resolution:2}),this._textStyleNormal=new Ln(lS),this._textStyleItalic=new Ln(vN)}resetAll(){for(let e of this._labels.values())e.displayObject&&(e.displayObject.destroy({children:!0,texture:!1,baseTexture:!1}),e.displayObject=null);this._avoidBoxes.clear(),this._labelBoxes.clear(),this._labels.clear(),this._rbush.clear()}resetFeature(e){let i=new Set,r=new Set;(this._labelBoxes.get(e)||[]).forEach(s=>i.add(s)),(this._avoidBoxes.get(e)||[]).forEach(s=>i.add(s));for(let s of i.values())this._rbush.remove(s),s.labelID&&r.add(s.labelID);this._labelBoxes.delete(e),this._avoidBoxes.delete(e);for(let s of r.values()){let n=this._labels.get(s);n&&n.displayObject&&(n.displayObject.destroy({children:!0,texture:!1,baseTexture:!1}),n.displayObject=null),this._labels.delete(s)}}render(e,i,r){if(this.enabled&&r>=SZ){this.labelContainer.visible=!0,this.debugContainer.visible=this.context.getDebug("label");let s=i.scale();s!==this._oldk&&(this.resetAll(),this._oldk=s);for(let l of this.scene.features.values())l._labelDirty&&(this.resetFeature(l.id),l._labelDirty=!1);this.gatherAvoids();let n=[],o=[],a=[];for(let l of this.scene.features.values())l.label&&l.visible&&!this._labelBoxes.has(l.id)&&(l.type==="point"?n.push(l):l.type==="line"?o.push(l):l.type==="polygon"&&a.push(l));this.labelPoints(n),this.labelLines(o),this.labelPolygons(a),this.renderObjects(i)}else this.labelContainer.visible=!1,this.debugContainer.visible=!1}getLabelSprite(e,i="normal"){let r=`${e}-${i}`,s=this.renderer.textures,n=s.getTexture("text",r);if(!n){let a=0,l=e.match(new RegExp("\\p{M}","gu"));l&&l.length>0&&(a=10),l&&l.length>20&&(a=50);let c;if(a){let b=Object.assign({},i==="normal"?lS:vN,{padding:a});c=new Ln(b)}else c=i==="normal"?this._textStyleNormal:this._textStyleItalic;let d=new Rd(e,c);d.resolution=2,d.updateText(!1);let[m,g]=[a*2,0],[_,v]=[d.canvas.width-a*4,d.canvas.height],E=d.context.getImageData(m,g,_,v);n=s.allocate("text",e,_,v,E),n.orig=d.texture.orig.clone(),n.orig.width=_/2,n.orig.height=v/2,d.destroy()}let o=new rs(n);return o.name=e,o.anchor.set(.5,.5),o}gatherAvoids(){let e=this.context.getDebug("label"),i=l.bind(this),r=[],n=this.scene.layers.get("map-ui").container.getChildByName("selected");n&&r.push(n);let o=this.scene.groups.get("points");o&&r.push(o);let a=[];r.forEach(c=>c.children.forEach(i)),a.length&&this._rbush.load(a);function l(c){if(!c.visible||!c.renderable)return;let d=c.name;if(this._avoidBoxes.has(d))return;let m=this.scene.features.get(d),g=m&&m.sceneBounds;if(!g)return;let _=.01,v={type:"avoid",boxID:`${d}-avoid`,featureID:d,minX:g.x+_,minY:g.y+_,maxX:g.x+g.width-_,maxY:g.y+g.height-_};this._avoidBoxes.set(d,[v]),a.push(v);let E=this._rbush.search(v);for(let b of E)if(b.type==="label"){let T=this.scene.features.get(b.featureID);T&&(T._labelDirty=!0)}}}labelPoints(e){e.sort((i,r)=>r.geometry.origCoords[1]-i.geometry.origCoords[1]);for(let i of e){if(this._labelBoxes.has(i.id)||(this._labelBoxes.set(i.id,[]),!i.label))continue;let r;/^[\x20-\x7E]*$/.test(i.label)?(r=new R2(i.label,{fontName:"label-normal"}),r.updateText(),r.name=i.label,r.anchor.set(.5,1)):r=this.getLabelSprite(i.label,"normal"),this.placeTextLabel(i,r)}}labelLines(e){function i(r){let s=parseInt(r.container.parent.name,10);return isNaN(s)?999:s}e.sort((r,s)=>i(s)-i(r));for(let r of e){let s=r.id;if(this._labelBoxes.has(s)||(this._labelBoxes.set(s,[]),!r.label)||!r.geometry.coords||!r.container.visible||!r.container.renderable||r.geometry.width<40&&r.geometry.height<40)continue;let n=this.getLabelSprite(r.label,"normal");this.placeRopeLabel(r,n,r.geometry.coords)}}labelPolygons(e){for(let i of e){let r=i.id;if(this._labelBoxes.has(r)||(this._labelBoxes.set(r,[]),!i.label)||!i.geometry.flatOuter||!i.container.visible||!i.container.renderable||i.geometry.width<600&&i.geometry.height<600)continue;let s=this.getLabelSprite(i.label,"italic"),n={alignment:.5,color:0,width:24,alpha:1,join:zr.BEVEL,cap:Ui.BUTT},o=O4(i.geometry.flatOuter,n);if(!o.inner)continue;let a=new Array(o.inner.length/2);for(let l=0;l<o.inner.length/2;++l)a[l]=[o.inner[l*2],o.inner[l*2+1]];this.placeRopeLabel(i,s,a)}}placeTextLabel(e,i){if(!e||!e.sceneBounds)return;let r=e.container;if(!r.visible||!r.renderable)return;let s=e.id,n=e.sceneBounds.clone().pad(1,0),o=n.x,a=n.y,l=n.width,c=n.height,d=n.x+l,m=n.x+l*.5,g=n.y+c,_=e.type==="point"?n.y+c-14:n.y+c*.5,v=i.getLocalBounds().clone().pad(0,-1),E=5,b=10,T=v.width,A=v.height,M=T*.5,k=A*.5,F={t1:[m-b,a-k],t2:[m-E,a-k],t3:[m,a-k],t4:[m+E,a-k],t5:[m+b,a-k],b1:[m-b,g+k],b2:[m-E,g+k],b3:[m,g+k],b4:[m+E,g+k],b5:[m+b,g+k],r1:[d+M,_-b],r2:[d+M,_-E],r3:[d+M,_],r4:[d+M,_+E],r5:[d+M,_+b],l1:[o-M,_-b],l2:[o-M,_-E],l3:[o-M,_],l4:[o-M,_+E],l5:[o-M,_+b]},O;this.context.systems.l10n.isRTL()?O=["l3","l4","l2","b3","b2","b4","b1","b5","t3","t2","t4","t1","t5","r3","r4","r2","l5","l1","r5","r1"]:O=["r3","r4","r2","b3","b4","b2","b5","b1","l3","l4","l2","t3","t4","t2","t5","t1","r5","r1","l5","l1"];let U=null;for(let z=0;!U&&z<O.length;z++){let Z=O[z],[W,q]=F[Z],Q=.01,V={type:"label",boxID:`${s}-${Z}`,featureID:s,labelID:s,minX:W-M+Q,minY:q-k+Q,maxX:W+M-Q,maxY:q+k-Q};if(!this._rbush.collides(V)){let le=new Yy(s,"text",{str:e.label,labelObj:i,x:W,y:q,tint:e.style.labelTint||15658734});this._labels.set(s,le),this._labelBoxes.get(s).push(V),this._rbush.insert(V),U=Z}}}placeRopeLabel(e,i,r){if(!e||!i||!r||!e.container.visible||!e.container.renderable)return;let s=e.id,n=i.getLocalBounds(),o=n.width,a=n.height,l=Math.PI/8,c=a+4,d=c*.5,m=Math.ceil(o/c)+1,g=o/((m-1)*c),_=m+15,v=c6(r,c),E=[],b=[],T=[],A=null;function M(){let k=T.length>=m;k&&b.push(T),T.forEach(F=>{F.box.candidate=k,E.push(F.box)}),T=[]}v.forEach((k,F)=>{let O=k.angle;O<0&&(O+=Math.PI),k.coords.forEach((B,U)=>{let[z,Z]=B,W=.01,q={type:"label",boxID:`${s}-${F}-${U}`,featureID:s,minX:z-d+W,minY:Z-d+W,maxX:z+d-W,maxY:Z+d-W},Q=!1;if(A!==null){let V=Math.abs(O-A);Q=Math.min(2*Math.PI-V,V)>l}A=O,Q?(M(),q.bendy=!0,E.push(q)):this._rbush.collides(q)?(M(),q.collides=!0,E.push(q)):(T.push({box:q,coord:B,angle:O}),T.length===_&&M())})}),M(),b.forEach((k,F)=>{let O=Math.floor((k.length-m)/2),B=`${s}-rope-${F}`,U=[];for(let Q=O;Q<O+m;Q++){U.push(k[Q].coord);let V=k[Q].box;V.labelID=B,this._rbush.insert(V),this._labelBoxes.get(s).push(V)}if(!U.length)return;U[0][0]>U[U.length-1][0]&&U.reverse();let z=fs(U[0],U[U.length-1]),Z=U.reduce((Q,V)=>Ir(Q,V),[0,0]),W=$o(Z,1/U.length);U=U.map(Q=>sr(Q,W)),U=Pu(U,-z,[0,0]),U=U.map(([Q,V])=>[Q*g,V]),U=Pu(U,z,[0,0]),U=U.map(Q=>Ir(Q,W));let q=new Yy(B,"rope",{str:e.label,coords:U,labelObj:i,tint:e.style.labelTint||15658734});this._labels.set(B,q)})}renderObjects(e){let i=this.context,r=i.getDebug("label"),s=i.pixi.screen,n=i.pixi.stage.position,o=new mt([s.x-n.x,s.y-n.y],[s.width-n.x,s.height-n.y]),a=new Set,l=this._rbush.search(o.bbox());for(let c of l)c.labelID&&a.add(c.labelID);for(let c of a.values()){let d=this._labels.get(c);if(!d)continue;let m=d.options;if(!d.displayObject){if(d.type==="text"){let g=m.labelObj;g.tint=m.tint||16777215,g.position.set(m.x,m.y),d.displayObject=g,this.labelContainer.addChild(g)}else if(d.type==="rope"){let g=m.labelObj,_=m.coords.map(([E,b])=>new ei(E,b)),v=new Q5(g.texture,_);v.name=c,v.autoUpdate=!1,v.sortableChildren=!1,v.tint=m.tint||16777215,d.displayObject=v,this.labelContainer.addChild(v)}}}}};var AZ=12,Qy=class extends Rr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.mapillary}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.mapillary.startAsync()))}filterDetections(e){let i=this.context.systems.photos,r=i.fromDate,s=i.toDate;if(r){let n=new Date(r).getTime();e=e.filter(o=>new Date(o.last_seen_at).getTime()>=n)}if(s){let n=new Date(s).getTime();e=e.filter(o=>new Date(o.first_seen_at).getTime()>=n)}return e}renderMarkers(e,i,r){let s=this.context.services.mapillary;if(!(s!=null&&s.started))return;let n=this.scene.groups.get("points"),o=s.getData("points");o=this.filterDetections(o);for(let a of o){let l=`${this.layerID}-${a.id}`,c=this.features.get(l);if(!c){let d={markerName:a.value};c=new Wr(this,l),c.geometry.setCoords(a.loc),c.style=d,c.parentContainer=n,c.setData(a.id,a)}this.syncFeatureClasses(c),c.update(i,r),this.retainFeature(c,e)}}render(e,i,r){let s=this.context.services.mapillary;this.enabled&&(s!=null&&s.started)&&r>=AZ?(s.loadTiles("points"),s.showFeatureDetections(!0),this.renderMarkers(e,i,r)):s==null||s.showFeatureDetections(!1)}};var CZ=12,cS=379747,IZ={casing:{alpha:0},stroke:{alpha:.9,width:4,color:cS}},kZ={markerName:"mediumCircle",markerTint:cS,viewfieldName:"viewfield",viewfieldTint:cS},Ky=class extends Rr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.mapillary}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.mapillary.startAsync()))}filterImages(e){let i=this.context.systems.photos,r=i.fromDate,s=i.toDate,n=i.usernames,o=i.showsPhotoType("flat"),a=i.showsPhotoType("panoramic");if(!o&&!a)return[];if(a&&!o?e=e.filter(l=>l.isPano):!a&&o&&(e=e.filter(l=>!l.isPano)),r){let l=new Date(r).getTime();e=e.filter(c=>new Date(c.captured_at).getTime()>=l)}if(s){let l=new Date(s).getTime();e=e.filter(c=>new Date(c.captured_at).getTime()<=l)}return n&&(e=e.filter(l=>n.indexOf(l.captured_by)!==-1)),e}filterSequences(e){let i=this.context.systems.photos,r=i.fromDate,s=i.toDate,n=i.usernames;if(r){let o=new Date(r).getTime();e=e.filter(a=>new Date(a[0].properties.captured_at).getTime()>=o)}if(s){let o=new Date(s).getTime();e=e.filter(a=>new Date(a[0].properties.captured_at).getTime()<=o)}return n&&(e=e.filter(o=>n.indexOf(o[0].properties.captured_by)!==-1)),e}renderMarkers(e,i,r){let s=this.context.services.mapillary;if(!(s!=null&&s.started))return;let n=this.scene.groups.get("streetview"),o=s.getSequences(),a=s.getData("images"),l=this.filterSequences(o),c=this.filterImages(a);for(let d of l)for(let m=0;m<d.length;++m){let g=d[m],_=g.properties.id,v=`${this.layerID}-sequence-${_}-${m}`,E=this.features.get(v);E||(E=new Ia(this,v),E.geometry.setCoords(g.geometry.coordinates),E.style=IZ,E.parentContainer=n,E.container.zIndex=-100,E.setData(_,g)),this.syncFeatureClasses(E),E.update(i,r),this.retainFeature(E,e)}for(let d of c){let m=`${this.layerID}-photo-${d.id}`,g=this.features.get(m);if(!g){let _=Object.assign({},kZ);Number.isFinite(d.ca)&&(_.viewfieldAngles=[d.ca]),d.isPano&&(_.viewfieldName="pano"),g=new Wr(this,m),g.geometry.setCoords(d.loc),g.style=_,g.parentContainer=n,g.setData(d.id,d),d.sequenceID&&g.addChildData(d.sequenceID,d.id)}this.syncFeatureClasses(g),g.update(i,r),this.retainFeature(g,e)}}render(e,i,r){let s=this.context.services.mapillary;!this.enabled||!(s!=null&&s.started)||r<CZ||(s.loadTiles("images"),this.renderMarkers(e,i,r))}};var MZ=12,Jy=class extends Rr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.mapillary}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.mapillary.startAsync()))}filterDetections(e){let i=this.context.systems.photos,r=i.fromDate,s=i.toDate;if(r){let n=new Date(r).getTime();e=e.filter(o=>new Date(o.last_seen_at).getTime()>=n)}if(s){let n=new Date(s).getTime();e=e.filter(o=>new Date(o.first_seen_at).getTime()>=n)}return e}renderMarkers(e,i,r){let s=this.context.services.mapillary;if(!(s!=null&&s.started))return;let n=this.scene.groups.get("points"),o=s.getData("signs");o=this.filterDetections(o);for(let a of o){let l=`${this.layerID}-${a.id}`,c=this.features.get(l);if(!c){let d={markerName:a.value};c=new Wr(this,l),c.geometry.setCoords(a.loc),c.style=d,c.parentContainer=n,c.setData(a.id,a)}this.syncFeatureClasses(c),c.update(i,r),this.retainFeature(c,e)}}render(e,i,r){let s=this.context.services.mapillary;this.enabled&&(s!=null&&s.started)&&r>=MZ?(s.loadTiles("signs"),s.showSignDetections(!0),this.renderMarkers(e,i,r)):s==null||s.showSignDetections(!1)}};var SN=Yi(u6(),1);var h6={DEFAULT:{fill:{width:2,color:11184810,alpha:.3},casing:{width:5,color:4473924,alpha:1,cap:Ui.ROUND,join:zr.ROUND},stroke:{width:3,color:13421772,alpha:1,cap:Ui.ROUND,join:zr.ROUND}},red:{fill:{color:14708319,alpha:.3}},green:{fill:{color:9228383,alpha:.3}},blue:{fill:{color:7853278,alpha:.3}},yellow:{fill:{color:16777108,alpha:.25}},gold:{fill:{color:12893721,alpha:.3}},orange:{fill:{color:14059546,alpha:.3}},pink:{fill:{color:14918901,alpha:.3}},teal:{fill:{color:10084778,alpha:.3}},lightgreen:{fill:{color:12511295,alpha:.3}},tan:{fill:{color:16112826,alpha:.3}},darkgray:{fill:{color:9211020,alpha:.5}},lightgray:{fill:{color:11184810,alpha:.3}},motorway:{casing:{width:10,color:7354159},stroke:{width:8,color:13574273}},trunk:{casing:{width:10,color:7354159},stroke:{width:8,color:14495522}},primary:{casing:{width:10,color:7354159},stroke:{width:8,color:16357382}},secondary:{casing:{width:10,color:7354159},stroke:{width:8,color:15987474}},tertiary:{casing:{width:10,color:7354159},stroke:{width:8,color:16775603}},unclassified:{casing:{width:10,color:4473924},stroke:{width:8,color:14535850}},residential:{casing:{width:10,color:4473924},stroke:{width:8,color:16777215}},living_street:{casing:{width:7,color:16777215},stroke:{width:5,color:13421772}},service:{casing:{width:7,color:4473924},stroke:{width:5,color:16777215}},special_service:{casing:{width:7,color:4473924},stroke:{width:5,color:14535850}},track:{casing:{width:7,color:7630703},stroke:{width:5,color:12957087}},pedestrian:{casing:{width:7,color:16777215},stroke:{width:5,color:10061960,dash:[8,8],cap:Ui.BUTT}},path:{casing:{width:5,color:14535850},stroke:{width:3,color:10061960,dash:[6,6],cap:Ui.BUTT}},footway:{casing:{width:5,color:16777215},stroke:{width:3,color:10061960,dash:[6,6],cap:Ui.BUTT}},crossing_marked:{casing:{width:5,color:14535850},stroke:{width:3,color:4998212,dash:[6,3],cap:Ui.BUTT}},crossing_unmarked:{casing:{width:5,color:14535850},stroke:{width:3,color:7826026,dash:[6,4],cap:Ui.BUTT}},cycleway:{casing:{width:5,color:16777215},stroke:{width:3,color:5810669,dash:[6,6],cap:Ui.BUTT}},bridleway:{casing:{width:5,color:16777215},stroke:{width:3,color:14708063,dash:[6,6],cap:Ui.BUTT}},corridor:{casing:{width:5,color:16777215},stroke:{width:3,color:9228383,dash:[2,8],cap:Ui.ROUND}},steps:{casing:{width:5,color:16777215},stroke:{width:3,color:8507996,dash:[3,3],cap:Ui.BUTT}},river:{casing:{width:10,color:4473924},stroke:{width:8,color:7855581}},stream:{casing:{width:7,color:4473924},stroke:{width:5,color:7855581}},ridge:{stroke:{width:2,color:9228383}},runway:{casing:{width:10,color:0,cap:Ui.BUTT},stroke:{width:8,color:16777215,dash:[24,48],cap:Ui.BUTT}},taxiway:{casing:{width:7,color:4473924},stroke:{width:5,color:16776960}},railway:{casing:{width:7,color:5592405,cap:Ui.BUTT},stroke:{width:2,color:15658734,dash:[12,12],cap:Ui.BUTT}},ferry:{casing:{alpha:0},stroke:{width:3,color:5810669,dash:[12,8],cap:Ui.BUTT}},boundary:{casing:{width:6,color:8566270,cap:Ui.BUTT},stroke:{width:2,color:16777215,dash:[20,5,5,5],cap:Ui.BUTT}},boundary_park:{casing:{width:6,color:8566270,cap:Ui.BUTT},stroke:{width:2,color:11592344,dash:[20,5,5,5],cap:Ui.BUTT}},barrier:{casing:{alpha:0},stroke:{width:3,color:14540253,dash:[10,5,1,5],cap:Ui.ROUND}},barrier_wall:{casing:{alpha:0},stroke:{width:3,color:14540253,dash:[10,5,1,5],cap:Ui.ROUND}},barrier_hedge:{fill:{color:9228383,alpha:.3},casing:{alpha:0},stroke:{width:3,color:9228383,dash:[10,5,1,5],cap:Ui.ROUND}},tree_row:{casing:{width:7,color:4473924},stroke:{width:5,color:9228383}}},PZ={aeroway:{runway:"runway",taxiway:"taxiway"},amenity:{childcare:"yellow",college:"yellow",fountain:"blue",kindergarten:"yellow",parking:"darkgray",research_institute:"yellow",school:"yellow",university:"yellow"},building:{"*":"red"},barrier:{city_wall:"barrier_wall",hedge:"barrier_hedge",retaining_wall:"barrier_wall",wall:"barrier_wall","*":"barrier"},boundary:{protected_area:"boundary_park",national_park:"boundary_park","*":"boundary"},crossing:{marked:"crossing_marked",traffic_signals:"crossing_marked",uncontrolled:"crossing_marked",zebra:"crossing_marked","*":"crossing_unmarked"},golf:{green:"lightgreen"},highway:{bridleway:"bridleway",bus_guideway:"railway",busway:"special_service",corridor:"corridor",cycleway:"cycleway",footway:"footway",living_street:"living_street",living_street_link:"living_street",motorway:"motorway",motorway_link:"motorway",path:"path",pedestrian:"pedestrian",primary:"primary",primary_link:"primary",residential:"residential",residential_link:"residential",secondary:"secondary",secondary_link:"secondary",service:"service",service_link:"service",steps:"steps",tertiary:"tertiary",tertiary_link:"tertiary",track:"track",trunk:"trunk",trunk_link:"trunk",unclassified:"unclassified",unclassified_link:"unclassified"},landuse:{cemetery:"lightgreen",commercial:"orange",construction:"gold",farmland:"lightgreen",farmyard:"tan",flowerbed:"green",forest:"green",grass:"green",industrial:"pink",landfill:"orange",meadow:"lightgreen",military:"orange",orchard:"lightgreen",quarry:"darkgray",railway:"darkgray",recreation_ground:"green",residential:"gold",retail:"orange",village_green:"green",vineyard:"lightgreen"},leisure:{garden:"green",golf_course:"green",nature_reserve:"green",park:"green",pitch:"green",swimming_pool:"blue",track:"yellow"},man_made:{adit:"darkgray",breakwater:"barrier_wall",groyne:"barrier_wall"},military:{"*":"orange"},natural:{bare_rock:"darkgray",bay:"blue",beach:"yellow",cave_entrance:"darkgray",cliff:"darkgray",glacier:"lightgray",ridge:"ridge",rock:"darkgray",sand:"yellow",scree:"darkgray",scrub:"yellow",shingle:"darkgray",stone:"darkgray",tree_row:"tree_row",water:"blue",wetland:"teal","*":"green"},power:{plant:"pink"},railway:{platform:"footway","*":"railway"},route:{ferry:"ferry"},sport:{baseball:"yellow",basketball:"darkgray",beachvolleyball:"yellow",skateboard:"darkgray",softball:"yellow"},type:{waterway:"river"},waterway:{river:"river",dam:"DEFAULT",weir:"DEFAULT","*":"stream"},service:{alley:"special_service",driveway:"special_service","drive-through":"special_service",parking_aisle:"special_service","*":"special_service"}},RZ={amenity:{fountain:"water_standing",grave_yard:"cemetery"},golf:{green:"grass"},landuse:{cemetery:"cemetery",construction:"construction",farmland:"farmland",farmyard:"farmyard",forest:"forest",grass:"grass",grave_yard:"cemetery",landfill:"landfill",meadow:"grass",military:"construction",orchard:"orchard",quarry:"quarry",vineyard:"vineyard"},leaf_type:{broadleaved:"forest_broadleaved",leafless:"forest_leafless",needleleaved:"forest_needleleaved"},natural:{beach:"dots",grassland:"grass",sand:"dots",scrub:"bushes",water:"waves",wetland:"wetland",wood:"forest"},religion:{buddhist:"cemetery_buddhist",christian:"cemetery_christian",jewish:"cemetery_jewish",muslim:"cemetery_muslim"},surface:{grass:"grass"},water:{pond:"pond",reservoir:"lines"},wetland:{bog:"wetland_bog",marsh:"wetland_marsh",reedbed:"wetland_reedbed",swamp:"wetland_swamp"}},DZ={motorway:!0,motorway_link:!0,trunk:!0,trunk_link:!0,primary:!0,primary_link:!0,secondary:!0,secondary_link:!0,tertiary:!0,tertiary_link:!0,unclassified:!0,unclassified_link:!0,residential:!0,residential_link:!0,living_street:!0,living_street_link:!0,service:!0,service_link:!0,bus_guideway:!0,track:!0};function Sh(t){let e=h6.DEFAULT,i=999;for(let[_,v]of Object.entries(t)){let E=PZ[_];if(!E||!v)continue;let b=Object.keys(E).length,T=E[v]||E["*"];if(T&&b<=i){if(!h6[T]){console.error(`invalid stylename: ${T}`);continue}if(e=h6[T],i=b,i===1)break}}let r={};for(let _ of["fill","casing","stroke"]){r[_]={};for(let v of["width","color","alpha","cap","dash"]){let E=e[_]&&e[_][v];if(E!==void 0){r[_][v]=E;continue}let b=h6.DEFAULT[_]&&h6.DEFAULT[_][v];b!==void 0&&(r[_][v]=b)}}let s=g(t,"bridge"),n=g(t,"building"),o=g(t,"cutting"),a=g(t,"embankment"),l=g(t,"highway"),c=g(t,"tracktype"),d=g(t,"tunnel"),m=g(t,"surface");if(l==="track"&&c!=="grade1"&&(m=m||"dirt"),(s||a||o)&&(r.casing.width+=7,r.casing.color=0,r.casing.cap=Ui.BUTT,(a||o)&&(r.casing.dash=[2,4])),d&&(r.stroke.alpha=.5),m&&DZ[l]&&!td.surface[m]&&(s||(r.casing.color=13421772),r.casing.cap=Ui.BUTT,r.casing.dash=[4,4]),r.fill.pattern||n)return r;i=999;for(let _ in t){let v=t[_],E=RZ[_];if(!E||!v)continue;let b=Object.keys(E).length,T=E[v];if(T||(T=E["*"]),T&&b<=i&&(r.fill.pattern=T,i=b,i===1))break}return r;function g(_,v){return _[v]==="no"?void 0:_[v]}}var FZ=12,t_=class extends Rr{constructor(e,i){super(e,i),this.enabled=!0;let r=this.scene.groups.get("basemap");this._resolved=new Map;let s=new Qi;s.name=`${this.layerID}-areas`,s.sortableChildren=!0,this.areaContainer=s;let n=new Qi;n.name=`${this.layerID}-lines`,n.sortableChildren=!0,this.lineContainer=n,r.addChild(s,n)}get supported(){return!!this.context.services.osm}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.osm.startAsync()))}render(e,i,r){var b,T,A,M,k,F;let s=this.context.services.osm;if(!this.enabled||!(s!=null&&s.started)||r<FZ)return;let n=this.context,o=n.graph(),a=n.systems.map;n.loadTiles(n.projection);let l=n.systems.edits.intersects(a.extent());l=n.systems.filters.filter(l,o);let c={polygons:new Map,lines:new Map,points:new Map,vertices:new Map};for(let O of l){let B=O.geometry(o);B==="point"?c.points.set(O.id,O):B==="vertex"?c.vertices.set(O.id,O):B==="line"?c.lines.set(O.id,O):B==="area"&&c.polygons.set(O.id,O)}this.renderPolygons(e,i,r,c),this.renderLines(e,i,r,c),this.renderPoints(e,i,r,c);let d=(b=this._classHasData.get("selected"))!=null?b:new Set,m=(T=this._classHasData.get("hovered"))!=null?T:new Set,g=(A=this._classHasData.get("drawing"))!=null?A:new Set,_=new Set([...d,...m,...g]);for(let O of _){let B=n.hasEntity(O);if((B==null?void 0:B.type)==="node")continue;let U=(M=this._dataHasFeature.get(O))!=null?M:new Set,z=!1;for(let Z of U){let W=(k=this.features.get(Z))==null?void 0:k.geometry;if(!(!W||W.type==="point")&&W.width<25&&W.height<25){z=!0;break}}z&&_.delete(O)}let v=new Set(_);for(let O of _){let B=n.hasEntity(O);if((B==null?void 0:B.type)==="node")for(let U of o.parentWays(B))v.add(U.id)}let E={descendantIDs:new Set,siblingIDs:new Set};for(let O of v)this.getSelfAndDescendants(O,E.descendantIDs),this.getSelfAndSiblings(O,E.siblingIDs);this.renderVertices(e,i,r,c,E),((F=n.mode)==null?void 0:F.id)==="select-osm"&&this.renderMidpoints(e,i,r,c,E)}renderPolygons(e,i,r,s){var _,v;let n=s.polygons,o=this.context,a=o.graph(),l=o.systems.l10n,c=o.systems.presets,d=this.scene.groups.get("points"),m=o.systems.filters.isEnabled("points");function g(E){return!E||E.isFallback()||/^(address|building|indoor|landuse|man_made|military|natural|playground)/.test(E.id)?!1:!!(/^(club|craft|emergency|healthcare|office|power|shop|telecom|tourism)/.test(E.id)||/^amenity\/(?!parking|shelter)/.test(E.id)||/^leisure\/(?!garden|firepit|picnic_table|pitch|swimming_pool)/.test(E.id))}for(let[E,b]of n){let T=b.v||0,A=this._resolved.get(E);(A==null?void 0:A.v)!==T&&(A=null),A||(A=(0,SN.default)(b.asGeoJSON(a),!0),A.v=T,this._resolved.set(E,A));let M=A.type==="Polygon"?[A.coordinates]:A.type==="MultiPolygon"?A.coordinates:[];for(let k=0;k<M.length;++k){let F=M[k],O=`${this.layerID}-${E}-fill-${k}`,B=this.features.get(O);if(B&&B.type!=="polygon"&&(B.destroy(),B=null),B||(B=new eu(this,O),B.parentContainer=this.areaContainer),B.v!==T){B.v=T,B.geometry.setCoords(F);let U=B.geometry.origExtent.area();B.container.zIndex=-U,B.setData(E,b),B.clearChildData(E),b.type==="relation"&&b.members.forEach(z=>B.addChildData(E,z.id)),b.type==="way"&&b.nodes.forEach(z=>B.addChildData(E,z))}if(this.syncFeatureClasses(B),B.dirty){let U=c.match(b,a),z=Sh(b.tags);z.labelTint=(v=(_=z.fill.color)!=null?_:z.stroke.color)!=null?v:15658734,B.style=z;let Z=l.displayPOIName(b.tags);B.label=Z,m&&(Z||g(U))?(B.poiFeatureID=`${this.layerID}-${E}-poi-${k}`,B.poiPreset=U):(B.poiFeatureID=null,B.poiPreset=null)}if(B.update(i,r),this.retainFeature(B,e),B.poiFeatureID&&B.poiPreset&&B.geometry.origPoi){let U=this.features.get(B.poiFeatureID);if(U||(U=new Wr(this,B.poiFeatureID),U.virtual=!0,U.parentContainer=d),U.v!==T&&(U.v=T,U.geometry.setCoords(B.geometry.origPoi),U.setData(E,b)),this.syncFeatureClasses(U),U.dirty){let z={iconName:B.poiPreset.icon,iconTint:1118481,markerName:"pin",markerTint:16777215};uS(b)&&(z.iconTint=4473924,z.labelTint=14540253,z.markerName="boldPin",z.markerTint=14540253),U.style=z,U.label=B.label}U.update(i,r),this.retainFeature(U,e)}}}}renderLines(e,i,r,s){let n=s.lines,o=this.context,a=o.graph(),l=o.systems.l10n,c=this.lineContainer;for(let[m,g]of n){let _=typeof g.layer=="function"?g.layer():0,v=d(_.toString()),E=NZ(g.tags),b=g.v||0,T=this._resolved.get(m);(T==null?void 0:T.v)!==b&&(T=null),T||(T=g.asGeoJSON(a),T.v=b,T.type==="LineString"&&g.tags.oneway==="-1"&&T.coordinates.reverse(),this._resolved.set(m,T));let A=T.type==="LineString"?[[T.coordinates]]:T.type==="Polygon"?[T.coordinates]:T.type==="MultiPolygon"?T.coordinates:[];for(let M=0;M<A.length;++M){let k=A[M];for(let F=0;F<k.length;++F){let O=k[F],B=`${this.layerID}-${m}-${M}-${F}`,U=this.features.get(B);if(U&&U.type!=="line"&&(U.destroy(),U=null),U||(U=new Ia(this,B)),U.v!==b&&(U.v=b,U.geometry.setCoords(O),U.parentContainer=v,U.container.zIndex=E,U.setData(m,g),U.clearChildData(m),g.type==="relation"&&g.members.forEach(z=>U.addChildData(m,z.id)),g.type==="way"&&g.nodes.forEach(z=>U.addChildData(m,z))),this.syncFeatureClasses(U),U.dirty){let z=g.tags,Z=g.geometry(a);if(!g.hasInterestingTags()){let q=a.parentRelations(g).find(Q=>Q.isMultipolygon());q&&(z=q.tags,Z="area")}let W=Sh(z);Z==="line"?(W.lineMarkerName=g.isOneWay()?"oneway":"",W.sidedMarkerName=g.isSided()?"sided":""):(W.casing.width=0,W.stroke.color=W.fill.color,W.stroke.width=2,W.stroke.alpha=1),U.style=W,U.label=l.displayName(g.tags)}U.update(i,r),this.retainFeature(U,e)}}}function d(m){let g=c.getChildByName(m);return g||(g=new Qi,g.name=m.toString(),g.sortableChildren=!0,g.zIndex=m,c.addChild(g)),g}}renderVertices(e,i,r,s,n){let o=s.vertices,a=this.context,l=a.graph(),c=a.systems.l10n,d=a.systems.presets,g=this.scene.layers.get("map-ui").container.getChildByName("selected"),_=this.scene.groups.get("points");function v(b){return b.hasInterestingTags()||b.isEndpoint(l)||b.isIntersection(l)}function E(b){return n.descendantIDs.has(b)||n.siblingIDs.has(b)}for(let[b,T]of o){let A=null;if(r>=16&&v(T)&&(A=_),E(b)&&(A=g),!A)continue;let M=`${this.layerID}-${b}`,k=T.v||0,F=this.features.get(M);if(F&&F.type!=="point"&&(F.destroy(),F=null),F||(F=new Wr(this,M)),F.v!==k&&(F.v=k,F.geometry.setCoords(T.loc),F.setData(b,T)),this.syncFeatureClasses(F),F.parentContainer=A,F.dirty){let O=d.match(T,l),B=O==null?void 0:O.icon,U=T.directions(l,a.projection),z={iconName:B,iconTint:1118481,labelTint:15658734,markerName:"smallCircle",markerTint:16777215,viewfieldAngles:U,viewfieldName:"viewfieldDark",viewfieldTint:16777215};B?(z.markerName="largeCircle",z.iconName=B):T.hasInterestingTags()&&(z.markerName="taggedCircle"),uS(T)&&(z.iconTint=4473924,z.labelTint=14540253,z.markerTint=14540253),l.isShared(T)&&(z.iconTint=1118481,z.labelTint=12303291,z.markerTint=12303291),F.style=z,F.label=c.displayName(T.tags)}F.update(i,r),this.retainFeature(F,e)}}renderPoints(e,i,r,s){let n=s.points,o=this.context,a=o.graph(),l=o.systems.l10n,c=o.systems.presets,d=this.scene.groups.get("points");for(let[m,g]of n){let _=`${this.layerID}-${m}`,v=g.v||0,E=this.features.get(_);if(E&&E.type!=="point"&&(E.destroy(),E=null),E||(E=new Wr(this,_),E.parentContainer=d),E.v!==v&&(E.v=v,E.geometry.setCoords(g.loc),E.setData(m,g)),this.syncFeatureClasses(E),E.dirty){let b=c.match(g,a),T=b==null?void 0:b.icon;T||(b=c.matchTags(g.tags,"vertex"),T=b==null?void 0:b.icon);let A=g.directions(a,o.projection),M={iconName:T,iconTint:1118481,markerName:"pin",markerTint:16777215,viewfieldAngles:A,viewfieldName:"viewfieldDark",viewfieldTint:16777215};uS(g)&&(M.iconTint=4473924,M.labelTint=14540253,M.markerName="boldPin",M.markerTint=14540253),b.id==="address"&&(M.iconName="maki-circle-stroked",M.markerName="largeCircle"),E.style=M,E.label=l.displayName(g.tags)}E.update(i,r),this.retainFeature(E,e)}}renderMidpoints(e,i,r,s,n){let a=this.context.graph(),l=new Map([...s.lines,...s.polygons]),d=this.scene.layers.get("map-ui").container.getChildByName("selected"),m=new Map,g={markerName:"midpoint"};for(let[_,v]of l){if(!n.descendantIDs.has(_))continue;let E=a.childNodes(v);if(!E.length)continue;let b=E.map(T=>({id:T.id,point:i.project(T.loc)}));v.tags.oneway==="-1"&&b.reverse(),b.slice(0,-1).forEach((T,A)=>{let M=b[A],k=b[A+1],F=[M.id,k.id].sort().join("-");if(Xi(M.point,k.point)<40)return;let B=yr(M.point,k.point,.5),U=fs(M.point,k.point),z=i.invert(B),Z={type:"midpoint",id:F,a:M,b:k,way:v,loc:z,rot:U};m.has(F)||m.set(F,Z)})}for(let[_,v]of m){let E=`${this.layerID}-${_}`,b=this.features.get(E);b||(b=new Wr(this,E),b.style=g,b.parentContainer=d),b.v!==v.loc&&(b.v=v.loc,b.geometry.setCoords(v.loc),b.container.rotation=v.rot,b.setData(_,v),b.addChildData(v.way.id,_)),this.syncFeatureClasses(b),b.update(i,r),this.retainFeature(b,e)}}},LZ={motorway:0,motorway_link:-1,trunk:-2,trunk_link:-3,primary:-4,primary_link:-5,secondary:-6,tertiary:-7,unclassified:-8,residential:-9,service:-10,track:-11,footway:-12};function NZ(t){return LZ[t.highway]||0}function uS(t){return t.tags.wikidata||t.tags["flag:wikidata"]||t.tags["brand:wikidata"]||t.tags["network:wikidata"]||t.tags["operator:wikidata"]}var OZ=12,i_=class extends Rr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.osm}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.osm.startAsync()))}renderMarkers(e,i,r){let s=this.context.services.osm;if(!(s!=null&&s.started))return;let n=this.scene.groups.get("qa"),o=s.notes(this.context.projection);for(let a of o){let l=`${this.layerID}-${a.id}`,c=this.features.get(l);if(!c){let d=16724736,m="rapid-icon-close";a.status==="closed"&&(d=5627136,m="rapid-icon-apply"),a.isNew()&&(d=16772608,m="rapid-icon-plus");let g={markerName:"osmnote",markerTint:d,iconName:m,anchor:{y:.65}};c=new Wr(this,l),c.geometry.setCoords(a.loc),c.style=g,c.parentContainer=n,c.setData(a.id,a)}this.syncFeatureClasses(c),c.update(i,r),this.retainFeature(c,e)}}render(e,i,r){let s=this.context.services.osm;!this.enabled||!(s!=null&&s.started)||r<OZ||(s.loadNotes(this.context.projection),this.renderMarkers(e,i,r))}};var BZ=12,r_=class extends Rr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.osmose}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.osmose.startAsync()))}renderMarkers(e,i,r){let s=this.context.services.osmose;if(!(s!=null&&s.started))return;let n=this.scene.groups.get("qa"),o=s.getData();for(let a of o){let l=`${this.layerID}-${a.id}`,c=this.features.get(l);if(!c){let d={markerName:"osmose",markerTint:s.getColor(a.item),iconName:a.icon};c=new Wr(this,l),c.geometry.setCoords(a.loc),c.style=d,c.parentContainer=n,c.setData(a.id,a)}this.syncFeatureClasses(c),c.update(i,r),c._isCircular||c.icon.position.set(0,-17),this.retainFeature(c,e)}}render(e,i,r){let s=this.context.services.osmose;!this.enabled||!(s!=null&&s.started)||r<BZ||(s.loadTiles(),this.renderMarkers(e,i,r))}};var AN=Yi(u6(),1);var UZ=12,s_=class extends Rr{constructor(e,i){super(e,i),this.enabled=!0,this._resolved=new Map}get supported(){let e=this.context.services;return!!e.mapwithai||!!e.esri}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.mapwithai.startAsync(),this.context.services.esri.startAsync()))}render(e,i,r){let s=this.context.systems.rapid;if(!(!this.enabled||!s.datasets.size||r<UZ))for(let n of s.datasets.values())this.renderDataset(n,e,i,r)}renderDataset(e,i,r,s){let n=this.context,o=n.systems.rapid;if(!(e.added&&e.enabled))return;let l=n.services[e.service];if(!(l!=null&&l.started))return;let c=e.id+(e.conflated?"-conflated":""),d=l.graph(c);function m(M){return o.acceptedIDs.has(M.id)||o.acceptedIDs.has(M.__origid__)}let g={points:[],vertices:new Set,lines:[],polygons:[]};if(e.service==="mapwithai"){s>=15&&l.loadTiles(c);let M=l.getData(c).filter(k=>k.type==="way"&&!m(k));e.id==="fbRoads"||e.id==="rapid_intro_graph"?(g.lines=M.filter(k=>k.geometry(d)==="line"&&!!k.tags.highway),g.lines.forEach(k=>{let F=d.entity(k.first()),O=d.entity(k.last());g.vertices.add(F),g.vertices.add(O)})):g.polygons=M.filter(k=>k.geometry(d)==="area")}else if(e.service==="esri"){s>=14&&l.loadTiles(c);let M=l.getData(c);for(let k of M){if(m(k))continue;let F=k.geometry(d);F==="point"&&k.__fbid__?g.points.push(k):F==="line"?g.lines.push(k):F==="area"&&g.polygons.push(k)}}let _=this.scene.groups.get("points"),v=this.scene.groups.get("basemap"),E=`${this.layerID}-${e.id}-areas`,b=`${this.layerID}-${e.id}-lines`,T=v.getChildByName(E);T||(T=new Qi,T.name=E,T.sortableChildren=!0,v.addChild(T));let A=v.getChildByName(b);A||(A=new Qi,A.name=b,A.sortableChildren=!0,v.addChild(A)),this.renderPolygons(T,e,d,i,r,s,g),this.renderLines(A,e,d,i,r,s,g),this.renderPoints(_,e,d,i,r,s,g)}renderPolygons(e,i,r,s,n,o,a){let l=new mi(i.color),c=this.context.systems.l10n;for(let d of a.polygons){let m=this._resolved.get(d.id);m||(m=(0,AN.default)(d.asGeoJSON(r),!0),this._resolved.set(d.id,m));let g=m.type==="Polygon"?[m.coordinates]:m.type==="MultiPolygon"?m.coordinates:[];for(let _=0;_<g.length;++_){let v=g[_],E=`${this.layerID}-${i.id}-${d.id}-${_}`,b=this.features.get(E);if(!b){b=new eu(this,E),b.geometry.setCoords(v);let T=b.geometry.origExtent.area();b.container.zIndex=-T,b.parentContainer=e,b.rapidFeature=!0,b.setData(d.id,d)}if(this.syncFeatureClasses(b),b.dirty){let T={labelTint:l,fill:{width:2,color:l,alpha:.3}};b.style=T,b.label=c.displayName(d.tags),b.update(n,o)}this.retainFeature(b,s)}}}renderLines(e,i,r,s,n,o,a){let l=new mi(i.color),c=this.context.systems.l10n;for(let d of a.lines){let m=`${this.layerID}-${i.id}-${d.id}`,g=this.features.get(m);if(!g){let v=d.asGeoJSON(r).coordinates;d.tags.oneway==="-1"&&v.reverse(),g=new Ia(this,m),g.geometry.setCoords(v),g.parentContainer=e,g.rapidFeature=!0,g.setData(d.id,d)}if(this.syncFeatureClasses(g),g.dirty){let _={labelTint:l,casing:{width:5,color:4473924},stroke:{width:3,color:l}};_.lineMarkerName=d.isOneWay()?"oneway":"",g.style=_,g.label=c.displayName(d.tags),g.update(n,o)}this.retainFeature(g,s)}}renderPoints(e,i,r,s,n,o,a){let l=new mi(i.color),c=this.context.systems.l10n,d={markerName:"largeCircle",markerTint:l,iconName:"maki-circle-stroked",labelTint:l},m={markerName:"smallCircle",markerTint:l,labelTint:l};for(let g of a.points){let _=`${this.layerID}-${i.id}-${g.id}`,v=this.features.get(_);if(v||(v=new Wr(this,_),v.geometry.setCoords(g.loc),v.parentContainer=e,v.rapidFeature=!0,v.setData(g.id,g)),this.syncFeatureClasses(v),v.dirty){v.style=d,v.label=c.displayName(g.tags);let E=g.tags["addr:housenumber"];!v.label&&E&&(v.label=E),v.update(n,o)}this.retainFeature(v,s)}for(let g of a.vertices){let _=`${this.layerID}-${g.id}`,v=this.features.get(_);if(v||(v=new Wr(this,_),v.geometry.setCoords(g.loc),v.parentContainer=e,v.rapidFeature=!0,v.allowInteraction=!1,v.setData(g.id,g)),this.syncFeatureClasses(v),v.dirty){v.style=m,v.label=c.displayName(g.tags);let E=g.tags["addr:housenumber"];!v.label&&E&&(v.label=E),v.update(n,o)}this.retainFeature(v,s)}}};var n_=class extends Rr{constructor(e,i){super(e,i),this.enabled=!0;let r=new Qi;r.name=i,r.sortableChildren=!0,this.container=r,this.scene.groups.get("ui").addChild(r),this._oldk=0,this._geolocationData=null,this._geolocationDirty=!1;let n=new Qi;n.name="geolocation",n.eventMode="none",n.sortableChildren=!1,n.visible=!1,this.geolocationContainer=n;let o=new Qi;o.name="tile-debug",o.eventMode="none",o.sortableChildren=!1,o.visible=!1,this.tileDebugContainer=o;let a=new Qi;a.name="selected",a.sortableChildren=!0,a.visible=!0,this.selectedContainer=a,this._lassoPolygonData=null,this._lassoPolygonDirty=!1,this._lassoLineGraphics=new Hi,this._lassoFillGraphics=new Hi;let l=new Qi;l.name="lasso",l.eventMode="none",l.sortableChildren=!1,l.visible=!0,l.addChild(this._lassoLineGraphics,this._lassoFillGraphics),this.lassoContainer=l,this.container.addChild(n,o,a,l)}get enabled(){return!0}set enabled(e){this._enabled=!0}get geolocationData(){return this._geolocationData}set geolocationData(e){this._geolocationData=e,this._geolocationDirty=!0}get lassoPolygonData(){return this._lassoPolygonData}set lassoPolygonData(e){this._lassoPolygonData=e,this._lassoPolygonDirty=!0}render(e,i){let r=i.scale();r!==this._oldk&&(this._geolocationDirty=!0,this._lassoPolygonDirty=!0,this._oldk=r),this._geolocationDirty&&this.renderGeolocation(e,i),this._lassoPolygonDirty&&this.renderLasso(e,i)}renderLasso(e,i){var s;this._lassoPolygonDirty&&(this._lassoPolygonDirty=!1);let r={alpha:.7,dash:[6,3],width:1,color:16777215};if(!this._lassoPolygonData&&this._lassoLineGraphics.parent)this.lassoContainer.removeChildren();else if(this._lassoLineGraphics.parent||(this.lassoContainer.addChild(this._lassoLineGraphics),this.lassoContainer.addChild(this._lassoFillGraphics)),this._lassoLineGraphics.clear(),this._lassoFillGraphics.clear(),((s=this._lassoPolygonData)==null?void 0:s.length)>0){let n=this._lassoPolygonData.map(o=>i.project(o));new Pl(this._lassoLineGraphics,r).drawPolygon(n.flat()),this._lassoFillGraphics.beginFill(11184810,.5).drawPolygon(n.flat()).endFill()}}renderGeolocation(e,i){if(this._geolocationDirty)if(this._geolocationDirty=!1,this.geolocationContainer.removeChildren(),this.geolocationData&&this.geolocationData.coords){let r=this.geolocationData.coords,s=[r.longitude,r.latitude],[n,o]=i.project(s),a=Dn(r.accuracy,s[1]),l=[r.longitude+a,r.latitude],c=i.project(l)[0],d=Math.max(Math.abs(c-n),15),m=942335,g=new Hi().beginFill(m,.4).drawCircle(n,o,d).endFill();if(g.name="aura",this.geolocationContainer.addChild(g),r.heading!==null&&!isNaN(r.heading)){let v=this.renderer.textures,E=new rs(v.get("viewfieldDark"));E.anchor.set(.5,1),E.angle=r.heading,E.name="heading",E.position.set(n,o),this.geolocationContainer.addChild(E)}let _=new Hi().lineStyle(1.5,16777215,1).beginFill(m,1).drawCircle(n,o,6.5).endFill();_.name="position",this.geolocationContainer.addChild(_),this.geolocationContainer.visible=!0}else this.geolocationContainer.visible=!1}};var zZ=12,hS=1048516,GZ={casing:{alpha:0},stroke:{alpha:.9,width:4,color:hS}},$Z={markerName:"mediumCircle",markerTint:hS,viewfieldName:"viewfield",viewfieldTint:hS},o_=class extends Rr{constructor(e,i){super(e,i)}get supported(){return!!this.context.services.streetside}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.streetside.startAsync()))}filterImages(e){let i=this.context.systems.photos,r=i.fromDate,s=i.toDate,n=i.usernames;if(r){let o=new Date(r).getTime();e=e.filter(a=>new Date(a.captured_at).getTime()>=o)}if(s){let o=new Date(s).getTime();e=e.filter(a=>new Date(a.captured_at).getTime()<=o)}return n&&(e=e.filter(o=>n.includes(o.captured_by))),e}filterSequences(e){let i=this.context.systems.photos,r=i.fromDate,s=i.toDate,n=i.usernames;if(r){let o=new Date(r).getTime();e=e.filter(a=>new Date(a.captured_at).getTime()>=o)}if(s){let o=new Date(s).getTime();e=e.filter(a=>new Date(a.captured_at).getTime()<=o)}return n&&(e=e.filter(o=>n.includes(o.captured_by))),e}renderMarkers(e,i,r){let s=this.context.services.streetside;if(!(s!=null&&s.started))return;let n=this.scene.groups.get("streetview"),o=s.getImages(),a=s.getSequences(),l=this.filterSequences(a),c=this.filterImages(o);for(let d of l){let m=d.id,g=`${this.layerID}-sequence-${m}`,_=d.v||0,v=this.features.get(g);v||(v=new Ia(this,g),v.style=GZ,v.parentContainer=n,v.container.zIndex=-100),v.v!==_&&(v.v=_,v.geometry.setCoords(d.coordinates),v.setData(m,d),v.clearChildData(m),d.bubbleIDs.forEach(E=>v.addChildData(m,E))),this.syncFeatureClasses(v),v.update(i,r),this.retainFeature(v,e)}for(let d of c){let m=d.id,g=`${this.layerID}-photo-${m}`,_=this.features.get(g);if(!_){let v=Object.assign({},$Z);Number.isFinite(d.ca)&&(v.viewfieldAngles=[d.ca]),d.isPano&&(v.viewfieldName="pano"),_=new Wr(this,g),_.geometry.setCoords(d.loc),_.style=v,_.parentContainer=n,_.setData(m,d)}this.syncFeatureClasses(_),_.update(i,r),this.retainFeature(_,e)}}render(e,i,r){let s=this.context.services.streetside;!this.enabled||!(s!=null&&s.started)||r<zZ||(s.loadTiles(),this.renderMarkers(e,i,r))}};function So(t,e){return Array.from(t.getElementsByTagName(e))}function l_(t){return t[0]==="#"?t:`#${t}`}function HZ(t,e,i){return Array.from(t.getElementsByTagNameNS(i,e))}function lo(t){return t==null||t.normalize(),t&&t.textContent||""}function na(t,e,i){let r=t.getElementsByTagName(e),s=r.length?r[0]:null;return s&&i&&i(s),s}function Rl(t,e,i){let r={};if(!t)return r;let s=t.getElementsByTagName(e),n=s.length?s[0]:null;return n&&i?i(n,r):r}function r0(t,e,i){let r=lo(na(t,e));return r&&i?i(r)||{}:{}}function CN(t,e,i){let r=parseFloat(lo(na(t,e)));if(!isNaN(r))return r&&i?i(r)||{}:{}}function i0(t,e,i){let r=parseFloat(lo(na(t,e)));if(!isNaN(r))return i&&i(r),r}function d6(t,e){let i={};for(let r of e)r0(t,r,s=>{i[r]=s});return i}function pS(t){return(t==null?void 0:t.nodeType)===1}function IN(t){return Rl(t,"line",e=>Object.assign({},r0(e,"color",r=>({stroke:`#${r}`})),CN(e,"opacity",r=>({"stroke-opacity":r})),CN(e,"width",r=>({"stroke-width":r*96/25.4}))))}function kN(t){let e=[];if(t===null)return e;for(let i of Array.from(t.childNodes)){if(!pS(i))continue;let r=VZ(i.nodeName);if(r==="gpxtpx:TrackPointExtension")e=e.concat(kN(i));else{let s=lo(i);e.push([r,jZ(s)])}}return e}function VZ(t){return["heart","gpxtpx:hr","hr"].includes(t)?"heart":t}function jZ(t){let e=parseFloat(t);return isNaN(e)?t:e}function MN(t){let e=[parseFloat(t.getAttribute("lon")||""),parseFloat(t.getAttribute("lat")||"")];if(isNaN(e[0])||isNaN(e[1]))return null;i0(t,"ele",r=>{e.push(r)});let i=na(t,"time");return{coordinates:e,time:i?lo(i):null,extendedValues:kN(na(t,"extensions"))}}function mS(t){var s;let e=d6(t,["name","cmt","desc","type","time","keywords"]),i=Array.from(t.getElementsByTagNameNS("http://www.garmin.com/xmlschemas/GpxExtensions/v3","*"));for(let n of i)((s=n.parentNode)==null?void 0:s.parentNode)===t&&(e[n.tagName.replace(":","_")]=lo(n));let r=So(t,"link");return r.length&&(e.links=r.map(n=>Object.assign({href:n.getAttribute("href")},d6(n,["text","type"])))),e}function PN(t,e){let i=So(t,e),r=[],s=[],n={};for(let o=0;o<i.length;o++){let a=MN(i[o]);if(a){r.push(a.coordinates),a.time&&s.push(a.time);for(let[l,c]of a.extendedValues){let d=l==="heart"?l:l.replace("gpxtpx:","")+"s";n[d]||(n[d]=Array(i.length).fill(null)),n[d][o]=c}}}if(!(r.length<2))return{line:r,times:s,extendedValues:n}}function XZ(t){let e=PN(t,"rtept");if(e)return{type:"Feature",properties:Object.assign({_gpxType:"rte"},mS(t),IN(na(t,"extensions"))),geometry:{type:"LineString",coordinates:e.line}}}function WZ(t){let e=So(t,"trkseg"),i=[],r=[],s=[];for(let a of e){let l=PN(a,"trkpt");l&&(s.push(l),l.times&&l.times.length&&r.push(l.times))}if(s.length===0)return null;let n=s.length>1,o=Object.assign({_gpxType:"trk"},mS(t),IN(na(t,"extensions")),r.length?{coordinateProperties:{times:n?r:r[0]}}:{});for(let a of s){i.push(a.line),o.coordinateProperties||(o.coordinateProperties={});let l=o.coordinateProperties,c=Object.entries(a.extendedValues);for(let d=0;d<c.length;d++){let[m,g]=c[d];n?(l[m]||(l[m]=s.map(_=>new Array(_.line.length).fill(null))),l[m][d]=g):l[m]=g}}return{type:"Feature",properties:o,geometry:n?{type:"MultiLineString",coordinates:i}:{type:"LineString",coordinates:i[0]}}}function qZ(t){let e=Object.assign(mS(t),d6(t,["sym"])),i=MN(t);return i?{type:"Feature",properties:e,geometry:{type:"Point",coordinates:i.coordinates}}:null}function*YZ(t){for(let e of So(t,"trk")){let i=WZ(e);i&&(yield i)}for(let e of So(t,"rte")){let i=XZ(e);i&&(yield i)}for(let e of So(t,"wpt")){let i=qZ(e);i&&(yield i)}}function u_(t){return{type:"FeatureCollection",features:Array.from(YZ(t))}}function RN(t,e){let i={},r=e=="stroke"||e==="fill"?e:e+"-color";return t[0]==="#"&&(t=t.substring(1)),t.length===6||t.length===3?i[r]="#"+t:t.length===8&&(i[e+"-opacity"]=parseInt(t.substring(0,2),16)/255,i[r]="#"+t.substring(6,8)+t.substring(4,6)+t.substring(2,4)),i}function c_(t,e,i){let r={};return i0(t,e,s=>{r[i]=s}),r}function gS(t,e){return Rl(t,"color",i=>RN(lo(i),e))}function DN(t){return Rl(t,"Icon",(e,i)=>(r0(e,"href",r=>{i.icon=r}),i))}function ZZ(t){return Rl(t,"IconStyle",e=>Object.assign(gS(e,"icon"),c_(e,"scale","icon-scale"),c_(e,"heading","icon-heading"),Rl(e,"hotSpot",i=>{let r=parseFloat(i.getAttribute("x")||""),s=parseFloat(i.getAttribute("y")||""),n=i.getAttribute("xunits")||"",o=i.getAttribute("yunits")||"";return!isNaN(r)&&!isNaN(s)?{"icon-offset":[r,s],"icon-offset-units":[n,o]}:{}}),DN(e)))}function QZ(t){return Rl(t,"LabelStyle",e=>Object.assign(gS(e,"label"),c_(e,"scale","label-scale")))}function KZ(t){return Rl(t,"LineStyle",e=>Object.assign(gS(e,"stroke"),c_(e,"width","stroke-width")))}function JZ(t){return Rl(t,"PolyStyle",(e,i)=>Object.assign(i,Rl(e,"color",r=>RN(lo(r),"fill")),r0(e,"fill",r=>{if(r==="0")return{"fill-opacity":0}}),r0(e,"outline",r=>{if(r==="0")return{"stroke-opacity":0}})))}function yS(t){return Object.assign({},JZ(t),KZ(t),QZ(t),ZZ(t))}var B4=t=>Number(t),dS={string:t=>t,int:B4,uint:B4,short:B4,ushort:B4,float:B4,double:B4,bool:t=>!!t};function FN(t,e){return Rl(t,"ExtendedData",(i,r)=>{for(let s of So(i,"Data"))r[s.getAttribute("name")||""]=lo(na(s,"value"));for(let s of So(i,"SimpleData")){let n=s.getAttribute("name")||"",o=e[n]||dS.string;r[n]=o(lo(s))}return r})}function LN(t){let e=na(t,"description");for(let i of Array.from((e==null?void 0:e.childNodes)||[]))if(i.nodeType===4)return{description:{"@type":"html",value:lo(i)}};return{}}function NN(t){return Rl(t,"TimeSpan",e=>({timespan:{begin:lo(na(e,"begin")),end:lo(na(e,"end"))}}))}function ON(t){return Rl(t,"TimeStamp",e=>({timestamp:lo(na(e,"when"))}))}function BN(t,e){return r0(t,"styleUrl",i=>(i=l_(i),e[i]?Object.assign({styleUrl:i},e[i]):{styleUrl:i}))}var eQ=/\s*/g,tQ=/^\s*|\s*$/g,iQ=/\s+/;function UN(t){return t.replace(eQ,"").split(",").map(parseFloat).filter(e=>!isNaN(e)).slice(0,3)}function fS(t){return t.replace(tQ,"").split(iQ).map(UN).filter(e=>e.length>=2)}function rQ(t){let e=So(t,"coord");e.length===0&&(e=HZ(t,"coord","*"));let i=e.map(r=>lo(r).split(" ").map(parseFloat));return i.length===0?null:{geometry:i.length>2?{type:"LineString",coordinates:i}:{type:"Point",coordinates:i[0]},times:So(t,"when").map(r=>lo(r))}}function zN(t){if(t.length===0)return t;let e=t[0],i=t[t.length-1],r=!0;for(let s=0;s<Math.max(e.length,i.length);s++)if(e[s]!==i[s]){r=!1;break}return r?t:t.concat([t[0]])}function a_(t){return lo(na(t,"coordinates"))}function GN(t){let e=[],i=[];for(let r=0;r<t.childNodes.length;r++){let s=t.childNodes.item(r);if(pS(s))switch(s.tagName){case"MultiGeometry":case"MultiTrack":case"gx:MultiTrack":{let n=GN(s);e=e.concat(n.geometries),i=i.concat(n.coordTimes);break}case"Point":{let n=UN(a_(s));n.length>=2&&e.push({type:"Point",coordinates:n});break}case"LinearRing":case"LineString":{let n=fS(a_(s));n.length>=2&&e.push({type:"LineString",coordinates:n});break}case"Polygon":{let n=[];for(let o of So(s,"LinearRing")){let a=zN(fS(a_(o)));a.length>=4&&n.push(a)}n.length&&e.push({type:"Polygon",coordinates:n});break}case"Track":case"gx:Track":{let n=rQ(s);if(!n)break;let{times:o,geometry:a}=n;e.push(a),o.length&&i.push(o);break}}}return{geometries:e,coordTimes:i}}function sQ(t){return t.length===0?null:t.length===1?t[0]:{type:"GeometryCollection",geometries:t}}function nQ(t,e,i,r){var c;let{coordTimes:s,geometries:n}=GN(t),o=sQ(n);if(!o&&r.skipNullGeometry)return null;let a={type:"Feature",geometry:o,properties:Object.assign(d6(t,["name","address","visibility","open","phoneNumber","description"]),LN(t),BN(t,e),yS(t),FN(t,i),NN(t),ON(t),s.length?{coordinateProperties:{times:s.length===1?s[0]:s}}:{})};((c=a.properties)==null?void 0:c.visibility)!==void 0&&(a.properties.visibility=a.properties.visibility!=="0");let l=t.getAttribute("id");return l!==null&&l!==""&&(a.id=l),a}function oQ(t){return na(t,"gx:LatLonQuad")?{geometry:{type:"Polygon",coordinates:[zN(fS(a_(t)))]}}:cQ(t)}var aQ=Math.PI/180;function lQ(t,e,i){let r=[(t[0]+t[2])/2,(t[1]+t[3])/2];return[e[0].map(s=>{let n=s[1]-r[1],o=s[0]-r[0],a=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),l=Math.atan2(n,o)+i*aQ;return[r[0]+Math.cos(l)*a,r[1]+Math.sin(l)*a]})]}function cQ(t){let e=na(t,"LatLonBox");if(e){let i=i0(e,"north"),r=i0(e,"west"),s=i0(e,"east"),n=i0(e,"south"),o=i0(e,"rotation");if(typeof i=="number"&&typeof n=="number"&&typeof r=="number"&&typeof s=="number"){let a=[r,n,s,i],l=[[[r,i],[s,i],[s,n],[r,n],[r,i]]];return typeof o=="number"&&(l=lQ(a,l,o)),{bbox:a,geometry:{type:"Polygon",coordinates:l}}}}return null}function uQ(t,e,i,r){var l;let s=oQ(t),n=(s==null?void 0:s.geometry)||null;if(!n&&r.skipNullGeometry)return null;let o={type:"Feature",geometry:n,properties:Object.assign({"@geometry-type":"groundoverlay"},d6(t,["name","address","visibility","open","phoneNumber","description"]),LN(t),BN(t,e),yS(t),DN(t),FN(t,i),NN(t),ON(t))};s!=null&&s.bbox&&(o.bbox=s.bbox),((l=o.properties)==null?void 0:l.visibility)!==void 0&&(o.properties.visibility=o.properties.visibility!=="0");let a=t.getAttribute("id");return a!==null&&a!==""&&(o.id=a),o}function hQ(t){let e=t.getAttribute("id"),i=t.parentNode;return!e&&pS(i)&&i.localName==="CascadingStyle"&&(e=i.getAttribute("kml:id")||i.getAttribute("id")),l_(e||"")}function dQ(t){let e={};for(let i of So(t,"Style"))e[hQ(i)]=yS(i);for(let i of So(t,"StyleMap")){let r=l_(i.getAttribute("id")||"");r0(i,"styleUrl",s=>{s=l_(s),e[s]&&(e[r]=e[s])})}return e}function fQ(t){let e={};for(let i of So(t,"SimpleField"))e[i.getAttribute("name")||""]=dS[i.getAttribute("type")||""]||dS.string;return e}function*pQ(t,e={skipNullGeometry:!1}){let i=dQ(t),r=fQ(t);for(let s of So(t,"Placemark")){let n=nQ(s,i,r,e);n&&(yield n)}for(let s of So(t,"GroundOverlay")){let n=uQ(s,i,r,e);n&&(yield n)}}function $N(t,e={skipNullGeometry:!1}){return{type:"FeatureCollection",features:Array.from(pQ(t,e))}}var HN=Yi(u6(),1);var s0=65535,h_=class extends Rr{constructor(e,i){super(e,i),this._dataUsed=null,this._fileList=null,this._template=null,this._url=null,this._geojson=null,this._geojsonExtent=null,this._fileReader=new FileReader,this._hashchange=this._hashchange.bind(this),this._updateHash=this._updateHash.bind(this),this._setFile=this._setFile.bind(this),this.setFileList=this.setFileList.bind(this);function r(s){s.stopPropagation(),s.preventDefault(),s.dataTransfer.dropEffect="copy"}this.context.container().attr("dropzone","copy").on("dragenter.draganddrop",r).on("dragexit.draganddrop",r).on("dragover.draganddrop",r).on("drop.draganddrop",s=>{s.stopPropagation(),s.preventDefault(),this.setFileList(s.dataTransfer.files)}),this.context.systems.urlhash.on("hashchange",this._hashchange),e.on("layerchange",this._updateHash)}render(e,i,r){if(!this.enabled||!this.hasData())return;let s=this.context.services.vectortile,n=[];this._template&&s?(r>=13&&s.loadTiles(this._template),n=s.getData(this._template).map(m=>m.geojson)):n=this._getFeatures(this._geojson);let o=n.filter(m=>m.geometry.type==="Polygon"||m.geometry.type==="MultiPolygon"),a=n.filter(m=>m.geometry.type==="LineString"||m.geometry.type==="MultiLineString"),l=n.filter(m=>m.geometry.type==="Point"||m.geometry.type==="MultiPoint");this.renderPolygons(e,i,r,o);let c=this.createGridLines(a),d={stroke:{width:.5,color:65535,alpha:.5,cap:Ui.ROUND}};this.renderLines(e,i,r,a),this.renderLines(e,i,r,c,d),this.renderPoints(e,i,r,l)}createGridLines(e){let i=this.context.systems.imagery.numGridSplits,r=[];if(this.context.systems.rapid.isTaskRectangular&&i>0){let s=e[0],n=s.geometry.coordinates.map(_=>_[0]),o=s.geometry.coordinates.map(_=>_[1]),a=Math.min(...n),l=Math.min(...o),c=Math.max(...n),d=Math.max(...o),m=(c-a)/i,g=(d-l)/i;for(let _=1;_<i;_++){let v=a+m*_,E=l+g*_;r.push({type:"Feature",geometry:{type:"LineString",coordinates:[[a,E],[c,E]]},id:i+"gridcol"+_}),r.push({type:"Feature",geometry:{type:"LineString",coordinates:[[v,l],[v,d]]},id:i+"gridrow"+_})}}return r}renderPolygons(e,i,r,s){let n=this.context.systems.l10n,o=this.scene.groups.get("basemap"),a={fill:{color:s0,alpha:.3},stroke:{width:2,color:s0,alpha:1,cap:Ui.ROUND},labelTint:s0};for(let l of s){let c=l.__featurehash__,d=l.v||0,m=l.geometry.type==="Polygon"?[l.geometry.coordinates]:l.geometry.type==="MultiPolygon"?l.geometry.coordinates:[];for(let g=0;g<m.length;++g){let _=m[g],v=`${this.layerID}-${c}-${g}`,E=this.features.get(v);E&&E.type!=="polygon"&&(E.destroy(),E=null),E||(E=new eu(this,v),E.style=a,E.parentContainer=o),E.v!==d&&(E.v=d,E.geometry.setCoords(_),E.label=n.displayName(l.properties),E.setData(c,l)),this.syncFeatureClasses(E),E.update(i,r),this.retainFeature(E,e)}}}renderLines(e,i,r,s,n){let o=this.context.systems.l10n,a=this.scene.groups.get("basemap"),l=n||{stroke:{width:2,color:s0,alpha:1,cap:Ui.ROUND},labelTint:s0};for(let c of s){let d=c.__featurehash__,m=c.v||0,g=c.geometry.type==="LineString"?[c.geometry.coordinates]:c.geometry.type==="MultiLineString"?c.geometry.coordinates:[];for(let _=0;_<g.length;++_){let v=g[_],E=`${this.layerID}-${d}-${_}`,b=this.features.get(E);b&&b.type!=="line"&&(b.destroy(),b=null),b||(b=new Ia(this,E),b.style=l,b.parentContainer=a),b.v!==m&&(b.v=m,b.geometry.setCoords(v),b.label=o.displayName(c.properties),b.setData(d,c)),this.syncFeatureClasses(b),b.update(i,r),this.retainFeature(b,e)}}}renderPoints(e,i,r,s){let n=this.context.systems.l10n,o=this.scene.groups.get("points"),a={markerName:"largeCircle",markerTint:s0,iconName:"maki-circle-stroked",labelTint:s0};for(let l of s){let c=l.__featurehash__,d=l.v||0,m=l.geometry.type==="Point"?[l.geometry.coordinates]:l.geometry.type==="MultiPoint"?l.geometry.coordinates:[];for(let g=0;g<m.length;++g){let _=m[g],v=`${this.layerID}-${c}-${g}`,E=this.features.get(v);E&&E.type!=="point"&&(E.destroy(),E=null),E||(E=new Wr(this,v),E.style=a,E.parentContainer=o),E.v!==d&&(E.v=d,E.geometry.setCoords(_),E.label=n.displayName(l.properties),E.setData(c,l)),this.syncFeatureClasses(E),E.update(i,r),this.retainFeature(E,e)}}}hasData(){return!!(this._template||this._geojson)}getSrc(){return this._dataUsed}fitZoom(){let e=this._geojsonExtent;e&&this.context.systems.map.trimmedExtent(e)}getFileList(){return this._fileList}setFileList(e){if(this._fileList=e,this._dataUsed=null,this._geojson=null,this._geojsonExtent=null,this._template=null,this._url=null,this.scene.disableLayers(this.layerID),!e||!e.length)return;let i=e[0],r=this._getExtension(i.name);this._fileReader.onload=s=>{this._fileReader.onload=null,this._setFile(s.target.result,r)},this._fileReader.readAsText(i)}setUrl(e){if(this._url=e,this._dataUsed=null,this._fileList=null,this._geojson=null,this._geojsonExtent=null,this._template=null,this.scene.disableLayers(this.layerID),!e)return;let i=e.toLowerCase().split(/[?#]/)[0],r=i.includes("project")&&i.includes("task")&&i.includes("gpx"),s=r?".gpx":this._getExtension(i);s?fetch(e).then(Ai).then(n=>{this._setFile(n,s),r&&(this._dataUsed=null,this.context.systems.rapid.setTaskExtentByGpxData(n))}).catch(n=>console.error(n)):this._setUrlTemplate(e)}_setUrlTemplate(e){var r;let i=this.context.services.osm;if(i){let s=(r=i.imageryBlocklists)!=null?r:[],n=!1,o=0,a;for(a of s)if(n=a.test(e),o++,n)return;if(!o&&(a=/.*\.google(apis)?\..*\/(vt|kh)[\?\/].*([xyz]=.*){3}.*/,n=a.test(e),n))return}this._template=e,this._dataUsed="vectortile:"+e.split(/[?#]/)[0],this.scene.enableLayers(this.layerID)}_setFile(e,i){if(!e)return;let r;switch(i){case".gpx":r=u_(e instanceof Document?e:s(e));break;case".kml":r=$N(e instanceof Document?e:s(e));break;case".geojson":case".json":r=e instanceof Object?e:JSON.parse(e);break}r=r||{},Object.keys(r).length&&(this._dataUsed=`${i} data file`,this._geojson=this._ensureIDs(r),(0,HN.default)(this._geojson),this._geojsonExtent=this._calcExtent(r),this.fitZoom(),this.scene.enableLayers(this.layerID));function s(n){return new DOMParser().parseFromString(n,"text/xml")}}_ensureIDs(e){if(!e)return null;for(let i of this._getFeatures(e))this._ensureFeatureID(i);return e}_ensureFeatureID(e){if(!e)return;let r=this.context.services.vectortile.getNextID();return e.id=r,e.__featurehash__=r,e}_getFeatures(e){return e?e.type==="FeatureCollection"?e.features:[e]:[]}_calcExtent(e){let i=new mt;if(!e)return i;for(let s of this._getFeatures(e)){let n=s.geometry;if(!n)continue;let o=n.type,a=n.coordinates,l=/^Multi/.test(o)?a:[a];if(/Polygon$/.test(o))for(let c of l){let d=c[0];for(let m of d)r(m)}else if(/LineString$/.test(o))for(let c of l)for(let d of c)r(d);else if(/Point$/.test(o))for(let c of l)r(c)}return i;function r(s){i.min=[Math.min(i.min[0],s[0]),Math.min(i.min[1],s[1])],i.max=[Math.max(i.max[0],s[0]),Math.max(i.max[1],s[1])]}}_getExtension(e){if(!e)return;let i=/\.(gpx|kml|(geo)?json)$/i,r=e.match(i);return r&&r.length&&r[0]}_hashchange(e,i){let r=e.get("data")||e.get("gpx"),s=i.get("data")||i.get("gpx");r!==s&&this.setUrl(r)}_updateHash(){let e=this.context.systems.urlhash;e.setParam("gpx",null),e.setParam("data",null),!(!this.enabled||typeof this._url!="string")&&(/gpx/i.test(this._url)?e.setParam("gpx",this._url):e.setParam("data",this._url))}};function U4(t){return t instanceof Set?t:new Set(t!==void 0&&[].concat(t))}var d_=class extends sn.default{constructor(e){super(),this.renderer=e,this.context=e.context,this.groups=new Map,this.layers=new Map,this.features=new Map,["background","basemap","points","streetview","qa","labels","blocks","ui"].forEach((i,r)=>{let s=new Qi;s.name=i,s.sortableChildren=!0,s.zIndex=r,this.renderer.stage.addChild(s),this.groups.set(i,s)}),[new N4(this,"background"),new t_(this,"osm"),new s_(this,"rapid"),new Qy(this,"mapillary-map-features"),new Jy(this,"mapillary-signs"),new h_(this,"custom-data"),new i_(this,"notes"),new Xy(this,"improveOSM"),new qy(this,"keepRight"),new r_(this,"osmose"),new Ky(this,"mapillary"),new Wy(this,"kartaview"),new o_(this,"streetside"),new Zy(this,"labels"),new jy(this,"edit-blocks"),new n_(this,"map-ui")].forEach(i=>this.layers.set(i.id,i))}render(e,i,r){for(let s of this.layers.values())s.render(e,i,r),s.cull(e)}enableLayers(e){for(let i of U4(e)){let r=this.layers.get(i);r&&(r.enabled=!0)}this.emit("layerchange")}disableLayers(e){for(let i of U4(e)){let r=this.layers.get(i);r&&(r.enabled=!1)}this.emit("layerchange")}toggleLayers(e){for(let i of U4(e)){let r=this.layers.get(i);r&&(r.enabled=!r.enabled)}this.emit("layerchange")}onlyLayers(e){let i=U4(e);for(let r of this.layers.values())r.enabled=i.has(r.id);this.emit("layerchange")}addFeature(e){this.features.set(e.id,e)}removeFeature(e){this.features.delete(e.id)}classData(e,i,r){var s;(s=this.layers.get(e))==null||s.classData(i,r)}unclassData(e,i,r){var s;(s=this.layers.get(e))==null||s.unclassData(e,i,r)}clearClass(e){for(let i of this.layers.values())i.clearClass(e)}dirtyScene(){for(let e of this.features.values())e.dirty=!0}dirtyLayers(e){var i;for(let r of U4(e))(i=this.layers.get(r))==null||i.dirtyLayer()}dirtyFeatures(e){for(let i of U4(e)){let r=this.features.get(i);r&&(r.dirty=!0)}}dirtyData(e,i){var r;(r=this.layers.get(e))==null||r.dirtyData(i)}};var ms=class{static makeArea(t,e,i){return t|e<<15|i<<30}static getOpenOffset(t){return t&32768-1}static getCloseOffset(t){return t>>15&32768-1}static getOrientation(t){return t>>30&1}static setOpenOffset(t,e){return ms.makeArea(e,ms.getCloseOffset(t),ms.getOrientation(t))}static setCloseOffset(t,e){return ms.makeArea(ms.getOpenOffset(e),e,ms.getOrientation(t))}},mQ=class extends Zo{constructor(t,e){super(t,e),this.managedItems=[]}upload(t,e,i){let r=t.gl,s=e.realWidth,n=e.realHeight;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===tn.UNPACK),(i.width!==s||i.height!==n)&&(i.width=s,i.height=n,r.texImage2D(e.target,0,e.format,s,n,0,e.format,e.type,void 0));let o=this.managedItems;for(let a=0,l=o.length;a<l;a++)this.uploadItem(t,e.target,e.format,e.type,o[a]);return!0}uploadItem(t,e,i,r,s){let n=t.gl,o=n instanceof WebGL2RenderingContext,a=s.frame,l=s.source;if(!o){if(l instanceof ImageData)l=l.data;else if(l instanceof HTMLCanvasElement){let c=l.getContext("2d"),[d,m]=[l.width,l.height];l=c.getImageData(0,0,d,m).data}else if(l instanceof HTMLImageElement){let[c,d]=[l.naturalWidth,l.naturalHeight],m=document.createElement("canvas");m.width=c,m.height=d;let g=m.getContext("2d");g.drawImage(l,0,0),l=g.getImageData(0,0,c,d).data}}n.texSubImage2D(e,0,a.x,a.y,a.width,a.height,i,r,l),s.updateId=s.dirtyId}};var VN=new ri,jN=class{constructor(t,e){this._width=t,this._height=e,this._root=[null,ms.makeArea(0,this._height,0),!1]}allocate(t,e,i){let r=this.findArea(t,e);if(!r)return null;i||(i=new ri),this.getFrame(r,i);let s=new ri(i.x,i.y,t,e),n=this.split(r,i,s);return i.copyFrom(s),i.__mem_area=n,i}free(t){let e=t.__mem_area;e[2]=!1,this.merge(e)}get width(){return this._width}get height(){return this._height}getAreaField(t){return t[1]}getFrame(t,e){e||(e=new ri);let i=this.getAreaField(t),r=this.getParent(t),s=ms.getOrientation(i),n=ms.getOpenOffset(i),o=ms.getCloseOffset(i),a=r?ms.getOpenOffset(r[1]):0,l=r?ms.getCloseOffset(r[1]):this._width;return s?(e.x=n,e.y=a,e.width=o-e.x,e.height=l-a):(e.x=a,e.y=n,e.width=l-e.x,e.height=o-e.y),e}getParent(t){return t[0]}hasChildren(t){return Array.isArray(t[2])&&t[2].length!==0}getChildren(t){if(!Array.isArray(t[2]))throw new Error("Children don't exist");return t[2]}addChild(t,...e){t[2]=Array.isArray(t[2])?t[2]:[],t[2].push(...e)}findArea(t,e){return this.findAreaRecursive(this._root,t,e)}findAreaRecursive(t,e,i){let r=this.getFrame(t,VN);if(r.width<e||r.height<i)return null;if(!this.hasChildren(t)){let a=r.width-e,l=r.height-i;return a<0||l<0||t[2]?null:t}let s=this.getChildren(t),n=null,o=1/0;for(let a=0,l=s.length;a<l;a++){let c=this.findAreaRecursive(s[a],e,i);if(!c)continue;let d=this.getFrame(c,VN),m=d.width-e,g=d.height-i;if(m<0||g<0)continue;if(!m&&!g)return c;let _=Math.min(m,g);o>_&&(n=c,o=_)}return n}splitOrientation(t,e){if(e.width===t.width&&e.height===t.height)return 2;if(e.width===t.width)return 1;if(e.height===t.height)return 0;let i=Math.abs((t.width-e.width)*t.height-e.width*(t.height-e.height)),r=Math.abs(t.width*(t.height-e.height)-(t.width-e.width)*e.height);return i>r?0:1}split(t,e,i,r=this.getParent(t)?this.splitOrientation(e,i):0){if(t[2]===!0)throw new Error("Cannot deallocate");return r===2?(t[2]=!0,t):this[r===0?"splitPrimaryHorizontal":"splitPrimaryVertical"](t,e,i)}splitPrimaryHorizontal(t,e,i){let r=this.getAreaField(t),s=ms.getOrientation(r),n=this.getParent(t);if(this.hasChildren(t))throw new Error("Can't split non-leaf node");let o=[t,ms.makeArea(e.left,e.x+i.width,1),[]],a=[t,ms.makeArea(e.x+i.width,e.right,1),!1];if(s===0)this.addChild(t,o,a);else{let l=this.getChildren(n).indexOf(t);o[0]=n,a[0]=n,this.getChildren(n).splice(l,1,o,a)}if(i.height!==e.height){let l=[o,ms.makeArea(e.top,e.y+i.height,0),!0],c=[o,ms.makeArea(e.y+i.height,e.bottom,0),!1];return this.addChild(o,l,c),l}else o[2]=!0;return o}splitPrimaryVertical(t,e,i){let r=this.getAreaField(t),s=ms.getOrientation(r),n=this.getParent(t);if(this.hasChildren(t))throw new Error("Can't split non-leaf node");let o=[t,ms.makeArea(e.top,e.y+i.height,0),[]],a=[t,ms.makeArea(e.y+i.height,e.bottom,0),!1];if(s===1)this.addChild(t,o,a);else{let l=this.getChildren(n).indexOf(t);o[0]=n,a[0]=n,this.getChildren(n).splice(l,1,o,a)}if(i.width!==e.height){let l=[o,ms.makeArea(e.left,e.x+i.width,1),!0],c=[o,ms.makeArea(e.x+i.width,e.right,1),!1];return this.addChild(o,l,c),l}else o[2]=!0;return o}merge(t){if(this.hasChildren(t))throw new Error("Cannot merge a non-leaf node");let e=this.getParent(t);if(!e)return;let i=this.getChildren(e),r=i.indexOf(t),s=i[r-1],n=i[r+1];n&&n[2]===!1&&(t[1]=ms.setCloseOffset(t[1],ms.getCloseOffset(n[1])),i.splice(r+1,1)),s&&s[2]===!1&&(t[1]=ms.setOpenOffset(t[1],ms.getOpenOffset(s[1])),i.splice(r-1,1)),i.length===1&&(e[2]=!1,this.merge(e))}printState(t){this.hasChildren(t)?this.getChildren(t).forEach(e=>this.printState(e)):console.log(di({},this.getFrame(t)),t[2])}},_S=new ri,gQ=class{constructor(t=2048,e=2048){this.slabWidth=t,this.slabHeight=e,this.textureSlabs=[]}get maxWidth(){return this.slabWidth-2*this.calculatePadding(this.slabWidth,this.slabHeight)}get maxHeight(){return this.slabHeight-2*this.calculatePadding(this.slabWidth,this.slabHeight)}allocate(t,e,i=this.calculatePadding(t,e)){if(t+2*i>this.slabWidth||e+2*i>this.slabHeight)return null;let r=this.textureSlabs;for(let n=0,o=r.length;n<o;n++){let a=r[n],l=this.issueTexture(a,t,e,i);if(l)return l}let s=this.createSlab();return this.textureSlabs.unshift(s),this.issueTexture(s,t,e,i)}free(t){let e=t.baseTexture,i=this.textureSlabs.find(s=>s.slab===e);if(!i)throw new Error("The texture cannot be freed because its base-texture is not pooled by this allocator. This is either a bug in TextureAllocator or you tried to free a texture that was never allocated by one.");let r=i.managedTextures.find(s=>s.texture===t);if(!r)throw new Error("The texture cannot be freed because it was not found in the managed list of issued textures on its slab. This may be because you duplicated this texture or a bug in TextureAllocator");i.managedArea.free(r.area),i.managedTextures.splice(i.managedTextures.indexOf(r),1)}calculatePadding(t,e){let i=Math.max(t,e);return i<64?2:i<128?4:i<1024?8:16}createSlab(){return{managedArea:new jN(this.slabWidth,this.slabHeight),managedTextures:[],slab:new ui(null,{width:this.slabWidth,height:this.slabHeight})}}createTexture(t,e){return new Yt(t,e)}issueTexture(t,e,i,r=0){let s=t.managedArea.allocate(e+2*r,i+2*r);if(!s)return null;_S.copyFrom(s),_S.pad(-r);let n=t.slab,o=this.createTexture(n,_S.clone());return t.managedTextures.push({area:s,texture:o}),o}},f_=class extends gQ{createSlab(){return{managedArea:new jN(this.slabWidth,this.slabHeight),managedTextures:[],slab:new ui(new mQ(this.slabWidth,this.slabHeight),{width:this.slabWidth,height:this.slabHeight})}}allocate(t,e,i,r){let s;typeof i=="number"?s=i:(s=this.calculatePadding(t,e),r=i);let n=super.allocate(t,e,s);if(r){let o=n.baseTexture.resource,a={frame:n.frame,source:r,dirtyId:r instanceof HTMLImageElement&&!r.complete?-1:0,updateId:-1,texture:n};o.managedItems.push(a),r instanceof HTMLImageElement&&!r.complete&&r.addEventListener("load",()=>{n.baseTexture.valid&&!n.baseTexture.destroyed&&o.managedItems.indexOf(a)>=0&&(a.dirtyId++,n.baseTexture.update())}),n.baseTexture.update()}return n}free(t){super.free(t);let e=t.baseTexture.resource,i=e.managedItems.find(r=>r.texture===t);i&&e.managedItems.splice(e.managedItems.indexOf(i),1)}};var p_=class{constructor(e){this.context=e,this.loaded=!1,this._atlas={symbol:new f_,text:new f_,tile:new f_},this._textureData=new Map,this._svgIcons=new Map;let i=["bushes","cemetery","cemetery_buddhist","cemetery_christian","cemetery_jewish","cemetery_muslim","construction","dots","farmland","farmyard","forest","forest_broadleaved","forest_leafless","forest_needleleaved","grass","landfill","lines","orchard","pond","quarry","vineyard","waves","wetland","wetland_bog","wetland_marsh","wetland_reedbed","wetland_swamp"],r={};for(let s of i)r[s]=e.asset(`img/pattern/${s}.png`);oh.addBundle("patterns",r),oh.loadBundle(["patterns"]).then(s=>{for(let[n,o]of Object.entries(s.patterns))this._textureData.set(n,{texture:o,refcount:1});this.loaded=!0}).catch(s=>console.error(s)),this._cacheGraphics()}get(e){return this.getTexture("symbol",e)}getTexture(e,i){let r=`${e}-${i}`,s=this._textureData.get(r);return s?s.texture:this._svgIcons.has(i)?(this.svgIconToTexture(i),Yt.EMPTY):null}getPatternTexture(e){let i=this._textureData.get(e);return i==null?void 0:i.texture}getDebugTexture(e){var n;let i=this._atlas[e];if(!i)return null;let r=new ri(0,0,i.slabWidth,i.slabHeight),s=(n=i.textureSlabs[0])==null?void 0:n.slab;return s?new Yt(s,r):null}allocate(e,i,r,s,n){let o=this._atlas[e];if(!o)return null;let a=`${e}-${i}`,l=this._textureData.get(a);if(l)return l.refcount++,l.texture;let c=e==="symbol"?1:0,d=o.allocate(r,s,c,n);if(!d)throw new Error(`Couldn't allocate texture ${a}`);if(e==="tile"){let m=d.frame.clone().pad(-.5);d.frame=m}return this._textureData.set(a,{texture:d,refcount:1}),d}free(e,i){let r=this._atlas[e];if(!r)return;let s=`${e}-${i}`,n=this._textureData.get(s);n&&(n.refcount--,n.refcount===0&&(r.free(n.texture),n.texture.destroy(!1),n.texture=null,this._textureData.delete(s)))}graphicToTexture(e,i,r){let s=this.context.pixi.renderer,n=s.generateTexture(i,r),o=n.baseTexture;if(o.format!==zt.RGBA||o.type!==yi.UNSIGNED_BYTE)return;let a=o.framebuffer;if(!a)return n;let l=a.width,c=a.height,d=new Uint8Array(l*c*4),m=s.context.gl,g=a.glFramebuffers[1],_=g==null?void 0:g.framebuffer;if(!m||!_)return n;m.bindFramebuffer(m.FRAMEBUFFER,_),m.readPixels(0,0,l,c,o.format,o.type,d);let v=this.allocate("symbol",e,l,c,d);v.orig=n.orig.clone(),n.destroy(!0)}addSvgIcon(e,i){this._svgIcons.set(e,i)}svgIconToTexture(e){let i=this._svgIcons.get(e);if(!i)return;this._svgIcons.set(e,null);let r=32,s={autoLoad:!1,height:r,width:r},n=new nc(i,s);n.load().then(()=>{this.allocate("symbol",e,r,r,n.source),this._svgIcons.delete(e)})}_cacheGraphics(){let e={resolution:2},r={region:new ri(-13,0,26,52),resolution:3},s=new Hi().lineStyle(1,4473924).beginFill(16777215,.75).moveTo(-2,26).lineTo(2,26).lineTo(12,4).bezierCurveTo(12,0,-12,0,-12,4).closePath().endFill(),n=new Hi().lineStyle(1,13421772).beginFill(3355443,.75).moveTo(-2,26).lineTo(2,26).lineTo(12,4).bezierCurveTo(12,0,-12,0,-12,4).closePath().endFill(),o=new Hi().lineStyle(1,13421772).beginFill(16777215,0).moveTo(-2,26).lineTo(2,26).lineTo(12,4).bezierCurveTo(12,0,-12,0,-12,4).closePath().endFill();this.graphicToTexture("viewfield",s,r),this.graphicToTexture("viewfieldDark",n,r),this.graphicToTexture("viewfieldOutline",o,r);let a=new Hi().lineStyle(1,4473924).beginFill(16777215,.75).drawCircle(0,0,20).endFill(),l=new Hi().lineStyle(1,13421772).beginFill(3355443,.75).drawCircle(0,0,20).endFill(),c=new Hi().lineStyle(1,13421772).beginFill(16777215,0).drawCircle(0,0,20).endFill();this.graphicToTexture("pano",a,e),this.graphicToTexture("panoDark",l,e),this.graphicToTexture("panoOutline",c,e);let d=new Hi().lineStyle(1,4473924).beginFill(16777215,1).moveTo(0,0).bezierCurveTo(-2,-2,-8,-10,-8,-15).bezierCurveTo(-8,-19,-4,-23,0,-23).bezierCurveTo(4,-23,8,-19,8,-15).bezierCurveTo(8,-10,2,-2,0,0).closePath().endFill(),m=new Hi().lineStyle(1.5,6710886).beginFill(14540253,1).moveTo(0,0).bezierCurveTo(-2,-2,-8,-10,-8,-15).bezierCurveTo(-8,-19,-4,-23,0,-23).bezierCurveTo(4,-23,8,-19,8,-15).bezierCurveTo(8,-10,2,-2,0,0).closePath().endFill(),g=new Hi().lineStyle(1,4473924).beginFill(16777215,1).drawCircle(0,0,8).endFill(),_=new Hi().lineStyle(1,4473924).beginFill(16777215,1).drawCircle(0,0,6).endFill(),v=new Hi().lineStyle(1,4473924).beginFill(16777215,1).drawCircle(0,0,4.5).endFill(),E=new Hi().lineStyle(1,4473924).beginFill(16777215,1).drawCircle(0,0,4.5).beginFill(0,1).drawCircle(0,0,1.5).endFill();this.graphicToTexture("pin",d,e),this.graphicToTexture("boldPin",m,e),this.graphicToTexture("largeCircle",g,e),this.graphicToTexture("mediumCircle",_,e),this.graphicToTexture("smallCircle",v,e),this.graphicToTexture("taggedCircle",E,e);let b=new Hi().lineStyle(1,3355443).beginFill(16777215).moveTo(15,6.5).lineTo(10.8,6.5).bezierCurveTo(12.2,1.3,11.7,.8,11.2,.8).lineTo(6.2,.8).bezierCurveTo(5.8,.7,5.4,1,5.4,1.5).lineTo(4.2,10.2).bezierCurveTo(4.1,10.8,4.6,11.2,5,11.2).lineTo(9.3,11.2).lineTo(7.6,18.3).bezierCurveTo(7.5,18.8,8,19.3,8.5,19.3).bezierCurveTo(8.8,19.3,9.1,19.1,9.2,18.8).lineTo(15.6,7.8).bezierCurveTo(16,7.2,15.6,6.5,15,6.5).endFill().closePath(),T=new Hi().lineStyle(1,3355443).beginFill(16777215).drawPolygon([16,3,4,3,1,6,1,17,4,20,7,20,10,27,13,20,16,20,19,17.033,19,6]).endFill().closePath(),A=new Hi().lineStyle(1.5,3355443).beginFill(16777215,1).moveTo(17.5,0).lineTo(2.5,0).bezierCurveTo(1.13,0,0,1.12,0,2.5).lineTo(0,13.75).bezierCurveTo(0,15.12,1.12,16.25,2.5,16.25).lineTo(6.25,16.25).lineTo(6.25,19.53).bezierCurveTo(6.25,19.91,6.68,20.13,7,19.9).lineTo(11.87,16.25).lineTo(17.49,16.25).bezierCurveTo(18.86,16.25,20,15.12,20,13.75).lineTo(20,2.5).bezierCurveTo(20,1.13,18.87,0,17.5,0).closePath().endFill(),M=new Hi().lineStyle(1,3355443).beginFill(16777215).drawPolygon([16,3,4,3,1,6,1,17,4,20,7,20,10,27,13,20,16,20,19,17.033,19,6]).endFill().closePath();this.graphicToTexture("keepright",b,e),this.graphicToTexture("improveosm",T,e),this.graphicToTexture("osmnote",A,e),this.graphicToTexture("osmose",M,e);let k=new Hi().lineStyle(1,4473924).beginFill(16777215,1).drawPolygon([-3,4,7,0,-3,-4]).endFill(),F=new Hi().beginFill(16777215,1).drawPolygon([5,3,0,3,0,2,5,2,5,0,10,2.5,5,5]).endFill(),O=new Hi().beginFill(16777215,1).drawPolygon([0,5,5,0,0,-5]).endFill();this.graphicToTexture("midpoint",k,e),this.graphicToTexture("oneway",F,e),this.graphicToTexture("sided",O,e);let B=new Hi().lineStyle(1,16777215).beginFill(16777215,.6).drawRect(-5,-5,10,10).endFill(),U=new Hi().lineStyle(1,16777215).beginFill(16777215,.6).drawPolygon([-5,-5,5,-5,5,5,1,5,1,1,-5,1,-5,-5]).endFill(),z=new Hi().lineStyle(1,16777215).beginFill(16777215,.6).drawCircle(0,0,5).endFill();this.graphicToTexture("lowres-square",B,e),this.graphicToTexture("lowres-ell",U,e),this.graphicToTexture("lowres-circle",z,e);let Z=new Hi().lineStyle(1,16777215).beginFill(0,0).drawRect(-5,-5,10,10).endFill(),W=new Hi().lineStyle(1,16777215).beginFill(0,0).drawPolygon([-5,-5,5,-5,5,5,1,5,1,1,-5,1,-5,-5]).endFill(),q=new Hi().lineStyle(1,16777215).beginFill(0,0).drawCircle(0,0,5).endFill();this.graphicToTexture("lowres-unfilled-square",Z,e),this.graphicToTexture("lowres-unfilled-ell",W,e),this.graphicToTexture("lowres-unfilled-circle",q,e)}};var xS,yQ=250,m_=class extends sn.default{constructor(e,i,r,s){super(),this.context=e,this.supersurface=i,this.surface=r,this.overlay=s,this._frame=0,this._timeToNextRender=0,this._appPending=!1,this._drawPending=!1,this.pixiProjection=new Ho,this._transformDraw=null,this._isTransformed=!1,this._transformEase=null,this._tick=this._tick.bind(this),this._onHoverChange=this._onHoverChange.bind(this),this._onModeChange=this._onModeChange.bind(this),ui.defaultOptions.mipmap=An.OFF,ht.PREFER_ENV=jo.WEBGL2,this.pixi=new Ed({antialias:!0,autoDensity:!0,autoStart:!1,events:{move:!1,globalMove:!1,click:!0,wheel:!1},resizeTo:i.node(),resolution:window.devicePixelRatio,sharedLoader:!0,sharedTicker:!0,view:r.node()}),globalThis.__PIXI_APP__=this.pixi,e.pixi=this.pixi,Vs.from("debug",{fill:16777215,fontSize:14,stroke:3355443,strokeThickness:2},{chars:Vs.ASCII,padding:0,resolution:2});let n=this.pixi.ticker,o=n._head.next;n.remove(o.fn,o.context),n.add(this._tick,this),n.start();let a=this.pixi.stage;a.name="stage",a.sortableChildren=!0,a.eventMode="static",a.hitArea=new ri(-1e7,-1e7,2e7,2e7),this.stage=a,this.scene=new d_(this),this.events=new ly(this),xS||(xS=new p_(e)),this.textures=xS,e.on("modechange",this._onModeChange),e.behaviors.hover.on("hoverchange",this._onHoverChange)}_onModeChange(e){this.scene.clearClass("selected");for(let[i,r]of this.context.selectedData()){let s=null;r instanceof Nr?s="notes":r instanceof Er&&r.service==="improveOSM"?s=r.service:r.__fbid__?s="rapid":r.__featurehash__?s="custom-data":e.id==="select-osm"&&(s="osm"),s&&this.scene.classData(s,i,"selected")}this.render()}_onHoverChange(e){var a;let i=e.target,r=i==null?void 0:i.layerID,s=i==null?void 0:i.dataID,n=i==null?void 0:i.data,o=(a=this.context.mode)==null?void 0:a.id;o!=="select"&&o!=="select-osm"&&this.context.systems.ui.sidebar.hover(n?[n]:[]),this.scene.clearClass("hovered"),r&&s&&this.scene.classData(r,s,"hovered"),this.render()}_tick(){let e=this.pixi.ticker;if(this._drawPending){let i=this._frame,r=`draw-${i}-start`,s=`draw-${i}-end`;window.performance.mark(r),this._draw(),window.performance.mark(s),window.performance.measure(`draw-${i}`,r,s);return}if(this._tform(),this._appPending){if(this._timeToNextRender-=e.deltaMS,this._timeToNextRender>=0)return;{let i=this._frame,r=`app-${i}-start`,s=`app-${i}-end`;window.performance.mark(r),this._app(),window.performance.mark(s),window.performance.measure(`app-${i}`,r,s);return}}}deferredRender(){this._appPending=!0}render(){this._timeToNextRender=0,this._appPending=!0}setTransformAsync(e,i=0){let r=window.performance.now(),s=this.context.projection.transform(),n;if(this._transformEase&&(this.context.projection.transform(s),this._transformEase.resolve(s),this._transformEase=null),i>0){let o;n=new Promise(a=>{o=a}),this._transformEase={time0:r,time1:r+i,xform0:s,xform1:e,promise:n,resolve:o}}else this.context.projection.transform(e),n=Promise.resolve(e);return this._appPending=!0,n}resize(e,i){this.pixi.renderer.resize(e,i),this._appPending=!0}_tform(){if(this._drawPending)return;if(this._transformEase){let{time0:s,time1:n,xform0:o,xform1:a,resolve:l}=this._transformEase,[c,d,m]=[o.x,o.y,o.k],[g,_,v]=[a.x,a.y,a.k],E=window.performance.now(),b=Math.max(0,Math.min(1,(E-s)/(n-s))),T=c+(g-c)*b,A=d+(_-d)*b,M=m+(v-m)*b,k={x:T,y:A,k:M};this.context.projection.transform(k),b===1&&(l(k),this._transformEase=null),this._appPending=!0}let e=this.context.projection.transform(),i=this._transformDraw;if(!i)return;if(this._isTransformed||i.x!==e.x||i.y!==e.y||i.k!==e.k){let s=e.k/i.k,n=(e.x/s-i.x)*s,o=(e.y/s-i.y)*s;Sl(this.supersurface,n,o,s),Sl(this.overlay,-n,-o),this._isTransformed=!0,this.emit("move")}}_app(){var m;if(!((m=this.textures)!=null&&m.loaded))return;let e=this.context,i=this.pixiProjection,r=i.transform(),s=e.projection.transform(),n=e.systems.map.effectiveZoom(),o=[r.x,r.y],a=[s.x,s.y],l=Xi(o,a),c;r.k!==s.k||l>1e5?(c=[0,0],i.transform(s),this.scene.dirtyScene()):c=sr(o,a),this.pixi.stage.position.set(-c[0],-c[1]),this.scene.render(this._frame,i,n),this._appPending=!1,this._drawPending=!0}_draw(){this.pixi.render(),this._transformDraw=this.context.projection.transform(),this._timeToNextRender=yQ,this._isTransformed&&(Sl(this.supersurface,0,0),Sl(this.overlay,0,0),this._isTransformed=!1,this.emit("move")),this._drawPending=!1,this.emit("draw"),this._frame++}};var Li=function(t){let e=Gs();if(e.os==="mac")return t;if(e.os==="win"&&t==="\u2318\u21E7Z")return"Ctrl+Y";let i={"\u2318":"Ctrl","\u21E7":"Shift","\u2325":"Alt","\u232B":"Backspace","\u2326":"Delete"},r="";for(let s=0;s<t.length;s++)t[s]in i?r+=i[t[s]]+(s<t.length-1?"+":""):r+=t[s];return r};Li.display=function(t,e){if(e.length!==1)return e;let i=t.t,s=Gs().os==="mac";return{"\u2318":s?"\u2318 "+i("shortcuts.key.cmd"):i("shortcuts.key.ctrl"),"\u21E7":s?"\u21E7 "+i("shortcuts.key.shift"):i("shortcuts.key.shift"),"\u2325":s?"\u2325 "+i("shortcuts.key.option"):i("shortcuts.key.alt"),"\u2303":s?"\u2303 "+i("shortcuts.key.ctrl"):i("shortcuts.key.ctrl"),"\u232B":s?"\u232B "+i("shortcuts.key.delete"):i("shortcuts.key.backspace"),"\u2326":s?"\u2326 "+i("shortcuts.key.del"):i("shortcuts.key.del"),"\u2196":s?"\u2196 "+i("shortcuts.key.pgup"):i("shortcuts.key.pgup"),"\u2198":s?"\u2198 "+i("shortcuts.key.pgdn"):i("shortcuts.key.pgdn"),"\u21DE":s?"\u21DE "+i("shortcuts.key.home"):i("shortcuts.key.home"),"\u21DF":s?"\u21DF "+i("shortcuts.key.end"):i("shortcuts.key.end"),"\u21B5":s?"\u23CE "+i("shortcuts.key.return"):i("shortcuts.key.enter"),"\u238B":s?"\u238B "+i("shortcuts.key.esc"):i("shortcuts.key.esc"),"\u2630":s?"\u2630 "+i("shortcuts.key.menu"):i("shortcuts.key.menu")}[e]||e};function _Q(t,e){var i=e.getBoundingClientRect(),r=[i.width,i.height];return t.property("__dimensions__",r),r}function pc(t,e){if(!t||t.empty())return[0,0];var i=t.node(),r=t.property("__dimensions__");return!r||e?_Q(t,i):r}var f6=256,vS=2,g_=24,XN=Fn(vS,f6),WN=Fn(g_,f6);function tu(t,e,i){return Math.max(e,Math.min(t,i))}var p6=class extends fi{constructor(e){super(e),this.id="map",this.dependencies=new Set(["edits","filters","imagery","photos","storage","l10n","urlhash"]),this.supersurface=ye(null),this.surface=ye(null),this.overlay=ye(null),this.redrawEnabled=!0,this.areaFillOptions=["wireframe","partial","full"],this._highlightEdits=!1,this._currFillMode="partial",this._toggleFillMode="partial",this._renderer=null,this._dimensions=[1,1],this._initPromise=null,this._hashchange=this._hashchange.bind(this),this._updateHash=this._updateHash.bind(this),this.render=this.render.bind(this),this.immediateRedraw=this.immediateRedraw.bind(this),this.deferredRedraw=this.deferredRedraw.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let n of this.dependencies)if(!this.context.systems[n])return Promise.reject(`Cannot init:  ${this.id} requires ${n}`);let e=this.context,i=e.systems.storage,r=e.systems.l10n;e.systems.urlhash.on("hashchange",this._hashchange);let s=Promise.all([i.initAsync(),r.initAsync()]);return this._initPromise=s.then(()=>{this._currFillMode=i.getItem("area-fill")||"partial",this._toggleFillMode=i.getItem("area-fill-toggle")||"partial";let n=r.t("area_fill.wireframe.key"),o=r.t("map_data.highlight_edits.key");e.keybinding().on(n,a=>{a.preventDefault(),a.stopPropagation(),this.wireframeMode=!this.wireframeMode}).on(Li("\u2325"+n),a=>{a.preventDefault(),a.stopPropagation();let l=e.mode;l&&/^draw/.test(l.id)||(this.scene.toggleLayers("osm"),e.enter("browse"))}).on(o,a=>{a.preventDefault(),this.highlightEdits=!this.highlightEdits})})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}render(e){let i=this.context;e.on("contextmenu",d=>d.preventDefault()).on("wheel.map mousewheel.map",d=>d.preventDefault()),this.supersurface=e.append("div").attr("class","supersurface"),this.surface=this.supersurface.append("canvas").attr("class","surface"),this.overlay=this.supersurface.append("div").attr("class","overlay"),this._renderer||(this._renderer=new m_(i,this.supersurface,this.surface,this.overlay),this._renderer.on("move",()=>this.emit("move")).on("draw",()=>{this._updateHash(),this.emit("draw",{full:!0})})),this.dimensions=pc(e);let r=i.systems.edits,s=i.systems.filters,n=i.systems.imagery,o=i.systems.photos,a=this._renderer.scene,l=d=>{var g;let m=(g=i.mode)==null?void 0:g.id;m!=="browse"&&m!=="select"||d&&this.transformEase(d)};r.on("merge",d=>{d&&a.dirtyData("osm",d),this.deferredRedraw()}).on("change",d=>{if(d){let m=d.complete();for(let g of m.values())g&&(g.touch(),s.clearEntity(g))}this.immediateRedraw()}).on("undone",(d,m)=>l(m.transform)).on("redone",d=>l(d.transform)),s.on("filterchange",()=>{a.dirtyLayers("osm"),this.immediateRedraw()}),n.on("imagerychange",this.immediateRedraw),o.on("photochange",this.immediateRedraw),a.on("layerchange",this.immediateRedraw);let c=i.services.osm;c&&c.on("authchange",this.immediateRedraw)}_hashchange(e,i){var a;let r=e.get("map"),s=i.get("map");if(!r||r!==s){let l,c,d,m;typeof r=="string"&&([l,c,d,m]=r.split("/",4).map(Number)),(isNaN(l)||!isFinite(l))&&(l=2),(isNaN(c)||!isFinite(c))&&(c=0),(isNaN(d)||!isFinite(d))&&(d=0),(isNaN(m)||!isFinite(m))&&(m=0),l=tu(l,2,24),c=tu(c,-90,90),d=tu(d,-180,180),m=tu(m,0,360),this.centerZoom([d,c],l)}let n=e.get("id"),o=i.get("id");if(n!==o&&typeof n=="string"){let l=n.split(",").map(d=>d.trim()).filter(Boolean),c=(a=this.mode)==null?void 0:a.id;l.length&&c!=="save"&&this.selectEntityID(l[0])}}_updateHash(){let[e,i]=this.center(),r=this.zoom(),s=0,n=Math.max(0,Math.ceil(Math.log(r)/Math.LN2)),o=.1;if(isNaN(r)||!isFinite(r)||isNaN(i)||!isFinite(i)||isNaN(e)||!isFinite(e)||isNaN(s)||!isFinite(s))return;let a=r.toFixed(2),l=i.toFixed(n),c=e.toFixed(n),d=s.toFixed(1),m=`${a}/${l}/${c}`;Math.abs(s)>o&&(m+=`/${d}`),this.context.systems.urlhash.setParam("map",m)}deferredRedraw(){!this._renderer||!this.redrawEnabled||this._renderer.deferredRender()}immediateRedraw(){!this._renderer||!this.redrawEnabled||this._renderer.render()}get dimensions(){return this._dimensions}set dimensions(e){let[i,r]=e;this._dimensions=e,this.context.projection.dimensions([[0,0],[i,r]]),this._renderer.resize(i,r)}centerPoint(){return $o(this._dimensions,.5)}centerLoc(){return this.context.projection.invert(this.centerPoint())}mouse(){return this._renderer.events.coord}mouseLoc(){let e=this.mouse()||this.centerPoint();return this.context.projection.invert(e)}transform(e,i){return e===void 0?this.context.projection.transform():(i===void 0&&(i=0),this._renderer.setTransformAsync(e,i),this)}setTransformAsync(e,i=0){return this._renderer.setTransformAsync(e,i)}centerZoom(e,i,r=0){let s=this.center(),n=this.zoom();if(e[0]===s[0]&&e[1]===s[1]&&i===n)return this;let o=tu(Fn(i,f6),XN,WN),a=new Ho;a.transform(this.context.projection.transform()),a.scale(o);let l=a.translate(),c=a.project(e),d=this.centerPoint(),m=sr(d,c);return l=Ir(l,m),this.transform({x:l[0],y:l[1],k:o},r)}setCenterZoomAsync(e,i,r=0){let s=this.center(),n=this.zoom();if(e[0]===s[0]&&e[1]===s[1]&&i===n)return new Promise.resolve(this.context.projection.transform());let o=tu(Fn(i,f6),XN,WN),a=new Ho;a.transform(this.context.projection.transform()),a.scale(o);let l=a.translate(),c=a.project(e),d=this.centerPoint(),m=sr(d,c);return l=Ir(l,m),this.setTransformAsync({x:l[0],y:l[1],k:o},r)}center(e,i){return e===void 0?this.context.projection.invert(this.centerPoint()):(i===void 0&&(i=0),e[0]=tu(e[0]||0,-180,180),e[1]=tu(e[1]||0,-90,90),this.centerZoom(e,this.zoom(),i))}zoom(e,i){return e===void 0?Math.max(0,Ga(this.context.projection.scale(),f6)):(i===void 0&&(i=0),e=tu(e||0,vS,g_),this.centerZoom(this.center(),e,i))}pan(e,i=0){let r=this.context.projection.transform();return this.transform({x:r.x+e[0],y:r.y+e[1],k:r.k},i)}fitEntities(e,i=0){let r;if(Array.isArray(e)?r=kr(e,this.context.graph()):r=e.extent(this.context.graph()),!isFinite(r.area()))return this;let s=tu(this.trimmedExtentZoom(r),0,20);return this.centerZoom(r.center(),s,i)}selectEntityID(e,i){let r=i||!1,s=this.context,n=a=>{var d;let l=s.selectedIDs();(((d=s.mode)==null?void 0:d.id)!=="select-osm"||!l.includes(e))&&s.enter("select-osm",{selectedIDs:[a.id]}),(a.extent(s.graph()).percentContainedIn(this.extent())<.8||r)&&this.fitEntities(a)},o=s.hasEntity(e);o?n(o):s.loadEntity(e,(a,l)=>{a||(o=l.data.find(c=>c.id===e),o&&n(o))})}_zoomIn(e){return this.centerZoom(this.center(),~~this.zoom()+e,250)}_zoomOut(e){return this.centerZoom(this.center(),~~this.zoom()-e,250)}zoomIn(){return this._zoomIn(1)}zoomInFurther(){return this._zoomIn(4)}canZoomIn(){return this.zoom()<g_}zoomOut(){return this._zoomOut(1)}zoomOutFurther(){return this._zoomOut(4)}canZoomOut(){return this.zoom()>vS}transformEase(e,i=250){return this.transform(e,i)}centerZoomEase(e,i,r=250){return this.centerZoom(e,i,r)}centerEase(e,i=250){return this.center(e,i)}zoomEase(e,i=250){return this.zoom(e,i)}fitEntitiesEase(e,i=250){return this.fitEntities(e,i)}effectiveZoom(){let e=this.center()[1],i=this.zoom(),r=Dn(1,e),s=Dn(1,0),n=Math.log(r/s)/Math.LN2;return Math.min(i+n,g_)}extent(e){return e===void 0?new mt(this.context.projection.invert([0,this._dimensions[1]]),this.context.projection.invert([this._dimensions[0],0])):this.centerZoom(e.center(),this.extentZoom(e))}trimmedExtent(e){return e===void 0?new mt(this.context.projection.invert([10,this._dimensions[1]-30-10]),this.context.projection.invert([this._dimensions[0]-10,71+10])):this.centerZoom(e.center(),this.trimmedExtentZoom(e))}extentZoom(e,i){let[r,s]=i||this._dimensions,n=this.context.projection.project([e.min[0],e.max[1]]),o=this.context.projection.project([e.max[0],e.min[1]]),a=(o[0]-n[0])/r,l=(o[1]-n[1])/s,c=Math.log(Math.abs(a))/Math.LN2,d=Math.log(Math.abs(l))/Math.LN2,m=Math.max(c,d),g=this.zoom(),_=Math.max(g,19);return isFinite(m)?g-m:_}trimmedExtentZoom(e){let s=sr(this._dimensions,[40,140]);return this.extentZoom(e,s)}get highlightEdits(){return this._highlightEdits}set highlightEdits(e){this._highlightEdits!==e&&(this._highlightEdits=e,this._renderer.scene.dirtyScene(),this.immediateRedraw(),this.emit("mapchange"))}get areaFillMode(){return this._currFillMode}set areaFillMode(e){let i=this.context.systems.storage,r=this._currFillMode;r!==e&&(r!=="wireframe"&&(this._toggleFillMode=r,i.setItem("area-fill-toggle",r)),this._currFillMode=e,i.setItem("area-fill",e),this._renderer.scene.dirtyScene(),this.immediateRedraw(),this.emit("mapchange"))}get wireframeMode(){return this._currFillMode==="wireframe"}set wireframeMode(e){e?this.areaFillMode!=="wireframe"&&(this.areaFillMode="wireframe"):this.areaFillMode=this._toggleFillMode}get scene(){return this._renderer.scene}get renderer(){return this._renderer}};var QN=Yi(YN(),1);var ZN="#01d4fa",m6=class extends fi{constructor(e){super(e),this.id="map3d",this.autoStart=!1,this.dependencies=new Set(["map"]),this.containerID="3d-buildings",this.maplibre=null,this._startPromise=null,this.building3dlayerSpec=this.get3dBuildingLayerSpec("3D Buildings","osmbuildings"),this.roadStrokelayerSpec=this.getRoadStrokeLayerSpec("Roads","osmroads"),this.roadCasinglayerSpec=this.getRoadCasingLayerSpec("Roads","osmroads"),this.roadSelectedlayerSpec=this.getRoadSelectedLayerSpec("Roads","osmroads"),this.areaLayerSpec=this.getAreaLayerSpec("Areas","osmareas")}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._startPromise?this._startPromise:(this.maplibre=new QN.Map({container:this.containerID,pitch:30,style:{version:8,sources:{},layers:[{id:"Background",type:"background",layout:{visibility:"visible"},paint:{"background-color":"white"}}]}}),this._startPromise=new Promise(e=>{let i=this.context.systems.map,r=this.maplibre;r.on("load",()=>{r.setLight({anchor:"viewport",color:"#ff00ff",position:[1,200,30],intensity:.3}),r.jumpTo({zoom:i.zoom()-3,center:i.extent().center()}),r.addSource("osmareas",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r.addLayer(this.areaLayerSpec),r.addSource("osmroads",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r.addLayer(this.roadSelectedlayerSpec),r.addLayer(this.roadCasinglayerSpec),r.addLayer(this.roadStrokelayerSpec),r.addSource("osmbuildings",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r.addLayer(this.building3dlayerSpec),this._started=!0,e()})}))}resetAsync(){return Promise.resolve()}get3dBuildingLayerSpec(e,i){return{id:e,type:"fill-extrusion",source:i,layout:{},paint:{"fill-extrusion-color":["match",["get","selected"],"true",ZN,"#e06e5f"],"fill-extrusion-height":["get","height"],"fill-extrusion-base":["get","min_height"],"fill-extrusion-opacity":.85}}}getAreaLayerSpec(e,i){return{id:e,type:"fill",source:i,layout:{},paint:{"fill-color":["get","fillcolor"],"fill-outline-color":["get","strokecolor"],"fill-opacity":.5}}}getRoadCasingLayerSpec(e,i){return{id:e+"-casing",type:"line",source:i,minzoom:4,layout:{"line-cap":"butt","line-join":"round",visibility:"visible"},paint:{"line-color":["get","casingColor"],"line-width":this.getLineWidthSpecification(6)}}}getRoadSelectedLayerSpec(e,i){return{id:e+"-selected",type:"line",source:i,minzoom:4,layout:{"line-cap":"butt","line-join":"round",visibility:"visible"},paint:{"line-color":ZN,"line-opacity":["match",["get","selected"],"true",.75,0],"line-width":this.getLineWidthSpecification(12)}}}getRoadStrokeLayerSpec(e,i){return{id:e+"-stroke",type:"line",source:i,minzoom:4,layout:{"line-cap":"butt","line-join":"round",visibility:"visible"},paint:{"line-color":["get","strokeColor"],"line-opacity":["match",["get","highway"],"unclassified",.8,"service",.2,1],"line-width":this.getLineWidthSpecification(4)}}}getLineWidthSpecification(e){return["interpolate",["linear",2],["zoom"],5,.5,16,["match",["get","highway"],["motorway","trunk","primary"],e*2,["secondary","unclassified"],Math.floor(.75*e*2),["tertiary"],Math.floor(.75*e*2)-1,["minor","service","track","footway","pedestrian","cycleway"],e,e],20,["match",["get","highway"],["motorway","trunk","primary"],e*2.5,["secondary","unclassified"],e*2.5,["tertiary"],e*2.5,["minor","service","track","footway","pedestrian","cycleway"],e*2,e*2]]}};var g6=class extends fi{constructor(e){super(e),this.id="photos",this.dependencies=new Set(["map","urlhash"]),this._LAYERIDS=["streetside","mapillary","mapillary-map-features","mapillary-signs","kartaview"],this._PHOTOTYPES=["flat","panoramic"],this._DATEFILTERS=["fromDate","toDate"],this._shownPhotoTypes=new Set(this._PHOTOTYPES),this._fromDate=null,this._toDate=null,this._usernames=null,this._currLayerID=null,this._currPhotoID=null,this._initPromise=null,this._startPromise=null,this._hashchange=this._hashchange.bind(this),this._updateHash=this._updateHash.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let n of this.dependencies)if(!this.context.systems[n])return Promise.reject(`Cannot init:  ${this.id} requires ${n}`);let e=this.context,i=e.systems.map,r=e.systems.urlhash,s=Promise.all([i.initAsync(),r.initAsync()]);return this._initPromise=s.then(()=>r.on("hashchange",this._hashchange))}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context.systems.map,i=e.startAsync();return this._startPromise=i.then(()=>{e.scene.on("layerchange",this._updateHash),this._started=!0})}resetAsync(){return Promise.resolve()}_hashchange(e,i){let s=this.context.scene(),n=e.get("photo_overlay"),o=i.get("photo_overlay");if(n!==o){let _=new Set;typeof n=="string"&&(_=new Set(n.replace(/;/g,",").split(",")));for(let v of this._LAYERIDS){let E=s.layers.get(v);E&&(E.enabled=_.has(E.id))}}let a=e.get("photo_dates"),l=i.get("photo_dates");if(a!==l)if(typeof a=="string"){let _=/^(.*)[_](.*)$/g.exec(a.trim());this.setDateFilter("fromDate",_&&_.length>=2&&_[1]),this.setDateFilter("toDate",_&&_.length>=3&&_[2])}else this._toDate=this._fromDate=null;let c=e.get("photo_username"),d=i.get("photo_username");c!==d&&this.setUsernameFilter(c);let m=e.get("photo"),g=i.get("photo");if(m!==g&&typeof m=="string"){let[_,v]=m.split("/",2).filter(Boolean);_&&v?this.selectPhoto(_,v):this.selectPhoto()}}_updateHash(){let e=this.context.systems.urlhash,i=this.context.scene(),r=[];for(let o of this._LAYERIDS){let a=i.layers.get(o);a&&a.supported&&a.enabled&&r.push(o)}e.setParam("photo_overlay",r.length?r.join(","):null);let s;this._currLayerID&&this._currPhotoID&&(s=`${this._currLayerID}/${this._currPhotoID}`),e.setParam("photo",s);let n;(this._fromDate||this._toDate)&&(n=(this._fromDate||"")+"_"+(this._toDate||"")),e.setParam("photo_dates",n),e.setParam("photo_username",this._usernames?this._usernames.join(","):null)}get overlayLayerIDs(){return this._LAYERIDS}get allPhotoTypes(){return this._PHOTOTYPES}get dateFilters(){return this._DATEFILTERS}get fromDate(){return this._fromDate}get toDate(){return this._toDate}get usernames(){return this._usernames}selectPhoto(e=null,i=null){if(e===this._currLayerID&&i===this._currPhotoID)return;this._currLayerID=e,this._currPhotoID=i;let r=this.context,s=r.scene();if(s.clearClass("selected"),e&&i){let n=r.services[e];if(!n)return null;s.enableLayers(e),s.classData(e,i,"selected"),n.startAsync().then(()=>n.selectImageAsync(i)).then(()=>n.showViewer())}this._updateHash(),this.emit("photochange")}dateFilterValue(e){return e==="fromDate"?this._fromDate:e==="toDate"?this._toDate:null}setDateFilter(e,i){let r=i&&new Date(i);r&&!isNaN(r)?i=r.toISOString().slice(0,10):i=null;let s=!1;e==="fromDate"&&(this._fromDate=i,s=!0,this._fromDate&&this._toDate&&new Date(this._toDate)<new Date(this._fromDate)&&(this._toDate=this._fromDate)),e==="toDate"&&(this._toDate=i,s=!0,this._fromDate&&this._toDate&&new Date(this._toDate)<new Date(this._fromDate)&&(this._fromDate=this._toDate)),s&&(this._updateHash(),this.emit("photochange"))}setUsernameFilter(e){e&&typeof e=="string"&&(e=e.replace(/;/g,",").split(",")),e&&(e=e.map(i=>i.trim()).filter(Boolean),e.length||(e=null)),this._usernames=e,this._updateHash(),this.emit("photochange")}togglePhotoType(e){this._PHOTOTYPES.includes(e)&&(this._shownPhotoTypes.has(e)?this._shownPhotoTypes.delete(e):this._shownPhotoTypes.add(e),this.emit("photochange"))}_showsLayer(e){let i=this.context.scene().layers.get(e);return i==null?void 0:i.enabled}shouldFilterByDate(){return this._showsLayer("mapillary")||this._showsLayer("kartaview")||this._showsLayer("streetside")}shouldFilterByPhotoType(){return this._showsLayer("mapillary")||this._showsLayer("streetside")&&this._showsLayer("kartaview")}shouldFilterByUsername(){return!this._showsLayer("mapillary")&&this._showsLayer("kartaview")&&!this._showsLayer("streetside")}showsPhotoType(e){return this.shouldFilterByPhotoType()?this._shownPhotoTypes.has(e):!0}showsFlat(){return this.showsPhotoType("flat")}showsPanoramic(){return this.showsPhotoType("panoramic")}};function n0(t,e){let i=Pt("change"),r=[],s=[],n=ye(null),o=ye(null),a=ye(null),l=ye(null),c,d,m=[],g,_=e.presetField.options;if(Array.isArray(_))for(let A of _)r.push(A==="undefined"?void 0:A),s.push(e.tHtml(`options.${A}`,{default:A}));else r=[void 0,"yes"],s=[t.tHtml("inspector.unknown"),t.tHtml("inspector.check.yes")],e.type!=="defaultCheck"&&(r.push("no"),s.push(t.tHtml("inspector.check.no")));function v(){if(d=e.id==="oneway_yes",e.id==="oneway"&&m.length){let A=t.entity(m[0]);for(let M in A.tags)if(M in O1&&A.tags[M]in O1[M]){d=!0,s[0]=t.tHtml("_tagging.presets.fields.oneway_yes.options.undefined");break}}}function E(){return t.container().select("div.inspector-hover").empty()?!(g==="yes"||d&&!g):!0}function b(A){let M=m.length&&t.hasEntity(m[0]);if(E()||!M)return A;let k=M.first(),F=M.isClosed()?M.nodes[M.nodes.length-2]:M.last(),B=k<F?"#rapid-icon-forward":"#rapid-icon-backward";return A.selectAll(".reverser-span").html(t.tHtml("inspector.check.reverser")).call(Ye(B,"inline")),A}let T=function(A){v(),a=A.selectAll(".form-field-input-wrap").data([0]);let M=a.enter().append("label").attr("class","form-field-input-wrap form-field-input-check");M.append("input").property("indeterminate",e.type!=="defaultCheck").attr("type","checkbox").attr("id",e.uid),M.append("span").html(s[0]).attr("class","value"),e.type==="onewayCheck"&&M.append("button").attr("class","reverser"+(E()?" hide":"")).append("span").attr("class","reverser-span"),a=a.merge(M),n=a.selectAll("input"),o=a.selectAll("span.value"),n.on("click",function(k){k.stopPropagation();let F=e.key,O={};Array.isArray(c[F])?r.indexOf("yes")!==-1?O[F]="yes":O[F]=r[0]:O[F]=r[(r.indexOf(g)+1)%r.length],(O[F]==="reversible"||O[F]==="alternating")&&(O[F]=r[0]),i.call("change",this,O)}),e.type==="onewayCheck"&&(l=a.selectAll(".reverser"),l.call(b).on("click",function(k){k.preventDefault(),k.stopPropagation(),m.length&&(t.perform(function(F){for(let O of m)F=pl(O)(F);return F},t.t("operations.reverse.annotation.line",{n:1})),t.systems.validator.validate(),ye(this).call(b))}))};return T.entityIDs=function(A){return arguments.length?(m=A,T):m},T.tags=function(A){c=A;let M=e.key;function k(B){return B!=="no"&&B!==""&&B!==void 0&&B!==null}function F(B){B===""&&(B=void 0);let U=r.indexOf(B);return U===-1?`"${B}"`:s[U]}v();let O=Array.isArray(A[M]);g=!O&&A[M]&&A[M].toLowerCase(),e.type==="onewayCheck"&&(g==="1"||g==="-1")&&(g="yes"),n.property("indeterminate",O||e.type!=="defaultCheck"&&!g).property("checked",k(g)),o.html(O?t.tHtml("inspector.multiple_values"):F(g)).classed("mixed",O),a.classed("set",!!g),e.type==="onewayCheck"&&l.classed("hide",E()).call(b)},T.focus=function(){n.node().focus()},$t(T,i,"on")}var y_;function xr(t,e){var i=Pt("accept","cancel"),r=t.container(),s=[],n=[],o={},a=null,l=!0,c=!1,d=!1,m=2,g=0,_,v,E=function(T,A){A(n.filter(function(M){var k=M.terms||[];return k.push(M.value),k.some(function(F){return F.toString().toLowerCase().indexOf(T.toLowerCase())!==-1})}))},b=function(T,A){if(!T||T.empty())return;T.classed("combobox-input",!0).on("focus.combo-input",F).on("blur.combo-input",O).on("keydown.combo-input",z).on("keyup.combo-input",Z).on("input.combo-input",W).on("mousedown.combo-input",M).each(function(){var te=this.parentNode,ie=this.nextSibling;ye(te).selectAll(".combobox-caret").filter(function(oe){return oe===T.node()}).data([T.node()]).enter().insert("div",function(){return ie}).attr("class","combobox-caret").on("mousedown.combo-caret",function(oe){oe.preventDefault(),T.node().focus(),M(oe)}).on("mouseup.combo-caret",function(oe){oe.preventDefault(),k(oe)})});function M(te){if(te.button===0){g=+new Date;var ie=T.property("selectionStart"),oe=T.property("selectionEnd");if(ie!==oe){var fe=si(T);T.node().setSelectionRange(fe.length,fe.length);return}T.on("mouseup.combo-input",k)}}function k(te){if(T.on("mouseup.combo-input",null),te.button===0&&T.node()===document.activeElement){var ie=T.property("selectionStart"),oe=T.property("selectionEnd");if(ie===oe){var fe=r.selectAll(".combobox");if(fe.empty()||fe.datum()!==T.node()){var Re=g;window.setTimeout(function(){Re===g&&le("",function(){B(),ne()})},250)}else U()}}}function F(){le("")}function O(){y_=window.setTimeout(U,75)}function B(){U(),r.insert("div",":first-child").datum(T.node()).attr("class","combobox"+(e?" combobox-"+e:"")).style("position","absolute").style("display","block").style("left","0px").on("mousedown.combo-container",function(te){te.preventDefault()}),r.on("scroll.combo-scroll",ne,!0)}function U(){y_&&(window.clearTimeout(y_),y_=void 0),r.selectAll(".combobox").remove(),r.on("scroll.combo-scroll",null)}function z(te){var ie=!r.selectAll(".combobox").empty(),oe=T.node()?T.node().tagName.toLowerCase():"";switch(te.keyCode){case 8:case 46:te.stopPropagation(),a=null,ne(),T.on("input.combo-input",function(){var fe=T.property("selectionStart");T.node().setSelectionRange(fe,fe),T.on("input.combo-input",W)});break;case 9:ee(te);break;case 13:te.preventDefault(),te.stopPropagation();break;case 38:if(oe==="textarea"&&!ie)return;te.preventDefault(),oe==="input"&&!ie&&B(),q(-1);break;case 40:if(oe==="textarea"&&!ie)return;te.preventDefault(),oe==="input"&&!ie&&B(),q(1);break}}function Z(te){switch(te.keyCode){case 27:re();break;case 13:ee(te);break}}function W(){le(V(),function(){a=null;var te=T.property("value");if(s.length&&(T.property("selectionEnd")===te.length&&(a=de()),a||(a=te)),te.length){var ie=r.selectAll(".combobox");ie.empty()&&B()}else U();ne()})}function q(te){if(s.length){for(var ie=-1,oe=0;oe<s.length;oe++)if(a&&s[oe].value===a){ie=oe;break}ie=Math.max(Math.min(ie+te,s.length-1),0),a=s[ie].value,T.property("value",a)}ne(),Q()}function Q(){var te=r.selectAll(".combobox");if(!te.empty()){var ie=r.node().getBoundingClientRect(),oe=te.node().getBoundingClientRect();if(oe.bottom>ie.bottom){var fe=A?A.node():T.node();fe.scrollIntoView({behavior:"instant",block:"center"}),ne()}var Re=te.selectAll(".combobox-option.selected").node();Re&&Re.scrollIntoView({behavior:"smooth",block:"nearest"})}}function V(){var te=T.property("value"),ie=T.property("selectionStart"),oe=T.property("selectionEnd");return ie&&oe&&(te=te.substring(0,ie)),te}function le(te,ie){d=!1,E.call(T,te,function(oe){d||(s=oe,oe.forEach(function(fe){o[fe.value]=fe}),ie&&ie())})}function de(){if(l){var te=c?V():V().toLowerCase();if(te&&!(!isNaN(parseFloat(te))&&isFinite(te))){for(var ie=-1,oe=0;oe<s.length;oe++){var fe=s[oe].value,Re=c?fe:fe.toLowerCase();if(Re===te){ie=oe;break}else ie===-1&&Re.indexOf(te)===0&&(ie=oe)}if(ie!==-1){var He=s[ie].value;return T.property("value",He),T.node().setSelectionRange(te.length,He.length),He}}}}function ne(){if(s.length<m||document.activeElement!==T.node()){U();return}var te=!r.selectAll(".combobox").empty();if(te){var ie=r.selectAll(".combobox"),oe=ie.selectAll(".combobox-option").data(s,function(Je){return Je.value});oe.exit().remove(),oe.enter().append("a").attr("class",function(Je){return"combobox-option "+(Je.klass||"")}).attr("title",function(Je){return Je.title}).html(function(Je){return Je.display||Je.value}).on("mouseenter",_).on("mouseleave",v).merge(oe).classed("selected",function(Je){return Je.value===a}).on("click.combo-option",ee).order();var fe=A?A.node():T.node(),Re=r.node().getBoundingClientRect(),He=fe.getBoundingClientRect();ie.style("left",He.left+5-Re.left+"px").style("width",He.width-10+"px").style("top",He.height+He.top-Re.top+"px")}}function ee(te,ie){d=!0;var oe=T.node();ie&&(si(T,ie.value),N2(T,"change"));var fe=si(T);oe.setSelectionRange(fe.length,fe.length),ie=o[fe],i.call("accept",oe,ie,fe),U()}function re(){d=!0;var te=T.node(),ie=si(T),oe=T.property("selectionStart"),fe=T.property("selectionEnd");ie=ie.slice(0,oe)+ie.slice(fe),si(T,ie),te.setSelectionRange(ie.length,ie.length),i.call("cancel",te),U()}};return b.canAutocomplete=function(T){return arguments.length?(l=T,b):l},b.caseSensitive=function(T){return arguments.length?(c=T,b):c},b.data=function(T){return arguments.length?(n=T,b):n},b.fetcher=function(T){return arguments.length?(E=T,b):E},b.minItems=function(T){return arguments.length?(m=T,b):m},b.itemsMouseEnter=function(T){return arguments.length?(_=T,b):_},b.itemsMouseLeave=function(T){return arguments.length?(v=T,b):v},$t(b,i,"on")}xr.off=function(t,e){t.on("focus.combo-input",null).on("blur.combo-input",null).on("keydown.combo-input",null).on("keyup.combo-input",null).on("input.combo-input",null).on("mousedown.combo-input",null).on("mouseup.combo-input",null),e.container().on("scroll.combo-scroll",null)};function nl(t,e){let i=Pt("change"),r=e.presetField;var s=e.type==="multiCombo"||e.type==="manyCombo",n=e.type==="networkCombo",o=e.type==="semiCombo",a=r.options,l=e.type!=="manyCombo"&&r.autoSuggestions!==!1,c=e.type!=="manyCombo"&&r.customValues!==!1,d=r.snake_case||r.snake_case===void 0,m=xr(t,"combo-"+e.safeid).caseSensitive(r.caseSensitive).minItems(s||o?1:2),g=ye(null),_=ye(null),v=ye(null),E=[],b=[],T=[],A,M,k,F=[];t.systems.data.getDataAsync("deprecated").then(function(ie){F=ie}).catch(ie=>console.error(ie)),s&&e.key&&/[^:]$/.test(e.key)&&(e.key+=":");function B(ie){return ie.replace(/\s+/g,"_").toLowerCase()}function U(ie){return ie.split(";").map(oe=>oe.trim()).join(";")}function z(ie){ie=U(ie||"");var oe=E.find(function(fe){return fe.key&&U(fe.value)===ie});return oe?oe.key:e.type==="typeCombo"&&!ie?"yes":(d?B(ie):ie)||void 0}function Z(ie){return ie=ie||"",e.hasTextForStringID("options."+ie)?e.t(`options.${ie}`,{default:ie}):e.type==="typeCombo"&&ie.toLowerCase()==="yes"?"":ie}function W(ie,oe){return ie.filter(function(fe){return!oe.some(function(Re){return!Re.isMixed&&fe.value===Re.value})})}function q(ie,oe){c||ie.attr("readonly","readonly"),t.services.taginfo&&l?(ie.call(m.fetcher(V),oe),V("",le)):(ie.call(m,oe),Q(le))}function Q(ie){a&&(E=a.map(function(oe){return{key:oe,value:e.t(`options.${oe}`,{default:oe}),title:oe,display:e.tHtml(`options.${oe}`,{default:oe}),klass:e.hasTextForStringID(`options.${oe}`)?"":"raw-option"}}),m.data(W(E,b)),ie&&ie(E))}function V(ie,oe){let fe=t.services.taginfo;if(!fe){E=[],oe&&oe(E);return}var Re=s?fe.multikeys:fe.values,He=(s?e.key:"")+ie,Je=n&&M&&M.indexOf(ie.toLowerCase())===0;Je&&(He=M+":");var ot={debounce:ie!=="",key:e.key,query:He};T.length&&(ot.geometry=t.graph().geometry(T[0])),Re(ot,function(yt,bt){if(!yt){bt=bt.filter(function(Te){return e.type==="typeCombo"&&Te.value==="yes"?!1:!Te.count||Te.count>10});var at=Dt.deprecatedTagValuesByKey(F)[e.key];at&&(bt=bt.filter(function(Te){return at.indexOf(Te.value)===-1})),Je&&(bt=bt.filter(function(Te){return Te.value.toLowerCase().indexOf(M+":")===0})),g.classed("empty-combobox",bt.length===0),E=bt.map(function(Te){var Ze=Te.value;s&&(Ze=Ze.replace(e.key,""));var xt=e.t(`options.${Ze}`,{default:Ze});return{key:Ze,value:xt,display:e.tHtml(`options.${Ze}`,{default:Ze}),title:Te.title||xt,klass:e.hasTextForStringID(`options.${Ze}`)?"":"raw-option"}}),E=W(E,b),oe&&oe(E)}})}function le(ie){if(s||o)k=e.placeholder||t.t("inspector.add");else{var oe=ie.map(function(He){return He.value}).filter(function(He){return He.length<20}),fe=oe.length>1?oe:ie.map(function(He){return He.key});k=e.placeholder||fe.slice(0,3).join(", ")}/(|\.\.\.)$/.test(k)||(k+="\u2026");var Re;!s&&!o&&A&&Array.isArray(A[e.key])?Re=t.t("inspector.multiple_values"):Re=k,g.selectAll("input").attr("placeholder",Re)}function de(){var ie={},oe;if(s||o){oe=z(si(v))||"",g.classed("active",!1),si(v,"");var fe=oe.split(";").filter(Boolean);if(!fe.length)return;if(s)Ei(fe).forEach(function(Je){var ot=(e.key||"")+Je;if(A){var yt=A[ot];if(typeof yt=="string"&&yt.toLowerCase()!=="no")return}ot=t.cleanTagKey(ot),e.keys.push(ot),ie[ot]="yes"});else if(o){var Re=b.map(function(Je){return Je.key});Re=Re.concat(fe),ie[e.key]=t.cleanTagValue(Ei(Re).filter(Boolean).join(";"))}window.setTimeout(function(){v.node().focus()},10)}else{var He=si(v);if(!He&&Array.isArray(A[e.key]))return;oe=t.cleanTagValue(z(He)),ie[e.key]=oe||void 0}i.call("change",this,ie)}function ne(){let ie=t.systems.rapid,oe=(T==null?void 0:T.length)&&T[0];return oe&&ie.acceptedIDs.has(oe)}function ee(ie,oe){ie.preventDefault(),ie.stopPropagation();let fe=e.key;if(!(fe==="source"&&ne())){var Re={};if(s)Re[oe.key]=void 0;else if(o){var He=b.map(function(Je){return Je.key===oe.key?null:Je.key}).filter(Boolean);He=Ei(He),Re[fe]=He.length?He.join(";"):void 0}i.call("change",this,Re)}}function re(ie){g=ie.selectAll(".form-field-input-wrap").data([0]);var oe=s||o?"multicombo":"combo";if(g=g.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+oe).merge(g),s||o){g=g.selectAll(".chiplist").data([0]);var fe="chiplist";(e.key==="destination"||e.key==="via")&&(fe+=" full-line-chips"),g=g.enter().append("ul").attr("class",fe).on("click",function(){window.setTimeout(function(){v.node().focus()},10)}).merge(g),_=g.selectAll(".input-wrap").data([0]),_=_.enter().append("li").attr("class","input-wrap").merge(_),v=_.selectAll("input").data([0])}else v=g.selectAll("input").data([0]);if(v=v.enter().append("input").attr("type","text").attr("id",e.uid).call(Ri).call(q,ie).merge(v),n){var Re=e.entityExtent,He=Re&&ph(Re.center());M=He&&He.toLowerCase()}v.on("change",de).on("blur",de),v.on("keydown.field",function(Je){switch(Je.keyCode){case 13:v.node().blur(),Je.stopPropagation();break}}),(s||o)&&(m.on("accept",function(){v.node().blur(),v.node().focus()}),v.on("focus",function(){g.classed("active",!0)}))}re.tags=function(ie){A=ie;let oe=e.key,fe=e.keys;if(s||o){b=[];var Re;if(s){for(var He in ie)if(!(oe&&He.indexOf(oe)!==0)&&!(!oe&&fe.indexOf(He)===-1)){var Je=ie[He];if(!(!Je||typeof Je=="string"&&Je.toLowerCase()==="no")){var ot=oe?He.slice(oe.length):He;b.push({key:He,value:Z(ot),isMixed:Array.isArray(Je)})}}oe?(fe=b.map(function(Oe){return Oe.key}),Re=t.maxCharsForTagKey-Sb(oe)):Re=t.maxCharsForTagKey}else if(o){var yt=[],bt;Array.isArray(ie[oe])?(ie[oe].forEach(function(Oe){var De=Ei((Oe||"").split(";")).filter(Boolean);yt=yt.concat(De),bt?bt=bt.filter(rt=>De.includes(rt)):bt=De}),yt=Ei(yt).filter(Boolean)):(yt=Ei((ie[oe]||"").split(";")).filter(Boolean),bt=yt),b=yt.map(function(Oe){return{key:Oe,value:Z(Oe),isMixed:!bt.includes(Oe)}});var at=Sb(bt.join(";"));Re=t.maxCharsForTagValue-at,at>0&&(Re-=1)}Re=Math.max(0,Re);var Te=o&&!Array.isArray(ie[oe]),Ze=W(E,b);m.data(Ze);var xt=!c&&!Ze.length||Re<=0;g.selectAll(".chiplist .input-wrap").style("display",xt?"none":null);var It=g.selectAll(".chip").data(b);It.exit().remove();var Bt=It.enter().insert("li",".input-wrap").attr("class","chip");Bt.append("span"),Bt.append("a"),It=It.merge(Bt).order().classed("raw-value",function(Oe){var De=Oe.key;return s&&(De=De.replace(oe,"")),!e.hasTextForStringID("options."+De)}).classed("draggable",Te).classed("mixed",function(Oe){return Oe.isMixed}).attr("title",function(Oe){return Oe.isMixed?t.t("inspector.unshared_value_tooltip"):null}),Te&&te(It),It.select("span").html(Oe=>Oe.value),e.key==="source"&&ne()||It.select("a").attr("href","#").on("click",ee).attr("class","remove").text("\xD7")}else{var Mi=Array.isArray(ie[oe]),je=Mi&&ie[oe].map(function(Oe){return Z(Oe)}).filter(Boolean),be=!Mi&&ie[oe]&&!(e.type==="typeCombo"&&ie[oe]==="yes"),ge=be&&!e.hasTextForStringID("options."+ie[oe]),xe=be&&!ge,Me=!c||xe;si(v,Mi?"":Z(ie[oe])).classed("raw-value",ge).classed("known-value",xe).attr("readonly",Me?"readonly":void 0).attr("title",Mi?je.join(`
`):void 0).attr("placeholder",Mi?t.t("inspector.multiple_values"):k||"").classed("mixed",Mi).on("keydown.deleteCapture",function(Oe){if(Me&&xe&&(Oe.keyCode===$i.keyCodes["\u232B"]||Oe.keyCode===$i.keyCodes["\u2326"])){Oe.preventDefault(),Oe.stopPropagation();var De={};De[oe]=void 0,i.call("change",this,De)}})}};function te(ie){let oe=e.key;var fe,Re;ie.call(F3().on("start",function(He){fe={x:He.x,y:He.y},Re=null}).on("drag",function(He){var Je=He.x-fe.x,ot=He.y-fe.y;if(!(!ye(this).classed("dragging")&&Math.sqrt(Math.pow(Je,2)+Math.pow(ot,2))<=5)){var yt=ie.nodes().indexOf(this);ye(this).classed("dragging",!0),Re=null;var bt=null,at=ye(this).node().offsetWidth;oe==="destination"||oe==="via"?g.selectAll(".chip").style("transform",function(Te,Ze){var xt=ye(this).node();return yt===Ze?"translate("+Je+"px, "+ot+"px)":Ze>yt&&He.y>xt.offsetTop?((Re===null||Ze>Re)&&(Re=Ze),"translateY(-100%)"):Ze<yt&&He.y<xt.offsetTop+xt.offsetHeight?((Re===null||Ze<Re)&&(Re=Ze),"translateY(100%)"):null}):g.selectAll(".chip").each(function(Te,Ze){var xt=ye(this).node();yt!==Ze&&He.x<xt.offsetLeft+xt.offsetWidth+5&&He.x>xt.offsetLeft&&He.y<xt.offsetTop+xt.offsetHeight&&He.y>xt.offsetTop&&(Re=Ze,bt=xt.offsetTop)}).style("transform",function(Te,Ze){var xt=ye(this).node();if(yt===Ze)return"translate("+Je+"px, "+ot+"px)";if(xt.offsetTop===bt){if(Ze<yt&&Ze>=Re)return"translateX("+at+"px)";if(Ze>yt&&Ze<=Re)return"translateX(-"+at+"px)"}return null})}}).on("end",function(){if(ye(this).classed("dragging")){var He=ie.nodes().indexOf(this);if(ye(this).classed("dragging",!1),g.selectAll(".chip").style("transform",null),typeof Re=="number"){var Je=b[He];b.splice(He,1),b.splice(Re,0,Je);var ot={};b.length?ot[oe]=b.map(function(yt){return yt.key}).join(";"):ot[oe]=void 0,i.call("change",this,ot)}fe=void 0,Re=void 0}}))}return re.focus=function(){v.node().focus()},re.entityIDs=function(ie){return arguments.length?(T=ie||[],re):T},$t(re,i,"on")}function ka(t,e){let i=t.systems.l10n,r=Pt("change"),s=ye(null),n=ye(null),o=[],a,l={};e.type==="tel"&&t.systems.data.getDataAsync("phone_formats").then(b=>{l=b,m()}).catch(b=>console.error(b));function c(){let b=["brand","network","operator","flag"].includes(e.id)&&o.length&&o.some(T=>{let A=t.graph().hasEntity(T);if(!A)return!1;if(A.tags.wikidata)return!0;let M=t.systems.presets.match(A,t.graph()),k=M==null?void 0:M.suggestion,F=e.id;return k&&!!A.tags[F]&&!!A.tags[F+":wikidata"]});e.locked(b)}function d(E){var M;let b=e.presetField;c();let T=e.locked(),A=E.selectAll(".form-field-input-wrap").data([0]);if(A=A.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(A),s=A.selectAll("input").data([0]),s=s.enter().append("input").attr("type",e.type==="identifier"||e.type==="roadheight"?"text":e.type).attr("id",e.uid).classed(e.type,!0).call(Ri).merge(s),s.classed("disabled",!!T).attr("readonly",T||null).on("input",v(!0)).on("blur",v()).on("change",v()),e.type==="tel")m();else if(e.type==="number"){s.attr("type","text");let k=(M=b.increment)!=null?M:1,F=A.selectAll(".increment, .decrement").data(i.isRTL()?[k,-k]:[-k,k]);F.enter().append("button").attr("class",function(O){return`form-field-button ${O>0?"increment":"decrement"}`}).merge(F).on("click",function(O,B){O.preventDefault();let z=(s.node().value||"0").split(";");z=z.map(Z=>{let W=parseFloat(Z.trim(),10);return isFinite(W)?_(W+B):Z.trim()}),s.node().value=z.join(";"),v()()})}else e.type==="identifier"&&b.urlFormat&&b.pattern?(s.attr("type","text"),n=A.selectAll(".foreign-id-permalink").data([0]),n.enter().append("button").call(Ye("#rapid-icon-out-link")).attr("class","form-field-button foreign-id-permalink").attr("title",function(){let k=/^https?:\/\/(.{1,}?)\//.exec(b.urlFormat);if(k.length>=2&&k[1]){let F=k[1];return i.t("icons.view_on",{domain:F})}return""}).on("click",function(k){k.preventDefault();let F=g();if(F){let O=b.urlFormat.replace(/{value}/,encodeURIComponent(F));window.open(O,"_blank")}}).merge(n)):e.type==="url"&&(s.attr("type","text"),n=A.selectAll(".foreign-id-permalink").data([0]),n.enter().append("button").call(Ye("#rapid-icon-out-link")).attr("class","form-field-button foreign-id-permalink").attr("title",()=>i.t("icons.visit_website")).on("click",function(k){k.preventDefault();let F=g();F&&window.open(F,"_blank")}).merge(n))}function m(){if(s.empty()||!Object.keys(l).length)return;let E=e.entityExtent,b=E&&ph(E.center()),T=b&&l[b.toLowerCase()];T&&s.attr("placeholder",T)}function g(){let E=e.presetField.pattern,b=si(s).trim().split(";")[0];return e.type==="url"&&b?b:e.type==="identifier"&&E?b&&b.match(new RegExp(E)):null}function _(E){let b=e.presetField;return b.minValue!==void 0&&(E=Math.max(E,b.minValue)),b.maxValue!==void 0&&(E=Math.min(E,b.maxValue)),E}function v(E){return function(){let b=e.key,T={},A=si(s);if(E||(A=t.cleanTagValue(A)),!(!A&&Array.isArray(a[b]))){if(!E){if(e.type==="number"&&A){let M=A.split(";");M=M.map(k=>{let F=parseFloat(k.trim(),10);return isFinite(F)?_(F):k.trim()}),A=M.join(";")}si(s,A)}T[b]=A||void 0,r.call("change",this,T,E)}}}return d.entityIDs=function(E){return arguments.length?(o=E,d):o},d.tags=function(E){a=E;let b=e.key,T=Array.isArray(E[b]);if(si(s,!T&&E[b]?E[b]:"").attr("title",T?E[b].filter(Boolean).join(`
`):void 0).attr("placeholder",T?i.t("inspector.multiple_values"):e.placeholder||i.t("inspector.unknown")).classed("mixed",T),n&&!n.empty()){let A=!g();n.classed("disabled",A)}},d.focus=function(){let E=s.node();E&&E.focus()},$t(d,r,"on")}function ES(t,e){let i=Pt("change"),r=ye(null),s;function n(l){let c=l.selectAll(".form-field-input-wrap").data([0]);c=c.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(c);let d=c.selectAll("ul").data([0]);d=d.enter().append("ul").attr("class","rows").merge(d),r=d.selectAll("li").data(e.keys);let m=r.enter().append("li").attr("class",g=>`labeled-input preset-access-${g}`);m.append("span").attr("class","label preset-label-access").attr("for",g=>`preset-input-access-${g}`).html(g=>e.tHtml(`types.${g}`)),m.append("div").attr("class","preset-input-access-wrap").append("input").attr("type","text").attr("class",g=>`preset-input-access preset-input-access-${g}`).call(Ri).each((g,_,v)=>{ye(v[_]).call(xr(t,`access-${g}`).data(n.options(g)))}),r=r.merge(m),c.selectAll(".preset-input-access").on("change",o).on("blur",o)}function o(l,c){let d={},m=t.cleanTagValue(si(ye(this)));!m&&typeof s[c]!="string"||(d[c]=m||void 0,i.call("change",this,d))}n.options=function(l){let c=["no","permissive","private","permit","destination"];return l!=="access"&&(c.unshift("yes"),c.push("designated"),l==="bicycle"&&c.push("dismount")),c.map(d=>({title:e.t(`options.${d}.description`),value:d}))};let a={footway:{foot:"designated",motor_vehicle:"no"},steps:{foot:"yes",motor_vehicle:"no",bicycle:"no",horse:"no"},pedestrian:{foot:"yes",motor_vehicle:"no"},cycleway:{motor_vehicle:"no",bicycle:"designated"},bridleway:{motor_vehicle:"no",horse:"designated"},path:{foot:"yes",motor_vehicle:"no",bicycle:"yes",horse:"yes"},motorway:{foot:"no",motor_vehicle:"yes",bicycle:"no",horse:"no"},trunk:{motor_vehicle:"yes"},primary:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},secondary:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},tertiary:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},residential:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},unclassified:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},service:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},motorway_link:{foot:"no",motor_vehicle:"yes",bicycle:"no",horse:"no"},trunk_link:{motor_vehicle:"yes"},primary_link:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},secondary_link:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},tertiary_link:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"}};return n.tags=function(l){s=l,si(r.selectAll(".preset-input-access"),c=>typeof l[c]=="string"?l[c]:"").classed("mixed",c=>l[c]&&Array.isArray(l[c])).attr("title",c=>l[c]&&Array.isArray(l[c])&&l[c].filter(Boolean).join(`
`)).attr("placeholder",c=>{if(l[c]&&Array.isArray(l[c]))return t.t("inspector.multiple_values");if(c==="access")return"yes";if(l.access&&typeof l.access=="string")return l.access;if(l.highway)if(typeof l.highway=="string"){if(a[l.highway]&&a[l.highway][c])return a[l.highway][c]}else{let d=l.highway.filter(Boolean).map(m=>a[m]&&a[m][c]).filter(Boolean);if(d.length===l.highway.length&&new Set(d).size===1)return d[0]}return e.placeholder})},n.focus=function(){r.selectAll(".preset-input-access").node().focus()},$t(n,i,"on")}function TS(t,e){let i=Pt("change"),r=ye(null),s=ye(null),n=[],o,a,l=[{format:[["housenumber","street"],["city","postcode"]]}];t.systems.data.getDataAsync("address_formats").then(A=>{l=A,r.empty()||r.call(v)}).catch(A=>console.error(A));function d(){let A=e.entityExtent.center(),M=new mt(A).padByMeters(200),k=t.systems.edits.intersects(M).filter(F).map(O=>{let B=t.projection.project(A),U=js(t.graph().childNodes(O),B,t.projection);return{title:O.tags.name,value:O.tags.name,dist:U.distance}}).sort((O,B)=>O.dist-B.dist);return ff(k,"value");function F(O){return O.tags.highway&&O.tags.name&&O.type==="way"}}function m(){let A=e.entityExtent.center(),M=new mt(A).padByMeters(200),k=t.systems.edits.intersects(M).filter(F).map(O=>({title:O.tags["addr:city"]||O.tags.name,value:O.tags["addr:city"]||O.tags.name,dist:mr(O.extent(t.graph()).center(),A)})).sort((O,B)=>O.dist-B.dist);return ff(k,"value");function F(O){return!!(O.tags.name&&(O.tags.admin_level==="8"&&O.tags.boundary==="administrative"||O.tags.border_type==="city"||O.tags.place==="city"||O.tags.place==="town"||O.tags.place==="village")||O.tags["addr:city"])}}function g(A){let M=e.entityExtent.center(),k=new mt(M).padByMeters(200),F=t.systems.edits.intersects(k).filter(O).map(B=>({title:B.tags[A],value:B.tags[A],dist:mr(B.extent(t.graph()).center(),M)})).sort((B,U)=>B.dist-U.dist);return ff(F,"value");function O(B){return!n.includes(B.id)&&B.tags[A]}}function _(){if(!a)return;let A;for(let U=0;U<l.length;U++){let z=l[U];if(!z.countryCodes)A=z;else if(z.countryCodes.includes(a)){A=z;break}}let M=A.dropdowns||["city","county","country","district","hamlet","neighbourhood","place","postcode","province","quarter","state","street","subdistrict","suburb"],k=A.widths||{housenumber:1/3,street:2/3,city:2/3,state:1/4,postcode:1/3};function F(U){let z=U.reduce((Z,W)=>Z+(k[W]||.5),0);return U.map(Z=>({id:Z,width:(k[Z]||.5)/z}))}let O=s.selectAll(".addr-row").data(A.format,U=>U.toString());O.exit().remove(),O.enter().append("div").attr("class","addr-row").selectAll("input").data(F).enter().append("input").property("type","text").call(b).attr("class",U=>`addr-${U.id}`).call(Ri).each(B).style("width",U=>U.width*100+"%");function B(U){if(!M.includes(U.id))return;let z=U.id==="street"?d:U.id==="city"?m:g;ye(this).call(xr(t,`address-${U.id}`).minItems(1).caseSensitive(!0).fetcher(function(Z,W){W(z(`addr:${U.id}`))}))}s.selectAll("input").on("blur",E()).on("change",E()),s.selectAll("input:not(.combobox-input)").on("input",E(!0)),o&&T(o)}function v(A){r=A,s=A.selectAll(".form-field-input-wrap").data([0]),s=s.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(s);let M=e.entityExtent.center(),k;t.inIntro?k=t.t("intro.graph.countrycode"):k=ph(M),k&&(a=k.toLowerCase(),_())}function E(A){return function(){let M={};s.selectAll("input").each((k,F,O)=>{let B=O[F],U=e.key+":"+k.id,z=A?B.value:t.cleanTagValue(B.value);Array.isArray(o[U])&&!z||(M[U]=z||void 0)}),i.call("change",this,M,A)}}function b(A){return A.attr("placeholder",function(M){let k=e.key+":"+M.id;if(o&&Array.isArray(o[k]))return t.t("inspector.multiple_values");if(a){let F=M.id+"!"+a,O=e.hasTextForStringID("placeholders."+F)?F:M.id;return e.presetField.t(`placeholders.${O}`)}})}function T(A){si(s.selectAll("input"),function(M){let k=e.key+":"+M.id,F=A[k];return typeof F=="string"?F:""}).attr("title",M=>{let k=e.key+":"+M.id,F=A[k];return F&&Array.isArray(F)&&F.filter(Boolean).join(`
`)}).classed("mixed",M=>{let k=e.key+":"+M.id;return Array.isArray(A[k])}).call(b)}return v.entityIDs=function(A){return arguments.length?(n=A,v):n},v.tags=function(A){o=A,T(A)},v.focus=function(){let A=s.selectAll("input").node();A&&A.focus()},$t(v,i,"on")}function SS(t,e){var i=Pt("change"),r=ye(null),s=ye(null),n;function o(l){function c(_){return _.replace(":","")}s=l.selectAll(".form-field-input-wrap").data([0]),s=s.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(s);var d=s.selectAll("ul").data([0]);d=d.enter().append("ul").attr("class","rows").merge(d);var m=["cycleway:left","cycleway:right"];r=d.selectAll("li").data(m);var g=r.enter().append("li").attr("class",function(_){return"labeled-input preset-cycleway-"+c(_)});g.append("span").attr("class","label preset-label-cycleway").attr("for",function(_){return"preset-input-cycleway-"+c(_)}).html(function(_){return e.tHtml("types."+_)}),g.append("div").attr("class","preset-input-cycleway-wrap").append("input").attr("type","text").attr("class",function(_){return"preset-input-cycleway preset-input-"+c(_)}).call(Ri).each(function(_){ye(this).call(xr(t,"cycleway-"+c(_)).data(o.options(_)))}),r=r.merge(g),s.selectAll(".preset-input-cycleway").on("change",a).on("blur",a)}function a(l,c){var d=t.cleanTagValue(si(ye(this)));if(!(!d&&(Array.isArray(n.cycleway)||Array.isArray(n[c])))){(d==="none"||d==="")&&(d=void 0);var m=c==="cycleway:left"?"cycleway:right":"cycleway:left",g=typeof n.cycleway=="string"?n.cycleway:n[m];g&&Array.isArray(g)&&(g=g[0]),(g==="none"||g==="")&&(g=void 0);var _={};d===g?_={cycleway:d,"cycleway:left":void 0,"cycleway:right":void 0}:(_={cycleway:void 0},_[c]=d,_[m]=g),i.call("change",this,_)}}return o.options=function(){return e.presetField.options.map(function(l){return{title:e.t(`options.${l}.description`),value:l}})},o.tags=function(l){n=l;var c=typeof l.cycleway=="string"&&l.cycleway;si(r.selectAll(".preset-input-cycleway"),function(d){return c||(!l.cycleway&&typeof l[d]=="string"?l[d]:"")}).attr("title",function(d){if(Array.isArray(l.cycleway)||Array.isArray(l[d])){var m=[];return Array.isArray(l.cycleway)&&(m=m.concat(l.cycleway)),Array.isArray(l[d])&&(m=m.concat(l[d])),m.filter(Boolean).join(`
`)}return null}).attr("placeholder",function(d){return Array.isArray(l.cycleway)||Array.isArray(l[d])?t.t("inspector.multiple_values"):e.placeholder}).classed("mixed",function(d){return Array.isArray(l.cycleway)||Array.isArray(l[d])})},o.focus=function(){var l=s.selectAll("input").node();l&&l.focus()},$t(o,i,"on")}function __(t,e){var i=Pt("change"),r=40,s=200,n=[];function o(a){var l=t.entity(n[0]).lanes();if(!t.container().select(".inspector-wrap.inspector-hidden").empty()||!a.node().parentNode){a.call(o.off);return}var c=a.selectAll(".form-field-input-wrap").data([0]);c=c.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(c);var d=c.selectAll(".surface").data([0]),m=pc(c),g=m[0]-l.lanes.length*r*1.5+r*.5;d=d.enter().append("svg").attr("width",m[0]).attr("height",300).attr("class","surface").merge(d);var _=d.selectAll(".lanes").data([0]);_=_.enter().append("g").attr("class","lanes").merge(_),_.attr("transform",function(){return"translate("+g/2+", 0)"});var v=_.selectAll(".lane").data(l.lanes);v.exit().remove();var E=v.enter().append("g").attr("class","lane");E.append("g").append("rect").attr("y",50).attr("width",r).attr("height",s),E.append("g").attr("class","forward").append("text").attr("y",40).attr("x",14).html("\u25B2"),E.append("g").attr("class","bothways").append("text").attr("y",40).attr("x",14).html("\u25B2\u25BC"),E.append("g").attr("class","backward").append("text").attr("y",40).attr("x",14).html("\u25BC"),v=v.merge(E),v.attr("transform",function(b){return"translate("+r*b.index*1.5+", 0)"}),v.select(".forward").style("visibility",function(b){return b.direction==="forward"?"visible":"hidden"}),v.select(".bothways").style("visibility",function(b){return b.direction==="bothways"?"visible":"hidden"}),v.select(".backward").style("visibility",function(b){return b.direction==="backward"?"visible":"hidden"})}return o.entityIDs=function(a){n=a},o.tags=function(){},o.focus=function(){},o.off=function(){},$t(o,i,"on")}__.supportsMultiselection=!1;var xQ=0;function x_(t,e){var i=xQ++,r=ye(null),s=function(A){r=A,A.each(g)},n=ss(!1),o=ss("top"),a=ss("center"),l=ss(ye(null)),c,d=ss(""),m=ss(!0);s.displayType=function(A){return arguments.length?(d=ss(A),s):d},s.hasArrow=function(A){return arguments.length?(m=ss(A),s):m},s.placement=function(A){return arguments.length?(o=ss(A),s):o},s.alignment=function(A){return arguments.length?(a=ss(A),s):a},s.scrollContainer=function(A){return arguments.length?(l=ss(A),s):l},s.content=function(A){return arguments.length?(c=A,s):c},s.isShown=function(){var A=r.select(".popover-"+i);return!A.empty()&&A.classed("in")},s.show=function(){r.each(_)},s.updateContent=function(){r.each(v)},s.hide=function(){r.each(b)},s.toggle=function(){r.each(T)},s.destroy=function(A,M){M=M||".popover-"+i,A.on("pointerenter.popover",null).on("pointerleave.popover",null).on("pointerup.popover",null).on("pointerdown.popover",null).on("click.popover",null).attr("title",function(){return this.getAttribute("data-original-title")||this.getAttribute("title")}).attr("data-original-title",null).selectAll(M).remove()},s.destroyAny=function(A){A.call(s.destroy,".popover")};function g(){var A=ye(this),M=n.apply(this,arguments),k=A.selectAll(".popover-"+i).data([0]),F=k.enter().append("div").attr("class","popover popover-"+i+" "+(e||"")).classed("arrowed",m.apply(this,arguments));F.append("div").attr("class","popover-arrow"),F.append("div").attr("class","popover-inner"),k=F.merge(k),M&&k.classed("fade",!0);var O=d.apply(this,arguments);if(O==="hover"){var B;A.on("pointerenter.popover",function(U){if(U.pointerType){if(U.pointerType!=="mouse"){B=U.timeStamp;return}else if(B&&U.timeStamp-B<1500)return}U.buttons===0&&_.apply(this,arguments)}).on("pointerleave.popover",function(){b.apply(this,arguments)}).on("focus.popover",function(){_.apply(this,arguments)}).on("blur.popover",function(){b.apply(this,arguments)})}else O==="clickFocus"&&(A.on("pointerdown.popover",function(U){U.preventDefault(),U.stopPropagation()}).on("pointerup.popover",function(U){U.preventDefault(),U.stopPropagation()}).on("click.popover",T),k.attr("tabindex",0).on("blur.popover",function(){A.each(function(){b.apply(this,arguments)})}))}function _(){var A=ye(this),M=A.selectAll(".popover-"+i);M.empty()&&(A.call(s.destroy),A.each(g),M=A.selectAll(".popover-"+i)),M.classed("in",!0);var k=d.apply(this,arguments);k==="clickFocus"&&(A.classed("active",!0),M.node().focus()),A.each(v)}function v(){var A=ye(this);c&&A.selectAll(".popover-"+i+" > .popover-inner").call(c.apply(this,arguments)),E.apply(this,arguments),E.apply(this,arguments),E.apply(this,arguments)}function E(){var A=ye(this),M=A.selectAll(".popover-"+i),k=l&&l.apply(this,arguments),F=k&&!k.empty()&&k.node(),O=F?F.scrollLeft:0,B=F?F.scrollTop:0,U=o.apply(this,arguments);M.classed("left",!1).classed("right",!1).classed("top",!1).classed("bottom",!1).classed(U,!0);var z=a.apply(this,arguments),Z=.5;z==="leading"?Z=0:z==="trailing"&&(Z=1);var W=ne(A.node()),q=ne(M.node()),Q;switch(U){case"top":Q={x:W.x+(W.w-q.w)*Z,y:W.y-q.h};break;case"bottom":Q={x:W.x+(W.w-q.w)*Z,y:W.y+W.h};break;case"left":Q={x:W.x-q.w,y:W.y+(W.h-q.h)*Z};break;case"right":Q={x:W.x+W.w,y:W.y+(W.h-q.h)*Z};break}if(Q){if(F&&(U==="top"||U==="bottom")){var V=Q.x;Q.x+q.w>F.offsetWidth-10?Q.x=F.offsetWidth-10-q.w:Q.x<10&&(Q.x=10);var le=A.selectAll(".popover-"+i+" > .popover-arrow"),de=Math.min(Math.max(q.w/2-(Q.x-V),10),q.w-10);le.style("left",~~de+"px")}M.style("left",~~Q.x+"px").style("top",~~Q.y+"px")}else M.style("left",null).style("top",null);function ne(ee){var re=ye(ee).style("position");return re==="absolute"||re==="static"?{x:ee.offsetLeft-O,y:ee.offsetTop-B,w:ee.offsetWidth,h:ee.offsetHeight}:{x:0,y:0,w:ee.offsetWidth,h:ee.offsetHeight}}}function b(){var A=ye(this);d.apply(this,arguments)==="clickFocus"&&A.classed("active",!1),A.selectAll(".popover-"+i).classed("in",!1)}function T(){ye(this).select(".popover-"+i).classed("in")?b.apply(this,arguments):_.apply(this,arguments)}return s}function Ft(t){var e=x_(t,"tooltip").displayType("hover"),i=function(){var n=this.getAttribute("data-original-title");return n||(n=this.getAttribute("title"),this.removeAttribute("title"),this.setAttribute("data-original-title",n),n)},r=ss(null),s=ss(null);return e.title=function(n){return arguments.length?(i=ss(n),e):i},e.heading=function(n){return arguments.length?(r=ss(n),e):r},e.keys=function(n){return arguments.length?(s=ss(n),e):s},e.content(function(){var n=r.apply(this,arguments),o=i.apply(this,arguments),a=s.apply(this,arguments);return function(l){var c=l.selectAll(".tooltip-heading").data(n?[n]:[]);c.exit().remove(),c.enter().append("div").attr("class","tooltip-heading").merge(c).html(n);var d=l.selectAll(".tooltip-text").data(o?[o]:[]);d.exit().remove(),d.enter().append("div").attr("class","tooltip-text").merge(d).html(o);var m=l.selectAll(".keyhint-wrap").data(a&&a.length?[0]:[]);m.exit().remove();var g=m.enter().append("div").attr("class","keyhint-wrap");g.append("span").html(t.tHtml("tooltip_keyhint")),m=g.merge(m),m.selectAll("kbd.shortcut").data(a&&a.length?a:[]).enter().append("kbd").attr("class","shortcut").html(_=>_)}}),e}var z4=[];function AS(t,e){let i=t.systems.data,r=t.systems.l10n;var s=Pt("change","input"),n=t.services.wikipedia,o=ye(null),a=ye(null),l,c;i.getDataAsync("languages").then(T).catch(W=>console.error(W));var d={};i.getDataAsync("territory_languages").then(function(W){d=W}).catch(W=>console.error(W));var m=xr(t,"localized-lang").fetcher(U).minItems(0),g=ye(null),_=[],v=Ft(t).title(r.tHtml("translate.translate")).placement("left"),E,b=[];function T(W){if(z4.length===0){var q={sr:"sr-Cyrl","sr-Cyrl":!1};for(var Q in W)if(q[Q]!==!1){var V=Q;q[Q]&&(V=q[Q]),z4.push({localName:r.languageName(V,{localOnly:!0}),nativeName:W[V].nativeName,code:Q,label:r.languageName(V)})}}}function A(){var W=e.id==="name"&&b.length&&b.some(function(q){var Q=t.graph().hasEntity(q);if(!Q)return!1;if(Q.tags.wikidata||Q.tags["name:etymology:wikidata"])return!0;var V=t.systems.presets.match(Q,t.graph());if(V){var le=V.suggestion,de=V.fields(),ne=de.some(function(oe){return oe.id==="brand"}),ee=de.some(function(oe){return oe.id==="operator"}),re=V.addTags.name,te=V.addTags["brand:wikidata"],ie=V.addTags["operator:wikidata"];return le&&re&&(te&&!ne||ie&&!ee)}return!1});e.locked(W)}function M(W){var q=_.map(function(ne){return ne.lang}),Q=new Set(q.filter(Boolean));for(var V in W){var le=V.match(/^(.*):([a-z]{2,3}(?:-[A-Z][a-z]{3})?(?:-[A-Z]{2})?)$/);if(le&&le[1]===e.key&&le[2]){var de={lang:le[2],value:W[V]};Q.has(de.lang)?(_[q.indexOf(de.lang)].value=de.value,Q.delete(de.lang)):_.push(de)}}_.forEach(function(ne){ne.lang&&Q.has(ne.lang)&&(ne.value="")})}function k(W){g=W,A();var q=e.locked(),Q=W.selectAll(".form-field-input-wrap").data([0]);Q=Q.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(Q),o=Q.selectAll(".localized-main").data([0]),o=o.enter().append("input").attr("type","text").attr("id",e.uid).attr("class","localized-main").call(Ri).merge(o),o.classed("disabled",!!q).attr("readonly",q||null).on("input",de(!0)).on("blur",de()).on("change",de());var V=Q.selectAll(".localized-add").data([0]);V=V.enter().append("button").attr("class","localized-add form-field-button").call(Ye("#rapid-icon-plus")).merge(V),V.classed("disabled",!!q).call(q?v.destroy:v).on("click",le),c&&!_.length&&M(c),a=W.selectAll(".localized-multilingual").data([0]),a=a.enter().append("div").attr("class","localized-multilingual").merge(a),a.call(z),a.selectAll("button, input").classed("disabled",!!q).attr("readonly",q||null);function le(ne){if(ne.preventDefault(),!e.locked()){var ee=r.languageCode().toLowerCase(),re=_.find(function(ie){return ie.lang===ee}),te=ee.indexOf("en")>-1;(te||re)&&(ee="",re=_.find(function(ie){return ie.lang===ee})),re||(_.unshift({lang:ee,value:""}),a.call(z))}}function de(ne){return function(ee){if(e.locked()){ee.preventDefault();return}var re=si(ye(this));if(ne||(re=t.cleanTagValue(re)),!(!re&&Array.isArray(c[e.key]))){var te={};te[e.key]=re||void 0,s.call("change",this,te,ne)}}}}function F(W){return e.key+":"+W}function O(W,q){var Q={},V=si(ye(this)).toLowerCase(),le=z4.find(function(ee){return ee.label.toLowerCase()===V||ee.localName&&ee.localName.toLowerCase()===V||ee.nativeName&&ee.nativeName.toLowerCase()===V});le&&(V=le.code),q.lang&&q.lang!==V&&(Q[F(q.lang)]=void 0);var de=V&&t.cleanTagKey(F(V)),ne=si(ye(this.parentNode).selectAll(".localized-value"));de&&ne?Q[de]=ne:de&&E&&E[q.lang]&&(Q[de]=E[q.lang]),q.lang=V,s.call("change",this,Q)}function B(W,q){if(q.lang){var Q=t.cleanTagValue(si(ye(this)))||void 0;if(!(!Q&&Array.isArray(q.value))){var V={};V[F(q.lang)]=Q,q.value=Q,s.call("change",this,V)}}}function U(W,q){var Q=W.toLowerCase(),V=[r.localeCode(),r.languageCode()];l&&d[l]&&(V=V.concat(d[l]));var le=[];V.forEach(function(de){var ne=z4.find(function(ee){return ee.code===de});ne&&le.push(ne)}),le=Ei(le.concat(z4)),q(le.filter(function(de){return de.label.toLowerCase().indexOf(Q)>=0||de.localName&&de.localName.toLowerCase().indexOf(Q)>=0||de.nativeName&&de.nativeName.toLowerCase().indexOf(Q)>=0||de.code.toLowerCase().indexOf(Q)>=0}).map(function(de){return{value:de.label}}))}function z(W){var q=W.selectAll("div.entry").data(_,function(V){return V.lang});q.exit().style("top","0").style("max-height","240px").transition().duration(200).style("opacity","0").style("max-height","0px").remove();var Q=q.enter().append("div").attr("class","entry").each(function(V,le){var de=ye(this),ne=fl(le),ee=de.append("label").attr("class","field-label").attr("for",ne),re=ee.append("span").attr("class","label-text");re.append("span").attr("class","label-textvalue").html(r.tHtml("translate.localized_translation_label")),re.append("span").attr("class","label-textannotation"),ee.append("button").attr("class","remove-icon-multilingual").on("click",function(te,ie){if(!e.locked()){te.preventDefault(),_.splice(_.indexOf(ie),1);var oe=ie.lang&&F(ie.lang);if(oe&&oe in c){delete c[oe];var fe={};fe[oe]=void 0,s.call("change",this,fe);return}z(W)}}).call(Ye("#rapid-operation-delete")),de.append("input").attr("class","localized-lang").attr("id",ne).attr("type","text").attr("placeholder",r.t("translate.localized_translation_language")).on("blur",O).on("change",O).call(m),de.append("input").attr("type","text").attr("class","localized-value").on("blur",B).on("change",B)});Q.style("margin-top","0px").style("max-height","0px").style("opacity","0").transition().duration(200).style("margin-top","10px").style("max-height","240px").style("opacity","1").on("end",function(){ye(this).style("max-height","").style("overflow","visible")}),q=q.merge(Q),q.order(),q.classed("present",!0),si(q.select(".localized-lang"),function(V){var le=z4.find(function(de){return de.code===V.lang});return le?le.label:V.lang}),si(q.select(".localized-value"),function(V){return typeof V.value=="string"?V.value:""}).attr("title",function(V){return Array.isArray(V.value)?V.value.filter(Boolean).join(`
`):null}).attr("placeholder",function(V){return Array.isArray(V.value)?r.t("inspector.multiple_values"):r.t("translate.localized_translation_name")}).classed("mixed",function(V){return Array.isArray(V.value)})}k.tags=function(W){if(c=W,typeof W.wikipedia=="string"&&!E){E={};var q=W.wikipedia.match(/([^:]+):(.+)/);q&&q[0]&&q[1]&&n.translations(q[1],q[2],function(V,le){V||!le||(E=le)})}var Q=Array.isArray(W[e.key]);si(o,typeof W[e.key]=="string"?W[e.key]:"").attr("title",Q?W[e.key].filter(Boolean).join(`
`):void 0).attr("placeholder",Q?r.t("inspector.multiple_values"):e.placeholder).classed("mixed",Q),M(W),g.call(k)},k.focus=function(){o.node().focus()},k.entityIDs=function(W){return arguments.length?(b=W,_=[],Z(),k):b};function Z(){var W=e.entityExtent,q=W&&ph(W.center());l=q&&q.toLowerCase()}return $t(k,s,"on")}function CS(t,e){var i=Pt("change"),r=ye(null),s=ye(null),n,o,a=xr(t,"roadspeed"),l=xr(t,"roadspeed-unit").data(["km/h","mph"].map(_)),c=[20,30,40,50,60,70,80,90,100,110,120],d=[5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80];function m(E){var b=E.selectAll(".form-field-input-wrap").data([0]);b=b.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(b),s=b.selectAll("input.roadspeed-number").data([0]),s=s.enter().append("input").attr("type","text").attr("class","roadspeed-number").attr("id",e.uid).call(Ri).call(a).merge(s),s.on("change",v).on("blur",v);var T=e.entityExtent.center();o=PF(T)==="mph",r=b.selectAll("input.roadspeed-unit").data([0]),r=r.enter().append("input").attr("type","text").attr("class","roadspeed-unit").call(l).merge(r),r.on("blur",A).on("change",A);function A(){o=si(r)==="mph",si(r,o?"mph":"km/h"),g(),v()}}function g(){a.data((o?d:c).map(_)),si(r,o?"mph":"km/h")}function _(E){return{value:E.toString(),title:E.toString()}}function v(){var E={},b=si(s).trim();let T=e.key;!b&&Array.isArray(n[T])||(b?isNaN(b)||!o?E[T]=t.cleanTagValue(b):E[T]=t.cleanTagValue(b+" mph"):E[T]=void 0,i.call("change",this,E))}return m.tags=function(E){n=E;let b=e.key;var T=E[b],A=Array.isArray(T);A||(T&&T.indexOf("mph")>=0?(T=parseInt(T,10).toString(),o=!0):T&&(o=!1)),g(),si(s,typeof T=="string"?T:"").attr("title",A?T.filter(Boolean).join(`
`):null).attr("placeholder",A?t.t("inspector.multiple_values"):e.placeholder).classed("mixed",A)},m.focus=function(){s.node().focus()},$t(m,i,"on")}function iu(t,e){let i=t.systems.l10n,r=t.services[e.qid?"wikidata":"osmwikibase"],s={},n=ye(null),o=ye(null),a,l;function c(){r&&(n.classed("tag-reference-loading",!0),r.getDocs(e,d))}function d(_,v){if(o.html(""),!v||!v.title){o.append("p").attr("class","tag-reference-description").html(i.tHtml("inspector.no_documentation_key")),m();return}v.imageURL?o.append("img").attr("class","tag-reference-wiki-image").attr("src",v.imageURL).on("load",()=>m()).on("error",function(){ye(this).remove(),m()}):m();let E;v.description?E=i.htmlForLocalizedText(v.description,v.descriptionLocaleCode):E=i.tHtml("inspector.no_documentation_key"),o.append("p").attr("class","tag-reference-description").html(E).append("a").attr("class","tag-reference-edit").attr("target","_blank").attr("title",i.t("inspector.edit_reference")).attr("href",v.editURL).call(Ye("#rapid-icon-edit","inline")),v.wiki&&o.append("a").attr("class","tag-reference-link").attr("target","_blank").attr("href",v.wiki.url).call(Ye("#rapid-icon-out-link","inline")).append("span").html(i.tHtml(v.wiki.text)),e.key==="comment"&&o.append("a").attr("class","tag-reference-comment-link").attr("target","_blank").call(Ye("#rapid-icon-out-link","inline")).attr("href",i.t("commit.about_changeset_comments_link")).append("span").html(i.tHtml("commit.about_changeset_comments"))}function m(){a=!0,n.classed("tag-reference-loading",!1),o.classed("expanded",!0).transition().duration(200).style("max-height","200px").style("opacity","1"),l=!0,n.selectAll("svg.icon use").each((_,v,E)=>{let b=ye(E[v]);b.attr("href")==="#rapid-icon-info"&&b.attr("href","#rapid-icon-info-filled")})}function g(){o.transition().duration(200).style("max-height","0px").style("opacity","0").on("end",()=>{o.classed("expanded",!1)}),l=!1,n.selectAll("svg.icon use").each((_,v,E)=>{let b=ye(E[v]);b.attr("href")==="#rapid-icon-info-filled"&&b.attr("href","#rapid-icon-info")})}return s.button=function(_,v,E){n=_.selectAll(".tag-reference-button").data([0]),n=n.enter().append("button").attr("class","tag-reference-button "+(v||"")).attr("title",i.t("icons.information")).call(Ye("#rapid-icon-"+(E||"inspect"))).merge(n),n.on("click",function(b){b.stopPropagation(),b.preventDefault(),this.blur(),l?g():a?m():c()})},s.body=function(_){let v=e.qid||e.key+"-"+(e.value||"");o=_.selectAll(".tag-reference-body").data([v],E=>E),o.exit().remove(),o=o.enter().append("div").attr("class","tag-reference-body").style("max-height","0").style("opacity","0").merge(o),l===!1&&g()},s.showing=function(_){return arguments.length?(l=_,s):l},s}var Ma=class{constructor(e,i,r=[],s={}){this.context=e,this.presetField=i,this.entityIDs=r,this.options=Object.assign({show:!0,wrap:!0,remove:!0,revert:!0,info:!0},s),this.id=i.id,this.type=i.type,this.title=i.title(),this.label=i.label(),this.terms=i.terms(),this.placeholder=i.placeholder(),this.default=i.default,this.key=i.key,this.keys=i.keys,this.t=i.t,this.tHtml=i.tHtml,this.hasTextForStringID=i.hasTextForStringID,this.uid=fl(`form-field-${i.safeid}`),this._show=this.options.show,this._internal=null,this._state="",this._tags={},this.entityExtent=null,r!=null&&r.length&&(this.entityExtent=kr(r,e.graph())),this._locked=!1,this._lockedTip=Ft(e).title(e.tHtml("inspector.lock.suggestion",{label:this.label})).placement("bottom"),this.dispatch=Pt("change","revert"),$t(this,this.dispatch,"on"),this.isAllowed=this.isAllowed.bind(this),this.isModified=this.isModified.bind(this),this.isShown=this.isShown.bind(this),this.remove=this.remove.bind(this),this.render=this.render.bind(this),this.revert=this.revert.bind(this),this.tagsContainFieldKey=this.tagsContainFieldKey.bind(this),this._show&&this._createField()}_createField(){this._internal||(this._internal=G4[this.type](this.context,this).on("change",(e,i)=>{this.dispatch.call("change",this,e,i)}),typeof this._internal.entityIDs=="function"&&this._internal.entityIDs(this.entityIDs))}isModified(){var e;return(e=this.entityIDs)!=null&&e.length?this.entityIDs.some(i=>{let r=this.context.graph(),s=r.base.entities.get(i),n=r.entity(i);return this.keys.some(o=>s?n.tags[o]!==s.tags[o]:n.tags[o])}):!1}tagsContainFieldKey(){return this.keys.some(e=>{if(this.type==="multiCombo"){for(let i in this._tags)if(i.indexOf(e)===0)return!0;return!1}else return this._tags[e]!==void 0})}revert(e){var i;e.stopPropagation(),e.preventDefault(),!(!((i=this.entityIDs)!=null&&i.length)||this._locked)&&this.dispatch.call("revert",this,this.keys)}remove(e){if(e.stopPropagation(),e.preventDefault(),this._locked)return;let i={};this.keys.forEach(r=>i[r]=void 0),this.dispatch.call("change",this,i)}render(e){let i=this.context.systems.l10n,r=e.selectAll(".form-field").data([this]),s=r.enter().append("div").attr("class",`form-field form-field-${this.safeid}`).classed("nowrap",!this.options.wrap);if(this.options.wrap){let a=s.append("label").attr("class","field-label").attr("for",this.uid),l=a.append("span").attr("class","label-text");l.append("span").attr("class","label-textvalue").html(this.label),l.append("span").attr("class","label-textannotation"),this.options.remove&&a.append("button").attr("class","remove-icon").attr("title",i.t("icons.remove")).call(Ye("#rapid-operation-delete")),this.options.revert&&a.append("button").attr("class","modified-icon").attr("title",i.t("icons.undo")).call(Ye(i.isRTL()?"#rapid-icon-redo":"#rapid-icon-undo"))}r=r.merge(s),r.select(".field-label > .remove-icon").on("click",this.remove),r.select(".field-label > .modified-icon").on("click",this.revert),r.each((a,l,c)=>{let d=ye(c[l]);this._internal||this._createField();let m;if(this.options.wrap&&this.options.info){let g=this.key||"";this.type==="multiCombo"&&(g=g.replace(/:$/,"")),m=iu(this.context,this.reference||{key:g}),this._state==="hover"&&m.showing(!1)}d.call(this._internal),m&&d.call(m.body).select(".field-label").call(m.button),this._internal.tags(this._tags)}),r.classed("locked",this._locked).classed("modified",this.isModified()).classed("present",this.tagsContainFieldKey());let o=r.selectAll(".field-label .label-textannotation").selectAll(".icon").data(this._locked?[0]:[]);o.exit().remove(),o.enter().append("svg").attr("class","icon").append("use").attr("xlink:href","#fas-lock"),r.call(this._locked?this._lockedTip:this._lockedTip.destroy)}state(e){return e===void 0?this._state:(this._state=e,this)}tags(e){return e===void 0?this._tags:(this._tags=e,this.tagsContainFieldKey()&&!this._show&&(this._show=!0,this._internal||this._createField()),this)}locked(e){return e===void 0?this._locked:(this._locked=e,this)}show(){if(this._show=!0,this._internal||this._createField(),this.default&&this.key&&this._tags[this.key]!==this.default){let e={};e[this.key]=this.default,this.dispatch.call("change",this,e)}}isShown(){return this._show}isAllowed(){var n;let e=this.context,i=this.presetField,r=e.systems.locations;if(!((n=this.entityIDs)!=null&&n.length))return!0;if(this.entityIDs.length>1&&G4[this.type].supportsMultiselection===!1||i.geometry&&!this.entityIDs.every(o=>i.matchGeometry(e.graph().geometry(o)))||this.entityExtent&&i.locationSetID&&!r.locationSetsAt(this.entityExtent.center())[i.locationSetID])return!1;let s=i.prerequisiteTag;return!(s&&!this.tagsContainFieldKey()&&!this.entityIDs.every(a=>{let l=e.graph().entity(a);if(s.key){let c=l.tags[s.key];if(!c)return!1;if(s.valueNot)return s.valueNot!==c;if(s.value)return s.value===c}else if(s.keyNot&&l.tags[s.keyNot])return!1;return!0}))}focus(){this._internal&&this._internal.focus()}};function y6(t,e){var i=Pt("change"),r=ye(null),s=ye(null),n=ye(null),o=ye(null),a=(e.presetField.options||e.keys).slice(),l,c,d={},m=[];function g(){var A=s.selectAll(".form-field-input-radio label.active input");return!A.empty()&&A.datum()}function _(A){A.classed("preset-radio",!0),s=A.selectAll(".form-field-input-wrap").data([0]);var M=s.enter().append("div").attr("class","form-field-input-wrap form-field-input-radio");M.append("span").attr("class","placeholder"),s=s.merge(M),r=s.selectAll(".placeholder"),n=s.selectAll("label").data(a),M=n.enter().append("label"),M.append("input").attr("type","radio").attr("name",e.id).attr("value",function(k){return e.t(`options.${k}`,{default:k})}).attr("checked",!1),M.append("span").html(function(k){return e.tHtml(`options.${k}`,{default:k})}),n=n.merge(M),o=n.selectAll("input").on("change",T)}function v(A,M){var k=g()||M.layer!==void 0,F=t.systems.presets,O=F.field(k),B=F.field("layer"),U=k==="bridge"||k==="tunnel"||M.layer!==void 0,z=A.selectAll(".structure-extras-wrap").data(k?[0]:[]);z.exit().remove(),z=z.enter().append("div").attr("class","structure-extras-wrap").merge(z);var Z=z.selectAll("ul").data([0]);Z=Z.enter().append("ul").attr("class","rows").merge(Z),O?((!l||l.id!==k)&&(l=new Ma(t,O,m,{wrap:!1}).on("change",E)),l.tags(M)):l=null;var W=Z.selectAll(".structure-type-item").data(l?[l]:[],function(le){return le.id});W.exit().remove();var q=W.enter().insert("li",":first-child").attr("class","labeled-input structure-type-item");q.append("span").attr("class","label structure-label-type").attr("for","preset-input-"+k).html(t.tHtml("inspector.radio.structure.type")),q.append("div").attr("class","structure-input-type-wrap"),W=W.merge(q),l&&W.selectAll(".structure-input-type-wrap").call(l.render),B&&U?(c||(c=new Ma(t,B,m,{wrap:!1}).on("change",b)),c.tags(M),e.keys=as(e.keys,["layer"])):(c=null,e.keys=e.keys.filter(function(le){return le!=="layer"}));var Q=Z.selectAll(".structure-layer-item").data(c?[c]:[]);Q.exit().remove();var V=Q.enter().append("li").attr("class","labeled-input structure-layer-item");V.append("span").attr("class","label structure-label-layer").attr("for","preset-input-layer").html(t.tHtml("inspector.radio.structure.layer")),V.append("div").attr("class","structure-input-layer-wrap"),Q=Q.merge(V),c&&Q.selectAll(".structure-input-layer-wrap").call(c.render)}function E(A,M){var k=g();if(k){var F=A[k];F!=="no"&&(d[k]=F),e.type==="structureRadio"&&((F==="no"||k!=="bridge"&&k!=="tunnel"||k==="tunnel"&&F==="building_passage")&&(A.layer=void 0),A.layer===void 0&&(k==="bridge"&&F!=="no"&&(A.layer="1"),k==="tunnel"&&F!=="no"&&F!=="building_passage"&&(A.layer="-1"))),i.call("change",this,A,M)}}function b(A,M){A.layer==="0"&&(A.layer=void 0),i.call("change",this,A,M)}function T(){var A={},M;e.key&&(A[e.key]=void 0),o.each(function(k){var F=ye(this).property("checked");if(F&&(M=k),e.key)F&&(A[e.key]=k);else{var O=d[M]||"yes";A[k]=F?O:void 0}}),e.type==="structureRadio"&&(M==="bridge"?A.layer="1":M==="tunnel"&&A.tunnel!=="building_passage"?A.layer="-1":A.layer=void 0),i.call("change",this,A)}return _.tags=function(A){o.property("checked",function(F){return e.key?A[e.key]===F:typeof A[F]=="string"&&A[F].toLowerCase()!=="no"});function M(F){return e.key?Array.isArray(A[e.key])&&A[e.key].includes(F):Array.isArray(A[F])}n.classed("active",function(F){return e.key?Array.isArray(A[e.key])&&A[e.key].includes(F)||A[e.key]===F:Array.isArray(A[F])||!!(A[F]&&A[F].toLowerCase()!=="no")}).classed("mixed",M).attr("title",function(F){return M(F)?t.t("inspector.unshared_value_tooltip"):null});var k=o.filter(function(){return this.checked});k.empty()?r.html(t.tHtml("inspector.none")):(r.html(k.attr("value")),d[k.datum()]=A[k.datum()]),e.type==="structureRadio"&&(A.waterway&&!d.tunnel&&(d.tunnel="culvert"),s.call(v,A))},_.focus=function(){o.node().focus()},_.entityIDs=function(A){return arguments.length?(m=A,d={},_):m},_.isAllowed=function(){return m.length===1},$t(_,i,"on")}function IS(t,e){let i=Pt("change"),r=ye(null),s;function n(a){let l=a.selectAll(".form-field-input-wrap").data([0]);l=l.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(l),r=l.selectAll("textarea").data([0]),r=r.enter().append("textarea").attr("id",e.uid).call(Ri).on("input",o(!0)).on("blur",o()).on("change",o()).merge(r)}function o(a){return function(){let l=e.key,c=si(r);if(a||(c=t.cleanTagValue(c)),!c&&Array.isArray(s[l]))return;let d={};d[l]=c||void 0,i.call("change",this,d,a)}}return n.tags=function(a){s=a;let l=e.key,c=Array.isArray(a[l]),d=c?t.t("inspector.multiple_values"):e.placeholder||t.t("inspector.unknown");si(r,!c&&a[l]?a[l]:"").attr("title",c?a[l].filter(Boolean).join(`
`):void 0).attr("placeholder",d).classed("mixed",c)},n.focus=function(){r.node().focus()},$t(n,i,"on")}function kS(t,e){var i=t.services.wikidata,r=Pt("change"),s=ye(null),n=ye(null),o=null,a=null,l="",c=[],d=e.keys&&e.keys.find(function(A){return A.includes("wikipedia")}),m=e.key==="wikidata"?"name":e.key.split(":")[0],g=xr(t,"combo-"+e.safeid).caseSensitive(!0).minItems(1);function _(A){s=A;var M=A.selectAll(".form-field-input-wrap").data([0]);M=M.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(M);var k=M.selectAll("ul").data([0]);k=k.enter().append("ul").attr("class","rows").merge(k);var F=k.selectAll("li.wikidata-search").data([0]),O=F.enter().append("li").attr("class","wikidata-search");O.append("input").attr("type","text").attr("id",e.uid).style("flex","1").call(Ri).on("focus",function(){var Z=ye(this).node();Z.setSelectionRange(0,Z.value.length)}).on("blur",function(){b()}).call(g.fetcher(v)),g.on("accept",function(Z){Z&&(o=Z.id,E())}).on("cancel",function(){b()}),O.append("button").attr("class","form-field-button wiki-link").attr("title",t.t("icons.view_on",{domain:"wikidata.org"})).call(Ye("#rapid-icon-out-link")).on("click",function(Z){Z.preventDefault(),l&&window.open(l,"_blank")}),F=F.merge(O),n=F.select("input");var B=["description","identifier"],U=k.selectAll("li.labeled-input").data(B),z=U.enter().append("li").attr("class",function(Z){return"labeled-input preset-wikidata-"+Z});z.append("span").attr("class","label").html(function(Z){return t.tHtml("wikidata."+Z)}),z.append("input").attr("type","text").call(Ri).classed("disabled","true").attr("readonly","true"),z.append("button").attr("class","form-field-button").attr("title",t.t("icons.copy")).call(Ye("#rapid-operation-copy")).on("click",function(Z){Z.preventDefault(),ye(this.parentNode).select("input").node().select(),document.execCommand("copy")})}function v(A,M){if(!A&&m)for(var k in c){var F=t.hasEntity(c[k]);if(F.tags[m]){A=F.tags[m];break}}i.itemsForSearchQuery(A,function(O,B){if(!O){var U=B.map(function(z){return{id:z.id,value:z.label+" ("+z.id+")",title:z.description,terms:z.aliases}});M&&M(U)}})}function E(){let A=e.key;var M={};M[A]=o,r.call("change",this,M);var k=t.graph(),F=c;i.entityByQID(o,function(O,B){if(!O&&t.graph()===k&&B.sitelinks){var U=i.languagesToQuery();["labels","descriptions"].forEach(function(ee){if(B[ee]){var re=Object.keys(B[ee]);if(re.length!==0){var te=re[0];U.indexOf(te)===-1&&U.push(te)}}});var z;if(d){var Z;for(var W in U){var q=U[W],Q=q.replace("-","_")+"wiki";if(B.sitelinks[Q]){Z=!0,z=q+":"+B.sitelinks[Q].title;break}}if(!Z){var V=Object.keys(B.sitelinks).filter(function(ee){return ee.endsWith("wiki")});if(V.length===0)z=null;else{var le=V[0].slice(0,-4).replace("_","-"),de=B.sitelinks[V[0]].title;z=le+":"+de}}}if(z&&(z=t.cleanTagValue(z)),typeof z!="undefined"){var ne=F.map(function(ee){var re=t.hasEntity(ee);if(!re)return null;var te=Object.assign({},re.tags);if(z===null){if(!te[d])return null;delete te[d]}else te[d]=z;return Xr(ee,te)}).filter(Boolean);ne.length&&t.overwrite(function(re){return ne.forEach(function(te){re=te(re)}),re},t.systems.edits.undoAnnotation())}}})}function b(){var A="";a&&(A=T(a,"labels"),A.length===0&&(A=a.id.toString())),si(n,A)}_.tags=function(A){let M=e.key;var k=Array.isArray(A[M]);if(n.attr("title",k?A[M].filter(Boolean).join(`
`):null).attr("placeholder",k?t.t("inspector.multiple_values"):"").classed("mixed",k),o=typeof A[M]=="string"&&A[M]||"",!/^Q[0-9]*$/.test(o)){F();return}l="https://wikidata.org/wiki/"+o,i.entityByQID(o,function(O,B){if(O){F();return}a=B,b();var U=T(B,"descriptions");s.select("button.wiki-link").classed("disabled",!1),s.select(".preset-wikidata-description").style("display",function(){return U.length>0?"flex":"none"}).select("input").attr("value",U),s.select(".preset-wikidata-identifier").style("display",function(){return B.id?"flex":"none"}).select("input").attr("value",B.id)});function F(){a=null,b(),s.select(".preset-wikidata-description").style("display","none"),s.select(".preset-wikidata-identifier").style("display","none"),s.select("button.wiki-link").classed("disabled",!0),o&&o!==""?l="https://wikidata.org/wiki/Special:Search?search="+o:l=""}};function T(A,M){if(!A[M])return"";var k=A[M],F=Object.keys(k);if(F.length===0)return"";var O=i.languagesToQuery();for(var B in O){var U=O[B],z=k[U];if(z&&z.value&&z.value.length>0)return z.value}return k[F[0]].value}return _.entityIDs=function(A){return arguments.length?(c=A,_):c},_.focus=function(){n.node().focus()},$t(_,r,"on")}function v_(t,e){let i=Pt("change"),r=t.services.wikipedia,s=t.services.wikidata,n=ye(null),o=ye(null),a="",l,c,d=[];t.systems.data.getDataAsync("wmf_sitematrix").then(k=>{d=k,c&&M(c)}).catch(k=>console.error(k));let g=xr(t,"wikipedia-lang").fetcher((k,F)=>{let O=k.toLowerCase();F(d.filter(B=>B[0].toLowerCase().indexOf(O)>=0||B[1].toLowerCase().indexOf(O)>=0||B[2].toLowerCase().indexOf(O)>=0).map(B=>({value:B[1]})))}),_=xr(t,"wikipedia-title").fetcher((k,F)=>{if(!k){k="";for(let B in l){let U=t.hasEntity(l[B]);if(U.tags.name){k=U.tags.name;break}}}(k.length>7?r.search:r.suggestions)(b()[2],k,(B,U)=>{F(U.map(z=>({value:z})))})});function v(k){let F=k.selectAll(".form-field-input-wrap").data([0]);F=F.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(F);let O=F.selectAll(".wiki-lang-container").data([0]);O=O.enter().append("div").attr("class","wiki-lang-container").merge(O),n=O.selectAll("input.wiki-lang").data([0]),n=n.enter().append("input").attr("type","text").attr("class","wiki-lang").attr("placeholder",t.t("translate.localized_translation_language")).call(Ri).call(g).merge(n),n.on("blur",T).on("change",T);let B=F.selectAll(".wiki-title-container").data([0]);B=B.enter().append("div").attr("class","wiki-title-container").merge(B),o=B.selectAll("input.wiki-title").data([0]),o=o.enter().append("input").attr("type","text").attr("class","wiki-title").attr("id",e.uid).call(Ri).call(_).merge(o),o.on("blur",function(){A(!0)}).on("change",function(){A(!1)});let U=B.selectAll(".wiki-link").data([0]);U=U.enter().append("button").attr("class","form-field-button wiki-link").attr("title",t.t("icons.view_on",{domain:"wikipedia.org"})).call(Ye("#rapid-icon-out-link")).merge(U),U.on("click",z=>{z.preventDefault(),a&&window.open(a,"_blank")})}function E(k){let F=t.systems.l10n.languageCode().toLowerCase();for(let O in d){let B=d[O];if(B[2]===F)return B}return k?["","",""]:["English","English","en"]}function b(k){let F=si(n).toLowerCase();for(let O in d){let B=d[O];if(B[0].toLowerCase()===F||B[1].toLowerCase()===F||B[2]===F)return B}return E(k)}function T(){si(n,b()[1]),A(!0)}function A(k){let F=si(o),O=F.match(/https?:\/\/([-a-z]+)\.wikipedia\.org\/(?:wiki|\1-[-a-z]+)\/([^#]+)(?:#(.+))?/),B=O&&d.find(W=>O[1]===W[2]),U={};if(B){let W=B[1];if(F=decodeURIComponent(O[2]).replace(/_/g," "),O[3]){let q;q=decodeURIComponent(O[3]),F+="#"+q.replace(/_/g," ")}F=F.slice(0,1).toUpperCase()+F.slice(1),si(n,W),si(o,F)}if(F?U.wikipedia=t.cleanTagValue(b()[2]+":"+F):U.wikipedia=void 0,i.call("change",this,U),k||!F||!b()[2])return;let z=t.graph(),Z=l;s.itemsByTitle(b()[2],F,(W,q)=>{if(W||!q||!Object.keys(q).length||t.graph()!==z)return;let Q=Object.keys(q),V=Q&&Q.find(de=>de.match(/^Q\d+$/)),le=Z.map(de=>{let ne=t.entity(de).tags,ee=Object.assign({},ne);return ee.wikidata!==V?(ee.wikidata=V,Xr(de,ee)):null}).filter(Boolean);le.length&&t.overwrite(function(ne){return le.forEach(function(ee){ne=ee(ne)}),ne},t.systems.edits.undoAnnotation())})}v.tags=k=>{c=k,M(k)};function M(k){let F=e.key,O=typeof k[F]=="string"?k[F]:"",B=O.match(/([^:]+):([^#]+)(?:#(.+))?/),U=B&&B[1],z=B&&B[2],Z=B&&B[3],W=U&&d.find(q=>U===q[2]);if(W){let q=W[1];if(si(n,q),si(o,z+(Z?"#"+Z:"")),Z)try{Z=encodeURIComponent(Z.replace(/ /g,"_")).replace(/%/g,".")}catch(Q){Z=Z.replace(/ /g,"_")}a="https://"+U+".wikipedia.org/wiki/"+z.replace(/ /g,"_")+(Z?"#"+Z:"")}else if(si(o,O),O&&O!=="")si(n,""),a=`https://${E()[2]}.wikipedia.org/w/index.php?fulltext=1&search=${O}`;else{let q=b(!0);si(n,q[1]),a=""}}return v.entityIDs=k=>arguments.length?(l=k,v):l,v.focus=()=>{o.node().focus()},$t(v,i,"on")}v_.supportsMultiselection=!1;var G4={access:ES,address:TS,check:n0,combo:nl,cycleway:SS,defaultCheck:n0,email:ka,identifier:ka,lanes:__,localized:AS,roadspeed:CS,roadheight:ka,manyCombo:nl,multiCombo:nl,networkCombo:nl,number:ka,onewayCheck:n0,radio:y6,semiCombo:nl,structureRadio:y6,tel:ka,text:ka,textarea:IS,typeCombo:nl,url:ka,wikidata:kS,wikipedia:v_};var vQ=!0,bQ=30,wQ=6,_6=class extends fi{constructor(e){super(e),this.id="presets",this.dependencies=new Set(["data","l10n","locations","storage","urlhash"]),this.geometries=["point","vertex","line","area","relation"];let i=new Xc(e,"point",{name:"Point",tags:{},geometry:["point","vertex"],matchScore:.1}),r=new Xc(e,"line",{name:"Line",tags:{},geometry:["line"],matchScore:.1}),s=new Xc(e,"area",{name:"Area",tags:{area:"yes"},geometry:["area"],matchScore:.1}),n=new Xc(e,"relation",{name:"Relation",tags:{},geometry:["relation"],matchScore:.1});this.collection=new jc(e,[i,r,s,n]),this._defaults={point:[],vertex:[],line:[],area:[],relation:[]},this._presets={point:i,line:r,area:s,relation:n},this._fields={},this._categories={},this._universal=[],this._recentIDs=null,this.addablePresetIDs=null,this._geometryIndex={point:{},vertex:{},line:{},area:{},relation:{}},this._initPromise=null}initAsync(){if(this._initPromise)return this._initPromise;for(let s of this.dependencies)if(!this.context.systems[s])return Promise.reject(`Cannot init:  ${this.id} requires ${s}`);let e=this.context.systems.data,i=this.context.systems.urlhash,r=Promise.all([e.initAsync(),i.initAsync()]);return this._initPromise=r.then(()=>{let s=i.initialHashParams.get("presets");if(s){let n=s.split(",").map(o=>o.trim()).filter(Boolean);this.addablePresetIDs=new Set(n)}return Promise.all([e.getDataAsync("preset_categories"),e.getDataAsync("preset_defaults"),e.getDataAsync("preset_presets"),e.getDataAsync("preset_fields")])}).then(s=>{this.merge({categories:s[0],defaults:s[1],presets:s[2],fields:s[3]}),L9(this.areaKeys()),N9(this.pointTags()),O9(this.vertexTags())})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}merge(e){let i=[],r=this.context,s=r.systems.locations;if(e.fields)for(let[o,a]of Object.entries(e.fields))if(a){if(!G4[a.type]){vQ&&console.warn(`"${a.type}" type not supported for ${o}`);continue}let l=new q2(r,o,a,this._fields);l.locationSet&&i.push(l),this._fields[o]=l}else delete this._fields[o];if(e.presets)for(let[o,a]of Object.entries(e.presets)){let l=this._presets[o],c=l==null?void 0:l.isFallback();if(a){a.icon&&(a.icon=a.icon.replace(/^iD-/,"rapid-")),o==="address"&&(a.icon="maki-circle-stroked"),o==="natural/tree"&&(a.icon="maki-park"),/^highway\/crossing/.test(o)&&(a.icon="temaki-pedestrian"),/^highway\/footway\/crossing/.test(o)&&(a.icon="temaki-pedestrian"),a.icon==="roentgen-needleleaved_tree"&&(a.icon="maki-park-alt1");let d=new Xc(r,o,a,this._fields,this._presets);d.locationSet&&i.push(d),this._presets[o]=d}else c||delete this._presets[o]}if(e.categories)for(let[o,a]of Object.entries(e.categories))if(a){a.icon&&(a.icon=a.icon.replace(/^iD-/,"rapid-"));let l=new $2(r,o,a,this._presets);l.locationSet&&i.push(l),this._categories[o]=l}else delete this._categories[o];if(e.defaults)for(let[o,a]of Object.entries(e.defaults))Array.isArray(a)?this._defaults[o]=a.map(l=>this._presets[l]||this._categories[l]).filter(l=>l&&!l.isFallback()):this._defaults[o]=[];let n=Object.values(this._presets).concat(Object.values(this._categories));return this.collection=new jc(r,n),this._universal=Object.values(this._fields).filter(o=>o.universal),Object.values(this._presets).forEach(o=>o.resetFields()),this._geometryIndex={point:{},vertex:{},line:{},area:{},relation:{}},n.forEach(o=>{(o.geometry||[]).forEach(a=>{let l=this._geometryIndex[a];for(let c in o.tags){l[c]=l[c]||{};let d=o.tags[c];(l[c][d]=l[c][d]||[]).push(o)}})}),e.featureCollection&&Array.isArray(e.featureCollection.features)&&s.mergeCustomGeoJSON(e.featureCollection),i.length&&s.mergeLocationSets(i),this}item(e){return this.collection.item(e)}index(e){return this.collection.index(e)}fallback(e){return this.collection.fallback(e)}matchGeometry(e){return this.collection.matchGeometry(e)}matchAllGeometry(e){return this.collection.matchAllGeometry(e)}search(e,i,r){return this.collection.search(e,i,r)}match(e,i){return i.transient(e,"presetMatch",()=>{let r=e.geometry(i);r==="vertex"&&e.isOnAddressLine(i)&&(r="point");let s=e.extent(i);return this.matchTags(e.tags,r,s.center())})}matchTags(e,i,r){let s=this._geometryIndex[i],n=-1,o,a=[];for(let c in e){let d=[],m=s[c];if(!m)continue;let g=m[e[c]];g&&d.push(...g);let _=m["*"];if(_&&d.push(..._),d.length!==0)for(let v=0;v<d.length;v++){let E=d[v],b=E.matchScore(e);b!==-1&&(a.push({score:b,candidate:E}),b>n&&(n=b,o=E))}}let l=this.context.systems.locations;if(o&&o.locationSetID&&o.locationSetID!=="+[Q2]"&&Array.isArray(r)){let c=l.locationSetsAt(r);if(!c[o.locationSetID]){a.sort((d,m)=>d.score<m.score?1:-1);for(let d=0;d<a.length;d++){let m=a[d];if(!m.candidate.locationSetID||c[m.candidate.locationSetID]){o=m.candidate,n=m.score;break}}}}if(!o||o.isFallback()){for(let c in e)if(/^addr:/.test(c)&&s["addr:*"]&&s["addr:*"]["*"]){o=s["addr:*"]["*"][0];break}}return o||this.fallback(i)}allowsVertex(e,i){return e.type!=="node"?!1:Object.keys(e.tags).length===0?!0:i.transient(e,"vertexMatch",()=>{if(e.isOnAddressLine(i))return!0;let r=N1(e.tags);return r.vertex?!0:!r.point})}areaKeys(){let e=["barrier","highway","footway","railway","junction","type"],i={},r=Object.values(this._presets).filter(s=>!s.suggestion&&!s.replacement);for(let s of r){let n=Object.keys(s.tags)[0];n&&(e.includes(n)||s.geometry.includes("area")&&(i[n]=i[n]||{}))}for(let s of r)if(s.geometry.includes("line"))for(let[n,o]of Object.entries(s.addTags))n in i&&o!=="*"&&(i[n][o]=!0);return i}pointTags(){let e={},i=Object.values(this._presets).filter(r=>!r.suggestion&&!r.replacement&&r.searchable!==!1);for(let r of i){if(!r.geometry.includes("point"))continue;let s=Object.keys(r.tags)[0],n=Object.values(r.tags)[0];!s||!n||(e[s]=e[s]||{},e[s][n]=!0)}return e}vertexTags(){let e={},i=Object.values(this._presets).filter(r=>!r.suggestion&&!r.replacement&&r.searchable!==!1);for(let r of i){if(!r.geometry.includes("vertex"))continue;let s=Object.keys(r.tags)[0],n=Object.values(r.tags)[0];!s||!n||(e[s]=e[s]||{},e[s][n]=!0)}return e}field(e){return this._fields[e]}universal(){return this._universal}defaults(e,i=10,r=!0,s=null){let n=new Map;if(r)for(let l of this.getRecents())n.size<wQ&&l.matchGeometry(e)&&n.set(l.id,l);if(this.addablePresetIDs instanceof Set)for(let l of this.addablePresetIDs){let c=this.item(l);c!=null&&c.matchGeometry(e)&&n.set(l,c)}else for(let l of this._defaults[e])l.matchGeometry(e)&&n.set(l.id,l);let o=this.fallback(e);o&&!n.has(o.id)&&n.set(o.id,o);let a=[...n.values()];if(Array.isArray(s)){let c=this.context.systems.locations.locationSetsAt(s);a=a.filter(d=>!d.locationSetID||c[d.locationSetID])}return new jc(this.context,a.slice(0,i-1))}getRecents(){let e=this._recentIDs;if(!e){let r=this.context.systems.storage;e=JSON.parse(r.getItem("preset_recents"))||[]}let i=e.map(r=>{let s=(r==null?void 0:r.id)||r;return this._presets[s]}).filter(Boolean);return this._recentIDs||(this._recentIDs=i.map(r=>r.id)),i}setMostRecent(e){if(e.searchable===!1)return;this._recentIDs.unshift(e.id),this._recentIDs=Ei(this._recentIDs).slice(0,bQ),this.context.systems.storage.setItem("preset_recents",JSON.stringify(this._recentIDs))}};var KN="#da26d3",MS=["#ff0000","#ffa500","#ffd700","#00ff00","#00ffff","#1e90ff","#da26d3","#ffc0cb","#d3d3d3","#faf0e6"],x6=class extends fi{constructor(e){super(e),this.id="rapid",this.dependencies=new Set(["edits","l10n","urlhash"]),this.sources=new Set,this.acceptedIDs=new Set,this._datasets=new Map,this._taskExtent=null,this._isTaskBoundsRect=null,this._hadPoweruser=!1,this._initPromise=null,this._hashchange=this._hashchange.bind(this),this._onUndone=this._onUndone.bind(this),this._onChange=this._onChange.bind(this),this._onRestore=this._onRestore.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let a of this.dependencies)if(!this.context.systems[a])return Promise.reject(`Cannot init:  ${this.id} requires ${a}`);let e=this.context,i=e.systems.edits,r=e.systems.l10n,s=e.systems.map,n=e.systems.urlhash,o=Promise.all([i.initAsync(),s.initAsync(),r.initAsync(),n.initAsync()]);return this._initPromise=o.then(()=>{n.on("hashchange",this._hashchange),i.on("undone",this._onUndone).on("change",this._onChange).on("restore",this._onRestore),this._datasets.set("fbRoads",{id:"fbRoads",beta:!1,added:!0,enabled:!1,conflated:!0,service:"mapwithai",color:KN,label:r.t("rapid_feature_toggle.fbRoads.label"),license_markdown:r.t("rapid_feature_toggle.fbRoads.license_markdown")}),this._datasets.set("msBuildings",{id:"msBuildings",beta:!1,added:!0,enabled:!1,conflated:!0,service:"mapwithai",color:KN,label:r.t("rapid_feature_toggle.msBuildings.label"),license_markdown:r.t("rapid_feature_toggle.msBuildings.license_markdown")})})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this.sources=new Set,this.acceptedIDs=new Set,Promise.resolve()}get colors(){return MS}get datasets(){return this._datasets}get taskExtent(){return this._taskExtent}isTaskRectangular(){return!!this._taskExtent&&this._isTaskBoundsRect}get hadPoweruser(){return this._hadPoweruser}setTaskExtentByGpxData(e){let i=new DOMParser().parseFromString(e,"text/xml"),r=u_(i),s=r.features.reduce((o,a)=>o+(a.geometry.type==="LineString"?1:0),0);if(r.type==="FeatureCollection"){let o,a,l,c;r.features.forEach(d=>{if(d.geometry.type==="Point"){let m=d.geometry.coordinates[0],g=d.geometry.coordinates[1];(o===void 0||g<o)&&(o=g),(a===void 0||m<a)&&(a=m),(l===void 0||g>l)&&(l=g),(c===void 0||m>c)&&(c=m)}else if(d.geometry.type==="LineString"&&s===1){let m=d.geometry.coordinates.map(b=>b[0]),g=d.geometry.coordinates.map(b=>b[1]),_=m.filter(n),v=g.filter(n),E=!0;_.forEach(b=>{d.geometry.coordinates.filter(A=>A[0]===b).map(A=>A[1]).filter(n).length!==2&&(E=!1)}),_.length===2&&v.length===2&&E?this._isTaskBoundsRect=!0:this._isTaskBoundsRect=!1}}),this._taskExtent=new mt([a,o],[c,l]),this.emit("taskchanged")}function n(o,a,l){return l.indexOf(o)===a}}_wasRapidEdit(e){return(e==null?void 0:e.type)&&/^rapid/.test(e.type)}_onUndone(e,i){let r=i.annotation;this._wasRapidEdit(r)&&(this.acceptedIDs.delete(r.id),this.context.systems.map.immediateRedraw())}_onChange(){let e=this.context.systems.edits.peekAnnotation();this._wasRapidEdit(e)&&(this.acceptedIDs.add(e.id),this.context.systems.map.immediateRedraw())}_onRestore(){this.acceptedIDs=new Set,this.context.systems.edits.peekAllAnnotations().forEach(e=>{this._wasRapidEdit(e)&&(this.acceptedIDs.add(e.id),e.origid&&this.acceptedIDs.add(e.origid))}),this.context.systems.map.immediateRedraw()}_hashchange(e,i){e.get("poweruser")==="true"&&(this._hadPoweruser=!0);let r=new Set,s=e.get("datasets"),n=i.get("datasets");if(s!==n){typeof s=="string"&&(r=new Set(s.split(",")));for(let[a,l]of this._datasets)r.has(a)?(l.enabled=!0,r.delete(a)):l.enabled=!1}let o=this.context.services.esri;!o||!r.size||o.startAsync().then(()=>o.loadDatasetsAsync()).then(a=>{let l=this.context.systems.l10n;for(let c of r){let d=a[c];if(!d)continue;o.loadLayerAsync(d.id);let m=d.groupCategories.some(E=>E.toLowerCase()==="/categories/preview"),g=d.groupCategories.some(E=>E.toLowerCase()==="/categories/buildings"),_=this._datasets.size%MS.length,v={id:d.id,beta:m,added:!0,enabled:!0,conflated:!1,service:"esri",color:MS[_],label:d.title,license_markdown:l.t("rapid_feature_toggle.esri.license_markdown")};d.extent&&(v.extent=new mt(d.extent[0],d.extent[1])),g&&(v.conflated=!0,v.service="mapwithai"),this._datasets.set(d.id,v)}})}};var v6=class extends fi{constructor(e){super(e),this.id="storage",this.dependencies=new Set,this._storage=null;try{this._storage=window.localStorage}catch(i){this._mock=new Map,this._storage={hasItem:r=>this._mock.has(r),getItem:r=>this._mock.get(r),setItem:(r,s)=>this._mock.set(r,s),removeItem:r=>this._mock.delete(r),clear:()=>this._mock.clear()}}}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}hasItem(e){return!!this._storage.getItem(e)}getItem(e){return this._storage.getItem(e)}setItem(e,i){try{return this._storage.setItem(e,i),!0}catch(r){console.error("localStorage quota exceeded")}return!1}removeItem(e){this._storage.removeItem(e)}clear(){this._storage.clear()}};function b_(t){let e=t.services.osm;function i(n){!e||!e.authenticated()?r(n,null):e.userDetails((o,a)=>r(n,a))}function r(n,o){let a=n.select(".userInfo"),l=n.select(".loginLogout");if(!o)a.html("").classed("hide",!0);else{a.html("").classed("hide",!1);let c=a.append("a").attr("href",e.userURL(o.display_name)).attr("target","_blank");o.image_url?c.append("img").attr("class","icon pre-text user-icon").attr("src",o.image_url):c.call(Ye("#rapid-icon-avatar","pre-text light")),c.append("span").attr("class","label").html(o.display_name)}e?e.authenticated()?l.classed("hide",!1).select("a").text(t.t("logout")).on("click",c=>{c.preventDefault(),e.logout(),s()}):l.classed("hide",!1).select("a").text(t.t("login")).on("click",c=>{c.preventDefault(),e.authenticate()}):l.classed("hide",!0)}function s(){if(!e)return;let n=e.urlroot+"/logout?referer=%2Flogin",o=600,a=550,l=[["width",o],["height",a],["left",window.screen.width/2-o/2],["top",window.screen.height/2-a/2]].map(c=>c.join("=")).join(",");window.open(n,"_blank",l)}return function(n){e&&(n.append("li").attr("class","userInfo").classed("hide",!0),n.append("li").attr("class","loginLogout").classed("hide",!0).append("a").attr("href","#"),e.on("authchange",()=>i(n)),i(n))}}function EQ(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var o0=EQ;var TQ=typeof global=="object"&&global&&global.Object===Object&&global,JN=TQ;var SQ=typeof self=="object"&&self&&self.Object===Object&&self,AQ=JN||SQ||Function("return this")(),w_=AQ;var CQ=function(){return w_.Date.now()},E_=CQ;var IQ=/\s/;function kQ(t){for(var e=t.length;e--&&IQ.test(t.charAt(e)););return e}var eO=kQ;var MQ=/^\s+/;function PQ(t){return t&&t.slice(0,eO(t)+1).replace(MQ,"")}var tO=PQ;var RQ=w_.Symbol,$4=RQ;var iO=Object.prototype,DQ=iO.hasOwnProperty,FQ=iO.toString,b6=$4?$4.toStringTag:void 0;function LQ(t){var e=DQ.call(t,b6),i=t[b6];try{t[b6]=void 0;var r=!0}catch(n){}var s=FQ.call(t);return r&&(e?t[b6]=i:delete t[b6]),s}var rO=LQ;var NQ=Object.prototype,OQ=NQ.toString;function BQ(t){return OQ.call(t)}var sO=BQ;var UQ="[object Null]",zQ="[object Undefined]",nO=$4?$4.toStringTag:void 0;function GQ(t){return t==null?t===void 0?zQ:UQ:nO&&nO in Object(t)?rO(t):sO(t)}var oO=GQ;function $Q(t){return t!=null&&typeof t=="object"}var aO=$Q;var HQ="[object Symbol]";function VQ(t){return typeof t=="symbol"||aO(t)&&oO(t)==HQ}var lO=VQ;var cO=0/0,jQ=/^[-+]0x[0-9a-f]+$/i,XQ=/^0b[01]+$/i,WQ=/^0o[0-7]+$/i,qQ=parseInt;function YQ(t){if(typeof t=="number")return t;if(lO(t))return cO;if(o0(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=o0(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=tO(t);var i=XQ.test(t);return i||WQ.test(t)?qQ(t.slice(2),i?2:8):jQ.test(t)?cO:+t}var PS=YQ;var ZQ="Expected a function",QQ=Math.max,KQ=Math.min;function JQ(t,e,i){var r,s,n,o,a,l,c=0,d=!1,m=!1,g=!0;if(typeof t!="function")throw new TypeError(ZQ);e=PS(e)||0,o0(i)&&(d=!!i.leading,m="maxWait"in i,n=m?QQ(PS(i.maxWait)||0,e):n,g="trailing"in i?!!i.trailing:g);function _(O){var B=r,U=s;return r=s=void 0,c=O,o=t.apply(U,B),o}function v(O){return c=O,a=setTimeout(T,e),d?_(O):o}function E(O){var B=O-l,U=O-c,z=e-B;return m?KQ(z,n-U):z}function b(O){var B=O-l,U=O-c;return l===void 0||B>=e||B<0||m&&U>=n}function T(){var O=E_();if(b(O))return A(O);a=setTimeout(T,E(O))}function A(O){return a=void 0,g&&r?_(O):(r=s=void 0,o)}function M(){a!==void 0&&clearTimeout(a),c=0,r=l=s=a=void 0}function k(){return a===void 0?o:A(E_())}function F(){var O=E_(),B=b(O);if(r=arguments,s=this,l=O,B){if(a===void 0)return v(l);if(m)return clearTimeout(a),a=setTimeout(T,e),_(l)}return a===void 0&&(a=setTimeout(T,e)),o}return F.cancel=M,F.flush=k,F}var Gr=JQ;var eK="Expected a function";function tK(t,e,i){var r=!0,s=!0;if(typeof t!="function")throw new TypeError(eK);return o0(i)&&(r="leading"in i?!!i.leading:r,s="trailing"in i?!!i.trailing:s),Gr(t,e,{leading:r,maxWait:e,trailing:s})}var ol=tK;function T_(t){let e=t.systems.imagery,i=ye(null);function r(n,o,a){let l=n.selectAll(`.${a}`).data([0]);l=l.enter().append("div").attr("class",a).merge(l);let c=l.selectAll(".attribution").data(o,m=>m.id);c.exit().remove(),c=c.enter().append("span").attr("class","attribution").each((m,g,_)=>{let v=ye(_[g]);if(m.terms_html){v.html(m.terms_html);return}m.terms_url&&(v=v.append("a").attr("href",m.terms_url).attr("target","_blank"));let E=t.t(`imagery.${m.idtx}.attribution.text`,{default:m.terms_text||m.id||m.name});m.icon&&!m.overlay&&v.append("img").attr("class","source-image").attr("src",m.icon),v.append("span").attr("class","attribution-text").html(E)}).merge(c);let d=c.selectAll(".copyright-notice").data(m=>{let g=m.copyrightNotices(t.systems.map.zoom(),t.systems.map.extent());return g?[g]:[]});d.exit().remove(),d=d.enter().append("span").attr("class","copyright-notice").merge(d),d.html(String)}function s(){let n=e.baseLayerSource();i.call(r,n?[n]:[],"base-layer-attribution");let o=t.systems.map.zoom(),a=e.overlayLayerSources()||[];i.call(r,a.filter(l=>l.validZoom(o)),"overlay-layer-attribution")}return function(n){i=n,e.on("imagerychange",s),t.systems.map.on("draw",ol(s,400,{leading:!1})),s()}}function H4(t){let e=xr(t,"more-fields").minItems(1),i=[],r="",s="",n="";function o(a){let l=i.filter(k=>k.isAllowed()),c=l.filter(k=>k.isShown()),d=l.filter(k=>!k.isShown()),m=a.selectAll(".form-fields-container").data([0]);m=m.enter().append("div").attr("class","form-fields-container "+(n||"")).merge(m);let g=m.selectAll(".wrap-form-field").data(c,k=>k.id+(k.entityIDs?k.entityIDs.join():""));g.exit().remove();let _=g.enter().append("div").attr("class",k=>`wrap-form-field wrap-form-field-${k.safeid}`);g=g.merge(_),g.order().each((k,F,O)=>{ye(O[F]).call(k.render)});let v=[],E=d.map(k=>{let F=k.title;v.push(F);let O=k.terms;return k.key&&O.push(k.key),k.keys&&(O=O.concat(k.keys)),{display:k.label,value:F,title:F,field:k,terms:O}}),b=v.slice(0,3).join(", ")+(v.length>3?"\u2026":""),T=a.selectAll(".more-fields").data(s==="hover"||E.length===0?[]:[0]);T.exit().remove();let A=T.enter().append("div").attr("class","more-fields").append("label");A.append("span").text(t.t("inspector.add_fields")),T=A.merge(T);let M=T.selectAll(".value").data([0]);M.exit().remove(),M=M.enter().append("input").attr("class","value").attr("type","text").attr("placeholder",b).call(Ri).merge(M),M.call(si,"").call(e.data(E).on("accept",k=>{if(!k)return;let F=k.field;F.show(),a.call(o),F.focus()})),r!==b&&(M.attr("placeholder",b),r=b)}return o.fieldsArr=function(a){return arguments.length?(i=a||[],o):i},o.state=function(a){return arguments.length?(s=a,o):s},o.klass=function(a){return arguments.length?(n=a,o):n},o}function S_(t){var e=Pt("change"),i=H4(t),r=xr(t,"comment").caseSensitive(!0),s,n,o;function a(c){l(c)}function l(c){var d=!1;if(!s){d=!0;var m=t.systems.presets;s=[new Ma(t,m.field("comment"),null,{show:!0,revert:!1}),new Ma(t,m.field("source"),null,{show:!1,revert:!1}),new Ma(t,m.field("hashtags"),null,{show:!1,revert:!1})],s.forEach(function(A){A.on("change",function(M,k){e.call("change",A,void 0,M,k)})})}if(s.forEach(function(A){A.tags(n)}),c.call(i.fieldsArr(s)),d){var g=c.select(".form-field-comment textarea"),_=g.node();_&&(_.focus(),_.select()),N2(g,"blur");var v=t.services.osm;v&&v.userChangesets(function(A,M){if(!A){var k=M.map(function(F){var O=F.tags.comment;return O?{title:O,value:O}:null}).filter(Boolean);g.call(r.data(ff(k,"title")))}})}var E=n.comment.match(/google/i),b=c.select(".form-field-comment").selectAll(".comment-warning").data(E?[0]:[]);b.exit().transition().duration(200).style("opacity",0).remove();var T=b.enter().insert("div",".tag-reference-body").attr("class","field-warning comment-warning").style("opacity",0);T.append("a").attr("target","_blank").call(Ye("#rapid-icon-alert","inline")).attr("href",t.t("commit.google_warning_link")).append("span").text(t.t("commit.google_warning")),T.transition().duration(200).style("opacity",1)}return a.tags=function(c){return arguments.length?(n=c,a):n},a.changesetID=function(c){return arguments.length?(o===c||(o=c,s=null),a):o},$t(a,e,"on")}var dO=Yi(H2(),1);var ru=new function(){var t="keyValue",e="keyAttributes",i="@",r=[],s=/^\s*$/,n=/^(?:true|false)$/i;function o(m){return s.test(m)?null:n.test(m)?m.toLowerCase()==="true":isFinite(m)?parseFloat(m):isFinite(Date.parse(m))?new Date(m):m}function a(){}a.prototype.toString=function(){return"null"},a.prototype.valueOf=function(){return null};function l(m){return m===null?new a:m instanceof Object?m:new m.constructor(m)}function c(m,g,_,v){var E=r.length,b=m.hasChildNodes(),T=m.hasAttributes(),A=!!(g&2),M,k,F=0,O="",B=A?{}:!0;if(b)for(var U,z=0;z<m.childNodes.length;z++)U=m.childNodes.item(z),U.nodeType===4?O+=U.nodeValue:U.nodeType===3?O+=U.nodeValue.trim():U.nodeType===1&&!U.prefix&&r.push(U);var Z=r.length,W=o(O);!A&&(b||T)&&(B=g===0?l(W):{});for(var q=E;q<Z;q++)M=r[q].nodeName.toLowerCase(),k=c(r[q],g,_,v),B.hasOwnProperty(M)?(B[M].constructor!==Array&&(B[M]=[B[M]]),B[M].push(k)):(B[M]=k,F++);if(T){for(var Q=m.attributes.length,V=v?"":i,le=v?{}:B,de,ne=0;ne<Q;F++,ne++)de=m.attributes.item(ne),le[V+de.name.toLowerCase()]=o(de.value.trim());v&&(_&&Object.freeze(le),B[e]=le,F-=Q-1)}return g===3||(g===2||g===1&&F>0)&&O?B[t]=W:!A&&F===0&&O&&(B=W),_&&(A||F>0)&&Object.freeze(B),r.length=E,B}function d(m,g,_){var v,E;_ instanceof String||_ instanceof Number||_ instanceof Boolean?g.appendChild(m.createTextNode(_.toString())):_.constructor===Date&&g.appendChild(m.createTextNode(_.toGMTString()));for(var b in _)if(v=_[b],!(isFinite(b)||v instanceof Function))if(b===t)v!==null&&v!==!0&&g.appendChild(m.createTextNode(v.constructor===Date?v.toGMTString():String(v)));else if(b===e)for(var T in v)g.setAttribute(T,v[T]);else if(b.charAt(0)===i)g.setAttribute(b.slice(1),v);else if(v.constructor===Array)for(var A=0;A<v.length;A++)E=m.createElement(b),d(m,E,v[A]),g.appendChild(E);else E=m.createElement(b),v instanceof Object?d(m,E,v):v!==null&&v!==!0&&E.appendChild(m.createTextNode(v.toString())),g.appendChild(E)}this.build=function(m,g,_,v){var E=arguments.length>1&&typeof g=="number"?g&3:1;return c(m,E,_||!1,arguments.length>3?v:E===3)},this.unbuild=function(m){var g=document.implementation.createDocument("","",null);return d(g,g,m),g},this.stringify=function(m){return new XMLSerializer().serializeToString(ru.unbuild(m))}};function V4(t,e){return function(i){i.style("opacity",t?0:1).classed("hide",!1).transition().style("opacity",t?1:0).on("end",function(){ye(this).classed("hide",!t).style("opacity",null),e&&e.apply(this)})}}function a0(t,e){let i=t.systems.l10n,r=t.systems.storage,s=Pt("toggled"),n=!0,o=!0,a,l=ss(""),c=function(){},d=function(g){o&&(n=(r.getItem(`disclosure.${e}.expanded`)||"true")==="true"),a!==void 0&&(n=a);let _=g.selectAll(`.hide-toggle-${e}`).data([0]),v=_.enter().append("a").attr("href","#").attr("class",`hide-toggle hide-toggle-${e}`).call(Ye("","pre-text hide-toggle-icon"));v.append("span").attr("class","hide-toggle-text"),_=v.merge(_),_.on("click",A).classed("expanded",n),_.selectAll(".hide-toggle-text").html(l());let E=i.isRTL(),b=n?"down":E?"backward":"forward";_.selectAll(".hide-toggle-icon > use").attr("xlink:href",`#rapid-icon-${b}`);let T=g.selectAll(".disclosure-wrap").data([0]);T=T.enter().append("div").attr("class",`disclosure-wrap disclosure-wrap-${e}`).merge(T).classed("hide",!n),n&&T.call(c);function A(M){M.preventDefault(),n=!n,o&&a===void 0&&r.setItem(`disclosure.${e}.expanded`,n),a=void 0,_.classed("expanded",n);let k=n?"down":E?"backward":"forward";_.selectAll(".hide-toggle-icon > use").attr("xlink:href",`#rapid-icon-${k}`),T.call(V4(n)),n&&T.call(c),s.call("toggled",this,n)}};return d.expanded=m=>arguments.length?(n=m,d):n,d.checkPreference=m=>arguments.length?(o=m,d):o,d.expandOverride=m=>arguments.length?(a=m,d):a,d.label=m=>arguments.length?(l=ss(m),d):l,d.content=m=>arguments.length?(c=m,d):c,$t(d,s,"on")}function tr(t,e){let i=ss(""),r=ye(null),s,n,o,a,l,c,d={id:e};d.selection=function(){return r},d.classes=function(g){return arguments.length?(i=ss(g),d):i},d.label=function(g){return arguments.length?(a=ss(g),d):a},d.shouldDisplay=function(g){return arguments.length?(s=ss(g),d):s},d.content=function(g){return arguments.length?(n=g,d):n},d.disclosureContent=function(g){return arguments.length?(l=g,d):l},d.disclosureExpandOverride=function(g){return arguments.length?(c=g,d):c},d.render=function(_){r=_.selectAll(`.section-${e}`).data([0]),r=r.enter().append("div").attr("class",`section section-${e} `+(i&&i()||"")).merge(r),r.call(m)},d.reRender=function(){r.call(m)};function m(g){if(typeof s=="function"){let _=s();if(g.classed("hide",!_),!_){g.html("");return}}l?(o||(o=a0(t,e.replace(/-/g,"_")).label(a||"").content(l)),o.expandOverride(c),g.call(o)):n&&g.call(n)}return d}function A_(t){let e=t.systems.l10n,i=Gs(),r={};t.systems.data.getDataAsync("discarded").then(a=>r=a).catch(()=>{});let n=tr(t,"changes-list").label(()=>{let l=t.systems.edits.difference().summary();return e.t("inspector.title_count",{title:e.tHtml("commit.changes"),count:l.size})}).disclosureContent(o);function o(a){let l=t.systems.edits,c=[...l.difference().summary().values()],d=a.selectAll(".commit-section").data([0]),m=d.enter().append("div").attr("class","commit-section");m.append("ul").attr("class","changeset-list"),d=m.merge(d);let g=d.select("ul").selectAll("li").data(c),_=g.enter().append("li").attr("class","change-item"),v=_.append("button").on("mouseover",F).on("mouseout",O).on("click",B);v.each((U,z,Z)=>{let W=U.entity.geometry(U.graph);ye(Z[z]).call(Ye(`#rapid-icon-${W}`,`pre-text ${U.changeType}`))}),v.append("span").attr("class","change-type").html(U=>e.tHtml(`commit.${U.changeType}`)+" "),v.append("strong").attr("class","entity-type").html(U=>{let z=t.systems.presets.match(U.entity,U.graph);return z&&z.name()||e.displayType(U.entity.id)}),v.append("span").attr("class","entity-name").html(U=>{let z=e.displayName(U.entity.tags),Z="";return z!==""&&(Z+=":"),Z+=" "+z}),g=_.merge(g);let E=new ia().update({id:void 0}),b=l.changes(Qu(l.difference(),r));delete E.id;let T=ru.stringify(E.osmChangeJXON(b)),A=new Blob([T],{type:"text/xml;charset=utf-8;"}),M="changes.osc",k=d.selectAll(".download-changes").data([0]).enter().append("a").attr("class","download-changes");i.download?k.attr("href",window.URL.createObjectURL(A)).attr("download",M):k.attr("target","_blank").on("click.download",()=>navigator.msSaveBlob(A,M)),k.call(Ye("#rapid-icon-load","inline")).append("span").html(e.tHtml("commit.download_changes"));function F(U){U.entity&&t.surface().selectAll(Qh([U.entity.id],t.graph())).classed("hover",!0)}function O(){t.surface().selectAll(".hover").classed("hover",!1)}function B(U,z){if(z.changeType!=="deleted"){let Z=z.entity;t.systems.map.fitEntitiesEase(Z),t.surface().selectAll(Qh([Z.id],t.graph())).classed("hover",!0)}}}return n}function C_(t){function e(i){let r=t.systems.validator.getIssuesBySeverity({what:"edited",where:"all",includeDisabledRules:!0});for(let s in r){let n=r[s];s!=="error"&&(n=n.filter(_=>_.type!=="help_request"));let o=`${s}-section`,a=`${s}-item`,l=i.selectAll("."+o).data(n.length?[0]:[]);l.exit().remove();let c=l.enter().append("div").attr("class","modal-section "+o+" fillL2");c.append("h3").html(s==="warning"?t.tHtml("commit.warnings"):t.tHtml("commit.errors")),c.append("ul").attr("class","changeset-list"),l=c.merge(l);let d=l.select("ul").selectAll("li").data(n,_=>_.key);d.exit().remove();let m=d.enter().append("li").attr("class",a),g=m.append("button").on("mouseover",(_,v)=>{v.entityIds&&t.surface().selectAll(Qh(v.entityIds,t.graph())).classed("hover",!0)}).on("mouseout",()=>{t.surface().selectAll(".hover").classed("hover",!1)}).on("click",(_,v)=>{t.systems.validator.focusIssue(v)});g.call(Ye("#rapid-icon-alert","pre-text")),g.append("strong").attr("class","issue-message"),g.filter(_=>_.tooltip).call(Ft(t).title(_=>_.tooltip).placement("top")),d=m.merge(d),d.selectAll(".issue-message").html(_=>_.message(t))}}return e}function Ah(t,e){let i=t.systems.l10n,r=t.systems.storage,s=t.services.taginfo,n=Pt("change"),o=[{id:"list",icon:"#fas-th-list"},{id:"text",icon:"#fas-i-cursor"}],a=tr(t,e).classes("raw-tag-editor").label(()=>{let ee=Object.keys(b).filter(Boolean).length;return i.t("inspector.title_count",{title:i.tHtml("inspector.tags"),count:ee})}).disclosureContent(A),l=r.getItem("raw-tag-editor-view")||"list",c=[],d=[],m=!1,g=!1,_=null,v,E,b,T;function A(ee){d=d.filter(Ze=>b[Ze]!==void 0);let re=Object.keys(b).sort(),te=Sn(re,d);for(let Ze in te)d.push(te[Ze]);let ie=d.map((Ze,xt)=>({index:xt,key:Ze,value:b[Ze]}));(!ie.length||g)&&(g=!1,ie.push({index:ie.length,key:"",value:""})),ee.selectAll(".raw-tag-options").data([0]).enter().insert("div",":first-child").attr("class","raw-tag-options").selectAll(".raw-tag-option").data(o,Ze=>Ze.id).enter().append("button").attr("class",Ze=>`raw-tag-option raw-tag-option-${Ze.id}`+(l===Ze.id?" selected":"")).attr("title",Ze=>i.t(`icons.${Ze.id}`)).on("click",function(Ze,xt){l=xt.id,r.setItem("raw-tag-editor-view",xt.id),ee.selectAll(".raw-tag-option").classed("selected",It=>It===xt),ee.selectAll(".tag-text").classed("hide",xt.id!=="text").each(F),ee.selectAll(".tag-list, .add-row").classed("hide",xt.id!=="list")}).each((Ze,xt,It)=>{ye(It[xt]).call(Ye(Ze.icon))});let He=U(ie),Je=ee.selectAll(".tag-text").data([0]);Je=Je.enter().append("textarea").attr("class","tag-text"+(l!=="text"?" hide":"")).call(Ri).attr("placeholder",i.t("inspector.key_value")).attr("spellcheck","false").merge(Je),Je.call(si,He).each(F).on("input",F).on("focus",de).on("blur",z).on("change",z);let ot=ee.selectAll(".tag-list").data([0]);ot=ot.enter().append("ul").attr("class","tag-list"+(l!=="list"?" hide":"")).merge(ot);let yt=ee.selectAll(".add-row").data([0]).enter().append("div").attr("class","add-row"+(l!=="list"?" hide":""));yt.append("button").attr("class","add-tag").call(Ye("#rapid-icon-plus","light")).on("click",le),yt.append("div").attr("class","space-value"),yt.append("div").attr("class","space-buttons");let bt=ot.selectAll(".tag-row").data(ie,Ze=>Ze.key);bt.exit().each((Ze,xt,It)=>{ye(It[xt]).selectAll("input.key, input.value").call(xr.off,t)}).remove();let at=bt.enter().append("li").attr("class","tag-row").classed("readonly",M),Te=at.append("div").attr("class","inner-wrap");Te.append("div").attr("class","key-wrap").append("input").property("type","text").attr("class","key").call(Ri).on("focus",de).on("blur",q).on("change",q),Te.append("div").attr("class","value-wrap").append("input").property("type","text").attr("class","value").call(Ri).on("focus",de).on("blur",Q).on("change",Q).on("keydown.push-more",Z),Te.append("button").attr("class","form-field-button remove").attr("title",i.t("icons.remove")).call(Ye("#rapid-operation-delete")),bt=bt.merge(at).sort((Ze,xt)=>Ze.index-xt.index),bt.each((Ze,xt,It)=>{let Bt=ye(It[xt]);Bt.select("input.key"),Bt.select("input.value"),T&&s&&v!=="hover"&&W(Bt);let Mi={key:Ze.key};k(Ze)||(Mi.value=Ze.value);let je=iu(t,Mi);v==="hover"&&je.showing(!1),Bt.select(".inner-wrap").call(je.button),Bt.call(je.body),Bt.select("button.remove")}),bt.selectAll("input.key").attr("title",Ze=>Ze.key).attr("readonly",Ze=>M(Ze)||k(Ze)||null).call(si,Ze=>Ze.key),bt.selectAll("input.value").classed("mixed",k).attr("title",Ze=>k(Ze)?Ze.value.filter(Boolean).join(`
`):Ze.value).attr("readonly",Ze=>M(Ze)||null).attr("placeholder",Ze=>k(Ze)?i.t("inspector.multiple_values"):null).call(si,Ze=>k(Ze)?"":Ze.value),bt.selectAll("button.remove").on(("PointerEvent"in window?"pointer":"mouse")+"down",V)}function M(ee){for(let re of c)if(re.test(ee.key))return!0;return!1}function k(ee){return Array.isArray(ee.value)}function F(){if(l!=="text")return;let ee=ye(this),re=ee.node().value.match(/\n/g),te=2+Number(re&&re.length),ie=20;ee.style("height",te*ie+"px")}function O(ee){return JSON.stringify(ee).slice(1,-1)}function B(ee){let re="",te="";return(ee.length<1||ee.charAt(0)!=='"')&&(re='"'),(ee.length<2||ee.charAt(ee.length-1)!=='"'||ee.charAt(ee.length-1)==='"'&&ee.charAt(ee.length-2)==="\\")&&(te='"'),JSON.parse(re+ee+te)}function U(ee){let re=ee.filter(te=>te.key&&te.key.trim()!=="").map(te=>{let ie=te.value;typeof ie!="string"&&(ie="*");let oe=ie?O(ie):"";return O(te.key)+"="+oe}).join(`
`);return v!=="hover"&&re.length?re+`
`:re}function z(){let ee=this.value.trim(),re={};ee.split(`
`).forEach(ie=>{let oe=ie.match(/^\s*([^=]+)=(.*)$/);if(oe!==null){let fe=t.cleanTagKey(B(oe[1].trim())),Re=t.cleanTagValue(B(oe[2].trim()));re[fe]=Re}});let te=pf(b,re);if(te.length){if(_=_||{},te.forEach(function(ie){M({key:ie.key})||ie.newVal==="*"&&typeof ie.oldVal!="string"||(ie.type==="-"?_[ie.key]=void 0:ie.type==="+"&&(_[ie.key]=ie.newVal||""))}),Object.keys(_).length===0){_=null;return}ne()}}function Z(ee){ee.keyCode===9&&!ee.shiftKey&&a.selection().selectAll(".tag-list li:last-child input.value").node()===this&&si(ye(this))&&le()}function W(ee){let re=ee.datum(),te=ee.select("input.key"),ie=ee.select("input.value");if(M(re))return;if(k(re)){ie.call(xr(t,"tag-value").minItems(1).fetcher(function(Re,He){let Je=si(te);if(!b[Je])return;let ot=b[Je].filter(Boolean).map(yt=>({value:yt,title:yt}));He(ot)}));return}let oe=t.graph().geometry(T[0]);te.call(xr(t,"tag-key").fetcher(function(Re,He){s.keys({debounce:!0,geometry:oe,query:Re},function(Je,ot){if(!Je){let yt=ot.filter(bt=>b[bt.value]===void 0);He(fe(Re,yt))}})})),ie.call(xr(t,"tag-value").fetcher(function(Re,He){s.values({debounce:!0,key:si(te),geometry:oe,query:Re},function(Je,ot){Je||He(fe(Re,ot))})}));function fe(Re,He){let Je=[],ot=[];for(let yt of He)yt.value.substring(0,Re.length)===Re?Je.push(yt):ot.push(yt);return Je.concat(ot)}}function q(ee,re){if(ye(this).attr("readonly"))return;let te=re.key;if(_&&_.hasOwnProperty(te)&&_[te]===void 0)return;let ie=t.cleanTagKey(this.value.trim());if(M({key:ie})){this.value=te;return}if(ie&&ie!==te&&b[ie]!==void 0){this.value=te,a.selection().selectAll(".tag-list input.value").each((Je,ot,yt)=>{if(Je.key===ie){let bt=yt[ot];bt.focus(),bt.select()}});return}let oe=this.parentNode.parentNode,fe=ye(oe).selectAll("input.value"),Re=t.cleanTagValue(si(fe));_=_||{},te&&(_[te]=void 0),_[ie]=Re;let He=d.indexOf(te);He!==-1&&(d[He]=ie),re.key=ie,re.value=Re,this.value=ie,si(fe,Re),ne()}function Q(ee,re){M(re)||k(re)&&!this.value||_&&_.hasOwnProperty(re.key)&&_[re.key]===void 0||(_=_||{},_[re.key]=t.cleanTagValue(this.value),ne())}function V(ee,re){M(re)||(re.key===""?(g=!1,a.reRender()):(d=d.filter(te=>te!==re.key),_=_||{},_[re.key]=void 0,ne()))}function le(){window.setTimeout(function(){g=!0,a.reRender(),a.selection().selectAll(".tag-list li:last-child input.key").node().focus()},20)}function de(){m=!0}function ne(){let ee=T;window.setTimeout(function(){_&&(n.call("change",this,ee,_),_=null)},10)}return a.state=function(ee){return arguments.length?(v!==ee&&(m=!1,d=[],v=ee),a):v},a.presets=function(ee){return arguments.length?(E=ee,E&&E.length&&E[0].isFallback()||m?a.disclosureExpandOverride(!0):a.disclosureExpandOverride(void 0),a):E},a.tags=function(ee){return arguments.length?(b=ee,a):b},a.entityIDs=function(ee){return arguments.length?((!T||!ee||!jn(T,ee))&&(m=!1,d=[],T=ee),a):T},a.readOnlyTags=function(ee){return arguments.length?(c=ee,a):c},$t(a,n,"on")}var uO=[/^changesets_count$/,/^created_by$/,/^ideditor:/,/^imagery_used$/,/^host$/,/^locale$/,/^rapid:poweruser$/,/^warnings:/,/^resolved:/,/^closed:note$/,/^closed:keepright$/,/^closed:improveosm:/,/^closed:osmose:/],hO=/(#[^\u2000-\u206F\u2E00-\u2E7F\s\\'!"#$%()*,.\/:;<=>?@\[\]^`{|}~]+)/g;function I_(t){let e=t.systems.rapid,i=t.systems.storage,r=t.systems.uploader,s=Pt("cancel"),n,o,a=S_(t).on("change",b),l=Ah(t,"changeset-tag-editor").on("change",b).readOnlyTags(uO),c=A_(t),d=C_(t);function m(k){o=k,r.changeset||g(),_(),k.call(v)}function g(){let k=t.systems.l10n.localeCode(),F=+i.getItem("commentDate")||0,O=Date.now(),B=2*86400*1e3;(F>O||O-F>B)&&(i.removeItem("comment"),i.removeItem("hashtags"),i.removeItem("source"));let U=t.systems.urlhash,z=U.initialHashParams.get("comment"),Z=U.initialHashParams.get("source"),W=U.initialHashParams.get("hashtags");z&&(i.setItem("comment",z),i.setItem("commentDate",Date.now())),Z&&(i.setItem("source",Z),i.setItem("commentDate",Date.now())),W&&(i.setItem("hashtags",W),i.setItem("commentDate",Date.now()));let q=Gs(),Q={comment:i.getItem("comment")||"",created_by:t.cleanTagValue("Rapid "+t.version),host:t.cleanTagValue(q.host),locale:t.cleanTagValue(k)};T(Q,!0);let V=i.getItem("hashtags");V&&(Q.hashtags=V);let le=i.getItem("source");le&&(Q.source=le),r.changeset=new ia({tags:Q})}function _(){let k=t.services.osm;if(!k)return;let F=Object.assign({},r.changeset.tags),O=new Set((F.source||"").split(";"));e.hadPoweruser?F["rapid:poweruser"]="true":delete F["rapid:poweruser"];let B=new Set(t.systems.edits.photosUsed());["streetside","mapillary","mapillary-map-features","mapillary-signs","kartaview"].forEach(function(ie){O.delete(ie)}),B.size?(O.add("streetlevel imagery"),B.forEach(function(ie){O.add(ie)})):O.delete("streetlevel imagery");let z=e.sources;["mapwithai","esri"].forEach(function(ie){O.delete(ie)}),z.forEach(function(ie){O.add(ie)});let W=t.cleanTagValue(Array.from(O).filter(Boolean).join(";"));W?F.source=W:delete F.source;let q=new Set(t.systems.edits.imageryUsed()),Q=t.cleanTagValue(Array.from(q).filter(Boolean).join(";"));F.imagery_used=Q||"None";let V=k.getClosedIDs();V.length&&(F["closed:note"]=t.cleanTagValue(V.join(";")));let le=t.services.keepRight;if(le){let ie=le.getClosedIDs();ie.length&&(F["closed:keepright"]=t.cleanTagValue(ie.join(";")))}let de=t.services.improveOSM;if(de){let ie=de.getClosedCounts();for(let oe in ie)F[`closed:improveosm:${oe}`]=t.cleanTagValue(ie[oe].toString())}let ne=t.services.osmose;if(ne){let ie=ne.getClosedCounts();for(let oe in ie)F[`closed:osmose:${oe}`]=t.cleanTagValue(ie[oe].toString())}for(let ie in F)ie.match(/(^warnings:)|(^resolved:)/)&&delete F[ie];function ee(ie,oe){let fe=ds(ie,"type");for(let Re in fe){let He=fe[Re];if(He[0].subtype){let Je=ds(He,"subtype");for(let ot in Je){let yt=Je[ot];F[oe+":"+Re+":"+ot]=t.cleanTagValue(yt.length.toString())}}else F[oe+":"+Re]=t.cleanTagValue(He.length.toString())}}let re=t.systems.validator.getIssuesBySeverity({what:"edited",where:"all",includeIgnored:!0,includeDisabledRules:!0}).warning.filter(ie=>ie.type!=="help_request");ee(re,"warnings");let te=t.systems.validator.getResolvedIssues();ee(te,"resolved"),r.changeset=r.changeset.update({tags:F})}function v(k){let F=t.services.osm;if(!F)return;let B=k.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");B.append("div").append("h3").html(t.tHtml("commit.title")),B.append("button").attr("class","close").on("click",function(){s.call("cancel",this)}).call(Ye("#rapid-icon-close"));let U=k.selectAll(".body").data([0]);U=U.enter().append("div").attr("class","body").merge(U);let z=U.selectAll(".changeset-editor").data([0]);z=z.enter().append("div").attr("class","modal-section changeset-editor").merge(z),z.call(a.changesetID(r.changeset.id).tags(r.changeset.tags)),U.call(d);let Z=U.selectAll(".save-section").data([0]);Z=Z.enter().append("div").attr("class","modal-section save-section fillL").merge(Z);let W=Z.selectAll(".commit-info").data([0]);W.enter().size()&&(n=null),W=W.enter().append("p").attr("class","commit-info").html(t.tHtml("commit.upload_explanation")).merge(W),F.userDetails(function(Re,He){if(Re||n===He)return;n=He;let Je=ye(document.createElement("div"));He.image_url&&Je.append("img").attr("src",He.image_url).attr("class","icon pre-text user-icon"),Je.append("a").attr("class","user-info").html(He.display_name).attr("href",F.userURL(He.display_name)).attr("target","_blank"),W.html(t.tHtml("commit.upload_explanation_with_user",{user:Je.html()}))});let q=Z.selectAll(".request-review").data([0]),Q=q.enter().append("div").attr("class","request-review"),V=fl("commit-input-request-review"),le=Q.append("label").attr("for",V);le.empty()||le.call(Ft(t).title(t.tHtml("commit.request_review_info")).placement("top")),le.append("input").attr("type","checkbox").attr("id",V),le.append("span").html(t.tHtml("commit.request_review")),q=q.merge(Q);let de=q.selectAll("input").property("checked",A(r.changeset.tags)).on("change",fe),ne=Z.selectAll(".buttons").data([0]),ee=ne.enter().append("div").attr("class","buttons fillL");ee.append("button").attr("class","secondary-action button cancel-button").append("span").attr("class","label").html(t.tHtml("commit.cancel")),ee.append("button").attr("class","action button save-button").append("span").attr("class","label").html(t.tHtml("commit.save"));let te=E();ne=ne.merge(ee),ne.selectAll(".cancel-button").on("click.cancel",function(){s.call("cancel",this)}),ne.selectAll(".save-button").classed("disabled",te!==null).on("click.save",function(){if(!ye(this).classed("disabled")){this.blur();for(let Re in r.changeset.tags)Re||delete r.changeset.tags[Re];r.save()}}),Ft(t).destroyAny(ne.selectAll(".save-button")),te&&ne.selectAll(".save-button").call(Ft(t).title(te).placement("top"));let ie=U.selectAll(".tag-section.raw-tag-editor").data([0]);ie=ie.enter().append("div").attr("class","modal-section tag-section raw-tag-editor").merge(ie),ie.call(l.tags(Object.assign({},r.changeset.tags)).render);let oe=U.selectAll(".commit-changes-section").data([0]);oe=oe.enter().append("div").attr("class","modal-section commit-changes-section").merge(oe),oe.call(c.render);function fe(){let Re=de.property("checked");M({review_requested:Re?"yes":void 0}),ie.call(l.tags(Object.assign({},r.changeset.tags)).render)}}function E(){var F,O,B;let k=t.systems.validator.getIssuesBySeverity({what:"edited",where:"all"}).error;return k.length?t.t("commit.outstanding_errors_message",{count:k.length}):((B=(O=(F=r.changeset)==null?void 0:F.tags)==null?void 0:O.comment)!=null?B:"").trim().length?null:t.t("commit.comment_needed_message")}function b(k,F,O){F.hasOwnProperty("comment")&&(F.comment===void 0&&(F.comment=""),O||(i.setItem("comment",F.comment),i.setItem("commentDate",Date.now()))),F.hasOwnProperty("source")&&(F.source===void 0?i.removeItem("source"):O||(i.setItem("source",F.source),i.setItem("commentDate",Date.now()))),M(F,O),o&&o.call(v)}function T(k,F){let O=U();O.length&&i.removeItem("hashtags"),(!O.length||!F)&&(O=O.concat(z()));let B=new Set;return O.filter(Z=>{let W=Z.toLowerCase();return B.has(W)?!1:(B.add(W),!0)});function U(){return(k.comment||"").replace(/http\S*/g,"").match(hO)||[]}function z(){return(k.hashtags||"").split(/[,;\s]+/).map(function(W){W[0]!=="#"&&(W="#"+W);let q=W.match(hO);return q&&q[0]}).filter(Boolean)||[]}}function A(k){let F=k.review_requested;return F===void 0?!1:(F=F.trim().toLowerCase(),!(F===""||F==="no"))}function M(k,F){let O=Object.assign({},r.changeset.tags);if(Object.keys(k).forEach(function(B){let U=k[B];B=t.cleanTagKey(B),uO.indexOf(B)===-1&&(U===void 0?delete O[B]:F?O[B]=U:O[B]=t.cleanTagValue(U))}),!F){let B=k.hasOwnProperty("comment")&&k.comment!=="",U=T(O,B);U.length?(O.hashtags=t.cleanTagValue(U.join(";")),i.setItem("hashtags",O.hashtags)):(delete O.hashtags,i.removeItem("hashtags"))}if(n&&n.changesets_count!==void 0){let B=parseInt(n.changesets_count,10)+1;if(O.changesets_count=String(B),B<=100){let U;U=i.getItem("walkthrough_completed"),U&&(O["ideditor:walkthrough_completed"]=U),U=i.getItem("walkthrough_progress"),U&&(O["ideditor:walkthrough_progress"]=U),U=i.getItem("walkthrough_started"),U&&(O["ideditor:walkthrough_started"]=U)}}else delete O.changesets_count;(0,dO.default)(r.changeset.tags,O)||(r.changeset=r.changeset.update({tags:O}))}return $t(m,s,"on")}function Ch(t,e){let i=Ts(e);i.select(".modal").classed("modal-alert",!0);let r=i.select(".content");r.append("div").attr("class","modal-section header"),r.append("div").attr("class","modal-section message-text");let s=r.append("div").attr("class","modal-section buttons cf");return i.okButton=function(){return s.append("button").attr("class","button ok-button action").on("click.confirm",()=>i.remove()).text(t.t("confirm.okay")).node().focus(),i},i}function k_(t){var e=Pt("cancel","save"),i=$i("conflicts"),r,s,n;function o(){ye(document).call(i.on("\u238B",c,!0))}function a(){ye(document).call(i.unbind)}function l(){a(),e.call("save")}function c(){a(),e.call("cancel")}function d(E){o();var b=E.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");b.append("button").attr("class","fr").on("click",c).call(Ye("#rapid-icon-close")),b.append("h3").html(t.tHtml("save.conflict.header"));var T=E.selectAll(".body").data([0]).enter().append("div").attr("class","body fillL"),A=T.append("div").attr("class","conflicts-help").html(t.tHtml("save.conflict.help")),M=Gs(),k=new ia;delete k.id;var F=ru.stringify(k.osmChangeJXON(r)),O=new Blob([F],{type:"text/xml;charset=utf-8;"}),B="changes.osc",U=A.selectAll(".download-changes").append("a").attr("class","download-changes");M.download?U.attr("href",window.URL.createObjectURL(O)).attr("download",B):U.attr("target","_blank").on("click.download",function(){navigator.msSaveBlob(O,B)}),U.call(Ye("#rapid-icon-load","inline")).append("span").html(t.tHtml("save.conflict.download_changes")),T.append("div").attr("class","conflict-container fillL3").call(m,0),T.append("div").attr("class","conflicts-done").attr("opacity",0).style("display","none").html(t.tHtml("save.conflict.done"));var z=T.append("div").attr("class","buttons col12 joined conflicts-buttons");z.append("button").attr("disabled",s.length>1).attr("class","action conflicts-button col6").html(t.tHtml("save.title")).on("click.try_again",l),z.append("button").attr("class","secondary-action conflicts-button col6").html(t.tHtml("confirm.cancel")).on("click.cancel",c)}function m(E,b){b=L2(b,s.length),n=b;var T=ye(E.node().parentNode);b===s.length-1&&window.setTimeout(function(){T.select(".conflicts-button").attr("disabled",null),T.select(".conflicts-done").transition().attr("opacity",1).style("display","block")},250);var A=E.selectAll(".conflict").data([s[b]]);A.exit().remove();var M=A.enter().append("div").attr("class","conflict");M.append("h4").attr("class","conflict-count").html(t.tHtml("save.conflict.count",{num:b+1,total:s.length})),M.append("a").attr("class","conflict-description").attr("href","#").html(function(F){return F.name}).on("click",function(F,O){F.preventDefault(),v(O.id)});var k=M.append("div").attr("class","conflict-detail-container");k.append("ul").attr("class","conflict-detail-list").selectAll("li").data(function(F){return F.details||[]}).enter().append("li").attr("class","conflict-detail-item").html(function(F){return F}),k.append("div").attr("class","conflict-choices").call(g),k.append("div").attr("class","conflict-nav-buttons joined cf").selectAll("button").data(["previous","next"]).enter().append("button").html(function(F){return t.tHtml("save.conflict."+F)}).attr("class","conflict-nav-button action col6").attr("disabled",function(F,O){return O===0&&b===0||O===1&&b===s.length-1||null}).on("click",function(F,O){F.preventDefault();var B=T.selectAll(".conflict-container"),U=O==="previous"?-1:1;B.selectAll(".conflict").remove(),B.call(m,b+U)})}function g(E){var b=E.append("ul").attr("class","layer-list").selectAll("li").data(function(M){return M.choices||[]}),T=b.enter().append("li").attr("class","layer"),A=T.append("label");A.append("input").attr("type","radio").attr("name",function(M){return M.id}).on("change",function(M,k){var F=this.parentNode.parentNode.parentNode;F.__data__.chosen=k.id,_(M,F,k)}),A.append("span").html(function(M){return M.text}),T.merge(b).each(function(M){var k=this.parentNode;k.__data__.chosen===M.id&&_(null,k,M)})}function _(E,b,T){E&&E.preventDefault(),ye(b).selectAll("li").classed("active",function(k){return k===T}).selectAll("input").property("checked",function(k){return k===T});var A=new mt,M;M=t.graph().hasEntity(T.id),M&&(A=A.extend(M.extent(t.graph()))),T.action(),M=t.graph().hasEntity(T.id),M&&(A=A.extend(M.extent(t.graph()))),v(T.id,A)}function v(E,b){t.surface().selectAll(".hover").classed("hover",!1);var T=t.graph().hasEntity(E);T&&(b?t.systems.map.trimmedExtent(b):t.systems.map.fitEntitiesEase(T),t.surface().selectAll(Qh([T.id],t.graph())).classed("hover",!0))}return d.conflictList=function(E){return arguments.length?(s=E,d):s},d.origChanges=function(E){return arguments.length?(r=E,d):r},d.shownEntityIds=function(){return s&&typeof n=="number"?[s[n].id]:[]},$t(d,e,"on")}function M_(t){var e=t.services.osm,i=Gr(function(){o()},1e3),r=4,s=!1,n=ye(null);function o(){if(!e)return;let a={};t.systems.edits.intersects(t.systems.map.extent()).forEach(function(v){v&&v.user&&(a[v.user]=!0)});let c=Object.keys(a),d=c.slice(0,c.length>r?r-1:r);n.html("").call(Ye("#rapid-icon-nearby","pre-text light"));var m=ye(document.createElement("span"));if(m.selectAll().data(d).enter().append("a").attr("class","user-link").attr("href",function(v){return e.userURL(v)}).attr("target","_blank").html(String),c.length>r){var g=ye(document.createElement("span")),_=c.length-r+1;g.append("a").attr("target","_blank").attr("href",function(){return e.changesetsURL(t.systems.map.center(),t.systems.map.zoom())}).html(_),n.append("span").html(t.tHtml("contributors.truncated_list",{n:_,users:m.html(),count:g.html()}))}else n.append("span").html(t.tHtml("contributors.list",{users:m.html()}));c.length?s&&n.transition().style("opacity",1):(s=!0,n.transition().style("opacity",0))}return function(a){e&&(n=a,o(),e.on("loaded.contributors",i),t.systems.map.on("draw",i))}}function P_(t){let e;function i(r){let s=r.selectAll(".data-header").data(e?[e]:[],a=>a.__featurehash__);s.exit().remove();let n=s.enter().append("div").attr("class","data-header");n.append("div").attr("class","data-header-icon").append("div").attr("class","preset-icon-28").call(Ye("#rapid-icon-data")),n.append("div").attr("class","data-header-label").html(t.tHtml("map_data.layers.custom.title"))}return i.datum=function(r){return arguments.length?(e=r,this):e},i}function j4(t){let e=P_(t),i=Ah(t,"custom-data-tag-editor").readOnlyTags([/./]),r;function s(n){let a=n.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");a.append("button").attr("class","close").on("click",()=>t.enter("browse")).call(Ye("#rapid-icon-close")),a.append("h3").html(t.tHtml("map_data.title"));let l=n.selectAll(".body").data([0]);l=l.enter().append("div").attr("class","body").merge(l);let c=l.selectAll(".data-editor").data([0]);c.enter().append("div").attr("class","modal-section data-editor").merge(c).call(e.datum(r));let d=l.selectAll(".data-tag-editor").data([0]);d.enter().append("div").attr("class","data-tag-editor").merge(d).call(i.tags(r&&r.properties||{}).state("hover").render).selectAll("textarea.tag-text").attr("readonly",!0).classed("readonly",!0)}return s.datum=function(n){return arguments.length?(r=n,this):r},s}var X4=class{constructor(e){this.context=e,this.parent=ye(null),this.spritesheetIDs=["rapid","maki","temaki","fa","roentgen","community","mapillary-object","mapillary"],this.render=this.render.bind(this),this._spritesheetLoaded=this._spritesheetLoaded.bind(this)}render(e){let i=this.context;this.parent=e;let r=e.selectAll("defs").data([0]),s=r.enter().append("defs");r.merge(s).selectAll(".spritesheet").data(this.spritesheetIDs,n=>n).enter().append("g").attr("class",n=>`spritesheet spritesheet-${n}`).each((n,o,a)=>{let l=ye(a[o]),c=i.asset(`img/${n}-sprite.svg`);fetch(c).then(Ai).then(d=>l.call(this._spritesheetLoaded,n,d)).catch(d=>console.error(d))})}_spritesheetLoaded(e,i,r){var a;let s=e.node(),n=r.documentElement;n.setAttribute("id",i),s.appendChild(n),["maki","temaki","fa","roentgen","community"].includes(i)&&e.selectAll("path").attr("fill","currentColor");let o=(a=this.context.systems.map.renderer)==null?void 0:a.textures;if(!o)throw new Error(`TextureManager not ready to pack icons for ${i}`);e.selectAll("symbol").each((l,c,d)=>{let m=d[c],g=m.getAttribute("id"),_=m.getAttribute("viewBox"),v=32,b=`<svg xmlns="http://www.w3.org/2000/svg" height="${v}" width="${v}" color="#fff" viewBox="${_}">${m.innerHTML}</svg>`;o.addSvgIcon(g,b)})}};function R_(t){let e=Pt("toggled"),i=85,r=45,s=35,n=10,o=4,a=210,l=ye(null),c=[],d=[0,0],m=0,g="",_=!1,v,E,b=[],T=function(M){g===void 0&&(g="rightclick");let k=g.includes("touch")||g.includes("pen"),F=c.filter(Q=>!k||!Q.mouseOnly);if(!F.length)return;b=[],_=k;let O=!0,B=O?32:34;O?E=52+Math.min(120,6*Math.max.apply(Math,F.map(function(Q){return Q.title.length}))):E=44,v=o*2+F.length*B,m=t.projection.scale(),l=M.append("div").attr("class","edit-menu").classed("touch-menu",k).style("padding",o+"px 0");let U=l.selectAll(".edit-menu-item").data(F),z=U.enter().append("button").attr("class",Q=>`edit-menu-item edit-menu-item-${Q.id}`).style("height",`${B}px`).on("click",q).on("pointerup",W).on("pointerdown mousedown",function(Q){Q.stopPropagation()}).on("mouseenter.highlight",function(Q,V){!V.relatedEntityIds||ye(this).classed("disabled")||Ki(V.relatedEntityIds(),!0,t)}).on("mouseleave.highlight",function(Q,V){V.relatedEntityIds&&Ki(V.relatedEntityIds(),!1,t)});z.each((Q,V,le)=>{let de=Ft(t).heading(Q.title).title(Q.tooltip()).keys([Q.keys[0]]);b.push(de),ye(le[V]).call(de).append("div").attr("class","icon-wrap").call(Ye(`#rapid-operation-${Q.id}`,"operation"))}),O&&z.append("span").attr("class","label").html(Q=>Q.title),z.merge(U).classed("disabled",Q=>Q.disabled()),A(),t.systems.map.on("move",A);let Z;function W(Q){Z=Q.pointerType}function q(Q,V){Q.stopPropagation(),V.relatedEntityIds&&Ki(V.relatedEntityIds(),!1,t),V.disabled()?(Z==="touch"||Z==="pen")&&t.systems.ui.flash.duration(4e3).iconName(`#rapid-operation-${V.id}`).iconClass("operation disabled").label(V.tooltip)():((Z==="touch"||Z==="pen")&&t.systems.ui.flash.duration(2e3).iconName(`#rapid-operation-${V.id}`).iconClass("operation").label(V.annotation()||V.title)(),V(),T.close()),Z=null}e.call("toggled",this,!0)};function A(){if(!l||l.empty())return;if(m!==t.projection.scale()){T.close();return}let M=t.projection.project(d),k=t.surfaceRect();if(M[0]<0||M[0]>k.width||M[1]<0||M[1]>k.height){T.close();return}let F=Z(k),O=[0,0];O[0]=F?-1*(n+E):n,_?M[1]-v<i?O[1]=-M[1]+i:O[1]=-v:M[1]+v>k.height-r?O[1]=-M[1]-v+k.height-r:O[1]=0;let[B,U]=Ir(M,O);l.style("left",`${B}px`).style("top",`${U}px`);let z=W(k,F);b.forEach(q=>q.placement(z));function Z(q){return t.systems.l10n.isRTL()?!(M[0]-n-E<s):M[0]+n+E>q.width-s}function W(q,Q){return t.systems.l10n.isRTL()?!Q||M[0]-n-E-a<s?"right":"left":Q||M[0]+n+E+a>q.width-s?"left":"right"}}return T.close=function(){t.systems.map.off("move",A),l.remove(),b=[],e.call("toggled",this,!1)},T.anchorLoc=function(M){return arguments.length?(d=M,T):d},T.triggerType=function(M){return arguments.length?(g=M,T):g},T.operations=function(M){return arguments.length?(c=M,T):c},$t(T,e,"on")}var FS=Yi(H2(),1);function D_(t){let e=t.systems.validator,i=t.systems.storage,s=(i.getItem("entity-issues.reference.expanded")||"true")==="true",n=[],o=[],a,l=tr(t,"entity-issues").shouldDisplay(()=>o.length).label(()=>t.t("inspector.title_count",{title:t.tHtml("issues.list_title"),count:o.length})).disclosureContent(m);function c(){o=e.getSharedEntityIssues(n,{includeDisabledRules:!0})}function d(v){a=v,l.selection().selectAll(".issue-container").classed("active",E=>E.id===a)}function m(v){v.classed("grouped-items-area",!0),a=o.length?o[0].id:null;let E=v.selectAll(".issue-container").data(o,z=>z.key);E.exit().remove();let b=E.enter().append("div").attr("class","issue-container"),T=b.append("div").attr("class",z=>`issue severity-${z.severity}`).on("mouseover.highlight",function(z,Z){let W=Z.entityIds.filter(q=>!n.includes(q));Ki(W,!0,t)}).on("mouseout.highlight",function(z,Z){let W=Z.entityIds.filter(q=>!n.includes(q));Ki(W,!1,t)}),A=T.append("div").attr("class","issue-label"),M=A.append("button").attr("class","issue-text").on("click",function(z,Z){d(Z.id);let W=Z.extent(t.graph());if(W){let q=Math.max(t.systems.map.zoom(),19);t.systems.map.centerZoomEase(W.center(),q)}});M.each((z,Z,W)=>{let q=z.severity==="warning"?"alert":"error";ye(W[Z]).call(Ye(`#rapid-icon-${q}`,"issue-icon"))}),M.append("span").attr("class","issue-message"),A.append("button").attr("class","issue-info-button").attr("title",t.t("icons.information")).call(Ye("#rapid-icon-inspect")).on("click",function(z){z.stopPropagation(),z.preventDefault(),this.blur();let W=ye(this.parentNode.parentNode.parentNode).selectAll(".issue-info"),q=W.classed("expanded");s=!q,i.setItem("entity-issues.reference.expanded",s),q?W.transition().duration(200).style("max-height","0px").style("opacity","0").on("end",()=>W.classed("expanded",!1)):W.classed("expanded",!0).transition().duration(200).style("max-height","200px").style("opacity","1").on("end",()=>W.style("max-height",null))}),T.append("ul").attr("class","issue-fix-list"),b.append("div").attr("class","issue-info"+(s?" expanded":"")).style("max-height",s?null:"0").style("opacity",s?"1":"0").each((z,Z,W)=>{let q=ye(W[Z]);typeof z.reference=="function"?q.call(z.reference):q.html(t.tHtml("inspector.no_documentation_key"))}),E=E.merge(b).classed("active",z=>z.id===a),E.selectAll(".issue-message").html(z=>z.message(t));let O=E.selectAll(".issue-fix-list").selectAll(".issue-fix-item").data(z=>z.fixes?z.fixes():[],z=>z.id);O.exit().remove();let B=O.enter().append("li").attr("class","issue-fix-item"),U=B.append("button").on("click",function(z,Z){ye(this).attr("disabled")||!Z.onClick||Z.issue.dateLastRanFix&&new Date-Z.issue.dateLastRanFix<1e3||(Z.issue.dateLastRanFix=new Date,Ki(Z.issue.entityIds.concat(Z.entityIds),!1,t),new Promise(function(W,q){Z.onClick(t,W,q),Z.onClick.length<=1&&W()}).then(()=>e.validate()))}).on("mouseover.highlight",function(z,Z){Ki(Z.issue.entityIds,!0,t)}).on("mouseout.highlight",function(z,Z){Ki(Z.issue.entityIds,!1,t)});U.each((z,Z,W)=>{var Q;let q=(Q=z.icon)!=null?Q:"rapid-icon-wrench";ye(W[Z]).call(Ye(`#${q}`,"fix-icon"))}),U.append("span").attr("class","fix-message").html(z=>z.title),B.merge(O).selectAll("button").classed("actionable",z=>typeof z.onClick=="function").attr("disabled",z=>typeof z.onClick=="function"?null:"true").attr("title",z=>{var Z;return(Z=z.disabledReason)!=null?Z:null})}let g=()=>{c(),l.reRender()},_=v=>{d(v.id)};return e.on("validated",g),e.on("focusedIssue",_),l.entityIDs=function(v){return v===void 0?n:((!n||!v||!jn(n,v))&&(n=v,a=null,c()),l)},l}function l0(t){let e,i;function r(v,E){return v.icon?v.icon:E==="line"?"rapid-other-line":E==="vertex"?v.isFallback()?"":"temaki-vertex":"maki-marker-stroked"}function s(v,E){let T=new mi(E.fill.color).toHex(),A=E.fill.alpha,M="M9.5,7.5 L25.5,7.5 L28.5,12.5 L49.5,12.5 C51.709139,12.5 53.5,14.290861 53.5,16.5 L53.5,43.5 C53.5,45.709139 51.709139,47.5 49.5,47.5 L10.5,47.5 C8.290861,47.5 6.5,45.709139 6.5,43.5 L6.5,12.5 L9.5,7.5 Z";v.append("svg").attr("class","preset-icon-category-border").attr("width","60px").attr("height","60px").attr("viewBox","0 0 60 60").append("path").attr("fill",T).attr("fill-opacity",A).attr("stroke",T).attr("d",M)}function n(v){let b="M 0,0 C -2,-2 -8,-10 -8,-15 C -8,-19 -4,-23 0,-23 C 4,-23 8,-19 8,-15 C 8,-10 2,-2 0,0 Z";v.append("svg").attr("class","preset-icon-point-border").attr("width","60px").attr("height","60px").attr("viewBox","-10 -27 20 30").append("path").attr("d",b)}function o(v){v.append("svg").attr("class","preset-icon-vertex-border").attr("width","60px").attr("height","60px").attr("viewBox","0 0 60 60").append("circle").attr("cx",30).attr("cy",30).attr("r",40/2)}function a(v,E){let F=new mi(E.fill.color).toHex(),O=E.fill.alpha,B=v.append("svg").attr("class","preset-icon-area-border").attr("width","60px").attr("height","60px").attr("viewBox","0 0 60 60");B.append("path").attr("fill",F).attr("fill-opacity",O).attr("stroke",F).attr("d","M10 10 L10 50 L50 50 L50 10 Z");let U=2.5;[[10,10],[10,50],[50,50],[50,10]].forEach(([Z,W])=>{B.append("circle").attr("class","vertex").attr("cx",Z).attr("cy",W).attr("r",U)});let z=1.25;[[10,30],[50,30],[30,10],[30,50]].forEach(([Z,W])=>{B.append("circle").attr("class","midpoint").attr("cx",Z).attr("cy",W).attr("r",z)})}function l(v,E){let T=Math.round(43.199999999999996),A=Math.round(60*.6),M=(60-A)/2,k=M+A,F=new mi(E.casing.color).toHex(),O=new mi(E.stroke.color).toHex(),B=E.stroke.dash,U=Array.isArray(B),z=v.append("svg").attr("class","preset-icon-line").attr("width","60px").attr("height","60px").attr("viewBox","0 0 60 60");z.append("path").attr("class","casing").attr("stroke",F).attr("stroke-opacity",U?1:.5).attr("d",`M${M} ${T} L${k} ${T}`),z.append("path").attr("class","stroke").attr("stroke",O).attr("stroke-dasharray",U?B.map(W=>W*.75).join(" "):null).attr("d",`M${M} ${T} L${k} ${T}`);let Z=3;[[M-1,T],[k+1,T]].forEach(([W,q])=>{z.append("circle").attr("class","vertex").attr("cx",W).attr("cy",q).attr("r",Z)})}function c(v){v.append("div").attr("class","preset-icon-route").call(Ye("#rapid-route","rapid-icon lowered"))}function d(v,E,b,T){v.append("div").attr("class","preset-icon").call(Ye(`#${E}`,b.join(" "))),v.selectAll(".preset-icon svg.icon").attr("color",T)}function m(v,E){v.selectAll("img.image-icon").data([E]).enter().append("img").attr("class","image-icon").attr("src",E).on("load",()=>v.classed("showing-img",!0)).on("error",()=>v.classed("showing-img",!1))}function g(v){var V;let E=v.selectAll(".preset-icon-container").data([0]);E=E.enter().append("div").attr("class","preset-icon-container").merge(E).html("");let b=e,T=i;if(!b||!T)return;let A=typeof b.setTags=="function",M=!A,k=A?b.setTags({},T):{};for(let le in k)k[le]==="*"&&(k[le]="yes");T==="relation"&&(k.type==="route"||k.type==="waterway")&&(T="route");let B=((V=t.systems.storage.getItem("preferences.privacy.thirdpartyicons"))!=null?V:"true")==="true"&&b.imageURL,U=r(b,T),z=A&&T==="vertex",Z=A&&T==="line",W=A&&T==="area",q=A&&T==="route"&&b.id!=="type/route",Q=Sh(k);if(E.classed("showing-img",!!B),M&&s(E,Q),z&&o(E),W&&a(E,Q),Z&&l(E,Q),q&&c(E),U){let le=Z||q,de=M||Z||q,ne=/^rapid-/.test(U),ee=[];ne&&ee.push("rapid-icon"),de&&ee.push("shrunk"),le&&ee.push("raised");let re="#333";(Z||q)&&ne&&(re=new mi(Q.stroke.color).toHex()),d(E,U,ee,re)}B&&m(E,B)}_.preset=function(v){return arguments.length?(e=v,_):e},_.geometry=function(v){return arguments.length?(i=v,_):i};function _(v){v.call(g)}return _}function F_(t){let e=Pt("choose"),i=[],r=[],s,n=tr(t,"feature-type").label(t.tHtml("inspector.feature_type")).disclosureContent(o);function o(l){l.classed("preset-list-item",!0),l.classed("mixed-types",r.length>1);let c=l.selectAll(".preset-list-button-wrap").data([0]).enter().append("div").attr("class","preset-list-button-wrap"),d=c.append("button").attr("class","preset-list-button preset-reset").call(Ft(t).title(t.tHtml("inspector.back_tooltip")).placement("bottom"));d.append("div").attr("class","preset-icon-container"),d.append("div").attr("class","label").append("div").attr("class","label-inner"),c.append("div").attr("class","accessory-buttons");let m=l.selectAll(".tag-reference-body-wrap").data([0]);m=m.enter().append("div").attr("class","tag-reference-body-wrap").merge(m),s&&(l.selectAll(".preset-list-button-wrap .accessory-buttons").style("display",r.length===1?null:"none").call(s.button),m.style("display",r.length===1?null:"none").call(s.body)),l.selectAll(".preset-reset").on("click",function(){e.call("choose",this,r)}).on("pointerdown pointerup mousedown mouseup",function(b){b.preventDefault(),b.stopPropagation()});let g=a();l.select(".preset-list-item button").call(l0(t).geometry(r.length===1?g.length===1&&g[0]:null).preset(r.length===1?r[0]:t.systems.presets.item("point")));let _=r.length===1?[r[0].nameLabel(),r[0].subtitleLabel()].filter(Boolean):[t.t("inspector.multiple_types")],E=l.select(".label-inner").selectAll(".namepart").data(_,b=>b);E.exit().remove(),E.enter().append("div").attr("class","namepart").html(b=>b)}n.entityIDs=function(l){return arguments.length?(i=l,n):i},n.presets=function(l){return arguments.length?(jn(l,r)||(r=l,r.length===1&&(s=iu(t,r[0].reference()).showing(!1))),n):r};function a(){let l={};for(let c of i){let d=t.graph().geometry(c);l[d]||(l[d]=0),l[d]+=1}return Object.keys(l).sort((c,d)=>l[d]-l[c])}return $t(n,e,"on")}function L_(t){let e=tr(t,"preset-fields").label(t.tHtml("inspector.fields")).disclosureContent(c),i=Pt("change","revert"),r=H4(t),s,n,o=[],a,l;function c(d){if(!n){let m=t.graph(),g=t.systems.presets,_=Object.keys(l.reduce((O,B)=>(O[m.entity(B).geometry(m)]=!0,O),{})),v=[],E=[],b;for(let O of o){let B=O.fields(),U=O.moreFields();v=as(v,B),E=as(E,U),b?b=b.filter(z=>B.includes(z)||U.includes(z)):b=as(B,U)}let T=v.filter(O=>b.includes(O)),A=E.filter(O=>b.includes(O));n=[];for(let O of T)O.matchAllGeometry(_)&&n.push(new Ma(t,O,l));let M=t.systems.l10n.localeCode(),k=as(A,g.universal());k.sort((O,B)=>O.label().localeCompare(B.label(),M));for(let O of k)!T.includes(O)&&O.matchAllGeometry(_)&&n.push(new Ma(t,O,l,{show:!1}));let F=l.slice();for(let O of n)O.on("change",(B,U)=>{i.call("change",O,F,B,U)}),O.on("revert",B=>{i.call("revert",O,B)})}for(let m of n)m.state(s).tags(a);d.call(r.fieldsArr(n).state(s).klass("grouped-items-area")),d.selectAll(".wrap-form-field input").on("keydown",function(m){m.keyCode===13&&t.container().select(".combobox").empty()&&t.enter("browse")})}return e.presets=function(d){return arguments.length?((!o||!d||!jn(o,d))&&(o=d,n=null),e):o},e.state=function(d){return arguments.length?(s=d,e):s},e.tags=function(d){return arguments.length?(a=d,e):a},e.entityIDs=function(d){return arguments.length?((!d||!l||!jn(l,d))&&(l=d,n=null),e):l},$t(e,i,"on")}var RS=1e3;function N_(t){let e=t.systems.l10n;var i=tr(t,"raw-member-editor").shouldDisplay(function(){if(!s||s.length!==1)return!1;var m=t.hasEntity(s[0]);return m&&m.type==="relation"}).label(function(){var m=t.hasEntity(s[0]);if(!m)return"";var g=m.members.length>RS?">":"",_=g+m.members.slice(0,RS).length;return e.t("inspector.title_count",{title:e.tHtml("inspector.members"),count:_})}).disclosureContent(d),r=t.services.taginfo,s;function n(m,g){m.preventDefault(),ye(this.parentNode).classed("tag-reference-loading",!0),t.loadEntity(g.id,function(){i.reRender()})}function o(m,g){m.preventDefault();var _=t.entity(g.id);t.systems.map.fitEntitiesEase(_),Ki([g.id],!0,t)}function a(m,g){m.preventDefault(),Ki([g.id],!1,t);var _=t.entity(g.id),v=t.systems.map.extent();_.intersects(v,t.graph())||t.systems.map.fitEntitiesEase(_),t.enter("select-osm",{selectedIDs:[g.id]})}function l(m,g){var _=g.role,v=t.cleanRelationRole(ye(this).property("value"));if(_!==v){var E={id:g.id,type:g.type,role:v};t.perform(hh(g.relation.id,E,g.index),e.t("operations.change_role.annotation",{n:1})),t.systems.validator.validate()}}function c(m,g){Ki([g.id],!1,t),t.perform(dh(g.relation.id,g.index),e.t("operations.delete_member.annotation",{n:1})),t.hasEntity(g.relation.id)?t.systems.validator.validate():t.enter("browse")}function d(m){var g=s[0],_=[],v=t.entity(g);v.members.slice(0,RS).forEach(function(B,U){_.push({index:U,id:B.id,type:B.type,role:B.role,relation:v,member:t.hasEntity(B.id),uid:fl(g+"-member-"+U)})});var E=m.selectAll(".member-list").data([0]);E=E.enter().append("ul").attr("class","member-list").merge(E);var b=E.selectAll("li").data(_,function(B){return Dt.key(B.relation)+","+B.index+","+(B.member?Dt.key(B.member):"incomplete")});b.exit().each(O).remove();var T=b.enter().append("li").attr("class","member-row form-field").classed("member-incomplete",function(B){return!B.member});T.each(function(B){var U=ye(this),z=U.append("label").attr("class","field-label").attr("for",B.uid);if(B.member){U.on("mouseover",function(){Ki([B.id],!0,t)}).on("mouseout",function(){Ki([B.id],!1,t)});var Z=z.append("span").attr("class","label-text").append("a").attr("href","#").on("click",a);Z.append("span").attr("class","member-entity-type").html(function(q){var Q=t.systems.presets.match(q.member,t.graph());return Q&&Q.name()||e.displayType(q.member.id)}),Z.append("span").attr("class","member-entity-name").html(q=>q.member?e.displayName(q.member.tags):""),z.append("button").attr("title",e.t("icons.remove")).attr("class","remove member-delete").call(Ye("#rapid-operation-delete")),z.append("button").attr("class","member-zoom").attr("title",e.t("icons.zoom_to")).call(Ye("#rapid-icon-framed-dot","monochrome")).on("click",o)}else{var W=z.append("span").attr("class","label-text");W.append("span").attr("class","member-entity-type").html(e.tHtml("inspector."+B.type,{id:B.id})),W.append("span").attr("class","member-entity-name").html(e.tHtml("inspector.incomplete",{id:B.id})),z.append("button").attr("class","member-download").attr("title",e.t("icons.download")).call(Ye("#rapid-icon-load")).on("click",n)}});var A=T.append("div").attr("class","form-field-input-wrap form-field-input-member");A.append("input").attr("class","member-role").attr("id",B=>B.uid).property("type","text").attr("placeholder",e.t("inspector.role")).call(Ri),r&&A.each(F),b=b.merge(T).order(),b.select("input.member-role").property("value",B=>B.role).on("blur",l).on("change",l),b.select("button.member-delete").on("click",c);var M,k;b.call(F3().on("start",function(B){M={x:B.x,y:B.y},k=null}).on("drag",function(B){var U=B.x-M.x,z=B.y-M.y;if(!(!ye(this).classed("dragging")&&Math.sqrt(Math.pow(U,2)+Math.pow(z,2))<=5)){var Z=b.nodes().indexOf(this);ye(this).classed("dragging",!0),k=null,m.selectAll("li.member-row").style("transform",function(W,q){var Q=ye(this).node();return Z===q?"translate("+U+"px, "+z+"px)":q>Z&&B.y>Q.offsetTop?((k===null||q>k)&&(k=q),"translateY(-100%)"):q<Z&&B.y<Q.offsetTop+Q.offsetHeight?((k===null||q<k)&&(k=q),"translateY(100%)"):null})}}).on("end",function(B,U){if(ye(this).classed("dragging")){var z=b.nodes().indexOf(this);ye(this).classed("dragging",!1),m.selectAll("li.member-row").style("transform",null),k!==null&&(t.perform(Hg(U.relation.id,z,k),e.t("operations.reorder_members.annotation")),t.systems.validator.validate())}}));function F(B){var U=ye(this),z=U.selectAll("input.member-role"),Z=z.property("value");function W(q,Q){for(var V=[],le=[],de=0;de<Q.length;de++)Q[de].value.substring(0,q.length)===q?V.push(Q[de]):le.push(Q[de]);return V.concat(le)}z.call(xr(t,"member-role").fetcher(function(q,Q){var V;B.member?V=t.graph().geometry(B.member.id):B.type==="relation"?V="relation":B.type==="way"?V="line":V="point";var le=v.tags.type;r.roles({debounce:!0,rtype:le||"",geometry:V,query:q},function(de,ne){de||Q(W(q,ne))})}).on("cancel",function(){z.property("value",Z)}))}function O(){var B=ye(this);B.selectAll("input.member-role").call(xr.off,t)}}return i.entityIDs=function(m){return arguments.length?(s=m,i):s},i}function fO(t,e){return function(i){e.sort((s,n)=>n-s);for(var r in e)i=dh(t,e[r])(i);return i}}var DS=1e3;function O_(t){let e=t.systems.l10n;var i=t.systems.presets,r=tr(t,"raw-membership-editor").shouldDisplay(function(){return a&&a.length}).label(function(){var A=c(),M=A.length>DS?">":"",k=M+A.slice(0,DS).length;return e.t("inspector.title_count",{title:e.tHtml("inspector.relations"),count:k})}).disclosureContent(T),s=t.services.taginfo,n=xr(t,"parent-relation").minItems(1).fetcher(b).itemsMouseEnter(function(A,M){M.relation&&Ki([M.relation.id],!0,t)}).itemsMouseLeave(function(A,M){M.relation&&Ki([M.relation.id],!1,t)}),o=!1,a=[],l;function c(){for(var A=[],M=0;M<a.length;M++){var k=t.graph().hasEntity(a[M]);if(k&&(M===0?A=t.graph().parentRelations(k):A=eo(A,t.graph().parentRelations(k)),!A.length))break}return A}function d(){var A=[],M=c().slice(0,DS),k=a.length>1,F,O,B,U,z,Z;for(F=0;F<M.length;F++){for(O=M[F],B={relation:O,members:[],hash:Dt.key(O)},U=0;U<O.members.length;U++)z=O.members[U],a.indexOf(z.id)!==-1&&(Z=Object.assign({},z,{index:U}),B.members.push(Z),B.hash+=","+U.toString(),k||(A.push(B),B={relation:O,members:[],hash:Dt.key(O)}));B.members.length&&A.push(B)}return A.forEach(function(W){W.uid=fl("membership-"+W.relation.id);var q=[];W.members.forEach(function(Q){q.indexOf(Q.role)===-1&&q.push(Q.role)}),W.role=q.length===1?q[0]:q}),A}function m(A,M){A.preventDefault(),Ki([M.relation.id],!1,t),t.enter("select-osm",{selectedIDs:[M.relation.id]})}function g(A,M){A.preventDefault();var k=t.entity(M.relation.id);t.systems.map.fitEntitiesEase(k),Ki([M.relation.id],!0,t)}function _(A,M){if(M!==0&&!o){var k=t.cleanRelationRole(ye(this).property("value"));if(!(!k.trim()&&typeof M.role!="string")){var F=M.members.filter(function(O){return O.role!==k});F.length&&(o=!0,t.perform(function(B){return F.forEach(function(U){var z=Object.assign({},U,{role:k});delete z.index,B=hh(M.relation.id,z,U.index)(B)}),B},e.t("operations.change_role.annotation",{n:F.length})),t.systems.validator.validate()),o=!1}}}function v(A,M){this.blur(),l=!1;function k(O,B,U){return function(z){for(var Z in B){var W={id:B[Z],type:z.entity(B[Z]).type,role:U};z=Nd(O,W)(z)}return z}}if(A.relation)t.perform(k(A.relation.id,a,M),e.t("operations.add_member.annotation",{n:a.length})),t.systems.validator.validate();else{var F=Ms();t.perform(Ur(F),k(F.id,a,M),e.t("operations.add.annotation.relation")),t.enter("select-osm",{selectedIDs:[F.id],newFeature:!0})}}function E(A,M){if(this.blur(),M!==0){Ki([M.relation.id],!1,t);var k=M.members.map(function(F){return F.index});t.perform(fO(M.relation.id,k),e.t("operations.delete_member.annotation",{n:a.length})),t.systems.validator.validate()}}function b(A,M){var k={relation:null,value:e.t("inspector.new_relation"),display:e.tHtml("inspector.new_relation")},F=a[0],O=[],B=t.graph();function U(W){var q=i.match(W,B),Q=q&&q.name()||e.t("inspector.relation"),V=e.displayName(W.tags)||"";return Q+" "+V}var z=A&&t.hasEntity(A.toLowerCase());if(z&&z.type==="relation"&&z.id!==F)O.push({relation:z,value:U(z)+" "+z.id});else{t.systems.edits.intersects(t.systems.map.extent()).forEach(function(W){if(!(W.type!=="relation"||W.id===F)){var q=U(W);A&&(q+" "+W.id).toLowerCase().indexOf(A.toLowerCase())===-1||O.push({relation:W,value:q})}}),O.sort(function(W,q){return Ms.creationOrder(W.relation,q.relation)});var Z=Object.values(ds(O,"value")).filter(function(W){return W.length>1});Z.forEach(function(W){W.forEach(function(q){q.value+=" "+q.relation.id})})}O.forEach(function(W){W.title=W.value}),O.unshift(k),M(O)}function T(A){var M=d(),k=A.selectAll(".member-list").data([0]);k=k.enter().append("ul").attr("class","member-list").merge(k);var F=k.selectAll("li.member-row-normal").data(M,function(ie){return ie.hash});F.exit().each(te).remove();var O=F.enter().append("li").attr("class","member-row member-row-normal form-field");O.on("mouseover",function(ie,oe){Ki([oe.relation.id],!0,t)}).on("mouseout",function(ie,oe){Ki([oe.relation.id],!1,t)});var B=O.append("label").attr("class","field-label").attr("for",function(ie){return ie.uid}),U=B.append("span").attr("class","label-text").append("a").attr("href","#").on("click",m);U.append("span").attr("class","member-entity-type").html(function(ie){var oe=i.match(ie.relation,t.graph());return oe&&oe.name()||e.t("inspector.relation")}),U.append("span").attr("class","member-entity-name").html(function(ie){let oe=i.match(ie.relation,t.graph());return e.displayName(ie.relation.tags,oe.suggestion)}),B.append("button").attr("class","remove member-delete").call(Ye("#rapid-operation-delete")).on("click",E),B.append("button").attr("class","member-zoom").attr("title",e.t("icons.zoom_to")).call(Ye("#rapid-icon-framed-dot","monochrome")).on("click",g);var z=O.append("div").attr("class","form-field-input-wrap form-field-input-member");z.append("input").attr("class","member-role").attr("id",function(ie){return ie.uid}).property("type","text").property("value",function(ie){return typeof ie.role=="string"?ie.role:""}).attr("title",function(ie){return Array.isArray(ie.role)?ie.role.filter(Boolean).join(`
`):ie.role}).attr("placeholder",function(ie){return Array.isArray(ie.role)?e.t("inspector.multiple_roles"):e.t("inspector.role")}).classed("mixed",function(ie){return Array.isArray(ie.role)}).call(Ri).on("blur",_).on("change",_),s&&z.each(re);var Z=k.selectAll(".member-row-new").data(l?[0]:[]);Z.exit().remove();var W=Z.enter().append("li").attr("class","member-row member-row-new form-field"),q=W.append("label").attr("class","field-label");q.append("input").attr("placeholder",e.t("inspector.choose_relation")).attr("type","text").attr("class","member-entity-input").call(Ri),q.append("button").attr("class","remove member-delete").call(Ye("#rapid-operation-delete")).on("click",function(){k.selectAll(".member-row-new").remove()});var Q=W.append("div").attr("class","form-field-input-wrap form-field-input-member");Q.append("input").attr("class","member-role").property("type","text").attr("placeholder",e.t("inspector.role")).call(Ri),Z=Z.merge(W),Z.selectAll(".member-entity-input").on("blur",ee).call(n.on("accept",ne).on("cancel",ee));var V=A.selectAll(".add-row").data([0]),le=V.enter().append("div").attr("class","add-row"),de=le.append("button").attr("class","add-relation");de.call(Ye("#rapid-icon-plus","light")),de.call(Ft(t).title(e.tHtml("inspector.add_to_relation")).placement(e.isRTL()?"left":"right")),le.append("div").attr("class","space-value"),le.append("div").attr("class","space-buttons"),V=V.merge(le),V.select(".add-relation").on("click",function(){l=!0,r.reRender(),k.selectAll(".member-entity-input").node().focus()});function ne(ie){if(!ie){ee();return}ie.relation&&Ki([ie.relation.id],!1,t);var oe=t.cleanRelationRole(k.selectAll(".member-row-new .member-role").property("value"));v(ie,oe)}function ee(){var ie=Z.selectAll(".member-entity-input");ie.property("value",""),t.surface().selectAll(".highlighted").classed("highlighted",!1)}function re(ie){var oe=ye(this),fe=oe.selectAll("input.member-role"),Re=fe.property("value");function He(Je,ot){for(var yt=[],bt=[],at=0;at<ot.length;at++)ot[at].value.substring(0,Je.length)===Je?yt.push(ot[at]):bt.push(ot[at]);return yt.concat(bt)}fe.call(xr(t,"member-role").fetcher(function(Je,ot){var yt=ie.relation.tags.type;s.roles({debounce:!0,rtype:yt||"",geometry:t.graph().geometry(a[0]),query:Je},function(bt,at){bt||ot(He(Je,at))})}).on("cancel",function(){fe.property("value",Re)}))}function te(){var ie=ye(this);ie.selectAll("input.member-role").call(xr.off,t)}}return r.entityIDs=function(A){return arguments.length?(a=A,l=!1,r):a},r}function B_(t){let e=t.systems.l10n,i=[],r=tr(t,"selected-features").shouldDisplay(s).label(n).disclosureContent(l);r.entityIDs=function(c){return arguments.length?(i=c,r):i};function s(){return i.length>1}function n(){return e.t("inspector.title_count",{title:e.tHtml("inspector.features"),count:i.length})}function o(c,d){t.enter("select-osm",{selectedIDs:[d.id]})}function a(c,d){let m=i.slice(),g=m.indexOf(d.id);g>-1&&(m.splice(g,1),t.enter("select-osm",{selectedIDs:m}))}function l(c){let d=c.selectAll(".feature-list").data([0]);d=d.enter().append("ul").attr("class","feature-list").merge(d);let m=i.map(E=>t.hasEntity(E)).filter(Boolean),g=d.selectAll(".feature-list-item").data(m,Dt.key);g.exit().remove();let _=g.enter().append("li").attr("class","feature-list-item").each((E,b,T)=>{ye(T[b]).on("mouseover",()=>Ki([E.id],!0,t)).on("mouseout",()=>Ki([E.id],!1,t))}),v=_.append("button").attr("class","label").on("click",o);v.append("span").attr("class","entity-geom-icon").call(Ye("","pre-text")),v.append("span").attr("class","entity-type"),v.append("span").attr("class","entity-name"),_.append("button").attr("class","close").attr("title",e.t("icons.deselect")).on("click",a).call(Ye("#rapid-icon-close")),g=g.merge(_),g.selectAll(".entity-geom-icon use").attr("href",(E,b,T)=>"#rapid-icon-"+ye(T[b])._groups[0][0].parentNode.parentNode.__data__.geometry(t.graph())),g.selectAll(".entity-type").html(E=>t.systems.presets.match(E,t.graph()).name()),g.selectAll(".entity-name").html(E=>{let b=t.entity(E.id);return e.displayName(b.tags)})}return t.systems.edits.on("change",c=>{c&&r.reRender()}),r}function U_(t){var e=Pt("choose"),i="select",r=!1,s=!1,n,o,a=[],l,c,d=!1;function m(b,T){var A={},M={},k=new Set,F=b.map(function(B){return T.hasEntity(B)}).filter(Boolean);F.forEach(function(B){var U=Object.keys(B.tags).filter(Boolean);U.forEach(function(z){k.add(z)})}),F.forEach(function(B){k.forEach(function(U){var z=B.tags[U];A.hasOwnProperty(U)?Array.isArray(A[U])?A[U].indexOf(z)===-1&&A[U].push(z):A[U]!==z&&(A[U]=[A[U],z]):A[U]=z;var Z=U+"="+z;M[Z]||(M[Z]=0),M[Z]+=1})});for(var O in A)Array.isArray(A[O])&&(A[O]=A[O].sort(function(B,U){var z=z,Z=M[z+"="+U],W=M[z+"="+B];return Z!==W?Z-W:U&&B?B.localeCompare(U):B?1:-1}));return A}function g(b){var T=m(o,t.graph());let A=t.systems.l10n.isRTL();var M=b.selectAll(".header").data([0]),k=M.enter().append("div").attr("class","header fillL");k.append("button").attr("class","preset-reset preset-choose").call(Ye(A?"#rapid-icon-forward":"#rapid-icon-backward")),k.append("button").attr("class","close").on("click",function(){t.enter("browse")}).call(Ye(s?"#rapid-icon-apply":"#rapid-icon-close")),k.append("h3"),M=M.merge(k),M.selectAll("h3").html(o.length===1?t.tHtml("inspector.edit"):t.tHtml("rapid_multiselect")),M.selectAll(".preset-reset").on("click",function(){e.call("choose",this,a)});var F=b.selectAll(".inspector-body").data([0]),O=F.enter().append("div").attr("class","entity-editor inspector-body");F=F.merge(O),c||(c=[B_(t),F_(t).on("choose",function(U){e.call("choose",this,U)}),D_(t),L_(t).on("change",_).on("revert",v),Ah(t,"raw-tag-editor").on("change",_),N_(t),O_(t)]),c.forEach(function(U){U.entityIDs&&U.entityIDs(o),U.presets&&U.presets(a),U.tags&&U.tags(T),U.state&&U.state(i),F.call(U.render)}),d||(t.systems.edits.on("change",B),d=!0);function B(U){if(!b.selectAll(".entity-editor").empty()&&i!=="hide"){var z=!U||U.didChange.properties||U.didChange.addition||U.didChange.deletion;if(z&&(o=o.filter(t.hasEntity),!!o.length)){var Z=a.length===1&&a[0];E();var W=t.graph();g.modified(n!==W),g(b),Z&&a.length===1&&Z!==a[0]&&t.container().selectAll(".entity-editor button.preset-reset .label").style("background-color","#fff").transition().duration(750).style("background-color",null)}}}}function _(b,T,A){var M=[];for(var k in b){var F=b[k],O=t.entity(F),B=Object.assign({},O.tags);for(var U in T)if(U&&!(O.__fbid__&&U==="source"&&(O.tags.source==="digitalglobe"||O.tags.source==="maxar"))){var z=T[U];(z!==void 0||B.hasOwnProperty(U))&&(B[U]=z)}A||(B=Tb(B)),(0,FS.default)(O.tags,B)||M.push(Xr(F,B))}if(M.length){var Z=function(q){return M.forEach(function(Q){q=Q(q)}),q},W=t.t("operations.change_tags.annotation");r?t.overwrite(Z,W):(t.perform(Z,W),r=!!A)}A||t.systems.validator.validate()}function v(b){var T=[];for(var A in o){var M=o[A],k=t.graph().base.entities.get(M),F={};for(var O in b){var B=b[O];F[B]=k?k.tags[B]:void 0}var U=t.entity(M),z=Object.assign({},U.tags);for(var Z in F)if(Z){var W=F[Z];(W!==void 0||z.hasOwnProperty(Z))&&(z[Z]=W)}z=Tb(z),(0,FS.default)(U.tags,z)||T.push(Xr(M,z))}if(T.length){var q=function(V){return T.forEach(function(le){V=le(V)}),V},Q=t.t("operations.change_tags.annotation");r?t.overwrite(q,Q):(t.perform(q,Q),r=!1)}t.systems.validator.validate()}g.modified=function(b){return arguments.length?(s=b,g):s},g.state=function(b){return arguments.length?(i=b,g):i},g.entityIDs=function(b){return arguments.length?(n=t.graph(),r=!1,b&&o&&jn(o,b)?g:(o=b,E(!0),g.modified(!1))):o},g.newFeature=function(b){return arguments.length?(l=b,g):l};function E(b){var T=t.systems.presets,A=t.graph(),M={};for(var k in o){var F=A.hasEntity(o[k]);if(!F)return;var O=T.match(F,A);M[O.id]||(M[O.id]=0),M[O.id]+=1}var B=Object.keys(M).sort(function(z,Z){return M[Z]-M[z]}).map(function(z){return T.item(z)});if(!b){var U=a.length===1&&!a[0].isFallback()&&Object.keys(a[0].addTags||{}).length===0;if(U&&B.length===1&&B[0].isFallback())return}g.presets(B)}return g.presets=function(b){return arguments.length?(jn(b,a)||(a=b),g):a},$t(g,e,"on")}function pO(t){let e=t.systems.filters;function i(r){let s=e.stats(),n=e.hidden(),o=0,a=Array.from(n).map(l=>s[l]?(o+=s[l],t.t("inspector.title_count",{title:t.tHtml(`feature.${l}.description`),count:s[l]})):null).filter(Boolean);if(r.html(""),a.length){let l=Ft(t).placement("top").title(()=>a.join("<br/>"));r.append("a").attr("class","chip").attr("href","#").html(t.tHtml("feature_info.hidden_warning",{count:o})).call(l).on("click",c=>{l.hide(),c.preventDefault(),t.systems.ui.togglePanes(t.container().select(".map-panes .map-data-pane"))})}r.classed("hide",!a.length)}return function(r){i(r),e.on("filterchange",()=>i(r))}}var yO=Yi(gO(),1);function z_(t){let e=t.services.nominatim,i=t.systems.presets,r=t.systems.l10n,s=t.systems.map,n;function o(a){a.append("div").attr("class","header fillL").append("h3").html(r.tHtml("inspector.feature_list"));let c=a.append("div").attr("class","search-header");c.call(Ye("#rapid-icon-search","pre-text"));let d=c.append("input").attr("placeholder",r.t("inspector.search")).attr("type","search").call(Ri).on("keypress",E).on("keydown",v).on("input",b),g=a.append("div").attr("class","inspector-body").append("div").attr("class","feature-list");t.on("modechange",T),t.keybinding().on(Li("\u2318F"),_);function _(U){var z;((z=t.mode)==null?void 0:z.id)==="browse"&&(U.preventDefault(),d.node().focus())}function v(U){U.keyCode===27&&d.node().blur()}function E(U){let z=d.property("value"),Z=g.selectAll(".feature-list-item");U.keyCode===13&&z.length&&Z.size()&&O(U,Z.datum())}function b(){n=void 0,M()}function T(){d.property("value",""),M()}function A(){let U=t.graph(),z=s.centerLoc(),Z=d.property("value").toLowerCase(),W=[];if(!Z)return W;let q=yO.pair(Z.toUpperCase())||Z.match(/^(-?\d+\.?\d*)\s+(-?\d+\.?\d*)$/);if(q){let ee=[parseFloat(q[0]),parseFloat(q[1])];W.push({id:-1,geometry:"point",type:r.t("inspector.location"),name:r.dmsCoordinatePair([ee[1],ee[0]]),location:ee})}let Q=!q&&Z.match(/(?:^|\W)(node|way|relation|[nwr])\W?0*([1-9]\d*)(?:\W|$)/i);if(Q){let ee=Q[1].charAt(0),re=Q[2];W.push({id:ee+re,geometry:ee==="n"?"point":ee==="w"?"line":"relation",type:r.displayType(ee),name:re})}let V=U.base.entities,le=U.local.entities,de=new Set([...V.keys(),...le.keys()]),ne=[];for(let ee of de){if(le.has(ee)&&le.get(ee)===void 0)continue;let re=U.hasEntity(ee);if(!re)continue;let te=r.displayName(re.tags)||"";if(te.toLowerCase().indexOf(Z)<0)continue;let ie=i.match(re,U),oe=ie&&ie.name()||r.displayType(re.id),fe=re.extent(U),Re=fe?mr(z,fe.center()):0;if(ne.push({id:re.id,entity:re,geometry:re.geometry(U),type:oe,name:te,distance:Re}),ne.length>100)break}ne=ne.sort((ee,re)=>ee.distance-re.distance),W=W.concat(ne);for(let ee of n||[]){if(!ee.osm_type||!ee.osm_id)continue;let re=Dt.id.fromOSM(ee.osm_type,ee.osm_id),te={};te[ee.class]=ee.type;let ie={id:re,type:ee.osm_type,tags:te};ee.osm_type==="way"&&(ie.nodes=["a","a"]);let oe=Dt(ie),fe=new Cn([oe]),Re=i.match(oe,fe),He=Re&&Re.name()||r.displayType(re);W.push({id:oe.id,geometry:oe.geometry(fe),type:He,name:ee.display_name,extent:new mt([parseFloat(ee.boundingbox[3]),parseFloat(ee.boundingbox[0])],[parseFloat(ee.boundingbox[2]),parseFloat(ee.boundingbox[1])])})}return Z.match(/^[0-9]+$/)&&(W.push({id:"n"+Z,geometry:"point",type:r.t("inspector.node"),name:Z}),W.push({id:"w"+Z,geometry:"line",type:r.t("inspector.way"),name:Z}),W.push({id:"r"+Z,geometry:"relation",type:r.t("inspector.relation"),name:Z})),W}function M(){let U=d.property("value"),z=A();g.classed("filtered",U.length),g.selectAll(".no-results-item").data([0]).enter().append("button").property("disabled",!0).attr("class","no-results-item").call(Ye("#rapid-icon-alert","pre-text")).append("span").attr("class","entity-name"),g.selectAll(".no-results-item .entity-name").html(r.tHtml("geocoder.no_results_worldwide")),e&&g.selectAll(".geocode-item").data([0]).enter().append("button").attr("class","geocode-item secondary-action").on("click",B).append("div").attr("class","label").append("span").attr("class","entity-name").html(r.tHtml("geocoder.search")),g.selectAll(".no-results-item").style("display",U.length&&!z.length?"block":"none"),g.selectAll(".geocode-item").style("display",U&&n===void 0?"block":"none"),g.selectAll(".feature-list-item").data([-1]).remove();let W=g.selectAll(".feature-list-item").data(z,V=>V.id),q=W.enter().insert("button",".geocode-item").attr("class","feature-list-item").on("mouseover",k).on("mouseout",F).on("click",O),Q=q.append("div").attr("class","label");Q.each((V,le,de)=>{ye(de[le]).call(Ye(`#rapid-icon-${V.geometry}`,"pre-text"))}),Q.append("span").attr("class","entity-type").html(V=>V.type),Q.append("span").attr("class","entity-name").html(V=>V.name),q.style("opacity",0).transition().style("opacity",1),W.order(),W.exit().remove()}function k(U,z){!z.id||z.id===-1||Ki([z.id],!0,t)}function F(U,z){!z.id||z.id===-1||Ki([z.id],!1,t)}function O(U,z){U.preventDefault(),z.location?s.centerZoomEase([z.location[1],z.location[0]],19):z.id!==-1&&(Ki([z.id],!1,t),s.selectEntityID(z.id,!0))}function B(){e.search(d.property("value"),(U,z)=>{n=z||[],M()})}}return o}function q4(t){var e,i=2e3,r="#rapid-icon-no",s="disabled",n="";function o(){e&&e.stop(),t.container().select(".main-footer-wrap").classed("footer-hide",!0).classed("footer-show",!1),t.container().select(".flash-wrap").classed("footer-hide",!1).classed("footer-show",!0);var a=t.container().select(".flash-wrap").selectAll(".flash-content").data([0]),l=a.enter().append("div").attr("class","flash-content"),c=l.append("svg").attr("class","flash-icon icon").append("g").attr("transform","translate(10,10)");return c.append("circle").attr("r",9),c.append("use").attr("transform","translate(-7,-7)").attr("width","14").attr("height","14"),l.append("div").attr("class","flash-text"),a=a.merge(l),a.selectAll(".flash-icon").attr("class","icon flash-icon "+(s||"")),a.selectAll(".flash-icon use").attr("xlink:href",r),a.selectAll(".flash-text").attr("class","flash-text").html(n),e=Pf(function(){e=null,t.container().select(".main-footer-wrap").classed("footer-hide",!1).classed("footer-show",!0),t.container().select(".flash-wrap").classed("footer-hide",!0).classed("footer-show",!1)},i),a}return o.duration=function(a){return arguments.length?(i=a,o):i},o.label=function(a){return arguments.length?(n=a,o):n},o.iconName=function(a){return arguments.length?(r=a,o):r},o.iconClass=function(a){return arguments.length?(s=a,o):s},o}function G_(t){var e=t.container().node();function i(){if(e.requestFullscreen)return e.requestFullscreen;if(e.msRequestFullscreen)return e.msRequestFullscreen;if(e.mozRequestFullScreen)return e.mozRequestFullScreen;if(e.webkitRequestFullscreen)return e.webkitRequestFullscreen}function r(){if(document.exitFullscreen)return document.exitFullscreen;if(document.msExitFullscreen)return document.msExitFullscreen;if(document.mozCancelFullScreen)return document.mozCancelFullScreen;if(document.webkitExitFullscreen)return document.webkitExitFullscreen}function s(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function n(){return!!i()}function o(a){a.preventDefault(),s()?r().apply(document):i().apply(e)}return function(){if(n()){var a=Gs(),l=a.os==="mac"?[Li("\u2303\u2318F"),"f11"]:["f11"];t.keybinding().on(l,o)}}}var oK=1e4,aK=2e3,_O={enableHighAccuracy:!1,timeout:6e3};function $_(t){let e=Yc(t).message(t.tHtml("geolocate.locating")).blocking(!0),i=t.scene().layers.get("map-ui"),r=!1,s,n=ye(null);function o(){t.inIntro||(r?(r=!1,i.geolocationData=null,t.systems.map.deferredRedraw(),c()):(r=!0,n.classed("active",!0),t.enter("browse"),s=window.setTimeout(l,oK),t.container().call(e),navigator.geolocation.getCurrentPosition(a,l,_O)))}function a(d){if(r){let m=d.coords,g=new mt([m.longitude,m.latitude]).padByMeters(m.accuracy);if(i.geolocationData=d,t.systems.map.deferredRedraw(),s){window.clearTimeout(s),s=void 0;let _=t.systems.map;_.centerZoomEase(g.center(),Math.min(20,_.extentZoom(g)))}window.setTimeout(()=>{navigator.geolocation.getCurrentPosition(a,l,_O)},aK)}c()}function l(){r&&t.systems.ui.flash.label(t.tHtml("geolocate.location_unavailable")).iconName("#rapid-icon-geolocate")(),r=!1,i.geolocationData=null,t.systems.map.deferredRedraw(),c()}function c(){s&&(window.clearTimeout(s),s=void 0),e.close(),n.classed("active",r)}return function(d){if(!navigator.geolocation||!navigator.geolocation.getCurrentPosition)return;let m=t.systems.l10n.isRTL();n=d.append("button").on("click",o).call(Ye("#rapid-icon-geolocate","light")).call(Ft(t).placement(m?"right":"left").title(t.tHtml("geolocate.title")))}}function H_(t){let e;function i(s){let n=t.services.improveOSM;if(!n)return;let o=s.selectAll(".comments-container").data([0]);o=o.enter().append("div").attr("class","comments-container").merge(o),n.getCommentsAsync(e).then(a=>{if(!a.comments)return;let l=o.selectAll(".comment").data(a.comments).enter().append("div").attr("class","comment");l.append("div").attr("class","comment-avatar").call(Ye("#rapid-icon-avatar","comment-avatar-icon"));let c=l.append("div").attr("class","comment-main"),d=c.append("div").attr("class","comment-metadata");d.append("div").attr("class","comment-author").each(function(m){let g=t.services.osm,_=ye(this);g&&m.username&&(_=_.append("a").attr("class","comment-author-link").attr("href",g.userURL(m.username)).attr("target","_blank")),_.html(v=>v.username)}),d.append("div").attr("class","comment-date").html(m=>t.tHtml("note.status.commented",{when:r(m.timestamp)})),c.append("div").attr("class","comment-text").append("p").html(m=>m.text)}).catch(a=>console.log(a))}function r(s){if(!s)return null;let n={day:"numeric",month:"short",year:"numeric"},o=new Date(s*1e3);if(isNaN(o.getTime()))return null;let a=t.systems.l10n.localeCode();return o.toLocaleDateString(a,n)}return i.issue=function(s){return arguments.length?(e=s,i):e},i}function V_(t){let e=t.systems.filters,i=t.systems.l10n,r=t.systems.map,s=t.systems.presets,n;function o(l){if(l.desc)return l.desc;let c=l.issueKey;return l.replacements=l.replacements||{},l.replacements.default=i.tHtml("inspector.unknown"),i.tHtml(`QA.improveOSM.error_types.${c}.description`,l.replacements)}function a(l){let c=l.selectAll(".error-details").data(n?[n]:[],_=>`${_.id}-${_.status||0}`);c.exit().remove();let m=c.enter().append("div").attr("class","error-details qa-details-container").append("div").attr("class","qa-details-subsection");m.append("h4").html(i.tHtml("QA.keepRight.detail_description")),m.append("div").attr("class","qa-details-description-text").html(o);let g=[];m.selectAll(".error_entity_link, .error_object_link").attr("href","#").each((_,v,E)=>{let b=E[v],T=ye(b),A=T.classed("error_object_link"),M=A?n.objectType.charAt(0)+n.objectId:b.textContent,k=t.hasEntity(M);if(g.push(M),T.on("mouseenter",()=>{Ki([M],!0,t)}).on("mouseleave",()=>{Ki([M],!1,t)}).on("click",F=>{F.preventDefault(),Ki([M],!1,t),r.scene.enableLayers("osm"),r.centerZoom(n.loc,20),r.selectEntityID(M)}),k){let F=i.displayName(k.tags);if(!F&&!A){let O=s.match(k,t.graph());F=O&&!O.isFallback()&&O.name()}F&&(b.innerText=F)}}),e.forceVisible(g),r.immediateRedraw()}return a.issue=function(l){return arguments.length?(n=l,a):n},a}function j_(t){let e;function i(s){let n=s.issueKey;return s.replacements=s.replacements||{},s.replacements.default=t.tHtml("inspector.unknown"),t.tHtml(`QA.improveOSM.error_types.${n}.title`,s.replacements)}function r(s){let n=16777215,o=t.services.improveOSM;o&&(n=o.getColor(e==null?void 0:e.itemType));let a=s.selectAll(".qa-header").data(e?[e]:[],d=>`${d.id}-${d.status||0}`);a.exit().remove();let l=a.enter().append("div").attr("class","qa-header"),c=l.append("div").attr("class","qa-header-icon").append("svg").attr("width","20px").attr("height","27px").attr("viewbox","0 0 20 27").attr("class",d=>`qaItem ${d.service}`);c.append("polygon").attr("fill",new mi(n).toHex()).attr("stroke","#333").attr("points","16,3 4,3 1,6 1,17 4,20 7,20 10,27 13,20 16,20 19,17.033 19,6"),c.append("use").attr("class","icon-annotation").attr("width","13px").attr("height","13px").attr("transform","translate(3.5, 5)").attr("xlink:href",d=>d.icon?`#${d.icon}`:""),l.append("div").attr("class","qa-header-label").html(i)}return r.issue=function(s){return arguments.length?(e=s,r):e},r}function Y4(t){let e=t.services.improveOSM,i=Pt("change"),r=V_(t),s=H_(t),n=j_(t),o;function a(d){let m=d.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");m.append("button").attr("class","close").on("click",()=>t.enter("browse")).call(Ye("#rapid-icon-close")),m.append("h3").html(t.tHtml("QA.improveOSM.title"));let g=d.selectAll(".body").data([0]);g=g.enter().append("div").attr("class","body").merge(g);let _=g.selectAll(".qa-editor").data([0]);_.enter().append("div").attr("class","modal-section qa-editor").merge(_).call(n.issue(o)).call(r.issue(o)).call(s.issue(o)).call(l)}function l(d){let m=o==null?void 0:o.id,g=m&&t.selectedData().has(m),_=o&&(g||o.newComment||o.comment),v=d.selectAll(".qa-save").data(_?[o]:[],T=>`${T.id}-${T.status||0}`);v.exit().remove();let E=v.enter().append("div").attr("class","qa-save save-section cf");E.append("h4").attr("class",".qa-save-header").html(t.tHtml("note.newComment")),E.append("textarea").attr("class","new-comment-input").attr("placeholder",t.t("QA.keepRight.comment_placeholder")).attr("maxlength",1e3).property("value",T=>T.newComment).call(Ri).on("input",b).on("blur",b),v=E.merge(v).call(c);function b(){let A=ye(this).property("value").trim();A===""&&(A=void 0),o=o.update({newComment:A}),e&&e.replaceItem(o),v.call(c)}}function c(d){let m=o==null?void 0:o.id,g=m&&t.selectedData().has(m),_=d.selectAll(".buttons").data(g?[o]:[],E=>E.status+E.id);_.exit().remove();let v=_.enter().append("div").attr("class","buttons");v.append("button").attr("class","button comment-button action").html(t.tHtml("QA.keepRight.save_comment")),v.append("button").attr("class","button close-button action"),v.append("button").attr("class","button ignore-button action"),_=_.merge(v),_.select(".comment-button").attr("disabled",E=>E.newComment?null:!0).on("click.comment",function(E,b){this.blur(),e&&e.postUpdate(b,(T,A)=>i.call("change",A))}),_.select(".close-button").html(E=>{let b=E.newComment?"_comment":"";return t.tHtml(`QA.keepRight.close${b}`)}).on("click.close",function(E,b){this.blur(),e&&(b.newStatus="SOLVED",e.postUpdate(b,(T,A)=>i.call("change",A)))}),_.select(".ignore-button").html(E=>{let b=E.newComment?"_comment":"";return t.tHtml(`QA.keepRight.ignore${b}`)}).on("click.ignore",function(E,b){this.blur(),e&&(b.newStatus="INVALID",e.postUpdate(b,(T,A)=>i.call("change",A)))})}return a.error=function(d){return arguments.length?(o=d,a):o},$t(a,i,"on")}function gi(t,e){return`<svg class="${"icon"+(e?` ${e}`:"")}"><use xlink:href="${t}"></use></svg>`}function Xs(t){t.stopPropagation(),t.preventDefault()}var X_;function ut(t,e,i){let r=t.systems.l10n,s=r.isRTL();X_||(X_={point_icon:gi("#rapid-icon-point","inline"),line_icon:gi("#rapid-icon-line","inline"),area_icon:gi("#rapid-icon-area","inline"),note_icon:gi("#rapid-icon-note","inline add-note"),plus:gi("#rapid-icon-plus","inline"),minus:gi("#rapid-icon-minus","inline"),layers_icon:gi("#rapid-icon-layers","inline"),data_icon:gi("#rapid-icon-data","inline"),inspect:gi("#rapid-icon-inspect","inline"),help_icon:gi("#rapid-icon-help","inline"),undo_icon:gi(s?"#rapid-icon-redo":"#rapid-icon-undo","inline"),redo_icon:gi(s?"#rapid-icon-undo":"#rapid-icon-redo","inline"),save_icon:gi("#rapid-icon-save","inline"),circularize_icon:gi("#rapid-operation-circularize","inline operation"),continue_icon:gi("#rapid-operation-continue","inline operation"),copy_icon:gi("#rapid-operation-copy","inline operation"),delete_icon:gi("#rapid-operation-delete","inline operation"),disconnect_icon:gi("#rapid-operation-disconnect","inline operation"),downgrade_icon:gi("#rapid-operation-downgrade","inline operation"),extract_icon:gi("#rapid-operation-extract","inline operation"),merge_icon:gi("#rapid-operation-merge","inline operation"),move_icon:gi("#rapid-operation-move","inline operation"),orthogonalize_icon:gi("#rapid-operation-orthogonalize","inline operation"),paste_icon:gi("#rapid-operation-paste","inline operation"),reflect_long_icon:gi("#rapid-operation-reflect-long","inline operation"),reflect_short_icon:gi("#rapid-operation-reflect-short","inline operation"),reverse_icon:gi("#rapid-operation-reverse","inline operation"),rotate_icon:gi("#rapid-operation-rotate","inline operation"),split_icon:gi("#rapid-operation-split","inline operation"),straighten_icon:gi("#rapid-operation-straighten","inline operation"),leftclick:gi("#rapid-walkthrough-mouse-left","inline operation"),rightclick:gi("#rapid-walkthrough-mouse-right","inline operation"),mousewheel_icon:gi("#rapid-walkthrough-mousewheel","inline operation"),tap_icon:gi("#rapid-walkthrough-tap","inline operation"),doubletap_icon:gi("#rapid-walkthrough-doubletap","inline operation"),longpress_icon:gi("#rapid-walkthrough-longpress","inline operation"),touchdrag_icon:gi("#rapid-walkthrough-touchdrag","inline operation"),pinch_icon:gi("#rapid-walkthrough-pinch-apart","inline operation"),shift:Li.display(t,"\u21E7"),alt:Li.display(t,"\u2325"),return:Li.display(t,"\u21B5"),esc:r.tHtml("shortcuts.key.esc"),space:r.tHtml("shortcuts.key.space"),add_note_key:r.tHtml("modes.add_note.key"),help_key:r.tHtml("help.key"),shortcuts_key:r.tHtml("shortcuts.toggle.key"),save:r.tHtml("save.title"),undo:r.tHtml("undo.title"),redo:r.tHtml("redo.title"),upload:r.tHtml("commit.save"),point:r.tHtml("modes.add_point.title"),line:r.tHtml("modes.add_line.title"),area:r.tHtml("modes.add_area.title"),note:r.tHtml("modes.add_note.label"),circularize:r.tHtml("operations.circularize.title"),continue:r.tHtml("operations.continue.title"),copy:r.tHtml("operations.copy.title"),delete:r.tHtml("operations.delete.title"),disconnect:r.tHtml("operations.disconnect.title"),downgrade:r.tHtml("operations.downgrade.title"),extract:r.tHtml("operations.extract.title"),merge:r.tHtml("operations.merge.title"),move:r.tHtml("operations.move.title"),orthogonalize:r.tHtml("operations.orthogonalize.title"),paste:r.tHtml("operations.paste.title"),reflect_long:r.tHtml("operations.reflect.title.long"),reflect_short:r.tHtml("operations.reflect.title.short"),reverse:r.tHtml("operations.reverse.title"),rotate:r.tHtml("operations.rotate.title"),split:r.tHtml("operations.split.title"),straighten:r.tHtml("operations.straighten.title"),map_data:r.tHtml("map_data.title"),osm_notes:r.tHtml("map_data.layers.notes.title"),fields:r.tHtml("inspector.fields"),tags:r.tHtml("inspector.tags"),relations:r.tHtml("inspector.relations"),new_relation:r.tHtml("inspector.new_relation"),turn_restrictions:r.tHtml("_tagging.presets.fields.restrictions.label"),background_settings:r.tHtml("background.description"),imagery_offset:r.tHtml("background.fix_misalignment"),start_the_walkthrough:r.tHtml("splash.walkthrough"),help:r.tHtml("help.title"),ok:r.tHtml("intro.ok")});let n;return i?n=Object.assign(i,X_):n=X_,r.tHtml(e,n).replace(/\`(.*?)\`/g,"<kbd>$1</kbd>")}function xO(t){return t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}var vO={};function bO(t,e,i){if(t.systems.l10n.t(e,{default:void 0})===void 0){if(vO.hasOwnProperty(e))return;vO[e]=i;let s=`${e}: ${i}`;typeof console!="undefined"&&console.log(s)}}function OS(t,e){let i=t.systems.l10n,r,s=e.tags&&e.tags.name;s&&(r="intro.graph.name."+xO(s),e.tags.name=i.t(r,{default:s}),bO(t,r,s));let n=e.tags&&e.tags["addr:street"];if(n){r="intro.graph.name."+xO(n),e.tags["addr:street"]=i.t(r,{default:n}),bO(t,r,n);let o=["block_number","city","county","district","hamlet","neighbourhood","postcode","province","quarter","state","subdistrict","suburb"];for(let a of o){let l=`intro.graph.${a}`,c=`addr:${a}`,d=e.tags&&e.tags[c],m=i.t(l,{default:d});m&&(m.match(/^<.*>$/)!==null?delete e.tags[c]:e.tags[c]=m)}}return e}function wO(t){let i=Math.cos(75*Math.PI/180),r=Math.cos(15*Math.PI/180);for(let s=0;s<t.length;s++){let n=t[(s-1+t.length)%t.length],o=t[s],a=t[(s+1)%t.length],l=R8(n,a,o),c=Math.abs(l);if(c>i&&c<r)return!1}return!0}function _n(t,e){let i=mr(t,e);return i<1e-4?0:i<200?500:1e3}function Dr(t=300){return new Promise(e=>window.setTimeout(e,t))}function Nn(t){t.select(".inspector-wrap .entity-editor-pane").classed("hide",!1),t.select(".inspector-wrap .preset-list-pane").classed("hide",!0),t.select(".inspector-wrap .panewrap").style("right","0%")}function Dl(t){t.select(".inspector-wrap .entity-editor-pane").classed("hide",!0),t.select(".inspector-wrap .preset-list-pane").classed("hide",!1),t.select(".inspector-wrap .panewrap").style("right","-100%")}function Ih(t,e,i){return Math.max(e,Math.min(t,i))}var W_=class{constructor(e){this.context=e,this._enabled=!1,this._revealOptions=null,this._containerRect=null,this._mapRect=null,this._revealRect=null,this._darknessDirty=!0,this._tooltipDirty=!0,this._inTransition=!1,this._curtain=ye(null),this._tooltip=ye(null),this.enable=this.enable.bind(this),this.disable=this.disable.bind(this),this.redraw=this.redraw.bind(this),this.resize=this.resize.bind(this)}enable(e){this._enabled||(this._enabled=!0,this._revealOptions=null,this._containerRect=null,this._mapRect=null,this._revealRect=null,this._darknessDirty=!0,this._tooltipDirty=!0,this._inTransition=!1,this._curtain=e.append("svg").attr("class","curtain").style("top",0).style("left",0),this._tooltip=e.append("div").attr("class","tooltip"),this._tooltip.append("div").attr("class","popover-arrow"),this._tooltip.append("div").attr("class","popover-inner"),ye(window).on("resize.curtain",this.resize),this.context.systems.map.on("move",this.redraw),this.resize())}disable(){this._enabled&&(this._enabled=!1,this._curtain.remove(),this._curtain=ye(null),this._tooltip.remove(),this._tooltip=ye(null),this._revealOptions=null,this._containerRect=null,this._mapRect=null,this._revealRect=null,ye(window).on("resize.curtain",null),this.context.systems.map.off("move",this.redraw))}resize(){let e=this.context.container().node();this._containerRect=this._copyRect(e.getBoundingClientRect());let i=this.context.container().select(".main-map").node();this._mapRect=this._copyRect(i.getBoundingClientRect());let[r,s]=[this._containerRect.width,this._containerRect.height];this._curtain.attr("width",r).attr("height",s),this._revealRect=null,this._darknessDirty=!0,this._curtain.selectAll("path").interrupt(),this._inTransition=!1,this.redraw()}hide(){this.reveal({duration:0})}reveal(e={}){return this._revealOptions=Object.assign({},e,{duration:250}),this._revealRect=null,this._darknessDirty=!0,this._tooltipDirty=!0,this.redrawDarkness(this._revealOptions.duration),this.redrawTooltip(),this._tooltip}redraw(){this._inTransition||(this.redrawDarkness(),this.redrawTooltip())}redrawDarkness(e=0){var v;if(!this._darknessDirty)return;let i=this._containerRect,r=this._mapRect;if(!i||!r)return;let s=this._revealOptions,n=(v=s==null?void 0:s.revealPadding)!=null?v:0,o,a;if(s){if(s.revealExtent instanceof mt){let E=this.context.projection,b=E.project([s.revealExtent.min[0],s.revealExtent.max[1]]),T=E.project([s.revealExtent.max[0],s.revealExtent.min[1]]);b=Ir(b,[r.left,r.top]),T=Ir(T,[r.left,r.top]),a=r,o={left:b[0],top:b[1],right:T[0],bottom:T[1],width:T[0]-b[0],height:T[1]-b[1]}}else s.revealSelector&&!s.revealNode&&(s.revealNode=ye(s.revealSelector).node()),s.revealNode instanceof Element&&(a=i,o=this._copyRect(s.revealNode.getBoundingClientRect()));o&&(o.left=Ih(o.left-n,a.left,a.right),o.top=Ih(o.top-n,a.top,a.bottom),o.right=Ih(o.right+n,a.left,a.right),o.bottom=Ih(o.bottom+n,a.top,a.bottom),o.width=o.right-o.left,o.height=o.bottom-o.top,this._revealRect=o)}let l=i,c=o,d=`M${l.left},${l.top} L${l.left},${l.bottom} L${l.right},${l.bottom}, L${l.right},${l.top} Z`;c&&(d+=` M${c.left},${c.top} L${c.left},${c.bottom} L${c.right},${c.bottom}, L${c.right},${c.top} Z`);let m=this._curtain.selectAll("path").data([0]).interrupt(),g=m.enter().append("path").attr("x",0).attr("y",0).attr("class","curtain-darkness"),_=m.merge(g);e>0?(this._inTransition=!0,_=_.transition().duration(e).ease(q3).on("end interrupt",()=>this._inTransition=!1)):this._inTransition=!1,_.attr("d",d),this._darknessDirty=s==null?void 0:s.revealExtent}redrawTooltip(){let e=this._containerRect;if(!e)return;let i=this._revealOptions,r;i&&(i.tipSelector&&!i.tipNode&&(i.tipNode=ye(i.tipSelector).node()),i.tipNode instanceof Element&&(r=this._copyRect(i.tipNode.getBoundingClientRect())),!r&&this._revealRect&&(r=this._copyRect(this._revealRect)));let s=i==null?void 0:i.tipHtml;if(r&&s){let n="curtain-tooltip popover tooltip arrowed in "+(i.tooltipClass||"");this._tooltipDirty&&(s.indexOf("**")!==-1&&(s.indexOf("<span")===0?s=s.replace(/^(<span.*?>)(.+?)(\*\*)/,"$1<span>$2</span>$3"):s=s.replace(/^(.+?)(\*\*)/,"<span>$1</span>$2"),s=s.replace(/\*\*(.*?)\*\*/g,'<span class="instruction">$1</span>')),s=s.replace(/\*(.*?)\*/g,"<em>$1</em>"),s=s.replace(/\{br\}/g,"<br/><br/>"),i.buttonText&&i.buttonCallback&&(s+=`<div class="button-section"><button href="#" class="button action">${i.buttonText}</button></div>`),this._tooltip.attr("class",n).selectAll(".popover-inner").html(s),i.buttonText&&i.buttonCallback&&this._tooltip.selectAll("button.action").on("click",g=>{g.preventDefault(),i.buttonCallback()}),this._tooltipDirty=!1);let o=5,a=this._copyRect(this._tooltip.node().getBoundingClientRect()),l,c,d;r.left=Ih(r.left,e.left,e.right),r.top=Ih(r.top,e.top,e.bottom),r.right=Ih(r.right,e.left,e.right),r.bottom=Ih(r.bottom,e.top,e.bottom),r.width=r.right-r.left,r.height=r.bottom-r.top,r.bottom<100?(l="bottom",c=r.left+r.width/2-a.width/2,d=r.bottom):r.top>e.height-140?(l="top",c=r.left+r.width/2-a.width/2,d=r.top-a.height):(d=r.top+r.height/2-a.height/2,this.context.systems.l10n.textDirection()==="rtl"?r.left-a.width-o<70?(l="right",c=r.right+o):(l="left",c=r.left-a.width-o):r.right+o+a.width>e.width-70?(l="left",c=r.left-a.width-o):(l="right",c=r.right+o)),this._tooltip.style("left",`${c}px`).style("top",`${d}px`).attr("class",n+" "+l);let m=0;(l==="left"||l==="right")&&(d<60?m=60-d:d+a.height>e.height-100&&(m=e.height-d-a.height-100)),this._tooltip.selectAll(".popover-inner").style("top",`${m}px`)}else this._tooltip.classed("in",!1).call(V4(!1)),this._tooltipDirty=!1}_copyRect(e){return{left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height}}};function EO(t,e){let i=Pt("done"),r={title:"intro.welcome.title"},s=new mt([-85.63654,41.9429],[-85.63632,41.94307]),n=!1,o=null;function a(g){return n?Promise.reject():typeof g!="function"?Promise.resolve():g().then(_=>a(_)).catch(_=>(_ instanceof Error&&console.error(_),a(g)))}function l(){return t.systems.map.setCenterZoomAsync(s.center(),19).then(()=>new Promise((g,_)=>{o=_,e.reveal({revealSelector:".intro-nav-wrap .chapter-welcome",tipHtml:ut(t,"intro.welcome.welcome"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>g(c)})}))}function c(){return new Promise((g,_)=>{o=_,e.reveal({revealSelector:".intro-nav-wrap .chapter-welcome",tipHtml:ut(t,"intro.welcome.practice"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>g(d)})})}function d(){return new Promise((g,_)=>{o=_,e.reveal({revealSelector:".intro-nav-wrap .chapter-welcome",tipHtml:ut(t,"intro.welcome.words"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>g(m)})})}function m(){return i.call("done"),e.reveal({revealSelector:".intro-nav-wrap .chapter-navigation",tipHtml:ut(t,"intro.welcome.chapters",{next:t.t("intro.navigation.title")})}),Promise.resolve()}return r.enter=()=>{n=!1,o=null,a(l).catch(g=>{g instanceof Error&&console.error(g)})},r.exit=()=>{n=!0,o&&(o(),o=null)},r.restart=()=>{r.exit(),r.enter()},$t(r,i,"on")}function TO(t,e){let i=Pt("done"),r={title:"intro.navigation.title"},s=t.container(),n=t.systems.edits,o=t.systems.map,a=t.systems.presets,l="n2061",c=new mt([-85.63654,41.9429],[-85.63632,41.94307]),d="w397",m=new mt([-85.63588,41.94155],[-85.63574,41.94278]),g=a.field("oneway"),_=a.field("maxspeed"),v=!1,E=null,b=null,T=null;function A(){var fe;if(!t.hasEntity(l)||((fe=t.mode)==null?void 0:fe.id)!=="select-osm")return!1;let oe=t.selectedIDs();return oe.length===1&&oe[0]===l}function M(){return t.hasEntity(d)}function k(){var fe;if(!t.hasEntity(d)||((fe=t.mode)==null?void 0:fe.id)!=="select-osm")return!1;let oe=t.selectedIDs();return oe.length===1&&oe[0]===d}function F(oe){return v?Promise.reject():typeof oe!="function"?Promise.resolve():oe().then(fe=>F(fe)).catch(fe=>(fe instanceof Error&&console.error(fe),F(oe)))}function O(){t.enter("browse"),n.resetToCheckpoint("initial");let oe=c.center(),fe=_n(oe,o.center());return fe>0&&e.hide(),o.setCenterZoomAsync(oe,19,fe).then(()=>new Promise((Re,He)=>{E=He;let Je=o.center(),ot=t.lastPointerType==="mouse"?"drag":"drag_touch",yt=ut(t,"intro.navigation.map_info")+"{br}"+ut(t,`intro.navigation.${ot}`);b=()=>{Zi(Je,o.center())||Re(B)},e.reveal({revealSelector:".main-map",tipHtml:yt})})).finally(()=>{b=null}).then(Re=>Dr(2e3).then(Re))}function B(){return new Promise((oe,fe)=>{E=fe;let Re=o.zoom(),He=t.lastPointerType==="mouse"?"zoom":"zoom_touch",Je=ut(t,`intro.navigation.${He}`);b=()=>{Re!==o.zoom()&&oe(U)},e.reveal({revealSelector:".main-map",tipHtml:Je})}).finally(()=>{b=null}).then(oe=>Dr(2e3).then(oe))}function U(){return new Promise((oe,fe)=>{E=fe,e.reveal({revealSelector:".main-map",tipHtml:ut(t,"intro.navigation.features"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>oe(z)})})}function z(){return new Promise((oe,fe)=>{E=fe,e.reveal({revealSelector:".main-map",tipHtml:ut(t,"intro.navigation.points_lines_areas"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>oe(Z)})})}function Z(){return new Promise((oe,fe)=>{E=fe,e.reveal({revealSelector:".main-map",tipHtml:ut(t,"intro.navigation.nodes_ways"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>oe(W)})})}function W(){t.enter("browse"),n.resetToCheckpoint("initial");let oe=c.center(),fe=_n(oe,o.center());return fe>0&&e.hide(),o.setCenterZoomAsync(oe,19,fe).then(()=>new Promise((Re,He)=>{E=He,T=()=>Re(q);let Je=t.lastPointerType==="mouse"?"click_townhall":"tap_townhall";e.reveal({revealExtent:c,tipHtml:ut(t,`intro.navigation.${Je}`)})})).finally(()=>{T=null})}function q(){return A()?new Promise((oe,fe)=>{E=fe,T=fe,e.reveal({revealExtent:c,tipHtml:ut(t,"intro.navigation.selected_townhall"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>oe(Q)})}).finally(()=>{T=null}):Promise.resolve(W)}function Q(){return A()?new Promise((oe,fe)=>{E=fe,T=fe,Nn(s),s.select(".inspector-wrap").on("wheel.intro",Xs),e.reveal({revealSelector:".entity-editor-pane",tipHtml:ut(t,"intro.navigation.editor_townhall"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>oe(V)})}).finally(()=>{T=null,s.select(".inspector-wrap").on("wheel.intro",null)}):Promise.resolve(W)}function V(){return A()?new Promise((oe,fe)=>{E=fe,T=fe,Nn(s),s.select(".inspector-wrap").on("wheel.intro",Xs);let Re=t.entity(t.selectedIDs()[0]),He=a.match(Re,t.graph());e.reveal({revealSelector:".entity-editor-pane .section-feature-type",revealPadding:5,tipHtml:ut(t,"intro.navigation.preset_townhall",{preset:He.name()}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>oe(le)})}).finally(()=>{T=null,s.select(".inspector-wrap").on("wheel.intro",null)}):Promise.resolve(W)}function le(){return A()?new Promise((oe,fe)=>{E=fe,T=fe,Nn(s),s.select(".inspector-wrap").on("wheel.intro",Xs),e.reveal({revealSelector:".entity-editor-pane .section-preset-fields",revealPadding:5,tipHtml:ut(t,"intro.navigation.fields_townhall"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>oe(de)})}).finally(()=>{T=null,s.select(".inspector-wrap").on("wheel.intro",null)}):Promise.resolve(W)}function de(){return A()?new Promise((oe,fe)=>{E=fe,T=()=>oe(ne),Nn(s);let He=ye(".entity-editor-pane button.close svg use").attr("href")||"#rapid-icon-close";e.reveal({revealSelector:".entity-editor-pane",tipSelector:".entity-editor-pane button.close",tipHtml:ut(t,"intro.navigation.close_townhall",{button:gi(He,"inline")})})}).finally(()=>{T=null}):Promise.resolve(W)}function ne(){t.enter("browse"),n.resetToCheckpoint("initial");let oe=m.center(),fe=_n(oe,o.center());return fe>0&&e.hide(),o.setCenterZoomAsync(oe,19,fe).then(()=>new Promise((Re,He)=>{E=He,e.reveal({revealSelector:".search-header input",tipHtml:ut(t,"intro.navigation.search_street",{name:t.t("intro.graph.name.spring-street")})}),s.select(".search-header input").on("keyup.intro",()=>Re(ee))})).finally(()=>{s.select(".search-header input").on("keyup.intro",null)})}function ee(){return M()?new Promise((oe,fe)=>{E=fe,T=()=>oe(re),s.select(".search-header input").on("keyup.intro",()=>{let Re=s.select(".feature-list-item:nth-child(0n+2)"),He=Re.select(".entity-name"),Je=t.t("intro.graph.name.spring-street");!He.empty()&&He.html()===Je&&(e.reveal({revealNode:Re.node(),revealPadding:5,tipHtml:ut(t,"intro.navigation.choose_street",{name:Je})}),s.select(".search-header input").on("keydown.intro",Xs,!0).on("keyup.intro",null))})}).finally(()=>{T=null,s.select(".search-header input").on("keydown.intro",null).on("keyup.intro",null)}):Promise.resolve(ne)}function re(){let oe=m.center();return o.setCenterZoomAsync(oe,19,0).then(()=>new Promise((fe,Re)=>{if(E=Re,T=Re,!k()){fe(ne);return}e.reveal({revealExtent:m,revealPadding:40,tipHtml:ut(t,"intro.navigation.selected_street",{name:t.t("intro.graph.name.spring-street")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>fe(te)})})).finally(()=>{T=null})}function te(){return k()?new Promise((oe,fe)=>{E=fe,T=()=>oe(ie),Nn(s);let He=ye(".entity-editor-pane button.close svg use").attr("href")||"#rapid-icon-close",Je=ut(t,"intro.navigation.street_different_fields")+"{br}"+ut(t,"intro.navigation.editor_street",{button:gi(He,"inline"),field1:g.label(),field2:_.label()});e.reveal({revealSelector:".entity-editor-pane",tipHtml:Je})}).finally(()=>{T=null}):Promise.resolve(ne)}function ie(){return i.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-point",tipHtml:ut(t,"intro.navigation.play",{next:t.t("intro.points.title")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{v=!1,E=null,b=null,T=null,t.on("modechange",fe),o.on("move",oe),F(O).catch(Re=>{Re instanceof Error&&console.error(Re)}).finally(()=>{t.off("modechange",fe),o.off("move",oe)});function oe(){typeof b=="function"&&b()}function fe(Re){typeof T=="function"&&T(Re)}},r.exit=()=>{v=!0,E&&(E(),E=null)},r.restart=()=>{r.exit(),r.enter()},$t(r,i,"on")}function SO(t,e){let i=Pt("done"),r={title:"intro.points.title"},s=t.systems.ui.editMenu,n=t.container(),o=t.systems.edits,a=t.systems.map,l=t.systems.presets,c=new mt([-85.63261,41.94391],[-85.63222,41.94419]),d=l.item("amenity/cafe"),m=!1,g=null,_=null,v=null,E=null;function b(){return E&&t.hasEntity(E)}function T(){var ee;if(((ee=t.mode)==null?void 0:ee.id)!=="select-osm")return!1;let ne=t.selectedIDs();return ne.length===1&&ne[0]===E}function A(ne){return m?Promise.reject():typeof ne!="function"?Promise.resolve():ne().then(ee=>A(ee)).catch(ee=>(ee instanceof Error&&console.error(ee),A(ne)))}function M(){t.enter("browse"),o.resetToCheckpoint("initial"),E=null;let ne=c.center(),ee=_n(ne,a.center());return ee>0&&e.hide(),a.setCenterZoomAsync(ne,20,ee).then(()=>new Promise((re,te)=>{g=te,_=()=>re(k),e.reveal({revealSelector:"button.add-point",tipHtml:ut(t,"intro.points.points_info")+"{br}"+ut(t,"intro.points.add_point")}).selectAll(".popover-inner").insert("svg","span").attr("class","tooltip-illustration").append("use").attr("xlink:href","#rapid-graphic-points")})).finally(()=>{_=null})}function k(){var ne;return((ne=t.mode)==null?void 0:ne.id)!=="add-point"?Promise.resolve(M):(E=null,new Promise((ee,re)=>{g=re,_=()=>ee(F),v=ie=>{if(!ie)return;let oe=ie.created();oe.length===1&&(E=oe[0].id)};let te=t.lastPointerType==="mouse"?"place_point":"place_point_touch";e.reveal({revealExtent:c,tipHtml:ut(t,`intro.points.${te}`)})}).finally(()=>{_=null,v=null}))}function F(){return Dr().then(()=>new Promise((ne,ee)=>{if(g=ee,!b()){ne(M);return}T()||t.enter("select-osm",{selectedIDs:[E]}),_=ee,v=te=>{if(!te)return;let ie=te.modified();ie.length===1&&(l.match(ie[0],t.graph())===d?ne(O):ee())},n.select(".inspector-wrap").on("wheel.intro",Xs),Dl(n),e.reveal({revealSelector:".preset-search-input",tipHtml:ut(t,"intro.points.search_cafe",{preset:d.name()})}),n.select(".preset-search-input").on("keydown.intro",null).on("keyup.intro",re);function re(){let te=n.select(".preset-list-item:first-child");te.classed("preset-amenity-cafe")&&(e.reveal({revealNode:te.select(".preset-list-button").node(),revealPadding:5,tipHtml:ut(t,"intro.points.choose_cafe",{preset:d.name()})}),n.select(".preset-search-input").on("keydown.intro",Xs,!0).on("keyup.intro",null))}})).finally(()=>{_=null,v=null,n.select(".inspector-wrap").on("wheel.intro",null),n.select(".preset-search-input").on("keydown.intro keyup.intro",null)})}function O(){return Dr().then(()=>new Promise((ne,ee)=>{if(g=ee,!b()){ne(M);return}T()||t.enter("select-osm",{selectedIDs:[E]}),_=()=>ne(B),Nn(n),e.reveal({revealSelector:".entity-editor-pane",tipHtml:ut(t,"intro.points.feature_editor"),tipClass:"intro-points-describe",buttonText:t.tHtml("intro.ok"),buttonCallback:()=>ne(B)})})).finally(()=>{_=null})}function B(){return Dr().then(()=>new Promise((ne,ee)=>{if(g=ee,!b()){ne(M);return}T()||t.enter("select-osm",{selectedIDs:[E]}),_=()=>ne(z),v=()=>ne(U),Nn(n),t.hasEntity(E).tags.name?e.reveal({revealSelector:".entity-editor-pane",tipHtml:ut(t,"intro.points.fields_info"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>ne(U)}).select(".instruction").style("display","none"):e.reveal({revealSelector:".entity-editor-pane",tipHtml:ut(t,"intro.points.fields_info")+"{br}"+ut(t,"intro.points.add_name"),tipClass:"intro-points-describe"})})).finally(()=>{_=null,v=null})}function U(){return b()?(T()||t.enter("select-osm",{selectedIDs:[E]}),new Promise((ne,ee)=>{g=ee,_=()=>ne(z),Nn(n);let te=ye(".entity-editor-pane button.close svg use").attr("href")||"#rapid-icon-close";e.reveal({revealSelector:".entity-editor-pane",tipHtml:ut(t,"intro.points.add_close",{button:gi(te,"inline")})})}).finally(()=>{_=null})):Promise.resolve(M)}function z(){if(!b())return Promise.resolve(M);let ne=t.entity(E),ee=l.match(ne,t.graph());return t.replace(qa(E,ee,d)),o.setCheckpoint("hasPoint"),Promise.resolve(Z)}function Z(){t.enter("browse"),o.resetToCheckpoint("hasPoint");let ne=c.center(),ee=_n(ne,a.center());return ee>0&&e.hide(),a.setCenterZoomAsync(ne,20,ee).then(()=>new Promise((re,te)=>{g=te,_=()=>re(W),e.reveal({revealExtent:c,tipHtml:ut(t,"intro.points.reselect")})})).finally(()=>{_=null})}function W(){return Dr().then(()=>new Promise((ne,ee)=>{if(g=ee,!b()||!T()){ne(Z);return}_=ee,v=()=>ne(q),Nn(n),e.reveal({revealSelector:".entity-editor-pane",tipHtml:ut(t,"intro.points.update"),tipClass:"intro-points-describe"})})).finally(()=>{_=null,v=null})}function q(){return!b()||!T()?Promise.resolve(Z):new Promise((ne,ee)=>{g=ee,_=()=>ne(Q),Nn(n),e.reveal({revealSelector:".entity-editor-pane",tipHtml:ut(t,"intro.points.update_close",{button:gi("#rapid-icon-close","inline")})})}).finally(()=>{_=null})}function Q(){var ne;return b()?(["browse","select-osm"].includes((ne=t.mode)==null?void 0:ne.id)||t.enter("browse"),new Promise((ee,re)=>{g=re,v=re;let te=t.lastPointerType==="mouse"?"rightclick":"edit_menu_touch";e.reveal({revealExtent:c,tipHtml:ut(t,`intro.points.${te}`)}),s.on("toggled.intro",ie=>{ie&&ee(V)})}).finally(()=>{v=null,s.on("toggled.intro",null)})):Promise.resolve(Z)}function V(){return n.select(".edit-menu-item-delete").node()?Dr().then(()=>new Promise((ee,re)=>{if(g=re,_=()=>{b()&&re()},v=te=>{if(!te)return;let ie=te.deleted();ie.length===1&&ie[0].id===E&&ee(le)},!b()||!T()){ee(Q);return}e.reveal({revealSelector:".edit-menu",revealPadding:50,tipHtml:ut(t,"intro.points.delete")})})).finally(()=>{_=null,v=null}):Promise.resolve(Q)}function le(){return new Promise((ne,ee)=>{g=ee,v=()=>ne(de),e.reveal({revealSelector:".top-toolbar button.undo-button",tipHtml:ut(t,"intro.points.undo")})}).finally(()=>{v=null})}function de(){return i.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-area",tipHtml:ut(t,"intro.points.play",{next:t.t("intro.areas.title")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{m=!1,g=null,_=null,v=null,t.on("modechange",ne),o.on("change",ee),A(M).catch(re=>{re instanceof Error&&console.error(re)}).finally(()=>{t.off("modechange",ne),o.off("change",ee)});function ne(re){typeof _=="function"&&_(re)}function ee(re){typeof v=="function"&&v(re)}},r.exit=()=>{m=!0,g&&(g(),g=null)},r.restart=()=>{r.exit(),r.enter()},$t(r,i,"on")}function AO(t,e){let i=Pt("done"),r={title:"intro.areas.title"},s=t.container(),n=t.systems.edits,o=t.systems.map,a=t.systems.presets,l=new mt([-85.63575,41.94137],[-85.63526,41.9418]),c=a.item("leisure/playground"),d=a.field("name"),m=a.field("description"),g=!1,_=null,v=null,E=null,b=null;function T(){return b&&t.hasEntity(b)}function A(){var le;if(((le=t.mode)==null?void 0:le.id)!=="select-osm")return!1;let V=t.selectedIDs();return V.length===1&&V[0]===b}function M(V){return g?Promise.reject():typeof V!="function"?Promise.resolve():V().then(le=>M(le)).catch(le=>(le instanceof Error&&console.error(le),M(V)))}function k(){t.enter("browse"),n.resetToCheckpoint("initial"),b=null;let V=l.center(),le=_n(V,o.center());return le>0&&e.hide(),o.setCenterZoomAsync(V,19.5,le).then(()=>new Promise((de,ne)=>{_=ne,v=()=>de(F),e.reveal({revealSelector:"button.draw-area",tipHtml:ut(t,"intro.areas.add_playground")}).selectAll(".popover-inner").insert("svg","span").attr("class","tooltip-illustration").append("use").attr("xlink:href","#rapid-graphic-areas")})).finally(()=>{v=null})}function F(){var V;return((V=t.mode)==null?void 0:V.id)!=="draw-area"?Promise.resolve(k):(b=null,new Promise((le,de)=>{_=de,v=de,E=re=>{if(re)for(let te of re.created())te.type==="way"&&(b=te.id,le(O))};let ne=t.lastPointerType==="mouse"?"click":"tap",ee=ut(t,"intro.areas.start_playground")+ut(t,`intro.areas.starting_node_${ne}`);e.reveal({revealExtent:l,tipHtml:ee})}).finally(()=>{v=null,E=null}))}function O(){var V;return!T()||((V=t.mode)==null?void 0:V.id)!=="draw-area"?Promise.resolve(k):new Promise((le,de)=>{_=de,v=de,E=ne=>{if(ne)for(let ee of ne.modified())ee.id===b&&ee.nodes.length>5&&le(B)},e.reveal({revealExtent:l,tipHtml:ut(t,"intro.areas.continue_playground")})}).finally(()=>{v=null,E=null})}function B(){var V;return!T()||((V=t.mode)==null?void 0:V.id)!=="draw-area"?Promise.resolve(k):new Promise((le,de)=>{_=de,v=()=>le(U);let ne=t.lastPointerType==="mouse"?"click":"tap",ee=ut(t,`intro.areas.finish_area_${ne}`)+ut(t,"intro.areas.finish_playground");e.reveal({revealExtent:l,tipHtml:ee})}).finally(()=>{v=null})}function U(){return Dr().then(()=>new Promise((V,le)=>{if(_=le,!T()){V(k);return}A()||t.enter("select-osm",{selectedIDs:[b]}),v=le,E=ne=>{if(!ne)return;let ee=ne.modified();ee.length===1&&(a.match(ee[0],t.graph())===c?V(z):le())},Dl(s),s.select(".inspector-wrap").on("wheel.intro",Xs),e.reveal({revealSelector:".preset-search-input",tipHtml:ut(t,"intro.areas.search_playground",{preset:c.name()})}),s.select(".preset-search-input").on("keydown.intro",null).on("keyup.intro",de);function de(){let ne=s.select(".preset-list-item:first-child");ne.classed("preset-leisure-playground")&&(e.reveal({revealNode:ne.select(".preset-list-button").node(),revealPadding:5,tipHtml:ut(t,"intro.areas.search_playground",{preset:c.name()})}),s.select(".preset-search-input").on("keydown.intro",Xs,!0).on("keyup.intro",null))}})).finally(()=>{v=null,E=null,s.select(".inspector-wrap").on("wheel.intro",null),s.select(".preset-search-input").on("keydown.intro keyup.intro",null)})}function z(){return Dr().then(()=>new Promise((V,le)=>{if(_=le,!T()){V(k);return}if(A()||t.enter("select-osm",{selectedIDs:[b]}),!s.select(".form-field-description").empty()){V(W);return}if(t.entity(b).tags.description){V(Q);return}v=le,Nn(s),s.select(".inspector-wrap").on("wheel.intro",Xs);let ne=s.select(".more-fields").node().getBoundingClientRect();if(ne.top>300){let ee=s.select(".entity-editor-pane .inspector-body"),re=ee.node().scrollTop,te=re+(ne.top-300);ee.transition().duration(250).tween("scroll.inspector",()=>{let ie=this,oe=en(re,te);return function(fe){ie.scrollTop=oe(fe)}})}window.setTimeout(()=>{e.reveal({revealSelector:".more-fields .combobox-input",revealPadding:5,tipHtml:ut(t,"intro.areas.add_field",{name:d.label(),description:m.label()})}),s.select(".more-fields .combobox-input").on("click.intro",()=>{let ee=window.setInterval(()=>{s.select("div.combobox").empty()||(window.clearInterval(ee),V(Z))},300)})},300)})).finally(()=>{v=null,s.select(".inspector-wrap").on("wheel.intro",null),s.select(".more-fields .combobox-input").on("click.intro",null)})}function Z(){if(!T())return Promise.resolve(k);if(!A())return Promise.resolve(U);if(!s.select(".form-field-description").empty())return Promise.resolve(W);if(s.select("div.combobox").empty())return Promise.resolve(z);let V;return new Promise((le,de)=>{_=de,v=de,V=window.setInterval(()=>{s.select("div.combobox").empty()&&(window.clearInterval(V),window.setTimeout(()=>{s.select(".form-field-description").empty()?le(q):le(W)},300))},300),Nn(s),e.reveal({revealSelector:"div.combobox",revealPadding:5,tipHtml:ut(t,"intro.areas.choose_field",{field:m.label()})})}).finally(()=>{v=null,V&&window.clearInterval(V)})}function W(){return T()?A()?s.select(".form-field-description").empty()?Promise.resolve(q):new Promise((V,le)=>{_=le,v=()=>V(Q),Nn(s),e.reveal({revealSelector:".entity-editor-pane",tipHtml:ut(t,"intro.areas.describe_playground",{button:gi("#rapid-icon-close","inline")})})}).finally(()=>{v=null}):Promise.resolve(U):Promise.resolve(k)}function q(){return T()?A()?new Promise((V,le)=>{_=le,v=le,Nn(s),e.reveal({revealSelector:".entity-editor-pane",tipHtml:ut(t,"intro.areas.retry_add_field",{field:m.label()}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>V(z)})}).finally(()=>{v=null}):Promise.resolve(U):Promise.resolve(k)}function Q(){return i.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-line",tipHtml:ut(t,"intro.areas.play",{next:t.t("intro.lines.title")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{g=!1,_=null,v=null,E=null,t.on("modechange",V),n.on("change",le),M(k).catch(de=>{de instanceof Error&&console.error(de)}).finally(()=>{t.off("modechange",V),n.off("change",le)});function V(de){typeof v=="function"&&v(de)}function le(de){typeof E=="function"&&E(de)}},r.exit=()=>{g=!0,_&&(_(),_=null)},r.restart=()=>{r.exit(),r.enter()},$t(r,i,"on")}function CO(t,e){let i=Pt("done"),r={title:"intro.lines.title"},s=t.systems.ui.editMenu,n=t.container(),o=t.behaviors.drag,a=t.systems.edits,l=t.systems.map,c=t.systems.presets,d="w646",m=new mt([-85.63016,41.95749],[-85.62937,41.95843]),g=new mt([-85.63044,41.95686],[-85.629,41.95843]),_=[-85.629745,41.95742],v=c.item("category-road_minor"),E=c.item("highway/residential"),b="w525",T="n2862",A=new mt([-85.62457,41.95381],[-85.62326,41.9548]),M=[-85.6239,41.95397],k=[-85.62387,41.95467],F=[-85.62386,41.9543],O="w522",B="w1",U="n3550",z=new mt([-85.62304,41.95084],[-85.62087,41.95336]),Z=t.entity(U).loc,W=!1,q=null,Q=null,V=null,le=null,de=null,ne=null;function ee(){return ne&&t.hasEntity(ne)}function re(){var dt;if(((dt=t.mode)==null?void 0:dt.id)!=="select-osm")return!1;let Ke=t.selectedIDs();return Ke.length===1&&Ke[0]===ne}function te(){let Ke=ne&&t.hasEntity(ne),dt=d&&t.hasEntity(d);if(!Ke||!dt)return!1;let kt=t.graph();return kt.childNodes(Ke).some(Qt=>kt.parentWays(Qt).some(Oi=>Oi.id===d))}function ie(){return t.hasEntity(b)&&t.hasEntity(T)}function oe(){var dt;if(((dt=t.mode)==null?void 0:dt.id)!=="select-osm")return!1;let Ke=t.selectedIDs();return Ke.length===1&&Ke[0]===b}function fe(){return t.hasEntity(O)&&t.hasEntity(B)&&t.hasEntity(U)}function Re(){return de&&t.hasEntity(de)}function He(){var dt;if(((dt=t.mode)==null?void 0:dt.id)!=="select-osm")return!1;let Ke=t.selectedIDs();return Ke.length===1&&Ke[0]===U}function Je(Ke){return W?Promise.reject():typeof Ke!="function"?Promise.resolve():Ke().then(dt=>Je(dt)).catch(dt=>(dt instanceof Error&&console.error(dt),Je(Ke)))}function ot(){t.enter("browse"),a.resetToCheckpoint("initial"),ne=null;let Ke=m.center(),dt=_n(Ke,l.center());return dt>0&&e.hide(),l.setCenterZoomAsync(Ke,18.5,dt).then(()=>new Promise((kt,Zt)=>{q=Zt,V=()=>kt(yt),e.reveal({revealSelector:"button.draw-line",tipHtml:ut(t,"intro.lines.add_line")}).selectAll(".popover-inner").insert("svg","span").attr("class","tooltip-illustration").append("use").attr("xlink:href","#rapid-graphic-lines")})).finally(()=>{V=null})}function yt(){var Ke;return((Ke=t.mode)==null?void 0:Ke.id)!=="draw-line"?Promise.resolve(ot):(ne=null,new Promise((dt,kt)=>{q=kt,V=kt,le=Oi=>{if(Oi)for(let gr of Oi.created())gr.type==="way"&&(ne=gr.id,dt(bt))};let Zt=t.lastPointerType==="mouse"?"start_line":"start_line_tap",Qt=ut(t,"intro.lines.missing_road")+"{br}"+ut(t,"intro.lines.line_draw_info")+ut(t,`intro.lines.${Zt}`);e.reveal({revealExtent:m,tipHtml:Qt})}).finally(()=>{V=null,le=null}))}function bt(){let Ke=g.center(),dt=_n(Ke,l.center());return l.setCenterZoomAsync(Ke,18.5,dt).then(()=>new Promise((kt,Zt)=>{var Qt;if(q=Zt,!ee()||((Qt=t.mode)==null?void 0:Qt.id)!=="draw-line"){kt(ot);return}V=()=>kt(at),le=()=>{te()&&kt(Te)},e.reveal({revealExtent:g,tipHtml:ut(t,"intro.lines.intersect",{name:t.t("intro.graph.name.flower-street")})})})).finally(()=>{V=null,le=null})}function at(){return new Promise((Ke,dt)=>{q=dt,e.reveal({revealExtent:new mt(_).padByMeters(15),tipHtml:ut(t,"intro.lines.retry_intersect",{name:t.t("intro.graph.name.flower-street")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>Ke(ot)})})}function Te(){let Ke=g.center(),dt=_n(Ke,l.center());return l.setCenterZoomAsync(Ke,18.5,dt).then(()=>new Promise((kt,Zt)=>{var gr;if(q=Zt,!ee()||((gr=t.mode)==null?void 0:gr.id)!=="draw-line"){kt(ot);return}V=()=>kt(Ze);let Qt=t.lastPointerType==="mouse"?"click":"tap",Oi=ut(t,"intro.lines.continue_line")+"{br}"+ut(t,`intro.lines.finish_line_${Qt}`)+ut(t,"intro.lines.finish_road");e.reveal({revealSelector:".main-map",tipHtml:Oi})})).finally(()=>{V=null})}function Ze(){let Ke;return Dr().then(()=>new Promise((dt,kt)=>{if(q=kt,!ee()){dt(ot);return}if(re()||t.enter("select-osm",{selectedIDs:[ne]}),V=kt,Dl(n),n.select(".inspector-wrap").on("wheel.intro",Xs),Ke=n.select(".preset-category-road_minor .preset-list-button"),Ke.empty()){kt(new Error("no minor roads category?"));return}if(Ke.classed("expanded")){dt(xt);return}e.reveal({revealNode:Ke.node(),revealPadding:5,tipHtml:ut(t,"intro.lines.choose_category_road",{category:v.name()})}),Ke.on("click.intro",()=>dt(xt))})).finally(()=>{V=null,Ke&&Ke.on("click.intro",null),n.select(".inspector-wrap").on("wheel.intro",null)})}function xt(){return Dr().then(()=>new Promise((Ke,dt)=>{if(q=dt,!ee()){Ke(ot);return}re()||t.enter("select-osm",{selectedIDs:[ne]}),Dl(n),n.select(".inspector-wrap").on("wheel.intro",Xs);let kt=n.select(".preset-category-road_minor .preset-list-button");if(kt.empty()){dt(new Error("no minor roads category?"));return}if(!kt.classed("expanded")){Ke(Ze);return}let Zt=n.select(".preset-category-road_minor .subgrid");if(Zt.empty()){dt(new Error("no minor roads presets?"));return}V=dt,le=Qt=>{if(!Qt)return;let Oi=Qt.modified();Oi.length===1&&(c.match(Oi[0],t.graph())===E?Ke(Bt):Ke(It))},e.reveal({revealNode:Zt.node(),revealPadding:5,tipSelector:".preset-highway-residential .preset-list-button",tipHtml:ut(t,"intro.lines.choose_preset_residential",{preset:E.name()})})})).finally(()=>{V=null,le=null,n.select(".inspector-wrap").on("wheel.intro",null)})}function It(){return Dr().then(()=>new Promise((Ke,dt)=>{if(q=dt,!ee()){Ke(ot);return}re()||t.enter("select-osm",{selectedIDs:[ne]}),Dl(n),n.select(".inspector-wrap").on("wheel.intro",Xs);let kt=n.select(".preset-category-road_minor .preset-list-button");if(kt.empty()){dt(new Error("no minor roads category?"));return}if(!kt.classed("expanded")){Ke(Ze);return}let Zt=n.select(".preset-highway-residential .preset-list-button");if(Zt.empty()){dt(new Error("no residential road preset?"));return}V=dt,le=Qt=>{if(!Qt)return;let Oi=Qt.modified();Oi.length===1&&(c.match(Oi[0],t.graph())===E?Ke(Bt):Ke(Ze))},e.reveal({revealNode:Zt.node(),revealPadding:5,tipHtml:ut(t,"intro.lines.retry_preset_residential",{preset:E.name()})})})).finally(()=>{V=null,le=null,n.select(".inspector-wrap").on("wheel.intro",null)})}function Bt(){return Dr().then(()=>new Promise((Ke,dt)=>{if(q=dt,!ee()){Ke(ot);return}re()||t.enter("select-osm",{selectedIDs:[ne]}),V=()=>Ke(Mi),Nn(n),e.reveal({revealSelector:".entity-editor-pane",tipHtml:ut(t,"intro.lines.name_road",{button:gi("#rapid-icon-close","inline")}),tooltipClass:"intro-lines-name_road"})})).finally(()=>{V=null})}function Mi(){return ee()?(a.setCheckpoint("doneAddLine"),new Promise((Ke,dt)=>{q=dt,e.reveal({revealSelector:".main-map",tipHtml:ut(t,"intro.lines.did_name_road"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>Ke(je)})})):Promise.resolve(ot)}function je(){t.enter("browse"),a.resetToCheckpoint("doneAddLine"),ie()||a.resetToCheckpoint("initial");let Ke=A.center(),dt=_n(Ke,l.center());return dt>0&&e.hide(),l.setCenterZoomAsync(Ke,19,dt).then(()=>new Promise((kt,Zt)=>{q=Zt,e.reveal({revealExtent:A,tipHtml:ut(t,"intro.lines.update_line"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>kt(be)})}))}function be(){return t.enter("browse"),ie()?new Promise((Ke,dt)=>{q=dt,V=Zt=>{["browse","select-osm"].includes(Zt.id)||dt()},le=Zt=>{Zt&&Zt.created().length===1?Ke(ge):dt()};let kt=t.lastPointerType==="mouse"?"":"_touch";e.reveal({revealExtent:new mt(M).padByMeters(15),tipHtml:ut(t,`intro.lines.add_node${kt}`)})}).finally(()=>{V=null,le=null}):Promise.resolve(je)}function ge(){if(!ie())return Promise.resolve(je);let Ke;return new Promise((dt,kt)=>{q=kt;let Zt=t.lastPointerType==="mouse"?"":"_touch",Qt=ut(t,`intro.lines.start_drag_endpoint${Zt}`)+ut(t,"intro.lines.drag_to_intersection");e.reveal({revealExtent:new mt(k).padByMeters(20),tipHtml:Qt}),Ke=()=>{if(!ie())kt();else{let Oi=t.entity(T);mr(Oi.loc,k)<=4&&dt(xe)}},o.on("move",Ke)}).finally(()=>{Ke&&o.off("move",Ke)})}function xe(){if(!ie())return Promise.resolve(je);let Ke;return new Promise((dt,kt)=>{q=kt,V=()=>dt(Me);let Zt=t.lastPointerType==="mouse"?"":"_touch",Qt=ut(t,"intro.lines.spot_looks_good")+ut(t,`intro.lines.finish_drag_endpoint${Zt}`);e.reveal({revealExtent:new mt(k).padByMeters(20),tipHtml:Qt}),Ke=()=>{if(!ie())kt();else{let Oi=t.entity(T);mr(Oi.loc,k)>4&&dt(ge)}},o.on("move",Ke)}).finally(()=>{V=null,Ke&&o.off("move",Ke)})}function Me(){return ie()?(oe()||t.enter("select-osm",{selectedIDs:[b]}),new Promise((Ke,dt)=>{q=dt,V=dt,le=kt=>{kt&&kt.created().length===1&&Ke(Oe)},e.reveal({revealExtent:new mt(F).padByMeters(20),tipHtml:ut(t,"intro.lines.start_drag_midpoint")})}).finally(()=>{V=null,le=null})):Promise.resolve(je)}function Oe(){return ie()?new Promise((Ke,dt)=>{q=dt,e.reveal({revealExtent:A,tipHtml:ut(t,"intro.lines.continue_drag_midpoint"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>{a.setCheckpoint("doneUpdateLine"),Ke(De)}})}):Promise.resolve(je)}function De(){t.enter("browse"),a.resetToCheckpoint("doneUpdateLine"),fe()||a.resetToCheckpoint("initial");let Ke=z.center(),dt=_n(Ke,l.center());return dt>0&&e.hide(),l.setCenterZoomAsync(Ke,18,dt).then(()=>new Promise((kt,Zt)=>{q=Zt,e.reveal({revealExtent:z,tipHtml:ut(t,"intro.lines.delete_lines",{street:t.t("intro.graph.name.12th-avenue")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>kt(rt)})}))}function rt(){return t.enter("browse"),a.resetToCheckpoint("doneUpdateLine"),fe()||a.resetToCheckpoint("initial"),de=null,new Promise((Ke,dt)=>{q=dt,le=dt;let kt=t.lastPointerType==="mouse"?"rightclick_intersection":"edit_menu_intersection_touch",Zt=ut(t,"intro.lines.split_street",{street1:t.t("intro.graph.name.11th-avenue"),street2:t.t("intro.graph.name.washington-street")})+ut(t,`intro.lines.${kt}`);e.reveal({revealExtent:new mt(Z).padByMeters(10),tipHtml:Zt}),s.on("toggled.intro",Qt=>{Qt&&Ke(ct)})}).finally(()=>{le=null,s.on("toggled.intro",null)})}function ct(){return n.select(".edit-menu-item-split").node()?(de=null,Dr().then(()=>new Promise((dt,kt)=>{if(q=kt,!fe()){dt(De);return}He()||t.enter("select-osm",{selectedIDs:[U]});let Zt=(Qt=0)=>{let Oi=n.select(".edit-menu").node();Oi?e.reveal({duration:Qt,revealNode:Oi,revealPadding:50,tipHtml:ut(t,"intro.lines.split_intersection",{street:t.t("intro.graph.name.washington-street")})}):kt()};V=kt,le=Qt=>{Q=null,le=null,Qt&&Qt.created()?(de=Qt.created()[0].id,dt()):kt()},Q=Zt,Zt(250)})).then(Dr).then(()=>a.undoAnnotation()===t.t("operations.split.annotation.line",{n:1})?ti:Vt).finally(()=>{V=null,le=null,Q=null})):Promise.resolve(rt)}function Vt(){return t.enter("browse"),new Promise((Ke,dt)=>{q=dt,e.reveal({revealExtent:z,tipHtml:ut(t,"intro.lines.retry_split"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>Ke(rt)})})}function ti(){return fe()?Re()?new Promise((Ke,dt)=>{q=dt,V=()=>Ke(lt),le=dt;let Zt="intro.lines.did_split_"+(t.selectedIDs().length>1?"multi":"single"),Qt=t.t("intro.graph.name.washington-street");e.reveal({revealExtent:z,tipHtml:ut(t,Zt,{street1:Qt,street2:Qt})})}).finally(()=>{V=null,le=null}):Promise.resolve(rt):Promise.resolve(De)}function lt(){if(!fe())return Promise.resolve(De);if(!Re())return Promise.resolve(rt);let Ke=t.selectedIDs(),dt=Ke.indexOf(de)!==-1,kt=Ke.indexOf(B)!==-1;if(dt&&kt)return Promise.resolve(Nt);if(!dt&&!kt)return Promise.resolve(ti);let Zt,Qt;dt?(Zt=t.t("intro.graph.name.washington-street"),Qt=t.t("intro.graph.name.12th-avenue")):(Zt=t.t("intro.graph.name.12th-avenue"),Qt=t.t("intro.graph.name.washington-street"));let Oi=t.lastPointerType==="mouse"?"click":"touch",gr=ut(t,"intro.lines.multi_select",{selected:Zt,other1:Qt})+" "+ut(t,`intro.lines.add_to_selection_${Oi}`,{selected:Zt,other2:Qt});return e.reveal({revealExtent:z,tipHtml:gr}),new Promise((Ji,ys)=>{q=ys,V=ys,le=ys}).finally(()=>{V=null,le=null})}function Nt(){if(!fe())return Promise.resolve(De);if(!Re())return Promise.resolve(rt);let Ke=t.selectedIDs(),dt=Ke.indexOf(de)!==-1,kt=Ke.indexOf(B)!==-1;return!dt||!kt?Promise.resolve(lt):new Promise((Zt,Qt)=>{q=Qt,V=Qt,le=Qt;let Oi=t.lastPointerType==="mouse"?"rightclick":"edit_menu_touch",gr=ut(t,"intro.lines.multi_select_success")+ut(t,`intro.lines.multi_${Oi}`);e.reveal({revealExtent:z,tipHtml:gr}),s.on("toggled.intro",Ji=>{Ji&&Zt(Lt)})}).finally(()=>{V=null,le=null,s.on("toggled.intro",null)})}function Lt(){return n.select(".edit-menu-item-delete").node()?Dr().then(()=>new Promise((dt,kt)=>{if(q=kt,!fe()){dt(De);return}if(!Re()){dt(rt);return}let Zt=t.selectedIDs(),Qt=Zt.indexOf(de)!==-1,Oi=Zt.indexOf(B)!==-1;if(!Qt||!Oi){dt(lt);return}let gr=(Ji=0)=>{let ys=n.select(".edit-menu").node();ys?e.reveal({duration:Ji,revealNode:ys,revealPadding:50,tipHtml:ut(t,"intro.lines.multi_delete")}):kt()};V=Ji=>{Ji.id==="browse"&&!t.hasEntity(de)&&!t.hasEntity(B)?dt(Vi):dt(lt)},le=()=>{le=null,V=null,!t.hasEntity(de)&&!t.hasEntity(B)?dt(Vi):dt(qi)},Q=gr,gr(250)})).finally(()=>{V=null,le=null,Q=null}):Promise.resolve(lt)}function qi(){return t.enter("browse"),new Promise((Ke,dt)=>{q=dt,e.reveal({revealExtent:z,tipHtml:ut(t,"intro.lines.retry_delete"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>Ke(lt)})})}function Vi(){return i.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-building",tipHtml:ut(t,"intro.lines.play",{next:t.t("intro.buildings.title")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{W=!1,q=null,Q=null,V=null,le=null,t.on("modechange",dt),l.on("move",Ke),a.on("change",kt),Je(ot).catch(Zt=>{Zt instanceof Error&&console.error(Zt)}).finally(()=>{t.off("modechange",dt),l.off("move",Ke),a.off("change",kt)});function Ke(){typeof Q=="function"&&Q()}function dt(Zt){typeof V=="function"&&V(Zt)}function kt(Zt){typeof le=="function"&&le(Zt)}},r.exit=()=>{W=!0,q&&(q(),q=null)},r.restart=()=>{r.exit(),r.enter()},$t(r,i,"on")}function IO(t,e){let i=Pt("done"),r={title:"intro.buildings.title"},s=t.systems.ui.editMenu,n=t.container(),o=t.systems.edits,a=t.systems.map,l=t.systems.presets,c=new mt([-85.62836,41.95622],[-85.62791,41.95654]),d=new mt([-85.62766,41.95324],[-85.62695,41.95372]),m=l.item("category-building"),g=l.item("building/house"),_=l.item("man_made/storage_tank"),v=!1,E=null,b=null,T=null,A=null,M=null,k=null;function F(){return M&&t.hasEntity(M)}function O(){var Te;if(((Te=t.mode)==null?void 0:Te.id)!=="select-osm")return!1;let at=t.selectedIDs();return at.length===1&&at[0]===M}function B(){return k&&t.hasEntity(k)}function U(){var Te;if(((Te=t.mode)==null?void 0:Te.id)!=="select-osm")return!1;let at=t.selectedIDs();return at.length===1&&at[0]===k}function z(at){return v?Promise.reject():typeof at!="function"?Promise.resolve():at().then(Te=>z(Te)).catch(Te=>(Te instanceof Error&&console.error(Te),z(at)))}function Z(){t.enter("browse"),o.resetToCheckpoint("initial"),M=null;let at=c.center(),Te=_n(at,a.center());return Te>0&&e.hide(),a.setCenterZoomAsync(at,19,Te).then(()=>new Promise((Ze,xt)=>{E=xt,T=()=>Ze(W),e.reveal({revealSelector:"button.draw-area",tipHtml:ut(t,"intro.buildings.add_building")}).selectAll(".popover-inner").insert("svg","span").attr("class","tooltip-illustration").append("use").attr("xlink:href","#rapid-graphic-buildings")})).finally(()=>{T=null})}function W(){return M=null,a.setCenterZoomAsync(c.center(),20,200).then(()=>new Promise((at,Te)=>{var It;if(E=Te,((It=t.mode)==null?void 0:It.id)!=="draw-area"){at(Z);return}T=Te,A=Bt=>{if(Bt)for(let Mi of Bt.created())Mi.type==="way"&&(M=Mi.id,at(q))};let Ze=t.lastPointerType==="mouse"?"click":"tap",xt=ut(t,"intro.buildings.start_building")+ut(t,`intro.buildings.building_corner_${Ze}`);e.reveal({revealExtent:c,tipHtml:xt})})).finally(()=>{T=null,A=null})}function q(){var at;return!F()||((at=t.mode)==null?void 0:at.id)!=="draw-area"?Promise.resolve(Z):new Promise((Te,Ze)=>{E=Ze,T=()=>{if(F()&&O()){let Bt=t.graph(),Mi=t.entity(M),je=Bt.childNodes(Mi),be=Ei(je).map(ge=>t.projection.project(ge.loc));wO(be)?Te(V):Te(Q)}else Ze()};let xt=t.lastPointerType==="mouse"?"click":"tap",It=ut(t,"intro.buildings.continue_building")+"{br}"+ut(t,`intro.areas.finish_area_${xt}`)+ut(t,"intro.buildings.finish_building");e.reveal({revealExtent:c,tipHtml:It})}).finally(()=>{T=null})}function Q(){return new Promise((at,Te)=>{E=Te,e.reveal({revealExtent:c,tipHtml:ut(t,"intro.buildings.retry_building"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>at(Z)})})}function V(){return Dr().then(()=>new Promise((at,Te)=>{if(E=Te,!F()){at(Z);return}O()||t.enter("select-osm",{selectedIDs:[M]}),T=Te,Dl(n),n.select(".inspector-wrap").on("wheel.intro",Xs);let Ze=n.select(".preset-category-building .preset-list-button");e.reveal({revealNode:Ze.node(),revealPadding:5,tipHtml:ut(t,"intro.buildings.choose_category_building",{category:m.name()})}),Ze.on("click.intro",()=>at(le))})).finally(()=>{T=null,n.select(".inspector-wrap").on("wheel.intro",null),n.select(".preset-list-button").on("click.intro",null)})}function le(){return Dr().then(()=>new Promise((at,Te)=>{if(E=Te,!F()){at(Z);return}O()||t.enter("select-osm",{selectedIDs:[M]}),T=Te,A=xt=>{if(!xt)return;let It=xt.modified();It.length===1&&(l.match(It[0],t.graph())===g?at(de):at(V))},Dl(n),n.select(".inspector-wrap").on("wheel.intro",Xs);let Ze=n.select(".preset-building-house .preset-list-button");e.reveal({revealNode:Ze.node(),revealPadding:5,tipHtml:ut(t,"intro.buildings.choose_preset_house",{preset:g.name()})})})).finally(()=>{T=null,A=null,n.select(".inspector-wrap").on("wheel.intro",null),n.select(".preset-list-button").on("click.intro",null)})}function de(){if(!F())return Promise.resolve(Z);let at=t.entity(M),Te=l.match(at,t.graph());return t.replace(qa(M,Te,g)),o.setCheckpoint("hasHouse"),Promise.resolve(ne)}function ne(){var Te;["browse","select-osm"].includes((Te=t.mode)==null?void 0:Te.id)||t.enter("browse"),o.resetToCheckpoint("hasHouse");let at=Math.max(a.zoom(),20);return a.setCenterZoomAsync(c.center(),at,100).then(()=>new Promise((Ze,xt)=>{E=xt,A=xt;let It=t.lastPointerType==="mouse"?"rightclick_building":"edit_menu_building_touch";e.reveal({revealExtent:c,tipHtml:ut(t,`intro.buildings.${It}`)}),s.on("toggled.intro",Bt=>{Bt&&Ze(ee)})})).finally(()=>{A=null,s.on("toggled.intro",null)})}function ee(){return n.select(".edit-menu-item-orthogonalize").node()?Dr().then(()=>new Promise((Te,Ze)=>{if(E=Ze,!F()||!O()){Te(ne);return}let xt=(It=0)=>{let Bt=n.select(".edit-menu").node();Bt?e.reveal({duration:It,revealNode:Bt,revealPadding:50,tipHtml:ut(t,"intro.buildings.square_building")}):Ze()};T=Ze,A=()=>{A=null,b=null,e.reveal({revealExtent:c}),Te()},b=xt,xt(250)})).then(Dr).then(()=>o.undoAnnotation()===t.t("operations.orthogonalize.annotation.feature",{n:1})?te:re).finally(()=>{b=null,T=null,A=null}):Promise.resolve(ne)}function re(){return t.enter("browse"),new Promise((at,Te)=>{E=Te,e.reveal({revealExtent:c,tipHtml:ut(t,"intro.buildings.retry_square"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>at(ne)})})}function te(){return o.setCheckpoint("doneSquare"),new Promise((at,Te)=>{E=Te,e.reveal({revealExtent:c,tipHtml:ut(t,"intro.buildings.done_square"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>at(ie)})})}function ie(){t.enter("browse"),o.resetToCheckpoint("doneSquare"),k=null;let at=d.center(),Te=_n(at,a.center());return Te>0&&e.hide(),a.setCenterZoomAsync(at,19.5,Te).then(()=>new Promise((Ze,xt)=>{E=xt,T=()=>Ze(oe),e.reveal({revealSelector:"button.draw-area",tipHtml:ut(t,"intro.buildings.add_tank")})})).finally(()=>{T=null})}function oe(){var at;return((at=t.mode)==null?void 0:at.id)!=="draw-area"?Promise.resolve(ie):(k=null,new Promise((Te,Ze)=>{E=Ze,T=Ze,A=Bt=>{if(Bt)for(let Mi of Bt.created())Mi.type==="way"&&(k=Mi.id,Te(fe))};let xt=t.lastPointerType==="mouse"?"click":"tap",It=ut(t,"intro.buildings.start_tank")+ut(t,`intro.buildings.tank_edge_${xt}`);e.reveal({revealExtent:d,tipHtml:It})}).finally(()=>{T=null,A=null}))}function fe(){var at;return((at=t.mode)==null?void 0:at.id)!=="draw-area"?Promise.resolve(ie):new Promise((Te,Ze)=>{E=Ze,T=()=>{B()&&U()?Te(Re):Ze()};let xt=t.lastPointerType==="mouse"?"click":"tap",It=ut(t,"intro.buildings.continue_tank")+"{br}"+ut(t,`intro.areas.finish_area_${xt}`)+ut(t,"intro.buildings.finish_tank");e.reveal({revealExtent:d,tipHtml:It})}).finally(()=>{T=null})}function Re(){return Dr().then(()=>new Promise((at,Te)=>{if(E=Te,!B()){at(ie);return}U()||t.enter("select-osm",{selectedIDs:[k]}),T=Te,A=xt=>{if(!xt)return;let It=xt.modified();It.length===1&&(l.match(It[0],t.graph())===_?at(He):Te())},n.select(".inspector-wrap").on("wheel.intro",Xs),Dl(n),e.reveal({revealSelector:".preset-search-input",tipHtml:ut(t,"intro.buildings.search_tank",{preset:_.name()})}),n.select(".preset-search-input").on("keydown.intro",null).on("keyup.intro",Ze);function Ze(){let xt=n.select(".preset-list-item:first-child");xt.classed("preset-man_made-storage_tank")&&(e.reveal({revealNode:xt.select(".preset-list-button").node(),revealPadding:5,tipHtml:ut(t,"intro.buildings.choose_tank",{preset:_.name()})}),n.select(".preset-search-input").on("keydown.intro",Xs,!0).on("keyup.intro",null))}})).finally(()=>{T=null,A=null,n.select(".inspector-wrap").on("wheel.intro",null),n.select(".preset-search-input").on("keydown.intro keyup.intro",null)})}function He(){if(!B())return Promise.resolve(ie);let at=t.entity(k),Te=l.match(at,t.graph());return t.replace(qa(k,Te,_)),o.setCheckpoint("hasTank"),Promise.resolve(Je)}function Je(){var at;return["browse","select-osm"].includes((at=t.mode)==null?void 0:at.id)||t.enter("browse"),o.resetToCheckpoint("hasTank"),new Promise((Te,Ze)=>{E=Ze,A=Ze;let xt=t.lastPointerType==="mouse"?"rightclick_tank":"edit_menu_tank_touch";e.reveal({revealExtent:d,tipHtml:ut(t,`intro.buildings.${xt}`)}),s.on("toggled.intro",It=>{It&&Te(ot)})}).finally(()=>{A=null,s.on("toggled.intro",null)})}function ot(){return n.select(".edit-menu-item-circularize").node()?Dr().then(()=>new Promise((Te,Ze)=>{if(E=Ze,!B()||!U()){Te(Je);return}T=Ze;let xt=(It=0)=>{let Bt=n.select(".edit-menu").node();Bt?e.reveal({duration:It,revealNode:Bt,revealPadding:50,tipHtml:ut(t,"intro.buildings.circle_tank")}):Ze()};A=()=>{b=null,A=null,e.reveal({revealExtent:d}),Te()},b=xt,xt(250)})).then(Dr).then(()=>o.undoAnnotation()===t.t("operations.circularize.annotation.feature",{n:1})?bt:yt).finally(()=>{b=null,T=null,A=null}):Promise.resolve(Je)}function yt(){return t.enter("browse"),new Promise((at,Te)=>{E=Te,e.reveal({revealExtent:d,tipHtml:ut(t,"intro.buildings.retry_circle"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>at(Je)})})}function bt(){return i.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-rapid",tipHtml:ut(t,"intro.buildings.play",{next:t.t("intro.rapid.title")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{v=!1,E=null,b=null,T=null,A=null,t.on("modechange",Te),a.on("move",at),o.on("change",Ze),z(Z).catch(xt=>{xt instanceof Error&&console.error(xt)}).finally(()=>{t.off("modechange",Te),a.off("move",at),o.off("change",Ze)});function at(){typeof b=="function"&&b()}function Te(xt){typeof T=="function"&&T(xt)}function Ze(xt){typeof A=="function"&&A(xt)}},r.exit=()=>{v=!0,E&&(E(),E=null)},r.restart=()=>{r.exit(),r.enter()},$t(r,i,"on")}function kO(t,e){let i=Pt("done","startEditing"),r={title:"intro.startediting.title"},s=t.container(),n=!1,o=null;function a(g){return n?Promise.reject():typeof g!="function"?Promise.resolve():g().then(_=>a(_)).catch(_=>(_ instanceof Error&&console.error(_),a(g)))}function l(){return new Promise((g,_)=>{o=_,e.reveal({revealSelector:".map-control.help-control",tipHtml:ut(t,"intro.startediting.help"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>g(c)})})}function c(){return new Promise((g,_)=>{o=_,e.reveal({revealSelector:".map-control.help-control",tipHtml:ut(t,"intro.startediting.shortcuts"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>g(d)})})}function d(){return s.selectAll(".shaded").remove(),new Promise((g,_)=>{o=_,e.reveal({revealSelector:".top-toolbar button.save",tipHtml:ut(t,"intro.startediting.save"),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>g(m)})})}function m(){s.selectAll(".shaded").remove();let g=Ts(s);return g.select(".modal").attr("class","modal-splash modal"),g.selectAll(".close").remove(),new Promise((_,v)=>{o=v,i.call("startEditing");let E=g.select(".content").attr("class","fillL").append("button").attr("class","modal-section huge-modal-button").on("click",_);E.append("svg").attr("class","illustration").append("use").attr("xlink:href","#rapid-logo-walkthrough"),E.append("h2").html(t.tHtml("intro.startediting.start"))}).finally(()=>{g.remove()})}return r.enter=()=>{n=!1,o=null,a(l).catch(g=>{g instanceof Error&&console.error(g)})},r.exit=()=>{s.selectAll(".shaded").remove(),n=!0,o&&(o(),o=null)},$t(r,i,"on")}function MO(t,e){let i=Pt("done"),r={title:"intro.rapid.title"},s=t.systems.edits,n=t.systems.map,o="w-516",a=new mt([-85.62991,41.95568],[-85.627,41.95638]),l=!1,c=null,d=null;function m(){var q;if(!["select","select-osm"].includes((q=t.mode)==null?void 0:q.id))return!1;let W=t.selectedIDs();return W.length===1&&W[0]===o}function g(){return t.hasEntity(o)}function _(W){return l?Promise.reject():typeof W!="function"?Promise.resolve():W().then(q=>_(q)).catch(q=>(q instanceof Error&&console.error(q),_(W)))}function v(){t.enter("browse"),s.resetToCheckpoint("initial");let W=a.center(),q=_n(W,n.center());return q>0&&e.hide(),n.setCenterZoomAsync(W,18.5,q).then(()=>new Promise((Q,V)=>{c=V,e.reveal({revealSelector:".intro-nav-wrap .chapter-rapid",tipHtml:ut(t,"intro.rapid.start",{rapid:gi("#rapid-logo-rapid-wordmark","pre-text rapid")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>Q(E)})}))}function E(){return new Promise((W,q)=>{c=q,e.reveal({revealSelector:"button.rapid-features",tipHtml:ut(t,"intro.rapid.ai_roads",{rapid:gi("#rapid-logo-rapid-wordmark","pre-text rapid")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>W(b)})})}function b(){return t.enter("browse"),s.resetToCheckpoint("initial"),t.scene().enableLayers("rapid"),t.systems.ui.togglePanes(),new Promise((W,q)=>{c=q,d=()=>W(T),ye(".inspector-wrap").on("wheel.intro",Xs),e.reveal({revealExtent:a,tipHtml:ut(t,"intro.rapid.select_road")})}).finally(()=>{d=null,ye(".inspector-wrap").on("wheel.intro",null)})}function T(){return Dr().then(()=>new Promise((W,q)=>{if(c=q,!m()){W();return}d=W,e.reveal({revealSelector:".rapid-inspector-choice-accept",tipHtml:ut(t,"intro.rapid.add_road")})})).then(()=>{var W;return((W=s.undoAnnotation())==null?void 0:W.type)==="rapid_accept_feature"?A:b}).finally(()=>{d=null})}function A(){return Dr().then(()=>new Promise((W,q)=>{if(c=q,!g()){W(b);return}m()||t.enter("select-osm",{selectedIDs:[o]}),d=q,e.reveal({revealExtent:a,tipHtml:ut(t,"intro.rapid.add_road_not_saved_yet",{rapid:gi("#rapid-logo-rapid-wordmark","pre-text rapid")}),buttonText:t.t("intro.ok"),buttonCallback:()=>W(M)})})).finally(()=>{d=null})}function M(){if(!g())return Promise.resolve(b);m()||t.enter("select-osm",{selectedIDs:[o]});let W=ye("div.map-control.issues-control > button");return new Promise((q,Q)=>{c=Q,d=Q,e.reveal({revealNode:W.node(),tipHtml:ut(t,"intro.rapid.open_issues")}),W.on("click.intro",()=>q(k))}).finally(()=>{d=null,W.on("click.intro",null)})}function k(){return Dr().then(()=>new Promise((W,q)=>{if(c=q,!g()){W(b);return}m()||t.enter("select-osm",{selectedIDs:[o]});let Q=ye("li.issue.severity-warning");e.reveal({revealNode:Q.node(),revealPadding:5,tipHtml:ut(t,"intro.rapid.new_lints"),buttonText:t.t("intro.ok"),buttonCallback:()=>W(F)})}))}function F(){if(!g())return Promise.resolve(b);m()||t.enter("select-osm",{selectedIDs:[o]});let W=ye(".top-toolbar button.undo-button");return new Promise((q,Q)=>{c=Q,e.reveal({revealNode:W.node(),tipHtml:ut(t,"intro.rapid.undo_road_add",{button:gi("#rapid-icon-undo","pre-text")})}),W.on("click.intro",()=>q(O))}).finally(()=>{W.on("click.intro",null)})}function O(){return g()?Promise.resolve(b):(t.systems.ui.togglePanes(),new Promise((W,q)=>{c=q,e.reveal({revealExtent:a,tipHtml:ut(t,"intro.rapid.undo_road_add_aftermath"),buttonText:t.t("intro.ok"),buttonCallback:()=>W(B)})}))}function B(){t.enter("browse"),s.resetToCheckpoint("initial");let W=a.center(),q=_n(W,n.center());return q>0&&e.hide(),n.setCenterZoomAsync(W,18.5,q).then(()=>new Promise((Q,V)=>{c=V,d=()=>{t.selectedIDs().includes(o)&&Q(U)},e.reveal({revealExtent:a,tipHtml:ut(t,"intro.rapid.select_road_again")})})).finally(()=>{d=null})}function U(){return Dr().then(()=>new Promise((W,q)=>{if(c=q,!m()){W();return}d=W,e.reveal({revealSelector:".rapid-inspector-choice-ignore",tipHtml:ut(t,"intro.rapid.ignore_road")})})).then(()=>{var W;return((W=s.undoAnnotation())==null?void 0:W.type)==="rapid_ignore_feature"?z:B}).finally(()=>{d=null})}function z(){return new Promise((W,q)=>{c=q,e.reveal({revealSelector:".map-control.help-control",tipHtml:ut(t,"intro.rapid.help",{rapid:gi("#rapid-logo-rapid-wordmark","pre-text rapid"),button:gi("#rapid-icon-help","pre-text"),key:t.t("help.key")}),buttonText:t.t("intro.ok"),buttonCallback:()=>W(Z)})})}function Z(){return i.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-startEditing",tipHtml:ut(t,"intro.rapid.done",{next:t.t("intro.startediting.title")}),buttonText:t.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{t.scene().enableLayers("rapid"),l=!1,c=null,d=null,t.on("modechange",W),_(v).catch(q=>{q instanceof Error&&console.error(q)}).finally(()=>{t.off("modechange",W)});function W(q){typeof d=="function"&&d(q)}},r.exit=()=>{t.scene().disableLayers("rapid"),l=!0,c&&(c(),c=null)},r.restart=()=>{r.exit(),r.enter()},$t(r,i,"on")}var lK="EsriWorldImageryClarity",cK={welcome:EO,navigation:TO,point:SO,area:AO,line:CO,building:IO,rapid:MO,startEditing:kO},w6=["welcome","navigation","point","area","line","building","rapid","startEditing"];function mc(t,e){let i={},r={},s;function n(a){let l=t.systems.data;Promise.all([l.getDataAsync("intro_rapid_graph"),l.getDataAsync("intro_graph")]).then(c=>{let d=c[0],m=c[1];for(let[g,_]of Object.entries(d))r[g]||(r[g]=Dt(OS(t,_)));for(let[g,_]of Object.entries(m))i[g]||(i[g]=Dt(OS(t,_)));a.call(o)})}function o(a){let l=t.systems.edits,c=t.systems.imagery,d=t.systems.l10n,m=t.services.mapwithai,g=t.services.osm,_=t.systems.storage,v=t.systems.rapid,E=t.systems.urlhash;E.disable(),t.inIntro=!0,t.enter("browse");let b={hash:window.location.hash,transform:t.systems.map.transform(),brightness:c.brightness,baseLayer:c.baseLayerSource(),overlayLayers:c.overlayLayerSources(),layersEnabled:new Set,datasetsEnabled:new Set,edits:l.toJSON()};for(let[Z,W]of t.scene().layers)W.enabled&&b.layersEnabled.add(Z);t.scene().onlyLayers(["background","osm","labels"]),t.systems.ui.sidebar.expand(),t.container().selectAll("button.sidebar-toggle").classed("disabled",!0),g&&g.toggle(!1),l.reset(),l.merge(Object.values(i)),l.setCheckpoint("initial");let T=c.getSource(lK)||c.getSource("Bing");c.baseLayerSource(T),b.overlayLayers.forEach(Z=>c.toggleOverlayLayer(Z)),c.brightness=1;for(let[Z,W]of v.datasets)W.enabled&&(b.datasetsEnabled.add(Z),W.enabled=!1);v.datasets.set("rapid_intro_graph",{id:"rapid_intro_graph",beta:!1,added:!0,enabled:!0,conflated:!1,service:"mapwithai",color:"#da26d3",label:"Rapid Walkthrough"}),m&&(m.toggle(!1),m.merge("rapid_intro_graph",Object.values(r)));let A=new W_(t);a.call(A.enable),_.setItem("walkthrough_started","yes");let k=(_.getItem("walkthrough_progress")||"").split(";").filter(Boolean),F=w6.map((Z,W)=>{let q=cK[Z](t,A).on("done",()=>{if(U.filter(Q=>Q.title===q.title).classed("finished",!0),W<w6.length-1){let Q=w6[W+1];t.container().select(`button.chapter-${Q}`).classed("next",!0)}k.push(Z),_.setItem("walkthrough_progress",Ei(k).join(";"))});return q});F[F.length-1].on("startEditing",()=>{k.push("startEditing"),_.setItem("walkthrough_progress",Ei(k).join(";")),Sn(w6,k).length||_.setItem("walkthrough_completed","yes");for(let[W,q]of v.datasets)q.enabled=b.datasetsEnabled.has(W);v.datasets.delete("rapid_intro_graph"),A.disable(),O.remove(),t.container().selectAll("button.sidebar-toggle").classed("disabled",!1);for(let[W,q]of t.scene().layers)q.enabled=b.layersEnabled.has(W);c.baseLayerSource(b.baseLayer),b.overlayLayers.forEach(W=>c.toggleOverlayLayer(W)),c.brightness=b.brightness,t.systems.map.transform(b.transform),window.location.replace(b.hash),t.resetAsync().then(()=>{b.edits&&l.fromJSON(b.edits,!0),g&&g.toggle(!0),m&&m.toggle(!0),t.inIntro=!1,E.enable()})});let O=a.append("div").attr("class","intro-nav-wrap fillD");O.append("svg").attr("class","intro-nav-wrap-logo").append("use").attr("xlink:href","#rapid-logo-walkthrough");let U=O.append("div").attr("class","joined").selectAll("button.chapter").data(F).enter().append("button").attr("class",(Z,W)=>`chapter chapter-${w6[W]}`).on("click",z);U.append("span").html(Z=>d.tHtml(Z.title)),U.append("span").attr("class","status").call(Ye(d.isRTL()?"#rapid-icon-backward":"#rapid-icon-forward","inline")),z(null,F[e?6:0]);function z(Z,W){s&&s.exit(),t.enter("browse"),s=W,s.enter(),U.classed("next",!1).classed("active",q=>q.title===s.title)}}return n}var su=class{constructor(e){this.context=e,this._enabled=!1}enable(){this._enabled=!0}disable(){this._enabled=!1}get enabled(){return this._enabled}};var PO=["zoom","vintage","source","description","resolution","accuracy"],E6=class extends su{constructor(e){super(e),this.id="background",this.label=e.tHtml("info_panels.background.title"),this.key=e.t("info_panels.background.key"),this._selection=ye(null),this._currSourceID=null,this._metadata={},this.render=this.render.bind(this),this.updateMetadata=this.updateMetadata.bind(this),this._deferredRender=Gr(this.render,250),this._deferredUpdateMetadata=Gr(this.updateMetadata,250)}enable(e){this._enabled||(this._enabled=!0,this._selection=e,this._currSourceID=null,this._metadata={},this.context.systems.map.on("draw",this._deferredRender).on("move",this._deferredUpdateMetadata))}disable(){this._enabled&&(this._deferredRender.cancel(),this._deferredUpdateMetadata.cancel(),this._selection.html(""),this._enabled=!1,this._selection=ye(null),this._currSourceID=null,this._metadata={},this.context.systems.map.off("draw",this._deferredRender).off("move",this._deferredUpdateMetadata))}render(){if(!this._enabled)return;let e=this.context,i=this._selection,s=e.systems.imagery.baseLayerSource();if(!s)return;this._currSourceID!==s.id&&(this._currSourceID=s.id,this._metadata={}),i.html("");let n=i.append("ul").attr("class","background-info");n.append("li").html(s.label),PO.forEach(a=>{n.append("li").attr("class",`background-info-list-${a}`).classed("hide",!this._metadata[a]).html(e.tHtml(`info_panels.background.${a}`)+":").append("span").attr("class",`background-info-span-${a}`).text(this._metadata[a])}),this._deferredUpdateMetadata();let o=e.getDebug("tile")?"hide_tiles":"show_tiles";i.append("a").html(e.tHtml(`info_panels.background.${o}`)).attr("href","#").attr("class","button button-toggle-tiles").on("click",a=>{a.preventDefault(),e.setDebug("tile",!e.getDebug("tile")),this.render()})}updateMetadata(){if(!this._enabled)return;let e=this.context,i=this._selection,s=e.systems.imagery.baseLayerSource();if(!s)return;this._currSourceID!==s.id&&(this._currSourceID=s.id,this._metadata={});let n=e.systems.map.center(),o=new mt(n),a=e.scene().layers.get("background"),l=a==null?void 0:a._tileMaps.get(s.id),c,d;if(l){for(let g of l.values())if(g.loaded&&g.wgs84Extent.contains(o)){c=g.xyz,d=g.xyz[2];break}}let m=d||Math.floor(e.systems.map.zoom());this._metadata.zoom=String(m),i.selectAll(".background-info-list-zoom").classed("hide",!1).selectAll(".background-info-span-zoom").text(this._metadata.zoom),c&&s.getMetadata(n,c,(g,_)=>{if(g||this._currSourceID!==s.id)return;let v=_.vintage;this._metadata.vintage=v&&v.range||e.t("info_panels.background.unknown"),i.selectAll(".background-info-list-vintage").classed("hide",!1).selectAll(".background-info-span-vintage").text(this._metadata.vintage),PO.forEach(E=>{if(E==="zoom"||E==="vintage")return;let b=_[E];this._metadata[E]=b,i.selectAll(`.background-info-list-${E}`).classed("hide",!b).selectAll(`.background-info-span-${E}`).text(b)})})}};var T6=class extends su{constructor(e){super(e),this.id="history",this.label=e.tHtml("info_panels.history.title"),this.key=e.t("info_panels.history.key"),this._selection=ye(null),this.render=this.render.bind(this),this.renderEntity=this.renderEntity.bind(this),this.renderNote=this.renderNote.bind(this),this.renderUser=this.renderUser.bind(this),this.renderChangeset=this.renderChangeset.bind(this),this.displayTimestamp=this.displayTimestamp.bind(this)}enable(e){this._enabled||(this._enabled=!0,this._selection=e,this.context.systems.map.on("draw",this.render),this.context.on("modechange",this.render))}disable(){this._enabled&&(this._selection.html(""),this._enabled=!1,this._selection=ye(null),this.context.systems.map.off("draw",this.render),this.context.off("modechange",this.render))}render(){if(!this._enabled)return;let e=this.context,i=this._selection;i.html("");let r,s,n;r=e.selectedIDs().filter(a=>e.hasEntity(a)),r.length&&(n=e.entity(r[0]));let o=r.length===1?r[0]:null;i.append("h4").attr("class","history-heading").html(o||e.tHtml("info_panels.selected",{n:r.length})),o&&(n?i.call(this.renderEntity,n):s&&i.call(this.renderNote,s))}renderNote(e,i){let r=this.context,s=r.services.osm;if(!i||i.isNew()){e.append("div").html(r.tHtml("info_panels.history.note_no_history"));return}let n=e.append("ul");n.append("li").html(r.tHtml("info_panels.history.note_comments")+":").append("span").html(i.comments.length),i.comments.length&&(n.append("li").html(r.tHtml("info_panels.history.note_created_date")+":").append("span").text(this.displayTimestamp(i.comments[0].date)),n.append("li").html(r.tHtml("info_panels.history.note_created_user")+":").call(this.renderUser,i.comments[0].user)),s&&e.append("a").attr("class","view-history-on-osm").attr("target","_blank").attr("href",s.noteURL(i)).call(Ye("#rapid-icon-out-link","inline")).append("span").html(r.tHtml("info_panels.history.note_link_text"))}renderEntity(e,i){let r=this.context,s=r.services.osm;if(!i||i.isNew()){e.append("div").html(r.tHtml("info_panels.history.no_history"));return}let n=e.append("div").attr("class","links");s&&n.append("a").attr("class","view-history-on-osm").attr("href",s.historyURL(i)).attr("target","_blank").attr("title",r.t("info_panels.history.link_text")).text("OSM"),n.append("a").attr("class","pewu-history-viewer-link").attr("href","https://pewu.github.io/osm-history/#/"+i.type+"/"+i.osmId()).attr("target","_blank").attr("tabindex",-1).text("PeWu");let o=e.append("ul");o.append("li").html(r.tHtml("info_panels.history.version")+":").append("span").text(i.version),o.append("li").html(r.tHtml("info_panels.history.last_edit")+":").append("span").text(this.displayTimestamp(i.timestamp)),o.append("li").html(r.tHtml("info_panels.history.edited_by")+":").call(this.renderUser,i.user),o.append("li").html(r.tHtml("info_panels.history.changeset")+":").call(this.renderChangeset,i.changeset)}displayTimestamp(e){let i=this.context;if(!e)return i.t("info_panels.history.unknown");let r={day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},s=new Date(e);if(isNaN(s.getTime()))return i.t("info_panels.history.unknown");let n=i.systems.l10n.localeCode();return s.toLocaleString(n,r)}renderUser(e,i){let r=this.context,s=r.services.osm;if(!i){e.append("span").html(r.tHtml("info_panels.history.unknown"));return}e.append("span").attr("class","user-name").html(i);let n=e.append("div").attr("class","links");s&&n.append("a").attr("class","user-osm-link").attr("href",s.userURL(i)).attr("target","_blank").text("OSM"),n.append("a").attr("class","user-hdyc-link").attr("href",`https://hdyc.neis-one.org/?${i}`).attr("target","_blank").attr("tabindex",-1).text("HDYC")}renderChangeset(e,i){let r=this.context,s=r.services.osm;if(!i){e.append("span").html(r.tHtml("info_panels.history.unknown"));return}e.append("span").attr("class","changeset-id").text(i);let n=e.append("div").attr("class","links");s&&n.append("a").attr("class","changeset-osm-link").attr("href",s.changesetURL(i)).attr("target","_blank").text("OSM"),n.append("a").attr("class","changeset-osmcha-link").attr("href",`https://osmcha.org/changesets/${i}`).attr("target","_blank").text("OSMCha"),n.append("a").attr("class","changeset-achavi-link").attr("href",`https://overpass-api.de/achavi/?changeset=${i}`).attr("target","_blank").text("Achavi")}};var S6=class extends su{constructor(e){super(e),this.id="location",this.label=e.tHtml("info_panels.location.title"),this.key=e.t("info_panels.location.key"),this._selection=ye(null),this._currLocation=null,this.render=this.render.bind(this),this.updateLocation=this.updateLocation.bind(this),this._deferredUpdateLocation=Gr(this.updateLocation,1e3)}enable(e){this._enabled||(this._enabled=!0,this._selection=e,this._currLocation=null,this.context.surface().on("pointermove.info-location",this.render))}disable(){this._enabled&&(this._deferredUpdateLocation.cancel(),this._selection.html(""),this._enabled=!1,this._selection=ye(null),this._currLocation=null,this.context.surface().on("pointermove.info-location",null))}render(){if(!this._enabled)return;let e=this.context,i=this._selection,r=e.systems.l10n;i.html("");let s=i.append("ul"),n=e.systems.map.mouseLoc();n.some(isNaN)&&(n=e.systems.map.center()),s.append("li").text(r.dmsCoordinatePair(n)).append("li").text(r.decimalCoordinatePair(n)),i.append("div").attr("class","location-info").text(this._currLocation||" "),this._deferredUpdateLocation(n)}updateLocation(e){if(!this._enabled)return;let i=this._selection,r=this.context,s=r.services.nominatim;s?s.reverse(e,(n,o)=>{this._currLocation=o?o.display_name:r.t("info_panels.location.unknown_location"),i.selectAll(".location-info").text(this._currLocation)}):(this._currLocation=r.t("info_panels.location.unknown_location"),i.selectAll(".location-info").text(this._currLocation))}};function uK(t){return t*63710071809e-4}function hK(t){return t/(4*Math.PI)*510065621724e3}function dK(t){if(t.type==="LineString")return t;let e={type:"LineString",coordinates:[]};return t.type==="Polygon"?e.coordinates=t.coordinates[0]:t.type==="MultiPolygon"&&(e.coordinates=t.coordinates[0][0]),e}var A6=class extends su{constructor(e){super(e),this.id="measurement",this.label=e.tHtml("info_panels.measurement.title"),this.key=e.t("info_panels.measurement.key"),this._selection=ye(null),this._isImperial=!e.systems.l10n.usesMetric(),this.render=this.render.bind(this)}enable(e){this._enabled||(this._enabled=!0,this._selection=e,this.context.systems.map.on("draw",this.render),this.context.on("modechange",this.render))}disable(){this._enabled&&(this._selection.html(""),this._enabled=!1,this._selection=ye(null),this.context.systems.map.off("draw",this.render),this.context.off("modechange",this.render))}render(){if(!this._enabled)return;let e=this._selection,i=this.context,r=i.graph(),s=i.systems.l10n,n=s.localeCode();e.html("");let o,a,l,c,d,m,g,_=0,v=0,E,b=i.selectedIDs(),T=i.selectedData(),[A]=T.values();if(T.size===1&&A instanceof Nr){let F=A;o=s.t("note.note")+" "+F.id,l=F.loc,m="note"}else{let F=b.map(O=>i.hasEntity(O)).filter(Boolean);if(F.length===1?o=F[0].id:o=s.t("info_panels.selected",{n:F.length}),F.length>0){let O=new mt;F.forEach(B=>{let U=B.extent(r),z=B.asGeoJSON(r);O=O.extend(U),m=B.geometry(r),(m==="line"||m==="area")&&(d=B.type==="relation"||B.isClosed()&&!B.isDegenerate(),_+=uK(jb(dK(z))),c=$b(z),(!c||!isFinite(c[0])||!isFinite(c[1]))&&(c=U.center()),d&&(v+=hK(B.area(r))))}),F.length>1&&(m=null,d=null,c=null),F.length===2&&F[0].type==="node"&&F[1].type==="node"&&(E=mr(F[0].loc,F[1].loc)),F.length===1&&F[0].type==="node"?l=F[0].loc:g=ls(b,i.graph()).length,!l&&!c&&(a=O.center())}}o&&e.append("h4").attr("class","measurement-heading").text(o);let M=e.append("ul"),k;if(m&&M.append("li").html(s.tHtml("info_panels.measurement.geometry")+":").append("span").text(d?s.t("info_panels.measurement.closed_"+m):s.t("geometry."+m)),g&&M.append("li").html(s.tHtml("info_panels.measurement.node_count")+":").append("span").text(g.toLocaleString(n)),v&&M.append("li").html(s.tHtml("info_panels.measurement.area")+":").append("span").text(s.displayArea(v,this._isImperial)),_&&M.append("li").html(s.tHtml("info_panels.measurement."+(d?"perimeter":"length"))+":").append("span").text(s.displayLength(_,this._isImperial)),typeof E=="number"&&M.append("li").html(s.tHtml("info_panels.measurement.distance")+":").append("span").text(s.displayLength(E,this._isImperial)),l&&(k=M.append("li").html(s.tHtml("info_panels.measurement.location")+":"),k.append("span").text(s.dmsCoordinatePair(l)),k.append("span").text(s.decimalCoordinatePair(l))),c&&(k=M.append("li").html(s.tHtml("info_panels.measurement.centroid")+":"),k.append("span").text(s.dmsCoordinatePair(c)),k.append("span").text(s.decimalCoordinatePair(c))),a&&(k=M.append("li").html(s.tHtml("info_panels.measurement.center")+":"),k.append("span").text(s.dmsCoordinatePair(a)),k.append("span").text(s.decimalCoordinatePair(a))),_||v||typeof E=="number"){let F=this._isImperial?"imperial":"metric";e.append("a").html(s.tHtml(`info_panels.measurement.${F}`)).attr("href","#").attr("class","button button-toggle-units").on("click",O=>{O.preventDefault(),this._isImperial=!this._isImperial,this.render()})}}};function q_(t){let e={background:new E6(t),history:new T6(t),location:new S6(t),measurement:new A6(t)},i=Object.keys(e),r=new Set,s=new Set;function n(o){function a(){let c=l.selectAll(".panel-container").data(Array.from(r),g=>g);c.exit().style("opacity",1).transition().duration(200).style("opacity",0).on("end",(g,_,v)=>{let E=ye(v[_]);e[g].disable(),E.remove()});let d=c.enter().append("div").attr("class",g=>`fillD2 panel-container panel-container-${g}`);d.style("opacity",0).transition().duration(200).style("opacity",1);let m=d.append("div").attr("class","panel-title fillD2");m.append("h3").html(g=>e[g].label),m.append("button").attr("class","close").on("click",(g,_)=>{g.stopImmediatePropagation(),g.preventDefault(),n.toggle(_)}).call(Ye("#rapid-icon-close")),d.append("div").attr("class",g=>`panel-content panel-content-${g}`).each((g,_,v)=>{let E=ye(v[_]);e[g].enable(E)}),l.selectAll(".panel-content").each(g=>e[g].render())}n.toggle=function(c){c?r.has(c)?(r.delete(c),s.size>1&&s.delete(c)):(r.add(c),s.add(c)):r.size?r.clear():(s.size||s.add("measurement"),r=new Set(s)),i.forEach(d=>{t.container().selectAll(`.${d}-panel-toggle-item`).classed("active",r.has(d)).select("input").property("checked",r.has(d))}),a()};let l=o.selectAll(".info-panels").data([0]);l=l.enter().append("div").attr("class","info-panels").merge(l),a(),t.keybinding().on(Li("\u2318"+t.t("info_panels.key")),c=>{c.stopImmediatePropagation(),c.preventDefault(),n.toggle()}),i.forEach(c=>{let d=t.t(`info_panels.${c}.key`,{default:null});d&&t.keybinding().on(Li("\u2318\u21E7"+d),m=>{m.stopImmediatePropagation(),m.preventDefault(),n.toggle(c)})})}return n}function oa(t,e){let i=e.length===1?"single":"multiple",r=e.map(d=>t.hasEntity(d)).filter(Boolean),s=r.every(d=>d.isNew()),n=Zu(e),a=ls(e,t.graph()).map(d=>d.loc),l=kr(r,t.graph()),c=function(){let d,m;if(r.length===1){let g=r[0],_=g.geometry(t.graph()),E=t.graph().parentWays(g)[0];if(_==="vertex"){let b=E.nodes,T=b.indexOf(g.id);if(T===0)T++;else if(T===b.length-1)T--;else{let A=mr(g.loc,t.entity(b[T-1]).loc),M=mr(g.loc,t.entity(b[T+1]).loc);T=A<M?T-1:T+1}d=t.entity(b[T]),m=d.loc}}t.perform(n,c.annotation()),t.systems.validator.validate(),d&&m?(t.systems.map.centerEase(m),t.enter("select-osm",{selectedIDs:[d.id]})):t.enter("browse")};return c.available=function(){return!0},c.disabled=function(){if(!s&&d())return"too_large";if(!s&&m())return"not_downloaded";if(e.some(t.hasHiddenConnections))return"connected_to_hidden";if(e.some(v))return"part_of_relation";if(e.some(_))return"incomplete_relation";if(e.some(g))return"has_wikidata_tag";return!1;function d(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&l.percentContainedIn(t.systems.map.extent())<.8}function m(){if(t.inIntro)return!1;let E=t.services.osm;if(E){let b=a.filter(T=>!E.isDataLoaded(T));if(b.length)return b.forEach(T=>t.loadTileAtLoc(T)),!0}return!1}function g(E){let b=t.entity(E);return b.tags.wikidata&&b.tags.wikidata.trim().length>0}function _(E){let b=t.entity(E);return b.type==="relation"&&!b.isComplete(t.graph())}function v(E){let b=t.entity(E);if(b.type!=="way")return!1;let T=t.graph().parentRelations(b);for(let A=0;A<T.length;A++){let M=T[A],k=M.tags.type,F=M.memberById(E).role||"outer";if(k==="route"||k==="boundary"||k==="multipolygon"&&F==="outer")return!0}return!1}},c.tooltip=function(){let d=c.disabled();return d?t.t(`operations.delete.${d}.${i}`):t.t(`operations.delete.description.${i}`)},c.annotation=function(){return e.length===1?t.t("operations.delete.annotation."+t.graph().geometry(e[0])):t.t("operations.delete.annotation.feature",{n:e.length})},c.id="delete",c.keys=[Li("\u2318\u232B"),Li("\u2318\u2326"),Li("\u2326")],c.title=t.t("operations.delete.title"),c.behavior=new Ar(t,c),c}function Y_(t){var e=t.systems.l10n,i=t.systems.filters,r=t.systems.presets,s=Pt("cancel","choose"),n,o,a,l=!1;function c(b){if(!n)return;var T=r.matchAllGeometry(E());let A=e.isRTL();b.html("");var M=b.append("div").attr("class","header fillL"),k=M.append("h3").html(e.tHtml("inspector.choose"));M.append("button").attr("class","preset-choose").on("click",function(){s.call("cancel",this)}).call(Ye(A?"#rapid-icon-backward":"#rapid-icon-forward"));var F=b.append("div").attr("class","search-header");F.call(Ye("#rapid-icon-search","pre-text"));var O=F.append("input").attr("class","preset-search-input").attr("placeholder",e.t("inspector.search")).attr("type","search").call(Ri).on("keydown",z).on("keypress",W).on("input",Gr(q));l&&(O.node().focus(),setTimeout(function(){O.node().focus()},0));var B=b.append("div").attr("class","inspector-body"),U=B.append("div").attr("class","preset-list").call(d,r.defaults(E()[0],36,!t.inIntro,o));i.on("filterchange",v);function z(Q){O.property("value").length===0&&(Q.keyCode===$i.keyCodes["\u232B"]||Q.keyCode===$i.keyCodes["\u2326"])?(Q.preventDefault(),Q.stopPropagation(),oa(t,n)()):O.property("value").length===0&&(Q.ctrlKey||Q.metaKey)&&Q.keyCode===$i.keyCodes.z?(Q.preventDefault(),Q.stopPropagation(),t.undo()):!Q.ctrlKey&&!Q.metaKey&&(ye(this).on("keydown",Z),Z.call(this,Q))}function Z(Q){if(Q.keyCode===$i.keyCodes["\u2193"]&&O.node().selectionStart===O.property("value").length){Q.preventDefault(),Q.stopPropagation();var V=U.selectAll(".preset-list-button");V.empty()||V.nodes()[0].focus()}}function W(Q){var V=O.property("value");Q.keyCode===13&&V.length&&U.selectAll(".preset-list-item:first-child").each(function(le){le.choose.call(this)})}function q(){var Q=O.property("value");U.classed("filtered",Q.length);var V,le;Q.length?(V=T.search(Q,E()[0],o),le=e.t("inspector.results",{n:V.array.length,search:Q})):(V=r.defaults(E()[0],36,!t.inIntro,o),le=e.t("inspector.choose")),U.call(d,V),k.html(le)}}function d(b,T){T=T.matchAllGeometry(E());let A=[];for(let k of T.array)k&&(k.members?A.push(g(k)):A.push(_(k)));let M=b.selectAll(".preset-list-item").data(A,k=>k.preset.id);M.order(),M.exit().remove(),M.enter().append("div").attr("class",function(k){return"preset-list-item preset-"+k.preset.id.replace("/","-")}).classed("current",function(k){return a.indexOf(k.preset)!==-1}).each(function(k){ye(this).call(k)}).style("opacity",0).transition().style("opacity",1),v()}function m(b){var T=ye(this.closest(".preset-list-item")),A=ye(T.node().parentNode.closest(".preset-list-item"));let M=e.isRTL();if(b.keyCode===$i.keyCodes["\u2193"]){b.preventDefault(),b.stopPropagation();var k=ye(T.node().nextElementSibling);k.empty()?A.empty()||(k=ye(A.node().nextElementSibling)):ye(this).classed("expanded")&&(k=T.select(".subgrid .preset-list-item:first-child")),k.empty()||k.select(".preset-list-button").node().focus()}else if(b.keyCode===$i.keyCodes["\u2191"]){b.preventDefault(),b.stopPropagation();var F=ye(T.node().previousElementSibling);if(F.empty()?A.empty()||(F=A):F.select(".preset-list-button").classed("expanded")&&(F=F.select(".subgrid .preset-list-item:last-child")),!F.empty())F.select(".preset-list-button").node().focus();else{var O=ye(this.closest(".preset-list-pane")).select(".preset-search-input");O.node().focus()}}else b.keyCode===$i.keyCodes[M?"\u2192":"\u2190"]?(b.preventDefault(),b.stopPropagation(),A.empty()||A.select(".preset-list-button").node().focus()):b.keyCode===$i.keyCodes[M?"\u2190":"\u2192"]&&(b.preventDefault(),b.stopPropagation(),T.datum().choose.call(ye(this).node()))}function g(b){var T,A,M=!1;function k(F){let O=e.isRTL();var B=F.append("div").attr("class","preset-list-button-wrap category");function U(){var q=ye(this).classed("expanded"),Q=q?O?"#rapid-icon-backward":"#rapid-icon-forward":"#rapid-icon-down";ye(this).classed("expanded",!q),ye(this).selectAll("div.label-inner svg.icon use").attr("href",Q),k.choose()}var z=E(),Z=B.append("button").attr("class","preset-list-button").classed("expanded",!1).call(l0(t).geometry(z.length===1&&z[0]).preset(b)).on("click",U).on("keydown",function(q){q.keyCode===$i.keyCodes[O?"\u2190":"\u2192"]?(q.preventDefault(),q.stopPropagation(),ye(this).classed("expanded")||U.call(this,q)):q.keyCode===$i.keyCodes[O?"\u2192":"\u2190"]?(q.preventDefault(),q.stopPropagation(),ye(this).classed("expanded")&&U.call(this,q)):m.call(this,q)}),W=Z.append("div").attr("class","label").append("div").attr("class","label-inner");W.append("div").attr("class","namepart").call(Ye(O?"#rapid-icon-backward":"#rapid-icon-forward","inline")).append("span").html(function(){return b.nameLabel()+"&hellip;"}),T=F.append("div").attr("class","subgrid").style("max-height","0px").style("opacity",0),T.append("div").attr("class","arrow"),A=T.append("div").attr("class","preset-list fillL3")}return k.choose=function(){if(!(!T||!A))if(M)M=!1,T.transition().duration(200).style("opacity","0").style("max-height","0px").style("padding-bottom","0px");else{M=!0;var F=b.members.matchAllGeometry(E());A.call(d,F),T.transition().duration(200).style("opacity","1").style("max-height",200+F.array.length*190+"px").style("padding-bottom","10px")}},k.preset=b,k}function _(b){function T(A){var M=A.append("div").attr("class","preset-list-button-wrap"),k=E(),F=M.append("button").attr("class","preset-list-button").call(l0(t).geometry(k.length===1&&k[0]).preset(b)).on("click",T.choose).on("keydown",m),O=F.append("div").attr("class","label").append("div").attr("class","label-inner"),B=[b.nameLabel(),b.subtitleLabel()].filter(Boolean);O.selectAll(".namepart").data(B).enter().append("div").attr("class","namepart").html(function(U){return U}),M.call(T.reference.button),A.call(T.reference.body)}return T.choose=function(){ye(this).classed("disabled")||(t.inIntro||r.setMostRecent(b),t.perform(function(A){for(var M in n){var k=n[M],F=r.match(A.entity(k),A);A=qa(k,F,b)(A)}return A},e.t("operations.change_tags.annotation")),t.systems.validator.validate(),s.call("choose",this,b))},T.help=function(A){A.stopPropagation(),T.reference.toggle()},T.preset=b,T.reference=iu(t,b.reference()),T}function v(){if(n.every(t.hasEntity)){var b=E(),T=t.container().selectAll(".preset-list .preset-list-button");T.call(Ft(t).destroyAny),T.each(function(A,M){let k;for(var F in b)if(k=i.isHiddenPreset(A.preset,b[F]),k)break;var O=!t.inIntro&&!!k&&(a.length!==1||A.preset!==a[0]);ye(this).classed("disabled",O),O&&ye(this).call(Ft(t).title(e.tHtml("inspector.hidden_preset.manual",{features:e.tHtml("feature."+k+".description")})).placement(M<2?"bottom":"top"))})}}c.autofocus=function(b){return arguments.length?(l=b,c):l},c.entityIDs=function(b){if(!arguments.length)return n;if(n=b,o=null,n&&n.length){o=kr(n,t.graph()).center();var T=n.map(function(A){return r.match(t.entity(A),t.graph())});c.presets(T)}return c},c.presets=function(b){return arguments.length?(a=b,c):a};function E(){var b={};for(var T in n){var A=n[T],M=t.entity(A),k=M.geometry(t.graph());k==="vertex"&&M.isOnAddressLine(t.graph())&&(k="point"),b[k]||(b[k]=0),b[k]+=1}return Object.keys(b).sort(function(F,O){return b[O]-b[F]})}return $t(c,s,"on")}function Z4(t){let e=t.services.osm,i;function r(s){let n;e&&i instanceof Dt&&!i.isNew()?n=e.entityURL(i):e&&i instanceof Nr&&!i.isNew()&&(n=e.noteURL(i));let o=s.selectAll(".view-on-osm").data(n?[n]:[],l=>l);o.exit().remove(),o.enter().append("a").attr("class","view-on-osm").attr("target","_blank").attr("href",l=>l).call(Ye("#rapid-icon-out-link","inline")).append("span").text(t.t("inspector.view_on_osm"))}return r.what=function(s){return arguments.length?(i=s,r):i},r}function Z_(t){var e=Y_(t),i=U_(t),r=ye(null),s=ye(null),n=ye(null),o="select",a,l=!1;function c(d){e.entityIDs(a).autofocus(l).on("choose",c.setPreset).on("cancel",function(){c.setPreset()}),i.state(o).entityIDs(a).on("choose",c.showList),r=d.selectAll(".panewrap").data([0]);var m=r.enter().append("div").attr("class","panewrap");m.append("div").attr("class","preset-list-pane pane"),m.append("div").attr("class","entity-editor-pane pane"),r=r.merge(m),s=r.selectAll(".preset-list-pane"),n=r.selectAll(".entity-editor-pane");function g(){if(o!=="select"||a.length!==1)return!1;var v=a[0],E=t.hasEntity(v);return!E||E.hasNonGeometryTags()?!1:l?!0:!(E.geometry(t.graph())!=="vertex"||t.graph().parentRelations(E).length||t.systems.validator.getEntityIssues(v).length||E.isHighwayIntersection(t.graph()))}g()?(r.style("right","-100%"),n.classed("hide",!0),s.classed("hide",!1).call(e)):(r.style("right","0%"),s.classed("hide",!0),n.classed("hide",!1).call(i));var _=d.selectAll(".footer").data([0]);_=_.enter().append("div").attr("class","footer").merge(_),_.call(Z4(t).what(t.hasEntity(a.length===1&&a[0])))}return c.showList=function(d){s.classed("hide",!1),r.transition().styleTween("right",function(){return $1("0%","-100%")}).on("end",function(){n.classed("hide",!0)}),d&&e.presets(d),s.call(e.autofocus(!0))},c.setPreset=function(d){d&&d.id==="type/multipolygon"?s.call(e.autofocus(!0)):(n.classed("hide",!1),r.transition().styleTween("right",function(){return $1("-100%","0%")}).on("end",function(){s.classed("hide",!0)}),d&&i.presets([d]),n.call(i))},c.state=function(d){return arguments.length?(o=d,i.state(o),t.container().selectAll(".field-help-body").remove(),c):o},c.entityIDs=function(d){return arguments.length?(a=d,c):a},c.newFeature=function(d){return arguments.length?(l=d,c):l},c}function Q_(t){let e=t.systems.validator,i=t.systems.storage,r={id:"warnings",count:0,iconID:"rapid-icon-alert",descriptionID:"issues.warnings_and_errors"},s={id:"resolved",count:0,iconID:"rapid-icon-apply",descriptionID:"issues.user_resolved_issues"};function n(o){var m,g;let a=[],l=e.getIssues({what:(m=i.getItem("validate-what"))!=null?m:"edited",where:(g=i.getItem("validate-where"))!=null?g:"all"});if(l.length&&(r.count=l.length,a.push(r)),i.getItem("validate-what")==="all"){let _=e.getResolvedIssues();_.length&&(s.count=_.length,a.push(s))}let c=o.selectAll(".chip").data(a,_=>_.id);c.exit().remove();let d=c.enter().append("a").attr("class",_=>`chip ${_.id}-count`).attr("href","#").each((_,v,E)=>{let b=ye(E[v]),T=Ft(t).placement("top").title(t.tHtml(_.descriptionID));b.call(T).on("click",A=>{A.preventDefault(),T.hide(),t.systems.ui.togglePanes(t.container().select(".map-panes .issues-pane"))}),b.call(Ye(`#${_.iconID}`))});d.append("span").attr("class","count"),d.merge(c).selectAll("span.count").text(_=>_.count.toString())}return function(a){n(a),e.on("validated",()=>n(a))}}function K_(t){let e=t.systems.filters,i=t.systems.l10n,r=t.systems.map,s=t.systems.presets,n;function o(l){let{itemType:c,parentIssueType:d}=l,m=i.tHtml("inspector.unknown"),g=l.replacements||{};g.default=m;let _=i.tHtml(`QA.keepRight.errorTypes.${c}.description`,g);return _===m&&(_=i.tHtml(`QA.keepRight.errorTypes.${d}.description`,g)),_}function a(l){let c=l.selectAll(".error-details").data(n?[n]:[],_=>`${_.id}-${_.status||0}`);c.exit().remove();let m=c.enter().append("div").attr("class","error-details qa-details-container").append("div").attr("class","qa-details-subsection");m.append("h4").html(i.tHtml("QA.keepRight.detail_description")),m.append("div").attr("class","qa-details-description-text").html(o);let g=[];m.selectAll(".error_entity_link, .error_object_link").attr("href","#").each((_,v,E)=>{let b=E[v],T=ye(b),A=T.classed("error_object_link"),M=A?n.objectType.charAt(0)+n.objectId:b.textContent,k=t.hasEntity(M);if(g.push(M),T.on("mouseenter",()=>{Ki([M],!0,t)}).on("mouseleave",()=>{Ki([M],!1,t)}).on("click",F=>{F.preventDefault(),Ki([M],!1,t),r.scene.enableLayers("osm"),r.centerZoomEase(n.loc,20),r.selectEntityID(M)}),k){let F=i.displayName(k.tags);if(!F&&!A){let O=s.match(k,t.graph());F=O&&!O.isFallback()&&O.name()}F&&(b.innerText=F)}}),e.forceVisible(g),r.immediateRedraw()}return a.issue=function(l){return arguments.length?(n=l,a):n},a}function J_(t){let e;function i(s){let n=t.tHtml("inspector.unknown"),o=s.replacements||{};o.default=n;let a=t.tHtml(`QA.keepRight.errorTypes.${s.itemType}.title`,o);return a===n&&(a=t.tHtml(`QA.keepRight.errorTypes.${s.parentIssueType}.title`,o)),a}function r(s){let n=16777215,o=t.services.keepRight;o&&(n=o.getColor(e==null?void 0:e.parentIssueType));let a=s.selectAll(".qa-header").data(e?[e]:[],c=>`${c.id}-${c.status||0}`);a.exit().remove();let l=a.enter().append("div").attr("class","qa-header");l.append("div").attr("class","qa-header-icon").append("div").attr("class",c=>`qaItem ${c.service}`).call(Ye("#rapid-icon-bolt")),l.append("div").attr("class","qa-header-label").html(i),l.selectAll(".qaItem svg.icon").attr("stroke","#333").attr("stroke-width","1.3px").attr("color",new mi(n).toHex())}return r.issue=function(s){return arguments.length?(e=s,r):e},r}function ex(t){let e=t.services.keepRight,i;function r(s){let n;e&&i instanceof Er&&(n=e.issueURL(i));let o=s.selectAll(".view-on-keepRight").data(n?[n]:[],l=>l);o.exit().remove(),o.enter().append("a").attr("class","view-on-keepRight").attr("target","_blank").attr("rel","noopener").attr("href",l=>l).call(Ye("#rapid-icon-out-link","inline")).append("span").text(t.t("inspector.view_on_keepRight"))}return r.what=function(s){return arguments.length?(i=s,r):i},r}function Q4(t){let e=t.services.keepRight,i=Pt("change"),r=K_(t),s=J_(t),n;function o(c){let d=c.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");d.append("button").attr("class","close").on("click",()=>t.enter("browse")).call(Ye("#rapid-icon-close")),d.append("h3").html(t.tHtml("QA.keepRight.title"));let m=c.selectAll(".body").data([0]);m=m.enter().append("div").attr("class","body").merge(m);let g=m.selectAll(".qa-editor").data([0]);g.enter().append("div").attr("class","modal-section qa-editor").merge(g).call(s.issue(n)).call(r.issue(n)).call(a);let _=c.selectAll(".footer").data([0]);_.enter().append("div").attr("class","footer").merge(_).call(ex(t).what(n))}function a(c){let d=n==null?void 0:n.id,m=d&&t.selectedData().has(d),g=n&&(m||n.newComment||n.comment),_=c.selectAll(".qa-save").data(g?[n]:[],b=>`${b.id}-${b.status||0}`);_.exit().remove();let v=_.enter().append("div").attr("class","qa-save save-section cf");v.append("h4").attr("class",".qa-save-header").html(t.tHtml("QA.keepRight.comment")),v.append("textarea").attr("class","new-comment-input").attr("placeholder",t.t("QA.keepRight.comment_placeholder")).attr("maxlength",1e3).property("value",b=>b.newComment||b.comment).call(Ri).on("input",E).on("blur",E),_=v.merge(_).call(l);function E(){let T=ye(this).property("value").trim();T===n.comment&&(T=void 0),n=n.update({newComment:T}),e&&e.replaceItem(n),_.call(l)}}function l(c){let d=n==null?void 0:n.id,m=d&&t.selectedData().has(d),g=c.selectAll(".buttons").data(m?[n]:[],v=>v.status+v.id);g.exit().remove();let _=g.enter().append("div").attr("class","buttons");_.append("button").attr("class","button comment-button action").html(t.tHtml("QA.keepRight.save_comment")),_.append("button").attr("class","button close-button action"),_.append("button").attr("class","button ignore-button action"),g=g.merge(_),g.select(".comment-button").attr("disabled",v=>v.newComment?null:!0).on("click.comment",function(v,E){this.blur(),e&&e.postUpdate(E,(b,T)=>i.call("change",T))}),g.select(".close-button").html(v=>{let E=v.newComment?"_comment":"";return t.tHtml(`QA.keepRight.close${E}`)}).on("click.close",function(v,E){this.blur(),e&&(E.newStatus="ignore_t",e.postUpdate(E,(b,T)=>i.call("change",T)))}),g.select(".ignore-button").html(v=>{let E=v.newComment?"_comment":"";return t.tHtml(`QA.keepRight.ignore${E}`)}).on("click.ignore",function(v,E){this.blur(),e&&(E.newStatus="ignore",e.postUpdate(E,(b,T)=>i.call("change",T)))})}return o.error=function(c){return arguments.length?(n=c,o):n},$t(o,i,"on")}function c0(t){function e(i){let r=ye(null),s=!0;function n(){s||(o(),a())}function o(){let _=t.systems.map.extent(),v=_.center();_.padByMeters(100),t.systems.map3d.maplibre.jumpTo({center:v,bearing:0,zoom:t.systems.map.zoom()-3})}function a(){let _=t.systems.map,v=t.systems.edits.intersects(_.extent()),E=v.filter(A=>Object.keys(A.tags).filter(k=>k.startsWith("building")).length>0),b=v.filter(A=>Object.keys(A.tags).filter(k=>k.startsWith("highway")).length>0),T=v.filter(A=>Object.keys(A.tags).filter(k=>k.startsWith("landuse")||k.startsWith("leisure")||k.startsWith("natural")||k.startsWith("area")).length>0);d(b),l(E),c(T)}function l(_){let v=[],E=t.selectedIDs();for(let A of _){let M=A.asGeoJSON(t.graph());if(M.type!=="Polygon"&&M.type!=="MultiPolygon")continue;let k={type:"Feature",properties:{extrude:!0,selected:E.includes(A.id).toString(),min_height:A.tags.min_height?parseFloat(A.tags.min_height):0,height:parseFloat(A.tags.height||A.tags["building:levels"]*3||0)},geometry:M};v.push(k)}let b=t.systems.map3d.maplibre,T=b==null?void 0:b.getSource("osmbuildings");T&&T.setData({type:"FeatureCollection",features:v})}function c(_){let v=[],E=t.selectedIDs();for(let A of _){let M=A.asGeoJSON(t.graph());if(M.type!=="Polygon"&&M.type!=="MultiPolygon")continue;let k=Sh(A.tags),F=new mi(k.fill.color).toHex(),O=new mi(k.stroke.color).toHex(),B={type:"Feature",properties:{selected:E.includes(A.id).toString(),fillcolor:F,strokecolor:O},geometry:M};v.push(B)}let b=t.systems.map3d.maplibre,T=b==null?void 0:b.getSource("osmareas");T&&T.setData({type:"FeatureCollection",features:v})}function d(_){let v=[],E=t.selectedIDs();for(let A of _){let M=A.asGeoJSON(t.graph());if(M.type!=="LineString")continue;let k=Sh(A.tags),F=new mi(k.casing.color).toHex(),O=new mi(k.stroke.color).toHex(),B={type:"Feature",properties:{selected:E.includes(A.id).toString(),highway:A.tags.highway,casingColor:F,strokeColor:O},geometry:M};v.push(B)}let b=t.systems.map3d.maplibre,T=b==null?void 0:b.getSource("osmroads");T&&T.setData({type:"FeatureCollection",features:v})}function m(_){_&&_.preventDefault(),s=!s,t.container().select(".three-d-map-toggle-item").classed("active",!s).select("input").property("checked",!s),s?r.style("display","block").style("opacity","1").transition().duration(200).style("opacity","0").on("end",()=>i.selectAll(".three-d-map").style("display","none")):r.style("display","block").style("opacity","0").transition().duration(200).style("opacity","1").on("end",()=>n())}c0.toggle=m,r=i.selectAll(".three-d-map").data([0]),r=r.enter().append("div").attr("class","three-d-map").attr("id","3d-buildings").style("display",s?"none":"block").merge(r),t.systems.map3d.startAsync(),t.systems.map.on("draw",()=>n()),t.systems.map.on("move",()=>n()),t.keybinding().on([Li("\u2318"+t.t("background.3dmap.key"))],m),n()}return e}function u0(t){function e(i){let r=new Ho,s=Ff().scaleExtent([Fn(.5),Fn(24)]).on("start",M).on("zoom",k).on("end",F),n=ye(null),o=ye(null),a=!0,l=!1,c=!1,d=null,m=6,g,_,v,E,b=null,T=null;function A(){a||(O(),B())}function M(){c||(v=E=r.transform(),d=null)}function k(q){if(c)return;let Q=q.transform.x,V=q.transform.y,le=q.transform.k,de=le!==v.k,ne=Q!==v.x||V!==v.y;if(!de&&!ne)return;d||(d=de?"zoom":"pan");let ee=r.transform(),re,te,ie;d==="zoom"?(ie=le/ee.k,re=(_[0]/ie-_[0])*ie,te=(_[1]/ie-_[1])*ie):(le=ee.k,ie=1,re=Q-ee.x,te=V-ee.y),d==="pan"?(b.stage.x+=re,b.stage.y+=te):Sl(o,0,0,ie),l=!0,E=yl.translate(Q,V).scale(le);let oe=Ga(t.projection.scale()),fe=Ga(le);m=oe-fe,A()}function F(){c||d==="pan"&&(O(),d=null,t.systems.map.center(r.invert(_)))}function O(){let q=t.systems.map.center(),Q=t.projection.transform(),V=Ga(Q.k),le=Math.max(V-m,.5),de=Fn(le);r.translate([Q.x,Q.y]).scale(de);let ne=r.project(q),ee=d==="pan"?sr([E.x,E.y],[v.x,v.y]):[0,0],re=_[0]-ne[0]+Q.x+ee[0],te=_[1]-ne[1]+Q.y+ee[1];r.translate([re,te]).dimensions([[0,0],g]),E=r.transform(),l&&(b.stage.x=0,b.stage.y=0,Sl(o,0,0),l=!1),s.scaleExtent([Fn(.5),Fn(V-3)]),c=!0,n.call(s.transform,E),c=!1}function B(){let q=t.systems.map.extent().bbox(),Q=r.project([q.minX,q.maxY]),V=r.project([q.maxX,q.minY]),le=Math.abs(V[0]-Q[0]),de=Math.abs(V[1]-Q[1]),ne=b.stage,ee=ne.getChildByName("bbox");ee||(ee=new Hi,ee.name="bbox",ee.eventMode="none",ne.addChild(ee)),ee.clear().lineStyle(2,16776960).drawRect(Q[0],Q[1],le,de)}function U(q){q&&q.preventDefault(),a=!a,t.container().select(".minimap-toggle-item").classed("active",!a).select("input").property("checked",!a),a?n.style("display","block").style("opacity","1").transition().duration(200).style("opacity","0").on("end",()=>{i.selectAll(".map-in-map").style("display","none"),z()}):(A(),n.style("display","block").style("opacity","0").transition().duration(200).style("opacity","1"))}function z(){let q=b.stage,Q=q.getChildByName("bbox");Q&&q.removeChild(Q),T&&T.destroyAll()}function Z(){if(a)return;window.performance.mark("minimap-start");let q=0;T.render(q,r),b.render(),window.performance.mark("minimap-end"),window.performance.measure("minimap","minimap-start","minimap-end")}u0.toggle=U,n=i.selectAll(".map-in-map").data([0]);let W=n.enter().append("div").attr("class","map-in-map").style("display",a?"none":"block").call(s).on("dblclick.zoom",null);if(!b){b=new Ed({antialias:!0,autoDensity:!0,autoStart:!1,events:{move:!1,globalMove:!1,click:!0,wheel:!1},resolution:window.devicePixelRatio,sharedLoader:!0,sharedTicker:!1});let[q,Q]=[200,150];b.renderer.resize(q,Q);let V=b.ticker;V.maxFPS=10;let le=V._head.next;V.remove(le.fn,le.context),V.add(Z,this),V.start();let de=b.stage;de.name="minimap-stage",de.eventMode="none",de.sortableChildren=!1;let ne=t.systems.map.renderer,ee={context:t,pixi:b,stage:de,textures:ne.textures},re={context:t,renderer:ee,groups:new Map,layers:new Map,features:new Map},te=new Qi;te.name="background",de.addChild(te),re.groups.set("background",te),T=new N4(re,"minimap-background",!0),re.layers.set(T.id,T),g=[q,Q],_=$o(g,.5),t.systems.map.on("draw",()=>A())}W.each((q,Q,V)=>{V[Q].appendChild(b.view)}),n=W.merge(n),o=ye(b.view),A(),t.keybinding().on(t.t("background.minimap.key"),U)}return e}function tx(t){let e;function i(n){if(e.isNew())return;let o=n.selectAll(".comments-container").data([0]);o=o.enter().append("div").attr("class","comments-container").merge(o);let a=o.selectAll(".comment").data(e.comments).enter().append("div").attr("class","comment");a.append("div").attr("class",d=>`comment-avatar user-${d.uid}`).call(Ye("#rapid-icon-avatar","comment-avatar-icon"));let l=a.append("div").attr("class","comment-main"),c=l.append("div").attr("class","comment-metadata");c.append("div").attr("class","comment-author").each((d,m,g)=>{let _=ye(g[m]),v=t.services.osm;v&&d.user&&(_=_.append("a").attr("class","comment-author-link").attr("href",v.userURL(d.user)).attr("target","_blank")),_.html(E=>E.user||t.tHtml("note.anonymous"))}),c.append("div").attr("class","comment-date").html(d=>t.t(`note.status.${d.action}`,{when:s(d.date)})),l.append("div").attr("class","comment-text").html(d=>d.html).selectAll("a").attr("rel","noopener nofollow").attr("target","_blank"),o.call(r)}function r(n){var d;let a=(d=t.systems.storage.getItem("preferences.privacy.thirdpartyicons"))!=null?d:"true",l=t.services.osm;if(a!=="true"||!l)return;let c=new Set;for(let m of e.comments)m.uid&&c.add(m.uid);for(let m of c)l.loadUser(m,(g,_)=>{!_||!_.image_url||n.selectAll(`.comment-avatar.user-${m}`).html("").append("img").attr("class","icon comment-avatar-icon").attr("src",_.image_url).attr("alt",_.display_name)})}function s(n){if(!n)return null;let o={day:"numeric",month:"short",year:"numeric"};n=n.replace(/-/g,"/");let a=new Date(n);if(isNaN(a.getTime()))return null;let l=t.systems.l10n.localeCode();return a.toLocaleDateString(l,o)}return i.note=function(n){return arguments.length?(e=n,i):e},i}function ix(t){let e;function i(r){let s=r.selectAll(".note-header").data(e?[e]:[],a=>a.status+a.id);s.exit().remove();let n=s.enter().append("div").attr("class","note-header"),o=n.append("div").attr("class",a=>`note-header-icon ${a.status}`).classed("new",a=>a.id<0);o.append("div").attr("class","preset-icon-28").call(Ye("#rapid-icon-note","note-fill")),o.each(a=>{let l;a.id<0?l="#rapid-icon-plus":a.status==="open"?l="#rapid-icon-close":l="#rapid-icon-apply",o.append("div").attr("class","note-icon-annotation").call(Ye(l,"icon-annotation"))}),n.append("div").attr("class","note-header-label").text(a=>e.isNew()?t.t("note.new"):t.t("note.note")+" "+a.id+" "+(a.status==="closed"?t.t("note.closed"):""))}return i.note=function(r){return arguments.length?(e=r,i):e},i}function rx(t){let e;function i(r){let s,n=t.services.osm;n&&e instanceof Nr&&!e.isNew()&&(s=n.noteReportURL(e));let o=r.selectAll(".note-report").data(s?[s]:[]);o.exit().remove(),o.enter().append("a").attr("class","note-report").attr("target","_blank").attr("href",l=>l).call(Ye("#rapid-icon-out-link","inline")).append("span").text(t.t("note.report"))}return i.note=function(r){return arguments.length?(e=r,i):e},i}function K4(t){var e=Pt("change"),i=tx(t),r=ix(t),s,n;function o(v){var E=v.selectAll(".header").data([0]),b=E.enter().append("div").attr("class","header fillL");b.append("button").attr("class","close").on("click",function(){t.enter("browse")}).call(Ye("#rapid-icon-close")),b.append("h3").html(t.tHtml("note.title"));var T=v.selectAll(".body").data([0]);T=T.enter().append("div").attr("class","body").merge(T);var A=T.selectAll(".note-editor").data([0]);A.enter().append("div").attr("class","modal-section note-editor").merge(A).call(r.note(s)).call(i.note(s)).call(a);var M=v.selectAll(".footer").data([0]);M.enter().append("div").attr("class","footer").merge(M).call(Z4(t).what(s)).call(rx(t).note(s));var k=t.services.osm;k&&k.on("authchange",function(){v.call(o)})}function a(v){var E=s&&s.id===t.selectedIDs()[0],b=v.selectAll(".note-save").data(E?[s]:[],function(F){return F.status+F.id});b.exit().remove();var T=b.enter().append("div").attr("class","note-save save-section cf");T.append("h4").attr("class",".note-save-header").html(function(){return s.isNew()?t.t("note.newDescription"):t.t("note.newComment")});var A=T.append("textarea").attr("class","new-comment-input").attr("placeholder",t.t("note.inputPlaceholder")).attr("maxlength",1e3).property("value",function(F){return F.newComment}).call(Ri).on("keydown.note-input",M).on("input.note-input",k).on("blur.note-input",k);!A.empty()&&n&&A.node().focus(),b=T.merge(b).call(l).call(c);function M(F){if(F.keyCode===13&&F.metaKey){var O=t.services.osm;if(O){var B=O.authenticated();B&&s.newComment&&(F.preventDefault(),ye(this).on("keydown.note-input",null),window.setTimeout(function(){s.isNew()?(b.selectAll(".save-button").node().focus(),m(s)):(b.selectAll(".comment-button").node().focus(),_(s))},10))}}}function k(){var F=ye(this),O=F.property("value").trim()||void 0;s=s.update({newComment:O});var B=t.services.osm;B&&B.replaceNote(s),b.call(c)}}function l(v){var E=v.selectAll(".detail-section").data([0]);E=E.enter().append("div").attr("class","detail-section").merge(E);var b=t.services.osm;if(b){var T=b.authenticated(),A=E.selectAll(".auth-warning").data(T?[]:[0]);A.exit().transition().duration(200).style("opacity",0).remove();var M=A.enter().insert("div",".tag-reference-body").attr("class","field-warning auth-warning").style("opacity",0);M.call(Ye("#rapid-icon-alert","inline")),M.append("span").html(t.tHtml("note.login")),M.append("a").attr("target","_blank").call(Ye("#rapid-icon-out-link","inline")).append("span").html(t.tHtml("login")).on("click.note-login",function(F){F.preventDefault(),b.authenticate()}),M.transition().duration(200).style("opacity",1);var k=E.selectAll(".note-save-prose").data(T?[0]:[]);k.exit().remove(),k=k.enter().append("p").attr("class","note-save-prose").html(t.tHtml("note.upload_explanation")).merge(k),b.userDetails(function(F,O){if(!F){var B=ye(document.createElement("div"));O.image_url&&B.append("img").attr("src",O.image_url).attr("class","icon pre-text user-icon"),B.append("a").attr("class","user-info").html(O.display_name).attr("href",b.userURL(O.display_name)).attr("target","_blank"),k.html(t.tHtml("note.upload_explanation_with_user",{user:B.html()}))}})}}function c(v){var E=t.services.osm,b=E&&E.authenticated(),T=s&&s.id===t.selectedIDs()[0],A=v.selectAll(".buttons").data(T?[s]:[],function(F){return F.status+F.id});A.exit().remove();var M=A.enter().append("div").attr("class","buttons");s.isNew()?(M.append("button").attr("class","button cancel-button secondary-action").html(t.tHtml("confirm.cancel")),M.append("button").attr("class","button save-button action").html(t.tHtml("note.save"))):(M.append("button").attr("class","button status-button action"),M.append("button").attr("class","button comment-button action").html(t.tHtml("note.comment"))),A=A.merge(M),A.select(".cancel-button").on("click.cancel",d),A.select(".save-button").attr("disabled",k).on("click.save",m),A.select(".status-button").attr("disabled",b?null:!0).html(function(F){var O=F.status==="open"?"close":"open",B=F.newComment?"_comment":"";return t.t("note."+O+B)}).on("click.status",g),A.select(".comment-button").attr("disabled",k).on("click.comment",_);function k(F){return b&&F.status==="open"&&F.newComment?null:!0}}function d(v,E){this.blur();var b=t.services.osm;b&&b.removeNote(E),t.enter("browse"),e.call("change")}function m(v,E){this.blur();var b=t.services.osm;b&&b.postNoteCreate(E,function(T,A){e.call("change",A)})}function g(v,E){this.blur();var b=t.services.osm;if(b){var T=E.status==="open"?"closed":"open";b.postNoteUpdate(E,T,function(A,M){e.call("change",M)})}}function _(v,E){this.blur();var b=t.services.osm;b&&b.postNoteUpdate(E,E.status,function(T,A){e.call("change",A)})}return o.note=function(v){return arguments.length?(s=v,o):s},o.newNote=function(v){return arguments.length?(n=v,o):n},$t(o,e,"on")}function sx(t){let e=t.systems.filters,i=t.systems.l10n,r=t.systems.map,s=t.services.osmose,n=t.systems.presets,o;function a(c,d){if(!s||!c)return"";let m=s.getStrings(c.itemType);return d in m?m[d]:""}function l(c){let d=c.selectAll(".error-details").data(o?[o]:[],v=>`${v.id}-${v.status||0}`);d.exit().remove();let m=d.enter().append("div").attr("class","error-details qa-details-container");if(a(o,"detail")){let v=m.append("div").attr("class","qa-details-subsection");v.append("h4").html(i.tHtml("QA.keepRight.detail_description")),v.append("p").attr("class","qa-details-description-text").html(E=>a(E,"detail")).selectAll("a").attr("rel","noopener").attr("target","_blank")}let g=m.append("div").attr("class","qa-details-subsection"),_=m.append("div").attr("class","qa-details-subsection");if(a(o,"fix")){let v=m.append("div").attr("class","qa-details-subsection");v.append("h4").html(i.tHtml("QA.osmose.fix_title")),v.append("p").html(E=>a(E,"fix")).selectAll("a").attr("rel","noopener").attr("target","_blank")}if(a(o,"trap")){let v=m.append("div").attr("class","qa-details-subsection");v.append("h4").html(i.tHtml("QA.osmose.trap_title")),v.append("p").html(E=>a(E,"trap")).selectAll("a").attr("rel","noopener").attr("target","_blank")}s&&s.loadIssueDetailAsync(o).then(v=>{o.id===v.id&&(!v.elems||v.elems.length===0||(v.detail&&(g.append("h4").html(i.tHtml("QA.osmose.detail_title")),g.append("p").html(E=>E.detail).selectAll("a").attr("rel","noopener").attr("target","_blank")),_.append("h4").html(i.tHtml("QA.osmose.elems_title")),_.append("ul").selectAll("li").data(v.elems).enter().append("li").append("a").attr("href","#").attr("class","error_entity_link").html(E=>E).each((E,b,T)=>{let A=T[b],M=ye(A),k=A.textContent,F=t.hasEntity(k);if(M.on("mouseenter",()=>{Ki([k],!0,t)}).on("mouseleave",()=>{Ki([k],!1,t)}).on("click",O=>{O.preventDefault(),Ki([k],!1,t),r.scene.enableLayers("osm"),r.centerZoom(E.loc,20),r.selectEntityID(k)}),F){let O=i.displayName(F.tags);if(!O){let B=n.match(F,t.graph());O=B&&!B.isFallback()&&B.name()}O&&(A.innerText=O)}}),e.forceVisible(v.elems),r.immediateRedraw()))}).catch(v=>console.error(v))}return l.issue=function(c){return arguments.length?(o=c,l):o},l}function nx(t){let e=t.services.osmose,i;function r(n){let o=t.t("inspector.unknown");if(!e||!n)return o;let a=e.getStrings(n.itemType);return"title"in a?a.title:o}function s(n){let o=16777215;e&&(o=e.getColor(i==null?void 0:i.item));let a=n.selectAll(".qa-header").data(i?[i]:[],d=>`${d.id}-${d.status||0}`);a.exit().remove();let l=a.enter().append("div").attr("class","qa-header"),c=l.append("div").attr("class","qa-header-icon").append("svg").attr("width","20px").attr("height","27px").attr("viewbox","0 0 20 27").attr("class",d=>`qaItem ${d.service}`);c.append("polygon").attr("fill",new mi(o).toHex()).attr("stroke","#333").attr("points","16,3 4,3 1,6 1,17 4,20 7,20 10,27 13,20 16,20 19,17.033 19,6"),c.append("use").attr("class","icon-annotation").attr("width","13px").attr("height","13px").attr("transform","translate(3.5, 5)").attr("xlink:href",d=>d.icon?`#${d.icon}`:""),l.append("div").attr("class","qa-header-label").html(r)}return s.issue=function(n){return arguments.length?(i=n,s):i},s}function ox(t){let e=t.services.osmose,i;function r(s){let n;e&&i instanceof Er&&(n=e.itemURL(i));let o=s.selectAll(".view-on-osmose").data(n?[n]:[],l=>l);o.exit().remove(),o.enter().append("a").attr("class","view-on-osmose").attr("target","_blank").attr("rel","noopener").attr("href",l=>l).call(Ye("#rapid-icon-out-link","inline")).append("span").text(t.t("inspector.view_on_osmose"))}return r.what=function(s){return arguments.length?(i=s,r):i},r}function J4(t){let e=t.services.osmose,i=Pt("change"),r=sx(t),s=nx(t),n;function o(c){let m=c.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");m.append("button").attr("class","close").on("click",()=>t.enter("browse")).call(Ye("#rapid-icon-close")),m.append("h3").html(t.tHtml("QA.osmose.title"));let g=c.selectAll(".body").data([0]);g=g.enter().append("div").attr("class","body").merge(g);let _=g.selectAll(".qa-editor").data([0]);_.enter().append("div").attr("class","modal-section qa-editor").merge(_).call(s.issue(n)).call(r.issue(n)).call(a);let v=c.selectAll(".footer").data([0]);v.enter().append("div").attr("class","footer").merge(v).call(ox(t).what(n))}function a(c){let d=n==null?void 0:n.id,m=d&&t.selectedData().has(d),g=n&&m,_=c.selectAll(".qa-save").data(g?[n]:[],E=>`${E.id}-${E.status||0}`);_.exit().remove(),_=_.enter().append("div").attr("class","qa-save save-section cf").merge(_).call(l)}function l(c){let d=n==null?void 0:n.id,m=d&&t.selectedData().has(d),g=c.selectAll(".buttons").data(m?[n]:[],v=>v.status+v.id);g.exit().remove();let _=g.enter().append("div").attr("class","buttons");_.append("button").attr("class","button close-button action"),_.append("button").attr("class","button ignore-button action"),g=g.merge(_),g.select(".close-button").html(t.tHtml("QA.keepRight.close")).on("click.close",function(v,E){this.blur(),e&&(E.newStatus="done",e.postUpdate(E,(b,T)=>i.call("change",T)))}),g.select(".ignore-button").html(t.tHtml("QA.keepRight.ignore")).on("click.ignore",function(v,E){this.blur(),e&&(E.newStatus="false",e.postUpdate(E,(b,T)=>i.call("change",T)))})}return o.error=function(c){return arguments.length?(n=c,o):n},$t(o,i,"on")}function Fl(t,e){let i,r="",s="",n="",o,a=ye(null),l,c={id:e};c.label=function(m){return arguments.length?(r=m,c):r},c.key=function(m){return arguments.length?(i=m,c):i},c.description=function(m){return arguments.length?(s=m,c):s},c.iconName=function(m){return arguments.length?(n=m,c):n},c.sections=function(m){return arguments.length?(o=m,c):o},c.selection=function(){return a};function d(){t.systems.ui.togglePanes()}return c.togglePane=function(m){m&&m.preventDefault(),l.hide();let g=!a.classed("shown");t.systems.ui.togglePanes(g?a:void 0),c.id==="issues"&&g&&t.systems.validator.validate()},c.renderToggleButton=function(m){if(!l){let g=t.systems.l10n.isRTL();l=Ft(t).placement(g?"right":"left").title(s).keys([i])}m.append("button").on("click",c.togglePane).call(Ye(`#${n}`,"light")).call(l)},c.renderContent=function(m){if(o)for(let g of o)m.call(g.render)},c.renderPane=function(m){a=m.append("div").attr("class",`fillL map-pane hide ${e}-pane`).attr("pane",e);let g=a.append("div").attr("class","pane-heading");g.append("h2").html(r),g.append("button").on("click",d).call(Ye("#rapid-icon-close")),a.append("div").attr("class","pane-content").call(c.renderContent),i&&t.keybinding().on(i,c.togglePane)},c}function ax(t){let e=Pt("resize");function i(r){r.append("button").attr("class","thumb-hide").on("click",()=>{for(let o of["mapillary","kartaview","streetside"]){let a=t.services[o];a==null||a.hideViewer()}}).append("div").call(Ye("#rapid-icon-close"));function s(o){o.preventDefault()}r.append("button").attr("class","resize-handle-xy").on("touchstart touchdown touchend",s).on("pointerdown",n(r,"resize",{resizeOnX:!0,resizeOnY:!0})),r.append("button").attr("class","resize-handle-x").on("touchstart touchdown touchend",s).on("pointerdown",n(r,"resize",{resizeOnX:!0})),r.append("button").attr("class","resize-handle-y").on("touchstart touchdown touchend",s).on("pointerdown",n(r,"resize",{resizeOnY:!0}));function n(o,a,l){let c=!!l.resizeOnX,d=!!l.resizeOnY,m=l.minHeight||240,g=l.minWidth||320,_,v,E,b,T;function A(F){if(_!==(F.pointerId||"mouse"))return;F.preventDefault(),F.stopPropagation();let O=t.systems.map.dimensions;if(c){let B=O[0],U=M(b+F.clientX-v,g,B);o.style("width",U+"px")}if(d){let B=O[1]-90,U=M(T+E-F.clientY,m,B);o.style("height",U+"px")}e.call(a,o,pc(o,!0))}function M(F,O,B){return Math.max(O,Math.min(F,B))}function k(F){_===(F.pointerId||"mouse")&&(F.preventDefault(),F.stopPropagation(),ye(window).on("."+a,null))}return function(O){O.preventDefault(),O.stopPropagation(),_=O.pointerId||"mouse",v=O.clientX,E=O.clientY;let B=o.node().getBoundingClientRect();b=B.width,T=B.height,ye(window).on("pointermove."+a,A,!1).on("pointerup."+a,k,!1).on("pointercancel."+a,k,!1)}}}return i.onMapResize=function(){let r=t.container().select(".photoviewer"),s=t.container().select(".main-content"),n=pc(s,!0),o=pc(r,!0);if(o[0]>n[0]||o[1]>n[1]-90){let a=[Math.min(o[0],n[0]),Math.min(o[1],n[1]-90)];r.style("width",a[0]+"px").style("height",a[1]+"px"),e.call("resize",r,a)}},$t(i,e,"on")}function lx(t,e){let i=Pt("change","done"),r=()=>{};function s(c){let d=t.container().selectAll(".shaded");d.empty()||(d.selectAll(".colorpicker-popup").size()?r():l(d,c.currentTarget))}function n(c){let d=c.target,m=d&&d.className||"";/colorpicker/i.test(m)||(c.stopPropagation(),c.preventDefault(),r())}function o(c){let d=c.length<6,m=parseInt(d?c[1]+c[1]:c[1]+c[2],16),g=parseInt(d?c[2]+c[2]:c[3]+c[4],16),_=parseInt(d?c[3]+c[3]:c[5]+c[6],16);return(m*299+g*587+_*114)/1e3}function a(c){let d=c.selectAll(".rapid-colorpicker").data(g=>[g],g=>g.id),m=d.enter().append("div").attr("class","rapid-colorpicker").on("click",s);m.append("div").attr("class","rapid-colorpicker-fill").call(Ye("#fas-palette")),d.merge(m).selectAll(".rapid-colorpicker-fill").style("background",g=>g.color).select(".icon").style("color",g=>o(g.color)>140.5?"#333":"#fff")}function l(c,d){let m=t.systems.l10n.isRTL(),g=d.__data__,_=d.getBoundingClientRect(),v=180,E=_.bottom+15,b=m?_.right-.3333*v:_.left-.6666*v,T=m?.3333*v-_.width+10:.6666*v+10,A=e.close;e.close=()=>{},r=()=>{k.transition().duration(200).style("opacity",0).remove(),e.close=A;let z=$i("modal");z.on(["\u232B","\u238B"],A),ye(document).call(z),ye(document).on("click.colorpicker",null),r=()=>{},i.call("done")};let M=$i("modal");M.on(["\u232B","\u238B"],r),ye(document).call(M),ye(document).on("click.colorpicker",n);let k=c.append("div").attr("class","colorpicker-popup").style("opacity",0).style("width",v+"px").style("top",E+"px").style("left",b+"px");k.append("div").attr("class","colorpicker-arrow").style("left",T+"px");let O=k.append("div").attr("class","colorpicker-content").selectAll(".colorpicker-colors").data([0]);O=O.enter().append("div").attr("class","colorpicker-colors").merge(O);let B=O.selectAll(".colorpicker-option").data(t.systems.rapid.colors),U=B.enter().append("div").attr("class","colorpicker-option").style("color",z=>z).on("click",(z,Z)=>{i.call("change",this,g.id,Z),B.classed("selected",W=>W===Z)});U.append("div").attr("class","colorpicker-option-fill"),B=B.merge(U),B.classed("selected",z=>z===g.color),k.transition().style("opacity",1)}return $t(a,i,"on")}function cx(t){return function(i){let r=t.systems.storage;if(r.getItem("sawRapidSplash"))return;r.setItem("sawRapidSplash",!0);let s=Ts(i);s.select(".modal").attr("class","modal rapid-modal modal-splash");let n=s.select(".content");n.append("div").attr("class","modal-section").append("h3").text(t.t("rapid_splash.welcome")),n.append("div").attr("class","modal-section").append("p").html(t.t("rapid_splash.text",{rapidicon:gi("#rapid-logo-rapid-wordmark","logo-rapid"),walkthrough:gi("#rapid-logo-walkthrough","logo-walkthrough"),edit:gi("#rapid-logo-features","logo-features")}));let o=n.append("div").attr("class","modal-actions"),a=o.append("button").attr("class","walkthrough").on("click",()=>{t.container().call(mc(t,!1)),s.close()});a.append("svg").attr("class","logo logo-features").append("use").attr("xlink:href","#rapid-logo-walkthrough"),a.append("div").text(t.t("rapid_splash.walkthrough"));let l=o.append("button").attr("class","rapid-walkthrough").on("click",()=>{t.container().call(mc(t,!0)),s.close()});l.append("svg").attr("class","logo logo-rapid").append("use").attr("xlink:href","#rapid-logo-rapid-wordmark"),l.append("div").text(t.t("rapid_splash.skip_to_rapid"));let c=o.append("button").attr("class","start-editing").on("click",()=>{s.close()});c.append("svg").attr("class","logo logo-features").append("use").attr("xlink:href","#rapid-logo-features"),c.append("div").text(t.t("rapid_splash.start")),s.select("button.close").attr("class","hide")}}function ux(t){return function(e){let i=Ts(e);i.select(".modal").attr("class","modal rapid-modal");let r=i.select(".content");r.append("div").attr("class","modal-section").append("h3").html(t.t("rapid_first_edit.nice",{rapidicon:gi("#rapid-logo-rapid-wordmark","logo-rapid")})),r.append("div").attr("class","modal-section").append("p").text(t.t("rapid_first_edit.text"));let s=r.append("div").attr("class","modal-actions");s.append("button").attr("class","rapid-explore").on("click",()=>{i.close()}).append("div").text(t.t("rapid_first_edit.exploring")),s.append("button").attr("class","rapid-login-to-osm").on("click",()=>{i.close();let a=t.services.osm;a&&a.authenticate(()=>t.container().call(cx(t)))}).append("div").text(t.t("rapid_first_edit.login_with_osm")),i.select("button.close").attr("class","hide")}}var BS=50;function ep(t,e){let i=t.systems.rapid,r=t.systems.urlhash,s;function n(){return r.initialHashParams.has("gpx")||r.getParam("poweruser")==="true"?!1:t.systems.edits.peekAllAnnotations().filter(T=>T.type==="rapid_accept_feature").length>=BS}function o(){if(!s)return;if(n()){q4(t).duration(5e3).label(t.t("rapid_feature_inspector.option_accept.disabled_flash",{n:BS}))();return}let _={type:"rapid_accept_feature",description:t.t("rapid_feature_inspector.option_accept.annotation"),id:s.id,origid:s.__origid__},E=t.services[s.__service__].graph(s.__datasetid__),b=s.tags&&s.tags.source;if(b&&(_.source=b),t.perform(Zg(s.id,E),_),t.enter("select-osm",{selectedIDs:[s.id]}),t.inIntro||(i.sources.add("mapwithai"),b&&/^esri/.test(b)&&i.sources.add("esri"),window.sessionStorage.getItem("acknowledgedLogin")==="true"))return;window.sessionStorage.setItem("acknowledgedLogin","true"),t.services.osm.authenticated()||t.container().call(ux(t))}function a(){if(!s)return;let _={type:"rapid_ignore_feature",description:t.t("rapid_feature_inspector.option_ignore.annotation"),id:s.id,origid:s.__origid__};t.perform(us(),_),t.enter("browse")}function l(_){let v=_.length<6,E=parseInt(v?_[1]+_[1]:_[1]+_[2],16),b=parseInt(v?_[2]+_[2]:_[3]+_[4],16),T=parseInt(v?_[3]+_[3]:_[5]+_[6],16);return(E*299+b*587+T*114)/1e3}function c(_){if(!s)return;let v=s.__datasetid__.replace("-conflated",""),E=i.datasets.get(v),b=E.color,T=_.selectAll(".feature-info").data([b]),A=T.enter().append("div").attr("class","feature-info");A.append("div").attr("class","dataset-label").text(E.label||E.id),E.beta&&A.append("div").attr("class","dataset-beta beta").attr("title",t.t("rapid_poweruser_features.beta")),T=T.merge(A).style("background",M=>M).style("color",M=>l(M)>140.5?"#333":"#fff")}function d(_){let v=s&&s.tags;if(!v)return;let b=_.selectAll(".tag-info").data([0]).enter().append("div").attr("class","tag-info").append("div").attr("class","tag-bag");b.append("div").attr("class","tag-heading").text(t.t("rapid_feature_inspector.tags")),Object.keys(v).map(A=>({key:A,value:v[A]})).forEach(A=>{let M=b.append("div").attr("class","tag-entry");M.append("div").attr("class","tag-key").text(A.key),M.append("div").attr("class","tag-value").text(A.value)})}function m(_){let v=_.selectAll(".rapid-inspector").data([0]),E=v.enter().append("div").attr("class","rapid-inspector");v=v.merge(E);let b=v.selectAll(".header").data([0]).enter().append("div").attr("class","header");b.append("h3").append("svg").attr("class","logo-rapid").append("use").attr("xlink:href","#rapid-logo-rapid-wordmark"),b.append("button").attr("class","fr rapid-inspector-close").on("click",()=>{t.enter("browse")}).call(Ye("#rapid-icon-close"));let T=v.selectAll(".body").data([0]),A=T.enter().append("div").attr("class","body");T=T.merge(A).call(c).call(d);let M=[{key:"accept",iconName:"#rapid-icon-rapid-plus-circle",label:t.t("rapid_feature_inspector.option_accept.label"),description:t.t("rapid_feature_inspector.option_accept.description"),onClick:o},{key:"ignore",iconName:"#rapid-icon-rapid-minus-circle",label:t.t("rapid_feature_inspector.option_ignore.label"),description:t.t("rapid_feature_inspector.option_ignore.description"),onClick:a}],F=T.selectAll(".rapid-inspector-choices").data([0]).enter().append("div").attr("class","rapid-inspector-choices");F.append("p").text(t.t("rapid_feature_inspector.prompt")),F.selectAll(".rapid-inspector-choice").data(M,O=>O.key).enter().append("div").attr("class",O=>`rapid-inspector-choice rapid-inspector-choice-${O.key}`).each(g)}function g(_,v,E){let b=ye(E[v]),T=_.key==="accept"&&n()?"secondary disabled":"",A=b.append("div").attr("class",`choice-wrap choice-wrap-${_.key}`),M=b.append("div").attr("class","tag-reference-body");M.text(_.description);let k=_.onClick,F=A.append("button").attr("class",`choice-button choice-button-${_.key} ${T}`).on("click",k),O,B;_.key==="accept"?n()?(O=t.t("rapid_feature_inspector.option_accept.disabled",{n:BS}),B=[]):(O=t.t("rapid_feature_inspector.option_accept.tooltip"),B=[t.t("rapid_feature_inspector.option_accept.key")]):_.key==="ignore"&&(O=t.t("rapid_feature_inspector.option_ignore.tooltip"),B=[t.t("rapid_feature_inspector.option_ignore.key")]),O&&B&&(F=F.call(Ft(t).placement("bottom").title(O).keys(B))),F.append("svg").attr("class","choice-icon icon").append("use").attr("xlink:href",_.iconName),F.append("div").attr("class","choice-label").text(_.label),A.append("button").attr("class",`tag-reference-button ${T}`).attr("title","info").attr("tabindex","-1").on("click",()=>{M.classed("expanded",!M.classed("expanded"))}).call(Ye("#rapid-icon-inspect"))}return m.datum=function(_){return arguments.length?(s=_,this):s},e&&e().on(t.t("rapid_feature_inspector.option_accept.key"),o).on(t.t("rapid_feature_inspector.option_ignore.key"),a),m}function GS(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!1,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!1,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}var f0=GS();function OO(t){f0=t}var BO=/[&<>"']/,fK=new RegExp(BO.source,"g"),UO=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,pK=new RegExp(UO.source,"g"),mK={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},RO=t=>mK[t];function Ao(t,e){if(e){if(BO.test(t))return t.replace(fK,RO)}else if(UO.test(t))return t.replace(pK,RO);return t}var gK=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function zO(t){return t.replace(gK,(e,i)=>(i=i.toLowerCase(),i==="colon"?":":i.charAt(0)==="#"?i.charAt(1)==="x"?String.fromCharCode(parseInt(i.substring(2),16)):String.fromCharCode(+i.substring(1)):""))}var yK=/(^|[^\[])\^/g;function qr(t,e){t=typeof t=="string"?t:t.source,e=e||"";let i={replace:(r,s)=>(s=typeof s=="object"&&"source"in s?s.source:s,s=s.replace(yK,"$1"),t=t.replace(r,s),i),getRegex:()=>new RegExp(t,e)};return i}var _K=/[^\w:]/g,xK=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function DO(t,e,i){if(t){let r;try{r=decodeURIComponent(zO(i)).replace(_K,"").toLowerCase()}catch(s){return null}if(r.indexOf("javascript:")===0||r.indexOf("vbscript:")===0||r.indexOf("data:")===0)return null}e&&!xK.test(i)&&(i=EK(e,i));try{i=encodeURI(i).replace(/%25/g,"%")}catch(r){return null}return i}var hx={},vK=/^[^:]+:\/*[^/]*$/,bK=/^([^:]+:)[\s\S]*$/,wK=/^([^:]+:\/*[^/]*)[\s\S]*$/;function EK(t,e){hx[" "+t]||(vK.test(t)?hx[" "+t]=t+"/":hx[" "+t]=dx(t,"/",!0)),t=hx[" "+t];let i=t.indexOf(":")===-1;return e.substring(0,2)==="//"?i?e:t.replace(bK,"$1")+e:e.charAt(0)==="/"?i?e:t.replace(wK,"$1")+e:t+e}var fx={exec:()=>null};function FO(t,e){let i=t.replace(/\|/g,(n,o,a)=>{let l=!1,c=o;for(;--c>=0&&a[c]==="\\";)l=!l;return l?"|":" |"}),r=i.split(/ \|/),s=0;if(r[0].trim()||r.shift(),r.length>0&&!r[r.length-1].trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;s<r.length;s++)r[s]=r[s].trim().replace(/\\\|/g,"|");return r}function dx(t,e,i){let r=t.length;if(r===0)return"";let s=0;for(;s<r;){let n=t.charAt(r-s-1);if(n===e&&!i)s++;else if(n!==e&&i)s++;else break}return t.slice(0,r-s)}function TK(t,e){if(t.indexOf(e[1])===-1)return-1;let i=0;for(let r=0;r<t.length;r++)if(t[r]==="\\")r++;else if(t[r]===e[0])i++;else if(t[r]===e[1]&&(i--,i<0))return r;return-1}function SK(t,e){!t||t.silent||(e&&console.warn("marked(): callback is deprecated since version 5.0.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/using_pro#async"),(t.sanitize||t.sanitizer)&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options"),(t.highlight||t.langPrefix!=="language-")&&console.warn("marked(): highlight and langPrefix parameters are deprecated since version 5.0.0, should not be used and will be removed in the future. Instead use https://www.npmjs.com/package/marked-highlight."),t.mangle&&console.warn("marked(): mangle parameter is enabled by default, but is deprecated since version 5.0.0, and will be removed in the future. To clear this warning, install https://www.npmjs.com/package/marked-mangle, or disable by setting `{mangle: false}`."),t.baseUrl&&console.warn("marked(): baseUrl parameter is deprecated since version 5.0.0, should not be used and will be removed in the future. Instead use https://www.npmjs.com/package/marked-base-url."),t.smartypants&&console.warn("marked(): smartypants parameter is deprecated since version 5.0.0, should not be used and will be removed in the future. Instead use https://www.npmjs.com/package/marked-smartypants."),t.xhtml&&console.warn("marked(): xhtml parameter is deprecated since version 5.0.0, should not be used and will be removed in the future. Instead use https://www.npmjs.com/package/marked-xhtml."),(t.headerIds||t.headerPrefix)&&console.warn("marked(): headerIds and headerPrefix parameters enabled by default, but are deprecated since version 5.0.0, and will be removed in the future. To clear this warning, install  https://www.npmjs.com/package/marked-gfm-heading-id, or disable by setting `{headerIds: false}`."))}function LO(t,e,i,r){let s=e.href,n=e.title?Ao(e.title):null,o=t[1].replace(/\\([\[\]])/g,"$1");if(t[0].charAt(0)!=="!"){r.state.inLink=!0;let a={type:"link",raw:i,href:s,title:n,text:o,tokens:r.inlineTokens(o)};return r.state.inLink=!1,a}return{type:"image",raw:i,href:s,title:n,text:Ao(o)}}function AK(t,e){let i=t.match(/^(\s+)(?:```)/);if(i===null)return e;let r=i[1];return e.split(`
`).map(s=>{let n=s.match(/^\s+/);if(n===null)return s;let[o]=n;return o.length>=r.length?s.slice(r.length):s}).join(`
`)}var tp=class{constructor(e){Vr(this,"options");Vr(this,"rules");Vr(this,"lexer");this.options=e||f0}space(e){let i=this.rules.block.newline.exec(e);if(i&&i[0].length>0)return{type:"space",raw:i[0]}}code(e){let i=this.rules.block.code.exec(e);if(i){let r=i[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:i[0],codeBlockStyle:"indented",text:this.options.pedantic?r:dx(r,`
`)}}}fences(e){let i=this.rules.block.fences.exec(e);if(i){let r=i[0],s=AK(r,i[3]||"");return{type:"code",raw:r,lang:i[2]?i[2].trim().replace(this.rules.inline._escapes,"$1"):i[2],text:s}}}heading(e){let i=this.rules.block.heading.exec(e);if(i){let r=i[2].trim();if(/#$/.test(r)){let s=dx(r,"#");(this.options.pedantic||!s||/ $/.test(s))&&(r=s.trim())}return{type:"heading",raw:i[0],depth:i[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(e){let i=this.rules.block.hr.exec(e);if(i)return{type:"hr",raw:i[0]}}blockquote(e){let i=this.rules.block.blockquote.exec(e);if(i){let r=i[0].replace(/^ *>[ \t]?/gm,""),s=this.lexer.state.top;this.lexer.state.top=!0;let n=this.lexer.blockTokens(r);return this.lexer.state.top=s,{type:"blockquote",raw:i[0],tokens:n,text:r}}}list(e){let i=this.rules.block.list.exec(e);if(i){let r=i[1].trim(),s=r.length>1,n={type:"list",raw:"",ordered:s,start:s?+r.slice(0,-1):"",loose:!1,items:[]};r=s?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=s?r:"[*+-]");let o=new RegExp(`^( {0,3}${r})((?:[	 ][^\\n]*)?(?:\\n|$))`),a="",l="",c=!1;for(;e;){let d=!1;if(!(i=o.exec(e))||this.rules.block.hr.test(e))break;a=i[0],e=e.substring(a.length);let m=i[2].split(`
`,1)[0].replace(/^\t+/,T=>" ".repeat(3*T.length)),g=e.split(`
`,1)[0],_=0;this.options.pedantic?(_=2,l=m.trimLeft()):(_=i[2].search(/[^ ]/),_=_>4?1:_,l=m.slice(_),_+=i[1].length);let v=!1;if(!m&&/^ *$/.test(g)&&(a+=g+`
`,e=e.substring(g.length+1),d=!0),!d){let T=new RegExp(`^ {0,${Math.min(3,_-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),A=new RegExp(`^ {0,${Math.min(3,_-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),M=new RegExp(`^ {0,${Math.min(3,_-1)}}(?:\`\`\`|~~~)`),k=new RegExp(`^ {0,${Math.min(3,_-1)}}#`);for(;e;){let F=e.split(`
`,1)[0];if(g=F,this.options.pedantic&&(g=g.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),M.test(g)||k.test(g)||T.test(g)||A.test(e))break;if(g.search(/[^ ]/)>=_||!g.trim())l+=`
`+g.slice(_);else{if(v||m.search(/[^ ]/)>=4||M.test(m)||k.test(m)||A.test(m))break;l+=`
`+g}!v&&!g.trim()&&(v=!0),a+=F+`
`,e=e.substring(F.length+1),m=g.slice(_)}}n.loose||(c?n.loose=!0:/\n *\n *$/.test(a)&&(c=!0));let E=null,b;this.options.gfm&&(E=/^\[[ xX]\] /.exec(l),E&&(b=E[0]!=="[ ] ",l=l.replace(/^\[[ xX]\] +/,""))),n.items.push({type:"list_item",raw:a,task:!!E,checked:b,loose:!1,text:l,tokens:[]}),n.raw+=a}n.items[n.items.length-1].raw=a.trimRight(),n.items[n.items.length-1].text=l.trimRight(),n.raw=n.raw.trimRight();for(let d=0;d<n.items.length;d++)if(this.lexer.state.top=!1,n.items[d].tokens=this.lexer.blockTokens(n.items[d].text,[]),!n.loose){let m=n.items[d].tokens.filter(_=>_.type==="space"),g=m.length>0&&m.some(_=>/\n.*\n/.test(_.raw));n.loose=g}if(n.loose)for(let d=0;d<n.items.length;d++)n.items[d].loose=!0;return n}}html(e){let i=this.rules.block.html.exec(e);if(i){let r={type:"html",block:!0,raw:i[0],pre:!this.options.sanitizer&&(i[1]==="pre"||i[1]==="script"||i[1]==="style"),text:i[0]};if(this.options.sanitize){let s=this.options.sanitizer?this.options.sanitizer(i[0]):Ao(i[0]),n=r;n.type="paragraph",n.text=s,n.tokens=this.lexer.inline(s)}return r}}def(e){let i=this.rules.block.def.exec(e);if(i){let r=i[1].toLowerCase().replace(/\s+/g," "),s=i[2]?i[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",n=i[3]?i[3].substring(1,i[3].length-1).replace(this.rules.inline._escapes,"$1"):i[3];return{type:"def",tag:r,raw:i[0],href:s,title:n}}}table(e){let i=this.rules.block.table.exec(e);if(i){let r={type:"table",raw:i[0],header:FO(i[1]).map(s=>({text:s,tokens:[]})),align:i[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:i[3]&&i[3].trim()?i[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(r.header.length===r.align.length){let s=r.align.length,n,o,a,l;for(n=0;n<s;n++){let c=r.align[n];c&&(/^ *-+: *$/.test(c)?r.align[n]="right":/^ *:-+: *$/.test(c)?r.align[n]="center":/^ *:-+ *$/.test(c)?r.align[n]="left":r.align[n]=null)}for(s=r.rows.length,n=0;n<s;n++)r.rows[n]=FO(r.rows[n],r.header.length).map(c=>({text:c,tokens:[]}));for(s=r.header.length,o=0;o<s;o++)r.header[o].tokens=this.lexer.inline(r.header[o].text);for(s=r.rows.length,o=0;o<s;o++)for(l=r.rows[o],a=0;a<l.length;a++)l[a].tokens=this.lexer.inline(l[a].text);return r}}}lheading(e){let i=this.rules.block.lheading.exec(e);if(i)return{type:"heading",raw:i[0],depth:i[2].charAt(0)==="="?1:2,text:i[1],tokens:this.lexer.inline(i[1])}}paragraph(e){let i=this.rules.block.paragraph.exec(e);if(i){let r=i[1].charAt(i[1].length-1)===`
`?i[1].slice(0,-1):i[1];return{type:"paragraph",raw:i[0],text:r,tokens:this.lexer.inline(r)}}}text(e){let i=this.rules.block.text.exec(e);if(i)return{type:"text",raw:i[0],text:i[0],tokens:this.lexer.inline(i[0])}}escape(e){let i=this.rules.inline.escape.exec(e);if(i)return{type:"escape",raw:i[0],text:Ao(i[1])}}tag(e){let i=this.rules.inline.tag.exec(e);if(i)return!this.lexer.state.inLink&&/^<a /i.test(i[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(i[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(i[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(i[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:i[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(i[0]):Ao(i[0]):i[0]}}link(e){let i=this.rules.inline.link.exec(e);if(i){let r=i[2].trim();if(!this.options.pedantic&&/^</.test(r)){if(!/>$/.test(r))return;let o=dx(r.slice(0,-1),"\\");if((r.length-o.length)%2===0)return}else{let o=TK(i[2],"()");if(o>-1){let l=(i[0].indexOf("!")===0?5:4)+i[1].length+o;i[2]=i[2].substring(0,o),i[0]=i[0].substring(0,l).trim(),i[3]=""}}let s=i[2],n="";if(this.options.pedantic){let o=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(s);o&&(s=o[1],n=o[3])}else n=i[3]?i[3].slice(1,-1):"";return s=s.trim(),/^</.test(s)&&(this.options.pedantic&&!/>$/.test(r)?s=s.slice(1):s=s.slice(1,-1)),LO(i,{href:s&&s.replace(this.rules.inline._escapes,"$1"),title:n&&n.replace(this.rules.inline._escapes,"$1")},i[0],this.lexer)}}reflink(e,i){let r;if((r=this.rules.inline.reflink.exec(e))||(r=this.rules.inline.nolink.exec(e))){let s=(r[2]||r[1]).replace(/\s+/g," ");if(s=i[s.toLowerCase()],!s){let n=r[0].charAt(0);return{type:"text",raw:n,text:n}}return LO(r,s,r[0],this.lexer)}}emStrong(e,i,r=""){let s=this.rules.inline.emStrong.lDelim.exec(e);if(!s||s[3]&&r.match(/[\p{L}\p{N}]/u))return;if(!(s[1]||s[2]||"")||!r||this.rules.inline.punctuation.exec(r)){let o=[...s[0]].length-1,a,l,c=o,d=0,m=s[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(m.lastIndex=0,i=i.slice(-1*e.length+o);(s=m.exec(i))!=null;){if(a=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!a)continue;if(l=[...a].length,s[3]||s[4]){c+=l;continue}else if((s[5]||s[6])&&o%3&&!((o+l)%3)){d+=l;continue}if(c-=l,c>0)continue;l=Math.min(l,l+c+d);let g=[...e].slice(0,o+s.index+l+1).join("");if(Math.min(o,l)%2){let v=g.slice(1,-1);return{type:"em",raw:g,text:v,tokens:this.lexer.inlineTokens(v)}}let _=g.slice(2,-2);return{type:"strong",raw:g,text:_,tokens:this.lexer.inlineTokens(_)}}}}codespan(e){let i=this.rules.inline.code.exec(e);if(i){let r=i[2].replace(/\n/g," "),s=/[^ ]/.test(r),n=/^ /.test(r)&&/ $/.test(r);return s&&n&&(r=r.substring(1,r.length-1)),r=Ao(r,!0),{type:"codespan",raw:i[0],text:r}}}br(e){let i=this.rules.inline.br.exec(e);if(i)return{type:"br",raw:i[0]}}del(e){let i=this.rules.inline.del.exec(e);if(i)return{type:"del",raw:i[0],text:i[2],tokens:this.lexer.inlineTokens(i[2])}}autolink(e,i){let r=this.rules.inline.autolink.exec(e);if(r){let s,n;return r[2]==="@"?(s=Ao(this.options.mangle?i(r[1]):r[1]),n="mailto:"+s):(s=Ao(r[1]),n=s),{type:"link",raw:r[0],text:s,href:n,tokens:[{type:"text",raw:s,text:s}]}}}url(e,i){let r;if(r=this.rules.inline.url.exec(e)){let s,n;if(r[2]==="@")s=Ao(this.options.mangle?i(r[0]):r[0]),n="mailto:"+s;else{let o;do o=r[0],r[0]=this.rules.inline._backpedal.exec(r[0])[0];while(o!==r[0]);s=Ao(r[0]),r[1]==="www."?n="http://"+r[0]:n=r[0]}return{type:"link",raw:r[0],text:s,href:n,tokens:[{type:"text",raw:s,text:s}]}}}inlineText(e,i){let r=this.rules.inline.text.exec(e);if(r){let s;return this.lexer.state.inRawBlock?s=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):Ao(r[0]):r[0]:s=Ao(this.options.smartypants?i(r[0]):r[0]),{type:"text",raw:r[0],text:s}}}},Bi={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:fx,lheading:/^((?:(?!^bull ).|\n(?!\n|bull ))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};Bi._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;Bi._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;Bi.def=qr(Bi.def).replace("label",Bi._label).replace("title",Bi._title).getRegex();Bi.bullet=/(?:[*+-]|\d{1,9}[.)])/;Bi.listItemStart=qr(/^( *)(bull) */).replace("bull",Bi.bullet).getRegex();Bi.list=qr(Bi.list).replace(/bull/g,Bi.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+Bi.def.source+")").getRegex();Bi._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";Bi._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;Bi.html=qr(Bi.html,"i").replace("comment",Bi._comment).replace("tag",Bi._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();Bi.lheading=qr(Bi.lheading).replace(/bull/g,Bi.bullet).getRegex();Bi.paragraph=qr(Bi._paragraph).replace("hr",Bi.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Bi._tag).getRegex();Bi.blockquote=qr(Bi.blockquote).replace("paragraph",Bi.paragraph).getRegex();Bi.normal=di({},Bi);Bi.gfm=Tn(di({},Bi.normal),{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"});Bi.gfm.table=qr(Bi.gfm.table).replace("hr",Bi.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Bi._tag).getRegex();Bi.gfm.paragraph=qr(Bi._paragraph).replace("hr",Bi.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",Bi.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Bi._tag).getRegex();Bi.pedantic=Tn(di({},Bi.normal),{html:qr(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Bi._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:fx,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:qr(Bi.normal._paragraph).replace("hr",Bi.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Bi.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});var oi={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:fx,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,rDelimAst:/^[^_*]*?__[^_*]*?\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\*)[punct](\*+)(?=[\s]|$)|[^punct\s](\*+)(?!\*)(?=[punct\s]|$)|(?!\*)[punct\s](\*+)(?=[^punct\s])|[\s](\*+)(?!\*)(?=[punct])|(?!\*)[punct](\*+)(?!\*)(?=[punct])|[^punct\s](\*+)(?=[^punct\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?_[^_*]*?(?=\*\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\s]|$)|[^punct\s](_+)(?!_)(?=[punct\s]|$)|(?!_)[punct\s](_+)(?=[^punct\s])|[\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:fx,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^((?![*_])[\spunctuation])/};oi._punctuation="\\p{P}$+<=>`^|~";oi.punctuation=qr(oi.punctuation,"u").replace(/punctuation/g,oi._punctuation).getRegex();oi.blockSkip=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g;oi.anyPunctuation=/\\[punct]/g;oi._escapes=/\\([punct])/g;oi._comment=qr(Bi._comment).replace("(?:-->|$)","-->").getRegex();oi.emStrong.lDelim=qr(oi.emStrong.lDelim,"u").replace(/punct/g,oi._punctuation).getRegex();oi.emStrong.rDelimAst=qr(oi.emStrong.rDelimAst,"gu").replace(/punct/g,oi._punctuation).getRegex();oi.emStrong.rDelimUnd=qr(oi.emStrong.rDelimUnd,"gu").replace(/punct/g,oi._punctuation).getRegex();oi.anyPunctuation=qr(oi.anyPunctuation,"gu").replace(/punct/g,oi._punctuation).getRegex();oi._escapes=qr(oi._escapes,"gu").replace(/punct/g,oi._punctuation).getRegex();oi._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;oi._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;oi.autolink=qr(oi.autolink).replace("scheme",oi._scheme).replace("email",oi._email).getRegex();oi._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;oi.tag=qr(oi.tag).replace("comment",oi._comment).replace("attribute",oi._attribute).getRegex();oi._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;oi._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;oi._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;oi.link=qr(oi.link).replace("label",oi._label).replace("href",oi._href).replace("title",oi._title).getRegex();oi.reflink=qr(oi.reflink).replace("label",oi._label).replace("ref",Bi._label).getRegex();oi.nolink=qr(oi.nolink).replace("ref",Bi._label).getRegex();oi.reflinkSearch=qr(oi.reflinkSearch,"g").replace("reflink",oi.reflink).replace("nolink",oi.nolink).getRegex();oi.normal=di({},oi);oi.pedantic=Tn(di({},oi.normal),{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:qr(/^!?\[(label)\]\((.*?)\)/).replace("label",oi._label).getRegex(),reflink:qr(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",oi._label).getRegex()});oi.gfm=Tn(di({},oi.normal),{escape:qr(oi.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/});oi.gfm.url=qr(oi.gfm.url,"i").replace("email",oi.gfm._extended_email).getRegex();oi.breaks=Tn(di({},oi.gfm),{br:qr(oi.br).replace("{2,}","*").getRegex(),text:qr(oi.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});function CK(t){return t.replace(/---/g,"\u2014").replace(/--/g,"\u2013").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1\u2018").replace(/'/g,"\u2019").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1\u201C").replace(/"/g,"\u201D").replace(/\.{3}/g,"\u2026")}function NO(t){let e="";for(let i=0;i<t.length;i++){let r=Math.random()>.5?"x"+t.charCodeAt(i).toString(16):t.charCodeAt(i).toString();e+="&#"+r+";"}return e}var c1=class t{constructor(e){Vr(this,"tokens");Vr(this,"options");Vr(this,"state");Vr(this,"tokenizer");Vr(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||f0,this.options.tokenizer=this.options.tokenizer||new tp,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let i={block:Bi.normal,inline:oi.normal};this.options.pedantic?(i.block=Bi.pedantic,i.inline=oi.pedantic):this.options.gfm&&(i.block=Bi.gfm,this.options.breaks?i.inline=oi.breaks:i.inline=oi.gfm),this.tokenizer.rules=i}static get rules(){return{block:Bi,inline:oi}}static lex(e,i){return new t(i).lex(e)}static lexInline(e,i){return new t(i).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);let i;for(;i=this.inlineQueue.shift();)this.inlineTokens(i.src,i.tokens);return this.tokens}blockTokens(e,i=[]){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(a,l,c)=>l+"    ".repeat(c.length));let r,s,n,o;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(a=>(r=a.call({lexer:this},e,i))?(e=e.substring(r.raw.length),i.push(r),!0):!1))){if(r=this.tokenizer.space(e)){e=e.substring(r.raw.length),r.raw.length===1&&i.length>0?i[i.length-1].raw+=`
`:i.push(r);continue}if(r=this.tokenizer.code(e)){e=e.substring(r.raw.length),s=i[i.length-1],s&&(s.type==="paragraph"||s.type==="text")?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue[this.inlineQueue.length-1].src=s.text):i.push(r);continue}if(r=this.tokenizer.fences(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.heading(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.hr(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.blockquote(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.list(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.html(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.def(e)){e=e.substring(r.raw.length),s=i[i.length-1],s&&(s.type==="paragraph"||s.type==="text")?(s.raw+=`
`+r.raw,s.text+=`
`+r.raw,this.inlineQueue[this.inlineQueue.length-1].src=s.text):this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title});continue}if(r=this.tokenizer.table(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.lheading(e)){e=e.substring(r.raw.length),i.push(r);continue}if(n=e,this.options.extensions&&this.options.extensions.startBlock){let a=1/0,l=e.slice(1),c;this.options.extensions.startBlock.forEach(d=>{c=d.call({lexer:this},l),typeof c=="number"&&c>=0&&(a=Math.min(a,c))}),a<1/0&&a>=0&&(n=e.substring(0,a+1))}if(this.state.top&&(r=this.tokenizer.paragraph(n))){s=i[i.length-1],o&&s.type==="paragraph"?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):i.push(r),o=n.length!==e.length,e=e.substring(r.raw.length);continue}if(r=this.tokenizer.text(e)){e=e.substring(r.raw.length),s=i[i.length-1],s&&s.type==="text"?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):i.push(r);continue}if(e){let a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,i}inline(e,i=[]){return this.inlineQueue.push({src:e,tokens:i}),i}inlineTokens(e,i=[]){let r,s,n,o=e,a,l,c;if(this.tokens.links){let d=Object.keys(this.tokens.links);if(d.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(o))!=null;)d.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.blockSkip.exec(o))!=null;)o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(o))!=null;)o=o.slice(0,a.index)+"++"+o.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(l||(c=""),l=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(d=>(r=d.call({lexer:this},e,i))?(e=e.substring(r.raw.length),i.push(r),!0):!1))){if(r=this.tokenizer.escape(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.tag(e)){e=e.substring(r.raw.length),s=i[i.length-1],s&&r.type==="text"&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):i.push(r);continue}if(r=this.tokenizer.link(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(r.raw.length),s=i[i.length-1],s&&r.type==="text"&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):i.push(r);continue}if(r=this.tokenizer.emStrong(e,o,c)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.codespan(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.br(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.del(e)){e=e.substring(r.raw.length),i.push(r);continue}if(r=this.tokenizer.autolink(e,NO)){e=e.substring(r.raw.length),i.push(r);continue}if(!this.state.inLink&&(r=this.tokenizer.url(e,NO))){e=e.substring(r.raw.length),i.push(r);continue}if(n=e,this.options.extensions&&this.options.extensions.startInline){let d=1/0,m=e.slice(1),g;this.options.extensions.startInline.forEach(_=>{g=_.call({lexer:this},m),typeof g=="number"&&g>=0&&(d=Math.min(d,g))}),d<1/0&&d>=0&&(n=e.substring(0,d+1))}if(r=this.tokenizer.inlineText(n,CK)){e=e.substring(r.raw.length),r.raw.slice(-1)!=="_"&&(c=r.raw.slice(-1)),l=!0,s=i[i.length-1],s&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):i.push(r);continue}if(e){let d="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(d);break}else throw new Error(d)}}return i}},ip=class{constructor(e){Vr(this,"options");this.options=e||f0}code(e,i,r){var n;let s=(n=(i||"").match(/^\S*/))==null?void 0:n[0];if(this.options.highlight){let o=this.options.highlight(e,s);o!=null&&o!==e&&(r=!0,e=o)}return e=e.replace(/\n$/,"")+`
`,s?'<pre><code class="'+this.options.langPrefix+Ao(s)+'">'+(r?e:Ao(e,!0))+`</code></pre>
`:"<pre><code>"+(r?e:Ao(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e,i){return e}heading(e,i,r,s){if(this.options.headerIds){let n=this.options.headerPrefix+s.slug(r);return`<h${i} id="${n}">${e}</h${i}>
`}return`<h${i}>${e}</h${i}>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(e,i,r){let s=i?"ol":"ul",n=i&&r!==1?' start="'+r+'"':"";return"<"+s+n+`>
`+e+"</"+s+`>
`}listitem(e,i,r){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(e){return`<p>${e}</p>
`}table(e,i){return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+i+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,i){let r=i.header?"th":"td";return(i.align?`<${r} align="${i.align}">`:`<${r}>`)+e+`</${r}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(e){return`<del>${e}</del>`}link(e,i,r){let s=DO(this.options.sanitize,this.options.baseUrl,e);if(s===null)return r;e=s;let n='<a href="'+e+'"';return i&&(n+=' title="'+i+'"'),n+=">"+r+"</a>",n}image(e,i,r){let s=DO(this.options.sanitize,this.options.baseUrl,e);if(s===null)return r;e=s;let n=`<img src="${e}" alt="${r}"`;return i&&(n+=` title="${i}"`),n+=this.options.xhtml?"/>":">",n}text(e){return e}},C6=class{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,i,r){return""+r}image(e,i,r){return""+r}br(){return""}},I6=class{constructor(){Vr(this,"seen");this.seen={}}serialize(e){return e.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(e,i){let r=e,s=0;if(this.seen.hasOwnProperty(r)){s=this.seen[e];do s++,r=e+"-"+s;while(this.seen.hasOwnProperty(r))}return i||(this.seen[e]=s,this.seen[r]=0),r}slug(e,i={}){let r=this.serialize(e);return this.getNextSafeSlug(r,i.dryrun)}},u1=class t{constructor(e){Vr(this,"options");Vr(this,"renderer");Vr(this,"textRenderer");Vr(this,"slugger");this.options=e||f0,this.options.renderer=this.options.renderer||new ip,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new C6,this.slugger=new I6}static parse(e,i){return new t(i).parse(e)}static parseInline(e,i){return new t(i).parseInline(e)}parse(e,i=!0){let r="";for(let s=0;s<e.length;s++){let n=e[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[n.type]){let o=n,a=this.options.extensions.renderers[o.type].call({parser:this},o);if(a!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(o.type)){r+=a||"";continue}}switch(n.type){case"space":continue;case"hr":{r+=this.renderer.hr();continue}case"heading":{let o=n;r+=this.renderer.heading(this.parseInline(o.tokens),o.depth,zO(this.parseInline(o.tokens,this.textRenderer)),this.slugger);continue}case"code":{let o=n;r+=this.renderer.code(o.text,o.lang,!!o.escaped);continue}case"table":{let o=n,a="",l="";for(let d=0;d<o.header.length;d++)l+=this.renderer.tablecell(this.parseInline(o.header[d].tokens),{header:!0,align:o.align[d]});a+=this.renderer.tablerow(l);let c="";for(let d=0;d<o.rows.length;d++){let m=o.rows[d];l="";for(let g=0;g<m.length;g++)l+=this.renderer.tablecell(this.parseInline(m[g].tokens),{header:!1,align:o.align[g]});c+=this.renderer.tablerow(l)}r+=this.renderer.table(a,c);continue}case"blockquote":{let o=n,a=this.parse(o.tokens);r+=this.renderer.blockquote(a);continue}case"list":{let o=n,a=o.ordered,l=o.start,c=o.loose,d="";for(let m=0;m<o.items.length;m++){let g=o.items[m],_=g.checked,v=g.task,E="";if(g.task){let b=this.renderer.checkbox(!!_);c?g.tokens.length>0&&g.tokens[0].type==="paragraph"?(g.tokens[0].text=b+" "+g.tokens[0].text,g.tokens[0].tokens&&g.tokens[0].tokens.length>0&&g.tokens[0].tokens[0].type==="text"&&(g.tokens[0].tokens[0].text=b+" "+g.tokens[0].tokens[0].text)):g.tokens.unshift({type:"text",text:b}):E+=b}E+=this.parse(g.tokens,c),d+=this.renderer.listitem(E,v,!!_)}r+=this.renderer.list(d,a,l);continue}case"html":{let o=n;r+=this.renderer.html(o.text,o.block);continue}case"paragraph":{let o=n;r+=this.renderer.paragraph(this.parseInline(o.tokens));continue}case"text":{let o=n,a=o.tokens?this.parseInline(o.tokens):o.text;for(;s+1<e.length&&e[s+1].type==="text";)o=e[++s],a+=`
`+(o.tokens?this.parseInline(o.tokens):o.text);r+=i?this.renderer.paragraph(a):a;continue}default:{let o='Token with "'+n.type+'" type was not found.';if(this.options.silent)return console.error(o),"";throw new Error(o)}}}return r}parseInline(e,i){i=i||this.renderer;let r="";for(let s=0;s<e.length;s++){let n=e[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[n.type]){let o=this.options.extensions.renderers[n.type].call({parser:this},n);if(o!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(n.type)){r+=o||"";continue}}switch(n.type){case"escape":{let o=n;r+=i.text(o.text);break}case"html":{let o=n;r+=i.html(o.text);break}case"link":{let o=n;r+=i.link(o.href,o.title,this.parseInline(o.tokens,i));break}case"image":{let o=n;r+=i.image(o.href,o.title,o.text);break}case"strong":{let o=n;r+=i.strong(this.parseInline(o.tokens,i));break}case"em":{let o=n;r+=i.em(this.parseInline(o.tokens,i));break}case"codespan":{let o=n;r+=i.codespan(o.text);break}case"br":{r+=i.br();break}case"del":{let o=n;r+=i.del(this.parseInline(o.tokens,i));break}case"text":{let o=n;r+=i.text(o.text);break}default:{let o='Token with "'+n.type+'" type was not found.';if(this.options.silent)return console.error(o),"";throw new Error(o)}}}return r}},h0=class{constructor(e){Vr(this,"options");this.options=e||f0}preprocess(e){return e}postprocess(e){return e}};Vr(h0,"passThroughHooks",new Set(["preprocess","postprocess"]));var k6,zS,px,GO,US=class{constructor(...e){xb(this,k6);xb(this,px);Vr(this,"defaults",GS());Vr(this,"options",this.setOptions);Vr(this,"parse",C9(this,k6,zS).call(this,c1.lex,u1.parse));Vr(this,"parseInline",C9(this,k6,zS).call(this,c1.lexInline,u1.parseInline));Vr(this,"Parser",u1);Vr(this,"parser",u1.parse);Vr(this,"Renderer",ip);Vr(this,"TextRenderer",C6);Vr(this,"Lexer",c1);Vr(this,"lexer",c1.lex);Vr(this,"Tokenizer",tp);Vr(this,"Slugger",I6);Vr(this,"Hooks",h0);this.use(...e)}walkTokens(e,i){var s,n;let r=[];for(let o of e)switch(r=r.concat(i.call(this,o)),o.type){case"table":{let a=o;for(let l of a.header)r=r.concat(this.walkTokens(l.tokens,i));for(let l of a.rows)for(let c of l)r=r.concat(this.walkTokens(c.tokens,i));break}case"list":{let a=o;r=r.concat(this.walkTokens(a.items,i));break}default:{let a=o;(n=(s=this.defaults.extensions)==null?void 0:s.childTokens)!=null&&n[a.type]?this.defaults.extensions.childTokens[a.type].forEach(l=>{r=r.concat(this.walkTokens(a[l],i))}):a.tokens&&(r=r.concat(this.walkTokens(a.tokens,i)))}}return r}use(...e){let i=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(r=>{let s=di({},r);if(s.async=this.defaults.async||s.async||!1,r.extensions&&(r.extensions.forEach(n=>{if(!n.name)throw new Error("extension name required");if("renderer"in n){let o=i.renderers[n.name];o?i.renderers[n.name]=function(...a){let l=n.renderer.apply(this,a);return l===!1&&(l=o.apply(this,a)),l}:i.renderers[n.name]=n.renderer}if("tokenizer"in n){if(!n.level||n.level!=="block"&&n.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=i[n.level];o?o.unshift(n.tokenizer):i[n.level]=[n.tokenizer],n.start&&(n.level==="block"?i.startBlock?i.startBlock.push(n.start):i.startBlock=[n.start]:n.level==="inline"&&(i.startInline?i.startInline.push(n.start):i.startInline=[n.start]))}"childTokens"in n&&n.childTokens&&(i.childTokens[n.name]=n.childTokens)}),s.extensions=i),r.renderer){let n=this.defaults.renderer||new ip(this.defaults);for(let o in r.renderer){let a=r.renderer[o],l=o,c=n[l];n[l]=(...d)=>{let m=a.apply(n,d);return m===!1&&(m=c.apply(n,d)),m||""}}s.renderer=n}if(r.tokenizer){let n=this.defaults.tokenizer||new tp(this.defaults);for(let o in r.tokenizer){let a=r.tokenizer[o],l=o,c=n[l];n[l]=(...d)=>{let m=a.apply(n,d);return m===!1&&(m=c.apply(n,d)),m}}s.tokenizer=n}if(r.hooks){let n=this.defaults.hooks||new h0;for(let o in r.hooks){let a=r.hooks[o],l=o,c=n[l];h0.passThroughHooks.has(o)?n[l]=d=>{if(this.defaults.async)return Promise.resolve(a.call(n,d)).then(g=>c.call(n,g));let m=a.call(n,d);return c.call(n,m)}:n[l]=(...d)=>{let m=a.apply(n,d);return m===!1&&(m=c.apply(n,d)),m}}s.hooks=n}if(r.walkTokens){let n=this.defaults.walkTokens,o=r.walkTokens;s.walkTokens=function(a){let l=[];return l.push(o.call(this,a)),n&&(l=l.concat(n.call(this,a))),l}}this.defaults=di(di({},this.defaults),s)}),this}setOptions(e){return this.defaults=di(di({},this.defaults),e),this}};k6=new WeakSet,zS=function(e,i){return(r,s,n)=>{typeof s=="function"&&(n=s,s=null);let o=di({},s),a=di(di({},this.defaults),o);this.defaults.async===!0&&o.async===!1&&(a.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),a.async=!0);let l=C9(this,px,GO).call(this,!!a.silent,!!a.async,n);if(typeof r=="undefined"||r===null)return l(new Error("marked(): input parameter is undefined or null"));if(typeof r!="string")return l(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(r)+", string expected"));if(SK(a,n),a.hooks&&(a.hooks.options=a),n){let c=n,d=a.highlight,m;try{a.hooks&&(r=a.hooks.preprocess(r)),m=e(r,a)}catch(v){return l(v)}let g=v=>{let E;if(!v)try{a.walkTokens&&this.walkTokens(m,a.walkTokens),E=i(m,a),a.hooks&&(E=a.hooks.postprocess(E))}catch(b){v=b}return a.highlight=d,v?l(v):c(null,E)};if(!d||d.length<3||(delete a.highlight,!m.length))return g();let _=0;this.walkTokens(m,v=>{v.type==="code"&&(_++,setTimeout(()=>{d(v.text,v.lang,(E,b)=>{if(E)return g(E);b!=null&&b!==v.text&&(v.text=b,v.escaped=!0),_--,_===0&&g()})},0))}),_===0&&g();return}if(a.async)return Promise.resolve(a.hooks?a.hooks.preprocess(r):r).then(c=>e(c,a)).then(c=>a.walkTokens?Promise.all(this.walkTokens(c,a.walkTokens)).then(()=>c):c).then(c=>i(c,a)).then(c=>a.hooks?a.hooks.postprocess(c):c).catch(l);try{a.hooks&&(r=a.hooks.preprocess(r));let c=e(r,a);a.walkTokens&&this.walkTokens(c,a.walkTokens);let d=i(c,a);return a.hooks&&(d=a.hooks.postprocess(d)),d}catch(c){return l(c)}}},px=new WeakSet,GO=function(e,i,r){return s=>{if(s.message+=`
Please report this to https://github.com/markedjs/marked.`,e){let n="<p>An error occurred:</p><pre>"+Ao(s.message+"",!0)+"</pre>";if(i)return Promise.resolve(n);if(r){r(null,n);return}return n}if(i)return Promise.reject(s);if(r){r(s);return}throw s}};var d0=new US;function er(t,e,i){return d0.parse(t,e,i)}er.options=er.setOptions=function(t){return d0.setOptions(t),er.defaults=d0.defaults,OO(er.defaults),er};er.getDefaults=GS;er.defaults=f0;er.use=function(...t){return d0.use(...t),er.defaults=d0.defaults,OO(er.defaults),er};er.walkTokens=function(t,e){return d0.walkTokens(t,e)};er.parseInline=d0.parseInline;er.Parser=u1;er.parser=u1.parse;er.Renderer=ip;er.TextRenderer=C6;er.Lexer=c1;er.lexer=c1.lex;er.Tokenizer=tp;er.Slugger=I6;er.Hooks=h0;er.parse=er;var Kot=er.options,Jot=er.setOptions,eat=er.use,tat=er.walkTokens,iat=er.parseInline;var rat=u1.parse,sat=c1.lex;function mx(t,e){let i=t.systems.rapid,r=Pt("done"),s=xr(t,"dataset-categories"),n=100,o=ye(null),a,l,c,d=()=>!0;function m(){let M=t.container().selectAll(".shaded");if(M.empty()||M.selectAll(".modal-view-manage").size())return;let k=e.close;e.close=()=>{},d=()=>{a=null,l=null,B.transition().duration(200).style("top","0px").on("end",()=>O.remove()),e.close=k;let U=$i("modal");U.on(["\u232B","\u238B"],k),ye(document).call(U),r.call("done")};let F=$i("modal");F.on(["\u232B","\u238B"],d),ye(document).call(F);let O=M.append("div").attr("class","view-manage-wrap"),B=O.append("div").attr("class","modal rapid-modal modal-view-manage").style("opacity",0);B.append("button").attr("class","close").on("click",d).call(Ye("#rapid-icon-close")),o=B.append("div").attr("class","rapid-stack content"),o.call(g),o.selectAll(".ok-button").node().focus(),B.transition().style("opacity",1)}function g(M){let k=M.selectAll(".rapid-view-manage-header").data([0]).enter().append("div").attr("class","modal-section rapid-view-manage-header"),F=k.append("div");F.append("div").attr("class","rapid-view-manage-header-icon").call(Ye("#rapid-icon-data","icon-30")),F.append("div").attr("class","rapid-view-manage-header-text").text(t.t("rapid_feature_toggle.esri.title"));let O=k.append("div");O.append("div").attr("class","rapid-view-manage-header-about").html(er.parse(t.t("rapid_feature_toggle.esri.about"))),O.selectAll("a").attr("target","_blank");let B=M.selectAll(".rapid-view-manage-filter").data([0]).enter().append("div").attr("class","modal-section rapid-view-manage-filter"),U=B.append("div").attr("class","rapid-view-manage-filter-search-wrap");U.call(Ye("#fas-filter","inline")),U.append("input").attr("class","rapid-view-manage-filter-search").attr("placeholder",t.t("rapid_feature_toggle.esri.filter_datasets")).call(Ri).on("input",Q=>{let V=Q.currentTarget;a=(V&&V.value||"").trim().toLowerCase(),Z.call(_)}),B.append("div").attr("class","rapid-view-manage-filter-type-wrap").append("input").attr("class","rapid-view-manage-filter-type").attr("placeholder",t.t("rapid_feature_toggle.esri.any_type")).call(Ri).call(s).on("blur change",Q=>{let V=Q.currentTarget,le=V&&V.value||"";s.data().some(ne=>ne.value===le)?l=le:(Q.currentTarget.value="",l=null),Z.call(_)}),B.append("div").attr("class","rapid-view-manage-filter-clear").append("a").attr("href","#").text(t.t("rapid_feature_toggle.esri.clear_filters")).on("click",Q=>{Q.preventDefault(),Q.currentTarget.blur(),M.selectAll("input").property("value",""),a=null,l=null,Z.call(_)}),B.append("div").attr("class","rapid-view-manage-filter-results");let Z=M.selectAll(".rapid-view-manage-datasets-section").data([0]),W=Z.enter().append("div").attr("class","modal-section rapid-view-manage-datasets-section");W.append("div").attr("class","rapid-view-manage-datasets-status"),W.append("div").attr("class","rapid-view-manage-datasets"),Z=Z.merge(W).call(_),M.selectAll(".modal-section.buttons").data([0]).enter().append("div").attr("class","modal-section buttons").append("button").attr("class","button ok-button action").on("click",d).text(t.t("confirm.okay"))}function _(M){let k=M.selectAll(".rapid-view-manage-datasets-status"),F=M.selectAll(".rapid-view-manage-datasets"),B=t.systems.storage.getItem("rapid-internal-feature.previewDatasets")==="true",U=t.services.esri;if(!U||Array.isArray(c)&&!c.length){F.classed("hide",!0),k.classed("hide",!1).text(t.t("rapid_feature_toggle.esri.no_datasets"));return}if(!c){F.classed("hide",!0),k.classed("hide",!1).text(t.t("rapid_feature_toggle.esri.fetching_datasets")),k.append("br"),k.append("img").attr("class","rapid-view-manage-datasets-spinner").attr("src",t.asset("img/loader-black.gif")),U.startAsync().then(()=>U.loadDatasetsAsync()).then(ne=>{let ee=new Set;Object.values(ne).forEach(te=>{te.groupCategories.forEach(ie=>{ee.add(ie.toLowerCase().replace("/categories/",""))})}),B||ee.delete("preview");let re=Array.from(ee).sort().map(te=>{let ie={title:te,value:te};return te==="preview"&&(ie.display=`${te} <span class="rapid-view-manage-dataset-beta beta"></span>`),ie});return s.data(re),c=Object.values(ne).filter(te=>B||!te.groupCategories.some(ie=>ie.toLowerCase()==="/categories/preview")),c}).then(()=>o.call(g));return}F.classed("hide",!1),k.classed("hide",!0);let z=0;c.forEach(ne=>{let ee=(ne.title||"").toLowerCase(),re=(ne.snippet||"").toLowerCase();if(b(ne)){ne.filtered=!1,++z;return}if(a&&ee.indexOf(a)===-1&&re.indexOf(a)===-1){ne.filtered=!0;return}if(l&&!ne.groupCategories.some(te=>te.toLowerCase()===`/categories/${l}`)){ne.filtered=!0;return}ne.filtered=++z>n});let Z=F.selectAll(".rapid-view-manage-dataset").data(c,ne=>ne.id);Z.exit().remove();let W=Z.enter().append("div").attr("class","rapid-view-manage-dataset"),q=W.append("div").attr("class","rapid-view-manage-dataset-label");q.append("div").attr("class","rapid-view-manage-dataset-name"),q.append("div").attr("class","rapid-view-manage-dataset-license").append("a").attr("class","rapid-view-manage-dataset-link").attr("target","_blank").attr("href",ne=>ne.itemURL).text(t.t("rapid_feature_toggle.esri.more_info")).call(Ye("#rapid-icon-out-link","inline"));let Q=q.selectAll(".rapid-view-manage-dataset-featured").data(ne=>ne.groupCategories.filter(ee=>ee.toLowerCase()==="/categories/featured")).enter().append("div").attr("class","rapid-view-manage-dataset-featured");Q.append("span").text("\u2B50"),Q.append("span").text(t.t("rapid_feature_toggle.esri.featured")),q.selectAll(".rapid-view-manage-dataset-beta").data(ne=>ne.groupCategories.filter(ee=>ee.toLowerCase()==="/categories/preview")).enter().append("div").attr("class","rapid-view-manage-dataset-beta beta").attr("title",t.t("rapid_poweruser_features.beta")),q.append("div").attr("class","rapid-view-manage-dataset-snippet"),q.append("button").attr("class","rapid-view-manage-dataset-action").on("click",E),W.append("div").attr("class","rapid-view-manage-dataset-thumb").append("img").attr("class","rapid-view-manage-dataset-thumbnail").attr("src",ne=>`https://openstreetmap.maps.arcgis.com/sharing/rest/content/items/${ne.id}/info/${ne.thumbnail}?w=400`),Z=Z.merge(W).sort(v).classed("hide",ne=>ne.filtered),Z.selectAll(".rapid-view-manage-dataset-name").html(ne=>T(a,ne.title)),Z.selectAll(".rapid-view-manage-dataset-snippet").html(ne=>T(a,ne.snippet)),Z.selectAll(".rapid-view-manage-dataset-action").classed("secondary",ne=>b(ne)).text(ne=>b(ne)?t.t("rapid_feature_toggle.esri.remove"):t.t("rapid_feature_toggle.esri.add_to_map"));let le=c.filter(ne=>!ne.filtered).length,de=z>n&&le===n?">":"";o.selectAll(".rapid-view-manage-filter-results").text(t.t("rapid_feature_toggle.esri.datasets_found",{num:`${de}${le}`}))}function v(M,k){let F=b(M),O=b(k),B=M.groupCategories.some(z=>z.toLowerCase()==="/categories/featured"),U=k.groupCategories.some(z=>z.toLowerCase()==="/categories/featured");return F&&!O?-1:O&&!F?1:B&&!U?-1:U&&!B?1:M.title.localeCompare(k.title)}function E(M,k){let F=i.datasets,O=F.get(k.id);if(O)O.added=!O.added;else{let z=t.services.esri;z&&z.loadLayerAsync(k.id);let Z=k.groupCategories.some(le=>le.toLowerCase()==="/categories/preview"),W=k.groupCategories.some(le=>le.toLowerCase()==="/categories/buildings"),q=i.colors,Q=F.size%q.length,V={id:k.id,beta:Z,added:!0,enabled:!0,conflated:!1,service:"esri",color:q[Q],label:k.title,license_markdown:t.t("rapid_feature_toggle.esri.license_markdown")};if(k.extent&&(V.extent=new mt(k.extent[0],k.extent[1])),W){V.conflated=!0,V.service="mapwithai";let le=F.get("msBuildings");le&&(le.enabled=!1)}F.set(k.id,V)}let B=t.systems.urlhash,U=[...i.datasets.values()].filter(z=>z.added&&z.enabled).map(z=>z.id).join(",");B.setParam("datasets",U.length?U:null),o.call(g),t.enter("browse"),t.systems.map.immediateRedraw()}function b(M){let k=i.datasets.get(M.id);return k==null?void 0:k.added}function T(M,k){let F=k;if(M){let O=new RegExp("("+A(M)+")","gi");F=F.replace(O,"<mark>$1</mark>")}return F}function A(M){return M.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}return $t(m,r,"on")}function gx(t,e,i){let r=t.systems.l10n,s=t.systems.rapid,n=ye(null),o=ye(null),a,l;function c(b){let T=s.datasets.get(b.id);return T==null?void 0:T.enabled}function d(b,T){let A=s.datasets.get(T.id);if(A){A.enabled=!A.enabled;let M=t.systems.urlhash,k=[...s.datasets.values()].filter(F=>F.added&&F.enabled).map(F=>F.id).join(",");M.setParam("datasets",k.length?k:null),t.scene().dirtyLayers("rapid"),t.enter("browse")}}function m(b,T){let A=s.datasets.get(b);if(A){A.color=T,t.scene().dirtyLayers("rapid"),t.systems.map.immediateRedraw(),o.call(v);let M=t.mode;if((M==null?void 0:M.id)==="select"){let k=new Map(M.selectedData);t.enter("select",{selection:k})}}}function g(){t.scene().toggleLayers("rapid"),o.call(v)}function _(b){b.shiftKey&&b.key===r.t("map_data.layers.ai-features.key")&&g()}return function(T){n=Ts(T),n.select(".modal").attr("class","modal rapid-modal"),a=mx(t,n).on("done",()=>o.call(v)),l=lx(t,n).on("change",m),o=n.select(".content").append("div").attr("class","rapid-stack").on("keypress",_),o.call(v),o.selectAll(".ok-button").node().focus(),i.on("ai_feature_toggle",()=>o.call(v))};function v(b){let T=t.scene().layers.get("rapid");if(!T)return;let A=b.selectAll(".rapid-toggle-all").data([0]),M=A.enter().append("div").attr("class","modal-section rapid-checkbox rapid-toggle-all"),k=M.append("div").attr("class","rapid-feature-label-container");k.append("div").attr("class","rapid-feature-label").html(r.t("rapid_feature_toggle.toggle_all",{rapidicon:gi("#rapid-logo-rapid-wordmark","logo-rapid")})),k.append("span").attr("class","rapid-feature-hotkey").html("("+e+")");let F=M.append("div").attr("class","rapid-checkbox-inputs").append("label").attr("class","rapid-checkbox-label");F.append("input").attr("type","checkbox").attr("class","rapid-feature-checkbox").on("click",g),F.append("div").attr("class","rapid-checkbox-custom"),A=A.merge(M),A.selectAll(".rapid-feature-checkbox").property("checked",T.enabled);let O=b.selectAll(".rapid-datasets-container").data([0]),B=O.enter().append("div").attr("class","rapid-datasets-container");O.merge(B).call(E);let U=b.selectAll(".rapid-manage-datasets").data([0]).enter().append("div").attr("class","modal-section rapid-checkbox rapid-manage-datasets").on("click",()=>t.container().call(a));U.append("div").attr("class","rapid-feature-label-container").append("div").attr("class","rapid-feature-label").text(r.t("rapid_feature_toggle.view_manage_datasets")),U.append("div").attr("class","rapid-checkbox-inputs").append("div").attr("class","rapid-checkbox-label").call(Ye(r.isRTL()?"#rapid-icon-backward":"#rapid-icon-forward","icon-30")),b.selectAll(".modal-section.buttons").data([0]).enter().append("div").attr("class","modal-section buttons").append("button").attr("class","button ok-button action").on("click",()=>n.remove()).text(r.t("confirm.okay"))}function E(b){let A=t.systems.storage.getItem("rapid-internal-feature.previewDatasets")==="true",M=[...s.datasets.values()].filter(z=>z.added&&(A||!z.beta)),k=t.scene().layers.get("rapid");if(!k)return;let F=b.selectAll(".rapid-checkbox-dataset").data(M,z=>z.id);F.exit().remove();let O=F.enter().append("div").attr("class","modal-section rapid-checkbox rapid-checkbox-dataset");O.append("div").attr("class","rapid-feature").each((z,Z,W)=>{let q=ye(W[Z]),Q=q.append("div").attr("class","rapid-feature-label-container");Q.append("div").attr("class","rapid-feature-label").text(z.label||z.id),z.beta&&Q.append("div").attr("class","rapid-feature-label-beta beta").attr("title",r.t("rapid_poweruser_features.beta")),z.description&&(Q.append("div").attr("class","rapid-feature-label-divider"),Q.append("div").attr("class","rapid-feature-description").text(z.description)),z.license_markdown&&(Q.append("div").attr("class","rapid-feature-label-divider"),Q.append("div").attr("class","rapid-feature-license").html(er.parse(z.license_markdown)),Q.select("p a").attr("target","_blank")),q.append("div").attr("class","rapid-feature-extent-container").each((V,le,de)=>{let ne=ye(de[le]);V.extent&&V.extent.area()<1e4?ne.append("a").attr("href","#").text(r.t("rapid_feature_toggle.center_map")).on("click",ee=>{ee.preventDefault(),t.systems.map.extent(V.extent)}):ne.text(r.t("rapid_feature_toggle.worldwide"))})});let B=O.append("div").attr("class","rapid-checkbox-inputs");B.append("label").attr("class","rapid-colorpicker-label");let U=B.append("label").attr("class","rapid-checkbox-label");U.append("input").attr("type","checkbox").attr("class","rapid-feature-checkbox").on("click",d),U.append("div").attr("class","rapid-checkbox-custom"),F=F.merge(O).classed("disabled",!k.enabled),F.selectAll(".rapid-colorpicker-label").attr("disabled",k.enabled?null:!0).call(l),F.selectAll(".rapid-checkbox-label").classed("disabled",!k.enabled),F.selectAll(".rapid-feature-checkbox").property("checked",c).attr("disabled",k.enabled?null:!0)}}function yx(t){let e=t.systems.rapid,i=t.systems.storage,r=t.systems.urlhash,s=["previewDatasets","tagnosticRoadCombine","tagSources","showAutoFix","allowLargeEdits"],n=ye(null),o=ye(null);t.systems.urlhash.on("hashchange",a);function a(g,_){let v=!0;if(g&&_&&(v=g.get("poweruser")!==_.get("poweruser")),!v)return;if(r.getParam("poweruser")==="true")for(let b of s){let T=i.getItem(`rapid-internal-feature.was.${b}`);T&&(i.setItem(`rapid-internal-feature.${b}`,T),i.removeItem(`rapid-internal-feature.was.${b}`))}else for(let b of s){let T=i.getItem(`rapid-internal-feature.${b}`);T&&(i.setItem(`rapid-internal-feature.was.${b}`,T),i.removeItem(`rapid-internal-feature.${b}`))}}function l(g){return i.getItem(`rapid-internal-feature.${g}`)==="true"}function c(g,_){let v=i.getItem(`rapid-internal-feature.${_}`)==="true";if(v=!v,i.setItem(`rapid-internal-feature.${_}`,v),_==="previewDatasets"&&!v){for(let E of e.datasets.values())E.beta&&(E.added=!1,E.enabled=!1);t.enter("browse"),t.systems.map.immediateRedraw()}}return g=>{a(),n=Ts(g),n.select(".modal").attr("class","modal rapid-modal"),o=n.select(".content").append("div").attr("class","rapid-stack poweruser"),o.call(d),o.selectAll(".ok-button").node().focus()};function d(g){let _=g.selectAll(".modal-section-heading").data([0]).enter().append("div").attr("class","modal-section-heading");_.append("h3").attr("class","modal-heading").html(t.t("rapid_poweruser_features.heading.label")),_.append("div").attr("class","modal-heading-desc").text(t.t("rapid_poweruser_features.heading.description")).append("span").attr("class","smile").text("\u{1F60E}");let v=g.selectAll(".rapid-features-container").data([0]),E=v.enter().append("div").attr("class","rapid-features-container");v.merge(E).call(m),g.selectAll(".modal-section.buttons").data([0]).enter().append("div").attr("class","modal-section buttons").append("button").attr("class","button ok-button action").on("click",()=>n.remove()).text(t.t("confirm.okay"))}function m(g){let _=g.selectAll(".rapid-checkbox-feature").data(s,T=>T),v=_.enter().append("div").attr("class","modal-section rapid-checkbox rapid-checkbox-feature");v.append("div").attr("class","rapid-feature").each((T,A,M)=>{let k=ye(M[A]);k.append("div").attr("class","rapid-feature-label").text(F=>t.t(`rapid_poweruser_features.${F}.label`)),k.append("div").attr("class","rapid-feature-description").text(F=>t.t(`rapid_poweruser_features.${F}.description`))});let b=v.append("div").attr("class","rapid-checkbox-inputs").append("label").attr("class","rapid-checkbox-label");b.append("input").attr("type","checkbox").attr("class","rapid-feature-checkbox").on("click",c),b.append("div").attr("class","rapid-checkbox-custom"),_=_.merge(v),_.selectAll(".rapid-feature-checkbox").property("checked",l)}}function _x(t){return function(e){e.append("a").attr("href","https://mapwith.ai/doc/license/MapWithAILicense.pdf").attr("target","_blank").text(t.t("rapid_feature_license"))}}function xx(t){let i=!1;return function(s){let n=t.systems.storage;if((parseInt(n.getItem("sawWhatsNewVersion"),10)||0)===20230823)return;let a=Ts(s);a.select(".modal").attr("class","modal rapid-modal modal-splash modal-whatsnew");let l=a.select(".content");l.append("div").attr("class","modal-section").append("h2").html(t.t("rapid_whats_new.welcome",{rapidicon:gi("#rapid-logo-rapid-wordmark","pre-text rapid")}));let c=l.append("div").attr("class","modal-section body").html(er.parse(t.t("rapid_whats_new.text",{rapidicon:gi("#rapid-logo-rapid-wordmark","pre-text rapid"),bugicon:gi("#rapid-icon-bug","bugnub")})));c.append("div").attr("class","whatsnew-images").append("img").attr("class","whatsnew-image").attr("src",t.asset("img/rapid-v21-splash.jpg")),c.selectAll("p a").attr("target","_blank");let g=l.append("div").attr("class","modal-section rapid-checkbox dontshow").attr("id","dontshowagain").append("label").attr("class","rapid-checkbox-label dontshow");g.append("span").attr("class","rapid-checkbox-text").text(t.t("rapid_whats_new.dontshowagain")),g.append("input").attr("type","checkbox").attr("class","rapid-feature-checkbox").property("checked",i).on("click",E=>{i=E.target.checked}),g.append("div").attr("class","rapid-checkbox-custom"),l.append("div").attr("class","modal-actions").append("button").attr("class","whats-new-okay").append("div").text(t.t("rapid_whats_new.ok")).on("click",()=>{i&&n.setItem("sawWhatsNewVersion",20230823),a.close()})}}function vx(t){return function(e){if(!t.systems.edits.hasRestorableChanges())return;let i=Ts(e,!0);i.select(".modal").attr("class","modal fillL");let r=i.select(".content");r.append("div").attr("class","modal-section").append("h3").text(t.t("restore.heading")),r.append("div").attr("class","modal-section").append("p").text(t.t("restore.description"));let s=r.append("div").attr("class","modal-actions"),n=s.append("button").attr("class","restore").on("click",()=>{t.systems.edits.restore(),i.remove()});n.append("svg").attr("class","logo logo-restore").append("use").attr("xlink:href","#rapid-logo-restore"),n.append("div").text(t.t("restore.restore"));let o=s.append("button").attr("class","reset").on("click",()=>{t.systems.edits.clearSaved(),i.remove()});o.append("svg").attr("class","logo logo-reset").append("use").attr("xlink:href","#rapid-logo-reset"),o.append("div").text(t.t("restore.reset")),n.node().focus()}}function bx(t){let e=t.projection,i=180,r=8,s=t.systems.l10n,n=!s.usesMetric();function o(l,c){let d=(c[1]+l[1])/2,m=n?3.28084:1,g=K3(c[0]-l[0],d)*m,_={dist:0,px:0,text:""},v;n?v=[528e4,528e3,52800,5280,500,50,5,1]:v=[5e6,5e5,5e4,5e3,500,50,5,1];for(let b=0;b<v.length;b++){let T=v[b];if(g>=T){_.dist=Math.floor(g/T)*T;break}else _.dist=+g.toFixed(2)}let E=Dn(_.dist/m,d);return _.px=Math.round(e.project([l[0]+E,l[1]])[0]),_.text=s.displayLength(_.dist/m,n),_}function a(l){let c=t.systems.map.dimensions,d=e.invert([0,c[1]]),m=e.invert([i,c[1]]),g=o(d,m),_=s.isRTL();l.select(".scale-path").attr("d","M0.5,0.5v"+r+"h"+g.px+"v-"+r),l.select(".scale-text").style(_?"right":"left",g.px+16+"px").html(g.text)}return function(l){function c(){n=!n,l.call(a)}l.append("svg").attr("class","scale").on("click",c).append("g").attr("transform","translate(10,11)").append("path").attr("class","scale-path"),l.append("div").attr("class","scale-text"),t.systems.map.on("draw",()=>{window.requestIdleCallback(()=>a(l))})}}function wx(t){var e=Gs(),i=0,r,s=ye(null),n;function o(l){l.select(".modal").classed("modal-shortcuts",!0);var c=l.select(".content");c.append("div").attr("class","modal-section").append("h3").html(t.tHtml("shortcuts.title")),t.systems.data.getDataAsync("shortcuts").then(m=>{n=m,c.call(a)}).catch(m=>console.error(m))}function a(l){if(n){var c=l.selectAll(".wrapper").data([0]),d=c.enter().append("div").attr("class","wrapper modal-section"),m=d.append("div").attr("class","tabs-bar"),g=d.append("div").attr("class","shortcuts-list");c=c.merge(d);var _=m.selectAll(".tab").data(n),v=_.enter().append("a").attr("class","tab").attr("href","#").on("click",function(B,U){B.preventDefault();var z=n.indexOf(U);i=z,a(l)});v.append("span").html(function(B){return t.tHtml(B.text)}),c.selectAll(".tab").classed("active",function(B,U){return U===i});var E=g.selectAll(".shortcut-tab").data(n),b=E.enter().append("div").attr("class",function(B){return"shortcut-tab shortcut-tab-"+B.tab}),T=b.selectAll(".shortcut-column").data(function(B){return B.columns}).enter().append("table").attr("class","shortcut-column"),A=T.selectAll(".shortcut-row").data(function(B){return B.rows}).enter().append("tr").attr("class","shortcut-row"),M=A.filter(function(B){return!B.shortcuts});M.append("td"),M.append("td").attr("class","shortcut-section").append("h3").html(function(B){return t.tHtml(B.text)});var k=A.filter(function(B){return B.shortcuts}),F=k.append("td").attr("class","shortcut-keys"),O=F.filter(function(B){return B.modifiers});O.selectAll("kbd.modifier").data(function(B){return e.os==="win"&&B.text==="shortcuts.editing.commands.redo"?["\u2318"]:e.os!=="mac"&&B.text==="shortcuts.browsing.display_options.fullscreen"?[]:B.modifiers}).enter().each(function(){var B=ye(this);B.append("kbd").attr("class","modifier").html(function(U){return Li.display(t,U)}),B.append("span").html("+")}),F.selectAll("kbd.shortcut").data(function(B){var U=B.shortcuts;return e.os==="win"&&B.text==="shortcuts.editing.commands.redo"?U=["Y"]:e.os!=="mac"&&B.text==="shortcuts.browsing.display_options.fullscreen"&&(U=["F11"]),U=U.map(z=>Li.display(t,z.indexOf(".")!==-1?t.t(z):z)),Ei(U).map(function(z){return{shortcut:z,separator:B.separator,suffix:B.suffix,rapid:B.rapid}})}).enter().each(function(B,U,z){var Z=ye(this),W=B.shortcut.toLowerCase().match(/(.*).click/);W&&W[1]?Z.call(Ye("#rapid-walkthrough-mouse-"+W[1],"operation")):B.shortcut.toLowerCase()==="long-press"?Z.call(Ye("#rapid-walkthrough-longpress","longpress operation")):B.shortcut.toLowerCase()==="tap"?Z.call(Ye("#rapid-walkthrough-tap","tap operation")):Z.append("kbd").attr("class","shortcut").html(function(q){return q.shortcut}),U<z.length-1?Z.append("span").html(B.separator||"\xA0"+t.tHtml("shortcuts.or")+"\xA0"):U===z.length-1&&B.suffix&&Z.append("span").html(B.suffix),B.rapid&&Z.append("svg").lower().attr("class","icon logo-rapid").append("use").attr("xlink:href","#rapid-logo-rapid").attr("class","#rapid-logo-rapid")}),F.filter(function(B){return B.gesture}).each(function(){var B=ye(this);B.append("span").html("+"),B.append("span").attr("class","gesture").html(function(U){return t.tHtml(U.gesture)})}),k.append("td").attr("class","shortcut-desc").html(function(B){return B.text?t.tHtml(B.text):"\xA0"}),c.selectAll(".shortcut-tab").style("display",function(B,U){return U===i?"flex":"none"})}}return function(l,c){s=l,c?(r=Ts(l),r.call(o)):t.keybinding().on([t.t("shortcuts.toggle.key"),"?"],function(){t.container().selectAll(".modal-shortcuts").size()?r&&(r.close(),r=null):(r=Ts(s),r.call(o))})}}function Ex(t){var e=Z_(t),i=ep(t),r=j4(t),s=K4(t),n=Y4(t),o=Q4(t),a=J4(t),l,c=!1,d=!1,m=!1,g=!1;function _(v){var E=t.container(),b=240,T,A,M;v.style("min-width",b+"px").style("max-width","400px").style("width","33.3333%");var k=v.append("div").attr("class","sidebar-resizer").on("pointerdown.sidebar-resizer",U),F,O,B;function U(le){if(!F&&!("button"in le&&le.button!==0)){F=le.pointerId||"mouse",O=le.clientX,B=cm(E.node()),M=cm(k.node())(le)[0]-1,T=v.node().getBoundingClientRect().width,A=E.node().getBoundingClientRect().width;var de=T/A*100;v.style("width",de+"%").style("max-width","85%"),k.classed("dragging",!0),ye(window).on("touchmove.sidebar-resizer",function(ne){ne.preventDefault()},{passive:!1}).on("pointermove.sidebar-resizer",z).on("pointerup.sidebar-resizer pointercancel.sidebar-resizer",Z)}}function z(le){if(F===(le.pointerId||"mouse")){le.preventDefault();var de=le.clientX-O;O=le.clientX;var ne=t.systems.l10n.isRTL(),ee=ne?0:1,re=ne?"margin-right":"margin-left",te=B(le)[0]-M;T=ne?A-te:te;var ie=v.classed("collapsed"),oe=T<b;if(v.classed("collapsed",oe),oe)ie||(v.style(re,"-400px").style("width","400px"),t.systems.ui.resize([(T-de)*ee,0]));else{var fe=T/A*100;v.style(re,null).style("width",fe+"%"),ie?t.systems.ui.resize([-T*ee,0]):t.systems.ui.resize([-de*ee,0])}}}function Z(le){F===(le.pointerId||"mouse")&&(F=null,k.classed("dragging",!1),ye(window).on("touchmove.sidebar-resizer",null).on("pointermove.sidebar-resizer",null).on("pointerup.sidebar-resizer pointercancel.sidebar-resizer",null))}var W=v.append("div").attr("class","feature-list-pane").call(z_(t)),q=v.append("div").attr("class","inspector-hidden inspector-wrap"),Q=function(le){if(t.container().selectAll(".feature-list-item button").classed("hover",!1),t.selectedIDs().length>1&&le&&le.length){var de=t.container().selectAll(".feature-list-item button").filter(function(ne){return le.indexOf(ne)!==-1});de.empty()||de.classed("hover",!0)}};_.hoverModeSelect=ol(Q,200);function V(le){var te;var de=le&&le.length&&le[0];if(de&&de.__featurehash__)d=!0,_.show(r.datum(de)),v.selectAll(".sidebar-component").classed("inspector-hover",!0);else if(de&&de.__fbid__)c=!0,_.show(i.datum(de)),v.selectAll(".sidebar-component").classed("inspector-hover",!0).classed("rapid-inspector-fadein",!0);else if(de instanceof Nr){if(((te=t.mode)==null?void 0:te.id)==="drag-note")return;m=!0;var ne=t.services.osm;ne&&(de=ne.getNote(de.id)),_.show(s.note(de)),v.selectAll(".sidebar-component").classed("inspector-hover",!0)}else if(de instanceof Er){g=!0;var ee=t.services[de.service];ee&&(de=ee.getError(de.id));var re;de.service==="keepRight"?re=o:de.service==="osmose"?re=a:re=n,t.container().selectAll(".qaItem."+de.service).classed("hover",function(ie){return ie.id===de.id}),_.show(re.error(de)),v.selectAll(".sidebar-component").classed("inspector-hover",!0)}else!l&&de instanceof Dt&&t.hasEntity(de)?(W.classed("inspector-hidden",!0),q.classed("inspector-hidden",!1).classed("inspector-hover",!0),(!e.entityIDs()||!jn(e.entityIDs(),[de.id])||e.state()!=="hover")&&(e.state("hover").entityIDs([de.id]).newFeature(!1),q.call(e))):l?(c||d||m||g)&&(c=!1,m=!1,d=!1,g=!1,t.container().selectAll(".layer-ai-features .hover").classed("hover",!1),t.container().selectAll(".note").classed("hover",!1),t.container().selectAll(".qaItem").classed("hover",!1),_.hide()):(W.classed("inspector-hidden",!1),q.classed("inspector-hidden",!0),e.state("hide"))}_.hover=ol(V,200),_.intersects=function(le){var de=v.node().getBoundingClientRect();return le.intersects(new mt(t.projection.invert([0,de.height]),t.projection.invert([de.width,0])))},_.select=function(le,de){if(_.hide(),le&&le.length){var ne=le.length===1&&t.entity(le[0]);if(ne&&de&&v.classed("collapsed")){var ee=ne.extent(t.graph());_.expand(_.intersects(ee))}W.classed("inspector-hidden",!0),q.classed("inspector-hidden",!1).classed("inspector-hover",!1),e.state("select").entityIDs(le).newFeature(de),q.call(e)}else e.state("hide")},_.showPresetList=function(){e.showList()},_.show=function(le,de){W.classed("inspector-hidden",!0),q.classed("inspector-hidden",!0),l&&l.remove(),l=v.append("div").attr("class","sidebar-component").call(le,de)},_.hide=function(){W.classed("inspector-hidden",!1),q.classed("inspector-hidden",!0),l&&l.remove(),l=null},_.expand=function(le){v.classed("collapsed")&&_.toggle(le)},_.collapse=function(le){v.classed("collapsed")||_.toggle(le)},_.toggle=function(le){if(!t.inIntro){var de=v.classed("collapsed"),ne=!de,ee=t.systems.l10n.isRTL(),re=ee?0:1,te=ee?"margin-right":"margin-left";T=v.node().getBoundingClientRect().width,v.style("width",T+"px");var ie,oe,fe;ne?(ie=fe=0,oe=-T):(ie=fe=-T,oe=0),ne||v.classed("collapsed",ne),v.transition().style(te,oe+"px").tween("panner",function(){var Re=en(ie,oe);return function(He){var Je=fe-Math.round(Re(He));fe=fe-Je,t.systems.ui.resize(le?void 0:[Je*re,0])}}).on("end",function(){ne&&v.classed("collapsed",ne);let Re=t.pixi.view.parentNode;if(t.pixi.resize(Re.clientWidth,Re.clientHeight),!ne){var He=E.node().getBoundingClientRect().width,Je=T/He*100;v.style(te,null).style("width",Je+"%")}})}},k.on("dblclick",function(le){le.preventDefault(),le.sourceEvent&&le.sourceEvent.preventDefault(),_.toggle()})}return _.showPresetList=function(){},_.hover=function(){},_.hover.cancel=function(){},_.intersects=function(){},_.select=function(){},_.show=function(){},_.hide=function(){},_.expand=function(){},_.collapse=function(){},_.toggle=function(){},_}function Tx(t){let e;function i(s){var a;s.preventDefault();let n=t.services.osm;if(!n||t.inIntro||((a=t.mode)==null?void 0:a.id)==="save"||t.systems.edits.hasChanges()&&!window.confirm(t.t("source_switch.lose_changes")))return;let o=ye(this).classed("live");o=!o,t.enter("browse"),t.systems.edits.clearSaved(),t.resetAsync().then(()=>(ye(this).html(o?t.tHtml("source_switch.live"):t.tHtml("source_switch.dev")).classed("live",o).classed("chip",o),n.switchAsync(o?e[0]:e[1])))}let r=function(s){s.append("a").attr("href","#").html(t.tHtml("source_switch.live")).attr("class","live chip").on("click",i)};return r.keys=function(s){return arguments.length?(e=s,r):e},r}function Sx(t){var e=t.services.osm;return function(i){var r=i.append("img").attr("src",t.asset("img/loader-black.gif")).style("opacity",0);e&&e.on("loading.spinner",function(){r.transition().style("opacity",1)}).on("loaded.spinner",function(){r.transition().style("opacity",0)})}}function $O(t){return e=>{let i=t.systems.storage;if(t.systems.edits.hasRestorableChanges())return;let r="",s=i("sawPrivacyVersion"),n=!i("sawSplash");if(s!==t.privacyVersion&&(r=t.t("splash.privacy_update"),n=!0),!n)return;i.setItem("sawSplash",!0),i.setItem("sawPrivacyVersion",t.privacyVersion),t.systems.data.getDataAsync("intro_graph");let a=Ts(e);a.select(".modal").attr("class","modal-splash modal");let l=a.select(".content").append("div").attr("class","fillL");l.append("div").attr("class","modal-section").append("h3").text(t.t("splash.welcome"));let c=l.append("div").attr("class","modal-section");c.append("p").html(t.tHtml("splash.text",{version:t.version,website:'<a target="_blank" href="https://github.com/openstreetmap/iD/blob/develop/CHANGELOG.md#whats-new">changelog</a>',github:'<a target="_blank" href="https://github.com/openstreetmap/iD/issues">github.com</a>'})),c.append("p").html(t.tHtml("splash.privacy",{updateMessage:r,privacyLink:'<a target="_blank" href="https://github.com/openstreetmap/iD/blob/release/PRIVACY.md">'+t.t("splash.privacy_policy")+"</a>"}));let d=l.append("div").attr("class","modal-actions"),m=d.append("button").attr("class","walkthrough").on("click",()=>{t.container().call(mc(t)),a.close()});m.append("svg").attr("class","logo logo-walkthrough").append("use").attr("xlink:href","#rapid-logo-walkthrough"),m.append("div").html(t.tHtml("splash.walkthrough"));let g=d.append("button").attr("class","start-editing").on("click",a.close);g.append("svg").attr("class","logo logo-features").append("use").attr("xlink:href","#rapid-logo-features"),g.append("div").html(t.tHtml("splash.start")),a.select("button.close").attr("class","hide")}}function Ax(t){let e=t.services.osm;return function(i){if(!e)return;function r(s,n){if(i.html(""),s){if(n==="connectionSwitched")return;if(n==="rateLimited")i.html(t.tHtml("osm_api_status.message.rateLimit")).append("a").attr("href","#").attr("class","api-status-login").attr("target","_blank").call(Ye("#rapid-icon-out-link","inline")).append("span").html(t.tHtml("login")).on("click.login",o=>{o.preventDefault(),e.authenticate()});else{let o=ol(()=>{t.loadTiles(t.projection),e.reloadApiStatus()},2e3);i.html(t.tHtml("osm_api_status.message.error")+" ").append("a").attr("href","#").html(t.tHtml("osm_api_status.retry")).on("click.retry",a=>{a.preventDefault(),o()})}}else n==="readonly"?i.html(t.tHtml("osm_api_status.message.readonly")):n==="offline"&&i.html(t.tHtml("osm_api_status.message.offline"));i.attr("class","api-status "+(s?"error":n))}e.on("apiStatusChange.uiStatus",r),t.systems.edits.on("storage_error",()=>{i.html(t.tHtml("osm_api_status.message.local_storage_full")),i.attr("class","api-status error")}),window.setInterval(()=>{e.reloadApiStatus()},9e4),e.reloadApiStatus()}}var HO=Yi(P9(),1);function $S(t){return typeof t!="string"?"":HO.default.remove(t.replace(/&/g,"and").replace(/(|i)/ig,"i").replace(/[\s\-=_!"#%'*{},.\/:;?\(\)\[\]@\\$\^*+<>~`\u00a1\u00a7\u00b6\u00b7\u00bf\u037e\u0387\u055a-\u055f\u0589\u05c0\u05c3\u05c6\u05f3\u05f4\u0609\u060a\u060c\u060d\u061b\u061e\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0830-\u083e\u085e\u0964\u0965\u0970\u0af0\u0df4\u0e4f\u0e5a\u0e5b\u0f04-\u0f12\u0f14\u0f85\u0fd0-\u0fd4\u0fd9\u0fda\u104a-\u104f\u10fb\u1360-\u1368\u166d\u166e\u16eb-\u16ed\u1735\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u1805\u1807-\u180a\u1944\u1945\u1a1e\u1a1f\u1aa0-\u1aa6\u1aa8-\u1aad\u1b5a-\u1b60\u1bfc-\u1bff\u1c3b-\u1c3f\u1c7e\u1c7f\u1cc0-\u1cc7\u1cd3\u2000-\u206f\u2cf9-\u2cfc\u2cfe\u2cff\u2d70\u2e00-\u2e7f\u3001-\u3003\u303d\u30fb\ua4fe\ua4ff\ua60d-\ua60f\ua673\ua67e\ua6f2-\ua6f7\ua874-\ua877\ua8ce\ua8cf\ua8f8-\ua8fa\ua92e\ua92f\ua95f\ua9c1-\ua9cd\ua9de\ua9df\uaa5c-\uaa5f\uaade\uaadf\uaaf0\uaaf1\uabeb\ufe10-\ufe16\ufe19\ufe30\ufe45\ufe46\ufe49-\ufe4c\ufe50-\ufe52\ufe54-\ufe57\ufe5f-\ufe61\ufe68\ufe6a\ufe6b\ufeff\uff01-\uff03\uff05-\uff07\uff0a\uff0c\uff0e\uff0f\uff1a\uff1b\uff1f\uff20\uff3c\uff61\uff64\uff65]+/g,"").toLowerCase())}function HS(t,e,i){let r=Object.assign({},t.strings),s=Object.assign({},e[t.type]),n=new RegExp(/(\{\w+\})/,"gi");if(i){if(r.community){let d=$S(r.community);r.community=i(`_communities.${d}`)}["name","description","extendedDescription"].forEach(d=>{s[d]&&(s[d]=i(`_defaults.${t.type}.${d}`)),r[d]&&(r[d]=i(`${t.id}.${d}`))})}let o={account:t.account,community:r.community,signupUrl:r.signupUrl,url:r.url};o.signupUrl||(o.signupUrl=l(r.signupUrl||s.signupUrl)),o.url||(o.url=l(r.url||s.url));let a={name:l(r.name||s.name),url:l(r.url||s.url),signupUrl:l(r.signupUrl||s.signupUrl),description:l(r.description||s.description),extendedDescription:l(r.extendedDescription||s.extendedDescription)};return a.nameHTML=c(a.url,a.name),a.urlHTML=c(a.url),a.signupUrlHTML=c(a.signupUrl),a.descriptionHTML=l(r.description||s.description,!0),a.extendedDescriptionHTML=l(r.extendedDescription||s.extendedDescription,!0),a;function l(d,m){if(!d)return;let g=d;for(let v in o){let E=`{${v}}`,b=new RegExp(E,"g");if(b.test(g)){let T=o[v];if(T)m&&(v==="signupUrl"||v==="url")&&(T=c(T)),g=g.replace(b,T);else throw new Error(`Cannot resolve token: ${E}`)}}let _=g.match(n);if(_)throw new Error(`Cannot resolve tokens: ${_}`);return m&&t.type==="reddit"&&(g=g.replace(/(\/r\/\w+\/*)/i,v=>c(a.url,v))),g}function c(d,m){if(d)return m=m||d,`<a target="_blank" href="${d}">${m}</a>`}}var rp=null;function Cx(t){let i=Pt("cancel"),r,s;n();function n(){let d=t.systems.data;return Promise.all([d.getDataAsync("oci_features"),d.getDataAsync("oci_resources"),d.getDataAsync("oci_defaults")]).then(m=>{if(rp)return rp;let g=t.systems.locations;m[0]&&Array.isArray(m[0].features)&&g.mergeCustomGeoJSON(m[0]);let _=Object.values(m[1].resources);return _.length?g.mergeLocationSets(_).then(()=>(rp={resources:_,defaults:m[2].defaults},rp)):(rp={resources:[],defaults:m[2].defaults},rp)})}function o(d){if(!d)return;let m=d.trim();if(!m)return;/Z$/.test(m)||(m+="Z");let g=new Date(m);return new Date(g.toUTCString().slice(0,25))}function a(d){let m=d.append("div").attr("class","header fillL");m.append("h3").html(t.tHtml("success.just_edited")),m.append("button").attr("class","close").on("click",()=>i.call("cancel")).call(Ye("#rapid-icon-close"));let g=d.append("div").attr("class","body save-success fillL"),_=g.append("div").attr("class","save-summary");_.append("h3").html(t.tHtml("success.thank_you"+(s?"_location":""),{where:s})),_.append("p").html(t.tHtml("success.help_html")).append("a").attr("class","link-out").attr("target","_blank").attr("href",t.t("success.help_link_url")).call(Ye("#rapid-icon-out-link","inline")).append("span").html(t.tHtml("success.help_link_text"));let v=t.services.osm;if(!v)return;let E=v.changesetURL(r.id),T=_.append("table").attr("class","summary-table").append("tr").attr("class","summary-row");T.append("td").attr("class","cell-icon summary-icon").append("a").attr("target","_blank").attr("href",E).append("svg").attr("class","logo-small").append("use").attr("xlink:href","#rapid-logo-osm");let A=T.append("td").attr("class","cell-detail summary-detail");A.append("a").attr("class","cell-detail summary-view-on-osm").attr("target","_blank").attr("href",E).html(t.tHtml("success.view_on_osm")),A.append("div").html(t.tHtml("success.changeset_id",{changeset_id:`<a href="${E}" target="_blank">${r.id}</a>`})),n().then(M=>{let k=t.systems.map.center(),O=t.systems.locations.locationSetsAt(k),B=[];M.resources.forEach(U=>{let z=O[U.locationSetID];if(!z)return;let Z=W=>t.tHtml(`community.${W}`);U.resolved=HS(U,M.defaults,Z),B.push({area:z,order:U.order||0,resource:U})}),B.sort((U,z)=>U.area-z.area||z.order-U.order),g.call(l,B.map(U=>U.resource))})}function l(d,m){let g=d.append("div").attr("class","save-communityLinks");g.append("h3").html(t.tHtml("success.like_osm"));let E=g.append("table").attr("class","community-table").selectAll(".community-row").data(m).enter().append("tr").attr("class","community-row");E.append("td").attr("class","cell-icon community-icon").append("a").attr("target","_blank").attr("href",T=>T.resolved.url).append("svg").attr("class","logo-small").append("use").attr("xlink:href",T=>`#community-${T.type}`),E.append("td").attr("class","cell-detail community-detail").each(c),g.append("div").attr("class","community-missing").html(t.tHtml("success.missing")).append("a").attr("class","link-out").attr("target","_blank").call(Ye("#rapid-icon-out-link","inline")).attr("href","https://github.com/osmlab/osm-community-index/issues").append("span").html(t.tHtml("success.tell_us"))}function c(d){let m=ye(this),g=d.id;m.append("div").attr("class","community-name").html(d.resolved.nameHTML),m.append("div").attr("class","community-description").html(d.resolved.descriptionHTML),(d.resolved.extendedDescriptionHTML||d.languageCodes&&d.languageCodes.length)&&m.append("div").call(a0(t,`community-more-${d.id}`).expanded(!1).checkPreference(!1).label(t.tHtml("success.more")).content(v));let _=(d.events||[]).map(b=>(b.date=o(b.when),b)).filter(b=>{let T=b.date.getTime(),A=new Date().setHours(0,0,0,0);return!isNaN(T)&&T>=A}).sort((b,T)=>b.date<T.date?-1:b.date>T.date?1:0).slice(0,2);_.length&&m.append("div").call(a0(t,`community-events-${d.id}`).expanded(!1).checkPreference(!1).label(t.tHtml("success.events")).content(E)).select(".hide-toggle").append("span").attr("class","badge-text").html(_.length);function v(b){let A=b.selectAll(".community-more").data([0]).enter().append("div").attr("class","community-more");if(d.resolved.extendedDescriptionHTML&&A.append("div").attr("class","community-extended-description").html(d.resolved.extendedDescriptionHTML),d.languageCodes&&d.languageCodes.length){let M=d.languageCodes.map(k=>t.systems.l10n.languageName(k)).join(", ");A.append("div").attr("class","community-languages").html(t.tHtml("success.languages",{languages:M}))}}function E(b){let M=b.append("div").attr("class","community-events").selectAll(".community-event").data(_).enter().append("div").attr("class","community-event");M.append("div").attr("class","community-event-name").append("a").attr("target","_blank").attr("href",k=>k.url).html(k=>{let F=k.name;return k.i18n&&k.id&&(F=t.t(`community.${g}.events.${k.id}.name`,{default:F})),F}),M.append("div").attr("class","community-event-when").html(k=>{let F={weekday:"short",day:"numeric",month:"short",year:"numeric"};(k.date.getHours()||k.date.getMinutes())&&(F.hour="numeric",F.minute="numeric");let O=t.systems.l10n.localeCode();return k.date.toLocaleString(O,F)}),M.append("div").attr("class","community-event-where").html(k=>{let F=k.where;return k.i18n&&k.id&&(F=t.t(`community.${g}.events.${k.id}.where`,{default:F})),F}),M.append("div").attr("class","community-event-description").html(k=>{let F=k.description;return k.i18n&&k.id&&(F=t.t(`community.${g}.events.${k.id}.description`,{default:F})),F})}}return a.changeset=function(d){return arguments.length?(r=d,a):r},a.location=function(d){return arguments.length?(s=d,a):s},$t(a,i,"on")}function VO(t){let e={id:"download_osc",label:t.t("download_osc.title")},i=null,r=null,s=0;function n(){return s===0}function o(d){d.preventDefault();let m=t.systems.edits;if(!t.inIntro&&m.hasChanges()){let g=m.changes(Qu(m.difference())),_=new ia,v=ru.stringify(_.osmChangeJXON(g));c(v,"change.osc")}}function a(){if(!r)return;let d=t.systems.edits.difference().summary().size;d!==s&&(s=d,r&&r.title(t.t(s>0?"download_osc.help":"download_osc.no_changes")),l())}function l(){i&&i.classed("disabled",n())}function c(d,m){let g=document.createElement("a");g.style.display="none",document.body.appendChild(g),g.href=window.URL.createObjectURL(new Blob([d])),g.setAttribute("download",m),g.click(),window.URL.revokeObjectURL(g.href),document.body.removeChild(g)}return e.install=function(d){i&&r||(r=Ft(t).placement("bottom").title(t.t("download_osc.no_changes")),i=d.append("button").attr("class","downloadOsc disabled bar-button").on("click",o).call(r),i.call(Ye("#rapid-icon-download-osc")),a(),t.systems.edits.on("change",a),t.on("modechange",l))},e.uninstall=function(){!i&&!r||(t.systems.edits.off("change",a),t.off("modechange",l),i=null,r=null)},e}function jO(t){let e=t.systems.presets,i,r,s={id:"draw_modes",label:t.tHtml("toolbar.add_feature")},n=[{id:"add-point",title:t.tHtml("modes.add_point.title"),button:"point",description:t.tHtml("modes.add_point.description"),preset:e.item("point"),key:"1"},{id:"draw-line",title:t.tHtml("modes.add_line.title"),button:"line",description:t.tHtml("modes.add_line.description"),preset:e.item("line"),key:"2"},{id:"draw-area",title:t.tHtml("modes.add_area.title"),button:"area",description:t.tHtml("modes.add_area.description"),preset:e.item("area"),key:"3"}];function o(){if(!r)return;let a=r.selectAll("button.add-button").data(n,c=>c.id);a.exit().remove();let l=a.enter().append("button").attr("class",c=>`${c.id} add-button bar-button`).on("click.mode-buttons",(c,d)=>{var g;if(!t.editable()||d.id==="add-area")return;let m=(g=t.mode)==null?void 0:g.id;/^draw/.test(m)||(d.id===m?t.enter("browse"):t.enter(d.id))}).call(Ft(t).placement("bottom").title(c=>c.description).keys(c=>[c.key]).scrollContainer(t.container().select(".top-toolbar")));l.each((c,d,m)=>{ye(m[d]).call(Ye(`#rapid-icon-${c.button}`))}),l.append("span").attr("class","label").html(c=>c.title),(a.enter().size()||a.exit().size())&&t.systems.ui.checkOverflow(".top-toolbar",!0),a=a.merge(l).classed("disabled",()=>!t.editable()).classed("active",c=>{var d;return((d=t.mode)==null?void 0:d.id)===c.id})}return s.install=function(a){r=a.append("div").attr("class","joined").style("display","flex"),i=Gr(o,500,{leading:!0,trailing:!0}),n.forEach(l=>{t.keybinding().on(l.key,()=>{var c;t.editable()&&(l.id===((c=t.mode)==null?void 0:c.id)?t.enter("browse"):t.enter(l.id))})}),t.systems.map.on("draw",i),t.on("modechange",o),o()},s.uninstall=function(){n.forEach(a=>{t.keybinding().off(a.key)}),i.cancel(),t.systems.map.off("draw",i),t.off("modechange",o),r=null},s}function XO(t){let e={id:"notes",label:t.tHtml("modes.add_note.label")},i={id:"add-note",title:t.tHtml("modes.add_note.title"),button:"note",description:t.tHtml("modes.add_note.description"),key:t.t("modes.add_note.key")};function r(){var l;return(l=t.scene().layers.get("notes"))==null?void 0:l.enabled}function s(){var l;return((l=t.mode)==null?void 0:l.id)!=="save"}let n,o;function a(){if(!o)return;let l=r()?[i]:[],c=o.selectAll("button.add-button").data(l,m=>m.id);c.exit().remove();let d=c.enter().append("button").attr("class",m=>`${m.id} add-button bar-button`).on("click.notes",(m,g)=>{var v;if(s()){var _=(v=t.mode)==null?void 0:v.id;/^draw/.test(_)||(g.id===_?t.enter("browse"):t.enter(g.id))}}).call(Ft(t).placement("bottom").title(m=>m.description).keys(m=>[m.key]).scrollContainer(t.container().select(".top-toolbar")));d.each((m,g,_)=>{ye(_[g]).call(Ye(m.icon||`#rapid-icon-${m.button}`))}),(c.enter().size()||c.exit().size())&&t.systems.ui.checkOverflow(".top-toolbar",!0),c=c.merge(d).classed("disabled",()=>!r()).classed("active",m=>{var g;return((g=t.mode)==null?void 0:g.id)===m.id})}return e.install=function(l){o=l,n=Gr(a,500,{leading:!0,trailing:!0}),t.keybinding().on(i.key,()=>{var c;s()&&(i.id===((c=t.mode)==null?void 0:c.id)?t.enter("browse"):t.enter(i.id))}),t.systems.map.on("draw",n),t.on("modechange",a),a()},e.uninstall=function(){n.cancel(),t.keybinding().off(i.key),t.off("modechange",a),t.systems.map.off("draw",n),o=null},e}function WO(t){let e={id:"save",label:t.tHtml("save.title")},i=Li("\u2318S"),r=0,s=null,n=null;function o(){var g;return((g=t.mode)==null?void 0:g.id)==="save"}function a(){return r===0||t.inIntro||o()}function l(g){g.preventDefault(),!t.inIntro&&!o()&&t.systems.edits.hasChanges()&&t.enter("save")}function c(){let g;return r===0?null:r<=50?(g=r/50,Rc("#fff","#ff8")(g)):(g=Math.min((r-50)/50,1),Rc("#ff8","#f88")(g))}function d(){if(!s||!n)return;let g=t.systems.edits.difference().summary().size;g!==r&&(r=g,n&&n.title(t.tHtml(r>0?"save.help":"save.no_changes")).keys([i]),s.classed("disabled",a()).style("background",c(r)),s.select("span.count").html(r))}function m(){!s||!n||(s.classed("disabled",a()),o()&&s.call(n.hide))}return e.install=function(g){s&&n||(n=Ft(t).placement("bottom").title(t.tHtml("save.no_changes")).keys([i]).scrollContainer(t.container().select(".top-toolbar")),s=g.append("button").attr("class","save disabled bar-button").on("click",_=>{l(_)}).call(n),s.call(Ye("#rapid-icon-save")),s.append("span").attr("class","count").attr("aria-hidden","true").html("0"),d(),t.keybinding().on(i,l,!0),t.systems.edits.on("change",d),t.on("modechange",m))},e.uninstall=function(){!s&&!n||(t.keybinding().off(i,!0),t.systems.edits.off("change",d),t.off("modechange",m),s=null,n=null)},e}function qO(t){let e=t.systems.l10n,i={id:"sidebar_toggle",label:e.tHtml("toolbar.inspect")};return i.install=function(r){r.append("button").attr("class","bar-button").on("click",()=>t.systems.ui.sidebar.toggle()).call(Ft(t).placement("bottom").title(e.tHtml("sidebar.tooltip")).keys([e.t("sidebar.key")]).scrollContainer(t.container().select(".top-toolbar"))).call(Ye("#rapid-icon-sidebar-"+(e.isRTL()?"right":"left")))},i}function YO(t){let e=t.systems.l10n,i=e.isRTL(),r=null,s=null,n,o={id:"undo_redo",label:e.tHtml("toolbar.undo_redo")},a=[{id:"undo",key:Li("\u2318Z"),action:()=>t.undo(),annotation:()=>t.systems.edits.undoAnnotation(),icon:i?"redo":"undo"},{id:"redo",key:Li("\u2318\u21E7Z"),action:()=>t.redo(),annotation:()=>t.systems.edits.redoAnnotation(),icon:i?"undo":"redo"}];function l(d){d&&c()}function c(){!r||!s||r.classed("disabled",d=>!t.editable()||!d.annotation()).each((d,m,g)=>{let _=ye(g[m]);_.select(".tooltip.in").empty()||_.call(s.updateContent)})}return o.install=function(d){if(!(r&&s)){s=Ft(t).placement("bottom").title(m=>{let g=m.annotation();return g&&g.description&&(g=g.description),g?e.t(`${m.id}.tooltip`,{action:g}):e.t(`${m.id}.nothing`)}).keys(m=>[m.key]).scrollContainer(t.container().select(".top-toolbar")),r=d.selectAll("button").data(a).enter().append("button").attr("class",m=>`disabled ${m.id}-button bar-button`).on("click",(m,g)=>{m.preventDefault();let _=g.annotation();t.editable()&&_&&g.action()}).call(s),r.each((m,g,_)=>{ye(_[g]).call(Ye(`#rapid-icon-${m.icon}`))}),n=Gr(c,500,{leading:!0,trailing:!0});for(let m of a)t.keybinding().on(m.key,g=>{g.preventDefault(),t.editable()&&m.action()});t.systems.map.on("draw",n),t.systems.edits.on("change",l),t.on("modechange",c)}},o.uninstall=function(){if(!(!r&&!s)){for(let d of a)t.keybinding().off(d.key);n.cancel(),t.systems.map.off("draw",n),t.systems.edits.off("change",l),t.off("modechange",c),s=null,r=null}},o}function ZO(t){let e=t.systems.map,i=t.systems.urlhash,r=Pt("ai_feature_toggle"),s="\u21E7"+t.t("map_data.layers.ai-features.key"),n=gx(t,Li(s),r),o=yx(t),a,l={id:"rapid_features",label:t.t("toolbar.rapid_features")};function c(){if(!t.scene)return!1;let v=e.scene.layers.get("rapid");return v==null?void 0:v.enabled}function d(){e.scene.toggleLayers("rapid"),r.call("ai_feature_toggle")}function m(){t.container().call(n)}function g(){t.container().call(o)}function _(){if(!a)return;let v=i.getParam("poweruser")==="true";a.attr("class",v?"joined":null);let E=a.selectAll(".rapid-features").data([0]),b=E.enter().append("button").attr("class","bar-button rapid-features").attr("tabindex",-1).on("click",m).call(Ft(t).placement("bottom").title(t.t("shortcuts.browsing.display_options.rapid_features_data")).keys(s));b.append("svg").attr("class","logo-rapid").append("use").attr("xlink:href","#rapid-logo-rapid-wordmark"),E.merge(b).classed("layer-off",!c());let T=a.selectAll(".rapid-poweruser-features").data(v?[0]:[]);T.exit().remove(),T.enter().append("button").attr("class","bar-button rapid-poweruser-features").attr("tabindex",-1).on("click",g).call(Ft(t).placement("bottom").title(t.t("rapid_poweruser_features.heading.label"))).append("div").attr("class","beta")}return l.install=v=>{t.keybinding().on(Li(s),E=>{E.preventDefault(),E.stopPropagation(),d()}),i.on("hashchange",_),e.scene.on("layerchange",_),t.on("modechange",_),a=v.append("div").style("display","flex"),_()},l.uninstall=function(){t.keybinding().off(Li(s)),i.off("hashchange",_),e.scene.off("layerchange",_),t.off("modechange",_),a=null},l}function Ix(t){let e=qO(t),i=ZO(t),r=jO(t),s=XO(t),n=YO(t),o=WO(t),a=VO(t);function l(){var m;return(m=t.scene().layers.get("notes"))==null?void 0:m.enabled}function c(m){let g=[e,"spacer",r,i];l()&&g.push("spacer",s),g.push("spacer",n,o),t.systems.urlhash.initialHashParams.get("support_download_osc")==="true"&&g.push(a);let v=m.selectAll(".toolbar-item").data(g,T=>T.id||T);v.exit().each(T=>{T.uninstall&&T.uninstall()}).remove();let b=v.enter().append("div").attr("class",T=>{let A="toolbar-item "+(T.id||T).replace("_","-");return T.klass&&(A+=" "+T.klass),A}).filter(T=>T!=="spacer");b.append("div").attr("class","item-content").each((T,A,M)=>{ye(M[A]).call(T.install,m)}),b.append("div").attr("class","item-label").html(T=>T.label)}function d(m){t.scene().on("layerchange",()=>c(m)),c(m)}return d}var QO=null,VS=!1,jS=!1;function kx(t){let e=t.version,i=e.match(/\d+\.\d+\.\d+.*/),r=t.systems.storage;return QO===null&&i!==null&&(r.getItem("sawVersion")?(jS=!1,VS=r.getItem("sawVersion")!==e&&e.indexOf("-")===-1):(jS=!0,VS=!0),r.setItem("sawVersion",e),QO=e),function(n){n.append("a").attr("target","_blank").attr("tabindex",-1).attr("href","https://github.com/facebook/Rapid/blob/main/CHANGELOG.md").text(e),VS&&!jS&&n.append("a").attr("class","badge").attr("target","_blank").attr("tabindex",-1).attr("href","https://github.com/facebook/Rapid/blob/main/CHANGELOG.md").call(Ye("#maki-gift")).call(Ft(t).title(t.tHtml("version.whats_new",{version:e})).placement("top").scrollContainer(t.container().select(".main-footer-wrap")))}}function Mx(t){let e=t.systems.l10n,i=[{id:"zoom-in",icon:"rapid-icon-plus",title:e.t("zoom.in"),action:r,isDisabled:()=>!t.systems.map.canZoomIn(),disabledTitle:e.t("zoom.disabled.in"),key:"+"},{id:"zoom-out",icon:"rapid-icon-minus",title:e.t("zoom.out"),action:s,isDisabled:()=>!t.systems.map.canZoomOut(),disabledTitle:e.t("zoom.disabled.out"),key:"-"}];function r(a){a.shiftKey||(a.preventDefault(),t.systems.map.zoomIn())}function s(a){a.shiftKey||(a.preventDefault(),t.systems.map.zoomOut())}function n(a){a.shiftKey||(a.preventDefault(),t.systems.map.zoomInFurther())}function o(a){a.shiftKey||(a.preventDefault(),t.systems.map.zoomOutFurther())}return function(l){let c=Ft(t).placement(e.isRTL()?"right":"left").title(_=>_.isDisabled()?_.disabledTitle:_.title).keys(_=>[_.key]),d,m=l.selectAll("button").data(i).enter().append("button").attr("class",_=>_.id).on("pointerup",_=>d=_.pointerType).on("click",(_,v)=>{v.isDisabled()?(d==="touch"||d==="pen")&&t.systems.ui.flash.duration(2e3).iconName(`#${v.icon}`).iconClass("disabled").label(v.disabledTitle)():v.action(_),d=null}).call(c);m.each((_,v,E)=>{ye(E[v]).call(Ye(`#${_.icon}`,"light"))}),$i.plusKeys.forEach(_=>{t.keybinding().on([_],r),t.keybinding().on([Li("\u2325"+_)],n)}),$i.minusKeys.forEach(_=>{t.keybinding().on([_],s),t.keybinding().on([Li("\u2325"+_)],o)});function g(){m.classed("disabled",_=>_.isDisabled()).each((_,v,E)=>{let b=ye(E[v]);b.select(".tooltip.in").empty()||b.call(c.updateContent)})}g(),t.systems.map.on("draw",g)}}function Px(t){let e=t.systems.l10n,i=e.t("inspector.zoom_to.key"),r,s;return function(o){let a=Ft(t).placement(e.isRTL()?"right":"left").title(()=>c()?e.t("inspector.zoom_to.no_selection"):e.t("inspector.zoom_to.title")).keys([i]),l=o.append("button").on("pointerup",g=>r=g.pointerType).on("click",d).call(Ye("#rapid-icon-framed-dot","light")).call(a);t.keybinding().on(i,d),t.on("modechange",m),m();function c(){var g;return!s&&!((g=t.mode)!=null&&g.extent)}function d(g){var E;g&&g.preventDefault();let _=(E=t.mode)==null?void 0:E.extent,v=t.systems.map;if(s)v.transformEase(s),s=null;else if(_){s=v.transform();let[b,T]=v.dimensions,A=v.extentZoom(_,[b/2,T/2]);v.centerZoomEase(_.center(),A)}else(r==="touch"||r==="pen")&&t.systems.ui.flash.duration(2e3).iconName("#rapid-icon-framed-dot").iconClass("disabled").label(e.t("inspector.zoom_to.no_selection"))();r=null}function m(){s=null,l.classed("disabled",c()),l.select(".tooltip.in").empty()||l.call(a.updateContent)}}}function Rx(t){let e=t.systems.l10n,i=t.systems.storage,r=t.systems.imagery,s=tr(t,"background-display-options").label(e.tHtml("background.display_options")).disclosureContent(g),n=i.getItem("background-opacity"),o=0,a=3,l=["brightness","contrast","saturation","sharpness"],c={brightness:n!==null?+n:1,contrast:1,saturation:1,sharpness:1};function d(_,v,E){return Math.max(v,Math.min(_,E))}function m(_,v){v=d(v,o,a),c[_]=v,_==="brightness"?(i.setItem("background-opacity",v),r.brightness=v):_==="contrast"?r.contrast=v:_==="saturation"?r.saturation=v:_==="sharpness"&&(r.sharpness=v),s.reRender()}function g(_){let v=_.selectAll(".display-options-container").data([0]),E=v.enter().append("div").attr("class","display-options-container controls-list"),b=E.selectAll(".display-control").data(l).enter().append("div").attr("class",A=>`display-control display-control-${A}`);b.append("h5").html(A=>e.tHtml(`background.${A}`)).append("span").attr("class",A=>`display-option-value display-option-value-${A}`);let T=b.append("div").attr("class","control-wrap");T.append("input").attr("class",A=>`display-option-input display-option-input-${A}`).attr("type","range").attr("min",o).attr("max",a).attr("step","0.05").on("input",(A,M)=>{m(M,A.target.value||1)}),T.append("button").attr("title",e.t("background.reset")).attr("class",A=>`display-option-reset display-option-reset-${A}`).on("click",(A,M)=>{A.button===0&&m(M,1)}).call(Ye("#rapid-icon-"+(e.isRTL()?"redo":"undo"))),E.append("a").attr("class","display-option-resetlink").attr("href","#").html(e.tHtml("background.reset_all")).on("click",A=>{A.preventDefault();for(let M of l)m(M,1)}),v=E.merge(v),v.selectAll(".display-option-input").property("value",A=>c[A]),v.selectAll(".display-option-value").text(A=>Math.floor(c[A]*100)+"%"),v.selectAll(".display-option-reset").classed("disabled",A=>c[A]===1),E.size()&&c.brightness!==1&&(r.brightness=c.brightness)}return s}function Dx(t){let e=t.systems.storage,i=Pt("change");function r(s){let n={template:e.getItem("background-custom-template")},o=Object.assign({},n),a=Ch(t,s).okButton();a.classed("settings-modal settings-custom-background",!0),a.select(".modal-section.header").append("h3").html(t.tHtml("settings.custom_background.header"));let l="settings.custom_background.instructions",c=t.t(`${l}.info`),d=t.t(`${l}.wms.tokens_label`),m=t.t(`${l}.wms.tokens.proj`),g=t.t(`${l}.wms.tokens.wkid`),_=t.t(`${l}.wms.tokens.dimensions`),v=t.t(`${l}.wms.tokens.bbox`),E=t.t(`${l}.tms.tokens_label`),b=t.t(`${l}.tms.tokens.xyz`),T=t.t(`${l}.tms.tokens.flipped_y`),A=t.t(`${l}.tms.tokens.switch`),M=t.t(`${l}.tms.tokens.quadtile`),k=t.t(`${l}.tms.tokens.scale_factor`),F=t.t("example"),O=er.parse(`
${c}
&nbsp;<br>
&nbsp;<br>
#### ${d}
* ${m}
* ${g}
* ${_}
* ${v}
&nbsp;<br>
&nbsp;<br>
#### ${E}
* ${b}
* ${T}
* ${A}
* ${M}
* ${k}
&nbsp;<br>
&nbsp;<br>
#### ${F}
* \`https://{switch:a,b,c}.tile.openstreetmap.org/{zoom}/{x}/{y}.png\`
`),B=a.select(".modal-section.message-text");B.append("div").attr("class","instructions-template").html(O),B.append("textarea").attr("class","field-template").attr("placeholder",t.t("settings.custom_background.template.placeholder")).call(Ri).property("value",o.template);let U=a.select(".modal-section.buttons");U.insert("button",".ok-button").attr("class","button cancel-button secondary-action").html(t.tHtml("confirm.cancel")),U.select(".cancel-button").on("click.cancel",z),U.select(".ok-button").on("click.save",Z);function z(){B.select(".field-template").property("value",n.template),e.setItem("background-custom-template",n.template),this.blur(),a.close()}function Z(){o.template=B.select(".field-template").property("value"),e.setItem("background-custom-template",o.template),this.blur(),a.close(),i.call("change",this,o)}}return $t(r,i,"on")}function Fx(t){let e=t.systems.map,i=t.systems.l10n,r=t.systems.imagery,s=t.systems.storage,n=tr(t,"background-list").label(i.t("background.backgrounds")).disclosureContent(_),o=ye(null),a=r.getSource("custom"),l=Dx(t).on("change",M),c=s.getItem("background-favorites"),d=c?JSON.parse(c):{};function m(){return s.getItem("background-last-used-toggle")}function g(U){return!U.overlay}function _(U){let z=U.selectAll(".layer-background-list").data([0]);o=z.enter().append("ul").attr("class","layer-list layer-background-list").attr("dir","auto").merge(z);let Z=U.selectAll(".bg-extras-list").data([0]).enter().append("ul").attr("class","layer-list bg-extras-list"),W=Z.append("li").attr("class","minimap-toggle-item").append("label").call(Ft(t).title(i.t("background.minimap.tooltip")).keys([i.t("background.minimap.key")]).placement("top"));W.append("input").attr("type","checkbox").on("change",le=>{le.preventDefault(),u0.toggle()}),W.append("span").text(i.t("background.minimap.description"));let q=Z.append("li").attr("class","three-d-map-toggle-item").append("label").call(Ft(t).title(i.t("background.3dmap.tooltip")).keys([Li("\u2318"+i.t("background.3dmap.key"))]).placement("top"));q.append("input").attr("type","checkbox").on("change",le=>{le.preventDefault(),c0.toggle()}),q.append("span").text(i.t("background.3dmap.description"));let Q=Z.append("li").attr("class","background-panel-toggle-item").append("label").call(Ft(t).title(i.t("background.panel.tooltip")).keys([Li("\u2318\u21E7"+i.t("info_panels.background.key"))]).placement("top"));Q.append("input").attr("type","checkbox").on("change",le=>{le.preventDefault(),t.systems.ui.info.toggle("background")}),Q.append("span").text(i.t("background.panel.description"));let V=Z.append("li").attr("class","location-panel-toggle-item").append("label").call(Ft(t).title(i.t("background.location_panel.tooltip")).keys([Li("\u2318\u21E7"+i.t("info_panels.location.key"))]).placement("top"));V.append("input").attr("type","checkbox").on("change",le=>{le.preventDefault(),t.systems.ui.info.toggle("location")}),V.append("span").text(i.t("background.location_panel.description")),U.selectAll(".imagery-faq").data([0]).enter().append("div").attr("class","imagery-faq").append("a").attr("target","_blank").call(Ye("#rapid-icon-out-link","inline")).attr("href","https://github.com/openstreetmap/iD/blob/develop/FAQ.md#how-can-i-report-an-issue-with-background-imagery").append("span").text(i.t("background.imagery_problem_faq")),o.call(b)}function v(U){U.each((z,Z,W)=>{let q=ye(W[Z]).select("label"),Q=q.select("span"),V=Z<W.length/2?"bottom":"top",le=Q.property("clientWidth")!==Q.property("scrollWidth");q.call(Ft(t).destroyAny),z.id===m()?q.call(Ft(t).placement(V).title("<div>"+i.t("background.switch")+"</div>").keys([Li("\u2318"+i.t("background.key"))])):(z.description||le)&&q.call(Ft(t).placement(V).title(z.description||z.name))})}function E(U,z){return d[U.id]&&!d[z.id]?-1:d[z.id]&&!d[U.id]?1:U.best&&!z.best?-1:z.best&&!U.best?1:_f(U.area,z.area)||Tu(U.name,z.name)||0}function b(U){let z=r.sources(e.extent(),e.zoom()).filter(g),Z=U.selectAll("li").data(z,Q=>Q.id);Z.exit().remove();let W=Z.enter().append("li").classed("layer-custom",Q=>Q.id==="custom").classed("best",Q=>Q.best),q=W.append("label");q.append("input").attr("type","radio").attr("name","layers").on("change",A),q.append("span").attr("class","background-name").text(Q=>Q.name),W.append("button").attr("class","background-favorite-button").classed("active",Q=>!!d[Q.id]).attr("tabindex",-1).call(Ye("#rapid-icon-favorite")).on("click",(Q,V)=>{d[V.id]?(ye(Q.currentTarget).classed("active",!1),delete d[V.id]):(ye(Q.currentTarget).classed("active",!0),d[V.id]=!0),s.setItem("background-favorites",JSON.stringify(d)),ye(Q.currentTarget.parentElement).transition().duration(300).ease(cd).style("background-color","orange").transition().duration(300).ease(cd).style("background-color",null),U.selectAll("li").sort(E),U.call(T)}),W.filter(Q=>Q.id==="custom").append("button").attr("class","layer-browse").call(Ft(t).title(i.t("settings.custom_background.tooltip")).placement(i.isRTL()?"right":"left")).on("click",k).call(Ye("#rapid-icon-more")),W.filter(Q=>Q.best).selectAll("label").append("span").attr("class","best").call(Ft(t).title(i.t("background.best_imagery")).placement("bottom")).call(Ye("#rapid-icon-best-background")),U.selectAll("li").sort(E),U.call(T)}function T(U){function z(Z){return r.showsLayer(Z)}U.selectAll("li").classed("active",z).classed("switch",Z=>Z.id===m()).call(v).selectAll("input").property("checked",z)}function A(U,z){if(z.id==="custom"&&!z.template)return k();let Z=r.baseLayerSource();Z instanceof Il&&s.setItem("background-last-used-toggle",Z.id),s.setItem("background-last-used",z.id),r.baseLayerSource(z)}function M(U){U!=null&&U.template?(a.template=U.template,A(void 0,a)):(a.template="",A(void 0,r.getSource("none")))}function k(U){U.preventDefault(),t.container().call(l)}function F(U){let z=r.sources(e.extent(),e.zoom()).filter(g);z.sort(E);let Z=r.baseLayerSource(),W=z.indexOf(Z);if(W===-1)return;let q=(W+U+z.length)%z.length,Q=z[q];Q.id==="custom"&&!Q.template&&(q=(q+U+z.length)%z.length,Q=z[q]),A(void 0,Q)}function O(){F(1)}function B(){F(-1)}return r.on("imagerychange",()=>o.call(T)),e.on("draw",Gr(()=>{window.requestIdleCallback(n.reRender)},1e3,{leading:!0,trailing:!0})),t.keybinding().on(i.t("background.next_background.key"),O).on(i.t("background.previous_background.key"),B),n}function Lx(t){let e=t.systems.l10n,i=t.systems.imagery,r=tr(t,"background-offset").label(e.tHtml("background.fix_misalignment")).disclosureContent(d),s=[["top",[0,-.5]],["left",[-.5,0]],["right",[.5,0]],["bottom",[0,.5]]];function n(){let m=M8(i.offset),g=+m[0].toFixed(2),_=+m[1].toFixed(2);t.container().selectAll(".nudge-inner-rect").select("input").classed("error",!1).property("value",`${g},${_}`),t.container().selectAll(".nudge-reset").classed("disabled",g===0&&_===0)}function o(){i.offset=[0,0],n()}function a(m){i.nudge(m,t.systems.map.zoom()),n()}function l(m){let g=ye(m.target),_=g.node().value;if(_==="")return o();if(_=_.replace(/;/g,",").split(",").map(v=>!isNaN(v)&&v),_.length!==2||!_[0]||!_[1]){g.classed("error",!0);return}i.offset=k8(_),n()}function c(m){if(m.button!==0)return;let g=[m.clientX,m.clientY],_=m.pointerId||"mouse";t.container().append("div").attr("class","nudge-surface"),ye(window).on("pointermove.drag-bg-offset",v).on("pointerup.drag-bg-offset",E).on("pointercancel.drag-bg-offset",E);function v(b){if(_!==(b.pointerId||"mouse"))return;let T=[b.clientX,b.clientY],A=[-(g[0]-T[0])/4,-(g[1]-T[1])/4];g=T,a(A)}function E(b){_===(b.pointerId||"mouse")&&b.button===0&&(t.container().selectAll(".nudge-surface").remove(),ye(window).on(".drag-bg-offset",null))}}function d(m){let _=m.selectAll(".nudge-container").data([0]).enter().append("div").attr("class","nudge-container");_.append("div").attr("class","nudge-instructions").html(e.tHtml("background.offset"));let v=_.append("div").attr("class","nudge-controls-wrap");v.append("div").attr("class","nudge-outer-rect").on("pointerdown",c).append("div").attr("class","nudge-inner-rect").append("input").attr("type","text").on("change",l),v.append("div").selectAll("button").data(s).enter().append("button").attr("class",b=>`${b[0]} nudge`).attr("tabindex",-1).on("click",(b,T)=>a(T[1])),v.append("button").attr("title",e.t("background.reset")).attr("class","nudge-reset disabled").on("click",b=>{b.preventDefault(),o()}).call(Ye("#rapid-icon-"+(e.isRTL()?"redo":"undo"))),n()}return i.on("imagerychange",n),r}function KO(t){let e=t.systems.imagery,i=t.systems.rapid,r=tr(t,"grid-display-options").label(t.t("background.grid.grids")).disclosureContent(a),s=[{numSplit:0,name:t.t("background.grid.no_grid")},{numSplit:2,name:t.t("background.grid.n_by_n",{num:2})},{numSplit:3,name:t.t("background.grid.n_by_n",{num:3})},{numSplit:4,name:t.t("background.grid.n_by_n",{num:4})},{numSplit:5,name:t.t("background.grid.n_by_n",{num:5})},{numSplit:6,name:t.t("background.grid.n_by_n",{num:6})}];function n(l,c){l.preventDefault(),e.numGridSplits=c.numSplit}function o(l){let c=l.selectAll(".layer-grid-list").data([0]),m=c.enter().append("ul").attr("class","layer-list layer-grid-list").attr("dir","auto").merge(c).selectAll("li").data(s,v=>v.name),_=m.enter().insert("li",".custom-gridsopt").attr("class","gridsopt").append("label");_.append("input").attr("type","radio").attr("name","grids").property("checked",v=>v.numSplit===e.numGridSplits).on("change",n),_.append("span").text(v=>v.name),m.exit().remove()}function a(l){let c=ye(".section-grid-display-options");if(i.on("taskchanged",()=>{i.isTaskRectangular()&&(c.classed("hide",!1),l.call(o))}),!i.isTaskRectangular()){c.classed("hide",!0);return}}return r}function Nx(t){let e=t.systems.map,i=t.systems.l10n,r=t.systems.imagery,s=tr(t,"overlay-list").label(i.tHtml("background.overlays")).disclosureContent(m),n=ye(null);function o(g){g.each((_,v,E)=>{let b=ye(E[v]).select("label"),T=b.select("span"),A=v<E.length/2?"bottom":"top",M=T.property("clientWidth")!==T.property("scrollWidth");b.call(Ft(t).destroyAny),(_.description||M)&&b.call(Ft(t).placement(A).title(_.description||_.name))})}function a(g){function _(v){return r.showsLayer(v)}g.selectAll("li").classed("active",_).call(o).selectAll("input").property("checked",_)}function l(g){let _=r.sources(e.extent(),e.zoom()).filter(d),v=g.selectAll("li").data(_,A=>A.name);v.exit().remove();let b=v.enter().append("li").append("label");b.append("input").attr("type","checkbox").attr("name","layers").on("change",c),b.append("span").html(A=>A.label),g.selectAll("li").sort(T),g.call(a);function T(A,M){return A.best&&!M.best?-1:M.best&&!A.best?1:_f(A.area,M.area)||Tu(A.name,M.name)||0}}function c(g,_){g.preventDefault(),r.toggleOverlayLayer(_),n.call(a)}function d(g){return!!g.overlay}function m(g){let _=g.selectAll(".layer-overlay-list").data([0]);n=_.enter().append("ul").attr("class","layer-list layer-overlay-list").attr("dir","auto").merge(_),n.call(l)}return r.on("imagerychange",()=>s.reRender),e.on("draw",Gr(()=>{window.requestIdleCallback(s.reRender)},1e3,{leading:!0,trailing:!0})),s}function Ox(t){var e=Fl(t,"background").key(t.t("background.key")).label(t.tHtml("background.title")).description(t.tHtml("background.description")).iconName("rapid-icon-layers").sections([Fx(t),Nx(t),KO(t),Rx(t),Lx(t)]);return e}function Bx(t){let e=t.systems.l10n,i=[["help",["welcome","open_data_h","open_data","before_start_h","before_start","open_source_h","open_source","open_source_help"]],["overview",["navigation_h","navigation_drag","navigation_zoom","features_h","features","nodes_ways"]],["editing",["select_h","select_left_click","select_right_click","select_space","multiselect_h","multiselect","multiselect_shift_click","multiselect_lasso","undo_redo_h","undo_redo","save_h","save","save_validation","upload_h","upload","backups_h","backups","keyboard_h","keyboard"]],["feature_editor",["intro","definitions","type_h","type","type_picker","fields_h","fields_all_fields","fields_example","fields_add_field","tags_h","tags_all_tags","tags_resources"]],["points",["intro","add_point_h","add_point","add_point_finish","move_point_h","move_point","delete_point_h","delete_point","delete_point_command"]],["lines",["intro","add_line_h","add_line","add_line_draw","add_line_continue","add_line_finish","modify_line_h","modify_line_dragnode","modify_line_addnode","connect_line_h","connect_line","connect_line_display","connect_line_drag","connect_line_tag","disconnect_line_h","disconnect_line_command","move_line_h","move_line_command","move_line_connected","delete_line_h","delete_line","delete_line_command"]],["areas",["intro","point_or_area_h","point_or_area","add_area_h","add_area_command","add_area_draw","add_area_continue","add_area_finish","square_area_h","square_area_command","modify_area_h","modify_area_dragnode","modify_area_addnode","delete_area_h","delete_area","delete_area_command"]],["relations",["intro","edit_relation_h","edit_relation","edit_relation_add","edit_relation_delete","maintain_relation_h","maintain_relation","relation_types_h","multipolygon_h","multipolygon","multipolygon_create","multipolygon_merge","turn_restriction_h","turn_restriction","turn_restriction_field","turn_restriction_editing","route_h","route","route_add","boundary_h","boundary","boundary_add"]],["operations",["intro","intro_2","straighten","orthogonalize","circularize","move","rotate","reflect","continue","reverse","disconnect","split","extract","merge","delete","downgrade","copy_paste"]],["notes",["intro","add_note_h","add_note","place_note","move_note","update_note_h","update_note","save_note_h","save_note"]],["imagery",["intro","sources_h","choosing","sources","offsets_h","offset","offset_change"]],["streetlevel",["intro","using_h","using","photos","viewer"]],["gps",["intro","survey","using_h","using","tracing","upload"]],["qa",["intro","tools_h","tools","issues_h","issues"]]],r={"help.help.open_data_h":3,"help.help.before_start_h":3,"help.help.open_source_h":3,"help.overview.navigation_h":3,"help.overview.features_h":3,"help.editing.select_h":3,"help.editing.multiselect_h":3,"help.editing.undo_redo_h":3,"help.editing.save_h":3,"help.editing.upload_h":3,"help.editing.backups_h":3,"help.editing.keyboard_h":3,"help.feature_editor.type_h":3,"help.feature_editor.fields_h":3,"help.feature_editor.tags_h":3,"help.points.add_point_h":3,"help.points.move_point_h":3,"help.points.delete_point_h":3,"help.lines.add_line_h":3,"help.lines.modify_line_h":3,"help.lines.connect_line_h":3,"help.lines.disconnect_line_h":3,"help.lines.move_line_h":3,"help.lines.delete_line_h":3,"help.areas.point_or_area_h":3,"help.areas.add_area_h":3,"help.areas.square_area_h":3,"help.areas.modify_area_h":3,"help.areas.delete_area_h":3,"help.relations.edit_relation_h":3,"help.relations.maintain_relation_h":3,"help.relations.relation_types_h":2,"help.relations.multipolygon_h":3,"help.relations.turn_restriction_h":3,"help.relations.route_h":3,"help.relations.boundary_h":3,"help.notes.add_note_h":3,"help.notes.update_note_h":3,"help.notes.save_note_h":3,"help.imagery.sources_h":3,"help.imagery.offsets_h":3,"help.streetlevel.using_h":3,"help.gps.using_h":3,"help.qa.tools_h":3,"help.qa.issues_h":3},s={version:`**${t.version}**`,rapidicon:'<svg class="icon pre-text rapid"><use xlink:href="#rapid-logo-rapid-wordmark"></use></svg>'},n=[];for(let[a,l]of i){let c=l.reduce((d,m)=>{let g=`help.${a}.${m}`,_=r[g],v=_?Array(_+1).join("#")+" ":"";return d+v+ut(t,g,s)+`

`},"");n.push({title:e.tHtml(`help.${a}.title`),content:er.parse(c.trim()).replace(/<code>/g,"<kbd>").replace(/<\/code>/g,"</kbd>")})}let o=Fl(t,"help").key(e.t("help.key")).label(e.tHtml("help.title")).description(e.tHtml("help.title")).iconName("rapid-icon-help");return o.renderContent=function(a){function l(A,M){let k=e.isRTL();a.property("scrollTop",0),o.selection().select(".pane-heading h2").html(A.title),b.html(A.content),b.selectAll("a").attr("target","_blank"),g.classed("selected",B=>B.title===A.title),T.html(""),k?T.call(F).call(O):T.call(O).call(F);function F(B){if(M===n.length-1)return;B.append("a").attr("href","#").attr("class","next").on("click",function(z){z.preventDefault(),l(n[M+1],M+1)}).append("span").html(n[M+1].title).call(Ye(k?"#rapid-icon-backward":"#rapid-icon-forward","inline"))}function O(B){if(M===0)return;B.append("a").attr("href","#").attr("class","previous").on("click",function(z){z.preventDefault(),l(n[M-1],M-1)}).call(Ye(k?"#rapid-icon-forward":"#rapid-icon-backward","inline")).append("span").html(n[M-1].title)}}function c(A){A.preventDefault(),!t.inIntro&&(t.container().call(mc(t)),t.systems.ui.togglePanes())}function d(A){A.preventDefault(),t.container().call(t.systems.ui.shortcuts,!0)}let m=a.append("ul").attr("class","toc"),g=m.selectAll("li").data(n).enter().append("li").append("a").attr("href","#").html(A=>A.title).on("click",function(A,M){A.preventDefault(),l(M,n.indexOf(M))});m.append("li").attr("class","shortcuts").call(Ft(t).title(e.tHtml("shortcuts.tooltip")).keys(["?"]).placement("top")).append("a").attr("href","#").on("click",d).append("div").html(e.tHtml("shortcuts.title"));let v=m.append("li").attr("class","walkthrough").append("a").attr("href","#").on("click",c);v.append("svg").attr("class","logo logo-walkthrough").append("use").attr("xlink:href","#rapid-logo-walkthrough"),v.append("div").html(e.tHtml("splash.walkthrough"));let E=a.append("div").attr("class","left-content"),b=E.append("div").attr("class","body"),T=E.append("div").attr("class","nav");l(n[0],0)},o}var XS=1e3;function M6(t,e,i){let r=t.systems.validator,s=t.systems.storage,n=tr(t,e).label(a).shouldDisplay(l).disclosureContent(c),o=[];function a(){let v=o.length>XS?`${XS}+`:String(o.length),E=t.t(`issues.${i}s.list_title`);return t.t("inspector.title_count",{title:E,count:v})}function l(){return o.length}function c(v){let E=t.systems.map.center(),b=t.graph(),T=o.map(function(M){let k=M.extent(b),F=k?mr(E,k.center()):0;return Object.assign(M,{dist:F})}).sort((A,M)=>A.dist-M.dist);T=T.slice(0,XS),v.call(d,T)}function d(v,E){let b=s.getItem("rapid-internal-feature.showAutoFix")==="true",T=v.selectAll(".issues-list").data([0]);T=T.enter().append("ul").attr("class",`layer-list issues-list ${i}s-list`).merge(T);let A=T.selectAll("li").data(E,Z=>Z.key);A.exit().remove();let M=A.enter().append("li").attr("class",Z=>`issue severity-${Z.severity}`),k=M.append("button").attr("class","issue-label").on("click",(Z,W)=>r.focusIssue(W)).on("mouseover",(Z,W)=>Ki(W.entityIds,!0,t)).on("mouseout",(Z,W)=>Ki(W.entityIds,!1,t)),F=k.append("span").attr("class","issue-text");F.append("span").attr("class","issue-icon").each((Z,W,q)=>{let Q=Z.severity==="warning"?"alert":"error";ye(q[W]).call(Ye(`#rapid-icon-${Q}`))}),F.append("span").attr("class","issue-message"),b&&k.append("span").attr("class","issue-autofix").each((Z,W,q)=>{Z.autoArgs&&ye(q[W]).append("button").attr("title",t.t("issues.fix_one.title")).datum(Z).attr("class","autofix action").on("click",(Q,V)=>{Q.preventDefault(),Q.stopPropagation(),Ki(V.entityIds,!1,t),t.perform.apply(t,V.autoArgs),r.validate()}).call(Ye("#rapid-icon-wrench"))}),A=A.merge(M).order(),A.selectAll(".issue-message").html(Z=>Z.message(t));let O=E.filter(Z=>Z.autoArgs),B=v.selectAll(".autofix-all").data(b&&O.length?[0]:[]);B.exit().remove();let U=B.enter().insert("div",".issues-list").attr("class","autofix-all"),z=U.append("a").attr("class","autofix-all-link").attr("href","#");z.append("span").attr("class","autofix-all-link-text").html(t.tHtml("issues.fix_all.title")),z.append("span").attr("class","autofix-all-link-icon").call(Ye("#rapid-icon-wrench")),B=B.merge(U),B.selectAll(".autofix-all-link").on("click",()=>{t.pauseChangeDispatch(),t.perform(us()),O.forEach(Z=>{let W=Z.autoArgs.slice();typeof W[W.length-1]!="function"&&W.pop(),W.push(t.t("issues.fix_all.annotation")),t.replace.apply(t,W)}),t.resumeChangeDispatch(),r.validate()})}function m(){return{what:s.getItem("validate-what")||"edited",where:s.getItem("validate-where")||"all"}}function g(){let v=m();o=r.getIssuesBySeverity(v)[i]}function _(){return t.container().selectAll(".map-panes .issues-pane.shown").size()}return r.on("validated",()=>{window.requestIdleCallback(()=>{_()&&(g(),n.reRender())})}),t.systems.map.on("draw",Gr(()=>{window.requestIdleCallback(()=>{_()&&(m().where==="visible"&&g(),n.reRender())})},1e3,{leading:!1,trailing:!0})),n}function Ux(t){let e=t.systems.storage,i=tr(t,"issues-options").content(r);function r(o){let a=o.selectAll(".issues-options-container").data([0]);a=a.enter().append("div").attr("class","issues-options-container").merge(a);let l=[{key:"what",values:["edited","all"]},{key:"where",values:["visible","all"]}],d=a.selectAll(".issues-option").data(l,g=>g.key).enter().append("div").attr("class",g=>`issues-option issues-option-${g.key}`);d.append("div").attr("class","issues-option-title").html(g=>t.tHtml(`issues.options.${g.key}.title`));let m=d.selectAll("label").data(g=>g.values.map(_=>({value:_,key:g.key}))).enter().append("label");m.append("input").attr("type","radio").attr("name",g=>`issues-option-${g.key}`).attr("value",g=>g.value).property("checked",g=>s()[g.key]===g.value).on("change",(g,_)=>n(g,_.key,_.value)),m.append("span").html(g=>t.tHtml(`issues.options.${g.key}.${g.value}`))}function s(){return{what:e.getItem("validate-what")||"edited",where:e.getItem("validate-where")||"all"}}function n(o,a,l){!l&&o&&o.target&&(l=o.target.value),e.setItem(`validate-${a}`,l),t.systems.validator.validate()}return i}function zx(t){let e=t.systems.validator,i=t.systems.storage,r=0,s=20,n=5,o=tr(t,"issues-rules").disclosureContent(l).label(t.tHtml("issues.rules.title")),a=e.getRuleKeys().sort((_,v)=>t.t(`issues.${_}.title`)<t.t(`issues.${v}.title`)?-1:1);function l(_){let v=_.selectAll(".issues-rulelist-container").data([0]),E=v.enter().append("div").attr("class","issues-rulelist-container");E.append("ul").attr("class","layer-list issue-rules-list");let b=E.append("div").attr("class","issue-rules-links section-footer");b.append("a").attr("class","issue-rules-link").attr("href","#").html(t.tHtml("issues.disable_all")).on("click",T=>{T.preventDefault(),e.disableRules(a)}),b.append("a").attr("class","issue-rules-link").attr("href","#").html(t.tHtml("issues.enable_all")).on("click",T=>{T.preventDefault(),e.disableRules([])}),v=v.merge(E),v.selectAll(".issue-rules-list").call(c)}function c(_){let v=_.selectAll("li").data(a);v.exit().remove();let E=v.enter().append("li").call(Ft(t).title(k=>t.tHtml(`issues.${k}.tip`)).placement("top")),b=E.append("label");b.append("input").attr("type","checkbox").attr("name","rule").on("change",g),b.append("span").html(k=>{let F={};return k==="unsquare_way"&&(F.val='<span class="square-degrees"></span>'),t.tHtml(`issues.${k}.title`,F)}),v=v.merge(E),v.classed("active",m).selectAll("input").property("checked",m).property("indeterminate",!1);let T=i.getItem("validate-square-degrees");T===null&&(T=n.toString());let M=v.selectAll(".square-degrees").selectAll(".square-degrees-input").data([0]);M.enter().append("input").attr("type","number").attr("min",r.toString()).attr("max",s.toString()).attr("step","0.5").attr("class","square-degrees-input").call(Ri).on("click",function(k){k.preventDefault(),k.stopPropagation(),this.select()}).on("keyup",function(k){k.keyCode===13&&(this.blur(),this.select())}).on("blur",d).merge(M).property("value",T)}function d(){let _=ye(this),v=si(_).trim(),E=parseFloat(v,10);isFinite(E)?E>s?E=s:E<r&&(E=r):E=n,E=Math.round(E*10)/10,v=E.toString(),_.property("value",v),i.setItem("validate-square-degrees",v),e.revalidateUnsquare()}function m(_){return e.isRuleEnabled(_)}function g(_,v){e.toggleRule(v)}return e.on("validated",()=>{window.requestIdleCallback(o.reRender)}),o}function Gx(t){let e=t.systems.validator,i=tr(t,"issues-status").shouldDisplay(r).content(n);function r(){return e.getIssues(s()).length===0}function s(){let l=t.systems.storage;return{what:l.getItem("validate-what")||"edited",where:l.getItem("validate-where")||"all"}}function n(l){let d=l.selectAll(".box").data([0]).enter().append("div").attr("class","box");d.append("div").call(Ye("#rapid-icon-apply","pre-text"));let m=d.append("span");m.append("strong").attr("class","message"),m.append("br"),m.append("span").attr("class","details"),o(l),a(l)}function o(l){let c=e.getIssues({what:"all",where:"all",includeDisabledRules:!0,includeIgnored:"only"}),d=l.selectAll(".reset-ignored").data(c.length?[0]:[]);d.exit().remove();let m=d.enter().append("div").attr("class","reset-ignored section-footer");m.append("a").attr("href","#"),d=d.merge(m),d.select("a").html(t.t("inspector.title_count",{title:t.tHtml("issues.reset_ignored"),count:c.length})),d.on("click",g=>{g.preventDefault(),e.resetIgnoredIssues()})}function a(l){let c=s();function d(g){for(let _ in g){let v=g[_],E=e.getIssues(v);if(E.length){l.select(".box .details").html(t.tHtml("issues.no_issues.hidden_issues."+_,{count:E.length.toString()}));return}}l.select(".box .details").html(t.tHtml("issues.no_issues.hidden_issues.none"))}let m;c.what==="edited"&&c.where==="visible"?(m="edits_in_view",d({elsewhere:{what:"edited",where:"all"},everything_else:{what:"all",where:"visible"},disabled_rules:{what:"edited",where:"visible",includeDisabledRules:"only"},everything_else_elsewhere:{what:"all",where:"all"},disabled_rules_elsewhere:{what:"edited",where:"all",includeDisabledRules:"only"},ignored_issues:{what:"edited",where:"visible",includeIgnored:"only"},ignored_issues_elsewhere:{what:"edited",where:"all",includeIgnored:"only"}})):c.what==="edited"&&c.where==="all"?(m="edits",d({everything_else:{what:"all",where:"all"},disabled_rules:{what:"edited",where:"all",includeDisabledRules:"only"},ignored_issues:{what:"edited",where:"all",includeIgnored:"only"}})):c.what==="all"&&c.where==="visible"?(m="everything_in_view",d({elsewhere:{what:"all",where:"all"},disabled_rules:{what:"all",where:"visible",includeDisabledRules:"only"},disabled_rules_elsewhere:{what:"all",where:"all",includeDisabledRules:"only"},ignored_issues:{what:"all",where:"visible",includeIgnored:"only"},ignored_issues_elsewhere:{what:"all",where:"all",includeIgnored:"only"}})):c.what==="all"&&c.where==="all"&&(m="everything",d({disabled_rules:{what:"all",where:"all",includeDisabledRules:"only"},ignored_issues:{what:"all",where:"all",includeIgnored:"only"}})),c.what==="edited"&&t.systems.edits.difference().summary().size===0&&(m="no_edits"),l.select(".box .message").html(t.tHtml(`issues.no_issues.message.${m}`))}return e.on("validated",()=>{window.requestIdleCallback(i.reRender)}),t.systems.map.on("draw",Gr(()=>{window.requestIdleCallback(i.reRender)},1e3)),i}function $x(t){return Fl(t,"issues").key(t.t("issues.key")).label(t.tHtml("issues.title")).description(t.tHtml("issues.title")).iconName("rapid-icon-alert").sections([Ux(t),Gx(t),M6(t,"issues-errors","error"),M6(t,"issues-warnings","warning"),zx(t)])}function Hx(t){let e=t.systems.storage,i=t.systems.urlhash,r=Pt("change"),s="settings.custom_data",n=[".gpx","application/gpx","application/gpx+xml",".kml","application/vnd.google-earth.kml+xml","application/kml","application/kml+xml",".geojson",".json","application/geo+json","application/json","application/vnd.geo+json","text/x-json"];function o(a){let l=t.scene().layers.get("custom-data"),c=i.getParam("data")||i.getParam("gpx")||e.getItem("settings-custom-data-url"),d=l&&l.getFileList()||null,m=c,g=d,_=Ch(t,a).okButton();_.classed("settings-modal settings-custom-data",!0),_.select(".modal-section.header").append("h3").html(t.tHtml("settings.custom_data.header"));let v=_.select(".modal-section.message-text"),E=t.t(`${s}.instructions`),b=t.t(`${s}.file.heading`),T=t.t(`${s}.file.instructions`),A=t.t(`${s}.file.types`),M=t.t(`${s}.file.tip`),k=er.parse(`
${E}
&nbsp;<br>
&nbsp;<br>
### ${b}
${T}
* ${A}
&nbsp;<br>
&nbsp;<br>
${M}
`);v.append("div").attr("class","instructions-template").html(k),v.append("input").attr("class","field-file").attr("type","file").attr("accept",n.join()).property("files",g).on("change",re=>{let te=re.target.files;te!=null&&te.length?(g=te,m="",v.select(".field-url").property("value","")):g=null});let F=t.t(`${s}.or`),O=t.t(`${s}.url.heading`),B=t.t(`${s}.url.instructions`),U=t.t(`${s}.url.tokens`),z=t.t(`${s}.url.xyz`),Z=t.t(`${s}.url.example_file`),W=t.t(`${s}.url.example_xyz`),q=t.t(`${s}.url.example_pmtiles`),Q=t.t("example"),V=er.parse(`
### ${F}
### ${O}
${B}
&nbsp;<br>
&nbsp;<br>
${U}
* ${z}
&nbsp;<br>
&nbsp;<br>
#### ${Q}
* \`${Z}\`
* \`${W}\`
* \`${q}\`
`);v.append("div").attr("class","instructions-template").html(V),v.append("textarea").attr("class","field-url").attr("placeholder",t.t("settings.custom_data.url.placeholder")).call(Ri).property("value",m);let le=_.select(".modal-section.buttons");le.insert("button",".ok-button").attr("class","button cancel-button secondary-action").html(t.tHtml("confirm.cancel")),le.select(".cancel-button").on("click.cancel",ne),le.select(".ok-button").attr("disabled",de).on("click.save",ee);function de(){return null}function ne(){v.select(".field-url").property("value",c),e.setItem("settings-custom-data-url",c),this.blur(),_.close()}function ee(){m=v.select(".field-url").property("value").trim();let re={};m?(re={url:m,fileList:null},e.setItem("settings-custom-data-url",m)):g&&(re={url:null,fileList:g}),this.blur(),_.close(),r.call("change",this,re)}}return $t(o,r,"on")}function Vx(t){let e=t.systems.l10n,i=tr(t,"data-layers").label(e.tHtml("map_data.data_layers")).disclosureContent(n),r=Hx(t).on("change",_),s=t.scene();function n(E){let b=E.selectAll(".data-layer-container").data([0]);b.enter().append("div").attr("class","data-layer-container").merge(b).call(c).call(d).call(m).call(v)}function o(E){let b=s.layers.get(E);return b==null?void 0:b.enabled}function a(E,b){let T=t.mode;T&&/^draw/.test(T.id)||(b?s.enableLayers(E):(s.disableLayers(E),(E==="osm"||E==="notes")&&t.enter("browse")))}function l(E){a(E,!o(E))}function c(E){let T=["osm","notes"].map(O=>s.layers.get(O)).filter(Boolean),A=E.selectAll(".layer-list-osm").data([0]);A=A.enter().append("ul").attr("class","layer-list layer-list-osm").merge(A);let M=A.selectAll(".list-item").data(T);M.exit().remove();let k=M.enter().append("li").attr("class",O=>`list-item list-item-${O.id}`),F=k.append("label").each((O,B,U)=>{O.id==="osm"?ye(U[B]).call(Ft(t).title(e.tHtml(`map_data.layers.${O.id}.tooltip`)).keys([Li("\u2325"+e.t("area_fill.wireframe.key"))]).placement("bottom")):ye(U[B]).call(Ft(t).title(e.tHtml(`map_data.layers.${O.id}.tooltip`)).placement("bottom"))});F.append("input").attr("type","checkbox").on("change",(O,B)=>l(B.id)),F.append("span").html(O=>e.tHtml(`map_data.layers.${O.id}.title`)),M.merge(k).classed("active",O=>O.enabled).selectAll("input").property("checked",O=>O.enabled)}function d(E){let T=["keepRight","improveOSM","osmose"].map(O=>s.layers.get(O)).filter(Boolean),A=E.selectAll(".layer-list-qa").data([0]);A=A.enter().append("ul").attr("class","layer-list layer-list-qa").merge(A);let M=A.selectAll(".list-item").data(T);M.exit().remove();let k=M.enter().append("li").attr("class",O=>`list-item list-item-${O.id}`),F=k.append("label").each((O,B,U)=>{ye(U[B]).call(Ft(t).title(e.tHtml(`map_data.layers.${O.id}.tooltip`)).placement("bottom"))});F.append("input").attr("type","checkbox").on("change",(O,B)=>l(B.id)),F.append("span").html(O=>e.tHtml(`map_data.layers.${O.id}.title`)),M.merge(k).classed("active",O=>O.enabled).selectAll("input").property("checked",O=>O.enabled)}function m(E){let b=s.layers.get("custom-data"),T=e.isRTL(),A=E.selectAll(".layer-list-data").data(b?[b]:[]);A.exit().remove();let M=A.enter().append("ul").attr("class","layer-list layer-list-data"),k=M.append("li").attr("class","list-item-data"),F=k.append("label").call(Ft(t).title(e.tHtml("map_data.layers.custom.tooltip")).placement("top"));F.append("input").attr("type","checkbox").on("change",()=>l("custom-data")),F.append("span").html(e.tHtml("map_data.layers.custom.title")),k.append("button").attr("class","open-data-options").call(Ft(t).title(e.tHtml("settings.custom_data.tooltip")).placement(T?"right":"left")).on("click",O=>{O.preventDefault(),g()}).call(Ye("#rapid-icon-more")),k.append("button").attr("class","zoom-to-data").call(Ft(t).title(e.tHtml("map_data.layers.custom.zoom")).placement(T?"right":"left")).on("click",function(O){if(ye(this).classed("disabled"))return;O.preventDefault(),O.stopPropagation();let B=s.layers.get("custom-data");B==null||B.fitZoom()}).call(Ye("#rapid-icon-framed-dot","monochrome")),A=A.merge(M),A.selectAll(".list-item-data").classed("active",O=>O.enabled).selectAll("label").classed("deemphasize",O=>!O.hasData).selectAll("input").property("disabled",O=>!O.hasData).property("checked",O=>O.enabled),A.selectAll("button.zoom-to-data").classed("disabled",O=>!O.hasData)}function g(){t.container().call(r)}function _(E){let b=s.layers.get("custom-data");b&&(E!=null&&E.url?b.setUrl(E.url):E!=null&&E.fileList&&b.setFileList(E.fileList))}function v(E){let b=E.selectAll(".md-extras-list").data([0]).enter().append("ul").attr("class","layer-list md-extras-list"),T=b.append("li").attr("class","history-panel-toggle-item").append("label").call(Ft(t).title(e.tHtml("map_data.history_panel.tooltip")).keys([Li("\u2318\u21E7"+e.t("info_panels.history.key"))]).placement("top"));T.append("input").attr("type","checkbox").on("change",M=>{M.preventDefault(),t.systems.ui.info.toggle("history")}),T.append("span").html(e.tHtml("map_data.history_panel.title"));let A=b.append("li").attr("class","measurement-panel-toggle-item").append("label").call(Ft(t).title(e.tHtml("map_data.measurement_panel.tooltip")).keys([Li("\u2318\u21E7"+e.t("info_panels.measurement.key"))]).placement("top"));A.append("input").attr("type","checkbox").on("change",M=>{M.preventDefault(),t.systems.ui.info.toggle("measurement")}),A.append("span").html(e.tHtml("map_data.measurement_panel.title"))}return t.scene().on("layerchange",i.reRender),i}function jx(t){let e=t.systems.filters,i=tr(t,"map-features").label(t.tHtml("map_data.map_features")).disclosureContent(r);function r(a){let l=a.selectAll(".layer-feature-list-container").data([0]),c=l.enter().append("div").attr("class","layer-feature-list-container");c.append("ul").attr("class","layer-list layer-feature-list");let d=c.append("div").attr("class","feature-list-links section-footer");d.append("a").attr("class","feature-list-link").attr("href","#").html(t.tHtml("issues.disable_all")).on("click",m=>{m.preventDefault(),e.disableAll()}),d.append("a").attr("class","feature-list-link").attr("href","#").html(t.tHtml("issues.enable_all")).on("click",m=>{m.preventDefault(),e.enableAll()}),l=l.merge(c),l.selectAll(".layer-feature-list").call(s)}function s(a){let l=a.selectAll("li").data(e.keys);l.exit().remove();let c=l.enter().append("li").call(Ft(t).title(m=>t.tHtml(`feature.${m}.tooltip`)).placement("top")),d=c.append("label");d.append("input").attr("type","checkbox").attr("name","feature").on("change",o),d.append("span").html(m=>t.tHtml(`feature.${m}.description`)),l=l.merge(c),l.classed("active",n).selectAll("input").property("checked",n)}function n(a){return e.isEnabled(a)}function o(a,l){e.toggle(l)}return e.on("filterchange",i.reRender),i}function Xx(t){let e=tr(t,"fill-area").label(t.tHtml("map_data.style_options")).disclosureContent(i);function i(l){let c=l.selectAll(".layer-fill-list").data([0]);c.enter().append("ul").attr("class","layer-list layer-fill-list").merge(c).call(r,t.systems.map.areaFillOptions,"radio","area_fill",n,s);let d=l.selectAll(".layer-visual-diff-list").data([0]);d.enter().append("ul").attr("class","layer-list layer-visual-diff-list").merge(d).call(r,["highlight_edits"],"checkbox","visual_diff",a,o)}function r(l,c,d,m,g,_){let v=l.selectAll("li").data(c);v.exit().remove();let E=v.enter().append("li").call(Ft(t).title(T=>t.tHtml(`${m}.${T}.tooltip`)).keys(T=>{let A=T==="wireframe"?t.t("area_fill.wireframe.key"):null;return T==="highlight_edits"&&(A=t.t("map_data.highlight_edits.key")),A?[A]:null}).placement("top")),b=E.append("label");b.append("input").attr("type",d).attr("name",m).on("change",g),b.append("span").html(T=>t.tHtml(`${m}.${T}.description`)),v=v.merge(E),v.classed("active",_).selectAll("input").property("checked",_).property("indeterminate",!1)}function s(l){return t.systems.map.areaFillMode===l}function n(l,c){t.systems.map.areaFillMode=c}function o(){return t.systems.map.highlightEdits}function a(l){let c=l.currentTarget;t.systems.map.highlightEdits=c.checked}return t.systems.map.on("mapchange",e.reRender),e}function Wx(t){let e=t.systems.photos,i=tr(t,"photo-overlays").label(t.tHtml("photo_overlays.title")).disclosureContent(s),r=t.scene();function s(g){let _=g.selectAll(".photo-overlay-container").data([0]);_.enter().append("div").attr("class","photo-overlay-container").merge(_).call(l).call(c).call(d).call(m)}function n(g){let _=r.layers.get(g);return _&&_.enabled}function o(g,_){let v=t.mode;v&&/^draw/.test(v.id)||(_?r.enableLayers(g):r.disableLayers(g))}function a(g){o(g,!n(g))}function l(g){let E=e.overlayLayerIDs.map(O=>r.layers.get(O)).filter(Boolean).filter(O=>O.supported);function b(O){return O&&O.supported}function T(O){return b(O)&&O.enabled}let A=g.selectAll(".layer-list-photos").data([0]);A=A.enter().append("ul").attr("class","layer-list layer-list-photos").merge(A);let M=A.selectAll(".list-item-photos").data(E);M.exit().remove();let k=M.enter().append("li").attr("class",function(O){var B="list-item-photos list-item-"+O.id;return(O.id==="mapillary-signs"||O.id==="mapillary-map-features")&&(B+=" indented"),B}),F=k.append("label").each((O,B,U)=>{let z;O.id==="mapillary-signs"?z="mapillary.signs.tooltip":O.id==="mapillary"?z="mapillary_images.tooltip":O.id==="kartaview"?z="kartaview_images.tooltip":z=O.id.replace(/-/g,"_")+".tooltip",ye(U[B]).call(Ft(t).title(t.tHtml(z)).placement("top"))});F.append("input").attr("type","checkbox").on("change",(O,B)=>a(B.id)),F.append("span").html(O=>{let B=O.id;return B==="mapillary-signs"&&(B="photo_overlays.traffic_signs"),t.tHtml(B.replace(/-/g,"_")+".title")}),M.merge(k).classed("active",T).selectAll("input").property("checked",T)}function c(g){let _=e.allPhotoTypes;function v(M){return e.showsPhotoType(M)}let E=g.selectAll(".layer-list-photo-types").data([0]);E.exit().remove(),E=E.enter().append("ul").attr("class","layer-list layer-list-photo-types").merge(E);let b=E.selectAll(".list-item-photo-types").data(e.shouldFilterByPhotoType()?_:[]);b.exit().remove();let T=b.enter().append("li").attr("class",M=>`list-item-photo-types list-item-${M}`),A=T.append("label").each(function(M){ye(this).call(Ft(t).title(t.tHtml(`photo_overlays.photo_type.${M}.tooltip`)).placement("top"))});A.append("input").attr("type","checkbox").on("change",(M,k)=>e.togglePhotoType(k)),A.append("span").html(M=>t.tHtml(`photo_overlays.photo_type.${M}.title`)),b.merge(T).classed("active",v).selectAll("input").property("checked",v)}function d(g){let _=e.dateFilters;function v(M){return e.dateFilterValue(M)}let E=g.selectAll(".layer-list-date-filter").data([0]);E.exit().remove(),E=E.enter().append("ul").attr("class","layer-list layer-list-date-filter").merge(E);let b=E.selectAll(".list-item-date-filter").data(e.shouldFilterByDate()?_:[]);b.exit().remove();let T=b.enter().append("li").attr("class","list-item-date-filter"),A=T.append("label").each((M,k,F)=>{ye(F[k]).call(Ft(t).title(t.tHtml(`photo_overlays.date_filter.${M}.tooltip`)).placement("top"))});A.append("span").html(M=>t.tHtml(`photo_overlays.date_filter.${M}.title`)),A.append("input").attr("type","date").attr("class","list-item-input").attr("placeholder",t.t("units.year_month_day")).call(Ri).each((M,k,F)=>{si(ye(F[k]),e.dateFilterValue(M)||"")}).on("change",function(M,k){let F=si(ye(this)).trim();e.setDateFilter(k,F,!0),b.selectAll("input").each(function(O){si(ye(this),e.dateFilterValue(O)||"")})}),b=b.merge(T).classed("active",v)}function m(g){function _(){return e.usernames}let v=g.selectAll(".layer-list-username-filter").data([0]);v.exit().remove(),v=v.enter().append("ul").attr("class","layer-list layer-list-username-filter").merge(v);let E=v.selectAll(".list-item-username-filter").data(e.shouldFilterByUsername()?["username-filter"]:[]);E.exit().remove();let b=E.enter().append("li").attr("class","list-item-username-filter"),T=b.append("label").each((M,k,F)=>{ye(F[k]).call(Ft(t).title(t.tHtml("photo_overlays.username_filter.tooltip")).placement("top"))});T.append("span").html(t.tHtml("photo_overlays.username_filter.title")),T.append("input").attr("type","text").attr("class","list-item-input").call(Ri).property("value",A).on("change",function(){let M=ye(this).property("value");e.setUsernameFilter(M,!0),ye(this).property("value",A)}),E.merge(b).classed("active",_);function A(){let M=e.usernames;return M&&M.join("; ")}}return t.scene().on("layerchange",i.reRender),e.on("photochange",i.reRender),i}function qx(t){return Fl(t,"map-data").key(t.t("map_data.key")).label(t.tHtml("map_data.title")).description(t.tHtml("map_data.description")).iconName("rapid-icon-data").sections([Vx(t),Wx(t),Xx(t),jx(t)])}function Yx(t){let e=t.systems.storage,i=tr(t,"preferences-third-party").label(t.tHtml("preferences.privacy.title")).disclosureContent(s),r=e.getItem("preferences.privacy.thirdpartyicons")||"true";function s(n){let a=n.selectAll(".privacy-options-list").data([0]).enter().append("ul").attr("class","layer-list privacy-options-list").append("li").attr("class","privacy-third-party-icons-item").append("label").call(Ft(t).title(t.tHtml("preferences.privacy.third_party_icons.tooltip")).placement("bottom"));a.append("input").attr("type","checkbox").on("change",c=>{c.preventDefault(),r=r==="true"?"false":"true",e.setItem("preferences.privacy.thirdpartyicons",r),l()}),a.append("span").html(t.tHtml("preferences.privacy.third_party_icons.description")),n.selectAll(".privacy-link").data([0]).enter().append("div").attr("class","privacy-link").append("a").attr("target","_blank").call(Ye("#rapid-icon-out-link","inline")).attr("href","https://mapwith.ai/doc/license/MapWithAIPrivacyPolicy.pdf").append("span").html(t.tHtml("preferences.privacy.privacy_link")),l();function l(){n.selectAll(".privacy-third-party-icons-item").classed("active",r==="true").select("input").property("checked",r==="true")}}return i}function Zx(t){let e=t.systems.storage,i=tr(t,"map-interaction").label(t.tHtml("preferences.map_interaction.title")).disclosureContent(s),r=["auto","zoom","pan"];function s(l){let c=l.selectAll(".mouse-wheel-options").data([0]),d=c.enter().append("div").attr("class","mouse-wheel-options");d.append("div").attr("class","mouse-wheel-title").text(t.t("preferences.map_interaction.mouse_wheel.title")),d.append("ul").attr("class","layer-list mouse-wheel-options-list"),c.merge(d).selectAll(".mouse-wheel-options-list").call(n)}function n(l){let c=l.selectAll("li").data(r);c.exit().remove();let d=c.enter().append("li").call(Ft(t).title(g=>t.t(`preferences.map_interaction.mouse_wheel.${g}.tooltip`)).placement("top")),m=d.append("label");m.append("input").attr("type","radio").attr("name","mouse_wheel").on("change",a),m.append("span").text(g=>t.t(`preferences.map_interaction.mouse_wheel.${g}.title`)),c.merge(d).classed("active",o).selectAll("input").property("checked",o).property("indeterminate",!1)}function o(l){return(e.getItem("prefs.mouse_wheel.interaction")||"auto")===l}function a(l,c){e.setItem("prefs.mouse_wheel.interaction",c),i.reRender()}return i}function Qx(t){return Fl(t,"preferences").key(t.t("preferences.key")).label(t.tHtml("preferences.title")).description(t.tHtml("preferences.description")).iconName("fas-user-cog").sections([Yx(t),Zx(t)])}var P6=class extends fi{constructor(e){super(e),this.id="ui",this.dependencies=new Set(["edits","imagery","l10n","map","storage","urlhash"]),this.authModal=null,this.defs=null,this.flash=null,this.editMenu=null,this.info=null,this.sidebar=null,this.photoviewer=null,this.shortcuts=null,this._didRender=!1,this._needWidth={},this._startPromise=null,this._initPromise=null,this.render=this.render.bind(this),this.resize=this.resize.bind(this),this._clickBugLink=this._clickBugLink.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let s of this.dependencies)if(!this.context.systems[s])return Promise.reject(`Cannot init:  ${this.id} requires ${s}`);let e=this.context;this.authModal=Yc(e).blocking(!0),this.defs=new X4(e),this.flash=q4(e),this.editMenu=R_(e),this.sidebar=Ex(e),this.photoviewer=ax(e),this.shortcuts=wx(e),window.addEventListener("beforeunload",()=>e.save()),window.addEventListener("unload",()=>e.systems.edits.unlock()),window.addEventListener("resize",()=>this.resize());let i=e.systems.l10n,r=i.initAsync();return this._initPromise=r.then(()=>{this.authModal.message(i.tHtml("loading_auth"));let s=e.services.osm;s&&s.on("authLoading",()=>{var n;return(n=e.container())==null?void 0:n.call(this.authModal)}).on("authDone",()=>this.authModal.close())})}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context.container();return e.empty()||this.render(e),this._started=!0,this._startPromise=Promise.resolve()}resetAsync(){let e=this.context.container();return e.empty()||e.select(".inspector-wrap *").remove(),Promise.resolve()}render(e){if(this._didRender)return;this.didRender=!0;let i=this.context,r=i.systems.l10n;e.attr("lang",r.localeCode()).attr("dir",r.textDirection()),e.call(G_(i));let s=i.systems.map;s.redrawEnabled=!1,e.append("svg").attr("id","rapid-defs").call(this.defs.render),e.append("div").attr("class","sidebar").call(this.sidebar),i.keybinding().on("\u232B",M=>M.preventDefault()).on([r.t("sidebar.key"),"`","\xB2","@"],this.sidebar.toggle).on(Li("\u2318"+r.t("background.key")),M=>{M&&(M.stopImmediatePropagation(),M.preventDefault());let k=i.systems.imagery,F=i.systems.storage,O=k.getSource(F.getItem("background-last-used-toggle"));if(O){let B=k.baseLayerSource();F.setItem("background-last-used-toggle",B.id),F.setItem("background-last-used",O.id),k.baseLayerSource(O)}});let n=e.append("div").attr("class","main-content active");n.append("div").attr("class","main-map").attr("dir","ltr").call(s.render),n.append("div").attr("class","top-toolbar-wrap").append("div").attr("class","top-toolbar fillD").call(Ix(i));let o=n.append("div").attr("class","over-map");o.append("div").attr("class","select-trap").text("t"),o.call(u0(i)),o.call(c0(i)),o.append("div").attr("class","spinner").call(Sx(i));let a=o.append("div").attr("class","map-controls");a.append("div").attr("class","map-control zoombuttons").call(Mx(i)),a.append("div").attr("class","map-control zoom-to-selection-control").call(Px(i)),a.append("div").attr("class","map-control geolocate-control").call($_(i));let l=o.append("div").attr("class","map-panes"),c=[Ox(i),qx(i),$x(i),Qx(i),Bx(i)];for(let M of c)a.append("div").attr("class",`map-control map-pane-control ${M.id}-control`).call(M.renderToggleButton),l.call(M.renderPane);this.info=q_(i),o.call(this.info),o.append("div").attr("class","photoviewer").classed("al",!0).classed("hide",!0).call(this.photoviewer),o.append("div").attr("class","attribution-wrap").attr("dir","ltr").call(T_(i));let d=n.append("div").attr("class","map-footer");d.append("div").attr("class","api-status").call(Ax(i));let m=d.append("div").attr("class","map-footer-bar fillD");m.append("div").attr("class","flash-wrap footer-hide");let g=m.append("div").attr("class","main-footer-wrap footer-show");g.append("div").attr("class","scale-block").call(bx(i));let _=g.append("div").attr("class","info-block").append("ul").attr("class","map-footer-list");_.append("li").attr("class","user-list").call(M_(i)),_.append("li").attr("class","fb-road-license").attr("tabindex",-1).call(_x(i));let v=i.apiConnections;v&&v.length>1&&_.append("li").attr("class","source-switch").call(Tx(i).keys(v)),_.append("li").attr("class","issues-info").call(Q_(i));let E=_.append("li");E.append("button").attr("class","bugnub").attr("tabindex",-1).on("click",this._clickBugLink).call(Ye("#rapid-icon-bug","bugnub")).call(Ft(i).title(r.tHtml("report_a_bug")).placement("top")),E.append("a").attr("target","_blank").attr("href","https://github.com/openstreetmap/iD/blob/develop/CONTRIBUTING.md#translating").call(Ye("#rapid-icon-translate","light")).call(Ft(i).title(r.tHtml("help_translate")).placement("top")),_.append("li").attr("class","version").call(kx(i)),i.embed()||_.call(b_(i)),e.call(this.shortcuts),this.resize(),s.redrawEnabled=!0,i.enter("browse");let b=i.systems.edits;i.systems.urlhash.initialHashParams.get("walkthrough")==="true"?e.call(mc(i)):b.lock()&&b.hasRestorableChanges()?e.call(vx(i)):e.call(xx(i))}resize(e){let i=this.context,r=i.container(),s=i.systems.map,n=pc(r.select(".main-content"),!0);pc(r.select(".sidebar"),!0),e!==void 0&&s.pan(e),s.dimensions=n,this.photoviewer.onMapResize(),this.checkOverflow(".top-toolbar"),this.checkOverflow(".map-footer-bar")}checkOverflow(e,i){i&&delete this._needWidth[e];let r=this.context.container().select(e);if(r.empty())return;let s=r.property("scrollWidth"),n=r.property("clientWidth"),o=this._needWidth[e]||s;s>n?(r.classed("narrow",!0),this._needWidth[e]||(this._needWidth[e]=s)):s>=o&&r.classed("narrow",!1)}togglePanes(e){let i=this.context,r=i.systems.l10n,s=i.container(),n=s.selectAll(".map-pane.shown"),o=r.isRTL()?"left":"right";n.classed("shown",!1).classed("hide",!0),s.selectAll(".map-pane-control button").classed("active",!1),e?(n.classed("shown",!1).classed("hide",!0).style(o,"-500px"),s.selectAll("."+e.attr("pane")+"-control button").classed("active",!0),e.classed("shown",!0).classed("hide",!1),n.empty()?e.style(o,"-500px").transition().duration(200).style(o,"0px"):e.style(o,"0px")):n.classed("shown",!0).classed("hide",!1).style(o,"0px").transition().duration(200).style(o,"-500px").on("end",function(){ye(this).classed("shown",!1).classed("hide",!0)})}showEditMenu(e,i,r){this.editMenu.close();let s=this.context,n=s.mode;if(!r&&n.operations&&(r=typeof n.operations=="function"?n.operations():n.operations),!r||!r.length||!s.editable())return;let o=s.surface().node();o.focus&&o.focus();for(let a of r)typeof a.point=="function"&&a.point(e);this.editMenu.anchorLoc(s.projection.invert(e)).triggerType(i).operations(r),s.systems.map.overlay.call(this.editMenu)}closeEditMenu(){this.editMenu.close()}_clickBugLink(){let e=new URL("https://github.com/facebook/Rapid/issues/new");e.searchParams.append("template","bug_report.yml");let i=Gs(),r=`${i.browser} v${i.version}`,s=`${i.os}`,n=navigator.userAgent;e.searchParams.append("browser",r),e.searchParams.append("os",s),e.searchParams.append("useragent",n),e.searchParams.append("URL",window.location.href),e.searchParams.append("version",this.context.version),window.open(e.toString(),"_blank")}};var R6=class extends fi{constructor(e){super(e),this.id="uploader",this.dependencies=new Set(["data","edits","l10n"]),this.changeset=null,this._origChanges=null,this._discardTags={},this._isSaving=!1,this._localGraph=null,this._remoteGraph=null,this._toCheckIDs=new Set,this._toLoadIDs=new Set,this._loadedIDs=new Set,this._conflicts=[],this._errors=[],this._initPromise=null,this._loadedSome=this._loadedSome.bind(this),this._uploadCallback=this._uploadCallback.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let r of this.dependencies)if(!this.context.systems[r])return Promise.reject(`Cannot init:  ${this.id} requires ${r}`);let e=this.context.systems.data,i=e.initAsync();return this._initPromise=i.then(()=>e.getDataAsync("discarded")).then(r=>this._discardTags=r)}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this.changeset=null,Promise.resolve()}isSaving(){return this._isSaving}save(e,i){if(this._isSaving&&!e)return;let r=this.context,s=r.services.osm;if(!s)return;if(!s.authenticated()){s.authenticate(o=>{o||this.save(e,i)});return}this._isSaving||(this._isSaving=!0,this.emit("saveStarted")),this._localGraph=null,this._remoteGraph=null,this._toCheckIDs=new Set,this._toLoadIDs=new Set,this._loadedIDs=new Set,this._conflicts=[],this._errors=[];let n=r.systems.edits;this._origChanges=n.changes(Qu(n.difference(),this._discardTags)),e||n.perform(us()),i?this._startConflictCheck():this._tryUpload()}_startConflictCheck(){let e=this.context,i=e.services.osm,r=e.systems.edits,s=r.difference().summary(),n=e.graph();this._localGraph=n,this._remoteGraph=new Cn(r.base(),!0),this._toCheckIDs=new Set;for(let[o,a]of s)if(a.changeType==="modified"){let l=n.entity(o);this._toCheckIDs.add(o);for(let c of n.childNodes(l))c.version!==void 0&&this._toCheckIDs.add(c.id)}this._toLoadIDs=new Set(this._toCheckIDs),this._loadedIDs=new Set,i&&this._toLoadIDs.size?(this.emit("progressChanged",this._loadedIDs.size,this._toCheckIDs.size),i.loadMultiple(Array.from(this._toLoadIDs),this._loadedSome)):this._tryUpload()}_loadedSome(e,i){if(this._errors.length)return;let r=this.context.systems.l10n,s=this.context.services.osm;if(e){this._errors.push({msg:e.message||e.responseText,details:[r.t("save.status_code",{code:e.status})]}),this._didResultInErrors();return}let n=new Set;for(let o of i.data)if(this._remoteGraph.replace(o),this._loadedIDs.add(o.id),this._toLoadIDs.delete(o.id),!!o.visible){if(o.type==="way")for(let a of o.nodes)this._toCheckIDs.has(a)||(this._toCheckIDs.add(a),this._toLoadIDs.add(a),n.add(a));else if(o.type==="relation"&&o.isMultipolygon())for(let a of o.members)this._toCheckIDs.has(a.id)||(this._toCheckIDs.add(a.id),this._toLoadIDs.add(a.id),n.add(a.id))}this.emit("progressChanged",this._loadedIDs.size,this._toCheckIDs.size),s&&n.size?s.loadMultiple(Array.from(n),this._loadedSome):this._toLoadIDs.size||(this._detectConflicts(),this._tryUpload())}_detectConflicts(){let e=this.context.systems.l10n,i=this.context.systems.edits,r=this.context.services.osm;if(!r)return;let s=this._localGraph,n=this._remoteGraph;for(let c of this._toCheckIDs){let d=s.entity(c),m=n.entity(c);if(l(d,m))continue;let g=Z2(c,{localGraph:s,remoteGraph:n,discardTags:this._discardTags,formatUser:o,localize:e.t,strategy:"safe"});i.replace(g);let _=g.conflicts();if(!_.length)continue;let v=Z2(c,{localGraph:s,remoteGraph:n,discardTags:this._discardTags,formatUser:o,localize:e.t,strategy:"force_local"}),E=Z2(c,{localGraph:s,remoteGraph:n,discardTags:this._discardTags,formatUser:o,localize:e.t,strategy:"force_remote"}),b=e.t("save.conflict."+(m.visible?"keep_local":"restore")),T=e.t("save.conflict."+(m.visible?"keep_remote":"delete"));this._conflicts.push({id:c,name:a(d),details:_,chosen:1,choices:[{id:c,text:b,action:()=>i.replace(v)},{id:c,text:T,action:()=>i.replace(E)}]})}function o(c){return'<a href="'+r.userURL(c)+'" target="_blank">'+c+"</a>"}function a(c){return e.displayName(c.tags)||e.displayType(c.id)+" "+c.id}function l(c,d){if(c.version!==d.version)return!1;if(c.type==="way")for(let m of as(c.nodes,d.nodes)){let g=s.hasEntity(m),_=n.hasEntity(m);if(g&&_&&g.version!==_.version)return!1}return!0}}_tryUpload(){let e=this.context,i=e.services.osm;if(i||this._errors.push({msg:"No OSM Service"}),this.changeset||this._errors.push({msg:"No OSM Changeset"}),this._conflicts.length)this._didResultInConflicts();else if(this._errors.length)this._didResultInErrors();else{let r=e.systems.edits,s=r.changes(Qu(r.difference(),this._discardTags));s.modified.length||s.created.length||s.deleted.length?(this.emit("willAttemptUpload"),i.sendChangeset(this.changeset,s,this._uploadCallback)):this._didResultInNoChanges()}}_uploadCallback(e,i){if(i&&(this.changeset=i),e)if(e.status===409)this.save(!0,!0);else{let r=this.context.systems.l10n;this._errors.push({msg:e.message||e.responseText,details:[r.t("save.status_code",{code:e.status})]}),this._didResultInErrors()}else this._didResultInSuccess()}_didResultInNoChanges(){this.emit("resultNoChanges"),this._endSave()}_didResultInErrors(){this.context.systems.edits.pop(),this.emit("resultErrors",this._errors),this._endSave()}_didResultInConflicts(){this._conflicts.sort((e,i)=>i.id.localeCompare(e.id)),this.emit("resultConflicts",this.changeset,this._conflicts,this._origChanges),this._endSave()}_didResultInSuccess(){this.context.systems.edits.clearSaved(),this.emit("resultSuccess",this.changeset),this._endSave()}_endSave(){this._isSaving=!1,this.emit("saveEnded")}cancelConflictResolution(){this.context.systems.edits.pop()}processResolvedConflicts(){let e=this.context.systems.edits;for(let i of this._conflicts)if(i.chosen===1){let r=this.context.hasEntity(i.id);if((r==null?void 0:r.type)==="way")for(let s of Ei(r.nodes))e.replace(pm(s));e.replace(pm(i.id))}this.save(!0,!1)}};var D6=class extends fi{constructor(e){super(e),this.id="urlhash",this.dependencies=new Set(["edits","l10n","map"]),this.doUpdateTitle=!0,this.titleBase="Rapid";let i=Kh(window.location.hash);this._initParams=new Map(Object.entries(i)),this._initParams.has("datasets")||this._initParams.set("datasets","fbRoads,msBuildings"),this._initParams.has("disable_features")||this._initParams.set("disable_features","boundaries"),this._currParams=new Map(this._initParams),this._currHash=null,this._prevParams=null,this._startPromise=null,this._hashchange=this._hashchange.bind(this),this._updateHash=this._updateHash.bind(this),this._updateTitle=this._updateTitle.bind(this),this.deferredUpdateHash=ol(this._updateHash,500,{leading:!1}),this.deferredUpdateTitle=ol(this._updateTitle,500,{leading:!1})}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){if(this._startPromise)return this._startPromise;let e=Promise.all([this.context.systems.l10n.startAsync(),this.context.systems.edits.startAsync()]);return this._startPromise=e.then(()=>{this._started=!0,this.enable()})}resetAsync(){return Promise.resolve()}enable(){this._enabled||(this._enabled=!0,this._currHash=null,this.context.systems.edits.on("change",this.deferredUpdateTitle),this.context.on("modechange",this.deferredUpdateTitle),window.addEventListener("hashchange",this._hashchange),this._updateHash(),this._hashchange(),this._updateTitle())}disable(){this._enabled&&(this._enabled=!1,this._currHash=null,this.deferredUpdateHash.cancel(),this.deferredUpdateTitle.cancel(),this.context.systems.edits.off("change",this.deferredUpdateTitle),this.context.off("modechange",this.deferredUpdateTitle),window.removeEventListener("hashchange",this._hashchange))}get initialHashParams(){return this._initParams}getParam(e){return this._currParams.get(e)}setParam(e,i){typeof e=="string"&&(i==null||i==="undefined"||i==="null"?this._currParams.delete(e):this._currParams.set(e,i),this._enabled&&this.deferredUpdateHash())}_updateHash(){if(!this._enabled)return;let e=["comment","source","hashtags","walkthrough"],i=dn(Object.fromEntries(this._currParams),e),r="#"+lr(i,!0);r!==this._currHash&&(window.history.replaceState(null,this.titleBase,r),this._currHash=r)}_updateTitle(){if(!this._enabled||!this.doUpdateTitle)return;let e=this.context,i=e.systems.l10n,s=e.systems.edits.difference().summary().size,n,o=e.selectedIDs().filter(c=>e.hasEntity(c));if(o.length){let c=i.displayLabel(e.entity(o[0]),e.graph());o.length>1?n=i.t("title.labeled_and_more",{labeled:c,count:o.length-1}):n=c}let a;s&&n?a="title.format.changes_context":s&&!n?a="title.format.changes":!s&&n&&(a="title.format.context");let l;a?l=i.t(a,{changes:s,base:this.titleBase,context:n}):l=this.titleBase,document.title!==l&&(document.title=l)}_hashchange(){if(!this._enabled)return;this._currHash=window.location.hash;let e=Kh(this._currHash);this._prevParams?this._prevParams=this._currParams:this._prevParams=new Map,this._currParams=new Map(Object.entries(e)),this.emit("hashchange",new Map(this._currParams),new Map(this._prevParams))}};var SA={};A9(SA,{validationAlmostJunction:()=>WS,validationCloseNodes:()=>qS,validationCrossingWays:()=>YS,validationDisconnectedWay:()=>ZS,validationDuplicateWaySegments:()=>QS,validationFormatting:()=>KS,validationHelpRequest:()=>JS,validationImpossibleOneway:()=>eA,validationIncompatibleSource:()=>tA,validationMismatchedGeometry:()=>iA,validationMissingRole:()=>rA,validationMissingTag:()=>sA,validationOutdatedTags:()=>nA,validationPrivateData:()=>oA,validationSuspiciousName:()=>EA,validationUnsquareWay:()=>TA,validationYShapedConnection:()=>wA});function WS(t){let e="almost_junction",i=t.systems.l10n,r=5,s=.75,n=r-s,o=Math.atan(s/r);function a(d){return d.type==="way"&&ml[d.tags.highway]}function l(d){return d.tags.noexit==="yes"||d.tags.amenity==="parking_entrance"||d.tags.entrance&&d.tags.entrance!=="no"}let c=function(m,g){if(!a(m))return[];if(m.isDegenerate())return[];let _=t.systems.edits.tree(),v=M(m),E=[];return v.forEach(z=>{E.push(new or(t,{type:e,subtype:"highway-highway",severity:"warning",message:function(){let Z=t.hasEntity(this.entityIds[0]);if(this.entityIds[0]===this.entityIds[2])return Z?i.tHtml("issues.almost_junction.self.message",{feature:i.displayLabel(Z,t.graph())}):"";{let W=t.hasEntity(this.entityIds[2]);return Z&&W?i.tHtml("issues.almost_junction.message",{feature:i.displayLabel(Z,t.graph()),feature2:i.displayLabel(W,t.graph())}):""}},reference:T,entityIds:[m.id,z.node.id,z.wid],loc:z.node.loc,hash:JSON.stringify(z.node.loc),data:{midId:z.mid.id,edge:z.edge,cross_loc:z.cross_loc},dynamicFixes:b}))}),E;function b(){let z=[new Ti({icon:"rapid-icon-abutment",title:i.tHtml("issues.fix.connect_features.title"),onClick:function(){let W=i.t("issues.fix.connect_almost_junction.annotation"),[,q,Q]=this.issue.entityIds,V=t.entity(this.issue.data.midId),le=t.entity(q),de=t.entity(Q),ne=k(le,de);if(ne.length>0){let fe=F(V,le,ne);if(fe){t.perform(Ya([fe.id,le.id],fe.loc),W);return}}let ee=this.issue.data.edge,re=this.issue.data.cross_loc,ie=[t.entity(ee[0]),t.entity(ee[1])].map(fe=>fe.loc),oe=P8(ie,re);oe.distance<s?t.perform(Ya([oe.id,le.id],oe.loc),W):t.perform(nn({loc:re,edge:ee},le),W)}})],Z=t.hasEntity(this.entityIds[1]);return Z&&!Z.hasInterestingTags()&&z.push(new Ti({icon:"maki-barrier",title:i.tHtml("issues.fix.tag_as_disconnected.title"),onClick:function(){let W=this.issue.entityIds[1],q=Object.assign({},t.entity(W).tags);q.noexit="yes",t.perform(Xr(W,q),i.t("issues.fix.tag_as_disconnected.annotation"))}})),z}function T(z){z.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.almost_junction.highway-highway.reference"))}function A(z,Z){let W=t.services.osm;if(W&&!W.isDataLoaded(z.loc)||l(z)||g.parentWays(z).length!==1)return!1;let q=0;for(let Q in Z.nodes)if(Z.nodes[Q]===z.id&&(q+=1,q>1))return!1;return!0}function M(z){let Z=[];if(z.isClosed())return Z;let W;return[0,z.nodes.length-1].forEach(Q=>{let V=z.nodes[Q],le=g.entity(V);if(!A(le,z))return;let de=U(z,Q);de&&(W=g.childNodes(z).slice(),W[Q]=W[Q].move(de.cross_loc),!Bd(W,V)&&Z.push(de))}),Z}function k(z,Z){return[Z.nodes[0],Z.nodes[Z.nodes.length-1]].map(W=>g.entity(W)).filter(W=>W.id!==z.id&&mr(z.loc,W.loc)<=n)}function F(z,Z,W){let q,Q=1/0;return W.forEach(V=>{let le=t.projection.project(z.loc),de=t.projection.project(Z.loc),ne=t.projection.project(V.loc),ee=fs(le,de)+Math.PI,re=fs(le,ne)+Math.PI,te=Math.max(ee,re)-Math.min(ee,re);te<Q&&(q=V,Q=te)}),Q<=o?q:null}function O(z,Z){return z[Z]!==void 0&&z[Z]!=="no"}function B(z,Z){if(z.id===Z.id)return!0;if((O(z.tags,"bridge")||O(Z.tags,"bridge"))&&!(O(z.tags,"bridge")&&O(Z.tags,"bridge"))||(O(z.tags,"tunnel")||O(Z.tags,"tunnel"))&&!(O(z.tags,"tunnel")&&O(Z.tags,"tunnel")))return!1;let W=z.tags.layer||"0",q=Z.tags.layer||"0";if(W!==q)return!1;let Q=z.tags.level||"0",V=Z.tags.level||"0";return Q===V}function U(z,Z){let W=z.nodes[Z],q=Z===0?z.nodes[1]:z.nodes[z.nodes.length-2],Q=g.entity(W),V=g.entity(q),le=Q.loc[0],de=Q.loc[1],ne=Dn(r,de)/2,ee=Fc(r)/2,re=new mt([le-ne,de-ee],[le+ne,de+ee]),te=mr(V.loc,Q.loc),ie=r/te+1,oe=yr(V.loc,Q.loc,ie),fe=_.waySegments(re,g);for(let Re=0;Re<fe.length;Re++){let He=fe[Re],Je=g.entity(He.wayId);if(!a(Je)||!B(z,Je))continue;let ot=He.nodes[0],yt=He.nodes[1];if(ot===W||yt===W)continue;let bt=g.entity(ot),at=g.entity(yt),Te=Ru([Q.loc,oe],[bt.loc,at.loc]);if(Te)return{mid:V,node:Q,wid:Je.id,edge:[bt.id,at.id],cross_loc:Te}}return null}};return c.type=e,c}function qS(t){let e="close_nodes",i=t.systems.l10n;var r=.2,s=function(n,o){if(n.type==="node")return a(n);if(n.type==="way")return d(n);return[];function a(E){var b=o.parentWays(E);return b.length?m(E,b):_(E)}function l(E){if(E.tags.boundary&&E.tags.boundary!=="no")return"boundary";if(E.tags.indoor&&E.tags.indoor!=="no")return"indoor";if(E.tags.building&&E.tags.building!=="no"||E.tags["building:part"]&&E.tags["building:part"]!=="no")return"building";if(ql[E.tags.highway])return"path";var b=o.parentRelations(E);for(var T in b){var A=b[T];if(A.tags.type==="boundary")return"boundary";if(A.isMultipolygon()){if(A.tags.indoor&&A.tags.indoor!=="no")return"indoor";if(A.tags.building&&A.tags.building!=="no"||A.tags["building:part"]&&A.tags["building:part"]!=="no")return"building"}}return"other"}function c(E){if(E.nodes.length<=2||E.isClosed()&&E.nodes.length<=4)return!1;var b=E.extent(o).bbox(),T=mr([b.minX,b.minY],[b.maxX,b.maxY]);return!(T<1.5)}function d(E){if(!c(E))return[];for(var b=[],T=o.childNodes(E),A=0;A<T.length-1;A++){var M=T[A],k=T[A+1],F=v(M,k,E);F&&b.push(F)}return b}function m(E,b){var T=[];function A(B,U,z){var Z=v(B,U,z);Z&&T.push(Z)}for(var M=0;M<b.length;M++){var k=b[M];if(c(k))for(var F=k.nodes.length-1,O=0;O<k.nodes.length;O++)O!==0&&k.nodes[O-1]===E.id&&A(E,o.entity(k.nodes[O]),k),O!==F&&k.nodes[O+1]===E.id&&A(o.entity(k.nodes[O]),E,k)}return T}function g(E){if(!c(E))return 0;var b=l(E);return b==="boundary"?0:b==="indoor"?.01:b==="building"?.05:b==="path"?.1:.2}function _(E){for(var b=[],T=E.loc[0],A=E.loc[1],M=Dn(r,A)/2,k=Fc(r)/2,F=new mt([T-M,A-k],[T+M,A+k]),O=t.systems.edits.tree().intersects(F,o),B=0;B<O.length;B++){var U=O[B];if(U.id!==E.id&&!(U.type!=="node"||U.geometry(o)!=="point")&&(U.loc===E.loc||mr(E.loc,U.loc)<r)){if("memorial:type"in E.tags&&"memorial:type"in U.tags&&E.tags["memorial:type"]==="stolperstein"&&U.tags["memorial:type"]==="stolperstein"||"memorial"in E.tags&&"memorial"in U.tags&&E.tags.memorial==="stolperstein"&&U.tags.memorial==="stolperstein")continue;var z={layer:!0,level:!0,"addr:housenumber":!0,"addr:unit":!0},Z=!1;for(var W in z){var q=E.tags[W]||"0",Q=U.tags[W]||"0";if(q!==Q){Z=!0;break}}if(Z)continue;b.push(new or(t,{type:e,subtype:"detached",severity:"warning",message:function(){var le=t.hasEntity(this.entityIds[0]),de=t.hasEntity(this.entityIds[1]);return le&&de?i.tHtml("issues.close_nodes.detached.message",{feature:i.displayLabel(le,t.graph()),feature2:i.displayLabel(de,t.graph())}):""},reference:V,entityIds:[E.id,U.id],dynamicFixes:function(){return[new Ti({icon:"rapid-operation-disconnect",title:i.tHtml("issues.fix.move_points_apart.title")}),new Ti({icon:"rapid-icon-layers",title:i.tHtml("issues.fix.use_different_layers_or_levels.title")})]}}))}}return b;function V(le){var de=i.t("issues.close_nodes.detached.reference");le.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(de)}}function v(E,b,T){if(E.id===b.id||E.hasInterestingTags()&&b.hasInterestingTags())return null;if(E.loc!==b.loc){var A=o.parentWays(E),M=new Set(o.parentWays(b)),k=A.filter(function(z){return M.has(z)}),F=k.map(function(z){return g(z)}),O=Math.min(...F),B=mr(E.loc,b.loc);if(B>O)return null}return new or(t,{type:e,subtype:"vertices",severity:"warning",message:function(){var z=t.hasEntity(this.entityIds[0]);return z?i.tHtml("issues.close_nodes.message",{way:i.displayLabel(z,t.graph())}):""},reference:U,entityIds:[T.id,E.id,b.id],loc:E.loc,dynamicFixes:function(){return[new Ti({icon:"rapid-icon-plus",title:i.tHtml("issues.fix.merge_points.title"),onClick:function(){var z=this.issue.entityIds,Z=Ya([z[1],z[2]]);t.perform(Z,i.t("issues.fix.merge_close_vertices.annotation"))}}),new Ti({icon:"rapid-operation-disconnect",title:i.tHtml("issues.fix.move_points_apart.title")})]}});function U(z){var Z=i.t("issues.close_nodes.reference");z.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(Z)}}};return s.type=e,s}function YS(t){let e="crossing_ways",i=t.systems.l10n;function r(O,B){if(c(O,B)===null)for(var U=B.parentRelations(O),z=0;z<U.length;z++){var Z=U[z];if(c(Z,B)!==null)return Z}return O}function s(O,B){return O[B]!==void 0&&O[B]!=="no"}function n(O){return s(O,"indoor")||s(O,"level")||O.highway==="corridor"}function o(O){return O==="highway"||O==="railway"||O==="waterway"||O==="aeroway"}function a(O){return O==="highway"||O==="railway"||O==="waterway"}var l={demolished:!0,dismantled:!0,proposed:!0,razed:!0};function c(O,B){var U=O.geometry(B);if(U!=="line"&&U!=="area")return null;var z=O.tags;return z.aeroway in HI?"aeroway":s(z,"building")&&!l[z.building]?"building":s(z,"highway")&&ml[z.highway]?"highway":U!=="line"?null:s(z,"railway")&&B9[z.railway]?"railway":s(z,"waterway")&&yf[z.waterway]&&O.tags.intermittent!=="yes"?"waterway":null}function d(O,B,U,z){var Z=O.level||"0",W=U.level||"0";if(n(O)&&n(U)&&Z!==W)return!0;var q=O.layer||"0",Q=U.layer||"0";if(B==="highway"&&z==="highway"&&q!==Q)return!0;if(o(B)&&o(z)){if(s(O,"bridge")&&!s(U,"bridge")||!s(O,"bridge")&&s(U,"bridge")||s(O,"bridge")&&s(U,"bridge")&&q!==Q)return!0}else{if(o(B)&&s(O,"bridge"))return!0;if(o(z)&&s(U,"bridge"))return!0}if(a(B)&&a(z)){if(s(O,"tunnel")&&!s(U,"tunnel")||!s(O,"tunnel")&&s(U,"tunnel")||s(O,"tunnel")&&s(U,"tunnel")&&q!==Q)return!0}else{if(a(B)&&s(O,"tunnel"))return!0;if(a(z)&&s(U,"tunnel"))return!0}return B==="waterway"&&z==="highway"&&U.man_made==="pier"||z==="waterway"&&B==="highway"&&O.man_made==="pier"||(B==="building"||z==="building")&&q!==Q}var m={motorway:!0,motorway_link:!0,trunk:!0,trunk_link:!0,primary:!0,primary_link:!0,secondary:!0,secondary_link:!0},g={track:!0};function _(O,B,U){var z=c(O,U),Z=c(B,U),W=O.geometry(U),q=B.geometry(U),Q=W==="line"&&q==="line";let V=[z,Z].sort().join("-");if(V==="aeroway-aeroway")return{};if(V==="aeroway-highway"){let ie=O.tags.highway==="service"||B.tags.highway==="service",oe=O.tags.highway in ql||B.tags.highway in ql;return ie||oe?{}:{aeroway:"aircraft_crossing"}}if(V==="aeroway-railway")return{aeroway:"aircraft_crossing",railway:"level_crossing"};if(V==="aeroway-waterway")return null;if(z===Z){if(z==="highway"){var le=ql[O.tags.highway],de=ql[B.tags.highway];if((le||de)&&le!==de){var ne=le?B:O;if(!Q||g[ne.tags.highway])return{};var ee={highway:"crossing"},re=le?O:B;for(let ie of["crossing","crossing:markings","crossing:signals"])re.tags[ie]&&(ee[ie]=re.tags[ie]);return ee}return{}}if(z==="waterway")return{};if(z==="railway")return{}}else if(V.includes("highway")){if(V.includes("railway")){if(!Q)return{};var te=O.tags.railway==="tram"||B.tags.railway==="tram";return ql[O.tags.highway]||ql[B.tags.highway]?te?{railway:"tram_crossing"}:{railway:"crossing"}:te?{railway:"tram_level_crossing"}:{railway:"level_crossing"}}if(V.includes("waterway"))return s(O.tags,"tunnel")&&s(B.tags,"tunnel")||s(O.tags,"bridge")&&s(B.tags,"bridge")||m[O.tags.highway]||m[B.tags.highway]?null:Q?{ford:"yes"}:{}}return null}function v(O,B,U){var z=[];if(O.type!=="way")return z;var Z=r(O,B),W=c(Z,B);if(W===null)return z;var q={},Q,V,le,de,ne,ee,re,te,ie,oe,fe,Re,He,Je,ot,yt,bt,at=B.childNodes(O),Te={};for(Q=0;Q<at.length-1;Q++)for(de=at[Q],ne=at[Q+1],le=new mt([Math.min(de.loc[0],ne.loc[0]),Math.min(de.loc[1],ne.loc[1])],[Math.max(de.loc[0],ne.loc[0]),Math.max(de.loc[1],ne.loc[1])]),He=U.waySegments(le,B),V=0;V<He.length;V++)if(Je=He[V],Je.wayId!==O.id&&!q[Je.wayId]&&(Te[Je.wayId]=!0,ot=B.hasEntity(Je.wayId),!!ot&&(yt=r(ot,B),bt=c(yt,B),!(bt===null||d(Z.tags,W,yt.tags,bt))&&(Re=W==="building"||bt==="building",te=Je.nodes[0],ie=Je.nodes[1],!(te===de.id||te===ne.id||ie===de.id||ie===ne.id)&&(ee=B.hasEntity(te),!!ee&&(re=B.hasEntity(ie),!!re)))))){oe=[de.loc,ne.loc],fe=[ee.loc,re.loc];var Ze=Ru(oe,fe);if(Ze&&(z.push({wayInfos:[{way:O,featureType:W,edge:[de.id,ne.id]},{way:ot,featureType:bt,edge:[ee.id,re.id]}],crossPoint:Ze}),Re)){q[ot.id]=!0;break}}return z}function E(O,B){var U=c(O,B);return U?O.type==="way"?[O]:O.type==="relation"?O.members.reduce(function(z,Z){if(Z.type==="way"&&(!Z.role||Z.role==="outer"||Z.role==="inner")){var W=B.hasEntity(Z.id);W&&!z.includes(W)&&z.push(W)}return z},[]):[]:[]}var b=function(B,U){var z=t.systems.edits.tree(),Z=E(B,U),W=[],q,Q,V;for(q in Z){V=v(Z[q],U,z);for(Q in V)W.push(T(V[Q],U))}return W};function T(O,B){O.wayInfos.sort(function(ie,oe){var fe=ie.featureType,Re=oe.featureType;return fe===Re?i.displayLabel(ie.way,B)>i.displayLabel(oe.way,B):fe==="waterway"?!0:Re==="waterway"?!1:fe<Re});var U=O.wayInfos.map(function(ie){return r(ie.way,B)}),z=[O.wayInfos[0].edge,O.wayInfos[1].edge],Z=[O.wayInfos[0].featureType,O.wayInfos[1].featureType],W=_(U[0],U[1],B),q=O.wayInfos[0].featureType,Q=O.wayInfos[1].featureType,V=n(U[0].tags)&&n(U[1].tags),le=a(q)&&s(U[0].tags,"tunnel")&&a(Q)&&s(U[1].tags,"tunnel"),de=o(q)&&s(U[0].tags,"bridge")&&o(Q)&&s(U[1].tags,"bridge"),ne=[q,Q].sort().join("-"),ee=ne;V?ee="indoor-indoor":le?ee="tunnel-tunnel":de&&(ee="bridge-bridge"),W&&(V||le||de)&&(ee+="_connectable");var re=""+O.crossPoint[0].toFixed(4)+","+O.crossPoint[1].toFixed(4);return new or(t,{type:e,subtype:ne,severity:"warning",message:function(){var ie=t.graph(),oe=ie.hasEntity(this.entityIds[0]),fe=ie.hasEntity(this.entityIds[1]);return oe&&fe?i.tHtml("issues.crossing_ways.message",{feature:i.displayLabel(oe,ie),feature2:i.displayLabel(fe,ie)}):""},reference:te,entityIds:U.map(function(ie){return ie.id}),data:{edges:z,featureTypes:Z,connectionTags:W},hash:re,loc:O.crossPoint,autoArgs:W&&!W.ford&&M(O.crossPoint,z,W),dynamicFixes:function(){var ot;var ie=t.selectedIDs();if(((ot=t.mode)==null?void 0:ot.id)!=="select-osm"||ie.length!==1)return[];var oe=this.entityIds[0]===ie[0]?0:1,fe=this.data.featureTypes[oe],Re=this.data.featureTypes[oe===0?1:0],He=[];if(W&&He.push(k(this.data.connectionTags)),V)He.push(new Ti({icon:"rapid-icon-layers",title:i.tHtml("issues.fix.use_different_levels.title")}));else if(le||de||q==="building"||Q==="building")He.push(F("higher")),He.push(F("lower"));else if(t.graph().geometry(this.entityIds[0])==="line"&&t.graph().geometry(this.entityIds[1])==="line"){o(fe)&&fe!=="waterway"&&He.push(A("add_a_bridge","temaki-bridge","bridge"));var Je=Re==="waterway"&&fe!=="waterway";a(fe)&&!Je&&He.push(A("add_a_tunnel","temaki-tunnel","tunnel"))}return He.push(new Ti({icon:"rapid-operation-move",title:i.tHtml("issues.fix.reposition_features.title")})),He}});function te(ie){ie.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.crossing_ways."+ee+".reference"))}}function A(O,B,U){return new Ti({icon:B,title:i.tHtml("issues.fix."+O+".title"),onClick:function(){var ee;if(((ee=t.mode)==null?void 0:ee.id)==="select-osm"){var z=t.selectedIDs();if(z.length===1){var Z=z[0];if(t.hasEntity(Z)){var W=[Z],q,Q,V;this.issue.entityIds[0]===Z?(q=this.issue.data.edges[0],Q=this.issue.data.edges[1],V=this.issue.entityIds[1]):(q=this.issue.data.edges[1],Q=this.issue.data.edges[0],V=this.issue.entityIds[0]);var le=this.issue.loc,de=t.projection,ne=function(te){var ie=[te.entity(q[0]),te.entity(q[1])],oe=te.hasEntity(V),fe=oe&&oe.tags.width&&parseFloat(oe.tags.width);fe||(fe=oe&&oe.impliedLineWidthMeters()),fe?c(oe,te)==="railway"&&(fe*=2):fe=8;var Re=fs(de.project(ie[0].loc),de.project(ie[1].loc))+Math.PI,He=fs(de.project(te.entity(Q[0]).loc),de.project(te.entity(Q[1]).loc))+Math.PI,Je=Math.max(Re,He)-Math.min(Re,He);Je>Math.PI&&(Je-=Math.PI),fe=fe/2/Math.sin(Je)*2,fe+=4,fe=Math.min(Math.max(fe,4),50);function ot(rt){return[K3(rt[0],rt[1]),cw(rt[1])]}function yt(rt){var ct=Fc(rt[1]);return[Dn(rt[0],ct),ct]}var bt=ot(ie[0].loc),at=ot(ie[1].loc),Te=fs(bt,at),Ze=ot(le),xt=Xi(bt,at)/mr(ie[0].loc,ie[1].loc);function It(rt,ct){var Vt=ct*xt;return yt([Ze[0]+Math.cos(rt)*Vt,Ze[1]+Math.sin(rt)*Vt])}var Bt=function(rt){return It(Te,rt)},Mi=function(rt){return It(Te+Math.PI,rt)},je=.55;function be(rt,ct,Vt){var ti,lt=fe/2,Nt=mr(le,ct.loc);if(Nt-lt>je){var Lt=Vt(lt);ti=vi(),te=nn({loc:Lt,edge:rt},ti)(te)}else{var qi=0;if(ct.parentIntersectionWays(te).forEach(function(kt){kt.nodes.forEach(function(Zt){Zt===ct.id&&(ct.id===kt.first()&&ct.id!==kt.last()||ct.id===kt.last()&&ct.id!==kt.first()?qi+=1:qi+=2)})}),qi>=3){var Vi=Nt-je;if(Vi>je){var Ke=Vt(Vi);ti=vi(),te=nn({loc:Ke,edge:rt},ti)(te)}}}ti||(ti=ct);var dt=Ku([ti.id]).limitWays(W);return te=dt(te),dt.getCreatedWayIDs().length&&W.push(dt.getCreatedWayIDs()[0]),ti}var ge=be(q,ie[1],Bt),xe=be([ie[0].id,ge.id],ie[0],Mi),Me=W.map(function(rt){return te.entity(rt)}).find(function(rt){return rt.nodes.includes(ge.id)&&rt.nodes.includes(xe.id)}),Oe=Object.assign({},Me.tags);if(U==="bridge")Oe.bridge="yes",Oe.layer="1";else{var De="yes";c(Me,te)==="waterway"&&(De="culvert"),Oe.tunnel=De,Oe.layer="-1"}return te=Xr(Me.id,Oe)(te),te};t.perform(ne,i.t(`issues.fix.${O}.annotation`)),t.enter("select-osm",{selectedIDs:W})}}}}})}function M(O,B,U){var z=function(W){var q=!1,Q=vi({loc:O,tags:U}),V=W.replace(Q),le=[Q.id],de=.75;return B.forEach(function(ne){var ee=V.hasEntity(ne[0]),re=V.hasEntity(ne[1]);if(!(!ee||!re)){var te=!1,ie=[ee,re],oe=P8([ee.loc,re.loc],O);if(oe&&oe.distance<de){var fe=ie[oe.index];(!fe.hasInterestingTags()||fe.isCrossing())&&(te=!0,le.push(fe.id))}te||(V=nn({loc:O,edge:ne},Q)(V),q=!0)}}),le.length>1&&(V=Ya(le,O)(V),q=!0),q?V:W};return[z,i.t("issues.fix.connect_crossing_features.annotation")]}function k(O){var B="connect_features";return O.ford&&(B="connect_using_ford"),new Ti({icon:"rapid-icon-crossing",title:i.tHtml(`issues.fix.${B}.title`),onClick:function(){var U=this.issue.loc,z=this.issue.data.edges,Z=this.issue.data.connectionTags,W=M(U,z,Z);t.perform(W[0],W[1])}})}function F(O){return new Ti({icon:"rapid-icon-"+(O==="higher"?"up":"down"),title:i.tHtml(`issues.fix.tag_this_as_${O}.title`),onClick:function(){var q;if(((q=t.mode)==null?void 0:q.id)==="select-osm"){var B=t.selectedIDs();if(B.length===1){var U=B[0];if(this.issue.entityIds.some(function(Q){return Q===U})){var z=t.hasEntity(U);if(z){var Z=Object.assign({},z.tags),W=Z.layer&&Number(Z.layer);W&&!isNaN(W)?O==="higher"?W+=1:W-=1:O==="higher"?W=1:W=-1,Z.layer=W.toString(),t.perform(Xr(z.id,Z),i.t("operations.change_tags.annotation"))}}}}}})}return b.type=e,b}function ZS(t){let e="disconnected_way",i=t.systems.l10n;function r(n){return ml[n.tags.highway]}let s=function(o,a){let l=m(o);if(!l)return[];return[new or(t,{type:e,subtype:"highway",severity:"warning",message:function(){let b=this.entityIds.length&&t.hasEntity(this.entityIds[0]),T=b&&i.displayLabel(b,t.graph());return i.tHtml("issues.disconnected_way.routable.message",{count:this.entityIds.length,highway:T})},reference:d,entityIds:Array.from(l).map(b=>b.id),dynamicFixes:c})];function c(){let b=this.entityIds.length===1&&t.hasEntity(this.entityIds[0]),T=[];if(b){if(b.type==="way"&&!b.isClosed()){let A=E(b.first(),"start");A&&T.push(A);let M=E(b.last(),"end");M&&T.push(M)}T.length||T.push(new Ti({title:i.tHtml("issues.fix.connect_feature.title")})),T.push(new Ti({icon:"rapid-operation-delete",title:i.tHtml("issues.fix.delete_feature.title"),entityIds:[b.id],onClick:function(){let A=this.issue.entityIds[0],M=oa(t,[A]);M.disabled()||M()}}))}else T.push(new Ti({title:i.tHtml("issues.fix.connect_features.title")}));return T}function d(b){b.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.disconnected_way.routable.reference"))}function m(b){let T=new Set,A=[];function M(k){for(let F of a.parentWays(k))!T.has(F)&&v(F,!1)&&(T.add(F),A.push(F))}if(b.type==="way"&&v(b,!0))T.add(b),A.push(b);else if(b.type==="node"&&_(b))T.add(b),M(b);else return null;for(;A.length;){let k=A.pop();for(let F of a.childNodes(k)){if(g(F))return null;_(F)&&T.add(F),M(F)}}return T}function g(b){let T=t.services.osm;return!!(T&&!T.isDataLoaded(b.loc)||b.tags.entrance&&b.tags.entrance!=="no"||b.tags.amenity==="parking_entrance")}function _(b){return b.tags.highway==="elevator"}function v(b,T){return r(b)||b.tags.route==="ferry"?!0:a.parentRelations(b).some(A=>!!(A.tags.type==="route"&&A.tags.route==="ferry"||A.isMultipolygon()&&r(A)&&(!T||A.memberById(b.id).role!=="inner")))}function E(b,T){let A=a.hasEntity(b);if(!A||A.tags.noexit==="yes")return null;let M=i.isRTL(),k=T==="start"&&!M||T==="end"&&M;return new Ti({icon:"rapid-operation-continue"+(k?"-left":""),title:i.tHtml(`issues.fix.continue_from_${T}.title`),entityIds:[b],onClick:function(){let F=this.issue.entityIds[0],O=t.hasEntity(F),B=this.entityIds[0],U=t.hasEntity(B);if(!O||!U)return;let z=t.systems.map;(!t.editable()||!z.trimmedExtent().contains(new mt(U.loc)))&&z.fitEntitiesEase(U),t.enter("draw-line",{continueWay:O,continueNode:U})}})}};return s.type=e,s}function QS(t){let e="duplicate_way_segments",i=t.systems.l10n,r=function(s,n){if(s.type==="way")return c(s);return[];function o(m){return m==="highway"||m==="railway"||m==="waterway"}function a(m){return m.isArea()?!1:Object.keys(m.tags).some(o)}function l(m,g,_){let v=n.childNodes(_),E=v.findIndex(T=>T.id===m.id),b=v.findIndex(T=>T.id===g.id);return Math.abs(E-b)===1}function c(m){let g=[];if(!a(m))return g;let _=n.childNodes(m);for(let v=0;v<_.length-1;v++){let E=_[v],b=_[v+1],T=d(E,b,m);T&&g.push(T)}return g}function d(m,g,_){if(m.id===g.id)return null;if(m.loc!==g.loc){let E=n.parentWays(m),b=new Set(n.parentWays(g));if(E.filter(k=>b.has(k)).filter(k=>a(k)).filter(k=>l(m,g,k)).length<=1)return null}return new or(t,{type:e,subtype:"vertices",severity:"warning",message:function(){let E=t.hasEntity(this.entityIds[0]);return E?i.tHtml("issues.duplicate_way_segments.message",{way:i.displayLabel(E,t.graph())}):""},reference:v,entityIds:[_.id,m.id,g.id],loc:m.loc,dynamicFixes:function(){return[new Ti({icon:"rapid-icon-plus",title:i.tHtml("issues.fix.merge_points.title")}),new Ti({icon:"rapid-operation-delete",title:i.tHtml("issues.fix.remove_way_segments.title")}),new Ti({icon:"rapid-operation-disconnect",title:i.tHtml("issues.fix.move_way_segments_apart.title")})]}});function v(E){E.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.t("issues.duplicate_way_segments.reference"))}}};return r.type=e,r}function KS(t){let e="invalid_format",i=t.systems.l10n,r=function(s){let n=[];function o(l){return!l||/^[^\(\)\\,":;<>@\[\]]+@[^\(\)\\,":;<>@\[\]\.]+(?:\.[a-z0-9-]+)*$/i.test(l)}function a(l){l.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.invalid_format.email.reference"))}if(s.tags.email){let l=s.tags.email.split(";").map(c=>c.trim()).filter(c=>!o(c));l.length&&n.push(new or(t,{type:e,subtype:"email",severity:"warning",message:function(){let c=t.hasEntity(this.entityIds[0]);return c?i.tHtml("issues.invalid_format.email.message"+this.data,{feature:i.displayLabel(c,t.graph()),email:l.join(", ")}):""},reference:a,entityIds:[s.id],hash:l.join(),data:l.length>1?"_multi":""}))}return n};return r.type=e,r}function JS(t){let e="help_request",i=t.systems.l10n,r=function(n){if(!n.tags.fixme)return[];if(n.version===void 0)return[];if(n.v!==void 0){let a=t.systems.edits.base().hasEntity(n.id);if(!a||!a.tags.fixme)return[]}return[new or(t,{type:e,subtype:"fixme_tag",severity:"warning",message:function(){let a=t.hasEntity(this.entityIds[0]);return a?i.tHtml("issues.fixme_tag.message",{feature:i.displayLabel(a,t.graph(),!0)}):""},dynamicFixes:()=>[new Ti({title:i.tHtml("issues.fix.address_the_concern.title")})],reference:o,entityIds:[n.id]})];function o(a){a.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.fixme_tag.reference"))}};return r.type=e,r}function eA(t){let e="impossible_oneway",i=t.systems.l10n,r=function(o,a){if(o.type!=="way"||o.geometry(a)!=="line")return[];if(o.isClosed())return[];if(!d(o))return[];if(!o.isOneWay())return[];if(o.tags.intermittent==="yes")return[];let l=_(o,o.first()),c=_(o,o.last());return l.concat(c);function d(v){return v.geometry(a)!=="line"?null:ml[v.tags.highway]?"highway":yf[v.tags.waterway]?"waterway":null}function m(v,E){return v.nodes.indexOf(E)!==v.nodes.lastIndexOf(E)}function g(v,E){let b=d(v);if(b==="highway"){if(E.tags.entrance&&E.tags.entrance!=="no"||E.tags.amenity==="parking_entrance")return!0}else if(b==="waterway"){if(E.id===v.first()){if(E.tags.natural==="spring")return!0}else if(E.tags.manhole==="drain")return!0}return a.parentWays(E).some(T=>T.id===v.id?!1:b==="highway"?T.geometry(a)==="area"&&ml[T.tags.highway]||T.tags.route==="ferry"?!0:a.parentRelations(T).some(A=>A.tags.type==="route"&&A.tags.route==="ferry"?!0:A.isMultipolygon()&&ml[A.tags.highway]):b==="waterway"&&(T.tags.natural==="water"||T.tags.natural==="coastline"))}function _(v,E){let b=E===v.first(),T=d(v);if(m(v,E))return[];let A=t.services.osm;if(!A)return[];let M=a.hasEntity(E);if(!M||!A.isDataLoaded(M.loc))return[];if(g(v,M))return[];let k=a.parentWays(M).filter(Z=>Z.id===v.id?!1:d(Z)===T);if(T==="waterway"&&k.length===0)return[];let F=k.filter(Z=>Z.isOneWay());if(F.length<k.length)return[];if(F.length&&F.some(W=>!!((b?W.first():W.last())!==E||m(W,E))))return[];let O=b?"start":"end",B,U;return T==="waterway"?(B=`${T}.connected.${O}`,U=`${T}.connected`):(B=`${T}.${O}`,U=`${T}.${O}`),[new or(t,{type:e,subtype:T,severity:"warning",message:function(){let Z=t.hasEntity(this.entityIds[0]);return Z?i.tHtml(`issues.impossible_oneway.${B}.message`,{feature:i.displayLabel(Z,t.graph())}):""},reference:z(U),entityIds:[v.id,M.id],dynamicFixes:function(){let Z=[];if(F.length&&Z.push(new Ti({icon:"rapid-operation-reverse",title:i.tHtml("issues.fix.reverse_feature.title"),entityIds:[v.id],onClick:function(){let W=this.issue.entityIds[0];t.perform(pl(W),i.t("operations.reverse.annotation.line",{n:1}))}})),M.tags.noexit!=="yes"){let W=i.isRTL(),q=b&&!W||!b&&W;Z.push(new Ti({icon:"rapid-operation-continue"+(q?"-left":""),title:i.tHtml("issues.fix.continue_from_"+(b?"start":"end")+".title"),onClick:function(){let Q=this.issue.entityIds[0],V=this.issue.entityIds[1],le=t.entity(Q),de=t.entity(V);s(le,de,t)}}))}return Z},loc:M.loc})];function z(Z){return function(q){q.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml(`issues.impossible_oneway.${Z}.reference`))}}}};function s(n,o,a){let l=a.systems.map;(!a.editable()||!l.trimmedExtent().contains(new mt(o.loc)))&&l.fitEntitiesEase(o),a.enter("draw-line",{continueWay:n,continueNode:o})}return r.type=e,r}function tA(t){let e="incompatible_source",i=t.systems.l10n,r=[{id:"amap",regex:/(amap|autonavi|mapabc|)/i},{id:"baidu",regex:/(baidu|mapbar|)/i},{id:"google",regex:/google/i,exceptRegex:/((books|drive)\.google|google\s?(books|drive|plus))|(esri\/Google_Africa_Buildings)/i}],s=function(o){let a=o.tags&&o.tags.source&&o.tags.source.split(";");if(!a)return[];let l=o.id;return a.map(d=>{let m=r.find(g=>!(!g.regex.test(d)||g.exceptRegex&&g.exceptRegex.test(d)));return m?new or(t,{type:e,severity:"warning",message:()=>{let g=t.hasEntity(l);return g?i.tHtml("issues.incompatible_source.feature.message",{feature:i.displayLabel(g,t.graph(),!0),value:d}):""},reference:c(m.id),entityIds:[l],hash:d,dynamicFixes:()=>[new Ti({title:i.tHtml("issues.fix.remove_proprietary_data.title")})]}):null}).filter(Boolean);function c(d){return function(g){g.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml(`issues.incompatible_source.reference.${d}`))}}};return s.type=e,s}var JO=Yi(H2(),1);function iA(t){let e="mismatched_geometry",i=t.systems.l10n,r=t.systems.presets;function s(_){if(_.type!=="way"||_.isClosed())return null;var v=_.tagSuggestingArea();if(!v)return null;var E=r.matchTags(v,"line"),b=r.matchTags(v,"area");return E&&b&&E===b?null:v}function n(_,v){if(_.nodes.length<3)return null;var E=v.childNodes(_),b,T=mr(E[0].loc,E[E.length-1].loc);if(T<.75&&(b=E.slice(),b.pop(),b.push(b[0]),!Bd(b,b[0].id)))return function(){var A=t.entity(this.issue.entityIds[0]);t.perform(Ya([A.nodes[0],A.nodes[A.nodes.length-1]],E[0].loc),i.t("issues.fix.connect_endpoints.annotation"))};if(b=E.slice(),b.push(b[0]),!Bd(b,b[0].id))return function(){var A=this.issue.entityIds[0],M=t.entity(A),k=M.nodes[0],F=M.nodes.length;t.perform(To(A,k,F),i.t("issues.fix.connect_endpoints.annotation"))}}function o(_){var v=s(_);if(!v)return null;return new or(t,{type:e,subtype:"area_as_line",severity:"warning",message:function(){var b=t.hasEntity(this.entityIds[0]);return b?i.tHtml("issues.tag_suggests_area.message",{feature:i.displayLabel(b,"area",!0),tag:zI({tags:v})}):""},reference:E,entityIds:[_.id],hash:JSON.stringify(v),dynamicFixes:function(){var b=[],T=t.entity(this.entityIds[0]),A=n(T,t.graph());return b.push(new Ti({title:i.tHtml("issues.fix.connect_endpoints.title"),onClick:A})),b.push(new Ti({icon:"rapid-operation-delete",title:i.tHtml("issues.fix.remove_tag.title"),onClick:function(){var M=this.issue.entityIds[0],k=t.entity(M),F=Object.assign({},k.tags);for(var O in v)delete F[O];t.perform(Xr(M,F),i.t("issues.fix.remove_tag.annotation"))}})),b}});function E(b){b.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.tag_suggests_area.reference"))}}function a(_,v){if(_.type!=="node"||Object.keys(_.tags).length===0||_.isOnAddressLine(v))return null;var E=_.geometry(v),b=N1(_.tags);return E==="point"&&!b.point&&b.vertex?new or(t,{type:e,subtype:"vertex_as_point",severity:"warning",message:function(){var T=t.hasEntity(this.entityIds[0]);return T?i.tHtml("issues.vertex_as_point.message",{feature:i.displayLabel(T,"vertex",!0)}):""},reference:function(A){A.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.vertex_as_point.reference"))},entityIds:[_.id]}):E==="vertex"&&!b.vertex&&b.point?new or(t,{type:e,subtype:"point_as_vertex",severity:"warning",message:function(){var T=t.hasEntity(this.entityIds[0]);return T?i.tHtml("issues.point_as_vertex.message",{feature:i.displayLabel(T,"point",!0)}):""},reference:function(A){A.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.point_as_vertex.reference"))},entityIds:[_.id],dynamicFixes:d}):null}function l(_,v){if(!_.hasInterestingTags()||_.type!=="node"&&_.type!=="way"||_.type==="node"&&_.isOnAddressLine(v))return null;var E=_.geometry(v),b=_.type==="way"?["point","vertex"]:["line","area"];E==="area"&&b.unshift("line");var T=r.match(_,v),A=b.find(O=>{var B=r.matchTags(_.tags,O);if(!T||!B||T===B||(0,JO.default)(T.tags,B.tags)||B.isFallback())return!1;var U=Object.keys(B.tags)[0];return U==="building"||B.tags[U]==="*"?!1:T.isFallback()||T.tags[U]==="*"});if(!A)return null;var M=A+"_as_"+E;A==="vertex"&&(A="point"),E==="vertex"&&(E="point");var k=A+"_as_"+E,F;return A==="point"?F=d:E==="area"&&A==="line"&&(F=c),new or(t,{type:e,subtype:M,severity:"warning",message:function(){var O=t.hasEntity(this.entityIds[0]);return O?i.tHtml("issues."+k+".message",{feature:i.displayLabel(O,A,!0)}):""},reference:function(B){B.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.mismatched_geometry.reference"))},entityIds:[_.id],dynamicFixes:F})}function c(){var _,v=this.entityIds[0],E=t.entity(v),b=Object.assign({},E.tags);return delete b.area,L1(b)||(_=function(){var T=this.issue.entityIds[0],A=t.entity(T),M=Object.assign({},A.tags);M.area&&delete M.area,t.perform(Xr(T,M),i.t("issues.fix.convert_to_line.annotation"))}),[new Ti({icon:"rapid-icon-line",title:i.tHtml("issues.fix.convert_to_line.title"),onClick:_})]}function d(){var _=this.entityIds[0],v=null;return t.hasHiddenConnections(_)||(v=function(){var E=this.issue.entityIds[0],b=G2(E,t.projection);t.perform(b,i.t("operations.extract.annotation",{n:1})),t.enter("select-osm",{selectedIDs:[b.getExtractedNodeID()]})}),[new Ti({icon:"rapid-operation-extract",title:i.tHtml("issues.fix.extract_point.title"),onClick:v})]}function m(_,v){if(_.type!=="relation"||!_.isMultipolygon()||_.isDegenerate()||!_.isComplete(v))return[];var E=wa(_.members,v),b=[];for(var T in E){var A=E[T];if(A.nodes){var M=A.nodes[0],k=A.nodes[A.nodes.length-1];if(M!==k){var F=new or(t,{type:e,subtype:"unclosed_multipolygon_part",severity:"warning",message:function(){var B=t.hasEntity(this.entityIds[0]);return B?i.tHtml("issues.unclosed_multipolygon_part.message",{feature:i.displayLabel(B,t.graph(),!0)}):""},reference:O,loc:A.nodes[0].loc,entityIds:[_.id],hash:A.map(function(B){return B.id}).join()});b.push(F)}}}return b;function O(B){B.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.unclosed_multipolygon_part.reference"))}}var g=function(v,E){var b=a(v,E);if(b)return[b];var T=o(v);if(T)return[T];var A=l(v,E);return A?[A]:m(v,E)};return g.type=e,g}function rA(t){let e="missing_role",i=t.systems.l10n,r=function(l,c){let d=[];if(l.type==="way")for(let m of c.parentRelations(l)){if(!m.isMultipolygon())continue;let g=m.memberById(l.id);g&&s(g)&&d.push(n(l,m,g))}else if(l.type==="relation"&&l.isMultipolygon())for(let m of l.indexedMembers()){let g=c.hasEntity(m.id);g&&s(m)&&d.push(n(g,l,m))}return d};function s(a){return!a.role||!a.role.trim().length}function n(a,l,c){return new or(t,{type:e,severity:"warning",message:function(){let m=t.hasEntity(this.entityIds[1]),g=t.hasEntity(this.entityIds[0]);return m&&g?i.tHtml("issues.missing_role.message",{member:i.displayLabel(m,t.graph()),relation:i.displayLabel(g,t.graph())}):""},reference:d,entityIds:[l.id,a.id],data:{member:c},hash:c.index.toString(),dynamicFixes:function(){return[o("inner"),o("outer"),new Ti({icon:"rapid-operation-delete",title:i.tHtml("issues.fix.remove_from_relation.title"),onClick:()=>{t.perform(dh(this.issue.entityIds[0],this.issue.data.member.index),i.t("operations.delete_member.annotation",{n:1}))}})]}});function d(m){m.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.missing_role.multipolygon.reference"))}}function o(a){return new Ti({title:i.tHtml(`issues.fix.set_as_${a}.title`),onClick:()=>{let l=this.issue.data.member,c={id:this.issue.entityIds[1],type:l.type,role:a};t.perform(hh(this.issue.entityIds[0],c,l.index),i.t("operations.change_role.annotation",{n:1}))}})}return r.type=e,r}function sA(t){let e="missing_tag",i=t.systems.l10n;function r(a,l){let c=["description","name","note","start_date"],d=Object.keys(a.tags).filter(m=>m==="area"||!No(m)?!1:!c.some(g=>m===g||m.indexOf(g+":")===0));return a.type==="relation"&&d.length===1&&a.tags.type==="multipolygon"?B2(a,l):d.length>0}function s(a){return a.type==="way"&&a.tags.highway==="road"}function n(a){return a.type==="relation"&&!a.tags.type}let o=function(l,c){let d=t.services.osm,m=l.type==="node"&&d&&!d.isDataLoaded(l.loc),g;if(!m&&l.geometry(c)!=="vertex"&&!l.hasParentRelations(c)&&(Object.keys(l.tags).length===0?g="any":r(l,c)?n(l)&&(g="relation_type"):g="descriptive"),!g&&s(l)&&(g="highway_classification"),!g)return[];let _=g==="highway_classification"?"unknown_road":`missing_tag.${g}`,v=g==="highway_classification"?"unknown_road":"missing_tag",b=(l.version===void 0||l.v!==void 0)&&g!=="highway_classification"?"error":"warning";return[new or(t,{type:e,subtype:g,severity:b,message:function(){let A=t.hasEntity(this.entityIds[0]);return A?i.tHtml(`issues.${_}.message`,{feature:i.displayLabel(A,t.graph())}):""},reference:T,entityIds:[l.id],dynamicFixes:function(){let A=[],M=g==="highway_classification"?"select_road_type":"select_preset";A.push(new Ti({icon:"rapid-icon-search",title:i.tHtml(`issues.fix.${M}.title`),onClick:function(){t.systems.ui.sidebar.showPresetList()}}));let k=this.entityIds[0],O=oa(t,[k]).disabled(),B;return O||(B=function(){let U=this.issue.entityIds[0],z=oa(t,[U]);z.disabled()||z()}),A.push(new Ti({icon:"rapid-operation-delete",title:i.tHtml("issues.fix.delete_feature.title"),disabledReason:O?i.t(`operations.delete.${O}.single`):void 0,onClick:B})),A}})];function T(A){A.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml(`issues.${v}.reference`))}};return o.type=e,o}function nA(t){let e="outdated_tags",i=t.systems.l10n,r=t.systems.presets,s=!0,n;t.systems.data.getDataAsync("deprecated").then(d=>n=d).catch(()=>{}).finally(()=>s=!1);function a(d,m){if(!d.hasInterestingTags())return[];let g=r.match(d,m);if(!g)return[];let _=Object.assign({},d.tags),v="deprecated_tags";if(g.replacement){let q=r.item(g.replacement);m=qa(d.id,g,q,!0)(m),d=m.entity(d.id),g=q}if(n){let q=d.deprecatedTags(n);q.length&&(q.forEach(Q=>{m=qg(d.id,Q.old,Q.replace)(m)}),d=m.entity(d.id))}let E=Object.assign({},d.tags);g.tags!==g.addTags&&Object.keys(g.addTags).forEach(q=>{E[q]||(g.addTags[q]==="*"?E[q]="yes":E[q]=g.addTags[q])});let b=t.services.nsi,T=!1,A;if(b&&(T=b.status==="loading",!T)){let q=d.extent(m).center();A=b.upgradeTags(E,q),A&&(E=A.newTags,v="noncanonical_brand")}let M=[];M.provisional=s||T;let k=pf(_,E);if(!k.length)return M;let F=k.every(q=>q.type==="+"),O="";A?O="noncanonical_brand.":v==="deprecated_tags"&&F&&(v="incomplete_tags",O="incomplete.");let B=[U,i.t("issues.fix.upgrade_tags.annotation")];return M.push(new or(t,{type:e,subtype:v,severity:"warning",message:Z,reference:W,entityIds:[d.id],hash:m3(JSON.stringify(k)),autoArgs:B,dynamicFixes:()=>{let q=[new Ti({autoArgs:B,title:i.tHtml("issues.fix.upgrade_tags.title"),onClick:()=>{t.perform(U,i.t("issues.fix.upgrade_tags.annotation"))}})],Q=A==null?void 0:A.matched;return Q&&q.push(new Ti({title:i.tHtml("issues.fix.tag_as_not.title",{name:Q.displayName}),onClick:()=>{t.perform(z,i.t("issues.fix.tag_as_not.annotation"))}})),q}})),M;function U(q){let Q=q.hasEntity(d.id);if(!Q)return q;let V=Object.assign({},Q.tags);return k.forEach(le=>{le.type==="-"?delete V[le.key]:le.type==="+"&&(V[le.key]=le.newVal)}),Xr(Q.id,V)(q)}function z(q){let Q=q.hasEntity(d.id);if(!Q)return q;let V=A==null?void 0:A.matched;if(!V)return q;let le=Object.assign({},Q.tags),de=V.mainTag,ne=`not:${de}`,ee=V.tags[de];if(le[ne]=ee,le[de]===ee){let re=V.mainTag.replace("wikidata","wikipedia");delete le[de],delete le[re]}return Xr(Q.id,le)(q)}function Z(){let q=t.hasEntity(d.id);if(!q)return"";let Q=`issues.outdated_tags.${O}message`;return v==="noncanonical_brand"&&F&&(Q+="_incomplete"),i.tHtml(Q,{feature:i.displayLabel(q,t.graph(),!0)})}function W(q){let Q=q.selectAll(".issue-reference").data([0]).enter();Q.append("div").attr("class","issue-reference").html(i.tHtml(`issues.outdated_tags.${O}reference`)),Q.append("strong").html(i.tHtml("issues.suggested")),Q.append("table").attr("class","tagDiff-table").selectAll(".tagDiff-row").data(k).enter().append("tr").attr("class","tagDiff-row").append("td").attr("class",V=>`tagDiff-cell tagDiff-cell-${V.type==="+"?"add":"remove"}`).html(V=>V.display)}}function l(d,m){let g,_;if(d.type==="relation")_=B2(d,m),g=d;else if(d.type==="way")g=U2(d,m),_=d;else return[];if(!g||!_)return[];return[new or(t,{type:e,subtype:"old_multipolygon",severity:"warning",message:E,reference:b,entityIds:[_.id,g.id],autoArgs:[v,i.t("issues.fix.move_tags.annotation")],dynamicFixes:()=>[new Ti({title:i.t("issues.fix.move_tags.title"),onClick:()=>{t.perform(v,i.t("issues.fix.move_tags.annotation"))}})]})];function v(T){let A=T.hasEntity(g.id),M=T.hasEntity(_.id);return!A||!M?T:(A=A.mergeTags(M.tags),T=T.replace(A),Xr(M.id,{})(T))}function E(){let T=t.hasEntity(g.id);return T?i.tHtml("issues.old_multipolygon.message",{multipolygon:i.displayLabel(T,t.graph(),!0)}):""}function b(T){T.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.old_multipolygon.reference"))}}let c=function(m,g){let _=l(m,g);return _.length||(_=a(m,g)),_};return c.type=e,c}function oA(t){let e="private_data",i=t.systems.l10n,r=new Set(["detached","farm","house","houseboat","residential","semidetached_house","static_caravan"]),s=new Set(["amenity","craft","historic","leisure","office","shop","tourism"]),n=new Set(["contact:email","contact:fax","contact:phone","email","fax","phone"]),o=function(l){let c=l.tags;if(!c.building||!r.has(c.building))return[];let d={};for(let[b,T]of Object.entries(c)){if(s.has(b))return[];n.has(b)||(d[b]=T)}let m=pf(c,d);if(!m.length)return[];let g=m.length===1?"remove_tag":"remove_tags";return[new or(t,{type:e,severity:"warning",message:v,reference:E,entityIds:[l.id],dynamicFixes:()=>[new Ti({icon:"rapid-operation-delete",title:i.tHtml(`issues.fix.${g}.title`),onClick:function(){t.perform(_,i.t("issues.fix.upgrade_tags.annotation"))}})]})];function _(b){let T=b.hasEntity(l.id);if(!T)return b;let A=Object.assign({},T.tags);for(let M of m)M.type==="-"?delete A[M.key]:M.type==="+"&&(A[M.key]=M.newVal);return Xr(T.id,A)(b)}function v(){let b=t.hasEntity(this.entityIds[0]);return b?i.tHtml("issues.private_data.contact.message",{feature:i.displayLabel(b,t.graph())}):""}function E(b){let T=b.selectAll(".issue-reference").data([0]).enter();T.append("div").attr("class","issue-reference").html(i.tHtml("issues.private_data.reference")),T.append("strong").html(i.tHtml("issues.suggested")),T.append("table").attr("class","tagDiff-table").selectAll(".tagDiff-row").data(m).enter().append("tr").attr("class","tagDiff-row").append("td").attr("class",A=>`tagDiff-cell tagDiff-cell-${A.type==="+"?"add":"remove"}`).html(A=>A.display)}};return o.type=e,o}var bA={};A9(bA,{operationCircularize:()=>aA,operationContinue:()=>lA,operationCopy:()=>F6,operationCycleHighwayTag:()=>cA,operationDelete:()=>oa,operationDisconnect:()=>uA,operationDowngrade:()=>L6,operationExtract:()=>hA,operationMerge:()=>dA,operationMove:()=>fA,operationOrthogonalize:()=>pA,operationPaste:()=>N6,operationReflectLong:()=>gA,operationReflectShort:()=>mA,operationReverse:()=>yA,operationRotate:()=>_A,operationSplit:()=>xA,operationStraighten:()=>vA});function aA(t,e){let i=e.length===1?"single":"multiple",r=e.map(d=>t.hasEntity(d)).filter(Boolean),s=r.every(d=>d.isNew()),n=kr(r,t.graph()),o=r.map(l).filter(Boolean),a=ls(e,t.graph()).map(d=>d.loc);function l(d){return d.type!=="way"||new Set(d.nodes).size<=1?null:Bg(d.id,t.projection)}let c=function(){if(!o.length)return;let d=function(m,g){return o.forEach(_=>{_.disabled(m)||(m=_(m,g))}),m};d.transitionable=!0,t.perform(d,c.annotation()),window.setTimeout(()=>t.systems.validator.validate(),300)};return c.available=function(){return o.length&&e.length===o.length},c.disabled=function(){if(!o.length)return"";let d=o.map(_=>_.disabled(t.graph())).filter(Boolean);if(d.length===o.length)return new Set(d).size>1?"multiple_blockers":d[0];if(!s&&m())return"too_large";if(!s&&g())return"not_downloaded";if(e.some(t.hasHiddenConnections))return"connected_to_hidden";return!1;function m(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&n.percentContainedIn(t.systems.map.extent())<.8}function g(){if(t.inIntro)return!1;let _=t.services.osm;if(_){let v=a.filter(E=>!_.isDataLoaded(E));if(v.length)return v.forEach(E=>t.loadTileAtLoc(E)),!0}return!1}},c.tooltip=function(){let d=c.disabled();return d?t.t(`operations.circularize.${d}.${i}`):t.t(`operations.circularize.description.${i}`)},c.annotation=function(){return t.t("operations.circularize.annotation.feature",{n:o.length})},c.id="circularize",c.keys=[t.t("operations.circularize.key")],c.title=t.t("operations.circularize.title"),c.behavior=new Ar(t,c),c}function lA(t,e){let i=e.map(l=>t.hasEntity(l)).filter(Boolean),r=Object.assign({line:[],vertex:[]},ds(i,l=>l.geometry(t.graph()))),s=r.vertex.length===1&&r.vertex[0],n=o();function o(){return s?t.graph().parentWays(s).filter(l=>l.geometry(t.graph())==="line"&&!l.isClosed()&&l.affix(s.id)&&(r.line.length===0||r.line[0]===l)):[]}let a=function(){n.length&&t.enter("draw-line",{continueWay:n[0],continueNode:s})};return a.relatedEntityIds=function(){return n.length?[n[0].id]:[]},a.available=function(){return r.vertex.length===1&&r.line.length<=1&&!t.systems.filters.hasHiddenConnections(s,t.graph())},a.disabled=function(){return n.length===0?"not_eligible":n.length>1?"multiple":!1},a.tooltip=function(){let l=a.disabled();return l?t.t(`operations.continue.${l}`):t.t("operations.continue.description")},a.annotation=function(){return t.t("operations.continue.annotation.line")},a.id="continue",a.keys=[t.t("operations.continue.key")],a.title=t.t("operations.continue.title"),a.behavior=new Ar(t,a),a}var eB=[],tB=[];function cA(t,e){let i=[/^highway\/(motorway|trunk|primary|secondary|tertiary|unclassified|residential|living_street|service|track)/,/^line$/],r=["highway/residential","highway/service","highway/track","highway/unclassified","highway/tertiary","line"],s=jn(e,eB),n=new Set(s?tB:r),o=t.systems.presets,a=e.map(c=>t.hasEntity(c)).filter(c=>{if((c==null?void 0:c.type)!=="way")return!1;let d=o.match(c,t.graph());return i.some(m=>m.test(d.id))?(n.has(d.id)||n.add(d.id),!0):!1});eB=e.slice(),tB=Array.from(n);let l=function(){if(!a.length)return;let c=l.annotation();(!s||t.systems.edits.undoAnnotation()!==c)&&t.perform(us(),c);let d=Array.from(n),m=o.match(a[0],t.graph()),g=m?d.indexOf(m.id):-1,_=d[(g+1)%d.length],v=o.item(_);for(let E of a){let b=o.match(E,t.graph()),T=qa(E.id,b,v,!0);t.replace(T,c)}t.enter("select-osm",{selectedIDs:e})};return l.available=function(){return a.length>0},l.disabled=function(){return!1},l.tooltip=function(){let c=l.disabled();return c?t.t(`operations.cycle_highway_tag.${c}`):t.t("operations.cycle_highway_tag.description")},l.annotation=function(){return t.t("operations.cycle_highway_tag.annotation")},l.id="cycle_highway_tag",l.keys=["\u21E7"+t.t("operations.cycle_highway_tag.key")],l.title=t.t("operations.cycle_highway_tag.title"),l.behavior=new Ar(t,l),l}function F6(t,e){let i=e.map(l=>t.hasEntity(l)).filter(l=>l&&(l.hasInterestingTags()||l.geometry(t.graph())!=="vertex")),r=i.every(l=>l.isNew()),s=kr(i,t.graph()),n,o=function(){let l=t.graph(),c=Object.assign({relation:[],way:[],node:[]},ds(i,"type")),d=[],m={},g,_;for(_=0;_<c.relation.length;_++)g=c.relation[_],!m[g.id]&&g.isComplete(l)&&(d.push(g.id),m=a(g.id,l,m));for(_=0;_<c.way.length;_++)g=c.way[_],m[g.id]||(d.push(g.id),m=a(g.id,l,m));for(_=0;_<c.node.length;_++)g=c.node[_],m[g.id]||d.push(g.id);t.copyIDs=d,n&&(d.length!==1||l.entity(d[0]).type!=="node")?t.copyLoc=t.projection.invert(n):t.copyLoc=null};function a(l,c,d){let m=c.entity(l),g;d=d||{},m.type==="relation"?g=m.members.map(_=>_.id):m.type==="way"?g=m.nodes:g=[];for(let _=0;_<g.length;_++)d[g[_]]||(d[g[_]]=!0,d=a(g[_],c,d));return d}return o.available=function(){return i.length>0},o.disabled=function(){if(!r&&l())return"too_large";return!1;function l(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&s.percentContainedIn(t.systems.map.extent())<.8}},o.availableForKeypress=function(){let l=window.getSelection&&window.getSelection();return!l||!l.toString()},o.tooltip=function(){let l=o.disabled();return l?t.t(`operations.copy.${l}`,{n:e.length}):t.t("operations.copy.description",{n:e.length})},o.annotation=function(){return t.t("operations.copy.annotation",{n:e.length})},o.point=function(l){return n=l,o},o.id="copy",o.keys=[Li("\u2318C")],o.title=t.t("operations.copy.title"),o.behavior=new Ar(t,o),o}function uA(t,e){let i=e.map(b=>t.hasEntity(b)).filter(Boolean),r=i.every(b=>b.isNew()),s=[],n=[],o=[],a=[];i.forEach(b=>{b.type==="way"?n.push(b.id):b.geometry(t.graph())==="vertex"?s.push(b.id):o.push(b.id)});let l,c="",d="features",m=[],g=[],_=t.graph();if(s.length>0)m=s,s.forEach(b=>{let T=hm(b);if(n.length>0){let A=n.filter(M=>_.entity(M).nodes.indexOf(b)!==-1);T.limitWays(A)}a.push(T),g=g.concat(_.parentWays(_.entity(b)).map(A=>A.id))}),g=Ei(g).filter(b=>n.indexOf(b)===-1),c+=a.length===1?"single_point.":"multiple_points.",n.length===1?c+="single_way."+_.geometry(n[0]):c+=n.length===0?"no_ways":"multiple_ways";else if(n.length>0){let b=n.map(O=>_.entity(O)),T=ls(n,_);l=T.map(O=>O.loc);let A=[],M=[],k=[],F=[];T.forEach(O=>{let B=hm(O.id).limitWays(n);if(B.disabled(_)!=="not_connected"){let U=0;for(let z in b)if(b[z].nodes.indexOf(O.id)!==-1&&(U+=1),U>1)break;U>1?(A.push(B),M.push(O)):(k.push(B),F.push(O))}}),c+="no_points.",c+=n.length===1?"single_way.":"multiple_ways.",A.length?(a=A,m=M.map(O=>O.id),c+="conjoined",d="from_each_other"):(a=k,m=F.map(O=>O.id),n.length===1?c+=_.geometry(n[0]):c+="separate")}let v=kr(m,_),E=function(){let b=function(T){return a.forEach(A=>{A.disabled(T)||(T=A(T))}),T};t.perform(b,E.annotation()),t.systems.validator.validate()};return E.relatedEntityIds=function(){return s.length?g:m},E.available=function(){return!(a.length===0||o.length!==0||s.length!==0&&n.length!==0&&!n.every(function(b){return s.some(T=>t.entity(b).nodes.indexOf(T)!==-1)}))},E.disabled=function(){let b;for(let M of a)if(b=M.disabled(t.graph()),b)return b;if(!r&&T())return"too_large."+((s.length?s:n).length===1?"single":"multiple");if(!r&&l&&A())return"not_downloaded";if(e.some(t.hasHiddenConnections))return"connected_to_hidden";return!1;function T(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&v.percentContainedIn(t.systems.map.extent())<.8}function A(){if(t.inIntro)return!1;let M=t.services.osm;if(M){let k=l.filter(F=>!M.isDataLoaded(F));if(k.length)return k.forEach(F=>t.loadTileAtLoc(F)),!0}return!1}},E.tooltip=function(){let b=E.disabled();return b?t.t(`operations.disconnect.${b}`):t.t(`operations.disconnect.description.${c}`)},E.annotation=function(){return t.t(`operations.disconnect.annotation.${d}`)},E.id="disconnect",E.keys=[t.t("operations.disconnect.key")],E.title=t.t("operations.disconnect.title"),E.behavior=new Ar(t,E),E}function L6(t,e){let i=0,r=n(e),s=i===1?"single":"multiple";function n(d){let m;i=0;for(let g in d){let _=d[g],v=o(_);v&&(i+=1,m&&v!==m?m!=="generic"&&v!=="generic"?m="building_address":m="generic":m=v)}return m}function o(d){let m=t.graph(),g=m.entity(d),v=t.systems.presets.match(g,m);if(!v||v.isFallback())return null;if(g.type==="node"&&v.id!=="address"&&Object.keys(g.tags).some(function(b){return b.match(/^addr:.{1,}/)}))return"address";let E=g.geometry(m);return E==="area"&&g.tags.building&&!v.tags.building?"building":E==="vertex"&&Object.keys(g.tags).length?"generic":null}let a=/architect|building|height|layer|nycdoitt:bin|source|type|wheelchair|roof/i,l=["source"],c=function(){t.perform(function(d){for(let m in e){let g=e[m],_=o(g);if(!_)continue;let v=Object.assign({},d.entity(g).tags);for(let E in v)_==="address"&&l.indexOf(E)!==-1||_==="building"&&a.test(E)||_!=="generic"&&(E.match(/^addr:.{1,}/)||E.match(/^source:.{1,}/))||delete v[E];d=Xr(g,v)(d)}return d},c.annotation()),t.systems.validator.validate(),t.enter("select-osm",{selectedIDs:e})};return c.available=function(){return r},c.disabled=function(){if(e.some(d))return"has_wikidata_tag";return!1;function d(m){let g=t.entity(m);return g.tags.wikidata&&g.tags.wikidata.trim().length>0}},c.tooltip=function(){let d=c.disabled();return d?t.t(`operations.downgrade.${d}.${s}`):t.t(`operations.downgrade.description.${r}`)},c.annotation=function(){let d;return r==="building_address"?d="generic":d=r,t.t(`operations.downgrade.annotation.${d}`,{n:i})},c.id="downgrade",c.keys=[Li("\u232B")],c.title=t.t("operations.downgrade.title"),c.behavior=new Ar(t,c),c}function hA(t,e){let i=t.systems.presets,r=e.length===1?"single":"multiple",s=e.map(m=>t.hasEntity(m)).filter(Boolean),n=s.every(m=>m.isNew()),o=kr(s,t.graph()),a=Ei(s.map(m=>m.geometry(t.graph()))),l=a.length===1?a[0]:"feature",c=s.map(m=>{if(!m.hasInterestingTags())return null;let g=t.graph();return m.type==="node"&&g.parentWays(m).length===0||m.type!=="node"&&!i.match(m,g).geometry.includes("point")?null:G2(m.id,t.projection)}).filter(Boolean),d=function(){if(!c.length)return;let m=T=>{for(let A of c)T=A(T);return T};t.perform(m,d.annotation()),t.systems.validator.validate();let g=t.projection,_=c.map(T=>T.getExtractedNodeID()),v=g.project(o.center()),E=sr(t.systems.map.mouse(),v);t.perform(Wc(_,E,g));let b=new Map;for(let T of _)b.set(T,t.entity(T));t.enter("move",{selection:b})};return d.available=function(){return c.length&&e.length===c.length},d.disabled=function(){if(!n&&m())return"too_large";if(e.some(g=>t.graph().geometry(g)==="vertex"&&t.hasHiddenConnections(g)))return"connected_to_hidden";return!1;function m(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&o.percentContainedIn(t.systems.map.extent())<.8}},d.tooltip=function(){let m=d.disabled();return m?t.t(`operations.extract.${m}.${r}`):t.t(`operations.extract.description.${l}.${r}`)},d.annotation=function(){return t.t("operations.extract.annotation",{n:e.length})},d.id="extract",d.keys=[t.t("operations.extract.key")],d.title=t.t("operations.extract.title"),d.behavior=new Ar(t,d),d}function dA(t,e){let i=r();function r(){let a={tagnosticRoadCombine:t.systems.storage.getItem("rapid-internal-feature.tagnosticRoadCombine")==="true"},l=Ug(e,a);if(!l.disabled(t.graph()))return l;let c=zg(e);if(!c.disabled(t.graph()))return c;let d=Gg(e);if(!d.disabled(t.graph()))return d;let m=Ya(e);return m.disabled(t.graph())?l.disabled(t.graph())!=="not_eligible"?l:c.disabled(t.graph())!=="not_eligible"?c:d.disabled(t.graph())!=="not_eligible"?d:m:m}let s=function(){if(s.disabled())return;t.perform(i,s.annotation()),t.systems.validator.validate();let n=e.filter(o=>t.hasEntity(o));if(n.length>1){let o=n.filter(a=>t.entity(a).hasInterestingTags());o.length&&(n=o)}t.enter("select-osm",{selectedIDs:n})};return s.available=function(){return e.length>=2},s.disabled=function(){let n=i.disabled(t.graph());if(n)return n;let o=t.services.osm;return o&&i.resultingWayNodesLength&&i.resultingWayNodesLength(t.graph())>o.maxWayNodes?"too_many_vertices":!1},s.tooltip=function(){let n=s.disabled(),o=t.systems.presets;if(n){if(n==="conflicting_relations")return t.t("operations.merge.conflicting_relations");if(n==="restriction"||n==="connectivity"){let a=o.item("type/"+n);return t.t("operations.merge.damage_relation",{relation:a.name()})}else return t.t(`operations.merge.${n}`)}else return t.t("operations.merge.description")},s.annotation=function(){return t.t("operations.merge.annotation",{n:e.length})},s.id="merge",s.keys=[t.t("operations.merge.key")],s.title=t.t("operations.merge.title"),s.behavior=new Ar(t,s),s}function fA(t,e){let i=e.length===1?"single":"multiple",r=e.map(c=>t.hasEntity(c)).filter(Boolean),s=r.every(c=>c.isNew()),o=ls(e,t.graph()).map(c=>c.loc),a=kr(r,t.graph()),l=function(){let c=new Map;for(let d of e)c.set(d,t.entity(d));t.enter("move",{selection:c})};return l.available=function(){return r.length>0},l.disabled=function(){if(!s&&c())return"too_large";if(!s&&d())return"not_downloaded";if(e.some(t.hasHiddenConnections))return"connected_to_hidden";if(r.some(m))return"incomplete_relation";return!1;function c(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&a.percentContainedIn(t.systems.map.extent())<.8}function d(){if(t.inIntro)return!1;let g=t.services.osm;if(g){let _=o.filter(v=>!g.isDataLoaded(v));if(_.length)return _.forEach(v=>t.loadTileAtLoc(v)),!0}return!1}function m(g){return g.type==="relation"&&!g.isComplete(t.graph())}},l.tooltip=function(){let c=l.disabled();return c?t.t(`operations.move.${c}.${i}`):t.t(`operations.move.description.${i}`)},l.annotation=function(){return e.length===1?t.t("operations.move.annotation."+t.graph().geometry(e[0])):t.t("operations.move.annotation.feature",{n:e.length})},l.id="move",l.keys=[t.t("operations.move.key")],l.title=t.t("operations.move.title"),l.behavior=new Ar(t,l),l.mouseOnly=!0,l}function pA(t,e){let i=e.length===1?"single":"multiple",r=e.map(m=>t.hasEntity(m)).filter(Boolean),s=r.every(m=>m.isNew()),n=kr(r,t.graph()),o,a=r.map(c).filter(Boolean),l=ls(e,t.graph()).map(m=>m.loc);function c(m){let g=t.graph(),_=m.geometry(g);if(m.type==="way"&&new Set(m.nodes).size>2)return o&&o!=="feature"?null:(o="feature",fh(m.id,t.projection));if(_==="vertex"){if(o&&o!=="corner")return null;o="corner";let v=g.parentWays(m);if(v.length===1){let E=v[0];if(E.nodes.indexOf(m.id)!==-1)return fh(E.id,t.projection,m.id)}}return null}let d=function(){if(!a.length)return;let m=function(g,_){return a.forEach(v=>{v.disabled(g)||(g=v(g,_))}),g};m.transitionable=!0,t.perform(m,d.annotation()),window.setTimeout(()=>t.systems.validator.validate(),300)};return d.available=function(){return a.length&&e.length===a.length},d.disabled=function(){if(!a.length)return"";let m=a.map(v=>v.disabled(t.graph())).filter(Boolean);if(m.length===a.length)return new Set(m).size>1?"multiple_blockers":m[0];if(!s&&g())return"too_large";if(!s&&_())return"not_downloaded";if(e.some(t.hasHiddenConnections))return"connected_to_hidden";return!1;function g(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&n.percentContainedIn(t.systems.map.extent())<.8}function _(){if(t.inIntro)return!1;let v=t.services.osm;if(v){let E=l.filter(b=>!v.isDataLoaded(b));if(E.length)return E.forEach(b=>t.loadTileAtLoc(b)),!0}return!1}},d.tooltip=function(){let m=d.disabled();return m?t.t(`operations.orthogonalize.${m}.${i}`):t.t(`operations.orthogonalize.description.${o}.${i}`)},d.annotation=function(){return t.t("operations.orthogonalize.annotation."+o,{n:a.length})},d.id="orthogonalize",d.keys=[t.t("operations.orthogonalize.key")],d.title=t.t("operations.orthogonalize.title"),d.behavior=new Ar(t,d),d}function N6(t){let e,i=function(){if(!e)return;let r=t.copyIDs;if(!r.length)return;let s=t.projection,n=t.copyGraph,o=new mt,a=[],l=z2(r,n);t.perform(l);let c=l.copies(),d=new Set;Object.values(c).forEach(function(v){d.add(v.id)});for(let v in c){let E=n.entity(v),b=c[v];o=o.extend(E.extent(n)),t.graph().parentWays(b).some(M=>d.has(M.id))||a.push(b.id)}let m=t.copyLoc,g=m&&s.project(m)||s.project(o.center()),_=sr(e,g);t.replace(Wc(a,_,s),i.annotation()),t.enter("select-osm",{selectedIDs:a})};return i.point=function(r){return e=r,i},i.available=function(){var r;return((r=t.mode)==null?void 0:r.id)==="browse"},i.disabled=function(){return!t.copyIDs.length},i.tooltip=function(){let r=t.systems.l10n,s=t.copyGraph,n=t.copyIDs;return n.length?r.t("operations.paste.description",{feature:r.displayLabel(s.entity(n[0]),s),n:n.length}):r.t("operations.paste.nothing_copied")},i.annotation=function(){let r=t.copyIDs;return t.t("operations.paste.annotation",{n:r.length})},i.id="paste",i.keys=[Li("\u2318V")],i.title=t.t("operations.paste.title"),i}function mA(t,e){return iB(t,e,"short")}function gA(t,e){return iB(t,e,"long")}function iB(t,e,i="long"){let r=e.length===1?"single":"multiple",s=e.map(d=>t.hasEntity(d)).filter(Boolean),n=s.every(d=>d.isNew()),o=kr(s,t.graph()),a=ls(e,t.graph()),l=a.map(d=>d.loc),c=function(){let d=Wg(e,t.projection).useLongAxis(i==="long");t.perform(d,c.annotation()),window.setTimeout(()=>t.systems.validator.validate(),300)};return c.available=function(){return a.length>=3},c.disabled=function(){if(!n&&d())return"too_large";if(!n&&m())return"not_downloaded";if(e.some(t.hasHiddenConnections))return"connected_to_hidden";if(s.some(g))return"incomplete_relation";return!1;function d(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&o.percentContainedIn(t.systems.map.extent())<.8}function m(){if(t.inIntro)return!1;let _=t.services.osm;if(_){let v=l.filter(E=>!_.isDataLoaded(E));if(v.length)return v.forEach(E=>t.loadTileAtLoc(E)),!0}return!1}function g(_){return _.type==="relation"&&!_.isComplete(t.graph())}},c.tooltip=function(){let d=c.disabled();return d?t.t(`operations.reflect.${d}.${r}`):t.t(`operations.reflect.description.${i}.${r}`)},c.annotation=function(){return t.t(`operations.reflect.annotation.${i}.feature`,{n:e.length})},c.id=`reflect-${i}`,c.keys=[t.t(`operations.reflect.key.${i}`)],c.title=t.t(`operations.reflect.title.${i}`),c.behavior=new Ar(t,c),c}function yA(t,e){let i=e.map(s).filter(Boolean),r=n();function s(a){let l=t.hasEntity(a);if(!l)return null;let c=l.geometry(t.graph());if(l.type!=="node"&&c!=="line")return null;let d=pl(a);return d.disabled(t.graph())?null:d}function n(){let a=i.filter(l=>{let c=t.hasEntity(l.entityID());return(c==null?void 0:c.type)==="node"}).length;return a===0?"line":a===i.length?"point":"feature"}let o=function(){if(!i.length)return;let a=function(l){for(let c of i)l=c(l);return l};t.perform(a,o.annotation()),t.systems.validator.validate()};return o.available=function(){return i.length>0},o.disabled=function(){return!1},o.tooltip=function(){return t.t(`operations.reverse.description.${r}`)},o.annotation=function(){return t.t(`operations.reverse.annotation.${r}`,{n:i.length})},o.id="reverse",o.keys=[t.t("operations.reverse.key")],o.title=t.t("operations.reverse.title"),o.behavior=new Ar(t,o),o}function _A(t,e){let i=e.length===1?"single":"multiple",r=e.map(c=>t.hasEntity(c)).filter(Boolean),s=r.every(c=>c.isNew()),n=kr(r,t.graph()),o=ls(e,t.graph()),a=o.map(c=>c.loc),l=function(){let c=new Map;for(let d of e)c.set(d,t.entity(d));t.enter("rotate",{selection:c})};return l.available=function(){return o.length>=2},l.disabled=function(){if(!s&&c())return"too_large";if(!s&&d())return"not_downloaded";if(e.some(t.hasHiddenConnections))return"connected_to_hidden";if(r.some(m))return"incomplete_relation";return!1;function c(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&n.percentContainedIn(t.systems.map.extent())<.8}function d(){if(t.inIntro)return!1;let g=t.services.osm;if(g){let _=a.filter(v=>!g.isDataLoaded(v));if(_.length)return _.forEach(v=>t.loadTileAtLoc(v)),!0}return!1}function m(g){return g.type==="relation"&&!g.isComplete(t.graph())}},l.tooltip=function(){let c=l.disabled();return c?t.t(`operations.rotate.${c}.${i}`):t.t(`operations.rotate.description.${i}`)},l.annotation=function(){return e.length===1?t.t("operations.rotate.annotation."+t.graph().geometry(e[0])):t.t("operations.rotate.annotation.feature",{n:e.length})},l.id="rotate",l.keys=[t.t("operations.rotate.key")],l.title=t.t("operations.rotate.title"),l.behavior=new Ar(t,l),l.mouseOnly=!0,l}function xA(t,e){let i=t.graph(),r=e.map(E=>t.hasEntity(E)).filter(Boolean),s=r.filter(E=>E.type==="node"&&E.geometry(i)==="vertex"),n=s.map(E=>E.id),o=n.length===1?"single":"multiple",a=r.filter(E=>E.type==="way"),l=a.map(E=>E.id),c=s.length>0&&s.length+a.length===e.length,d=Ku(n),m="feature",g=[],_="single";if(c){l.length&&d.limitWays(l),g=d.ways(i);let E=new Set;for(let b of g)E.add(b.geometry(i));E.size===1&&(m=Array.from(E)[0]),_=g.length===1?"single":"multiple"}let v=function(){let E=t.perform(d,v.annotation());t.systems.validator.validate();let b=n.slice();for(let[T,A]of E.changes){let M=A.head;M&&M.type==="way"&&b.push(T)}t.enter("select-osm",{selectedIDs:b})};return v.relatedEntityIds=function(){return g.map(E=>E.id)},v.available=function(){return c},v.disabled=function(){let E=d.disabled(t.graph());return E||(e.some(t.hasHiddenConnections)?"connected_to_hidden":!1)},v.tooltip=function(){let E=v.disabled();return E?t.t(`operations.split.${E}`):t.t(`operations.split.description.${m}.${_}.${o}_node`)},v.annotation=function(){return t.t(`operations.split.annotation.${m}`,{n:g.length})},v.id="split",v.keys=[t.t("operations.split.key")],v.title=t.t("operations.split.title"),v.behavior=new Ar(t,v),v}function vA(t,e){let i=e.map(E=>t.hasEntity(E)).filter(Boolean),r=i.every(E=>E.isNew()),s=i.filter(E=>E.type==="way"),n=s.map(E=>E.id),o=i.filter(E=>E.type==="node"),a=o.map(E=>E.id),l=(s.length?s:o).length===1?"single":"multiple",c=ls(e,t.graph()).map(E=>E.loc),d=kr(e,t.graph()),m,g=_();function _(){if(s.length===0&&o.length>2)return m="point",jg(a,t.projection);if(s.length>0&&(o.length===0||o.length===2)){let E=[],b=[];for(let A of i)if(A.type==="way"){if(A.type==="way"&&A.isClosed())return null;E.push(A.first()),b.push(A.last())}if(E=E.filter(A=>E.indexOf(A)===E.lastIndexOf(A)),b=b.filter(A=>b.indexOf(A)===b.lastIndexOf(A)),Sn(E,b).length+Sn(b,E).length!==2)return null;let T=ls(n,t.graph()).map(A=>A.id);return T.length<=2||a.length===2&&(T.indexOf(a[0])===-1||T.indexOf(a[1])===-1)?null:(a.length&&(d=kr(a,t.graph())),m="line",Xg(e,t.projection))}return null}let v=function(){g&&(t.perform(g,v.annotation()),window.setTimeout(()=>t.systems.validator.validate(),300))};return v.available=function(){return!!g},v.disabled=function(){let E=g.disabled(t.graph());if(E)return E;if(!r&&b())return"too_large";if(!r&&T())return"not_downloaded";if(e.some(t.hasHiddenConnections))return"connected_to_hidden";return!1;function b(){return!(t.systems.storage.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&d.percentContainedIn(t.systems.map.extent())<.8}function T(){if(t.inIntro)return!1;let A=t.services.osm;if(A){let M=c.filter(k=>!A.isDataLoaded(k));if(M.length)return M.forEach(k=>t.loadTileAtLoc(k)),!0}return!1}},v.tooltip=function(){let E=v.disabled();return E?t.t(`operations.straighten.${E}.${l}`):t.t(`operations.straighten.description.${m}`+(s.length===1?"":"s"))},v.annotation=function(){return t.t(`operations.straighten.annotation.${m}`,{n:s.length?s.length:o.length})},v.id="straighten",v.keys=[t.t("operations.straighten.key")],v.title=t.t("operations.straighten.title"),v.behavior=new Ar(t,v),v}function wA(t){let e="y_shaped_connection",i=t.systems.l10n,r=12,s=5,n=new Set(["residential","service","track","unclassified","tertiary","secondary","primary","living_street","cycleway","trunk","motorway","road","raceway"]);function o(d,m){return m.parentWays(d).filter(_=>n.has(_.tags.highway))}function a(d,m){let g=!oa(m,[d.id]).disabled(),_;return g?_=new Ti({icon:"rapid-operation-delete",title:i.t("issues.fix.delete_node_around_conn.title"),entityIds:[d.id],onClick:function(){let v=this.entityIds[0],E=oa(m,[v]);E.disabled()||E()}}):_=new Ti({icon:"rapid-operation-move",title:i.t("issues.fix.move_node_around_conn.title"),entityIds:[d.id]}),new or(m,{type:e,severity:"warning",message:()=>i.t("issues.y_shaped_connection.message"),reference:v=>{v.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(i.t("issues.y_shaped_connection.reference"))},entityIds:[d.id],fixes:[_]})}function l(d,m,g,_){if(g<=0||g>=m.nodes.length-1)return!1;let v=m.nodes[g],E=d.entity(v);if(o(E,d).length<2)return!1;let T=m.nodes[_],A=d.entity(T);if(mr(E.loc,A.loc)>r)return!1;let k=g<_?g-1:g+1,F=m.nodes[k],O=d.entity(F),B=t.projection.project(O.loc),U=t.projection.project(E.loc),z=t.projection.project(A.loc),Z=0,W=0,q=0;return k<_?(Z=fs(B,U),W=fs(U,z),q=Math.abs(W-Z)/Math.PI*180):(Z=fs(z,U),W=fs(U,B),q=Math.abs(W-Z)/Math.PI*180),q>s}let c=function(d,m){if(d.type!=="node")return[];let g=o(d,m);if(g.length!==1||!g[0].id.startsWith("w-"))return[];let _=[],v=g[0],E=v.nodes.indexOf(d.id);return E<=0||(l(m,v,E-1,E)||l(m,v,E+1,E))&&_.push(a(d,t)),_};return c.type=e,c}function EA(t){let e="suspicious_name",i=t.systems.l10n,r=["aerialway","aeroway","amenity","building","craft","highway","leisure","railway","man_made","office","shop","tourism","waterway"],s=!1;function n(m){let g=t.services.nsi;return g&&(s=g.status==="loading",!s)?g.isGenericName(m):!1}function o(m,g){for(let _ of r){let v=g[_];if(v&&(v=v.toLowerCase(),_===m||v===m||_.replace(/\_/g," ")===m||v.replace(/\_/g," ")===m))return!0}return!1}function a(m,g){return m=m.toLowerCase(),o(m,g)||n(g)}function l(m,g,_,v){return new or(t,{type:e,subtype:"generic_name",severity:"warning",message:function(){let b=t.hasEntity(this.entityIds[0]);if(!b)return"";let T=t.systems.presets.match(b,t.graph()),A=v&&i.languageName(v);return i.tHtml("issues.generic_name.message"+(A?"_language":""),{feature:T.name(),name:_,language:A})},reference:E,entityIds:[m],hash:`${g}=${_}`,dynamicFixes:function(){return[new Ti({icon:"rapid-operation-delete",title:i.tHtml("issues.fix.remove_the_name.title"),onClick:function(){let b=this.issue.entityIds[0],T=t.entity(b),A=Object.assign({},T.tags);delete A[g],t.perform(Xr(b,A),i.t("issues.fix.remove_generic_name.annotation"))}})]}});function E(b){b.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.generic_name.reference"))}}function c(m,g,_,v){return new or(t,{type:e,subtype:"not_name",severity:"warning",message:function(){let b=t.hasEntity(this.entityIds[0]);if(!b)return"";let T=t.systems.presets.match(b,t.graph()),A=v&&i.languageName(v);return i.tHtml("issues.incorrect_name.message"+(A?"_language":""),{feature:T.name(),name:_,language:A})},reference:E,entityIds:[m],hash:`${g}=${_}`,dynamicFixes:function(){return[new Ti({icon:"rapid-operation-delete",title:i.tHtml("issues.fix.remove_the_name.title"),onClick:function(){let b=this.issue.entityIds[0],T=t.entity(b),A=Object.assign({},T.tags);delete A[g],t.perform(Xr(b,A),i.t("issues.fix.remove_mistaken_name.annotation"))}})]}});function E(b){b.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.generic_name.reference"))}}let d=function(g){var T;let _=g.tags;if(!!_.wikidata||!!_["brand:wikidata"]||!!_["operator:wikidata"])return[];let E=[],b=new Set(((T=_["not:name"])!=null?T:"").split(";").map(A=>A.trim()).filter(Boolean));for(let[A,M]of Object.entries(_)){if(!M)continue;let k=A.match(/^name(?:(?::)([a-zA-Z_-]+))?$/);if(!k)continue;let F=k.length>=2?k[1]:null;b.has(M)&&E.push(c(g.id,A,M,F)),a(M,_)&&(E.provisional=s,E.push(l(g.id,A,M,F)))}return E};return d.type=e,d}function TA(t){let e="unsquare_way",i=t.systems.l10n,r=5,s=.05,n=10;function o(l,c){return l.type!=="way"||l.geometry(c)!=="area"?!1:l.tags.building&&l.tags.building!=="no"}let a=function(c,d){if(!o(c,d))return[];if(c.tags.nonsquare==="yes")return[];let m=c.isClosed();if(!m)return[];let g=d.childNodes(c).slice();if(g.length>n+1)return[];let _=t.services.osm;if(!_||g.some(F=>!_.isDataLoaded(F.loc)))return[];if(g.some(F=>d.parentWays(F).some(O=>O.id===c.id?!1:o(O,d)?!0:d.parentRelations(O).some(B=>B.isMultipolygon()&&B.tags.building&&B.tags.building!=="no"))))return[];let b=t.systems.storage.getItem("validate-square-degrees"),T=isNaN(b)?r:parseFloat(b),A=g.map(F=>t.projection.project(F.loc));if(!Q2(A,m,s,T,!0))return[];let M;if(!c.tags.wikidata){let F=fh(c.id,t.projection,void 0,T);F.transitionable=!1,M=[F,i.t("operations.orthogonalize.annotation.feature",{n:1})]}return[new or(t,{type:e,subtype:"building",severity:"warning",message:function(){let F=t.hasEntity(this.entityIds[0]);return F?i.tHtml("issues.unsquare_way.message",{feature:i.displayLabel(F,t.graph())}):""},reference:k,entityIds:[c.id],hash:T,autoArgs:M,dynamicFixes:function(){return[new Ti({icon:"rapid-operation-orthogonalize",title:i.t("issues.fix.square_feature.title"),onClick:function(F,O){let B=this.issue.entityIds[0];F.perform(fh(B,F.projection,void 0,T),i.t("operations.orthogonalize.annotation.feature",{n:1})),window.setTimeout(function(){O()},175)}})]}})];function k(F){F.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").html(i.tHtml("issues.unsquare_way.buildings.reference"))}};return a.type=e,a}var IK=5e3,O6=class extends fi{constructor(e){super(e),this.id="validator",this.dependencies=new Set(["edits","storage","map","urlhash"]),this._rules=new Map,this._base=new sp("base"),this._head=new sp("head"),this._disabledRuleIDs=new Set,this._ignoredIssueIDs=new Set,this._resolvedIssueIDs=new Set,this._completeDiff=new Map,this._headIsCurrent=!1,this._deferredRIC=new Map,this._deferredST=new Set,this._headPromise=null,this._errorOverrides=[],this._warningOverrides=[],this._disableOverrides=[],this._initPromise=null,this.validate=this.validate.bind(this),this.validateAsync=this.validateAsync.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let o of this.dependencies)if(!this.context.systems[o])return Promise.reject(`Cannot init:  ${this.id} requires ${o}`);let e=this.context;Object.values(SA).forEach(o=>{if(typeof o!="function")return;let a=o(e);this._rules.set(a.type,a)});let i=e.systems.edits;e.on("modechange",this.validate),i.on("restore",this.validate).on("undone",this.validate).on("redone",this.validate),i.on("merge",o=>{if(!o)return;let a=i.base();this._head.graph||(this._head.graph=a),this._base.graph||(this._base.graph=a),o=this._base.withAllRelatedEntities(o),this._validateEntitiesAsync(o,this._base)});let r=e.systems.storage,s=e.systems.urlhash,n=Promise.all([r.initAsync(),s.initAsync()]);return this._initPromise=n.then(()=>{this._errorOverrides=this._parseHashParam(s.initialHashParams.get("validationError")),this._warningOverrides=this._parseHashParam(s.initialHashParams.get("validationWarning")),this._disableOverrides=this._parseHashParam(s.initialHashParams.get("validationDisable"));let o=r.getItem("validate-disabledRules");if(o){let a=o.split(",").map(l=>l.trim()).filter(Boolean);this._disabledRuleIDs=new Set(a)}})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this._reset(!0),Promise.resolve()}_parseHashParam(e=""){var n;let i=[],r=e.split(",").map(o=>o.trim()).filter(Boolean);for(let o of r){let a=o.split("/",2),l=a[0],c=(n=a[1])!=null?n:"*";!l||!c||i.push({type:s(l),subtype:s(c)})}return i;function s(o){let a=o.replace(/[-\/\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*");return new RegExp(`^${a}$`)}}_reset(e=!1){this._base.queue=[],this._head.queue=[];for(let[i,r]of this._deferredRIC)window.cancelIdleCallback(i),r();this._deferredRIC.clear();for(let i of this._deferredST)window.clearTimeout(i);this._deferredST.clear(),e&&this._ignoredIssueIDs.clear(),this._resolvedIssueIDs.clear(),this._base=new sp("base"),this._head=new sp("head"),this._completeDiff=new Map,this._headIsCurrent=!1}resetIgnoredIssues(){this._ignoredIssueIDs.clear(),this.emit("validated")}revalidateUnsquare(){let e=this._rules.get("unsquare_way");if(typeof e!="function")return;let i=r=>{if(!r.graph)return;r.uncacheIssuesOfType("unsquare_way");let n=this.context.systems.edits.tree().intersects(new mt([-180,-90],[180,90]),r.graph).filter(o=>o.type==="way"&&o.tags.building&&o.tags.building!=="no");for(let o of n){let a=e(o,r.graph);a.length&&r.cacheIssues(a)}};i(this._head),i(this._base),this.emit("validated")}getIssues(e){let i=Object.assign({what:"all",where:"all",includeIgnored:!1,includeDisabledRules:!1},e),r=this.context,s=r.systems.map.extent(),n=new Set,o=[],a=l=>{if(!l||n.has(l.id)||this._resolvedIssueIDs.has(l.id)||i.includeDisabledRules==="only"&&!this._disabledRuleIDs.has(l.type)||!i.includeDisabledRules&&this._disabledRuleIDs.has(l.type)||i.includeIgnored==="only"&&!this._ignoredIssueIDs.has(l.id)||!i.includeIgnored&&this._ignoredIssueIDs.has(l.id)||(l.entityIds||[]).some(c=>!r.hasEntity(c)))return!1;if(i.where==="visible"){let c=l.extent(r.graph());if(!s.intersects(c))return!1}return!0};if(this._head.graph&&this._head.graph!==this._base.graph){let l=[...this._head.issues.values()];for(let c of l){let d=(c.entityIds||[]).some(m=>this._completeDiff.has(m));i.what==="edited"&&!d||a(c)&&(n.add(c.id),o.push(c))}}if(i.what==="all"){let l=[...this._base.issues.values()];for(let c of l)a(c)&&(n.add(c.id),o.push(c))}return o}getResolvedIssues(){return Array.from(this._resolvedIssueIDs).map(e=>this._base.issues.get(e)).filter(Boolean)}focusIssue(e){let i=this.context,r=i.graph(),s,n,o=e.extent(r);if(o&&(n=o.center()),e.entityIds&&e.entityIds.length&&(s=e.entityIds[0],s&&s.charAt(0)==="r")){let a=UI([s],r),l=a.find(c=>c.charAt(0)==="n"&&r.hasEntity(c));if(!l){let c=a.find(d=>d.charAt(0)==="w"&&r.hasEntity(d));c&&(l=r.entity(c).first())}l&&(n=r.entity(l).loc)}if(n){let a=Math.max(i.systems.map.zoom(),19);i.systems.map.centerZoomEase(n,a)}s&&window.setTimeout(()=>{i.enter("select-osm",{selectedIDs:[s]}),this.emit("focusedIssue",e)},250)}getIssuesBySeverity(e){var r,s;let i=ds(this.getIssues(e),"severity");return i.error=(r=i.error)!=null?r:[],i.warning=(s=i.warning)!=null?s:[],i}getSharedEntityIssues(e,i){let r=["missing_tag","missing_role","outdated_tags","mismatched_geometry","crossing_ways","almost_junction","disconnected_way","impossible_oneway"],s=this.getIssues(i),n=new Set(e);return s.filter(o=>{var a;return((a=o.entityIds)!=null?a:[]).some(l=>n.has(l))}).sort((o,a)=>{if(o.type===a.type)return o.id<a.id?-1:1;let l=r.indexOf(o.type),c=r.indexOf(a.type);return l!==-1&&c!==-1?l-c:l===-1&&c===-1?o.type<a.type?-1:1:l!==-1?-1:1})}getEntityIssues(e,i){return this.getSharedEntityIssues([e],i)}getRuleKeys(){return[...this._rules.keys()]}isRuleEnabled(e){return!this._disabledRuleIDs.has(e)}toggleRule(e){this._disabledRuleIDs.has(e)?this._disabledRuleIDs.delete(e):this._disabledRuleIDs.add(e),this.context.systems.storage.setItem("validate-disabledRules",[...this._disabledRuleIDs].join(",")),this.validateAsync()}disableRules(e=[]){this._disabledRuleIDs=new Set(e),this.context.systems.storage.setItem("validate-disabledRules",[...this._disabledRuleIDs].join(",")),this.validateAsync()}ignoreIssue(e){this._ignoredIssueIDs.add(e)}validateAsync(){let e=this.context,i=e.systems.edits.base();this._head.graph||(this._head.graph=i),this._base.graph||(this._base.graph=i);let r=this._head.graph,s=e.graph();if(s===r)return this._headIsCurrent=!0,this.emit("validated"),Promise.resolve();if(this._headPromise)return this._headIsCurrent=!1,this._headPromise;this._head.graph=s,this._completeDiff=e.systems.edits.difference().complete();let o=[...new Za(r,s).complete().keys()];return o=this._head.withAllRelatedEntities(o),o.size?(this._headPromise=this._validateEntitiesAsync(o,this._head).then(()=>this._updateResolvedIssues(o)).then(()=>this.emit("validated")).catch(a=>console.error(a)).then(()=>{this._headPromise=null,this._headIsCurrent||this.validateAsync()}),this._headPromise):(this.emit("validated"),Promise.resolve())}validate(){return this.validateAsync()}_validateEntity(e,i){let r=n=>{var l;let o=n.type,a=(l=n.subtype)!=null?l:"";for(let c of this._errorOverrides)if(c.type.test(o)&&c.subtype.test(a))return n.severity="error",!0;for(let c of this._warningOverrides)if(c.type.test(o)&&c.subtype.test(a))return n.severity="warning",!0;for(let c of this._disableOverrides)if(c.type.test(o)&&c.subtype.test(a))return!1;return!0},s={issues:[],provisional:!1};for(let[n,o]of this._rules){if(typeof o!="function"){console.error(`no such validation rule = ${n}`);continue}let a=o(e,i);a.provisional&&(s.provisional=!0),a=a.filter(r),s.issues=s.issues.concat(a)}return s}_updateResolvedIssues(e=[]){var i;for(let r of e){let s=(i=this._base.entityIssueIDs.get(r))!=null?i:[];for(let n of s){let o=this._base.issues.get(n);((o==null?void 0:o.entityIds)||[]).some(l=>this._completeDiff.has(l))&&!this._head.issues.has(n)?this._resolvedIssueIDs.add(n):this._resolvedIssueIDs.delete(n)}}}_validateEntitiesAsync(e,i){let r=Array.from(e).map(s=>i.queuedEntityIDs.has(s)?null:(i.queuedEntityIDs.add(s),i.uncacheEntityID(s),()=>{i.queuedEntityIDs.delete(s);let n=i.graph;if(!n)return;let o=n.hasEntity(s);if(!o)return;let a=this._validateEntity(o,n);a.provisional&&i.provisionalEntityIDs.add(s),i.cacheIssues(a.issues)})).filter(Boolean);return i.queue=i.queue.concat(p3(r,50)),i.queuePromise||(i.queuePromise=this._processQueue(i).then(()=>this._revalidateProvisionalEntities(i)).catch(s=>console.error(s)).finally(()=>i.queuePromise=null)),i.queuePromise}_revalidateProvisionalEntities(e){if(!e.provisionalEntityIDs.size)return;let i=window.setTimeout(()=>{this._deferredST.delete(i),e.provisionalEntityIDs.size&&this._validateEntitiesAsync(e.provisionalEntityIDs,e)},IK);this._deferredST.add(i)}_processQueue(e){if(!e.queue.length)return Promise.resolve();let i=e.queue.pop();return new Promise((r,s)=>{let n=window.requestIdleCallback(()=>{this._deferredRIC.delete(n),i.forEach(o=>o()),r()});this._deferredRIC.set(n,s)}).then(()=>{e.queue.length%100===0&&this.emit("validated")}).then(()=>this._processQueue(e))}},sp=class{constructor(e){this.which=e,this.graph=null,this.queue=[],this.queuePromise=null,this.queuedEntityIDs=new Set,this.provisionalEntityIDs=new Set,this.issues=new Map,this.entityIssueIDs=new Map}cacheIssue(e){var i;for(let r of(i=e.entityIds)!=null?i:[]){let s=this.entityIssueIDs.get(r);s||(s=new Set,this.entityIssueIDs.set(r,s)),s.add(e.id)}this.issues.set(e.id,e)}uncacheIssue(e){var i;for(let r of(i=e.entityIds)!=null?i:[]){let s=this.entityIssueIDs.get(r);s&&(s.delete(e.id),s.size||this.entityIssueIDs.delete(r))}this.issues.delete(e.id)}cacheIssues(e=[]){for(let i of e)this.cacheIssue(i)}uncacheIssues(e=[]){for(let i of e)this.uncacheIssue(i)}uncacheIssuesOfType(e){let r=[...this.issues.values()].filter(s=>s.type===e);this.uncacheIssues(r)}uncacheEntityID(e){var r;let i=(r=this.entityIssueIDs.get(e))!=null?r:[];for(let s of i){let n=this.issues.get(s);n&&this.uncacheIssue(n)}this.entityIssueIDs.delete(e),this.provisionalEntityIDs.delete(e)}withAllRelatedEntities(e=[]){var r,s;let i=new Set;for(let n of e){i.add(n);let o=(r=this.entityIssueIDs.get(n))!=null?r:[];for(let a of o){let l=this.issues.get(a),c=(s=l==null?void 0:l.entityIDs)!=null?s:[];for(let d of c)i.add(d)}}return i}};var On={available:new Map};On.available.set("data",Em);On.available.set("edits",Tm);On.available.set("filters",Sm);On.available.set("imagery",Mm);On.available.set("l10n",Pm);On.available.set("locations",Fm);On.available.set("map",p6);On.available.set("map3d",m6);On.available.set("photos",g6);On.available.set("presets",_6);On.available.set("rapid",x6);On.available.set("storage",v6);On.available.set("ui",P6);On.available.set("uploader",R6);On.available.set("urlhash",D6);On.available.set("validator",O6);var gs=class extends sn.default{constructor(e){super(),this.context=e,this.id="",this._active=!1,this._selectedData=new Map,this.operations=[]}enter(){return this._active=!0,!0}exit(){this._active=!1}get active(){return this._active}get selectedData(){return this._selectedData}get selectedIDs(){return Array.from(this._selectedData.keys())}};var rB=!1,B6=class extends gs{constructor(e){super(e),this.id="add-note",this._click=this._click.bind(this),this._cancel=this._cancel.bind(this)}enter(){rB&&console.log("AddNoteMode: entering"),this._active=!0;let e=this.context;return e.enableBehaviors(["hover","draw","map-interaction","map-nudging"]),e.behaviors.draw.on("click",this._click).on("cancel",this._cancel).on("finish",this._cancel),e.systems.edits.on("undone",this._cancel).on("redone",this._cancel),e.behaviors["map-nudging"].allow(),!0}exit(){if(!this._active)return;this._active=!1,rB&&console.log("AddNoteMode: exiting");let e=this.context;e.behaviors.draw.off("click",this._click).off("cancel",this._cancel).off("finish",this._cancel),e.systems.edits.off("undone",this._cancel).off("redone",this._cancel)}_click(e){let i=this.context,r=i.services.osm,s=i.projection,n=e.coord,o=s.invert(n);if(!r)return;let a=Nr({loc:o,status:"open",comments:[]});r.replaceNote(a);let l=new Map().set(a.id,a);i.enter("select",{selection:l})}_cancel(){this.context.enter("browse")}};var sB=!1,U6=class extends gs{constructor(e){super(e),this.id="add-point",this.defaultTags={},this._click=this._click.bind(this),this._cancel=this._cancel.bind(this)}enter(){sB&&console.log("AddPointMode: entering"),this._active=!0;let e=this.context;return e.enableBehaviors(["hover","draw","map-interaction"]),e.behaviors.draw.on("click",this._click).on("cancel",this._cancel).on("finish",this._cancel),e.systems.edits.on("undone",this._cancel).on("redone",this._cancel),!0}exit(){if(!this._active)return;sB&&console.log("AddPointMode: exiting"),this._active=!1;let e=this.context;e.behaviors.draw.off("click",this._click).off("cancel",this._cancel).off("finish",this._cancel),e.systems.edits.off("undone",this._cancel).off("redone",this._cancel)}_click(e){var m,g;let i=this.context,r=i.graph(),s=i.projection,n=e.coord,o=s.invert(n);if(i.systems.locations.blocksAt(o).length)return;let l=(m=e==null?void 0:e.target)==null?void 0:m.data,c=(g=e==null?void 0:e.target)==null?void 0:g.choice,d=l&&r.hasEntity(l.id);if((d==null?void 0:d.type)==="node"){this._clickNode(d.loc,d);return}if((d==null?void 0:d.type)==="way"){let _=js(r.childNodes(d),n,s),v=6;if(_&&_.distance<v){let E=[d.nodes[_.index-1],d.nodes[_.index]];this._clickWay(_.loc,E);return}}this._clickNothing(o)}_clickNothing(e){let i=this.context,r=vi({loc:e,tags:this.defaultTags}),s=i.t("operations.add.annotation.point");i.perform(Ur(r),s),i.enter("select-osm",{selectedIDs:[r.id],newFeature:!0})}_clickWay(e,i){let r=this.context,s=vi({tags:this.defaultTags}),n=r.t("operations.add.annotation.vertex");r.perform(nn({loc:e,edge:i},s),n),r.enter("select-osm",{selectedIDs:[s.id],newFeature:!0})}_clickNode(e,i){let r=this.context;if(Object.keys(this.defaultTags).length===0){r.enter("select-osm",{selectedIDs:[i.id]});return}let s=Object.assign({},i.tags);for(let o in this.defaultTags)s[o]=this.defaultTags[o];let n=r.t("operations.add.annotation.point");r.perform(Xr(i.id,s),n),r.enter("select-osm",{selectedIDs:[i.id],newFeature:!0})}_cancel(){this.context.enter("browse")}};var nB=!1,z6=class extends gs{constructor(e){super(e),this.context=e,this.id="browse"}enter(){return nB&&console.log("BrowseMode: entering"),this.operations=[N6(this.context)],this._active=!0,this.context.enableBehaviors(["hover","select","drag","paste","lasso","map-interaction"]),document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),!0}exit(){this._active&&(this._active=!1,nB&&console.log("BrowseMode: exiting"))}sidebar(){console.error("error: do not call BrowseMode.sidebar anymore")}};var G6=class extends gs{constructor(e){super(e),this.id="drag-node",this.dragNode=null,this._reselectIDs=[],this._wasMidpoint=!1,this._startLoc=null,this._clickLoc=null,this._move=this._move.bind(this),this._end=this._end.bind(this),this._cancel=this._cancel.bind(this)}enter(e={}){var a;let i=this.context,r=e.selection;if(!(r instanceof Map)||!r.size)return!1;this._reselectIDs=(a=e.reselectIDs)!=null?a:[];let[s]=r.values();if(!i.editable())return!1;if(this._wasMidpoint=s.type==="midpoint",!this._wasMidpoint&&i.systems.filters.hasHiddenConnections(s,i.graph()))return i.systems.ui.flash.duration(4e3).iconName("#rapid-icon-no").label(i.t("modes.drag_node.connected_to_hidden"))(),!1;if(this._active=!0,this._wasMidpoint){let l={loc:s.loc,edge:[s.a.id,s.b.id]};s=vi(),i.perform(nn(l,s)),s=i.entity(s.id)}else i.perform(us());this.dragNode=s,this._startLoc=s.loc;let n=i.scene();n.classData("osm",this.dragNode.id,"drawing");for(let l of i.graph().parentWays(this.dragNode))n.classData("osm",l.id,"drawing");let o=i.behaviors.drag.lastDown.coord;return this._clickLoc=i.projection.invert(o),i.enableBehaviors(["hover","drag"]),i.behaviors.drag.on("move",this._move).on("end",this._end).on("cancel",this._cancel),i.systems.edits.on("undone",this._cancel).on("redone",this._cancel),!0}exit(){if(!this._active)return;this._active=!1,this.dragNode=null,this._startLoc=null,this._clickLoc=null,this._wasMidpoint=!1,this._selectedData.clear();let e=this.context;e.scene().clearClass("drawing"),e.behaviors.drag.off("move",this._move).off("end",this._end).off("cancel",this._cancel),e.systems.edits.off("undone",this._cancel).off("redone",this._cancel)}_refreshEntities(){let i=this.context.graph();if(this._selectedData.clear(),this.dragNode=this.dragNode&&i.hasEntity(this.dragNode.id),!this.dragNode){this._cancel();return}this._selectedData.set(this.dragNode.id,this.dragNode)}_move(e){var m,g;if(!this.dragNode)return;let i=this.context,r=i.graph(),s=i.projection,n=e.coord,o=(m=e==null?void 0:e.target)==null?void 0:m.data,a=(g=e==null?void 0:e.target)==null?void 0:g.choice,l=o&&r.hasEntity(o.id),c;if((l==null?void 0:l.type)==="node"&&this._canSnapToNode(l))c=l.loc;else if((l==null?void 0:l.type)==="way"){let _=js(r.childNodes(l),n,s,this.dragNode.id),v=6;_&&_.distance<v&&(c=_.loc)}if(!c){let _=i.projection.project(this._clickLoc),v=i.projection.project(this._startLoc),E=sr(v,_),b=Ir(n,E);c=s.invert(b)}if(i.systems.locations.blocksAt(c).length){this._cancel();return}i.replace(qc(this.dragNode.id,c)),this._refreshEntities()}_end(e){var l,c;if(!this.dragNode)return;let i=this.context,r=i.graph(),s=this.dragNode.geometry(r)==="point",n=(l=e==null?void 0:e.target)==null?void 0:l.data,o=(c=e==null?void 0:e.target)==null?void 0:c.choice,a=n&&r.hasEntity(n.id);if((a==null?void 0:a.type)==="node"&&this._canSnapToNode(a))i.replace(Od([a.id,this.dragNode.id]),this._connectAnnotation(a));else if((a==null?void 0:a.type)==="way"){let d=js(r.childNodes(a),e.coord,i.projection,this.dragNode.id),m=6;if(d&&d.distance<m){let g=[a.nodes[d.index-1],a.nodes[d.index]];i.replace(nn({loc:d.loc,edge:g},this.dragNode),this._connectAnnotation(a))}else i.replace(us(),this._moveAnnotation())}else this._wasMidpoint?i.replace(us(),i.t("operations.add.annotation.vertex")):i.replace(us(),this._moveAnnotation());s&&i.hasEntity(this.dragNode.id)?i.enter("select-osm",{selectedIDs:[this.dragNode.id]}):this._reselectIDs.length?i.enter("select-osm",{selectedIDs:this._reselectIDs}):i.enter("browse")}_moveAnnotation(){if(!this.dragNode)return;let e=this.context,i=this.dragNode.geometry(e.graph());return e.t(`operations.move.annotation.${i}`)}_connectAnnotation(e){if(!this.dragNode||!e)return;let i=this.context,r=i.graph(),s=this.dragNode.geometry(r),n=e.geometry(r);if(s==="vertex"&&n==="vertex"){let o=r.parentWays(this.dragNode),a=r.parentWays(e),l=eo(o,a);if(l.length!==0)return l[0].areAdjacent(this.dragNode.id,e.id)?i.t("operations.connect.annotation.from_vertex.to_adjacent_vertex"):i.t("operations.connect.annotation.from_vertex.to_sibling_vertex")}return i.t(`operations.connect.annotation.from_${s}.to_${n}`)}_canSnapToNode(e){if(!this.dragNode)return!1;let i=this.context.graph(),r=this.context.systems.presets;return this.dragNode.geometry(i)!=="vertex"||e.geometry(i)==="vertex"||r.allowsVertex(e,i)}_cancel(){this.context.enter("browse")}};var gc=!1,$6=class extends gs{constructor(e){super(e),this.id="draw-area",this.defaultTags={},this.drawWay=null,this.drawNode=null,this.firstNode=null,this.lastNode=null,this._startGraph=null,this._move=this._move.bind(this),this._click=this._click.bind(this),this._finish=this._finish.bind(this),this._cancel=this._cancel.bind(this),this._undoOrRedo=this._undoOrRedo.bind(this)}enter(){gc&&console.log("DrawAreaMode: entering");let e=this.context;return this._active=!0,this.defaultTags={area:"yes"},this.drawWay=null,this.drawNode=null,this.lastNode=null,this.firstNode=null,this._startGraph=e.graph(),this._selectedData.clear(),e.enableBehaviors(["hover","draw","map-interaction","map-nudging"]),e.behaviors.draw.on("move",this._move).on("click",this._click).on("finish",this._finish).on("cancel",this._cancel),e.systems.edits.on("undone",this._undoOrRedo).on("redone",this._undoOrRedo),e.behaviors["map-interaction"].doubleClickEnabled=!1,!0}exit(){var r,s;if(!this._active)return;this._active=!1,gc&&console.log("DrawAreaMode: exiting");let e=this.context;if(e.pauseChangeDispatch(),this.drawNode&&(e.pop(),this.drawWay&&(this.drawWay=e.hasEntity(this.drawWay.id))),(((s=(r=this.drawWay)==null?void 0:r.nodes)==null?void 0:s.length)||0)<4)for(gc&&console.log("DrawAreaMode: draw way invalid, rolling back");e.graph()!==this._startGraph;)e.pop();this.drawWay=null,this.drawNode=null,this.lastNode=null,this.firstNode=null,this._selectedData.clear(),e.scene().clearClass("drawing"),window.setTimeout(()=>{e.behaviors["map-interaction"].doubleClickEnabled=!0},1e3),e.behaviors.draw.off("move",this._move).off("click",this._click).off("finish",this._finish).off("cancel",this._cancel),e.systems.edits.off("undone",this._undoOrRedo).off("redone",this._undoOrRedo),e.resumeChangeDispatch()}_refreshEntities(){let e=this.context,i=e.scene(),r=e.graph();if(this._selectedData.clear(),i.clearClass("drawing"),this.drawWay=this.drawWay&&r.hasEntity(this.drawWay.id),this.drawNode=this.drawNode&&r.hasEntity(this.drawNode.id),this.lastNode=this.lastNode&&r.hasEntity(this.lastNode.id),this.firstNode=this.firstNode&&r.hasEntity(this.firstNode.id),!this.drawWay||!this.drawNode||!this.lastNode||!this.firstNode){this._cancel();return}this._selectedData.set(this.drawWay.id,this.drawWay),i.classData("osm",this.drawWay.id,"drawing"),i.classData("osm",this.drawNode.id,"drawing")}_getAnnotation(){var r,s;let e=((s=(r=this.drawWay)==null?void 0:r.nodes)==null?void 0:s.length)||0;if(e<4)return;let i=e>4?"continue":"start";return this.context.t(`operations.${i}.annotation.area`)}_move(e){var d,m;if(!this.drawNode)return;let i=this.context,r=i.graph(),s=i.projection,n=e.coord,o=s.invert(n),a=(d=e==null?void 0:e.target)==null?void 0:d.data,l=(m=e==null?void 0:e.target)==null?void 0:m.choice,c=a&&r.hasEntity(a.id);if((c==null?void 0:c.type)==="node")o=c.loc;else if(c&&c.type==="way"){let g=js(r.childNodes(c),n,s,this.drawNode.id),_=6;g&&g.distance<_&&(o=g.loc)}i.replace(qc(this.drawNode.id,o)),this.drawNode=i.entity(this.drawNode.id)}_click(e){var m,g,_;let i=this.context,r=i.graph(),s=i.projection,n=e.coord,o=s.invert(n);if(i.systems.locations.blocksAt(o).length)return;i.behaviors["map-nudging"].allow();let l=(m=e==null?void 0:e.target)==null?void 0:m.data,c=(g=e==null?void 0:e.target)==null?void 0:g.choice,d=l&&r.hasEntity(l.id);if((d==null?void 0:d.type)==="node"){this._clickNode(d.loc,d);return}if((d==null?void 0:d.type)==="way"){let v=js(r.childNodes(d),n,s,(_=this.drawNode)==null?void 0:_.id),E=6;if(v&&v.distance<E){let b=[d.nodes[v.index-1],d.nodes[v.index]];this._clickWay(v.loc,b);return}}this._clickLoc(o)}_clickLoc(e){let r=this.context;if(r.pauseChangeDispatch(),this.drawWay){if(Zi(e,this.lastNode.loc,1e-6)||Zi(e,this.firstNode.loc,1e-6)){this._finish();return}gc&&console.log(`DrawAreaMode: _clickLoc, extending area to ${e}`),r.replace(us(),this._getAnnotation()),this.lastNode=this.drawNode,this.drawNode=vi({loc:e}),r.perform(Ur(this.drawNode),To(this.drawWay.id,this.drawNode.id))}else gc&&console.log(`DrawAreaMode: _clickLoc, starting area at ${e}`),this.firstNode=vi({loc:e}),this.lastNode=this.firstNode,this.drawNode=vi({loc:e}),this.drawWay=Mr({tags:this.defaultTags,nodes:[this.firstNode.id,this.drawNode.id,this.firstNode.id]}),r.perform(Ur(this.drawNode),Ur(this.firstNode),Ur(this.drawWay));this._refreshEntities(),r.resumeChangeDispatch()}_clickWay(e,i){let s=this.context,n={loc:e,edge:i};if(s.pauseChangeDispatch(),this.drawWay){if(Zi(e,this.lastNode.loc,1e-6)||Zi(e,this.firstNode.loc,1e-6)){this._finish();return}gc&&console.log(`DrawAreaMode: _clickWay, extending area to edge ${i}`),s.replace(qc(this.drawNode.id,e),nn(n,this.drawNode),this._getAnnotation()),this.lastNode=this.drawNode,this.drawNode=vi({loc:e}),s.perform(Ur(this.drawNode),To(this.drawWay.id,this.drawNode.id))}else gc&&console.log(`DrawAreaMode: _clickWay, starting area at edge ${i}`),this.firstNode=vi({loc:e}),this.lastNode=this.firstNode,this.drawNode=vi({loc:e}),this.drawWay=Mr({tags:this.defaultTags,nodes:[this.firstNode.id,this.drawNode.id,this.firstNode.id]}),s.perform(Ur(this.firstNode),Ur(this.drawNode),Ur(this.drawWay),nn(n,this.firstNode));this._refreshEntities(),s.resumeChangeDispatch()}_clickNode(e,i){let s=this.context;if(s.pauseChangeDispatch(),this.drawWay){if(i===this.lastNode||i===this.firstNode||Zi(e,this.lastNode.loc,1e-6)||Zi(e,this.firstNode.loc,1e-6)){this._finish();return}gc&&console.log(`DrawAreaMode: _clickNode, extending area to ${i.id}`),s.replace(this._actionRemoveDrawNode(this.drawWay.id,this.drawNode),To(this.drawWay.id,i.id),this._getAnnotation()),this.lastNode=i,s.perform(Ur(this.drawNode),To(this.drawWay.id,this.drawNode.id))}else gc&&console.log(`DrawAreaMode: _clickNode, starting line at ${i.id}`),this.firstNode=i,this.lastNode=this.firstNode,this.drawNode=vi({loc:e}),this.drawWay=Mr({tags:this.defaultTags,nodes:[this.firstNode.id,this.drawNode.id,this.firstNode.id]}),s.perform(Ur(this.drawNode),Ur(this.drawWay));this._refreshEntities(),s.resumeChangeDispatch()}_actionRemoveDrawNode(e,i){return function(r){return r.replace(r.entity(e).removeNode(i.id)).remove(i)}}_finish(){this.drawWay?(gc&&console.log(`DrawAreaMode: _finish, drawWay.id = ${this.drawWay.id}`),this.context.enter("select-osm",{selectedIDs:[this.drawWay.id],newFeature:!0})):this._cancel()}_cancel(){gc&&console.log("DrawAreaMode: _cancel"),this.drawWay=null,this.drawNode=null,this.firstNode=null,this.lastNode=null,this.context.enter("browse")}_undoOrRedo(){this._cancel()}};var Ll=!1,H6=class extends gs{constructor(e){super(e),this.id="draw-line",this.defaultTags={},this.drawWay=null,this.drawNode=null,this.firstNode=null,this.lastNode=null,this._insertIndex=void 0,this._startGraph=null,this._move=this._move.bind(this),this._click=this._click.bind(this),this._finish=this._finish.bind(this),this._cancel=this._cancel.bind(this),this._undoOrRedo=this._undoOrRedo.bind(this)}enter(e={}){let i=e.continueNode,r=e.continueWay;if(i||r){if(!(i instanceof vi)||!(r instanceof Mr))return!1;Ll&&console.log(`DrawLineMode: entering, continuing line ${r.id}`)}else Ll&&console.log("DrawLineMode: entering");let s=this.context;if(this._active=!0,this.drawWay=null,this.drawNode=null,this.lastNode=null,this.firstNode=null,this._insertIndex=void 0,this._startGraph=s.graph(),this._selectedData.clear(),s.enableBehaviors(["hover","draw","map-interaction","map-nudging"]),s.behaviors.draw.on("move",this._move).on("click",this._click).on("finish",this._finish).on("cancel",this._cancel),s.systems.edits.on("undone",this._undoOrRedo).on("redone",this._undoOrRedo),s.behaviors["map-interaction"].doubleClickEnabled=!1,i&&r){let n=r.affix(i.id)==="prefix",o=n?r.last():r.first();this._insertIndex=n?0:void 0,this.lastNode=i,this.firstNode=s.entity(o),this.drawWay=r,this.drawNode=vi({loc:s.systems.map.mouseLoc()}),s.perform(Ur(this.drawNode),To(this.drawWay.id,this.drawNode.id,this._insertIndex)),this._refreshEntities()}return!0}exit(){var r,s;if(!this._active)return;this._active=!1,Ll&&console.log("DrawLineMode: exiting");let e=this.context;if(e.pauseChangeDispatch(),this.drawNode&&(e.pop(),this.drawWay&&(this.drawWay=e.hasEntity(this.drawWay.id))),(((s=(r=this.drawWay)==null?void 0:r.nodes)==null?void 0:s.length)||0)<2||this.firstNode.id===this.lastNode.id)for(Ll&&console.log("DrawLineMode: draw way invalid, rolling back");e.graph()!==this._startGraph;)e.pop();this.drawWay=null,this.drawNode=null,this.lastNode=null,this.firstNode=null,this._insertIndex=void 0,this._selectedData.clear(),e.scene().clearClass("drawing"),window.setTimeout(()=>{e.behaviors["map-interaction"].doubleClickEnabled=!0},1e3),e.behaviors.draw.off("move",this._move).off("click",this._click).off("finish",this._finish).off("cancel",this._cancel),e.systems.edits.off("undone",this._undoOrRedo).off("redone",this._undoOrRedo),e.resumeChangeDispatch()}_refreshEntities(){let e=this.context,i=e.scene(),r=e.graph();if(this._selectedData.clear(),i.clearClass("drawing"),this.drawWay=this.drawWay&&r.hasEntity(this.drawWay.id),this.drawNode=this.drawNode&&r.hasEntity(this.drawNode.id),this.lastNode=this.lastNode&&r.hasEntity(this.lastNode.id),this.firstNode=this.firstNode&&r.hasEntity(this.firstNode.id),!this.drawWay||!this.drawNode||!this.lastNode||!this.firstNode){this._cancel();return}this._selectedData.set(this.drawWay.id,this.drawWay),i.classData("osm",this.drawNode.id,"drawing"),i.classData("osm",this.drawWay.id,"drawing")}_getAnnotation(){var r,s;let e=((s=(r=this.drawWay)==null?void 0:r.nodes)==null?void 0:s.length)||0;if(e<2)return;let i=e>2?"continue":"start";return this.context.t(`operations.${i}.annotation.line`)}_move(e){var d,m;if(!this.drawNode)return;let i=this.context,r=i.graph(),s=i.projection,n=e.coord,o=s.invert(n),a=(d=e==null?void 0:e.target)==null?void 0:d.data,l=(m=e==null?void 0:e.target)==null?void 0:m.choice,c=a&&r.hasEntity(a.id);if((c==null?void 0:c.type)==="node")o=c.loc;else if((c==null?void 0:c.type)==="way"){let g=js(r.childNodes(c),n,s,this.drawNode.id),_=6;g&&g.distance<_&&(o=g.loc)}i.replace(qc(this.drawNode.id,o)),this.drawNode=i.entity(this.drawNode.id)}_click(e){var m,g,_;let i=this.context,r=i.graph(),s=i.projection,n=e.coord,o=s.invert(n);if(i.systems.locations.blocksAt(o).length)return;i.behaviors["map-nudging"].allow();let l=(m=e==null?void 0:e.target)==null?void 0:m.data,c=(g=e==null?void 0:e.target)==null?void 0:g.choice,d=l&&r.hasEntity(l.id);if((d==null?void 0:d.type)==="node"){this._clickNode(d.loc,d);return}if((d==null?void 0:d.type)==="way"){let v=js(r.childNodes(d),n,s,(_=this.drawNode)==null?void 0:_.id),E=6;if(v&&v.distance<E){let b=[d.nodes[v.index-1],d.nodes[v.index]];this._clickWay(v.loc,b);return}}this._clickLoc(o)}_clickLoc(e){let r=this.context;if(r.pauseChangeDispatch(),this.drawWay){if(Zi(e,this.lastNode.loc,1e-6)||Zi(e,this.firstNode.loc,1e-6)){this._finish();return}Ll&&console.log(`DrawLineMode: _clickLoc, extending line to ${e}`),r.replace(us(),this._getAnnotation()),this.lastNode=this.drawNode,this.drawNode=vi({loc:e}),r.perform(Ur(this.drawNode),To(this.drawWay.id,this.drawNode.id,this._insertIndex))}else Ll&&console.log(`DrawLineMode: _clickLoc, starting line at ${e}`),this.firstNode=vi({loc:e}),this.lastNode=this.firstNode,this.drawNode=vi({loc:e}),this.drawWay=Mr({tags:this.defaultTags,nodes:[this.firstNode.id,this.drawNode.id]}),r.perform(Ur(this.firstNode),Ur(this.drawNode),Ur(this.drawWay));this._refreshEntities(),r.resumeChangeDispatch()}_clickWay(e,i){let s=this.context,n={loc:e,edge:i};if(s.pauseChangeDispatch(),this.drawWay){if(Zi(e,this.lastNode.loc,1e-6)||Zi(e,this.firstNode.loc,1e-6)){this._finish();return}Ll&&console.log(`DrawLineMode: _clickWay, extending line to edge ${i}`),s.replace(qc(this.drawNode.id,e),nn(n,this.drawNode),this._getAnnotation()),this.lastNode=this.drawNode,this.drawNode=vi({loc:e}),s.perform(Ur(this.drawNode),To(this.drawWay.id,this.drawNode.id,this._insertIndex))}else Ll&&console.log(`DrawLineMode: _clickWay, starting line at edge ${i}`),this.firstNode=vi({loc:e}),this.lastNode=this.firstNode,this.drawNode=vi({loc:e}),this.drawWay=Mr({tags:this.defaultTags,nodes:[this.firstNode.id,this.drawNode.id]}),s.perform(Ur(this.firstNode),Ur(this.drawNode),Ur(this.drawWay),nn(n,this.firstNode));this._refreshEntities(),s.resumeChangeDispatch()}_clickNode(e,i){let s=this.context;if(s.pauseChangeDispatch(),this.drawWay){if(i===this.lastNode||i===this.firstNode||Zi(e,this.lastNode.loc,1e-6)||Zi(e,this.firstNode.loc,1e-6)){i===this.firstNode&&(s.replace(this._actionRemoveDrawNode(this.drawWay.id,this.drawNode),To(this.drawWay.id,i.id,this._insertIndex),this._getAnnotation()),this.drawNode=null),this._finish();return}Ll&&console.log(`DrawLineMode: _clickNode, extending line to ${i.id}`),s.replace(this._actionRemoveDrawNode(this.drawWay.id,this.drawNode),To(this.drawWay.id,i.id,this._insertIndex),this._getAnnotation()),this.lastNode=i,s.perform(Ur(this.drawNode),To(this.drawWay.id,this.drawNode.id,this._insertIndex))}else Ll&&console.log(`DrawLineMode: _clickNode, starting line at ${i.id}`),this.firstNode=i,this.lastNode=i,this.drawNode=vi({loc:e}),this.drawWay=Mr({tags:this.defaultTags,nodes:[i.id,this.drawNode.id]}),s.perform(Ur(this.drawNode),Ur(this.drawWay));this._refreshEntities(),s.resumeChangeDispatch()}_actionRemoveDrawNode(e,i){return function(r){return r.replace(r.entity(e).removeNode(i.id)).remove(i)}}_finish(){this.drawWay?(Ll&&console.log(`DrawLineMode: _finish, drawWay.id = ${this.drawWay.id}`),this.context.enter("select-osm",{selectedIDs:[this.drawWay.id],newFeature:!0})):this._cancel()}_cancel(){Ll&&console.log("DrawLineMode: _cancel"),this.drawWay=null,this.drawNode=null,this.firstNode=null,this.lastNode=null,this.context.enter("browse")}_undoOrRedo(){this._cancel()}};var V6=class extends gs{constructor(e){super(e),this.id="move",this._entityIDs=[],this._prevGraph=null,this._startLoc=null,this._movementCache=null,this._cancel=this._cancel.bind(this),this._finish=this._finish.bind(this),this._keydown=this._keydown.bind(this),this._pointermove=this._pointermove.bind(this),this._undoOrRedo=this._undoOrRedo.bind(this)}enter(e={}){let i=e.selection;if(!(i instanceof Map)||!i.size)return!1;this._entityIDs=[...i.keys()],this._active=!0;let r=this.context;return r.systems.filters.forceVisible(this._entityIDs),r.enableBehaviors(["map-interaction","map-nudging"]),r.behaviors["map-nudging"].allow(),this._prevGraph=null,this._startLoc=null,this._movementCache=null,r.systems.map.renderer.events.on("click",this._finish).on("keydown",this._keydown).on("pointercancel",this._cancel).on("pointermove",this._pointermove),r.systems.edits.on("undone",this._undoOrRedo).on("redone",this._undoOrRedo),!0}exit(){if(!this._active)return;this._active=!1,this._prevGraph=null,this._startLoc=null,this._movementCache=null;let e=this.context;e.systems.filters.forceVisible([]),this.context.systems.map.renderer.events.off("click",this._finish).off("keydown",this._keydown).off("pointercancel",this._cancel).off("pointermove",this._pointermove),e.systems.edits.off("undone",this._undoOrRedo).off("redone",this._undoOrRedo)}_keydown(e){["Enter"].includes(e.key)?(e.preventDefault(),this._finish()):["Backspace","Delete","Del","Escape","Esc"].includes(e.key)&&(e.preventDefault(),this._cancel())}_pointermove(){let e=this.context,i;this._prevGraph!==e.graph()?(this._startLoc=e.systems.map.mouseLoc(),this._movementCache={},i=e.perform):i=e.overwrite;let r=e.systems.map.mouseLoc();if(e.systems.locations.blocksAt(r).length){this._cancel();return}let n=e.projection.project(this._startLoc),o=e.projection.project(r),a=sr(o,n);i(Wc(this._entityIDs,a,e.projection,this._movementCache)),this._prevGraph=e.graph(),this._selectedData.clear();for(let l of this._entityIDs)this._selectedData.set(l,e.entity(l))}_finish(){let e=this.context;if(this._prevGraph){let i=this._entityIDs.length===1?e.t("operations.move.annotation."+e.graph().geometry(this._entityIDs[0])):e.t("operations.move.annotation.feature",{n:this._entityIDs.length});e.replace(us(),i)}e.enter("select-osm",{selectedIDs:this._entityIDs})}_cancel(){let e=this.context;this._prevGraph&&e.pop(),e.enter("select-osm",{selectedIDs:this._entityIDs})}_undoOrRedo(){this.context.enter("browse")}};var j6=class extends gs{constructor(e){super(e),this.id="rotate",this._entityIDs=[],this._prevGraph=null,this._lastPoint=null,this._pivotLoc=null,this._cancel=this._cancel.bind(this),this._finish=this._finish.bind(this),this._keydown=this._keydown.bind(this),this._pointermove=this._pointermove.bind(this),this._undoOrRedo=this._undoOrRedo.bind(this)}enter(e={}){let i=e.selection;if(!(i instanceof Map)||!i.size)return!1;this._entityIDs=[...i.keys()],this._active=!0;let r=this.context;return r.systems.filters.forceVisible(this._entityIDs),r.enableBehaviors(["map-interaction"]),this._prevGraph=null,this._lastPoint=null,this._pivotLoc=null,r.systems.map.renderer.events.on("click",this._finish).on("keydown",this._keydown).on("pointercancel",this._cancel).on("pointermove",this._pointermove),r.systems.edits.on("undone",this._undoOrRedo).on("redone",this._undoOrRedo),!0}exit(){if(!this._active)return;this._active=!1,this._prevGraph=null,this._lastPoint=null,this._pivotLoc=null;let e=this.context;e.systems.filters.forceVisible([]),this.context.systems.map.renderer.events.off("click",this._finish).off("keydown",this._keydown).off("pointercancel",this._cancel).off("pointermove",this._pointermove),e.systems.edits.off("undone",this._undoOrRedo).off("redone",this._undoOrRedo)}_keydown(e){["Enter"].includes(e.key)?(e.preventDefault(),this._finish()):["Backspace","Delete","Del","Escape","Esc"].includes(e.key)&&(e.preventDefault(),this._cancel())}_pointermove(){let e=this.context,r=e.systems.map.renderer.events.coord,s;if(this._prevGraph!==e.graph()?(this._pivotLoc=this._calcPivotLoc(),s=e.perform):s=e.replace,this._lastPoint){let n=e.projection.project(this._pivotLoc),[o,a]=sr(r,this._lastPoint),[l,c]=[r[0]>n[0]?1:-1,r[1]>n[1]?-1:1],d=c*o+l*a,m=.3,g=d*(Math.PI/180)*m;s(Vg(this._entityIDs,n,g,e.projection)),this._prevGraph=e.graph()}this._lastPoint=r.slice(),this._selectedData.clear();for(let n of this._entityIDs)this._selectedData.set(n,e.entity(n))}_calcPivotLoc(){let e=this.context.projection,r=ls(this._entityIDs,this.context.graph()).map(n=>e.project(n.loc)),s;return r.length===1?s=r[0]:r.length===2?s=yr(r[0],r[1],.5):Ql(r).length===2?s=yr(r[0],r[1],.5):s=ma(Ql(r)),e.invert(s)}_finish(){let e=this.context;if(this._prevGraph){let i=this._entityIDs.length===1?e.t("operations.rotate.annotation."+e.graph().geometry(this._entityIDs[0])):e.t("operations.rotate.annotation.feature",{n:this._entityIDs.length});e.replace(us(),i)}e.enter("select-osm",{selectedIDs:this._entityIDs})}_cancel(){let e=this.context;this._prevGraph&&e.pop(),e.enter("select-osm",{selectedIDs:this._entityIDs})}_undoOrRedo(){this.context.enter("browse")}};var oB=!1,X6=class extends gs{constructor(e){super(e),this.id="save",this._keybinding=$i("SaveMode"),this._cancel=this._cancel.bind(this),this._hideLoading=this._hideLoading.bind(this),this._keybindingOff=this._keybindingOff.bind(this),this._keybindingOn=this._keybindingOn.bind(this),this._prepareForSuccess=this._prepareForSuccess.bind(this),this._progressChanged=this._progressChanged.bind(this),this._resultConflicts=this._resultConflicts.bind(this),this._resultErrors=this._resultErrors.bind(this),this._resultNoChanges=this._resultNoChanges.bind(this),this._resultSuccess=this._resultSuccess.bind(this),this._saveEnded=this._saveEnded.bind(this),this._saveStarted=this._saveStarted.bind(this),this._showLoading=this._showLoading.bind(this),this._location=null,this._uiConflicts=null,this._uiLoading=null,this._uiSuccess=null,this._wasSuccessfulSave=!1}enter(){oB&&console.log("SaveMode: entering");let e=this.context;e.systems.ui.sidebar.expand();let i=e.services.osm;return i?(this._active=!0,this._wasSuccessfulSave=!1,this._uiCommit=I_(e).on("cancel",this._cancel),i.authenticated()?e.systems.ui.sidebar.show(this._uiCommit):i.authenticate(r=>{r?this._cancel():e.systems.ui.sidebar.show(this._uiCommit)}),e.container().selectAll(".main-content").classed("active",!1).classed("inactive",!0),this._keybindingOn(),e.enableBehaviors(["map-interaction"]),e.systems.uploader.on("progressChanged",this._progressChanged).on("resultConflicts",this._resultConflicts).on("resultErrors",this._resultErrors).on("resultNoChanges",this._resultNoChanges).on("resultSuccess",this._resultSuccess).on("saveEnded",this._saveEnded).on("saveStarted",this._saveStarted).on("willAttemptUpload",this._prepareForSuccess),!0):!1}exit(){this._active&&(this._active=!1,oB&&console.log("SaveMode: exiting"),this._uiCommit.on("cancel",null),this._uiCommit=null,this.context.systems.uploader.off("progressChanged",this._progressChanged).off("resultConflicts",this._resultConflicts).off("resultErrors",this._resultErrors).off("resultNoChanges",this._resultNoChanges).off("resultSuccess",this._resultSuccess).off("saveEnded",this._saveEnded).off("saveStarted",this._saveStarted).off("willAttemptUpload",this._prepareForSuccess),this._keybindingOff(),this._hideLoading(),this.context.container().selectAll(".main-content").classed("active",!0).classed("inactive",!1),this._wasSuccessfulSave||this.context.systems.ui.sidebar.hide())}_cancel(){this.context.enter("browse")}_progressChanged(e,i){let s=this.context.container().select(".loading-modal .modal-section").selectAll(".progress").data([0]);s.enter().append("div").attr("class","progress").merge(s).text(this.context.t("save.conflict_progress",{num:e,total:i}))}_resultConflicts(e,i){let r=this.context,s=r.systems.uploader,n=r.container().select(".sidebar").append("div").attr("class","sidebar-component"),o=r.container().selectAll(".main-content");o.classed("active",!0).classed("inactive",!1),this._uiConflicts=k_(r).conflictList(e).origChanges(i).on("cancel",()=>{o.classed("active",!1).classed("inactive",!0),n.remove(),this._keybindingOn(),s.cancelConflictResolution()}).on("save",()=>{o.classed("active",!1).classed("inactive",!0),n.remove(),s.processResolvedConflicts()}),n.call(this._uiConflicts)}_resultErrors(e){this._keybindingOn();let i=Ch(this.context,this.context.container());i.select(".modal-section.header").append("h3").text(this.context.t("save.error")),this._addErrors(i,e),i.okButton()}_addErrors(e,i){let s=e.select(".modal-section.message-text").selectAll(".error-container").data(i),n=s.enter().append("div").attr("class","error-container");n.append("a").attr("class","error-description").attr("href","#").classed("hide-toggle",!0).text(a=>a.msg||this.context.t("save.unknown_error_details")).on("click",function(a){a.preventDefault();let l=ye(this),c=ye(this.nextElementSibling),d=l.classed("expanded");c.style("display",d?"none":"block"),l.classed("expanded",!d)}),n.append("div").attr("class","error-detail-container").style("display","none").append("ul").attr("class","error-detail-list").selectAll("li").data(a=>a.details||[]).enter().append("li").attr("class","error-detail-item").text(a=>a),s.exit().remove()}_resultNoChanges(){let e=this.context;e.resetAsync().then(()=>e.enter("browse"))}_resultSuccess(e){let i=this.context,r=this._uiSuccess.changeset(e).location(this._location).on("cancel",()=>i.systems.ui.sidebar.hide());this._wasSuccessfulSave=!0,i.systems.ui.sidebar.show(r),window.setTimeout(()=>{i.resetAsync().then(()=>i.enter("browse"))},2500)}_saveStarted(){this._keybindingOff(),this._showLoading()}_saveEnded(){this._keybindingOn(),this._hideLoading()}_showLoading(){if(this._saveLoading)return;let e=this.context;this._saveLoading=Yc(e).message(e.tHtml("save.uploading")).blocking(!0),e.container().call(this._saveLoading)}_hideLoading(){this._saveLoading&&(this._saveLoading.close(),this._saveLoading=null)}_keybindingOn(){ye(document).call(this._keybinding.on("\u238B",this._cancel,!0))}_keybindingOff(){ye(document).call(this._keybinding.unbind)}_prepareForSuccess(){this._uiSuccess=Cx(this.context),this._location=null;let e=this.context.systems.map.center(),i=this.context.services.nominatim;i&&i.reverse(e,(r,s)=>{var c,d,m,g,_;if(r||!s||!s.address)return;let n=s.address,o=(m=(d=(c=n==null?void 0:n.town)!=null?c:n==null?void 0:n.city)!=null?d:n==null?void 0:n.county)!=null?m:"",a=(_=(g=n==null?void 0:n.state)!=null?g:n==null?void 0:n.country)!=null?_:"",l=o&&a?this.context.t("success.thank_you_where.separator"):"";this._location=this.context.t("success.thank_you_where.format",{place:o,separator:l,region:a})})}};var aB=!1,W6=class extends gs{constructor(e){super(e),this.id="select",this.keybinding=null,this.extent=null}enter(e={}){let i=e.selection;if(!(i instanceof Map)||!i.size)return!1;let[[r,s]]=i.entries();aB&&console.log(`SelectMode: entering, selected ${r}`),this._selectedData=i,this._active=!0;let n=this.context;n.enableBehaviors(["hover","select","drag","map-interaction","lasso","paste"]);let o=n.systems.ui.sidebar,a=null;this.extent=new mt;for(let l of i.values()){let c;if(l.loc)c=new mt(l.loc);else if(l.__featurehash__){let d=Ob(l);c=new mt(d[0],d[1])}else if(l.__fbid__){let d=n.services[l.__service__];if(!d)continue;let m=d.graph(l.__datasetid__);if(!m)continue;c=l.extent(m)}c&&(this.extent=this.extent.extend(c))}return s instanceof Nr?(a=K4(n).note(s),a.on("change",()=>{n.systems.map.immediateRedraw();let l=n.services.osm,c=l==null?void 0:l.getNote(r);c instanceof Nr&&(n.systems.ui.sidebar.show(a.note(c)),this._selectedData.set(r,c))})):s instanceof Er&&s.service==="improveOSM"?(a=Y4(n).error(s),a.on("change",()=>{n.systems.map.immediateRedraw();let l=n.services.improveOSM,c=l==null?void 0:l.getError(r);c instanceof Er&&(n.systems.ui.sidebar.show(a.error(c)),this._selectedData.set(r,c))})):s instanceof Er&&s.service==="keepRight"?(a=Q4(n).error(s),a.on("change",()=>{n.systems.map.immediateRedraw();let l=n.services.keepRight,c=l==null?void 0:l.getError(r);c instanceof Er&&(n.systems.ui.sidebar.show(a.error(c)),this._selectedData.set(r,c))})):s instanceof Er&&s.service==="osmose"?(a=J4(n).error(s),a.on("change",()=>{n.systems.map.immediateRedraw();let l=n.services.osmose,c=l==null?void 0:l.getError(r);c instanceof Er&&(n.systems.ui.sidebar.show(a.error(c)),this._selectedData.set(r,c))})):s.__featurehash__?a=j4(n).datum(s):s.__fbid__&&(this.keybinding=$i("select-ai-features"),a=ep(n,this.keybinding).datum(s)),a&&o.show(a),!0}exit(){this._active&&(this._active=!1,this.extent=null,this.keybinding&&(ye(document).call(this.keybinding.unbind),this.keybinding=null),aB&&console.log("SelectMode: exiting"),this._selectedData.clear(),this.context.systems.ui.sidebar.hide())}};var q6=class extends gs{constructor(e){super(e),this.id="select-osm",this.keybinding=null,this.extent=null,this._newFeature=!1,this._focusedParentID=null,this._singularDatum=null,this._esc=this._esc.bind(this),this._firstVertex=this._firstVertex.bind(this),this._focusNextParent=this._focusNextParent.bind(this),this._lastVertex=this._lastVertex.bind(this),this._nextVertex=this._nextVertex.bind(this),this._previousVertex=this._previousVertex.bind(this),this._undoOrRedo=this._undoOrRedo.bind(this)}enter(e={}){let i=e.selectedIDs;if(this._newFeature=e.newFeature,!Array.isArray(i)||!i.length)return!1;let r=this.context,s=r.systems.locations,n=[];this._selectedData=new Map,this._singularDatum=null;for(let o of i){let a=r.hasEntity(o);a&&(a.type==="node"&&s.blocksAt(a.loc).length||(this._selectedData.set(o,a),n.push(o),i.length===1&&(this._singularDatum=a)))}return this._selectedData.size?(this._active=!0,r.enableBehaviors(["hover","select","drag","map-interaction","lasso","paste"]),this.extent=kr(n,r.graph()),r.systems.urlhash.setParam("id",n.join(",")),r.systems.filters.forceVisible(n),this.operations.forEach(o=>{o.behavior&&o.behavior.disable()}),this.operations=Object.values(bA).map(o=>o(r,n)).filter(o=>o.id!=="delete"&&o.id!=="downgrade"&&o.id!=="copy").concat([F6(r,n),L6(r,n),oa(r,n)]).filter(o=>o.available()),this.operations.forEach(o=>{o.behavior&&o.behavior.enable()}),r.systems.ui.closeEditMenu(),this.keybinding=$i("select"),this.keybinding.on(["[","pgup"],this._previousVertex).on(["]","pgdown"],this._nextVertex).on(["{",Li("\u2318["),"home"],this._firstVertex).on(["}",Li("\u2318]"),"end"],this._lastVertex).on(["\\","pause"],this._focusNextParent).on("\u238B",this._esc,!0),ye(document).call(this.keybinding),r.systems.ui.sidebar.select(n,this._newFeature),r.systems.edits.on("undone",this._undoOrRedo).on("redone",this._undoOrRedo),!0):!1}exit(){if(!this._active)return;this._active=!1;let e=this.context,i=this._singularDatum;if(i&&i.type==="relation"&&Object.keys(i.tags).length===0&&e.graph().parentRelations(i).length===0&&(i.members.length===0||i.members.length===1&&!i.members[0].role)){let r=gn(i.id,!0);e.perform(r,e.t("operations.delete.annotation.relation")),e.systems.validator.validate()}this.extent=null,this._newFeature=!1,this._singularDatum=null,this._selectedData.clear(),this.operations.forEach(r=>{r.behavior&&r.behavior.disable()}),this.operations=[],e.systems.ui.closeEditMenu(),e.systems.ui.sidebar.hide(),e.systems.urlhash.setParam("id",null),e.systems.filters.forceVisible([]),this.keybinding&&(ye(document).call(this.keybinding.unbind),this.keybinding=null),e.systems.edits.off("undone",this._undoOrRedo).off("redone",this._undoOrRedo)}_esc(){let e=this.context;e.container().select(".combobox").size()||e.enter("browse")}_undoOrRedo(){let e=this.context,i=e.systems.locations,r=[];for(let[s,n]of this._selectedData)e.hasEntity(s)&&(n.type==="node"&&i.blocksAt(n.loc).length||r.push(s));r.length?e.enter("select-osm",{selectedIDs:r}):e.enter("browse")}_chooseParentWay(e){if(!e)return null;let i=this.context.graph();if(e.type==="way")this._focusedParentID=e.id;else{let r=i.parentWays(e).map(s=>s.id);r.length?r.includes(this._focusedParentID)||(this._focusedParentID=r[0]):this._focusedParentID=null}return i.hasEntity(this._focusedParentID)}_firstVertex(e){e.preventDefault();let i=this.context,r=this._chooseParentWay(this._singularDatum);if(!r)return;let s=i.entity(r.first());i.enter("select-osm",{selectedIDs:[s.id]}),i.systems.map.centerEase(s.loc)}_lastVertex(e){e.preventDefault();let i=this.context,r=this._chooseParentWay(this._singularDatum);if(!r)return;let s=i.entity(r.last());i.enter("select-osm",{selectedIDs:[s.id]}),i.systems.map.centerEase(s.loc)}_previousVertex(e){e.preventDefault();let i=this.context,r=this._singularDatum;if((r==null?void 0:r.type)!=="node")return;let s=this._chooseParentWay(this._singularDatum);if(!s)return;let n=s.nodes.indexOf(r.id),o=-1;if(n>0?o=n-1:s.isClosed()&&(o=length-2),o!==-1){let a=i.entity(s.nodes[o]);i.enter("select-osm",{selectedIDs:[a.id]}),i.systems.map.centerEase(a.loc)}}_nextVertex(e){e.preventDefault();let i=this.context,r=this._singularDatum;if((r==null?void 0:r.type)!=="node")return;let s=this._chooseParentWay(this._singularDatum);if(!s)return;let n=s.nodes.indexOf(r.id),o=-1;if(n<s.nodes.length-1?o=n+1:s.isClosed()&&(o=0),o!==-1){let a=i.entity(s.nodes[o]);i.enter("select-osm",{selectedIDs:[a.id]}),i.systems.map.centerEase(a.loc)}}_focusNextParent(e){e.preventDefault();let i=this._singularDatum;if((i==null?void 0:i.type)!=="node")return;let s=this.context.graph().parentWays(i).map(n=>n.id);if(s.length){let o=s.indexOf(this._focusedParentID)+1;o>=s.length&&(o=0),this._focusedParentID=s[o]}}};function lB(t){var e={id:"drag-note",button:"browse"};let i=t.behaviors.drag.on("start",c).on("move",d).on("end",g);var r,s,n;function o(_,v){r&&window.clearInterval(r),r=window.setInterval(function(){t.systems.map.pan(v),m(_,v)},50)}function a(){r&&(window.clearInterval(r),r=null)}function l(_){return t.projection.project(_.loc)}function c(_,v){n=v;var E=t.services.osm;E&&(n=E.getNote(n.id)),n.id&&(t.surface().selectAll(".note-"+n.id).classed("active",!0),t.perform(us()),t.enter(e))}function d(_,v,E){_.stopPropagation(),s=t.projection.invert(E),m(_);var b=L8(E,t.systems.map.dimensions);b?o(_,b):a()}function m(_,v){v=v||[0,0];var E=_&&_.point||t.projection.project(s),b=sr(E,v),T=t.projection.invert(b);n=n.move(T);var A=t.services.osm;A&&A.replaceNote(n),t.replace(us())}function g(){t.replace(us());let _=new Map().set(n.id,n);t.enter("select",_)}return e.enter=function(){return t.enableBehaviors(["hover","drag","map-interaction"]),!0},e.exit=function(){t.systems.ui.sidebar.hover.cancel(),t.surface().selectAll(".active").classed("active",!1),a()},e}var Pa={available:new Map};Pa.available.set("add-note",B6);Pa.available.set("add-point",U6);Pa.available.set("browse",z6);Pa.available.set("drag-node",G6);Pa.available.set("draw-area",$6);Pa.available.set("draw-line",H6);Pa.available.set("move",V6);Pa.available.set("rotate",j6);Pa.available.set("save",X6);Pa.available.set("select",W6);Pa.available.set("select-osm",q6);var kK="bdf6c800b3ae453b9db239e03d7c1727",MK="https://openstreetmap.maps.arcgis.com/sharing/rest/content",PK="https://openstreetmap.maps.arcgis.com/home",RK=14,Y6=class extends fi{constructor(e){super(e),this.id="esri",this.context=e,this._tiler=new zs().zoomRange(RK),this._datasets={},this._gotDatasets=!1,this._off=!1,this._parseDataset=this._parseDataset.bind(this)}initAsync(){return this.resetAsync()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){for(let e of Object.values(this._datasets))e.cache.inflight&&Object.values(e.cache.inflight).forEach(i=>this._abortRequest(i)),e.graph=new Cn,e.tree=new Qa(e.graph),e.cache={inflight:{},loaded:{},seen:{},origIdTile:{},firstNodeIDs:new Set};return Promise.resolve()}getData(e){let i=this._datasets[e];if(!i||!i.tree||!i.graph)return[];let r=this.context.systems.map.extent();return i.tree.intersects(r,i.graph)}loadTiles(e){if(this._off)return;let i=this._datasets[e];if(!i||!i.layer)return;let r=i.cache,s=this.context.systems.locations,n=this.context.projection,o=this._tiler.getTiles(n).tiles;for(let a of Object.keys(r.inflight))o.find(c=>c.id===a)||(this._abortRequest(r.inflight[a]),delete r.inflight[a]);for(let a of o){if(r.loaded[a.id]||r.inflight[a.id])continue;if(a.wgs84Extent.polygon().slice(0,4).every(d=>s.blocksAt(d).length)){r.loaded[a.id]=!0;continue}this._loadTilePage(i,a,0)}}graph(e){let i=this._datasets[e];return i==null?void 0:i.graph}toggle(e){this._off=!e}loadDatasetsAsync(){if(this._gotDatasets)return Promise.resolve(this._datasets);{let e=this;return new Promise((i,r)=>{n(1);function n(o){fetch(e._searchURL(o)).then(Ai).then(a=>{var l;for(let c of(l=a.results)!=null?l:[])e._parseDataset(c);a.nextStart>0?n(a.nextStart):(e._gotDatasets=!0,i(e._datasets))}).catch(a=>{e._gotDatasets=!1,r(a)})}})}}loadLayerAsync(e){let i=this._datasets[e];return!i||!i.url?Promise.reject(`Unknown datasetID: ${e}`):i.layer?Promise.resolve(i.layer):fetch(this._layerURL(i.url)).then(Ai).then(r=>{if(!r.layers||!r.layers.length)throw new Error(`Missing layer info for datasetID: ${e}`);i.layer=r.layers[0];let s={};for(let n of i.layer.fields)n.type==="esriFieldTypeOID"&&(i.layer.idfield=n.name),n.editable&&(s[n.name]=n.alias);return i.layer.tagmap=s,i.layer}).catch(r=>{r.name!=="AbortError"&&console.error(r)})}_abortRequest(e){e.abort()}_searchURL(e){let i={f:"json",sortField:"title",sortOrder:"asc",num:100,start:e};return`${MK}/groups/${kK}/search?`+lr(i)}_layerURL(e){return`${e}/layers?f=json`}_itemURL(e){return`${PK}/item.html?id=${e}`}_tileURL(e,i,r){r=r||0;let s=e.layer.id,n=e.layer.maxRecordCount||2e3,o=n*r,a={f:"geojson",outfields:"*",outSR:4326,geometryType:"esriGeometryEnvelope",geometry:i.toParam(),resultOffset:o,resultRecordCount:n};return`${e.url}/${s}/query?`+lr(a)}_parseDataset(e){if(this._datasets[e.id])return;this._datasets[e.id]=e,e.graph=new Cn,e.tree=new Qa(e.graph),e.cache={inflight:{},loaded:{},seen:{},origIdTile:{}};let i=ye(document.createElement("div"));i.html(e.licenseInfo),i.selectAll("*").attr("style",null).attr("size",null),e.license_html=i.html(),e.itemURL=this._itemURL(e.id)}_loadTilePage(e,i,r){let s=e.cache;if(s.loaded[i.id])return;let n=new AbortController,o=this._tileURL(e,i.wgs84Extent,r);fetch(o,{signal:n.signal}).then(Ai).then(a=>{var l;if(!a)throw new Error("no geojson");return this._parseTile(e,i,a,(c,d)=>{if(c)throw new Error(c);e.graph.rebase(d,[e.graph],!0),e.tree.rebase(d,!0)}),(l=a.properties)==null?void 0:l.exceededTransferLimit}).then(a=>{a?this._loadTilePage(e,i,++r):(s.loaded[i.id]=!0,delete s.inflight[i.id],this.context.deferredRedraw(),this.emit("loadedData"))}).catch(a=>{a.name!=="AbortError"&&console.error(a)}),s.inflight[i.id]=n}_parseTile(e,i,r,s){var o;if(!r)return s({message:"No GeoJSON",status:-1});let n=[];for(let a of(o=r.features)!=null?o:[]){let l=this._parseFeature(a,e);l&&n.push.apply(n,l)}s(null,n)}_parseFeature(e,i){var _;let r=e.geometry,s=e.properties;if(!r||!s)return null;let n=s[i.layer.idfield]||s.OBJECTID||s.FID||s.id;if(!n||i.cache.seen[n])return null;i.cache.seen[n]=!0;let o=`${i.id}-${n}`,a={__fbid__:o,__origid__:o,__service__:"esri",__datasetid__:i.id},l=[],c=new Map;if(r.type==="Point")return[new vi({loc:r.coordinates,tags:m(s)},a)];if(r.type==="LineString"){let v=d(r.coordinates);if(v.length<2)return null;let E=new Mr({nodes:v,tags:m(s)},a);return l.push(E),l}else if(r.type==="Polygon"){let v=[];for(let E of(_=r.coordinates)!=null?_:[]){let b=d(E);if(b.length<3)continue;let T=b[0],A=b[b.length-1];T!==A&&b.push(T);let M=new Mr({nodes:b});v.push(M)}if(v.length===1)l.push(v[0].update(Object.assign({tags:m(s)},a)));else{let E=v.map((A,M)=>(l.push(A),{id:A.id,role:M===0?"outer":"inner",type:"way"})),b=Object.assign(m(s),{type:"multipolygon"}),T=new Ms({members:E,tags:b},a);l.push(T)}return l}function d(v){let E=[];for(let b of v){let T=b.toString(),A=c.get(T);A||(A=new vi({loc:b}),l.push(A),c.set(T,A)),E.push(A.id)}return E}function m(v){let E={};for(let b of Object.keys(v)){let T=g(i.layer.tagmap[b]),A=g(v[b]);T&&A&&(E[T]=A)}return E.source=`esri/${i.name}`,E}function g(v){return v?v.toString().trim():null}}};var cB=Yi(kl(),1);var DK=14,Kx={ow:"https://grab.community.improve-osm.org/directionOfFlowService",mr:"https://grab.community.improve-osm.org/missingGeoService",tr:"https://grab.community.improve-osm.org/turnRestrictionService"},p0=new Map;p0.set("tr",15473700);p0.set("ow",2003199);p0.set("mr-road",11817677);p0.set("mr-path",10506797);p0.set("mr-parking",15658496);p0.set("mr-both",16753920);var Z6=class extends fi{constructor(e){super(e),this.id="improveOSM",this.autoStart=!1,this._impOsmData={icons:{}},this._cache=null,this._tiler=new zs().zoomRange(DK).skipNullIsland(!0)}initAsync(){return this.resetAsync()}startAsync(){return this.context.systems.data.getDataAsync("qa_data").then(i=>{this._impOsmData=i.improveOSM,this._started=!0})}resetAsync(){if(this._cache)for(let e of Object.values(this._cache.inflightTile))this._abortRequest(e);return this._cache={data:{},loadedTile:{},inflightTile:{},inflightPost:{},closed:{},rtree:new cB.default},Promise.resolve()}getData(){let e=this.context.systems.map.extent();return this._cache.rtree.search(e.bbox()).map(i=>i.data)}loadTiles(){let e={client:"Rapid",status:"OPEN",zoom:"19"},i=this.context,r=this._tiler.getTiles(i.projection).tiles;this._abortUnwantedRequests(this._cache,r);for(let s of r){if(this._cache.loadedTile[s.id]||this._cache.inflightTile[s.id])continue;let[n,o,a,l]=s.wgs84Extent.rectangle(),c=Object.assign({},e,{east:n,south:l,west:a,north:o}),d={};for(let m of Object.keys(Kx)){let g=Object.assign({},c,m==="mr"?{type:"PARKING,ROAD,BOTH,PATH"}:{confidenceLevel:"C1"}),_=`${Kx[m]}/search?`+lr(g),v=new AbortController;d[m]=v,fetch(_,{signal:v.signal}).then(Ai).then(E=>{delete this._cache.inflightTile[s.id][m],Object.keys(this._cache.inflightTile[s.id]).length||(delete this._cache.inflightTile[s.id],this._cache.loadedTile[s.id]=!0),E.roadSegments&&E.roadSegments.forEach(b=>{let{points:T,wayId:A,fromNodeId:M,toNodeId:k}=b,F=`${A}${M}${k}`,O=T.length/2,B;O%1===0?B=this._pointAverage([T[O-1],T[O]]):(O=T[Math.floor(O)],B=[O.lon,O.lat]),B=this._preventCoincident(B,!1);let U=new Er(B,this,m,F,{issueKey:m,identifier:{wayId:A,fromNodeId:M,toNodeId:k},objectId:A,objectType:"way"});U.replacements={percentage:b.percentOfTrips,num_trips:b.numberOfTrips,highway:this._linkErrorObject(i.t("QA.keepRight.error_parts.highway")),from_node:this._linkEntity("n"+b.fromNodeId),to_node:this._linkEntity("n"+b.toNodeId)},this._cache.data[U.id]=U,this._cache.rtree.insert(this._encodeIssueRtree(U))}),E.tiles&&E.tiles.forEach(b=>{let{type:T,x:A,y:M,numberOfTrips:k}=b,F=T.toLowerCase(),O=`${F}${A}${M}${k}`,B=this._pointAverage(b.points);B=this._preventCoincident(B,!1);let U=new Er(B,this,`${m}-${F}`,O,{issueKey:m,identifier:{x:A,y:M}});U.replacements={num_trips:k,geometry_type:i.t(`QA.improveOSM.geometry_types.${F}`)},k===-1&&(U.desc=i.t("QA.improveOSM.error_types.mr.description_alt",U.replacements)),this._cache.data[U.id]=U,this._cache.rtree.insert(this._encodeIssueRtree(U))}),E.entities&&E.entities.forEach(b=>{let{point:T,id:A,segments:M,numberOfPasses:k,turnType:F}=b,O=`${A.replace(/[,:+#]/g,"_")}`,B=this._preventCoincident([T.lon,T.lat],!0),U=A.split(","),z=U[0],Z=U[3],W=U[2].split(":")[1],q=new Er(B,this,m,O,{issueKey:m,identifier:A,objectId:Z,objectType:"node"}),[Q,V]=M[0].points,le=this._cardinalDirection(this._relativeBearing(Q,V));q.replacements={num_passed:k,num_trips:M[0].numberOfTrips,turn_restriction:F.toLowerCase(),from_way:this._linkEntity("w"+z),to_way:this._linkEntity("w"+W),travel_direction:le,junction:this._linkErrorObject(i.t("QA.keepRight.error_parts.this_node"))},this._cache.data[q.id]=q,this._cache.rtree.insert(this._encodeIssueRtree(q)),this.context.deferredRedraw(),this.emit("loadedData")})}).catch(E=>{console.error(E),delete this._cache.inflightTile[s.id][m],Object.keys(this._cache.inflightTile[s.id]).length||(delete this._cache.inflightTile[s.id],this._cache.loadedTile[s.id]=!0)})}this._cache.inflightTile[s.id]=d}}getCommentsAsync(e){if(e.comments)return Promise.resolve(e);let i=e.issueKey,r={};i==="ow"?r=e.identifier:i==="mr"?(r.tileX=e.identifier.x,r.tileY=e.identifier.y):i==="tr"&&(r.targetId=e.identifier);let s=`${Kx[i]}/retrieveComments?`+lr(r),n=o=>{e.comments=o.comments?o.comments.reverse():[],this.replaceItem(e)};return fetch(s).then(Ai).then(n).then(()=>e)}postUpdate(e,i){let r=this.context.services.osm;if(!r||!r.authenticated())return i({message:"Not Authenticated",status:-3},e);if(this._cache.inflightPost[e.id])return i({message:"Error update already inflight",status:-2},e);r.userDetails(s.bind(this));function s(n,o){if(n)return i(n,e);let a=e.issueKey,l=`${Kx[a]}/comment`,c={username:o.display_name,targetIds:[e.identifier]};e.newStatus&&(c.status=e.newStatus,c.text="status changed"),e.newComment&&(c.text=e.newComment);let d=new AbortController;this._cache.inflightPost[e.id]=d;let m={method:"POST",signal:d.signal,body:JSON.stringify(c)};fetch(l,m).then(Ai).then(()=>{if(delete this._cache.inflightPost[e.id],e.newStatus)this.removeItem(e),e.newStatus==="SOLVED"&&(e.issueKey in this._cache.closed||(this._cache.closed[e.issueKey]=0),this._cache.closed[e.issueKey]+=1);else{let g=new Date,_=e.comments?e.comments:[];_.push({username:c.username,text:c.text,timestamp:g.getTime()/1e3}),this.replaceItem(e.update({comments:_,newComment:void 0}))}i&&i(null,e)}).catch(g=>{delete this._cache.inflightPost[e.id],i&&i(g.message)})}}getError(e){return this._cache.data[e]}getColor(e){var i;return(i=p0.get(e))!=null?i:16777215}getIcon(e){return this._impOsmData.icons[e]}replaceItem(e){if(!(!(e instanceof Er)||!e.id))return this._cache.data[e.id]=e,this._updateRtree(this._encodeIssueRtree(e),!0),e}removeItem(e){!(e instanceof Er)||!e.id||(delete this._cache.data[e.id],this._updateRtree(this._encodeIssueRtree(e),!1))}getClosedCounts(){return this._cache.closed}_abortRequest(e){for(let i of Object.values(e))i.abort()}_abortUnwantedRequests(e,i){for(let r of Object.keys(e.inflightTile))i.find(n=>r===n.id)||(this._abortRequest(e.inflightTile[r]),delete e.inflightTile[r])}_encodeIssueRtree(e){return{minX:e.loc[0],minY:e.loc[1],maxX:e.loc[0],maxY:e.loc[1],data:e}}_updateRtree(e,i){this._cache.rtree.remove(e,(r,s)=>r.data.id===s.data.id),i&&this._cache.rtree.insert(e)}_linkErrorObject(e){return`<a class="error_object_link">${e}</a>`}_linkEntity(e){return`<a class="error_entity_link">${e}</a>`}_pointAverage(e){if(e.length){let i=e.reduce((r,s)=>Ir(r,[s.lon,s.lat]),[0,0]);return $o(i,1/e.length)}else return[0,0]}_relativeBearing(e,i){let r=Math.atan2(i.lon-e.lon,i.lat-e.lat);return r<0&&(r+=2*Math.PI),r*180/Math.PI}_cardinalDirection(e){let i=45*Math.round(e/45),r={0:"north",45:"northeast",90:"east",135:"southeast",180:"south",225:"southwest",270:"west",315:"northwest",360:"north"};return this.context.t(`QA.improveOSM.directions.${r[i]}`)}_preventCoincident(e,i){let r=!1;do{e=Ir(e,r?[1e-5,0]:i?[0,1e-5]:[0,0]);let n=new mt(e).bbox();r=this._cache.rtree.search(n).length}while(r);return e}};var dB=Yi(kl(),1);var uB="https://kartaview.org",hB=1e3,FK=14,Q6=class extends fi{constructor(e){super(e),this.id="kartaview",this.autoStart=!1,this._imgZoom=Ff().extent([[0,0],[320,240]]).translateExtent([[0,0],[320,240]]).scaleExtent([1,15]),this._cache={},this._selectedImage=null,this._waitingForPhotoID=null,this._startPromise=null,this._tiler=new zs().zoomRange(FK).skipNullIsland(!0),this._zoomPan=this._zoomPan.bind(this)}initAsync(){return this.resetAsync()}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context,r=e.container().select(".photoviewer").selectAll(".osc-wrapper").data([0]).enter().append("div").attr("class","photo-wrapper osc-wrapper").classed("hide",!0).call(this._imgZoom.on("zoom",this._zoomPan)).on("dblclick.zoom",null);r.append("div").attr("class","photo-attribution fillD");let s=r.append("div").attr("class","photo-controls-wrap").append("div").attr("class","photo-controls");return s.append("button").on("click.back",()=>this._step(-1)).html("\u25C4"),s.append("button").on("click.rotate-ccw",()=>this._rotate(-90)).html("\u293F"),s.append("button").on("click.rotate-cw",()=>this._rotate(90)).html("\u293E"),s.append("button").on("click.forward",()=>this._step(1)).html("\u25BA"),r.append("div").attr("class","osc-image-wrap"),e.systems.ui.photoviewer.on("resize.kartaview",n=>{this._imgZoom=Ff().extent([[0,0],n]).translateExtent([[0,0],n]).scaleExtent([1,15]).on("zoom",this._zoomPan)}),this._started=!0,this._startPromise=Promise.resolve()}resetAsync(){if(this._cache.inflight)for(let e of this._cache.inflight.values())e.controller.abort();return this._cache={inflight:new Map,loaded:new Set,nextPage:new Map,images:new Map,sequences:new Map,rtree:new dB.default},this._selectedImage=null,Promise.resolve()}getImages(){let e=this.context.systems.map.extent();return this._cache.rtree.search(e.bbox()).map(i=>i.data)}getSequences(){var s,n,o;let e=this.context.systems.map.extent(),i=new Set;for(let a of this._cache.rtree.search(e.bbox()))a.data.sequenceID&&i.add(a.data.sequenceID);let r=[];for(let a of i){let l=this._cache.sequences.get(a),c=(s=l==null?void 0:l.images)!=null?s:[];c.length&&r.push({type:"LineString",properties:{id:a,v:l.v,captured_at:(n=c[0])==null?void 0:n.captured_at,captured_by:(o=c[0])==null?void 0:o.captured_by},coordinates:c.map(d=>d.loc).filter(Boolean)})}return r}loadTiles(){let e=this.context.projection,i=Math.floor(Ga(e.scale())),r=this._tiler.getTiles(e).tiles;for(let[s,n]of this._cache.inflight)r.find(a=>s.indexOf(a.id)===0)||n.controller.abort();for(let s of r)this._loadNextTilePage(i,s)}showViewer(){let e=this.context.container().select(".photoviewer").classed("hide",!1);e.selectAll(".photo-wrapper.osc-wrapper.hide").size()&&(e.selectAll(".photo-wrapper:not(.osc-wrapper)").classed("hide",!0),e.selectAll(".photo-wrapper.osc-wrapper").classed("hide",!1))}hideViewer(){this._selectedImage=null;let e=this.context;e.systems.photos.selectPhoto(null);let i=e.container().select(".photoviewer");i.empty()||i.datum(null),i.classed("hide",!0).selectAll(".photo-wrapper").classed("hide",!0),e.container().selectAll(".viewfield-group, .sequence, .icon-sign").classed("currentView",!1),this.setStyles(e,null,!0),this.emit("imageChanged")}selectImageAsync(e){var c;let i=this._cache.images.get(e);this._selectedImage=i;let r=this.context;if(!r.container())return;let s=r.container().select(".photoviewer");if(s.empty()||s.datum(i),this.setStyles(r,null,!0),r.container().selectAll(".icon-sign").classed("currentView",!1),e&&!i&&(this._waitingForPhotoID=e),!i)return Promise.resolve();let n=r.container().select(".photoviewer .osc-wrapper"),o=n.selectAll(".osc-image-wrap"),a=n.selectAll(".photo-attribution").html("");if(n.transition().duration(100).call(this._imgZoom.transform,yl),o.selectAll(".osc-image").remove(),i){let d=this._cache.sequences.get(i.sequenceID),m=(c=d==null?void 0:d.rotation)!=null?c:0;o.append("img").attr("class","osc-image").attr("src",`${uB}/${i.imagePath}`).style("transform",`rotate(${m}deg)`),i.captured_by&&(a.append("a").attr("class","captured_by").attr("target","_blank").attr("href","https://kartaview.org/user/"+encodeURIComponent(i.captured_by)).text("@"+i.captured_by),a.append("span").text("|")),i.captured_at&&(a.append("span").attr("class","captured_at").text(l(i.captured_at)),a.append("span").text("|")),a.append("a").attr("class","image-link").attr("target","_blank").attr("href",`https://kartaview.org/details/${i.sequenceID}/${i.sequenceIndex}`).text("kartaview.org")}return Promise.resolve();function l(d){if(!d)return null;let m={day:"numeric",month:"short",year:"numeric"},g=new Date(d);if(isNaN(g.getTime()))return null;let _=r.systems.l10n.localeCode();return g.toLocaleDateString(_,m)}}setStyles(e,i,r){r&&(e.container().selectAll(".viewfield-group").classed("highlighted",!1).classed("hovered",!1).classed("currentView",!1),e.container().selectAll(".sequence").classed("highlighted",!1).classed("currentView",!1));let s=i==null?void 0:i.id,n=i==null?void 0:i.sequenceID,o=n&&this._cache.sequences.get(n),a=o&&o.images.map(function(b){return b.id})||[],l=e.container().select(".photoviewer"),c=l.empty()?void 0:l.datum(),d=c==null?void 0:c.id,m=c==null?void 0:c.sequenceID,g=m&&this._cache.sequences.get(m),_=g&&g.images.map(function(b){return b.id})||[],v=as(a,_);e.container().selectAll(".layer-kartaview .viewfield-group").classed("highlighted",function(b){return v.indexOf(b.id)!==-1}).classed("hovered",function(b){return b.id===s}).classed("currentView",function(b){return b.id===d}),e.container().selectAll(".layer-kartaview .sequence").classed("highlighted",function(b){return b.properties.id===n}).classed("currentView",function(b){return b.properties.id===m}),e.container().selectAll(".layer-kartaview .viewfield-group .viewfield").attr("d",E);function E(){let b=this.parentNode.__data__;return b.isPano&&b.id!==d?"M 8,13 m -10,0 a 10,10 0 1,0 20,0 a 10,10 0 1,0 -20,0":"M 6,9 C 8,8.4 8,8.4 10,9 L 16,-2 C 12,-5 4,-5 0,-2 z"}}_maxPageAtZoom(e){if(e<15)return 2;if(e===15)return 5;if(e===16)return 10;if(e===17)return 20;if(e===18)return 40;if(e>18)return 80}_loadNextTilePage(e,i){var g;let r=i.wgs84Extent.bbox(),s=this._maxPageAtZoom(e),n=(g=this._cache.nextPage.get(i.id))!=null?g:1;if(n>s)return;let o=`${i.id},${n}`;if(this._cache.loaded.has(o)||this._cache.inflight.has(o))return;let a=lr({ipp:hB,page:n,bbTopLeft:[r.maxY,r.minX].join(","),bbBottomRight:[r.minY,r.maxX].join(",")},!0),l=new AbortController,c={method:"POST",signal:l.signal,body:a,headers:{"Content-Type":"application/x-www-form-urlencoded"}},d=`${uB}/1.0/list/nearby-photos/`,m=fetch(d,c).then(Ai).then(_=>{if(this._cache.loaded.add(o),!_||!_.currentPageItems||!_.currentPageItems.length)throw new Error("No Data");let v=null,E=_.currentPageItems.map(b=>{let T=b.id;if(this._waitingForPhotoID===T&&(v=T,this._waitingForPhotoID=null),this._cache.images.has(T))return null;let A=[+b.lng,+b.lat],M={id:T,loc:A,ca:+b.heading,captured_at:b.shot_date||b.date_added,captured_by:b.username,imagePath:b.lth_name,sequenceID:b.sequence_id,sequenceIndex:+b.sequence_index};this._cache.images.set(T,M);let k=this._cache.sequences.get(M.sequenceID);return k||(k={rotation:0,images:[],v:0},this._cache.sequences.set(M.sequenceID,k)),k.images[M.sequenceIndex]=M,k.v++,{minX:A[0],minY:A[1],maxX:A[0],maxY:A[1],data:M}}).filter(Boolean);if(this._cache.rtree.load(E),_.currentPageItems.length===hB?(this._cache.nextPage.set(i.id,n+1),this._loadNextTilePage(e,i)):this._cache.nextPage.set(i.id,1/0),v){let b=this.context.systems.photos;b.selectPhoto(),b.selectPhoto("kartaview",v)}this.context.deferredRedraw(),this.emit("loadedData")}).catch(_=>{_.name!=="AbortError"&&_ instanceof Error&&console.error(_)}).finally(()=>{this._cache.inflight.delete(o)});this._cache.inflight.set(o,{promise:m,controller:l})}_zoomPan(e){let i=e.transform;this.context.container().select(".photoviewer .osc-image-wrap").call(Sl,i.x,i.y,i.k)}_rotate(e){if(!this._selectedImage)return;let i=this._selectedImage.sequenceID,r=this._cache.sequences.get(i);if(!r)return;let s=r.rotation||0;s+=e,s>180&&(s-=360),s<-180&&(s+=360),r.rotation=s;let n=this.context.container().select(".photoviewer .osc-wrapper");n.transition().duration(100).call(this._imgZoom.transform,yl),n.selectAll(".osc-image").transition().duration(100).style("transform",`rotate(${s}deg)`)}_step(e){if(!this._selectedImage)return;let i=this._selectedImage.sequenceID,r=this._cache.sequences.get(i);if(!r)return;let s=this._selectedImage.sequenceIndex+e,n=r.images[s];if(!n)return;let o=this.context;o.systems.map.centerEase(n.loc),o.systems.photos.selectPhoto("kartaview",n.id),this.emit("imageChanged")}};var fB=Yi(kl(),1);var AA="https://www.keepright.at",LK=14,NK=[30,40,50,60,70,90,100,110,120,130,150,160,170,180,190,191,192,193,194,195,196,197,198,200,201,202,203,204,205,206,207,208,210,220,230,231,232,270,280,281,282,283,284,285,290,291,292,293,294,295,296,297,298,300,310,311,312,313,320,350,360,370,380,390,400,401,402,410,411,412,413],Zn=new Map;["20","40","210","270","310","320","350"].forEach(t=>Zn.set(t,16777113));["60","70","90","100","110","150","220","380"].forEach(t=>Zn.set(t,5627136));["360","370","410"].forEach(t=>Zn.set(t,16751035));Zn.set("50",16777113);Zn.set("120",13382485);Zn.set("130",16755251);Zn.set("160",12281344);Zn.set("170",16776960);Zn.set("180",11193582);Zn.set("190",16724787);Zn.set("200",16629615);Zn.set("230",12281344);Zn.set("280",6244256);Zn.set("290",11193582);Zn.set("300",39168);Zn.set("390",39168);Zn.set("400",13382485);var K6=class extends fi{constructor(e){super(e),this.id="keepRight",this.autoStart=!1,this._krData={errorTypes:{},localizeStrings:{}},this._cache=null,this._tiler=new zs().zoomRange(LK).skipNullIsland(!0)}initAsync(){return this.resetAsync()}startAsync(){return this.context.systems.data.getDataAsync("keepRight").then(i=>{this._krData=i,this._started=!0})}resetAsync(){return this._cache&&Object.values(this._cache.inflightTile).forEach(e=>this._abortRequest(e)),this._cache={data:{},loadedTile:{},inflightTile:{},inflightPost:{},closed:{},rtree:new fB.default},Promise.resolve()}getData(){let e=this.context.systems.map.extent();return this._cache.rtree.search(e.bbox()).map(i=>i.data)}loadTiles(){let e={format:"geojson",ch:NK},i=this.context.projection,r=this._tiler.getTiles(i).tiles;this._abortUnwantedRequests(this._cache,r);for(let s of r){if(this._cache.loadedTile[s.id]||this._cache.inflightTile[s.id])continue;let[n,o,a,l]=s.wgs84Extent.rectangle(),c=Object.assign({},e,{left:n,bottom:l,right:a,top:o}),d=`${AA}/export.php?`+lr(c),m=new AbortController;this._cache.inflightTile[s.id]=m,fetch(d,{signal:m.signal}).then(Ai).then(g=>{if(delete this._cache.inflightTile[s.id],this._cache.loadedTile[s.id]=!0,!g||!g.features||!g.features.length)throw new Error("No Data");for(let _ of g.features){let{properties:{error_type:v,error_id:E,comment:b=null,object_id:T,object_type:A,schema:M,title:k}}=_,{geometry:{coordinates:F},properties:{description:O=""}}=_,B=this._krData.errorTypes[v],U=(Math.floor(v/10)*10).toString(),z=B?v:U,Z=this._krData.errorTypes[z];switch(z){case"170":O=`This feature has a FIXME tag: ${O}`;break;case"292":case"293":O=O.replace("A turn-","This turn-");break;case"294":case"295":case"296":case"297":case"298":O=`This turn-restriction~${O}`;break;case"300":O="This highway is missing a maxspeed tag";break;case"411":case"412":case"413":O=`This feature~${O}`;break}let W=!1;do{F=Ir(F,W?[1e-5,0]:[0,1e-5]);let V=new mt(F).bbox();W=this._cache.rtree.search(V).length}while(W);let q=new Er(F,this,v,E,{comment:b,description:O,whichType:z,parentIssueType:U,severity:Z.severity||"error",objectId:T,objectType:A,schema:M,title:k});q.replacements=this._tokenReplacements(q),this._cache.data[E]=q,this._cache.rtree.insert(this._encodeIssueRtree(q))}this.context.deferredRedraw(),this.emit("loadedData")}).catch(()=>{delete this._cache.inflightTile[s.id],this._cache.loadedTile[s.id]=!0})}}postUpdate(e,i){if(this._cache.inflightPost[e.id])return i({message:"Error update already inflight",status:-2},e);let r={schema:e.schema,id:e.id};e.newStatus&&(r.st=e.newStatus),e.newComment!==void 0&&(r.co=e.newComment);let s=`${AA}/comment.php?`+lr(r),n=new AbortController;this._cache.inflightPost[e.id]=n,fetch(s,{signal:n.signal}).then(Ai).finally(()=>{delete this._cache.inflightPost[e.id],e.newStatus==="ignore"?this.removeItem(e):e.newStatus==="ignore_t"?(this.removeItem(e),this._cache.closed[`${e.schema}:${e.id}`]=!0):e=this.replaceItem(e.update({comment:e.newComment,newComment:void 0,newState:void 0})),i&&i(null,e)})}getError(e){return this._cache.data[e]}getColor(e){var i;return(i=Zn.get(e))!=null?i:16777215}replaceItem(e){return!(e instanceof Er)||!e.id?null:(this._cache.data[e.id]=e,this._updateRtree(this._encodeIssueRtree(e),!0),e)}removeItem(e){!(e instanceof Er)||!e.id||(delete this._cache.data[e.id],this._updateRtree(this._encodeIssueRtree(e),!1))}issueURL(e){return`${AA}/report_map.php?schema=${e.schema}&error=${e.id}`}getClosedIDs(){return Object.keys(this._cache.closed).sort()}_abortRequest(e){e&&e.abort()}_abortUnwantedRequests(e,i){Object.keys(e.inflightTile).forEach(r=>{i.find(n=>r===n.id)||(this._abortRequest(e.inflightTile[r]),delete e.inflightTile[r])})}_encodeIssueRtree(e){return{minX:e.loc[0],minY:e.loc[1],maxX:e.loc[0],maxY:e.loc[1],data:e}}_updateRtree(e,i){this._cache.rtree.remove(e,(r,s)=>r.data.id===s.data.id),i&&this._cache.rtree.insert(e)}_tokenReplacements(e){if(!(e instanceof Er))return;let i=new RegExp(/<\/[a-z][\s\S]*>/),r={},s=this._krData.errorTypes[e.whichType];if(!s){console.log("No Template: ",e.whichType),console.log("  ",e.description);return}if(!s.regex)return;let n=new RegExp(s.regex,"i"),o=n.exec(e.description);if(!o){console.log("Unmatched: ",e.whichType),console.log("  ",e.description),console.log("  ",n);return}for(let a=1;a<o.length;a++){let l=o[a],c;if(c="IDs"in s?s.IDs[a-1]:"",c&&l)l=this._parseError(l,c);else if(i.test(l))l="\\"+l+"\\";else{let d=l.toLowerCase();this._krData.localizeStrings[d]&&(l=this.context.t("QA.keepRight.error_parts."+this._krData.localizeStrings[d]))}r["var"+a]=l}return r}_parseError(e,i){let r=e.toLowerCase();switch(this._krData.localizeStrings[r]&&(e=this.context.t("QA.keepRight.error_parts."+this._krData.localizeStrings[r])),i){case"this":e=s(e);break;case"url":e=o(e);break;case"n":case"w":case"r":e=n(i+e);break;case"20":e=m(e);break;case"211":e=a(e);break;case"231":e=l(e);break;case"294":e=c(e);break;case"370":e=d(e);break}return e;function s(g){return`<a class="error_object_link">${g}</a>`}function n(g){return`<a class="error_entity_link">${g}</a>`}function o(g){return`<a class="kr_external_link" target="_blank" href="${g}">${g}</a>`}function a(g){let _=[],v=g.split(", ");for(let E of v){let b=n("n"+E.slice(1));_.push(b)}return _.join(", ")}function l(g){let _=[],v=g.split("),");for(let E of v){let b=E.match(/\#(\d+)\((.+)\)?/);b!==null&&b.length>2&&_.push(n("w"+b[1])+" "+this.context.t("QA.keepRight.errorTypes.231.layer",{layer:b[2]}))}return _.join(", ")}function c(g){let _=[],v=g.split(",");for(let E of v){let b=E.split(" "),T=`"${b[0]}"`,A=b[1].slice(0,1),M=b[2].slice(1);M=n(A+M),_.push(`${T} ${b[1]} ${M}`)}return _.join(", ")}function d(g){if(!g)return"";let _=g.match(/\(including the name (\'.+\')\)/);return _!=null&&_.length?this.context.t("QA.keepRight.errorTypes.370.including_the_name",{name:_[1]}):""}function m(g){let _=[],v=g.split(",");for(let E of v){let b=n("n"+E.slice(1));_.push(b)}return _.join(", ")}}};var DA=Yi(kA(),1),FA=Yi(RA(),1),iv=Yi(kl(),1);var cp="MLY|3376030635833192|f13ab0bdf6b2f7b99e0d8bd5868e1d88",CB="https://graph.mapillary.com/",LA="https://tiles.mapillary.com/maps/vtp",hJ=`${LA}/mly1_public/2/{z}/{x}/{y}?access_token=${cp}`,dJ=`${LA}/mly_map_feature_point/2/{z}/{x}/{y}?access_token=${cp}`,fJ=`${LA}/mly_map_feature_traffic_sign/2/{z}/{x}/{y}?access_token=${cp}`,pJ="mapillary-js/mapillary.css",mJ="mapillary-js/mapillary.js",gJ=14,J6=class extends fi{constructor(e){super(e),this.id="mapillary",this._startPromise=null,this._mlyActiveImage=null,this._mlyCache={},this._mlyIsFallback=!1,this._mlyHighlightedDetection=null,this._mlyShowFeatureDetections=!1,this._mlyShowSignDetections=!1,this._mlyViewer=null,this._mlyViewerFilter=["all"],this._tiler=new zs().zoomRange(gJ).skipNullIsland(!0)}initAsync(){return this.resetAsync()}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context;return e.container().select(".photoviewer").selectAll(".mly-wrapper").data([0]).enter().append("div").attr("id","rapideditor-mly").attr("class","photo-wrapper mly-wrapper").classed("hide",!0),this._startPromise=new Promise((r,s)=>{let n=0;function o(){n+=1,n===2&&r()}let a=ye("head");a.selectAll("#rapideditor-mapillary-viewercss").data([0]).enter().append("link").attr("id","rapideditor-mapillary-viewercss").attr("rel","stylesheet").attr("crossorigin","anonymous").attr("href",e.asset(pJ)).on("load",o).on("error",s),a.selectAll("#rapideditor-mapillary-viewerjs").data([0]).enter().append("script").attr("id","rapideditor-mapillary-viewerjs").attr("crossorigin","anonymous").attr("src",e.asset(mJ)).on("load",o).on("error",s)}).then(()=>this._initViewer()).then(()=>this._started=!0).catch(r=>{r instanceof Error&&console.error(r),this._startPromise=null}),this._startPromise}resetAsync(){return this._mlyCache.requests&&Object.values(this._mlyCache.requests.inflight).forEach(function(e){e.abort()}),this._mlyCache={images:{rtree:new iv.default,forImageID:{}},signs:{rtree:new iv.default},points:{rtree:new iv.default},sequences:new Map,image_detections:{forImageID:{}},requests:{loaded:{},inflight:{}}},this._mlyActiveImage=null,Promise.resolve()}getData(e){if(!["images","signs","points"].includes(e))return[];let i=this.context.systems.map.extent();return this._mlyCache[e].rtree.search(i.bbox()).map(s=>s.data)}getSequences(){let e=this.context.systems.map.extent(),i=new Map;for(let r of this._mlyCache.images.rtree.search(e.bbox())){let s=r.data.sequenceID;if(!s)continue;let n=this._mlyCache.sequences.get(s);n&&(i.has(s)||i.set(s,n))}return[...i.values()]}loadTiles(e){if(!["images","signs","points"].includes(e))return;let i=this.context.projection,r=this._tiler.getTiles(i).tiles;for(let s of r)this._loadTile(e,s)}resetTags(){this._mlyViewer&&!this._mlyIsFallback&&this._mlyViewer.getComponent("tag").removeAll()}showFeatureDetections(e){this._mlyShowFeatureDetections=e,!this._mlyShowFeatureDetections&&!this._mlyShowSignDetections&&this.resetTags()}showSignDetections(e){this._mlyShowSignDetections=e,!this._mlyShowFeatureDetections&&!this._mlyShowSignDetections&&this.resetTags()}filterViewer(){let e=this.context.systems.photos,i=e.showsPanoramic,r=e.showsFlat,s=e.fromDate,n=e.toDate,o=["all"];return i||o.push(["!=","cameraType","spherical"]),!r&&i&&o.push(["==","pano",!0]),s&&o.push([">=","capturedAt",new Date(s).getTime()]),n&&o.push([">=","capturedAt",new Date(n).getTime()]),this._mlyViewer&&this._mlyViewer.setFilter(o),this._mlyViewerFilter=o,o}showViewer(){let e=this.context.container().select(".photoviewer").classed("hide",!1);e.selectAll(".photo-wrapper.mly-wrapper.hide").size()&&this._mlyViewer&&(e.selectAll(".photo-wrapper:not(.mly-wrapper)").classed("hide",!0),e.selectAll(".photo-wrapper.mly-wrapper").classed("hide",!1),this._mlyViewer.resize())}hideViewer(){this._mlyActiveImage=null;let e=this.context;e.systems.photos.selectPhoto(null),!this._mlyIsFallback&&this._mlyViewer&&this._mlyViewer.getComponent("sequence").stop();let i=e.container().select(".photoviewer");i.empty()||i.datum(null),i.classed("hide",!0).selectAll(".photo-wrapper").classed("hide",!0),this.setStyles(e,null),this.emit("imageChanged")}highlightDetection(e){return e&&(this._mlyHighlightedDetection=e.id),this}selectImageAsync(e){return e?this.startAsync().then(()=>this._mlyViewer.moveTo(e).catch(i=>console.error("mly3",i))):Promise.resolve()}getActiveImage(){return this._mlyActiveImage}getDetectionsAsync(e){return this._loadDataAsync(`${CB}/${e}/detections?access_token=${cp}&fields=id,value,image`)}setActiveImage(e){e?this._mlyActiveImage={ca:e.originalCompassAngle,id:e.id,loc:[e.originalLngLat.lng,e.originalLngLat.lat],isPano:e.cameraType==="spherical",sequenceID:e.sequenceID}:this._mlyActiveImage=null}setStyles(e,i){let r=i==null?void 0:i.id,s=i==null?void 0:i.sequenceID,n=this._mlyActiveImage&&this._mlyActiveImage.sequenceID;e.container().selectAll(".layer-mapillary .viewfield-group").classed("highlighted",function(o){return o.sequenceID===n||o.id===r}).classed("hovered",function(o){return o.id===r}),e.container().selectAll(".layer-mapillary .sequence").classed("highlighted",function(o){return o.properties.id===s}).classed("currentView",function(o){return o.properties.id===n})}updateDetections(e,i){if(!this._mlyViewer||this._mlyIsFallback||!e)return;let r=this._mlyCache.image_detections,s=r.forImageID[e];s?this._showDetections(s):this._loadDataAsync(i).then(n=>{for(let o of n)r.forImageID[e]||(r.forImageID[e]=[]),r.forImageID[e].push({id:o.id,geometry:o.geometry,image_id:e,value:o.value});this._showDetections(r.forImageID[e]||[])})}_showDetections(e){let i=this._mlyViewer.getComponent("tag");for(let r of e){let s=this._makeTag(r);s&&i.add([s])}}_makeTag(e){let i=e.value.split("--");if(!i.length)return;let r,s,n=16777215;this._mlyHighlightedDetection===e.id&&(n=16776960,s=i[1],(s==="flat"||s==="discrete"||s==="sign")&&(s=i[2]),s=s.replace(/-/g," "),s=s.charAt(0).toUpperCase()+s.slice(1),this._mlyHighlightedDetection=null);let o=window.atob(e.geometry),a=new Uint8Array(o.length);for(let _=0;_<o.length;_++)a[_]=o.charCodeAt(_);let c=new DA.VectorTile(new FA.default(a.buffer)).layers["mpy-or"],m=c.feature(0).loadGeometry().map(_=>_.map(v=>[v.x/c.extent,v.y/c.extent])),g=window.mapillary;return r=new g.OutlineTag(e.id,new g.PolygonGeometry(m[0]),{text:s,textColor:n,lineColor:n,lineWidth:2,fillColor:n,fillOpacity:.3}),r}_loadTile(e,i){if(!["images","signs","points"].includes(e))return;let r=this._mlyCache.requests,s=`${i.id}-${e}`;if(r.loaded[s]||r.inflight[s])return;let n=new AbortController;r.inflight[s]=n;let o={images:hJ,signs:fJ,points:dJ}[e];o=o.replace("{x}",i.xyz[0]).replace("{y}",i.xyz[1]).replace("{z}",i.xyz[2]),fetch(o,{signal:n.signal}).then(Ai).then(a=>{if(r.loaded[s]=!0,!a)throw new Error("No Data");this._loadTileDataToCache(a,i),this.context.deferredRedraw(),e==="images"?this.emit("loadedImages"):e==="signs"?this.emit("loadedSigns"):e==="points"&&this.emit("loadedMapFeatures")}).catch(a=>{a.name!=="AbortError"&&(a instanceof Error&&console.error(a),r.loaded[s]=!0)}).finally(()=>{delete r.inflight[s]})}_loadTileDataToCache(e,i){let r=new DA.VectorTile(new FA.default(e));if(r.layers.hasOwnProperty("image")){let s=this._mlyCache.images,n=r.layers.image,o=[];for(let a=0;a<n.length;a++){let l=n.feature(a).toGeoJSON(i.xyz[0],i.xyz[1],i.xyz[2]);if(!l||s.forImageID[l.properties.id]!==void 0)continue;let c=l.geometry.coordinates,d={id:l.properties.id,loc:c,captured_at:l.properties.captured_at,ca:l.properties.compass_angle,isPano:l.properties.is_pano,sequenceID:l.properties.sequence_id};s.forImageID[d.id]=d,o.push({minX:c[0],minY:c[1],maxX:c[0],maxY:c[1],data:d})}s.rtree.load(o)}if(r.layers.hasOwnProperty("sequence")){let s=this._mlyCache.sequences,n=r.layers.sequence;for(let o=0;o<n.length;o++){let a=n.feature(o).toGeoJSON(i.xyz[0],i.xyz[1],i.xyz[2]);if(!a)continue;let l=a.properties.id,c=s.get(l);c||(c=[],s.set(l,c)),c.push(a)}}if(r.layers.hasOwnProperty("point")){let s=this._mlyCache.points,n=r.layers.point,o=[];for(let a=0;a<n.length;a++){let l=n.feature(a).toGeoJSON(i.xyz[0],i.xyz[1],i.xyz[2]);if(!l)continue;let c=l.geometry.coordinates,d={id:l.properties.id,loc:c,first_seen_at:l.properties.first_seen_at,last_seen_at:l.properties.last_seen_at,value:l.properties.value};o.push({minX:c[0],minY:c[1],maxX:c[0],maxY:c[1],data:d})}s.rtree.load(o)}if(r.layers.hasOwnProperty("traffic_sign")){let s=this._mlyCache.signs,n=r.layers.traffic_sign,o=[];for(let a=0;a<n.length;a++){let l=n.feature(a).toGeoJSON(i.xyz[0],i.xyz[1],i.xyz[2]),c=l.geometry.coordinates,d={id:l.properties.id,loc:c,first_seen_at:l.properties.first_seen_at,last_seen_at:l.properties.last_seen_at,value:l.properties.value};o.push({minX:c[0],minY:c[1],maxX:c[0],maxY:c[1],data:d})}s.rtree.load(o)}}_loadDataAsync(e){return fetch(e).then(Ai).then(i=>(i==null?void 0:i.data)||[]).catch(i=>{i.name!=="AbortError"&&i instanceof Error&&console.error(i)})}_initViewer(){let e=window.mapillary;if(!e)return;let i=this.context,r={accessToken:cp,component:{cover:!1,keyboard:!1,tag:!0},container:"rapideditor-mly"};!e.isSupported()&&e.isFallbackSupported()&&(this._mlyIsFallback=!0,r.component={cover:!1,direction:!1,imagePlane:!1,keyboard:!1,mouse:!1,sequence:!1,tag:!1,image:!0,navigation:!0});let s=o=>{this.resetTags();let a=o.image;this.setActiveImage(a),this.setStyles(i,null);let l=[a.originalLngLat.lng,a.originalLngLat.lat];i.systems.map.centerEase(l),i.systems.photos.selectPhoto("mapillary",a.id),(this._mlyShowFeatureDetections||this._mlyShowSignDetections)&&this.updateDetections(a.id,`${CB}/${a.id}/detections?access_token=${cp}&fields=id,image,geometry,value`),this.emit("imageChanged")},n=o=>{this.emit("bearingChanged",void 0,o)};this._mlyViewer=new e.Viewer(r),this._mlyViewer.on("image",s),this._mlyViewer.on("bearing",n),this._mlyViewerFilter&&this._mlyViewer.setFilter(this._mlyViewerFilter),i.systems.ui.photoviewer.on("resize.mapillary",()=>{this._mlyViewer&&this._mlyViewer.resize()})}};var yJ="https://mapwith.ai/maps/ml_roads",_J=16,e7=class extends fi{constructor(e){super(e),this.id="mapwithai",this._tiler=new zs().zoomRange(_J),this._datasets={},this._deferred=new Set,this._off=!1,this._parseNode=this._parseNode.bind(this),this._parseWay=this._parseWay.bind(this)}initAsync(){return this.resetAsync().then(()=>{let e="rapid_intro_graph",i=new Cn,r=new Qa(i),n={id:e,graph:i,tree:r,cache:{inflight:{},loaded:{},seen:{},origIdTile:{},firstNodeIDs:new Set}};this._datasets[e]=n})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){for(let e of this._deferred)window.cancelIdleCallback(e),this._deferred.delete(e);for(let e of Object.values(this._datasets))e.cache.inflight&&Object.values(e.cache.inflight).forEach(i=>this._abortRequest(i)),e.graph=new Cn,e.tree=new Qa(e.graph),e.cache={inflight:{},loaded:{},seen:{},origIdTile:{},firstNodeIDs:new Set};return Promise.resolve()}getData(e){let i=this._datasets[e];if(!i||!i.tree||!i.graph)return[];let r=this.context.systems.map.extent();return i.tree.intersects(r,i.graph)}loadTiles(e){if(this._off)return;let i=this._datasets[e],r,s,n;i?(r=i.graph,s=i.tree,n=i.cache):(r=new Cn,s=new Qa(r),n={inflight:{},loaded:{},seen:{},origIdTile:{},firstNodeIDs:new Set},i={id:e,graph:r,tree:s,cache:n},this._datasets[e]=i);let o=this.context.systems.locations,a=this.context.projection,l=this._tiler.getTiles(a).tiles;for(let c of Object.keys(n.inflight))l.find(m=>m.id===c)||(this._abortRequest(n.inflight[c]),delete n.inflight[c]);for(let c of l){if(n.loaded[c.id]||n.inflight[c.id])continue;if(c.wgs84Extent.polygon().slice(0,4).every(v=>o.blocksAt(v).length)){n.loaded[c.id]=!0;continue}let g=this._tileURL(i,c.wgs84Extent),_=new AbortController;fetch(g,{signal:_.signal}).then(Ai).then(v=>{delete n.inflight[c.id],v&&this._parseXML(i,v,c,(E,b)=>{E||(r.rebase(b,[r],!0),s.rebase(b,!0),n.loaded[c.id]=!0,this.context.deferredRedraw(),this.emit("loadedData"))})}).catch(v=>{v.name!=="AbortError"&&console.error(v)}),n.inflight[c.id]=_}}graph(e){let i=this._datasets[e];return i==null?void 0:i.graph}merge(e,i){let r=this._datasets[e];!r||!r.tree||!r.graph||(r.graph.rebase(i,[r.graph],!1),r.tree.rebase(i,!1))}toggle(e){this._off=!e}_abortRequest(e){e.abort()}_tileURL(e,i){let r=/-conflated$/.test(e.id),s=e.id.replace("-conflated",""),n={conflate_with_osm:r,theme:"ml_road_vector",collaborator:"fbid",token:"ASZUVdYpCkd3M6ZrzjXdQzHulqRMnxdlkeBJWEKOeTUoY_Gwm9fuEd2YObLrClgDB_xfavizBsh0oDfTWTF7Zb4C",hash:"ASYM8LPNy8k1XoJiI7A"};s==="fbRoads"?n.result_type="road_vector_xml":s==="msBuildings"?(n.result_type="road_building_vector_xml",n.building_source="microsoft"):(n.result_type="osm_xml",n.sources=`esri_building.${s}`),n.bbox=i.toParam();let o=this.context.systems.rapid.taskExtent;return o&&(n.crop_bbox=o.toParam()),yJ+"?"+l(n,!0);function l(c,d){function m(g){return encodeURIComponent(g).replace(/(%2F|%3A|%2C|%7B|%7D)/g,decodeURIComponent)}return Object.keys(c).map(g=>encodeURIComponent(g)+"="+(d?m(c[g]):encodeURIComponent(c[g]))).join("&")}}_getLoc(e){var s,n;let i=(s=e.lon)==null?void 0:s.value,r=(n=e.lat)==null?void 0:n.value;return[parseFloat(i),parseFloat(r)]}_getNodes(e){return Array.from(e.getElementsByTagName("nd")).map(r=>"n"+r.attributes.ref.value)}_getTags(e){var s,n;let i=Array.from(e.getElementsByTagName("tag")),r={};for(let o of i){let a=o.attributes,l=((s=a.k.value)!=null?s:"").trim(),c=((n=a.v.value)!=null?n:"").trim();l&&c&&(r[l]=c)}return r}_getVisible(e){return!e.visible||e.visible.value!=="false"}_parseNode(e,i){let r=e.attributes;return new vi({id:i,visible:this._getVisible(r),loc:this._getLoc(r),tags:this._getTags(e)})}_parseWay(e,i){let r=e.attributes;return new Mr({id:i,visible:this._getVisible(r),tags:this._getTags(e),nodes:this._getNodes(e)})}_parseXML(e,i,r,s,n){if(n=Object.assign({skipSeen:!0},n),!i||!i.childNodes)return s({message:"No XML",status:-1});let a=i.childNodes[0].childNodes,l=window.requestIdleCallback(()=>{this._deferred.delete(l);let c=[];for(let d of a){let m=this._parseChild(e,r,d,n);m&&c.push(m)}s(null,c)});this._deferred.add(l)}_parseChild(e,i,r,s){let n=e.graph,o=e.cache,a;if(r.nodeName==="node"?a=this._parseNode:r.nodeName==="way"&&(a=this._parseWay),!a)return null;let l=Dt.id.fromOSM(r.nodeName,r.attributes.id.value);if(s.skipSeen){if(o.seen[l]||o.origIdTile[l])return null;o.seen[l]=!0}let c;if(r.attributes.orig_id){if(c=Dt.id.fromOSM(r.nodeName,r.attributes.orig_id.value),n.hasEntity(c)||o.origIdTile[c]&&o.origIdTile[c]!==i.id)return null;o.origIdTile[c]=i.id}let d=a(r,l);if(/^msBuildings/.test(e.id)&&d.type==="way"){let g=d.nodes[0];if(o.firstNodeIDs.has(g))return null;o.firstNodeIDs.add(g)}let m={__fbid__:r.attributes.id.value,__origid__:c,__service__:"mapwithai",__datasetid__:e.id};return Object.assign(d,m)}};var NA=Yi(kl(),1);var t7=class extends fi{constructor(e){super(e),this.id="nominatim",this.apibase="https://nominatim.openstreetmap.org/",this._inflight={},this._nominatimCache=new NA.default,this.countryCode=this.countryCode.bind(this),this.reverse=this.reverse.bind(this),this.search=this.search.bind(this)}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Object.values(this._inflight).forEach(e=>e.abort()),this._inflight={},this._nominatimCache=new NA.default,Promise.resolve()}countryCode(e,i){this.reverse(e,(r,s)=>r?i(r):s.address?i(null,s.address.country_code):i("Unable to geocode",null))}reverse(e,i){let r=this._nominatimCache.search({minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]});if(r.length>0){i&&i(null,r[0].data);return}let s={zoom:13,format:"json",addressdetails:1,lat:e[1],lon:e[0]},n=this.apibase+"reverse?"+lr(s);if(this._inflight[n])return;let o=new AbortController;this._inflight[n]=o;let a=this.context.systems.l10n,l={signal:o.signal,headers:{"Accept-Language":a.localeCodes().join(",")}};fetch(n,l).then(Ai).then(c=>{if(delete this._inflight[n],c!=null&&c.error)throw new Error(c.error);let d=new mt(e).padByMeters(200);this._nominatimCache.insert(Object.assign(d.bbox(),{data:c})),i&&i(null,c)}).catch(c=>{delete this._inflight[n],c.name!=="AbortError"&&i&&i(c.message)})}search(e,i){let r=encodeURIComponent(e),s=this.apibase+`search?q=${r}&limit=10&format=json`;if(this._inflight[s])return;let n=new AbortController;this._inflight[s]=n;let o=this.context.systems.l10n,a={signal:n.signal,headers:{"Accept-Language":o.localeCodes().join(",")}};fetch(s,a).then(Ai).then(l=>{if(delete this._inflight[s],l!=null&&l.error)throw new Error(l.error);i&&i(null,l)}).catch(l=>{delete this._inflight[s],l.name!=="AbortError"&&i&&i(l.message)})}};var RB=Yi(km(),1);var IB=Yi(P9(),1);function m0(t){return typeof t!="string"?"":IB.default.remove(t.replace(/&/g,"and").replace(/(|i)/ig,"i").replace(/[\s\-=_!"#%'*{},.\/:;?\(\)\[\]@\\$\^*+<>~`\u00a1\u00a7\u00b6\u00b7\u00bf\u037e\u0387\u055a-\u055f\u0589\u05c0\u05c3\u05c6\u05f3\u05f4\u0609\u060a\u060c\u060d\u061b\u061e\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0830-\u083e\u085e\u0964\u0965\u0970\u0af0\u0df4\u0e4f\u0e5a\u0e5b\u0f04-\u0f12\u0f14\u0f85\u0fd0-\u0fd4\u0fd9\u0fda\u104a-\u104f\u10fb\u1360-\u1368\u166d\u166e\u16eb-\u16ed\u1735\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u1805\u1807-\u180a\u1944\u1945\u1a1e\u1a1f\u1aa0-\u1aa6\u1aa8-\u1aad\u1b5a-\u1b60\u1bfc-\u1bff\u1c3b-\u1c3f\u1c7e\u1c7f\u1cc0-\u1cc7\u1cd3\u2000-\u206f\u2cf9-\u2cfc\u2cfe\u2cff\u2d70\u2e00-\u2e7f\u3001-\u3003\u303d\u30fb\ua4fe\ua4ff\ua60d-\ua60f\ua673\ua67e\ua6f2-\ua6f7\ua874-\ua877\ua8ce\ua8cf\ua8f8-\ua8fa\ua92e\ua92f\ua95f\ua9c1-\ua9cd\ua9de\ua9df\uaa5c-\uaa5f\uaade\uaadf\uaaf0\uaaf1\uabeb\ufe10-\ufe16\ufe19\ufe30\ufe45\ufe46\ufe49-\ufe4c\ufe50-\ufe52\ufe54-\ufe57\ufe5f-\ufe61\ufe68\ufe6a\ufe6b\ufeff\uff01-\uff03\uff05-\uff07\uff0a\uff0c\uff0e\uff0f\uff1a\uff1b\uff1f\uff20\uff3c\uff61\uff64\uff65]+/g,"").toLowerCase())}var kB={matchGroups:{adult_gaming_centre:["amenity/casino","amenity/gambling","leisure/adult_gaming_centre"],bar:["amenity/bar","amenity/pub","amenity/restaurant"],beauty:["shop/beauty","shop/hairdresser_supply"],bed:["shop/bed","shop/furniture"],beverages:["shop/alcohol","shop/beer","shop/beverages","shop/kiosk","shop/wine"],camping:["tourism/camp_site","tourism/caravan_site"],car_parts:["shop/car_parts","shop/car_repair","shop/tires","shop/tyres"],clinic:["amenity/clinic","amenity/doctors","healthcare/clinic","healthcare/laboratory","healthcare/physiotherapist","healthcare/sample_collection","healthcare/dialysis"],convenience:["shop/beauty","shop/chemist","shop/convenience","shop/cosmetics","shop/grocery","shop/kiosk","shop/newsagent","shop/perfumery"],coworking:["amenity/coworking_space","office/coworking","office/coworking_space"],dentist:["amenity/dentist","amenity/doctors","healthcare/dentist"],electronics:["office/telecommunication","shop/appliance","shop/computer","shop/electronics","shop/hifi","shop/kiosk","shop/mobile","shop/mobile_phone","shop/telecommunication","shop/video_games"],fabric:["shop/fabric","shop/haberdashery","shop/sewing"],fashion:["shop/accessories","shop/bag","shop/boutique","shop/clothes","shop/department_store","shop/fashion","shop/fashion_accessories","shop/sports","shop/shoes"],financial:["amenity/bank","office/accountant","office/financial","office/financial_advisor","office/tax_advisor","shop/tax"],fitness:["leisure/fitness_centre","leisure/fitness_center","leisure/sports_centre","leisure/sports_center"],food:["amenity/cafe","amenity/fast_food","amenity/ice_cream","amenity/restaurant","shop/bakery","shop/candy","shop/chocolate","shop/coffee","shop/confectionary","shop/confectionery","shop/food","shop/kiosk","shop/ice_cream","shop/pastry","shop/tea"],fuel:["amenity/fuel","shop/gas","shop/convenience;gas","shop/gas;convenience"],gift:["shop/gift","shop/card","shop/cards","shop/kiosk","shop/stationery"],hardware:["shop/bathroom_furnishing","shop/carpet","shop/diy","shop/doityourself","shop/doors","shop/electrical","shop/flooring","shop/hardware","shop/hardware_store","shop/power_tools","shop/tool_hire","shop/tools","shop/trade"],health_food:["shop/health","shop/health_food","shop/herbalist","shop/nutrition_supplements"],hobby:["shop/electronics","shop/hobby","shop/books","shop/games","shop/collector","shop/toys","shop/model","shop/video_games","shop/anime"],hospital:["amenity/doctors","amenity/hospital","healthcare/hospital"],houseware:["shop/houseware","shop/interior_decoration"],water_rescue:["amenity/lifeboat_station","emergency/lifeboat_station","emergency/marine_rescue","emergency/water_rescue"],lodging:["tourism/guest_house","tourism/hotel","tourism/motel"],money_transfer:["amenity/money_transfer","shop/money_transfer"],office_supplies:["shop/office_supplies","shop/stationary","shop/stationery"],outdoor:["shop/clothes","shop/outdoor","shop/sports"],parcel_locker:["amenity/parcel_locker","amenity/vending_machine"],pharmacy:["amenity/doctors","amenity/pharmacy","healthcare/pharmacy","shop/chemist"],playground:["amenity/theme_park","leisure/amusement_arcade","leisure/playground"],rental:["amenity/bicycle_rental","amenity/boat_rental","amenity/car_rental","amenity/truck_rental","amenity/vehicle_rental","shop/kiosk","shop/plant_hire","shop/rental","shop/tool_hire"],school:["amenity/childcare","amenity/college","amenity/kindergarten","amenity/language_school","amenity/prep_school","amenity/school","amenity/university"],storage:["shop/storage_units","shop/storage_rental"],substation:["power/station","power/substation","power/sub_station"],supermarket:["shop/food","shop/frozen_food","shop/greengrocer","shop/grocery","shop/supermarket","shop/wholesale"],thrift:["shop/charity","shop/clothes","shop/second_hand"],tobacco:["shop/e-cigarette","shop/tobacco"],variety_store:["shop/variety_store","shop/discount","shop/convenience"],vending:["amenity/vending_machine","shop/kiosk","shop/vending_machine"],weight_loss:["amenity/clinic","amenity/doctors","amenity/weight_clinic","healthcare/counselling","leisure/fitness_centre","office/therapist","shop/beauty","shop/diet","shop/food","shop/health_food","shop/herbalist","shop/nutrition","shop/nutrition_supplements","shop/weight_loss"],wholesale:["shop/wholesale","shop/supermarket","shop/department_store"]}};var MB={genericWords:["^(barn|bazaa?r|bench|bou?tique|building|casa|church)$","^(baseball|basketball|football|soccer|softball|tennis(halle)?)\\s?(field|court)?$","^(club|green|out|ware)\\s?house$","^(driveway|el \xE1rbol|fountain|generic|golf|government|graveyard)$","^(fixme|n\\s?\\/?\\s?a|name|no\\s?name|none|null|temporary|test|unknown)$","^(hofladen|librairie|magazine?|maison)$","^(mobile home|skate)?\\s?park$","^(obuwie|pond|pool|sale|shops?|sklep|stores?)$","^\\?+$","^private$","^tattoo( studio)?$","^windmill$","^\u0446\u0435\u0440\u043A\u043E\u0432\u043D\u0430\u044F( \u043B\u0430\u0432\u043A\u0430)?$"]};var PB={trees:{brands:{emoji:"\u{1F354}",mainTag:"brand:wikidata",sourceTags:["brand","name"],nameTags:{primary:"^(name|name:\\w+)$",alternate:"^(brand|brand:\\w+|operator|operator:\\w+|\\w+_name|\\w+_name:\\w+)$"}},flags:{emoji:"\u{1F6A9}",mainTag:"flag:wikidata",nameTags:{primary:"^(flag:name|flag:name:\\w+)$",alternate:"^(country|country:\\w+|flag|flag:\\w+|subject|subject:\\w+)$"}},operators:{emoji:"\u{1F4BC}",mainTag:"operator:wikidata",sourceTags:["operator"],nameTags:{primary:"^(name|name:\\w+|operator|operator:\\w+)$",alternate:"^(brand|brand:\\w+|\\w+_name|\\w+_name:\\w+)$"}},transit:{emoji:"\u{1F687}",mainTag:"network:wikidata",sourceTags:["network"],nameTags:{primary:"^network$",alternate:"^(operator|operator:\\w+|network:\\w+|\\w+_name|\\w+_name:\\w+)$"}}}};var OA=kB.matchGroups,wJ=PB.trees,i7=class{constructor(){this.matchIndex=void 0,this.genericWords=new Map,(MB.genericWords||[]).forEach(e=>this.genericWords.set(e,new RegExp(e,"i"))),this.itemLocation=void 0,this.locationSets=void 0,this.locationIndex=void 0,this.warnings=[]}buildMatchIndex(e){let i=this;if(i.matchIndex)return;i.matchIndex=new Map;let r=new Map;Object.keys(e).forEach(o=>{let a=e[o],l=o.split("/",3),c=l[0],d=l[1],m=l[2],g=`${d}/${m}`,_=wJ[c],v=i.matchIndex.get(g);v||(v={primary:new Map,alternate:new Map,excludeGeneric:new Map,excludeNamed:new Map},i.matchIndex.set(g,v));let b=(a.properties||{}).exclude||{};(b.generic||[]).forEach(z=>v.excludeGeneric.set(z,new RegExp(z,"i"))),(b.named||[]).forEach(z=>v.excludeNamed.set(z,new RegExp(z,"i")));let T=[...v.excludeGeneric.values(),...v.excludeNamed.values()],A=a.items;if(!Array.isArray(A)||!A.length)return;let M=new RegExp(_.nameTags.primary,"i"),k=new RegExp(_.nameTags.alternate,"i"),F=/:(colou?r|type|forward|backward|left|right|etymology|pronunciation|wikipedia)$/i,O=n(c,d,m),B=new Set([`${d}/yes`,"building/yes"]),U=new Set;Object.values(OA).forEach(z=>{z.some(W=>W===g)&&z.forEach(W=>{if(W===g)return;U.add(W);let q=W.split("/",2)[0];B.add(`${q}/yes`)})}),A.forEach(z=>{if(!z.id)return;Array.isArray(z.matchTags)&&z.matchTags.length&&(z.matchTags=z.matchTags.filter(q=>!U.has(q)&&q!==g&&!B.has(q)),z.matchTags.length||delete z.matchTags);let Z=[`${g}`].concat(z.matchTags||[]);O||(Z=Z.concat(Array.from(B))),Object.keys(z.tags).forEach(q=>{if(F.test(q))return;let Q=z.tags[q];!Q||T.some(V=>V.test(Q))||(M.test(q)?Z.forEach(V=>s("primary",c,V,m0(Q),z.id)):k.test(q)&&Z.forEach(V=>s("alternate",c,V,m0(Q),z.id)))});let W=new Set;(z.matchNames||[]).forEach(q=>{let Q=m0(q);Z.forEach(V=>{let le=i.matchIndex.get(V),de=le&&le.primary.get(Q),ne=le&&le.alternate.get(Q),ee=de&&de.has(z.id),re=ne&&ne.has(z.id);!ee&&!re&&(s("alternate",c,V,Q,z.id),W.add(q))})}),W.size?z.matchNames=Array.from(W):delete z.matchNames})});function s(o,a,l,c,d){if(!c){i.warnings.push(`Warning: skipping empty ${o} name for item ${a}/${l}: ${d}`);return}let m=i.matchIndex.get(l);m||(m={primary:new Map,alternate:new Map,excludeGeneric:new Map,excludeNamed:new Map},i.matchIndex.set(l,m));let g=m[o].get(c);if(g||(g=new Set,m[o].set(c,g)),g.add(d),!/yes$/.test(l)){let _=`${l}/${c}`,v=r.get(_);if(v&&v!==a){let E=Array.from(g);i.warnings.push(`Duplicate cache key "${_}" in trees "${a}" and "${v}", check items: ${E}`);return}r.set(_,a)}}function n(o,a,l){return o==="flags"||o==="transit"||a==="landuse"||l==="atm"||l==="bicycle_parking"||l==="car_sharing"||l==="caravan_site"||l==="charging_station"||l==="dog_park"||l==="parking"||l==="phone"||l==="playground"||l==="post_box"||l==="public_bookcase"||l==="recycling"||l==="vending_machine"}}buildLocationIndex(e,i){let r=this;if(r.locationIndex)return;r.itemLocation=new Map,r.locationSets=new Map,Object.keys(e).forEach(n=>{let o=e[n].items;!Array.isArray(o)||!o.length||o.forEach(a=>{if(r.itemLocation.has(a.id))return;let l;try{l=i.resolveLocationSet(a.locationSet)}catch(d){console.warn(`buildLocationIndex: ${d.message}`)}if(!l||!l.id||(r.itemLocation.set(a.id,l.id),r.locationSets.has(l.id)))return;let c=s(l.feature);if(c.id=l.id,c.properties.id=l.id,!c.geometry.coordinates.length||!c.properties.area){console.warn(`buildLocationIndex: locationSet ${l.id} for ${a.id} resolves to an empty feature:`),console.warn(JSON.stringify(c));return}r.locationSets.set(l.id,c)})}),r.locationIndex=(0,RB.default)({type:"FeatureCollection",features:[...r.locationSets.values()]});function s(n){return JSON.parse(JSON.stringify(n))}}match(e,i,r,s){let n=this;if(!n.matchIndex)throw new Error("match:  matchIndex not built.");let o;Array.isArray(s)&&n.locationIndex&&(o=n.locationIndex([s[0],s[1],s[0],s[1]],!0));let a=m0(r),l=new Set,c=[];if(d("primary"),d("alternate"),c.length)return c;return d("exclude"),c.length?c:null;function d(g){let _=`${e}/${i}`,v=m(g,_);if(!v){for(let E in OA){let b=OA[E];if(b.some(A=>A===_))for(let A=0;A<b.length;A++){let M=b[A];if(M!==_&&(v=m(g,M),v))return}}if(g==="exclude"){let E=[...n.genericWords.values()].find(b=>b.test(r));if(E){c.push({match:"excludeGeneric",pattern:String(E)});return}}}}function m(g,_){let v=n.matchIndex.get(_);if(!v)return;if(g==="exclude"){let F=[...v.excludeNamed.values()].find(O=>O.test(r));if(F){c.push({match:"excludeNamed",pattern:String(F),kv:_});return}if(F=[...v.excludeGeneric.values()].find(O=>O.test(r)),F){c.push({match:"excludeGeneric",pattern:String(F),kv:_});return}return}let E=v[g].get(a);if(!E||!E.size)return;let b=Array.from(E).map(F=>{let O=1/0;if(n.itemLocation&&n.locationSets){let B=n.locationSets.get(n.itemLocation.get(F));O=B&&B.properties.area||1/0}return{match:g,itemID:F,area:O,kv:_,nsimple:a}}),T=k;if(o&&(b=b.filter(A),T=M),!b.length)return;return b.sort(T).forEach(F=>{l.has(F.itemID)||(l.add(F.itemID),c.push(F))}),!0;function A(F){return n.itemLocation?o.find(O=>O.id===n.itemLocation.get(F.itemID)):!0}function M(F,O){return F.area-O.area}function k(F,O){return O.area-F.area}}}getWarnings(){return this.warnings}};var EJ={"building/commercial":!0,"building/government":!0,"building/hotel":!0,"building/retail":!0,"building/office":!0,"building/supermarket":!0,"building/yes":!0},TJ=/:(colou?r|type|forward|backward|left|right|etymology|pronunciation|wikipedia)$/i,SJ=/(coop|express|wireless|factory|outlet)/i,r7=class extends fi{constructor(e){super(e),this.id="nsi",this.status="loading",this._nsi={}}initAsync(){let e={nsi_data:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/nsi.min.json",nsi_dissolved:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/dissolved.min.json",nsi_features:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/featureCollection.min.json",nsi_generics:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/genericWords.min.json",nsi_presets:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/presets/nsi-id-presets.min.json",nsi_replacements:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/replacements.min.json",nsi_trees:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/trees.min.json"},r=this.context.systems.data.fileMap;for(let[n,o]of Object.entries(e))r.has(n)||r.set(n,o);return this.context.systems.presets.initAsync().then(()=>this._loadNsiPresetsAsync()).then(()=>this._loadNsiDataAsync()).then(()=>this.status="ok").catch(n=>{console.error(n),this.status="failed"})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}isGenericName(e){let i=e.name;if(!i)return!1;let r={primary:new Set([i]),alternate:new Set},s=this._gatherKVs(e);if(!s.primary.size&&!s.alternate.size)return!1;let n=this._gatherTuples(s,r);for(let o of n){let a=this._nsi.matcher.match(o.k,o.v,o.n);if(a!=null&&a.length&&a[0].match==="excludeGeneric")return!0}return!1}upgradeTags(e,i){let r=Object.assign({},e),s=!1;for(let d of Object.keys(r)){let m=d.match(/^(\w+:)?wikidata$/);if(m){let g=m[1]||"",_=r[d],v=this._nsi.replacements[_];if((v==null?void 0:v.wikidata)!==void 0&&(s=!0,v.wikidata?r[d]=v.wikidata:delete r[d]),(v==null?void 0:v.wikipedia)!==void 0){s=!0;let E=`${g}wikipedia`;v.wikipedia?r[E]=v.wikipedia:delete r[E]}}}let n=e.type==="route_master",o=this._gatherKVs(e);if(!o.primary.size&&!o.alternate.size)return s?{newTags:r,matched:null}:null;let a=this._gatherNames(e),l=this._nsi.qids.get(e.wikidata)||this._nsi.qids.get(e.wikipedia);if(l&&a.primary.add(l),!a.primary.size&&!a.alternate.size)return s?{newTags:r,matched:null}:null;let c=this._gatherTuples(o,a);for(let d of c){let m=this._nsi.matcher.match(d.k,d.v,d.n,i);if(!m||!m.length)continue;if(m[0].match!=="primary"&&m[0].match!=="alternate")break;let g,_;for(let z of m){if(g=z.itemID,this._nsi.dissolved[g]||(_=this._nsi.ids.get(g),!_))continue;let Z=_.mainTag,W=_.tags[Z],q=r[`not:${Z}`];if(!W||W===q||r.office&&!_.tags.office){_=null;continue}else break}if(!_)continue;_=JSON.parse(JSON.stringify(_));let v=_.tkv,E=v.split("/",3),b=E[1],T=E[2],M=this._nsi.data[v].properties||{},k=_.preserveTags||M.preserveTags||[];["building","emergency","internet_access","takeaway"].forEach(z=>{b!==z&&k.push(`^${z}$`)});let F=k.map(z=>new RegExp(z,"i")),O={};for(let z of Object.keys(r))F.some(Z=>Z.test(z))&&(O[z]=r[z]);this._nsi.kvt.forEach((z,Z)=>{r[Z]==="yes"&&delete r[Z]}),l&&(delete r.wikipedia,delete r.wikidata),Object.assign(r,_.tags,O),n&&(r.route_master=r.route,delete r.route);let B=e.name,U=r.name;if(U&&B&&U!==B&&!r.branch){let z=this._gatherNames(r);if(!new Set([...z.primary,...z.alternate]).has(B)){let q=B.split(/[\s\-\/,.]/);for(let Q=q.length;Q>0;Q--){let V=q.slice(0,Q).join(" "),le=q.slice(Q).join(" "),de=this._nsi.matcher.match(b,T,V,i);if(!(!de||!de.length)&&de.some(ne=>ne.itemID===g)){if(le)if(SJ.test(le))r.name=B;else{let ne=this._nsi.matcher.match(b,T,le,i);if(ne&&ne.length){if(ne[0].match==="primary"||ne[0].match==="alternate")return null}else r.branch=le}break}}}}return{newTags:r,matched:_}}return s?{newTags:r,matched:null}:null}_loadNsiPresetsAsync(){let e=this.context.systems.data;return Promise.all([e.getDataAsync("nsi_presets"),e.getDataAsync("nsi_features")]).then(i=>{Object.values(i[0].presets).forEach(s=>s.suggestion=!0),this.context.systems.presets.merge({presets:i[0].presets,featureCollection:i[1]})})}_loadNsiDataAsync(){let e=this.context.systems.data;return Promise.all([e.getDataAsync("nsi_data"),e.getDataAsync("nsi_dissolved"),e.getDataAsync("nsi_replacements"),e.getDataAsync("nsi_trees")]).then(i=>{var n;this._nsi={data:i[0].nsi,dissolved:i[1].dissolved,replacements:i[2].replacements,trees:i[3].trees,kvt:new Map,qids:new Map,ids:new Map};let r=this._nsi.matcher=new i7;r.buildMatchIndex(this._nsi.data),r.itemLocation=new Map,r.locationSets=new Map;let s=this.context.systems.locations;for(let o of Object.values(this._nsi.data))for(let a of(n=o.items)!=null?n:[]){if(r.itemLocation.has(a.id))continue;let l=s.locationSetID(a.locationSet);if(r.itemLocation.set(a.id,l),r.locationSets.has(l))continue;let c={id:l,properties:{id:l,area:1}};r.locationSets.set(l,c)}r.locationIndex=o=>{let a=s.locationSetsAt([o[0],o[1]]),l=[];for(let[c,d]of Object.entries(a)){let m=r.locationSets.get(c);m&&(m.properties.area=d,l.push(m))}return l},Object.keys(this._nsi.data).forEach(o=>{let a=this._nsi.data[o],[l,c,d]=o.split("/",3),m=this._nsi.kvt.get(c);m||(m=new Map,this._nsi.kvt.set(c,m)),m.set(d,l);let _=this._nsi.trees[l].mainTag;(a.items||[]).forEach(E=>{E.tkv=o,E.mainTag=_,this._nsi.ids.set(E.id,E);let b=E.tags[_],T=E.tags[_.replace("wikidata","wikipedia")];b&&this._nsi.qids.set(b,b),T&&b&&this._nsi.qids.set(T,b)})})})}_gatherKVs(e){let i=new Set,r=new Set;for(let[o,a]of Object.entries(e)){if(!o||!a)continue;o==="route_master"&&(o="route");let l=this._nsi.kvt.get(o);l&&(l.get(a)?i.add(`${o}/${a}`):a==="yes"&&r.add(`${o}/${a}`))}let n=this.context.systems.presets.matchTags(e,"area");return EJ[n.id]&&r.add("building/yes"),{primary:i,alternate:r}}_identifyTree(e){let i,r;for(let[s,n]of Object.entries(e)){if(!s||!n)continue;s==="route_master"&&(s="route");let o=this._nsi.kvt.get(s);if(o)if(n==="yes")i="unknown";else{r=o.get(n);break}}return r||i||null}_gatherNames(e){let i={primary:new Set,alternate:new Set},r=new Set,s=new Set,n=!1,o=!1,a,l=this._identifyTree(e);if(!l)return i;if(l==="transit"?a={primary:/^network$/i,alternate:/^(operator|operator:\w+|network:\w+|\w+_name|\w+_name:\w+)$/i}:l==="flags"?a={primary:/^(flag:name|flag:name:\w+)$/i,alternate:/^(flag|flag:\w+|subject|subject:\w+)$/i}:l==="brands"?(o=!0,a={primary:/^(name|name:\w+)$/i,alternate:/^(brand|brand:\w+|operator|operator:\w+|\w+_name|\w+_name:\w+)/i}):l==="operators"?(o=!0,a={primary:/^(name|name:\w+|operator|operator:\w+)$/i,alternate:/^(brand|brand:\w+|\w+_name|\w+_name:\w+)/i}):(o=!0,a={primary:/^(name|name:\w+)$/i,alternate:/^(brand|brand:\w+|network|network:\w+|operator|operator:\w+|\w+_name|\w+_name:\w+)/i}),e.name&&o){let d=e.name.split(/[\s\-\/,.]/);for(let m=d.length;m>0;m--){let g=d.slice(0,m).join(" ");r.add(g)}}for(let[d,m]of Object.entries(e))!d||!m||(c(d,"primary")?/;/.test(m)?n=!0:(r.add(m),s.delete(m)):!r.has(m)&&c(d,"alternate")&&(/;/.test(m)?n=!0:s.add(m)));if(e.man_made==="flagpole"&&!r.size&&!s.size&&e.country){let d=e.country;/;/.test(d)?n=!0:s.add(d)}if(n)return i;return{primary:r,alternate:s};function c(d,m){return d==="old_name"?!1:a[m].test(d)&&!TJ.test(d)}}_gatherTuples(e,i){let r=[];for(let s of["primary","alternate"]){let n=Array.from(i[s]).sort((o,a)=>a.length-o.length);for(let o of n)for(let a of["primary","alternate"])for(let l of e[a]){let[c,d]=l.split("/",2);r.push({k:c,v:d,n:o})}}return r}};var l7=Yi(cU(),1);function dU(t){var e={};e.authenticated=function(){return!!s("oauth2_access_token")},e.logout=function(){return s("oauth2_access_token",""),s("oauth_token",""),s("oauth_token_secret",""),s("oauth_request_token_secret",""),e},e.authenticate=function(o){if(e.authenticated()){o(null,e);return}e.logout(),hU(function(a){i(a,o)})},e.authenticateAsync=function(){return e.authenticated()?Promise.resolve(e):(e.logout(),new Promise((o,a)=>{var l=(c,d)=>{c?a(new Error(c)):o(d)};hU(c=>i(c,l))}))};function i(o,a){var l=kee(),c=t.url+"/oauth2/authorize?"+uU({client_id:t.client_id,redirect_uri:t.redirect_uri,response_type:"code",scope:t.scope,state:l,code_challenge:o.code_challenge,code_challenge_method:o.code_challenge_method});if(t.singlepage){if(!l7.default.enabled){var d=new Error("local storage unavailable, but require in singlepage mode");d.status="pkce-localstorage-unavailable",a(d);return}var m=WA(window.location.search.slice(1));m.code?e.bootstrapToken(m.code,a):(s("oauth2_state",l),s("oauth2_pkce_code_verifier",o.code_verifier),window.location=c)}else{var g=600,_=550,v=[["width",g],["height",_],["left",window.screen.width/2-g/2],["top",window.screen.height/2-_/2]].map(function(T){return T.join("=")}).join(","),E=window.open("about:blank","oauth_window",v);e.popupWindow=E,E.location=c,E||(d=new Error("Popup was blocked"),d.status="popup-blocked",a(d))}window.authComplete=function(T){var A=WA(T.split("?")[1]);if(A.state!==l){d=new Error("Invalid state"),d.status="invalid-state",a(d);return}r(A.code,o.code_verifier,b),delete window.authComplete};function b(T,A){if(t.done(),T){a(T);return}var M=JSON.parse(A.response);s("oauth2_access_token",M.access_token),a(null,e)}}function r(o,a,l){var c=t.url+"/oauth2/token?"+uU({client_id:t.client_id,redirect_uri:t.redirect_uri,grant_type:"authorization_code",code:o,code_verifier:a});e.rawxhr("POST",c,null,null,null,l),t.loading()}e.bringPopupWindowToFront=function(){var o=!1;try{e.popupWindow&&!e.popupWindow.closed&&(e.popupWindow.focus(),o=!0)}catch(a){}return o},e.bootstrapToken=function(o,a){var l=s("oauth2_state");s("oauth2_state","");var c=WA(window.location.search.slice(1));if(c.state!==l){var d=new Error("Invalid state");d.status="invalid-state",a(d);return}var m=s("oauth2_pkce_code_verifier");s("oauth2_pkce_code_verifier",""),r(o,m,g);function g(_,v){if(t.done(),_){a(_);return}var E=JSON.parse(v.response);s("oauth2_access_token",E.access_token),a(null,e)}},e.fetch=function(o,a){if(e.authenticated())return l();return t.auto?e.authenticateAsync().then(l):Promise.reject(new Error("not authenticated"));function l(){return a=a||{},a.headers||(a.headers={"Content-Type":"application/x-www-form-urlencoded"}),a.headers.Authorization="Bearer "+s("oauth2_access_token"),fetch(o,a)}},e.xhr=function(o,a){if(e.authenticated())return l();if(t.auto){e.authenticate(l);return}else{a("not authenticated",null);return}function l(){var d=o.prefix!==!1?t.url+o.path:o.path;return e.rawxhr(o.method,d,s("oauth2_access_token"),o.content,o.headers,c)}function c(d,m){d?a(d):m.responseXML?a(d,m.responseXML):a(d,m.response)}},e.rawxhr=function(o,a,l,c,d,m){d=d||{"Content-Type":"application/x-www-form-urlencoded"},l&&(d.Authorization="Bearer "+l);var g=new XMLHttpRequest;g.onreadystatechange=function(){g.readyState===4&&g.status!==0&&(/^20\d$/.test(g.status)?m(null,g):m(g,null))},g.onerror=function(v){m(v,null)},g.open(o,a,!0);for(var _ in d)g.setRequestHeader(_,d[_]);return g.send(c),g},e.preauth=function(o){return o&&o.access_token&&s("oauth2_access_token",o.access_token),e},e.options=function(o){return arguments.length?(t=o,t.url=t.url||"https://www.openstreetmap.org",t.auto=t.auto||!1,t.singlepage=t.singlepage||!1,t.loading=t.loading||function(){},t.done=t.done||function(){},e.preauth(t)):t};var s;if(l7.default.enabled)s=function(o,a){if(arguments.length===1)return l7.default.get(t.url+o);if(arguments.length===2)return l7.default.set(t.url+o,a)};else{var n={};s=function(o,a){if(arguments.length===1)return n[t.url+o];if(arguments.length===2)return n[t.url+o]=a}}return e.options(t),e}function uU(t){return Object.keys(t).filter(function(e){return t[e]!==void 0}).sort().map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}function WA(t){for(var e=0;e<t.length&&(t[e]==="?"||t[e]==="#");)e++;return t=t.slice(e),t.split("&").reduce(function(i,r){var s=r.split("=");return s.length===2&&(i[s[0]]=decodeURIComponent(s[1])),i},{})}function fU(){return window&&window.crypto&&window.crypto.getRandomValues&&window.crypto.subtle&&window.crypto.subtle.digest}function hU(t){var e;if(fU()){var i=window.crypto.getRandomValues(new Uint8Array(32));e=qA(i.buffer);var r=Uint8Array.from(Array.from(e).map(function(o){return o.charCodeAt(0)}));window.crypto.subtle.digest("SHA-256",r).then(function(o){var a=qA(o);t({code_challenge:a,code_verifier:e,code_challenge_method:"S256"})})}else{var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";e="";for(var n=0;n<64;n++)e+=s[Math.floor(Math.random()*s.length)];t({code_verifier:e,code_challenge:e,code_challenge_method:"plain"})}}function kee(){var t;if(fU()){var e=window.crypto.getRandomValues(new Uint8Array(32));t=qA(e.buffer)}else{var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";t="";for(var r=0;r<64;r++)t+=i[Math.floor(Math.random()*i.length)]}return t}function qA(t){return btoa(String.fromCharCode.apply(null,new Uint8Array(t))).replace(/\//g,"_").replace(/\+/g,"-").replace(/[=]/g,"")}var fp=Yi(kl(),1);var c7=class extends fi{constructor(e){super(e),this.id="osm",this._maxWayNodes=2e3,this._imageryBlocklists=[/.*\.google(apis)?\..*\/(vt|kh)[\?\/].*([xyz]=.*){3}.*/],this._urlroot="https://www.openstreetmap.org",this._tileCache={toLoad:{},loaded:{},inflight:{},seen:{},rtree:new fp.default},this._noteCache={toLoad:{},loaded:{},inflight:{},inflightPost:{},note:{},closed:{},rtree:new fp.default},this._userCache={toLoad:{},user:{}},this._changeset={},this._tiler=new zs,this._deferred=new Set,this._connectionID=0,this._tileZoom=16,this._noteZoom=12,this._rateLimitError=void 0,this._userChangesets=void 0,this._userDetails=void 0,this._cachedApiStatus=void 0,this._off=!1,this._authLoading=this._authLoading.bind(this),this._authDone=this._authDone.bind(this),this._parseNodeJSON=this._parseNodeJSON.bind(this),this._parseWayJSON=this._parseWayJSON.bind(this),this._parseRelationJSON=this._parseRelationJSON.bind(this),this._parseNodeXML=this._parseNodeXML.bind(this),this._parseWayXML=this._parseWayXML.bind(this),this._parseRelationXML=this._parseRelationXML.bind(this),this._parseNoteXML=this._parseNoteXML.bind(this),this._parseUserXML=this._parseUserXML.bind(this),this.reloadApiStatus=this.reloadApiStatus.bind(this),this.throttledReloadApiStatus=ol(this.reloadApiStatus,500);let i=window.location.origin,r=window.location.pathname;(i==="https://mapwith.ai"||i==="https://rapideditor.org")&&(r="/rapid/"),this._oauth=dU({url:this._urlroot,client_id:"O3g0mOUuA2WY5Fs826j5tP260qR3DDX7cIIE2R2WWSc",client_secret:"b4aeHD1cNeapPPQTrvpPoExqQRjybit6JBlNnxh62uE",scope:"read_prefs write_prefs write_api read_gpx write_notes",redirect_uri:`${i}${r}land.html`,loading:this._authLoading,done:this._authDone})}initAsync(){return this.resetAsync()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){for(let e of this._deferred)window.cancelIdleCallback(e),this._deferred.delete(e);return this._connectionID++,this._userChangesets=void 0,this._userDetails=void 0,this._rateLimitError=void 0,this._cachedApiStatus=void 0,Object.values(this._tileCache.inflight).forEach(this._abortRequest),Object.values(this._noteCache.inflight).forEach(this._abortRequest),Object.values(this._noteCache.inflightPost).forEach(this._abortRequest),this._changeset.inflight&&this._abortRequest(this._changeset.inflight),this._tileCache={toLoad:{},loaded:{},inflight:{},seen:{},rtree:new fp.default},this._noteCache={toLoad:{},loaded:{},inflight:{},inflightPost:{},note:{},closed:{},rtree:new fp.default},this._userCache={toLoad:{},user:{}},this._changeset={},Promise.resolve()}switchAsync(e){this._urlroot=e.url;let i=dn(this._oauth.options(),"access_token");return this._oauth.options(Object.assign(i,e)),this.resetAsync().then(()=>{this.emit("authchange")})}toggle(e){this._off=!e}isChangesetInflight(){return!!this._changeset.inflight}get connectionID(){return this._connectionID}get urlroot(){return this._urlroot}get imageryBlocklists(){return this._imageryBlocklists}get maxWayNodes(){return this._maxWayNodes}changesetURL(e){return`${this._urlroot}/changeset/${e}`}changesetsURL(e,i){let r=Math.max(0,Math.ceil(Math.log(i)/Math.LN2));return this._urlroot+"/history#map="+Math.floor(i)+"/"+e[1].toFixed(r)+"/"+e[0].toFixed(r)}entityURL(e){let i=e.osmId();return`${this._urlroot}/${e.type}/${i}`}historyURL(e){let i=e.osmId();return`${this._urlroot}/${e.type}/${i}/history`}userURL(e){return`${this._urlroot}/user/${e}`}noteURL(e){return`${this._urlroot}/note/${e.id}`}noteReportURL(e){return`${this._urlroot}/reports/new?reportable_type=Note&reportable_id=${e.id}`}loadFromAPI(e,i,r){r=Object.assign({skipSeen:!0},r);let s=this._connectionID,n=(c,d)=>{if(this._connectionID!==s){i&&i({message:"Connection Switched",status:-1});return}let m=this.authenticated();if(m&&((c==null?void 0:c.status)===400||(c==null?void 0:c.status)===401||(c==null?void 0:c.status)===403))this.logout(),this.loadFromAPI(e,i,r);else if(!m&&!this._rateLimitError&&((c==null?void 0:c.status)===509||(c==null?void 0:c.status)===429)?(this._rateLimitError=c,this.emit("authchange"),this.throttledReloadApiStatus()):(c&&this._cachedApiStatus==="online"||!c&&this._cachedApiStatus!=="online")&&this.throttledReloadApiStatus(),i)return c?i(c):e.indexOf(".json")!==-1?this._parseJSON(d,i,r):this._parseXML(d,i,r)},o=this._urlroot+e,a=new AbortController;return(this.authenticated()?this._oauth.fetch:window.fetch)(o,{signal:a.signal}).then(Ai).then(c=>n(null,c)).catch(c=>{if(c.name!=="AbortError"&&c.name==="FetchError"){n(c);return}}),a}loadEntity(e,i){let r=Dt.id.type(e),s=Dt.id.toOSM(e),n={skipSeen:!1},o=r!=="node"?"/full":"";this.loadFromAPI(`/api/0.6/${r}/${s}${o}.json`,i,n)}loadEntityVersion(e,i,r){let s=Dt.id.type(e),n=Dt.id.toOSM(e),o={skipSeen:!1};this.loadFromAPI(`/api/0.6/${s}/${n}/${i}.json`,r,o)}loadEntityRelations(e,i){let r=Dt.id.type(e),s=Dt.id.toOSM(e),n={skipSeen:!1};this.loadFromAPI(`/api/0.6/${r}/${s}/relations.json`,i,n)}loadMultiple(e,i){let r=ds(Ei(e),Dt.id.type),s={skipSeen:!1};for(let[n,o]of Object.entries(r)){let a=n+"s",l=o.map(c=>Dt.id.toOSM(c));for(let c of p3(l,150))this.loadFromAPI(`/api/0.6/${a}.json?${a}=`+c.join(),i,s)}}createChangeset(e,i){if(this._changeset.inflight)return i({message:"Changeset already inflight",status:-2});if(!this.authenticated())return i({message:"Not Authenticated",status:-3});let r=(l,c)=>{if(this._changeset.inflight=null,l)return i(l,e);this._changeset.openChangesetID=c,e=e.update({id:c}),i(null,e)};if(this._changeset.openChangesetID)return r(null,this._changeset.openChangesetID);let s=this._wrapcb(r),n=this._urlroot+"/api/0.6/changeset/create",o=new AbortController,a={method:"PUT",headers:{"Content-Type":"text/xml"},body:ru.stringify(e.asJXON()),signal:o.signal};this._oauth.fetch(n,a).then(Ai).then(l=>s(null,l)).catch(l=>{if(this._changeset.inflight=null,l.name!=="AbortError"&&l.name==="FetchError"){s(l);return}}),this._changeset.inflight=o}uploadChangeset(e,i,r){if(this._changeset.inflight)return r({message:"Changeset already inflight",status:-2});if(this.authenticated()){if(e.id!==this._changeset.openChangesetID)return r({message:"Changeset ID mismatch",status:-4})}else return r({message:"Not Authenticated",status:-3});let s=c=>{this._changeset.inflight=null,r(c,e)},n=this._wrapcb(s),o=this._urlroot+`/api/0.6/changeset/${e.id}/upload`,a=new AbortController,l={method:"POST",headers:{"Content-Type":"text/xml"},body:ru.stringify(e.osmChangeJXON(i)),signal:a.signal};this._oauth.fetch(o,l).then(Ai).then(c=>n(null,c)).catch(c=>{if(this._changeset.inflight=null,c.name!=="AbortError"&&c.name==="FetchError"){n(c);return}}),this._changeset.inflight=a}closeChangeset(e,i){if(this._changeset.inflight)return i({message:"Changeset already inflight",status:-2});if(this.authenticated()){if(e.id!==this._changeset.openChangesetID)return i({message:"Changeset ID mismatch",status:-4})}else return i({message:"Not Authenticated",status:-3});let r=l=>{this._changeset.inflight=null,this._changeset.openChangesetID=null,i(l,e)},s=this._wrapcb(r),n=this._urlroot+`/api/0.6/changeset/${e.id}/close`,o=new AbortController,a={method:"PUT",headers:{"Content-Type":"text/xml"},signal:o.signal};this._oauth.fetch(n,a).then(Ai).then(l=>s(null,l)).catch(l=>{if(this._changeset.inflight=null,l.name!=="AbortError"&&l.name==="FetchError"){s(l);return}}),this._changeset.inflight=o}sendChangeset(e,i,r){let s=this._connectionID;this.createChangeset(e,(n,o)=>{if(e=o,n)return r(n,e);this.uploadChangeset(e,i,(a,l)=>{if(e=l,a)return r(a,e);window.setTimeout(()=>{this._changeset.openChangesetID=null,r(null,e)},2500),this.connectionID===s&&this.closeChangeset(e,()=>{})})})}loadUsers(e,i){let r=[],s=[];for(let a of Ei(e))this._userCache.user[a]?(delete this._userCache.toLoad[a],s.push(this._userCache.user[a])):r.push(a);if((s.length||!this.authenticated())&&(i(void 0,s),!this.authenticated()))return;let n=(a,l)=>{if(a)return i(a);i(void 0,l.data)},o={skipSeen:!0};for(let a of p3(r,150))this.loadFromAPI("/api/0.6/users.json?users="+a.join(),n,o)}loadUser(e,i){if(this._userCache.user[e]||!this.authenticated())return delete this._userCache.toLoad[e],i(void 0,this._userCache.user[e]);let r=(n,o)=>{if(n)return i(n);i(void 0,o.data[0])},s={skipSeen:!0};this.loadFromAPI(`/api/0.6/user/${e}.json`,r,s)}userDetails(e){if(this._userDetails)return e(void 0,this._userDetails);let i=(s,n)=>{if(s)return e(s);this._userDetails=n.data[0],e(void 0,this._userDetails)},r={skipSeen:!1};this.loadFromAPI("/api/0.6/user/details.json",i,r)}userChangesets(e){if(this._userChangesets)return e(void 0,this._userChangesets);let i=(n,o)=>n?e(n):(this._userChangesets=o.data,e(void 0,this._userChangesets)),r={skipSeen:!1},s=(n,o)=>{if(n)return e(n);this.loadFromAPI(`/api/0.6/changesets.json?user=${o.id}`,i,r)};this.userDetails(s)}status(e){let i=(n,o)=>{if(n)return e(n,null);if(this._rateLimitError)return e(this._rateLimitError,"rateLimited");{let a=[];for(let g of o.getElementsByTagName("blacklist")){let _=g.getAttribute("regex");if(_)try{a.push(new RegExp(_))}catch(v){}}a.length&&(this._imageryBlocklists=a);let l=o.getElementsByTagName("waynodes"),c=l.length&&parseInt(l[0].getAttribute("maximum"),10);c&&isFinite(c)&&(this._maxWayNodes=c);let m=o.getElementsByTagName("status")[0].getAttribute("api");return e(void 0,m)}},r=this._urlroot+"/api/capabilities",s=this._wrapcb(i);fetch(r).then(Ai).then(n=>s(null,n)).catch(n=>s(n))}reloadApiStatus(){this.status((e,i)=>{i!==this._cachedApiStatus&&(this._cachedApiStatus=i,this.emit("apiStatusChange",e,i))})}loadTiles(e,i){if(this._off)return;let r=this._tiler.zoomRange(this._tileZoom).margin(1).getTiles(e).tiles,s=this._tileCache,n=this._hasInflightRequests(s);this._abortUnwantedRequests(s,r),n&&!this._hasInflightRequests(s)&&this.emit("loaded");for(let o of r)this.loadTile(o,i)}loadTile(e,i){if(this._off)return;let r=this._tileCache;if(r.loaded[e.id]||r.inflight[e.id])return;let s=this.context.systems.locations;if(e.wgs84Extent.polygon().slice(0,4).every(d=>s.blocksAt(d).length)){r.loaded[e.id]=!0;return}this._hasInflightRequests(r)||this.emit("loading");let a=(d,m)=>{if(delete r.inflight[e.id],!d){delete r.toLoad[e.id],r.loaded[e.id]=!0;let g=e.wgs84Extent.bbox();g.id=e.id,r.rtree.insert(g)}i&&i(d,Object.assign({},m,{tile:e})),this._hasInflightRequests(r)||this.emit("loaded")},l="/api/0.6/map.json?bbox=",c={skipSeen:!0};r.inflight[e.id]=this.loadFromAPI(l+e.wgs84Extent.toParam(),a,c)}isDataLoaded(e){let i={minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]};return this._tileCache.rtree.collides(i)}loadTileAtLoc(e,i){let r=this._tileCache;if(Object.keys(r.toLoad).length>50)return;let s=Fn(this._tileZoom+1),n=new Ho().scale(s).project(e),o=new Ho().transform({k:s,x:-n[0],y:-n[1]}),a=this._tiler.zoomRange(this._tileZoom).getTiles(o).tiles;for(let l of a)r.toLoad[l.id]||r.loaded[l.id]||r.inflight[l.id]||(r.toLoad[l.id]=!0,this.loadTile(l,i))}loadNotes(e,i){if(this._off)return;i=Object.assign({limit:1e4,closed:7},i);let r=this._noteCache,s=this,n="/api/0.6/notes?limit="+i.limit+"&closed="+i.closed+"&bbox=",o=ol(()=>{let l=Object.keys(s._userCache.toLoad);l.length&&s.loadUsers(l,function(){})},750),a=this._tiler.zoomRange(this._noteZoom).margin(1).getTiles(e).tiles;this._abortUnwantedRequests(r,a);for(let l of a){if(r.loaded[l.id]||r.inflight[l.id])continue;let c=this.context.systems.locations;if(l.wgs84Extent.polygon().slice(0,4).every(_=>c.blocksAt(_).length)){r.loaded[l.id]=!0;continue}let g={skipSeen:!1};r.inflight[l.id]=this.loadFromAPI(n+l.wgs84Extent.toParam(),function(_){delete s._noteCache.inflight[l.id],_||(s._noteCache.loaded[l.id]=!0),s.emit("loadedNotes")},g)}}postNoteCreate(e,i){if(this._noteCache.inflightPost[e.id])return i({message:"Note update already inflight",status:-2},e);if(!this.authenticated())return i({message:"Not Authenticated",status:-3},e);if(!e.loc[0]||!e.loc[1]||!e.newComment)return;let r=(l,c)=>{if(delete this._noteCache.inflightPost[e.id],l)return i(l);this.removeNote(e);let d={skipSeen:!1};return this._parseXML(c,(m,g)=>m?i(m):i(void 0,g.data[0]),d)},s=this._wrapcb(r),n=this._urlroot+"/api/0.6/notes?"+lr({lon:e.loc[0],lat:e.loc[1],text:e.newComment}),o=new AbortController,a={method:"POST",signal:o.signal};this._oauth.fetch(n,a).then(Ai).then(l=>s(null,l)).catch(l=>{if(this._changeset.inflight=null,l.name!=="AbortError"&&l.name==="FetchError"){s(l);return}}),this._noteCache.inflightPost[e.id]=o}postNoteUpdate(e,i,r){if(!this.authenticated())return r({message:"Not Authenticated",status:-3},e);if(this._noteCache.inflightPost[e.id])return r({message:"Note update already inflight",status:-2},e);let s;if(e.status!=="closed"&&i==="closed")s="close";else if(e.status!=="open"&&i==="open")s="reopen";else if(s="comment",!e.newComment)return;let n=(d,m)=>{if(delete this._noteCache.inflightPost[e.id],d)return r(d);this.removeNote(e),s==="close"?this._noteCache.closed[e.id]=!0:s==="reopen"&&delete this._noteCache.closed[e.id];let g={skipSeen:!1};return this._parseXML(m,(_,v)=>_?r(_):r(void 0,v.data[0]),g)},o=this._wrapcb(n),a=this._urlroot+`/api/0.6/notes/${e.id}/${s}`;e.newComment&&(a+="?"+lr({text:e.newComment}));let l=new AbortController,c={method:"POST",signal:l.signal};this._oauth.fetch(a,c).then(Ai).then(d=>o(null,d)).catch(d=>{if(this._changeset.inflight=null,d.name!=="AbortError"&&d.name==="FetchError"){o(d);return}}),this._noteCache.inflightPost[e.id]=l}caches(e){function i(r){let s={};for(let[n,o]of Object.entries(r))if(n==="rtree")s.rtree=new fp.default().fromJSON(o.toJSON());else if(n==="note"){s.note={};for(let a of Object.keys(o))s.note[a]=Nr(r.note[a])}else s[n]=JSON.parse(JSON.stringify(o));return s}return e===void 0?{tile:i(this._tileCache),note:i(this._noteCache),user:i(this._userCache)}:e==="get"?{tile:this._tileCache,note:this._noteCache,user:this._userCache}:(e.tile&&(this._tileCache=e.tile,this._tileCache.inflight={}),e.note&&(this._noteCache=e.note,this._noteCache.inflight={},this._noteCache.inflightPost={}),e.user&&(this._userCache=e.user),this)}logout(){return this._userChangesets=void 0,this._userDetails=void 0,this._oauth.logout(),this.emit("authchange"),this}authenticated(){return this._oauth.authenticated()}authenticate(e){let i=this._connectionID;this._userChangesets=void 0,this._userDetails=void 0;let r=(s,n)=>{if(s){e&&e(s);return}if(this._connectionID!==i){e&&e({message:"Connection Switched",status:-1});return}this._rateLimitError=void 0,this.emit("authchange"),e&&e(s,n),this.userChangesets(function(){})};this._oauth.authenticate(r)}notes(e){let i=e.dimensions(),r=[i[0][0],i[1][1]],s=[i[1][0],i[0][1]],n=new mt(e.invert(r),e.invert(s)).bbox();return this._noteCache.rtree.search(n).map(o=>o.data)}getNote(e){return this._noteCache.note[e]}removeNote(e){!(e instanceof Nr)||!e.id||(delete this._noteCache.note[e.id],this._updateRtree(this._encodeNoteRtree(e),!1))}replaceNote(e){if(!(!(e instanceof Nr)||!e.id))return this._noteCache.note[e.id]=e,this._updateRtree(this._encodeNoteRtree(e),!0),e}getClosedIDs(){return Object.keys(this._noteCache.closed).sort()}_authLoading(){this.emit("authLoading")}_authDone(){this.emit("authDone")}_abortRequest(e){e&&e.abort()}_hasInflightRequests(e){return Object.keys(e.inflight).length}_abortUnwantedRequests(e,i){for(let r of Object.keys(e.inflight))e.toLoad[r]||i.find(s=>s.id===r)||(this._abortRequest(e.inflight[r]),delete e.inflight[r])}_getLoc(e){var s,n;let i=(s=e.lon)==null?void 0:s.value,r=(n=e.lat)==null?void 0:n.value;return[parseFloat(i),parseFloat(r)]}_getNodes(e){return Array.from(e.getElementsByTagName("nd")).map(r=>"n"+r.attributes.ref.value)}_getNodesJSON(e){var i;return((i=e.nodes)!=null?i:[]).map(r=>"n"+r)}_getTags(e){var s,n;let i=Array.from(e.getElementsByTagName("tag")),r={};for(let o of i){let a=o.attributes,l=((s=a.k.value)!=null?s:"").trim(),c=((n=a.v.value)!=null?n:"").trim();l&&(r[l]=c)}return r}_getMembers(e){return Array.from(e.getElementsByTagName("member")).map(r=>{let s=r.attributes;return{id:s.type.value[0]+s.ref.value,type:s.type.value,role:s.role.value}})}_getMembersJSON(e){var i;return((i=e.members)!=null?i:[]).map(r=>({id:r.type[0]+r.ref,type:r.type,role:r.role}))}_parseComments(e){let i=[];for(let r of e)if(r.nodeName==="comment"){let s={};for(let n of r.childNodes){let o=n.nodeName;if(o!=="#text"&&(s[o]=n.textContent,o==="uid")){let a=n.textContent;a&&!this._userCache.user[a]&&(this._userCache.toLoad[a]=!0)}}Object.keys(s).length&&i.push(s)}return i}_encodeNoteRtree(e){return{minX:e.loc[0],minY:e.loc[1],maxX:e.loc[0],maxY:e.loc[1],data:e}}_parseJSON(e,i,r){var c,d;if(r=Object.assign({skipSeen:!0},r),!e)return i({message:"No JSON",status:-1});let s=e;typeof s!="object"&&(s=JSON.parse(e));let n=(c=s.elements)!=null?c:[],o=(d=s.user?[s.user]:s.users)!=null?d:[],a=(s==null?void 0:s.changesets)||[];if(!n||!o||!a)return i({message:"No JSON",status:-1});if(n.some(m=>m.type==="error"))return i({message:"Partial JSON",status:-1});let l=window.requestIdleCallback(()=>{var g,_,v,E,b,T,A,M,k,F;this._deferred.delete(l);let m={data:[],seenIDs:new Set};for(let O of n){let B;if(O.type==="node"?B=this._parseNodeJSON:O.type==="way"?B=this._parseWayJSON:O.type==="relation"&&(B=this._parseRelationJSON),!B)continue;let U=Dt.id.fromOSM(O.type,O.id);if(m.seenIDs.add(U),r.skipSeen){if(this._tileCache.seen[U])continue;this._tileCache.seen[U]=!0}let z=B(O,U);z&&m.data.push(z)}for(let O of o){let B=(g=O.id)==null?void 0:g.toString();if(!B||(delete this._userCache.toLoad[B],m.seenIDs.add(B),r.skipSeen&&this._userCache.user[B]))continue;let U={id:B,display_name:O.display_name,account_created:O.account_created,image_url:(_=O.img)==null?void 0:_.href,changesets_count:(b=(E=(v=O.changesets)==null?void 0:v.count)==null?void 0:E.toString())!=null?b:"0",active_blocks:(k=(M=(A=(T=O.blocks)==null?void 0:T.received)==null?void 0:A.active)==null?void 0:M.toString())!=null?k:"0"};this._userCache.user[B]=U,m.data.push(U)}for(let O of a)(F=O==null?void 0:O.tags)!=null&&F.comment&&m.data.push(O);i(null,m)});this._deferred.add(l)}_parseXML(e,i,r){if(r=Object.assign({skipSeen:!0},r),!e||!e.childNodes)return i({message:"No XML",status:-1});let s=e.childNodes[0],n=Array.from(s.childNodes);if(n.some(a=>a.nodename==="error"))return i({message:"Partial XML",status:-1});let o=window.requestIdleCallback(()=>{this._deferred.delete(o);let a={data:[],seenIDs:new Set};for(let l of n){let c;if(l.nodeName==="node"?c=this._parseNodeXML:l.nodeName==="way"?c=this._parseWayXML:l.nodeName==="relation"?c=this._parseRelationXML:l.nodeName==="note"?c=this._parseNoteXML:l.nodeName==="user"&&(c=this._parseUserXML),!c)continue;let d;if(l.nodeName==="user"){if(d=l.attributes.id.value,a.seenIDs.add(d),r.skipSeen&&this._userCache.user[d]){delete this._userCache.toLoad[d];continue}}else if(l.nodeName==="note")d=l.getElementsByTagName("id")[0].textContent,a.seenIDs.add(d);else if(d=Dt.id.fromOSM(l.nodeName,l.attributes.id.value),a.seenIDs.add(d),r.skipSeen){if(this._tileCache.seen[d])continue;this._tileCache.seen[d]=!0}let m=c(l,d);m&&a.data.push(m)}i(null,a)});this._deferred.add(o)}_parseNodeJSON(e,i){var r,s,n;return new vi({id:i,visible:typeof e.visible=="boolean"?e.visible:!0,version:(r=e.version)==null?void 0:r.toString(),changeset:(s=e.changeset)==null?void 0:s.toString(),timestamp:e.timestamp,user:e.user,uid:(n=e.uid)==null?void 0:n.toString(),loc:[parseFloat(e.lon),parseFloat(e.lat)],tags:e.tags})}_parseWayJSON(e,i){var r,s,n;return new Mr({id:i,visible:typeof e.visible=="boolean"?e.visible:!0,version:(r=e.version)==null?void 0:r.toString(),changeset:(s=e.changeset)==null?void 0:s.toString(),timestamp:e.timestamp,user:e.user,uid:(n=e.uid)==null?void 0:n.toString(),tags:e.tags,nodes:this._getNodesJSON(e)})}_parseRelationJSON(e,i){var r,s,n;return new Ms({id:i,visible:typeof e.visible=="boolean"?e.visible:!0,version:(r=e.version)==null?void 0:r.toString(),changeset:(s=e.changeset)==null?void 0:s.toString(),timestamp:e.timestamp,user:e.user,uid:(n=e.uid)==null?void 0:n.toString(),tags:e.tags,members:this._getMembersJSON(e)})}_parseNodeXML(e,i){var s,n,o,a;let r=e.attributes;return new vi({id:i,visible:!r.visible||r.visible.value!=="false",version:r.version.value,changeset:(s=r.changeset)==null?void 0:s.value,timestamp:(n=r.timestamp)==null?void 0:n.value,user:(o=r.user)==null?void 0:o.value,uid:(a=r.uid)==null?void 0:a.value,loc:this._getLoc(r),tags:this._getTags(e)})}_parseWayXML(e,i){var s,n,o,a;let r=e.attributes;return new Mr({id:i,visible:!r.visible||r.visible.value!=="false",version:r.version.value,changeset:(s=r.changeset)==null?void 0:s.value,timestamp:(n=r.timestamp)==null?void 0:n.value,user:(o=r.user)==null?void 0:o.value,uid:(a=r.uid)==null?void 0:a.value,tags:this._getTags(e),nodes:this._getNodes(e)})}_parseRelationXML(e,i){var s,n,o,a;let r=e.attributes;return new Ms({id:i,visible:!r.visible||r.visible.value!=="false",version:r.version.value,changeset:(s=r.changeset)==null?void 0:s.value,timestamp:(n=r.timestamp)==null?void 0:n.value,user:(o=r.user)==null?void 0:o.value,uid:(a=r.uid)==null?void 0:a.value,tags:this._getTags(e),members:this._getMembers(e)})}_parseNoteXML(e,i){let r=e.attributes,s=e.childNodes,n={};n.id=i,n.loc=this._getLoc(r);let o=!1,a=1e-5;do{o&&(n.loc=Ir(n.loc,[a,a]));let d=new mt(n.loc).bbox();o=this._noteCache.rtree.search(d).length}while(o);for(let d of s){let m=d.nodeName;m!=="#text"&&(m==="comments"?n[m]=this._parseComments(d.childNodes):n[m]=d.textContent)}let l=new Nr(n),c=this._encodeNoteRtree(l);return this._noteCache.note[l.id]=l,this._noteCache.rtree.insert(c),l}_parseUserXML(e,i){var l,c;let r=e.attributes,s={id:i,display_name:(l=r.display_name)==null?void 0:l.value,account_created:(c=r.account_created)==null?void 0:c.value,changesets_count:"0",active_blocks:"0"},n=e.getElementsByTagName("img");n&&n[0]&&n[0].getAttribute("href")&&(s.image_url=n[0].getAttribute("href"));let o=e.getElementsByTagName("changesets");o&&o[0]&&o[0].getAttribute("count")&&(s.changesets_count=o[0].getAttribute("count"));let a=e.getElementsByTagName("blocks");if(a&&a[0]){let d=a[0].getElementsByTagName("received");d&&d[0]&&d[0].getAttribute("active")&&(s.active_blocks=d[0].getAttribute("active"))}return this._userCache.user[i]=s,delete this._userCache.toLoad[i],s}_updateRtree(e,i){this._noteCache.rtree.remove(e,(r,s)=>r.data.id===s.data.id),i&&this._noteCache.rtree.insert(e)}_wrapcb(e){let i=this._connectionID;return(r,s)=>r?((r.status===400||r.status===401||r.status===403)&&this.logout(),e.call(this,r)):this._connectionID!==i?e.call(this,{message:"Connection Switched",status:-1}):e.call(this,r,s)}};var pU=Yi(kl(),1);var Mee=14,rv="https://osmose.openstreetmap.fr/api/0.3",u7=class extends fi{constructor(e){super(e),this.id="osmose",this.autoStart=!1,this._osmoseColors=new Map,this._osmoseStrings=new Map,this._osmoseData={icons:{},types:[]},this._cache=null,this._tiler=new zs().zoomRange(Mee).skipNullIsland(!0)}initAsync(){return this.resetAsync()}startAsync(){return this.context.systems.data.getDataAsync("qa_data").then(i=>{this._osmoseData.icons=i.osmose.icons,this._osmoseData.types=Object.keys(i.osmose.icons).map(r=>r.split("-")[0]).reduce((r,s)=>r.indexOf(s)!==-1?r:[...r,s],[])}).then(()=>this._loadStringsAsync()).then(()=>this._started=!0)}resetAsync(){return this._cache&&Object.values(this._cache.inflightTile).forEach(e=>this._abortRequest(e)),this._cache={issues:new Map,loadedTile:{},inflightTile:{},inflightPost:{},closed:{},rtree:new pU.default},Promise.resolve()}getData(){let e=this.context.systems.map.extent();return this._cache.rtree.search(e.bbox()).map(i=>i.data)}loadTiles(){let e=this.context.projection,i=this._tiler.getTiles(e).tiles;this._abortUnwantedRequests(this._cache,i);for(let r of i){if(this._cache.loadedTile[r.id]||this._cache.inflightTile[r.id])continue;let[s,n,o]=r.xyz,a={item:this._osmoseData.types},l=`${rv}/issues/${o}/${s}/${n}.json?`+lr(a),c=new AbortController;this._cache.inflightTile[r.id]=c,fetch(l,{signal:c.signal}).then(Ai).then(d=>{var m;this._cache.loadedTile[r.id]=!0;for(let g of(m=d.features)!=null?m:[]){let{item:_,class:v,uuid:E}=g.properties,b=`${_}-${v}`;if(b in this._osmoseData.icons){let T=g.geometry.coordinates;T=this._preventCoincident(T);let A=new Er(T,this,b,E,{item:_});(_===8300||_===8360)&&(A.elems=[]),this._cache.issues.set(A.id,A),this._cache.rtree.insert(this._encodeIssueRtree(A))}}this.context.deferredRedraw(),this.emit("loadedData")}).catch(d=>{d.name!=="AbortError"&&(this._cache.loadedTile[r.id]=!0)}).finally(()=>{delete this._cache.inflightTile[r.id]})}}loadIssueDetailAsync(e){if(e.elems!==void 0)return Promise.resolve(e);let i=this.context.systems.l10n.localeCode(),r=`${rv}/issue/${e.id}?langs=${i}`,s=n=>{e.elems=n.elems.map(o=>o.type.substring(0,1)+o.id),e.detail=n.subtitle?er.parse(n.subtitle.auto):"",this.replaceItem(e)};return fetch(r).then(Ai).then(s).then(()=>e)}getStrings(e,i){var s,n;return i=i||this.context.systems.l10n.localeCode(),(n=((s=this._osmoseStrings.get(i))!=null?s:{})[e])!=null?n:{}}getColor(e){var i;return(i=this._osmoseColors.get(e))!=null?i:16777215}getIcon(e){return this._osmoseData.icons[e]}postUpdate(e,i){if(this._cache.inflightPost[e.id])return i({message:"Issue update already inflight",status:-2},e);let r=`${rv}/issue/${e.id}/${e.newStatus}`,s=new AbortController,n=()=>{delete this._cache.inflightPost[e.id],this.removeItem(e),e.newStatus==="done"&&(e.item in this._cache.closed||(this._cache.closed[e.item]=0),this._cache.closed[e.item]+=1),i&&i(null,e)};this._cache.inflightPost[e.id]=s,fetch(r,{signal:s.signal}).then(n).catch(o=>{delete this._cache.inflightPost[e.id],i&&i(o.message)})}getError(e){return this._cache.issues.get(e)}replaceItem(e){if(!(!(e instanceof Er)||!e.id))return this._cache.issues.set(e.id,e),this._updateRtree(this._encodeIssueRtree(e),!0),e}removeItem(e){!(e instanceof Er)||!e.id||(this._cache.isseus.delete(e.id),this._updateRtree(this._encodeIssueRtree(e),!1))}getClosedCounts(){return this._cache.closed}itemURL(e){return`https://osmose.openstreetmap.fr/en/error/${e.id}`}_abortRequest(e){e&&e.abort()}_abortUnwantedRequests(e,i){Object.keys(e.inflightTile).forEach(r=>{i.find(n=>r===n.id)||(this._abortRequest(e.inflightTile[r]),delete e.inflightTile[r])})}_encodeIssueRtree(e){return{minX:e.loc[0],minY:e.loc[1],maxX:e.loc[0],maxY:e.loc[1],data:e}}_updateRtree(e,i){this._cache.rtree.remove(e,(r,s)=>r.data.id===s.data.id),i&&this._cache.rtree.insert(e)}_preventCoincident(e){let i=!1;do{e=Ir(e,i?[1e-5,0]:[0,1e-5]);let s=new mt(e).bbox();i=this._cache.rtree.search(s).length}while(i);return e}_loadStringsAsync(){let e=Object.keys(this._osmoseData.icons),i={},r=this.context.systems.l10n.localeCode();this._osmoseStrings.set(r,i);let s=e.map(n=>{let o=d=>{let[m={items:[]}]=d.categories,[g={class:[]}]=m.items,[_=null]=g.class;if(!_){console.log(`Osmose strings request (${n}) had unexpected data`);return}let v=g.item;this._osmoseColors.set(v,new mi(g.color).toNumber());let{title:E,detail:b,fix:T,trap:A}=_,M={};E&&(M.title=E.auto.charAt(0).toUpperCase()+E.auto.slice(1)),b&&(M.detail=er.parse(b.auto)),A&&(M.trap=er.parse(A.auto)),T&&(M.fix=er.parse(T.auto)),i[n]=M},[a,l]=n.split("-"),c=`${rv}/items/${a}/class/${l}?langs=${r}`;return fetch(c).then(Ai).then(o)}).filter(Boolean);return Promise.all(s)}};var h7=class extends fi{constructor(e){super(e),this.id="osmwikibase",this.apibase="https://wiki.openstreetmap.org/w/api.php",this._inflight={},this._cache={},this._localeIDs={en:!1},this.claimToValue=this.claimToValue.bind(this),this.monolingualClaimToValueObj=this.monolingualClaimToValueObj.bind(this),this.toSitelink=this.toSitelink.bind(this),this.getEntity=this.getEntity.bind(this),this.getDocs=this.getDocs.bind(this),this._request=this._request.bind(this),this._debouncedRequest=Gr(this._request,500,{leading:!1})}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this._debouncedRequest.cancel(),Object.values(this._inflight).forEach(e=>e.abort()),this._inflight={},Promise.resolve()}claimToValue(e,i,r){var l;if(!e.claims[i])return;let s=this._localeIDs[r],n,o;for(let c of e.claims[i]){!n&&c.rank==="preferred"&&(n=c);let d=((l=c.qualifiers)==null?void 0:l.P26)&&c.qualifiers.P26[0].datavalue.value.id;s&&d===s&&(o=c)}let a=o!=null?o:n;if(a){let c=a.mainsnak.datavalue;return c.type==="wikibase-entityid"?c.value.id:c.value}else return}monolingualClaimToValueObj(e,i){if(e!=null&&e.claims[i])return e.claims[i].reduce(function(r,s){var n=s.mainsnak.datavalue.value;return r[n.language]=n.text,r},{})}toSitelink(e,i){return(i?`Tag:${e}=${i}`:`Key:${e}`).replace(/_/g," ").trim()}getEntity(e,i){let r=e.debounce?this._debouncedRequest:this._request,s=e.key==="type"&&e.value?`Relation:${e.value}`.replace(/_/g," ").trim():!1,n=e.key?this.toSitelink(e.key):!1,o=e.key&&e.value?this.toSitelink(e.key,e.value):!1,a=[],l={},c;if(e.langCodes)for(let g of e.langCodes)this._localeIDs[g]===void 0&&(c=`Locale:${g}`.replace(/_/g," ").trim(),a.push(c));if(s&&(this._cache[s]?l.rtype=this._cache[s]:a.push(s)),n&&(this._cache[n]?l.key=this._cache[n]:a.push(n)),o&&(this._cache[o]?l.tag=this._cache[o]:a.push(o)),!a.length)return i(null,l);let d={action:"wbgetentities",sites:"wiki",titles:a.join("|"),languages:e.langCodes.join("|"),languagefallback:1,origin:"*",format:"json"},m=this.apibase+"?"+lr(d);r(m,(g,_)=>{if(g)i(g);else if(!_.success||_.error)i(_.error.messages.map(v=>v.html["*"]).join("<br>"));else{let v=!1;for(let E of Object.values(_.entities))if(E.missing!==""){let b=E.sitelinks.wiki.title;b===s?(this._cache[s]=E,l.rtype=E):b===n?(this._cache[n]=E,l.key=E):b===o?(this._cache[o]=E,l.tag=E):b===c?v=E.id:console.log(`Unexpected title ${b}`)}c&&this.addLocale(e.langCodes[0],v),i(null,l)}})}getDocs(e,i){let r=this.context.systems.l10n.localeCodes().map(s=>s.toLowerCase());e.langCodes=r,this.getEntity(e,(s,n)=>{var _,v,E;if(s){i(s);return}let o=n.rtype||n.tag||n.key;if(!o){i("No entity");return}let a;for(let b of r)if(((_=o.descriptions[b])==null?void 0:_.language)===b){a=o.descriptions[b];break}!a&&Object.values(o.descriptions).length&&(a=Object.values(o.descriptions)[0]);let l={title:o.title,description:(v=a==null?void 0:a.value)!=null?v:"",descriptionLocaleCode:(E=a==null?void 0:a.language)!=null?E:"",editURL:`https://wiki.openstreetmap.org/wiki/${o.title}`};if(o.claims){let b,T=this.claimToValue(o,"P4",r[0]);T?b="https://commons.wikimedia.org/w/index.php":(T=this.claimToValue(o,"P28",r[0]),T&&(b="https://wiki.openstreetmap.org/w/index.php")),b&&T&&(l.imageURL=b+"?"+lr({title:`Special:Redirect/file/${T}`,width:400}))}let c=this.monolingualClaimToValueObj(n.rtype,"P31"),d=this.monolingualClaimToValueObj(n.tag,"P31"),m=this.monolingualClaimToValueObj(n.key,"P31");for(let b of[c,d,m]){for(let T of r){let M=r[0].split("-")[0]!=="en"&&T.split("-")[0]==="en"?"inspector.wiki_en_reference":"inspector.wiki_reference",k=g(b,T,M);if(k){l.wiki=k;break}}if(l.wiki)break}i(null,l);function g(b,T,A){if(b&&b[T])return{title:b[T],text:A,url:`https://wiki.openstreetmap.org/wiki/${b[T]}`}}})}addLocale(e,i){this._localeIDs[e]=i}_request(e,i){if(this._inflight[e])return;let r=new AbortController;this._inflight[e]=r,fetch(e,{signal:r.signal}).then(Ai).then(s=>{delete this._inflight[e],i&&i(null,s)}).catch(s=>{delete this._inflight[e],s.name!=="AbortError"&&i&&i(s.message)})}};var yU=Yi(kl(),1);var sv={};window.jsonpCache=sv;function mU(t,e){var i={abort:function(){}};if(window.JSONP_FIX){if(window.JSONP_DELAY===0)e(window.JSONP_FIX);else{var r=window.setTimeout(function(){e(window.JSONP_FIX)},window.JSONP_DELAY||0);i.abort=function(){window.clearTimeout(r)}}return i}function s(){for(var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",c="",d=-1;++d<15;)c+=l.charAt(Math.floor(Math.random()*52));return c}function n(l){var c=l.match(/callback=(\w+)/),d=c?c[1]:s();sv[d]=function(g){sv[d]&&e(g),m()};function m(){delete sv[d],a.remove()}return i.abort=m,"jsonpCache."+d}var o=n(t),a=ye("head").append("script").attr("type","text/javascript").attr("src",t.replace(/(\{|%7B)callback(\}|%7D)/,o));return i}var Pee="pannellum-streetside/pannellum.css",Ree="pannellum-streetside/pannellum.js",gU=16.5,d7=class extends fi{constructor(e){super(e),this.id="streetside",this.autoStart=!1,this._hires=!1,this._resolution=512,this._currScene=0,this._cache={},this._pannellumViewer=null,this._nextSequenceID=0,this._waitingForPhotoID=null,this._startPromise=null,this._sceneOptions={showFullscreenCtrl:!1,autoLoad:!0,compass:!0,yaw:0,hfov:45,minHfov:10,maxHfov:90,type:"cubemap",cubeMap:[]},this._setupCanvas=this._setupCanvas.bind(this),this._tiler=new zs().zoomRange(gU).skipNullIsland(!0)}initAsync(){return this.resetAsync()}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context,i=e.container().select(".photoviewer").selectAll(".ms-wrapper").data([0]),r=i.enter().append("div").attr("class","photo-wrapper ms-wrapper").classed("hide",!0);r.append("div").attr("id","rapideditor-viewer-streetside").on("pointerdown.streetside",()=>{ye(window).on("pointermove.streetside",()=>{this.emit("viewerChanged")},!0)}).on("pointerup.streetside pointercancel.streetside",()=>{ye(window).on("pointermove.streetside",null);let n=Mf(o=>{this.emit("viewerChanged"),o>2e3&&n.stop()})}).append("div").attr("class","photo-attribution fillD");let s=r.append("div").attr("class","photo-controls-wrap").append("div").attr("class","photo-controls");return s.append("button").on("click.back",()=>this._step(-1)).html("\u25C4"),s.append("button").on("click.forward",()=>this._step(1)).html("\u25BA"),i=i.merge(r).call(this._setupCanvas),e.systems.ui.photoviewer.on("resize.streetside",()=>{this._pannellumViewer&&this._pannellumViewer.resize()}),this._startPromise=new Promise((n,o)=>{let a=0;function l(){a+=1,a===2&&n()}let c=ye("head");c.selectAll("#rapideditor-streetside-viewercss").data([0]).enter().append("link").attr("id","rapideditor-streetside-viewercss").attr("rel","stylesheet").attr("crossorigin","anonymous").attr("href",e.asset(Pee)).on("load",l).on("error",o),c.selectAll("#rapideditor-streetside-viewerjs").data([0]).enter().append("script").attr("id","rapideditor-streetside-viewerjs").attr("crossorigin","anonymous").attr("src",e.asset(Ree)).on("load",l).on("error",o)}).then(()=>this._started=!0).catch(n=>{n instanceof Error&&console.error(n),this._startPromise=null}),this._startPromise}resetAsync(){if(this._cache.inflight)for(let e of this._cache.inflight.values())e.controller.abort();return this._cache={rtree:new yU.default,inflight:new Map,loaded:new Set,bubbles:new Map,sequences:new Map,unattachedBubbles:new Set,bubbleHasSequences:new Map,metadataPromise:null},Promise.resolve()}getImages(){let e=this.context.systems.map.extent();return this._cache.rtree.search(e.bbox()).map(i=>i.data)}getSequences(){var s;let e=this._cache,i=this.context.systems.map.extent(),r=new Map;for(let n of e.rtree.search(i.bbox())){let o=n.data.id,a=(s=e.bubbleHasSequences.get(o))!=null?s:[];for(let l of a)r.has(l)||r.set(l,e.sequences.get(l))}return[...r.values()]}loadTiles(){let i=this.context.projection,r=this._tiler.zoomRange(gU).margin(2).getTiles(i).tiles;for(let[s,n]of this._cache.inflight)r.find(a=>a.id===s)||n.controller.abort();for(let s of r){let n=s.id;this._cache.loaded.has(n)||this._cache.inflight.has(n)||this._loadTileAsync(s).then(o=>this._processResults(o)).catch(o=>{o.name!=="AbortError"&&o instanceof Error&&console.error(o)})}}showViewer(){let e=this.context.container().select(".photoviewer").classed("hide",!1);e.selectAll(".photo-wrapper.ms-wrapper.hide").size()&&(e.selectAll(".photo-wrapper:not(.ms-wrapper)").classed("hide",!0),e.selectAll(".photo-wrapper.ms-wrapper").classed("hide",!1))}hideViewer(){let e=this.context;e.systems.photos.selectPhoto(null);let i=e.container().select(".photoviewer");i.empty()||i.datum(null),i.classed("hide",!0).selectAll(".photo-wrapper").classed("hide",!0),e.container().selectAll(".viewfield-group, .sequence, .icon-sign").classed("currentView",!1),this.setStyles(e,null,!0),this.emit("imageChanged")}selectImageAsync(e){let i=this._cache.bubbles.get(e),r=this.context,s=r.container().select(".photoviewer");s.empty()||s.datum(i),this.setStyles(r,null,!0);let n=r.container().select(".photoviewer .ms-wrapper"),o=n.selectAll(".photo-attribution").html("");if(n.selectAll(".pnlm-load-box").style("display","block").style("transform","translate(-50%, -50%)"),e&&!i&&(this._waitingForPhotoID=e),!i)return Promise.resolve();this._sceneOptions.northOffset=i.ca;let a=o.append("div").attr("class","attribution-row"),l=fl("streetside-hires"),c=a.append("label").attr("for",l).attr("class","streetside-hires");c.append("input").attr("type","checkbox").attr("id",l).property("checked",this._hires).on("click",F=>{F.stopPropagation(),this._hires=!this._hires,this._resolution=this._hires?1024:512,n.call(this._setupCanvas);let O={yaw:this._pannellumViewer.getYaw(),pitch:this._pannellumViewer.getPitch(),hfov:this._pannellumViewer.getHfov()};this._sceneOptions=Object.assign(this._sceneOptions,O),r.systems.photos.selectPhoto(),r.systems.photos.selectPhoto("streetside",i.id)}),c.append("span").text(this.context.t("streetside.hires"));let d=a.append("div").attr("class","attribution-capture-info");if(i.captured_by){let F=new Date().getFullYear();d.append("a").attr("class","captured_by").attr("target","_blank").attr("href","https://www.microsoft.com/en-us/maps/streetside").text(`\xA9 ${F} Microsoft`),d.append("span").text("|")}i.captured_at&&d.append("span").attr("class","captured_at").text(this._localeDateString(i.captured_at));let m=o.append("div").attr("class","attribution-row");m.append("a").attr("class","image-view-link").attr("target","_blank").attr("href","https://www.bing.com/maps?cp="+i.loc[1]+"~"+i.loc[0]+"&lvl=17&dir="+i.ca+"&style=x&v=2&sV=1").text(this.context.t("streetside.view_on_bing")),m.append("a").attr("class","image-report-link").attr("target","_blank").attr("href","https://www.bing.com/maps/privacyreport/streetsideprivacyreport?bubbleid="+encodeURIComponent(i.id)+"&focus=photo&lat="+i.loc[1]+"&lng="+i.loc[0]+"&z=17").text(this.context.t("streetside.report"));let g="http://ecn.t0.tiles.virtualearth.net/tiles/",v=parseInt(i.id,10).toString(4),E=16-v.length;for(let F=0;F<E;F++)v="0"+v;let b=g+"hs"+v,T="?g=13305&n=z",A=["01","02","03","10","11","12"],M=this._getQuadKeys(),k=A.map(F=>M.map(O=>{let B=this._qkToXY(O);return{face:F,url:b+F+O+T,x:B[0],y:B[1]}}));return this._loadFacesAsync(k).then(()=>{if(!this._pannellumViewer)this._initViewer();else{this._currScene++;let F=this._currScene.toString();this._pannellumViewer.addScene(F,this._sceneOptions).loadScene(F),this._currScene>2&&(F=(this._currScene-1).toString(),this._pannellumViewer.removeScene(F))}})}setStyles(e,i,r){r&&(e.container().selectAll(".viewfield-group").classed("highlighted",!1).classed("hovered",!1).classed("currentView",!1),e.container().selectAll(".sequence").classed("highlighted",!1).classed("currentView",!1));let s=i==null?void 0:i.id,n=i==null?void 0:i.sequenceID,o=n&&this._cache.sequences.get(n),a=o&&o.bubbles.map(b=>b.id)||[],l=e.container().select(".photoviewer"),c=l.empty()?void 0:l.datum(),d=c==null?void 0:c.id,m=c==null?void 0:c.sequenceID,g=m&&this._cache.sequences.get(m),_=g&&g.bubbles.map(b=>b.id)||[],v=as(a,_);e.container().selectAll(".layer-streetside-images .viewfield-group").classed("highlighted",b=>v.indexOf(b.id)!==-1).classed("hovered",b=>b.id===s).classed("currentView",b=>b.id===d),e.container().selectAll(".layer-streetside-images .sequence").classed("highlighted",b=>b.properties.id===n).classed("currentView",b=>b.properties.id===m),e.container().selectAll(".layer-streetside-images .viewfield-group .viewfield").attr("d",E);function E(){let b=this.parentNode.__data__;return b.isPano&&b.id!==d?"M 8,13 m -10,0 a 10,10 0 1,0 20,0 a 10,10 0 1,0 -20,0":"M 6,9 C 8,8.4 8,8.4 10,9 L 16,-2 C 12,-5 4,-5 0,-2 z"}}_initViewer(){if(!window.pannellum||this._pannellumViewer)return;this._currScene++;let e=this._currScene.toString(),i={default:{firstScene:e},scenes:{}};i.scenes[e]=this._sceneOptions,this._pannellumViewer=window.pannellum.viewer("rapideditor-viewer-streetside",i)}_step(e){let i=this.context,r=i.container().select(".photoviewer"),s=r.empty()?void 0:r.datum();if(!s)return;let n=e===1?s.ne:s.pr,o=this._pannellumViewer.getYaw();this._sceneOptions.yaw=o;let a=s.ca+o,l=s.loc,c=35,d=[l[0]+Dn(c/5,l[1]),l[1]],m=[l[0]+Dn(c/2,l[1]),l[1]+Fc(c)],g=[l[0]-Dn(c/2,l[1]),l[1]+Fc(c)],_=[l[0]-Dn(c/5,l[1]),l[1]],v=[d,m,g,_,d],E=(e===1?a:a+180)*(Math.PI/180);v=Pu(v,-E,l);let b=v.reduce((M,k)=>(M.min=[Math.min(M.min[0],k[0]),Math.min(M.min[1],k[1])],M.max=[Math.max(M.max[0],k[0]),Math.max(M.max[1],k[1])],M),new mt),T=1/0;this._cache.rtree.search(b.bbox()).forEach(M=>{if(M.data.id===s.id||!Nf(M.data.loc,v))return;let k=Xi(M.data.loc,s.loc),F=s.ca-M.data.ca;Math.min(Math.abs(F),360-Math.abs(F))>20&&(k+=5),k<T&&(n=M.data.id,T=k)});let A=this._cache.bubbles.get(n);A&&(i.systems.map.centerEase(A.loc),i.systems.photos.selectPhoto("streetside",A.id),this.emit("imageChanged"))}_localeDateString(e){if(!e)return null;let i={day:"numeric",month:"short",year:"numeric"},r=new Date(e);if(isNaN(r.getTime()))return null;let s=this.context.systems.l10n.localeCode();return r.toLocaleString(s,i)}_processResults(e){let i=this._cache;i.loaded.add(e.tile.id);let r=e.data;if(!r)return;if(r.error)throw new Error(r.error);r.shift();let s=null,n=r.map(o=>{var m,g;let l=o.id.toString();if(this._waitingForPhotoID===l&&(s=l,this._waitingForPhotoID=null),i.bubbles.has(l))return null;let c=[o.lo,o.la],d={loc:c,id:l,ca:o.he,captured_at:o.cd,captured_by:"microsoft",pr:(m=o.pr)==null?void 0:m.toString(),ne:(g=o.ne)==null?void 0:g.toString(),isPano:!0};return i.bubbles.set(l,d),i.unattachedBubbles.add(l),{minX:c[0],minY:c[1],maxX:c[0],maxY:c[1],data:d}}).filter(Boolean);if(this._cache.rtree.load(n),this._connectSequences(),s){let o=this.context.systems.photos;o.selectPhoto(),o.selectPhoto("streetside",s)}this.context.deferredRedraw(),this.emit("loadedData")}_connectSequences(){let e=this._cache,i=new Set,r=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}),s=Array.from(e.unattachedBubbles).sort(r.compare),n=(o,a)=>{i.add(o),e.unattachedBubbles.delete(a);let l=e.bubbleHasSequences.get(a);l||(l=[],e.bubbleHasSequences.set(a,l)),l.push(o)};for(let o of s){let a=e.unattachedBubbles.has(o),l=e.bubbles.get(o);if(!l||!a)continue;let c=l.ne,d=c&&e.bubbles.get(c),m=l.pr,g=m&&e.bubbles.get(m);if(c&&d){let _,v,E=d&&e.bubbleHasSequences.get(c)||[];for(_ of E){v=e.sequences.get(_);let b=v.bubbleIDs.at(0),T=v.bubbleIDs.at(-1);if(c===T){v.bubbleIDs.push(o),n(_,o);break}else if(c===b){v.bubbleIDs.unshift(o),n(_,o);break}}}if(m&&g){let _,v,E=g&&e.bubbleHasSequences.get(m)||[];for(_ of E){v=e.sequences.get(_);let b=v.bubbleIDs.at(0),T=v.bubbleIDs.at(-1);if(m===T){v.bubbleIDs.push(o),n(_,o);break}else if(m===b){v.bubbleIDs.unshift(o),n(_,o);break}}}if(e.unattachedBubbles.has(o)){let v=`s${this._nextSequenceID++}`,E={id:v,v:0,bubbleIDs:[o]};e.sequences.set(v,E),n(v,o),m&&g&&(E.bubbleIDs.unshift(m),n(v,m)),c&&d&&(E.bubbleIDs.push(c),n(v,c))}}for(let o of i){let a=e.sequences.get(o),l=a.bubbleIDs.map(c=>e.bubbles.get(c));a.v++,a.captured_at=l[0].captured_at,a.captured_by=l[0].captured_by,a.coordinates=l.map(c=>c.loc)}}_fetchMetadataAsync(e){if(this._cache.metadataPromise)return this._cache.metadataPromise;let[i,r]=e.wgs84Extent.center(),o=`https://dev.virtualearth.net/REST/v1/Imagery/MetaData/Streetside/${r},${i}?key=AoG8TaQvkPo6o8SlpRVmBs7WJwO_NDQklVRcAfpn7P8oiEMYWNY59XHSJU81sP1Y`;this._cache.metadataPromise=fetch(o).then(Ai).then(a=>{if(!a)throw new Error("no data");return a})}_loadTileAsync(e){let[i,r,s,n]=e.wgs84Extent.rectangle(),c="https://dev.virtualearth.net/mapcontrol/HumanScaleServices/GetBubbles.ashx?"+lr({n,s:r,e:s,w:i,c:2e3,appkey:"AuftgJsO0Xs8Ts4M1xZUQJQXJNsvmh3IV8DkNieCiy3tCwCUMq76-WpkrBtNAuEm",jsCallback:"{callback}"}),d=this._cache.inflight.get(e.id);if(d)return d.promise;let m=new AbortController,g=new Promise((_,v)=>{let E,b=mU(c,T=>{E&&m.signal.removeEventListener("abort",E),_({data:T,tile:e})});E=()=>{m.signal.removeEventListener("abort",E),b.abort(),v(new DOMException("Aborted","AbortError"))},m.signal.addEventListener("abort",E)}).finally(()=>{this._cache.inflight.delete(e.id)});return this._cache.inflight.set(e.id,{promise:g,controller:m}),g}_loadImageAsync(e){return new Promise(i=>{let r=e.face,s=document.getElementById(`rapideditor-canvas${r}`),n=s.getContext("2d"),o=new Image;o.onload=()=>{n.drawImage(o,e.x,e.y),i({imgInfo:e,status:"ok"})},o.onerror=()=>{n.clearRect(0,0,s.width,s.height),i({imgInfo:e,status:"error"})},o.setAttribute("crossorigin",""),o.src=e.url})}_loadFaceAsync(e){return Promise.all(e.map(i=>this._loadImageAsync(i))).then(i=>{let r=i[0].imgInfo.face,s=document.getElementById(`rapideditor-canvas${r}`),n={"01":0,"02":1,"03":2,10:3,11:4,12:5};return this._sceneOptions.cubeMap[n[r]]=s.toDataURL("image/jpeg",1),{status:`face ${r} ok`}})}_loadFacesAsync(e){return Promise.all(e.map(i=>this._loadFaceAsync(i))).then(()=>({status:"this._loadFacesAsync done"}))}_setupCanvas(e){e.selectAll("#rapideditor-stitcher-canvases").remove(),e.selectAll("#rapideditor-stitcher-canvases").data([0]).enter().append("div").attr("id","rapideditor-stitcher-canvases").attr("display","none").selectAll("canvas").data(["canvas01","canvas02","canvas03","canvas10","canvas11","canvas12"]).enter().append("canvas").attr("id",i=>`rapideditor-${i}`).attr("width",this._resolution).attr("height",this._resolution)}_qkToXY(e){let i=0,r=0,s=256;for(let n=e.length;n>0;n--){let o=e[n-1];i+=+(o==="1"||o==="3")*s,r+=+(o==="2"||o==="3")*s,s*=2}return[i,r]}_getQuadKeys(){let e=this._resolution/256,i;return e===16?i=["0000","0001","0010","0011","0100","0101","0110","0111","1000","1001","1010","1011","1100","1101","1110","1111","0002","0003","0012","0013","0102","0103","0112","0113","1002","1003","1012","1013","1102","1103","1112","1113","0020","0021","0030","0031","0120","0121","0130","0131","1020","1021","1030","1031","1120","1121","1130","1131","0022","0023","0032","0033","0122","0123","0132","0133","1022","1023","1032","1033","1122","1123","1132","1133","0200","0201","0210","0211","0300","0301","0310","0311","1200","1201","1210","1211","1300","1301","1310","1311","0202","0203","0212","0213","0302","0303","0312","0313","1202","1203","1212","1213","1302","1303","1312","1313","0220","0221","0230","0231","0320","0321","0330","0331","1220","1221","1230","1231","1320","1321","1330","1331","0222","0223","0232","0233","0322","0323","0332","0333","1222","1223","1232","1233","1322","1323","1332","1333","2000","2001","2010","2011","2100","2101","2110","2111","3000","3001","3010","3011","3100","3101","3110","3111","2002","2003","2012","2013","2102","2103","2112","2113","3002","3003","3012","3013","3102","3103","3112","3113","2020","2021","2030","2031","2120","2121","2130","2131","3020","3021","3030","3031","3120","3121","3130","3131","2022","2023","2032","2033","2122","2123","2132","2133","3022","3023","3032","3033","3122","3123","3132","3133","2200","2201","2210","2211","2300","2301","2310","2311","3200","3201","3210","3211","3300","3301","3310","3311","2202","2203","2212","2213","2302","2303","2312","2313","3202","3203","3212","3213","3302","3303","3312","3313","2220","2221","2230","2231","2320","2321","2330","2331","3220","3221","3230","3231","3320","3321","3330","3331","2222","2223","2232","2233","2322","2323","2332","2333","3222","3223","3232","3233","3322","3323","3332","3333"]:e===8?i=["000","001","010","011","100","101","110","111","002","003","012","013","102","103","112","113","020","021","030","031","120","121","130","131","022","023","032","033","122","123","132","133","200","201","210","211","300","301","310","311","202","203","212","213","302","303","312","313","220","221","230","231","320","321","330","331","222","223","232","233","322","323","332","333"]:e===4?i=["00","01","10","11","02","03","12","13","20","21","30","31","22","23","32","33"]:i=["0","1","2","3"],i}};var f7="https://taginfo.openstreetmap.org/api/4/",Dee={point:"count_nodes",vertex:"count_nodes",area:"count_ways",line:"count_ways"},Fee={point:"count_node_members",vertex:"count_node_members",area:"count_way_members",line:"count_way_members",relation:"count_relation_members"},Lee={point:"nodes",vertex:"nodes",area:"ways",line:"ways"},Nee={point:"count_node_members_fraction",vertex:"count_node_members_fraction",area:"count_way_members_fraction",line:"count_way_members_fraction",relation:"count_relation_members_fraction"},p7=class extends fi{constructor(e){super(e),this.id="taginfo",this._inflight={},this._cache={},this._popularKeys={postal_code:!0,full_name:!0,loc_name:!0,reg_name:!0,short_name:!0,sorting_name:!0,artist_name:!0,nat_name:!0,long_name:!0,"bridge:name":!0},this.keys=this.keys.bind(this),this.multikeys=this.multikeys.bind(this),this.values=this.values.bind(this),this.roles=this.roles.bind(this),this.docs=this.docs.bind(this),this._request=this._request.bind(this),this._debouncedRequest=Gr(this._request,300,{leading:!1})}initAsync(){return Promise.resolve()}startAsync(){let i={rp:100,sortname:"values_all",sortorder:"desc",page:1,debounce:!1,lang:this.context.systems.l10n.languageCode()};return new Promise((r,s)=>{this.keys(i,(n,o)=>{if(n)s();else{for(let a of o)a.value!=="opening_hours"&&(this._popularKeys[a.value]=!0);this._started=!0,r()}})})}resetAsync(){return this._debouncedRequest.cancel(),Object.values(this._inflight).forEach(e=>e.abort()),this._inflight={},Promise.resolve()}keys(e,i){let r=this.context.systems.l10n.languageCode(),s=e.debounce?this._debouncedRequest:this._request;e=this._clean(this._setSort(e)),e=Object.assign({rp:10,sortname:"count_all",sortorder:"desc",page:1,lang:r},e);let n=f7+"keys/all?"+lr(e);s(n,e,!1,i,(o,a)=>{if(o)i(o);else{let l=this._filterKeys(e.filter),c=a.data.filter(l).sort(this._sortKeys).map(this._valKey);this._cache[n]=c,i(null,c)}})}multikeys(e,i){let r=this.context.systems.l10n.languageCode(),s=e.debounce?this._debouncedRequest:this._request;e=this._clean(this._setSort(e)),e=Object.assign({rp:25,sortname:"count_all",sortorder:"desc",page:1,lang:r},e);let n=e.query,o=f7+"keys/all?"+lr(e);s(o,e,!0,i,(a,l)=>{if(a)i(a);else{let c=this._filterMultikeys(n),d=l.data.filter(c).map(this._valKey);this._cache[o]=d,i(null,d)}})}values(e,i){let r=e.key;if(r&&this._popularKeys[r]){i(null,[]);return}let s=this.context.systems.l10n.languageCode(),n=e.debounce?this._debouncedRequest:this._request;e=this._clean(this._setSort(this._setFilter(e))),e=Object.assign({rp:25,sortname:"count_all",sortorder:"desc",page:1,lang:s},e);let o=f7+"key/values?"+lr(e);n(o,e,!1,i,(a,l)=>{if(a)i(a);else{let d=/network|taxon|genus|species|brand|grape_constiety|royal_cypher|listed_status|booth|rating|stars|:output|_hours|_times|_ref|manufacturer|country|target|brewery/.test(e.key),m=this._filterValues(d),g=l.data.filter(m).map(this._valKeyDescription);this._cache[o]=g,i(null,g)}})}roles(e,i){let r=this.context.systems.l10n.languageCode(),s=e.debounce?this._debouncedRequest:this._request,n=e.geometry;e=this._clean(this._setSortMembers(e)),e=Object.assign({rp:25,sortname:"count_all_members",sortorder:"desc",page:1,lang:r},e);let o=f7+"relation/roles?"+lr(e);s(o,e,!0,i,(a,l)=>{if(a)i(a);else{let c=this._filterRoles(n),d=l.data.filter(c).map(this._roleKey);this._cache[o]=d,i(null,d)}})}docs(e,i){let r=e.debounce?this._debouncedRequest:this._request;e=this._clean(this._setSort(e));let s="key/wiki_pages?";e.value?s="tag/wiki_pages?":e.rtype&&(s="relation/wiki_pages?");let n=f7+s+lr(e);r(n,e,!0,i,(o,a)=>{o?i(o):(this._cache[n]=a.data,i(null,a.data))})}_sets(e,i,r){return e.geometry&&r[e.geometry]&&(e[i]=r[e.geometry]),e}_setFilter(e){return this._sets(e,"filter",Lee)}_setSort(e){return this._sets(e,"sortname",Dee)}_setSortMembers(e){return this._sets(e,"sortname",Fee)}_clean(e){return dn(e,["geometry","debounce"])}_filterKeys(e){let i=e?"count_"+e:"count_all";return r=>parseFloat(r[i])>2500||r.in_wiki}_filterMultikeys(e){return i=>{let r=new RegExp("^"+e+"(.*)$"),s=i.key.match(r)||[];return s.length===2&&s[1].indexOf(":")===-1}}_filterValues(e){return i=>i.value.match(/[;,]/)!==null||!e&&i.value.match(/[A-Z*]/)!==null?!1:parseFloat(i.fraction)>0}_filterRoles(e){return i=>i.role===""||i.role.match(/[A-Z*;,]/)!==null?!1:parseFloat(i[Nee[e]])>0}_valKey(e){return{value:e.key,title:e.key}}_valKeyDescription(e){let i={value:e.value,title:e.description||e.value};return e.count&&(i.count=e.count),i}_roleKey(e){return{value:e.role,title:e.role}}_sortKeys(e,i){return e.key.indexOf(":")===-1&&i.key.indexOf(":")!==-1?-1:e.key.indexOf(":")!==-1&&i.key.indexOf(":")===-1?1:0}_request(e,i,r,s,n){if(this._inflight[e]||this._checkCache(e,i,r,s))return;let o=new AbortController;this._inflight[e]=o,fetch(e,{signal:o.signal}).then(Ai).then(a=>{delete this._inflight[e],n&&n(null,a)}).catch(a=>{delete this._inflight[e],a.name!=="AbortError"&&n&&n(a.message)})}_checkCache(e,i,r,s){var l,c;let n=(l=i.rp)!=null?l:25,o=(c=i.query)!=null?c:"",a=e;do{let d=this._cache[a];if(d&&(e===a||d.length<n))return s(null,d),!0;if(r||!o.length)return!1;o=o.slice(0,-1),a=e.replace(/&query=(.*?)&/,`&query=${o}&`)}while(o.length>=0);return!1}};var OU=Yi(kA(),1),eC=Yi(u6(),1);var aa=(t,e,i)=>new Promise((r,s)=>{var n=l=>{try{a(i.next(l))}catch(c){s(c)}},o=l=>{try{a(i.throw(l))}catch(c){s(c)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(n,o);a((i=i.apply(t,e)).next())}),ll=Uint8Array,mp=Uint16Array,Oee=Int32Array,vU=new ll([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),bU=new ll([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Bee=new ll([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wU=function(t,e){for(var i=new mp(31),r=0;r<31;++r)i[r]=e+=1<<t[r-1];for(var s=new Oee(i[30]),r=1;r<30;++r)for(var n=i[r];n<i[r+1];++n)s[n]=n-i[r]<<5|r;return{b:i,r:s}},EU=wU(vU,2),TU=EU.b,Uee=EU.r;TU[28]=258,Uee[258]=28;var SU=wU(bU,0),zee=SU.b,Umt=SU.r,QA=new mp(32768);for(Hr=0;Hr<32768;++Hr)d1=(Hr&43690)>>1|(Hr&21845)<<1,d1=(d1&52428)>>2|(d1&13107)<<2,d1=(d1&61680)>>4|(d1&3855)<<4,QA[Hr]=((d1&65280)>>8|(d1&255)<<8)>>1;var d1,Hr,y7=function(t,e,i){for(var r=t.length,s=0,n=new mp(e);s<r;++s)t[s]&&++n[t[s]-1];var o=new mp(e);for(s=1;s<e;++s)o[s]=o[s-1]+n[s-1]<<1;var a;if(i){a=new mp(1<<e);var l=15-e;for(s=0;s<r;++s)if(t[s])for(var c=s<<4|t[s],d=e-t[s],m=o[t[s]-1]++<<d,g=m|(1<<d)-1;m<=g;++m)a[QA[m]>>l]=c}else for(a=new mp(r),s=0;s<r;++s)t[s]&&(a[s]=QA[o[t[s]-1]++]>>15-t[s]);return a},_7=new ll(288);for(Hr=0;Hr<144;++Hr)_7[Hr]=8;var Hr;for(Hr=144;Hr<256;++Hr)_7[Hr]=9;var Hr;for(Hr=256;Hr<280;++Hr)_7[Hr]=7;var Hr;for(Hr=280;Hr<288;++Hr)_7[Hr]=8;var Hr,AU=new ll(32);for(Hr=0;Hr<32;++Hr)AU[Hr]=5;var Hr,Gee=y7(_7,9,1),$ee=y7(AU,5,1),YA=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},yc=function(t,e,i){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(e&7)&i},ZA=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(e&7)},Hee=function(t){return(t+7)/8|0},Vee=function(t,e,i){(e==null||e<0)&&(e=0),(i==null||i>t.length)&&(i=t.length);var r=new ll(i-e);return r.set(t.subarray(e,i)),r},jee=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],al=function(t,e,i){var r=new Error(e||jee[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,al),!i)throw r;return r},JA=function(t,e,i,r){var s=t.length,n=r?r.length:0;if(!s||e.f&&!e.l)return i||new ll(0);var o=!i||e.i!=2,a=e.i;i||(i=new ll(s*3));var l=function(at){var Te=i.length;if(at>Te){var Ze=new ll(Math.max(Te*2,at));Ze.set(i),i=Ze}},c=e.f||0,d=e.p||0,m=e.b||0,g=e.l,_=e.d,v=e.m,E=e.n,b=s*8;do{if(!g){c=yc(t,d,1);var T=yc(t,d+1,3);if(d+=3,T)if(T==1)g=Gee,_=$ee,v=9,E=5;else if(T==2){var F=yc(t,d,31)+257,O=yc(t,d+10,15)+4,B=F+yc(t,d+5,31)+1;d+=14;for(var U=new ll(B),z=new ll(19),Z=0;Z<O;++Z)z[Bee[Z]]=yc(t,d+Z*3,7);d+=O*3;for(var W=YA(z),q=(1<<W)-1,Q=y7(z,W,1),Z=0;Z<B;){var V=Q[yc(t,d,q)];d+=V&15;var A=V>>4;if(A<16)U[Z++]=A;else{var le=0,de=0;for(A==16?(de=3+yc(t,d,3),d+=2,le=U[Z-1]):A==17?(de=3+yc(t,d,7),d+=3):A==18&&(de=11+yc(t,d,127),d+=7);de--;)U[Z++]=le}}var ne=U.subarray(0,F),ee=U.subarray(F);v=YA(ne),E=YA(ee),g=y7(ne,v,1),_=y7(ee,E,1)}else al(1);else{var A=Hee(d)+4,M=t[A-4]|t[A-3]<<8,k=A+M;if(k>s){a&&al(0);break}o&&l(m+M),i.set(t.subarray(A,k),m),e.b=m+=M,e.p=d=k*8,e.f=c;continue}if(d>b){a&&al(0);break}}o&&l(m+131072);for(var re=(1<<v)-1,te=(1<<E)-1,ie=d;;ie=d){var le=g[ZA(t,d)&re],oe=le>>4;if(d+=le&15,d>b){a&&al(0);break}if(le||al(2),oe<256)i[m++]=oe;else if(oe==256){ie=d,g=null;break}else{var fe=oe-254;if(oe>264){var Z=oe-257,Re=vU[Z];fe=yc(t,d,(1<<Re)-1)+TU[Z],d+=Re}var He=_[ZA(t,d)&te],Je=He>>4;He||al(3),d+=He&15;var ee=zee[Je];if(Je>3){var Re=bU[Je];ee+=ZA(t,d)&(1<<Re)-1,d+=Re}if(d>b){a&&al(0);break}o&&l(m+131072);var ot=m+fe;if(m<ee){var yt=n-ee,bt=Math.min(ee,ot);for(yt+m<0&&al(3);m<bt;++m)i[m]=r[yt+m]}for(;m<ot;m+=4)i[m]=i[m-ee],i[m+1]=i[m+1-ee],i[m+2]=i[m+2-ee],i[m+3]=i[m+3-ee];m=ot}}e.l=g,e.p=ie,e.b=m,e.f=c,g&&(c=1,e.m=v,e.d=_,e.n=E)}while(!c);return m==i.length?i:Vee(i,0,m)},Xee=new ll(0),Wee=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&al(6,"invalid gzip data");var e=t[3],i=10;e&4&&(i+=(t[10]|t[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!t[i++]);return i+(e&2)},qee=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},Yee=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&al(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&al(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function Zee(t,e){return JA(t,{i:2},e&&e.out,e&&e.dictionary)}function Qee(t,e){var i=Wee(t);return i+8>t.length&&al(6,"invalid gzip data"),JA(t.subarray(i,-8),{i:2},e&&e.out||new ll(qee(t)),e&&e.dictionary)}function Kee(t,e){return JA(t.subarray(Yee(t,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function KA(t,e){return t[0]==31&&t[1]==139&&t[2]==8?Qee(t,e):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?Zee(t,e):Kee(t,e)}var Jee=typeof TextDecoder!="undefined"&&new TextDecoder,ete=0;try{Jee.decode(Xee,{stream:!0}),ete=1}catch(t){}var CU=(t,e)=>t*Math.pow(2,e),m7=(t,e)=>Math.floor(t/Math.pow(2,e)),nv=(t,e)=>CU(t.getUint16(e+1,!0),8)+t.getUint8(e),IU=(t,e)=>CU(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),tte=(t,e,i,r,s)=>{if(t!=r.getUint8(s))return t-r.getUint8(s);let n=nv(r,s+1);if(e!=n)return e-n;let o=nv(r,s+4);return i!=o?i-o:0},ite=(t,e,i,r)=>{let s=kU(t,e|128,i,r);return s?{z:e,x:i,y:r,offset:s[0],length:s[1],is_dir:!0}:null},_U=(t,e,i,r)=>{let s=kU(t,e,i,r);return s?{z:e,x:i,y:r,offset:s[0],length:s[1],is_dir:!1}:null},kU=(t,e,i,r)=>{let s=0,n=t.byteLength/17-1;for(;s<=n;){let o=n+s>>1,a=tte(e,i,r,t,o*17);if(a>0)s=o+1;else if(a<0)n=o-1;else return[IU(t,o*17+7),t.getUint32(o*17+13,!0)]}return null},rte=(t,e)=>t.is_dir&&!e.is_dir?1:!t.is_dir&&e.is_dir?-1:t.z!==e.z?t.z-e.z:t.x!==e.x?t.x-e.x:t.y-e.y,MU=(t,e)=>{let i=t.getUint8(e*17);return{z:i&127,x:nv(t,e*17+1),y:nv(t,e*17+4),offset:IU(t,e*17+7),length:t.getUint32(e*17+13,!0),is_dir:i>>7===1}},xU=t=>{let e=[],i=new DataView(t);for(let r=0;r<i.byteLength/17;r++)e.push(MU(i,r));return ste(e)},ste=t=>{t.sort(rte);let e=new ArrayBuffer(17*t.length),i=new Uint8Array(e);for(let r=0;r<t.length;r++){let s=t[r],n=s.z;s.is_dir&&(n=n|128),i[r*17]=n,i[r*17+1]=s.x&255,i[r*17+2]=s.x>>8&255,i[r*17+3]=s.x>>16&255,i[r*17+4]=s.y&255,i[r*17+5]=s.y>>8&255,i[r*17+6]=s.y>>16&255,i[r*17+7]=s.offset&255,i[r*17+8]=m7(s.offset,8)&255,i[r*17+9]=m7(s.offset,16)&255,i[r*17+10]=m7(s.offset,24)&255,i[r*17+11]=m7(s.offset,32)&255,i[r*17+12]=m7(s.offset,48)&255,i[r*17+13]=s.length&255,i[r*17+14]=s.length>>8&255,i[r*17+15]=s.length>>16&255,i[r*17+16]=s.length>>24&255}return e},nte=(t,e)=>{if(t.byteLength<17)return null;let i=t.byteLength/17,r=MU(t,i-1);if(r.is_dir){let s=r.z,n=e.z-s,o=Math.trunc(e.x/(1<<n)),a=Math.trunc(e.y/(1<<n));return{z:s,x:o,y:a}}return null};function ote(t){return aa(this,null,function*(){let e=yield t.getBytes(0,512e3),i=new DataView(e.data),r=i.getUint32(4,!0),s=i.getUint16(8,!0),n=new TextDecoder("utf-8"),o=JSON.parse(n.decode(new DataView(e.data,10,r))),a=0;o.compression==="gzip"&&(a=2);let l=0;"minzoom"in o&&(l=+o.minzoom);let c=0;"maxzoom"in o&&(c=+o.maxzoom);let d=0,m=0,g=0,_=-180,v=-85,E=180,b=85;if(o.bounds){let A=o.bounds.split(",");_=+A[0],v=+A[1],E=+A[2],b=+A[3]}if(o.center){let A=o.center.split(",");d=+A[0],m=+A[1],g=+A[2]}return{specVersion:i.getUint16(2,!0),rootDirectoryOffset:10+r,rootDirectoryLength:s*17,jsonMetadataOffset:10,jsonMetadataLength:r,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:l,maxZoom:c,minLon:_,minLat:v,maxLon:E,maxLat:b,centerZoom:g,centerLon:d,centerLat:m,etag:e.etag}})}function ate(t,e,i,r,s,n,o){return aa(this,null,function*(){let a=yield i.getArrayBuffer(e,t.rootDirectoryOffset,t.rootDirectoryLength,t);t.specVersion===1&&(a=xU(a));let l=_U(new DataView(a),r,s,n);if(l){let m=(yield e.getBytes(l.offset,l.length,o)).data,g=new DataView(m);return g.getUint8(0)==31&&g.getUint8(1)==139&&(m=KA(new Uint8Array(m))),{data:m}}let c=nte(new DataView(a),{z:r,x:s,y:n});if(c){let d=ite(new DataView(a),c.z,c.x,c.y);if(d){let m=yield i.getArrayBuffer(e,d.offset,d.length,t);t.specVersion===1&&(m=xU(m));let g=_U(new DataView(m),r,s,n);if(g){let v=(yield e.getBytes(g.offset,g.length,o)).data,E=new DataView(v);return E.getUint8(0)==31&&E.getUint8(1)==139&&(v=KA(new Uint8Array(v))),{data:v}}}}})}var PU={getHeader:ote,getZxy:ate};function pp(t,e){return(e>>>0)*4294967296+(t>>>0)}function lte(t,e){let i=e.buf,r,s;if(s=i[e.pos++],r=(s&112)>>4,s<128||(s=i[e.pos++],r|=(s&127)<<3,s<128)||(s=i[e.pos++],r|=(s&127)<<10,s<128)||(s=i[e.pos++],r|=(s&127)<<17,s<128)||(s=i[e.pos++],r|=(s&127)<<24,s<128)||(s=i[e.pos++],r|=(s&1)<<31,s<128))return pp(t,r);throw new Error("Expected varint not more than 10 bytes")}function g7(t){let e=t.buf,i,r;return r=e[t.pos++],i=r&127,r<128||(r=e[t.pos++],i|=(r&127)<<7,r<128)||(r=e[t.pos++],i|=(r&127)<<14,r<128)||(r=e[t.pos++],i|=(r&127)<<21,r<128)?i:(r=e[t.pos],i|=(r&15)<<28,lte(i,t))}function cte(t,e,i,r){if(r==0){i==1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);let s=e[0];e[0]=e[1],e[1]=s}}var ute=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function hte(t,e,i){if(t>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,t)-1||i>Math.pow(2,t)-1)throw Error("tile x/y outside zoom level bounds");let r=ute[t],s=Math.pow(2,t),n=0,o=0,a=0,l=[e,i],c=s/2;for(;c>0;)n=(l[0]&c)>0?1:0,o=(l[1]&c)>0?1:0,a+=c*c*(3*n^o),cte(c,l,n,o),c=c/2;return r+a}function RU(t,e){return aa(this,null,function*(){if(e===1||e===0)return t;if(e===2){if(typeof globalThis.DecompressionStream=="undefined")return KA(new Uint8Array(t));{let r=new Response(t).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}}else throw Error("Compression method not supported")})}var dte=127;function fte(t,e){let i=0,r=t.length-1;for(;i<=r;){let s=r+i>>1,n=e-t[s].tileId;if(n>0)i=s+1;else if(n<0)r=s-1;else return t[s]}return r>=0&&(t[r].runLength===0||e-t[r].tileId<t[r].runLength)?t[r]:null}var pte=class{constructor(t){this.url=t}getKey(){return this.url}getBytes(t,e,i){return aa(this,null,function*(){let r;i||(r=new AbortController,i=r.signal);let s=yield fetch(this.url,{signal:i,headers:{Range:"bytes="+t+"-"+(t+e-1)}});if(s.status===416&&t===0){let a=s.headers.get("Content-Range");if(!a||!a.startsWith("bytes */"))throw Error("Missing content-length on 416 response");let l=+a.substr(8);s=yield fetch(this.url,{signal:i,headers:{Range:"bytes=0-"+(l-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);let n=s.headers.get("Content-Length");if(s.status===200&&(!n||+n>e))throw r&&r.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function _c(t,e){let i=t.getUint32(e+4,!0),r=t.getUint32(e+0,!0);return i*Math.pow(2,32)+r}function mte(t,e){let i=new DataView(t),r=i.getUint8(7);if(r>3)throw Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:_c(i,8),rootDirectoryLength:_c(i,16),jsonMetadataOffset:_c(i,24),jsonMetadataLength:_c(i,32),leafDirectoryOffset:_c(i,40),leafDirectoryLength:_c(i,48),tileDataOffset:_c(i,56),tileDataLength:_c(i,64),numAddressedTiles:_c(i,72),numTileEntries:_c(i,80),numTileContents:_c(i,88),clustered:i.getUint8(96)===1,internalCompression:i.getUint8(97),tileCompression:i.getUint8(98),tileType:i.getUint8(99),minZoom:i.getUint8(100),maxZoom:i.getUint8(101),minLon:i.getInt32(102,!0)/1e7,minLat:i.getInt32(106,!0)/1e7,maxLon:i.getInt32(110,!0)/1e7,maxLat:i.getInt32(114,!0)/1e7,centerZoom:i.getUint8(118),centerLon:i.getInt32(119,!0)/1e7,centerLat:i.getInt32(123,!0)/1e7,etag:e}}function DU(t){let e={buf:new Uint8Array(t),pos:0},i=g7(e),r=[],s=0;for(let n=0;n<i;n++){let o=g7(e);r.push({tileId:s+o,offset:0,length:0,runLength:1}),s+=o}for(let n=0;n<i;n++)r[n].runLength=g7(e);for(let n=0;n<i;n++)r[n].length=g7(e);for(let n=0;n<i;n++){let o=g7(e);o===0&&n>0?r[n].offset=r[n-1].offset+r[n-1].length:r[n].offset=o-1}return r}function gte(t){let e=new DataView(t);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var gp=class extends Error{};function yte(t,e,i,r){return aa(this,null,function*(){let s=yield t.getBytes(0,16384);if(new DataView(s.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(gte(s.data)<3)return[yield PU.getHeader(t)];let o=s.data.slice(0,dte),a=s.etag;r&&s.etag!=r&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+t.getKey()),a=void 0);let l=mte(o,a);if(i){let c=s.data.slice(l.rootDirectoryOffset,l.rootDirectoryOffset+l.rootDirectoryLength),d=t.getKey()+"|"+(l.etag||"")+"|"+l.rootDirectoryOffset+"|"+l.rootDirectoryLength,m=DU(yield e(c,l.internalCompression));return[l,[d,m.length,m]]}return[l,void 0]})}function _te(t,e,i,r,s){return aa(this,null,function*(){let n=yield t.getBytes(i,r);if(s.etag&&s.etag!==n.etag)throw new gp(n.etag);let o=yield e(n.data,s.internalCompression),a=DU(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var xte=class{constructor(t=100,e=!0,i=RU){this.cache=new Map,this.maxCacheEntries=t,this.counter=1,this.prefetch=e,this.decompress=i}getHeader(t,e){return aa(this,null,function*(){let i=t.getKey();if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;let r=new Promise((s,n)=>{yte(t,this.decompress,this.prefetch,e).then(o=>{o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:Promise.resolve(o[1][2])}),s(o[0]),this.prune()}).catch(o=>{n(o)})});return this.cache.set(i,{lastUsed:this.counter++,data:r}),r})}getDirectory(t,e,i,r){return aa(this,null,function*(){let s=t.getKey()+"|"+(r.etag||"")+"|"+e+"|"+i;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;let n=new Promise((o,a)=>{_te(t,this.decompress,e,i,r).then(l=>{o(l),this.prune()}).catch(l=>{a(l)})});return this.cache.set(s,{lastUsed:this.counter++,data:n}),n})}getArrayBuffer(t,e,i,r){return aa(this,null,function*(){let s=t.getKey()+"|"+(r.etag||"")+"|"+e+"|"+i;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;let n=new Promise((o,a)=>{t.getBytes(e,i).then(l=>{if(r.etag&&r.etag!==l.etag)throw new gp(l.etag);o(l.data),this.cache.has(s),this.prune()}).catch(l=>{a(l)})});return this.cache.set(s,{lastUsed:this.counter++,data:n}),n})}prune(){if(this.cache.size>=this.maxCacheEntries){let t=1/0,e;this.cache.forEach((i,r)=>{i.lastUsed<t&&(t=i.lastUsed,e=r)}),e&&this.cache.delete(e)}}invalidate(t,e){return aa(this,null,function*(){this.cache.delete(t.getKey()),yield this.getHeader(t,e)})}},FU=class{constructor(t,e,i){typeof t=="string"?this.source=new pte(t):this.source=t,i?this.decompress=i:this.decompress=RU,e?this.cache=e:this.cache=new xte}getHeader(){return aa(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(t,e,i,r){return aa(this,null,function*(){let s=hte(t,e,i),n=yield this.cache.getHeader(this.source);if(n.specVersion<3)return PU.getZxy(n,this.source,this.cache,t,e,i,r);if(t<n.minZoom||t>n.maxZoom)return;let o=n.rootDirectoryOffset,a=n.rootDirectoryLength;for(let l=0;l<=3;l++){let c=yield this.cache.getDirectory(this.source,o,a,n),d=fte(c,s);if(d)if(d.runLength>0){let m=yield this.source.getBytes(n.tileDataOffset+d.offset,d.length,r);if(n.etag&&n.etag!==m.etag)throw new gp(m.etag);return{data:yield this.decompress(m.data,n.tileCompression),cacheControl:m.cacheControl,expires:m.expires}}else o=n.leafDirectoryOffset+d.offset,a=d.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(t,e,i,r){return aa(this,null,function*(){try{return yield this.getZxyAttempt(t,e,i,r)}catch(s){if(s instanceof gp)return this.cache.invalidate(this.source,s.message),yield this.getZxyAttempt(t,e,i,r);throw s}})}getMetadataAttempt(){return aa(this,null,function*(){let t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength);if(t.etag&&t.etag!==e.etag)throw new gp(e.etag);let i=yield this.decompress(e.data,t.internalCompression),r=new TextDecoder("utf-8");return JSON.parse(r.decode(i))})}getMetadata(){return aa(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof gp)return this.cache.invalidate(this.source,t.message),yield this.getMetadataAttempt();throw t}})}};var BU=Yi(NU(),1),UU=Yi(yT(),1),zU=Yi(RA(),1),GU=Yi(kl(),1);var x7=class extends fi{constructor(e){super(e),this.id="vectortile",this._sources=new Map,this._tiler=new zs().tileSize(512).margin(1),this._nextID=0}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){for(let e of this._sources.values()){for(let i of e.inflight.values())i.abort();e.inflight.clear(),e.loaded.clear(),e.readyPromise=null;for(let i of e.zoomCache.values())i.features.clear(),i.boxes.clear(),i.toMerge.clear(),i.didMerge.clear(),i.rbush.clear();e.zoomCache.clear()}return this._sources.clear(),Promise.resolve()}getNextID(){return(this._nextID++).toString()}getData(e){let i=this._sources.get(e);if(!i)return[];let r=this.context.systems.map,s=r.extent(),n=Math.round(r.zoom())-1,o;for(let a=0;a<12;a++){if(o=i.zoomCache.get(n+a),o)return o.rbush.search(s.bbox()).map(l=>l.data);if(o=i.zoomCache.get(n-a),o)return o.rbush.search(s.bbox()).map(l=>l.data)}return[]}loadTiles(e){this._getSourceAsync(e).then(i=>{let r=i.header;if(r&&(this._tiler.zoomRange(r.minZoom,r.maxZoom),r.tileType!==1))throw new Error(`Unsupported tileType ${r.tileType}. Only Type 1 (MVT) is supported`);let s=this.context.projection,n=this._tiler.getTiles(s).tiles;for(let[a,l]of i.inflight)n.find(d=>d.id===a)||l.abort();let o=n.map(a=>this._loadTileAsync(i,a));return Promise.all(o).then(()=>this._processMergeQueue(i))})}_getSourceAsync(e){if(!e)return Promise.reject(new Error("No template"));let i=this._sources.get(e);if(!i){let r=new URL(e),s=r.hostname,n=r.pathname.split("/").at(-1);i={id:m3(e).toString(),displayName:s,template:e,inflight:new Map,loaded:new Map,zoomCache:new Map},this._sources.set(e,i),n&&/\.pmtiles$/.test(n)?(i.displayName=n,i.pmtiles=new FU(e),i.readyPromise=i.pmtiles.getHeader().then(o=>i.header=o).then(()=>Promise.resolve(i))):i.readyPromise=Promise.resolve(i)}return i.readyPromise}_getZoomCache(e,i){let r=e.zoomCache.get(i);return r||(r={features:new Map,boxes:new Map,toMerge:new Map,didMerge:new Set,rbush:new GU.default},e.zoomCache.set(i,r)),r}_loadTileAsync(e,i){let r=i.id;if(e.loaded.has(r)||e.inflight.has(r))return;let s=new AbortController;e.inflight.set(r,s);let[n,o,a]=i.xyz,l;if(e.pmtiles)l=e.pmtiles.getZxy(a,n,o,s.signal).then(c=>c==null?void 0:c.data);else{let c=e.template.replace("{x}",n).replace("{y}",o).replace(/\{[t-]y\}/,Math.pow(2,a)-o-1).replace(/\{z(oom)?\}/,a).replace(/\{switch:([^}]+)\}/,function(d,m){let g=m.split(",");return g[(n+o)%g.length]});l=fetch(c,{signal:s.signal}).then(Ai)}return l.then(c=>{e.loaded.set(r,i),this._parseTileBuffer(e,i,c)}).catch(c=>{c.name!=="AbortError"&&c instanceof Error&&console.error(c)}).finally(()=>{e.inflight.delete(r)})}_parseTileBuffer(e,i,r){if(!r)return;let[s,n,o]=i.xyz,a=i.id,l=i.wgs84Extent,c=`${s-1},${n},${o}-${a}`,d=`${a}-${s+1},${n},${o}`,m=`${s},${n-1},${o}-${a}`,g=`${a}-${s},${n+1},${o}`,_=new OU.VectorTile(new zU.default(r)),v=this._getZoomCache(e,o),E=[];for(let[b,T]of Object.entries(_.layers)){if(!T)continue;let A=0,M=T.extent;for(let k=0;k<T.length;k++){let F=T.feature(k),[O,B,U,z]=F.bbox();if(O>M||B>M||U<A||z<A)continue;for(let[q,Q]of Object.entries(F.properties))F.properties[q]=Q.toString();let Z=m3((0,BU.default)(F.properties)).toString();F.id||(F.id=Z);let W=F.toGeoJSON(s,n,o);for(let q of this._toSingleFeatures(W)){let Q=this._calcExtent(q);if(!isFinite(Q.min[0]))continue;let V=this.getNextID();q.id=V,q.__featurehash__=V,q.geometry.type==="Polygon"&&(Q.min[0]<l.min[0]&&this._queueMerge(v,V,Z,c),Q.max[0]>l.max[0]&&this._queueMerge(v,V,Z,d),Q.min[1]<l.min[1]&&this._queueMerge(v,V,Z,g),Q.max[1]>l.max[1]&&this._queueMerge(v,V,Z,m)),E.push({id:V,extent:Q,layerID:b,prophash:Z,geojson:(0,eC.default)(q,!0),v:0})}}}E.length&&(this._cacheFeatures(v,E),this.context.deferredRedraw(),this.emit("loadedData"))}_queueMerge(e,i,r,s){if(e.didMerge.has(s))return;let n=e.toMerge.get(s);n||(n=new Map,e.toMerge.set(s,n));let o=n.get(r);o||(o=new Set,n.set(r,o)),o.add(i)}_processMergeQueue(e){for(let i of e.zoomCache.values())for(let[r,s]of i.toMerge){let[n,o]=r.split("-"),a=e.loaded.get(n),l=e.loaded.get(o);if(!(!a||!l)){i.didMerge.add(r);for(let[c,d]of s)this._mergePolygons(i,c,d,a,l),s.delete(c);i.toMerge.delete(r)}}}_cacheFeatures(e,i){let r=[];for(let s of i){e.features.set(s.id,s);let n=s.extent.bbox();n.data=s,e.boxes.set(s.id,n),r.push(n)}e.rbush.load(r)}_uncacheFeatureIDs(e,i){for(let r of i){let s=e.boxes.get(r);s&&(e.boxes.delete(r),e.rbush.remove(s)),e.features.delete(r)}}_mergePolygons(e,i,r,s,n){let o=Array.from(r).map(de=>e.features.get(de)).filter(Boolean);if(!o.length)return;let[a,l,c]=s.xyz,[d,m,g]=n.xyz,_=s.id,v=n.id,E=s.wgs84Extent,b=n.wgs84Extent,T=m===l+1,A=d===a+1,M=`${a-1},${l},${c}-${_}`,k=`${_}-${a+1},${l},${c}`,F=`${a},${l-1},${c}-${_}`,O=`${_}-${a},${l+1},${c}`,B=`${d-1},${m},${g}-${v}`,U=`${v}-${d+1},${m},${g}`,z=`${d},${m-1},${g}-${v}`,Z=`${v}-${d},${m+1},${g}`,W=o[0];this._uncacheFeatureIDs(e,r);let q=o.map(de=>de.geojson.geometry.coordinates),Q=UU.default.union(...q);if(!Q||!Q.length)throw new Error("Failed to merge");let V={type:"Feature",geometry:{type:"MultiPolygon",coordinates:Q},properties:Object.assign({},W.geojson.properties)},le=[];for(let de of this._toSingleFeatures(V)){let ne=this._calcExtent(de);if(!isFinite(ne.min[0]))continue;this._dedupePoints(de);let ee=this.getNextID();de.id=ee,de.__featurehash__=ee,ne.min[0]<E.min[0]&&this._queueMerge(e,ee,i,M),T&&ne.max[0]>E.max[0]&&this._queueMerge(e,ee,i,k),A&&ne.min[1]<E.min[1]&&this._queueMerge(e,ee,i,O),ne.max[1]>E.max[1]&&this._queueMerge(e,ee,i,F),T&&ne.min[0]<b.min[0]&&this._queueMerge(e,ee,i,B),ne.max[0]>b.max[0]&&this._queueMerge(e,ee,i,U),ne.min[1]<b.min[1]&&this._queueMerge(e,ee,i,Z),A&&ne.max[1]>b.max[1]&&this._queueMerge(e,ee,i,z),le.push({id:ee,extent:ne,layerID:W.layerID,prophash:i,geojson:(0,eC.default)(de,!0),v:0})}le.length&&(this._cacheFeatures(e,le),this.context.deferredRedraw())}_calcExtent(e){let i=new mt,r=e==null?void 0:e.geometry;if(!e||!r)return i;let s=r.type,n=r.coordinates,o=/^Multi/.test(s)?n:[n];if(/Polygon$/.test(s))for(let l of o){let c=l[0];for(let d of c)a(d)}else if(/LineString$/.test(s))for(let l of o)for(let c of l)a(c);else if(/Point$/.test(s))for(let l of o)a(l);return i;function a(l){i.min=[Math.min(i.min[0],l[0]),Math.min(i.min[1],l[1])],i.max=[Math.max(i.max[0],l[0]),Math.max(i.max[1],l[1])]}}_dedupePoints(e){let i=e==null?void 0:e.geometry;if(!e||!i||i.type!=="Polygon")return;let r=5e-6,s=i.coordinates;for(let n=0;n<s.length;n++){let o=s[n],a=[],l=null;for(let c=0;c<o.length;c++){let d=o[c];c===0||c===o.length-1?a.push(d):Zi(d,l,r)||a.push(d),l=d}s[n]=a}}_toSingleFeatures(e){var a;let i=[],r=e==null?void 0:e.geometry;if(!e||!r)return i;let s=r.type,n=r.coordinates,o=/^Multi/.test(s)?n:[n];for(let l of o)i.push({type:"Feature",id:(a=e.id)!=null?a:void 0,geometry:{type:s.replace("Multi",""),coordinates:l},properties:Object.assign({},e.properties)});return i}};var tC="https://www.wikidata.org/w/api.php?",v7=class extends fi{constructor(e){super(e),this.id="wikidata",this._cache=new Map}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this._cache.clear(),Promise.resolve()}itemsForSearchQuery(e,i){if(!e){i&&i("No query",{});return}let r=this.languagesToQuery()[0],s=tC+lr({action:"wbsearchentities",format:"json",formatversion:2,search:e,type:"item",language:r,uselang:r,limit:10,origin:"*"});fetch(s).then(Ai).then(n=>{if(n&&n.error)throw new Error(n.error);i&&i(null,n.search||{})}).catch(n=>{i&&i(n.message,{})})}itemsByTitle(e,i,r){if(!i){r&&r("No title",{});return}e=e||"en";let s=tC+lr({action:"wbgetentities",format:"json",formatversion:2,sites:e.replace(/-/g,"_")+"wiki",titles:i,languages:"en",origin:"*"});fetch(s).then(Ai).then(n=>{if(n&&n.error)throw new Error(n.error);r&&r(null,n.entities||{})}).catch(n=>{r&&r(n.message,{})})}languagesToQuery(){return this.context.systems.l10n.localeCodes().map(i=>i.toLowerCase()).filter(i=>i!=="en-us")}entityByQID(e,i){if(!e){i("No qid",{});return}if(this._cache.has(e)){i&&i(null,this._cache.get(e));return}let r=this.languagesToQuery(),s=tC+lr({action:"wbgetentities",format:"json",formatversion:2,ids:e,props:"labels|descriptions|claims|sitelinks",sitefilter:r.map(n=>`${n}wiki`).join("|"),languages:r.join("|"),languagefallback:1,origin:"*"});fetch(s).then(Ai).then(n=>{if(n&&n.error)throw new Error(n.error);this._cache.set(e,n.entities[e]),i&&i(null,n.entities[e]||{})}).catch(n=>{i&&i(n.message,{})})}getDocs(e,i){let r=this.languagesToQuery();this.entityByQID(e.qid,function(s,n){var l,c;if(s||!n){i(s||"No entity");return}let o;for(let d of r)if(n.descriptions[d]&&n.descriptions[d].language===d){o=n.descriptions[d];break}!o&&Object.values(n.descriptions).length&&(o=Object.values(n.descriptions)[0]);let a={title:n.id,description:(l=o==null?void 0:o.value)!=null?l:"",descriptionLocaleCode:(c=o==null?void 0:o.language)!=null?c:"",editURL:`https://www.wikidata.org/wiki/${n.id}`};if(n.claims){let d="https://commons.wikimedia.org/w/index.php?";for(let m of["P154","P18"]){let g=n.claims[m];if(g&&Object.keys(g).length){let _=g[Object.keys(g)[0]].mainsnak.datavalue.value;if(_){a.imageURL=d+lr({title:`Special:Redirect/file/${_}`,width:400});break}}}}if(n.sitelinks){let m=this.context.systems.l10n.languageCode().toLowerCase()==="en";for(let g of r){let _=`${g}wiki`;if(n.sitelinks[_]){let v=n.sitelinks[_].title,E="inspector.wiki_reference";!m&&g==="en"&&(E="inspector.wiki_en_reference"),a.wiki={title:v,text:E,url:`https://${g}.wikipedia.org/wiki/`+v.replace(/ /g,"_")};break}}}i(null,a)})}};var iC="https://en.wikipedia.org/w/api.php?",b7=class extends fi{constructor(e){super(e),this.id="wikipedia"}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}search(e,i,r){if(!i){r&&r("No Query",[]);return}e=e||"en";let s=iC.replace("en",e)+lr({action:"query",list:"search",srlimit:"10",srinfo:"suggestion",format:"json",origin:"*",srsearch:i});fetch(s).then(Ai).then(n=>{if(n&&n.error)throw new Error(n.error);if(!n||!n.query||!n.query.search)throw new Error("No Results");if(r){let o=n.query.search.map(a=>a.title);r(null,o)}}).catch(n=>{r&&r(n,[])})}suggestions(e,i,r){if(!i){r&&r("",[]);return}e=e||"en";let s=iC.replace("en",e)+lr({action:"opensearch",namespace:0,suggest:"",format:"json",origin:"*",search:i});fetch(s).then(Ai).then(n=>{if(n&&n.error)throw new Error(n.error);if(!n||n.length<2)throw new Error("No Results");r&&r(null,n[1]||[])}).catch(n=>{r&&r(n.message,[])})}translations(e,i,r){if(!i){r&&r("No Title");return}e=e||"en";let s=iC.replace("en",e)+lr({action:"query",prop:"langlinks",format:"json",origin:"*",lllimit:500,titles:i});fetch(s).then(Ai).then(n=>{if(n&&n.error)throw new Error(n.error);if(!n||!n.query||!n.query.pages)throw new Error("No Results");if(r){let o=n.query.pages[Object.keys(n.query.pages)[0]],a={};o&&o.langlinks&&o.langlinks.forEach(function(l){a[l.lang]=l["*"]}),r(null,a)}}).catch(n=>{r&&r(n.message)})}};var Bn={available:new Map};Bn.available.set("esri",Y6);Bn.available.set("improveOSM",Z6);Bn.available.set("kartaview",Q6);Bn.available.set("keepRight",K6);Bn.available.set("mapillary",J6);Bn.available.set("mapwithai",e7);Bn.available.set("nominatim",t7);Bn.available.set("nsi",r7);Bn.available.set("osm",c7);Bn.available.set("osmose",u7);Bn.available.set("osmwikibase",h7);Bn.available.set("streetside",d7);Bn.available.set("taginfo",p7);Bn.available.set("vectortile",x7);Bn.available.set("wikidata",v7);Bn.available.set("wikipedia",b7);function $U(){var t=["building","highway","railway","waterway","aeroway","aerialway","piste:type","boundary","power","amenity","natural","landuse","leisure","military","place","man_made","route","attraction","building:part","indoor"],e=Object.keys(F1),i=["oneway","bridge","tunnel","embankment","cutting","barrier","surface","tracktype","footway","crossing","service","sport","public_transport","location","parking","golf","type","leisure","man_made","indoor"],r=function(n){return n.tags},s=function(n){n.each(function(a){var l=this.className;l.baseVal!==void 0&&(l=l.baseVal);var c=r(a),d=s.getClassesString(c,l);d!==l&&ye(this).attr("class",d)})};return s.getClassesString=function(n,o){var a,l,c,d,m,g,_;/\bstroke\b/.test(o)&&n.barrier&&n.barrier!=="no"&&(_="line");var v=o.trim().split(/\s+/).filter(function(T){return T.length&&!/^tag-/.test(T)}).map(function(T){return(T==="line"||T==="area")&&_||T});for(c=0;c<t.length;c++)if(m=t[c],g=n[m],!(!g||g==="no")){m==="piste:type"?m="piste":m==="building:part"&&(m="building_part"),a=m,e.indexOf(g)!==-1?(l=g,v.push("tag-"+m)):(v.push("tag-"+m),v.push("tag-"+m+"-"+g));break}if(!a){for(c=0;c<e.length;c++)for(d=0;d<t.length;d++)if(m=e[c]+":"+t[d],g=n[m],!(!g||g==="no")){l=e[c];break}}if(!l)for(c=0;c<e.length&&(m=e[c],g=n[m],!(!(!g||g==="no")&&(g==="yes"||a&&a===g?l=m:!a&&t.indexOf(g)!==-1&&(l=m,a=g,v.push("tag-"+g)),l)));c++);for(l&&(v.push("tag-status"),v.push("tag-status-"+l)),c=0;c<i.length;c++)m=i[c],g=n[m],!(!g||g==="no"||m===a)&&(v.push("tag-"+m),v.push("tag-"+m+"-"+g));if(a==="highway"&&!ql[n.highway]||a==="aeroway"){var E=n.highway==="track"?"unpaved":"paved";for(m in n)g=n[m],m in td&&(E=td[m][g]?"paved":"unpaved"),m in Ab&&Ab[m][g]&&(E="semipaved");v.push("tag-"+E)}var b=n.wikidata||n["flag:wikidata"]||n["brand:wikidata"]||n["network:wikidata"]||n["operator:wikidata"];return b&&v.push("tag-wikidata"),v.join(" ").trim()},s.tags=function(n){return arguments.length?(r=n,s):r},s}var vte=15,bte=256,ov=class extends sn.default{constructor(){super(),this.version="2.1.0",this.privacyVersion="20201202",this.maxCharsForTagKey=255,this.maxCharsForTagValue=255,this.maxCharsForRelationRole=255,this.assetPath="",this.assetMap={},this.projection=new Ho,this.systems={},this.modes={},this._currMode=null,this.behaviors={},this.services={},this.lastPointerType="mouse",this._keybinding=$i("context"),ye(document).call(this._keybinding),this._preauth=null,this._apiConnections=null,this._prelocale=null,this._copyGraph=null,this._copyIDs=[],this._copyLoc=null,this._debugFlags={tile:!1,label:!1,imagery:!1,target:!1,downloaded:!1},this._container=ye(null),this._embed=null,this.inIntro=!1,this.save=this.save.bind(this),this.debouncedSave=Gr(this.save,350)}initAsync(){for(let[l,c]of On.available)this.systems[l]=new c(this);let e=this.systems.edits,i=l=>(...c)=>{let d=l.apply(e,c);return this.debouncedSave(),d};this.graph=e.graph,this.hasEntity=l=>e.graph().hasEntity(l),this.entity=l=>e.graph().entity(l),this.pauseChangeDispatch=e.pauseChangeDispatch,this.resumeChangeDispatch=e.resumeChangeDispatch,this.perform=i(e.perform),this.replace=i(e.replace),this.pop=i(e.pop),this.overwrite=i(e.overwrite),this.undo=i(e.undo),this.redo=i(e.redo);let r=this.systems.l10n;this.t=r.t,this.tHtml=r.tHtml,this.tAppend=r.tAppend,this._prelocale&&(this.systems.l10n.preferredLocaleCodes=this._prelocale);let s=this.systems.filters;this.hasHiddenConnections=l=>{let c=e.graph(),d=c.entity(l);return s.hasHiddenConnections(d,c)};let n=this.systems.map;this.deferredRedraw=n.deferredRedraw,this.immediateRedraw=n.immediateRedraw,this.scene=()=>n.scene,this.surface=()=>n.surface,this.surfaceRect=()=>n.surface.node().getBoundingClientRect(),this.editable=()=>{let l=this._currMode;return!(!l||l.id==="save")};for(let[l,c]of Pa.available)this.modes[l]=new c(this);for(let[l,c]of uc.available)this.behaviors[l]=new c(this);if(!window.mocha)for(let[l,c]of Bn.available)this.services[l]=new c(this);let o=Object.values(this.systems),a=Object.values(this.services);return Promise.resolve().then(()=>Promise.all(o.map(l=>l.initAsync()))).then(()=>Promise.all(a.map(l=>l.initAsync()))).then(()=>{let l=this.services.osm;return l&&this._preauth?l.switchAsync(this._preauth):Promise.resolve()}).then(()=>Promise.all(o.map(l=>l.autoStart?l.startAsync():Promise.resolve()))).then(()=>Promise.all(a.map(l=>l.autoStart?l.startAsync():Promise.resolve())))}resetAsync(){this.debouncedSave.cancel();let e=Object.values(this.systems),i=Object.values(this.services);return Promise.resolve().then(()=>Promise.all(e.map(r=>r.resetAsync()))).then(()=>Promise.all(i.map(r=>r.resetAsync())))}keybinding(){return this._keybinding}get preauth(){return this._preauth}set preauth(e){this._preauth=Object.assign({},e)}get apiConnections(){return this._apiConnections}set apiConnections(e){this._apiConnections=e}get locale(){return this._prelocale}set locale(e){this._prelocale=e}_afterLoad(e,i){return(r,s)=>{let n=this.services.osm;if(r){(r.status===400||r.status===401||r.status===403)&&(n==null||n.logout()),typeof i=="function"&&i(r);return}else if((n==null?void 0:n.connectionID)!==e){typeof i=="function"&&i({message:"Connection Switched",status:-1});return}else{this.systems.edits.merge(s.data,s.seenIDs),typeof i=="function"&&i(r,s);return}}}loadTiles(e,i){let r=this.services.osm;if(!(!r||Ga(e.scale(),bte)<vte)&&this.editable()){let n=r.connectionID;r.loadTiles(e,this._afterLoad(n,i))}}loadTileAtLoc(e,i){let r=this.services.osm;if(r&&this.editable()){let s=r.connectionID;r.loadTileAtLoc(e,this._afterLoad(s,i))}}loadEntity(e,i){let r=this.services.osm;if(!r)return;let s=r.connectionID;r.loadEntity(e,this._afterLoad(s,i)),r.loadEntityRelations(e,this._afterLoad(s,i))}_cleanOsmString(e,i){return e==null?e="":e=e.toString(),e=e.trim(),e.normalize&&(e=e.normalize("NFC")),F9(e,i)}cleanTagKey(e){return this._cleanOsmString(e,this.maxCharsForTagKey)}cleanTagValue(e){return this._cleanOsmString(e,this.maxCharsForTagValue)}cleanRelationRole(e){return this._cleanOsmString(e,this.maxCharsForRelationRole)}save(){var s;let e=this.systems.edits,i=this.systems.l10n;if(this.inIntro||this._container.select(".modal").size())return;let r;if(((s=this._currMode)==null?void 0:s.id)==="save"){r=!1;let n=this.services.osm;if(n&&n.isChangesetInflight()){e.clearSaved();return}}else r=this.selectedIDs().every(n=>{let o=this.hasEntity(n);return o&&!o.isDegenerate()});if(r&&e.save(),e.hasChanges())return i.t("save.unsaved_changes")}get mode(){return this._currMode}enter(e,i){let r=this._currMode,s;return typeof e=="string"?s=this.modes[e]:s=e,s||(console.error(`context.enter: no such mode: ${e}`),s=this.modes.browse),r&&(r.exit(),this._container.classed(`mode-${r.id}`,!1)),this._currMode=s,this._currMode.enter(i)||(this._currMode=this.modes.browse,this._currMode.enter()),this._container.classed(`mode-${this._currMode.id}`,!0),this.emit("modechange",this._currMode),this._currMode}selectedData(){return this._currMode?this._currMode.selectedData||new Map:new Map}selectedIDs(){return this._currMode?this._currMode.selectedIDs||[]:[]}selectedNoteID(){return console.error("deprecated: do not call context.selectedNoteID anymore"),null}selectedErrorID(){return console.error("deprecated: do not call context.selectedErrorID anymore"),null}enableBehaviors(e){e instanceof Set||(e=new Set([].concat(e)));for(let[i,r]of Object.entries(this.behaviors))e.has(i)?r.enabled||r.enable():r.enabled&&r.disable()}get copyGraph(){return this._copyGraph}set copyGraph(e){this._copyGraph=e}get copyIDs(){return this._copyIDs}set copyIDs(e){this._copyIDs=e,this._copyGraph=this.systems.edits.graph()}get copyLoc(){return this._copyLoc}set copyLoc(e){this._copyLoc=e}debugFlags(){return this._debugFlags}getDebug(e){return e&&this._debugFlags[e]}setDebug(e,i=!0){var r;this._debugFlags[e]=i,(r=this.systems.map)!=null&&r.renderer&&this.systems.map.immediateRedraw()}container(e){return e===void 0?this._container:(this._container=e,this._container.classed("ideditor",!0),this)}get containerNode(){return this._container.node()}set containerNode(e){this.container(ye(e))}embed(e){return e===void 0?this._embed:(this._embed=e,this)}asset(e){if(/^http(s)?:\/\//i.test(e))return e;let i=`${this.assetPath}${e}`;return this.assetMap[i]||i}imagePath(e){return console.error("deprecated: do not call context.imagePath anymore"),this.asset(`img/${e}`)}};var{abs:C7t,max:I7t,min:k7t}=Math;function HU(t){return[+t[0],+t[1]]}function wte(t){return[HU(t[0]),HU(t[1])]}var M7t={name:"x",handles:["w","e"].map(rC),input:function(t,e){return t==null?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},P7t={name:"y",handles:["n","s"].map(rC),input:function(t,e){return t==null?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},R7t={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(rC),input:function(t){return t==null?null:wte(t)},output:function(t){return t}};function rC(t){return{type:t}}var Tte={polygonArea:Af,polygonCentroid:ma,select:ye,selectAll:Zb,timerFlush:v8},Ste={Projection:Ho,Extent:mt,geoSphericalDistance:mr,geoZoomToScale:Fn,vecLength:Xi,utilQsString:lr,utilStringQs:Kh};er.setOptions({headerIds:!1,mangle:!1});window.requestIdleCallback=window.requestIdleCallback||function(t){var e=Date.now();return window.requestAnimationFrame(function(){t({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-e))}})})};window.cancelIdleCallback=window.cancelIdleCallback||function(t){window.cancelAnimationFrame(t)};window.Rapid=av;window.iD=av;})();
//# sourceMappingURL=rapid.legacy.min.js.map
