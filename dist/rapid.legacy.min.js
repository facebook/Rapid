(()=>{var kI=Object.create;var p3=Object.defineProperty,TI=Object.defineProperties,II=Object.getOwnPropertyDescriptor,MI=Object.getOwnPropertyDescriptors,PI=Object.getOwnPropertyNames,f3=Object.getOwnPropertySymbols,DI=Object.getPrototypeOf,o7=Object.prototype.hasOwnProperty,by=Object.prototype.propertyIsEnumerable;var n7=(i,e,t)=>e in i?p3(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ne=(i,e)=>{for(var t in e||(e={}))o7.call(e,t)&&n7(i,t,e[t]);if(f3)for(var t of f3(e))by.call(e,t)&&n7(i,t,e[t]);return i},Si=(i,e)=>TI(i,MI(e));var m3=(i,e)=>{var t={};for(var r in i)o7.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&f3)for(var r of f3(i))e.indexOf(r)<0&&by.call(i,r)&&(t[r]=i[r]);return t};var ze=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),g3=(i,e)=>{for(var t in e)p3(i,t,{get:e[t],enumerable:!0})},RI=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of PI(e))!o7.call(i,s)&&s!==t&&p3(i,s,{get:()=>e[s],enumerable:!(r=II(e,s))||r.enumerable});return i};var et=(i,e,t)=>(t=i!=null?kI(DI(i)):{},RI(e||!i||!i.__esModule?p3(t,"default",{value:i,enumerable:!0}):t,i));var ge=(i,e,t)=>(n7(i,typeof e!="symbol"?e+"":e,t),t),NI=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var a7=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)};var y3=(i,e,t)=>(NI(i,e,"access private method"),t);var fe=(i,e,t)=>new Promise((r,s)=>{var n=l=>{try{a(t.next(l))}catch(c){s(c)}},o=l=>{try{a(t.throw(l))}catch(c){s(c)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(n,o);a((t=t.apply(i,e)).next())});var Ey=ze((l7,wy)=>{(function(i){"use strict";function e(N){return parseInt(N)===N}function t(N){if(!e(N.length))return!1;for(var F=0;F<N.length;F++)if(!e(N[F])||N[F]<0||N[F]>255)return!1;return!0}function r(N,F){if(N.buffer&&N.name==="Uint8Array")return F&&(N.slice?N=N.slice():N=Array.prototype.slice.call(N)),N;if(Array.isArray(N)){if(!t(N))throw new Error("Array contains invalid value: "+N);return new Uint8Array(N)}if(e(N.length)&&t(N))return new Uint8Array(N);throw new Error("unsupported array-like object")}function s(N){return new Uint8Array(N)}function n(N,F,B,$,U){($!=null||U!=null)&&(N.slice?N=N.slice($,U):N=Array.prototype.slice.call(N,$,U)),F.set(N,B)}var o=function(){function N(B){var $=[],U=0;for(B=encodeURI(B);U<B.length;){var H=B.charCodeAt(U++);H===37?($.push(parseInt(B.substr(U,2),16)),U+=2):$.push(H)}return r($)}function F(B){for(var $=[],U=0;U<B.length;){var H=B[U];H<128?($.push(String.fromCharCode(H)),U++):H>191&&H<224?($.push(String.fromCharCode((H&31)<<6|B[U+1]&63)),U+=2):($.push(String.fromCharCode((H&15)<<12|(B[U+1]&63)<<6|B[U+2]&63)),U+=3)}return $.join("")}return{toBytes:N,fromBytes:F}}(),a=function(){function N($){for(var U=[],H=0;H<$.length;H+=2)U.push(parseInt($.substr(H,2),16));return U}var F="0123456789abcdef";function B($){for(var U=[],H=0;H<$.length;H++){var z=$[H];U.push(F[(z&240)>>4]+F[z&15])}return U.join("")}return{toBytes:N,fromBytes:B}}(),l={16:10,24:12,32:14},c=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],u=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],h=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],d=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],f=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],p=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],m=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],g=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],y=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],x=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239e3,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],b=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998e3,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],_=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],w=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],A=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],k=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];function v(N){for(var F=[],B=0;B<N.length;B+=4)F.push(N[B]<<24|N[B+1]<<16|N[B+2]<<8|N[B+3]);return F}var E=function(N){if(!(this instanceof E))throw Error("AES must be instanitated with `new`");Object.defineProperty(this,"key",{value:r(N,!0)}),this._prepare()};E.prototype._prepare=function(){var N=l[this.key.length];if(N==null)throw new Error("invalid key size (must be 16, 24 or 32 bytes)");this._Ke=[],this._Kd=[];for(var F=0;F<=N;F++)this._Ke.push([0,0,0,0]),this._Kd.push([0,0,0,0]);for(var B=(N+1)*4,$=this.key.length/4,U=v(this.key),H,F=0;F<$;F++)H=F>>2,this._Ke[H][F%4]=U[F],this._Kd[N-H][F%4]=U[F];for(var z=0,j=$,X;j<B;){if(X=U[$-1],U[0]^=u[X>>16&255]<<24^u[X>>8&255]<<16^u[X&255]<<8^u[X>>24&255]^c[z]<<24,z+=1,$!=8)for(var F=1;F<$;F++)U[F]^=U[F-1];else{for(var F=1;F<$/2;F++)U[F]^=U[F-1];X=U[$/2-1],U[$/2]^=u[X&255]^u[X>>8&255]<<8^u[X>>16&255]<<16^u[X>>24&255]<<24;for(var F=$/2+1;F<$;F++)U[F]^=U[F-1]}for(var F=0,K,Y;F<$&&j<B;)K=j>>2,Y=j%4,this._Ke[K][Y]=U[F],this._Kd[N-K][Y]=U[F++],j++}for(var K=1;K<N;K++)for(var Y=0;Y<4;Y++)X=this._Kd[K][Y],this._Kd[K][Y]=_[X>>24&255]^w[X>>16&255]^A[X>>8&255]^k[X&255]},E.prototype.encrypt=function(N){if(N.length!=16)throw new Error("invalid plaintext size (must be 16 bytes)");for(var F=this._Ke.length-1,B=[0,0,0,0],$=v(N),U=0;U<4;U++)$[U]^=this._Ke[0][U];for(var H=1;H<F;H++){for(var U=0;U<4;U++)B[U]=d[$[U]>>24&255]^f[$[(U+1)%4]>>16&255]^p[$[(U+2)%4]>>8&255]^m[$[(U+3)%4]&255]^this._Ke[H][U];$=B.slice()}for(var z=s(16),j,U=0;U<4;U++)j=this._Ke[F][U],z[4*U]=(u[$[U]>>24&255]^j>>24)&255,z[4*U+1]=(u[$[(U+1)%4]>>16&255]^j>>16)&255,z[4*U+2]=(u[$[(U+2)%4]>>8&255]^j>>8)&255,z[4*U+3]=(u[$[(U+3)%4]&255]^j)&255;return z},E.prototype.decrypt=function(N){if(N.length!=16)throw new Error("invalid ciphertext size (must be 16 bytes)");for(var F=this._Kd.length-1,B=[0,0,0,0],$=v(N),U=0;U<4;U++)$[U]^=this._Kd[0][U];for(var H=1;H<F;H++){for(var U=0;U<4;U++)B[U]=g[$[U]>>24&255]^y[$[(U+3)%4]>>16&255]^x[$[(U+2)%4]>>8&255]^b[$[(U+1)%4]&255]^this._Kd[H][U];$=B.slice()}for(var z=s(16),j,U=0;U<4;U++)j=this._Kd[F][U],z[4*U]=(h[$[U]>>24&255]^j>>24)&255,z[4*U+1]=(h[$[(U+3)%4]>>16&255]^j>>16)&255,z[4*U+2]=(h[$[(U+2)%4]>>8&255]^j>>8)&255,z[4*U+3]=(h[$[(U+1)%4]&255]^j)&255;return z};var S=function(N){if(!(this instanceof S))throw Error("AES must be instanitated with `new`");this.description="Electronic Code Block",this.name="ecb",this._aes=new E(N)};S.prototype.encrypt=function(N){if(N=r(N),N.length%16!==0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var F=s(N.length),B=s(16),$=0;$<N.length;$+=16)n(N,B,0,$,$+16),B=this._aes.encrypt(B),n(B,F,$);return F},S.prototype.decrypt=function(N){if(N=r(N),N.length%16!==0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var F=s(N.length),B=s(16),$=0;$<N.length;$+=16)n(N,B,0,$,$+16),B=this._aes.decrypt(B),n(B,F,$);return F};var M=function(N,F){if(!(this instanceof M))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Block Chaining",this.name="cbc",!F)F=s(16);else if(F.length!=16)throw new Error("invalid initialation vector size (must be 16 bytes)");this._lastCipherblock=r(F,!0),this._aes=new E(N)};M.prototype.encrypt=function(N){if(N=r(N),N.length%16!==0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var F=s(N.length),B=s(16),$=0;$<N.length;$+=16){n(N,B,0,$,$+16);for(var U=0;U<16;U++)B[U]^=this._lastCipherblock[U];this._lastCipherblock=this._aes.encrypt(B),n(this._lastCipherblock,F,$)}return F},M.prototype.decrypt=function(N){if(N=r(N),N.length%16!==0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var F=s(N.length),B=s(16),$=0;$<N.length;$+=16){n(N,B,0,$,$+16),B=this._aes.decrypt(B);for(var U=0;U<16;U++)F[$+U]=B[U]^this._lastCipherblock[U];n(N,this._lastCipherblock,0,$,$+16)}return F};var I=function(N,F,B){if(!(this instanceof I))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Feedback",this.name="cfb",!F)F=s(16);else if(F.length!=16)throw new Error("invalid initialation vector size (must be 16 size)");B||(B=1),this.segmentSize=B,this._shiftRegister=r(F,!0),this._aes=new E(N)};I.prototype.encrypt=function(N){if(N.length%this.segmentSize!=0)throw new Error("invalid plaintext size (must be segmentSize bytes)");for(var F=r(N,!0),B,$=0;$<F.length;$+=this.segmentSize){B=this._aes.encrypt(this._shiftRegister);for(var U=0;U<this.segmentSize;U++)F[$+U]^=B[U];n(this._shiftRegister,this._shiftRegister,0,this.segmentSize),n(F,this._shiftRegister,16-this.segmentSize,$,$+this.segmentSize)}return F},I.prototype.decrypt=function(N){if(N.length%this.segmentSize!=0)throw new Error("invalid ciphertext size (must be segmentSize bytes)");for(var F=r(N,!0),B,$=0;$<F.length;$+=this.segmentSize){B=this._aes.encrypt(this._shiftRegister);for(var U=0;U<this.segmentSize;U++)F[$+U]^=B[U];n(this._shiftRegister,this._shiftRegister,0,this.segmentSize),n(N,this._shiftRegister,16-this.segmentSize,$,$+this.segmentSize)}return F};var T=function(N,F){if(!(this instanceof T))throw Error("AES must be instanitated with `new`");if(this.description="Output Feedback",this.name="ofb",!F)F=s(16);else if(F.length!=16)throw new Error("invalid initialation vector size (must be 16 bytes)");this._lastPrecipher=r(F,!0),this._lastPrecipherIndex=16,this._aes=new E(N)};T.prototype.encrypt=function(N){for(var F=r(N,!0),B=0;B<F.length;B++)this._lastPrecipherIndex===16&&(this._lastPrecipher=this._aes.encrypt(this._lastPrecipher),this._lastPrecipherIndex=0),F[B]^=this._lastPrecipher[this._lastPrecipherIndex++];return F},T.prototype.decrypt=T.prototype.encrypt;var C=function(N){if(!(this instanceof C))throw Error("Counter must be instanitated with `new`");N!==0&&!N&&(N=1),typeof N=="number"?(this._counter=s(16),this.setValue(N)):this.setBytes(N)};C.prototype.setValue=function(N){if(typeof N!="number"||parseInt(N)!=N)throw new Error("invalid counter value (must be an integer)");if(N>Number.MAX_SAFE_INTEGER)throw new Error("integer value out of safe range");for(var F=15;F>=0;--F)this._counter[F]=N%256,N=parseInt(N/256)},C.prototype.setBytes=function(N){if(N=r(N,!0),N.length!=16)throw new Error("invalid counter bytes size (must be 16 bytes)");this._counter=N},C.prototype.increment=function(){for(var N=15;N>=0;N--)if(this._counter[N]===255)this._counter[N]=0;else{this._counter[N]++;break}};var P=function(N,F){if(!(this instanceof P))throw Error("AES must be instanitated with `new`");this.description="Counter",this.name="ctr",F instanceof C||(F=new C(F)),this._counter=F,this._remainingCounter=null,this._remainingCounterIndex=16,this._aes=new E(N)};P.prototype.encrypt=function(N){for(var F=r(N,!0),B=0;B<F.length;B++)this._remainingCounterIndex===16&&(this._remainingCounter=this._aes.encrypt(this._counter._counter),this._remainingCounterIndex=0,this._counter.increment()),F[B]^=this._remainingCounter[this._remainingCounterIndex++];return F},P.prototype.decrypt=P.prototype.encrypt;function D(N){N=r(N,!0);var F=16-N.length%16,B=s(N.length+F);n(N,B);for(var $=N.length;$<B.length;$++)B[$]=F;return B}function O(N){if(N=r(N,!0),N.length<16)throw new Error("PKCS#7 invalid length");var F=N[N.length-1];if(F>16)throw new Error("PKCS#7 padding byte out of range");for(var B=N.length-F,$=0;$<F;$++)if(N[B+$]!==F)throw new Error("PKCS#7 invalid padding byte");var U=s(B);return n(N,U,0,0,B),U}var R={AES:E,Counter:C,ModeOfOperation:{ecb:S,cbc:M,cfb:I,ofb:T,ctr:P},utils:{hex:a,utf8:o},padding:{pkcs7:{pad:D,strip:O}},_arrayTest:{coerceArray:r,createArray:s,copyArray:n}};typeof l7!="undefined"?wy.exports=R:typeof define=="function"&&define.amd?define([],function(){return R}):(i.aesjs&&(R._aesjs=i.aesjs),i.aesjs=R)})(l7)});var b3=ze(_3=>{_3.remove=FI;var v3=[{base:" ",chars:"\xA0"},{base:"0",chars:"\u07C0"},{base:"A",chars:"\u24B6\uFF21\xC0\xC1\xC2\u1EA6\u1EA4\u1EAA\u1EA8\xC3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\xC4\u01DE\u1EA2\xC5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F"},{base:"AA",chars:"\uA732"},{base:"AE",chars:"\xC6\u01FC\u01E2"},{base:"AO",chars:"\uA734"},{base:"AU",chars:"\uA736"},{base:"AV",chars:"\uA738\uA73A"},{base:"AY",chars:"\uA73C"},{base:"B",chars:"\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0181"},{base:"C",chars:"\u24B8\uFF23\uA73E\u1E08\u0106C\u0108\u010A\u010C\xC7\u0187\u023B"},{base:"D",chars:"\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018A\u0189\u1D05\uA779"},{base:"Dh",chars:"\xD0"},{base:"DZ",chars:"\u01F1\u01C4"},{base:"Dz",chars:"\u01F2\u01C5"},{base:"E",chars:"\u025B\u24BA\uFF25\xC8\xC9\xCA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\xCB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E\u1D07"},{base:"F",chars:"\uA77C\u24BB\uFF26\u1E1E\u0191\uA77B"},{base:"G",chars:"\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E\u0262"},{base:"H",chars:"\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D"},{base:"I",chars:"\u24BE\uFF29\xCC\xCD\xCE\u0128\u012A\u012C\u0130\xCF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197"},{base:"J",chars:"\u24BF\uFF2A\u0134\u0248\u0237"},{base:"K",chars:"\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2"},{base:"L",chars:"\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780"},{base:"LJ",chars:"\u01C7"},{base:"Lj",chars:"\u01C8"},{base:"M",chars:"\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C\u03FB"},{base:"N",chars:"\uA7A4\u0220\u24C3\uFF2E\u01F8\u0143\xD1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u019D\uA790\u1D0E"},{base:"NJ",chars:"\u01CA"},{base:"Nj",chars:"\u01CB"},{base:"O",chars:"\u24C4\uFF2F\xD2\xD3\xD4\u1ED2\u1ED0\u1ED6\u1ED4\xD5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\xD6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\xD8\u01FE\u0186\u019F\uA74A\uA74C"},{base:"OE",chars:"\u0152"},{base:"OI",chars:"\u01A2"},{base:"OO",chars:"\uA74E"},{base:"OU",chars:"\u0222"},{base:"P",chars:"\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754"},{base:"Q",chars:"\u24C6\uFF31\uA756\uA758\u024A"},{base:"R",chars:"\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782"},{base:"S",chars:"\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784"},{base:"T",chars:"\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786"},{base:"Th",chars:"\xDE"},{base:"TZ",chars:"\uA728"},{base:"U",chars:"\u24CA\uFF35\xD9\xDA\xDB\u0168\u1E78\u016A\u1E7A\u016C\xDC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244"},{base:"V",chars:"\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245"},{base:"VY",chars:"\uA760"},{base:"W",chars:"\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72"},{base:"X",chars:"\u24CD\uFF38\u1E8A\u1E8C"},{base:"Y",chars:"\u24CE\uFF39\u1EF2\xDD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE"},{base:"Z",chars:"\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762"},{base:"a",chars:"\u24D0\uFF41\u1E9A\xE0\xE1\xE2\u1EA7\u1EA5\u1EAB\u1EA9\xE3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\xE4\u01DF\u1EA3\xE5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250\u0251"},{base:"aa",chars:"\uA733"},{base:"ae",chars:"\xE6\u01FD\u01E3"},{base:"ao",chars:"\uA735"},{base:"au",chars:"\uA737"},{base:"av",chars:"\uA739\uA73B"},{base:"ay",chars:"\uA73D"},{base:"b",chars:"\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253\u0182"},{base:"c",chars:"\uFF43\u24D2\u0107\u0109\u010B\u010D\xE7\u1E09\u0188\u023C\uA73F\u2184"},{base:"d",chars:"\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\u018B\u13E7\u0501\uA7AA"},{base:"dh",chars:"\xF0"},{base:"dz",chars:"\u01F3\u01C6"},{base:"e",chars:"\u24D4\uFF45\xE8\xE9\xEA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\xEB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u01DD"},{base:"f",chars:"\u24D5\uFF46\u1E1F\u0192"},{base:"ff",chars:"\uFB00"},{base:"fi",chars:"\uFB01"},{base:"fl",chars:"\uFB02"},{base:"ffi",chars:"\uFB03"},{base:"ffl",chars:"\uFB04"},{base:"g",chars:"\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\uA77F\u1D79"},{base:"h",chars:"\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265"},{base:"hv",chars:"\u0195"},{base:"i",chars:"\u24D8\uFF49\xEC\xED\xEE\u0129\u012B\u012D\xEF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131"},{base:"j",chars:"\u24D9\uFF4A\u0135\u01F0\u0249"},{base:"k",chars:"\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3"},{base:"l",chars:"\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747\u026D"},{base:"lj",chars:"\u01C9"},{base:"m",chars:"\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F"},{base:"n",chars:"\u24DD\uFF4E\u01F9\u0144\xF1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5\u043B\u0509"},{base:"nj",chars:"\u01CC"},{base:"o",chars:"\u24DE\uFF4F\xF2\xF3\xF4\u1ED3\u1ED1\u1ED7\u1ED5\xF5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\xF6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\xF8\u01FF\uA74B\uA74D\u0275\u0254\u1D11"},{base:"oe",chars:"\u0153"},{base:"oi",chars:"\u01A3"},{base:"oo",chars:"\uA74F"},{base:"ou",chars:"\u0223"},{base:"p",chars:"\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755\u03C1"},{base:"q",chars:"\u24E0\uFF51\u024B\uA757\uA759"},{base:"r",chars:"\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783"},{base:"s",chars:"\u24E2\uFF53\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B\u0282"},{base:"ss",chars:"\xDF"},{base:"t",chars:"\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787"},{base:"th",chars:"\xFE"},{base:"tz",chars:"\uA729"},{base:"u",chars:"\u24E4\uFF55\xF9\xFA\xFB\u0169\u1E79\u016B\u1E7B\u016D\xFC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289"},{base:"v",chars:"\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C"},{base:"vy",chars:"\uA761"},{base:"w",chars:"\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73"},{base:"x",chars:"\u24E7\uFF58\u1E8B\u1E8D"},{base:"y",chars:"\u24E8\uFF59\u1EF3\xFD\u0177\u1EF9\u0233\u1E8F\xFF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF"},{base:"z",chars:"\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763"}],u7={};for(f0=0;f0<v3.length;f0+=1)for(c7=v3[f0].chars,x3=0;x3<c7.length;x3+=1)u7[c7[x3]]=v3[f0].base;var c7,x3,f0;function FI(i){return i.replace(/[^\u0000-\u007e]/g,function(e){return u7[e]||e})}_3.replacementList=v3;_3.diacriticsMap=u7});var f1=ze((oee,a_)=>{"use strict";a_.exports=function i(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,s,n;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(s=r;s--!==0;)if(!i(e[s],t[s]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(n=Object.keys(e),r=n.length,r!==Object.keys(t).length)return!1;for(s=r;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,n[s]))return!1;for(s=r;s--!==0;){var o=n[s];if(!i(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}});var Zr=ze((a9,l9)=>{(function(i,e){typeof a9=="object"&&typeof l9!="undefined"?l9.exports=e():typeof define=="function"&&define.amd?define(e):(i=i||self).RBush=e()})(a9,function(){"use strict";function i(g,y,x,b,_){(function w(A,k,v,E,S){for(;E>v;){if(E-v>600){var M=E-v+1,I=k-v+1,T=Math.log(M),C=.5*Math.exp(2*T/3),P=.5*Math.sqrt(T*C*(M-C)/M)*(I-M/2<0?-1:1),D=Math.max(v,Math.floor(k-I*C/M+P)),O=Math.min(E,Math.floor(k+(M-I)*C/M+P));w(A,k,D,O,S)}var R=A[k],N=v,F=E;for(e(A,v,k),S(A[E],R)>0&&e(A,v,E);N<F;){for(e(A,N,F),N++,F--;S(A[N],R)<0;)N++;for(;S(A[F],R)>0;)F--}S(A[v],R)===0?e(A,v,F):e(A,++F,E),F<=k&&(v=F+1),k<=F&&(E=F-1)}})(g,y,x||0,b||g.length-1,_||t)}function e(g,y,x){var b=g[y];g[y]=g[x],g[x]=b}function t(g,y){return g<y?-1:g>y?1:0}var r=function(g){g===void 0&&(g=9),this._maxEntries=Math.max(4,g),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(g,y,x){if(!x)return y.indexOf(g);for(var b=0;b<y.length;b++)if(x(g,y[b]))return b;return-1}function n(g,y){o(g,0,g.children.length,y,g)}function o(g,y,x,b,_){_||(_=p(null)),_.minX=1/0,_.minY=1/0,_.maxX=-1/0,_.maxY=-1/0;for(var w=y;w<x;w++){var A=g.children[w];a(_,g.leaf?b(A):A)}return _}function a(g,y){return g.minX=Math.min(g.minX,y.minX),g.minY=Math.min(g.minY,y.minY),g.maxX=Math.max(g.maxX,y.maxX),g.maxY=Math.max(g.maxY,y.maxY),g}function l(g,y){return g.minX-y.minX}function c(g,y){return g.minY-y.minY}function u(g){return(g.maxX-g.minX)*(g.maxY-g.minY)}function h(g){return g.maxX-g.minX+(g.maxY-g.minY)}function d(g,y){return g.minX<=y.minX&&g.minY<=y.minY&&y.maxX<=g.maxX&&y.maxY<=g.maxY}function f(g,y){return y.minX<=g.maxX&&y.minY<=g.maxY&&y.maxX>=g.minX&&y.maxY>=g.minY}function p(g){return{children:g,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(g,y,x,b,_){for(var w=[y,x];w.length;)if(!((x=w.pop())-(y=w.pop())<=b)){var A=y+Math.ceil((x-y)/b/2)*b;i(g,A,y,x,_),w.push(y,A,A,x)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(g){var y=this.data,x=[];if(!f(g,y))return x;for(var b=this.toBBox,_=[];y;){for(var w=0;w<y.children.length;w++){var A=y.children[w],k=y.leaf?b(A):A;f(g,k)&&(y.leaf?x.push(A):d(g,k)?this._all(A,x):_.push(A))}y=_.pop()}return x},r.prototype.collides=function(g){var y=this.data;if(!f(g,y))return!1;for(var x=[];y;){for(var b=0;b<y.children.length;b++){var _=y.children[b],w=y.leaf?this.toBBox(_):_;if(f(g,w)){if(y.leaf||d(g,w))return!0;x.push(_)}}y=x.pop()}return!1},r.prototype.load=function(g){if(!g||!g.length)return this;if(g.length<this._minEntries){for(var y=0;y<g.length;y++)this.insert(g[y]);return this}var x=this._build(g.slice(),0,g.length-1,0);if(this.data.children.length)if(this.data.height===x.height)this._splitRoot(this.data,x);else{if(this.data.height<x.height){var b=this.data;this.data=x,x=b}this._insert(x,this.data.height-x.height-1,!0)}else this.data=x;return this},r.prototype.insert=function(g){return g&&this._insert(g,this.data.height-1),this},r.prototype.clear=function(){return this.data=p([]),this},r.prototype.remove=function(g,y){if(!g)return this;for(var x,b,_,w=this.data,A=this.toBBox(g),k=[],v=[];w||k.length;){if(w||(w=k.pop(),b=k[k.length-1],x=v.pop(),_=!0),w.leaf){var E=s(g,w.children,y);if(E!==-1)return w.children.splice(E,1),k.push(w),this._condense(k),this}_||w.leaf||!d(w,A)?b?(x++,w=b.children[x],_=!1):w=null:(k.push(w),v.push(x),x=0,b=w,w=w.children[0])}return this},r.prototype.toBBox=function(g){return g},r.prototype.compareMinX=function(g,y){return g.minX-y.minX},r.prototype.compareMinY=function(g,y){return g.minY-y.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(g){return this.data=g,this},r.prototype._all=function(g,y){for(var x=[];g;)g.leaf?y.push.apply(y,g.children):x.push.apply(x,g.children),g=x.pop();return y},r.prototype._build=function(g,y,x,b){var _,w=x-y+1,A=this._maxEntries;if(w<=A)return n(_=p(g.slice(y,x+1)),this.toBBox),_;b||(b=Math.ceil(Math.log(w)/Math.log(A)),A=Math.ceil(w/Math.pow(A,b-1))),(_=p([])).leaf=!1,_.height=b;var k=Math.ceil(w/A),v=k*Math.ceil(Math.sqrt(A));m(g,y,x,v,this.compareMinX);for(var E=y;E<=x;E+=v){var S=Math.min(E+v-1,x);m(g,E,S,k,this.compareMinY);for(var M=E;M<=S;M+=k){var I=Math.min(M+k-1,S);_.children.push(this._build(g,M,I,b-1))}}return n(_,this.toBBox),_},r.prototype._chooseSubtree=function(g,y,x,b){for(;b.push(y),!y.leaf&&b.length-1!==x;){for(var _=1/0,w=1/0,A=void 0,k=0;k<y.children.length;k++){var v=y.children[k],E=u(v),S=(M=g,I=v,(Math.max(I.maxX,M.maxX)-Math.min(I.minX,M.minX))*(Math.max(I.maxY,M.maxY)-Math.min(I.minY,M.minY))-E);S<w?(w=S,_=E<_?E:_,A=v):S===w&&E<_&&(_=E,A=v)}y=A||y.children[0]}var M,I;return y},r.prototype._insert=function(g,y,x){var b=x?g:this.toBBox(g),_=[],w=this._chooseSubtree(b,this.data,y,_);for(w.children.push(g),a(w,b);y>=0&&_[y].children.length>this._maxEntries;)this._split(_,y),y--;this._adjustParentBBoxes(b,_,y)},r.prototype._split=function(g,y){var x=g[y],b=x.children.length,_=this._minEntries;this._chooseSplitAxis(x,_,b);var w=this._chooseSplitIndex(x,_,b),A=p(x.children.splice(w,x.children.length-w));A.height=x.height,A.leaf=x.leaf,n(x,this.toBBox),n(A,this.toBBox),y?g[y-1].children.push(A):this._splitRoot(x,A)},r.prototype._splitRoot=function(g,y){this.data=p([g,y]),this.data.height=g.height+1,this.data.leaf=!1,n(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(g,y,x){for(var b,_,w,A,k,v,E,S=1/0,M=1/0,I=y;I<=x-y;I++){var T=o(g,0,I,this.toBBox),C=o(g,I,x,this.toBBox),P=(_=T,w=C,A=void 0,k=void 0,v=void 0,E=void 0,A=Math.max(_.minX,w.minX),k=Math.max(_.minY,w.minY),v=Math.min(_.maxX,w.maxX),E=Math.min(_.maxY,w.maxY),Math.max(0,v-A)*Math.max(0,E-k)),D=u(T)+u(C);P<S?(S=P,b=I,M=D<M?D:M):P===S&&D<M&&(M=D,b=I)}return b||x-y},r.prototype._chooseSplitAxis=function(g,y,x){var b=g.leaf?this.compareMinX:l,_=g.leaf?this.compareMinY:c;this._allDistMargin(g,y,x,b)<this._allDistMargin(g,y,x,_)&&g.children.sort(b)},r.prototype._allDistMargin=function(g,y,x,b){g.children.sort(b);for(var _=this.toBBox,w=o(g,0,y,_),A=o(g,x-y,x,_),k=h(w)+h(A),v=y;v<x-y;v++){var E=g.children[v];a(w,g.leaf?_(E):E),k+=h(w)}for(var S=x-y-1;S>=y;S--){var M=g.children[S];a(A,g.leaf?_(M):M),k+=h(A)}return k},r.prototype._adjustParentBBoxes=function(g,y,x){for(var b=x;b>=0;b--)a(y[b],g)},r.prototype._condense=function(g){for(var y=g.length-1,x=void 0;y>=0;y--)g[y].children.length===0?y>0?(x=g[y-1].children).splice(x.indexOf(g[y]),1):this.clear():n(g[y],this.toBBox)},r})});var P_=ze((vre,p9)=>{"use strict";var LD=Object.prototype.hasOwnProperty,_r="~";function l2(){}Object.create&&(l2.prototype=Object.create(null),new l2().__proto__||(_r=!1));function OD(i,e,t){this.fn=i,this.context=e,this.once=t||!1}function M_(i,e,t,r,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var n=new OD(t,r||i,s),o=_r?_r+e:e;return i._events[o]?i._events[o].fn?i._events[o]=[i._events[o],n]:i._events[o].push(n):(i._events[o]=n,i._eventsCount++),i}function W5(i,e){--i._eventsCount===0?i._events=new l2:delete i._events[e]}function tr(){this._events=new l2,this._eventsCount=0}tr.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)LD.call(t,r)&&e.push(_r?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};tr.prototype.listeners=function(e){var t=_r?_r+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,n=r.length,o=new Array(n);s<n;s++)o[s]=r[s].fn;return o};tr.prototype.listenerCount=function(e){var t=_r?_r+e:e,r=this._events[t];return r?r.fn?1:r.length:0};tr.prototype.emit=function(e,t,r,s,n,o){var a=_r?_r+e:e;if(!this._events[a])return!1;var l=this._events[a],c=arguments.length,u,h;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,s),!0;case 5:return l.fn.call(l.context,t,r,s,n),!0;case 6:return l.fn.call(l.context,t,r,s,n,o),!0}for(h=1,u=new Array(c-1);h<c;h++)u[h-1]=arguments[h];l.fn.apply(l.context,u)}else{var d=l.length,f;for(h=0;h<d;h++)switch(l[h].once&&this.removeListener(e,l[h].fn,void 0,!0),c){case 1:l[h].fn.call(l[h].context);break;case 2:l[h].fn.call(l[h].context,t);break;case 3:l[h].fn.call(l[h].context,t,r);break;case 4:l[h].fn.call(l[h].context,t,r,s);break;default:if(!u)for(f=1,u=new Array(c-1);f<c;f++)u[f-1]=arguments[f];l[h].fn.apply(l[h].context,u)}}return!0};tr.prototype.on=function(e,t,r){return M_(this,e,t,r,!1)};tr.prototype.once=function(e,t,r){return M_(this,e,t,r,!0)};tr.prototype.removeListener=function(e,t,r,s){var n=_r?_r+e:e;if(!this._events[n])return this;if(!t)return W5(this,n),this;var o=this._events[n];if(o.fn)o.fn===t&&(!s||o.once)&&(!r||o.context===r)&&W5(this,n);else{for(var a=0,l=[],c=o.length;a<c;a++)(o[a].fn!==t||s&&!o[a].once||r&&o[a].context!==r)&&l.push(o[a]);l.length?this._events[n]=l.length===1?l[0]:l:W5(this,n)}return this};tr.prototype.removeAllListeners=function(e){var t;return e?(t=_r?_r+e:e,this._events[t]&&W5(this,t)):(this._events=new l2,this._eventsCount=0),this};tr.prototype.off=tr.prototype.removeListener;tr.prototype.addListener=tr.prototype.on;tr.prefixed=_r;tr.EventEmitter=tr;typeof p9!="undefined"&&(p9.exports=tr)});var L_=ze((_re,x9)=>{"use strict";x9.exports=Q5;x9.exports.default=Q5;function Q5(i,e,t){t=t||2;var r=e&&e.length,s=r?e[0]*t:i.length,n=R_(i,0,s,t,!0),o=[];if(!n||n.next===n.prev)return o;var a,l,c,u,h,d,f;if(r&&(n=GD(i,e,n,t)),i.length>80*t){a=c=i[0],l=u=i[1];for(var p=t;p<s;p+=t)h=i[p],d=i[p+1],h<a&&(a=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);f=Math.max(c-a,u-l),f=f!==0?32767/f:0}return c2(n,o,t,a,l,f,0),o}function R_(i,e,t,r,s){var n,o;if(s===y9(i,e,t,r)>0)for(n=e;n<t;n+=r)o=D_(n,i[n],i[n+1],o);else for(n=t-r;n>=e;n-=r)o=D_(n,i[n],i[n+1],o);return o&&Y5(o,o.next)&&(h2(o),o=o.next),o}function za(i,e){if(!i)return i;e||(e=i);var t=i,r;do if(r=!1,!t.steiner&&(Y5(t,t.next)||ii(t.prev,t,t.next)===0)){if(h2(t),t=e=t.prev,t===t.next)break;r=!0}else t=t.next;while(r||t!==e);return e}function c2(i,e,t,r,s,n,o){if(i){!o&&n&&XD(i,r,s,n);for(var a=i,l,c;i.prev!==i.next;){if(l=i.prev,c=i.next,n?UD(i,r,s,n):BD(i)){e.push(l.i/t|0),e.push(i.i/t|0),e.push(c.i/t|0),h2(i),i=c.next,a=c.next;continue}if(i=c,i===a){o?o===1?(i=$D(za(i),e,t),c2(i,e,t,r,s,n,2)):o===2&&HD(i,e,t,r,s,n):c2(za(i),e,t,r,s,n,1);break}}}}function BD(i){var e=i.prev,t=i,r=i.next;if(ii(e,t,r)>=0)return!1;for(var s=e.x,n=t.x,o=r.x,a=e.y,l=t.y,c=r.y,u=s<n?s<o?s:o:n<o?n:o,h=a<l?a<c?a:c:l<c?l:c,d=s>n?s>o?s:o:n>o?n:o,f=a>l?a>c?a:c:l>c?l:c,p=r.next;p!==e;){if(p.x>=u&&p.x<=d&&p.y>=h&&p.y<=f&&E1(s,a,n,l,o,c,p.x,p.y)&&ii(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function UD(i,e,t,r){var s=i.prev,n=i,o=i.next;if(ii(s,n,o)>=0)return!1;for(var a=s.x,l=n.x,c=o.x,u=s.y,h=n.y,d=o.y,f=a<l?a<c?a:c:l<c?l:c,p=u<h?u<d?u:d:h<d?h:d,m=a>l?a>c?a:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,y=m9(f,p,e,t,r),x=m9(m,g,e,t,r),b=i.prevZ,_=i.nextZ;b&&b.z>=y&&_&&_.z<=x;){if(b.x>=f&&b.x<=m&&b.y>=p&&b.y<=g&&b!==s&&b!==o&&E1(a,u,l,h,c,d,b.x,b.y)&&ii(b.prev,b,b.next)>=0||(b=b.prevZ,_.x>=f&&_.x<=m&&_.y>=p&&_.y<=g&&_!==s&&_!==o&&E1(a,u,l,h,c,d,_.x,_.y)&&ii(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;b&&b.z>=y;){if(b.x>=f&&b.x<=m&&b.y>=p&&b.y<=g&&b!==s&&b!==o&&E1(a,u,l,h,c,d,b.x,b.y)&&ii(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;_&&_.z<=x;){if(_.x>=f&&_.x<=m&&_.y>=p&&_.y<=g&&_!==s&&_!==o&&E1(a,u,l,h,c,d,_.x,_.y)&&ii(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function $D(i,e,t){var r=i;do{var s=r.prev,n=r.next.next;!Y5(s,n)&&N_(s,r,r.next,n)&&u2(s,n)&&u2(n,s)&&(e.push(s.i/t|0),e.push(r.i/t|0),e.push(n.i/t|0),h2(r),h2(r.next),r=i=n),r=r.next}while(r!==i);return za(r)}function HD(i,e,t,r,s,n){var o=i;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&YD(o,a)){var l=F_(o,a);o=za(o,o.next),l=za(l,l.next),c2(o,e,t,r,s,n,0),c2(l,e,t,r,s,n,0);return}a=a.next}o=o.next}while(o!==i)}function GD(i,e,t,r){var s=[],n,o,a,l,c;for(n=0,o=e.length;n<o;n++)a=e[n]*r,l=n<o-1?e[n+1]*r:i.length,c=R_(i,a,l,r,!1),c===c.next&&(c.steiner=!0),s.push(QD(c));for(s.sort(zD),n=0;n<s.length;n++)t=jD(s[n],t);return t}function zD(i,e){return i.x-e.x}function jD(i,e){var t=VD(i,e);if(!t)return e;var r=F_(t,i);return za(r,r.next),za(t,t.next)}function VD(i,e){var t=e,r=i.x,s=i.y,n=-1/0,o;do{if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){var a=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(a<=r&&a>n&&(n=a,o=t.x<t.next.x?t:t.next,a===r))return o}t=t.next}while(t!==e);if(!o)return null;var l=o,c=o.x,u=o.y,h=1/0,d;t=o;do r>=t.x&&t.x>=c&&r!==t.x&&E1(s<u?r:n,s,c,u,s<u?n:r,s,t.x,t.y)&&(d=Math.abs(s-t.y)/(r-t.x),u2(t,i)&&(d<h||d===h&&(t.x>o.x||t.x===o.x&&WD(o,t)))&&(o=t,h=d)),t=t.next;while(t!==l);return o}function WD(i,e){return ii(i.prev,i,e.prev)<0&&ii(e.next,i,i.next)<0}function XD(i,e,t,r){var s=i;do s.z===0&&(s.z=m9(s.x,s.y,e,t,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i);s.prevZ.nextZ=null,s.prevZ=null,qD(s)}function qD(i){var e,t,r,s,n,o,a,l,c=1;do{for(t=i,i=null,n=null,o=0;t;){for(o++,r=t,a=0,e=0;e<c&&(a++,r=r.nextZ,!!r);e++);for(l=c;a>0||l>0&&r;)a!==0&&(l===0||!r||t.z<=r.z)?(s=t,t=t.nextZ,a--):(s=r,r=r.nextZ,l--),n?n.nextZ=s:i=s,s.prevZ=n,n=s;t=r}n.nextZ=null,c*=2}while(o>1);return i}function m9(i,e,t,r,s){return i=(i-t)*s|0,e=(e-r)*s|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function QD(i){var e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function E1(i,e,t,r,s,n,o,a){return(s-o)*(e-a)>=(i-o)*(n-a)&&(i-o)*(r-a)>=(t-o)*(e-a)&&(t-o)*(n-a)>=(s-o)*(r-a)}function YD(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!KD(i,e)&&(u2(i,e)&&u2(e,i)&&ZD(i,e)&&(ii(i.prev,i,e.prev)||ii(i,e.prev,e))||Y5(i,e)&&ii(i.prev,i,i.next)>0&&ii(e.prev,e,e.next)>0)}function ii(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function Y5(i,e){return i.x===e.x&&i.y===e.y}function N_(i,e,t,r){var s=q5(ii(i,e,t)),n=q5(ii(i,e,r)),o=q5(ii(t,r,i)),a=q5(ii(t,r,e));return!!(s!==n&&o!==a||s===0&&X5(i,t,e)||n===0&&X5(i,r,e)||o===0&&X5(t,i,r)||a===0&&X5(t,e,r))}function X5(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function q5(i){return i>0?1:i<0?-1:0}function KD(i,e){var t=i;do{if(t.i!==i.i&&t.next.i!==i.i&&t.i!==e.i&&t.next.i!==e.i&&N_(t,t.next,i,e))return!0;t=t.next}while(t!==i);return!1}function u2(i,e){return ii(i.prev,i,i.next)<0?ii(i,e,i.next)>=0&&ii(i,i.prev,e)>=0:ii(i,e,i.prev)<0||ii(i,i.next,e)<0}function ZD(i,e){var t=i,r=!1,s=(i.x+e.x)/2,n=(i.y+e.y)/2;do t.y>n!=t.next.y>n&&t.next.y!==t.y&&s<(t.next.x-t.x)*(n-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next;while(t!==i);return r}function F_(i,e){var t=new g9(i.i,i.x,i.y),r=new g9(e.i,e.x,e.y),s=i.next,n=e.prev;return i.next=e,e.prev=i,t.next=s,s.prev=t,r.next=t,t.prev=r,n.next=r,r.prev=n,r}function D_(i,e,t,r){var s=new g9(i,e,t);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function h2(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function g9(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Q5.deviation=function(i,e,t,r){var s=e&&e.length,n=s?e[0]*t:i.length,o=Math.abs(y9(i,0,n,t));if(s)for(var a=0,l=e.length;a<l;a++){var c=e[a]*t,u=a<l-1?e[a+1]*t:i.length;o-=Math.abs(y9(i,c,u,t))}var h=0;for(a=0;a<r.length;a+=3){var d=r[a]*t,f=r[a+1]*t,p=r[a+2]*t;h+=Math.abs((i[d]-i[p])*(i[f+1]-i[d+1])-(i[d]-i[f])*(i[p+1]-i[d+1]))}return o===0&&h===0?0:Math.abs((h-o)/o)};function y9(i,e,t,r){for(var s=0,n=e,o=t-r;n<t;n+=r)s+=(i[o]-i[n])*(i[n+1]+i[o+1]),o=n;return s}Q5.flatten=function(i){for(var e=i[0][0].length,t={vertices:[],holes:[],dimensions:e},r=0,s=0;s<i.length;s++){for(var n=0;n<i[s].length;n++)for(var o=0;o<e;o++)t.vertices.push(i[s][n][o]);s>0&&(r+=i[s-1].length,t.holes.push(r))}return t}});var O_=ze((A1,S1)=>{(function(i){var e=typeof A1=="object"&&A1&&!A1.nodeType&&A1,t=typeof S1=="object"&&S1&&!S1.nodeType&&S1,r=typeof global=="object"&&global;(r.global===r||r.window===r||r.self===r)&&(i=r);var s,n=2147483647,o=36,a=1,l=26,c=38,u=700,h=72,d=128,f="-",p=/^xn--/,m=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,y={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=o-a,b=Math.floor,_=String.fromCharCode,w;function A(R){throw new RangeError(y[R])}function k(R,N){for(var F=R.length,B=[];F--;)B[F]=N(R[F]);return B}function v(R,N){var F=R.split("@"),B="";F.length>1&&(B=F[0]+"@",R=F[1]),R=R.replace(g,".");var $=R.split("."),U=k($,N).join(".");return B+U}function E(R){for(var N=[],F=0,B=R.length,$,U;F<B;)$=R.charCodeAt(F++),$>=55296&&$<=56319&&F<B?(U=R.charCodeAt(F++),(U&64512)==56320?N.push((($&1023)<<10)+(U&1023)+65536):(N.push($),F--)):N.push($);return N}function S(R){return k(R,function(N){var F="";return N>65535&&(N-=65536,F+=_(N>>>10&1023|55296),N=56320|N&1023),F+=_(N),F}).join("")}function M(R){return R-48<10?R-22:R-65<26?R-65:R-97<26?R-97:o}function I(R,N){return R+22+75*(R<26)-((N!=0)<<5)}function T(R,N,F){var B=0;for(R=F?b(R/u):R>>1,R+=b(R/N);R>x*l>>1;B+=o)R=b(R/x);return b(B+(x+1)*R/(R+c))}function C(R){var N=[],F=R.length,B,$=0,U=d,H=h,z,j,X,K,Y,oe,re,W,Z;for(z=R.lastIndexOf(f),z<0&&(z=0),j=0;j<z;++j)R.charCodeAt(j)>=128&&A("not-basic"),N.push(R.charCodeAt(j));for(X=z>0?z+1:0;X<F;){for(K=$,Y=1,oe=o;X>=F&&A("invalid-input"),re=M(R.charCodeAt(X++)),(re>=o||re>b((n-$)/Y))&&A("overflow"),$+=re*Y,W=oe<=H?a:oe>=H+l?l:oe-H,!(re<W);oe+=o)Z=o-W,Y>b(n/Z)&&A("overflow"),Y*=Z;B=N.length+1,H=T($-K,B,K==0),b($/B)>n-U&&A("overflow"),U+=b($/B),$%=B,N.splice($++,0,U)}return S(N)}function P(R){var N,F,B,$,U,H,z,j,X,K,Y,oe=[],re,W,Z,Q;for(R=E(R),re=R.length,N=d,F=0,U=h,H=0;H<re;++H)Y=R[H],Y<128&&oe.push(_(Y));for(B=$=oe.length,$&&oe.push(f);B<re;){for(z=n,H=0;H<re;++H)Y=R[H],Y>=N&&Y<z&&(z=Y);for(W=B+1,z-N>b((n-F)/W)&&A("overflow"),F+=(z-N)*W,N=z,H=0;H<re;++H)if(Y=R[H],Y<N&&++F>n&&A("overflow"),Y==N){for(j=F,X=o;K=X<=U?a:X>=U+l?l:X-U,!(j<K);X+=o)Q=j-K,Z=o-K,oe.push(_(I(K+Q%Z,0))),j=b(Q/Z);oe.push(_(I(j,0))),U=T(F,W,B==$),F=0,++B}++F,++N}return oe.join("")}function D(R){return v(R,function(N){return p.test(N)?C(N.slice(4).toLowerCase()):N})}function O(R){return v(R,function(N){return m.test(N)?"xn--"+P(N):N})}if(s={version:"1.4.1",ucs2:{decode:E,encode:S},decode:C,encode:P,toASCII:O,toUnicode:D},typeof define=="function"&&typeof define.amd=="object"&&define.amd)define("punycode",function(){return s});else if(e&&t)if(S1.exports==e)t.exports=s;else for(w in s)s.hasOwnProperty(w)&&(e[w]=s[w]);else i.punycode=s})(A1)});var U_=ze((bre,B_)=>{"use strict";B_.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var s=42;e[t]=s;for(t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var n=Object.getOwnPropertySymbols(e);if(n.length!==1||n[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(e,t);if(o.value!==s||o.enumerable!==!0)return!1}return!0}});var G_=ze((wre,H_)=>{"use strict";var $_=typeof Symbol!="undefined"&&Symbol,JD=U_();H_.exports=function(){return typeof $_!="function"||typeof Symbol!="function"||typeof $_("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:JD()}});var V_=ze((Ere,j_)=>{"use strict";var eR="Function.prototype.bind called on incompatible ",tR=Object.prototype.toString,iR=Math.max,rR="[object Function]",z_=function(e,t){for(var r=[],s=0;s<e.length;s+=1)r[s]=e[s];for(var n=0;n<t.length;n+=1)r[n+e.length]=t[n];return r},sR=function(e,t){for(var r=[],s=t||0,n=0;s<e.length;s+=1,n+=1)r[n]=e[s];return r},nR=function(i,e){for(var t="",r=0;r<i.length;r+=1)t+=i[r],r+1<i.length&&(t+=e);return t};j_.exports=function(e){var t=this;if(typeof t!="function"||tR.apply(t)!==rR)throw new TypeError(eR+t);for(var r=sR(arguments,1),s,n=function(){if(this instanceof s){var u=t.apply(this,z_(r,arguments));return Object(u)===u?u:this}return t.apply(e,z_(r,arguments))},o=iR(0,t.length-r.length),a=[],l=0;l<o;l++)a[l]="$"+l;if(s=Function("binder","return function ("+nR(a,",")+"){ return binder.apply(this,arguments); }")(n),t.prototype){var c=function(){};c.prototype=t.prototype,s.prototype=new c,c.prototype=null}return s}});var K5=ze((Are,W_)=>{"use strict";var oR=V_();W_.exports=Function.prototype.bind||oR});var q_=ze((Sre,X_)=>{"use strict";var aR=K5();X_.exports=aR.call(Function.call,Object.prototype.hasOwnProperty)});var eh=ze((Cre,Z_)=>{"use strict";var gt,M1=SyntaxError,K_=Function,T1=TypeError,v9=function(i){try{return K_('"use strict"; return ('+i+").constructor;")()}catch(e){}},ja=Object.getOwnPropertyDescriptor;if(ja)try{ja({},"")}catch(i){ja=null}var _9=function(){throw new T1},lR=ja?function(){try{return arguments.callee,_9}catch(i){try{return ja(arguments,"callee").get}catch(e){return _9}}}():_9,C1=G_()(),qo=Object.getPrototypeOf||function(i){return i.__proto__},k1={},cR=typeof Uint8Array=="undefined"?gt:qo(Uint8Array),I1={"%AggregateError%":typeof AggregateError=="undefined"?gt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer=="undefined"?gt:ArrayBuffer,"%ArrayIteratorPrototype%":C1?qo([][Symbol.iterator]()):gt,"%AsyncFromSyncIteratorPrototype%":gt,"%AsyncFunction%":k1,"%AsyncGenerator%":k1,"%AsyncGeneratorFunction%":k1,"%AsyncIteratorPrototype%":k1,"%Atomics%":typeof Atomics=="undefined"?gt:Atomics,"%BigInt%":typeof BigInt=="undefined"?gt:BigInt,"%Boolean%":Boolean,"%DataView%":typeof DataView=="undefined"?gt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array=="undefined"?gt:Float32Array,"%Float64Array%":typeof Float64Array=="undefined"?gt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry=="undefined"?gt:FinalizationRegistry,"%Function%":K_,"%GeneratorFunction%":k1,"%Int8Array%":typeof Int8Array=="undefined"?gt:Int8Array,"%Int16Array%":typeof Int16Array=="undefined"?gt:Int16Array,"%Int32Array%":typeof Int32Array=="undefined"?gt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":C1?qo(qo([][Symbol.iterator]())):gt,"%JSON%":typeof JSON=="object"?JSON:gt,"%Map%":typeof Map=="undefined"?gt:Map,"%MapIteratorPrototype%":typeof Map=="undefined"||!C1?gt:qo(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise=="undefined"?gt:Promise,"%Proxy%":typeof Proxy=="undefined"?gt:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect=="undefined"?gt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set=="undefined"?gt:Set,"%SetIteratorPrototype%":typeof Set=="undefined"||!C1?gt:qo(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer=="undefined"?gt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":C1?qo(""[Symbol.iterator]()):gt,"%Symbol%":C1?Symbol:gt,"%SyntaxError%":M1,"%ThrowTypeError%":lR,"%TypedArray%":cR,"%TypeError%":T1,"%Uint8Array%":typeof Uint8Array=="undefined"?gt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray=="undefined"?gt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array=="undefined"?gt:Uint16Array,"%Uint32Array%":typeof Uint32Array=="undefined"?gt:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap=="undefined"?gt:WeakMap,"%WeakRef%":typeof WeakRef=="undefined"?gt:WeakRef,"%WeakSet%":typeof WeakSet=="undefined"?gt:WeakSet},uR=function i(e){var t;if(e==="%AsyncFunction%")t=v9("async function () {}");else if(e==="%GeneratorFunction%")t=v9("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=v9("async function* () {}");else if(e==="%AsyncGenerator%"){var r=i("%AsyncGeneratorFunction%");r&&(t=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var s=i("%AsyncGenerator%");s&&(t=qo(s.prototype))}return I1[e]=t,t},Q_={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},d2=K5(),Z5=q_(),hR=d2.call(Function.call,Array.prototype.concat),dR=d2.call(Function.apply,Array.prototype.splice),Y_=d2.call(Function.call,String.prototype.replace),J5=d2.call(Function.call,String.prototype.slice),fR=d2.call(Function.call,RegExp.prototype.exec),pR=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,mR=/\\(\\)?/g,gR=function(e){var t=J5(e,0,1),r=J5(e,-1);if(t==="%"&&r!=="%")throw new M1("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&t!=="%")throw new M1("invalid intrinsic syntax, expected opening `%`");var s=[];return Y_(e,pR,function(n,o,a,l){s[s.length]=a?Y_(l,mR,"$1"):o||n}),s},yR=function(e,t){var r=e,s;if(Z5(Q_,r)&&(s=Q_[r],r="%"+s[0]+"%"),Z5(I1,r)){var n=I1[r];if(n===k1&&(n=uR(r)),typeof n=="undefined"&&!t)throw new T1("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:s,name:r,value:n}}throw new M1("intrinsic "+e+" does not exist!")};Z_.exports=function(e,t){if(typeof e!="string"||e.length===0)throw new T1("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new T1('"allowMissing" argument must be a boolean');if(fR(/^%?[^%]*%?$/,e)===null)throw new M1("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=gR(e),s=r.length>0?r[0]:"",n=yR("%"+s+"%",t),o=n.name,a=n.value,l=!1,c=n.alias;c&&(s=c[0],dR(r,hR([0,1],c)));for(var u=1,h=!0;u<r.length;u+=1){var d=r[u],f=J5(d,0,1),p=J5(d,-1);if((f==='"'||f==="'"||f==="`"||p==='"'||p==="'"||p==="`")&&f!==p)throw new M1("property names with quotes must have matching quotes");if((d==="constructor"||!h)&&(l=!0),s+="."+d,o="%"+s+"%",Z5(I1,o))a=I1[o];else if(a!=null){if(!(d in a)){if(!t)throw new T1("base intrinsic for "+e+" exists, but the property is not available.");return}if(ja&&u+1>=r.length){var m=ja(a,d);h=!!m,h&&"get"in m&&!("originalValue"in m.get)?a=m.get:a=a[d]}else h=Z5(a,d),a=a[d];h&&!l&&(I1[o]=a)}}return a}});var sb=ze((kre,th)=>{"use strict";var b9=K5(),P1=eh(),tb=P1("%Function.prototype.apply%"),ib=P1("%Function.prototype.call%"),rb=P1("%Reflect.apply%",!0)||b9.call(ib,tb),J_=P1("%Object.getOwnPropertyDescriptor%",!0),Va=P1("%Object.defineProperty%",!0),xR=P1("%Math.max%");if(Va)try{Va({},"a",{value:1})}catch(i){Va=null}th.exports=function(e){var t=rb(b9,ib,arguments);if(J_&&Va){var r=J_(t,"length");r.configurable&&Va(t,"length",{value:1+xR(0,e.length-(arguments.length-1))})}return t};var eb=function(){return rb(b9,tb,arguments)};Va?Va(th.exports,"apply",{value:eb}):th.exports.apply=eb});var lb=ze((Tre,ab)=>{"use strict";var nb=eh(),ob=sb(),vR=ob(nb("String.prototype.indexOf"));ab.exports=function(e,t){var r=nb(e,!!t);return typeof r=="function"&&vR(e,".prototype.")>-1?ob(r):r}});var cb=ze(()=>{});var Ib=ze((Pre,Tb)=>{var P9=typeof Map=="function"&&Map.prototype,w9=Object.getOwnPropertyDescriptor&&P9?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,rh=P9&&w9&&typeof w9.get=="function"?w9.get:null,ub=P9&&Map.prototype.forEach,D9=typeof Set=="function"&&Set.prototype,E9=Object.getOwnPropertyDescriptor&&D9?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,sh=D9&&E9&&typeof E9.get=="function"?E9.get:null,hb=D9&&Set.prototype.forEach,_R=typeof WeakMap=="function"&&WeakMap.prototype,p2=_R?WeakMap.prototype.has:null,bR=typeof WeakSet=="function"&&WeakSet.prototype,m2=bR?WeakSet.prototype.has:null,wR=typeof WeakRef=="function"&&WeakRef.prototype,db=wR?WeakRef.prototype.deref:null,ER=Boolean.prototype.valueOf,AR=Object.prototype.toString,SR=Function.prototype.toString,CR=String.prototype.match,R9=String.prototype.slice,Yo=String.prototype.replace,kR=String.prototype.toUpperCase,fb=String.prototype.toLowerCase,wb=RegExp.prototype.test,pb=Array.prototype.concat,wn=Array.prototype.join,TR=Array.prototype.slice,mb=Math.floor,C9=typeof BigInt=="function"?BigInt.prototype.valueOf:null,A9=Object.getOwnPropertySymbols,k9=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,D1=typeof Symbol=="function"&&typeof Symbol.iterator=="object",ir=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===D1||!0)?Symbol.toStringTag:null,Eb=Object.prototype.propertyIsEnumerable,gb=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(i){return i.__proto__}:null);function yb(i,e){if(i===1/0||i===-1/0||i!==i||i&&i>-1e3&&i<1e3||wb.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof i=="number"){var r=i<0?-mb(-i):mb(i);if(r!==i){var s=String(r),n=R9.call(e,s.length+1);return Yo.call(s,t,"$&_")+"."+Yo.call(Yo.call(n,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Yo.call(e,t,"$&_")}var T9=cb(),xb=T9.custom,vb=Sb(xb)?xb:null;Tb.exports=function i(e,t,r,s){var n=t||{};if(Qo(n,"quoteStyle")&&n.quoteStyle!=="single"&&n.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Qo(n,"maxStringLength")&&(typeof n.maxStringLength=="number"?n.maxStringLength<0&&n.maxStringLength!==1/0:n.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=Qo(n,"customInspect")?n.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Qo(n,"indent")&&n.indent!==null&&n.indent!=="	"&&!(parseInt(n.indent,10)===n.indent&&n.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Qo(n,"numericSeparator")&&typeof n.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=n.numericSeparator;if(typeof e=="undefined")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return kb(e,n);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var l=String(e);return a?yb(e,l):l}if(typeof e=="bigint"){var c=String(e)+"n";return a?yb(e,c):c}var u=typeof n.depth=="undefined"?5:n.depth;if(typeof r=="undefined"&&(r=0),r>=u&&u>0&&typeof e=="object")return I9(e)?"[Array]":"[Object]";var h=WR(n,r);if(typeof s=="undefined")s=[];else if(Cb(s,e)>=0)return"[Circular]";function d(T,C,P){if(C&&(s=TR.call(s),s.push(C)),P){var D={depth:n.depth};return Qo(n,"quoteStyle")&&(D.quoteStyle=n.quoteStyle),i(T,D,r+1,s)}return i(T,n,r+1,s)}if(typeof e=="function"&&!_b(e)){var f=OR(e),p=ih(e,d);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(p.length>0?" { "+wn.call(p,", ")+" }":"")}if(Sb(e)){var m=D1?Yo.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):k9.call(e);return typeof e=="object"&&!D1?f2(m):m}if(zR(e)){for(var g="<"+fb.call(String(e.nodeName)),y=e.attributes||[],x=0;x<y.length;x++)g+=" "+y[x].name+"="+Ab(IR(y[x].value),"double",n);return g+=">",e.childNodes&&e.childNodes.length&&(g+="..."),g+="</"+fb.call(String(e.nodeName))+">",g}if(I9(e)){if(e.length===0)return"[]";var b=ih(e,d);return h&&!VR(b)?"["+M9(b,h)+"]":"[ "+wn.call(b,", ")+" ]"}if(PR(e)){var _=ih(e,d);return!("cause"in Error.prototype)&&"cause"in e&&!Eb.call(e,"cause")?"{ ["+String(e)+"] "+wn.call(pb.call("[cause]: "+d(e.cause),_),", ")+" }":_.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+wn.call(_,", ")+" }"}if(typeof e=="object"&&o){if(vb&&typeof e[vb]=="function"&&T9)return T9(e,{depth:u-r});if(o!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(BR(e)){var w=[];return ub&&ub.call(e,function(T,C){w.push(d(C,e,!0)+" => "+d(T,e))}),bb("Map",rh.call(e),w,h)}if(HR(e)){var A=[];return hb&&hb.call(e,function(T){A.push(d(T,e))}),bb("Set",sh.call(e),A,h)}if(UR(e))return S9("WeakMap");if(GR(e))return S9("WeakSet");if($R(e))return S9("WeakRef");if(RR(e))return f2(d(Number(e)));if(FR(e))return f2(d(C9.call(e)));if(NR(e))return f2(ER.call(e));if(DR(e))return f2(d(String(e)));if(!MR(e)&&!_b(e)){var k=ih(e,d),v=gb?gb(e)===Object.prototype:e instanceof Object||e.constructor===Object,E=e instanceof Object?"":"null prototype",S=!v&&ir&&Object(e)===e&&ir in e?R9.call(Ko(e),8,-1):E?"Object":"",M=v||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",I=M+(S||E?"["+wn.call(pb.call([],S||[],E||[]),": ")+"] ":"");return k.length===0?I+"{}":h?I+"{"+M9(k,h)+"}":I+"{ "+wn.call(k,", ")+" }"}return String(e)};function Ab(i,e,t){var r=(t.quoteStyle||e)==="double"?'"':"'";return r+i+r}function IR(i){return Yo.call(String(i),/"/g,"&quot;")}function I9(i){return Ko(i)==="[object Array]"&&(!ir||!(typeof i=="object"&&ir in i))}function MR(i){return Ko(i)==="[object Date]"&&(!ir||!(typeof i=="object"&&ir in i))}function _b(i){return Ko(i)==="[object RegExp]"&&(!ir||!(typeof i=="object"&&ir in i))}function PR(i){return Ko(i)==="[object Error]"&&(!ir||!(typeof i=="object"&&ir in i))}function DR(i){return Ko(i)==="[object String]"&&(!ir||!(typeof i=="object"&&ir in i))}function RR(i){return Ko(i)==="[object Number]"&&(!ir||!(typeof i=="object"&&ir in i))}function NR(i){return Ko(i)==="[object Boolean]"&&(!ir||!(typeof i=="object"&&ir in i))}function Sb(i){if(D1)return i&&typeof i=="object"&&i instanceof Symbol;if(typeof i=="symbol")return!0;if(!i||typeof i!="object"||!k9)return!1;try{return k9.call(i),!0}catch(e){}return!1}function FR(i){if(!i||typeof i!="object"||!C9)return!1;try{return C9.call(i),!0}catch(e){}return!1}var LR=Object.prototype.hasOwnProperty||function(i){return i in this};function Qo(i,e){return LR.call(i,e)}function Ko(i){return AR.call(i)}function OR(i){if(i.name)return i.name;var e=CR.call(SR.call(i),/^function\s*([\w$]+)/);return e?e[1]:null}function Cb(i,e){if(i.indexOf)return i.indexOf(e);for(var t=0,r=i.length;t<r;t++)if(i[t]===e)return t;return-1}function BR(i){if(!rh||!i||typeof i!="object")return!1;try{rh.call(i);try{sh.call(i)}catch(e){return!0}return i instanceof Map}catch(e){}return!1}function UR(i){if(!p2||!i||typeof i!="object")return!1;try{p2.call(i,p2);try{m2.call(i,m2)}catch(e){return!0}return i instanceof WeakMap}catch(e){}return!1}function $R(i){if(!db||!i||typeof i!="object")return!1;try{return db.call(i),!0}catch(e){}return!1}function HR(i){if(!sh||!i||typeof i!="object")return!1;try{sh.call(i);try{rh.call(i)}catch(e){return!0}return i instanceof Set}catch(e){}return!1}function GR(i){if(!m2||!i||typeof i!="object")return!1;try{m2.call(i,m2);try{p2.call(i,p2)}catch(e){return!0}return i instanceof WeakSet}catch(e){}return!1}function zR(i){return!i||typeof i!="object"?!1:typeof HTMLElement!="undefined"&&i instanceof HTMLElement?!0:typeof i.nodeName=="string"&&typeof i.getAttribute=="function"}function kb(i,e){if(i.length>e.maxStringLength){var t=i.length-e.maxStringLength,r="... "+t+" more character"+(t>1?"s":"");return kb(R9.call(i,0,e.maxStringLength),e)+r}var s=Yo.call(Yo.call(i,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,jR);return Ab(s,"single",e)}function jR(i){var e=i.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+kR.call(e.toString(16))}function f2(i){return"Object("+i+")"}function S9(i){return i+" { ? }"}function bb(i,e,t,r){var s=r?M9(t,r):wn.call(t,", ");return i+" ("+e+") {"+s+"}"}function VR(i){for(var e=0;e<i.length;e++)if(Cb(i[e],`
`)>=0)return!1;return!0}function WR(i,e){var t;if(i.indent==="	")t="	";else if(typeof i.indent=="number"&&i.indent>0)t=wn.call(Array(i.indent+1)," ");else return null;return{base:t,prev:wn.call(Array(e+1),t)}}function M9(i,e){if(i.length===0)return"";var t=`
`+e.prev+e.base;return t+wn.call(i,","+t)+`
`+e.prev}function ih(i,e){var t=I9(i),r=[];if(t){r.length=i.length;for(var s=0;s<i.length;s++)r[s]=Qo(i,s)?e(i[s],i):""}var n=typeof A9=="function"?A9(i):[],o;if(D1){o={};for(var a=0;a<n.length;a++)o["$"+n[a]]=n[a]}for(var l in i)Qo(i,l)&&(t&&String(Number(l))===l&&l<i.length||D1&&o["$"+l]instanceof Symbol||(wb.call(/[^\w$]/,l)?r.push(e(l,i)+": "+e(i[l],i)):r.push(l+": "+e(i[l],i))));if(typeof A9=="function")for(var c=0;c<n.length;c++)Eb.call(i,n[c])&&r.push("["+e(n[c])+"]: "+e(i[n[c]],i));return r}});var Pb=ze((Dre,Mb)=>{"use strict";var N9=eh(),R1=lb(),XR=Ib(),qR=N9("%TypeError%"),nh=N9("%WeakMap%",!0),oh=N9("%Map%",!0),QR=R1("WeakMap.prototype.get",!0),YR=R1("WeakMap.prototype.set",!0),KR=R1("WeakMap.prototype.has",!0),ZR=R1("Map.prototype.get",!0),JR=R1("Map.prototype.set",!0),eN=R1("Map.prototype.has",!0),F9=function(i,e){for(var t=i,r;(r=t.next)!==null;t=r)if(r.key===e)return t.next=r.next,r.next=i.next,i.next=r,r},tN=function(i,e){var t=F9(i,e);return t&&t.value},iN=function(i,e,t){var r=F9(i,e);r?r.value=t:i.next={key:e,next:i.next,value:t}},rN=function(i,e){return!!F9(i,e)};Mb.exports=function(){var e,t,r,s={assert:function(n){if(!s.has(n))throw new qR("Side channel does not contain "+XR(n))},get:function(n){if(nh&&n&&(typeof n=="object"||typeof n=="function")){if(e)return QR(e,n)}else if(oh){if(t)return ZR(t,n)}else if(r)return tN(r,n)},has:function(n){if(nh&&n&&(typeof n=="object"||typeof n=="function")){if(e)return KR(e,n)}else if(oh){if(t)return eN(t,n)}else if(r)return rN(r,n);return!1},set:function(n,o){nh&&n&&(typeof n=="object"||typeof n=="function")?(e||(e=new nh),YR(e,n,o)):oh?(t||(t=new oh),JR(t,n,o)):(r||(r={key:{},next:null}),iN(r,n,o))}};return s}});var ah=ze((Rre,Db)=>{"use strict";var sN=String.prototype.replace,nN=/%20/g,L9={RFC1738:"RFC1738",RFC3986:"RFC3986"};Db.exports={default:L9.RFC3986,formatters:{RFC1738:function(i){return sN.call(i,nN,"+")},RFC3986:function(i){return String(i)}},RFC1738:L9.RFC1738,RFC3986:L9.RFC3986}});var B9=ze((Nre,Nb)=>{"use strict";var oN=ah(),O9=Object.prototype.hasOwnProperty,Wa=Array.isArray,En=function(){for(var i=[],e=0;e<256;++e)i.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return i}(),aN=function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(Wa(r)){for(var s=[],n=0;n<r.length;++n)typeof r[n]!="undefined"&&s.push(r[n]);t.obj[t.prop]=s}}},Rb=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},s=0;s<e.length;++s)typeof e[s]!="undefined"&&(r[s]=e[s]);return r},lN=function i(e,t,r){if(!t)return e;if(typeof t!="object"){if(Wa(e))e.push(t);else if(e&&typeof e=="object")(r&&(r.plainObjects||r.allowPrototypes)||!O9.call(Object.prototype,t))&&(e[t]=!0);else return[e,t];return e}if(!e||typeof e!="object")return[e].concat(t);var s=e;return Wa(e)&&!Wa(t)&&(s=Rb(e,r)),Wa(e)&&Wa(t)?(t.forEach(function(n,o){if(O9.call(e,o)){var a=e[o];a&&typeof a=="object"&&n&&typeof n=="object"?e[o]=i(a,n,r):e.push(n)}else e[o]=n}),e):Object.keys(t).reduce(function(n,o){var a=t[o];return O9.call(n,o)?n[o]=i(n[o],a,r):n[o]=a,n},s)},cN=function(e,t){return Object.keys(t).reduce(function(r,s){return r[s]=t[s],r},e)},uN=function(i,e,t){var r=i.replace(/\+/g," ");if(t==="iso-8859-1")return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(s){return r}},hN=function(e,t,r,s,n){if(e.length===0)return e;var o=e;if(typeof e=="symbol"?o=Symbol.prototype.toString.call(e):typeof e!="string"&&(o=String(e)),r==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(u){return"%26%23"+parseInt(u.slice(2),16)+"%3B"});for(var a="",l=0;l<o.length;++l){var c=o.charCodeAt(l);if(c===45||c===46||c===95||c===126||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||n===oN.RFC1738&&(c===40||c===41)){a+=o.charAt(l);continue}if(c<128){a=a+En[c];continue}if(c<2048){a=a+(En[192|c>>6]+En[128|c&63]);continue}if(c<55296||c>=57344){a=a+(En[224|c>>12]+En[128|c>>6&63]+En[128|c&63]);continue}l+=1,c=65536+((c&1023)<<10|o.charCodeAt(l)&1023),a+=En[240|c>>18]+En[128|c>>12&63]+En[128|c>>6&63]+En[128|c&63]}return a},dN=function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],s=0;s<t.length;++s)for(var n=t[s],o=n.obj[n.prop],a=Object.keys(o),l=0;l<a.length;++l){var c=a[l],u=o[c];typeof u=="object"&&u!==null&&r.indexOf(u)===-1&&(t.push({obj:o,prop:c}),r.push(u))}return aN(t),e},fN=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},pN=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},mN=function(e,t){return[].concat(e,t)},gN=function(e,t){if(Wa(e)){for(var r=[],s=0;s<e.length;s+=1)r.push(t(e[s]));return r}return t(e)};Nb.exports={arrayToObject:Rb,assign:cN,combine:mN,compact:dN,decode:uN,encode:hN,isBuffer:pN,isRegExp:fN,maybeMap:gN,merge:lN}});var $b=ze((Fre,Ub)=>{"use strict";var Ob=Pb(),lh=B9(),g2=ah(),yN=Object.prototype.hasOwnProperty,Fb={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},no=Array.isArray,xN=Array.prototype.push,Bb=function(i,e){xN.apply(i,no(e)?e:[e])},vN=Date.prototype.toISOString,Lb=g2.default,rr={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:lh.encode,encodeValuesOnly:!1,format:Lb,formatter:g2.formatters[Lb],indices:!1,serializeDate:function(e){return vN.call(e)},skipNulls:!1,strictNullHandling:!1},_N=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},U9={},bN=function i(e,t,r,s,n,o,a,l,c,u,h,d,f,p,m,g){for(var y=e,x=g,b=0,_=!1;(x=x.get(U9))!==void 0&&!_;){var w=x.get(e);if(b+=1,typeof w!="undefined"){if(w===b)throw new RangeError("Cyclic object value");_=!0}typeof x.get(U9)=="undefined"&&(b=0)}if(typeof l=="function"?y=l(t,y):y instanceof Date?y=h(y):r==="comma"&&no(y)&&(y=lh.maybeMap(y,function(D){return D instanceof Date?h(D):D})),y===null){if(n)return a&&!p?a(t,rr.encoder,m,"key",d):t;y=""}if(_N(y)||lh.isBuffer(y)){if(a){var A=p?t:a(t,rr.encoder,m,"key",d);return[f(A)+"="+f(a(y,rr.encoder,m,"value",d))]}return[f(t)+"="+f(String(y))]}var k=[];if(typeof y=="undefined")return k;var v;if(r==="comma"&&no(y))p&&a&&(y=lh.maybeMap(y,a)),v=[{value:y.length>0?y.join(",")||null:void 0}];else if(no(l))v=l;else{var E=Object.keys(y);v=c?E.sort(c):E}for(var S=s&&no(y)&&y.length===1?t+"[]":t,M=0;M<v.length;++M){var I=v[M],T=typeof I=="object"&&typeof I.value!="undefined"?I.value:y[I];if(!(o&&T===null)){var C=no(y)?typeof r=="function"?r(S,I):S:S+(u?"."+I:"["+I+"]");g.set(e,b);var P=Ob();P.set(U9,g),Bb(k,i(T,C,r,s,n,o,r==="comma"&&p&&no(y)?null:a,l,c,u,h,d,f,p,m,P))}}return k},wN=function(e){if(!e)return rr;if(e.encoder!==null&&typeof e.encoder!="undefined"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var t=e.charset||rr.charset;if(typeof e.charset!="undefined"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=g2.default;if(typeof e.format!="undefined"){if(!yN.call(g2.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var s=g2.formatters[r],n=rr.filter;return(typeof e.filter=="function"||no(e.filter))&&(n=e.filter),{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:rr.addQueryPrefix,allowDots:typeof e.allowDots=="undefined"?rr.allowDots:!!e.allowDots,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:rr.charsetSentinel,delimiter:typeof e.delimiter=="undefined"?rr.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:rr.encode,encoder:typeof e.encoder=="function"?e.encoder:rr.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:rr.encodeValuesOnly,filter:n,format:r,formatter:s,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:rr.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:rr.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:rr.strictNullHandling}};Ub.exports=function(i,e){var t=i,r=wN(e),s,n;typeof r.filter=="function"?(n=r.filter,t=n("",t)):no(r.filter)&&(n=r.filter,s=n);var o=[];if(typeof t!="object"||t===null)return"";var a;e&&e.arrayFormat in Fb?a=e.arrayFormat:e&&"indices"in e?a=e.indices?"indices":"repeat":a="indices";var l=Fb[a];if(e&&"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var c=l==="comma"&&e&&e.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);for(var u=Ob(),h=0;h<s.length;++h){var d=s[h];r.skipNulls&&t[d]===null||Bb(o,bN(t[d],d,l,c,r.strictNullHandling,r.skipNulls,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,u))}var f=o.join(r.delimiter),p=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),f.length>0?p+f:""}});var zb=ze((Lre,Gb)=>{"use strict";var N1=B9(),$9=Object.prototype.hasOwnProperty,EN=Array.isArray,Ri={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:N1.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},AN=function(i){return i.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},Hb=function(i,e){return i&&typeof i=="string"&&e.comma&&i.indexOf(",")>-1?i.split(","):i},SN="utf8=%26%2310003%3B",CN="utf8=%E2%9C%93",kN=function(e,t){var r={__proto__:null},s=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,n=t.parameterLimit===1/0?void 0:t.parameterLimit,o=s.split(t.delimiter,n),a=-1,l,c=t.charset;if(t.charsetSentinel)for(l=0;l<o.length;++l)o[l].indexOf("utf8=")===0&&(o[l]===CN?c="utf-8":o[l]===SN&&(c="iso-8859-1"),a=l,l=o.length);for(l=0;l<o.length;++l)if(l!==a){var u=o[l],h=u.indexOf("]="),d=h===-1?u.indexOf("="):h+1,f,p;d===-1?(f=t.decoder(u,Ri.decoder,c,"key"),p=t.strictNullHandling?null:""):(f=t.decoder(u.slice(0,d),Ri.decoder,c,"key"),p=N1.maybeMap(Hb(u.slice(d+1),t),function(m){return t.decoder(m,Ri.decoder,c,"value")})),p&&t.interpretNumericEntities&&c==="iso-8859-1"&&(p=AN(p)),u.indexOf("[]=")>-1&&(p=EN(p)?[p]:p),$9.call(r,f)?r[f]=N1.combine(r[f],p):r[f]=p}return r},TN=function(i,e,t,r){for(var s=r?e:Hb(e,t),n=i.length-1;n>=0;--n){var o,a=i[n];if(a==="[]"&&t.parseArrays)o=[].concat(s);else{o=t.plainObjects?Object.create(null):{};var l=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a,c=parseInt(l,10);!t.parseArrays&&l===""?o={0:s}:!isNaN(c)&&a!==l&&String(c)===l&&c>=0&&t.parseArrays&&c<=t.arrayLimit?(o=[],o[c]=s):l!=="__proto__"&&(o[l]=s)}s=o}return s},IN=function(e,t,r,s){if(e){var n=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,l=r.depth>0&&o.exec(n),c=l?n.slice(0,l.index):n,u=[];if(c){if(!r.plainObjects&&$9.call(Object.prototype,c)&&!r.allowPrototypes)return;u.push(c)}for(var h=0;r.depth>0&&(l=a.exec(n))!==null&&h<r.depth;){if(h+=1,!r.plainObjects&&$9.call(Object.prototype,l[1].slice(1,-1))&&!r.allowPrototypes)return;u.push(l[1])}return l&&u.push("["+n.slice(l.index)+"]"),TN(u,t,r,s)}},MN=function(e){if(!e)return Ri;if(e.decoder!==null&&e.decoder!==void 0&&typeof e.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof e.charset!="undefined"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=typeof e.charset=="undefined"?Ri.charset:e.charset;return{allowDots:typeof e.allowDots=="undefined"?Ri.allowDots:!!e.allowDots,allowPrototypes:typeof e.allowPrototypes=="boolean"?e.allowPrototypes:Ri.allowPrototypes,allowSparse:typeof e.allowSparse=="boolean"?e.allowSparse:Ri.allowSparse,arrayLimit:typeof e.arrayLimit=="number"?e.arrayLimit:Ri.arrayLimit,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:Ri.charsetSentinel,comma:typeof e.comma=="boolean"?e.comma:Ri.comma,decoder:typeof e.decoder=="function"?e.decoder:Ri.decoder,delimiter:typeof e.delimiter=="string"||N1.isRegExp(e.delimiter)?e.delimiter:Ri.delimiter,depth:typeof e.depth=="number"||e.depth===!1?+e.depth:Ri.depth,ignoreQueryPrefix:e.ignoreQueryPrefix===!0,interpretNumericEntities:typeof e.interpretNumericEntities=="boolean"?e.interpretNumericEntities:Ri.interpretNumericEntities,parameterLimit:typeof e.parameterLimit=="number"?e.parameterLimit:Ri.parameterLimit,parseArrays:e.parseArrays!==!1,plainObjects:typeof e.plainObjects=="boolean"?e.plainObjects:Ri.plainObjects,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:Ri.strictNullHandling}};Gb.exports=function(i,e){var t=MN(e);if(i===""||i===null||typeof i=="undefined")return t.plainObjects?Object.create(null):{};for(var r=typeof i=="string"?kN(i,t):i,s=t.plainObjects?Object.create(null):{},n=Object.keys(r),o=0;o<n.length;++o){var a=n[o],l=IN(a,r[a],t,typeof i=="string");s=N1.merge(s,l,t)}return t.allowSparse===!0?s:N1.compact(s)}});var Vb=ze((Ore,jb)=>{"use strict";var PN=$b(),DN=zb(),RN=ah();jb.exports={formats:RN,parse:DN,stringify:PN}});var Qb=ze(L1=>{"use strict";var NN=O_();function ws(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var FN=/^([a-z0-9.+-]+:)/i,LN=/:[0-9]*$/,ON=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,BN=["<",">",'"',"`"," ","\r",`
`,"	"],UN=["{","}","|","\\","^","`"].concat(BN),H9=["'"].concat(UN),Wb=["%","/","?",";","#"].concat(H9),Xb=["/","?","#"],$N=255,qb=/^[+a-z0-9A-Z_-]{0,63}$/,HN=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,GN={javascript:!0,"javascript:":!0},G9={javascript:!0,"javascript:":!0},F1={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},z9=Vb();function y2(i,e,t){if(i&&typeof i=="object"&&i instanceof ws)return i;var r=new ws;return r.parse(i,e,t),r}ws.prototype.parse=function(i,e,t){if(typeof i!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof i);var r=i.indexOf("?"),s=r!==-1&&r<i.indexOf("#")?"?":"#",n=i.split(s),o=/\\/g;n[0]=n[0].replace(o,"/"),i=n.join(s);var a=i;if(a=a.trim(),!t&&i.split("#").length===1){var l=ON.exec(a);if(l)return this.path=a,this.href=a,this.pathname=l[1],l[2]?(this.search=l[2],e?this.query=z9.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var c=FN.exec(a);if(c){c=c[0];var u=c.toLowerCase();this.protocol=u,a=a.substr(c.length)}if(t||c||a.match(/^\/\/[^@/]+@[^@/]+/)){var h=a.substr(0,2)==="//";h&&!(c&&G9[c])&&(a=a.substr(2),this.slashes=!0)}if(!G9[c]&&(h||c&&!F1[c])){for(var d=-1,f=0;f<Xb.length;f++){var p=a.indexOf(Xb[f]);p!==-1&&(d===-1||p<d)&&(d=p)}var m,g;d===-1?g=a.lastIndexOf("@"):g=a.lastIndexOf("@",d),g!==-1&&(m=a.slice(0,g),a=a.slice(g+1),this.auth=decodeURIComponent(m)),d=-1;for(var f=0;f<Wb.length;f++){var p=a.indexOf(Wb[f]);p!==-1&&(d===-1||p<d)&&(d=p)}d===-1&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!y)for(var x=this.hostname.split(/\./),f=0,b=x.length;f<b;f++){var _=x[f];if(_&&!_.match(qb)){for(var w="",A=0,k=_.length;A<k;A++)_.charCodeAt(A)>127?w+="x":w+=_[A];if(!w.match(qb)){var v=x.slice(0,f),E=x.slice(f+1),S=_.match(HN);S&&(v.push(S[1]),E.unshift(S[2])),E.length&&(a="/"+E.join(".")+a),this.hostname=v.join(".");break}}}this.hostname.length>$N?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=NN.toASCII(this.hostname));var M=this.port?":"+this.port:"",I=this.hostname||"";this.host=I+M,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!GN[u])for(var f=0,b=H9.length;f<b;f++){var T=H9[f];if(a.indexOf(T)!==-1){var C=encodeURIComponent(T);C===T&&(C=escape(T)),a=a.split(T).join(C)}}var P=a.indexOf("#");P!==-1&&(this.hash=a.substr(P),a=a.slice(0,P));var D=a.indexOf("?");if(D!==-1?(this.search=a.substr(D),this.query=a.substr(D+1),e&&(this.query=z9.parse(this.query)),a=a.slice(0,D)):e&&(this.search="",this.query={}),a&&(this.pathname=a),F1[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var M=this.pathname||"",O=this.search||"";this.path=M+O}return this.href=this.format(),this};function zN(i){return typeof i=="string"&&(i=y2(i)),i instanceof ws?i.format():ws.prototype.format.call(i)}ws.prototype.format=function(){var i=this.auth||"";i&&(i=encodeURIComponent(i),i=i.replace(/%3A/i,":"),i+="@");var e=this.protocol||"",t=this.pathname||"",r=this.hash||"",s=!1,n="";this.host?s=i+this.host:this.hostname&&(s=i+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(n=z9.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||n&&"?"+n||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||F1[e])&&s!==!1?(s="//"+(s||""),t&&t.charAt(0)!=="/"&&(t="/"+t)):s||(s=""),r&&r.charAt(0)!=="#"&&(r="#"+r),o&&o.charAt(0)!=="?"&&(o="?"+o),t=t.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),e+s+t+o+r};function jN(i,e){return y2(i,!1,!0).resolve(e)}ws.prototype.resolve=function(i){return this.resolveObject(y2(i,!1,!0)).format()};function VN(i,e){return i?y2(i,!1,!0).resolveObject(e):e}ws.prototype.resolveObject=function(i){if(typeof i=="string"){var e=new ws;e.parse(i,!1,!0),i=e}for(var t=new ws,r=Object.keys(this),s=0;s<r.length;s++){var n=r[s];t[n]=this[n]}if(t.hash=i.hash,i.href==="")return t.href=t.format(),t;if(i.slashes&&!i.protocol){for(var o=Object.keys(i),a=0;a<o.length;a++){var l=o[a];l!=="protocol"&&(t[l]=i[l])}return F1[t.protocol]&&t.hostname&&!t.pathname&&(t.pathname="/",t.path=t.pathname),t.href=t.format(),t}if(i.protocol&&i.protocol!==t.protocol){if(!F1[i.protocol]){for(var c=Object.keys(i),u=0;u<c.length;u++){var h=c[u];t[h]=i[h]}return t.href=t.format(),t}if(t.protocol=i.protocol,!i.host&&!G9[i.protocol]){for(var b=(i.pathname||"").split("/");b.length&&!(i.host=b.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),b[0]!==""&&b.unshift(""),b.length<2&&b.unshift(""),t.pathname=b.join("/")}else t.pathname=i.pathname;if(t.search=i.search,t.query=i.query,t.host=i.host||"",t.auth=i.auth,t.hostname=i.hostname||i.host,t.port=i.port,t.pathname||t.search){var d=t.pathname||"",f=t.search||"";t.path=d+f}return t.slashes=t.slashes||i.slashes,t.href=t.format(),t}var p=t.pathname&&t.pathname.charAt(0)==="/",m=i.host||i.pathname&&i.pathname.charAt(0)==="/",g=m||p||t.host&&i.pathname,y=g,x=t.pathname&&t.pathname.split("/")||[],b=i.pathname&&i.pathname.split("/")||[],_=t.protocol&&!F1[t.protocol];if(_&&(t.hostname="",t.port=null,t.host&&(x[0]===""?x[0]=t.host:x.unshift(t.host)),t.host="",i.protocol&&(i.hostname=null,i.port=null,i.host&&(b[0]===""?b[0]=i.host:b.unshift(i.host)),i.host=null),g=g&&(b[0]===""||x[0]==="")),m)t.host=i.host||i.host===""?i.host:t.host,t.hostname=i.hostname||i.hostname===""?i.hostname:t.hostname,t.search=i.search,t.query=i.query,x=b;else if(b.length)x||(x=[]),x.pop(),x=x.concat(b),t.search=i.search,t.query=i.query;else if(i.search!=null){if(_){t.host=x.shift(),t.hostname=t.host;var w=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;w&&(t.auth=w.shift(),t.hostname=w.shift(),t.host=t.hostname)}return t.search=i.search,t.query=i.query,(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.href=t.format(),t}if(!x.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var A=x.slice(-1)[0],k=(t.host||i.host||x.length>1)&&(A==="."||A==="..")||A==="",v=0,E=x.length;E>=0;E--)A=x[E],A==="."?x.splice(E,1):A===".."?(x.splice(E,1),v++):v&&(x.splice(E,1),v--);if(!g&&!y)for(;v--;v)x.unshift("..");g&&x[0]!==""&&(!x[0]||x[0].charAt(0)!=="/")&&x.unshift(""),k&&x.join("/").substr(-1)!=="/"&&x.push("");var S=x[0]===""||x[0]&&x[0].charAt(0)==="/";if(_){t.hostname=S?"":x.length?x.shift():"",t.host=t.hostname;var w=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;w&&(t.auth=w.shift(),t.hostname=w.shift(),t.host=t.hostname)}return g=g||t.host&&x.length,g&&!S&&x.unshift(""),x.length>0?t.pathname=x.join("/"):(t.pathname=null,t.path=null),(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.auth=i.auth||t.auth,t.slashes=t.slashes||i.slashes,t.href=t.format(),t};ws.prototype.parseHost=function(){var i=this.host,e=LN.exec(i);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),i=i.substr(0,i.length-e.length)),i&&(this.hostname=i)};L1.parse=y2;L1.resolve=jN;L1.resolveObject=VN;L1.format=zN;L1.Url=ws});var Qw=ze((t8,i8)=>{(function(i,e){typeof t8=="object"&&typeof i8!="undefined"?i8.exports=e():typeof define=="function"&&define.amd?define(e):i.quickselect=e()})(t8,function(){"use strict";function i(s,n,o,a,l){e(s,n,o||0,a||s.length-1,l||r)}function e(s,n,o,a,l){for(;a>o;){if(a-o>600){var c=a-o+1,u=n-o+1,h=Math.log(c),d=.5*Math.exp(2*h/3),f=.5*Math.sqrt(h*d*(c-d)/c)*(u-c/2<0?-1:1),p=Math.max(o,Math.floor(n-u*d/c+f)),m=Math.min(a,Math.floor(n+(c-u)*d/c+f));e(s,n,p,m,l)}var g=s[n],y=o,x=a;for(t(s,o,n),l(s[a],g)>0&&t(s,o,a);y<x;){for(t(s,y,x),y++,x--;l(s[y],g)<0;)y++;for(;l(s[x],g)>0;)x--}l(s[o],g)===0?t(s,o,x):(x++,t(s,x,a)),x<=n&&(o=x+1),n<=x&&(a=x-1)}}function t(s,n,o){var a=s[n];s[n]=s[o],s[o]=a}function r(s,n){return s<n?-1:s>n?1:0}return i})});var Jw=ze((aae,n8)=>{"use strict";n8.exports=H2;n8.exports.default=H2;var GF=Qw();function H2(i,e){if(!(this instanceof H2))return new H2(i,e);this._maxEntries=Math.max(4,i||9),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),e&&this._initFormat(e),this.clear()}H2.prototype={all:function(){return this._all(this.data,[])},search:function(i){var e=this.data,t=[],r=this.toBBox;if(!Sh(i,e))return t;for(var s=[],n,o,a,l;e;){for(n=0,o=e.children.length;n<o;n++)a=e.children[n],l=e.leaf?r(a):a,Sh(i,l)&&(e.leaf?t.push(a):s8(i,l)?this._all(a,t):s.push(a));e=s.pop()}return t},collides:function(i){var e=this.data,t=this.toBBox;if(!Sh(i,e))return!1;for(var r=[],s,n,o,a;e;){for(s=0,n=e.children.length;s<n;s++)if(o=e.children[s],a=e.leaf?t(o):o,Sh(i,a)){if(e.leaf||s8(i,a))return!0;r.push(o)}e=r.pop()}return!1},load:function(i){if(!(i&&i.length))return this;if(i.length<this._minEntries){for(var e=0,t=i.length;e<t;e++)this.insert(i[e]);return this}var r=this._build(i.slice(),0,i.length-1,0);if(!this.data.children.length)this.data=r;else if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var s=this.data;this.data=r,r=s}this._insert(r,this.data.height-r.height-1,!0)}return this},insert:function(i){return i&&this._insert(i,this.data.height-1),this},clear:function(){return this.data=H1([]),this},remove:function(i,e){if(!i)return this;for(var t=this.data,r=this.toBBox(i),s=[],n=[],o,a,l,c;t||s.length;){if(t||(t=s.pop(),a=s[s.length-1],o=n.pop(),c=!0),t.leaf&&(l=zF(i,t.children,e),l!==-1))return t.children.splice(l,1),s.push(t),this._condense(s),this;!c&&!t.leaf&&s8(t,r)?(s.push(t),n.push(o),o=0,a=t,t=t.children[0]):a?(o++,t=a.children[o],c=!1):t=null}return this},toBBox:function(i){return i},compareMinX:Yw,compareMinY:Kw,toJSON:function(){return this.data},fromJSON:function(i){return this.data=i,this},_all:function(i,e){for(var t=[];i;)i.leaf?e.push.apply(e,i.children):t.push.apply(t,i.children),i=t.pop();return e},_build:function(i,e,t,r){var s=t-e+1,n=this._maxEntries,o;if(s<=n)return o=H1(i.slice(e,t+1)),$1(o,this.toBBox),o;r||(r=Math.ceil(Math.log(s)/Math.log(n)),n=Math.ceil(s/Math.pow(n,r-1))),o=H1([]),o.leaf=!1,o.height=r;var a=Math.ceil(s/n),l=a*Math.ceil(Math.sqrt(n)),c,u,h,d;for(Zw(i,e,t,l,this.compareMinX),c=e;c<=t;c+=l)for(h=Math.min(c+l-1,t),Zw(i,c,h,a,this.compareMinY),u=c;u<=h;u+=a)d=Math.min(u+a-1,h),o.children.push(this._build(i,u,d,r-1));return $1(o,this.toBBox),o},_chooseSubtree:function(i,e,t,r){for(var s,n,o,a,l,c,u,h;r.push(e),!(e.leaf||r.length-1===t);){for(u=h=1/0,s=0,n=e.children.length;s<n;s++)o=e.children[s],l=r8(o),c=jF(i,o)-l,c<h?(h=c,u=l<u?l:u,a=o):c===h&&l<u&&(u=l,a=o);e=a||e.children[0]}return e},_insert:function(i,e,t){var r=this.toBBox,s=t?i:r(i),n=[],o=this._chooseSubtree(s,this.data,e,n);for(o.children.push(i),$2(o,s);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(s,n,e)},_split:function(i,e){var t=i[e],r=t.children.length,s=this._minEntries;this._chooseSplitAxis(t,s,r);var n=this._chooseSplitIndex(t,s,r),o=H1(t.children.splice(n,t.children.length-n));o.height=t.height,o.leaf=t.leaf,$1(t,this.toBBox),$1(o,this.toBBox),e?i[e-1].children.push(o):this._splitRoot(t,o)},_splitRoot:function(i,e){this.data=H1([i,e]),this.data.height=i.height+1,this.data.leaf=!1,$1(this.data,this.toBBox)},_chooseSplitIndex:function(i,e,t){var r,s,n,o,a,l,c,u;for(l=c=1/0,r=e;r<=t-e;r++)s=U2(i,0,r,this.toBBox),n=U2(i,r,t,this.toBBox),o=VF(s,n),a=r8(s)+r8(n),o<l?(l=o,u=r,c=a<c?a:c):o===l&&a<c&&(c=a,u=r);return u},_chooseSplitAxis:function(i,e,t){var r=i.leaf?this.compareMinX:Yw,s=i.leaf?this.compareMinY:Kw,n=this._allDistMargin(i,e,t,r),o=this._allDistMargin(i,e,t,s);n<o&&i.children.sort(r)},_allDistMargin:function(i,e,t,r){i.children.sort(r);var s=this.toBBox,n=U2(i,0,e,s),o=U2(i,t-e,t,s),a=Ah(n)+Ah(o),l,c;for(l=e;l<t-e;l++)c=i.children[l],$2(n,i.leaf?s(c):c),a+=Ah(n);for(l=t-e-1;l>=e;l--)c=i.children[l],$2(o,i.leaf?s(c):c),a+=Ah(o);return a},_adjustParentBBoxes:function(i,e,t){for(var r=t;r>=0;r--)$2(e[r],i)},_condense:function(i){for(var e=i.length-1,t;e>=0;e--)i[e].children.length===0?e>0?(t=i[e-1].children,t.splice(t.indexOf(i[e]),1)):this.clear():$1(i[e],this.toBBox)},_initFormat:function(i){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(i[0])),this.compareMinY=new Function("a","b",e.join(i[1])),this.toBBox=new Function("a","return {minX: a"+i[0]+", minY: a"+i[1]+", maxX: a"+i[2]+", maxY: a"+i[3]+"};")}};function zF(i,e,t){if(!t)return e.indexOf(i);for(var r=0;r<e.length;r++)if(t(i,e[r]))return r;return-1}function $1(i,e){U2(i,0,i.children.length,e,i)}function U2(i,e,t,r,s){s||(s=H1(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var n=e,o;n<t;n++)o=i.children[n],$2(s,i.leaf?r(o):o);return s}function $2(i,e){return i.minX=Math.min(i.minX,e.minX),i.minY=Math.min(i.minY,e.minY),i.maxX=Math.max(i.maxX,e.maxX),i.maxY=Math.max(i.maxY,e.maxY),i}function Yw(i,e){return i.minX-e.minX}function Kw(i,e){return i.minY-e.minY}function r8(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function Ah(i){return i.maxX-i.minX+(i.maxY-i.minY)}function jF(i,e){return(Math.max(e.maxX,i.maxX)-Math.min(e.minX,i.minX))*(Math.max(e.maxY,i.maxY)-Math.min(e.minY,i.minY))}function VF(i,e){var t=Math.max(i.minX,e.minX),r=Math.max(i.minY,e.minY),s=Math.min(i.maxX,e.maxX),n=Math.min(i.maxY,e.maxY);return Math.max(0,s-t)*Math.max(0,n-r)}function s8(i,e){return i.minX<=e.minX&&i.minY<=e.minY&&e.maxX<=i.maxX&&e.maxY<=i.maxY}function Sh(i,e){return e.minX<=i.maxX&&e.minY<=i.maxY&&e.maxX>=i.minX&&e.maxY>=i.minY}function H1(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Zw(i,e,t,r,s){for(var n=[e,t],o;n.length;)t=n.pop(),e=n.pop(),!(t-e<=r)&&(o=e+Math.ceil((t-e)/r/2)*r,GF(i,o,e,t,s),n.push(e,o,o,t))}});var tE=ze((lae,eE)=>{"use strict";eE.exports=Ch;Ch.polyline=Ch;Ch.polygon=WF;function Ch(i,e,t){var r=i.length,s=G1(i[0],e),n=[],o,a,l,c,u;for(t||(t=[]),o=1;o<r;o++){for(a=i[o-1],l=i[o],c=u=G1(l,e);;)if(s|c){if(s&c)break;s?(a=o8(a,l,s,e),s=G1(a,e)):(l=o8(a,l,c,e),c=G1(l,e))}else{n.push(a),c!==u?(n.push(l),o<r-1&&(t.push(n),n=[])):o===r-1&&n.push(l);break}s=u}return n.length&&t.push(n),t}function WF(i,e){var t,r,s,n,o,a,l;for(r=1;r<=8;r*=2){for(t=[],s=i[i.length-1],n=!(G1(s,e)&r),o=0;o<i.length;o++)a=i[o],l=!(G1(a,e)&r),l!==n&&t.push(o8(s,a,r,e)),l&&t.push(a),s=a,n=l;if(i=t,!i.length)break}return t}function o8(i,e,t,r){return t&8?[i[0]+(e[0]-i[0])*(r[3]-i[1])/(e[1]-i[1]),r[3]]:t&4?[i[0]+(e[0]-i[0])*(r[1]-i[1])/(e[1]-i[1]),r[1]]:t&2?[r[2],i[1]+(e[1]-i[1])*(r[2]-i[0])/(e[0]-i[0])]:t&1?[r[0],i[1]+(e[1]-i[1])*(r[0]-i[0])/(e[0]-i[0])]:null}function G1(i,e){var t=0;return i[0]<e[0]?t|=1:i[0]>e[2]&&(t|=2),i[1]<e[1]?t|=4:i[1]>e[3]&&(t|=8),t}});var G2=ze((cae,sE)=>{"use strict";var XF=Jw(),qF=tE();sE.exports=QF;function QF(i){for(var e=[],t=0;t<i.features.length;t++){var r=i.features[t];if(r.geometry){var s=r.geometry.coordinates;if(r.geometry.type==="Polygon")e.push(iE(s,r.properties));else if(r.geometry.type==="MultiPolygon")for(var n=0;n<s.length;n++)e.push(iE(s[n],r.properties))}}var o=XF().load(e);function a(l,c){for(var u=[],h=o.search({minX:l[0],minY:l[1],maxX:l[0],maxY:l[1]}),d=0;d<h.length;d++)if(rE(h[d].coords,l))if(c)u.push(h[d].props);else return h[d].props;return c&&u.length?u:null}return a.tree=o,a.bbox=function(c){for(var u=[],h=o.search({minX:c[0],minY:c[1],maxX:c[2],maxY:c[3]}),d=0;d<h.length;d++)YF(h[d].coords,c)&&u.push(h[d].props);return u},a}function YF(i,e){var t=[(e[0]+e[2])/2,(e[1]+e[3])/2];if(rE(i,t))return!0;for(var r=0;r<i.length;r++)if(qF(i[r],e).length>0)return!0;return!1}function rE(i,e){for(var t=!1,r=0,s=i.length;r<s;r++)for(var n=i[r],o=0,a=n.length,l=a-1;o<a;l=o++)KF(e,n[o],n[l])&&(t=!t);return t}function KF(i,e,t){return e[1]>i[1]!=t[1]>i[1]&&i[0]<(t[0]-e[0])*(i[1]-e[1])/(t[1]-e[1])+e[0]}function iE(i,e){for(var t={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0,coords:i,props:e},r=0;r<i[0].length;r++){var s=i[0][r];t.minX=Math.min(t.minX,s[0]),t.minY=Math.min(t.minY,s[1]),t.maxX=Math.max(t.maxX,s[0]),t.maxY=Math.max(t.maxY,s[1])}return t}});var TE=ze((gle,Bh)=>{Bh.exports.RADIUS=6378137;Bh.exports.FLATTENING=1/298.257223563;Bh.exports.POLAR_RADIUS=63567523142e-4});var w8=ze((yle,b8)=>{var IE=TE();b8.exports.geometry=PE;b8.exports.ring=_8;function PE(i){var e=0,t;switch(i.type){case"Polygon":return ME(i.coordinates);case"MultiPolygon":for(t=0;t<i.coordinates.length;t++)e+=ME(i.coordinates[t]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(t=0;t<i.geometries.length;t++)e+=PE(i.geometries[t]);return e}}function ME(i){var e=0;if(i&&i.length>0){e+=Math.abs(_8(i[0]));for(var t=1;t<i.length;t++)e-=Math.abs(_8(i[t]))}return e}function _8(i){var e,t,r,s,n,o,a,l=0,c=i.length;if(c>2){for(a=0;a<c;a++)a===c-2?(s=c-2,n=c-1,o=0):a===c-1?(s=c-1,n=0,o=1):(s=a,n=a+1,o=a+2),e=i[s],t=i[n],r=i[o],l+=(v8(r[0])-v8(e[0]))*Math.sin(v8(t[1]));l=l*IE.RADIUS*IE.RADIUS/2}return l}function v8(i){return i*Math.PI/180}});var RE=ze(DE=>{DE.validateCenter=function(e){var t=[2,3];if(!Array.isArray(e)||!t.includes(e.length))throw new Error("ERROR! Center has to be an array of length two or three");var[r,s]=e;if(typeof r!="number"||typeof s!="number")throw new Error(`ERROR! Longitude and Latitude has to be numbers but where ${typeof r} and ${typeof s}`);if(r>180||r<-180)throw new Error(`ERROR! Longitude has to be between -180 and 180 but was ${r}`);if(s>90||s<-90)throw new Error(`ERROR! Latitude has to be between -90 and 90 but was ${s}`)}});var FE=ze(NE=>{NE.validateRadius=function(e){if(typeof e!="number")throw new Error(`ERROR! Radius has to be a positive number but was: ${typeof e}`);if(e<=0)throw new Error(`ERROR! Radius has to be a positive number but was: ${e}`)}});var OE=ze(LE=>{LE.validateNumberOfEdges=function(e){if(typeof e!="number"){let t=Array.isArray(e)?"array":typeof e;throw new Error(`ERROR! Number of edges has to be a number but was: ${t}`)}if(e<3)throw new Error(`ERROR! Number of edges has to be at least 3 but was: ${e}`)}});var UE=ze(BE=>{BE.validateEarthRadius=function(e){if(typeof e!="number"){let t=Array.isArray(e)?"array":typeof e;throw new Error(`ERROR! Earth radius has to be a number but was: ${t}`)}if(e<=0)throw new Error(`ERROR! Earth radius has to be a positive number but was: ${e}`)}});var HE=ze($E=>{$E.validateBearing=function(e){if(typeof e!="number"){let t=Array.isArray(e)?"array":typeof e;throw new Error(`ERROR! Bearing has to be a number but was: ${t}`)}}});var XE=ze(Ya=>{var GE=RE().validateCenter,zE=FE().validateRadius,jE=OE().validateNumberOfEdges,VE=UE().validateEarthRadius,WE=HE().validateBearing;function mL({center:i,radius:e,numberOfEdges:t,earthRadius:r,bearing:s}){GE(i),zE(e),jE(t),VE(r),WE(s)}Ya.validateCenter=GE;Ya.validateRadius=zE;Ya.validateNumberOfEdges=jE;Ya.validateEarthRadius=VE;Ya.validateBearing=WE;Ya.validateInput=mL});var YE=ze((Ale,QE)=>{"use strict";var{validateInput:gL}=XE(),E8=6378137;function A8(i){return i*Math.PI/180}function qE(i){return i*180/Math.PI}function yL(i,e,t,r){var s=A8(i[1]),n=A8(i[0]),o=e/t,a=Math.asin(Math.sin(s)*Math.cos(o)+Math.cos(s)*Math.sin(o)*Math.cos(r)),l=n+Math.atan2(Math.sin(r)*Math.sin(o)*Math.cos(s),Math.cos(o)-Math.sin(s)*Math.sin(a));return[qE(l),qE(a)]}QE.exports=function(e,t,r){var s=xL(r),n=vL(r),o=bL(r),a=_L(r);gL({center:e,radius:t,numberOfEdges:s,earthRadius:n,bearing:o});for(var l=A8(o),c=[],u=0;u<s;++u)c.push(yL(e,t,n,l+a*2*Math.PI*-u/s));return c.push(c[0]),{type:"Polygon",coordinates:[c]}};function xL(i){if(S8(i))return 32;if(Uh(i)){var e=i.numberOfEdges;return e===void 0?32:e}return i}function vL(i){if(S8(i))return E8;if(Uh(i)){var e=i.earthRadius;return e===void 0?E8:e}return E8}function _L(i){return Uh(i)&&i.rightHandRule?-1:1}function bL(i){if(S8(i))return 0;if(Uh(i)){var e=i.bearing;return e===void 0?0:e}return 0}function Uh(i){return i!==null&&typeof i=="object"&&!Array.isArray(i)}function S8(i){return i==null}});var KE=ze((Sle,C8)=>{(function(){function i(e,t,r){function s(d){return d.map(function(f,p){return p<2?1*f.toFixed(t):1*f.toFixed(r)})}function n(d){return d.map(s)}function o(d){return d.map(n)}function a(d){return d.map(o)}function l(d){if(!d)return{};switch(d.type){case"Point":return d.coordinates=s(d.coordinates),d;case"LineString":case"MultiPoint":return d.coordinates=n(d.coordinates),d;case"Polygon":case"MultiLineString":return d.coordinates=o(d.coordinates),d;case"MultiPolygon":return d.coordinates=a(d.coordinates),d;case"GeometryCollection":return d.geometries=d.geometries.map(l),d;default:return{}}}function c(d){return d.geometry=l(d.geometry),d}function u(d){return d.features=d.features.map(c),d}function h(d){return d.geometries=d.geometries.map(l),d}if(!e)return e;switch(e.type){case"Feature":return c(e);case"GeometryCollection":return h(e);case"FeatureCollection":return u(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiPolygon":case"MultiLineString":return l(e);default:return e}}C8.exports=i,C8.exports.parse=i})()});var eA=ze((Cle,JE)=>{function $h(i){return typeof i=="object"&&i!==null}function wL(i,e){Array.isArray(i)?i.forEach(e):$h(i)&&Object.keys(i).forEach(function(t){var r=i[t];e(r,t)})}function ZE(i){var e=0;return Array.isArray(i)||$h(i)?(wL(i,function(t){if(Array.isArray(t)||$h(t)){var r=ZE(t);r>e&&(e=r)}}),e+1):e}function EL(i,e){e=e||{};var t=JSON.stringify([1],null,W1(e,"indent",2)).slice(2,-3),r=W1(e,"margins",!1),s=W1(e,"arrayMargins",!1),n=W1(e,"objectMargins",!1),o=t===""?1/0:W1(e,"maxLength",80),a=W1(e,"maxNesting",1/0);return function l(c,u,h){c&&typeof c.toJSON=="function"&&(c=c.toJSON());var d=JSON.stringify(c);if(d===void 0)return d;var f=o-u.length-h,p=ZE(c);if(p<=a&&d.length<=f){var m=SL(d,{addMargin:r,addArrayMargin:s,addObjectMargin:n});if(m.length<=f)return m}if($h(c)){var g=u+t,y=[],x,b=function(w,A){return A===w.length-1?0:1};if(Array.isArray(c)){for(var _=0;_<c.length;_++)y.push(l(c[_],g,b(c,_))||"null");x="[]"}else Object.keys(c).forEach(function(w,A,k){var v=JSON.stringify(w)+": ",E=l(c[w],g,v.length+b(k,A));E!==void 0&&y.push(v+E)}),x="{}";if(y.length>0)return[x[0],t+y.join(`,
`+g),x[1]].join(`
`+u)}return d}(i,"",0)}var AL=/("(?:[^\\"]|\\.)*")|[:,\][}{]/g;function SL(i,e){e=e||{};var t={"{":"{","}":"}","[":"[","]":"]",",":", ",":":": "};return(e.addMargin||e.addObjectMargin)&&(t["{"]="{ ",t["}"]=" }"),(e.addMargin||e.addArrayMargin)&&(t["["]="[ ",t["]"]=" ]"),i.replace(AL,function(r,s){return s?r:t[r]})}function W1(i,e,t){return e in i?i[e]:t}JE.exports=EL});var tu=ze((kAe,$C)=>{$C.exports=$d;function $d(i,e){var t=i&&i.type,r;if(t==="FeatureCollection")for(r=0;r<i.features.length;r++)$d(i.features[r],e);else if(t==="GeometryCollection")for(r=0;r<i.geometries.length;r++)$d(i.geometries[r],e);else if(t==="Feature")$d(i.geometry,e);else if(t==="Polygon")BC(i.coordinates,e);else if(t==="MultiPolygon")for(r=0;r<i.coordinates.length;r++)BC(i.coordinates[r],e);return i}function BC(i,e){if(i.length!==0){UC(i[0],e);for(var t=1;t<i.length;t++)UC(i[t],!e)}}function UC(i,e){for(var t=0,r=0,s=0,n=i.length,o=n-1;s<n;o=s++){var a=(i[s][0]-i[o][0])*(i[o][1]+i[s][1]),l=t+a;r+=Math.abs(t)>=Math.abs(a)?t-l+a:a-l+t,t=l}t+r>=0!=!!e&&i.reverse()}});var GC=ze((PAe,gm)=>{"use strict";gm.exports=iu;gm.exports.default=iu;function iu(i,e){if(!(this instanceof iu))return new iu(i,e);if(this.data=i||[],this.length=this.data.length,this.compare=e||y$,this.length>0)for(var t=(this.length>>1)-1;t>=0;t--)this._down(t)}function y$(i,e){return i<e?-1:i>e?1:0}iu.prototype={push:function(i){this.data.push(i),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var i=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),i}},peek:function(){return this.data[0]},_up:function(i){for(var e=this.data,t=this.compare,r=e[i];i>0;){var s=i-1>>1,n=e[s];if(t(r,n)>=0)break;e[i]=n,i=s}e[i]=r},_down:function(i){for(var e=this.data,t=this.compare,r=this.length>>1,s=e[i];i<r;){var n=(i<<1)+1,o=n+1,a=e[n];if(o<this.length&&t(e[o],a)<0&&(n=o,a=e[o]),t(a,s)>=0)break;e[i]=a,i=n}e[i]=s}}});var jC=ze((DAe,ym)=>{"use strict";var x$=GC();ym.exports=zC;ym.exports.default=zC;function zC(i,e,t){e=e||1;for(var r,s,n,o,a=0;a<i[0].length;a++){var l=i[0][a];(!a||l[0]<r)&&(r=l[0]),(!a||l[1]<s)&&(s=l[1]),(!a||l[0]>n)&&(n=l[0]),(!a||l[1]>o)&&(o=l[1])}var c=n-r,u=o-s,h=Math.min(c,u),d=h/2,f=new x$(null,v$);if(h===0)return[r,s];for(var p=r;p<n;p+=h)for(var m=s;m<o;m+=h)f.push(new ba(p+d,m+d,d,i));var g=b$(i),y=new ba(r+c/2,s+u/2,0,i);y.d>g.d&&(g=y);for(var x=f.length;f.length;){var b=f.pop();b.d>g.d&&(g=b,t&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,x)),!(b.max-g.d<=e)&&(d=b.h/2,f.push(new ba(b.x-d,b.y-d,d,i)),f.push(new ba(b.x+d,b.y-d,d,i)),f.push(new ba(b.x-d,b.y+d,d,i)),f.push(new ba(b.x+d,b.y+d,d,i)),x+=4)}return t&&(console.log("num probes: "+x),console.log("best distance: "+g.d)),[g.x,g.y]}function v$(i,e){return e.max-i.max}function ba(i,e,t,r){this.x=i,this.y=e,this.h=t,this.d=_$(i,e,r),this.max=this.d+this.h*Math.SQRT2}function _$(i,e,t){for(var r=!1,s=1/0,n=0;n<t.length;n++)for(var o=t[n],a=0,l=o.length,c=l-1;a<l;c=a++){var u=o[a],h=o[c];u[1]>e!=h[1]>e&&i<(h[0]-u[0])*(e-u[1])/(h[1]-u[1])+u[0]&&(r=!r),s=Math.min(s,w$(i,e,u,h))}return(r?1:-1)*Math.sqrt(s)}function b$(i){for(var e=0,t=0,r=0,s=i[0],n=0,o=s.length,a=o-1;n<o;a=n++){var l=s[n],c=s[a],u=l[0]*c[1]-c[0]*l[1];t+=(l[0]+c[0])*u,r+=(l[1]+c[1])*u,e+=u*3}return e===0?new ba(s[0][0],s[0][1],0,i):new ba(t/e,r/e,0,i)}function w$(i,e,t,r){var s=t[0],n=t[1],o=r[0]-s,a=r[1]-n;if(o!==0||a!==0){var l=((i-s)*o+(e-n)*a)/(o*o+a*a);l>1?(s=r[0],n=r[1]):l>0&&(s+=o*l,n+=a*l)}return o=i-s,a=e-n,o*o+a*a}});var bk=ze((uNe,Xc)=>{Xc.exports=pH;Xc.exports.pair=gH;Xc.exports.format=Zm;Xc.exports.formatPair=mH;Xc.exports.coordToDMS=_k;function pH(i,e){var t=Jm(i,e);return t===null?null:t.val}function mH(i){return Zm(i.lat,"lat")+" "+Zm(i.lon,"lon")}function Zm(i,e){var t=_k(i,e);return t.whole+"\xB0 "+(t.minutes?t.minutes+"' ":"")+(t.seconds?t.seconds+'" ':"")+t.dir}function _k(i,e){var t={lat:["N","S"],lon:["E","W"]}[e]||"",r=t[i>=0?0:1],s=Math.abs(i),n=Math.floor(s),o=s-n,a=o*60,l=Math.floor(a),c=Math.floor((a-l)*60);return{whole:n,minutes:l,seconds:c,dir:r}}function Jm(i,e){if(e||(e="NSEW"),typeof i!="string")return null;i=i.toUpperCase();var t=/^[\s\,]*([NSEW])?\s*([\-|\|\]?[0-9.]+)[]?\s*(?:([0-9.]+)[']\s*)?(?:([0-9.]+)(?:''|"||)\s*)?([NSEW])?/,r=i.match(t);if(!r)return null;var s=r[0],n;if(r[1]&&r[5]?(n=r[1],s=s.slice(0,-1)):n=r[1]||r[5],n&&e.indexOf(n)===-1)return null;var o=r[2]?parseFloat(r[2]):0,a=r[3]?parseFloat(r[3])/60:0,l=r[4]?parseFloat(r[4])/3600:0,c=o<0?-1:1;return(n==="S"||n==="W")&&(c*=-1),{val:(Math.abs(o)+a+l)*c,dim:n,matched:s,remain:i.slice(s.length)}}function gH(i,e){i=i.trim();var t=Jm(i,e);if(!t)return null;i=t.remain.trim();var r=Jm(i,e);return!r||r.remain?null:t.dim?yH(t.val,r.val,t.dim):[t.val,r.val]}function yH(i,e,t){if(t==="N"||t==="S")return[i,e];if(t==="W"||t==="E")return[e,i]}});var IT=ze((XKe,TT)=>{"use strict";TT.exports=s0;function s0(i,e){this.x=i,this.y=e}s0.prototype={clone:function(){return new s0(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,t=i.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[0]*this.x+i[1]*this.y,t=i[2]*this.x+i[3]*this.y;return this.x=e,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),t=Math.sin(i),r=e*this.x-t*this.y,s=t*this.x+e*this.y;return this.x=r,this.y=s,this},_rotateAround:function(i,e){var t=Math.cos(i),r=Math.sin(i),s=e.x+t*(this.x-e.x)-r*(this.y-e.y),n=e.y+r*(this.x-e.x)+t*(this.y-e.y);return this.x=s,this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};s0.convert=function(i){return i instanceof s0?i:Array.isArray(i)?new s0(i[0],i[1]):i}});var Zg=ze((qKe,MT)=>{"use strict";var vG=IT();MT.exports=n0;function n0(i,e,t,r,s){this.properties={},this.extent=t,this.type=0,this._pbf=i,this._geometry=-1,this._keys=r,this._values=s,i.readFields(_G,this,e)}function _G(i,e,t){i==1?e.id=t.readVarint():i==2?bG(t,e):i==3?e.type=t.readVarint():i==4&&(e._geometry=t.pos)}function bG(i,e){for(var t=i.readVarint()+i.pos;i.pos<t;){var r=e._keys[i.readVarint()],s=e._values[i.readVarint()];e.properties[r]=s}}n0.types=["Unknown","Point","LineString","Polygon"];n0.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,t=1,r=0,s=0,n=0,o=[],a;i.pos<e;){if(r<=0){var l=i.readVarint();t=l&7,r=l>>3}if(r--,t===1||t===2)s+=i.readSVarint(),n+=i.readSVarint(),t===1&&(a&&o.push(a),a=[]),a.push(new vG(s,n));else if(t===7)a&&a.push(a[0].clone());else throw new Error("unknown command "+t)}return a&&o.push(a),o};n0.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,t=1,r=0,s=0,n=0,o=1/0,a=-1/0,l=1/0,c=-1/0;i.pos<e;){if(r<=0){var u=i.readVarint();t=u&7,r=u>>3}if(r--,t===1||t===2)s+=i.readSVarint(),n+=i.readSVarint(),s<o&&(o=s),s>a&&(a=s),n<l&&(l=n),n>c&&(c=n);else if(t!==7)throw new Error("unknown command "+t)}return[o,l,a,c]};n0.prototype.toGeoJSON=function(i,e,t){var r=this.extent*Math.pow(2,t),s=this.extent*i,n=this.extent*e,o=this.loadGeometry(),a=n0.types[this.type],l,c;function u(f){for(var p=0;p<f.length;p++){var m=f[p],g=180-(m.y+n)*360/r;f[p]=[(m.x+s)*360/r-180,360/Math.PI*Math.atan(Math.exp(g*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(l=0;l<o.length;l++)h[l]=o[l][0];o=h,u(o);break;case 2:for(l=0;l<o.length;l++)u(o[l]);break;case 3:for(o=wG(o),l=0;l<o.length;l++)for(c=0;c<o[l].length;c++)u(o[l][c]);break}o.length===1?o=o[0]:a="Multi"+a;var d={type:"Feature",geometry:{type:a,coordinates:o},properties:this.properties};return"id"in this&&(d.id=this.id),d};function wG(i){var e=i.length;if(e<=1)return[i];for(var t=[],r,s,n=0;n<e;n++){var o=EG(i[n]);o!==0&&(s===void 0&&(s=o<0),s===o<0?(r&&t.push(r),r=[i[n]]):r.push(i[n]))}return r&&t.push(r),t}function EG(i){for(var e=0,t=0,r=i.length,s=r-1,n,o;t<r;s=t++)n=i[t],o=i[s],e+=(o.x-n.x)*(n.y+o.y);return e}});var Jg=ze((QKe,DT)=>{"use strict";var AG=Zg();DT.exports=PT;function PT(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(SG,this,e),this.length=this._features.length}function SG(i,e,t){i===15?e.version=t.readVarint():i===1?e.name=t.readString():i===5?e.extent=t.readVarint():i===2?e._features.push(t.pos):i===3?e._keys.push(t.readString()):i===4&&e._values.push(CG(t))}function CG(i){for(var e=null,t=i.readVarint()+i.pos;i.pos<t;){var r=i.readVarint()>>3;e=r===1?i.readString():r===2?i.readFloat():r===3?i.readDouble():r===4?i.readVarint64():r===5?i.readVarint():r===6?i.readSVarint():r===7?i.readBoolean():null}return e}PT.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new AG(this._pbf,e,this.extent,this._keys,this._values)}});var NT=ze((YKe,RT)=>{"use strict";var kG=Jg();RT.exports=TG;function TG(i,e){this.layers=i.readFields(IG,{},e)}function IG(i,e,t){if(i===3){var r=new kG(t,t.readVarint()+t.pos);r.length&&(e[r.name]=r)}}});var ey=ze((KKe,Kf)=>{Kf.exports.VectorTile=NT();Kf.exports.VectorTileFeature=Zg();Kf.exports.VectorTileLayer=Jg()});var FT=ze(ty=>{ty.read=function(i,e,t,r,s){var n,o,a=s*8-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=t?s-1:0,d=t?-1:1,f=i[e+h];for(h+=d,n=f&(1<<-u)-1,f>>=-u,u+=a;u>0;n=n*256+i[e+h],h+=d,u-=8);for(o=n&(1<<-u)-1,n>>=-u,u+=r;u>0;o=o*256+i[e+h],h+=d,u-=8);if(n===0)n=1-c;else{if(n===l)return o?NaN:(f?-1:1)*(1/0);o=o+Math.pow(2,r),n=n-c}return(f?-1:1)*o*Math.pow(2,n-r)};ty.write=function(i,e,t,r,s,n){var o,a,l,c=n*8-s-1,u=(1<<c)-1,h=u>>1,d=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:n-1,p=r?1:-1,m=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+h>=1?e+=d/l:e+=d*Math.pow(2,1-h),e*l>=2&&(o++,l/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*l-1)*Math.pow(2,s),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,s),o=0));s>=8;i[t+f]=a&255,f+=p,a/=256,s-=8);for(o=o<<s|a,c+=s;c>0;i[t+f]=o&255,f+=p,o/=256,c-=8);i[t+f-p]|=m*128}});var ry=ze((JKe,$T)=>{"use strict";$T.exports=Et;var Zf=FT();function Et(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Et.Varint=0;Et.Fixed64=1;Et.Bytes=2;Et.Fixed32=5;var iy=65536*65536,LT=1/iy,MG=12,UT=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");Et.prototype={destroy:function(){this.buf=null},readFields:function(i,e,t){for(t=t||this.length;this.pos<t;){var r=this.readVarint(),s=r>>3,n=this.pos;this.type=r&7,i(s,e,this),this.pos===n&&this.skip(r)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Jf(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=BT(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Jf(this.buf,this.pos)+Jf(this.buf,this.pos+4)*iy;return this.pos+=8,i},readSFixed64:function(){var i=Jf(this.buf,this.pos)+BT(this.buf,this.pos+4)*iy;return this.pos+=8,i},readFloat:function(){var i=Zf.read(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Zf.read(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e=this.buf,t,r;return r=e[this.pos++],t=r&127,r<128||(r=e[this.pos++],t|=(r&127)<<7,r<128)||(r=e[this.pos++],t|=(r&127)<<14,r<128)||(r=e[this.pos++],t|=(r&127)<<21,r<128)?t:(r=e[this.pos],t|=(r&15)<<28,PG(t,i,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2===1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=MG&&UT?VG(this.buf,e,i):jG(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Et.Bytes)return i.push(this.readVarint(e));var t=To(this);for(i=i||[];this.pos<t;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Et.Bytes)return i.push(this.readSVarint());var e=To(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Et.Bytes)return i.push(this.readBoolean());var e=To(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Et.Bytes)return i.push(this.readFloat());var e=To(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Et.Bytes)return i.push(this.readDouble());var e=To(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Et.Bytes)return i.push(this.readFixed32());var e=To(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Et.Bytes)return i.push(this.readSFixed32());var e=To(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Et.Bytes)return i.push(this.readFixed64());var e=To(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Et.Bytes)return i.push(this.readSFixed64());var e=To(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=i&7;if(e===Et.Varint)for(;this.buf[this.pos++]>127;);else if(e===Et.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Et.Fixed32)this.pos+=4;else if(e===Et.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),a0(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),a0(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),a0(this.buf,i&-1,this.pos),a0(this.buf,Math.floor(i*LT),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),a0(this.buf,i&-1,this.pos),a0(this.buf,Math.floor(i*LT),this.pos+4),this.pos+=8},writeVarint:function(i){if(i=+i||0,i>268435455||i<0){DG(i,this);return}this.realloc(4),this.buf[this.pos++]=i&127|(i>127?128:0),!(i<=127)&&(this.buf[this.pos++]=(i>>>=7)&127|(i>127?128:0),!(i<=127)&&(this.buf[this.pos++]=(i>>>=7)&127|(i>127?128:0),!(i<=127)&&(this.buf[this.pos++]=i>>>7&127)))},writeSVarint:function(i){this.writeVarint(i<0?-i*2-1:i*2)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(i.length*4),this.pos++;var e=this.pos;this.pos=WG(this.buf,i,this.pos);var t=this.pos-e;t>=128&&OT(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(i){this.realloc(4),Zf.write(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Zf.write(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=i[t]},writeRawMessage:function(i,e){this.pos++;var t=this.pos;i(e,this);var r=this.pos-t;r>=128&&OT(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeMessage:function(i,e,t){this.writeTag(i,Et.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,FG,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,LG,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,UG,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,OG,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,BG,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,$G,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,HG,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,GG,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,zG,e)},writeBytesField:function(i,e){this.writeTag(i,Et.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Et.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Et.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Et.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Et.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Et.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Et.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Et.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Et.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Et.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};function PG(i,e,t){var r=t.buf,s,n;if(n=r[t.pos++],s=(n&112)>>4,n<128||(n=r[t.pos++],s|=(n&127)<<3,n<128)||(n=r[t.pos++],s|=(n&127)<<10,n<128)||(n=r[t.pos++],s|=(n&127)<<17,n<128)||(n=r[t.pos++],s|=(n&127)<<24,n<128)||(n=r[t.pos++],s|=(n&1)<<31,n<128))return o0(i,s,e);throw new Error("Expected varint not more than 10 bytes")}function To(i){return i.type===Et.Bytes?i.readVarint()+i.pos:i.pos+1}function o0(i,e,t){return t?e*4294967296+(i>>>0):(e>>>0)*4294967296+(i>>>0)}function DG(i,e){var t,r;if(i>=0?(t=i%4294967296|0,r=i/4294967296|0):(t=~(-i%4294967296),r=~(-i/4294967296),t^4294967295?t=t+1|0:(t=0,r=r+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),RG(t,r,e),NG(r,e)}function RG(i,e,t){t.buf[t.pos++]=i&127|128,i>>>=7,t.buf[t.pos++]=i&127|128,i>>>=7,t.buf[t.pos++]=i&127|128,i>>>=7,t.buf[t.pos++]=i&127|128,i>>>=7,t.buf[t.pos]=i&127}function NG(i,e){var t=(i&7)<<4;e.buf[e.pos++]|=t|((i>>>=3)?128:0),i&&(e.buf[e.pos++]=i&127|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=i&127|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=i&127|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=i&127|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=i&127)))))}function OT(i,e,t){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(r);for(var s=t.pos-1;s>=i;s--)t.buf[s+r]=t.buf[s]}function FG(i,e){for(var t=0;t<i.length;t++)e.writeVarint(i[t])}function LG(i,e){for(var t=0;t<i.length;t++)e.writeSVarint(i[t])}function OG(i,e){for(var t=0;t<i.length;t++)e.writeFloat(i[t])}function BG(i,e){for(var t=0;t<i.length;t++)e.writeDouble(i[t])}function UG(i,e){for(var t=0;t<i.length;t++)e.writeBoolean(i[t])}function $G(i,e){for(var t=0;t<i.length;t++)e.writeFixed32(i[t])}function HG(i,e){for(var t=0;t<i.length;t++)e.writeSFixed32(i[t])}function GG(i,e){for(var t=0;t<i.length;t++)e.writeFixed64(i[t])}function zG(i,e){for(var t=0;t<i.length;t++)e.writeSFixed64(i[t])}function Jf(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+i[e+3]*16777216}function a0(i,e,t){i[t]=e,i[t+1]=e>>>8,i[t+2]=e>>>16,i[t+3]=e>>>24}function BT(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function jG(i,e,t){for(var r="",s=e;s<t;){var n=i[s],o=null,a=n>239?4:n>223?3:n>191?2:1;if(s+a>t)break;var l,c,u;a===1?n<128&&(o=n):a===2?(l=i[s+1],(l&192)===128&&(o=(n&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=i[s+1],c=i[s+2],(l&192)===128&&(c&192)===128&&(o=(n&15)<<12|(l&63)<<6|c&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=i[s+1],c=i[s+2],u=i[s+3],(l&192)===128&&(c&192)===128&&(u&192)===128&&(o=(n&15)<<18|(l&63)<<12|(c&63)<<6|u&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),r+=String.fromCharCode(o),s+=a}return r}function VG(i,e,t){return UT.decode(i.subarray(e,t))}function WG(i,e,t){for(var r=0,s,n;r<e.length;r++){if(s=e.charCodeAt(r),s>55295&&s<57344)if(n)if(s<56320){i[t++]=239,i[t++]=191,i[t++]=189,n=s;continue}else s=n-55296<<10|s-56320|65536,n=null;else{s>56319||r+1===e.length?(i[t++]=239,i[t++]=191,i[t++]=189):n=s;continue}else n&&(i[t++]=239,i[t++]=191,i[t++]=189,n=null);s<128?i[t++]=s:(s<2048?i[t++]=s>>6|192:(s<65536?i[t++]=s>>12|224:(i[t++]=s>>18|240,i[t++]=s>>12&63|128),i[t++]=s>>6&63|128),i[t++]=s&63|128)}return t}});var xI=ze((EJe,yI)=>{"use strict";yI.exports=function(i,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var t=typeof e.cycles=="boolean"?e.cycles:!1,r=e.cmp&&function(n){return function(o){return function(a,l){var c={key:a,value:o[a]},u={key:l,value:o[l]};return n(c,u)}}}(e.cmp),s=[];return function n(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,l;if(Array.isArray(o)){for(l="[",a=0;a<o.length;a++)a&&(l+=","),l+=n(o[a])||"null";return l+"]"}if(o===null)return"null";if(s.indexOf(o)!==-1){if(t)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var c=s.push(o)-1,u=Object.keys(o).sort(r&&r(o));for(l="",a=0;a<u.length;a++){var h=u[a],d=n(o[h]);d&&(l&&(l+=","),l+=JSON.stringify(h)+":"+d)}return s.splice(c,1),"{"+l+"}"}}(i)}});var s7={};g3(s7,{AbstractBehavior:()=>mi,AbstractMode:()=>Ht,AbstractSystem:()=>Ce,AddNoteMode:()=>Ru,AddPointMode:()=>Nu,BrowseMode:()=>Fu,Category:()=>d1,Collection:()=>xn,Context:()=>r7,DataLoaderSystem:()=>F2,Difference:()=>er,DragBehavior:()=>k2,DragNodeMode:()=>Lu,DrawAreaMode:()=>Ou,DrawBehavior:()=>T2,DrawLineMode:()=>Bu,Edit:()=>ro,EditSystem:()=>O2,EsriService:()=>ju,FetchError:()=>i2,Field:()=>x1,FilterSystem:()=>B2,Graph:()=>di,HoverBehavior:()=>I2,ImagerySource:()=>_s,ImagerySourceBing:()=>g1,ImagerySourceCustom:()=>m1,ImagerySourceEsri:()=>y1,ImagerySourceNone:()=>p1,ImagerySystem:()=>z2,ImproveOsmService:()=>Vu,KartaviewService:()=>Wu,KeepRightService:()=>Xu,KeyOperationBehavior:()=>ht,LassoBehavior:()=>M2,LocalizationSystem:()=>j2,LocationSystem:()=>Z2,Map3dSystem:()=>J2,MapInteractionBehavior:()=>P2,MapNudgingBehavior:()=>D2,MapSystem:()=>au,MapWithAIService:()=>Qu,MapillaryService:()=>qu,MoveMode:()=>Uu,NominatimService:()=>Yu,NsiService:()=>Zu,OsmService:()=>Ju,OsmWikibaseService:()=>t3,OsmoseService:()=>e3,PasteBehavior:()=>R2,PhotoSystem:()=>lu,Preset:()=>vn,PresetSystem:()=>uu,QAItem:()=>ut,RapidSystem:()=>hu,RotateMode:()=>$u,SaveMode:()=>Hu,SelectBehavior:()=>N2,SelectMode:()=>Gu,SelectOsmMode:()=>zu,StorageSystem:()=>du,StreetsideService:()=>i3,StyleSystem:()=>pu,TaginfoService:()=>s3,Tree:()=>Jr,UiDefs:()=>Wc,UiField:()=>zr,UiPanelBackground:()=>gu,UiPanelHistory:()=>yu,UiPanelLocation:()=>xu,UiPanelMeasurement:()=>vu,UiSystem:()=>ku,UploaderSystem:()=>Tu,UrlHashSystem:()=>Iu,ValidationFix:()=>Te,ValidationIssue:()=>Ye,ValidationSystem:()=>Du,VectorTileService:()=>c3,WikidataService:()=>u3,WikipediaService:()=>h3,actionAddEntity:()=>Mt,actionAddMember:()=>Ua,actionAddMidpoint:()=>yi,actionAddVertex:()=>xs,actionChangeMember:()=>Vo,actionChangePreset:()=>xr,actionChangeTags:()=>vt,actionCircularize:()=>P5,actionConnect:()=>$a,actionCopyEntities:()=>u1,actionDeleteMember:()=>Wo,actionDeleteMultiple:()=>eo,actionDeleteNode:()=>yn,actionDeleteRelation:()=>xi,actionDeleteWay:()=>vs,actionDiscardTags:()=>to,actionDisconnect:()=>r2,actionExtract:()=>h1,actionJoin:()=>D5,actionMerge:()=>R5,actionMergeNodes:()=>Nr,actionMergePolygon:()=>N5,actionMergeRemoteChanges:()=>_1,actionMove:()=>_n,actionMoveMember:()=>L5,actionMoveNode:()=>bn,actionNoop:()=>O5,actionOrthogonalize:()=>Xo,actionRapidAcceptFeature:()=>U5,actionReflect:()=>z5,actionRestrictTurn:()=>m_,actionReverse:()=>hs,actionRevert:()=>o2,actionRotate:()=>$5,actionScale:()=>g_,actionSplit:()=>io,actionStraightenNodes:()=>H5,actionStraightenWay:()=>G5,actionSyncCrossingTags:()=>Vs,actionUnrestrictTurn:()=>y_,actionUpgradeTags:()=>j5,behaviors:()=>qs,d3:()=>rj,geoChooseEdge:()=>ti,geoHasLineIntersections:()=>d_,geoHasSelfIntersections:()=>Ha,geoOrthoCalcScore:()=>F5,geoOrthoCanOrthogonalize:()=>b1,geoOrthoMaxOffsetAngle:()=>p_,geoOrthoNormalizedDotProduct:()=>Ga,modeDragNote:()=>wT,modes:()=>jr,operationCircularize:()=>Pg,operationContinue:()=>Dg,operationCopy:()=>Ng,operationCycleHighwayTag:()=>Rg,operationDelete:()=>ns,operationDisconnect:()=>Fg,operationDowngrade:()=>Lg,operationExtract:()=>Og,operationMerge:()=>Bg,operationMove:()=>Mu,operationOrthogonalize:()=>Ug,operationPaste:()=>Pu,operationReflectLong:()=>Hg,operationReflectShort:()=>$g,operationReverse:()=>Gg,operationRotate:()=>zg,operationSplit:()=>jg,operationStraighten:()=>Vg,osmAreaKeys:()=>Ia,osmChangeset:()=>vr,osmEntity:()=>de,osmFlowingWaterwayTagValues:()=>Ol,osmInferRestriction:()=>c_,osmIntersection:()=>l_,osmIsInterestingTag:()=>lr,osmIsOldMultipolygonOuterMember:()=>c1,osmJoinWays:()=>Rr,osmLanes:()=>I5,osmLifecyclePrefixes:()=>Po,osmNode:()=>Be,osmNodeGeometriesForTags:()=>Ro,osmNote:()=>_t,osmOldMultipolygonOuterMember:()=>s_,osmOldMultipolygonOuterMemberOfRelation:()=>l1,osmOneWayTags:()=>No,osmPavedTags:()=>Ma,osmPointTags:()=>Fl,osmRailwayTrackTagValues:()=>T3,osmRelation:()=>Qt,osmRemoveLifecyclePrefix:()=>y0,osmRoutableHighwayTagValues:()=>ds,osmSetAreaKeys:()=>S3,osmSetPointTags:()=>C3,osmSetVertexTags:()=>k3,osmTagSuggestingArea:()=>Do,osmTurn:()=>n2,osmVertexTags:()=>Ll,osmWay:()=>pt,sdk:()=>sj,services:()=>Pi,svgTagClasses:()=>EI,systems:()=>Ai,uiAccount:()=>x6,uiAttribution:()=>v6,uiChangesetEditor:()=>_6,uiCmd:()=>Ie,uiCombobox:()=>st,uiCommit:()=>E6,uiCommitWarnings:()=>w6,uiConfirm:()=>Sa,uiConflicts:()=>A6,uiContributors:()=>S6,uiDataEditor:()=>Vc,uiDataHeader:()=>C6,uiDisclosure:()=>El,uiEditMenu:()=>k6,uiEntityEditor:()=>F6,uiFeatureInfo:()=>vk,uiFeatureList:()=>L6,uiFieldAccess:()=>Hm,uiFieldAddress:()=>Gm,uiFieldCheck:()=>wl,uiFieldCombo:()=>ss,uiFieldCycleway:()=>zm,uiFieldDefaultCheck:()=>wl,uiFieldEmail:()=>Gr,uiFieldIdentifier:()=>Gr,uiFieldLanes:()=>m6,uiFieldLocalized:()=>jm,uiFieldManyCombo:()=>ss,uiFieldMultiCombo:()=>ss,uiFieldNetworkCombo:()=>ss,uiFieldNumber:()=>Gr,uiFieldOnewayCheck:()=>wl,uiFieldRadio:()=>cu,uiFieldRoadspeed:()=>Vm,uiFieldSemiCombo:()=>ss,uiFieldStructureRadio:()=>cu,uiFieldTel:()=>Gr,uiFieldText:()=>Gr,uiFieldTextarea:()=>Wm,uiFieldTypeCombo:()=>ss,uiFieldUrl:()=>Gr,uiFieldWikidata:()=>Xm,uiFieldWikipedia:()=>y6,uiFields:()=>Gc,uiFlash:()=>qc,uiFormFields:()=>zc,uiFullScreen:()=>O6,uiGeolocate:()=>B6,uiIcon:()=>V,uiImproveOsmComments:()=>U6,uiImproveOsmDetails:()=>$6,uiImproveOsmEditor:()=>Qc,uiImproveOsmHeader:()=>H6,uiInfo:()=>j6,uiInspector:()=>W6,uiIntro:()=>an,uiIssuesInfo:()=>X6,uiKeepRightDetails:()=>q6,uiKeepRightEditor:()=>Kc,uiKeepRightHeader:()=>Q6,uiLoading:()=>Sn,uiMap3dViewer:()=>Sl,uiMapInMap:()=>Cl,uiModal:()=>Vt,uiNoteComments:()=>K6,uiNoteEditor:()=>Zc,uiNoteHeader:()=>Z6,uiNoteReport:()=>J6,uiOsmoseDetails:()=>ef,uiOsmoseEditor:()=>Jc,uiOsmoseHeader:()=>tf,uiPane:()=>Rs,uiPaneBackground:()=>Ff,uiPaneHelp:()=>Lf,uiPaneIssues:()=>$f,uiPaneMapData:()=>Wf,uiPanePreferences:()=>Qf,uiPhotoViewer:()=>sf,uiPopover:()=>g6,uiPresetIcon:()=>Al,uiPresetList:()=>V6,uiRapidColorpicker:()=>nf,uiRapidFeatureInspector:()=>e0,uiRapidFeatureToggleDialog:()=>pf,uiRapidFirstEditDialog:()=>af,uiRapidPowerUserFeaturesDialog:()=>mf,uiRapidServiceLicense:()=>gf,uiRapidSplash:()=>of,uiRapidViewManageDatasets:()=>ff,uiRapidWhatsNew:()=>yf,uiRestore:()=>xf,uiScale:()=>vf,uiSection:()=>Ge,uiSectionBackgroundDisplayOptions:()=>Mf,uiSectionBackgroundList:()=>Df,uiSectionBackgroundOffset:()=>Rf,uiSectionChanges:()=>b6,uiSectionColorSelection:()=>AI,uiSectionColorblindModeOptions:()=>SI,uiSectionDataLayers:()=>Gf,uiSectionEntityIssues:()=>T6,uiSectionFeatureType:()=>I6,uiSectionMapFeatures:()=>zf,uiSectionMapInteractionOptions:()=>qf,uiSectionMapStyleOptions:()=>jf,uiSectionOverlayList:()=>Nf,uiSectionPhotoOverlays:()=>Vf,uiSectionPresetFields:()=>M6,uiSectionPrivacy:()=>Xf,uiSectionRawMemberEditor:()=>P6,uiSectionRawMembershipEditor:()=>D6,uiSectionRawTagEditor:()=>Aa,uiSectionSelectionList:()=>R6,uiSectionValidationIssues:()=>Cu,uiSectionValidationOptions:()=>Of,uiSectionValidationRules:()=>Bf,uiSectionValidationStatus:()=>Uf,uiSettingsCustomBackground:()=>Pf,uiSettingsCustomData:()=>Hf,uiShortcuts:()=>_f,uiSidebar:()=>bf,uiSourceSwitch:()=>wf,uiSpinner:()=>Ef,uiSplash:()=>Jk,uiStatus:()=>Af,uiSuccess:()=>Sf,uiTagReference:()=>Hn,uiToggle:()=>jc,uiTooltip:()=>he,uiTopToolbar:()=>Cf,uiVersion:()=>kf,uiViewOnKeepRight:()=>Y6,uiViewOnOSM:()=>Yc,uiViewOnOsmose:()=>rf,uiZoom:()=>Tf,uiZoomToSelection:()=>If,utilDetect:()=>ei,utilFastMouse:()=>t2,utilFetchResponse:()=>Me,utilFunctor:()=>kt,utilGetDimensions:()=>Kr,utilGetSetValue:()=>be,utilHighlightEntities:()=>Xe,utilIsColorValid:()=>zo,utilKeybinding:()=>He,utilNoAuto:()=>Re,utilRebind:()=>me,utilSetDimensions:()=>r_,utilSetTransform:()=>gs,utilTotalExtent:()=>ft,utilTriggerEvent:()=>o1,utilWrap:()=>n1,validationAlmostJunction:()=>gg,validationAmbiguousCrossingTags:()=>xg,validationCloseNodes:()=>yg,validationCrossingWays:()=>vg,validationDisconnectedWay:()=>_g,validationDuplicateWaySegments:()=>bg,validationFormatting:()=>wg,validationHelpRequest:()=>Eg,validationImpossibleOneway:()=>Ag,validationIncompatibleSource:()=>Sg,validationMismatchedGeometry:()=>Cg,validationMissingRole:()=>kg,validationMissingTag:()=>Tg,validationOutdatedTags:()=>Ig,validationPrivateData:()=>Mg,validationSuspiciousName:()=>qg,validationUnsquareWay:()=>Qg,validationYShapedConnection:()=>Xg});function Mt(i){return function(e){return e.replace(i)}}var w3=et(Ey(),1),h7=et(b3(),1),LI=[250,157,60,79,142,134,229,129,138,126,210,129,29,71,160,208];function Ay(i,e){e=e||LI;let t=w3.default.utils.hex.toBytes(i),s=new w3.default.ModeOfOperation.ctr(e).decrypt(t);return w3.default.utils.utf8.fromBytes(s)}function ai(i,e){if(i===e)return!0;let t=i.length;if(t!==e.length)return!1;for(;t--;)if(i[t]!==e[t])return!1;return!0}function Di(i,e){let t=new Set(e);return Array.from(new Set(i)).filter(r=>!t.has(r))}function Vi(i,e){let t=new Set(e);return Array.from(new Set(i)).filter(r=>t.has(r))}function Gt(i,e){let t=new Set(i);return e.forEach(r=>t.add(r)),Array.from(t)}function Fe(i){return Array.from(new Set(i))}function p0(i,e){if(!e||e<0)return[i.slice()];let t=new Array(Math.ceil(i.length/e));return Array.from(t,(r,s)=>i.slice(s*e,s*e+e))}function Ut(i,e){return i.reduce((t,r)=>{let s=typeof e=="function"?e(r):r[e];return(t[s]=t[s]||[]).push(r),t},{})}function Nl(i,e){let t=new Set;return i.reduce((r,s)=>{let n=typeof e=="function"?e(s):s[e];return n&&!t.has(n)&&(t.add(n),r.push(s)),r},[])}function li(i,e){return Object.keys(i).reduce((t,r)=>(e.indexOf(r)===-1&&(t[r]=i[r]),t),{})}function d7(i){let e={};for(let r in i){if(!r)continue;let s=i[r];s!==void 0&&(e[r]=t(r,s))}return e;function t(r,s){function n(l){return/_hours|_times|:conditional$/.test(l)}function o(l){return/^(description|note|fixme)$/.test(l)}if(o(r))return s;let a=s.split(";").map(l=>l.trim()).join(n(r)?"; ":";");return(r.indexOf("website")!==-1||r.indexOf("email")!==-1||a.indexOf("http")===0)&&(a=a.replace(/[\u200B-\u200F\uFEFF]/g,"")),a}}function m0(i,e){let t=new Set(i);return i.forEach(r),OI(Array.from(t));function r(s){var n=e.hasEntity(s);!n||n.type!=="relation"||(n.members||[]).forEach(o=>t.add(o.id))}}function OI(i){return i.length?"."+i.join(",."):"nothing"}function Ft(i,e){let t=new Set,r=new Set;return i.forEach(s),Array.from(r);function s(n){if(t.has(n))return;t.add(n);let o=e.hasEntity(n);o&&(o.type==="node"?r.add(o):o.type==="way"?(o.nodes||[]).forEach(s):(o.members||[]).forEach(a=>s(a.id)))}}function jn(i,e){let t=[];return Gt(Object.keys(i),Object.keys(e)).sort().forEach(s=>{let n=i[s],o=e[s];(n||n==="")&&(o===void 0||o!==n)&&t.push({type:"-",key:s,oldVal:n,newVal:o,display:`- ${s}=${n}`}),(o||o==="")&&(n===void 0||o!==n)&&t.push({type:"+",key:s,oldVal:n,newVal:o,display:`+ ${s}=${o}`})}),t}function Sy(i){let e=i&&i.tags||{};return Object.keys(e).map(t=>`${t}=${e[t]}`).join(", ")}function Cy(i){let e;function t(){let s=new Date;s.setSeconds(s.getSeconds()+5),document.cookie=i+"=1; expires="+s.toUTCString()+"; sameSite=strict"}return{lock:()=>e?!0:document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+i+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")?!1:(t(),e=window.setInterval(t,4e3),!0),unlock:()=>{e&&(document.cookie=i+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; sameSite=strict",clearInterval(e),e=null)},locked:()=>!!e}}function E3(i,e){if(i=(0,h7.remove)(i.toLowerCase()),e=(0,h7.remove)(e.toLowerCase()),i.length===0)return e.length;if(e.length===0)return i.length;let t=[];for(let r=0;r<=e.length;r++)t[r]=[r];for(let r=0;r<=i.length;r++)t[0][r]=r;for(let r=1;r<=e.length;r++)for(let s=1;s<=i.length;s++)e.charAt(r-1)===i.charAt(s-1)?t[r][s]=t[r-1][s-1]:t[r][s]=Math.min(t[r-1][s-1]+1,Math.min(t[r][s-1]+1,t[r-1][s]+1));return t[e.length][i.length]}function g0(i){let e=0;if(i.length===0)return e;for(let t=0;t<i.length;t++){let r=i.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e}function tt(i,e){function t(r){return encodeURIComponent(r).replace(/(%2F|%3A|%2C|%7B|%7D)/g,decodeURIComponent)}return Object.keys(i).sort().map(r=>encodeURIComponent(r)+"="+(e?t(i[r]):encodeURIComponent(i[r]))).join("&")}function Vn(i){let e=0;for(;e<i.length&&(i[e]==="?"||i[e]==="#");)e++;return i=i.slice(e),i.split("&").reduce((t,r)=>{let s=r.split("=");return s.length===2&&(t[s[0]]=decodeURIComponent(s[1])),t},{})}function f7(i){return Array.from(i).length}function A3(i,e){return Array.from(i).slice(0,e).join("")}function Ta(i){return i.toLowerCase().replace(/[^a-z0-9]+/g,"_")}function us(i){return"rapideditor-"+Ta(i.toString())+"-"+new Date().getTime().toString()}function hs(i,e){var t=/^.*(_|:)?(description|name|note|website|ref|source|comment|watch|attribution)(_|:)?/,r=/^([+\-]?)(?=[\d.])/,s=/direction$/,n=/^turn:lanes:?/,o=[[/:right$/,":left"],[/:left$/,":right"],[/:forward$/,":backward"],[/:backward$/,":forward"],[/:right:/,":left:"],[/:left:/,":right:"],[/:forward:/,":backward:"],[/:backward:/,":forward:"]],a={left:"right",right:"left",up:"down",down:"up",forward:"backward",backward:"forward",forwards:"backward",backwards:"forward"},l={forward:"backward",backward:"forward",forwards:"backward",backwards:"forward"},c={yes:"-1",1:"-1","-1":"yes"},u={N:"S",NNE:"SSW",NE:"SW",ENE:"WSW",E:"W",ESE:"WNW",SE:"NW",SSE:"NNW",S:"N",SSW:"NNE",SW:"NE",WSW:"ENE",W:"E",WNW:"ESE",NW:"SE",NNW:"SSE"};function h(g){for(var y=0;y<o.length;++y){var x=o[y];if(x[0].test(g))return g.replace(x[0],x[1])}return g}function d(g,y,x){if(t.test(g)||n.test(g))return y;if(g==="incline"&&r.test(y))return y.replace(r,function(_,w){return w==="-"?"":"-"});if(e&&e.reverseOneway&&g==="oneway")return c[y]||y;if(x&&s.test(g)){if(u[y])return u[y];var b=parseFloat(y);if(typeof b=="number"&&!isNaN(b))return b<180?b+=180:b-=180,b.toString()}return a[y]||y}function f(g,y){for(var x=0;x<y.length;x++){var b=g.hasEntity(y[x]);if(!(!b||!Object.keys(b.tags).length)){var _={};for(var w in b.tags)_[h(w)]=d(w,b.tags[w],b.id===i);g=g.replace(b.update({tags:_}))}}return g}function p(g,y){var x=y.nodes.slice().reverse(),b={},_;for(var w in y.tags)b[h(w)]=d(w,y.tags[w]);return g.parentRelations(y).forEach(function(A){A.members.forEach(function(k,v){k.id===y.id&&(_=l[k.role])&&(A=A.updateMember({role:_},v),g=g.replace(A))})}),f(g,x).replace(y.update({nodes:x,tags:b}))}var m=function(g){var y=g.entity(i);return y.type==="way"?p(g,y):f(g,[i])};return m.disabled=function(g){var y=g.hasEntity(i);if(!y||y.type==="way")return!1;for(var x in y.tags){var b=y.tags[x];if(h(x)!==x||d(x,b,!0)!==b)return!1}return"nondirectional_node"},m.entityID=function(){return i},m}function lr(i){return i!=="attribution"&&i!=="created_by"&&i!=="source"&&i!=="odbl"&&i.indexOf("source:")!==0&&i.indexOf("source_ref")!==0&&i.indexOf("tiger:")!==0}var Ia={};function S3(i){Ia=i}var Po={proposed:!0,planned:!0,construction:!0,disused:!0,abandoned:!0,was:!0,dismantled:!0,razed:!0,demolished:!0,destroyed:!0,removed:!0,obliterated:!0,intermittent:!0};function y0(i){let e=i.split(":");return e.length===1?i:e[0]in Po?i.slice(e[0].length+1):i}var ky={highway:{elevator:!0,rest_area:!0,services:!0},public_transport:{platform:!0},railway:{platform:!0,roundhouse:!0,station:!0,traverser:!0,turntable:!0,wash:!0},traffic_calming:{island:!0},waterway:{dam:!0}};function Do(i){if(i.area==="yes")return{area:"yes"};if(i.area==="no")return null;var e={};for(var t in i){let r=y0(t);if(r in Ia&&!(i[t]in Ia[r])||r in ky&&i[t]in ky[r])return e[t]=i[t],e}return null}var Fl={};function C3(i){Fl=i}var Ll={};function k3(i){Ll=i}function Ro(i){var e={};for(var t in i)if(Fl[t]&&(Fl[t]["*"]||Fl[t][i[t]])&&(e.point=!0),Ll[t]&&(Ll[t]["*"]||Ll[t][i[t]])&&(e.vertex=!0),e.point&&e.vertex)break;return e}var No={aerialway:{chair_lift:!0,drag_lift:!0,"j-bar":!0,magic_carpet:!0,mixed_lift:!0,platter:!0,rope_tow:!0,"t-bar":!0,zip_line:!0},highway:{motorway:!0},junction:{circular:!0,roundabout:!0},man_made:{goods_conveyor:!0,"piste:halfpipe":!0},"piste:type":{downhill:!0,sled:!0,yes:!0},roller_coaster:{track:!0},"seamark:type":{"two-way_route":!0,recommended_traffic_lane:!0,separation_lane:!0,separation_roundabout:!0},waterway:{canal:!0,ditch:!0,drain:!0,fish_pass:!0,pressurised:!0,river:!0,spillway:!0,stream:!0,tidal_channel:!0}},Ma={surface:{paved:!0,asphalt:!0,concrete:!0,chipseal:!0,"concrete:lanes":!0,"concrete:plates":!0},tracktype:{grade1:!0}},p7={surface:{cobblestone:!0,"cobblestone:flattened":!0,unhewn_cobblestone:!0,sett:!0,paving_stones:!0,metal:!0,wood:!0}},x0={natural:{cliff:!0,coastline:"coastline"},barrier:{retaining_wall:!0,kerb:!0,guard_rail:!0,city_wall:!0},man_made:{embankment:!0},waterway:{weir:!0}},ds={motorway:!0,trunk:!0,primary:!0,secondary:!0,tertiary:!0,residential:!0,motorway_link:!0,trunk_link:!0,primary_link:!0,secondary_link:!0,tertiary_link:!0,unclassified:!0,road:!0,service:!0,track:!0,living_street:!0,bus_guideway:!0,busway:!0,path:!0,footway:!0,cycleway:!0,bridleway:!0,pedestrian:!0,corridor:!0,steps:!0},Ty={runway:!0,taxiway:!0},Bs={path:!0,footway:!0,cycleway:!0,bridleway:!0,pedestrian:!0,corridor:!0,steps:!0},T3={rail:!0,light_rail:!0,tram:!0,subway:!0,monorail:!0,funicular:!0,miniature:!0,narrow_gauge:!0,disused:!0,preserved:!0},Ol={canal:!0,ditch:!0,drain:!0,fish_pass:!0,river:!0,stream:!0,tidal_channel:!0};function cr(i,e){return i==null||e==null?NaN:i<e?-1:i>e?1:i>=e?0:NaN}function Fo(i,e){return i==null||e==null?NaN:e<i?-1:e>i?1:e>=i?0:NaN}function I3(i){let e,t,r;i.length!==2?(e=cr,t=(a,l)=>cr(i(a),l),r=(a,l)=>i(a)-l):(e=i===cr||i===Fo?i:UI,t=i,r=i);function s(a,l,c=0,u=a.length){if(c<u){if(e(l,l)!==0)return u;do{let h=c+u>>>1;t(a[h],l)<0?c=h+1:u=h}while(c<u)}return c}function n(a,l,c=0,u=a.length){if(c<u){if(e(l,l)!==0)return u;do{let h=c+u>>>1;t(a[h],l)<=0?c=h+1:u=h}while(c<u)}return c}function o(a,l,c=0,u=a.length){let h=s(a,l,c,u-1);return h>c&&r(a[h-1],l)>-r(a[h],l)?h-1:h}return{left:s,center:o,right:n}}function UI(){return 0}function M3(i){return i===null?NaN:+i}function*Iy(i,e){if(e===void 0)for(let t of i)t!=null&&(t=+t)>=t&&(yield t);else{let t=-1;for(let r of i)(r=e(r,++t,i))!=null&&(r=+r)>=r&&(yield r)}}var My=I3(cr),Py=My.right,$I=My.left,HI=I3(M3).center,m7=Py;var Ji=class{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){let t=this._partials,r=0;for(let s=0;s<this._n&&s<32;s++){let n=t[s],o=e+n,a=Math.abs(e)<Math.abs(n)?e-(o-n):n-(o-e);a&&(t[r++]=a),e=o}return t[r]=e,this._n=r+1,this}valueOf(){let e=this._partials,t=this._n,r,s,n,o=0;if(t>0){for(o=e[--t];t>0&&(r=o,s=e[--t],o=r+s,n=s-(o-r),!n););t>0&&(n<0&&e[t-1]<0||n>0&&e[t-1]>0)&&(s=n*2,r=o+s,s==r-o&&(o=r))}return o}};function Dy(i=cr){if(i===cr)return g7;if(typeof i!="function")throw new TypeError("compare is not a function");return(e,t)=>{let r=i(e,t);return r||r===0?r:(i(t,t)===0)-(i(e,e)===0)}}function g7(i,e){return(i==null||!(i>=i))-(e==null||!(e>=e))||(i<e?-1:i>e?1:0)}var GI=Math.sqrt(50),zI=Math.sqrt(10),jI=Math.sqrt(2);function P3(i,e,t){let r=(e-i)/Math.max(0,t),s=Math.floor(Math.log10(r)),n=r/Math.pow(10,s),o=n>=GI?10:n>=zI?5:n>=jI?2:1,a,l,c;return s<0?(c=Math.pow(10,-s)/o,a=Math.round(i*c),l=Math.round(e*c),a/c<i&&++a,l/c>e&&--l,c=-c):(c=Math.pow(10,s)*o,a=Math.round(i/c),l=Math.round(e/c),a*c<i&&++a,l*c>e&&--l),l<a&&.5<=t&&t<2?P3(i,e,t*2):[a,l,c]}function D3(i,e,t){if(e=+e,i=+i,t=+t,!(t>0))return[];if(i===e)return[i];let r=e<i,[s,n,o]=r?P3(e,i,t):P3(i,e,t);if(!(n>=s))return[];let a=n-s+1,l=new Array(a);if(r)if(o<0)for(let c=0;c<a;++c)l[c]=(n-c)/-o;else for(let c=0;c<a;++c)l[c]=(n-c)*o;else if(o<0)for(let c=0;c<a;++c)l[c]=(s+c)/-o;else for(let c=0;c<a;++c)l[c]=(s+c)*o;return l}function v0(i,e,t){return e=+e,i=+i,t=+t,P3(i,e,t)[2]}function y7(i,e,t){e=+e,i=+i,t=+t;let r=e<i,s=r?v0(e,i,t):v0(i,e,t);return(r?-1:1)*(s<0?1/-s:s)}function R3(i,e){let t;if(e===void 0)for(let r of i)r!=null&&(t<r||t===void 0&&r>=r)&&(t=r);else{let r=-1;for(let s of i)(s=e(s,++r,i))!=null&&(t<s||t===void 0&&s>=s)&&(t=s)}return t}function N3(i,e){let t;if(e===void 0)for(let r of i)r!=null&&(t>r||t===void 0&&r>=r)&&(t=r);else{let r=-1;for(let s of i)(s=e(s,++r,i))!=null&&(t>s||t===void 0&&s>=s)&&(t=s)}return t}function F3(i,e,t=0,r=1/0,s){if(e=Math.floor(e),t=Math.floor(Math.max(0,t)),r=Math.floor(Math.min(i.length-1,r)),!(t<=e&&e<=r))return i;for(s=s===void 0?g7:Dy(s);r>t;){if(r-t>600){let l=r-t+1,c=e-t+1,u=Math.log(l),h=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*h*(l-h)/l)*(c-l/2<0?-1:1),f=Math.max(t,Math.floor(e-c*h/l+d)),p=Math.min(r,Math.floor(e+(l-c)*h/l+d));F3(i,e,f,p,s)}let n=i[e],o=t,a=r;for(_0(i,t,e),s(i[r],n)>0&&_0(i,t,r);o<a;){for(_0(i,o,a),++o,--a;s(i[o],n)<0;)++o;for(;s(i[a],n)>0;)--a}s(i[t],n)===0?_0(i,t,a):(++a,_0(i,a,r)),a<=e&&(t=a+1),e<=a&&(r=a-1)}return i}function _0(i,e,t){let r=i[e];i[e]=i[t],i[t]=r}function x7(i,e,t){if(i=Float64Array.from(Iy(i,t)),!(!(r=i.length)||isNaN(e=+e))){if(e<=0||r<2)return N3(i);if(e>=1)return R3(i);var r,s=(r-1)*e,n=Math.floor(s),o=R3(F3(i,n).subarray(0,n+1)),a=N3(i.subarray(n+1));return o+(a-o)*(s-n)}}function L3(i,e){return x7(i,.5,e)}var Bl=1e-6,v7=1e-12,Ul=Math.PI,b0=Ul/2,_7=Ul/4,O3=Ul*2,Pa=180/Ul,Xt=Ul/180,$l=Math.abs,Ry=Math.atan,Wn=Math.atan2,ci=Math.cos;var Ny=Math.exp;var B3=Math.hypot,Fy=Math.log;var ui=Math.sin;var Hl=Math.sqrt,Ly=Math.tan;function w0(i){return i>1?b0:i<-1?-b0:Math.asin(i)}function ur(){}function U3(i,e){i&&By.hasOwnProperty(i.type)&&By[i.type](i,e)}var Oy={Feature:function(i,e){U3(i.geometry,e)},FeatureCollection:function(i,e){for(var t=i.features,r=-1,s=t.length;++r<s;)U3(t[r].geometry,e)}},By={Sphere:function(i,e){e.sphere()},Point:function(i,e){i=i.coordinates,e.point(i[0],i[1],i[2])},MultiPoint:function(i,e){for(var t=i.coordinates,r=-1,s=t.length;++r<s;)i=t[r],e.point(i[0],i[1],i[2])},LineString:function(i,e){b7(i.coordinates,e,0)},MultiLineString:function(i,e){for(var t=i.coordinates,r=-1,s=t.length;++r<s;)b7(t[r],e,0)},Polygon:function(i,e){Uy(i.coordinates,e)},MultiPolygon:function(i,e){for(var t=i.coordinates,r=-1,s=t.length;++r<s;)Uy(t[r],e)},GeometryCollection:function(i,e){for(var t=i.geometries,r=-1,s=t.length;++r<s;)U3(t[r],e)}};function b7(i,e,t){var r=-1,s=i.length-t,n;for(e.lineStart();++r<s;)n=i[r],e.point(n[0],n[1],n[2]);e.lineEnd()}function Uy(i,e){var t=-1,r=i.length;for(e.polygonStart();++t<r;)b7(i[t],e,1);e.polygonEnd()}function Lo(i,e){i&&Oy.hasOwnProperty(i.type)?Oy[i.type](i,e):U3(i,e)}var E0=new Ji,$3=new Ji,$y,Hy,w7,E7,A7,Us={point:ur,lineStart:ur,lineEnd:ur,polygonStart:function(){E0=new Ji,Us.lineStart=VI,Us.lineEnd=WI},polygonEnd:function(){var i=+E0;$3.add(i<0?O3+i:i),this.lineStart=this.lineEnd=this.point=ur},sphere:function(){$3.add(O3)}};function VI(){Us.point=XI}function WI(){Gy($y,Hy)}function XI(i,e){Us.point=Gy,$y=i,Hy=e,i*=Xt,e*=Xt,w7=i,E7=ci(e=e/2+_7),A7=ui(e)}function Gy(i,e){i*=Xt,e*=Xt,e=e/2+_7;var t=i-w7,r=t>=0?1:-1,s=r*t,n=ci(e),o=ui(e),a=A7*o,l=E7*n+a*ci(s),c=a*r*ui(s);E0.add(Wn(c,l)),w7=i,E7=n,A7=o}function hn(i){return $3=new Ji,Lo(i,Us),$3*2}function zy(i){return[Wn(i[1],i[0]),w0(i[2])]}function jy(i){var e=i[0],t=i[1],r=ci(t);return[r*ci(e),r*ui(e),ui(t)]}function S7(i,e){return[i[1]*e[2]-i[2]*e[1],i[2]*e[0]-i[0]*e[2],i[0]*e[1]-i[1]*e[0]]}function Vy(i){var e=Hl(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]/=e,i[1]/=e,i[2]/=e}var Zt,Mr,hi,Qr,Da,Qy,Yy,Gl,A0,Oo,qn,Xn={point:C7,lineStart:Wy,lineEnd:Xy,polygonStart:function(){Xn.point=Zy,Xn.lineStart=qI,Xn.lineEnd=QI,A0=new Ji,Us.polygonStart()},polygonEnd:function(){Us.polygonEnd(),Xn.point=C7,Xn.lineStart=Wy,Xn.lineEnd=Xy,E0<0?(Zt=-(hi=180),Mr=-(Qr=90)):A0>Bl?Qr=90:A0<-Bl&&(Mr=-90),qn[0]=Zt,qn[1]=hi},sphere:function(){Zt=-(hi=180),Mr=-(Qr=90)}};function C7(i,e){Oo.push(qn=[Zt=i,hi=i]),e<Mr&&(Mr=e),e>Qr&&(Qr=e)}function Ky(i,e){var t=jy([i*Xt,e*Xt]);if(Gl){var r=S7(Gl,t),s=[r[1],-r[0],0],n=S7(s,r);Vy(n),n=zy(n);var o=i-Da,a=o>0?1:-1,l=n[0]*Pa*a,c,u=$l(o)>180;u^(a*Da<l&&l<a*i)?(c=n[1]*Pa,c>Qr&&(Qr=c)):(l=(l+360)%360-180,u^(a*Da<l&&l<a*i)?(c=-n[1]*Pa,c<Mr&&(Mr=c)):(e<Mr&&(Mr=e),e>Qr&&(Qr=e))),u?i<Da?qr(Zt,i)>qr(Zt,hi)&&(hi=i):qr(i,hi)>qr(Zt,hi)&&(Zt=i):hi>=Zt?(i<Zt&&(Zt=i),i>hi&&(hi=i)):i>Da?qr(Zt,i)>qr(Zt,hi)&&(hi=i):qr(i,hi)>qr(Zt,hi)&&(Zt=i)}else Oo.push(qn=[Zt=i,hi=i]);e<Mr&&(Mr=e),e>Qr&&(Qr=e),Gl=t,Da=i}function Wy(){Xn.point=Ky}function Xy(){qn[0]=Zt,qn[1]=hi,Xn.point=C7,Gl=null}function Zy(i,e){if(Gl){var t=i-Da;A0.add($l(t)>180?t+(t>0?360:-360):t)}else Qy=i,Yy=e;Us.point(i,e),Ky(i,e)}function qI(){Us.lineStart()}function QI(){Zy(Qy,Yy),Us.lineEnd(),$l(A0)>Bl&&(Zt=-(hi=180)),qn[0]=Zt,qn[1]=hi,Gl=null}function qr(i,e){return(e-=i)<0?e+360:e}function YI(i,e){return i[0]-e[0]}function qy(i,e){return i[0]<=i[1]?i[0]<=e&&e<=i[1]:e<i[0]||i[1]<e}function k7(i){var e,t,r,s,n,o,a;if(Qr=hi=-(Zt=Mr=1/0),Oo=[],Lo(i,Xn),t=Oo.length){for(Oo.sort(YI),e=1,r=Oo[0],n=[r];e<t;++e)s=Oo[e],qy(r,s[0])||qy(r,s[1])?(qr(r[0],s[1])>qr(r[0],r[1])&&(r[1]=s[1]),qr(s[0],r[1])>qr(r[0],r[1])&&(r[0]=s[0])):n.push(r=s);for(o=-1/0,t=n.length-1,e=0,r=n[t];e<=t;r=s,++e)s=n[e],(a=qr(r[1],s[0]))>o&&(o=a,Zt=s[0],hi=r[1])}return Oo=qn=null,Zt===1/0||Mr===1/0?[[NaN,NaN],[NaN,NaN]]:[[Zt,Mr],[hi,Qr]]}var S0,H3,G3,z3,j3,V3,W3,X3,T7,I7,M7,tx,ix,hr,dr,fr,$s={sphere:ur,point:P7,lineStart:Jy,lineEnd:ex,polygonStart:function(){$s.lineStart=JI,$s.lineEnd=eM},polygonEnd:function(){$s.lineStart=Jy,$s.lineEnd=ex}};function P7(i,e){i*=Xt,e*=Xt;var t=ci(e);C0(t*ci(i),t*ui(i),ui(e))}function C0(i,e,t){++S0,G3+=(i-G3)/S0,z3+=(e-z3)/S0,j3+=(t-j3)/S0}function Jy(){$s.point=KI}function KI(i,e){i*=Xt,e*=Xt;var t=ci(e);hr=t*ci(i),dr=t*ui(i),fr=ui(e),$s.point=ZI,C0(hr,dr,fr)}function ZI(i,e){i*=Xt,e*=Xt;var t=ci(e),r=t*ci(i),s=t*ui(i),n=ui(e),o=Wn(Hl((o=dr*n-fr*s)*o+(o=fr*r-hr*n)*o+(o=hr*s-dr*r)*o),hr*r+dr*s+fr*n);H3+=o,V3+=o*(hr+(hr=r)),W3+=o*(dr+(dr=s)),X3+=o*(fr+(fr=n)),C0(hr,dr,fr)}function ex(){$s.point=P7}function JI(){$s.point=tM}function eM(){rx(tx,ix),$s.point=P7}function tM(i,e){tx=i,ix=e,i*=Xt,e*=Xt,$s.point=rx;var t=ci(e);hr=t*ci(i),dr=t*ui(i),fr=ui(e),C0(hr,dr,fr)}function rx(i,e){i*=Xt,e*=Xt;var t=ci(e),r=t*ci(i),s=t*ui(i),n=ui(e),o=dr*n-fr*s,a=fr*r-hr*n,l=hr*s-dr*r,c=B3(o,a,l),u=w0(c),h=c&&-u/c;T7.add(h*o),I7.add(h*a),M7.add(h*l),H3+=u,V3+=u*(hr+(hr=r)),W3+=u*(dr+(dr=s)),X3+=u*(fr+(fr=n)),C0(hr,dr,fr)}function D7(i){S0=H3=G3=z3=j3=V3=W3=X3=0,T7=new Ji,I7=new Ji,M7=new Ji,Lo(i,$s);var e=+T7,t=+I7,r=+M7,s=B3(e,t,r);return s<v7&&(e=V3,t=W3,r=X3,H3<Bl&&(e=G3,t=z3,r=j3),s=B3(e,t,r),s<v7)?[NaN,NaN]:[Wn(t,e)*Pa,w0(r/s)*Pa]}var R7,N7,q3,Q3,zl={sphere:ur,point:ur,lineStart:iM,lineEnd:ur,polygonStart:ur,polygonEnd:ur};function iM(){zl.point=sM,zl.lineEnd=rM}function rM(){zl.point=zl.lineEnd=ur}function sM(i,e){i*=Xt,e*=Xt,N7=i,q3=ui(e),Q3=ci(e),zl.point=nM}function nM(i,e){i*=Xt,e*=Xt;var t=ui(e),r=ci(e),s=$l(i-N7),n=ci(s),o=ui(s),a=r*o,l=Q3*t-q3*r*n,c=q3*t+Q3*r*n;R7.add(Wn(Hl(a*a+l*l),c)),N7=i,q3=t,Q3=r}function F7(i){return R7=new Ji,Lo(i,zl),+R7}function O7(i){return{stream:oM(i)}}function oM(i){return function(e){var t=new L7;for(var r in i)t[r]=i[r];return t.stream=e,t}}function L7(){}L7.prototype={constructor:L7,point:function(i,e){this.stream.point(i,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function jl(i,e){return[i,Fy(Ly((b0+e)/2))]}jl.invert=function(i,e){return[i,2*Ry(Ny(e))-b0]};function Vl(i){for(var e=-1,t=i.length,r,s=i[t-1],n=0;++e<t;)r=s,s=i[e],n+=r[1]*s[0]-r[0]*s[1];return n/2}function Pr(i){for(var e=-1,t=i.length,r=0,s=0,n,o=i[t-1],a,l=0;++e<t;)n=o,o=i[e],l+=a=n[0]*o[1]-o[0]*n[1],r+=(n[0]+o[0])*a,s+=(n[1]+o[1])*a;return l*=3,[r/l,s/l]}function sx(i,e,t){return(e[0]-i[0])*(t[1]-i[1])-(e[1]-i[1])*(t[0]-i[0])}function aM(i,e){return i[0]-e[0]||i[1]-e[1]}function nx(i){let e=i.length,t=[0,1],r=2,s;for(s=2;s<e;++s){for(;r>1&&sx(i[t[r-2]],i[t[r-1]],i[s])<=0;)--r;t[r++]=s}return t.slice(0,r)}function Hs(i){if((t=i.length)<3)return null;var e,t,r=new Array(t),s=new Array(t);for(e=0;e<t;++e)r[e]=[+i[e][0],+i[e][1],e];for(r.sort(aM),e=0;e<t;++e)s[e]=[r[e][0],-r[e][1]];var n=nx(r),o=nx(s),a=o[0]===n[0],l=o[o.length-1]===n[n.length-1],c=[];for(e=n.length-1;e>=0;--e)c.push(i[r[n[e]][2]]);for(e=+a;e<o.length-l;++e)c.push(i[r[o[e]][2]]);return c}var lM={value:()=>{}};function ax(){for(var i=0,e=arguments.length,t={},r;i<e;++i){if(!(r=arguments[i]+"")||r in t||/[\s.]/.test(r))throw new Error("illegal type: "+r);t[r]=[]}return new Y3(t)}function Y3(i){this._=i}function cM(i,e){return i.trim().split(/^|\s+/).map(function(t){var r="",s=t.indexOf(".");if(s>=0&&(r=t.slice(s+1),t=t.slice(0,s)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:r}})}Y3.prototype=ax.prototype={constructor:Y3,on:function(i,e){var t=this._,r=cM(i+"",t),s,n=-1,o=r.length;if(arguments.length<2){for(;++n<o;)if((s=(i=r[n]).type)&&(s=uM(t[s],i.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++n<o;)if(s=(i=r[n]).type)t[s]=ox(t[s],i.name,e);else if(e==null)for(s in t)t[s]=ox(t[s],i.name,null);return this},copy:function(){var i={},e=this._;for(var t in e)i[t]=e[t].slice();return new Y3(i)},call:function(i,e){if((s=arguments.length-2)>0)for(var t=new Array(s),r=0,s,n;r<s;++r)t[r]=arguments[r+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(n=this._[i],r=0,s=n.length;r<s;++r)n[r].value.apply(e,t)},apply:function(i,e,t){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var r=this._[i],s=0,n=r.length;s<n;++s)r[s].value.apply(e,t)}};function uM(i,e){for(var t=0,r=i.length,s;t<r;++t)if((s=i[t]).name===e)return s.value}function ox(i,e,t){for(var r=0,s=i.length;r<s;++r)if(i[r].name===e){i[r]=lM,i=i.slice(0,r).concat(i.slice(r+1));break}return t!=null&&i.push({name:e,value:t}),i}var ue=ax;var K3="http://www.w3.org/1999/xhtml",B7={svg:"http://www.w3.org/2000/svg",xhtml:K3,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Qn(i){var e=i+="",t=e.indexOf(":");return t>=0&&(e=i.slice(0,t))!=="xmlns"&&(i=i.slice(t+1)),B7.hasOwnProperty(e)?{space:B7[e],local:i}:i}function hM(i){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===K3&&e.documentElement.namespaceURI===K3?e.createElement(i):e.createElementNS(t,i)}}function dM(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function Z3(i){var e=Qn(i);return(e.local?dM:hM)(e)}function fM(){}function Ra(i){return i==null?fM:function(){return this.querySelector(i)}}function lx(i){typeof i!="function"&&(i=Ra(i));for(var e=this._groups,t=e.length,r=new Array(t),s=0;s<t;++s)for(var n=e[s],o=n.length,a=r[s]=new Array(o),l,c,u=0;u<o;++u)(l=n[u])&&(c=i.call(l,l.__data__,u,n))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new zt(r,this._parents)}function k0(i){return i==null?[]:Array.isArray(i)?i:Array.from(i)}function pM(){return[]}function T0(i){return i==null?pM:function(){return this.querySelectorAll(i)}}function mM(i){return function(){return k0(i.apply(this,arguments))}}function cx(i){typeof i=="function"?i=mM(i):i=T0(i);for(var e=this._groups,t=e.length,r=[],s=[],n=0;n<t;++n)for(var o=e[n],a=o.length,l,c=0;c<a;++c)(l=o[c])&&(r.push(i.call(l,l.__data__,c,o)),s.push(l));return new zt(r,s)}function I0(i){return function(){return this.matches(i)}}function J3(i){return function(e){return e.matches(i)}}var gM=Array.prototype.find;function yM(i){return function(){return gM.call(this.children,i)}}function xM(){return this.firstElementChild}function ux(i){return this.select(i==null?xM:yM(typeof i=="function"?i:J3(i)))}var vM=Array.prototype.filter;function _M(){return Array.from(this.children)}function bM(i){return function(){return vM.call(this.children,i)}}function hx(i){return this.selectAll(i==null?_M:bM(typeof i=="function"?i:J3(i)))}function dx(i){typeof i!="function"&&(i=I0(i));for(var e=this._groups,t=e.length,r=new Array(t),s=0;s<t;++s)for(var n=e[s],o=n.length,a=r[s]=[],l,c=0;c<o;++c)(l=n[c])&&i.call(l,l.__data__,c,n)&&a.push(l);return new zt(r,this._parents)}function e5(i){return new Array(i.length)}function fx(){return new zt(this._enter||this._groups.map(e5),this._parents)}function M0(i,e){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=e}M0.prototype={constructor:M0,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,e){return this._parent.insertBefore(i,e)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function px(i){return function(){return i}}function wM(i,e,t,r,s,n){for(var o=0,a,l=e.length,c=n.length;o<c;++o)(a=e[o])?(a.__data__=n[o],r[o]=a):t[o]=new M0(i,n[o]);for(;o<l;++o)(a=e[o])&&(s[o]=a)}function EM(i,e,t,r,s,n,o){var a,l,c=new Map,u=e.length,h=n.length,d=new Array(u),f;for(a=0;a<u;++a)(l=e[a])&&(d[a]=f=o.call(l,l.__data__,a,e)+"",c.has(f)?s[a]=l:c.set(f,l));for(a=0;a<h;++a)f=o.call(i,n[a],a,n)+"",(l=c.get(f))?(r[a]=l,l.__data__=n[a],c.delete(f)):t[a]=new M0(i,n[a]);for(a=0;a<u;++a)(l=e[a])&&c.get(d[a])===l&&(s[a]=l)}function AM(i){return i.__data__}function mx(i,e){if(!arguments.length)return Array.from(this,AM);var t=e?EM:wM,r=this._parents,s=this._groups;typeof i!="function"&&(i=px(i));for(var n=s.length,o=new Array(n),a=new Array(n),l=new Array(n),c=0;c<n;++c){var u=r[c],h=s[c],d=h.length,f=SM(i.call(u,u&&u.__data__,c,r)),p=f.length,m=a[c]=new Array(p),g=o[c]=new Array(p),y=l[c]=new Array(d);t(u,h,m,g,y,f,e);for(var x=0,b=0,_,w;x<p;++x)if(_=m[x]){for(x>=b&&(b=x+1);!(w=g[b])&&++b<p;);_._next=w||null}}return o=new zt(o,r),o._enter=a,o._exit=l,o}function SM(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function gx(){return new zt(this._exit||this._groups.map(e5),this._parents)}function yx(i,e,t){var r=this.enter(),s=this,n=this.exit();return typeof i=="function"?(r=i(r),r&&(r=r.selection())):r=r.append(i+""),e!=null&&(s=e(s),s&&(s=s.selection())),t==null?n.remove():t(n),r&&s?r.merge(s).order():s}function xx(i){for(var e=i.selection?i.selection():i,t=this._groups,r=e._groups,s=t.length,n=r.length,o=Math.min(s,n),a=new Array(s),l=0;l<o;++l)for(var c=t[l],u=r[l],h=c.length,d=a[l]=new Array(h),f,p=0;p<h;++p)(f=c[p]||u[p])&&(d[p]=f);for(;l<s;++l)a[l]=t[l];return new zt(a,this._parents)}function vx(){for(var i=this._groups,e=-1,t=i.length;++e<t;)for(var r=i[e],s=r.length-1,n=r[s],o;--s>=0;)(o=r[s])&&(n&&o.compareDocumentPosition(n)^4&&n.parentNode.insertBefore(o,n),n=o);return this}function _x(i){i||(i=CM);function e(h,d){return h&&d?i(h.__data__,d.__data__):!h-!d}for(var t=this._groups,r=t.length,s=new Array(r),n=0;n<r;++n){for(var o=t[n],a=o.length,l=s[n]=new Array(a),c,u=0;u<a;++u)(c=o[u])&&(l[u]=c);l.sort(e)}return new zt(s,this._parents).order()}function CM(i,e){return i<e?-1:i>e?1:i>=e?0:NaN}function bx(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function wx(){return Array.from(this)}function Ex(){for(var i=this._groups,e=0,t=i.length;e<t;++e)for(var r=i[e],s=0,n=r.length;s<n;++s){var o=r[s];if(o)return o}return null}function Ax(){let i=0;for(let e of this)++i;return i}function Sx(){return!this.node()}function Cx(i){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var s=e[t],n=0,o=s.length,a;n<o;++n)(a=s[n])&&i.call(a,a.__data__,n,s);return this}function kM(i){return function(){this.removeAttribute(i)}}function TM(i){return function(){this.removeAttributeNS(i.space,i.local)}}function IM(i,e){return function(){this.setAttribute(i,e)}}function MM(i,e){return function(){this.setAttributeNS(i.space,i.local,e)}}function PM(i,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(i):this.setAttribute(i,t)}}function DM(i,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,t)}}function kx(i,e){var t=Qn(i);if(arguments.length<2){var r=this.node();return t.local?r.getAttributeNS(t.space,t.local):r.getAttribute(t)}return this.each((e==null?t.local?TM:kM:typeof e=="function"?t.local?DM:PM:t.local?MM:IM)(t,e))}function t5(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function RM(i){return function(){this.style.removeProperty(i)}}function NM(i,e,t){return function(){this.style.setProperty(i,e,t)}}function FM(i,e,t){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(i):this.style.setProperty(i,r,t)}}function Tx(i,e,t){return arguments.length>1?this.each((e==null?RM:typeof e=="function"?FM:NM)(i,e,t==null?"":t)):Bo(this.node(),i)}function Bo(i,e){return i.style.getPropertyValue(e)||t5(i).getComputedStyle(i,null).getPropertyValue(e)}function LM(i){return function(){delete this[i]}}function OM(i,e){return function(){this[i]=e}}function BM(i,e){return function(){var t=e.apply(this,arguments);t==null?delete this[i]:this[i]=t}}function Ix(i,e){return arguments.length>1?this.each((e==null?LM:typeof e=="function"?BM:OM)(i,e)):this.node()[i]}function Mx(i){return i.trim().split(/^|\s+/)}function U7(i){return i.classList||new Px(i)}function Px(i){this._node=i,this._names=Mx(i.getAttribute("class")||"")}Px.prototype={add:function(i){var e=this._names.indexOf(i);e<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var e=this._names.indexOf(i);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function Dx(i,e){for(var t=U7(i),r=-1,s=e.length;++r<s;)t.add(e[r])}function Rx(i,e){for(var t=U7(i),r=-1,s=e.length;++r<s;)t.remove(e[r])}function UM(i){return function(){Dx(this,i)}}function $M(i){return function(){Rx(this,i)}}function HM(i,e){return function(){(e.apply(this,arguments)?Dx:Rx)(this,i)}}function Nx(i,e){var t=Mx(i+"");if(arguments.length<2){for(var r=U7(this.node()),s=-1,n=t.length;++s<n;)if(!r.contains(t[s]))return!1;return!0}return this.each((typeof e=="function"?HM:e?UM:$M)(t,e))}function GM(){this.textContent=""}function zM(i){return function(){this.textContent=i}}function jM(i){return function(){var e=i.apply(this,arguments);this.textContent=e==null?"":e}}function Fx(i){return arguments.length?this.each(i==null?GM:(typeof i=="function"?jM:zM)(i)):this.node().textContent}function VM(){this.innerHTML=""}function WM(i){return function(){this.innerHTML=i}}function XM(i){return function(){var e=i.apply(this,arguments);this.innerHTML=e==null?"":e}}function Lx(i){return arguments.length?this.each(i==null?VM:(typeof i=="function"?XM:WM)(i)):this.node().innerHTML}function qM(){this.nextSibling&&this.parentNode.appendChild(this)}function Ox(){return this.each(qM)}function QM(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Bx(){return this.each(QM)}function Ux(i){var e=typeof i=="function"?i:Z3(i);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function YM(){return null}function $x(i,e){var t=typeof i=="function"?i:Z3(i),r=e==null?YM:typeof e=="function"?e:Ra(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),r.apply(this,arguments)||null)})}function KM(){var i=this.parentNode;i&&i.removeChild(this)}function Hx(){return this.each(KM)}function ZM(){var i=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function JM(){var i=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function Gx(i){return this.select(i?JM:ZM)}function zx(i){return arguments.length?this.property("__data__",i):this.node().__data__}function eP(i){return function(e){i.call(this,e,this.__data__)}}function tP(i){return i.trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}})}function iP(i){return function(){var e=this.__on;if(e){for(var t=0,r=-1,s=e.length,n;t<s;++t)n=e[t],(!i.type||n.type===i.type)&&n.name===i.name?this.removeEventListener(n.type,n.listener,n.options):e[++r]=n;++r?e.length=r:delete this.__on}}}function rP(i,e,t){return function(){var r=this.__on,s,n=eP(e);if(r){for(var o=0,a=r.length;o<a;++o)if((s=r[o]).type===i.type&&s.name===i.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=n,s.options=t),s.value=e;return}}this.addEventListener(i.type,n,t),s={type:i.type,name:i.name,value:e,listener:n,options:t},r?r.push(s):this.__on=[s]}}function jx(i,e,t){var r=tP(i+""),s,n=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,u;l<c;++l)for(s=0,u=a[l];s<n;++s)if((o=r[s]).type===u.type&&o.name===u.name)return u.value}return}for(a=e?rP:iP,s=0;s<n;++s)this.each(a(r[s],e,t));return this}function Vx(i,e,t){var r=t5(i),s=r.CustomEvent;typeof s=="function"?s=new s(e,t):(s=r.document.createEvent("Event"),t?(s.initEvent(e,t.bubbles,t.cancelable),s.detail=t.detail):s.initEvent(e,!1,!1)),i.dispatchEvent(s)}function sP(i,e){return function(){return Vx(this,i,e)}}function nP(i,e){return function(){return Vx(this,i,e.apply(this,arguments))}}function Wx(i,e){return this.each((typeof e=="function"?nP:sP)(i,e))}function*Xx(){for(var i=this._groups,e=0,t=i.length;e<t;++e)for(var r=i[e],s=0,n=r.length,o;s<n;++s)(o=r[s])&&(yield o)}var P0=[null];function zt(i,e){this._groups=i,this._parents=e}function qx(){return new zt([[document.documentElement]],P0)}function oP(){return this}zt.prototype=qx.prototype={constructor:zt,select:lx,selectAll:cx,selectChild:ux,selectChildren:hx,filter:dx,data:mx,enter:fx,exit:gx,join:yx,merge:xx,selection:oP,order:vx,sort:_x,call:bx,nodes:wx,node:Ex,size:Ax,empty:Sx,each:Cx,attr:kx,style:Tx,property:Ix,classed:Nx,text:Fx,html:Lx,raise:Ox,lower:Bx,append:Ux,insert:$x,remove:Hx,clone:Gx,datum:zx,on:jx,dispatch:Wx,[Symbol.iterator]:Xx};var Yn=qx;function G(i){return typeof i=="string"?new zt([[document.querySelector(i)]],[document.documentElement]):new zt([[i]],P0)}function Qx(i){let e;for(;e=i.sourceEvent;)i=e;return i}function fs(i,e){if(i=Qx(i),e===void 0&&(e=i.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var r=t.createSVGPoint();return r.x=i.clientX,r.y=i.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var s=e.getBoundingClientRect();return[i.clientX-s.left-e.clientLeft,i.clientY-s.top-e.clientTop]}}return[i.pageX,i.pageY]}function $7(i){return typeof i=="string"?new zt([document.querySelectorAll(i)],[document.documentElement]):new zt([k0(i)],P0)}var Yx={passive:!1},Na={capture:!0,passive:!1};function i5(i){i.stopImmediatePropagation()}function Uo(i){i.preventDefault(),i.stopImmediatePropagation()}function D0(i){var e=i.document.documentElement,t=G(i).on("dragstart.drag",Uo,Na);"onselectstart"in e?t.on("selectstart.drag",Uo,Na):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function R0(i,e){var t=i.document.documentElement,r=G(i).on("dragstart.drag",null);e&&(r.on("click.drag",Uo,Na),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in t?r.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}var N0=i=>()=>i;function F0(i,{sourceEvent:e,subject:t,target:r,identifier:s,active:n,x:o,y:a,dx:l,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:i,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:n,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}F0.prototype.on=function(){var i=this._.on.apply(this._,arguments);return i===this._?this:i};function aP(i){return!i.ctrlKey&&!i.button}function lP(){return this.parentNode}function cP(i,e){return e==null?{x:i.x,y:i.y}:e}function uP(){return navigator.maxTouchPoints||"ontouchstart"in this}function L0(){var i=aP,e=lP,t=cP,r=uP,s={},n=ue("start","drag","end"),o=0,a,l,c,u,h=0;function d(_){_.on("mousedown.drag",f).filter(r).on("touchstart.drag",g).on("touchmove.drag",y,Yx).on("touchend.drag touchcancel.drag",x).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(_,w){if(!(u||!i.call(this,_,w))){var A=b(this,e.call(this,_,w),_,w,"mouse");A&&(G(_.view).on("mousemove.drag",p,Na).on("mouseup.drag",m,Na),D0(_.view),i5(_),c=!1,a=_.clientX,l=_.clientY,A("start",_))}}function p(_){if(Uo(_),!c){var w=_.clientX-a,A=_.clientY-l;c=w*w+A*A>h}s.mouse("drag",_)}function m(_){G(_.view).on("mousemove.drag mouseup.drag",null),R0(_.view,c),Uo(_),s.mouse("end",_)}function g(_,w){if(i.call(this,_,w)){var A=_.changedTouches,k=e.call(this,_,w),v=A.length,E,S;for(E=0;E<v;++E)(S=b(this,k,_,w,A[E].identifier,A[E]))&&(i5(_),S("start",_,A[E]))}}function y(_){var w=_.changedTouches,A=w.length,k,v;for(k=0;k<A;++k)(v=s[w[k].identifier])&&(Uo(_),v("drag",_,w[k]))}function x(_){var w=_.changedTouches,A=w.length,k,v;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),k=0;k<A;++k)(v=s[w[k].identifier])&&(i5(_),v("end",_,w[k]))}function b(_,w,A,k,v,E){var S=n.copy(),M=fs(E||A,w),I,T,C;if((C=t.call(_,new F0("beforestart",{sourceEvent:A,target:d,identifier:v,active:o,x:M[0],y:M[1],dx:0,dy:0,dispatch:S}),k))!=null)return I=C.x-M[0]||0,T=C.y-M[1]||0,function P(D,O,R){var N=M,F;switch(D){case"start":s[v]=P,F=o++;break;case"end":delete s[v],--o;case"drag":M=fs(R||O,w),F=o;break}S.call(D,_,new F0(D,{sourceEvent:O,subject:C,target:d,identifier:v,active:F,x:M[0]+I,y:M[1]+T,dx:M[0]-N[0],dy:M[1]-N[1],dispatch:S}),k)}}return d.filter=function(_){return arguments.length?(i=typeof _=="function"?_:N0(!!_),d):i},d.container=function(_){return arguments.length?(e=typeof _=="function"?_:N0(_),d):e},d.subject=function(_){return arguments.length?(t=typeof _=="function"?_:N0(_),d):t},d.touchable=function(_){return arguments.length?(r=typeof _=="function"?_:N0(!!_),d):r},d.on=function(){var _=n.on.apply(n,arguments);return _===n?d:_},d.clickDistance=function(_){return arguments.length?(h=(_=+_)*_,d):Math.sqrt(h)},d}function r5(i,e,t){i.prototype=e.prototype=t,t.constructor=i}function H7(i,e){var t=Object.create(i.prototype);for(var r in e)t[r]=e[r];return t}function U0(){}var O0=.7,o5=1/O0,Wl="\\s*([+-]?\\d+)\\s*",B0="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",dn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",hP=/^#([0-9a-f]{3,8})$/,dP=new RegExp(`^rgb\\(${Wl},${Wl},${Wl}\\)$`),fP=new RegExp(`^rgb\\(${dn},${dn},${dn}\\)$`),pP=new RegExp(`^rgba\\(${Wl},${Wl},${Wl},${B0}\\)$`),mP=new RegExp(`^rgba\\(${dn},${dn},${dn},${B0}\\)$`),gP=new RegExp(`^hsl\\(${B0},${dn},${dn}\\)$`),yP=new RegExp(`^hsla\\(${B0},${dn},${dn},${B0}\\)$`),Kx={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};r5(U0,zs,{copy(i){return Object.assign(new this.constructor,this,i)},displayable(){return this.rgb().displayable()},hex:Zx,formatHex:Zx,formatHex8:xP,formatHsl:vP,formatRgb:Jx,toString:Jx});function Zx(){return this.rgb().formatHex()}function xP(){return this.rgb().formatHex8()}function vP(){return nv(this).formatHsl()}function Jx(){return this.rgb().formatRgb()}function zs(i){var e,t;return i=(i+"").trim().toLowerCase(),(e=hP.exec(i))?(t=e[1].length,e=parseInt(e[1],16),t===6?ev(e):t===3?new Dr(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?s5(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?s5(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=dP.exec(i))?new Dr(e[1],e[2],e[3],1):(e=fP.exec(i))?new Dr(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=pP.exec(i))?s5(e[1],e[2],e[3],e[4]):(e=mP.exec(i))?s5(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=gP.exec(i))?rv(e[1],e[2]/100,e[3]/100,1):(e=yP.exec(i))?rv(e[1],e[2]/100,e[3]/100,e[4]):Kx.hasOwnProperty(i)?ev(Kx[i]):i==="transparent"?new Dr(NaN,NaN,NaN,0):null}function ev(i){return new Dr(i>>16&255,i>>8&255,i&255,1)}function s5(i,e,t,r){return r<=0&&(i=e=t=NaN),new Dr(i,e,t,r)}function _P(i){return i instanceof U0||(i=zs(i)),i?(i=i.rgb(),new Dr(i.r,i.g,i.b,i.opacity)):new Dr}function Xl(i,e,t,r){return arguments.length===1?_P(i):new Dr(i,e,t,r==null?1:r)}function Dr(i,e,t,r){this.r=+i,this.g=+e,this.b=+t,this.opacity=+r}r5(Dr,Xl,H7(U0,{brighter(i){return i=i==null?o5:Math.pow(o5,i),new Dr(this.r*i,this.g*i,this.b*i,this.opacity)},darker(i){return i=i==null?O0:Math.pow(O0,i),new Dr(this.r*i,this.g*i,this.b*i,this.opacity)},rgb(){return this},clamp(){return new Dr(La(this.r),La(this.g),La(this.b),a5(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:tv,formatHex:tv,formatHex8:bP,formatRgb:iv,toString:iv}));function tv(){return`#${Fa(this.r)}${Fa(this.g)}${Fa(this.b)}`}function bP(){return`#${Fa(this.r)}${Fa(this.g)}${Fa(this.b)}${Fa((isNaN(this.opacity)?1:this.opacity)*255)}`}function iv(){let i=a5(this.opacity);return`${i===1?"rgb(":"rgba("}${La(this.r)}, ${La(this.g)}, ${La(this.b)}${i===1?")":`, ${i})`}`}function a5(i){return isNaN(i)?1:Math.max(0,Math.min(1,i))}function La(i){return Math.max(0,Math.min(255,Math.round(i)||0))}function Fa(i){return i=La(i),(i<16?"0":"")+i.toString(16)}function rv(i,e,t,r){return r<=0?i=e=t=NaN:t<=0||t>=1?i=e=NaN:e<=0&&(i=NaN),new Gs(i,e,t,r)}function nv(i){if(i instanceof Gs)return new Gs(i.h,i.s,i.l,i.opacity);if(i instanceof U0||(i=zs(i)),!i)return new Gs;if(i instanceof Gs)return i;i=i.rgb();var e=i.r/255,t=i.g/255,r=i.b/255,s=Math.min(e,t,r),n=Math.max(e,t,r),o=NaN,a=n-s,l=(n+s)/2;return a?(e===n?o=(t-r)/a+(t<r)*6:t===n?o=(r-e)/a+2:o=(e-t)/a+4,a/=l<.5?n+s:2-n-s,o*=60):a=l>0&&l<1?0:o,new Gs(o,a,l,i.opacity)}function ov(i,e,t,r){return arguments.length===1?nv(i):new Gs(i,e,t,r==null?1:r)}function Gs(i,e,t,r){this.h=+i,this.s=+e,this.l=+t,this.opacity=+r}r5(Gs,ov,H7(U0,{brighter(i){return i=i==null?o5:Math.pow(o5,i),new Gs(this.h,this.s,this.l*i,this.opacity)},darker(i){return i=i==null?O0:Math.pow(O0,i),new Gs(this.h,this.s,this.l*i,this.opacity)},rgb(){var i=this.h%360+(this.h<0)*360,e=isNaN(i)||isNaN(this.s)?0:this.s,t=this.l,r=t+(t<.5?t:1-t)*e,s=2*t-r;return new Dr(G7(i>=240?i-240:i+120,s,r),G7(i,s,r),G7(i<120?i+240:i-120,s,r),this.opacity)},clamp(){return new Gs(sv(this.h),n5(this.s),n5(this.l),a5(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let i=a5(this.opacity);return`${i===1?"hsl(":"hsla("}${sv(this.h)}, ${n5(this.s)*100}%, ${n5(this.l)*100}%${i===1?")":`, ${i})`}`}}));function sv(i){return i=(i||0)%360,i<0?i+360:i}function n5(i){return Math.max(0,Math.min(1,i||0))}function G7(i,e,t){return(i<60?e+(t-e)*i/60:i<180?t:i<240?e+(t-e)*(240-i)/60:e)*255}function z7(i,e,t,r,s){var n=i*i,o=n*i;return((1-3*i+3*n-o)*e+(4-6*n+3*o)*t+(1+3*i+3*n-3*o)*r+o*s)/6}function av(i){var e=i.length-1;return function(t){var r=t<=0?t=0:t>=1?(t=1,e-1):Math.floor(t*e),s=i[r],n=i[r+1],o=r>0?i[r-1]:2*s-n,a=r<e-1?i[r+2]:2*n-s;return z7((t-r/e)*e,o,s,n,a)}}function lv(i){var e=i.length;return function(t){var r=Math.floor(((t%=1)<0?++t:t)*e),s=i[(r+e-1)%e],n=i[r%e],o=i[(r+1)%e],a=i[(r+2)%e];return z7((t-r/e)*e,s,n,o,a)}}var $0=i=>()=>i;function wP(i,e){return function(t){return i+t*e}}function EP(i,e,t){return i=Math.pow(i,t),e=Math.pow(e,t)-i,t=1/t,function(r){return Math.pow(i+r*e,t)}}function cv(i){return(i=+i)==1?l5:function(e,t){return t-e?EP(e,t,i):$0(isNaN(e)?t:e)}}function l5(i,e){var t=e-i;return t?wP(i,t):$0(isNaN(i)?e:i)}var fn=function i(e){var t=cv(e);function r(s,n){var o=t((s=Xl(s)).r,(n=Xl(n)).r),a=t(s.g,n.g),l=t(s.b,n.b),c=l5(s.opacity,n.opacity);return function(u){return s.r=o(u),s.g=a(u),s.b=l(u),s.opacity=c(u),s+""}}return r.gamma=i,r}(1);function uv(i){return function(e){var t=e.length,r=new Array(t),s=new Array(t),n=new Array(t),o,a;for(o=0;o<t;++o)a=Xl(e[o]),r[o]=a.r||0,s[o]=a.g||0,n[o]=a.b||0;return r=i(r),s=i(s),n=i(n),a.opacity=1,function(l){return a.r=r(l),a.g=s(l),a.b=n(l),a+""}}}var AP=uv(av),SP=uv(lv);function hv(i,e){e||(e=[]);var t=i?Math.min(e.length,i.length):0,r=e.slice(),s;return function(n){for(s=0;s<t;++s)r[s]=i[s]*(1-n)+e[s]*n;return r}}function dv(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function fv(i,e){var t=e?e.length:0,r=i?Math.min(t,i.length):0,s=new Array(r),n=new Array(t),o;for(o=0;o<r;++o)s[o]=pn(i[o],e[o]);for(;o<t;++o)n[o]=e[o];return function(a){for(o=0;o<r;++o)n[o]=s[o](a);return n}}function pv(i,e){var t=new Date;return i=+i,e=+e,function(r){return t.setTime(i*(1-r)+e*r),t}}function qt(i,e){return i=+i,e=+e,function(t){return i*(1-t)+e*t}}function mv(i,e){var t={},r={},s;(i===null||typeof i!="object")&&(i={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in i?t[s]=pn(i[s],e[s]):r[s]=e[s];return function(n){for(s in t)r[s]=t[s](n);return r}}var V7=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,j7=new RegExp(V7.source,"g");function CP(i){return function(){return i}}function kP(i){return function(e){return i(e)+""}}function H0(i,e){var t=V7.lastIndex=j7.lastIndex=0,r,s,n,o=-1,a=[],l=[];for(i=i+"",e=e+"";(r=V7.exec(i))&&(s=j7.exec(e));)(n=s.index)>t&&(n=e.slice(t,n),a[o]?a[o]+=n:a[++o]=n),(r=r[0])===(s=s[0])?a[o]?a[o]+=s:a[++o]=s:(a[++o]=null,l.push({i:o,x:qt(r,s)})),t=j7.lastIndex;return t<e.length&&(n=e.slice(t),a[o]?a[o]+=n:a[++o]=n),a.length<2?l[0]?kP(l[0].x):CP(e):(e=l.length,function(c){for(var u=0,h;u<e;++u)a[(h=l[u]).i]=h.x(c);return a.join("")})}function pn(i,e){var t=typeof e,r;return e==null||t==="boolean"?$0(e):(t==="number"?qt:t==="string"?(r=zs(e))?(e=r,fn):H0:e instanceof zs?fn:e instanceof Date?pv:dv(e)?hv:Array.isArray(e)?fv:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?mv:qt)(i,e)}function W7(i,e){return i=+i,e=+e,function(t){return Math.round(i*(1-t)+e*t)}}var gv=180/Math.PI,c5={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function X7(i,e,t,r,s,n){var o,a,l;return(o=Math.sqrt(i*i+e*e))&&(i/=o,e/=o),(l=i*t+e*r)&&(t-=i*l,r-=e*l),(a=Math.sqrt(t*t+r*r))&&(t/=a,r/=a,l/=a),i*r<e*t&&(i=-i,e=-e,l=-l,o=-o),{translateX:s,translateY:n,rotate:Math.atan2(e,i)*gv,skewX:Math.atan(l)*gv,scaleX:o,scaleY:a}}var u5;function yv(i){let e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(i+"");return e.isIdentity?c5:X7(e.a,e.b,e.c,e.d,e.e,e.f)}function xv(i){return i==null?c5:(u5||(u5=document.createElementNS("http://www.w3.org/2000/svg","g")),u5.setAttribute("transform",i),(i=u5.transform.baseVal.consolidate())?(i=i.matrix,X7(i.a,i.b,i.c,i.d,i.e,i.f)):c5)}function vv(i,e,t,r){function s(c){return c.length?c.pop()+" ":""}function n(c,u,h,d,f,p){if(c!==h||u!==d){var m=f.push("translate(",null,e,null,t);p.push({i:m-4,x:qt(c,h)},{i:m-2,x:qt(u,d)})}else(h||d)&&f.push("translate("+h+e+d+t)}function o(c,u,h,d){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),d.push({i:h.push(s(h)+"rotate(",null,r)-2,x:qt(c,u)})):u&&h.push(s(h)+"rotate("+u+r)}function a(c,u,h,d){c!==u?d.push({i:h.push(s(h)+"skewX(",null,r)-2,x:qt(c,u)}):u&&h.push(s(h)+"skewX("+u+r)}function l(c,u,h,d,f,p){if(c!==h||u!==d){var m=f.push(s(f)+"scale(",null,",",null,")");p.push({i:m-4,x:qt(c,h)},{i:m-2,x:qt(u,d)})}else(h!==1||d!==1)&&f.push(s(f)+"scale("+h+","+d+")")}return function(c,u){var h=[],d=[];return c=i(c),u=i(u),n(c.translateX,c.translateY,u.translateX,u.translateY,h,d),o(c.rotate,u.rotate,h,d),a(c.skewX,u.skewX,h,d),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,h,d),c=u=null,function(f){for(var p=-1,m=d.length,g;++p<m;)h[(g=d[p]).i]=g.x(f);return h.join("")}}}var q7=vv(yv,"px, ","px)","deg)"),Q7=vv(xv,", ",")",")");var TP=1e-12;function _v(i){return((i=Math.exp(i))+1/i)/2}function IP(i){return((i=Math.exp(i))-1/i)/2}function MP(i){return((i=Math.exp(2*i))-1)/(i+1)}var Y7=function i(e,t,r){function s(n,o){var a=n[0],l=n[1],c=n[2],u=o[0],h=o[1],d=o[2],f=u-a,p=h-l,m=f*f+p*p,g,y;if(m<TP)y=Math.log(d/c)/e,g=function(k){return[a+k*f,l+k*p,c*Math.exp(e*k*y)]};else{var x=Math.sqrt(m),b=(d*d-c*c+r*m)/(2*c*t*x),_=(d*d-c*c-r*m)/(2*d*t*x),w=Math.log(Math.sqrt(b*b+1)-b),A=Math.log(Math.sqrt(_*_+1)-_);y=(A-w)/e,g=function(k){var v=k*y,E=_v(w),S=c/(t*x)*(E*MP(e*v+w)-IP(w));return[a+S*f,l+S*p,c*E/_v(e*v+w)]}}return g.duration=y*1e3*e/Math.SQRT2,g}return s.rho=function(n){var o=Math.max(.001,+n),a=o*o,l=a*a;return i(o,a,l)},s}(Math.SQRT2,2,4);var ql=0,z0=0,G0=0,wv=1e3,h5,j0,d5=0,Oa=0,f5=0,V0=typeof performance=="object"&&performance.now?performance:Date,Ev=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(i){setTimeout(i,17)};function X0(){return Oa||(Ev(PP),Oa=V0.now()+f5)}function PP(){Oa=0}function W0(){this._call=this._time=this._next=null}W0.prototype=Ql.prototype={constructor:W0,restart:function(i,e,t){if(typeof i!="function")throw new TypeError("callback is not a function");t=(t==null?X0():+t)+(e==null?0:+e),!this._next&&j0!==this&&(j0?j0._next=this:h5=this,j0=this),this._call=i,this._time=t,K7()},stop:function(){this._call&&(this._call=null,this._time=1/0,K7())}};function Ql(i,e,t){var r=new W0;return r.restart(i,e,t),r}function p5(){X0(),++ql;for(var i=h5,e;i;)(e=Oa-i._time)>=0&&i._call.call(void 0,e),i=i._next;--ql}function bv(){Oa=(d5=V0.now())+f5,ql=z0=0;try{p5()}finally{ql=0,RP(),Oa=0}}function DP(){var i=V0.now(),e=i-d5;e>wv&&(f5-=e,d5=i)}function RP(){for(var i,e=h5,t,r=1/0;e;)e._call?(r>e._time&&(r=e._time),i=e,e=e._next):(t=e._next,e._next=null,e=i?i._next=t:h5=t);j0=i,K7(r)}function K7(i){if(!ql){z0&&(z0=clearTimeout(z0));var e=i-Oa;e>24?(i<1/0&&(z0=setTimeout(bv,i-V0.now()-f5)),G0&&(G0=clearInterval(G0))):(G0||(d5=V0.now(),G0=setInterval(DP,wv)),ql=1,Ev(bv))}}function Yl(i,e,t){var r=new W0;return e=e==null?0:+e,r.restart(s=>{r.stop(),i(s+e)},e,t),r}var NP=ue("start","end","cancel","interrupt"),FP=[],Cv=0,Av=1,g5=2,m5=3,Sv=4,y5=5,q0=6;function $o(i,e,t,r,s,n){var o=i.__transition;if(!o)i.__transition={};else if(t in o)return;LP(i,t,{name:e,index:r,group:s,on:NP,tween:FP,time:n.time,delay:n.delay,duration:n.duration,ease:n.ease,timer:null,state:Cv})}function Q0(i,e){var t=Ci(i,e);if(t.state>Cv)throw new Error("too late; already scheduled");return t}function Wi(i,e){var t=Ci(i,e);if(t.state>m5)throw new Error("too late; already running");return t}function Ci(i,e){var t=i.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function LP(i,e,t){var r=i.__transition,s;r[e]=t,t.timer=Ql(n,0,t.time);function n(c){t.state=Av,t.timer.restart(o,t.delay,t.time),t.delay<=c&&o(c-t.delay)}function o(c){var u,h,d,f;if(t.state!==Av)return l();for(u in r)if(f=r[u],f.name===t.name){if(f.state===m5)return Yl(o);f.state===Sv?(f.state=q0,f.timer.stop(),f.on.call("interrupt",i,i.__data__,f.index,f.group),delete r[u]):+u<e&&(f.state=q0,f.timer.stop(),f.on.call("cancel",i,i.__data__,f.index,f.group),delete r[u])}if(Yl(function(){t.state===m5&&(t.state=Sv,t.timer.restart(a,t.delay,t.time),a(c))}),t.state=g5,t.on.call("start",i,i.__data__,t.index,t.group),t.state===g5){for(t.state=m5,s=new Array(d=t.tween.length),u=0,h=-1;u<d;++u)(f=t.tween[u].value.call(i,i.__data__,t.index,t.group))&&(s[++h]=f);s.length=h+1}}function a(c){for(var u=c<t.duration?t.ease.call(null,c/t.duration):(t.timer.restart(l),t.state=y5,1),h=-1,d=s.length;++h<d;)s[h].call(i,u);t.state===y5&&(t.on.call("end",i,i.__data__,t.index,t.group),l())}function l(){t.state=q0,t.timer.stop(),delete r[e];for(var c in r)return;delete i.__transition}}function Ho(i,e){var t=i.__transition,r,s,n=!0,o;if(t){e=e==null?null:e+"";for(o in t){if((r=t[o]).name!==e){n=!1;continue}s=r.state>g5&&r.state<y5,r.state=q0,r.timer.stop(),r.on.call(s?"interrupt":"cancel",i,i.__data__,r.index,r.group),delete t[o]}n&&delete i.__transition}}function kv(i){return this.each(function(){Ho(this,i)})}function OP(i,e){var t,r;return function(){var s=Wi(this,i),n=s.tween;if(n!==t){r=t=n;for(var o=0,a=r.length;o<a;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}s.tween=r}}function BP(i,e,t){var r,s;if(typeof t!="function")throw new Error;return function(){var n=Wi(this,i),o=n.tween;if(o!==r){s=(r=o).slice();for(var a={name:e,value:t},l=0,c=s.length;l<c;++l)if(s[l].name===e){s[l]=a;break}l===c&&s.push(a)}n.tween=s}}function Tv(i,e){var t=this._id;if(i+="",arguments.length<2){for(var r=Ci(this.node(),t).tween,s=0,n=r.length,o;s<n;++s)if((o=r[s]).name===i)return o.value;return null}return this.each((e==null?OP:BP)(t,i,e))}function Kl(i,e,t){var r=i._id;return i.each(function(){var s=Wi(this,r);(s.value||(s.value={}))[e]=t.apply(this,arguments)}),function(s){return Ci(s,r).value[e]}}function x5(i,e){var t;return(typeof e=="number"?qt:e instanceof zs?fn:(t=zs(e))?(e=t,fn):H0)(i,e)}function UP(i){return function(){this.removeAttribute(i)}}function $P(i){return function(){this.removeAttributeNS(i.space,i.local)}}function HP(i,e,t){var r,s=t+"",n;return function(){var o=this.getAttribute(i);return o===s?null:o===r?n:n=e(r=o,t)}}function GP(i,e,t){var r,s=t+"",n;return function(){var o=this.getAttributeNS(i.space,i.local);return o===s?null:o===r?n:n=e(r=o,t)}}function zP(i,e,t){var r,s,n;return function(){var o,a=t(this),l;return a==null?void this.removeAttribute(i):(o=this.getAttribute(i),l=a+"",o===l?null:o===r&&l===s?n:(s=l,n=e(r=o,a)))}}function jP(i,e,t){var r,s,n;return function(){var o,a=t(this),l;return a==null?void this.removeAttributeNS(i.space,i.local):(o=this.getAttributeNS(i.space,i.local),l=a+"",o===l?null:o===r&&l===s?n:(s=l,n=e(r=o,a)))}}function Iv(i,e){var t=Qn(i),r=t==="transform"?Q7:x5;return this.attrTween(i,typeof e=="function"?(t.local?jP:zP)(t,r,Kl(this,"attr."+i,e)):e==null?(t.local?$P:UP)(t):(t.local?GP:HP)(t,r,e))}function VP(i,e){return function(t){this.setAttribute(i,e.call(this,t))}}function WP(i,e){return function(t){this.setAttributeNS(i.space,i.local,e.call(this,t))}}function XP(i,e){var t,r;function s(){var n=e.apply(this,arguments);return n!==r&&(t=(r=n)&&WP(i,n)),t}return s._value=e,s}function qP(i,e){var t,r;function s(){var n=e.apply(this,arguments);return n!==r&&(t=(r=n)&&VP(i,n)),t}return s._value=e,s}function Mv(i,e){var t="attr."+i;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var r=Qn(i);return this.tween(t,(r.local?XP:qP)(r,e))}function QP(i,e){return function(){Q0(this,i).delay=+e.apply(this,arguments)}}function YP(i,e){return e=+e,function(){Q0(this,i).delay=e}}function Pv(i){var e=this._id;return arguments.length?this.each((typeof i=="function"?QP:YP)(e,i)):Ci(this.node(),e).delay}function KP(i,e){return function(){Wi(this,i).duration=+e.apply(this,arguments)}}function ZP(i,e){return e=+e,function(){Wi(this,i).duration=e}}function Dv(i){var e=this._id;return arguments.length?this.each((typeof i=="function"?KP:ZP)(e,i)):Ci(this.node(),e).duration}function JP(i,e){if(typeof e!="function")throw new Error;return function(){Wi(this,i).ease=e}}function Rv(i){var e=this._id;return arguments.length?this.each(JP(e,i)):Ci(this.node(),e).ease}function eD(i,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;Wi(this,i).ease=t}}function Nv(i){if(typeof i!="function")throw new Error;return this.each(eD(this._id,i))}function Fv(i){typeof i!="function"&&(i=I0(i));for(var e=this._groups,t=e.length,r=new Array(t),s=0;s<t;++s)for(var n=e[s],o=n.length,a=r[s]=[],l,c=0;c<o;++c)(l=n[c])&&i.call(l,l.__data__,c,n)&&a.push(l);return new pr(r,this._parents,this._name,this._id)}function Lv(i){if(i._id!==this._id)throw new Error;for(var e=this._groups,t=i._groups,r=e.length,s=t.length,n=Math.min(r,s),o=new Array(r),a=0;a<n;++a)for(var l=e[a],c=t[a],u=l.length,h=o[a]=new Array(u),d,f=0;f<u;++f)(d=l[f]||c[f])&&(h[f]=d);for(;a<r;++a)o[a]=e[a];return new pr(o,this._parents,this._name,this._id)}function tD(i){return(i+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function iD(i,e,t){var r,s,n=tD(e)?Q0:Wi;return function(){var o=n(this,i),a=o.on;a!==r&&(s=(r=a).copy()).on(e,t),o.on=s}}function Ov(i,e){var t=this._id;return arguments.length<2?Ci(this.node(),t).on.on(i):this.each(iD(t,i,e))}function rD(i){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==i)return;e&&e.removeChild(this)}}function Bv(){return this.on("end.remove",rD(this._id))}function Uv(i){var e=this._name,t=this._id;typeof i!="function"&&(i=Ra(i));for(var r=this._groups,s=r.length,n=new Array(s),o=0;o<s;++o)for(var a=r[o],l=a.length,c=n[o]=new Array(l),u,h,d=0;d<l;++d)(u=a[d])&&(h=i.call(u,u.__data__,d,a))&&("__data__"in u&&(h.__data__=u.__data__),c[d]=h,$o(c[d],e,t,d,c,Ci(u,t)));return new pr(n,this._parents,e,t)}function $v(i){var e=this._name,t=this._id;typeof i!="function"&&(i=T0(i));for(var r=this._groups,s=r.length,n=[],o=[],a=0;a<s;++a)for(var l=r[a],c=l.length,u,h=0;h<c;++h)if(u=l[h]){for(var d=i.call(u,u.__data__,h,l),f,p=Ci(u,t),m=0,g=d.length;m<g;++m)(f=d[m])&&$o(f,e,t,m,d,p);n.push(d),o.push(u)}return new pr(n,o,e,t)}var sD=Yn.prototype.constructor;function Hv(){return new sD(this._groups,this._parents)}function nD(i,e){var t,r,s;return function(){var n=Bo(this,i),o=(this.style.removeProperty(i),Bo(this,i));return n===o?null:n===t&&o===r?s:s=e(t=n,r=o)}}function Gv(i){return function(){this.style.removeProperty(i)}}function oD(i,e,t){var r,s=t+"",n;return function(){var o=Bo(this,i);return o===s?null:o===r?n:n=e(r=o,t)}}function aD(i,e,t){var r,s,n;return function(){var o=Bo(this,i),a=t(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(i),Bo(this,i))),o===l?null:o===r&&l===s?n:(s=l,n=e(r=o,a))}}function lD(i,e){var t,r,s,n="style."+e,o="end."+n,a;return function(){var l=Wi(this,i),c=l.on,u=l.value[n]==null?a||(a=Gv(e)):void 0;(c!==t||s!==u)&&(r=(t=c).copy()).on(o,s=u),l.on=r}}function zv(i,e,t){var r=(i+="")=="transform"?q7:x5;return e==null?this.styleTween(i,nD(i,r)).on("end.style."+i,Gv(i)):typeof e=="function"?this.styleTween(i,aD(i,r,Kl(this,"style."+i,e))).each(lD(this._id,i)):this.styleTween(i,oD(i,r,e),t).on("end.style."+i,null)}function cD(i,e,t){return function(r){this.style.setProperty(i,e.call(this,r),t)}}function uD(i,e,t){var r,s;function n(){var o=e.apply(this,arguments);return o!==s&&(r=(s=o)&&cD(i,o,t)),r}return n._value=e,n}function jv(i,e,t){var r="style."+(i+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,uD(i,e,t==null?"":t))}function hD(i){return function(){this.textContent=i}}function dD(i){return function(){var e=i(this);this.textContent=e==null?"":e}}function Vv(i){return this.tween("text",typeof i=="function"?dD(Kl(this,"text",i)):hD(i==null?"":i+""))}function fD(i){return function(e){this.textContent=i.call(this,e)}}function pD(i){var e,t;function r(){var s=i.apply(this,arguments);return s!==t&&(e=(t=s)&&fD(s)),e}return r._value=i,r}function Wv(i){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(i==null)return this.tween(e,null);if(typeof i!="function")throw new Error;return this.tween(e,pD(i))}function Xv(){for(var i=this._name,e=this._id,t=v5(),r=this._groups,s=r.length,n=0;n<s;++n)for(var o=r[n],a=o.length,l,c=0;c<a;++c)if(l=o[c]){var u=Ci(l,e);$o(l,i,t,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new pr(r,this._parents,i,t)}function qv(){var i,e,t=this,r=t._id,s=t.size();return new Promise(function(n,o){var a={value:o},l={value:function(){--s===0&&n()}};t.each(function(){var c=Wi(this,r),u=c.on;u!==i&&(e=(i=u).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),c.on=e}),s===0&&n()})}var mD=0;function pr(i,e,t,r){this._groups=i,this._parents=e,this._name=t,this._id=r}function Qv(i){return Yn().transition(i)}function v5(){return++mD}var Kn=Yn.prototype;pr.prototype=Qv.prototype={constructor:pr,select:Uv,selectAll:$v,selectChild:Kn.selectChild,selectChildren:Kn.selectChildren,filter:Fv,merge:Lv,selection:Hv,transition:Xv,call:Kn.call,nodes:Kn.nodes,node:Kn.node,size:Kn.size,empty:Kn.empty,each:Kn.each,on:Ov,attr:Iv,attrTween:Mv,style:zv,styleTween:jv,text:Vv,textTween:Wv,remove:Bv,tween:Tv,delay:Pv,duration:Dv,ease:Rv,easeVarying:Nv,end:qv,[Symbol.iterator]:Kn[Symbol.iterator]};var Y0=i=>+i;function Ba(i){return((i*=2)<=1?i*i*i:(i-=2)*i*i+2)/2}var gD={time:null,delay:0,duration:250,ease:Ba};function yD(i,e){for(var t;!(t=i.__transition)||!(t=t[e]);)if(!(i=i.parentNode))throw new Error(`transition ${e} not found`);return t}function Yv(i){var e,t;i instanceof pr?(e=i._id,i=i._name):(e=v5(),(t=gD).time=X0(),i=i==null?null:i+"");for(var r=this._groups,s=r.length,n=0;n<s;++n)for(var o=r[n],a=o.length,l,c=0;c<a;++c)(l=o[c])&&$o(l,i,e,c,o,t||yD(l,e));return new pr(r,this._parents,i,e)}Yn.prototype.interrupt=kv;Yn.prototype.transition=Yv;var K0=i=>()=>i;function Z7(i,{sourceEvent:e,target:t,transform:r,dispatch:s}){Object.defineProperties(this,{type:{value:i,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:s}})}function js(i,e,t){this.k=i,this.x=e,this.y=t}js.prototype={constructor:js,scale:function(i){return i===1?this:new js(this.k*i,this.x,this.y)},translate:function(i,e){return i===0&e===0?this:new js(this.k,this.x+this.k*i,this.y+this.k*e)},apply:function(i){return[i[0]*this.k+this.x,i[1]*this.k+this.y]},applyX:function(i){return i*this.k+this.x},applyY:function(i){return i*this.k+this.y},invert:function(i){return[(i[0]-this.x)/this.k,(i[1]-this.y)/this.k]},invertX:function(i){return(i-this.x)/this.k},invertY:function(i){return(i-this.y)/this.k},rescaleX:function(i){return i.copy().domain(i.range().map(this.invertX,this).map(i.invert,i))},rescaleY:function(i){return i.copy().domain(i.range().map(this.invertY,this).map(i.invert,i))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ps=new js(1,0,0);J7.prototype=js.prototype;function J7(i){for(;!i.__zoom;)if(!(i=i.parentNode))return ps;return i.__zoom}function _5(i){i.stopImmediatePropagation()}function Zl(i){i.preventDefault(),i.stopImmediatePropagation()}function xD(i){return(!i.ctrlKey||i.type==="wheel")&&!i.button}function vD(){var i=this;return i instanceof SVGElement?(i=i.ownerSVGElement||i,i.hasAttribute("viewBox")?(i=i.viewBox.baseVal,[[i.x,i.y],[i.x+i.width,i.y+i.height]]):[[0,0],[i.width.baseVal.value,i.height.baseVal.value]]):[[0,0],[i.clientWidth,i.clientHeight]]}function Kv(){return this.__zoom||ps}function _D(i){return-i.deltaY*(i.deltaMode===1?.05:i.deltaMode?1:.002)*(i.ctrlKey?10:1)}function bD(){return navigator.maxTouchPoints||"ontouchstart"in this}function wD(i,e,t){var r=i.invertX(e[0][0])-t[0][0],s=i.invertX(e[1][0])-t[1][0],n=i.invertY(e[0][1])-t[0][1],o=i.invertY(e[1][1])-t[1][1];return i.translate(s>r?(r+s)/2:Math.min(0,r)||Math.max(0,s),o>n?(n+o)/2:Math.min(0,n)||Math.max(0,o))}function Jl(){var i=xD,e=vD,t=wD,r=_D,s=bD,n=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,l=Y7,c=ue("start","zoom","end"),u,h,d,f=500,p=150,m=0,g=10;function y(C){C.property("__zoom",Kv).on("wheel.zoom",v,{passive:!1}).on("mousedown.zoom",E).on("dblclick.zoom",S).filter(s).on("touchstart.zoom",M).on("touchmove.zoom",I).on("touchend.zoom touchcancel.zoom",T).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}y.transform=function(C,P,D,O){var R=C.selection?C.selection():C;R.property("__zoom",Kv),C!==R?w(C,P,D,O):R.interrupt().each(function(){A(this,arguments).event(O).start().zoom(null,typeof P=="function"?P.apply(this,arguments):P).end()})},y.scaleBy=function(C,P,D,O){y.scaleTo(C,function(){var R=this.__zoom.k,N=typeof P=="function"?P.apply(this,arguments):P;return R*N},D,O)},y.scaleTo=function(C,P,D,O){y.transform(C,function(){var R=e.apply(this,arguments),N=this.__zoom,F=D==null?_(R):typeof D=="function"?D.apply(this,arguments):D,B=N.invert(F),$=typeof P=="function"?P.apply(this,arguments):P;return t(b(x(N,$),F,B),R,o)},D,O)},y.translateBy=function(C,P,D,O){y.transform(C,function(){return t(this.__zoom.translate(typeof P=="function"?P.apply(this,arguments):P,typeof D=="function"?D.apply(this,arguments):D),e.apply(this,arguments),o)},null,O)},y.translateTo=function(C,P,D,O,R){y.transform(C,function(){var N=e.apply(this,arguments),F=this.__zoom,B=O==null?_(N):typeof O=="function"?O.apply(this,arguments):O;return t(ps.translate(B[0],B[1]).scale(F.k).translate(typeof P=="function"?-P.apply(this,arguments):-P,typeof D=="function"?-D.apply(this,arguments):-D),N,o)},O,R)};function x(C,P){return P=Math.max(n[0],Math.min(n[1],P)),P===C.k?C:new js(P,C.x,C.y)}function b(C,P,D){var O=P[0]-D[0]*C.k,R=P[1]-D[1]*C.k;return O===C.x&&R===C.y?C:new js(C.k,O,R)}function _(C){return[(+C[0][0]+ +C[1][0])/2,(+C[0][1]+ +C[1][1])/2]}function w(C,P,D,O){C.on("start.zoom",function(){A(this,arguments).event(O).start()}).on("interrupt.zoom end.zoom",function(){A(this,arguments).event(O).end()}).tween("zoom",function(){var R=this,N=arguments,F=A(R,N).event(O),B=e.apply(R,N),$=D==null?_(B):typeof D=="function"?D.apply(R,N):D,U=Math.max(B[1][0]-B[0][0],B[1][1]-B[0][1]),H=R.__zoom,z=typeof P=="function"?P.apply(R,N):P,j=l(H.invert($).concat(U/H.k),z.invert($).concat(U/z.k));return function(X){if(X===1)X=z;else{var K=j(X),Y=U/K[2];X=new js(Y,$[0]-K[0]*Y,$[1]-K[1]*Y)}F.zoom(null,X)}})}function A(C,P,D){return!D&&C.__zooming||new k(C,P)}function k(C,P){this.that=C,this.args=P,this.active=0,this.sourceEvent=null,this.extent=e.apply(C,P),this.taps=0}k.prototype={event:function(C){return C&&(this.sourceEvent=C),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(C,P){return this.mouse&&C!=="mouse"&&(this.mouse[1]=P.invert(this.mouse[0])),this.touch0&&C!=="touch"&&(this.touch0[1]=P.invert(this.touch0[0])),this.touch1&&C!=="touch"&&(this.touch1[1]=P.invert(this.touch1[0])),this.that.__zoom=P,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(C){var P=G(this.that).datum();c.call(C,this.that,new Z7(C,{sourceEvent:this.sourceEvent,target:y,type:C,transform:this.that.__zoom,dispatch:c}),P)}};function v(C,...P){if(!i.apply(this,arguments))return;var D=A(this,P).event(C),O=this.__zoom,R=Math.max(n[0],Math.min(n[1],O.k*Math.pow(2,r.apply(this,arguments)))),N=fs(C);if(D.wheel)(D.mouse[0][0]!==N[0]||D.mouse[0][1]!==N[1])&&(D.mouse[1]=O.invert(D.mouse[0]=N)),clearTimeout(D.wheel);else{if(O.k===R)return;D.mouse=[N,O.invert(N)],Ho(this),D.start()}Zl(C),D.wheel=setTimeout(F,p),D.zoom("mouse",t(b(x(O,R),D.mouse[0],D.mouse[1]),D.extent,o));function F(){D.wheel=null,D.end()}}function E(C,...P){if(d||!i.apply(this,arguments))return;var D=C.currentTarget,O=A(this,P,!0).event(C),R=G(C.view).on("mousemove.zoom",$,!0).on("mouseup.zoom",U,!0),N=fs(C,D),F=C.clientX,B=C.clientY;D0(C.view),_5(C),O.mouse=[N,this.__zoom.invert(N)],Ho(this),O.start();function $(H){if(Zl(H),!O.moved){var z=H.clientX-F,j=H.clientY-B;O.moved=z*z+j*j>m}O.event(H).zoom("mouse",t(b(O.that.__zoom,O.mouse[0]=fs(H,D),O.mouse[1]),O.extent,o))}function U(H){R.on("mousemove.zoom mouseup.zoom",null),R0(H.view,O.moved),Zl(H),O.event(H).end()}}function S(C,...P){if(i.apply(this,arguments)){var D=this.__zoom,O=fs(C.changedTouches?C.changedTouches[0]:C,this),R=D.invert(O),N=D.k*(C.shiftKey?.5:2),F=t(b(x(D,N),O,R),e.apply(this,P),o);Zl(C),a>0?G(this).transition().duration(a).call(w,F,O,C):G(this).call(y.transform,F,O,C)}}function M(C,...P){if(i.apply(this,arguments)){var D=C.touches,O=D.length,R=A(this,P,C.changedTouches.length===O).event(C),N,F,B,$;for(_5(C),F=0;F<O;++F)B=D[F],$=fs(B,this),$=[$,this.__zoom.invert($),B.identifier],R.touch0?!R.touch1&&R.touch0[2]!==$[2]&&(R.touch1=$,R.taps=0):(R.touch0=$,N=!0,R.taps=1+!!u);u&&(u=clearTimeout(u)),N&&(R.taps<2&&(h=$[0],u=setTimeout(function(){u=null},f)),Ho(this),R.start())}}function I(C,...P){if(this.__zooming){var D=A(this,P).event(C),O=C.changedTouches,R=O.length,N,F,B,$;for(Zl(C),N=0;N<R;++N)F=O[N],B=fs(F,this),D.touch0&&D.touch0[2]===F.identifier?D.touch0[0]=B:D.touch1&&D.touch1[2]===F.identifier&&(D.touch1[0]=B);if(F=D.that.__zoom,D.touch1){var U=D.touch0[0],H=D.touch0[1],z=D.touch1[0],j=D.touch1[1],X=(X=z[0]-U[0])*X+(X=z[1]-U[1])*X,K=(K=j[0]-H[0])*K+(K=j[1]-H[1])*K;F=x(F,Math.sqrt(X/K)),B=[(U[0]+z[0])/2,(U[1]+z[1])/2],$=[(H[0]+j[0])/2,(H[1]+j[1])/2]}else if(D.touch0)B=D.touch0[0],$=D.touch0[1];else return;D.zoom("touch",t(b(F,B,$),D.extent,o))}}function T(C,...P){if(this.__zooming){var D=A(this,P).event(C),O=C.changedTouches,R=O.length,N,F;for(_5(C),d&&clearTimeout(d),d=setTimeout(function(){d=null},f),N=0;N<R;++N)F=O[N],D.touch0&&D.touch0[2]===F.identifier?delete D.touch0:D.touch1&&D.touch1[2]===F.identifier&&delete D.touch1;if(D.touch1&&!D.touch0&&(D.touch0=D.touch1,delete D.touch1),D.touch0)D.touch0[1]=this.__zoom.invert(D.touch0[0]);else if(D.end(),D.taps===2&&(F=fs(F,this),Math.hypot(h[0]-F[0],h[1]-F[1])<g)){var B=G(this).on("dblclick.zoom");B&&B.apply(this,arguments)}}}return y.wheelDelta=function(C){return arguments.length?(r=typeof C=="function"?C:K0(+C),y):r},y.filter=function(C){return arguments.length?(i=typeof C=="function"?C:K0(!!C),y):i},y.touchable=function(C){return arguments.length?(s=typeof C=="function"?C:K0(!!C),y):s},y.extent=function(C){return arguments.length?(e=typeof C=="function"?C:K0([[+C[0][0],+C[0][1]],[+C[1][0],+C[1][1]]]),y):e},y.scaleExtent=function(C){return arguments.length?(n[0]=+C[0],n[1]=+C[1],y):[n[0],n[1]]},y.translateExtent=function(C){return arguments.length?(o[0][0]=+C[0][0],o[1][0]=+C[1][0],o[0][1]=+C[0][1],o[1][1]=+C[1][1],y):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},y.constrain=function(C){return arguments.length?(t=C,y):t},y.duration=function(C){return arguments.length?(a=+C,y):a},y.interpolate=function(C){return arguments.length?(l=C,y):l},y.on=function(){var C=c.on.apply(c,arguments);return C===c?y:C},y.clickDistance=function(C){return arguments.length?(m=(C=+C)*C,y):Math.sqrt(m)},y.tapDistance=function(C){return arguments.length?(g=+C,y):g},y}var mn=2*Math.PI,b5=6356752314245179e-9,w5=6378137;function e9(i){return i*(mn*w5/360)}function e2(i,e){return Math.abs(e)>=90?0:i*(mn*b5/360)*Math.abs(Math.cos(e*(Math.PI/180)))}function gn(i){return i/(mn*w5/360)}function ki(i,e){return Math.abs(e)>=90?0:i/(mn*b5/360)/Math.abs(Math.cos(e*(Math.PI/180)))}function E5(i,e){return e=e||256,[i[0]*e/(mn*b5),-i[1]*e/(mn*w5)]}function A5(i,e){return e=e||256,[i[0]*mn*b5/e,-i[1]*mn*w5/e]}function at(i,e){let t=e2(i[0]-e[0],(i[1]+e[1])/2),r=e9(i[1]-e[1]);return Math.sqrt(t*t+r*r)}function Yr(i,e){e=e||256;let t=Math.log(e)*Math.LOG2E;return Math.log(i*mn)/Math.LN2-t}function Ti(i,e){return e=e||256,e*Math.pow(2,i)/mn}function S5(i,e){let t=1/0,r;for(let s=0;s<i.length;s++){let n=at(i[s],e);n<t&&(t=n,r=s)}return r!==void 0?{index:r,distance:t,point:i[r]}:null}var ie=class{constructor(i,e){this.min=[1/0,1/0],this.max=[-1/0,-1/0];let t;i instanceof ie?(t=i.min,e=i.max):t=i,t&&t.length===2&&(this.min[0]=t[0],this.min[1]=t[1],e||(e=t)),e&&e.length===2&&(this.max[0]=e[0],this.max[1]=e[1])}equals(i){return this.min[0]===i.min[0]&&this.min[1]===i.min[1]&&this.max[0]===i.max[0]&&this.max[1]===i.max[1]}area(){return Math.abs((this.max[0]-this.min[0])*(this.max[1]-this.min[1]))}center(){return[(this.min[0]+this.max[0])/2,(this.min[1]+this.max[1])/2]}rectangle(){return[this.min[0],this.min[1],this.max[0],this.max[1]]}toParam(){return this.rectangle().join(",")}bbox(){return{minX:this.min[0],minY:this.min[1],maxX:this.max[0],maxY:this.max[1]}}polygon(){return[[this.min[0],this.min[1]],[this.min[0],this.max[1]],[this.max[0],this.max[1]],[this.max[0],this.min[1]],[this.min[0],this.min[1]]]}contains(i){return i.min[0]>=this.min[0]&&i.min[1]>=this.min[1]&&i.max[0]<=this.max[0]&&i.max[1]<=this.max[1]}intersects(i){return i.min[0]<=this.max[0]&&i.min[1]<=this.max[1]&&i.max[0]>=this.min[0]&&i.max[1]>=this.min[1]}intersection(i){return this.intersects(i)?new ie([Math.max(i.min[0],this.min[0]),Math.max(i.min[1],this.min[1])],[Math.min(i.max[0],this.max[0]),Math.min(i.max[1],this.max[1])]):new ie}percentContainedIn(i){let e=this.intersection(i).area(),t=this.area();return e===1/0||t===1/0?0:e===0||t===0?i.contains(this)?1:0:e/t}extend(i){return new ie([Math.min(i.min[0],this.min[0]),Math.min(i.min[1],this.min[1])],[Math.max(i.max[0],this.max[0]),Math.max(i.max[1],this.max[1])])}padByMeters(i){let e=gn(i),t=ki(i,this.center()[1]);return new ie([this.min[0]-t,this.min[1]-e],[this.max[0]+t,this.max[1]+e])}};function We(i,e,t){return t?Math.abs(i[0]-e[0])<=t&&Math.abs(i[1]-e[1])<=t:i[0]===e[0]&&i[1]===e[1]}function dt(i,e){return[i[0]+e[0],i[1]+e[1]]}function Ze(i,e){return[i[0]-e[0],i[1]-e[1]]}function mr(i,e){return[i[0]*e,i[1]*e]}function ct(i,e,t){return[i[0]+(e[0]-i[0])*t,i[1]+(e[1]-i[1])*t]}function Ue(i,e){e=e||[0,0];let t=i[0]-e[0],r=i[1]-e[1];return Math.sqrt(t*t+r*r)}function t9(i,e=[0,0]){return(i[0]-e[0])**2+(i[1]-e[1])**2}function e1(i){let e=Math.sqrt(i[0]*i[0]+i[1]*i[1]);return e!==0?mr(i,1/e):[0,0]}function $t(i,e){return Math.atan2(e[1]-i[1],e[0]-i[0])}function ms(i,e,t){t=t||[0,0];let r=Ze(i,t),s=Ze(e,t);return r[0]*s[0]+r[1]*s[1]}function C5(i,e,t){t=t||[0,0];let r=e1(Ze(i,t)),s=e1(Ze(e,t));return ms(r,s)}function J0(i,e,t){t=t||[0,0];let r=Ze(i,t),s=Ze(e,t);return r[0]*s[1]-r[1]*s[0]}function Jv(i,e){let t=1/0,r,s;for(let n=0;n<e.length-1;n++){let o=e[n],a=Ze(e[n+1],o),l=Ze(i,o),c=ms(l,a)/ms(a,a),u;c<0?u=o:c>1?u=e[n+1]:u=[o[0]+c*a[0],o[1]+c*a[1]];let h=Ue(u,i);h<t&&(t=h,r=n+1,s=u)}return r!==void 0&&s!==void 0?{index:r,distance:t,target:s}:null}function e_(i,e){return i[0]===e[0]&&i[1]===e[1]||i[0]===e[1]&&i[1]===e[0]}function Zn(i,e,t){return i.map(r=>{let s=Ze(r,t);return[s[0]*Math.cos(e)-s[1]*Math.sin(e)+t[0],s[0]*Math.sin(e)+s[1]*Math.cos(e)+t[1]]})}function Jn(i,e){if(i.length!==2||e.length!==2)return null;let t=[i[0][0],i[0][1]],r=[i[1][0],i[1][1]],s=[e[0][0],e[0][1]],n=[e[1][0],e[1][1]],o=Ze(r,t),a=Ze(n,s),l=J0(Ze(s,t),o),c=J0(o,a);if(l&&c){let u=l/c,h=J0(Ze(s,t),a)/c;if(h>=0&&h<=1&&u>=0&&u<=1)return ct(t,r,h)}return null}function k5(i,e){let t=[];for(let r=0;r<i.length-1;r++)for(let s=0;s<e.length-1;s++){let n=[i[r],i[r+1]],o=[e[s],e[s+1]],a=Jn(n,o);a&&t.push(a)}return t}function ED(i,e){for(let t=0;t<i.length-1;t++)for(let r=0;r<e.length-1;r++){let s=[i[t],i[t+1]],n=[e[r],e[r+1]];if(Jn(s,n))return!0}return!1}function t1(i,e){let t=i[0],r=i[1],s=!1;for(let n=0,o=e.length-1;n<e.length;o=n++){let a=e[n][0],l=e[n][1],c=e[o][0],u=e[o][1];l>r!=u>r&&t<(c-a)*(r-l)/(u-l)+a&&(s=!s)}return s}function i1(i,e){return e.every(t=>t1(t,i))}function t_(i,e,t){function r(s,n){return n.some(o=>t1(o,s))}return r(i,e)||!!t&&ED(i,e)}function r1(i){let e=Hs(i);if(!e)return null;let t=Pr(e),r=1/0,s=new ie,n=0,o=e[0];for(let a=0;a<=e.length-1;a++){let l=a===e.length-1?e[0]:e[a+1],c=Math.atan2(l[1]-o[1],l[0]-o[0]),h=Zn(e,-c,t).reduce((f,p)=>(f.min[0]=Math.min(f.min[0],p[0]),f.min[1]=Math.min(f.min[1],p[1]),f.max[0]=Math.max(f.max[0],p[0]),f.max[1]=Math.max(f.max[1],p[1]),f),new ie),d=h.area();d<r&&(r=d,s=h,n=c),o=l}return{poly:Zn(s.polygon(),n,t),angle:n}}function i9(i){let e=0;for(let t=0;t<i.length-1;t++)e+=Ue(i[t],i[t+1]);return e}function T5(i,e){let t=[80,20,50,20],r=0,s=0;return i[0]>e[0]-t[1]&&(r=-10),i[0]<t[3]&&(r=10),i[1]>e[1]-t[2]&&(s=-10),i[1]<t[0]&&(s=10),r||s?[r,s]:null}var gr=class{constructor(i,e,t){this._proj=jl,this._dimensions=[[0,0],[0,0]],this._x=i||0,this._y=e||0,this._k=t||256/Math.PI}project(i){return i=this._proj(i[0]*Math.PI/180,i[1]*Math.PI/180),[i[0]*this._k+this._x,this._y-i[1]*this._k]}invert(i){return i=this._proj.invert((i[0]-this._x)/this._k,(this._y-i[1])/this._k),[i[0]*180/Math.PI,i[1]*180/Math.PI]}scale(i){return i===void 0?this._k:(this._k=+i,this)}translate(i){return i===void 0?[this._x,this._y]:(this._x=+i[0],this._y=+i[1],this)}dimensions(i){return i===void 0?this._dimensions:(this._dimensions=i,this)}transform(i){return i===void 0?ps.translate(this._x,this._y).scale(this._k):(this._x=+i.x,this._y=+i.y,this._k=+i.k,this)}getStream(){let i=this;return O7({point:function(e,t){let r=i.project([e,t]);this.stream.point(r[0],r[1])}}).stream}};function Z0(i,e,t){return Math.max(e,Math.min(i,t))}function Zv(i,e){return Array.from(Array(1+e-i).keys()).map(t=>i+t)}var Jt=class{constructor(){this._tileSize=256,this._zoomRange=[0,24],this._margin=0,this._skipNullIsland=!1}getTiles(i){let e=i.dimensions(),t=i.translate(),r=i.scale(),s=Yr(r,this._tileSize),n=Z0(Math.round(s),this._zoomRange[0],this._zoomRange[1]),o=0,a=Math.pow(2,n)-1,l=Math.log(this._tileSize)*Math.LOG2E,c=Math.pow(2,s-n+l),u=[r*Math.PI-t[0],r*Math.PI-t[1]],h=[u[0]+e[0][0],u[1]+e[0][1]],d=[u[0]+e[1][0],u[1]+e[1][1]],f=new ie(h,d),p=Math.pow(2,n)/2*this._tileSize,m=Ti(n,this._tileSize),g=new gr(p,p,m),y=Zv(Z0(Math.floor(h[0]/c)-this._margin,o,a),Z0(Math.floor(d[0]/c)+this._margin,o,a)),x=Zv(Z0(Math.floor(h[1]/c)-this._margin,o,a),Z0(Math.floor(d[1]/c)+this._margin,o,a)),b=[];for(let _=0;_<x.length;_++){let w=x[_];for(let A=0;A<y.length;A++){let k=y[A],v=[k,w,n];if(this._skipNullIsland&&Jt.isNearNullIsland(k,w,n))continue;let E=[k*this._tileSize,w*this._tileSize],S=[(k+1)*this._tileSize,(w+1)*this._tileSize],M=new ie(E,S),I=f.intersects(M),T=g.invert([E[0],S[1]]),C=g.invert([S[0],E[1]]),P={id:v.toString(),xyz:v,pxExtent:new ie(E,S),wgs84Extent:new ie(T,C),isVisible:I};I?b.unshift(P):b.push(P)}}return{tiles:b}}getGeoJSON(i){return{type:"FeatureCollection",features:i.tiles.map(t=>({type:"Feature",properties:{id:t.id,name:t.id},geometry:{type:"Polygon",coordinates:[t.wgs84Extent.polygon()]}}))}}tileSize(i){return i===void 0?this._tileSize:(this._tileSize=i,this)}zoomRange(i,e){return i===void 0?this._zoomRange:(e===void 0&&(e=i),this._zoomRange=[i,e],this)}margin(i){return i===void 0?this._margin:(this._margin=+i,this)}skipNullIsland(i){return i===void 0?this._skipNullIsland:(this._skipNullIsland=i,this)}static isNearNullIsland(i,e,t){if(t>=7){let r=Math.pow(2,t-1),s=Math.pow(2,t-6),n=r-s/2,o=r+s/2-1;return i>=n&&i<=o&&e>=n&&e<=o}return!1}};var SD=0;function de(i){if(!(this instanceof de))return i&&i.type?de[i.type].apply(this,arguments):i&&i.id?de[de.id.type(i.id)].apply(this,arguments):new de().initialize(arguments)}de.id=function(i){return de.id.fromOSM(i,de.id.next[i]--)};de.id.next={changeset:-1,node:-1,way:-1,relation:-1};de.id.fromOSM=function(i,e){return i[0]+e};de.id.toOSM=function(i){return i.slice(1)};de.id.type=function(i){return{c:"changeset",n:"node",w:"way",r:"relation"}[i[0]]};de.key=function(i){return i.id+"v"+(i.v||0)};var s1;de.deprecatedTagValuesByKey=function(i){return s1||(s1={},i.forEach(function(e){var t=Object.keys(e.old);if(t.length===1){var r=t[0],s=e.old[r];s!=="*"&&(s1[r]?s1[r].push(s):s1[r]=[s])}})),s1};de.prototype={tags:{},initialize:function(i){for(var e=0;e<i.length;++e){var t=i[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(t[r]===void 0?delete this[r]:this[r]=t[r])}return!this.id&&this.type&&(this.id=de.id(this.type)),this.hasOwnProperty("visible")||(this.visible=!0),this},copy:function(i,e){if(e[this.id])return e[this.id];var t=de(this,{id:void 0,user:void 0,version:void 0,v:void 0});return e[this.id]=t,t},osmId:function(){return de.id.toOSM(this.id)},isNew:function(){return this.osmId()<0},update:function(i){return de(this,i).touch()},touch:function(){return this.v=SD++,this},mergeTags:function(i){var e=Object.assign({},this.tags),t=!1;for(var r in i){var s=e[r],n=i[r];if(!s)t=!0,e[r]=n;else if(r==="building"){if(n==="yes")continue;s==="yes"&&(t=!0,e[r]=n)}else s!==n&&(t=!0,e[r]=A3(Gt(s.split(/;\s*/),n.split(/;\s*/)).join(";"),255))}return t?this.update({tags:e}):this},intersects:function(i,e){return this.extent(e).intersects(i)},hasNonGeometryTags:function(){return Object.keys(this.tags).some(function(i){return i!=="area"})},hasParentRelations:function(i){return i.parentRelations(this).length>0},hasInterestingTags:function(){return Object.keys(this.tags).some(lr)},isHighwayIntersection:function(){return!1},isDegenerate:function(){return!0},deprecatedTags:function(i){var e=this.tags;if(Object.keys(e).length===0)return[];var t=[];return i.forEach(function(r){var s=Object.keys(r.old);if(r.replace){var n=Object.keys(r.replace).some(function(a){if(!e[a]||r.old[a])return!1;var l=r.replace[a];return!(l==="*"||l===e[a])});if(n)return}var o=s.every(function(a){if(!e[a])return!1;if(r.old[a]==="*"||r.old[a]===e[a])return!0;var l=e[a].split(";").filter(Boolean);if(l.length===0)return!1;if(l.length>1)return l.indexOf(r.old[a])!==-1;if(e[a]===r.old[a])if(r.replace&&r.old[a]===r.replace[a]){var c=Object.keys(r.replace);return!c.every(function(u){return e[u]===r.replace[u]})}else return!0;return!1});o&&t.push(r)}),t}};function I5(i){if(i.type!=="way"||!i.tags.highway)return null;var e=i.tags,t=i.isOneWay(),r=CD(e,t),s=kD(e),n=TD(e,t,r),o=n.forward,a=n.backward,l=n.bothways,c={};c.unspecified=r9(e["turn:lanes"]),c.forward=r9(e["turn:lanes:forward"]),c.backward=r9(e["turn:lanes:backward"]);var u={};u.unspecified=s9(e["maxspeed:lanes"],s),u.forward=s9(e["maxspeed:lanes:forward"],s),u.backward=s9(e["maxspeed:lanes:backward"],s);var h={};h.unspecified=yr(e["psv:lanes"]),h.forward=yr(e["psv:lanes:forward"]),h.backward=yr(e["psv:lanes:backward"]);var d={};d.unspecified=yr(e["bus:lanes"]),d.forward=yr(e["bus:lanes:forward"]),d.backward=yr(e["bus:lanes:backward"]);var f={};f.unspecified=yr(e["taxi:lanes"]),f.forward=yr(e["taxi:lanes:forward"]),f.backward=yr(e["taxi:lanes:backward"]);var p={};p.unspecified=yr(e["hov:lanes"]),p.forward=yr(e["hov:lanes:forward"]),p.backward=yr(e["hov:lanes:backward"]);var m={};m.unspecified=yr(e["hgv:lanes"]),m.forward=yr(e["hgv:lanes:forward"]),m.backward=yr(e["hgv:lanes:backward"]);var g={};g.unspecified=n9(e["bicycleway:lanes"]),g.forward=n9(e["bicycleway:lanes:forward"]),g.backward=n9(e["bicycleway:lanes:backward"]);var y={forward:[],backward:[],unspecified:[]};return Go(y,c,"turnLane"),Go(y,u,"maxspeed"),Go(y,h,"psv"),Go(y,d,"bus"),Go(y,f,"taxi"),Go(y,p,"hov"),Go(y,m,"hgv"),Go(y,g,"bicycleway"),{metadata:{count:r,oneway:t,forward:o,backward:a,bothways:l,turnLanes:c,maxspeed:s,maxspeedLanes:u,psvLanes:h,busLanes:d,taxiLanes:f,hovLanes:p,hgvLanes:m,bicyclewayLanes:g},lanes:y}}function CD(i,e){var t;if(i.lanes&&(t=parseInt(i.lanes,10),t>0))return t;switch(i.highway){case"trunk":case"motorway":t=e?2:4;break;default:t=e?1:2;break}return t}function kD(i){var e=i.maxspeed;if(e){var t=/^([0-9][\.0-9]+?)(?:[ ]?(?:km\/h|kmh|kph|mph|knots))?$/;if(t.test(e))return parseInt(e,10)}}function TD(i,e,t){var r=parseInt(i["lanes:forward"],10),s=parseInt(i["lanes:backward"],10),n=parseInt(i["lanes:both_ways"],10)>0?1:0;return parseInt(i.oneway,10)===-1?(r=0,n=0,s=t):e?(r=t,n=0,s=0):isNaN(r)&&isNaN(s)?(s=Math.floor((t-n)/2),r=t-n-s):isNaN(r)?(s>t-n&&(s=t-n),r=t-n-s):isNaN(s)&&(r>t-n&&(r=t-n),s=t-n-r),{forward:r,backward:s,bothways:n}}function r9(i){if(i){var e=["left","slight_left","sharp_left","through","right","slight_right","sharp_right","reverse","merge_to_left","merge_to_right","none"];return i.split("|").map(function(t){return t===""&&(t="none"),t.split(";").map(function(r){return e.indexOf(r)===-1?"unknown":r})})}}function s9(i,e){if(i)return i.split("|").map(function(t){if(t==="none")return t;var r=parseInt(t,10);return t===""||r===e?null:isNaN(r)?"unknown":r})}function yr(i){if(i){var e=["yes","no","designated"];return i.split("|").map(function(t){return t===""&&(t="no"),e.indexOf(t)===-1?"unknown":t})}}function n9(i){if(i){var e=["yes","no","designated","lane"];return i.split("|").map(function(t){return t===""&&(t="no"),e.indexOf(t)===-1?"unknown":t})}}function Go(i,e,t){e.forward&&e.forward.forEach(function(r,s){i.forward[s]||(i.forward[s]={}),i.forward[s][t]=r}),e.backward&&e.backward.forEach(function(r,s){i.backward[s]||(i.backward[s]={}),i.backward[s][t]=r}),e.unspecified&&e.unspecified.forEach(function(r,s){i.unspecified[s]||(i.unspecified[s]={}),i.unspecified[s][t]=r})}var Je;function ei(i){if(Je&&!i)return Je;Je={};let e=navigator.userAgent,t=null;t=e.match(/(edg)\/?\s*(\.?\d+(\.\d+)*)/i),t!==null&&(Je.browser="Edge",Je.version=t[2]),Je.browser||(t=e.match(/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/i),t!==null&&(Je.browser="msie",Je.version=t[1])),Je.browser||(t=e.match(/(opr)\/?\s*(\.?\d+(\.\d+)*)/i),t!==null&&(Je.browser="Opera",Je.version=t[2])),Je.browser||(t=e.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i),t!==null&&(Je.browser=t[1],Je.version=t[2],t=e.match(/version\/([\.\d]+)/i),t!==null&&(Je.version=t[1]))),Je.browser||(Je.browser=navigator.appName,Je.version=navigator.appVersion),Je.version=Je.version.split(/\W/).slice(0,2).join("."),Je.opera=Je.browser.toLowerCase()==="opera"&&parseFloat(Je.version)<15,Je.browser.toLowerCase()==="msie"?Je.support=!1:Je.support=!0,Je.filedrop=window.FileReader&&"ondrop"in window,Je.download=!(Je.ie||Je.browser.toLowerCase()==="edge"),Je.cssfilters=!(Je.ie||Je.browser.toLowerCase()==="edge"),/Win/.test(e)?(Je.os="win",Je.platform="Windows"):/Mac/.test(e)?(Je.os="mac",Je.platform="Macintosh"):/X11/.test(e)||/Linux/.test(e)?(Je.os="linux",Je.platform="Linux"):(Je.os="win",Je.platform="Unknown"),Je.isMobileWebKit=(/\b(iPad|iPhone|iPod)\b/.test(e)||navigator.platform==="MacIntel"&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>1)&&/WebKit/.test(e)&&!/Edge/.test(e)&&!window.MSStream,Je.browserLocales=Array.from(new Set([navigator.language].concat(navigator.languages||[]).concat([navigator.userLanguage]).filter(Boolean)));let r=window.top.location,s=r.origin;return s||(s=r.protocol+"//"+r.hostname+(r.port?":"+r.port:"")),Je.host=s+r.pathname,Je}function ft(i,e){let t=new ie;for(let r of i){let s=typeof r=="string"?e.hasEntity(r):r;if(s){let n=s.extent(e);t.min=[Math.min(t.min[0],n.min[0]),Math.min(t.min[1],n.min[1])],t.max=[Math.max(t.max[0],n.max[0]),Math.max(t.max[1],n.max[1])]}}return t}function Xe(i,e,t){let r=t.systems.editor,s=t.systems.map,n=s.scene;if(n){if(e){for(let o of i)if(n.classData("osm",o,"highlighted"),o[0]==="r"){let a=r.staging.graph.hasEntity(o);if(!a)continue;for(let l of a.members)n.classData("osm",l.id,"highlighted")}}else n.clearClass("highlighted");s.immediateRedraw()}}function zo(i){return!(!i.match(/^(#([0-9a-fA-F]{3}){1,2}|\w+)$/)||!CSS.supports("color",i)||["unset","inherit","initial","revert"].includes(i))}function gs(i,e,t,r,s){let n=`translate3d(${e}px,${t}px,0)`,o=r?` scale(${r})`:"",a=s?` rotate(${s}deg)`:"";return i.style("transform",`${n}${o}${a}`)}function t2(i){let e=i.getBoundingClientRect(),t=e.left,r=e.top,s=+i.clientLeft,n=+i.clientTop;return function(o){return[o.clientX-t-s,o.clientY-r-n]}}function n1(i,e){return i<0&&(i+=Math.ceil(-i/e)*e),i%e}function kt(i){return typeof i=="function"?i:()=>i}function Re(i){let e=i.size()&&i.node().tagName.toLowerCase()==="textarea";return i.attr("autocomplete","new-password").attr("autocorrect","off").attr("autocapitalize","off").attr("data-1p-ignore","").attr("data-lpignore","true").attr("spellcheck",e?"true":"false")}var i2=class extends Error{constructor(e){let t=e.status+" "+e.statusText;super(t),this.name="FetchError",this.status=e.status,this.statusText=e.statusText,this.response=e}};function Me(i){if(!i.ok)throw new i2(i);let e=(i.headers.get("content-type")||"").split(";")[0];if(!e)switch((new URL(i.url).pathname.split("/").at(-1)||"").toLowerCase().split(".").at(-1)||""){case"geojson":case"json":e="application/json";break;case"htm":case"html":e="text/html";break;case"svg":e="image/svg+xml";break;case"gpx":case"kml":case"xml":e="application/xml";break;case"mvt":case"pb":case"pbf":case"pmtiles":case"proto":e="application/protobuf";break;default:e="text/plain"}switch(e){case"application/geo+json":case"application/json":case"application/vnd.geo+json":case"text/x-json":return i.status===204||i.status===205?void 0:i.json();case"application/xhtml+xml":case"application/xml":case"image/svg+xml":case"text/html":case"text/xml":return i.text().then(t=>new window.DOMParser().parseFromString(t,e));case"application/octet-stream":case"application/protobuf":case"application/vnd.google.protobuf":case"application/vnd.mapbox-vector-tile":case"application/x-protobuf":return i.arrayBuffer();default:return i.text()}}function i_(i,e){var t=e.getBoundingClientRect(),r=[t.width,t.height];return i.property("__dimensions__",r),r}function Kr(i,e){if(!i||i.empty())return[0,0];var t=i.node(),r=i.property("__dimensions__");return!r||e?i_(i,t):r}function r_(i,e){if(!i||i.empty())return i;var t=i.node();return e===null?(i_(i,t),i):i.property("__dimensions__",[e[0],e[1]]).attr("width",e[0]).attr("height",e[1])}function be(i,e){function t(r){function s(){delete this.value}function n(){this.value!==r&&(this.value=r)}function o(){var a=r.apply(this,arguments);a==null?delete this.value:this.value!==a&&(this.value=a)}return r==null?s:typeof r=="function"?o:n}return arguments.length===1?i.property("value"):i.each(t(e))}function He(i){var e={};function t(o,a){var l=!1,c=Object.keys(e).map(function(f){return e[f]}),u,h;for(u=0;u<c.length;u++)if(h=c[u],!!h.event.modifiers.shiftKey&&!!h.capture===a&&d(o,h,!0)){h.callback(o),l=!0;break}if(l)return;for(u=0;u<c.length;u++)if(h=c[u],!h.event.modifiers.shiftKey&&!!h.capture===a&&d(o,h,!1)){h.callback(o);break}function d(f,p,m){var g=f,y=!1,x=!0;return g.key!==void 0&&(x=g.key.charCodeAt(0)>255,y=!0,p.event.key===void 0?y=!1:Array.isArray(p.event.key)?p.event.key.map(function(b){return b.toLowerCase()}).indexOf(g.key.toLowerCase())===-1&&(y=!1):g.key.toLowerCase()!==p.event.key.toLowerCase()&&(y=!1)),!y&&x&&(y=g.keyCode===p.event.keyCode),!(!y||!(g.ctrlKey&&g.altKey)&&(g.ctrlKey!==p.event.modifiers.ctrlKey||g.altKey!==p.event.modifiers.altKey)||g.metaKey!==p.event.modifiers.metaKey||m&&g.shiftKey!==p.event.modifiers.shiftKey)}}function r(o){t(o,!0)}function s(o){var a=G(o.target).node().tagName;a==="INPUT"||a==="SELECT"||a==="TEXTAREA"||t(o,!1)}function n(o){return o=o||G(document),o.on("keydown.capture."+i,r,!0),o.on("keydown.bubble."+i,s,!1),n}return n.unbind=function(o){return e=[],o=o||G(document),o.on("keydown.capture."+i,null),o.on("keydown.bubble."+i,null),n},n.clear=function(){return e={},n},n.off=function(o,a){for(var l=Fe([].concat(o)),c=0;c<l.length;c++){var u=l[c]+(a?"-capture":"-bubble");delete e[u]}return n},n.on=function(o,a,l){if(typeof a!="function")return n.off(o,l);for(var c=Fe([].concat(o)),u=0;u<c.length;u++){var h=c[u]+(l?"-capture":"-bubble"),d={id:h,capture:l,callback:a,event:{key:void 0,keyCode:0,modifiers:{shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1}}};e[h]&&console.warn('warning: duplicate keybinding for "'+h+'"'),e[h]=d;for(var f=c[u].toLowerCase().match(/(?:(?:[^+])+|[]|\+\+|^\+$)/g),p=0;p<f.length;p++)if(f[p]==="++"&&(f[p]="+"),f[p]in He.modifierCodes){var m=He.modifierProperties[He.modifierCodes[f[p]]];d.event.modifiers[m]=!0}else d.event.key=He.keys[f[p]]||f[p],f[p]in He.keyCodes&&(d.event.keyCode=He.keyCodes[f[p]])}return n},n}He.modifierCodes={"\u21E7":16,shift:16,"\u2303":17,ctrl:17,"\u2325":18,alt:18,option:18,"\u2318":91,meta:91,cmd:91,super:91,win:91};He.modifierProperties={16:"shiftKey",17:"ctrlKey",18:"altKey",91:"metaKey"};He.plusKeys=["+","ffplus","=","ffequals","\u2260","\xB1"];He.minusKeys=["_","-","ffminus","dash","\u2013","\u2014"];He.keys={"\u232B":"Backspace",backspace:"Backspace","\u21E5":"Tab","\u21C6":"Tab",tab:"Tab","\u21A9":"Enter","\u21B5":"Enter","\u23CE":"Enter",return:"Enter",enter:"Enter","\u2305":"Enter",pause:"Pause","pause-break":"Pause","\u21EA":"CapsLock",caps:"CapsLock","caps-lock":"CapsLock","\u238B":["Escape","Esc"],escape:["Escape","Esc"],esc:["Escape","Esc"],space:[" ","Spacebar"],"\u2196":"PageUp",pgup:"PageUp","page-up":"PageUp","\u2198":"PageDown",pgdown:"PageDown","page-down":"PageDown","\u21DF":"End",end:"End","\u21DE":"Home",home:"Home",ins:"Insert",insert:"Insert","\u2326":["Delete","Del"],del:["Delete","Del"],delete:["Delete","Del"],"\u2190":["ArrowLeft","Left"],left:["ArrowLeft","Left"],"arrow-left":["ArrowLeft","Left"],"\u2191":["ArrowUp","Up"],up:["ArrowUp","Up"],"arrow-up":["ArrowUp","Up"],"\u2192":["ArrowRight","Right"],right:["ArrowRight","Right"],"arrow-right":["ArrowRight","Right"],"\u2193":["ArrowDown","Down"],down:["ArrowDown","Down"],"arrow-down":["ArrowDown","Down"],"*":["*","Multiply"],star:["*","Multiply"],asterisk:["*","Multiply"],multiply:["*","Multiply"],"+":["+","Add"],plus:["+","Add"],"-":["-","Subtract"],subtract:["-","Subtract"],dash:["-","Subtract"],semicolon:";",equals:"=",comma:",",period:".","full-stop":".",slash:"/","forward-slash":"/",tick:"`","back-quote":"`","open-bracket":"[","back-slash":"\\","close-bracket":"]",quote:"'",apostrophe:"'","num-0":"0","num-1":"1","num-2":"2","num-3":"3","num-4":"4","num-5":"5","num-6":"6","num-7":"7","num-8":"8","num-9":"9",f1:"F1",f2:"F2",f3:"F3",f4:"F4",f5:"F5",f6:"F6",f7:"F7",f8:"F8",f9:"F9",f10:"F10",f11:"F11",f12:"F12",f13:"F13",f14:"F14",f15:"F15",f16:"F16",f17:"F17",f18:"F18",f19:"F19",f20:"F20",f21:"F21",f22:"F22",f23:"F23",f24:"F24",f25:"F25"};He.keyCodes={"\u232B":8,backspace:8,"\u21E5":9,"\u21C6":9,tab:9,"\u21A9":13,"\u21B5":13,"\u23CE":13,return:13,enter:13,"\u2305":13,pause:19,"pause-break":19,"\u21EA":20,caps:20,"caps-lock":20,"\u238B":27,escape:27,esc:27,space:32,"\u2196":33,pgup:33,"page-up":33,"\u2198":34,pgdown:34,"page-down":34,"\u21DF":35,end:35,"\u21DE":36,home:36,ins:45,insert:45,"\u2326":46,del:46,delete:46,"\u2190":37,left:37,"arrow-left":37,"\u2191":38,up:38,"arrow-up":38,"\u2192":39,right:39,"arrow-right":39,"\u2193":40,down:40,"arrow-down":40,ffequals:61,"*":106,star:106,asterisk:106,multiply:106,"+":107,plus:107,"-":109,subtract:109,"|":124,ffplus:171,ffminus:173,";":186,semicolon:186,"=":187,equals:187,",":188,comma:188,dash:189,".":190,period:190,"full-stop":190,"/":191,slash:191,"forward-slash":191,"`":192,tick:192,"back-quote":192,"[":219,"open-bracket":219,"\\":220,"back-slash":220,"]":221,"close-bracket":221,"'":222,quote:222,apostrophe:222};var ys=95,jo=0;for(;++ys<106;)He.keyCodes["num-"+jo]=ys,++jo;ys=47;jo=0;for(;++ys<58;)He.keyCodes[jo]=ys,++jo;ys=111;jo=1;for(;++ys<136;)He.keyCodes["f"+jo]=ys,++jo;ys=64;for(;++ys<91;)He.keyCodes[String.fromCharCode(ys).toLowerCase()]=ys;function me(i,e){for(var t=1,r=arguments.length,s;++t<r;)i[s=arguments[t]]=ID(i,e,e[s]);return i}function ID(i,e,t){return function(){var r=t.apply(e,arguments);return r===e?i:r}}function o1(i,e){i.each(function(){var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!0),this.dispatchEvent(t)})}function pt(){if(this instanceof pt)arguments.length&&this.initialize(arguments);else return new pt().initialize(arguments)}de.way=pt;pt.prototype=Object.create(de.prototype);Object.assign(pt.prototype,{type:"way",nodes:[],copy:function(i,e){if(e[this.id])return e[this.id];var t=de.prototype.copy.call(this,i,e),r=this.nodes.map(function(s){return i.entity(s).copy(i,e).id});return t=t.update({nodes:r}),e[this.id]=t,t},extent:function(i){return i.transient(this,"extent",function(){return ft(this.nodes,i)})},first:function(){return this.nodes[0]},last:function(){return this.nodes[this.nodes.length-1]},contains:function(i){return this.nodes.indexOf(i)>=0},affix:function(i){if(this.nodes[0]===i)return"prefix";if(this.nodes[this.nodes.length-1]===i)return"suffix"},layer:function(){return isFinite(this.tags.layer)?Math.max(-10,Math.min(+this.tags.layer,10)):this.tags.covered==="yes"?-1:this.tags.location==="overground"?1:this.tags.location==="underground"?-1:this.tags.location==="underwater"?-10:this.tags.power==="line"||this.tags.power==="minor_line"||this.tags.aerialway?10:this.tags.bridge?1:this.tags.cutting||this.tags.tunnel||this.tags.waterway?-1:this.tags.man_made==="pipeline"||this.tags.boundary?-10:0},impliedLineWidthMeters:function(){var i={highway:{motorway:5,motorway_link:5,trunk:4.5,trunk_link:4.5,primary:4,secondary:4,tertiary:4,primary_link:4,secondary_link:4,tertiary_link:4,unclassified:4,road:4,living_street:4,bus_guideway:4,pedestrian:4,residential:3.5,service:3.5,track:3,cycleway:2.5,bridleway:2,corridor:2,steps:2,path:1.5,footway:1.5},railway:{rail:2.5,light_rail:2.5,tram:2.5,subway:2.5,monorail:2.5,funicular:2.5,disused:2.5,preserved:2.5,miniature:1.5,narrow_gauge:1.5},waterway:{river:50,canal:25,stream:5,tidal_channel:5,fish_pass:2.5,drain:2.5,ditch:1.5}};for(var e in i)if(this.tags[e]&&i[e][this.tags[e]]){var t=i[e][this.tags[e]];if(e==="highway"){var r=this.tags.lanes&&parseInt(this.tags.lanes,10);return r||(r=this.isOneWay()?1:2),t*r}return t}return null},isOneWay:function(){var i={yes:!0,1:!0,"-1":!0,reversible:!0,alternating:!0,no:!1,0:!1};if(i[this.tags.oneway]!==void 0)return i[this.tags.oneway];for(var e in this.tags)if(e in No&&this.tags[e]in No[e])return!0;return!1},sidednessIdentifier:function(){for(let i in this.tags){let e=this.tags[i],t=y0(i);if(t in x0&&e in x0[t])return x0[t][e]===!0?t:x0[t][e]}return null},isSided:function(){return this.tags.two_sided==="yes"?!1:this.sidednessIdentifier()!==null},lanes:function(){return I5(this)},isClosed:function(){return this.nodes.length>1&&this.first()===this.last()},isConvex:function(i){if(!this.isClosed()||this.isDegenerate())return null;for(var e=Fe(i.childNodes(this)),t=e.map(function(u){return u.loc}),r=0,s=0,n=0;n<t.length;n++){var o=t[(n+1)%t.length],a=t[n],l=t[(n+2)%t.length],c=J0(a,l,o);if(r=c>0?1:c<0?-1:0,r!==0){if(s&&r!==s)return!1;s=r}}return!0},tagSuggestingArea:function(){return Do(this.tags)},isArea:function(){return this.tags.area==="yes"?!0:!this.isClosed()||this.tags.area==="no"?!1:this.tagSuggestingArea()!==null},isDegenerate:function(){return new Set(this.nodes).size<(this.isClosed()?3:2)},areAdjacent:function(i,e){for(var t=0;t<this.nodes.length;t++)if(this.nodes[t]===i&&(this.nodes[t-1]===e||this.nodes[t+1]===e))return!0;return!1},geometry:function(i){return i.transient(this,"geometry",function(){return this.isArea()?"area":"line"})},segments:function(i){function e(t){var r=t.hasEntity(this.nodes[0]),s=t.hasEntity(this.nodes[1]);return r&&s&&new ie([Math.min(r.loc[0],s.loc[0]),Math.min(r.loc[1],s.loc[1])],[Math.max(r.loc[0],s.loc[0]),Math.max(r.loc[1],s.loc[1])])}return i.transient(this,"segments",function(){for(var t=[],r=0;r<this.nodes.length-1;r++)t.push({id:this.id+"-"+r,wayId:this.id,index:r,nodes:[this.nodes[r],this.nodes[r+1]],extent:e});return t})},close:function(){if(this.isClosed()||!this.nodes.length)return this;var i=this.nodes.slice();return i=i.filter(a1),i.push(i[0]),this.update({nodes:i})},unclose:function(){if(!this.isClosed())return this;for(var i=this.nodes.slice(),e=this.first(),t=i.length-1;t>0&&i.length>1&&i[t]===e;)i.splice(t,1),t=i.length-1;return i=i.filter(a1),this.update({nodes:i})},addNode:function(i,e){var t=this.nodes.slice(),r=this.isClosed(),s=r?t.length-1:t.length;if(e===void 0&&(e=s),e<0||e>s)throw new RangeError("index "+e+" out of range 0.."+s);if(r){for(var n=this.first(),o=1;o<t.length&&t.length>2&&t[o]===n;)t.splice(o,1),e>o&&e--;for(o=t.length-1;o>0&&t.length>1&&t[o]===n;)t.splice(o,1),e>o&&e--,o=t.length-1}return t.splice(e,0,i),t=t.filter(a1),r&&(t.length===1||t[0]!==t[t.length-1])&&t.push(t[0]),this.update({nodes:t})},updateNode:function(i,e){var t=this.nodes.slice(),r=this.isClosed(),s=t.length-1;if(e===void 0||e<0||e>s)throw new RangeError("index "+e+" out of range 0.."+s);if(r){for(var n=this.first(),o=1;o<t.length&&t.length>2&&t[o]===n;)t.splice(o,1),e>o&&e--;for(o=t.length-1;o>0&&t.length>1&&t[o]===n;)t.splice(o,1),e===o&&(e=0),o=t.length-1}return t.splice(e,1,i),t=t.filter(a1),r&&(t.length===1||t[0]!==t[t.length-1])&&t.push(t[0]),this.update({nodes:t})},replaceNode:function(i,e){for(var t=this.nodes.slice(),r=this.isClosed(),s=0;s<t.length;s++)t[s]===i&&(t[s]=e);return t=t.filter(a1),r&&(t.length===1||t[0]!==t[t.length-1])&&t.push(t[0]),this.update({nodes:t})},removeNode:function(i){var e=this.nodes.slice(),t=this.isClosed();return e=e.filter(function(r){return r!==i}).filter(a1),t&&(e.length===1||e[0]!==e[e.length-1])&&e.push(e[0]),this.update({nodes:e})},asJXON:function(i){var e={way:{"@id":this.osmId(),"@version":this.version||0,nd:this.nodes.map(function(t){return{keyAttributes:{ref:de.id.toOSM(t)}}},this),tag:Object.keys(this.tags).map(function(t){return{keyAttributes:{k:t,v:this.tags[t]}}},this)}};return i&&(e.way["@changeset"]=i),e},asGeoJSON:function(i){return i.transient(this,"GeoJSON",function(){var e=i.childNodes(this).map(function(t){return t.loc});return this.isArea()&&this.isClosed()?{type:"Polygon",coordinates:[e]}:{type:"LineString",coordinates:e}})},area:function(i){return i.transient(this,"area",function(){var e=i.childNodes(this),t={type:"Polygon",coordinates:[e.map(function(s){return s.loc})]};!this.isClosed()&&e.length&&t.coordinates[0].push(e[0].loc);var r=hn(t);return r>2*Math.PI&&(t.coordinates[0]=t.coordinates[0].reverse(),r=hn(t)),isNaN(r)?0:r})}});function a1(i,e,t){return e===0||i!==t[e-1]}function l1(i,e){if(i.type!=="relation"||!i.isMultipolygon()||Object.keys(i.tags).filter(lr).length>1)return!1;var t;for(var r in i.members){var s=i.members[r];if((!s.role||s.role==="outer")&&(t||s.type!=="way"||!e.hasEntity(s.id)||(t=e.entity(s.id),Object.keys(t.tags).filter(lr).length===0)))return!1}return t}function c1(i,e){if(i.type!=="way"||Object.keys(i.tags).filter(lr).length===0)return!1;var t=e.parentRelations(i);if(t.length!==1)return!1;var r=t[0];if(!r.isMultipolygon()||Object.keys(r.tags).filter(lr).length>1)return!1;for(var s=r.members,n,o=0;o<s.length;o++)if(n=s[o],n.id===i.id&&n.role&&n.role!=="outer"||n.id!==i.id&&(!n.role||n.role==="outer"))return!1;return r}function s_(i,e){if(i.type!=="way")return!1;var t=e.parentRelations(i);if(t.length!==1)return!1;var r=t[0];if(!r.isMultipolygon()||Object.keys(r.tags).filter(lr).length>1)return!1;for(var s=r.members,n,o,a=0;a<s.length;a++)if(n=s[a],!n.role||n.role==="outer"){if(o)return!1;o=n}if(!o)return!1;var l=e.hasEntity(o.id);return!l||!Object.keys(l.tags).filter(lr).length?!1:l}function Rr(i,e){function t(p){return e.childNodes(e.entity(p.id))}function r(p){var m=hs(p.id,{reverseOneway:!0});return o.actions.push(m),p instanceof pt?m(e).entity(p.id):p}i=i.filter(function(p){return p.type==="way"&&e.hasEntity(p.id)});var s,n=!0;for(s=0;s<i.length;s++)if(i[s]instanceof pt){n=!1;break}var o=[];for(o.actions=[];i.length;){for(var a=i.shift(),l=[a],c=t(a).slice();i.length;){var u=c[0],h=c[c.length-1],d=null,f=null;for(s=0;s<i.length;s++)if(a=i[s],f=t(a),n&&l.length===1&&f[0]!==h&&f[f.length-1]!==h&&(f[f.length-1]===u||f[0]===u)&&(l[0]=r(l[0]),c.reverse(),u=c[0],h=c[c.length-1]),f[0]===h){d=c.push,f=f.slice(1);break}else if(f[f.length-1]===h){d=c.push,f=f.slice(0,-1).reverse(),a=r(a);break}else if(f[f.length-1]===u){d=c.unshift,f=f.slice(0,-1);break}else if(f[0]===u){d=c.unshift,f=f.slice(1).reverse(),a=r(a);break}else d=f=null;if(!f)break;d.apply(l,[a]),d.apply(c,f),i.splice(s,1)}l.nodes=c,o.push(l)}return o}function Ua(i,e,t,r){return function(o){var a=o.entity(i),l=/stop|platform/.test(e.role);return(isNaN(t)||r)&&e.type==="way"&&!l?o=s(a,o):(l&&isNaN(t)&&(t=0),o=o.replace(a.addMember(e,t))),o};function s(n,o){var a,l,c,u,h,d,f=[],p=[];for(u=0;u<n.members.length;u++){var m=n.members[u];/stop|platform/.test(m.role)?f.push(m):p.push(m)}if(n=n.update({members:p}),r){l=pt({id:"wTemp",nodes:r.nodes}),o=o.replace(l);var g={id:l.id,type:"way",role:e.role},y=n.replaceMember({id:r.originalID},g,!0);a=Ut(y.members,"type"),a.way=a.way||[]}else a=Ut(n.members,"type"),a.way=a.way||[],a.way.push(e);p=S(a.way);var x=Rr(p,o);for(u=0;u<x.length;u++){var b=x[u],_=b.nodes.slice(),w=b[0].index;for(h=0;h<p.length&&p[h].index!==w;h++);for(d=0;d<b.length;d++){c=b[d];var A=o.entity(c.id);l&&c.id===l.id&&(_[0].id===r.nodes[0]?c.pair=[{id:r.originalID,type:"way",role:c.role},{id:r.insertedID,type:"way",role:c.role}]:c.pair=[{id:r.insertedID,type:"way",role:c.role},{id:r.originalID,type:"way",role:c.role}]),d>0&&(h+d>=p.length||c.index!==p[h+d].index)&&E(p,c.index,h+d),_.splice(0,A.nodes.length-1)}}l&&(o=o.remove(l));var k=[];for(u=0;u<p.length;u++)c=p[u],c.index!==-1&&(c.pair?(k.push(c.pair[0]),k.push(c.pair[1])):k.push(li(c,["index"])));var v=f.concat(a.node||[],k,a.relation||[]);return o.replace(n.update({members:v}));function E(M,I,T){var C;for(C=0;C<M.length&&M[C].index!==I;C++);var P=Object.assign({},M[C]);M[C].index=-1,P.index=T,M.splice(T,0,P)}function S(M){for(var I=new Array(M.length),T=0;T<M.length;T++)I[T]=Object.assign({},M[T]),I[T].index=T;return I}}}function yi(i,e){return function(t){t=t.replace(e.move(i.loc));var r=Vi(t.parentWays(t.entity(i.edge[0])),t.parentWays(t.entity(i.edge[1])));return r.forEach(function(s){for(var n=0;n<s.nodes.length-1;n++)if(e_([s.nodes[n],s.nodes[n+1]],i.edge)){t=t.replace(t.entity(s.id).addNode(e.id,n+1));return}}),t}}function xs(i,e,t){return function(r){return r.replace(r.entity(i).addNode(e,t))}}function Vo(i,e,t){return function(r){return r.replace(r.entity(i).updateMember(e,t))}}var n_=new Set(["motorway","trunk","primary","secondary","tertiary","residential","motorway_link","trunk_link","primary_link","secondary_link","tertiary_link","unclassified","road","service","track","living_street","bus_guideway","busway"]),o9=new Set(["path","footway","cycleway","bridleway","pedestrian"]),M5=new Set(["crossing","crossing_ref","crossing:continuous","crossing:island","crossing:markings","crossing:signals"]),o_=new Set(["crossing_ref","crossing:continuous","crossing:island"]);function Vs(i){return function(c){let u=c.entity(i),h=u.geometry(c);return u.type==="way"&&h==="line"?c=n(u,c):u.type==="node"&&h==="vertex"&&(c=o(u,c)),c};function e(l){for(let c of o9)if(l.highway===c&&l[c]==="crossing")return!0;return!1}function t(l){return n_.has(l.highway)||o9.has(l.highway)||!!l.railway||!!l.crossing}function r(l){return o9.has(l.highway)}function s(l){let c=new Set((l.highway||"").split(";").filter(Boolean));return!!l["crossing:markings"]||c.has("crossing")}function n(l,c,u){let h=Object.assign({},l.tags);h=a(h);let d=e(h),f=!t(h);if(f)for(let y of M5)delete h[y];if(l=l.update({tags:h}),c=c.replace(l),!(d||f))return c;let p={};for(let y of M5)p[y]=h[y];let m=new Set;for(let y of l.nodes){if(y===u)continue;let x=c.hasEntity(y);if(x){if(d){let b=!1;for(let _ of c.parentWays(x))if(_.id!==l.id&&n_.has(_.tags.highway)){b=!0;break}b&&m.add(x)}else if(f){let b=!0;for(let _ of c.parentWays(x))if(_.id!==l.id&&t(_.tags)){b=!1;break}b&&m.add(x)}}}let g=["informal","no"].includes(p.crossing);for(let y of m){let x=Object.assign({},y.tags);for(let[_,w]of Object.entries(p))w?x[_]=w:o_.has(_)||delete x[_];let b=new Set((x.highway||"").split(";").filter(Boolean));d?g?b.delete("crossing"):b.add("crossing"):f&&b.delete("crossing"),b.size?x.highway=Array.from(b).join(";"):delete x.highway,c=c.replace(y.update({tags:x}))}return c}function o(l,c){let u=c.parentWays(l),h=Object.assign({},l.tags);h=a(h);let d=s(h)&&u.some(m=>t(m.tags));if(!d)for(let m of M5)delete h[m];if(l=l.update({tags:h}),c=c.replace(l),!d)return c;let f={};for(let m of M5)f[m]=h[m];let p=new Set;for(let m of u)e(m.tags)&&p.add(m);for(let m of p){let g=Object.assign({},m.tags);for(let[y,x]of Object.entries(f))x?g[y]=x:o_.has(y)||delete g[y];m=m.update({tags:g}),c=c.replace(m),d&&(c=n(m,c,l.id))}return c}function a(l){var p,m,g,y;let c=(p=l.crossing)!=null?p:"",u=(m=l.crossing_ref)!=null?m:"",h=(g=l["crossing:markings"])!=null?g:"",d=(y=l["crossing:signals"])!=null?y:"";if(!c&&!u&&!h&&!d||c.includes(";")||u.includes(";")||h.includes(";")||d.includes(";"))return l;let f=Object.assign({},l);if(u){if(!h)switch(u){case"zebra":h=f["crossing:markings"]="zebra";break;default:h=f["crossing:markings"]="yes";break}if(!d)switch(u){case"hawk":case"pelican":case"puffin":case"toucan":case"pegasus":d=f["crossing:signals"]="yes";break}}if(c){if(!h)switch(c){case"island":case"pedestrian_signals":case"traffic_signals":break;case"informal":case"no":case"unmarked":h=f["crossing:markings"]="no";break;case"zebra":h=f["crossing:markings"]="zebra";break;default:h=f["crossing:markings"]="yes";break}if(!d)switch(c){case"informal":case"no":case"uncontrolled":d=f["crossing:signals"]="no";break;case"pedestrian_signals":case"traffic_signals":d=f["crossing:signals"]="yes";break}let x=!["island","informal","no","traffic_signals","pedestrian_signals","unmarked"].includes(c),b=["traffic_signals","pedestrian_signals"].includes(c),_=h&&h!=="no",w=d&&d!=="no";(x&&!_||!x&&_||b&&!w||!b&&w||c==="yes"&&h)&&(c=null,delete f.crossing)}if(!f.crossing){if(d&&d!=="no")f.crossing="traffic_signals";else if(h)switch(h){case"no":f.crossing="unmarked";break;default:f.crossing="marked";break}}return f}}function xr(i,e,t,r){return function(n){let o=n.entity(i),a=o.geometry(n),l=Object.assign({},o.tags),c=o.tags;return e&&(c=e.unsetTags(c,a,t&&t.addTags?Object.keys(t.addTags):null)),t&&(c=t.setTags(c,a,r)),n=n.replace(o.update({tags:c})),["crossing","crossing_ref","crossing:continuous","crossing:island","crossing:markings","crossing:signals"].some(h=>c[h]!==l[h])&&(n=Vs(i)(n)),n}}function vt(i,e){return function(t){let r=t.entity(i);return t.replace(r.update({tags:e}))}}function Be(){if(this instanceof Be)arguments.length&&this.initialize(arguments);else return new Be().initialize(arguments)}de.node=Be;Be.prototype=Object.create(de.prototype);Object.assign(Be.prototype,{type:"node",loc:[9999,9999],extent:function(){return new ie(this.loc)},geometry:function(i){return i.transient(this,"geometry",function(){return i.isPoi(this)?"point":"vertex"})},move:function(i){return this.update({loc:i})},isDegenerate:function(){return!(Array.isArray(this.loc)&&this.loc.length===2&&this.loc[0]>=-180&&this.loc[0]<=180&&this.loc[1]>=-90&&this.loc[1]<=90)},directions:function(i,e){var t,r;if(this.isHighwayIntersection(i)&&(this.tags.stop||"").toLowerCase()==="all")t="all";else{t=(this.tags.direction||"").toLowerCase();var s=/:direction$/i,n=Object.keys(this.tags);for(r=0;r<n.length;r++)if(s.test(n[r])){t=this.tags[n[r]].toLowerCase();break}}if(t==="")return[];var o={north:0,n:0,northnortheast:22,nne:22,northeast:45,ne:45,eastnortheast:67,ene:67,east:90,e:90,eastsoutheast:112,ese:112,southeast:135,se:135,southsoutheast:157,sse:157,south:180,s:180,southsouthwest:202,ssw:202,southwest:225,sw:225,westsouthwest:247,wsw:247,west:270,w:270,westnorthwest:292,wnw:292,northwest:315,nw:315,northnorthwest:337,nnw:337},a=t.split(";"),l=[];return a.forEach(function(c){if(o[c]!==void 0&&(c=o[c]),c!==""&&!isNaN(+c)){l.push(+c);return}var u=this.tags["traffic_sign:backward"]||c==="backward"||c==="both"||c==="all",h=this.tags["traffic_sign:forward"]||c==="forward"||c==="both"||c==="all";if(!(!h&&!u)){var d={};i.parentWays(this).forEach(function(f){var p=f.nodes;for(r=0;r<p.length;r++)p[r]===this.id&&(h&&r>0&&(d[p[r-1]]=!0),u&&r<p.length-1&&(d[p[r+1]]=!0))},this),Object.keys(d).forEach(function(f){var p=e.project(this.loc),m=e.project(i.entity(f).loc);l.push($t(p,m)*180/Math.PI+90)},this)}},this),Fe(l)},isCrossing:function(){return this.tags.highway==="crossing"||this.tags.railway&&this.tags.railway.indexOf("crossing")!==-1},isEndpoint:function(i){return i.transient(this,"isEndpoint",function(){var e=this.id;return i.parentWays(this).filter(function(t){return!t.isClosed()&&!!t.affix(e)}).length>0})},isConnected:function(i){return i.transient(this,"isConnected",function(){var e=i.parentWays(this);if(e.length>1){for(var t in e)if(e[t].geometry(i)==="line"&&e[t].hasInterestingTags())return!0}else if(e.length===1){var r=e[0],s=r.nodes.slice();return r.isClosed()&&s.pop(),s.indexOf(this.id)!==s.lastIndexOf(this.id)}return!1})},parentIntersectionWays:function(i){return i.transient(this,"parentIntersectionWays",function(){return i.parentWays(this).filter(function(e){return(e.tags.highway||e.tags.waterway||e.tags.railway||e.tags.aeroway)&&e.geometry(i)==="line"})})},isIntersection:function(i){return this.parentIntersectionWays(i).length>1},isHighwayIntersection:function(i){return i.transient(this,"isHighwayIntersection",function(){return i.parentWays(this).filter(function(e){return e.tags.highway&&e.geometry(i)==="line"}).length>1})},isOnAddressLine:function(i){return i.transient(this,"isOnAddressLine",function(){return i.parentWays(this).filter(function(e){return e.tags.hasOwnProperty("addr:interpolation")&&e.geometry(i)==="line"}).length>0})},asJXON:function(i){var e={node:{"@id":this.osmId(),"@lon":this.loc[0],"@lat":this.loc[1],"@version":this.version||0,tag:Object.keys(this.tags).map(function(t){return{keyAttributes:{k:t,v:this.tags[t]}}},this)}};return i&&(e.node["@changeset"]=i),e},asGeoJSON:function(){return{type:"Point",coordinates:this.loc}}});function P5(i,e,t){t=(t||20)*Math.PI/180;var r=function(s,n){(n===null||!isFinite(n))&&(n=1),n=Math.min(Math.max(+n,0),1);var o=s.entity(i),a={};s.childNodes(o).forEach(function(pe){a[pe.id]||(a[pe.id]=pe)}),o.isConvex(s)||(s=r.makeConvex(s));var l=Fe(s.childNodes(o)),c=l.filter(function(pe){return s.parentWays(pe).length!==1}),u=l.map(function(pe){return e.project(pe.loc)}),h=c.map(function(pe){return e.project(pe.loc)}),d=u.length===2?ct(u[0],u[1],.5):Pr(u),f=L3(u,function(pe){return Ue(d,pe)}),p=Vl(u)>0?1:-1,m,g,y,x;if(c.length||(c=[l[0]],h=[u[0]]),c.length===1){var b=l.indexOf(c[0]),_=Math.floor((b+l.length/2)%l.length);c.push(l[_]),h.push(u[_])}for(g=0;g<h.length;g++){var w=(g+1)%c.length,A=c[g],k=c[w],v=l.indexOf(A),E=l.indexOf(k),S=-1,M=E-v,I={},T=[],C,P,D,O,R,N,F,B;M<0&&(M+=l.length);var $=Ue(d,h[g])||1e-4;h[g]=[d[0]+(h[g][0]-d[0])/$*f,d[1]+(h[g][1]-d[1])/$*f],N=e.invert(h[g]),F=c[g],B=a[F.id],F=F.move(ct(B.loc,N,n)),s=s.replace(F),C=Math.atan2(h[g][1]-d[1],h[g][0]-d[0]),P=Math.atan2(h[w][1]-d[1],h[w][0]-d[0]),D=P-C,D*p>0&&(D=-p*(2*Math.PI-Math.abs(D)));do S++,O=D/(M+S);while(Math.abs(O)>t);for(y=1;y<M;y++)R=C+y*O,N=e.invert([d[0]+Math.cos(R)*f,d[1]+Math.sin(R)*f]),F=l[(y+v)%l.length],B=a[F.id],I[F.id]=R,F=F.move(ct(B.loc,N,n)),s=s.replace(F);for(y=0;y<S;y++){R=C+(M+y)*O,N=e.invert([d[0]+Math.cos(R)*f,d[1]+Math.sin(R)*f]);var U=1/0;for(var H in I){var z=I[H],j=Math.abs(z-R);j<U&&(U=j,B=a[H])}F=Be({loc:ct(B.loc,N,n)}),s=s.replace(F),l.splice(E+y,0,F),T.push(F.id)}if(M===1&&T.length){var X=o.nodes.lastIndexOf(A.id),K=o.nodes.lastIndexOf(k.id),Y=K-X;Y<-1&&(Y=1);var oe=s.parentWays(c[g]);for(y=0;y<oe.length;y++){var re=oe[y];if(re!==o&&re.areAdjacent(A.id,k.id)){var W=re.nodes.lastIndexOf(A.id),Z=re.nodes.lastIndexOf(k.id),Q=Z-W,q=Z;for(Q<-1&&(Q=1),Y!==Q&&(T.reverse(),q=W),x=0;x<T.length;x++)re=re.addNode(T[x],q+x);s=s.replace(re)}}}}return m=l.map(function(pe){return pe.id}),m.push(m[0]),o=o.update({nodes:m}),s=s.replace(o),s};return r.makeConvex=function(s){var n=s.entity(i),o=Fe(s.childNodes(n)),a=o.map(function(y){return e.project(y.loc)}),l=Vl(a)>0?1:-1,c=Hs(a),u,h;for(l===-1&&(o.reverse(),a.reverse()),u=0;u<c.length-1;u++){var d=a.indexOf(c[u]),f=a.indexOf(c[u+1]),p=f-d;for(p<0&&(p+=o.length),h=1;h<p;h++){var m=ct(c[u],c[u+1],h/p),g=o[(h+d)%o.length].move(e.invert(m));s=s.replace(g)}}return s},r.disabled=function(s){if(!s.entity(i).isClosed())return"not_closed";var n=s.entity(i),o=Fe(s.childNodes(n)),a=o.map(function(_){return e.project(_.loc)}),l=Hs(a),c=Math.PI/180;if(l.length!==a.length||l.length<3)return!1;var u=Pr(a),h=t9(u,a[0]),d,f;for(d=0;d<l.length;d++){f=l[d];var p=t9(f,u),m=Math.abs(p-h);if(m>.05*h)return!1}for(d=0;d<l.length;d++){f=l[d];var g=l[(d+1)%l.length],y=Math.atan2(f[1]-u[1],f[0]-u[0]),x=Math.atan2(g[1]-u[1],g[0]-u[0]),b=x-y;if(b<0&&(b=-b),b>Math.PI&&(b=2*Math.PI-b),b>t+c)return!1}return"already_circular"},r.transitionable=!0,r}function vs(i){function e(r,s){if(s.parentWays(r).length||s.parentRelations(r).length)return!1;var n=Ro(r.tags);return n.point?!1:n.vertex?!0:!r.hasInterestingTags()}var t=function(r){var s=r.entity(i);return r.parentRelations(s).forEach(function(n){n=n.removeMembersWithID(i),r=r.replace(n),n.isDegenerate()&&(r=xi(n.id)(r))}),new Set(s.nodes).forEach(function(n){r=r.replace(s.removeNode(n));var o=r.entity(n);e(o,r)&&(r=r.remove(o))}),r.remove(s)};return t}function eo(i){var e={way:vs,node:yn,relation:xi},t=function(r){return i.forEach(function(s){r.hasEntity(s)&&(r=e[r.entity(s).type](s)(r))}),r};return t}function xi(i,e){function t(s,n){return!n.parentWays(s).length&&!n.parentRelations(s).length&&!s.hasInterestingTags()&&!e}var r=function(s){var n=s.entity(i);s.parentRelations(n).forEach(function(a){a=a.removeMembersWithID(i),s=s.replace(a),a.isDegenerate()&&(s=xi(a.id)(s))});var o=Fe(n.members.map(function(a){return a.id}));return o.forEach(function(a){s=s.replace(n.removeMembersWithID(a));var l=s.entity(a);t(l,s)&&(s=eo([a])(s))}),s.remove(n)};return r}function yn(i){var e=function(t){var r=t.entity(i);return t.parentWays(r).forEach(function(s){s=s.removeNode(i),t=t.replace(s),s.isDegenerate()&&(t=vs(s.id)(t))}),t.parentRelations(r).forEach(function(s){s=s.removeMembersWithID(i),t=t.replace(s),s.isDegenerate()&&(t=xi(s.id)(t))}),t.remove(r)};return e}function $a(i){var e=function(t){var r,s,n,o,a;for(o=0;o<i.length&&(r=t.entity(i[o]),!r.version);o++);for(o=0;o<i.length;o++)if(s=t.entity(i[o]),s.id!==r.id){for(n=t.parentWays(s),a=0;a<n.length;a++)t=t.replace(n[a].replaceNode(s.id,r.id));for(n=t.parentRelations(s),a=0;a<n.length;a++)t=t.replace(n[a].replaceMember(s,r));r=r.mergeTags(s.tags),t=yn(s.id)(t)}for(t=t.replace(r),n=t.parentWays(r),o=0;o<n.length;o++)n[o].isDegenerate()&&(t=vs(n[o].id)(t));return t};return e.disabled=function(t){var r={},s=[],n,o,a,l,c,u,h,d,f;for(h=0;h<i.length&&(n=t.entity(i[h]),!n.version);h++);for(h=0;h<i.length;h++)for(o=t.entity(i[h]),l=t.parentRelations(o),d=0;d<l.length;d++){if(c=l[d],u=c.memberById(o.id).role||"",c.hasFromViaTo()&&s.push(c.id),r[c.id]!==void 0&&r[c.id]!==u)return"relation";r[c.id]=u}for(h=0;h<i.length;h++){o=t.entity(i[h]);var p=t.parentWays(o);for(d=0;d<p.length;d++){var m=p[d];for(l=t.parentRelations(m),f=0;f<l.length;f++)c=l[f],c.hasFromViaTo()&&s.push(c.id)}}for(s=Fe(s),h=0;h<s.length;h++)if(c=t.entity(s[h]),!!c.isComplete(t)){var g=c.members.filter(function(R){return R.type==="way"}).map(function(R){return t.entity(R.id)});g=Fe(g);var y=c.memberByRole("from"),x=c.memberByRole("to"),b=y.id===x.id,_={from:[],via:[],to:[],keyfrom:[],keyto:[]};for(d=0;d<c.members.length;d++)O(c.members[d],_);_.keyfrom=Fe(_.keyfrom.filter(P)),_.keyto=Fe(_.keyto.filter(P));var w=D(_.keyfrom,_.keyto);_.from=_.from.filter(w),_.via=_.via.filter(w),_.to=_.to.filter(w);var A=!1,k=!1,v=!1,E=!1,S=!1;for(d=0;d<i.length;d++){var M=i[d];_.from.indexOf(M)!==-1&&(A=!0),_.via.indexOf(M)!==-1&&(k=!0),_.to.indexOf(M)!==-1&&(v=!0),_.keyfrom.indexOf(M)!==-1&&(E=!0),_.keyto.indexOf(M)!==-1&&(S=!0)}if(A&&v&&!b||A&&k||v&&k)return"restriction";if(E||S){if(i.length!==2)return"restriction";var I=null,T=null;for(d=0;d<g.length;d++)a=g[d],a.contains(i[0])&&(I=i[0]),a.contains(i[1])&&(T=i[1]);if(I&&T){var C=!1;for(d=0;d<g.length;d++)if(a=g[d],a.areAdjacent(I,T)){C=!0;break}if(!C)return"restriction"}}for(d=0;d<g.length;d++){for(a=g[d].update({}),f=0;f<i.length;f++)i[f]!==n.id&&(a.areAdjacent(i[f],n.id)?a=a.removeNode(i[f]):a=a.replaceNode(i[f],n.id));if(a.isDegenerate())return"restriction"}}return!1;function P(R,N,F){return F.indexOf(R)!==F.lastIndexOf(R)}function D(R,N){return function(F){return R.indexOf(F)===-1&&N.indexOf(F)===-1}}function O(R,N){var F=t.hasEntity(R.id);if(F){var B=R.role||"";N[B]||(N[B]=[]),R.type==="node"?(N[B].push(R.id),B==="via"&&(N.keyfrom.push(R.id),N.keyto.push(R.id))):R.type==="way"&&(N[B].push.apply(N[B],F.nodes),(B==="from"||B==="via")&&(N.keyfrom.push(F.first()),N.keyfrom.push(F.last())),(B==="to"||B==="via")&&(N.keyto.push(F.first()),N.keyto.push(F.last())))}}},e}function u1(i,e){var t={},r=function(s){i.forEach(function(o){e.entity(o).copy(e,t)});for(var n in t)s=s.replace(t[n]);return s};return r.copies=function(){return t},r}function Wo(i,e){return function(t){var r=t.entity(i).removeMember(e);return t=t.replace(r),r.isDegenerate()&&(t=xi(r.id)(t)),t}}function to(i,e){return e=e||{},t=>{return i.modified().forEach(r),i.created().forEach(r),t;function r(s){let n=Object.keys(s.tags),o=!1,a={};for(let l=0;l<n.length;l++){let c=n[l];e[c]||!s.tags[c]?o=!0:a[c]=s.tags[c]}o&&(t=t.replace(s.update({tags:a})))}}}function r2(i,e){var t,r=function(s){var n=s.entity(i),o=r.connections(s);return o.forEach(function(a){var l=s.entity(a.wayID),c=Be({id:e,loc:n.loc,tags:n.tags});s=s.replace(c),a.index===0&&l.isArea()?s=s.replace(l.replaceNode(l.nodes[0],c.id)):l.isClosed()&&a.index===l.nodes.length-1?s=s.replace(l.unclose().addNode(c.id)):s=s.replace(l.updateNode(c.id,a.index))}),s};return r.connections=function(s){for(var n=[],o=!1,a=s.parentWays(s.entity(i)),l,c,u=0;u<a.length;u++){if(l=a[u],t&&t.indexOf(l.id)===-1){o=!0;continue}if(l.isArea()&&l.nodes[0]===i)n.push({wayID:l.id,index:0});else for(var h=0;h<l.nodes.length;h++)if(c=l.nodes[h],c===i){if(l.isClosed()&&a.length>1&&t&&t.indexOf(l.id)!==-1&&h===l.nodes.length-1)continue;n.push({wayID:l.id,index:h})}}if(o)return n;if(i[1]!=="-"&&n.length>1&&n[0].wayID[1]==="-"){for(var d=1;d<n.length;d++)if(n[d].wayID[1]!=="-")return n.splice(d,1),n}return n.slice(1)},r.disabled=function(s){var n=r.connections(s);if(n.length===0)return"not_connected";var o=s.parentWays(s.entity(i)),a={},l;if(o.forEach(function(c){var u=s.parentRelations(c);u.forEach(function(h){h.id in a?t?(t.indexOf(c.id)!==-1||t.indexOf(a[h.id])!==-1)&&(l=h):l=h:a[h.id]=c.id})}),l)return"relation"},r.limitWays=function(s){return arguments.length?(t=s,r):t},r}function h1(i,e){let t,r=function(o){let a=o.entity(i);return a.type==="node"?s(a,o):n(a,o)};function s(o,a){t=o.id;let l=Be({loc:o.loc});a=a.replace(l);for(let c of a.parentWays(o))a=a.replace(c.replaceNode(i,l.id));for(let c of a.parentRelations(o))a=a.replace(c.replaceMember(o,l));return a}function n(o,a){let l=o.geometry(a),c=["source","wheelchair"],u=["area"],h=/architect|building|height|layer|nycdoitt:bin|roof/i,d=o.asGeoJSON(a),p=(d.type==="LineString"?d.coordinates:d.type==="Polygon"?d.coordinates[0]:d.type==="MultiPolygon"?d.coordinates[0][0]:[]).map(k=>e.project(k)),m;if(p.length)p.length===1?m=p[0]:p.length===2?m=ct(p[0],p[1],.5):m=Pr(p);else return a;let g=e.invert(m);(!g||!isFinite(g[0])||!isFinite(g[1]))&&(g=o.extent(a).center());let y={area:!0,corridor:!0,elevator:!0,level:!0,room:!0},x=o.tags.building&&o.tags.building!=="no"||o.tags["building:part"]&&o.tags["building:part"]!=="no",b=l==="area"&&o.tags.indoor&&y[o.tags.indoor],_=Object.assign({},o.tags),w={};for(let k in _)o.type==="relation"&&k==="type"||u.indexOf(k)===-1&&(b&&k==="indoor"||x&&h.test(k)||(w[k]=_[k],!(c.indexOf(k)!==-1||k.match(/^addr:.{1,}/))&&(b&&k==="level"||delete _[k])));!x&&!b&&l==="area"&&(_.area="yes");let A=Be({loc:g,tags:w});return a=a.replace(A),t=A.id,a.replace(o.update({tags:_}))}return r.getExtractedNodeID=function(){return t},r}function D5(i,e={}){function t(s){var n=i.map(function(o){return s.entity(o)});return Object.assign({line:[]},Ut(n,function(o){return o.geometry(s)}))}var r=function(s){var n=i.map(s.entity,s);n.sort(function(d,f){var p=d.isSided(),m=f.isSided();return p&&!m?-1:m&&!p?1:0});let o=(n.filter(d=>!d.isNew()).sort((d,f)=>+d.osmId()-+f.osmId())[0]||n[0]).id;var a=Rr(n,s),l=a[0];s=a.actions.reduce(function(d,f){return f(d)},s);var c=s.entity(o);if(c=c.update({nodes:l.nodes.map(function(d){return d.id})}),s=s.replace(c),l.forEach(function(d){d.id!==o&&(s.parentRelations(d).forEach(function(f){s=s.replace(f.replaceMember(d,c))}),c=c.mergeTags(d.tags),s=s.replace(c),s=vs(d.id)(s))}),e.tagnosticRoadCombine&&n.length&&n[0].tags.highway){var u=Object.assign({},c.tags);u.highway=n[0].tags.highway,c=c.update({tags:u}),s=s.replace(c)}function h(){if(c.isClosed()){var d=s.parentMultipolygons(c).filter(function(g){return g.members.length===1});if(d.length===1){var f=d[0];for(var p in c.tags)if(f.tags[p]&&f.tags[p]!==c.tags[p])return;c=c.mergeTags(f.tags),s=s.replace(c),s=xi(f.id,!0)(s);var m=Object.assign({},c.tags);c.geometry(s)!=="area"&&(m.area="yes"),delete m.type,c=c.update({tags:m}),s=s.replace(c)}}}return h(),s};return r.resultingWayNodesLength=function(s){return i.reduce(function(n,o){return n+s.entity(o).nodes.length},0)-i.length-1},r.disabled=function(s){var n=t(s);if(i.length<2||i.length!==n.line.length)return"not_eligible";var o=Rr(i.map(s.entity,s),s);if(o.length>1)return"not_adjacent";var a,l=function(_){return s.parentRelations(s.entity(_)).filter(w=>!w.isRestriction()&&!w.isConnectivity()).sort((w,A)=>w.id-A.id)},c=l(i[0]);for(a=1;a<i.length;a++){var u=l(i[a]);if(!ai(c,u))return"conflicting_relations"}for(a=0;a<i.length-1;a++)for(var h=a+1;h<i.length;h++){var d=s.childNodes(s.entity(i[a])).map(function(_){return _.loc}),f=s.childNodes(s.entity(i[h])).map(function(_){return _.loc}),p=k5(d,f),m=Vi(o[0].nodes.map(function(_){return _.loc.toString()}),p.map(function(_){return _.toString()}));if(m.length!==p.length)return"paths_intersect"}var g=o[0].nodes.map(function(_){return _.id}).slice(1,-1),y,x={},b=!1;if(o[0].forEach(function(_){var w=s.parentRelations(_);w.forEach(function(k){(k.isRestriction()||k.isConnectivity())&&k.members.some(function(v){return g.indexOf(v.id)>=0})&&(y=k)});for(var A in _.tags)A in x?x[A]&&lr(A)&&x[A]!==_.tags[A]&&(b=!0,A==="highway"&&e.tagnosticRoadCombine&&!window.mocha&&(b=!1)):x[A]=_.tags[A]}),y)return y.isRestriction()?"restriction":"connectivity";if(b)return"conflicting_tags"},r}function R5(i){function e(r){var s=i.map(function(n){return r.entity(n)});return Object.assign({point:[],area:[],line:[],relation:[]},Ut(s,function(n){return n.geometry(r)}))}var t=function(r){var s=e(r),n=s.area[0]||s.line[0],o=s.point;if(o.forEach(function(l){n=n.mergeTags(l.tags),r=r.replace(n),r.parentRelations(l).forEach(function(f){r=r.replace(f.replaceMember(l,n))});for(var c=Fe(r.childNodes(n)),u=l,h=0;h<c.length;h++){var d=c[h];if(!(r.parentWays(d).length>1||r.parentRelations(d).length||d.hasInterestingTags())){r=r.replace(l.update({tags:{},loc:d.loc})),n=n.replaceNode(d.id,l.id),r=r.replace(n),u=d;break}}r=r.remove(u)}),n.tags.area==="yes"){var a=Object.assign({},n.tags);delete a.area,Do(a)&&(n=n.update({tags:a}),r=r.replace(n))}return r};return t.disabled=function(r){var s=e(r);if(s.point.length===0||s.area.length+s.line.length!==1||s.relation.length!==0)return"not_eligible"},t}function Nr(i,e){function t(s){if(!i.length)return null;for(var n=[0,0],o=0,a,l=0;l<i.length;l++){var c=s.entity(i[l]);c.hasInterestingTags()&&(a=++o===1?c.loc:null),n=dt(n,c.loc)}return a||mr(n,1/i.length)}var r=function(s){if(i.length<2)return s;var n=e;n||(n=t(s));for(var o=0;o<i.length;o++){var a=s.entity(i[o]);a.loc!==n&&(s=s.replace(a.move(n)))}return $a(i)(s)};return r.disabled=function(s){if(i.length<2)return"not_eligible";for(var n=0;n<i.length;n++){var o=s.entity(i[n]);if(o.type!=="node")return"not_eligible"}return $a(i).disabled(s)},r}function vr(){if(this instanceof vr)arguments.length&&this.initialize(arguments);else return new vr().initialize(arguments)}de.changeset=vr;vr.prototype=Object.create(de.prototype);Object.assign(vr.prototype,{type:"changeset",extent:function(){return new new ie()},geometry:function(){return"changeset"},asJXON:function(){return{osm:{changeset:{tag:Object.keys(this.tags).map(function(i){return{"@k":i,"@v":this.tags[i]}},this),"@version":.6,"@generator":"Rapid"}}}},osmChangeJXON:function(i){var e=this.id;function t(n,o){for(var a={},l=0;l<n.length;l++){var c=Object.keys(n[l])[0];a[c]||(a[c]=[]),a[c].push(n[l][c])}var u={};return o.forEach(function(h){a[h]&&(u[h]=a[h])}),u}function r(n){function o(m){return u.find(function(g){return m.keyAttributes.type==="relation"&&m.keyAttributes.ref===g["@id"]})}function a(m){return!c[m["@id"]]&&!l.find(function(g){return g["@id"]===m["@id"]})}var l=[],c={},u=n.relation;if(!u)return n;for(var h=0;h<u.length;h++){var d=u[h];for(c[d["@id"]]||l.push(d);l.length>0;){var f=l[0],p=f.member.map(o).filter(Boolean).filter(a);p.length===0?(c[f["@id"]]=f,l.shift()):l=p.concat(l)}}return n.relation=Object.values(c),n}function s(n){return n.asJXON(e)}return{osmChange:{"@version":.6,"@generator":"Rapid",create:r(t(i.created.map(s),["node","way","relation"])),modify:t(i.modified.map(s),["node","way","relation"]),delete:Object.assign(t(i.deleted.map(s),["relation","way","node"]),{"@if-unused":!0})}}},asGeoJSON:function(){return{}}});function _t(){if(this instanceof _t)arguments.length&&this.initialize(arguments);else return new _t().initialize(arguments)}_t.id=function(){return _t.id.next--};_t.id.next=-1;Object.assign(_t.prototype,{type:"note",initialize:function(i){for(var e=0;e<i.length;++e){var t=i[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(t[r]===void 0?delete this[r]:this[r]=t[r])}return this.id||(this.id=_t.id().toString()),this},extent:function(){return new ie(this.loc)},update:function(i){return _t(this,i)},isNew:function(){return this.id<0},move:function(i){return this.update({loc:i})}});function Qt(){if(this instanceof Qt)arguments.length&&this.initialize(arguments);else return new Qt().initialize(arguments)}de.relation=Qt;Qt.prototype=Object.create(de.prototype);Qt.creationOrder=function(i,e){var t=parseInt(de.id.toOSM(i.id),10),r=parseInt(de.id.toOSM(e.id),10);return t<0||r<0?t-r:r-t};Object.assign(Qt.prototype,{type:"relation",members:[],copy:function(i,e){if(e[this.id])return e[this.id];var t=de.prototype.copy.call(this,i,e),r=this.members.map(function(s){return Object.assign({},s,{id:i.entity(s.id).copy(i,e).id})});return t=t.update({members:r}),e[this.id]=t,t},extent:function(i,e){return i.transient(this,"extent",function(){if(e&&e[this.id])return new ie;e=e||{},e[this.id]=!0;for(var t=new ie,r=0;r<this.members.length;r++){var s=i.hasEntity(this.members[r].id);s&&(t=t.extend(s.extent(i,e)))}return t})},geometry:function(i){return i.transient(this,"geometry",function(){return this.isMultipolygon()?"area":"relation"})},isDegenerate:function(){return this.members.length===0},indexedMembers:function(){for(var i=new Array(this.members.length),e=0;e<this.members.length;e++)i[e]=Object.assign({},this.members[e],{index:e});return i},memberByRole:function(i){for(var e=0;e<this.members.length;e++)if(this.members[e].role===i)return Object.assign({},this.members[e],{index:e})},membersByRole:function(i){for(var e=[],t=0;t<this.members.length;t++)this.members[t].role===i&&e.push(Object.assign({},this.members[t],{index:t}));return e},memberById:function(i){for(var e=0;e<this.members.length;e++)if(this.members[e].id===i)return Object.assign({},this.members[e],{index:e})},memberByIdAndRole:function(i,e){for(var t=0;t<this.members.length;t++)if(this.members[t].id===i&&this.members[t].role===e)return Object.assign({},this.members[t],{index:t})},addMember:function(i,e){var t=this.members.slice();return t.splice(e===void 0?t.length:e,0,i),this.update({members:t})},updateMember:function(i,e){var t=this.members.slice();return t.splice(e,1,Object.assign({},t[e],i)),this.update({members:t})},removeMember:function(i){var e=this.members.slice();return e.splice(i,1),this.update({members:e})},removeMembersWithID:function(i){var e=this.members.filter(function(t){return t.id!==i});return this.update({members:e})},moveMember:function(i,e){var t=this.members.slice();return t.splice(e,0,t.splice(i,1)[0]),this.update({members:t})},replaceMember:function(i,e,t){if(!this.memberById(i.id))return this;for(var r=[],s=0;s<this.members.length;s++){var n=this.members[s];n.id!==i.id?r.push(n):(t||!this.memberByIdAndRole(e.id,n.role))&&r.push({id:e.id,type:e.type,role:n.role})}return this.update({members:r})},asJXON:function(i){var e={relation:{"@id":this.osmId(),"@version":this.version||0,member:this.members.map(function(t){return{keyAttributes:{type:t.type,role:t.role,ref:de.id.toOSM(t.id)}}},this),tag:Object.keys(this.tags).map(function(t){return{keyAttributes:{k:t,v:this.tags[t]}}},this)}};return i&&(e.relation["@changeset"]=i),e},asGeoJSON:function(i){return i.transient(this,"GeoJSON",function(){return this.isMultipolygon()?{type:"MultiPolygon",coordinates:this.multipolygon(i)}:{type:"FeatureCollection",properties:this.tags,features:this.members.map(function(e){return Object.assign({role:e.role},i.entity(e.id).asGeoJSON(i))})}})},area:function(i){return i.transient(this,"area",function(){return hn(this.asGeoJSON(i))})},isMultipolygon:function(){return this.tags.type==="multipolygon"},isComplete:function(i){for(var e=0;e<this.members.length;e++)if(!i.hasEntity(this.members[e].id))return!1;return!0},hasFromViaTo:function(){return this.members.some(function(i){return i.role==="from"})&&this.members.some(function(i){return i.role==="via"})&&this.members.some(function(i){return i.role==="to"})},isRestriction:function(){return!!(this.tags.type&&this.tags.type.match(/^restriction:?/))},isValidRestriction:function(){if(!this.isRestriction())return!1;var i=this.members.filter(function(r){return r.role==="from"}),e=this.members.filter(function(r){return r.role==="via"}),t=this.members.filter(function(r){return r.role==="to"});return!(i.length!==1&&this.tags.restriction!=="no_entry"||i.some(function(r){return r.type!=="way"})||t.length!==1&&this.tags.restriction!=="no_exit"||t.some(function(r){return r.type!=="way"})||e.length===0||e.length>1&&e.some(function(r){return r.type!=="way"}))},isConnectivity:function(){return!!(this.tags.type&&this.tags.type.match(/^connectivity:?/))},multipolygon:function(i){var e=this.members.filter(function(c){return(c.role||"outer")==="outer"}),t=this.members.filter(function(c){return c.role==="inner"});e=Rr(e,i),t=Rr(t,i);var r=function(c){return c.nodes.length>2&&c.nodes[0]!==c.nodes[c.nodes.length-1]&&c.nodes.push(c.nodes[0]),c.nodes.map(function(u){return u.loc})};e=e.map(r),t=t.map(r);var s=e.map(function(c){return[hn({type:"Polygon",coordinates:[c]})>2*Math.PI?c.reverse():c]});function n(c){var u,h;for(u=0;u<e.length;u++)if(h=e[u],i1(h,c))return u;for(u=0;u<e.length;u++)if(h=e[u],t_(h,c,!1))return u}for(var o=0;o<t.length;o++){var a=t[o];hn({type:"Polygon",coordinates:[a]})<2*Math.PI&&(a=a.reverse());var l=n(t[o]);l!==void 0?s[l].push(t[o]):s.push([t[o]])}return s}});var ut=class i{constructor(e,t,r,s,n){this.loc=e,this.service=t.id,this.itemType=r,this.id=s||`${i.id()}`,this.update(n),t&&typeof t.getIcon=="function"&&(this.icon=t.getIcon(r))}update(e){let{loc:t,service:r,itemType:s,id:n}=this;return Object.keys(e).forEach(o=>this[o]=e[o]),this.loc=t,this.service=r,this.itemType=s,this.id=n,this}static id(){return this.nextId--}};ut.nextId=-1;function io(i,e){typeof i=="string"&&(i=[i]);var t,r="longest",s=[];function n(u,h,d){var f=u.entity(h).loc,p=u.entity(d).loc,m=1e-6;return f&&p?at(f,p):m}function o(u,h,d){var f=new Array(u.length),p,m,g=0,y;function x(_){return n1(_,u.length)}for(p=0,m=x(h+1);m!==h;m=x(m+1))p+=n(d,u[m],u[x(m-1)]),f[m]=p;for(p=0,m=x(h-1);m!==h;m=x(m-1))p+=n(d,u[m],u[x(m+1)]),p<f[m]&&(f[m]=p);for(m=0;m<u.length;m++){var b=f[m]/n(d,u[h],u[m]);b>g&&(y=m,g=b)}return y}function a(u,h){for(var d=0,f=0;f<h.length-1;f++)d+=n(u,h[f],h[f+1]);return d}function l(u,h,d,f){var p=pt({id:f,tags:d.tags}),m=d.nodes.slice(),g,y,x=d.isArea(),b=c1(d,u);if(d.isClosed()){var _=d.nodes.slice(0,-1),w=_.indexOf(h),A=o(_,w,u);A<w?(g=_.slice(w).concat(_.slice(0,A+1)),y=_.slice(A,w+1)):(g=_.slice(w,A+1),y=_.slice(A).concat(_.slice(0,w+1)))}else{var k=d.nodes.indexOf(h,1);g=d.nodes.slice(0,k+1),y=d.nodes.slice(k)}var v=a(u,g),E=a(u,y);if(r==="longest"&&E>v){d=d.update({nodes:y}),p=p.update({nodes:g});var S=v;v=E,E=S}else d=d.update({nodes:g}),p=p.update({nodes:y});if(d.tags.step_count){var M=parseFloat(d.tags.step_count);if(M&&isFinite(M)&&M>0&&Math.round(M)===M){var I=Object.assign({},d.tags),T=Object.assign({},p.tags),C=v/(v+E),P=Math.round(M*C);I.step_count=P.toString(),T.step_count=(M-P).toString(),d=d.update({tags:I}),p=p.update({tags:T})}}if(u=u.replace(d),u=u.replace(p),u.parentRelations(d).forEach(function(O){var R;if(O.hasFromViaTo()){var N=O.memberByRole("from"),F=O.membersByRole("via"),B=O.memberByRole("to"),$;if(N.id===d.id||B.id===d.id){var U=!1;if(F.length===1&&F[0].type==="node")U=p.contains(F[0].id);else for($=0;$<F.length;$++)if(F[$].type==="way"){var H=u.hasEntity(F[$].id);if(H&&Vi(p.nodes,H.nodes).length){U=!0;break}}U&&(O=O.replaceMember(d,p),u=u.replace(O))}else for($=0;$<F.length;$++)if(F[$].type==="way"&&F[$].id===d.id){R={id:p.id,type:"way",role:"via"},u=Ua(O.id,R,F[$].index+1)(u);break}}else{O===b&&(u=u.replace(O.mergeTags(d.tags)),u=u.replace(d.update({tags:{}})),u=u.replace(p.update({tags:{}}))),R={id:p.id,type:"way",role:O.memberById(d.id).role};var z={originalID:d.id,insertedID:p.id,nodes:m};u=Ua(O.id,R,void 0,z)(u)}}),!b&&x){var D=Qt({tags:Object.assign({},d.tags,{type:"multipolygon"}),members:[{id:d.id,role:"outer",type:"way"},{id:p.id,role:"outer",type:"way"}]});u=u.replace(D),u=u.replace(d.update({tags:{}})),u=u.replace(p.update({tags:{}}))}return s.push(p.id),u}var c=function(u){s=[];for(var h=0,d=0;d<i.length;d++)for(var f=i[d],p=c.waysForNode(f,u),m=0;m<p.length;m++)u=l(u,f,p[m],e&&e[h]),h+=1;return u};return c.getCreatedWayIDs=function(){return s},c.waysForNode=function(u,h){var d=h.entity(u),f=h.parentWays(d).filter(m);if(!t){var p=f.some(function(g){return g.geometry(h)==="line"});if(p)return f.filter(function(g){return g.geometry(h)==="line"})}return f;function m(g){if(t&&t.indexOf(g.id)===-1)return!1;if(g.isClosed())return!0;for(var y=1;y<g.nodes.length-1;y++)if(g.nodes[y]===u)return!0;return!1}},c.ways=function(u){return Fe([].concat.apply([],i.map(function(h){return c.waysForNode(h,u)})))},c.disabled=function(u){for(var h=0;h<i.length;h++){var d=i[h],f=c.waysForNode(d,u);if(f.length===0||t&&t.length!==f.length)return"not_eligible"}},c.limitWays=function(u){return arguments.length?(t=u,c):t},c.keepHistoryOn=function(u){return arguments.length?(r=u,c):r},c}var MD=50,xn=class i{constructor(e,t){this.context=e,this.array=t,this._memo=new Map}item(e){let t=this._memo.get(e);return t||(t=this.array.find(r=>r.id===e),t&&this._memo.set(e,t),t)}index(e){return this.array.findIndex(t=>t.id===e)}matchGeometry(e){let t=this.array.filter(r=>r.matchGeometry(e));return new i(this.context,t)}matchAllGeometry(e){let t=this.array.filter(r=>r&&r.matchAllGeometry(e));return new i(this.context,t)}fallback(e){let t=e;return t==="vertex"&&(t="point"),this.item(t)}search(e,t,r){if(!e)return this;e=e.toLowerCase().trim();function s(w){let A=w.indexOf(e);return A===0||w[A-1]===" "}function n(w){return w.indexOf(e)===0}function o(w){return function(k,v){let E=k[w](),S=v[w]();if(e===E)return-1;if(e===S)return 1;let M=v.orig.matchScore-k.orig.matchScore;return M!==0||(M=E.indexOf(e)-S.indexOf(e),M!==0)?M:E.length-S.length}}let a=this.array.filter(w=>w.matchGeometry(t));if(Array.isArray(r)){let A=this.context.systems.locations.locationSetsAt(r);a=a.filter(k=>!k.locationSetID||A[k.locationSetID])}let l=a.filter(w=>w.searchable!==!1&&w.suggestion!==!0),c=a.filter(w=>w.suggestion===!0),u=l.filter(w=>s(w.searchName())).sort(o("searchName")),h=c.filter(w=>n(w.searchName())).sort(o("searchName")),d=l.filter(w=>s(w.searchNameStripped())).sort(o("searchNameStripped")),f=c.filter(w=>n(w.searchNameStripped())).sort(o("searchNameStripped")),p=l.filter(w=>(w.terms()||[]).some(s)),m=c.filter(w=>(w.terms()||[]).some(s)),g=l.filter(w=>Object.values(w.tags||{}).filter(A=>A!=="*").some(s)),y=l.map(w=>({preset:w,dist:E3(e,w.searchName())})).filter(w=>w.dist+Math.min(e.length-w.preset.searchName().length,0)<3).sort((w,A)=>w.dist-A.dist).map(w=>w.preset),x=c.map(w=>({preset:w,dist:E3(e,w.searchName())})).filter(w=>w.dist+Math.min(e.length-w.preset.searchName().length,0)<1).sort((w,A)=>w.dist-A.dist).map(w=>w.preset),b=l.filter(w=>(w.terms()||[]).some(A=>E3(e,A)+Math.min(e.length-A.length,0)<3)),_=u.concat(h,d,f,p,m,g,y,x,b).slice(0,MD-1);if(typeof t=="string"){let w=this.fallback(t);w&&_.push(w)}return new i(this.context,Fe(_))}};var d1=class{constructor(e,t,r,s={}){var o,a;this.context=e,this.id=t,this.safeid=Ta(t),this.allPresets=s,this.orig={},this.orig.name=(o=r.name)!=null?o:"",this.orig.icon=r.icon,this.orig.matchScore=-1,this.orig.members=(a=r.members)!=null?a:[],Object.assign(this,li(this.orig,["name","matchScore","members"]));let n=this.orig.members.map(l=>s[l]).filter(Boolean);this.members=new xn(e,n),this.geometry=n.reduce((l,c)=>{for(let u in c.geometry){let h=c.geometry[u];l.indexOf(h)===-1&&l.push(h)}return l},[]),this._searchName=null,this._searchNameStripped=null}matchGeometry(e){return this.geometry.includes(e)}matchAllGeometry(e){return this.members.array.some(t=>t.matchAllGeometry(e))}matchScore(){return-1}name(){return this.context.systems.l10n.t(`_tagging.presets.categories.${this.id}.name`,{default:this.id})}nameLabel(){return this.context.systems.l10n.tHtml(`_tagging.presets.categories.${this.id}.name`,{default:this.id})}terms(){return[]}searchName(){return this._searchName||(this._searchName=this.name().toLowerCase()),this._searchName}searchNameStripped(){return this._searchNameStripped||(this._searchNameStripped=this._stripDiacritics(this.searchName())),this._searchNameStripped}searchAliases(){return[]}searchAliasesStripped(){return[]}isFallback(){return!1}_stripDiacritics(e){return e.normalize&&(e=e.normalize("NFD")),e=e.replace(/[\u0300-\u036f]/g,""),e}};var s2=et(f1(),1);var er=class{constructor(e,t){if(this._base=e,this._head=t,this._changes=new Map,this.didChange={},e===t)return;let r=new Set([...t.local.entities.keys(),...e.local.entities.keys()]);for(let s of r){let n=t.hasEntity(s),o=e.hasEntity(s);if(n!==o){if(o&&!n){this._changes.set(s,{base:o,head:n}),this.didChange.deletion=!0;continue}if(!o&&n){this._changes.set(s,{base:o,head:n}),this.didChange.addition=!0;continue}if(n&&o){if(n.members&&o.members&&!(0,s2.default)(n.members,o.members)){this._changes.set(s,{base:o,head:n}),this.didChange.geometry=!0,this.didChange.properties=!0;continue}n.loc&&o.loc&&!We(n.loc,o.loc)&&(this._changes.set(s,{base:o,head:n}),this.didChange.geometry=!0),n.nodes&&o.nodes&&!(0,s2.default)(n.nodes,o.nodes)&&(this._changes.set(s,{base:o,head:n}),this.didChange.geometry=!0),n.tags&&o.tags&&!(0,s2.default)(n.tags,o.tags)&&(this._changes.set(s,{base:o,head:n}),this.didChange.properties=!0)}}}}get changes(){return this._changes}modified(){let e=[];for(let t of this._changes.values())t.base&&t.head&&e.push(t.head);return e}created(){let e=[];for(let t of this._changes.values())!t.base&&t.head&&e.push(t.head);return e}deleted(){let e=[];for(let t of this._changes.values())t.base&&!t.head&&e.push(t.base);return e}summary(){let e=this._base,t=this._head,r=new Map;for(let n of this._changes.values()){let o=n.head,a=n.base;if(o&&o.geometry(t)!=="vertex")s(o,t,a?"modified":"created");else if(a&&a.geometry(e)!=="vertex")s(a,e,"deleted");else if(a&&o){let l=!We(a.loc,o.loc),c=!(0,s2.default)(a.tags,o.tags);if(l)for(let u of t.parentWays(o))r.has(u.id)||s(u,t,"modified");(c||l&&o.hasInterestingTags())&&s(o,t,"modified")}else o&&o.hasInterestingTags()?s(o,t,"created"):a&&a.hasInterestingTags()&&s(a,e,"deleted")}return r;function s(n,o,a){r.set(n.id,{entity:n,graph:o,changeType:a})}}complete(){let e=this._head,t=new Map;for(let[s,n]of this._changes){let o=n.head,a=n.base,l=o||a;if(t.set(s,o),l.type==="way"){let c=o?o.nodes:[],u=a?a.nodes:[];for(let h of Gt(c,u))t.set(h,e.hasEntity(h))}if(l.type==="relation"&&l.isMultipolygon()){let c=o?o.members.map(h=>h.id):[],u=a?a.members.map(h=>h.id):[];for(let h of Gt(c,u)){let d=e.hasEntity(h);d&&t.set(h,d)}}r(e.parentWays(l),t),r(e.parentRelations(l),t)}return t;function r(s){for(let n of s)t.has(n.id)||(t.set(n.id,n),r(e.parentRelations(n)))}}};var ro=class{constructor(e){this.annotation=e.annotation,this.graph=e.graph,this.selectedIDs=e.selectedIDs,this.sources=e.sources||{},this.transform=e.transform}};var _s=class{constructor(e,t){this.context=e,this._id=t.id,this._idtx=t.id.replace(/\./g,"<TX_DOT>"),this._name=t.name,this._description=t.description,this._template=t.encrypted?Ay(t.template):t.template,this.best=!!t.best,this.endDate=t.endDate,this.icon=t.icon,this.overlay=t.overlay,this.polygon=t.polygon,this.projection=t.projection,this.startDate=t.startDate,this.terms_html=t.terms_html,this.terms_text=t.terms_text,this.terms_url=t.terms_url,this.tileSize=t.tileSize||256,this.type=t.type,this.zoomExtent=t.zoomExtent||[0,22],this.isBlocked=!1,this.offset=[0,0]}get id(){return this._id}get idtx(){return this._idtx}get name(){return this.context.systems.l10n.t(`imagery.${this._idtx}.name`,{default:this._name})}get description(){return this.context.systems.l10n.t(`imagery.${this._idtx}.description`,{default:this._description})}get imageryUsed(){return this._name||this._id}get template(){return this._template}get area(){if(!this.polygon)return Number.MAX_VALUE;let e=hn({type:"MultiPolygon",coordinates:[this.polygon]});return isNaN(e)?0:e}validZoom(e){if(Number.isNaN(e))return!1;let[t,r]=this.zoomExtent;return e>=t&&e<=r}isLocatorOverlay(){return this._id==="mapbox_locator_overlay"}copyrightNotices(){}getMetadata(e,t,r){let s={start:this._localeDateString(this.startDate),end:this._localeDateString(this.endDate)};s.range=this._vintageRange(s),r(null,{vintage:s})}nudge(e,t){return this.offset[0]+=e[0]/Math.pow(2,t),this.offset[1]+=e[1]/Math.pow(2,t),this}url(e){let t=this._template;if(t==="")return t;function r(s,n,o,a){let l=Math.pow(2,a),c=n/l*Math.PI*2-Math.PI,u=Math.atan(Math.sinh(Math.PI*(1-2*o/l))),h;switch(s){case"EPSG:4326":return{x:c*180/Math.PI,y:u*180/Math.PI};default:return h=jl(c,u),{x:2003750834e-2/Math.PI*h[0],y:2003750834e-2/Math.PI*h[1]}}}if(this.type||(/SERVICE=WMS|\{(proj|wkid|bbox)\}/.test(this._template)?(this.type="wms",this.projection="EPSG:3857"):/\{(x|y)\}/.test(this._template)?this.type="tms":/\{u\}/.test(this._template)&&(this.type="bing")),this.type==="wms"){let s=this.tileSize,n=this.projection,o=r(n,e[0],e[1],e[2]),a=r(n,e[0]+1,e[1]+1,e[2]);t=t.replace(/\{(\w+)\}/g,(l,c)=>{switch(c){case"width":case"height":return s;case"proj":return n;case"wkid":return n.replace(/^EPSG:/,"");case"bbox":return n==="EPSG:4326"&&/VERSION=1.3|CRS={proj}/.test(this._template.toUpperCase())?a.y+","+o.x+","+o.y+","+a.x:o.x+","+a.y+","+a.x+","+o.y;case"w":return o.x;case"s":return a.y;case"n":return a.x;case"e":return o.y;default:return l}})}else if(this.type==="tms"){let s=window.devicePixelRatio&&window.devicePixelRatio>=2;t=t.replace("{x}",e[0]).replace("{y}",e[1]).replace(/\{[t-]y\}/,Math.pow(2,e[2])-e[1]-1).replace(/\{z(oom)?\}/,e[2]).replace(/\{@2x\}|\{r\}/,s?"@2x":"")}else this.type==="bing"&&(t=t.replace("{u}",()=>{let s="";for(let n=e[2];n>0;n--){let o=0,a=1<<n-1;e[0]&a&&o++,e[1]&a&&(o+=2),s+=o.toString()}return s}));return t=t.replace(/\{switch:([^}]+)\}/,(s,n)=>{let o=n.split(",");return o[(e[0]+e[1])%o.length]}),t}_localeDateString(e){if(!e)return null;let t={day:"numeric",month:"short",year:"numeric"},r=new Date(e);if(isNaN(r.getTime()))return null;let s=this.context.systems.l10n.localeCode();return r.toLocaleDateString(s,t)}_vintageRange(e){let t;return(e.start||e.end)&&(t=e.start||"?",e.start!==e.end&&(t+=" - "+(e.end||"?"))),t}},p1=class extends _s{constructor(e){super(e,{id:"none",template:""})}get name(){return this.context.systems.l10n.t("background.none")}get area(){return-1}get imageryUsed(){return null}},m1=class extends _s{constructor(e,t=""){super(e,{id:"custom",template:t})}get name(){return this.context.systems.l10n.t("background.custom")}get area(){return-2}get imageryUsed(){let e=this._template,[t,r]=e.split("?",2);if(r){let s=Vn(r);for(let n of Object.keys(s))/^(access_token|connectid|key|signature|token)$/i.test(n)&&(s[n]="{apikey}");e=t+"?"+tt(s,!0)}return e=e.replace(/token\/(\w+)/,"token/{apikey}").replace(/key=(\w+)/,"key={apikey}"),`Custom (${e} )`}set template(e){this._template=e}get template(){return this._template}},g1=class extends _s{constructor(e,t){super(e,t),this._template="https://ecn.t{switch:0,1,2,3}.tiles.virtualearth.net/tiles/a{u}.jpeg?g=1&pr=odbl&n=z",this.terms_url="https://blog.openstreetmap.org/2010/11/30/microsoft-imagery-details"}},y1=class extends _s{constructor(e,t){super(e,t),/blankTile/.test(this._template)||(this._template+="?blankTile=false"),this._cache={},this._inflight={},this._prevCenter=null}fetchTilemap(e){if(this._prevCenter&&at(e,this._prevCenter)<5e3)return;this._prevCenter=e;let t=this.url([1,2,3]),r=20,s=Math.floor((e[0]+180)/360*Math.pow(2,r)),n=Math.floor((1-Math.log(Math.tan(e[1]*Math.PI/180)+1/Math.cos(e[1]*Math.PI/180))/Math.PI)/2*Math.pow(2,r)),o=t.replace(/tile\/[0-9]+\/[0-9]+\/[0-9]+\?blankTile=false/,"tilemap")+"/"+r+"/"+n+"/"+s+"/8/8";fetch(o).then(Me).then(a=>{if(!a)throw new Error("Unknown Error");let l=!0;for(let c=0;c<a.data.length;c++)if(!a.data[c]){l=!1;break}this.zoomExtent[1]=l?22:19}).catch(a=>console.error(a))}getMetadata(e,t,r){let s=t.slice(0,3).join("/"),n=Math.min(t[2],this.zoomExtent[1]),o=e[0]+","+e[1],a=this.context.systems.l10n.t("info_panels.background.unknown");if(this._inflight[s])return;let l;switch(!0){case(n>=20&&this._id==="EsriWorldImageryClarity"):l=4;break;case n>=19:l=3;break;case n>=17:l=2;break;case n>=13:l=0;break;default:l=99}let c;if(this._id==="EsriWorldImagery")c="https://services.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/";else if(this._id==="EsriWorldImageryClarity")c="https://serviceslab.arcgisonline.com/arcgis/rest/services/Clarity_World_Imagery/MapServer/";else return;if(c+=l+"/query?returnGeometry=false&geometry="+o+"&inSR=4326&geometryType=esriGeometryPoint&outFields=*&f=json",this._cache[s]||(this._cache[s]={}),this._cache[s]&&this._cache[s].metadata)return r(null,this._cache[s].metadata);let u={},h={};l===99?(u={start:null,end:null,range:null},h={vintage:null,source:a,description:a,resolution:a,accuracy:a},r(null,h)):(this._inflight[s]=!0,fetch(c).then(Me).then(f=>{if(delete this._inflight[s],f){if(f.features&&f.features.length<1)throw new Error("No Results");if(f.error&&f.error.message)throw new Error(f.error.message)}else throw new Error("Unknown Error");let p=this._localeDateString(f.features[0].attributes.SRC_DATE2);u={start:p,end:p,range:p},h={vintage:u,source:d(f.features[0].attributes.NICE_NAME),description:d(f.features[0].attributes.NICE_DESC),resolution:d(+parseFloat(f.features[0].attributes.SRC_RES).toFixed(4)),accuracy:d(+parseFloat(f.features[0].attributes.SRC_ACC).toFixed(4))},isFinite(h.resolution)&&(h.resolution+=" m"),isFinite(h.accuracy)&&(h.accuracy+=" m"),this._cache[s].metadata=h,r&&r(null,h)}).catch(f=>{delete this._inflight[s],r&&r(f.message)}));function d(f){return String(f).trim()||a}}};var x1=class{constructor(e,t,r,s={}){var n,o,a,l,c,u,h,d,f,p;this.context=e,this.id=t,this.safeid=Ta(t),this.allFields=s,this.orig={},this.orig.autoSuggestions=(n=r.autoSuggestions)!=null?n:!0,this.orig.caseSensitive=(o=r.caseSensitive)!=null?o:!1,this.orig.customValues=(a=r.customValues)!=null?a:!0,this.orig.default=r.default,this.orig.geometry=r.geometry,this.orig.icon=r.icon,this.orig.increment=(l=r.increment)!=null?l:1,this.orig.key=r.key,this.orig.keys=(c=r.keys)!=null?c:[r.key],this.orig.label=(u=r.label)!=null?u:"",this.orig.locationSet=r.locationSet,this.orig.maxValue=r.maxValue,this.orig.minValue=r.minValue,this.orig.options=r.options,this.orig.pattern=r.pattern,this.orig.placeholder=(h=r.placeholder)!=null?h:"",this.orig.prerequisiteTag=r.prerequisiteTag,this.orig.reference=r.reference,this.orig.snake_case=(d=r.snake_case)!=null?d:!0,this.orig.strings=r.strings,this.orig.terms=((f=r.terms)!=null?f:[]).join(),this.orig.type=r.type,this.orig.universal=(p=r.universal)!=null?p:!1,this.orig.urlFormat=r.urlFormat,this.orig.usage=r.usage,Object.assign(this,li(this.orig,["increment","label","placeholder","terms"])),this.title=this.title.bind(this),this.label=this.label.bind(this),this.placeholder=this.placeholder.bind(this),this.terms=this.terms.bind(this)}increment(){return this.type==="number"?this.orig.increment:void 0}title(){return this._resolveReference("label").t("label",{default:this.orig.label||this.id})}label(){return this._resolveReference("label").tHtml("label",{default:this.orig.label||this.id})}placeholder(){return this._resolveReference("placeholder").t("placeholder",{default:this.orig.placeholder})}terms(){return this._resolveReference("terms").t("terms",{default:this.orig.terms}).toLowerCase().trim().split(/\s*,+\s*/)}matchGeometry(e){return!this.geometry||this.geometry.indexOf(e)!==-1}matchAllGeometry(e){return!this.geometry||e.every(t=>this.geometry.indexOf(t)!==-1)}t(e,t){return this.context.systems.l10n.t(`_tagging.presets.fields.${this.id}.${e}`,t)}tHtml(e,t){return this.context.systems.l10n.tHtml(`_tagging.presets.fields.${this.id}.${e}`,t)}tAppend(e,t){return this.context.systems.l10n.tAppend(`_tagging.presets.fields.${this.id}.${e}`,t)}hasTextForStringID(e){return this.context.systems.l10n.hasTextForStringID(`_tagging.presets.fields.${this.id}.${e}`)}_resolveReference(e){let r=(this.orig[e]||"").match(/^\{(.*)\}$/);if(r){let s=this.allFields[r[1]];if(s)return s;console.error(`Unable to resolve referenced field: ${r[1]}`)}return this}};var di=class i{constructor(e,t){e instanceof i?(this._base=e._base,this._local={entities:new Map(e._local.entities),parentWays:new Map(e._local.parentWays),parentRels:new Map(e._local.parentRels)}):(this._base={entities:new Map,parentWays:new Map,parentRels:new Map},this._local={entities:new Map,parentWays:new Map,parentRels:new Map},this.rebase(e||[],[this])),this._transients=new Map,this._childNodes=new Map,this._frozen=!t}get base(){return this._base}get local(){return this._local}get frozen(){return this._frozen}hasEntity(e){let t=this._base.entities,r=this._local.entities;return r.has(e)?r.get(e):t.get(e)}entity(e){let t=this.hasEntity(e);if(!t)throw new Error(`Entity ${e} not found`);return t}geometry(e){return this.entity(e).geometry(this)}transient(e,t,r){let s=e.id,n=this._transients.get(s);n||(n=new Map,this._transients.set(s,n));let o=n.get(t);return o!==void 0||(o=r.call(e),n.set(t,o)),o}isPoi(e){var n,o;if(e.type!=="node")return!1;let t=this._base.parentWays;return((o=(n=this._local.parentWays.get(e.id))!=null?n:t.get(e.id))!=null?o:new Set).size===0}isShared(e){var l,c;if(e.type!=="node")return!1;let t=this._base.parentWays,s=(c=(l=this._local.parentWays.get(e.id))!=null?l:t.get(e.id))!=null?c:new Set;if(s.size===0)return!1;if(s.size>1)return!0;let n=[...s][0],o=this.entity(n),a=o.isClosed()?o.nodes.length-1:o.nodes.length;for(let u=0,h=0;u<a;u++)if(e.id===o.nodes[u]&&h++,h>1)return!0;return!1}parentWays(e){var n,o;let t=this._base.parentWays,s=(o=(n=this._local.parentWays.get(e.id))!=null?n:t.get(e.id))!=null?o:new Set;return Array.from(s).map(a=>this.entity(a))}parentRelations(e){var n,o;let t=this._base.parentRels,s=(o=(n=this._local.parentRels.get(e.id))!=null?n:t.get(e.id))!=null?o:new Set;return Array.from(s).map(a=>this.entity(a))}parentMultipolygons(e){return this.parentRelations(e).filter(t=>t.isMultipolygon())}childNodes(e){if(!e.nodes)return[];let t=this._childNodes.get(e.id);if(t)return t;t=new Array(e.nodes.length);for(let r=0;r<e.nodes.length;++r)t[r]=this.entity(e.nodes[r]);return this._childNodes.set(e.id,t),t}rebase(e,t,r){let s=this._base,n=t[t.length-1]._local.entities,o=new Set;for(let a of e)if(!(!a.visible||!r&&s.entities.has(a.id))&&(s.entities.set(a.id,a),this._updateCalculated(void 0,a,s.parentWays,s.parentRels),a.type==="way"))for(let l of a.nodes)n.has(l)&&n.get(l)===void 0&&o.add(l);for(let a of t){let l=a._local.entities;for(let c of o)l.has(c)&&l.get(c)===void 0&&l.delete(c);a._updateRebased()}}_updateRebased(){let e=this._base,t=this._local;for(let[r,s]of t.parentWays){let n=e.parentWays.get(r);if(n)for(let o of n)t.entities.has(o)||s.add(o)}for(let[r,s]of t.parentRels){let n=e.parentRels.get(r);if(n)for(let o of n)t.entities.has(o)||s.add(o)}this._transients=new Map}_updateCalculated(e,t,r,s){var u,h,d,f,p,m,g,y;let n=this._base,o=this._local;r=r||o.parentWays,s=s||o.parentRels;let a=t!=null?t:e;if(!a)return;let l,c;if(a.type==="way"){e&&t?(l=Di(e.nodes,t.nodes),c=Di(t.nodes,e.nodes)):e?(l=e.nodes,c=[]):t&&(l=[],c=t.nodes);for(let x of l){let b=new Set((h=(u=o.parentWays.get(x))!=null?u:n.parentWays.get(x))!=null?h:[]);b.delete(a.id),r.set(x,b)}for(let x of c){let b=new Set((f=(d=o.parentWays.get(x))!=null?d:n.parentWays.get(x))!=null?f:[]);b.add(a.id),r.set(x,b)}}else if(a.type==="relation"){let x=e?e.members.map(_=>_.id):[],b=t?t.members.map(_=>_.id):[];e&&t?(l=Di(x,b),c=Di(b,x)):e?(l=x,c=[]):t&&(l=[],c=b);for(let _ of l){let w=new Set((m=(p=o.parentRels.get(_))!=null?p:n.parentRels.get(_))!=null?m:[]);w.delete(a.id),s.set(_,w)}for(let _ of c){let w=new Set((y=(g=o.parentRels.get(_))!=null?g:n.parentRels.get(_))!=null?y:[]);w.add(a.id),s.set(_,w)}}}replace(e){let t=e.id,r=this.hasEntity(t);return r===e?this:this.update(function(){this._updateCalculated(r,e),this._local.entities.set(t,e)})}remove(e){let t=e.id,r=this.hasEntity(t);return r?this.update(function(){this._updateCalculated(r,void 0),this._local.entities.set(t,void 0)}):this}revert(e){let t=this._base.entities.get(e),r=this.hasEntity(e);return r===t?this:this.update(function(){this._updateCalculated(r,t),this._local.entities.delete(e)})}update(...e){let t=this._frozen?new i(this,!0):this;for(let r of e)r.call(t,t);return this._frozen&&(t._frozen=!0),t}load(e){let t=this._base,r=this._local;r.entities=new Map;for(let[s,n]of Object.entries(e)){let o=t.entities.get(s);r.entities.set(s,n),this._updateCalculated(o,n)}return this}};var vn=class{constructor(e,t,r,s={},n={}){var o,a,l,c,u,h,d,f,p,m,g,y,x,b,_;this.context=e,this.id=t,this.safeid=Ta(t),this.allFields=s,this.allPresets=n,this.orig={},this.orig.addTags=(a=(o=r.addTags)!=null?o:r.tags)!=null?a:{},this.orig.aliases=(l=r.aliases)!=null?l:[],this.orig.fields=(c=r.fields)!=null?c:[],this.orig.geometry=(u=r.geometry)!=null?u:[],this.orig.icon=r.icon,this.orig.imageURL=r.imageURL,this.orig.locationSet=r.locationSet,this.orig.matchScore=(h=r.matchScore)!=null?h:1,this.orig.moreFields=(d=r.moreFields)!=null?d:[],this.orig.name=(f=r.name)!=null?f:"",this.orig.reference=(p=r.reference)!=null?p:{},this.orig.removeTags=(y=(g=(m=r.removeTags)!=null?m:r.addTags)!=null?g:r.tags)!=null?y:{},this.orig.replacement=r.replacement,this.orig.searchable=(x=r.searchable)!=null?x:!0,this.orig.suggestion=r.suggestion,this.orig.tags=(b=r.tags)!=null?b:{},this.orig.terms=((_=r.terms)!=null?_:[]).join(),Object.assign(this,li(this.orig,["aliases","fields","matchScore","moreFields","name","reference","terms"])),this._resolved={fields:null,moreFields:null},this._searchName=null,this._searchNameStripped=null,this._searchAliases=null,this._searchAliasesStripped=null}aliases(){return this._resolveName("name").t("aliases",{default:this.orig.aliases}).trim().split(/\s*[\r\n]+\s*/)}name(){return this._resolveName("name").t("name",{default:this.orig.name||this.id})}nameLabel(){return this._resolveName("name").tHtml("name",{default:this.orig.name||this.id})}fields(){return this._resolved.fields||(this._resolved.fields=this._resolveFields("fields"))}moreFields(){return this._resolved.moreFields||(this._resolved.moreFields=this._resolveFields("moreFields"))}resetFields(){return this._resolved={fields:null,moreFields:null}}matchGeometry(e){return this.geometry.includes(e)}matchAllGeometry(e){return e.every(t=>this.matchGeometry(t))}matchScore(e){let t=this.tags,r={},s=0;for(let o in t)if(r[o]=!0,e[o]===t[o])s+=this.orig.matchScore;else if(t[o]==="*"&&o in e)s+=this.orig.matchScore/2;else return-1;let n=this.addTags;for(let o in n)!r[o]&&e[o]===n[o]&&(s+=this.orig.matchScore);return s}t(e,t){return this.context.systems.l10n.t(`_tagging.presets.presets.${this.id}.${e}`,t)}tHtml(e,t){return this.context.systems.l10n.tHtml(`_tagging.presets.presets.${this.id}.${e}`,t)}tAppend(e,t){return this.context.systems.l10n.tAppend(`_tagging.presets.presets.${this.id}.${e}`,t)}subtitle(){if(this.suggestion){let e=this.context.systems.l10n,t=this.id.split("/");return t.pop(),e.t("_tagging.presets.presets."+t.join("/")+".name")}return null}subtitleLabel(){if(this.suggestion){let e=this.context.systems.l10n,t=this.id.split("/");return t.pop(),e.tHtml("_tagging.presets.presets."+t.join("/")+".name")}return null}terms(){return this._resolveName("name").t("terms",{default:this.orig.terms}).toLowerCase().trim().split(/\s*,+\s*/)}searchName(){return this._searchName||(this._searchName=(this.suggestion?this.orig.name:this.name()).toLowerCase()),this._searchName}searchNameStripped(){return this._searchNameStripped||(this._searchNameStripped=this._stripDiacritics(this.searchName())),this._searchNameStripped}searchAliases(){return this._searchAliases||(this._searchAliases=this.aliases().map(e=>e.toLowerCase())),this._searchAliases}searchAliasesStripped(){return this._searchAliasesStripped||(this._searchAliasesStripped=this.searchAliases().map(this._stripDiacritics)),this._searchAliasesStripped}isFallback(){return["point","line","area","relation"].includes(this.id)}reference(){let e=this.tags.wikidata||this.tags["flag:wikidata"]||this.tags["brand:wikidata"]||this.tags["network:wikidata"]||this.tags["operator:wikidata"];if(e)return{qid:e};let t=this.orig.reference.key||Object.keys(li(this.tags,"name"))[0],r=this.orig.reference.value||this.tags[t];return r==="*"?{key:t}:{key:t,value:r}}unsetTags(e,t,r,s){let n=r?li(this.removeTags,r):this.removeTags;return e=li(e,Object.keys(n)),t&&!s&&this.fields().forEach(o=>{o.matchGeometry(t)&&o.key&&o.default===e[o.key]&&delete e[o.key]}),delete e.area,e}setTags(e,t,r){let s=this.addTags;e=Object.assign({},e);for(let n in s)s[n]==="*"?(this.tags[n]||!e[n]||e[n]==="no")&&(e[n]="yes"):e[n]=s[n];if(!s.hasOwnProperty("area")&&(delete e.area,t==="area")){let n=!0;if(this.geometry.indexOf("line")===-1){for(let o in s)if(o in Ia){n=!1;break}}n&&(e.area="yes")}return t&&!r&&this.fields().forEach(n=>{n.matchGeometry(t)&&n.key&&!e[n.key]&&n.default&&(e[n.key]=n.default)}),e}_stripDiacritics(e){return e.normalize&&(e=e.normalize("NFD")),e=e.replace(/[\u0300-\u036f]/g,""),e}_resolveName(e){var s;let r=((s=this.orig[e])!=null?s:"").match(/^\{(.*)\}$/);if(r){let n=this.allPresets[r[1]];if(n)return n;console.warn(`Unable to resolve referenced preset: ${r[1]}.${e}`)}return this}_resolveFields(e){var a;let t=(a=this.orig[e])!=null?a:[],r=this,s=[];for(let l of t){let c=l.match(/^\{(.*)\}$/);c!==null?s=s.concat(o(c[1],e)):this.allFields[l]?s.push(this.allFields[l]):console.warn(`Cannot resolve "${l}" found in ${this.id}.${e}`)}let n=this.id.split("/");for(;!s.length&&n.length;){n.pop();let l=n.join("/");l&&(s=o(l,e))}return Fe(s);function o(l,c){let u=r.allPresets[l];return u?c==="fields"?u.fields():c==="moreFields"?u.moreFields():[]:[]}}};var c9=et(Zr(),1);var Jr=class{constructor(e){this._current=e,this._entityRBush=new c9.default,this._entityBoxes=new Map,this._entitySegments=new Map,this._segmentRBush=new c9.default,this._segmentBoxes=new Map}_removeEntity(e){var s;let t=this._entityBoxes.get(e);t&&(this._entityRBush.remove(t),this._entityBoxes.delete(e));let r=(s=this._entitySegments.get(e))!=null?s:[];for(let n of r){let o=n.id,a=this._segmentBoxes.get(o);a&&(this._segmentRBush.remove(a),this._segmentBoxes.delete(o))}this._entitySegments.delete(e)}_loadEntities(e){var n;let t=this._current,r=[],s=[];for(let[o,a]of e){let l=a.extent(t);if(!l)continue;let c=l.bbox();if(c.id=o,this._entityBoxes.set(o,c),r.push(c),typeof a.segments!="function")continue;let u=(n=a.segments(t))!=null?n:[];this._entitySegments.set(o,u);for(let h of u){let d=h.id,f=h.extent(t);if(!f)continue;let p=f.bbox();p.id=d,p.segment=h,this._segmentBoxes.set(d,p),s.push(p)}}r.length&&this._entityRBush.load(r),s.length&&this._segmentRBush.load(s)}_includeParents(e,t,r){let s=this._current,n=e.id;if(r||(r=new Set),!r.has(n)){r.add(n);for(let o of s.parentWays(e))this._entityBoxes.has(o.id)&&(this._removeEntity(o.id),t.set(o.id,o)),this._includeParents(o,t,r);for(let o of s.parentRelations(e))this._entityBoxes.has(o.id)&&(this._removeEntity(o.id),t.set(o.id,o)),this._includeParents(o,t,r)}}_setCurrentGraph(e){if(e===this._current)return;let t=new er(this._current,e);this._current=e;let r=t.didChange;if(!r.addition&&!r.deletion&&!r.geometry)return;let s=new Map;if(r.deletion)for(let n of t.deleted())this._removeEntity(n.id);if(r.geometry)for(let n of t.modified())this._removeEntity(n.id),s.set(n.id,n),this._includeParents(n,s);if(r.addition)for(let n of t.created())s.set(n.id,n);this._loadEntities(s)}rebase(e,t){let s=this._current.local,n=new Map;for(let o of e){if(!o.visible)continue;let a=o.id;s.entities.has(a)&&s.entities.get(a)===void 0||this._entityBoxes.has(a)&&!t||(this._removeEntity(a),n.set(a,o),this._includeParents(o,n))}this._loadEntities(n)}intersects(e,t){return this._setCurrentGraph(t),this._entityRBush.search(e.bbox()).map(r=>t.entity(r.id))}waySegments(e,t){return this._setCurrentGraph(t),this._segmentRBush.search(e.bbox()).map(r=>r.segment)}};var Te=class{constructor(e){this.title=e.title,this.onClick=e.onClick,this.disabledReason=e.disabledReason,this.icon=e.icon,this.entityIds=e.entityIds||[],this.issue=null}};var Ye=class{constructor(e,t){this.context=e,this.type=t.type,this.subtype=t.subtype,this.severity=t.severity,this.entityIds=t.entityIds,this.loc=t.loc,this.data=t.data,this.hash=t.hash,this.autoArgs=t.autoArgs,t.message&&(this.message=t.message.bind(this)),t.reference&&(this.reference=t.reference.bind(this)),t.dynamicFixes&&(this.dynamicFixes=t.dynamicFixes.bind(this)),this.id=this._generateID(),this.key=this._generateKey()}extent(e){return this.loc?new ie(this.loc):this.entityIds&&this.entityIds.length?ft(this.entityIds,e):null}fixes(){let e=typeof this.dynamicFixes=="function"?this.dynamicFixes():[];if(this.severity==="warning"){let t=this.context.systems.l10n,r=this.context.systems.validator;e.push(new Te({title:t.t("issues.fix.ignore_issue.title"),icon:"rapid-icon-close",onClick:()=>{r.ignoreIssue(this.id)}}))}for(let t of e)t.id=t.title,t.issue=this;return e}_generateID(){let e=[this.type];if(this.hash&&e.push(this.hash),this.subtype&&e.push(this.subtype),this.entityIds){let t=this.entityIds.slice().sort();e.push.apply(e,t)}return e.join(":")}_generateKey(){return this.id+":"+Date.now().toString()}};function n2(i){if(!(this instanceof n2))return new n2(i);Object.assign(this,i)}function l_(i,e,t){t=t||30;var r=new di,s,n,o;function a($){return i.parentRelations($).some(function(U){return U.isRestriction()})}function l($){if($.isArea()||$.isDegenerate())return!1;var U={motorway:!0,motorway_link:!0,trunk:!0,trunk_link:!0,primary:!0,primary_link:!0,secondary:!0,secondary_link:!0,tertiary:!0,tertiary_link:!0,residential:!0,unclassified:!0,living_street:!0,service:!0,busway:!0,road:!0,track:!0};return U[$.tags.highway]}for(var c=i.entity(e),u=[c],h,d=[],f=[],p,m=[],g=[],y,x=[],b,_=[],w,A=[];u.length;){p=u.pop(),h=i.parentWays(p);var k=!1;for(s=0;s<h.length;s++)if(y=h[s],!(!l(y)&&!a(y))){for(m.push(y),k=!0,x=Fe(i.childNodes(y)),n=0;n<x.length;n++)if(b=x[n],b!==p&&d.indexOf(b)===-1&&!(at(b.loc,c.loc)>t)){var v=!1;for(_=i.parentWays(b),o=0;o<_.length;o++)if(w=_[o],w!==y&&m.indexOf(w)===-1&&l(w)){v=!0;break}v&&u.push(b)}}k&&d.push(p)}d=Fe(d),m=Fe(m),m.forEach(function($){i.childNodes($).forEach(function(U){r=r.replace(U)}),r=r.replace($),i.parentRelations($).forEach(function(U){U.isRestriction()&&(U.isValidRestriction(i)?r=r.replace(U):U.isComplete(i)&&A.push(xi(U.id)))})}),m.forEach(function($){var U=r.entity($.id);if(U.tags.oneway==="-1"){var H=hs(U.id,{reverseOneway:!0});A.push(H),r=H(r)}});var E=de.id.next.way;d.forEach(function($){var U=io([$.id]).keepHistoryOn("first");U.disabled(r)||U.ways(r).forEach(function(H){var z=io([$.id]).limitWays([H.id]).keepHistoryOn("first");A.push(z),r=z(r)})}),de.id.next.way=E,f=d.map(function($){return $.id}),d=[],m=[],f.forEach(function($){var U=r.entity($),H=r.parentWays(U);d.push(U),m=m.concat(H)}),d=Fe(d),m=Fe(m),f=d.map(function($){return $.id}),g=m.map(function($){return $.id});function S($,U){var H=$.isOneWay(),z=U.indexOf($.first())!==-1,j=U.indexOf($.last())!==-1,X=z&&j,K=z&&!H||j,Y=z||j&&!H;return $.update({__first:z,__last:j,__from:K,__via:X,__to:Y,__oneWay:H})}m=[],g.forEach(function($){var U=S(r.entity($),f);r=r.replace(U),m.push(U)});var M,I=[],T=[];do for(M=!1,u=f.slice(),s=0;s<u.length;s++){var C=u[s];if(p=r.hasEntity(C),!p){f.indexOf(C)!==-1&&f.splice(f.indexOf(C),1),T.push(C);continue}if(_=r.parentWays(p),_.length<3&&f.indexOf(C)!==-1&&f.splice(f.indexOf(C),1),_.length===2){var P=_[0],D=_[1],O=P&&!P.__via,R=D&&!D.__via,N,F;O&&!R?(N=P,F=D):!O&&R&&(N=D,F=P),N&&F&&(F=S(F,f),r=r.replace(F).remove(N),I.push(N.id),M=!0)}_=r.parentWays(p),_.length<2&&(f.indexOf(C)!==-1&&f.splice(f.indexOf(C),1),T.push(C),M=!0),_.length<1&&(r=r.remove(p))}while(M);d=d.filter(function($){return T.indexOf($.id)===-1}).map(function($){return r.entity($.id)}),m=m.filter(function($){return I.indexOf($.id)===-1}).map(function($){return r.entity($.id)});var B={graph:r,actions:A,vertices:d,ways:m};return B.turns=function($,U){if(!$)return[];U||(U=0);var H=B.graph,z=B.vertices.map(function(re){return re.id}),j=H.entity($);if(!j||!(j.__from||j.__via))return[];var X=U*2+3,K=[];return Y(j),K;function Y(re,W,Z,Q){if(W=(W||[]).slice(),!(W.length>=X)){W.push(re.id),Z=(Z||[]).slice();var q,pe;if(re.type==="node"){var $e=H.parentWays(re),nt=[];for(q=0;q<$e.length;q++){var lt=$e[q];if(!(lt.__oneWay&&lt.nodes[0]!==re.id)&&!(W.indexOf(lt.id)!==-1&&W.length>=3)){var Tt=null;for(pe=0;pe<Z.length;pe++){var Yt=Z[pe],zi=Yt.memberByRole("from"),oi=Yt.membersByRole("via"),mt=Yt.memberByRole("to"),Ve=/^only_/.test(Yt.tags.restriction),It=zi.id===$,Fs=!1,Vr=!1;if(mt.id===lt.id)if(oi.length===1&&oi[0].type==="node")Fs=oi[0].id===re.id&&(It&&W.length===2||!It&&W.length>2);else{var Mo=[];for(o=2;o<W.length;o+=2)Mo.push(W[o]);var cs=[];for(o=0;o<oi.length;o++)oi[o].type==="way"&&cs.push(oi[o].id);var ka=Di(Mo,cs);Fs=!ka.length}else if(Ve){for(o=0;o<oi.length;o++)if(oi[o].type==="way"&&oi[o].id===lt.id){Vr=!0;break}}if(Fs?Ve?Tt={id:Yt.id,direct:It,from:zi.id,no:!1,only:!0,end:!0}:Tt={id:Yt.id,direct:It,from:zi.id,no:!0,only:!1,end:!0}:Vr?Tt={id:Yt.id,direct:!1,from:zi.id,no:!1,only:!0,end:!1}:Ve&&(Tt={id:Yt.id,direct:!1,from:zi.id,no:!0,only:!1,end:!0}),Tt&&Tt.direct)break}nt.push({way:lt,restrict:Tt})}}nt.forEach(function(De){Y(De.way,W,Z,De.restrict)})}else{if(W.length>=3){var Wr=W.slice();if(Q&&Q.direct===!1){for(q=0;q<Wr.length;q++)if(Wr[q]===Q.from){Wr=Wr.slice(q);break}}var ji=oe(Wr);if(ji&&(Q&&(ji.restrictionID=Q.id,ji.no=Q.no,ji.only=Q.only,ji.direct=Q.direct),K.push(n2(ji))),W[0]===W[2])return}if(Q&&Q.end)return;var Ls=H.entity(re.first()),ae=H.entity(re.last()),ce=at(Ls.loc,ae.loc),Pe=[];if(W.length>1&&(ce>t||!re.__via))return;!re.__oneWay&&z.indexOf(Ls.id)!==-1&&W.indexOf(Ls.id)===-1&&Pe.push(Ls),z.indexOf(ae.id)!==-1&&W.indexOf(ae.id)===-1&&Pe.push(ae),Pe.forEach(function(De){var ot=H.parentRelations(re).filter(function(Nt){if(!Nt.isRestriction())return!1;var Kt=Nt.memberByRole("from");if(!Kt||Kt.id!==re.id)return!1;var Os=/^only_/.test(Nt.tags.restriction);if(!Os)return!0;var Xr=!1,Rl=Nt.membersByRole("via");if(Rl.length===1&&Rl[0].type==="node")Xr=Rl[0].id===De.id;else for(var d3=0;d3<Rl.length;d3++)if(Rl[d3].type==="way"){var _y=H.entity(Rl[d3].id);if(_y.first()===De.id||_y.last()===De.id){Xr=!0;break}}return Xr});Y(De,W,Z.concat(ot),!1)})}}}function oe(re){if(re.length<3)return;var W,Z,Q,q,pe,$e,nt,lt,Tt;if(W=re[0],q=re[re.length-1],re.length===3&&W===q){var Yt=H.entity(W);if(Yt.__oneWay)return null;Tt=!0,lt=Q=$e=re[1],Z=pe=zi(W,lt)}else Tt=!1,Q=re[1],Z=zi(W,Q),$e=re[re.length-2],pe=zi(q,$e),re.length===3?lt=re[1]:(nt=re.filter(function(oi){return oi[0]==="w"}),nt=nt.slice(1,nt.length-1));return{key:re.join("_"),path:re,from:{node:Z,way:W,vertex:Q},via:{node:lt,ways:nt},to:{node:pe,way:q,vertex:$e},u:Tt};function zi(oi,mt){var Ve=H.entity(oi).nodes;return mt===Ve[0]?Ve[1]:Ve[Ve.length-2]}}},B}function c_(i,e,t){for(var r=i.entity(e.from.way),s=i.entity(e.from.node),n=i.entity(e.from.vertex),o=i.entity(e.to.way),a=i.entity(e.to.node),l=i.entity(e.to.vertex),c=r.tags.oneway==="yes",u=o.tags.oneway==="yes",h=($t(t.project(n.loc),t.project(s.loc))-$t(t.project(l.loc),t.project(a.loc)))*(180/Math.PI);h<0;)h+=360;return s===a||(h<23||h>336)&&c&&u||(h<40||h>319)&&c&&u&&e.from.vertex!==e.to.vertex?"no_u_turn":h<158?"no_right_turn":h>202?"no_left_turn":"no_straight_on"}function N5(i,e){function t(s){var n=i.map(function(a){return s.entity(a)}),o=Ut(n,function(a){return a.type==="way"&&a.isClosed()?"closedWay":a.type==="relation"&&a.isMultipolygon()?"multipolygon":"other"});return Object.assign({closedWay:[],multipolygon:[],other:[]},o)}var r=function(s){for(var n=t(s),o=n.multipolygon.reduce(function(p,m){return p.concat(Rr(m.members,s))},[]).concat(n.closedWay.map(function(p){var m=[{id:p.id}];return m.nodes=s.childNodes(p),m})),a=o.map(function(p,m){return o.map(function(g,y){return m===y?null:i1(g.nodes.map(function(x){return x.loc}),p.nodes.map(function(x){return x.loc}))})}),l=[],c=!0;o.length;)d(o),o=o.filter(u),a=a.filter(u).map(h);function u(p,m){return a[m].some(function(g){return g})}function h(p){return p.filter(u)}function d(p){p.forEach(function(m,g){u(m,g)||m.forEach(function(y){l.push({type:"way",id:y.id,role:c?"outer":"inner"})})}),c=!c}var f=n.multipolygon[0]||Qt({id:e,tags:{type:"multipolygon"}});return n.multipolygon.slice(1).forEach(function(p){f=f.mergeTags(p.tags),s=s.remove(p)}),n.closedWay.forEach(function(p){function m(g){return g.id===p.id&&g.role!=="inner"}l.some(m)&&(f=f.mergeTags(p.tags),s=s.replace(p.update({tags:{}})))}),s.replace(f.update({members:l,tags:li(f.tags,["area"])}))};return r.disabled=function(s){var n=t(s);if(n.other.length>0||n.closedWay.length+n.multipolygon.length<2)return"not_eligible";if(!n.multipolygon.every(function(a){return a.isComplete(s)}))return"incomplete_relation";if(n.multipolygon.length){if(n.closedWay.some(function(a){return Vi(s.parentMultipolygons(a),n.multipolygon).length}))return"not_eligible"}else{var o=[];if(n.closedWay.forEach(function(a,l){l===0?o=s.parentMultipolygons(a):o=Vi(o,s.parentMultipolygons(a))}),o=o.filter(function(a){return a.members.length===n.closedWay.length}),o.length)return"not_eligible"}},r}var v1=et(f1(),1);function PD(i,e){let t={};for(let n=0;n<e.length;n++){let o=e[n];t[o]?t[o].push(n):t[o]=[n]}let s=[{buffer1index:-1,buffer2index:-1,chain:null}];for(let n=0;n<i.length;n++){let o=i[n],a=t[o]||[],l=0,c=s[0];for(let u=0;u<a.length;u++){let h=a[u],d;for(d=l;d<s.length&&!(s[d].buffer2index<h&&(d===s.length-1||s[d+1].buffer2index>h));d++);if(d<s.length){let f={buffer1index:n,buffer2index:h,chain:s[d]};if(l===s.length?s.push(c):s[l]=c,l=d+1,c=f,l===s.length)break}}s[l]=c}return s[s.length-1]}function u_(i,e){let t=PD(i,e),r=[],s=i.length,n=e.length;for(let o=t;o!==null;o=o.chain){let a=s-o.buffer1index-1,l=n-o.buffer2index-1;s=o.buffer1index,n=o.buffer2index,(a||l)&&r.push({buffer1:[s+1,a],buffer1Content:i.slice(s+1,s+1+a),buffer2:[n+1,l],buffer2Content:e.slice(n+1,n+1+l)})}return r.reverse(),r}function DD(i,e,t){let r=[];function s(l,c){r.push({ab:c,oStart:l.buffer1[0],oLength:l.buffer1[1],abStart:l.buffer2[0],abLength:l.buffer2[1]})}u_(e,i).forEach(l=>s(l,"a")),u_(e,t).forEach(l=>s(l,"b")),r.sort((l,c)=>l.oStart-c.oStart);let n=[],o=0;function a(l){l>o&&(n.push({stable:!0,buffer:"o",bufferStart:o,bufferLength:l-o,bufferContent:e.slice(o,l)}),o=l)}for(;r.length;){let l=r.shift(),c=l.oStart,u=l.oStart+l.oLength,h=[l];for(a(c);r.length;){let d=r[0],f=d.oStart;if(f>u)break;u=Math.max(u,f+d.oLength),h.push(r.shift())}if(h.length===1){if(l.abLength>0){let d=l.ab==="a"?i:t;n.push({stable:!0,buffer:l.ab,bufferStart:l.abStart,bufferLength:l.abLength,bufferContent:d.slice(l.abStart,l.abStart+l.abLength)})}}else{let d={a:[i.length,-1,e.length,-1],b:[t.length,-1,e.length,-1]};for(;h.length;){l=h.shift();let x=l.oStart,b=x+l.oLength,_=l.abStart,w=_+l.abLength,A=d[l.ab];A[0]=Math.min(_,A[0]),A[1]=Math.max(w,A[1]),A[2]=Math.min(x,A[2]),A[3]=Math.max(b,A[3])}let f=d.a[0]+(c-d.a[2]),p=d.a[1]+(u-d.a[3]),m=d.b[0]+(c-d.b[2]),g=d.b[1]+(u-d.b[3]),y={stable:!1,aStart:f,aLength:p-f,aContent:i.slice(f,p),oStart:c,oLength:u-c,oContent:e.slice(c,u),bStart:m,bLength:g-m,bContent:t.slice(m,g)};n.push(y)}o=u}return a(e.length),n}function h_(i,e,t,r){r=Object.assign({excludeFalseConflicts:!0,stringSeparator:/\s+/},r),typeof i=="string"&&(i=i.split(r.stringSeparator)),typeof e=="string"&&(e=e.split(r.stringSeparator)),typeof t=="string"&&(t=t.split(r.stringSeparator));let n=[],o=DD(i,e,t),a=[];function l(){a.length&&n.push({ok:a}),a=[]}function c(u,h){if(u.length!==h.length)return!1;for(let d=0;d<u.length;d++)if(u[d]!==h[d])return!1;return!0}return o.forEach(u=>{u.stable?a.push(...u.bufferContent):r.excludeFalseConflicts&&c(u.aContent,u.bContent)?a.push(...u.aContent):(l(),n.push({conflict:{a:u.aContent,aIndex:u.aStart,o:u.oContent,oIndex:u.oStart,b:u.bContent,bIndex:u.bStart}}))}),l(),n}function _1(i,e={}){var g,y,x,b;let t=e.localGraph,r=e.remoteGraph,s=(g=e.discardTags)!=null?g:{},n=(y=e.formatUser)!=null?y:_=>_,o=(x=e.localize)!=null?x:_=>_,a=(b=e.strategy)!=null?b:"safe",l=[];function c(_,w){return a==="force_local"||We(w.loc,_.loc,1e-6)?w:a==="force_remote"?w.update({loc:_.loc}):(l.push(o("merge_remote_changes.conflict.location",{user:n(_.user)})),w)}function u(_,w,A){if(a==="force_local"||(0,v1.default)(A.nodes,w.nodes))return A;if(a==="force_remote")return A.update({nodes:w.nodes});let k=l.length,v=_.nodes||[],E=A.nodes||[],S=w.nodes||[],M=h_(E,v,S,{excludeFalseConflicts:!0}),I=[];for(let T of M)if(T.ok)I.push.apply(I,T.ok);else{let C=T.conflict;if((0,v1.default)(C.o,C.a))I.push.apply(I,C.b);else if((0,v1.default)(C.o,C.b))I.push.apply(I,C.a);else{l.push(o("merge_remote_changes.conflict.nodelist",{user:n(w.user)}));break}}return l.length===k?A.update({nodes:I}):A}function h(_,w,A,k){function v(S,M){let I=k.parentWays(S).some(T=>T.id!==M.id);return S.hasInterestingTags()||I||k.parentRelations(S).length>0}let E=l.length;for(let S of w){let M=k.hasEntity(S);if(_.nodes.indexOf(S)===-1){M&&!v(M,_)&&A.removeIDs.push(S);continue}let I=t.hasEntity(S),T=r.hasEntity(S),C;if(a==="force_remote"&&T&&T.visible)A.replacements.push(T);else if(a==="force_local"&&I)C=de(I),T&&(C=C.update({version:T.version})),A.replacements.push(C);else if(a==="safe"&&I&&T&&I.version!==T.version){if(C=de(I,{version:T.version}),T.visible?C=c(T,C):l.push(o("merge_remote_changes.conflict.deleted",{user:n(T.user)})),l.length!==E)break;A.replacements.push(C)}}return _}function d(_,w){for(let A of _.replacements)w=w.replace(A);return _.removeIDs.length&&(w=eo(_.removeIDs)(w)),w}function f(_,w){return a==="force_local"||(0,v1.default)(w.members,_.members)?w:a==="force_remote"?w.update({members:_.members}):(l.push(o("merge_remote_changes.conflict.memberlist",{user:n(_.user)})),w)}function p(_,w,A){var D,O,R;if(a==="force_local"||(0,v1.default)(A.tags,w.tags))return A;if(a==="force_remote")return A.update({tags:w.tags});let k=l.length,v=(D=_.tags)!=null?D:{},E=(O=A.tags)!=null?O:{},S=(R=w.tags)!=null?R:{},M=Gt(Gt(Object.keys(v),Object.keys(E)),Object.keys(S)).filter(function(N){return!s[N]}),I=Object.assign({},E),T=!1;for(var C=0;C<M.length;C++){var P=M[C];v[P]!==S[P]&&E[P]!==S[P]&&(v[P]!==E[P]?l.push(o("merge_remote_changes.conflict.tags",{tag:P,local:E[P],remote:S[P],user:n(w.user)})):(S.hasOwnProperty(P)?I[P]=S[P]:delete I[P],T=!0))}return T&&l.length===k?A.update({tags:I}):A}let m=function(_){let w={replacements:[],removeIDs:[]},A=_.base.entities.get(i),k=t.entity(i),v=r.entity(i),E=de(k,{version:v.version});return v.visible?(E.type==="node"?E=c(v,E):E.type==="way"?(_.rebase(r.childNodes(v),[_],!1),E=u(A,v,E),E=h(E,Gt(k.nodes,v.nodes),w,_)):E.type==="relation"&&(E=f(v,E)),E=p(A,v,E),l.length||(_=d(w,_).replace(E)),_):a==="force_remote"?eo([i])(_):a==="force_local"?(E.type==="way"&&(E=h(E,Fe(k.nodes),w,_),_=d(w,_)),_.replace(E)):(l.push(o("merge_remote_changes.conflict.deleted",{user:n(v.user)})),_)};return m.conflicts=function(){return l},m}function ti(i,e,t,r){for(var s=Ue,n=i.map(function(y){return t.project(y.loc)}),o=i.map(function(y){return y.id}),a=1/0,l,c,u=0;u<n.length-1;u++)if(!(o[u]===r||o[u+1]===r)){var h=n[u],d=Ze(n[u+1],h),f=Ze(e,h),p=ms(f,d)/ms(d,d),m;p<0?m=h:p>1?m=n[u+1]:m=[h[0]+p*d[0],h[1]+p*d[1]];var g=s(m,e);g<a&&(a=g,l=u+1,c=t.invert(m))}return l!==void 0?{index:l,distance:a,loc:c}:null}function d_(i,e,t){var r=[],s=[],n,o,a,l,c;for(n=0;n<i.length-1;n++)a=i[n],l=i[n+1],c=[a.loc,l.loc],(a.id===t||l.id===t)&&r.push(c);for(n=0;n<e.length-1;n++)a=e[n],l=e[n+1],c=[a.loc,l.loc],s.push(c);for(n=0;n<r.length;n++)for(o=0;o<s.length;o++){var u=r[n],h=s[o],d=Jn(u,h);if(d)return!0}return!1}function Ha(i,e){var t=[],r=[],s,n;for(s=0;s<i.length-1;s++){var o=i[s],a=i[s+1],l=[o.loc,a.loc];o.id===e||a.id===e?t.push(l):r.push(l)}for(s=0;s<t.length;s++)for(n=0;n<r.length;n++){var c=t[s],u=r[n];if(!(We(c[1],u[0])||We(c[0],u[1])||We(c[0],u[0])||We(c[1],u[1]))){var h=Jn(c,u);if(h){var d=1e-8;if(We(c[1],h,d)||We(c[0],h,d)||We(u[1],h,d)||We(u[0],h,d))continue;return!0}}}return!1}function Ga(i,e,t){return We(t,i)||We(t,e)?1:C5(i,e,t)}function f_(i,e,t,r,s){var n=Math.abs(i);return n<e||s&&Math.abs(n-1)<e?0:n<t||n>r?i:null}function F5(i,e,t,r){for(var s=0,n=e?0:1,o=e?i.length:i.length-1,a=i.map(function(m){return m.coord}),l=Math.cos((90-r)*Math.PI/180),c=Math.cos(r*Math.PI/180),u=n;u<o;u++){var h=a[(u-1+a.length)%a.length],d=a[u],f=a[(u+1)%a.length],p=f_(Ga(h,f,d),t,l,c);p!==null&&(s=s+2*Math.min(Math.abs(p-1),Math.min(Math.abs(p),Math.abs(p+1))))}return s}function p_(i,e,t){for(var r=-1/0,s=e?0:1,n=e?i.length:i.length-1,o=s;o<n;o++){var a=i[(o-1+i.length)%i.length],l=i[o],c=i[(o+1)%i.length],u=Ga(a,c,l),h=Math.acos(Math.abs(u))*180/Math.PI;h>45&&(h=90-h),!(h>=t)&&h>r&&(r=h)}return r===-1/0?null:r}function b1(i,e,t,r,s){for(var n=null,o=e?0:1,a=e?i.length:i.length-1,l=Math.cos((90-r)*Math.PI/180),c=Math.cos(r*Math.PI/180),u=o;u<a;u++){var h=i[(u-1+i.length)%i.length],d=i[u],f=i[(u+1)%i.length],p=f_(Ga(h,f,d),t,l,c,s);if(p!==null){if(Math.abs(p)>0)return 1;n=0}}return n}function _n(i,e,t,r){var s=e;function n(d){function f(g){if(i.indexOf(g)!==-1)return!0;var y=d.parentWays(d.entity(g));if(y.length<3)return!0;var x=y.every(function(b){return r.moving[b.id]});return x||delete r.moving[g],x}function p(g){for(var y=0;y<g.length;y++){var x=g[y];if(!r.moving[x]){r.moving[x]=!0;var b=d.hasEntity(x);b&&(b.type==="node"?(r.nodes.push(x),r.startLoc[x]=b.loc):b.type==="way"?(r.ways.push(x),p(b.nodes)):p(b.members.map(function(_){return _.id})))}}}function m(g){function y(I,T){return!I.isClosed()&&!!I.affix(T)}for(var x=0;x<g.length;x++)for(var b=g[x],_=d.childNodes(d.entity(b)),w=0;w<_.length;w++){var A=_[w],k=d.parentWays(A);if(k.length===2){for(var v=d.entity(b),E=null,S=0;S<k.length;S++){var M=k[S];if(!r.moving[M.id]){E=M;break}}E&&(Vi(v.nodes,E.nodes).length>2||v.isArea()||E.isArea()||r.intersections.push({nodeId:A.id,movedId:v.id,unmovedId:E.id,movedIsEP:y(v,A.id),unmovedIsEP:y(E,A.id)}))}}}r||(r={}),r.ok||(r.moving={},r.intersections=[],r.replacedVertex={},r.startLoc={},r.nodes=[],r.ways=[],p(i),m(r.ways),r.nodes=r.nodes.filter(f),r.ok=!0)}function o(d,f,p,m){var g=p.entity(f),y=p.entity(d),x=g.nodes.indexOf(d),b,_,w;g.isClosed()?(b=g.nodes.length-1,_=(x+b-1)%b,w=(x+b+1)%b):(b=g.nodes.length,_=x-1,w=x+1);var A=p.hasEntity(g.nodes[_]),k=p.hasEntity(g.nodes[w]);if(!A||!k)return p;var v=f+"_"+d,E=r.replacedVertex[v];E||(E=Be(),r.replacedVertex[v]=E,r.startLoc[E.id]=r.startLoc[d]);var S,M;m?(S=t.project(r.startLoc[d]),M=t.invert(dt(S,m))):M=r.startLoc[d],E=E.move(M);var I=t.project(E.loc),T=t.project(A.loc),C=t.project(k.loc),P=Math.abs($t(I,T)-$t(I,C))*(180/Math.PI);if(P>175&&P<185)return p;var D=[A.loc,E.loc,y.loc,k.loc].map(B=>t.project(B)),O=[A.loc,y.loc,E.loc,k.loc].map(B=>t.project(B)),R=i9(D),N=i9(O),F=R<=N?x:w;return g.isClosed()&&F===0&&(F=b),g=g.addNode(E.id,F),p.replace(E).replace(g)}function a(d,f){var p=f.entity(d),m=1e-6,g,y;function x(_,w){return w.parentWays(_).length>1||w.parentRelations(_).length||_.hasInterestingTags()}for(var b=0;b<p.nodes.length;b++)y=f.entity(p.nodes[b]),g&&y&&We(g.loc,y.loc,m)&&(x(g,f)?x(y,f)||(p=p.removeNode(y.id),f=f.replace(p).remove(y)):(p=p.removeNode(g.id),f=f.replace(p).remove(g))),g=y;return f}function l(d,f){var p=f.entity(d.nodeId),m=f.entity(d.movedId),g=f.entity(d.unmovedId),y=d.movedIsEP,x=d.unmovedIsEP;if(y&&x)return f;var b=f.childNodes(m).filter(function(M){return M!==p}),_=f.childNodes(g).filter(function(M){return M!==p});m.isClosed()&&m.first()===p.id&&b.push(b[0]),g.isClosed()&&g.first()===p.id&&_.push(_[0]);var w=!y&&ti(b,t.project(p.loc),t),A=!x&&ti(_,t.project(p.loc),t),k;if(!y&&!x)for(var v=1e-6,E=10,S=0;S<E&&(k=ct(w.loc,A.loc,.5),w=ti(b,t.project(k),t),A=ti(_,t.project(k),t),!(Math.abs(w.distance-A.distance)<v));S++);else y?k=A.loc:k=w.loc;return f=f.replace(p.move(k)),!y&&w.index!==m.nodes.indexOf(p.id)&&(m=m.removeNode(p.id).addNode(p.id,w.index),f=f.replace(m)),!x&&A.index!==g.nodes.indexOf(p.id)&&(g=g.removeNode(p.id).addNode(p.id,A.index),f=f.replace(g)),f}function c(d){for(var f=0;f<r.intersections.length;f++){var p=r.intersections[f];d=o(p.nodeId,p.movedId,d,s),d=o(p.nodeId,p.unmovedId,d,null),d=l(p,d),d=a(p.movedId,d),d=a(p.unmovedId,d)}return d}function u(d){function f(S){return dt(t.project(S),s)}for(var p=0;p<r.intersections.length;p++){var m=r.intersections[p];if(!(m.movedIsEP&&m.unmovedIsEP)&&m.movedIsEP){for(var g=d.entity(m.nodeId),y=t.project(g.loc),x=dt(y,s),b=d.childNodes(d.entity(m.movedId)),_=b.map(function(S){return f(S.loc)}),w=d.childNodes(d.entity(m.unmovedId)),A=w.map(function(S){return t.project(S.loc)}),k=k5(_,A),v=0;p<k.length;p++)if(!We(k[v],x)){var E=ti(w,x,t);s=Ze(t.project(E.loc),y)}}}}var h=function(d){if(s[0]===0&&s[1]===0)return d;n(d),r.intersections.length&&u(d);for(var f=0;f<r.nodes.length;f++){var p=d.entity(r.nodes[f]),m=t.project(p.loc),g=dt(m,s);d=d.replace(p.move(t.invert(g)))}return r.intersections.length&&(d=c(d)),d};return h.delta=function(){return s},h}function L5(i,e,t){return function(r){return r.replace(r.entity(i).moveMember(e,t))}}function bn(i,e){var t=function(r,s){(s===null||!isFinite(s))&&(s=1),s=Math.min(Math.max(+s,0),1);var n=r.entity(i);return r.replace(n.move(ct(n.loc,e,s)))};return t.transitionable=!0,t}function O5(){return function(i){return i}}function Xo(i,e,t,r,s){var n=s||1e-4,o=r||13,a=Math.cos((90-o)*Math.PI/180),l=Math.cos(o*Math.PI/180),c=function(h,d){(d===null||!isFinite(d))&&(d=1),d=Math.min(Math.max(+d,0),1);var f=h.entity(i);if(f=f.removeNode(""),f.tags.nonsquare){var p=Object.assign({},f.tags);delete p.nonsquare,f=f.update({tags:p})}h=h.replace(f);var m=f.isClosed(),g=h.childNodes(f).slice();if(m&&g.pop(),t!==void 0&&(g=u(g,t,m),g.length!==3))return h;var y={},x=[],b={i:0,dotp:1},_,w,A,k,v,E,S;for(E=0;E<g.length;E++)_=g[E],y[_.id]=(y[_.id]||0)+1,x.push({id:_.id,coord:e.project(_.loc)});if(x.length===3){for(E=0;E<1e3&&(v=x.map($),x[b.i].coord=dt(x[b.i].coord,v[b.i]),k=b.dotp,!(k<n));E++);_=h.entity(g[b.i].id),A=e.invert(x[b.i].coord),h=h.replace(_.move(ct(_.loc,A,d)))}else{var M=[],I=[];for(E=0;E<x.length;E++){w=x[E];var T=0;if(m||E>0&&E<x.length-1){var C=x[(E-1+x.length)%x.length],P=x[(E+1)%x.length];T=Math.abs(Ga(C.coord,P.coord,w.coord))}T>l?M.push(w):I.push(w)}var D=B(I),O=B(I);for(k=1/0,E=0;E<1e3;E++){for(v=I.map($),S=0;S<v.length;S++)I[S].coord=dt(I[S].coord,v[S]);var R=F5(I,m,n,o);if(R<k&&(D=B(I),k=R),k<n)break}var N=D.map(function(U){return U.coord});for(m&&N.push(N[0]),E=0;E<D.length;E++)w=D[E],We(O[E].coord,w.coord)||(_=h.entity(w.id),A=e.invert(w.coord),h=h.replace(_.move(ct(_.loc,A,d))));for(E=0;E<M.length;E++)if(w=M[E],!(y[w.id]>1))if(_=h.entity(w.id),d===1&&h.parentWays(_).length===1&&h.parentRelations(_).length===0&&!_.hasInterestingTags())h=yn(_.id)(h);else{var F=Jv(w.coord,N);F&&(A=e.invert(F.target),h=h.replace(_.move(ct(_.loc,A,d))))}}return h;function B(U){return U.map(function(H){return{id:H.id,coord:[H.coord[0],H.coord[1]]}})}function $(U,H,z){if(!m&&(H===0||H===z.length-1))return[0,0];if(y[z[H].id]>1)return[0,0];var j=z[(H-1+z.length)%z.length].coord,X=U.coord,K=z[(H+1)%z.length].coord,Y=Ze(j,X),oe=Ze(K,X),re=2*Math.min(Ue(Y),Ue(oe));Y=e1(Y),oe=e1(oe);var W=Y[0]*oe[0]+Y[1]*oe[1],Z=Math.abs(W);if(Z<a){b.i=H,b.dotp=Z;var Q=e1(dt(Y,oe));return mr(Q,.1*W*re)}return[0,0]}};function u(h,d,f){for(var p=f?0:1,m=f?h.length:h.length-1,g=p;g<m;g++)if(h[g].id===d)return[h[(g-1+h.length)%h.length],h[g],h[(g+1)%h.length]];return[]}return c.disabled=function(h){var d=h.entity(i);d=d.removeNode(""),h=h.replace(d);var f=d.isClosed(),p=h.childNodes(d).slice();f&&p.pop();var m=!1;if(t!==void 0&&(m=!0,p=u(p,t,f),p.length!==3))return"end_vertex";var g=p.map(function(x){return e.project(x.loc)}),y=b1(g,f,n,o,m);return y===null?"not_squarish":y===0?"square_enough":!1},c.transitionable=!0,c}function RD(i,e,t,r,s){var n=Math.abs(r.loc[0]-s.loc[0])>Math.abs(r.loc[1]-s.loc[1]),o=n?function(g,y){return r.loc[0]<s.loc[0]?g.loc[0]-y.loc[0]:y.loc[0]-g.loc[0]}:function(g,y){return r.loc[1]<s.loc[1]?g.loc[1]-y.loc[1]:y.loc[1]-g.loc[1]},a=t.nodes,l=a.indexOf(r.id),c=a.indexOf(s.id);if(l===-1||c===-1||l>=c||o(r,s)>=0)return null;for(var u=l+1;u<c&&o(e,i.entity(a[u]))>0;)u++;var h=i.entity(a[u-1]).loc,d=i.entity(a[u]).loc,f=e.loc,p=Math.abs(h[0]-d[0])>Math.abs(h[1]-d[1])?(f[0]-h[0])/(d[0]-h[0]):(f[1]-h[1])/(d[1]-h[1]),m=ct(h,d,p);return{insertIdx:u,interpLoc:m}}function u9(i,e){return Math.abs(i[0]-e[0])>2e-5||Math.abs(i[1]-e[1])>2e-5}function B5(i){delete i.__fbid__,delete i.__origid__,delete i.__service__,delete i.__datasetid__,delete i.tags.conn,delete i.tags.dupe}function U5(i,e){return function(t){var r={},s=e.entity(i);return s.type==="node"?n(s):s.type==="way"?o(s):s.type==="relation"&&a(s),t;function n(l){var c=Be(l);return c.tags=Object.assign({},c.tags),B5(c),t=t.replace(c),c}function o(l){var c=pt(l);c.nodes=l.nodes.slice(),c.tags=Object.assign({},c.tags),B5(c);var u=c.nodes.map(function(h){var d=Be(e.entity(h));d.tags=Object.assign({},d.tags);var f=d.tags.conn&&d.tags.conn.split(","),p=d.tags.dupe;if(B5(d),p&&t.hasEntity(p)&&!u9(t.entity(p).loc,d.loc)?d=t.entity(p):t.hasEntity(d.id)&&u9(t.entity(d.id).loc,d.loc)&&(d=Be({loc:d.loc})),f&&t.hasEntity(f[0])){var m=t.hasEntity(f[0]),g=t.hasEntity(f[1]),y=t.hasEntity(f[2]);if(m&&g&&y){var x=RD(t,d,m,g,y);x&&!u9(x.interpLoc,d.loc)&&(d.loc=x.interpLoc,t=t.replace(m.addNode(d.id,x.insertIdx)))}}return t=t.replace(d),d.id});return c=c.update({nodes:u}),t=t.replace(c),c}function a(l){var c=r[l.id];if(c)return c;var u=Qt(l);u.members=l.members.slice(),u.tags=Object.assign({},l.tags),B5(u);var h=u.members.map(function(d){var f=e.entity(d.id),p;return f.type==="node"?p=n(f):f.type==="way"?p=o(f):f.type==="relation"&&(p=a(f)),Object.assign(d,{id:p.id})});return u=u.update({members:h}),t=t.replace(u),r[l.id]=u,u}}}function m_(i,e,t){return function(r){var s=r.entity(i.from.way),n=r.entity(i.to.way),o=i.via.node&&r.entity(i.via.node),a=i.via.ways&&i.via.ways.map(function(c){return r.entity(c)}),l=[];return l.push({id:s.id,type:"way",role:"from"}),o?l.push({id:o.id,type:"node",role:"via"}):a&&a.forEach(function(c){l.push({id:c.id,type:"way",role:"via"})}),l.push({id:n.id,type:"way",role:"to"}),r.replace(Qt({id:t,tags:{type:"restriction",restriction:e},members:l}))}}function o2(i){var e=function(t){var r=t.hasEntity(i),s=t.base.entities.get(i);return r&&!s&&(r.type==="node"&&t.parentWays(r).forEach(function(n){n=n.removeNode(i),t=t.replace(n),n.isDegenerate()&&(t=vs(n.id)(t))}),t.parentRelations(r).forEach(function(n){n=n.removeMembersWithID(i),t=t.replace(n),n.isDegenerate()&&(t=xi(n.id)(t))})),t.revert(i)};return e}function $5(i,e,t,r){var s=function(n){return n.update(function(o){Ft(i,o).forEach(function(a){var l=Zn([r.project(a.loc)],t,e)[0];o=o.replace(a.move(r.invert(l)))})})};return s}function g_(i,e,t,r){return function(s){return s.update(function(n){let o,a;Ft(i,n).forEach(function(l){o=r.project(l.loc),a=[o[0]-e[0],o[1]-e[1]],o=[e[0]+t*a[0],e[1]+t*a[1]],n=n.replace(l.move(r.invert(o)))})})}}function H5(i,e){function t(n,o,a){return ms(n,a,o)/ms(a,a,o)}function r(n){var o=r1(n),a=[(o.poly[0][0]+o.poly[1][0])/2,(o.poly[0][1]+o.poly[1][1])/2],l=[(o.poly[2][0]+o.poly[3][0])/2,(o.poly[2][1]+o.poly[3][1])/2],c=[(o.poly[3][0]+o.poly[4][0])/2,(o.poly[3][1]+o.poly[4][1])/2],u=[(o.poly[1][0]+o.poly[2][0])/2,(o.poly[1][1]+o.poly[2][1])/2],h=Ue(a,l)>Ue(c,u);return h?[a,l]:[c,u]}var s=function(n,o){(o===null||!isFinite(o))&&(o=1),o=Math.min(Math.max(+o,0),1);for(var a=i.map(function(x){return n.entity(x)}),l=a.map(function(x){return e.project(x.loc)}),c=r(l),u=c[0],h=c[1],d=0;d<l.length;d++){var f=a[d],p=l[d],m=t(p,u,h),g=ct(u,h,m),y=e.invert(g);n=n.replace(f.move(ct(f.loc,y,o)))}return n};return s.disabled=function(n){for(var o=i.map(function(y){return n.entity(y)}),a=o.map(function(y){return e.project(y.loc)}),l=r(a),c=l[0],u=l[1],h=0,d=0;d<a.length;d++){var f=a[d],p=t(f,c,u),m=ct(c,u,p),g=Ue(m,f);!isNaN(g)&&g>h&&(h=g)}if(h<1e-4)return"straight_enough"},s.transitionable=!0,s}function G5(i,e){function t(o,a,l){return ms(o,l,a)/ms(l,l,a)}function r(o){for(var a=[],l=[],c=[],u=[],h=i.filter(function(w){return o.entity(w).type==="way"}),d=i.filter(function(w){return o.entity(w).type==="node"}),f=0;f<h.length;f++){var p=o.entity(h[f]);a=p.nodes.slice(0),u.push(a),l.push(a[0]),c.push(a[a.length-1])}l=l.filter(function(w){return l.indexOf(w)===l.lastIndexOf(w)}),c=c.filter(function(w){return c.indexOf(w)===c.lastIndexOf(w)});var m=Di(l,c).concat(Di(c,l))[0],g=[];a=[];for(var y=function(w,A){return A.filter(function(k){return k[0]===w||k[k.length-1]===w})[0]};u.length;)g=y(m,u),u=Di(u,[g]),g[0]!==m&&g.reverse(),a=a.concat(g),m=a[a.length-1];if(d.length===2){var x=a.indexOf(d[0]),b=a.indexOf(d[1]),_=[x,b];_.sort(function(w,A){return w-A}),a=a.slice(_[0],_[1]+1)}return a.map(function(w){return o.entity(w)})}function s(o,a){return a.parentWays(o).length>1||a.parentRelations(o).length||o.hasInterestingTags()}var n=function(o,a){(a===null||!isFinite(a))&&(a=1),a=Math.min(Math.max(+a,0),1);var l=r(o),c=l.map(function(b){return e.project(b.loc)}),u=c[0],h=c[c.length-1],d=[],f;for(f=1;f<c.length-1;f++){var p=l[f],m=c[f];if(a<1||s(p,o)){var g=t(m,u,h),y=ct(u,h,g),x=e.invert(y);o=o.replace(p.move(ct(p.loc,x,a)))}else d.indexOf(p)===-1&&d.push(p)}for(f=0;f<d.length;f++)o=yn(d[f].id)(o);return o};return n.disabled=function(o){var a=r(o),l=a.map(function(b){return e.project(b.loc)}),c=l[0],u=l[l.length-1],h=.2*Ue(c,u),d;if(h===0)return"too_bendy";var f=0;for(d=1;d<l.length-1;d++){var p=l[d],m=t(p,c,u),g=ct(c,u,m),y=Ue(g,p);if(isNaN(y)||y>h)return"too_bendy";y>f&&(f=y)}var x=a.every(function(b,_){return _===0||_===a.length-1||s(b,o)});if(f<1e-4&&x)return"straight_enough"},n.transitionable=!0,n}function y_(i){return function(e){return xi(i.restrictionID)(e)}}function z5(i,e){var t=!0,r=function(s,n){(n===null||!isFinite(n))&&(n=1),n=Math.min(Math.max(+n,0),1);var o=Ft(i,s),a=o.map(function(E){return e.project(E.loc)}),l=r1(a),c=[(l.poly[0][0]+l.poly[1][0])/2,(l.poly[0][1]+l.poly[1][1])/2],u=[(l.poly[2][0]+l.poly[3][0])/2,(l.poly[2][1]+l.poly[3][1])/2],h=[(l.poly[3][0]+l.poly[4][0])/2,(l.poly[3][1]+l.poly[4][1])/2],d=[(l.poly[1][0]+l.poly[2][0])/2,(l.poly[1][1]+l.poly[2][1])/2],f,p,m=Ue(c,u)>Ue(h,d);t&&m||!t&&!m?(f=c,p=u):(f=h,p=d);for(var g=p[0]-f[0],y=p[1]-f[1],x=(g*g-y*y)/(g*g+y*y),b=2*g*y/(g*g+y*y),_=0;_<o.length;_++){var w=o[_],A=e.project(w.loc),k=[x*(A[0]-f[0])+b*(A[1]-f[1])+f[0],b*(A[0]-f[0])-x*(A[1]-f[1])+f[1]],v=e.invert(k);w=w.move(ct(w.loc,v,n)),s=s.replace(w)}return s};return r.useLongAxis=function(s){return arguments.length?(t=s,r):t},r.transitionable=!0,r}function j5(i,e,t){return function(r){let s=r.entity(i),n=Object.assign({},s.tags),o,a;for(let[l,c]of Object.entries(e))if(l in n)if(c==="*")o=n[l],delete n[l];else if(c===n[l])delete n[l];else{let u=n[l].split(";").filter(Boolean),h=u.indexOf(c);u.length===1||h===-1?delete n[l]:(t&&t[l]&&(a=h),u.splice(h,1),n[l]=u.join(";"))}if(t)for(let[l,c]of Object.entries(t))if(c==="*"){if(n[l]&&n[l]!=="no")continue;n[l]="yes"}else if(c==="$1")n[l]=o;else if(n[l]&&e[l]&&a!==void 0){let u=n[l].split(";").filter(Boolean);u.indexOf(c)===-1&&(u.splice(a,0,c),n[l]=u.join(";"))}else n[l]=c;return r=r.replace(s.update({tags:n})),r}}var se={};g3(se,{BaseTextureCache:()=>Er,BoundingBox:()=>A2,CanvasRenderTarget:()=>gh,DATA_URI:()=>ph,EventEmitter:()=>pi.default,ProgramCache:()=>S2,TextureCache:()=>Fi,clearTextureCache:()=>Sw,correctBlendMode:()=>yw,createIndicesForQuads:()=>bw,decomposeDataUri:()=>Iw,deprecation:()=>je,destroyTextureCache:()=>Aw,detectVideoAlphaMode:()=>Zb,determineCrossOrigin:()=>xh,earcut:()=>Mw.default,getBufferType:()=>Zo,getCanvasBoundingBox:()=>yh,getResolutionOfUrl:()=>C2,hex2rgb:()=>fw,hex2string:()=>pw,interleaveTypedArrays:()=>ww,isMobile:()=>bs,isPow2:()=>w2,isWebGLSupported:()=>hh,log2:()=>E2,nextPow2:()=>Jo,path:()=>j9,premultiplyBlendMode:()=>b2,premultiplyRgba:()=>xw,premultiplyTint:()=>vw,premultiplyTintToRgba:()=>_w,removeItems:()=>mh,rgb2hex:()=>gw,sayHello:()=>ew,sign:()=>Ew,skipHello:()=>Jb,string2hex:()=>mw,trimCanvas:()=>Tw,uid:()=>An,url:()=>Kb});var h9={createCanvas:(i,e)=>{let t=document.createElement("canvas");return t.width=i,t.height=e,t},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>{var i;return(i=document.baseURI)!=null?i:window.location.href},getFontFaceSet:()=>document.fonts,fetch:(i,e)=>fetch(i,e),parseXML:i=>new DOMParser().parseFromString(i,"text/xml")};var te={ADAPTER:h9,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var d9=/iPhone/i,x_=/iPod/i,v_=/iPad/i,__=/\biOS-universal(?:.+)Mac\b/i,f9=/\bAndroid(?:.+)Mobile\b/i,b_=/Android/i,w1=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,V5=/Silk/i,so=/Windows Phone/i,w_=/\bWindows(?:.+)ARM\b/i,E_=/BlackBerry/i,A_=/BB10/i,S_=/Opera Mini/i,C_=/\b(CriOS|Chrome)(?:.+)Mobile/i,k_=/Mobile(?:.+)Firefox\b/i,T_=function(i){return typeof i!="undefined"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream=="undefined"};function ND(i){return function(e){return e.test(i)}}function a2(i){var e={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator!="undefined"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?e.userAgent=i:i&&i.userAgent&&(e={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var t=e.userAgent,r=t.split("[FBAN");typeof r[1]!="undefined"&&(t=r[0]),r=t.split("Twitter"),typeof r[1]!="undefined"&&(t=r[0]);var s=ND(t),n={apple:{phone:s(d9)&&!s(so),ipod:s(x_),tablet:!s(d9)&&(s(v_)||T_(e))&&!s(so),universal:s(__),device:(s(d9)||s(x_)||s(v_)||s(__)||T_(e))&&!s(so)},amazon:{phone:s(w1),tablet:!s(w1)&&s(V5),device:s(w1)||s(V5)},android:{phone:!s(so)&&s(w1)||!s(so)&&s(f9),tablet:!s(so)&&!s(w1)&&!s(f9)&&(s(V5)||s(b_)),device:!s(so)&&(s(w1)||s(V5)||s(f9)||s(b_))||s(/\bokhttp\b/i)},windows:{phone:s(so),tablet:s(w_),device:s(so)||s(w_)},other:{blackberry:s(E_),blackberry10:s(A_),opera:s(S_),firefox:s(k_),chrome:s(C_),device:s(E_)||s(A_)||s(S_)||s(k_)||s(C_)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}var I_,FD=(I_=a2.default)!=null?I_:a2,bs=FD(globalThis.navigator);te.RETINA_PREFIX=/@([0-9\.]+)x/;te.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var pi=et(P_(),1),Mw=et(L_(),1);var O1=et(Qb(),1);var Yb={};function je(i,e,t=3){if(Yb[e])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${i}`):(r=r.split(`
`).splice(t).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${i}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${i}`),console.warn(r))),Yb[e]=!0}var Kb={get parse(){return je("7.3.0","utils.url.parse is deprecated, use native URL API instead."),O1.parse},get format(){return je("7.3.0","utils.url.format is deprecated, use native URL API instead."),O1.format},get resolve(){return je("7.3.0","utils.url.resolve is deprecated, use native URL API instead."),O1.resolve}};function Ws(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function x2(i){return i.split("?")[0].split("#")[0]}function WN(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function XN(i,e,t){return i.replace(new RegExp(WN(e),"g"),t)}function qN(i,e){let t="",r=0,s=-1,n=0,o=-1;for(let a=0;a<=i.length;++a){if(a<i.length)o=i.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(s===a-1||n===1))if(s!==a-1&&n===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){let l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),s=a,n=0;continue}}else if(t.length===2||t.length===1){t="",r=0,s=a,n=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+=`/${i.slice(s+1,a)}`:t=i.slice(s+1,a),r=a-s-1;s=a,n=0}else o===46&&n!==-1?++n:n=-1}return t}var j9={toPosix(i){return XN(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},isBlobUrl(i){return i.startsWith("blob:")},hasProtocol(i){return/^[^/:]+:/.test(this.toPosix(i))},getProtocol(i){Ws(i),i=this.toPosix(i);let e=/^file:\/\/\//.exec(i);if(e)return e[0];let t=/^[^/:]+:\/{0,2}/.exec(i);return t?t[0]:""},toAbsolute(i,e,t){if(Ws(i),this.isDataUrl(i)||this.isBlobUrl(i))return i;let r=x2(this.toPosix(e!=null?e:te.ADAPTER.getBaseUrl())),s=x2(this.toPosix(t!=null?t:this.rootname(r)));return i=this.toPosix(i),i.startsWith("/")?j9.join(s,i.slice(1)):this.isAbsolute(i)?i:this.join(r,i)},normalize(i){if(Ws(i),i.length===0)return".";if(this.isDataUrl(i)||this.isBlobUrl(i))return i;i=this.toPosix(i);let e="",t=i.startsWith("/");this.hasProtocol(i)&&(e=this.rootname(i),i=i.slice(e.length));let r=i.endsWith("/");return i=qN(i,!1),i.length>0&&r&&(i+="/"),t?`/${i}`:e+i},isAbsolute(i){return Ws(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){var t;if(i.length===0)return".";let e;for(let r=0;r<i.length;++r){let s=i[r];if(Ws(s),s.length>0)if(e===void 0)e=s;else{let n=(t=i[r-1])!=null?t:"";this.joinExtensions.includes(this.extname(n).toLowerCase())?e+=`/../${s}`:e+=`/${s}`}}return e===void 0?".":this.normalize(e)},dirname(i){if(Ws(i),i.length===0)return".";i=this.toPosix(i);let e=i.charCodeAt(0),t=e===47,r=-1,s=!0,n=this.getProtocol(i),o=i;i=i.slice(n.length);for(let a=i.length-1;a>=1;--a)if(e=i.charCodeAt(a),e===47){if(!s){r=a;break}}else s=!1;return r===-1?t?"/":this.isUrl(o)?n+i:n:t&&r===1?"//":n+i.slice(0,r)},rootname(i){Ws(i),i=this.toPosix(i);let e="";if(i.startsWith("/")?e="/":e=this.getProtocol(i),this.isUrl(i)){let t=i.indexOf("/",e.length);t!==-1?e=i.slice(0,t):e=i,e.endsWith("/")||(e+="/")}return e},basename(i,e){Ws(i),e&&Ws(e),i=x2(this.toPosix(i));let t=0,r=-1,s=!0,n;if(e!==void 0&&e.length>0&&e.length<=i.length){if(e.length===i.length&&e===i)return"";let o=e.length-1,a=-1;for(n=i.length-1;n>=0;--n){let l=i.charCodeAt(n);if(l===47){if(!s){t=n+1;break}}else a===-1&&(s=!1,a=n+1),o>=0&&(l===e.charCodeAt(o)?--o===-1&&(r=n):(o=-1,r=a))}return t===r?r=a:r===-1&&(r=i.length),i.slice(t,r)}for(n=i.length-1;n>=0;--n)if(i.charCodeAt(n)===47){if(!s){t=n+1;break}}else r===-1&&(s=!1,r=n+1);return r===-1?"":i.slice(t,r)},extname(i){Ws(i),i=x2(this.toPosix(i));let e=-1,t=0,r=-1,s=!0,n=0;for(let o=i.length-1;o>=0;--o){let a=i.charCodeAt(o);if(a===47){if(!s){t=o+1;break}continue}r===-1&&(s=!1,r=o+1),a===46?e===-1?e=o:n!==1&&(n=1):e!==-1&&(n=-1)}return e===-1||r===-1||n===0||n===1&&e===r-1&&e===t+1?"":i.slice(e,r)},parse(i){Ws(i);let e={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return e;i=x2(this.toPosix(i));let t=i.charCodeAt(0),r=this.isAbsolute(i),s,n="";e.root=this.rootname(i),r||this.hasProtocol(i)?s=1:s=0;let o=-1,a=0,l=-1,c=!0,u=i.length-1,h=0;for(;u>=s;--u){if(t=i.charCodeAt(u),t===47){if(!c){a=u+1;break}continue}l===-1&&(c=!1,l=u+1),t===46?o===-1?o=u:h!==1&&(h=1):o!==-1&&(h=-1)}return o===-1||l===-1||h===0||h===1&&o===l-1&&o===a+1?l!==-1&&(a===0&&r?e.base=e.name=i.slice(1,l):e.base=e.name=i.slice(a,l)):(a===0&&r?(e.name=i.slice(1,o),e.base=i.slice(1,l)):(e.name=i.slice(a,o),e.base=i.slice(a,l)),e.ext=i.slice(o,l)),e.dir=this.dirname(i),n&&(e.dir=n+e.dir),e},sep:"/",delimiter:":",joinExtensions:[".html"]};var br=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(br||{}),V9=(i=>(i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS",i))(V9||{}),ch=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(ch||{}),Le=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(Le||{}),Fr=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(Fr||{}),le=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(le||{}),oo=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(oo||{}),Se=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(Se||{}),Ee=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(Ee||{}),Xi=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(Xi||{}),Lr=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(Lr||{}),bi=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(bi||{}),jt=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(jt||{}),es=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(es||{}),uh=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(uh||{}),wr=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(wr||{}),fi=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(fi||{});var bt=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(bt||{}),Or=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(Or||{});var v2;function Zb(){return fe(this,null,function*(){return v2!=null||(v2=fe(this,null,function*(){var n;let i=document.createElement("canvas").getContext("webgl");if(!i)return jt.UNPACK;let e=yield new Promise(o=>{let a=document.createElement("video");a.onloadeddata=()=>o(a),a.onerror=()=>o(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!e)return jt.UNPACK;let t=i.createTexture();i.bindTexture(i.TEXTURE_2D,t);let r=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,r),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e);let s=new Uint8Array(4);return i.readPixels(0,0,1,1,i.RGBA,i.UNSIGNED_BYTE,s),i.deleteFramebuffer(r),i.deleteTexture(t),(n=i.getExtension("WEBGL_lose_context"))==null||n.loseContext(),s[0]<=s[3]?jt.PMA:jt.UNPACK})),v2})}function Jb(){je("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function ew(){je("7.0.0",`sayHello is deprecated, please use Renderer's "hello" option`)}var W9;function hh(){return typeof W9>"u"&&(W9=function(){var e;let i={stencil:!0,failIfMajorPerformanceCaveat:te.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!te.ADAPTER.getWebGLRenderingContext())return!1;let t=te.ADAPTER.createCanvas(),r=t.getContext("webgl",i)||t.getContext("experimental-webgl",i),s=!!((e=r==null?void 0:r.getContextAttributes())!=null&&e.stencil);if(r){let n=r.getExtension("WEBGL_lose_context");n&&n.loseContext()}return r=null,s}catch(t){return!1}}()),W9}var QN={grad:.9,turn:360,rad:360/(2*Math.PI)},ao=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},Ni=function(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*i)/t+0},Es=function(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),i>t?t:i>e?i:e},lw=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},tw=function(i){return{r:Es(i.r,0,255),g:Es(i.g,0,255),b:Es(i.b,0,255),a:Es(i.a)}},X9=function(i){return{r:Ni(i.r),g:Ni(i.g),b:Ni(i.b),a:Ni(i.a,3)}},YN=/^#([0-9a-f]{3,8})$/i,dh=function(i){var e=i.toString(16);return e.length<2?"0"+e:e},cw=function(i){var e=i.r,t=i.g,r=i.b,s=i.a,n=Math.max(e,t,r),o=n-Math.min(e,t,r),a=o?n===e?(t-r)/o:n===t?2+(r-e)/o:4+(e-t)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:s}},uw=function(i){var e=i.h,t=i.s,r=i.v,s=i.a;e=e/360*6,t/=100,r/=100;var n=Math.floor(e),o=r*(1-t),a=r*(1-(e-n)*t),l=r*(1-(1-e+n)*t),c=n%6;return{r:255*[r,a,o,o,l,r][c],g:255*[l,r,r,a,o,o][c],b:255*[o,o,l,r,r,a][c],a:s}},iw=function(i){return{h:lw(i.h),s:Es(i.s,0,100),l:Es(i.l,0,100),a:Es(i.a)}},rw=function(i){return{h:Ni(i.h),s:Ni(i.s),l:Ni(i.l),a:Ni(i.a,3)}},sw=function(i){return uw((t=(e=i).s,{h:e.h,s:(t*=((r=e.l)<50?r:100-r)/100)>0?2*t/(r+t)*100:0,v:r+t,a:e.a}));var e,t,r},_2=function(i){return{h:(e=cw(i)).h,s:(s=(200-(t=e.s))*(r=e.v)/100)>0&&s<200?t*r/100/(s<=100?s:200-s)*100:0,l:s/2,a:e.a};var e,t,r,s},KN=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ZN=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,JN=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,eF=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Y9={string:[[function(i){var e=YN.exec(i);return e?(i=e[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?Ni(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?Ni(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var e=JN.exec(i)||eF.exec(i);return e?e[2]!==e[4]||e[4]!==e[6]?null:tw({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(i){var e=KN.exec(i)||ZN.exec(i);if(!e)return null;var t,r,s=iw({h:(t=e[1],r=e[2],r===void 0&&(r="deg"),Number(t)*(QN[r]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return sw(s)},"hsl"]],object:[[function(i){var e=i.r,t=i.g,r=i.b,s=i.a,n=s===void 0?1:s;return ao(e)&&ao(t)&&ao(r)?tw({r:Number(e),g:Number(t),b:Number(r),a:Number(n)}):null},"rgb"],[function(i){var e=i.h,t=i.s,r=i.l,s=i.a,n=s===void 0?1:s;if(!ao(e)||!ao(t)||!ao(r))return null;var o=iw({h:Number(e),s:Number(t),l:Number(r),a:Number(n)});return sw(o)},"hsl"],[function(i){var e=i.h,t=i.s,r=i.v,s=i.a,n=s===void 0?1:s;if(!ao(e)||!ao(t)||!ao(r))return null;var o=function(a){return{h:lw(a.h),s:Es(a.s,0,100),v:Es(a.v,0,100),a:Es(a.a)}}({h:Number(e),s:Number(t),v:Number(r),a:Number(n)});return uw(o)},"hsv"]]},nw=function(i,e){for(var t=0;t<e.length;t++){var r=e[t][0](i);if(r)return[r,e[t][1]]}return[null,void 0]},tF=function(i){return typeof i=="string"?nw(i.trim(),Y9.string):typeof i=="object"&&i!==null?nw(i,Y9.object):[null,void 0]};var q9=function(i,e){var t=_2(i);return{h:t.h,s:Es(t.s+100*e,0,100),l:t.l,a:t.a}},Q9=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},ow=function(i,e){var t=_2(i);return{h:t.h,s:t.s,l:Es(t.l+100*e,0,100),a:t.a}},K9=function(){function i(e){this.parsed=tF(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return Ni(Q9(this.rgba),2)},i.prototype.isDark=function(){return Q9(this.rgba)<.5},i.prototype.isLight=function(){return Q9(this.rgba)>=.5},i.prototype.toHex=function(){return e=X9(this.rgba),t=e.r,r=e.g,s=e.b,o=(n=e.a)<1?dh(Ni(255*n)):"","#"+dh(t)+dh(r)+dh(s)+o;var e,t,r,s,n,o},i.prototype.toRgb=function(){return X9(this.rgba)},i.prototype.toRgbString=function(){return e=X9(this.rgba),t=e.r,r=e.g,s=e.b,(n=e.a)<1?"rgba("+t+", "+r+", "+s+", "+n+")":"rgb("+t+", "+r+", "+s+")";var e,t,r,s,n},i.prototype.toHsl=function(){return rw(_2(this.rgba))},i.prototype.toHslString=function(){return e=rw(_2(this.rgba)),t=e.h,r=e.s,s=e.l,(n=e.a)<1?"hsla("+t+", "+r+"%, "+s+"%, "+n+")":"hsl("+t+", "+r+"%, "+s+"%)";var e,t,r,s,n},i.prototype.toHsv=function(){return e=cw(this.rgba),{h:Ni(e.h),s:Ni(e.s),v:Ni(e.v),a:Ni(e.a,3)};var e},i.prototype.invert=function(){return Xs({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},i.prototype.saturate=function(e){return e===void 0&&(e=.1),Xs(q9(this.rgba,e))},i.prototype.desaturate=function(e){return e===void 0&&(e=.1),Xs(q9(this.rgba,-e))},i.prototype.grayscale=function(){return Xs(q9(this.rgba,-1))},i.prototype.lighten=function(e){return e===void 0&&(e=.1),Xs(ow(this.rgba,e))},i.prototype.darken=function(e){return e===void 0&&(e=.1),Xs(ow(this.rgba,-e))},i.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},i.prototype.alpha=function(e){return typeof e=="number"?Xs({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):Ni(this.rgba.a,3);var t},i.prototype.hue=function(e){var t=_2(this.rgba);return typeof e=="number"?Xs({h:e,s:t.s,l:t.l,a:t.a}):Ni(t.h)},i.prototype.isEqual=function(e){return this.toHex()===Xs(e).toHex()},i}(),Xs=function(i){return i instanceof K9?i:new K9(i)},aw=[],hw=function(i){i.forEach(function(e){aw.indexOf(e)<0&&(e(K9,Y9),aw.push(e))})};function dw(i,e){var t={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var s in t)r[t[s]]=s;var n={};i.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,c=r[this.toHex()];if(c)return c;if(o!=null&&o.closest){var u=this.toRgb(),h=1/0,d="black";if(!n.length)for(var f in t)n[f]=new i(t[f]).toRgb();for(var p in t){var m=(a=u,l=n[p],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));m<h&&(h=m,d=p)}return d}},e.string.push([function(o){var a=o.toLowerCase(),l=a==="transparent"?"#0000":t[a];return l?new i(l).toRgb():null},"name"])}hw([dw]);var B1=class fh{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof fh)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?Ne({},e):e}isSourceEqual(e,t){let r=typeof e;if(r!==typeof t)return!1;if(r==="number"||r==="string"||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length!==t.length?!1:e.every((s,n)=>s===t[n]);if(e!==null&&t!==null){let s=Object.keys(e),n=Object.keys(t);return s.length!==n.length?!1:s.every(o=>e[o]===t[o])}return e===t}toRgba(){let[e,t,r,s]=this._components;return{r:e,g:t,b:r,a:s}}toRgb(){let[e,t,r]=this._components;return{r:e,g:t,b:r}}toRgbaString(){let[e,t,r]=this.toUint8RgbArray();return`rgba(${e},${t},${r},${this.alpha})`}toUint8RgbArray(e){let[t,r,s]=this._components;return e=e!=null?e:[],e[0]=Math.round(t*255),e[1]=Math.round(r*255),e[2]=Math.round(s*255),e}toRgbArray(e){e=e!=null?e:[];let[t,r,s]=this._components;return e[0]=t,e[1]=r,e[2]=s,e}toNumber(){return this._int}toLittleEndianNumber(){let e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){let[t,r,s,n]=fh.temp.setValue(e)._components;return this._components[0]*=t,this._components[1]*=r,this._components[2]*=s,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(e===1)return(255<<24)+this._int;if(e===0)return t?0:this._int;let r=this._int>>16&255,s=this._int>>8&255,n=this._int&255;return t&&(r=r*e+.5|0,s=s*e+.5|0,n=n*e+.5|0),(e*255<<24)+(r<<16)+(s<<8)+n}toHex(){let e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){let e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){let[t,r,s]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(r*e)/e,this._components[2]=Math.round(s*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e!=null?e:[];let[t,r,s,n]=this._components;return e[0]=t,e[1]=r,e[2]=s,e[3]=n,e}normalize(e){let t,r,s,n;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){let o=e;t=(o>>16&255)/255,r=(o>>8&255)/255,s=(o&255)/255,n=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[t,r,s,n=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[t,r,s,n=255]=e,t/=255,r/=255,s/=255,n/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){let a=fh.HEX_PATTERN.exec(e);a&&(e=`#${a[2]}`)}let o=Xs(e);o.isValid()&&({r:t,g:r,b:s,a:n}=o.rgba,t/=255,r/=255,s/=255)}if(t!==void 0)this._components[0]=t,this._components[1]=r,this._components[2]=s,this._components[3]=n,this.refreshInt();else throw new Error(`Unable to convert color ${e}`)}refreshInt(){this._clamp(this._components);let[e,t,r]=this._components;this._int=(e*255<<16)+(t*255<<8)+(r*255|0)}_clamp(e,t=0,r=1){return typeof e=="number"?Math.min(Math.max(e,t),r):(e.forEach((s,n)=>{e[n]=Math.min(Math.max(s,t),r)}),e)}};B1.shared=new B1,B1.temp=new B1,B1.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;var we=B1;function fw(i,e=[]){return je("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),we.shared.setValue(i).toRgbArray(e)}function pw(i){return je("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),we.shared.setValue(i).toHex()}function mw(i){return je("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),we.shared.setValue(i).toNumber()}function gw(i){return je("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),we.shared.setValue(i).toNumber()}function iF(){let i=[],e=[];for(let r=0;r<32;r++)i[r]=r,e[r]=r;i[Le.NORMAL_NPM]=Le.NORMAL,i[Le.ADD_NPM]=Le.ADD,i[Le.SCREEN_NPM]=Le.SCREEN,e[Le.NORMAL]=Le.NORMAL_NPM,e[Le.ADD]=Le.ADD_NPM,e[Le.SCREEN]=Le.SCREEN_NPM;let t=[];return t.push(e),t.push(i),t}var b2=iF();function yw(i,e){return b2[e?1:0][i]}function xw(i,e,t,r=!0){return je("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),we.shared.setValue(i).premultiply(e,r).toArray(t!=null?t:new Float32Array(4))}function vw(i,e){return je("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),we.shared.setValue(i).toPremultiplied(e)}function _w(i,e,t,r=!0){return je("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),we.shared.setValue(i).premultiply(e,r).toArray(t!=null?t:new Float32Array(4))}var ph=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function bw(i,e=null){let t=i*6;if(e=e||new Uint16Array(t),e.length!==t)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${t}`);for(let r=0,s=0;r<t;r+=6,s+=4)e[r+0]=s+0,e[r+1]=s+1,e[r+2]=s+2,e[r+3]=s+0,e[r+4]=s+2,e[r+5]=s+3;return e}function Zo(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}var rF={Float32Array,Uint32Array,Int32Array,Uint8Array};function ww(i,e){let t=0,r=0,s={};for(let l=0;l<i.length;l++)r+=e[l],t+=i[l].length;let n=new ArrayBuffer(t*4),o=null,a=0;for(let l=0;l<i.length;l++){let c=e[l],u=i[l],h=Zo(u);s[h]||(s[h]=new rF[h](n)),o=s[h];for(let d=0;d<u.length;d++){let f=(d/c|0)*r+a,p=d%c;o[f+p]=u[d]}a+=c}return new Float32Array(n)}function Jo(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function w2(i){return!(i&i-1)&&!!i}function E2(i){let e=(i>65535?1:0)<<4;i>>>=e;let t=(i>255?1:0)<<3;return i>>>=t,e|=t,t=(i>15?1:0)<<2,i>>>=t,e|=t,t=(i>3?1:0)<<1,i>>>=t,e|=t,e|i>>1}function mh(i,e,t){let r=i.length,s;if(e>=r||t===0)return;t=e+t>r?r-e:t;let n=r-t;for(s=e;s<n;++s)i[s]=i[s+t];i.length=n}function Ew(i){return i===0?0:i<0?-1:1}var sF=0;function An(){return++sF}var Z9=class{constructor(i,e,t,r){this.left=i,this.top=e,this.right=t,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};Z9.EMPTY=new Z9(0,0,0,0);var A2=Z9;var S2={},Fi=Object.create(null),Er=Object.create(null);function Aw(){let i;for(i in Fi)Fi[i].destroy();for(i in Er)Er[i].destroy()}function Sw(){let i;for(i in Fi)delete Fi[i];for(i in Er)delete Er[i]}var gh=class{constructor(e,t,r){this._canvas=te.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||te.RESOLUTION,this.resize(e,t)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,t){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(t*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}};function Cw(i,e,t){for(let r=0,s=4*t*e;r<e;++r,s+=4)if(i[s+3]!==0)return!1;return!0}function kw(i,e,t,r,s){let n=4*e;for(let o=r,a=r*n+4*t;o<=s;++o,a+=n)if(i[a+3]!==0)return!1;return!0}function yh(i){let{width:e,height:t}=i,r=i.getContext("2d",{willReadFrequently:!0});if(r===null)throw new TypeError("Failed to get canvas 2D context");let s=r.getImageData(0,0,e,t).data,n=0,o=0,a=e-1,l=t-1;for(;o<t&&Cw(s,e,o);)++o;if(o===t)return A2.EMPTY;for(;Cw(s,e,l);)--l;for(;kw(s,e,n,o,l);)++n;for(;kw(s,e,a,o,l);)--a;return++a,++l,new A2(n,o,a,l)}function Tw(i){let e=yh(i),{width:t,height:r}=e,s=null;if(!e.isEmpty()){let n=i.getContext("2d");if(n===null)throw new TypeError("Failed to get canvas 2D context");s=n.getImageData(e.left,e.top,t,r)}return{width:t,height:r,data:s}}function Iw(i){let e=ph.exec(i);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}}function xh(i,e=globalThis.location){if(i.startsWith("data:"))return"";e=e||globalThis.location;let t=new URL(i,document.baseURI);return t.hostname!==e.hostname||t.port!==e.port||t.protocol!==e.protocol?"anonymous":""}function C2(i,e=1){var r;let t=(r=te.RETINA_PREFIX)==null?void 0:r.exec(i);return t?parseFloat(t[1]):e}var mi=class extends pi.default{constructor(e){super(),this.context=e,this.id="",this._enabled=!1}enable(){this._enabled||(this._enabled=!0)}disable(){this._enabled&&(this._enabled=!1)}get enabled(){return this._enabled}_getEventData(e){var n,o;let t={id:(o=(n=e.pointerId)!=null?n:e.pointerType)!=null?o:"unknown",event:e,originalEvent:e.originalEvent,coord:[e.global.x,e.global.y],time:e.timeStamp,isCancelled:!1,target:null};if(!e.target)return t;let r=e.target,s=r==null?void 0:r.__feature__;return s?(t.target={displayObject:r,feature:s,featureID:s.id,layer:s.layer,layerID:s.layer.id,data:s.data,dataID:s.dataID},t):(r=e.target.parent,s=r==null?void 0:r.__feature__,s?(t.target={displayObject:r,feature:s,featureID:s.id,layer:s.layer,layerID:s.layer.id,data:s.data,dataID:s.dataID},t):(t.target={displayObject:e.target,feature:null,featureID:null,layer:null,layerID:null,data:null,dataID:null},t))}};var nF=1,oF=4,k2=class extends mi{constructor(e){super(e),this.id="drag",this.dragTarget=null,this.lastDown=null,this.lastMove=null,this._doMove=this._doMove.bind(this),this._pointercancel=this._pointercancel.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.lastDown=null,this.lastMove=null,this.dragTarget=null;let e=this.context.systems.map.renderer.events;e.on("modifierchange",this._doMove),e.on("pointerover",this._doMove),e.on("pointerout",this._doMove),e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup),e.on("pointercancel",this._pointercancel)}disable(){if(!this._enabled)return;let e=this.lastMove;e&&this.dragTarget&&(e.target=null,this.dragTarget.feature.active=!1,this.emit("cancel",e)),this._enabled=!1,this.lastDown=null,this.lastMove=null,this.dragTarget=null;let t=this.context.systems.map.renderer.events;t.off("modifierchange",this._doMove),t.off("pointerover",this._doMove),t.off("pointerout",this._doMove),t.off("pointerdown",this._pointerdown),t.off("pointermove",this._pointermove),t.off("pointerup",this._pointerup),t.off("pointercancel",this._pointercancel)}_pointerdown(e){var o,a,l,c;if(this.lastDown||e.pointerType==="mouse"&&e.button!==0)return;let t=this._getEventData(e),r=((o=t.target)==null?void 0:o.data)instanceof Be,s=((l=(a=t.target)==null?void 0:a.data)==null?void 0:l.type)==="midpoint";(r||s)&&((c=t.target)==null?void 0:c.layerID)==="osm"&&(this.lastDown=t,this.lastMove=null,this.dragTarget=null)}_pointermove(e){let t=this.context,s=t.systems.editor.staging.graph,n=t.systems.map;if(n.supersurface.select(".edit-menu").size()){this._pointercancel(e);return}if(!n.renderer.events.pointerOverRenderer)return;let l=this.lastDown,c=this._getEventData(e);if(!(!l||l.id!==c.id)){if(this.lastMove=c,this.dragTarget)this._doMove();else if(l.target){let u=Ue(l.coord,c.coord),h=e.pointerType==="pen"?oF:nF;if(u>=h){let d=Object.assign({},l.target);this.dragTarget=d,d.feature.active=!0;let f=d.data,p=f.type==="midpoint",m=p?[f.way]:s.parentWays(f),g=new Set;for(let _ of m){g.add(_.id);for(let w of s.parentRelations(_))g.add(w.id)}let y=t.selectedIDs(),b=y.some(_=>g.has(_))?y.slice():[];if(p){let _={loc:f.loc,edge:[f.a.id,f.b.id]};t.enter("drag-node",{midpoint:_,reselectIDs:b})}else t.enter("drag-node",{nodeID:f.id,reselectIDs:b});this.emit("start",l)}}}}_pointerup(e){let t=this.lastDown,r=this._getEventData(e);!t||t.id!==r.id||(this.dragTarget&&(this._snappingDisabled()?r.target=null:r.target=Object.assign({},r.target)),this.lastDown=null,this.lastMove=null,this.dragTarget&&(this.dragTarget.feature.active=!1,this.dragTarget=null,this.emit("end",r)))}_pointercancel(e){let t=this._getEventData(e);this.lastDown=null,this.lastMove=null,this.dragTarget&&(this.dragTarget.feature.active=!1,this.dragTarget=null,this.emit("cancel",t))}_snappingDisabled(){let e=this.context.systems.map.renderer.events;if(!e.pointerOverRenderer)return!1;let t=e.modifierKeys;return t.has("Alt")||t.has("Control")||t.has("Meta")}_doMove(){if(!this._enabled||!this.lastMove)return;let e=Object.assign({},this.lastMove);this._snappingDisabled()&&(e.target=null),this.emit("move",e)}};var Pw=4,Dw=12,T2=class extends mi{constructor(e){super(e),this.id="draw",this._spaceClickDisabled=!1,this.lastDown=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._doClick=this._doClick.bind(this),this._doMove=this._doMove.bind(this),this._keydown=this._keydown.bind(this),this._keyup=this._keyup.bind(this),this._pointercancel=this._pointercancel.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.lastDown=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._spaceClickDisabled=!1;let e=this.context.systems.map.renderer.events;e.on("keydown",this._keydown),e.on("keyup",this._keyup),e.on("modifierchange",this._doMove),e.on("pointerover",this._doMove),e.on("pointerout",this._doMove),e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup),e.on("pointercancel",this._pointercancel)}disable(){if(!this._enabled)return;this._enabled=!1,this.lastDown=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._spaceClickDisabled=!1;let e=this.context.systems.map.renderer.events;e.off("keydown",this._keydown),e.off("keyup",this._keyup),e.off("modifierchange",this._doMove),e.off("pointerover",this._doMove),e.off("pointerout",this._doMove),e.off("pointerdown",this._pointerdown),e.off("pointermove",this._pointermove),e.off("pointerup",this._pointerup),e.off("pointercancel",this._pointercancel)}_keydown(e){["Enter","Escape","Esc"].includes(e.key)?(e.preventDefault(),this.emit("finish")):["Backspace","Delete","Del"].includes(e.key)?(e.preventDefault(),this.emit("cancel")):!this._spaceClickDisabled&&[" ","Spacebar"].includes(e.key)&&(e.preventDefault(),e.stopPropagation(),this._spacebar())}_keyup(e){this._spaceClickDisabled&&[" ","Spacebar"].includes(e.key)&&(e.preventDefault(),e.stopPropagation(),this._spaceClickDisabled=!1)}_pointerdown(e){if(this.lastDown)return;let t=this._getEventData(e);this.lastDown=t,this.lastClick=null,this.emit("down",t)}_pointermove(e){let t=this._getEventData(e);this.lastMove=t,this._spaceClickDisabled&&this.lastSpace&&Ue(t.coord,this.lastSpace.coord)>Dw&&(this._spaceClickDisabled=!1);let r=this.lastDown;r&&!r.isCancelled&&r.id===t.id&&Ue(r.coord,t.coord)>=Pw&&(r.isCancelled=!0),this._doMove()}_pointerup(e){let t=this.lastDown,r=this._getEventData(e);if(!t||t.id!==r.id||(this.lastDown=null,t.isCancelled))return;let s=Ue(t.coord,r.coord);(s<Pw||s<Dw&&r.time-t.time<500)&&(this.lastClick=r,this._doClick())}_pointercancel(){this.lastDown=null}_spacebar(){this._spaceClickDisabled||this.lastMove&&(this._spaceClickDisabled=!0,this.lastSpace=this.lastMove,this.lastClick=this.lastMove,this._doClick())}_doMove(){if(!this._enabled||!this.lastMove)return;let t=this.context.systems.map.renderer.events;if(!t.pointerOverRenderer)return;let r=t.modifierKeys,s=r.has("Alt")||r.has("Control")||r.has("Meta"),n=Object.assign({},this.lastMove);(s||!1)&&(n.target=null),this.emit("move",n)}_doClick(){if(!this._enabled||!this.lastClick)return;let r=this.context.systems.map.renderer.events.modifierKeys,s=r.has("Alt")||r.has("Control")||r.has("Meta"),n=Object.assign({},this.lastClick);(s||!1)&&(n.target=null),this.emit("click",n)}};var I2=class extends mi{constructor(e){super(e),this.id="hover",this.lastMove=null,this.hoverTarget=null,this._doHover=this._doHover.bind(this),this._pointermove=this._pointermove.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.lastMove=null,this.hoverTarget=null;let e=this.context.systems.map.renderer.events;e.on("modifierchange",this._doHover),e.on("pointerover",this._doHover),e.on("pointerout",this._doHover),e.on("pointermove",this._pointermove)}disable(){if(!this._enabled)return;let e=this.lastMove;this.hoverTarget&&e&&(e.target=null,this._doHover()),this._enabled=!1,this.lastMove=null,this.hoverTarget=null;let t=this.context.systems.map.renderer.events;t.off("modifierchange",this._doHover),t.off("pointerover",this._doHover),t.off("pointerout",this._doHover),t.off("pointermove",this._pointermove)}_pointermove(e){this._enabled&&(this.lastMove=this._getEventData(e),this._doHover())}_doHover(){var u,h;if(!this._enabled||!this.lastMove||this.context.behaviors["map-interaction"].gesture)return;let r=this.context.systems.map.renderer.events,s=r.modifierKeys,n=s.has("Alt")||s.has("Control")||s.has("Meta"),o=Object.assign({},this.lastMove);(n||!1||!r.pointerOverRenderer)&&(o.target=null);let l=((u=this.hoverTarget)==null?void 0:u.featureID)||null,c=((h=o==null?void 0:o.target)==null?void 0:h.featureID)||null;l!==c&&(this.hoverTarget=Object.assign({},o.target),this.emit("hoverchange",o))}};var ht=class extends mi{constructor(e,t){super(e),this.id=`key-${t.id}`,this._operation=t,window.mocha||(this._keybinding=this.context.keybinding()),this._keydown=this._keydown.bind(this)}enable(){if(this._enabled)return;let e=this._operation;e.available()&&e.keys&&(this._keybinding.on(e.keys,this._keydown),this._enabled=!0)}disable(){if(!this._enabled)return;this._enabled=!1;let e=this._operation;e.keys&&this._keybinding.off(e.keys)}_keydown(e){let t=this.context,r=this._operation;if(r.availableForKeypress&&!r.availableForKeypress())return;e.preventDefault(),r.disabled()?t.systems.ui.flash.duration(4e3).iconName(`#rapid-operation-${r.id}`).iconClass("operation disabled").label(r.tooltip)():(t.systems.ui.flash.duration(2e3).iconName(`#rapid-operation-${r.id}`).iconClass("operation").label(r.annotation()||r.title)(),r.point&&r.point(null),r())}};var M2=class extends mi{constructor(e){super(e),this.id="lasso",this._lassoing=!1,this._extent=null,this._coords=[],this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this._lassoing=!1,this._extent=null;let t=this.context.systems.map.renderer.events;t.on("pointerdown",this._pointerdown),t.on("pointermove",this._pointermove),t.on("pointerup",this._pointerup)}disable(){if(!this._enabled)return;this._enabled=!1,this._lassoing=!1,this._extent=null;let t=this.context.systems.map.renderer.events;t.off("pointerdown",this._pointerdown),t.off("pointermove",this._pointermove),t.off("pointerup",this._pointerup)}_pointerdown(){let e=this.context.systems.map,t=e.renderer.events;if(!t.pointerOverRenderer)return;if(t.modifierKeys.has("Shift")){this._lassoing=!0;let n=e.mouseLoc();this._extent=new ie(n),this._coords.push(n)}}_pointermove(){if(!this._lassoing)return;let e=this.context.systems.map;if(!e.renderer.events.pointerOverRenderer)return;let r=e.mouseLoc();this._extent=this._extent.extend(new ie(r)),this._coords.push(r);let s=e.scene.layers.get("map-ui");s.lassoPolygonData=this._coords,e.immediateRedraw()}_pointerup(){if(!this._lassoing)return;this._lassoing=!1;let t=this.context.systems.map.scene.layers.get("map-ui"),r=this._lassoed();this._coords=[],t.lassoPolygonData=this._coords,this._extent=null,r.length&&this.context.enter("select-osm",{selection:{osm:r}})}_normalize(e,t){return[[Math.min(e[0],t[0]),Math.min(e[1],t[1])],[Math.max(e[0],t[0]),Math.max(e[1],t[1])]]}_lassoed(){let e=this.context,t=e.systems.editor,r=e.systems.locations,s=e.systems.filters,n=t.staging.graph;if(!this.context.editable())return[];let o=this._coords,a=t.intersects(this._extent).filter(l=>l.type==="node"&&t1(l.loc,o)&&!s.isHidden(l,n,l.geometry(n))&&!r.blocksAt(l.loc).length);return a.sort(function(l,c){let u=n.parentWays(l),h=n.parentWays(c);if(u.length&&h.length){let d=Vi(u,h);if(d.length){let f=d[0].nodes;return f.indexOf(l.id)-f.indexOf(c.id)}else return parseFloat(u[0].id.slice(1))-parseFloat(h[0].id.slice(1))}else if(u.length||h.length)return u.length-h.length;return l.loc[0]-c.loc[0]}),a.map(l=>l.id)}};var Fw=256,aF=2,lF=24,Rw=Ti(aF,Fw),Nw=Ti(lF,Fw),cF=1,uF=4,P2=class extends mi{constructor(e){super(e),this.id="map-interaction",this.lastDown=null,this.gesture=null,this.doubleClickEnabled=!0,this._click=this._click.bind(this),this._keydown=this._keydown.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this),this._pointercancel=this._pointercancel.bind(this),this._wheel=this._wheel.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.lastDown=null,this.gesture=null;let e=this.context.systems.map.renderer.events;e.on("click",this._click),e.on("keydown",this._keydown),e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup),e.on("pointercancel",this._pointercancel),e.on("wheel",this._wheel)}disable(){if(!this._enabled)return;this._enabled=!1,this.lastDown=null,this.gesture=null;let e=this.context.systems.map.renderer.events;e.off("click",this._click),e.off("keydown",this._keydown),e.off("pointerdown",this._pointerdown),e.off("pointermove",this._pointermove),e.off("pointerup",this._pointerup),e.off("pointercancel",this._pointercancel),e.off("wheel",this._wheel)}_keydown(e){var o,a,l;if(((a=(o=document.activeElement)==null?void 0:o.tagName)!=null?a:"BODY")!=="BODY"||this.context.services.mapillary.viewerShowing)return;let r=this.context,s=r.systems.map,n=100;if(!e.shiftKey){let[u,h]=s.dimensions,d=e.altKey||e.metaKey||e.ctrlKey,f;((l=r.mode)==null?void 0:l.id)!=="select-osm"&&(e.key==="ArrowLeft"?f=d?[u/2,0]:[80,0]:e.key==="ArrowRight"?f=d?[-u/2,0]:[-80,0]:e.key==="ArrowUp"?f=d?[0,h/2]:[0,80]:e.key==="ArrowDown"&&(f=d?[0,-h/2]:[0,-80])),f&&(e.preventDefault(),s.pan(f,n))}}_click(e){if(!this.doubleClickEnabled||e.detail!==2||e.pointerType==="mouse"&&e.button!==0)return;function t(h,d,f){return Math.max(d,Math.min(h,f))}let[r,s]=[e.global.x,e.global.y],n=this.context.projection.transform(),o=e.getModifierState("Shift"),a=[(r-n.x)/n.k,(s-n.y)/n.k],l=n.k*(o?.5:2);l=t(l,Rw,Nw);let c=r-a[0]*l,u=s-a[1]*l;this.context.systems.map.transformEase({x:c,y:u,k:l})}_pointerdown(e){var o,a;if(this.lastDown)return;let t=this.context.systems.map.renderer.events;if(t.modifierKeys.has("Shift"))return;let r=this._getEventData(e);if(((o=r.target)==null?void 0:o.data)instanceof Be&&((a=r.target)==null?void 0:a.layerID)==="osm"&&e.pointerType==="mouse"&&e.button===0)return;this.lastDown=r,this.gesture=null;let n=this.context.mode.id;n==="draw-area"||n==="draw-line"?t.setCursor("crosshair"):t.setCursor("grabbing")}_pointermove(e){let t=this.lastDown,r=this._getEventData(e);if(!(!t||t.id!==r.id)){if(!this.gesture){let s=Ue(t.coord,r.coord),n=t.originalEvent.pointerType==="pen"?uF:cF;this.was=[r.originalEvent.clientX,r.originalEvent.clientY],s>=n&&(this.gesture="pan")}if(this.gesture==="pan"){let s=r.originalEvent,n=this.context.projection.transform(),o=s.clientX-this.was[0],a=s.clientY-this.was[1];this.was=[s.clientX,s.clientY];let l={x:n.x+o,y:n.y+a,k:n.k};this.context.systems.map.transform(l)}}}_pointerup(e){let t=this.lastDown,r=this._getEventData(e);if(!t||t.id!==r.id)return;this.lastDown=null,this.gesture=null;let s=this.context.systems.map.renderer.events,n=this.context.mode.id;n==="draw-area"||n==="draw-line"?s.setCursor("crosshair"):s.setCursor("grab")}_pointercancel(){this.lastDown=null,this.gesture=null}_wheel(e){let[t,r]=[e.offsetX,e.offsetY],[s,n]=[e._normalizedDeltaX,e._normalizedDeltaY],o=this.context.projection.transform(),a;function l(c,u,h){return Math.max(u,Math.min(c,h))}if(e._gesture==="zoom"){let c=(t-o.x)/o.k,u=(r-o.y)/o.k,h=o.k*Math.pow(2,-n/500);h=l(h,Rw,Nw);let d=t-c*h,f=r-u*h;a={x:d,y:f,k:h}}else a={x:o.x-s,y:o.y-n,k:o.k};this.context.systems.map.transform(a)}};var Lw=.1,D2=class extends mi{constructor(e){super(e),this.id="map-nudging",this._pointermove=this._pointermove.bind(this)}enable(){if(this._enabled)return;this.context.systems.map.renderer.events.on("pointermove",this._pointermove)}allow(){this._enabled=!0}disable(){if(!this._enabled)return;this._enabled=!1,this.context.systems.map.renderer.events.off("pointermove",this._pointermove)}_pointermove(e){if(!this._enabled)return;let t=[e.global.x,e.global.y],r=T5(t,this.context.systems.map.dimensions);if(r){let[s,n]=[r[0]*Lw,r[1]*Lw],o=this.context.projection.transform(),a={x:o.x+s,y:o.y+n,k:o.k};this.context.systems.map.transform(a)}}};var R2=class extends mi{constructor(e){super(e),this.id="paste",this._isMacOS=ei().os==="mac",this._keydown=this._keydown.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.context.systems.map.renderer.events.on("keydown",this._keydown)}disable(){if(!this._enabled)return;this._enabled=!1,this.context.systems.map.renderer.events.off("keydown",this._keydown)}_keydown(e){let t=this._isMacOS;(t&&e.metaKey||!t&&e.ctrlKey)&&e.key==="v"&&this._doPaste(e)}_doPaste(e){let t=this.context,r=t.systems.editor,s=t.systems.l10n,n=t.systems.map,o=t.copyGraph,a=t.copyIDs;if(!a.length||!n.renderer.events.pointerOverRenderer)return;e.preventDefault(),e.stopPropagation();let c=u1(a,o);r.beginTransaction(),r.perform(c);let u=r.staging.graph,h=c.copies(),d=new Set;for(let _ of Object.values(h))d.add(_.id);let f=new ie,p=[];for(let[_,w]of Object.entries(h)){let A=o.entity(_);f=f.extend(A.extent(o)),u.parentWays(w).some(E=>d.has(E.id))||p.push(w.id)}let m=t.projection,g=t.copyLoc,y=g&&m.project(g)||m.project(f.center()),x=Ze(n.mouse(),y),b=s.t("operations.paste.annotation",{n:p.length});r.perform(_n(p,x,m)),r.commit({annotation:b,selectedIDs:p}),r.endTransaction(),t.enter("move",{selection:{osm:p}})}};var J9=4,Ow=12,N2=class extends mi{constructor(e){super(e),this.id="select",this._multiSelection=new Set,this._spaceClickDisabled=!1,this._longPressTimeout=null,this._showsMenu=!1,this.lastDown=null,this.lastUp=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._cancelLongPress=this._cancelLongPress.bind(this),this._doLongPress=this._doLongPress.bind(this),this._keydown=this._keydown.bind(this),this._keyup=this._keyup.bind(this),this._pointercancel=this._pointercancel.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this._multiSelection.clear(),this._spaceClickDisabled=!1,this._longPressTimeout=null,this._showsMenu=!1,this.lastDown=null,this.lastUp=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null;let e=this.context.systems.map.renderer.events;e.on("keydown",this._keydown),e.on("keyup",this._keyup),e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup),e.on("pointercancel",this._pointercancel)}disable(){if(!this._enabled)return;this._enabled=!1,this._multiSelection.clear(),this._spaceClickDisabled=!1,this._longPressTimeout=null,this._showsMenu=!1,this.lastDown=null,this.lastUp=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._cancelLongPress();let e=this.context.systems.map.renderer.events;e.off("keydown",this._keydown),e.off("keyup",this._keyup),e.off("pointerdown",this._pointerdown),e.off("pointermove",this._pointermove),e.off("pointerup",this._pointerup),e.off("pointercancel",this._pointercancel)}_keydown(e){if(this._cancelLongPress(),e.key==="ContextMenu"){e.preventDefault(),this._doContextMenu();return}else if(!this._spaceClickDisabled&&[" ","Spacebar"].includes(e.key)){let t=document.activeElement;if(t&&new Set(["INPUT","TEXTAREA"]).has(t.nodeName))return;e.preventDefault(),e.stopPropagation(),this._spacebar()}}_keyup(e){this._spaceClickDisabled&&[" ","Spacebar"].includes(e.key)&&(e.preventDefault(),e.stopPropagation(),this._spaceClickDisabled=!1)}_pointerdown(e){if(this.lastDown)return;this.context.systems.ui.closeEditMenu(),this._showsMenu=!1;let t=this._getEventData(e);this.lastDown=t,this.lastClick=null,this._cancelLongPress(),e.pointerType==="touch"&&(this._longPressTimeout=window.setTimeout(this._doLongPress,750,t))}_pointermove(e){let t=this._getEventData(e);this.lastMove=t,this._spaceClickDisabled&&this.lastSpace&&Ue(t.coord,this.lastSpace.coord)>Ow&&(this._spaceClickDisabled=!1);let r=this.lastDown;r&&!r.isCancelled&&r.id===t.id&&Ue(r.coord,t.coord)>=J9&&(r.isCancelled=!0)}_pointerup(e){var a,l,c,u,h;let t=this.lastDown,r=this._getEventData(e);if(!t||t.id!==r.id||(this.lastDown=null,t.isCancelled))return;let s=Ue(t.coord,r.coord),n=Ue(r.coord,this.lastUp?this.lastUp.coord:0);r.event.button===0&&((l=(a=this.lastUp)==null?void 0:a.target)!=null&&l.dataID)&&n<J9&&((u=(c=this.lastUp)==null?void 0:c.target)==null?void 0:u.dataID)===((h=r.target)==null?void 0:h.dataID)&&r.time-(this.lastUp?this.lastUp.time:0)<500?(this.lastClick=this.lastUp=r,this._doDoubleClick()):(s<J9||s<Ow&&r.time-t.time<500)&&(this.lastClick=this.lastUp=r,t.originalEvent.button===2?(this.context.selectedIDs().includes(t.target.dataID)||this._doSelect(),this._doContextMenu()):this._doSelect())}_pointercancel(){this.lastDown=null}_spacebar(){this._spaceClickDisabled||this.lastMove&&(this._spaceClickDisabled=!0,this.lastSpace=this.lastMove,this.lastClick=this.lastMove,this._doSelect())}_doSelect(){var u;if(!this._enabled||!this.lastClick)return;this._cancelLongPress();let e=this.context,r=e.systems.map.renderer.events.modifierKeys,s=r.has("Alt")||r.has("Control")||r.has("Meta"),n=r.has("Shift"),o=Object.assign({},this.lastClick);s&&(o.target=null);let a=o.target,l=a==null?void 0:a.data,c=a==null?void 0:a.dataID;if(l){let h=this.context.behaviors["map-interaction"];h.doubleClickEnabled=!1,window.setTimeout(()=>h.doubleClickEnabled=!0,500)}if((l==null?void 0:l.type)==="midpoint"&&(l=l.way,c=l.id),!l){e.systems.photos.selectPhoto(null),((u=e.mode)==null?void 0:u.id)!=="browse"&&!this._multiSelection.size&&e.enter("browse");return}if(l.__fbid__||l.__featurehash__||l instanceof _t||l instanceof ut){let h=new Map().set(c,l);e.enter("select",{selection:h});return}if(l instanceof de){let h=e.selectedIDs();n?h.includes(c)?this._showsMenu||(h=h.filter(d=>d!==c),e.enter("select-osm",{selection:{osm:h}})):(h.push(c),e.enter("select-osm",{selection:{osm:h}})):(!this._showsMenu||h.length<=1||!h.includes(c))&&e.enter("select-osm",{selection:{osm:[c]}})}if(l.captured_at){let h=a.layerID;e.systems.map.centerEase(l.loc),e.systems.photos.selectPhoto(h,c)}if(l.first_seen_at){let h=e.services.mapillary;if(!(h!=null&&h.started))return;e.systems.map.centerEase(event.loc);let d=h.getActiveImage()&&h.getActiveImage().id;h.getDetectionsAsync(c).then(f=>{if(!f.length)return;let p=f[0].image.id;e.systems.photos.selectPhoto("mapillary",p)})}}_cancelLongPress(){this._longPressTimeout&&(window.clearTimeout(this._longPressTimeout),this._longPressTimeout=null,this._showsMenu=!1)}_doLongPress(e){this._longPressTimeout=null,this.lastDown===e&&!e.isCancelled&&(this.lastClick=e,e.isCancelled=!0,this._doSelect(),this._doContextMenu())}_doDoubleClick(){var u;if(!this._enabled||!this.lastUp)return;let e=this.context,t=e.systems.editor,r=e.systems.l10n,s=this.lastUp.coord,n=(u=this.lastUp.target)==null?void 0:u.data,o=n instanceof pt&&!n.__fbid__,a=n.type==="midpoint",l,c;if(o){let h=t.staging.graph,d=e.projection,f=ti(h.childNodes(n),s,d);l=d.invert(s),c=[n.nodes[f.index-1],n.nodes[f.index]]}else a&&(l=n.loc,c=[n.a.id,n.b.id]);l&&c&&(t.perform(yi({loc:l,edge:c},Be())),t.commit({annotation:r.t("operations.add.annotation.vertex"),selectedIDs:e.selectedIDs()}))}_doContextMenu(){if(!this._enabled||!this.lastClick)return;let e=this.context,t=e.systems.map.renderer.events,r=e.systems.ui,s=t.modifierKeys,n=s.has("Alt")||s.has("Control")||s.has("Meta"),o=Object.assign({},this.lastClick);n&&(o.target=null),this._showsMenu?(r.closeEditMenu(),this._showsMenu=!1):(this._showsMenu=!0,r.showEditMenu(o.coord))}};var qs={available:new Map};qs.available.set("drag",k2);qs.available.set("draw",T2);qs.available.set("hover",I2);qs.available.set("lasso",M2);qs.available.set("map-interaction",P2);qs.available.set("map-nudging",D2);qs.available.set("paste",R2);qs.available.set("select",N2);var Ce=class extends pi.default{constructor(e){super(),this.context=e,this.id="",this.dependencies=new Set,this.autoStart=!0,this._started=!1,this._paused=!1}get started(){return this._started}get paused(){return this._paused}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}pause(){this._paused=!0}resume(){this._paused=!1}};var F2=class extends Ce{constructor(e){super(e),this.id="dataloader",this.dependencies=new Set;let t=new Map;if(t.set("address_formats","data/address_formats.min.json"),t.set("deprecated","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.6/dist/deprecated.min.json"),t.set("discarded","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.6/dist/discarded.min.json"),t.set("imagery","data/imagery.min.json"),t.set("intro_graph","data/intro_graph.min.json"),t.set("intro_rapid_graph","data/intro_rapid_graph.min.json"),t.set("keepRight","data/keepRight.min.json"),t.set("languages","data/languages.min.json"),t.set("locales","locales/index.min.json"),t.set("oci_defaults","https://cdn.jsdelivr.net/npm/osm-community-index@5.6/dist/defaults.min.json"),t.set("oci_features","https://cdn.jsdelivr.net/npm/osm-community-index@5.6/dist/featureCollection.min.json"),t.set("oci_resources","https://cdn.jsdelivr.net/npm/osm-community-index@5.6/dist/resources.min.json"),t.set("phone_formats","data/phone_formats.min.json"),t.set("preset_categories","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.6/dist/preset_categories.min.json"),t.set("preset_defaults","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.6/dist/preset_defaults.min.json"),t.set("preset_fields","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.6/dist/fields.min.json"),t.set("preset_presets","https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.6/dist/presets.min.json"),t.set("preset_overrides","data/preset_overrides.min.json"),t.set("qa_data","data/qa_data.min.json"),t.set("shortcuts","data/shortcuts.min.json"),t.set("territory_languages","data/territory_languages.min.json"),t.set("wmf_sitematrix","https://cdn.jsdelivr.net/npm/wmf-sitematrix@0.1/wikipedia.min.json"),this.fileMap=t,this._cachedData={},this._inflight={},window.mocha){let r=this._cachedData;r.address_formats=[{format:[["housenumber","street"],["city","postcode"]]}],r.deprecated=[{old:{highway:"no"}},{old:{highway:"ford"},replace:{ford:"*"}}],r.discarded={},r.imagery=[],r.keepRight={},r.languages={de:{nativeName:"Deutsch"},en:{nativeName:"English"}},r.locales={en:{rtl:!1,pct:1}},r.locale_general_en={en:{}},r.locale_tagging_en={en:{}},r.locales_index_general={en:{rtl:!1,pct:1}},r.locales_index_tagging={en:{rtl:!1,pct:1}},r.phone_formats={},r.preset_categories={},r.preset_defaults={},r.preset_fields={},r.preset_presets={},r.preset_overrides={},r.qa_data={improveOSM:{},osmose:{}},r.shortcuts=[],r.territory_languages={},r.wmf_sitematrix=[["English","English","en"],["German","Deutsch","de"]],r.colors={}}}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}getDataAsync(e){if(this._cachedData[e])return Promise.resolve(this._cachedData[e]);let t=this.fileMap.get(e),r=t&&this.context.asset(t);if(!r)return Promise.reject(`Unknown data file for "${e}"`);let s=this._inflight[r];return s||(this._inflight[r]=s=fetch(r).then(Me).then(n=>{if(delete this._inflight[r],!n)throw new Error(`No data loaded for "${e}"`);return this._cachedData[e]=n,n}).catch(n=>{throw delete this._inflight[r],n})),s}};function hF(i){var e=typeof i;return i!=null&&(e=="object"||e=="function")}var Xa=hF;var dF=typeof global=="object"&&global&&global.Object===Object&&global,Bw=dF;var fF=typeof self=="object"&&self&&self.Object===Object&&self,pF=Bw||fF||Function("return this")(),vh=pF;var mF=function(){return vh.Date.now()},_h=mF;var gF=/\s/;function yF(i){for(var e=i.length;e--&&gF.test(i.charAt(e)););return e}var Uw=yF;var xF=/^\s+/;function vF(i){return i&&i.slice(0,Uw(i)+1).replace(xF,"")}var $w=vF;var _F=vh.Symbol,U1=_F;var Hw=Object.prototype,bF=Hw.hasOwnProperty,wF=Hw.toString,L2=U1?U1.toStringTag:void 0;function EF(i){var e=bF.call(i,L2),t=i[L2];try{i[L2]=void 0;var r=!0}catch(n){}var s=wF.call(i);return r&&(e?i[L2]=t:delete i[L2]),s}var Gw=EF;var AF=Object.prototype,SF=AF.toString;function CF(i){return SF.call(i)}var zw=CF;var kF="[object Null]",TF="[object Undefined]",jw=U1?U1.toStringTag:void 0;function IF(i){return i==null?i===void 0?TF:kF:jw&&jw in Object(i)?Gw(i):zw(i)}var Vw=IF;function MF(i){return i!=null&&typeof i=="object"}var Ww=MF;var PF="[object Symbol]";function DF(i){return typeof i=="symbol"||Ww(i)&&Vw(i)==PF}var Xw=DF;var qw=NaN,RF=/^[-+]0x[0-9a-f]+$/i,NF=/^0b[01]+$/i,FF=/^0o[0-7]+$/i,LF=parseInt;function OF(i){if(typeof i=="number")return i;if(Xw(i))return qw;if(Xa(i)){var e=typeof i.valueOf=="function"?i.valueOf():i;i=Xa(e)?e+"":e}if(typeof i!="string")return i===0?i:+i;i=$w(i);var t=NF.test(i);return t||FF.test(i)?LF(i.slice(2),t?2:8):RF.test(i)?qw:+i}var e8=OF;var BF="Expected a function",UF=Math.max,$F=Math.min;function HF(i,e,t){var r,s,n,o,a,l,c=0,u=!1,h=!1,d=!0;if(typeof i!="function")throw new TypeError(BF);e=e8(e)||0,Xa(t)&&(u=!!t.leading,h="maxWait"in t,n=h?UF(e8(t.maxWait)||0,e):n,d="trailing"in t?!!t.trailing:d);function f(A){var k=r,v=s;return r=s=void 0,c=A,o=i.apply(v,k),o}function p(A){return c=A,a=setTimeout(y,e),u?f(A):o}function m(A){var k=A-l,v=A-c,E=e-k;return h?$F(E,n-v):E}function g(A){var k=A-l,v=A-c;return l===void 0||k>=e||k<0||h&&v>=n}function y(){var A=_h();if(g(A))return x(A);a=setTimeout(y,m(A))}function x(A){return a=void 0,d&&r?f(A):(r=s=void 0,o)}function b(){a!==void 0&&clearTimeout(a),c=0,r=l=s=a=void 0}function _(){return a===void 0?o:x(_h())}function w(){var A=_h(),k=g(A);if(r=arguments,s=this,l=A,k){if(a===void 0)return p(l);if(h)return clearTimeout(a),a=setTimeout(y,e),f(l)}return a===void 0&&(a=setTimeout(y,e)),o}return w.cancel=b,w.flush=_,w}var wt=HF;function V(i,e=""){let t=i.replace("#","");return function(s){let n=["icon"];t&&n.push(`icon-${t}`),e&&n.push(e),s.selectAll(`svg.icon-${t}`).data([t],o=>o).enter().append("svg").attr("class",n.join(" ")).append("use").attr("xlink:href",i)}}function Vt(i,e){let t=He("modal"),r=i.select("div.modal"),s=r.empty();r.transition().duration(200).style("opacity",0).remove();let n=i.append("div").attr("class","shaded").style("opacity",0);n.close=()=>{n.transition().duration(200).style("opacity",0).remove(),o.transition().duration(200).style("top","0px"),G(document).call(t.unbind)};let o=n.append("div").attr("class","modal fillL");return o.append("input").attr("class","keytrap keytrap-first").on("focus.keytrap",l),e||(n.on("click.remove-modal",c=>{c.target===this&&n.close()}),o.append("button").attr("class","close").on("click",n.close).call(V("#rapid-icon-close")),t.on("\u232B",n.close).on("\u238B",n.close),G(document).call(t)),o.append("div").attr("class","content"),o.append("input").attr("class","keytrap keytrap-last").on("focus.keytrap",a),s?n.transition().style("opacity",1):n.style("opacity",1),n;function a(){let c=o.select("a, button, input:not(.keytrap), select, textarea").node();c?c.focus():G(this).node().blur()}function l(){let c=o.selectAll("a, button, input:not(.keytrap), select, textarea").nodes();c.length?c[c.length-1].focus():G(this).node().blur()}}function Sn(i){let e=G(null),t="",r=!1,s=n=>{e=Vt(n,r);let o=e.select(".content").classed("loading-modal",!0).append("div").attr("class","modal-section fillL");return o.append("img").attr("class","loader").attr("src",i.asset("img/loader-white.gif")),o.append("h3").html(t),e.select("button.close").attr("class","hide"),s};return s.message=function(n){return arguments.length?(t=n,s):t},s.blocking=function(n){return arguments.length?(r=n,s):r},s.close=()=>{e.remove()},s.isShown=()=>e&&!e.empty()&&e.node().parentNode,s}var O2=class extends Ce{constructor(e){super(e),this.id="editor",this.dependencies=new Set(["imagery","map","photos","storage"]),this._mutex=Cy("lock"),this._canRestoreBackup=!1,this._hasWorkInProgress=!1,this._history=[],this._index=0,this._staging=null,this._checkpoints=new Map,this._inTransition=!1,this._inTransaction=!1,this._tree=null,this._backupStatus=!0,this._fullDifference=null,this._lastStableGraph=null,this._lastStagingGraph=null,this._initPromise=null,this.saveBackup=this.saveBackup.bind(this),this.deferredBackup=wt(this.saveBackup,1e3,{leading:!1,trailing:!0})}initAsync(){if(this._initPromise)return this._initPromise;for(let r of this.dependencies)if(!this.context.systems[r])return Promise.reject(`Cannot init:  ${this.id} requires ${r}`);this._reset();let e=this.context.systems.storage,t=e.initAsync();return this._initPromise=t.then(()=>{window.mocha||(window.addEventListener("beforeunload",r=>{if(this._history.length>1)return r.preventDefault(),this.saveBackup(),r.returnValue=""}),window.addEventListener("unload",()=>this._mutex.unlock()),this._canRestoreBackup=this._mutex.lock()&&e.hasItem(this._backupKey()))})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){let e=this._index;return this._reset(),this.emit("stagingchange",this._fullDifference),this.emit("stablechange",this._fullDifference),this.emit("historyjump",e,this._index),this.emit("backupstatuschange",this._backupStatus),Promise.resolve()}_reset(){G(document).interrupt("editTransition"),this.deferredBackup.cancel();let e=new di,t=new ro({graph:e});this._history=[t],this._index=0;let r=new di(e),s=new ro({graph:r});this._staging=s,this._hasWorkInProgress=!1,this._tree=new Jr(r),this._lastStableGraph=e,this._lastStagingGraph=r,this._fullDifference=new er(e,e),this._backupStatus=!0,this._checkpoints.clear(),this._inTransition=!1,this._inTransaction=!1}get base(){return this._history[0]}get stable(){return this._history[this._index]}get staging(){return this._staging}get tree(){return this._tree}get history(){return this._history.slice()}get index(){return this._index}get hasWorkInProgress(){return this._hasWorkInProgress}perform(...e){return G(document).interrupt("editTransition"),this._perform(e,1),this._updateChanges()}performAsync(e){if(G(document).interrupt("editTransition"),typeof e!="function")return Promise.reject();if(!e.transitionable)return this._perform([e],1),this._updateChanges(),Promise.resolve();let t=150;return new Promise(r=>{G(document).transition("editTransition").duration(t).ease(Y0).tween("edit.tween",()=>s=>{s<1&&(this._replaceStaging(),this._perform([e],s),this._updateChanges())}).on("start",()=>{this._inTransition=!0,this._replaceStaging(),this._perform([e],0),this._updateChanges()}).on("end interrupt",()=>{this._replaceStaging(),this._perform([e],1),this._updateChanges(),this._inTransition=!1,r()})})}revert(){if(this._hasWorkInProgress)return G(document).interrupt("editTransition"),this._replaceStaging(),this._updateChanges()}commit(e={}){var n,o;G(document).interrupt("editTransition");let t=this.context,r=this.staging,s=(n=e.annotation)!=null?n:"";r.annotation=s,r.selectedIDs=(o=e.selectedIDs)!=null?o:[],r.sources=this._gatherSources(s),r.transform=t.projection.transform(),this._history.splice(this._index+1,1/0,r),this._index++,this._replaceStaging(),this._updateChanges()}commitAppend(e={}){var n,o;G(document).interrupt("editTransition");let t=this.context,r=this.staging;if(this._index===0)throw new Error("Can not commitAppend to the base edit!");let s=(n=e.annotation)!=null?n:"";r.annotation=s,r.selectedIDs=(o=e.selectedIDs)!=null?o:[],r.sources=this._gatherSources(s),r.transform=t.projection.transform(),this._history.splice(this._index,1/0,r),this._replaceStaging(),this._updateChanges()}undo(){G(document).interrupt("editTransition");let e=this._index;if(this._hasWorkInProgress){this.revert(),this.emit("historyjump",e,this._index);return}this._index>0&&this._index--,this._index!==e&&(this._replaceStaging(),this._updateChanges(),this.emit("historyjump",e,this._index))}redo(){G(document).interrupt("editTransition");let e=this._index;this._index<this._history.length-1&&this._index++,this._index!==e&&(this._replaceStaging(),this._updateChanges(),this.emit("historyjump",e,this._index))}setCheckpoint(e){e&&(G(document).interrupt("editTransition"),this._checkpoints.set(e,{history:this._history.slice(),index:this._index}))}restoreCheckpoint(e){if(!e)return;G(document).interrupt("editTransition");let t=this._index,r=this._checkpoints.get(e);r&&(this._history=r.history.slice(),this._index=r.index,this._replaceStaging(),this._updateChanges(),this.emit("historyjump",t,this._index))}deleteCheckpoint(e){e&&this._checkpoints.delete(e)}merge(e,t){let r=this.base.graph,s=this.staging.graph;t instanceof Set||(t=new Set(e.map(a=>a.id)));let n=new Set;for(let a of e)r.hasEntity(a.id)||n.add(a.id);for(let a of t){let l=s.hasEntity(a);if((l==null?void 0:l.type)==="relation")for(let c of l.members)n.has(c.id)&&l.touch()}let o=this._history.map(a=>a.graph);o.push(s),r.rebase(e,o,!1),this._tree.rebase(e,!1),this.emit("merge",t)}beginTransaction(){this._inTransaction=!0}endTransaction(){return this._inTransaction=!1,this._updateChanges()}getUndoAnnotation(){let e=this._index;for(;e>=0;){let t=this._history[e];if(t.annotation)return t.annotation;e--}}getRedoAnnotation(){let e=this._index+1;for(;e<=this._history.length-1;){let t=this._history[e];if(t.annotation)return t.annotation;e++}}intersects(e){return this._tree.intersects(e,this.staging.graph)}difference(){return this._fullDifference}changes(e){let t=this._fullDifference;if(e){let r=this.base.graph,s=e(this.stable.graph);t=new er(r,s)}return{created:t.created(),modified:t.modified(),deleted:t.deleted()}}hasChanges(){return this._fullDifference.changes.size>0}sourcesUsed(){var t;let e={imagery:new Set,photos:new Set,data:new Set};for(let r=1;r<=this._index;r++){let s=this._history[r];for(let n of["imagery","photos","data"])for(let o of(t=s.sources[n])!=null?t:[])e[n].add(o)}return e}toIntroGraph(){let e={n:0,r:0,w:0},t={},r=this.stable.graph,s=new Map;for(let a of r.base.entities.values()){let l=o(a);s.set(l.id,l)}for(let[a,l]of r.local.entities)if(l){let c=o(l);s.set(c.id,c)}else s.delete(a);for(let a of s.values())Array.isArray(a.nodes)&&(a.nodes=a.nodes.map(l=>{var c;return(c=t[l])!=null?c:l})),Array.isArray(a.members)&&(a.members=a.members.map(l=>{var c;return l.id=(c=t[l.id])!=null?c:l.id,l}));let n={};for(let[a,l]of s)n[a]=l;return JSON.stringify({dataIntroGraph:n});function o(a){let l=li(a,["type","user","v","version","visible"]);l.tags&&Object.keys(l.tags).length===0&&delete l.tags,Array.isArray(l.loc)&&(l.loc[0]=+l.loc[0].toFixed(6),l.loc[1]=+l.loc[1].toFixed(6));let c=a.id.match(/([nrw])-\d*/);if(c!==null){let u=c[1],h;do h=u+ ++e[u];while(s.has(h));t[a.id]=h,l.id=h}return l}}toJSON(){var a;if(!this.hasChanges())return;let e=7,t=this.base.graph,r=new Map,s=new Map,n=[];for(let l of this._history){let c=[],u=[];for(let[f,p]of l.graph.local.entities){if(p){let g=de.key(p);r.set(g,o(p)),c.push(g)}else u.push(f);let m=t.hasEntity(f);if(m&&!s.has(f)&&s.set(f,o(m)),p&&p.nodes)for(let g of p.nodes){let y=t.hasEntity(g);y&&!s.has(y.id)&&s.set(y.id,o(y))}if(m)for(let g of t.parentWays(m))s.has(g.id)||s.set(g.id,o(g))}let h=(a=l.sources)!=null?a:{},d={};c.length&&(d.modified=c),u.length&&(d.deleted=u),l.annotation&&(d.annotation=l.annotation),l.selectedIDs&&(d.selectedIDs=l.selectedIDs),l.transform&&(d.transform=l.transform),h.imagery&&(d.imageryUsed=h.imagery),h.photos&&(d.photosUsed=h.photos),h.data&&(d.dataUsed=h.data),n.push(d)}return JSON.stringify({version:3,entities:[...r.values()],baseEntities:[...s.values()],stack:n,nextIDs:de.id.next,index:this._index,timestamp:new Date().getTime()});function o(l){let c=li(l,["visible"]);return c.tags&&Object.keys(c.tags).length===0&&delete c.tags,Array.isArray(c.loc)&&(c.loc[0]=+c.loc[0].toFixed(e),c.loc[1]=+c.loc[1].toFixed(e)),c}}fromJSONAsync(e){let t=this.context,r=t.systems.map,s=t.services.osm,n=JSON.parse(e);if(n.version!==3)throw new Error(`Backup version ${n.version} not supported.`);r.pause();let o;window.mocha||(o=Sn(t).blocking(!0),t.container().call(o));let a=new Map,l=new Map,c=new Set;de.id.next=n.nextIDs;for(let d of n.baseEntities){let f=de(d);a.set(f.id,f)}for(let d of a.values())if(Array.isArray(d.nodes))for(let f of d.nodes)a.has(f)||c.add(f);for(let d of n.entities)l.set(de.key(d),de(d));let u=()=>new Promise((d,f)=>{if(s&&c.size){let p=(m,g)=>{var y,x;if(m)f(m);else{let b=Ut(g.data,"visible"),_=(y=b.true)!=null?y:[],w=(x=b.false)!=null?x:[];for(let A of _)c.delete(A.id),a.set(A.id,A);for(let A of w)s.loadEntityVersion(A.id,+A.version-1,p)}c.size||d()};s.loadMultiple(c,p)}else d()}),h=()=>{var g,y;let d=[...a.values()],f=new Set(a.keys()),p=this.base.graph;p.rebase(d,[p],!1),this._tree.rebase(d,!1);let m=p;for(let x=1;x<n.stack.length;x++){let b=n.stack[x],_={};for(let k of(g=b.modified)!=null?g:[]){let v=l.get(k);_[v.id]=v}for(let k of(y=b.deleted)!=null?y:[])_[k]=void 0;let w=new di(m).load(_);m=w;let A={};Array.isArray(b.imageryUsed)&&(A.imagery=b.imageryUsed),Array.isArray(b.photosUsed)&&(A.photos=b.photosUsed),Array.isArray(b.dataUsed)&&(A.data=b.dataUsed),this._history.push(new ro({annotation:b.annotation,graph:w,selectedIDs:b.selectedIDs,sources:A,transform:b.transform}))}this._index=n.index,this._replaceStaging(),r.resume(),o==null||o.close(),this.emit("merge",f),this._updateChanges(),this.emit("historyjump",0,this._index)};return u().finally(()=>h())}saveBackup(){var s;let e=this.context;if(e.inIntro||((s=e.mode)==null?void 0:s.id)==="save"||this._canRestoreBackup||this._inTransition||this._inTransaction||!this._mutex.locked())return;let t=e.systems.storage,r=this.toJSON();if(r){let n=t.setItem(this._backupKey(),r);n!==this._backupStatus&&(this._backupStatus=n,this.emit("backupstatuschange",this._backupStatus))}}get canRestoreBackup(){return this._canRestoreBackup}restoreBackup(){if(this._canRestoreBackup=!1,!this._mutex.locked())return;let e=this.context,r=e.systems.storage.getItem(this._backupKey());r&&e.resetAsync().then(()=>this.fromJSONAsync(r))}clearBackup(){if(this._canRestoreBackup=!1,this.deferredBackup.cancel(),!this._mutex.locked())return;let e=this.context.systems.storage;e.removeItem(this._backupKey()),e.removeItem("comment"),e.removeItem("hashtags"),e.removeItem("source")}_backupKey(){return"Rapid_"+window.location.origin+"_saved_history"}_gatherSources(e){var u,h;let t=this.context,r={},s=t.systems.imagery.imageryUsed();s.length&&(r.imagery=s);let n=t.systems.photos.photosUsed();n.length&&(r.photos=n);let o=t.scene().layers.get("custom-data"),a=(u=o==null?void 0:o.dataUsed())!=null?u:[],c=[...(h=e==null?void 0:e.dataUsed)!=null?h:[],...a];return c.length&&(r.data=c),r}_perform(e,t=1){let r=this._staging.graph;for(let s of e)typeof s=="function"&&(r=s(r,t));this._staging.graph=r,this._hasWorkInProgress=!0}_replaceStaging(){this._staging=new ro({graph:new di(this.stable.graph)}),this._hasWorkInProgress=!1}_updateChanges(){if(this._inTransaction)return;let e=this.base.graph,t=this.stable.graph,r=this.staging.graph,s;if((this._lastStagingGraph!==r||this._hasWorkInProgress)&&(s=new er(this._lastStagingGraph,r),this._lastStagingGraph=r,this.emit("stagingchange",s)),this._lastStableGraph!==t){this._fullDifference=new er(e,t);let n=new er(this._lastStableGraph,t);this._lastStableGraph=t,this.emit("stablechange",n),this.deferredBackup()}return s}};var bh={motorway:!0,motorway_link:!0,trunk:!0,trunk_link:!0,primary:!0,primary_link:!0,secondary:!0,secondary_link:!0,tertiary:!0,tertiary_link:!0,residential:!0,unclassified:!0,living_street:!0},wh={busway:!0,service:!0,road:!0,track:!0},Eh={path:!0,footway:!0,cycleway:!0,bridleway:!0,steps:!0,pedestrian:!0},Li=class{constructor(e){this.filter=e,this.enabled=!0,this.count=0}},B2=class extends Ce{constructor(e){super(e),this.id="filters",this.dependencies=new Set(["editor","storage","urlhash"]),this._rules=new Map,this._hidden=new Set,this._forceVisible=new Set,this._cache={},this._initPromise=null,this._hashchange=this._hashchange.bind(this),this._rules.set("points",new Li(this._isPoint.bind(this))),this._rules.set("traffic_roads",new Li(this._isTrafficRoad.bind(this))),this._rules.set("service_roads",new Li(this._isServiceRoad.bind(this))),this._rules.set("paths",new Li(this._isPath.bind(this))),this._rules.set("buildings",new Li(this._isBuilding.bind(this))),this._rules.set("building_parts",new Li(this._isBuildingPart.bind(this))),this._rules.set("indoor",new Li(this._isIndoor.bind(this))),this._rules.set("landuse",new Li(this._isLanduse.bind(this))),this._rules.set("boundaries",new Li(this._isBoundary.bind(this))),this._rules.set("water",new Li(this._isWater.bind(this))),this._rules.set("rail",new Li(this._isRail.bind(this))),this._rules.set("pistes",new Li(this._isPiste.bind(this))),this._rules.set("aerialways",new Li(this._isAerialway.bind(this))),this._rules.set("power",new Li(this._isPower.bind(this))),this._rules.set("past_future",new Li(this._isPastFuture.bind(this))),this._rules.set("others",new Li(this._isOther.bind(this)))}initAsync(){if(this._initPromise)return this._initPromise;for(let s of this.dependencies)if(!this.context.systems[s])return Promise.reject(`Cannot init:  ${this.id} requires ${s}`);let e=this.context.systems.storage,t=this.context.systems.urlhash,r=Promise.all([e.initAsync(),t.initAsync()]);return this._initPromise=r.then(()=>{var n;t.on("hashchange",this._hashchange);let s=(n=t.getParam("disable_features"))!=null?n:e.getItem("disabled-features");if(s){let o=s.replace(/;/g,",").split(",").map(a=>a.trim()).filter(Boolean);for(let a of o){this._hidden.add(a);let l=this._rules.get(a);l.enabled=!1}}})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this._cache={},this._forceVisible.clear(),Promise.resolve()}get keys(){return[...this._rules.keys()]}get hidden(){return this._hidden}isEnabled(e){let t=this._rules.get(e);return t==null?void 0:t.enabled}enable(e){let t=this._rules.get(e);t&&!t.enabled&&(t.enabled=!0,this._update())}enableAll(){let e=!1;for(let t of this._rules.values())t.enabled||(e=!0,t.enabled=!0);e&&this._update()}disable(e){let t=this._rules.get(e);t&&t.enabled&&(t.enabled=!1,this._update())}disableAll(){let e=!1;for(let t of this._rules.values())t.enabled&&(e=!0,t.enabled=!1);e&&this._update()}toggle(e){let t=this._rules.get(e);t&&(t.enabled=!t.enabled,this._update())}resetStats(){for(let e of this._rules.values())e.count=0;this.emit("filterchange")}gatherStats(e,t){let r=Ut(e,"type"),s=[].concat(r.relation||[],r.way||[],r.node||[]);for(let n of this._rules.values())n.count=0;for(let n of s){let o=n.geometry(t),a=Object.keys(this.getMatches(n,t,o));for(let l of a){let c=this._rules.get(l);c.count++}}}stats(){let e={};for(let[t,r]of this._rules)e[t]=r.count;return e}clear(e){for(let t of e)this.clearEntity(t)}clearEntity(e){let t=de.key(e);delete this._cache[t]}getMatches(e,t,r){if(r==="vertex")return{};if(r==="relation"&&e.tags.type!=="boundary")return{};let s=de.key(e);if(this._cache[s]||(this._cache[s]={}),!this._cache[s].matches){let n={},o=!1;for(let[a,l]of this._rules){if(a==="others"){if(o)continue;if(e.type==="way"){let c=this.getParents(e,t,r);if(c.length===1&&c[0].isMultipolygon()||c.length>0&&c.every(u=>u.tags.type==="boundary")){let u=de.key(c[0]);if(this._cache[u]&&this._cache[u].matches){n=Object.assign({},this._cache[u].matches);continue}}}}l.filter(e.tags,r)&&(n[a]=o=!0)}this._cache[s].matches=n}return this._cache[s].matches}getParents(e,t,r){if(r==="point")return[];let s=de.key(e);if(this._cache[s]||(this._cache[s]={}),!this._cache[s].parents){let n;r==="vertex"?n=t.parentWays(e):n=t.parentRelations(e),this._cache[s].parents=n}return this._cache[s].parents}isHiddenPreset(e,t){if(!this._hidden.size||!e.tags)return!1;let r=e.setTags({},t);for(let[s,n]of this._rules)if(n.filter(r,t))return this._hidden.has(s)?s:!1;return!1}isHiddenFeature(e,t,r){if(!this._hidden.size||!e.version||this._forceVisible.has(e.id))return!1;let s=Object.keys(this.getMatches(e,t,r));return s.length&&s.every(n=>this._hidden.has(n))}isHiddenChild(e,t,r){if(!this._hidden.size||!e.version||r==="point"||this._forceVisible.has(e.id))return!1;let s=this.getParents(e,t,r);if(!s.length)return!1;for(let n of s)if(!this.isHidden(n,t,n.geometry(t)))return!1;return!0}hasHiddenConnections(e,t){if(!this._hidden.size)return!1;let r,s;return e.type==="midpoint"?(r=[t.entity(e.edge[0]),t.entity(e.edge[1])],s=[]):(r=e.nodes?t.childNodes(e):[],s=this.getParents(e,t,e.geometry(t))),s=r.reduce((n,o)=>t.isShared(o)?Gt(n,t.parentWays(o)):n,s),s.some(n=>this.isHidden(n,t,n.geometry(t)))}isHidden(e,t,r){return!this._hidden.size||!e.version?!1:r==="vertex"?this.isHiddenChild(e,t,r):this.isHiddenFeature(e,t,r)}filter(e,t){if(!this._hidden.size)return e;var r=[];for(let s of e)this.isHidden(s,t,s.geometry(t))||r.push(s);return r}forceVisible(e){this._forceVisible=new Set;let r=this.context.systems.editor.staging.graph;for(let s of e){this._forceVisible.add(s);let n=r.hasEntity(s);if((n==null?void 0:n.type)==="relation")for(let o of n.members)this._forceVisible.add(o.id)}}_hashchange(e,t){let r=e.get("disable_features"),s=t.get("disable_features");if(r!==s){let n=new Set;typeof r=="string"&&(n=new Set(r.replace(/;/g,",").split(",")));let o=!1;for(let[a,l]of this._rules)l.enabled&&n.has(a)?(l.enabled=!1,o=!0):!l.enabled&&!n.has(a)&&(l.enabled=!0,o=!0);o&&this._update()}}_update(){this._hidden=new Set;for(let[s,n]of this._rules)n.enabled||this._hidden.add(s);let e=[...this._hidden].join(",");this.context.systems.urlhash.setParam("disable_features",e.length?e:null),this.context.systems.storage.setItem("disabled-features",e),this.emit("filterchange")}_isPoint(e,t){return t==="point"}_isTrafficRoad(e){return bh[e.highway]}_isServiceRoad(e){return wh[e.highway]}_isPath(e){return Eh[e.highway]}_isBuilding(e){return!!e.building&&e.building!=="no"||e.parking==="multi-storey"||e.parking==="sheds"||e.parking==="carports"||e.parking==="garage_boxes"}_isBuildingPart(e){return e["building:part"]}_isIndoor(e){return e.indoor}_isLanduse(e,t){return t==="area"&&!this._isBuilding(e)&&!this._isBuildingPart(e)&&!this._isIndoor(e)&&!this._isWater(e)&&!this._isAerialway(e)}_isBoundary(e){return!!e.boundary&&!(bh[e.highway]||wh[e.highway]||Eh[e.highway]||e.waterway||e.railway||e.landuse||e.natural||e.building||e.power)}_isWater(e){return!!e.waterway||e.natural==="water"||e.natural==="coastline"||e.natural==="bay"||e.landuse==="pond"||e.landuse==="basin"||e.landuse==="reservoir"||e.landuse==="salt_pond"}_isRail(e){return(!!e.railway||e.landuse==="railway")&&!(bh[e.highway]||wh[e.highway]||Eh[e.highway])}_isPiste(e){return e["piste:type"]}_isAerialway(e){return e.aerialway&&e.aerialway!=="yes"&&e.aerialway!=="station"}_isPower(e){return!!e.power}_isPastFuture(e){if(bh[e.highway]||wh[e.highway]||Eh[e.highway])return!1;for(let t of Object.keys(e))if(Po[t]||Po[e[t]])return!0;return!1}_isOther(e,t){return t==="line"||t==="area"}};var nE=et(G2(),1);var z2=class extends Ce{constructor(e){super(e),this.id="imagery",this.dependencies=new Set(["dataloader","editor","l10n","map","urlhash"]),this._initPromise=null,this._imageryIndex=null,this._baseLayer=null,this._overlayLayers=new Map,this._checkedBlocklists=[],this._isValid=!0,this._brightness=1,this._contrast=1,this._saturation=1,this._sharpness=1,this._numGridSplits=0,this._hashchange=this._hashchange.bind(this),this.updateImagery=this.updateImagery.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let a of this.dependencies)if(!this.context.systems[a])return Promise.reject(`Cannot init:  ${this.id} requires ${a}`);let e=this.context,t=e.systems.dataloader,r=e.systems.map,s=e.systems.storage,n=e.systems.urlhash,o=Promise.all([r.initAsync(),t.initAsync(),s.initAsync(),n.initAsync()]);return this._initPromise=o.then(()=>n.on("hashchange",this._hashchange)).then(()=>t.getDataAsync("imagery")).then(a=>this._initImageryIndex(a))}_initImageryIndex(e){let t=this.context;this._imageryIndex={features:new Map,sources:new Map,query:null};let r=e.map(l=>{if(!l.polygon)return null;let c=l.polygon.map(h=>[h]),u={type:"Feature",properties:{id:l.id},geometry:{type:"MultiPolygon",coordinates:c}};return this._imageryIndex.features.set(l.id.toLowerCase(),u),u}).filter(Boolean);this._imageryIndex.query=(0,nE.default)({type:"FeatureCollection",features:r});for(let l of e){let c;l.type==="bing"?c=new g1(t,l):/^EsriWorldImagery/.test(l.id)?c=new y1(t,l):c=new _s(t,l),this._imageryIndex.sources.set(l.id.toLowerCase(),c)}let s=new p1(t);this._imageryIndex.sources.set(s.id,s);let n=new m1(t),o=this.context.systems.storage;n.template=o.getItem("background-custom-template")||"",this._imageryIndex.sources.set(n.id,n);let a=this._imageryIndex.sources.get("mapbox_locator_overlay");a&&this.toggleOverlayLayer(a)}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context.systems.map,t=e.startAsync();return this._startPromise=t.then(()=>{e.scene.on("layerchange",this.updateImagery),this._started=!0})}resetAsync(){return Promise.resolve()}_hashchange(e,t){let r=e.get("background"),s=t.get("background");if(!r||r!==s){let c;typeof r=="string"&&(c=this.getSource(r)),c||(c=this.chooseDefaultSource()),this.baseLayerSource(c)}let n=e.get("overlays"),o=t.get("overlays");if(n!==o){let c=new Set;if(typeof n=="string"){let u=n.split(",").map(h=>h.trim().toLowerCase()).filter(Boolean);c=new Set(u)}this.enableOverlayLayers(c)}let a=e.get("offset"),l=t.get("offset");if(a!==l){let c,u;typeof a=="string"&&([c,u]=a.replace(/;/g,",").split(",").map(h=>h.trim()).map(Number)),(isNaN(c)||!isFinite(c))&&(c=0),(isNaN(u)||!isFinite(u))&&(u=0),this.offset=E5([c,u])}}updateImagery(){let e=this._baseLayer;if(this.context.inIntro||!e)return;let t=e.id;t==="custom"&&(t=`custom:${e.template}`);let r=[];for(let c of this._overlayLayers.values())c.isLocatorOverlay()||r.push(c.id);let s=this.context.systems.urlhash;s.setParam("background",t),s.setParam("overlays",r.length?r.join(","):null);let n=A5(e.offset),o=.01,a=+n[0].toFixed(2),l=+n[1].toFixed(2);s.setParam("offset",Math.abs(a)>o||Math.abs(l)>o?`${a},${l}`:null)}imageryUsed(){var r;let e=new Set,t=(r=this._baseLayer)==null?void 0:r.imageryUsed;t&&this._isValid&&e.add(t);for(let s of this._overlayLayers.values())s.isLocatorOverlay()||s.imageryUsed&&e.add(s.imageryUsed);return Array.from(e)}sources(e,t){var c;if(!this._imageryIndex)return[];let r=new Set;(this._imageryIndex.query.bbox(e.rectangle(),!0)||[]).forEach(u=>r.add(u.id));let s=this._baseLayer,n=[...this._imageryIndex.sources.values()],o=this.context.services.osm,a=(c=o==null?void 0:o.imageryBlocklists)!=null?c:[];if(a.length!==this._checkedBlocklists.length||a.some((u,h)=>String(u)!==this._checkedBlocklists[h])){for(let u of n)u.isBlocked=a.some(h=>h.test(u.template));this._checkedBlocklists=a.map(u=>String(u))}return n.filter(u=>s===u?!0:u.isBlocked?!1:u.polygon?t&&t<6?!1:r.has(u.id):!0)}baseLayerSource(e){var l;if(!arguments.length)return this._baseLayer;let t=this.context.services.osm;if(!t)return this;let r=(l=t==null?void 0:t.imageryBlocklists)!=null?l:[],s=e.template,n=!1,o=0,a;for(a of r)if(n=a.test(s),o++,n)break;return o||(a=/.*\.google(apis)?\..*\/(vt|kh)[\?\/].*([xyz]=.*){3}.*/,n=a.test(s)),this._baseLayer=n?this.getSource("none"):e,this.updateImagery(),this.emit("imagerychange"),this}chooseDefaultSource(){let e=this.context.systems.map,t=this.sources(e.extent(),e.zoom()),r=t[0],s=t.find(l=>l.best),o=this.context.systems.storage.getItem("background-last-used")||"none",a=o!=="none"&&this.getSource(o);return s||a||this.getSource("Bing")||r||this.getSource("none")}getSource(e){return this._imageryIndex?this._imageryIndex.sources.get(e.toLowerCase()):null}showsLayer(e){let t=this._baseLayer;return!e||!t?!1:e.id===t.id||this._overlayLayers.has(e.id)}overlayLayerSources(){return[...this._overlayLayers.values()]}toggleOverlayLayer(e){this._overlayLayers.has(e.id)?this._overlayLayers.delete(e.id):this._overlayLayers.set(e.id,e),this.updateImagery(),this.emit("imagerychange")}enableOverlayLayers(e){for(let[t,r]of this._overlayLayers)r.isLocatorOverlay()||this._overlayLayers.delete(t);for(let t of e){let r=this.getSource(t);r&&this._overlayLayers.set(r.id,r)}this.updateImagery(),this.emit("imagerychange")}nudge(e,t){this._baseLayer&&(this._baseLayer.nudge(e,t),this.updateImagery(),this.emit("imagerychange"))}get offset(){var e;return((e=this._baseLayer)==null?void 0:e.offset)||[0,0]}set offset([e,t]=[0,0]){var n;let[r,s]=((n=this._baseLayer)==null?void 0:n.offset)||[0,0];e===r&&t===s||this._baseLayer&&(this._baseLayer.offset=[e,t],this.updateImagery(),this.emit("imagerychange"))}get brightness(){return this._brightness}set brightness(e=1){var t;e!==this._brightness&&(this._brightness=e,(t=this.context.scene().layers.get("background"))==null||t.setBrightness(e),this.emit("imagerychange"))}get contrast(){return this._contrast}set contrast(e=1){var t;e!==this._contrast&&(this._contrast=e,(t=this.context.scene().layers.get("background"))==null||t.setContrast(e),this.emit("imagerychange"))}get saturation(){return this._saturation}set saturation(e=1){var t;e!==this._saturation&&(this._saturation=e,(t=this.context.scene().layers.get("background"))==null||t.setSaturation(e),this.emit("imagerychange"))}get sharpness(){return this._sharpness}set sharpness(e=1){var t;e!==this._sharpness&&(this._sharpness=e,(t=this.context.scene().layers.get("background"))==null||t.setSharpness(e),this.emit("imagerychange"))}get numGridSplits(){return this._numGridSplits}set numGridSplits(e=0){e!==this._numGridSplits&&(this._numGridSplits=e,this.emit("imagerychange"))}};function oE(i,e,t){let r=t-e;return((i-e)%r+r)%r+e}function aE(i,e,t){return Math.max(e,Math.min(i,t))}var j2=class extends Ce{constructor(e){super(e),this.id="l10n",this.dependencies=new Set(["dataloader","presets","urlhash"]),this._supportedLanguages={},this._supportedLocales={},this._cache={},this._initPromise=null,this._preferredLocaleCodes=[],this._currLocaleCode="en-US",this._currLocaleCodes=["en-US","en"],this._currLanguageCode="en",this._currTextDirection="ltr",this._currIsMetric=!1,this._languageNames={},this._scriptNames={},this.t=this.t.bind(this),this.tHtml=this.tHtml.bind(this),this.tAppend=this.tAppend.bind(this)}localeCode(){return this._currLocaleCode}localeCodes(){return this._currLocaleCodes}languageCode(){return this._currLanguageCode}textDirection(){return this._currTextDirection}usesMetric(){return this._currIsMetric}languageNames(){return this._languageNames}scriptNames(){return this._scriptNames}isRTL(){return this._currTextDirection==="rtl"}set preferredLocaleCodes(e){typeof e=="string"?this._preferredLocaleCodes=e.split(/,|;| /gi).filter(Boolean):this._preferredLocaleCodes=e||[]}get preferredLocaleCodes(){return this._preferredLocaleCodes}initAsync(){if(this._initPromise)return this._initPromise;for(let n of this.dependencies)if(!this.context.systems[n])return Promise.reject(`Cannot init:  ${this.id} requires ${n}`);let e={general:"locales",tagging:"https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.4/dist/translations"},t=this.context.systems.dataloader,r=this.context.systems.urlhash,s=Promise.all([t.initAsync(),r.initAsync()]);return this._initPromise=s.then(()=>{let n=["languages","locales"],o=t.fileMap;for(let a in e){let l=`locales_index_${a}`;o.has(l)||o.set(l,e[a]+"/index.min.json"),n.push(l)}return Promise.all(n.map(a=>t.getDataAsync(a)))}).then(n=>{this._supportedLanguages=n[0],this._supportedLocales=n[1];let o=r.initialHashParams.get("locale");o&&(this._preferredLocaleCodes=o.split(",").map(u=>u.trim()).filter(Boolean));let a=n.slice(2),l=(this._preferredLocaleCodes||[]).concat(ei().browserLocales).concat(["en"]);this._currLocaleCodes=this._localesToUseFrom(l),this._currLocaleCode=this._currLocaleCodes[0];let c=[];return a.forEach((u,h)=>{this._currLocaleCodes.forEach(d=>{let f=Object.keys(e)[h],p=Object.values(e)[h];u[d]&&c.push(this.loadLocaleAsync(d,f,p))})}),Promise.all(c)}).then(()=>this._updateForCurrentLocale()).catch(n=>console.error(n))}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}loadLocaleAsync(e,t,r){if(e.toLowerCase()==="en-us"&&(e="en"),this._cache[t]&&this._cache[t][e])return Promise.resolve(e);let s=this.context.systems.dataloader,n=s.fileMap,o=`locale_${t}_${e}`;return n.has(o)||n.set(o,`${r}/${e}.min.json`),s.getDataAsync(o).then(a=>(this._cache[t]||(this._cache[t]={}),this._cache[t][e]=a[e],e))}pluralRule(e,t=this._currLocaleCode){let r="Intl"in window&&Intl.PluralRules&&new Intl.PluralRules(t);return r?r.select(e):e===1?"one":"other"}_getString(e,t,r){let s=e.trim(),n="general";if(s[0]==="_"){let h=s.split(".");n=h[0].slice(1),s=h.slice(1).join(".")}r=r||this._currLocaleCode;let o=s.split(".").map(h=>h.replace(/<TX_DOT>/g,".")).reverse(),a=r;a.toLowerCase()==="en-us"&&(a="en");let l=this._cache[n]&&this._cache[n][a];for(;l!==void 0&&o.length;)l=l[o.pop()];if(l!==void 0){if(t){if(typeof l=="object"&&Object.keys(l).length){let h=Object.values(t).find(d=>typeof d=="number");if(h!==void 0){let d=this.pluralRule(h,r);l[d]?l=l[d]:l=Object.values(l)[0]}}if(typeof l=="string")for(let h in t){let d=t[h];typeof d=="number"&&(d.toLocaleString?d=d.toLocaleString(r,{style:"decimal",useGrouping:!0,minimumFractionDigits:0}):d=d.toString());let f=`{${h}}`,p=new RegExp(f,"g");l=l.replace(p,d)}}if(typeof l=="string")return{text:l,locale:r}}let c=this._currLocaleCodes.indexOf(r);if(c>=0&&c<this._currLocaleCodes.length-1){let h=this._currLocaleCodes[c+1];return this._getString(e,t,h)}if(t&&"default"in t)return{text:t.default,locale:null};let u=`Missing ${r} translation: ${e}`;return typeof console!="undefined"&&console.error(u),{text:u,locale:"en"}}hasTextForStringID(e){return!!this._getString(e,{default:"nothing found"}).locale}t(e,t,r){return this._getString(e,t,r).text}tHtml(e,t,r){let s=this._getString(e,t,r);return s.text?this.htmlForLocalizedText(s.text,s.locale):""}tAppend(e,t,r){let s=function(n){let o=this._getString(e,t,r);return n.append("span").attr("class","localized-text").attr("lang",o.locale||"und").text(((t==null?void 0:t.prefix)||"")+o.text+((t==null?void 0:t.suffix)||""))};return s.stringID=e,s}htmlForLocalizedText(e,t){return`<span class="localized-text" lang="${t||"unknown"}">${e}</span>`}languageName(e,t){if(this._languageNames[e])return this._languageNames[e];if(t&&t.localOnly)return null;let r=this._supportedLanguages[e];if(r){if(r.nativeName)return this.t("translate.language_and_code",{language:r.nativeName,code:e});if(r.base&&r.script){let s=r.base;if(this._languageNames[s]){let n=r.script,o=this._scriptNames[n]||n;return this.t("translate.language_and_code",{language:this._languageNames[s],code:o})}else if(this._supportedLanguages[s]&&this._supportedLanguages[s].nativeName)return this.t("translate.language_and_code",{language:this._supportedLanguages[s].nativeName,code:e})}}return e}displayName(e,t){var l,c,u;let r=this._currLanguageCode.toLowerCase(),s=e.route,n=(c=(l=e[`name:${r}`])!=null?l:e.name)!=null?c:"",o={name:n,direction:e.direction,from:e.from,network:t?void 0:(u=e.cycle_network)!=null?u:e.network,ref:e.ref,to:e.to,via:e.via};if(s&&o.ref&&o.name)return o.network?this.t("inspector.display_name.network_ref_name",o):this.t("inspector.display_name.ref_name",o);if(n)return n;let a=[];return o.network&&a.push("network"),o.ref&&a.push("ref"),s&&(o.direction?a.push("direction"):o.from&&o.to&&(a.push("from"),a.push("to"),o.via&&a.push("via"))),a.length?this.t("inspector.display_name."+a.join("_"),o):""}displayPOIName(e){var r,s,n,o,a,l;let t=this._currLanguageCode.toLowerCase();return(l=(a=(o=(n=(s=(r=e[`name:${t}`])!=null?r:e.name)!=null?s:e[`brand:${t}`])!=null?n:e.brand)!=null?o:e[`operator:${t}`])!=null?a:e.operator)!=null?l:""}displayType(e){return{n:this.t("inspector.node"),w:this.t("inspector.way"),r:this.t("inspector.relation")}[e.charAt(0)]}displayLabel(e,t,r){let s=this.displayName(e.tags),n=this.context.systems.presets,o=typeof t=="string"?n.matchTags(e.tags,t):n.match(e,t),a=o&&(o.suggestion?o.subtitle():o.name()),l;return r?l=[a,s].filter(Boolean).join(" "):l=s||a,l!=null?l:this.displayType(e.id)}displayLength(e,t){let r=this._currLocaleCode,s=e*(t?3.28084:1),n;return t?s>=5280?(s/=5280,n="miles"):n="feet":s>=1e3?(s/=1e3,n="kilometers"):n="meters",this.t(`units.${n}`,{quantity:s.toLocaleString(r,{maximumSignificantDigits:4})})}displayArea(e,t){let r=this._currLocaleCode,s=e*(t?10.7639111056:1),n,o,a,l;t?(s>=6969600?(n=s/27878400,a="square_miles"):(n=s,a="square_feet"),s>4356&&s<4356e4&&(o=s/43560,l="acres")):(s>=25e4?(n=s/1e6,a="square_kilometers"):(n=s,a="square_meters"),s>1e3&&s<1e7&&(o=s/1e4,l="hectares"));let c=this.t(`units.${a}`,{quantity:n.toLocaleString(r,{maximumSignificantDigits:4})});if(l){let u=this.t(`units.${l}`,{quantity:o.toLocaleString(r,{maximumSignificantDigits:2})});return this.t("units.area_pair",{area1:c,area2:u})}else return c}dmsCoordinatePair(e){return this.t("units.coordinate_pair",{latitude:this._displayCoordinate(aE(e[1],-90,90),"north","south"),longitude:this._displayCoordinate(oE(e[0],-180,180),"east","west")})}decimalCoordinatePair(e){return this.t("units.coordinate_pair",{latitude:aE(e[1],-90,90).toFixed(7),longitude:oE(e[0],-180,180).toFixed(7)})}_displayCoordinate(e,t,r){let s=this._currLocaleCode,n=(Math.abs(e)-Math.floor(Math.abs(e)))*60,o=(n-Math.floor(n))*60,a=this.t("units.arcdegrees",{quantity:Math.floor(Math.abs(e)).toLocaleString(s)}),l;return Math.floor(o)>0?l=a+this.t("units.arcminutes",{quantity:Math.floor(n).toLocaleString(s)})+this.t("units.arcseconds",{quantity:Math.round(o).toLocaleString(s)}):Math.floor(n)>0?l=a+this.t("units.arcminutes",{quantity:Math.round(n).toLocaleString(s)}):l=this.t("units.arcdegrees",{quantity:Math.round(Math.abs(e)).toLocaleString(s)}),e===0?l:this.t("units.coordinate",{coordinate:l,direction:this.t("units."+(e>0?t:r))})}_localesToUseFrom(e){let t=new Set;return e.forEach(r=>{if(this._supportedLocales[r]&&t.add(r),r.includes("-")){let s=r.split("-")[0];this._supportedLocales[s]&&t.add(s)}}),Array.from(t)}_updateForCurrentLocale(){if(!this._currLocaleCode)return;let[e,t]=this._currLocaleCode.toLowerCase().split("-",2);this._currLanguageCode=e,this._currIsMetric=t!=="us";let s=this.context.systems.urlhash.initialHashParams.get("rtl");if(s==="true")this._currTextDirection="rtl";else if(s==="false")this._currTextDirection="ltr";else{let o=this._supportedLocales[this._currLocaleCode]||this._supportedLocales[this._currLanguageCode];this._currTextDirection=o&&o.rtl?"rtl":"ltr"}let n=this._currLocaleCode;n.toLowerCase()==="en-us"&&(n="en"),this._languageNames=this._cache.general[n].languageNames,this._scriptNames=this._cache.general[n].scriptNames}};var lE=et(G2(),1),ZF={type:"FeatureCollection",features:[{type:"Feature",properties:{wikidata:"Q21",nameEn:"England",aliases:["GB-ENG"],country:"GB",groups:["Q23666","Q3336843","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44"]},geometry:{type:"MultiPolygon",coordinates:[[[[-6.03913,51.13217],[-7.74976,48.64773],[1.17405,50.74239],[2.18458,51.52087],[2.56575,51.85301],[.792,57.56437],[-2.30613,55.62698],[-2.17058,55.45916],[-2.6095,55.28488],[-2.63532,55.19452],[-3.02906,55.04606],[-3.09361,54.94924],[-3.38407,54.94278],[-4.1819,54.57861],[-3.5082,53.54318],[-3.08228,53.25526],[-3.03675,53.25092],[-2.92329,53.19383],[-2.92022,53.17685],[-2.98598,53.15589],[-2.90649,53.10964],[-2.87469,53.12337],[-2.89131,53.09374],[-2.83133,52.99184],[-2.7251,52.98389],[-2.72221,52.92969],[-2.80549,52.89428],[-2.85897,52.94487],[-2.92401,52.93836],[-2.97243,52.9651],[-3.13576,52.895],[-3.15744,52.84947],[-3.16105,52.79599],[-3.08734,52.77504],[-3.01001,52.76636],[-2.95581,52.71794],[-3.01724,52.72083],[-3.04398,52.65435],[-3.13648,52.58208],[-3.12926,52.5286],[-3.09746,52.53077],[-3.08662,52.54811],[-3.00929,52.57774],[-2.99701,52.551],[-3.03603,52.49969],[-3.13359,52.49174],[-3.22971,52.45344],[-3.22754,52.42526],[-3.04687,52.34504],[-2.95364,52.3501],[-2.99701,52.323],[-3.00785,52.2753],[-3.09289,52.20546],[-3.12638,52.08114],[-2.97111,51.90456],[-2.8818,51.93196],[-2.78742,51.88833],[-2.74277,51.84367],[-2.66234,51.83555],[-2.66336,51.59504],[-3.20563,51.31615],[-6.03913,51.13217]]]]}},{type:"Feature",properties:{wikidata:"Q22",nameEn:"Scotland",aliases:["GB-SCT"],country:"GB",groups:["Q23666","Q3336843","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44"]},geometry:{type:"MultiPolygon",coordinates:[[[[.792,57.56437],[-.3751,61.32236],[-14.78497,57.60709],[-6.82333,55.83103],[-4.69044,54.3629],[-3.38407,54.94278],[-3.09361,54.94924],[-3.02906,55.04606],[-2.63532,55.19452],[-2.6095,55.28488],[-2.17058,55.45916],[-2.30613,55.62698],[.792,57.56437]]]]}},{type:"Feature",properties:{wikidata:"Q25",nameEn:"Wales",aliases:["GB-WLS"],country:"GB",groups:["Q23666","Q3336843","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44"]},geometry:{type:"MultiPolygon",coordinates:[[[[-3.5082,53.54318],[-5.37267,53.63269],[-6.03913,51.13217],[-3.20563,51.31615],[-2.66336,51.59504],[-2.66234,51.83555],[-2.74277,51.84367],[-2.78742,51.88833],[-2.8818,51.93196],[-2.97111,51.90456],[-3.12638,52.08114],[-3.09289,52.20546],[-3.00785,52.2753],[-2.99701,52.323],[-2.95364,52.3501],[-3.04687,52.34504],[-3.22754,52.42526],[-3.22971,52.45344],[-3.13359,52.49174],[-3.03603,52.49969],[-2.99701,52.551],[-3.00929,52.57774],[-3.08662,52.54811],[-3.09746,52.53077],[-3.12926,52.5286],[-3.13648,52.58208],[-3.04398,52.65435],[-3.01724,52.72083],[-2.95581,52.71794],[-3.01001,52.76636],[-3.08734,52.77504],[-3.16105,52.79599],[-3.15744,52.84947],[-3.13576,52.895],[-2.97243,52.9651],[-2.92401,52.93836],[-2.85897,52.94487],[-2.80549,52.89428],[-2.72221,52.92969],[-2.7251,52.98389],[-2.83133,52.99184],[-2.89131,53.09374],[-2.87469,53.12337],[-2.90649,53.10964],[-2.98598,53.15589],[-2.92022,53.17685],[-2.92329,53.19383],[-3.03675,53.25092],[-3.08228,53.25526],[-3.5082,53.54318]]]]}},{type:"Feature",properties:{wikidata:"Q26",nameEn:"Northern Ireland",aliases:["GB-NIR"],country:"GB",groups:["Q22890","Q3336843","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44"]},geometry:{type:"MultiPolygon",coordinates:[[[[-6.34755,55.49206],[-7.2471,55.06933],[-7.34464,55.04688],[-7.4033,55.00391],[-7.40004,54.94498],[-7.44404,54.9403],[-7.4473,54.87003],[-7.47626,54.83084],[-7.54508,54.79401],[-7.54671,54.74606],[-7.64449,54.75265],[-7.75041,54.7103],[-7.83352,54.73854],[-7.93293,54.66603],[-7.70315,54.62077],[-7.8596,54.53671],[-7.99812,54.54427],[-8.04538,54.48941],[-8.179,54.46763],[-8.04555,54.36292],[-7.87101,54.29299],[-7.8596,54.21779],[-7.81397,54.20159],[-7.69501,54.20731],[-7.55812,54.12239],[-7.4799,54.12239],[-7.44567,54.1539],[-7.32834,54.11475],[-7.30553,54.11869],[-7.34005,54.14698],[-7.29157,54.17191],[-7.28017,54.16714],[-7.29687,54.1354],[-7.29493,54.12013],[-7.26316,54.13863],[-7.25012,54.20063],[-7.14908,54.22732],[-7.19145,54.31296],[-7.02034,54.4212],[-6.87775,54.34682],[-6.85179,54.29176],[-6.81583,54.22791],[-6.74575,54.18788],[-6.70175,54.20218],[-6.6382,54.17071],[-6.66264,54.0666],[-6.62842,54.03503],[-6.47849,54.06947],[-6.36605,54.07234],[-6.36279,54.11248],[-6.32694,54.09337],[-6.29003,54.11278],[-6.26218,54.09785],[-5.83481,53.87749],[-4.69044,54.3629],[-6.34755,55.49206]]]]}},{type:"Feature",properties:{wikidata:"Q35",nameEn:"Denmark",country:"DK",groups:["EU","154","150","UN"],callingCodes:["45"]},geometry:{type:"MultiPolygon",coordinates:[[[[12.16597,56.60205],[10.40861,58.38489],[7.28637,57.35913],[8.02459,55.09613],[8.45719,55.06747],[8.55769,54.91837],[8.63979,54.91069],[8.76387,54.8948],[8.81178,54.90518],[8.92795,54.90452],[9.04629,54.87249],[9.14275,54.87421],[9.20571,54.85841],[9.24631,54.84726],[9.23445,54.83432],[9.2474,54.8112],[9.32771,54.80602],[9.33849,54.80233],[9.36496,54.81749],[9.38532,54.83968],[9.41213,54.84254],[9.43155,54.82586],[9.4659,54.83131],[9.58937,54.88785],[9.62734,54.88057],[9.61187,54.85548],[9.73563,54.8247],[9.89314,54.84171],[10.16755,54.73883],[10.31111,54.65968],[11.00303,54.63689],[11.90309,54.38543],[12.85844,54.82438],[13.93395,54.84044],[15.36991,54.73263],[15.79951,55.54655],[14.89259,55.5623],[14.28399,55.1553],[12.84405,55.13257],[12.60345,55.42675],[12.88472,55.63369],[12.6372,55.91371],[12.65312,56.04345],[12.07466,56.29488],[12.16597,56.60205]]]]}},{type:"Feature",properties:{wikidata:"Q55",nameEn:"Netherlands",country:"NL",groups:["EU","155","150","UN"],callingCodes:["31"]},geometry:{type:"MultiPolygon",coordinates:[[[[5.45168,54.20039],[2.56575,51.85301],[3.36263,51.37112],[3.38696,51.33436],[3.35847,51.31572],[3.38289,51.27331],[3.41704,51.25933],[3.43488,51.24135],[3.52698,51.2458],[3.51502,51.28697],[3.58939,51.30064],[3.78999,51.25766],[3.78783,51.2151],[3.90125,51.20371],[3.97889,51.22537],[4.01957,51.24504],[4.05165,51.24171],[4.16721,51.29348],[4.24024,51.35371],[4.21923,51.37443],[4.33265,51.37687],[4.34086,51.35738],[4.39292,51.35547],[4.43777,51.36989],[4.38064,51.41965],[4.39747,51.43316],[4.38122,51.44905],[4.47736,51.4778],[4.5388,51.48184],[4.54675,51.47265],[4.52846,51.45002],[4.53521,51.4243],[4.57489,51.4324],[4.65442,51.42352],[4.72935,51.48424],[4.74578,51.48937],[4.77321,51.50529],[4.78803,51.50284],[4.84139,51.4799],[4.82409,51.44736],[4.82946,51.4213],[4.78314,51.43319],[4.76577,51.43046],[4.77229,51.41337],[4.78941,51.41102],[4.84988,51.41502],[4.90016,51.41404],[4.92152,51.39487],[5.00393,51.44406],[5.0106,51.47167],[5.03281,51.48679],[5.04774,51.47022],[5.07891,51.4715],[5.10456,51.43163],[5.07102,51.39469],[5.13105,51.34791],[5.13377,51.31592],[5.16222,51.31035],[5.2002,51.32243],[5.24244,51.30495],[5.22542,51.26888],[5.23814,51.26064],[5.26461,51.26693],[5.29716,51.26104],[5.33886,51.26314],[5.347,51.27502],[5.41672,51.26248],[5.4407,51.28169],[5.46519,51.2849],[5.48476,51.30053],[5.515,51.29462],[5.5569,51.26544],[5.5603,51.22249],[5.65145,51.19788],[5.65528,51.18736],[5.70344,51.1829],[5.74617,51.18928],[5.77735,51.17845],[5.77697,51.1522],[5.82564,51.16753],[5.85508,51.14445],[5.80798,51.11661],[5.8109,51.10861],[5.83226,51.10585],[5.82921,51.09328],[5.79903,51.09371],[5.79835,51.05834],[5.77258,51.06196],[5.75961,51.03113],[5.77688,51.02483],[5.76242,50.99703],[5.71864,50.96092],[5.72875,50.95428],[5.74752,50.96202],[5.75927,50.95601],[5.74644,50.94723],[5.72545,50.92312],[5.72644,50.91167],[5.71626,50.90796],[5.69858,50.91046],[5.67886,50.88142],[5.64504,50.87107],[5.64009,50.84742],[5.65259,50.82309],[5.70118,50.80764],[5.68995,50.79641],[5.70107,50.7827],[5.68091,50.75804],[5.69469,50.75529],[5.72216,50.76398],[5.73904,50.75674],[5.74356,50.7691],[5.76533,50.78159],[5.77513,50.78308],[5.80673,50.7558],[5.84548,50.76542],[5.84888,50.75448],[5.88734,50.77092],[5.89129,50.75125],[5.89132,50.75124],[5.95942,50.7622],[5.97545,50.75441],[6.01976,50.75398],[6.02624,50.77453],[5.97497,50.79992],[5.98404,50.80988],[6.00462,50.80065],[6.02328,50.81694],[6.01921,50.84435],[6.05623,50.8572],[6.05702,50.85179],[6.07431,50.84674],[6.07693,50.86025],[6.08805,50.87223],[6.07486,50.89307],[6.09297,50.92066],[6.01615,50.93367],[6.02697,50.98303],[5.95282,50.98728],[5.90296,50.97356],[5.90493,51.00198],[5.87849,51.01969],[5.86735,51.05182],[5.9134,51.06736],[5.9541,51.03496],[5.98292,51.07469],[6.16706,51.15677],[6.17384,51.19589],[6.07889,51.17038],[6.07889,51.24432],[6.16977,51.33169],[6.22674,51.36135],[6.22641,51.39948],[6.20654,51.40049],[6.21724,51.48568],[6.18017,51.54096],[6.09055,51.60564],[6.11759,51.65609],[6.02767,51.6742],[6.04091,51.71821],[5.95003,51.7493],[5.98665,51.76944],[5.94568,51.82786],[5.99848,51.83195],[6.06705,51.86136],[6.10337,51.84829],[6.16902,51.84094],[6.11551,51.89769],[6.15349,51.90439],[6.21443,51.86801],[6.29872,51.86801],[6.30593,51.84998],[6.40704,51.82771],[6.38815,51.87257],[6.47179,51.85395],[6.50231,51.86313],[6.58556,51.89386],[6.68386,51.91861],[6.72319,51.89518],[6.82357,51.96711],[6.83035,51.9905],[6.68128,52.05052],[6.76117,52.11895],[6.83984,52.11728],[6.97189,52.20329],[6.9897,52.2271],[7.03729,52.22695],[7.06365,52.23789],[7.02703,52.27941],[7.07044,52.37805],[7.03417,52.40237],[6.99041,52.47235],[6.94293,52.43597],[6.69507,52.488],[6.71641,52.62905],[6.77307,52.65375],[7.04557,52.63318],[7.07253,52.81083],[7.21694,53.00742],[7.17898,53.13817],[7.22681,53.18165],[7.21679,53.20058],[7.19052,53.31866],[7.00198,53.32672],[6.91025,53.44221],[5.45168,54.20039]],[[4.93295,51.44945],[4.95244,51.45207],[4.9524,51.45014],[4.93909,51.44632],[4.93295,51.44945]],[[4.91493,51.4353],[4.91935,51.43634],[4.92227,51.44252],[4.91811,51.44621],[4.92287,51.44741],[4.92811,51.4437],[4.92566,51.44273],[4.92815,51.43856],[4.92879,51.44161],[4.93544,51.44634],[4.94025,51.44193],[4.93416,51.44185],[4.93471,51.43861],[4.94265,51.44003],[4.93986,51.43064],[4.92952,51.42984],[4.92652,51.43329],[4.91493,51.4353]]]]}},{type:"Feature",properties:{wikidata:"Q782",nameEn:"Hawaii",aliases:["US-HI"],country:"US",groups:["Q35657","061","009","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-177.8563,29.18961],[-179.49839,27.86265],[-151.6784,9.55515],[-154.05867,45.51124],[-177.5224,27.7635],[-177.8563,29.18961]]]]}},{type:"Feature",properties:{wikidata:"Q797",nameEn:"Alaska",aliases:["US-AK"],country:"US",groups:["Q35657","021","003","019","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[169.34848,52.47228],[180,51.0171],[179.84401,55.10087],[169.34848,52.47228]]],[[[-168.95635,65.98512],[-169.03888,65.48473],[-172.76104,63.77445],[-179.55295,57.62081],[-179.55295,50.81807],[-133.92876,54.62289],[-130.61931,54.70835],[-130.64499,54.76912],[-130.44184,54.85377],[-130.27203,54.97174],[-130.18765,55.07744],[-130.08035,55.21556],[-129.97513,55.28029],[-130.15373,55.74895],[-130.00857,55.91344],[-130.00093,56.00325],[-130.10173,56.12178],[-130.33965,56.10849],[-130.77769,56.36185],[-131.8271,56.62247],[-133.38523,58.42773],[-133.84645,58.73543],[-134.27175,58.8634],[-134.48059,59.13231],[-134.55699,59.1297],[-134.7047,59.2458],[-135.00267,59.28745],[-135.03069,59.56208],[-135.48007,59.79937],[-136.31566,59.59083],[-136.22381,59.55526],[-136.33727,59.44466],[-136.47323,59.46617],[-136.52365,59.16752],[-136.82619,59.16198],[-137.4925,58.89415],[-137.60623,59.24465],[-138.62145,59.76431],[-138.71149,59.90728],[-139.05365,59.99655],[-139.20603,60.08896],[-139.05831,60.35205],[-139.68991,60.33693],[-139.98024,60.18027],[-140.45648,60.30919],[-140.5227,60.22077],[-141.00116,60.30648],[-140.97446,84.39275],[-168.25765,71.99091],[-168.95635,65.98512]]]]}},{type:"Feature",properties:{wikidata:"Q3492",nameEn:"Sumatra",aliases:["ID-SM"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[109.82788,2.86812],[110.90339,7.52694],[105.01437,3.24936],[104.56723,1.44271],[104.34728,1.33529],[104.12282,1.27714],[104.03085,1.26954],[103.74084,1.12902],[103.66049,1.18825],[103.56591,1.19719],[103.03657,1.30383],[96.11174,6.69841],[74.28481,-3.17525],[102.92489,-8.17146],[106.32259,-5.50116],[106.38511,-5.16715],[109.17017,-4.07401],[109.3962,-2.07276],[108.50935,-2.01066],[107.94791,1.06924],[109.82788,2.86812]]]]}},{type:"Feature",properties:{wikidata:"Q3757",nameEn:"Java",aliases:["ID-JW"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[109.17017,-4.07401],[106.38511,-5.16715],[106.32259,-5.50116],[102.92489,-8.17146],[116.22542,-10.49172],[114.39575,-8.2889],[114.42235,-8.09762],[114.92859,-7.49253],[116.33992,-7.56171],[116.58433,-5.30385],[109.17017,-4.07401]]]]}},{type:"Feature",properties:{wikidata:"Q3795",nameEn:"Kalimantan",aliases:["ID-KA"],country:"ID",groups:["Q36117","035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[120.02464,2.83703],[118.06469,4.16638],[117.67641,4.16535],[117.47313,4.18857],[117.25801,4.35108],[115.90217,4.37708],[115.58276,3.93499],[115.53713,3.14776],[115.11343,2.82879],[115.1721,2.49671],[114.80706,2.21665],[114.80706,1.92351],[114.57892,1.5],[114.03788,1.44787],[113.64677,1.23933],[113.01448,1.42832],[113.021,1.57819],[112.48648,1.56516],[112.2127,1.44135],[112.15679,1.17004],[111.94553,1.12016],[111.82846,.99349],[111.55434,.97864],[111.22979,1.08326],[110.62374,.873],[110.49182,.88088],[110.35354,.98869],[109.66397,1.60425],[109.66397,1.79972],[109.57923,1.80624],[109.53794,1.91771],[109.62558,1.99182],[109.82788,2.86812],[107.94791,1.06924],[108.50935,-2.01066],[109.3962,-2.07276],[109.17017,-4.07401],[116.58433,-5.30385],[120.02464,2.83703]]]]}},{type:"Feature",properties:{wikidata:"Q3803",nameEn:"Lesser Sunda Islands",aliases:["ID-NU"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[116.96967,-8.01483],[114.92859,-7.49253],[114.42235,-8.09762],[114.39575,-8.2889],[116.22542,-10.49172],[122.14954,-11.52517],[125.68138,-9.85176],[125.09025,-9.46406],[124.97892,-9.19281],[125.04044,-9.17093],[125.09434,-9.19669],[125.18907,-9.16434],[125.18632,-9.03142],[125.11764,-8.96359],[124.97742,-9.08128],[124.94011,-8.85617],[124.46701,-9.13002],[124.45971,-9.30263],[124.38554,-9.3582],[124.35258,-9.43002],[124.3535,-9.48493],[124.28115,-9.50453],[124.28115,-9.42189],[124.21247,-9.36904],[124.14517,-9.42324],[124.10539,-9.41206],[124.04286,-9.34243],[124.04628,-9.22671],[124.33472,-9.11416],[124.92337,-8.75859],[125.87688,-7.49892],[116.96967,-8.01483]]]]}},{type:"Feature",properties:{wikidata:"Q3812",nameEn:"Sulawesi",aliases:["ID-SL"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[128.34321,3.90322],[126.69413,6.02692],[119.56457,.90759],[116.58433,-5.30385],[116.33992,-7.56171],[116.96967,-8.01483],[125.87688,-7.49892],[123.78965,-.86805],[128.34321,3.90322]]]]}},{type:"Feature",properties:{wikidata:"Q3827",nameEn:"Maluku Islands",aliases:["ID-ML"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[129.63187,2.21409],[128.34321,3.90322],[123.78965,-.86805],[125.87688,-7.49892],[125.58506,-7.95311],[125.87691,-8.31789],[127.42116,-8.22471],[127.55165,-9.05052],[135.49042,-9.2276],[135.35517,-5.01442],[132.8312,-4.70282],[130.8468,-2.61103],[128.40647,-2.30349],[129.71519,-.24692],[129.63187,2.21409]]]]}},{type:"Feature",properties:{wikidata:"Q3845",nameEn:"Western New Guinea",aliases:["ID-PP"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[135.49042,-9.2276],[141.01842,-9.35091],[141.01763,-6.90181],[140.90448,-6.85033],[140.85295,-6.72996],[140.99813,-6.3233],[141.02352,.08993],[129.63187,2.21409],[129.71519,-.24692],[128.40647,-2.30349],[130.8468,-2.61103],[132.8312,-4.70282],[135.35517,-5.01442],[135.49042,-9.2276]]]]}},{type:"Feature",properties:{wikidata:"Q5765",nameEn:"Balearic Islands",aliases:["ES-IB"],country:"ES",groups:["EU","039","150","UN"],callingCodes:["34 971"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.27707,35.35051],[5.10072,39.89531],[3.75438,42.33445],[-2.27707,35.35051]]]]}},{type:"Feature",properties:{wikidata:"Q5823",nameEn:"Ceuta",aliases:["ES-CE"],country:"ES",groups:["EA","EU","015","002","UN"],level:"subterritory",callingCodes:["34"]},geometry:{type:"MultiPolygon",coordinates:[[[[-5.38491,35.92591],[-5.37338,35.88417],[-5.35844,35.87375],[-5.34379,35.8711],[-5.21179,35.90091],[-5.38491,35.92591]]]]}},{type:"Feature",properties:{wikidata:"Q5831",nameEn:"Melilla",aliases:["ES-ML"],country:"ES",groups:["EA","EU","015","002","UN"],level:"subterritory",callingCodes:["34"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.91909,35.33927],[-2.96038,35.31609],[-2.96648,35.30475],[-2.96978,35.29459],[-2.97035,35.28852],[-2.96507,35.28801],[-2.96826,35.28296],[-2.96516,35.27967],[-2.95431,35.2728],[-2.95065,35.26576],[-2.93893,35.26737],[-2.92272,35.27509],[-2.91909,35.33927]]]]}},{type:"Feature",properties:{wikidata:"Q7835",nameEn:"Crimea",country:"RU",groups:["151","150","UN"],level:"subterritory",callingCodes:["7"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.5,44],[36.4883,45.0488],[36.475,45.2411],[36.5049,45.3136],[36.6545,45.3417],[36.6645,45.4514],[35.0498,45.7683],[34.9601,45.7563],[34.7991,45.8101],[34.8015,45.9005],[34.7548,45.907],[34.6668,45.9714],[34.6086,45.9935],[34.5589,45.9935],[34.5201,45.951],[34.4873,45.9427],[34.4415,45.9599],[34.4122,46.0025],[34.3391,46.0611],[34.2511,46.0532],[34.181,46.068],[34.1293,46.1049],[34.0731,46.1177],[34.0527,46.1084],[33.9155,46.1594],[33.8523,46.1986],[33.7972,46.2048],[33.7405,46.1855],[33.646,46.2303],[33.6152,46.2261],[33.6385,46.1415],[33.6147,46.1356],[33.5732,46.1032],[33.5909,46.0601],[33.5597,46.0307],[31.5,45.5],[33.5,44]]]]}},{type:"Feature",properties:{wikidata:"Q12837",nameEn:"Iberia",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q14056",nameEn:"Jan Mayen",aliases:["NO-22"],country:"NO",groups:["SJ","154","150","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[-9.18243,72.23144],[-10.71459,70.09565],[-5.93364,70.76368],[-9.18243,72.23144]]]]}},{type:"Feature",properties:{wikidata:"Q19188",nameEn:"Mainland China",country:"CN",groups:["030","142","UN"],callingCodes:["86"]},geometry:{type:"MultiPolygon",coordinates:[[[[125.6131,53.07229],[125.17522,53.20225],[124.46078,53.21881],[123.86158,53.49391],[123.26989,53.54843],[122.85966,53.47395],[122.35063,53.49565],[121.39213,53.31888],[120.85633,53.28499],[120.0451,52.7359],[120.04049,52.58773],[120.46454,52.63811],[120.71673,52.54099],[120.61346,52.32447],[120.77337,52.20805],[120.65907,51.93544],[120.10963,51.671],[119.13553,50.37412],[119.38598,50.35162],[119.27996,50.13348],[119.11003,50.00276],[118.61623,49.93809],[117.82343,49.52696],[117.48208,49.62324],[117.27597,49.62544],[116.71193,49.83813],[116.03781,48.87014],[116.06565,48.81716],[115.78876,48.51781],[115.811,48.25699],[115.52082,48.15367],[115.57128,47.91988],[115.94296,47.67741],[116.21879,47.88505],[116.4465,47.83662],[116.67405,47.89039],[116.9723,47.87285],[117.37875,47.63627],[117.50181,47.77216],[117.80196,48.01661],[118.03676,48.00982],[118.11009,48.04],[118.22677,48.03853],[118.29654,48.00246],[118.55766,47.99277],[118.7564,47.76947],[119.12343,47.66458],[119.13995,47.53997],[119.35892,47.48104],[119.31964,47.42617],[119.54918,47.29505],[119.56019,47.24874],[119.62403,47.24575],[119.71209,47.19192],[119.85518,46.92196],[119.91242,46.90091],[119.89261,46.66423],[119.80455,46.67631],[119.77373,46.62947],[119.68127,46.59015],[119.65265,46.62342],[119.42827,46.63783],[119.32827,46.61433],[119.24978,46.64761],[119.10448,46.65516],[119.00541,46.74273],[118.92616,46.72765],[118.89974,46.77139],[118.8337,46.77742],[118.78747,46.68689],[118.30534,46.73519],[117.69554,46.50991],[117.60748,46.59771],[117.41782,46.57862],[117.36609,46.36335],[116.83166,46.38637],[116.75551,46.33083],[116.58612,46.30211],[116.26678,45.96479],[116.24012,45.8778],[116.27366,45.78637],[116.16989,45.68603],[115.60329,45.44717],[114.94546,45.37377],[114.74612,45.43585],[114.54801,45.38337],[114.5166,45.27189],[113.70918,44.72891],[112.74662,44.86297],[112.4164,45.06858],[111.98695,45.09074],[111.76275,44.98032],[111.40498,44.3461],[111.96289,43.81596],[111.93776,43.68709],[111.79758,43.6637],[111.59087,43.51207],[111.0149,43.3289],[110.4327,42.78293],[110.08401,42.6411],[109.89402,42.63111],[109.452,42.44842],[109.00679,42.45302],[108.84489,42.40246],[107.57258,42.40898],[107.49681,42.46221],[107.29755,42.41395],[107.24774,42.36107],[106.76517,42.28741],[105.0123,41.63188],[104.51667,41.66113],[104.52258,41.8706],[103.92804,41.78246],[102.72403,42.14675],[102.07645,42.22519],[101.80515,42.50074],[100.84979,42.67087],[100.33297,42.68231],[99.50671,42.56535],[97.1777,42.7964],[96.37926,42.72055],[96.35658,42.90363],[95.89543,43.2528],[95.52594,43.99353],[95.32891,44.02407],[95.39772,44.2805],[95.01191,44.25274],[94.71959,44.35284],[94.10003,44.71016],[93.51161,44.95964],[91.64048,45.07408],[90.89169,45.19667],[90.65114,45.49314],[90.70907,45.73437],[91.03026,46.04194],[90.99672,46.14207],[90.89639,46.30711],[91.07696,46.57315],[91.0147,46.58171],[91.03649,46.72916],[90.84035,46.99525],[90.76108,46.99399],[90.48542,47.30438],[90.48854,47.41826],[90.33598,47.68303],[90.10871,47.7375],[90.06512,47.88177],[89.76624,47.82745],[89.55453,48.0423],[89.0711,47.98528],[88.93186,48.10263],[88.8011,48.11302],[88.58316,48.21893],[88.58939,48.34531],[87.96361,48.58478],[88.0788,48.71436],[87.73822,48.89582],[87.88171,48.95853],[87.81333,49.17354],[87.48983,49.13794],[87.478,49.07403],[87.28386,49.11626],[86.87238,49.12432],[86.73568,48.99918],[86.75343,48.70331],[86.38069,48.46064],[85.73581,48.3939],[85.5169,48.05493],[85.61067,47.49753],[85.69696,47.2898],[85.54294,47.06171],[85.22443,47.04816],[84.93995,46.87399],[84.73077,47.01394],[83.92184,46.98912],[83.04622,47.19053],[82.21792,45.56619],[82.58474,45.40027],[82.51374,45.1755],[81.73278,45.3504],[80.11169,45.03352],[79.8987,44.89957],[80.38384,44.63073],[80.40229,44.23319],[80.40031,44.10986],[80.75156,43.44948],[80.69718,43.32589],[80.77771,43.30065],[80.78817,43.14235],[80.62913,43.141],[80.3735,43.01557],[80.58999,42.9011],[80.38169,42.83142],[80.26886,42.8366],[80.16892,42.61137],[80.26841,42.23797],[80.17807,42.21166],[80.17842,42.03211],[79.92977,42.04113],[78.3732,41.39603],[78.15757,41.38565],[78.12873,41.23091],[77.81287,41.14307],[77.76206,41.01574],[77.52723,41.00227],[77.3693,41.0375],[77.28004,41.0033],[76.99302,41.0696],[76.75681,40.95354],[76.5261,40.46114],[76.33659,40.3482],[75.96168,40.38064],[75.91361,40.2948],[75.69663,40.28642],[75.5854,40.66874],[75.22834,40.45382],[75.08243,40.43945],[74.82013,40.52197],[74.78168,40.44886],[74.85996,40.32857],[74.69875,40.34668],[74.35063,40.09742],[74.25533,40.13191],[73.97049,40.04378],[73.83006,39.76136],[73.9051,39.75073],[73.92354,39.69565],[73.94683,39.60733],[73.87018,39.47879],[73.59831,39.46425],[73.59241,39.40843],[73.5004,39.38402],[73.55396,39.3543],[73.54572,39.27567],[73.60638,39.24534],[73.75823,39.023],[73.81728,39.04007],[73.82964,38.91517],[73.7445,38.93867],[73.7033,38.84782],[73.80656,38.66449],[73.79806,38.61106],[73.97933,38.52945],[74.17022,38.65504],[74.51217,38.47034],[74.69619,38.42947],[74.69894,38.22155],[74.80331,38.19889],[74.82665,38.07359],[74.9063,38.03033],[74.92416,37.83428],[75.00935,37.77486],[74.8912,37.67576],[74.94338,37.55501],[75.06011,37.52779],[75.15899,37.41443],[75.09719,37.37297],[75.12328,37.31839],[74.88887,37.23275],[74.80605,37.21565],[74.49981,37.24518],[74.56453,37.03023],[75.13839,37.02622],[75.40481,36.95382],[75.45562,36.71971],[75.72737,36.7529],[75.92391,36.56986],[76.0324,36.41198],[76.00906,36.17511],[75.93028,36.13136],[76.15325,35.9264],[76.14913,35.82848],[76.33453,35.84296],[76.50961,35.8908],[76.77323,35.66062],[76.84539,35.67356],[76.96624,35.5932],[77.44277,35.46132],[77.70232,35.46244],[77.80532,35.52058],[78.11664,35.48022],[78.03466,35.3785],[78.00033,35.23954],[78.22692,34.88771],[78.18435,34.7998],[78.27781,34.61484],[78.54964,34.57283],[78.56475,34.50835],[78.74465,34.45174],[79.05364,34.32482],[78.99802,34.3027],[78.91769,34.15452],[78.66225,34.08858],[78.65657,34.03195],[78.73367,34.01121],[78.77349,33.73871],[78.67599,33.66445],[78.73636,33.56521],[79.15252,33.17156],[79.14016,33.02545],[79.46562,32.69668],[79.26768,32.53277],[79.13174,32.47766],[79.0979,32.38051],[78.99322,32.37948],[78.96713,32.33655],[78.7831,32.46873],[78.73916,32.69438],[78.38897,32.53938],[78.4645,32.45367],[78.49609,32.2762],[78.68754,32.10256],[78.74404,32.00384],[78.78036,31.99478],[78.69933,31.78723],[78.84516,31.60631],[78.71032,31.50197],[78.77898,31.31209],[78.89344,31.30481],[79.01931,31.42817],[79.14016,31.43403],[79.30694,31.17357],[79.59884,30.93943],[79.93255,30.88288],[80.20721,30.58541],[80.54504,30.44936],[80.83343,30.32023],[81.03953,30.20059],[81.12842,30.01395],[81.24362,30.0126],[81.29032,30.08806],[81.2623,30.14596],[81.33355,30.15303],[81.39928,30.21862],[81.41018,30.42153],[81.5459,30.37688],[81.62033,30.44703],[81.99082,30.33423],[82.10135,30.35439],[82.10757,30.23745],[82.19475,30.16884],[82.16984,30.0692],[82.38622,30.02608],[82.5341,29.9735],[82.73024,29.81695],[83.07116,29.61957],[83.28131,29.56813],[83.44787,29.30513],[83.63156,29.16249],[83.82303,29.30513],[83.97559,29.33091],[84.18107,29.23451],[84.24801,29.02783],[84.2231,28.89571],[84.47528,28.74023],[84.62317,28.73887],[84.85511,28.58041],[85.06059,28.68562],[85.19135,28.62825],[85.18668,28.54076],[85.10729,28.34092],[85.38127,28.28336],[85.4233,28.32996],[85.59765,28.30529],[85.60854,28.25045],[85.69105,28.38475],[85.71907,28.38064],[85.74864,28.23126],[85.84672,28.18187],[85.90743,28.05144],[85.97813,27.99023],[85.94946,27.9401],[86.06309,27.90021],[86.12069,27.93047],[86.08333,28.02121],[86.088,28.09264],[86.18607,28.17364],[86.22966,27.9786],[86.42736,27.91122],[86.51609,27.96623],[86.56265,28.09569],[86.74181,28.10638],[86.75582,28.04182],[87.03757,27.94835],[87.11696,27.84104],[87.56996,27.84517],[87.72718,27.80938],[87.82681,27.95248],[88.13378,27.88015],[88.1278,27.95417],[88.25332,27.9478],[88.54858,28.06057],[88.63235,28.12356],[88.83559,28.01936],[88.88091,27.85192],[88.77517,27.45415],[88.82981,27.38814],[88.91901,27.32483],[88.93678,27.33777],[88.96947,27.30319],[89.00216,27.32532],[88.95355,27.4106],[88.97213,27.51671],[89.0582,27.60985],[89.12825,27.62502],[89.59525,28.16433],[89.79762,28.23979],[90.13387,28.19178],[90.58842,28.02838],[90.69894,28.07784],[91.20019,27.98715],[91.25779,28.07509],[91.46327,28.0064],[91.48973,27.93903],[91.5629,27.84823],[91.6469,27.76358],[91.84722,27.76325],[91.87057,27.7195],[92.27432,27.89077],[92.32101,27.79363],[92.42538,27.80092],[92.7275,27.98662],[92.73025,28.05814],[92.65472,28.07632],[92.67486,28.15018],[92.93075,28.25671],[93.14635,28.37035],[93.18069,28.50319],[93.44621,28.67189],[93.72797,28.68821],[94.35897,29.01965],[94.2752,29.11687],[94.69318,29.31739],[94.81353,29.17804],[95.0978,29.14446],[95.11291,29.09527],[95.2214,29.10727],[95.26122,29.07727],[95.3038,29.13847],[95.41091,29.13007],[95.50842,29.13487],[95.72086,29.20797],[95.75149,29.32063],[95.84899,29.31464],[96.05361,29.38167],[96.31316,29.18643],[96.18682,29.11087],[96.20467,29.02325],[96.3626,29.10607],[96.61391,28.72742],[96.40929,28.51526],[96.48895,28.42955],[96.6455,28.61657],[96.85561,28.4875],[96.88445,28.39452],[96.98882,28.32564],[97.1289,28.3619],[97.34547,28.21385],[97.41729,28.29783],[97.47085,28.2688],[97.50518,28.49716],[97.56835,28.55628],[97.70705,28.5056],[97.79632,28.33168],[97.90069,28.3776],[98.15337,28.12114],[98.13964,27.9478],[98.32641,27.51385],[98.42529,27.55404],[98.43353,27.67086],[98.69582,27.56499],[98.7333,26.85615],[98.77547,26.61994],[98.72741,26.36183],[98.67797,26.24487],[98.7329,26.17218],[98.66884,26.09165],[98.63128,26.15492],[98.57085,26.11547],[98.60763,26.01512],[98.70818,25.86241],[98.63128,25.79937],[98.54064,25.85129],[98.40606,25.61129],[98.31268,25.55307],[98.25774,25.6051],[98.16848,25.62739],[98.18084,25.56298],[98.12591,25.50722],[98.14925,25.41547],[97.92541,25.20815],[97.83614,25.2715],[97.77023,25.11492],[97.72216,25.08508],[97.72903,24.91332],[97.79949,24.85655],[97.76481,24.8289],[97.73127,24.83015],[97.70181,24.84557],[97.64354,24.79171],[97.56648,24.76475],[97.56383,24.75535],[97.5542,24.74943],[97.54675,24.74202],[97.56525,24.72838],[97.56286,24.54535],[97.52757,24.43748],[97.60029,24.4401],[97.66998,24.45288],[97.7098,24.35658],[97.65624,24.33781],[97.66723,24.30027],[97.71941,24.29652],[97.76799,24.26365],[97.72998,24.2302],[97.72799,24.18883],[97.75305,24.16902],[97.72903,24.12606],[97.62363,24.00506],[97.5247,23.94032],[97.64667,23.84574],[97.72302,23.89288],[97.79456,23.94836],[97.79416,23.95663],[97.84328,23.97603],[97.86545,23.97723],[97.88811,23.97446],[97.8955,23.97758],[97.89676,23.97931],[97.89683,23.98389],[97.88814,23.98605],[97.88414,23.99405],[97.88616,24.00463],[97.90998,24.02094],[97.93951,24.01953],[97.98691,24.03897],[97.99583,24.04932],[98.04709,24.07616],[98.05302,24.07408],[98.05671,24.07961],[98.0607,24.07812],[98.06703,24.08028],[98.07806,24.07988],[98.20666,24.11406],[98.54476,24.13119],[98.59256,24.08371],[98.85319,24.13042],[98.87998,24.15624],[98.89632,24.10612],[98.67797,23.9644],[98.68209,23.80492],[98.79607,23.77947],[98.82933,23.72921],[98.81775,23.694],[98.88396,23.59555],[98.80294,23.5345],[98.82877,23.47908],[98.87683,23.48995],[98.92104,23.36946],[98.87573,23.33038],[98.93958,23.31414],[98.92515,23.29535],[98.88597,23.18656],[99.05975,23.16382],[99.04601,23.12215],[99.25741,23.09025],[99.34127,23.13099],[99.52214,23.08218],[99.54218,22.90014],[99.43537,22.94086],[99.45654,22.85726],[99.31243,22.73893],[99.38247,22.57544],[99.37972,22.50188],[99.28771,22.4105],[99.17318,22.18025],[99.19176,22.16983],[99.1552,22.15874],[99.33166,22.09656],[99.47585,22.13345],[99.85351,22.04183],[99.96612,22.05965],[99.99084,21.97053],[99.94003,21.82782],[99.98654,21.71064],[100.04956,21.66843],[100.12679,21.70539],[100.17486,21.65306],[100.10757,21.59945],[100.12542,21.50365],[100.1625,21.48704],[100.18447,21.51898],[100.25863,21.47043],[100.35201,21.53176],[100.42892,21.54325],[100.4811,21.46148],[100.57861,21.45637],[100.72143,21.51898],[100.87265,21.67396],[101.11744,21.77659],[101.15156,21.56129],[101.2124,21.56422],[101.19349,21.41959],[101.26912,21.36482],[101.2229,21.23271],[101.29326,21.17254],[101.54563,21.25668],[101.6068,21.23329],[101.59491,21.18621],[101.60886,21.17947],[101.66977,21.20004],[101.70548,21.14911],[101.7622,21.14813],[101.79266,21.19025],[101.76745,21.21571],[101.83887,21.20983],[101.84412,21.25291],[101.74014,21.30967],[101.74224,21.48276],[101.7727,21.51794],[101.7475,21.5873],[101.80001,21.57461],[101.83257,21.61562],[101.74555,21.72852],[101.7791,21.83019],[101.62566,21.96574],[101.57525,22.13026],[101.60675,22.13513],[101.53638,22.24794],[101.56789,22.28876],[101.61306,22.27515],[101.68973,22.46843],[101.7685,22.50337],[101.86828,22.38397],[101.90714,22.38688],[101.91344,22.44417],[101.98487,22.42766],[102.03633,22.46164],[102.1245,22.43372],[102.14099,22.40092],[102.16621,22.43336],[102.26428,22.41321],[102.25339,22.4607],[102.41061,22.64184],[102.38415,22.67919],[102.42618,22.69212],[102.46665,22.77108],[102.51802,22.77969],[102.57095,22.7036],[102.60675,22.73376],[102.8636,22.60735],[102.9321,22.48659],[103.0722,22.44775],[103.07843,22.50097],[103.17961,22.55705],[103.15782,22.59873],[103.18895,22.64471],[103.28079,22.68063],[103.32282,22.8127],[103.43179,22.75816],[103.43646,22.70648],[103.52675,22.59155],[103.57812,22.65764],[103.56255,22.69499],[103.64506,22.79979],[103.87904,22.56683],[103.93286,22.52703],[103.94513,22.52553],[103.95191,22.5134],[103.96352,22.50584],[103.96783,22.51173],[103.97384,22.50634],[103.99247,22.51958],[104.01088,22.51823],[104.03734,22.72945],[104.11384,22.80363],[104.27084,22.8457],[104.25683,22.76534],[104.35593,22.69353],[104.47225,22.75813],[104.58122,22.85571],[104.60457,22.81841],[104.65283,22.83419],[104.72755,22.81984],[104.77114,22.90017],[104.84942,22.93631],[104.86765,22.95178],[104.8334,23.01484],[104.79478,23.12934],[104.87382,23.12854],[104.87992,23.17141],[104.91435,23.18666],[104.9486,23.17235],[104.96532,23.20463],[104.98712,23.19176],[105.07002,23.26248],[105.11672,23.25247],[105.17276,23.28679],[105.22569,23.27249],[105.32376,23.39684],[105.40782,23.28107],[105.42805,23.30824],[105.49966,23.20669],[105.56037,23.16806],[105.57594,23.075],[105.72382,23.06641],[105.8726,22.92756],[105.90119,22.94168],[105.99568,22.94178],[106.00179,22.99049],[106.19705,22.98475],[106.27022,22.87722],[106.34961,22.86718],[106.49749,22.91164],[106.51306,22.94891],[106.55976,22.92311],[106.60179,22.92884],[106.6516,22.86862],[106.6734,22.89587],[106.71387,22.88296],[106.71128,22.85982],[106.78422,22.81532],[106.81271,22.8226],[106.83685,22.8098],[106.82404,22.7881],[106.76293,22.73491],[106.72321,22.63606],[106.71698,22.58432],[106.65316,22.5757],[106.61269,22.60301],[106.58395,22.474],[106.55665,22.46498],[106.57221,22.37],[106.55976,22.34841],[106.6516,22.33977],[106.69986,22.22309],[106.67495,22.1885],[106.6983,22.15102],[106.70142,22.02409],[106.68274,21.99811],[106.69276,21.96013],[106.72551,21.97923],[106.74345,22.00965],[106.81038,21.97934],[106.9178,21.97357],[106.92714,21.93459],[106.97228,21.92592],[106.99252,21.95191],[107.05634,21.92303],[107.06101,21.88982],[107.00964,21.85948],[107.02615,21.81981],[107.10771,21.79879],[107.20734,21.71493],[107.24625,21.7077],[107.29296,21.74674],[107.35834,21.6672],[107.35989,21.60063],[107.38636,21.59774],[107.41593,21.64839],[107.47197,21.6672],[107.49532,21.62958],[107.49065,21.59774],[107.54047,21.5934],[107.56537,21.61945],[107.66967,21.60787],[107.80355,21.66141],[107.86114,21.65128],[107.90006,21.5905],[107.92652,21.58906],[107.95232,21.5388],[107.96774,21.53601],[107.97074,21.54072],[107.97383,21.53961],[107.97932,21.54503],[108.02926,21.54997],[108.0569,21.53604],[108.10003,21.47338],[108.00365,17.98159],[111.60491,13.57105],[118.41371,24.06775],[118.11703,24.39734],[118.28244,24.51231],[118.35291,24.51645],[118.42453,24.54644],[118.6333,24.46259],[119.42295,25.0886],[119.98511,25.37624],[119.78816,26.2348],[120.0693,26.3959],[120.5128,26.536],[121.03532,26.8787],[123.5458,31.01942],[122.29378,31.76513],[122.80525,33.30571],[123.85601,37.49093],[123.90497,38.79949],[124.17532,39.8232],[124.23201,39.9248],[124.35029,39.95639],[124.37089,40.03004],[124.3322,40.05573],[124.38556,40.11047],[124.40719,40.13655],[124.86913,40.45387],[125.71172,40.85223],[125.76869,40.87908],[126.00335,40.92835],[126.242,41.15454],[126.53189,41.35206],[126.60631,41.65565],[126.90729,41.79955],[127.17841,41.59714],[127.29712,41.49473],[127.92943,41.44291],[128.02633,41.42103],[128.03311,41.39232],[128.12967,41.37931],[128.18546,41.41279],[128.20061,41.40895],[128.30716,41.60322],[128.15119,41.74568],[128.04487,42.01769],[128.94007,42.03537],[128.96068,42.06657],[129.15178,42.17224],[129.22285,42.26491],[129.22423,42.3553],[129.28541,42.41574],[129.42882,42.44702],[129.54701,42.37254],[129.60482,42.44461],[129.72541,42.43739],[129.75294,42.59409],[129.77183,42.69435],[129.7835,42.76521],[129.80719,42.79218],[129.83277,42.86746],[129.85261,42.96494],[129.8865,43.00395],[129.95082,43.01051],[129.96409,42.97306],[130.12957,42.98361],[130.09764,42.91425],[130.26095,42.9027],[130.23068,42.80125],[130.2385,42.71127],[130.41826,42.6011],[130.44361,42.54849],[130.50123,42.61636],[130.55143,42.52158],[130.62107,42.58413],[130.56576,42.68925],[130.40213,42.70788],[130.44361,42.76205],[130.66524,42.84753],[131.02438,42.86518],[131.02668,42.91246],[131.135,42.94114],[131.10274,43.04734],[131.20414,43.13654],[131.19031,43.21385],[131.30324,43.39498],[131.29402,43.46695],[131.19492,43.53047],[131.21105,43.82383],[131.26176,43.94011],[131.23583,43.96085],[131.25484,44.03131],[131.30365,44.04262],[131.1108,44.70266],[130.95639,44.85154],[131.48415,44.99513],[131.68466,45.12374],[131.66852,45.2196],[131.76532,45.22609],[131.86903,45.33636],[131.99417,45.2567],[132.83978,45.05916],[132.96373,45.0212],[133.12293,45.1332],[133.09279,45.25693],[133.19419,45.51913],[133.41083,45.57723],[133.48457,45.86203],[133.60442,45.90053],[133.67569,45.9759],[133.72695,46.05576],[133.68047,46.14697],[133.88097,46.25066],[133.91496,46.4274],[133.84104,46.46681],[134.03538,46.75668],[134.20016,47.33458],[134.50898,47.4812],[134.7671,47.72051],[134.55508,47.98651],[134.67098,48.1564],[134.75328,48.36763],[134.49516,48.42884],[132.66989,47.96491],[132.57309,47.71741],[131.90448,47.68011],[131.2635,47.73325],[131.09871,47.6852],[130.95985,47.6957],[130.90915,47.90623],[130.65103,48.10052],[130.84462,48.30942],[130.52147,48.61745],[130.66946,48.88251],[130.43232,48.90844],[130.2355,48.86741],[129.85416,49.11067],[129.67598,49.29596],[129.50685,49.42398],[129.40398,49.44194],[129.35317,49.3481],[129.23232,49.40353],[129.11153,49.36813],[128.72896,49.58676],[127.83476,49.5748],[127.53516,49.84306],[127.49299,50.01251],[127.60515,50.23503],[127.37384,50.28393],[127.36009,50.43787],[127.28765,50.46585],[127.36335,50.58306],[127.28165,50.72075],[127.14586,50.91152],[126.93135,51.0841],[126.90369,51.3238],[126.68349,51.70607],[126.44606,51.98254],[126.558,52.13738],[125.6131,53.07229]],[[113.56865,22.20973],[113.57123,22.20416],[113.60504,22.20464],[113.63011,22.10782],[113.57191,22.07696],[113.54839,22.10909],[113.54942,22.14519],[113.54093,22.15497],[113.52659,22.18271],[113.53552,22.20607],[113.53301,22.21235],[113.53591,22.21369],[113.54093,22.21314],[113.54333,22.21688],[113.5508,22.21672],[113.56865,22.20973]],[[114.50148,22.15017],[113.92195,22.13873],[113.83338,22.1826],[113.81621,22.2163],[113.86771,22.42972],[114.03113,22.5065],[114.05438,22.5026],[114.05729,22.51104],[114.06272,22.51617],[114.07267,22.51855],[114.07817,22.52997],[114.08606,22.53276],[114.09048,22.53716],[114.09692,22.53435],[114.1034,22.5352],[114.11181,22.52878],[114.11656,22.53415],[114.12665,22.54003],[114.13823,22.54319],[114.1482,22.54091],[114.15123,22.55163],[114.1597,22.56041],[114.17247,22.55944],[114.18338,22.55444],[114.20655,22.55706],[114.22185,22.55343],[114.22888,22.5436],[114.25154,22.55977],[114.44998,22.55977],[114.50148,22.15017]]]]}},{type:"Feature",properties:{wikidata:"Q22890",nameEn:"Ireland",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q23666",nameEn:"Great Britain",country:"GB",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q23681",nameEn:"Northern Cyprus",groups:["Q644636","145","142"],driveSide:"left",callingCodes:["90 392"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.67678,35.03866],[33.67742,35.05963],[33.68474,35.06602],[33.69095,35.06237],[33.70861,35.07644],[33.7161,35.07279],[33.70209,35.04882],[33.71482,35.03722],[33.73824,35.05321],[33.76106,35.04253],[33.78581,35.05104],[33.82067,35.07826],[33.84168,35.06823],[33.8541,35.07201],[33.87479,35.08881],[33.87097,35.09389],[33.87622,35.10457],[33.87224,35.12293],[33.88561,35.12449],[33.88943,35.12007],[33.88737,35.11408],[33.89853,35.11377],[33.91789,35.08688],[33.91299,35.07579],[33.90247,35.07686],[33.89485,35.06873],[33.88367,35.07877],[33.85261,35.0574],[33.8355,35.05777],[33.82051,35.0667],[33.8012,35.04786],[33.81524,35.04192],[33.83055,35.02865],[33.82875,35.01685],[33.84045,35.00616],[33.85216,35.00579],[33.85891,35.001],[33.85621,34.98956],[33.83505,34.98108],[33.84811,34.97075],[33.86432,34.97592],[33.90075,34.96623],[33.98684,34.76642],[35.48515,34.70851],[35.51152,36.10954],[32.82353,35.70297],[32.46489,35.48584],[32.60361,35.16647],[32.64864,35.19967],[32.70947,35.18328],[32.70779,35.14127],[32.85733,35.07742],[32.86406,35.1043],[32.94471,35.09422],[33.01192,35.15639],[33.08249,35.17319],[33.11105,35.15639],[33.15138,35.19504],[33.27068,35.16815],[33.3072,35.16816],[33.31955,35.18096],[33.35056,35.18328],[33.34964,35.17803],[33.35596,35.17942],[33.35612,35.17402],[33.36569,35.17479],[33.3717,35.1788],[33.37248,35.18698],[33.38575,35.2018],[33.4076,35.20062],[33.41675,35.16325],[33.46813,35.10564],[33.48136,35.0636],[33.47825,35.04103],[33.45178,35.02078],[33.45256,35.00288],[33.47666,35.00701],[33.48915,35.06594],[33.53975,35.08151],[33.57478,35.06049],[33.567,35.04803],[33.59658,35.03635],[33.61215,35.0527],[33.63765,35.03869],[33.67678,35.03866]]]]}},{type:"Feature",properties:{wikidata:"Q25231",nameEn:"Svalbard",aliases:["NO-21"],country:"NO",groups:["SJ","154","150","UN"],level:"subterritory",callingCodes:["47 79"]},geometry:{type:"MultiPolygon",coordinates:[[[[-7.49892,77.24208],[32.07813,72.01005],[36.85549,84.09565],[-7.49892,77.24208]]]]}},{type:"Feature",properties:{wikidata:"Q25263",nameEn:"Azores",aliases:["PT-20"],country:"PT",groups:["Q3320166","Q2914565","Q105472","EU","039","150","UN"],callingCodes:["351"]},geometry:{type:"MultiPolygon",coordinates:[[[[-23.12984,40.26428],[-36.43765,41.39418],[-22.54767,33.34416],[-23.12984,40.26428]]]]}},{type:"Feature",properties:{wikidata:"Q25359",nameEn:"Navassa Island",aliases:["UM-76"],country:"US",groups:["UM","Q1352230","029","003","419","019","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-74.7289,18.71009],[-75.71816,18.46438],[-74.76465,18.06252],[-74.7289,18.71009]]]]}},{type:"Feature",properties:{wikidata:"Q25396",nameEn:"Bonaire",aliases:["BQ-BO","NL-BQ1"],country:"NL",groups:["Q1451600","BQ","029","003","419","019","UN"],level:"subterritory",callingCodes:["599 7"]},geometry:{type:"MultiPolygon",coordinates:[[[[-67.89186,12.4116],[-68.90012,12.62309],[-68.33524,11.78151],[-68.01417,11.77722],[-67.89186,12.4116]]]]}},{type:"Feature",properties:{wikidata:"Q25528",nameEn:"Saba",aliases:["BQ-SA","NL-BQ2"],country:"NL",groups:["Q1451600","BQ","029","003","419","019","UN"],level:"subterritory",callingCodes:["599 4"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.07669,17.79659],[-63.81314,17.95045],[-63.22932,17.32592],[-63.07669,17.79659]]]]}},{type:"Feature",properties:{wikidata:"Q26180",nameEn:"Sint Eustatius",aliases:["BQ-SE","NL-BQ3"],country:"NL",groups:["Q1451600","BQ","029","003","419","019","UN"],level:"subterritory",callingCodes:["599 3"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.07669,17.79659],[-63.34999,16.94218],[-62.76692,17.64353],[-63.07669,17.79659]]]]}},{type:"Feature",properties:{wikidata:"Q26253",nameEn:"Madeira",aliases:["PT-30"],country:"PT",groups:["Q3320166","Q2914565","Q105472","EU","039","150","UN"],callingCodes:["351"]},geometry:{type:"MultiPolygon",coordinates:[[[[-19.30302,33.65304],[-16.04789,29.65076],[-11.68307,33.12333],[-19.30302,33.65304]]]]}},{type:"Feature",properties:{wikidata:"Q26927",nameEn:"Lakshadweep",aliases:["IN-LD"],country:"IN",groups:["034","142","UN"],driveSide:"left",callingCodes:["91"]},geometry:{type:"MultiPolygon",coordinates:[[[[67.64074,11.57295],[76.59015,5.591],[72.67494,13.58102],[67.64074,11.57295]]]]}},{type:"Feature",properties:{wikidata:"Q27329",nameEn:"Asian Russia",country:"RU",groups:["142","UN"],callingCodes:["7"]},geometry:{type:"MultiPolygon",coordinates:[[[[-179.99933,64.74703],[-172.76104,63.77445],[-169.03888,65.48473],[-168.95635,65.98512],[-168.25765,71.99091],[-179.9843,71.90735],[-179.99933,64.74703]]],[[[59.99809,51.98263],[60.19925,51.99173],[60.48915,52.15175],[60.72581,52.15538],[60.78201,52.22067],[61.05417,52.35096],[60.98021,52.50068],[60.84709,52.52228],[60.84118,52.63912],[60.71693,52.66245],[60.71989,52.75923],[61.05842,52.92217],[61.23462,53.03227],[62.0422,52.96105],[62.12799,52.99133],[62.14574,53.09626],[61.19024,53.30536],[61.14291,53.41481],[61.29082,53.50992],[61.37957,53.45887],[61.57185,53.50112],[61.55706,53.57144],[60.90626,53.62937],[61.22574,53.80268],[61.14283,53.90063],[60.99796,53.93699],[61.26863,53.92797],[61.3706,54.08464],[61.47603,54.08048],[61.56941,53.95703],[61.65318,54.02445],[62.03913,53.94768],[62.00966,54.04134],[62.38535,54.03961],[62.45931,53.90737],[62.56876,53.94047],[62.58651,54.05871],[63.80604,54.27079],[63.91224,54.20013],[64.02715,54.22679],[63.97686,54.29763],[64.97216,54.4212],[65.11033,54.33028],[65.24663,54.35721],[65.20174,54.55216],[68.21308,54.98645],[68.26661,55.09226],[68.19206,55.18823],[68.90865,55.38148],[69.34224,55.36344],[69.74917,55.35545],[70.19179,55.1476],[70.76493,55.3027],[70.96009,55.10558],[71.08288,54.71253],[71.24185,54.64965],[71.08706,54.33376],[71.10379,54.13326],[71.96141,54.17736],[72.17477,54.36303],[72.43415,53.92685],[72.71026,54.1161],[73.37963,53.96132],[73.74778,54.07194],[73.68921,53.86522],[73.25412,53.61532],[73.39218,53.44623],[75.07405,53.80831],[75.43398,53.98652],[75.3668,54.07439],[76.91052,54.4677],[76.82266,54.1798],[76.44076,54.16017],[76.54243,53.99329],[77.90383,53.29807],[79.11255,52.01171],[80.08138,50.77658],[80.4127,50.95581],[80.44819,51.20855],[80.80318,51.28262],[81.16999,51.15662],[81.06091,50.94833],[81.41248,50.97524],[81.46581,50.77658],[81.94999,50.79307],[82.55443,50.75412],[83.14607,51.00796],[83.8442,50.87375],[84.29385,50.27257],[84.99198,50.06793],[85.24047,49.60239],[86.18709,49.50259],[86.63674,49.80136],[86.79056,49.74787],[86.61307,49.60239],[86.82606,49.51796],[87.03071,49.25142],[87.31465,49.23603],[87.28386,49.11626],[87.478,49.07403],[87.48983,49.13794],[87.81333,49.17354],[87.98977,49.18147],[88.15543,49.30314],[88.17223,49.46934],[88.42449,49.48821],[88.82499,49.44808],[89.70687,49.72535],[89.59711,49.90851],[91.86048,50.73734],[92.07173,50.69585],[92.44714,50.78762],[93.01109,50.79001],[92.99595,50.63183],[94.30823,50.57498],[94.39258,50.22193],[94.49477,50.17832],[94.6121,50.04239],[94.97166,50.04725],[95.02465,49.96941],[95.74757,49.97915],[95.80056,50.04239],[96.97388,49.88413],[97.24639,49.74737],[97.56811,49.84265],[97.56432,49.92801],[97.76871,49.99861],[97.85197,49.91339],[98.29481,50.33561],[98.31373,50.4996],[98.06393,50.61262],[97.9693,50.78044],[98.01472,50.86652],[97.83305,51.00248],[98.05257,51.46696],[98.22053,51.46579],[98.33222,51.71832],[98.74142,51.8637],[98.87768,52.14563],[99.27888,51.96876],[99.75578,51.90108],[99.89203,51.74903],[100.61116,51.73028],[101.39085,51.45753],[101.5044,51.50467],[102.14032,51.35566],[102.32194,50.67982],[102.71178,50.38873],[103.70343,50.13952],[105.32528,50.4648],[106.05562,50.40582],[106.07865,50.33474],[106.47156,50.31909],[106.49628,50.32436],[106.51122,50.34408],[106.58373,50.34044],[106.80326,50.30177],[107.00007,50.1977],[107.1174,50.04239],[107.36407,49.97612],[107.96116,49.93191],[107.95387,49.66659],[108.27937,49.53167],[108.53969,49.32325],[109.18017,49.34709],[109.51325,49.22859],[110.24373,49.16676],[110.39891,49.25083],[110.64493,49.1816],[113.02647,49.60772],[113.20216,49.83356],[114.325,50.28098],[114.9703,50.19254],[115.26068,49.97367],[115.73602,49.87688],[116.22402,50.04477],[116.62502,49.92919],[116.71193,49.83813],[117.27597,49.62544],[117.48208,49.62324],[117.82343,49.52696],[118.61623,49.93809],[119.11003,50.00276],[119.27996,50.13348],[119.38598,50.35162],[119.13553,50.37412],[120.10963,51.671],[120.65907,51.93544],[120.77337,52.20805],[120.61346,52.32447],[120.71673,52.54099],[120.46454,52.63811],[120.04049,52.58773],[120.0451,52.7359],[120.85633,53.28499],[121.39213,53.31888],[122.35063,53.49565],[122.85966,53.47395],[123.26989,53.54843],[123.86158,53.49391],[124.46078,53.21881],[125.17522,53.20225],[125.6131,53.07229],[126.558,52.13738],[126.44606,51.98254],[126.68349,51.70607],[126.90369,51.3238],[126.93135,51.0841],[127.14586,50.91152],[127.28165,50.72075],[127.36335,50.58306],[127.28765,50.46585],[127.36009,50.43787],[127.37384,50.28393],[127.60515,50.23503],[127.49299,50.01251],[127.53516,49.84306],[127.83476,49.5748],[128.72896,49.58676],[129.11153,49.36813],[129.23232,49.40353],[129.35317,49.3481],[129.40398,49.44194],[129.50685,49.42398],[129.67598,49.29596],[129.85416,49.11067],[130.2355,48.86741],[130.43232,48.90844],[130.66946,48.88251],[130.52147,48.61745],[130.84462,48.30942],[130.65103,48.10052],[130.90915,47.90623],[130.95985,47.6957],[131.09871,47.6852],[131.2635,47.73325],[131.90448,47.68011],[132.57309,47.71741],[132.66989,47.96491],[134.49516,48.42884],[134.75328,48.36763],[134.67098,48.1564],[134.55508,47.98651],[134.7671,47.72051],[134.50898,47.4812],[134.20016,47.33458],[134.03538,46.75668],[133.84104,46.46681],[133.91496,46.4274],[133.88097,46.25066],[133.68047,46.14697],[133.72695,46.05576],[133.67569,45.9759],[133.60442,45.90053],[133.48457,45.86203],[133.41083,45.57723],[133.19419,45.51913],[133.09279,45.25693],[133.12293,45.1332],[132.96373,45.0212],[132.83978,45.05916],[131.99417,45.2567],[131.86903,45.33636],[131.76532,45.22609],[131.66852,45.2196],[131.68466,45.12374],[131.48415,44.99513],[130.95639,44.85154],[131.1108,44.70266],[131.30365,44.04262],[131.25484,44.03131],[131.23583,43.96085],[131.26176,43.94011],[131.21105,43.82383],[131.19492,43.53047],[131.29402,43.46695],[131.30324,43.39498],[131.19031,43.21385],[131.20414,43.13654],[131.10274,43.04734],[131.135,42.94114],[131.02668,42.91246],[131.02438,42.86518],[130.66524,42.84753],[130.44361,42.76205],[130.40213,42.70788],[130.56576,42.68925],[130.62107,42.58413],[130.55143,42.52158],[130.56835,42.43281],[130.60805,42.4317],[130.64181,42.41422],[130.66367,42.38024],[130.65022,42.32281],[131.95041,41.5445],[140.9182,45.92937],[145.82343,44.571],[145.23667,43.76813],[153.94307,38.42848],[180,62.52334],[180,71.53642],[155.31937,81.93282],[76.13964,83.37843],[64.18965,69.94255],[66.1708,67.61252],[61.98014,65.72191],[60.74386,64.95767],[59.63945,64.78384],[59.80579,64.13948],[59.24834,63.01859],[59.61398,62.44915],[59.36223,61.3882],[59.50685,60.91162],[58.3853,59.487],[59.15636,59.14682],[59.40376,58.45822],[58.71104,58.07475],[58.81412,57.71602],[58.13789,57.68097],[58.07604,57.08308],[57.28024,56.87898],[57.51527,56.08729],[59.28419,56.15739],[59.49035,55.60486],[58.81825,55.03378],[57.25137,55.26262],[57.14829,54.84204],[57.95234,54.39672],[59.95217,54.85853],[59.70487,54.14846],[58.94336,53.953],[58.79644,52.43392],[59.22409,52.28437],[59.25033,52.46803],[60.17516,52.39457],[60.17253,52.25814],[59.91279,52.06924],[59.99809,51.98263]]]]}},{type:"Feature",properties:{wikidata:"Q34366",nameEn:"Tasmania",aliases:["AU-TAS"],country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[123.64533,-39.13605],[159.69067,-56.28945],[159.74028,-39.1978],[123.64533,-39.13605]]]]}},{type:"Feature",properties:{wikidata:"Q34497",nameEn:"Saint Helena",aliases:["SH-HL"],country:"GB",groups:["SH","BOTS","011","202","002","UN"],level:"subterritory",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["290"]},geometry:{type:"MultiPolygon",coordinates:[[[[-8.3824,-13.9131],[-6.17428,-19.07236],[-3.29308,-15.22647],[-8.3824,-13.9131]]]]}},{type:"Feature",properties:{wikidata:"Q35657",nameEn:"US States",country:"US",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q36117",nameEn:"Borneo",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q36678",nameEn:"West Bank",country:"PS",groups:["145","142"],callingCodes:["970"]},geometry:{type:"MultiPolygon",coordinates:[[[[35.47672,31.49578],[35.55941,31.76535],[35.52758,31.9131],[35.54375,31.96587],[35.52012,32.04076],[35.57111,32.21877],[35.55807,32.38674],[35.42078,32.41562],[35.41048,32.43706],[35.41598,32.45593],[35.42034,32.46009],[35.40224,32.50136],[35.35212,32.52047],[35.30685,32.51024],[35.29306,32.50947],[35.25049,32.52453],[35.2244,32.55289],[35.15937,32.50466],[35.10882,32.4757],[35.10024,32.47856],[35.09236,32.47614],[35.08564,32.46948],[35.07059,32.4585],[35.05423,32.41754],[35.05311,32.4024],[35.0421,32.38242],[35.05142,32.3667],[35.04243,32.35008],[35.01772,32.33863],[35.01119,32.28684],[35.02939,32.2671],[35.01841,32.23981],[34.98885,32.20758],[34.95703,32.19522],[34.96009,32.17503],[34.99039,32.14626],[34.98507,32.12606],[34.99437,32.10962],[34.9863,32.09551],[35.00261,32.027],[34.98682,31.96935],[35.00124,31.93264],[35.03489,31.92448],[35.03978,31.89276],[35.03489,31.85919],[34.99712,31.85569],[34.9724,31.83352],[35.01978,31.82944],[35.05617,31.85685],[35.07677,31.85627],[35.14174,31.81325],[35.18603,31.80901],[35.18169,31.82542],[35.19461,31.82687],[35.21469,31.81835],[35.216,31.83894],[35.21128,31.863],[35.20381,31.86716],[35.20673,31.88151],[35.20791,31.8821],[35.20945,31.8815],[35.21016,31.88237],[35.21276,31.88153],[35.2136,31.88241],[35.22014,31.88264],[35.22294,31.87889],[35.22567,31.86745],[35.22817,31.8638],[35.2249,31.85433],[35.2304,31.84222],[35.24816,31.8458],[35.25753,31.8387],[35.251,31.83085],[35.26404,31.82567],[35.25573,31.81362],[35.26058,31.79064],[35.25225,31.7678],[35.26319,31.74846],[35.25182,31.73945],[35.24981,31.72543],[35.2438,31.7201],[35.24315,31.71244],[35.23972,31.70896],[35.22392,31.71899],[35.21937,31.71578],[35.20538,31.72388],[35.18023,31.72067],[35.16478,31.73242],[35.15474,31.73352],[35.15119,31.73634],[35.13931,31.73012],[35.12933,31.7325],[35.11895,31.71454],[35.10782,31.71594],[35.08226,31.69107],[35.00879,31.65426],[34.95249,31.59813],[34.9415,31.55601],[34.94356,31.50743],[34.93258,31.47816],[34.89756,31.43891],[34.87833,31.39321],[34.88932,31.37093],[34.92571,31.34337],[35.02459,31.35979],[35.13033,31.3551],[35.22921,31.37445],[35.39675,31.49572],[35.47672,31.49578]]]]}},{type:"Feature",properties:{wikidata:"Q37362",nameEn:"Akrotiri and Dhekelia",aliases:["SBA"],country:"GB"},geometry:null},{type:"Feature",properties:{wikidata:"Q38095",nameEn:"Gal\xE1pagos Islands",aliases:["EC-W"],country:"EC",groups:["005","419","019","UN"],callingCodes:["593"]},geometry:{type:"MultiPolygon",coordinates:[[[[-93.12365,2.64343],[-92.46744,-2.52874],[-87.07749,-.8849],[-93.12365,2.64343]]]]}},{type:"Feature",properties:{wikidata:"Q39760",nameEn:"Gaza Strip",country:"PS",groups:["145","142"],callingCodes:["970"]},geometry:{type:"MultiPolygon",coordinates:[[[[34.052,31.46619],[34.21853,31.32363],[34.23572,31.2966],[34.24012,31.29591],[34.26742,31.21998],[34.29417,31.24194],[34.36523,31.28963],[34.37381,31.30598],[34.36505,31.36404],[34.40077,31.40926],[34.48892,31.48365],[34.56797,31.54197],[34.48681,31.59711],[34.29262,31.70393],[34.052,31.46619]]]]}},{type:"Feature",properties:{wikidata:"Q40888",nameEn:"Andaman and Nicobar Islands",aliases:["IN-AN"],country:"IN",groups:["034","142","UN"],driveSide:"left",callingCodes:["91"]},geometry:{type:"MultiPolygon",coordinates:[[[[94.42132,5.96581],[94.6371,13.81803],[86.7822,13.41052],[94.42132,5.96581]]]]}},{type:"Feature",properties:{wikidata:"Q41684",nameEn:"Stewart Island",country:"NZ",groups:["053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[166.59185,-47.61313],[169.70504,-47.56021],[167.52103,-46.41337],[166.59185,-47.61313]]]]}},{type:"Feature",properties:{wikidata:"Q43296",nameEn:"Wake Island",aliases:["WK","WAK","WKUM","872","UM-79"],country:"US",groups:["UM","Q1352230","057","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[167.34779,18.97692],[166.67967,20.14834],[165.82549,18.97692],[167.34779,18.97692]]]]}},{type:"Feature",properties:{wikidata:"Q46275",nameEn:"New Zealand Subantarctic Islands",country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left"},geometry:{type:"MultiPolygon",coordinates:[[[[164.30551,-47.88072],[161.96603,-56.07661],[179.49541,-50.04657],[179.49541,-47.2902],[169.91032,-47.66283],[164.30551,-47.88072]]]]}},{type:"Feature",properties:{wikidata:"Q46395",nameEn:"British Overseas Territories",aliases:["BOTS","UKOTS"],country:"GB",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q46772",nameEn:"Kerguelen Islands",country:"FR",groups:["EU","TF","Q1451600","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[61.9216,-49.39746],[70.67507,-51.14192],[74.25129,-45.45074],[61.9216,-49.39746]]]]}},{type:"Feature",properties:{wikidata:"Q46879",nameEn:"Baker Island",aliases:["UM-81"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-175.33482,-1.40631],[-175.31323,.5442],[-177.91421,.39582],[-175.33482,-1.40631]]]]}},{type:"Feature",properties:{wikidata:"Q47863",nameEn:"Midway Atoll",aliases:["MI","MID","MIUM","488","UM-71"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-176.29741,29.09786],[-177.77531,29.29793],[-177.5224,27.7635],[-176.29741,29.09786]]]]}},{type:"Feature",properties:{wikidata:"Q62218",nameEn:"Jarvis Island",aliases:["UM-86"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-160.42921,-1.4364],[-159.12443,.19975],[-160.38779,.30331],[-160.42921,-1.4364]]]]}},{type:"Feature",properties:{wikidata:"Q105472",nameEn:"Macaronesia",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q114935",nameEn:"Kermadec Islands",country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[-174.40891,-29.09438],[-180,-24.21376],[-179.96512,-35.00791],[-174.40891,-29.09438]]]]}},{type:"Feature",properties:{wikidata:"Q115459",nameEn:"Chatham Islands",aliases:["NZ-CIT"],country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[-179.93224,-45.18423],[-172.47015,-45.17912],[-176.30998,-41.38382],[-179.93224,-45.18423]]]]}},{type:"Feature",properties:{wikidata:"Q118863",nameEn:"North Island",country:"NZ",groups:["053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[179.49541,-47.2902],[179.49541,-36.79303],[174.17679,-32.62487],[170.27492,-36.38133],[174.58663,-40.80446],[174.46634,-41.55028],[179.49541,-47.2902]]]]}},{type:"Feature",properties:{wikidata:"Q120755",nameEn:"South Island",country:"NZ",groups:["053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[169.70504,-47.56021],[179.49541,-47.2902],[174.46634,-41.55028],[174.58663,-40.80446],[170.27492,-36.38133],[166.56976,-39.94841],[164.8365,-46.0205],[167.52103,-46.41337],[169.70504,-47.56021]]]]}},{type:"Feature",properties:{wikidata:"Q123076",nameEn:"Palmyra Atoll",aliases:["UM-95"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-161.06795,5.2462],[-161.0731,7.1291],[-163.24478,5.24198],[-161.06795,5.2462]]]]}},{type:"Feature",properties:{wikidata:"Q130574",nameEn:"Chafarinas Islands",country:"ES",groups:["EU","Q191011","015","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[-2.40316,35.16893],[-2.43262,35.20652],[-2.45965,35.16527],[-2.40316,35.16893]]]]}},{type:"Feature",properties:{wikidata:"Q130895",nameEn:"Kingman Reef",aliases:["UM-89"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-161.0731,7.1291],[-163.16627,7.15036],[-163.24478,5.24198],[-161.0731,7.1291]]]]}},{type:"Feature",properties:{wikidata:"Q131008",nameEn:"Johnston Atoll",aliases:["JT","JTN","JTUM","396","UM-67"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-170.65691,16.57199],[-168.87689,16.01159],[-169.2329,17.4933],[-170.65691,16.57199]]]]}},{type:"Feature",properties:{wikidata:"Q131305",nameEn:"Howland Island",aliases:["UM-84"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-177.91421,.39582],[-175.31323,.5442],[-176.74464,2.28109],[-177.91421,.39582]]]]}},{type:"Feature",properties:{wikidata:"Q133888",nameEn:"Ashmore and Cartier Islands",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[123.7463,-11.1783],[120.6877,-13.59408],[125.29076,-12.33139],[123.7463,-11.1783]]]]}},{type:"Feature",properties:{wikidata:"Q153732",nameEn:"Mariana Islands",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q172216",nameEn:"Coral Sea Islands",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[159.77159,-28.41151],[156.73836,-14.50464],[145.2855,-9.62524],[147.69992,-17.5933],[152.93188,-20.92631],[154.02855,-24.43238],[159.77159,-28.41151]]]]}},{type:"Feature",properties:{wikidata:"Q179313",nameEn:"Alderney",country:"GB",groups:["GG","830","Q185086","154","150","UN"],level:"subterritory",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01481"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.36485,49.48223],[-2.09454,49.46288],[-2.02963,49.91866],[-2.49556,49.79012],[-2.36485,49.48223]]]]}},{type:"Feature",properties:{wikidata:"Q185086",nameEn:"Crown Dependencies",country:"GB",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q190571",nameEn:"Scattered Islands",country:"FR",groups:["EU","TF","Q1451600","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[53.53458,-16.36909],[54.96649,-16.28353],[54.61476,-15.02273],[53.53458,-16.36909]]],[[[38.55969,-20.75596],[40.68027,-23.38889],[43.52893,-15.62903],[38.55969,-20.75596]]],[[[47.03092,-11.05648],[47.11593,-12.08552],[47.96702,-11.46447],[47.03092,-11.05648]]]]}},{type:"Feature",properties:{wikidata:"Q191011",nameEn:"Plazas de soberan\xEDa",country:"ES"},geometry:null},{type:"Feature",properties:{wikidata:"Q191146",nameEn:"Pe\xF1\xF3n de V\xE9lez de la Gomera",country:"ES",groups:["EU","Q191011","015","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[-4.30191,35.17419],[-4.30112,35.17058],[-4.29436,35.17149],[-4.30191,35.17419]]]]}},{type:"Feature",properties:{wikidata:"Q201698",nameEn:"Crozet Islands",country:"FR",groups:["EU","TF","Q1451600","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[55.03425,-43.65017],[46.31615,-46.28749],[54.5587,-47.93013],[55.03425,-43.65017]]]]}},{type:"Feature",properties:{wikidata:"Q578170",nameEn:"Contiguous United States",aliases:["CONUS"],country:"US",groups:["Q35657","021","003","019","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-97.13927,25.96583],[-96.92418,25.97377],[-80.57035,24.0565],[-78.91214,27.76553],[-61.98255,37.34815],[-67.16117,44.20069],[-66.93432,44.82597],[-66.96824,44.83078],[-66.98249,44.87071],[-66.96824,44.90965],[-67.0216,44.95333],[-67.11316,45.11176],[-67.15965,45.16179],[-67.19603,45.16771],[-67.20349,45.1722],[-67.22751,45.16344],[-67.27039,45.1934],[-67.29748,45.18173],[-67.29754,45.14865],[-67.34927,45.122],[-67.48201,45.27351],[-67.42394,45.37969],[-67.50578,45.48971],[-67.42144,45.50584],[-67.43815,45.59162],[-67.6049,45.60725],[-67.80705,45.69528],[-67.80653,45.80022],[-67.75654,45.82324],[-67.80961,45.87531],[-67.75196,45.91814],[-67.78111,45.9392],[-67.78578,47.06473],[-67.87993,47.10377],[-67.94843,47.1925],[-68.23244,47.35712],[-68.37458,47.35851],[-68.38332,47.28723],[-68.57914,47.28431],[-68.60575,47.24659],[-68.70125,47.24399],[-68.89222,47.1807],[-69.05039,47.2456],[-69.05073,47.30076],[-69.05148,47.42012],[-69.22119,47.46461],[-69.99966,46.69543],[-70.05812,46.41768],[-70.18547,46.35357],[-70.29078,46.18832],[-70.23855,46.1453],[-70.31025,45.96424],[-70.24694,45.95138],[-70.25976,45.89675],[-70.41523,45.79497],[-70.38934,45.73215],[-70.54019,45.67291],[-70.68516,45.56964],[-70.72651,45.49771],[-70.62518,45.42286],[-70.65383,45.37592],[-70.78372,45.43269],[-70.82638,45.39828],[-70.80236,45.37444],[-70.84816,45.22698],[-70.89864,45.2398],[-70.91169,45.29849],[-70.95193,45.33895],[-71.0107,45.34819],[-71.01866,45.31573],[-71.08364,45.30623],[-71.14568,45.24128],[-71.19723,45.25438],[-71.22338,45.25184],[-71.29371,45.29996],[-71.37133,45.24624],[-71.44252,45.2361],[-71.40364,45.21382],[-71.42778,45.12624],[-71.48735,45.07784],[-71.50067,45.01357],[-73.35025,45.00942],[-74.32699,44.99029],[-74.66689,45.00646],[-74.8447,45.00606],[-74.99101,44.98051],[-75.01363,44.95608],[-75.2193,44.87821],[-75.41441,44.76614],[-75.76813,44.51537],[-75.8217,44.43176],[-75.95947,44.34463],[-76.00018,44.34896],[-76.16285,44.28262],[-76.1664,44.23051],[-76.244,44.19643],[-76.31222,44.19894],[-76.35324,44.13493],[-76.43859,44.09393],[-76.79706,43.63099],[-79.25796,43.54052],[-79.06921,43.26183],[-79.05512,43.25375],[-79.05544,43.21224],[-79.05002,43.20133],[-79.05384,43.17418],[-79.04652,43.16396],[-79.0427,43.13934],[-79.06881,43.12029],[-79.05671,43.10937],[-79.07486,43.07845],[-79.01055,43.06659],[-78.99941,43.05612],[-79.02424,43.01983],[-79.02074,42.98444],[-78.98126,42.97],[-78.96312,42.95509],[-78.93224,42.95229],[-78.90905,42.93022],[-78.90712,42.89733],[-78.93684,42.82887],[-82.67862,41.67615],[-83.11184,41.95671],[-83.14962,42.04089],[-83.12724,42.2376],[-83.09837,42.28877],[-83.07837,42.30978],[-83.02253,42.33045],[-82.82964,42.37355],[-82.64242,42.55594],[-82.58873,42.54984],[-82.57583,42.5718],[-82.51858,42.611],[-82.51063,42.66025],[-82.46613,42.76615],[-82.4826,42.8068],[-82.45331,42.93139],[-82.4253,42.95423],[-82.4146,42.97626],[-82.42469,42.992],[-82.48419,45.30225],[-83.59589,45.82131],[-83.43746,45.99749],[-83.57017,46.105],[-83.83329,46.12169],[-83.90453,46.05922],[-83.95399,46.05634],[-84.1096,46.23987],[-84.09756,46.25512],[-84.11615,46.2681],[-84.11254,46.32329],[-84.13451,46.39218],[-84.11196,46.50248],[-84.12885,46.53068],[-84.17723,46.52753],[-84.1945,46.54061],[-84.2264,46.53337],[-84.26351,46.49508],[-84.29893,46.49127],[-84.34174,46.50683],[-84.42101,46.49853],[-84.4481,46.48972],[-84.47607,46.45225],[-84.55635,46.45974],[-84.85871,46.88881],[-88.37033,48.30586],[-89.48837,48.01412],[-89.57972,48.00023],[-89.77248,48.02607],[-89.89974,47.98109],[-90.07418,48.11043],[-90.56312,48.09488],[-90.56444,48.12184],[-90.75045,48.09143],[-90.87588,48.2484],[-91.08016,48.18096],[-91.25025,48.08522],[-91.43248,48.04912],[-91.45829,48.07454],[-91.58025,48.04339],[-91.55649,48.10611],[-91.70451,48.11805],[-91.71231,48.19875],[-91.86125,48.21278],[-91.98929,48.25409],[-92.05339,48.35958],[-92.14732,48.36578],[-92.202,48.35252],[-92.26662,48.35651],[-92.30939,48.31251],[-92.27167,48.25046],[-92.37185,48.22259],[-92.48147,48.36609],[-92.45588,48.40624],[-92.50712,48.44921],[-92.65606,48.43471],[-92.71323,48.46081],[-92.69927,48.49573],[-92.62747,48.50278],[-92.6342,48.54133],[-92.7287,48.54005],[-92.94973,48.60866],[-93.25391,48.64266],[-93.33946,48.62787],[-93.3712,48.60599],[-93.39758,48.60364],[-93.40693,48.60948],[-93.44472,48.59147],[-93.47022,48.54357],[-93.66382,48.51845],[-93.79267,48.51631],[-93.80939,48.52439],[-93.80676,48.58232],[-93.83288,48.62745],[-93.85769,48.63284],[-94.23215,48.65202],[-94.25104,48.65729],[-94.25172,48.68404],[-94.27153,48.70232],[-94.4174,48.71049],[-94.44258,48.69223],[-94.53826,48.70216],[-94.54885,48.71543],[-94.58903,48.71803],[-94.69335,48.77883],[-94.69669,48.80918],[-94.70486,48.82365],[-94.70087,48.8339],[-94.687,48.84077],[-94.75017,49.09931],[-94.77355,49.11998],[-94.82487,49.29483],[-94.8159,49.32299],[-94.85381,49.32492],[-94.95681,49.37035],[-94.99532,49.36579],[-95.01419,49.35647],[-95.05825,49.35311],[-95.12903,49.37056],[-95.15357,49.384],[-95.15355,48.9996],[-123.32163,49.00419],[-123.0093,48.83186],[-123.0093,48.76586],[-123.26565,48.6959],[-123.15614,48.35395],[-123.50039,48.21223],[-125.03842,48.53282],[-133.98258,38.06389],[-118.48109,32.5991],[-117.1243,32.53427],[-115.88053,32.63624],[-114.71871,32.71894],[-114.76736,32.64094],[-114.80584,32.62028],[-114.81141,32.55543],[-114.79524,32.55731],[-114.82011,32.49609],[-111.07523,31.33232],[-108.20979,31.33316],[-108.20899,31.78534],[-106.529,31.784],[-106.52266,31.77509],[-106.51251,31.76922],[-106.50962,31.76155],[-106.50111,31.75714],[-106.48815,31.74769],[-106.47298,31.75054],[-106.46726,31.75998],[-106.45244,31.76523],[-106.43419,31.75478],[-106.41773,31.75196],[-106.38003,31.73151],[-106.3718,31.71165],[-106.34864,31.69663],[-106.33419,31.66303],[-106.30305,31.62154],[-106.28084,31.56173],[-106.24612,31.54193],[-106.23711,31.51262],[-106.20346,31.46305],[-106.09025,31.40569],[-106.00363,31.39181],[-104.77674,30.4236],[-104.5171,29.64671],[-104.3969,29.57105],[-104.39363,29.55396],[-104.37752,29.54255],[-103.15787,28.93865],[-102.60596,29.8192],[-101.47277,29.7744],[-101.05686,29.44738],[-101.01128,29.36947],[-100.96725,29.3477],[-100.94579,29.34523],[-100.94056,29.33371],[-100.87982,29.296],[-100.79696,29.24688],[-100.67294,29.09744],[-100.63689,28.90812],[-100.59809,28.88197],[-100.52313,28.75598],[-100.5075,28.74066],[-100.51222,28.70679],[-100.50029,28.66117],[-99.55409,27.61314],[-99.51478,27.55836],[-99.52955,27.49747],[-99.50208,27.50021],[-99.48045,27.49016],[-99.482,27.47128],[-99.49744,27.43746],[-99.53573,27.30926],[-99.08477,26.39849],[-99.03053,26.41249],[-99.00546,26.3925],[-98.35126,26.15129],[-98.30491,26.10475],[-98.27075,26.09457],[-98.24603,26.07191],[-97.97017,26.05232],[-97.95155,26.0625],[-97.66511,26.01708],[-97.52025,25.88518],[-97.49828,25.89877],[-97.45669,25.86874],[-97.42511,25.83969],[-97.37332,25.83854],[-97.35946,25.92189],[-97.13927,25.96583]]]]}},{type:"Feature",properties:{wikidata:"Q620634",nameEn:"Bir Tawil",groups:["015","002"],level:"territory"},geometry:{type:"MultiPolygon",coordinates:[[[[33.17563,22.00405],[33.57251,21.72406],[33.99686,21.76784],[34.0765,22.00501],[33.17563,22.00405]]]]}},{type:"Feature",properties:{wikidata:"Q639185",nameEn:"Peros Banhos",country:"GB",groups:["IO","BOTS","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[72.12587,-4.02588],[70.1848,-6.37445],[72.09518,-5.61768],[72.12587,-4.02588]]]]}},{type:"Feature",properties:{wikidata:"Q644636",nameEn:"Cyprus",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q851132",nameEn:"New Zealand Outlying Islands",country:"NZ",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q875134",nameEn:"European Russia",country:"RU",groups:["151","150","UN"],callingCodes:["7"]},geometry:{type:"MultiPolygon",coordinates:[[[[18.57853,55.25302],[19.64312,54.45423],[19.8038,54.44203],[20.63871,54.3706],[21.41123,54.32395],[22.79705,54.36264],[22.7253,54.41732],[22.70208,54.45312],[22.67788,54.532],[22.71293,54.56454],[22.68021,54.58486],[22.7522,54.63525],[22.74225,54.64339],[22.75467,54.6483],[22.73397,54.66604],[22.73631,54.72952],[22.87317,54.79492],[22.85083,54.88711],[22.76422,54.92521],[22.68723,54.9811],[22.65451,54.97037],[22.60075,55.01863],[22.58907,55.07085],[22.47688,55.04408],[22.31562,55.0655],[22.14267,55.05345],[22.11697,55.02131],[22.06087,55.02935],[22.02582,55.05078],[22.03984,55.07888],[21.99543,55.08691],[21.96505,55.07353],[21.85521,55.09493],[21.64954,55.1791],[21.55605,55.20311],[21.51095,55.18507],[21.46766,55.21115],[21.38446,55.29348],[21.35465,55.28427],[21.26425,55.24456],[20.95181,55.27994],[20.60454,55.40986],[18.57853,55.25302]]],[[[26.32936,60.00121],[26.90044,59.63819],[27.85643,59.58538],[28.04187,59.47017],[28.19061,59.39962],[28.21137,59.38058],[28.20537,59.36491],[28.19284,59.35791],[28.14215,59.28934],[28.00689,59.28351],[27.90911,59.24353],[27.87978,59.18097],[27.80482,59.1116],[27.74429,58.98351],[27.36366,58.78381],[27.55489,58.39525],[27.48541,58.22615],[27.62393,58.09462],[27.67282,57.92627],[27.81841,57.89244],[27.78526,57.83963],[27.56689,57.83356],[27.50171,57.78842],[27.52615,57.72843],[27.3746,57.66834],[27.40393,57.62125],[27.31919,57.57672],[27.34698,57.52242],[27.56832,57.53728],[27.52453,57.42826],[27.86101,57.29402],[27.66511,56.83921],[27.86101,56.88204],[28.04768,56.59004],[28.13526,56.57989],[28.10069,56.524],[28.19057,56.44637],[28.16599,56.37806],[28.23716,56.27588],[28.15217,56.16964],[28.30571,56.06035],[28.36888,56.05805],[28.37987,56.11399],[28.43068,56.09407],[28.5529,56.11705],[28.68337,56.10173],[28.63668,56.07262],[28.73418,55.97131],[29.08299,56.03427],[29.21717,55.98971],[29.44692,55.95978],[29.3604,55.75862],[29.51283,55.70294],[29.61446,55.77716],[29.80672,55.79569],[29.97975,55.87281],[30.12136,55.8358],[30.27776,55.86819],[30.30987,55.83592],[30.48257,55.81066],[30.51346,55.78982],[30.51037,55.76568],[30.63344,55.73079],[30.67464,55.64176],[30.72957,55.66268],[30.7845,55.58514],[30.86003,55.63169],[30.93419,55.6185],[30.95204,55.50667],[30.90123,55.46621],[30.93144,55.3914],[30.8257,55.3313],[30.81946,55.27931],[30.87944,55.28223],[30.97369,55.17134],[31.02071,55.06167],[31.00972,55.02783],[30.94243,55.03964],[30.9081,55.02232],[30.95754,54.98609],[30.93144,54.9585],[30.81759,54.94064],[30.8264,54.90062],[30.75165,54.80699],[30.95479,54.74346],[30.97127,54.71967],[31.0262,54.70698],[30.98226,54.68872],[30.99187,54.67046],[31.19339,54.66947],[31.21399,54.63113],[31.08543,54.50361],[31.22945,54.46585],[31.3177,54.34067],[31.30791,54.25315],[31.57002,54.14535],[31.89599,54.0837],[31.88744,54.03653],[31.85019,53.91801],[31.77028,53.80015],[31.89137,53.78099],[32.12621,53.81586],[32.36663,53.7166],[32.45717,53.74039],[32.50112,53.68594],[32.40499,53.6656],[32.47777,53.5548],[32.74968,53.45597],[32.73257,53.33494],[32.51725,53.28431],[32.40773,53.18856],[32.15368,53.07594],[31.82373,53.10042],[31.787,53.18033],[31.62496,53.22886],[31.56316,53.19432],[31.40523,53.21406],[31.36403,53.13504],[31.3915,53.09712],[31.33519,53.08805],[31.32283,53.04101],[31.24147,53.031],[31.35667,52.97854],[31.592,52.79011],[31.57277,52.71613],[31.50406,52.69707],[31.63869,52.55361],[31.56316,52.51518],[31.61397,52.48843],[31.62084,52.33849],[31.57971,52.32146],[31.70735,52.26711],[31.6895,52.1973],[31.77877,52.18636],[31.7822,52.11406],[31.81722,52.09955],[31.85018,52.11305],[31.96141,52.08015],[31.92159,52.05144],[32.08813,52.03319],[32.23331,52.08085],[32.2777,52.10266],[32.34044,52.1434],[32.33083,52.23685],[32.38988,52.24946],[32.3528,52.32842],[32.54781,52.32423],[32.69475,52.25535],[32.85405,52.27888],[32.89937,52.2461],[33.18913,52.3754],[33.51323,52.35779],[33.48027,52.31499],[33.55718,52.30324],[33.78789,52.37204],[34.05239,52.20132],[34.11199,52.14087],[34.09413,52.00835],[34.41136,51.82793],[34.42922,51.72852],[34.07765,51.67065],[34.17599,51.63253],[34.30562,51.5205],[34.22048,51.4187],[34.33446,51.363],[34.23009,51.26429],[34.31661,51.23936],[34.38802,51.2746],[34.6613,51.25053],[34.6874,51.18],[34.82472,51.17483],[34.97304,51.2342],[35.14058,51.23162],[35.12685,51.16191],[35.20375,51.04723],[35.31774,51.08434],[35.40837,51.04119],[35.32598,50.94524],[35.39307,50.92145],[35.41367,50.80227],[35.47704,50.77274],[35.48116,50.66405],[35.39464,50.64751],[35.47463,50.49247],[35.58003,50.45117],[35.61711,50.35707],[35.73659,50.35489],[35.80388,50.41356],[35.8926,50.43829],[36.06893,50.45205],[36.20763,50.3943],[36.30101,50.29088],[36.47817,50.31457],[36.58371,50.28563],[36.56655,50.2413],[36.64571,50.218],[36.69377,50.26982],[36.91762,50.34963],[37.08468,50.34935],[37.48204,50.46079],[37.47243,50.36277],[37.62486,50.29966],[37.62879,50.24481],[37.61113,50.21976],[37.75807,50.07896],[37.79515,50.08425],[37.90776,50.04194],[38.02999,49.94482],[38.02999,49.90592],[38.21675,49.98104],[38.18517,50.08161],[38.32524,50.08866],[38.35408,50.00664],[38.65688,49.97176],[38.68677,50.00904],[38.73311,49.90238],[38.90477,49.86787],[38.9391,49.79524],[39.1808,49.88911],[39.27968,49.75976],[39.44496,49.76067],[39.59142,49.73758],[39.65047,49.61761],[39.84548,49.56064],[40.13249,49.61672],[40.16683,49.56865],[40.03636,49.52321],[40.03087,49.45452],[40.1141,49.38798],[40.14912,49.37681],[40.18331,49.34996],[40.22176,49.25683],[40.01988,49.1761],[39.93437,49.05709],[39.6836,49.05121],[39.6683,48.99454],[39.71353,48.98959],[39.72649,48.9754],[39.74874,48.98675],[39.78368,48.91596],[39.98967,48.86901],[40.03636,48.91957],[40.08168,48.87443],[39.97182,48.79398],[39.79466,48.83739],[39.73104,48.7325],[39.71765,48.68673],[39.67226,48.59368],[39.79764,48.58668],[39.84548,48.57821],[39.86196,48.46633],[39.88794,48.44226],[39.94847,48.35055],[39.84136,48.33321],[39.84273,48.30947],[39.90041,48.3049],[39.91465,48.26743],[39.95248,48.29972],[39.9693,48.29904],[39.97325,48.31399],[39.99241,48.31768],[40.00752,48.22445],[39.94847,48.22811],[39.83724,48.06501],[39.88256,48.04482],[39.77544,48.04206],[39.82213,47.96396],[39.73935,47.82876],[38.87979,47.87719],[38.79628,47.81109],[38.76379,47.69346],[38.35062,47.61631],[38.28679,47.53552],[38.28954,47.39255],[38.22225,47.30788],[38.33074,47.30508],[38.32112,47.2585],[38.23049,47.2324],[38.22955,47.12069],[38.3384,46.98085],[38.12112,46.86078],[37.62608,46.82615],[35.23066,45.79231],[35.04991,45.76827],[36.6645,45.4514],[36.6545,45.3417],[36.5049,45.3136],[36.475,45.2411],[36.4883,45.0488],[33.5943,44.03313],[39.81147,43.06294],[40.0078,43.38551],[40.00853,43.40578],[40.01552,43.42025],[40.01007,43.42411],[40.03312,43.44262],[40.04445,43.47776],[40.10657,43.57344],[40.65957,43.56212],[41.64935,43.22331],[42.40563,43.23226],[42.66667,43.13917],[42.75889,43.19651],[43.03322,43.08883],[43.0419,43.02413],[43.81453,42.74297],[43.73119,42.62043],[43.95517,42.55396],[44.54202,42.75699],[44.70002,42.74679],[44.80941,42.61277],[44.88754,42.74934],[45.15318,42.70598],[45.36501,42.55268],[45.78692,42.48358],[45.61676,42.20768],[46.42738,41.91323],[46.5332,41.87389],[46.58924,41.80547],[46.75269,41.8623],[46.8134,41.76252],[47.00955,41.63583],[46.99554,41.59743],[47.03757,41.55434],[47.10762,41.59044],[47.34579,41.27884],[47.49004,41.26366],[47.54504,41.20275],[47.62288,41.22969],[47.75831,41.19455],[47.87973,41.21798],[48.07587,41.49957],[48.22064,41.51472],[48.2878,41.56221],[48.40277,41.60441],[48.42301,41.65444],[48.55078,41.77917],[48.5867,41.84306],[48.80971,41.95365],[49.2134,44.84989],[49.88945,46.04554],[49.32259,46.26944],[49.16518,46.38542],[48.54988,46.56267],[48.51142,46.69268],[49.01136,46.72716],[48.52326,47.4102],[48.45173,47.40818],[48.15348,47.74545],[47.64973,47.76559],[47.41689,47.83687],[47.38731,47.68176],[47.12107,47.83687],[47.11516,48.27188],[46.49011,48.43019],[46.78392,48.95352],[47.00857,49.04921],[47.04658,49.19834],[46.78398,49.34026],[46.9078,49.86707],[47.18319,49.93721],[47.34589,50.09308],[47.30448,50.30894],[47.58551,50.47867],[48.10044,50.09242],[48.24519,49.86099],[48.42564,49.82283],[48.68352,49.89546],[48.90782,50.02281],[48.57946,50.63278],[48.86936,50.61589],[49.12673,50.78639],[49.41959,50.85927],[49.39001,51.09396],[49.76866,51.11067],[49.97277,51.2405],[50.26859,51.28677],[50.59695,51.61859],[51.26254,51.68466],[51.301,51.48799],[51.77431,51.49536],[51.8246,51.67916],[52.36119,51.74161],[52.54329,51.48444],[53.46165,51.49445],[53.69299,51.23466],[54.12248,51.11542],[54.46331,50.85554],[54.41894,50.61214],[54.55797,50.52006],[54.71476,50.61214],[54.56685,51.01958],[54.72067,51.03261],[55.67774,50.54508],[56.11398,50.7471],[56.17906,50.93204],[57.17302,51.11253],[57.44221,50.88354],[57.74986,50.93017],[57.75578,51.13852],[58.3208,51.15151],[58.87974,50.70852],[59.48928,50.64216],[59.51886,50.49937],[59.81172,50.54451],[60.01288,50.8163],[60.17262,50.83312],[60.31914,50.67705],[60.81833,50.6629],[61.4431,50.80679],[61.56889,51.23679],[61.6813,51.25716],[61.55114,51.32746],[61.50677,51.40687],[60.95655,51.48615],[60.92401,51.61124],[60.5424,51.61675],[60.36787,51.66815],[60.50986,51.7964],[60.09867,51.87135],[59.99809,51.98263],[59.91279,52.06924],[60.17253,52.25814],[60.17516,52.39457],[59.25033,52.46803],[59.22409,52.28437],[58.79644,52.43392],[58.94336,53.953],[59.70487,54.14846],[59.95217,54.85853],[57.95234,54.39672],[57.14829,54.84204],[57.25137,55.26262],[58.81825,55.03378],[59.49035,55.60486],[59.28419,56.15739],[57.51527,56.08729],[57.28024,56.87898],[58.07604,57.08308],[58.13789,57.68097],[58.81412,57.71602],[58.71104,58.07475],[59.40376,58.45822],[59.15636,59.14682],[58.3853,59.487],[59.50685,60.91162],[59.36223,61.3882],[59.61398,62.44915],[59.24834,63.01859],[59.80579,64.13948],[59.63945,64.78384],[60.74386,64.95767],[61.98014,65.72191],[66.1708,67.61252],[64.18965,69.94255],[76.13964,83.37843],[36.85549,84.09565],[32.07813,72.01005],[31.59909,70.16571],[30.84095,69.80584],[30.95011,69.54699],[30.52662,69.54699],[30.16363,69.65244],[29.97205,69.41623],[29.27631,69.2811],[29.26623,69.13794],[29.0444,69.0119],[28.91738,69.04774],[28.45957,68.91417],[28.78224,68.86696],[28.43941,68.53366],[28.62982,68.19816],[29.34179,68.06655],[29.66955,67.79872],[30.02041,67.67523],[29.91155,67.51507],[28.9839,66.94139],[29.91155,66.13863],[30.16363,65.66935],[29.97205,65.70256],[29.74013,65.64025],[29.84096,65.56945],[29.68972,65.31803],[29.61914,65.23791],[29.8813,65.22101],[29.84096,65.1109],[29.61914,65.05993],[29.68972,64.80789],[30.05271,64.79072],[30.12329,64.64862],[30.01238,64.57513],[30.06279,64.35782],[30.4762,64.25728],[30.55687,64.09036],[30.25437,63.83364],[29.98213,63.75795],[30.49637,63.46666],[31.23244,63.22239],[31.29294,63.09035],[31.58535,62.91642],[31.38369,62.66284],[31.10136,62.43042],[29.01829,61.17448],[28.82816,61.1233],[28.47974,60.93365],[27.77352,60.52722],[27.71177,60.3893],[27.44953,60.22766],[26.32936,60.00121]]]]}},{type:"Feature",properties:{wikidata:"Q1083368",nameEn:"Mainland Finland",country:"FI",groups:["EU","154","150","UN"],callingCodes:["358"]},geometry:{type:"MultiPolygon",coordinates:[[[[29.12697,69.69193],[28.36883,69.81658],[28.32849,69.88605],[27.97558,69.99671],[27.95542,70.0965],[27.57226,70.06215],[27.05802,69.92069],[26.64461,69.96565],[26.40261,69.91377],[25.96904,69.68397],[25.69679,69.27039],[25.75729,68.99383],[25.61613,68.89602],[25.42455,68.90328],[25.12206,68.78684],[25.10189,68.63307],[24.93048,68.61102],[24.90023,68.55579],[24.74898,68.65143],[24.18432,68.73936],[24.02299,68.81601],[23.781,68.84514],[23.68017,68.70276],[23.13064,68.64684],[22.53321,68.74393],[22.38367,68.71561],[22.27276,68.89514],[21.63833,69.27485],[21.27827,69.31281],[21.00732,69.22755],[20.98641,69.18809],[21.11099,69.10291],[21.05775,69.0356],[20.72171,69.11874],[20.55258,69.06069],[20.78802,69.03087],[20.91658,68.96764],[20.85104,68.93142],[20.90649,68.89696],[21.03001,68.88969],[22.00429,68.50692],[22.73028,68.40881],[23.10336,68.26551],[23.15377,68.14759],[23.26469,68.15134],[23.40081,68.05545],[23.65793,67.9497],[23.45627,67.85297],[23.54701,67.59306],[23.39577,67.46974],[23.75372,67.43688],[23.75372,67.29914],[23.54701,67.25435],[23.58735,67.20752],[23.56214,67.17038],[23.98563,66.84149],[23.98059,66.79585],[23.89488,66.772],[23.85959,66.56434],[23.63776,66.43568],[23.67591,66.3862],[23.64982,66.30603],[23.71339,66.21299],[23.90497,66.15802],[24.15791,65.85385],[24.14798,65.83466],[24.15107,65.81427],[24.14112,65.39731],[20.15877,63.06556],[19.23413,60.61414],[20.96741,60.71528],[21.15143,60.54555],[21.08159,60.20167],[21.02509,60.12142],[21.35468,59.67511],[20.5104,59.15546],[26.32936,60.00121],[27.44953,60.22766],[27.71177,60.3893],[27.77352,60.52722],[28.47974,60.93365],[28.82816,61.1233],[29.01829,61.17448],[31.10136,62.43042],[31.38369,62.66284],[31.58535,62.91642],[31.29294,63.09035],[31.23244,63.22239],[30.49637,63.46666],[29.98213,63.75795],[30.25437,63.83364],[30.55687,64.09036],[30.4762,64.25728],[30.06279,64.35782],[30.01238,64.57513],[30.12329,64.64862],[30.05271,64.79072],[29.68972,64.80789],[29.61914,65.05993],[29.84096,65.1109],[29.8813,65.22101],[29.61914,65.23791],[29.68972,65.31803],[29.84096,65.56945],[29.74013,65.64025],[29.97205,65.70256],[30.16363,65.66935],[29.91155,66.13863],[28.9839,66.94139],[29.91155,67.51507],[30.02041,67.67523],[29.66955,67.79872],[29.34179,68.06655],[28.62982,68.19816],[28.43941,68.53366],[28.78224,68.86696],[28.45957,68.91417],[28.91738,69.04774],[28.81248,69.11997],[28.8629,69.22395],[29.31664,69.47994],[29.12697,69.69193]]]]}},{type:"Feature",properties:{wikidata:"Q1184963",nameEn:"Alhucemas Islands",country:"ES",groups:["EU","Q191011","015","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[-3.90602,35.21494],[-3.88372,35.20767],[-3.89343,35.22728],[-3.90602,35.21494]]]]}},{type:"Feature",properties:{wikidata:"Q1298289",nameEn:"Egmont Islands",country:"GB",groups:["IO","BOTS","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[70.1848,-6.37445],[70.67958,-8.2663],[72.17991,-6.68509],[70.1848,-6.37445]]]]}},{type:"Feature",properties:{wikidata:"Q1352230",nameEn:"US Territories",country:"US",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q1451600",nameEn:"Overseas Countries and Territories of the EU",aliases:["OCT"],level:"subunion"},geometry:null},{type:"Feature",properties:{wikidata:"Q1544253",nameEn:"Great Chagos Bank",country:"GB",groups:["IO","BOTS","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[70.1848,-6.37445],[72.17991,-6.68509],[73.20573,-5.20727],[70.1848,-6.37445]]]]}},{type:"Feature",properties:{wikidata:"Q1585511",nameEn:"Salomon Atoll",country:"GB",groups:["IO","BOTS","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[72.09518,-5.61768],[73.20573,-5.20727],[72.12587,-4.02588],[72.09518,-5.61768]]]]}},{type:"Feature",properties:{wikidata:"Q1681727",nameEn:"Saint-Paul and Amsterdam",country:"FR",groups:["EU","TF","Q1451600","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[76.31747,-42.16264],[80.15867,-36.04977],[71.22311,-38.75287],[76.31747,-42.16264]]]]}},{type:"Feature",properties:{wikidata:"Q1901211",nameEn:"East Malaysia",country:"MY",groups:["Q36117","035","142","UN"],driveSide:"left",callingCodes:["60"]},geometry:{type:"MultiPolygon",coordinates:[[[[110.90339,7.52694],[109.82788,2.86812],[109.62558,1.99182],[109.53794,1.91771],[109.57923,1.80624],[109.66397,1.79972],[109.66397,1.60425],[110.35354,.98869],[110.49182,.88088],[110.62374,.873],[111.22979,1.08326],[111.55434,.97864],[111.82846,.99349],[111.94553,1.12016],[112.15679,1.17004],[112.2127,1.44135],[112.48648,1.56516],[113.021,1.57819],[113.01448,1.42832],[113.64677,1.23933],[114.03788,1.44787],[114.57892,1.5],[114.80706,1.92351],[114.80706,2.21665],[115.1721,2.49671],[115.11343,2.82879],[115.53713,3.14776],[115.58276,3.93499],[115.90217,4.37708],[117.25801,4.35108],[117.47313,4.18857],[117.67641,4.16535],[118.06469,4.16638],[118.93936,4.09009],[119.52945,5.35672],[117.98544,6.27477],[117.93857,6.89845],[117.17735,7.52841],[116.79524,7.43869],[115.02521,5.35005],[115.16236,5.01011],[115.15092,4.87604],[115.20737,4.8256],[115.27819,4.63661],[115.2851,4.42295],[115.36346,4.33563],[115.31275,4.30806],[115.09978,4.39123],[115.07737,4.53418],[115.04064,4.63706],[115.02278,4.74137],[115.02955,4.82087],[115.05038,4.90275],[114.99417,4.88201],[114.96982,4.81146],[114.88841,4.81905],[114.8266,4.75062],[114.77303,4.72871],[114.83189,4.42387],[114.88039,4.4257],[114.78539,4.12205],[114.64211,4.00694],[114.49922,4.13108],[114.4416,4.27588],[114.32176,4.2552],[114.32176,4.34942],[114.26876,4.49878],[114.15813,4.57],[114.07448,4.58441],[114.10166,4.76112],[110.90339,7.52694]]]]}},{type:"Feature",properties:{wikidata:"Q1973345",nameEn:"Peninsular Malaysia",country:"MY",groups:["035","142","UN"],driveSide:"left",callingCodes:["60"]},geometry:{type:"MultiPolygon",coordinates:[[[[102.46318,7.22462],[102.09086,6.23546],[102.08127,6.22679],[102.07732,6.193],[102.09182,6.14161],[102.01835,6.05407],[101.99209,6.04075],[101.97114,6.01992],[101.9714,6.00575],[101.94712,5.98421],[101.92819,5.85511],[101.91776,5.84269],[101.89188,5.8386],[101.80144,5.74505],[101.75074,5.79091],[101.69773,5.75881],[101.58019,5.93534],[101.25524,5.78633],[101.25755,5.71065],[101.14062,5.61613],[100.98815,5.79464],[101.02708,5.91013],[101.087,5.9193],[101.12388,6.11411],[101.06165,6.14161],[101.12618,6.19431],[101.10313,6.25617],[100.85884,6.24929],[100.81045,6.45086],[100.74822,6.46231],[100.74361,6.50811],[100.66986,6.45086],[100.43027,6.52389],[100.42351,6.51762],[100.41791,6.5189],[100.41152,6.52299],[100.35413,6.54932],[100.31929,6.65413],[100.32607,6.65933],[100.32671,6.66526],[100.31884,6.66423],[100.31618,6.66781],[100.30828,6.66462],[100.29651,6.68439],[100.19511,6.72559],[100.12,6.42105],[100.0756,6.4045],[99.91873,6.50233],[99.50117,6.44501],[99.31854,5.99868],[99.75778,3.86466],[103.03657,1.30383],[103.56591,1.19719],[103.62738,1.35255],[103.67468,1.43166],[103.7219,1.46108],[103.74161,1.4502],[103.76395,1.45183],[103.81181,1.47953],[103.86383,1.46288],[103.89565,1.42841],[103.93384,1.42926],[104.00131,1.42405],[104.02277,1.4438],[104.04622,1.44691],[104.07348,1.43322],[104.08871,1.42015],[104.09162,1.39694],[104.08072,1.35998],[104.12282,1.27714],[104.34728,1.33529],[104.56723,1.44271],[105.01437,3.24936],[102.46318,7.22462]]]]}},{type:"Feature",properties:{wikidata:"Q2093907",nameEn:"Three Kings Islands",country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left"},geometry:{type:"MultiPolygon",coordinates:[[[[174.17679,-32.62487],[170.93268,-32.97889],[171.97383,-34.64644],[174.17679,-32.62487]]]]}},{type:"Feature",properties:{wikidata:"Q2298216",nameEn:"Solander Islands",country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left"},geometry:{type:"MultiPolygon",coordinates:[[[[167.39068,-46.49187],[166.5534,-46.39484],[166.84561,-46.84889],[167.39068,-46.49187]]]]}},{type:"Feature",properties:{wikidata:"Q2872203",nameEn:"Mainland Australia",country:"AU",groups:["053","009","UN"],level:"subcountryGroup",driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[88.16419,-23.49578],[123.64533,-39.13605],[159.74028,-39.1978],[159.76765,-29.76946],[154.02855,-24.43238],[152.93188,-20.92631],[147.69992,-17.5933],[145.2855,-9.62524],[143.87386,-9.02382],[143.29772,-9.33993],[142.48658,-9.36754],[142.19246,-9.15378],[141.88934,-9.36111],[141.01842,-9.35091],[135.49042,-9.2276],[127.55165,-9.05052],[125.29076,-12.33139],[88.16419,-23.49578]]]]}},{type:"Feature",properties:{wikidata:"Q2914565",nameEn:"Autonomous Regions of Portugal",country:"PT",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q2915956",nameEn:"Mainland Portugal",country:"PT",groups:["Q12837","EU","039","150","UN"],level:"subcountryGroup",callingCodes:["351"]},geometry:{type:"MultiPolygon",coordinates:[[[[-10.39881,36.12218],[-7.37282,36.96896],[-7.39769,37.16868],[-7.41133,37.20314],[-7.41854,37.23813],[-7.43227,37.25152],[-7.43974,37.38913],[-7.46878,37.47127],[-7.51759,37.56119],[-7.41981,37.75729],[-7.33441,37.81193],[-7.27314,37.90145],[-7.24544,37.98884],[-7.12648,38.00296],[-7.10366,38.04404],[-7.05966,38.01966],[-7.00375,38.01914],[-6.93418,38.21454],[-7.09389,38.17227],[-7.15581,38.27597],[-7.32529,38.44336],[-7.265,38.61674],[-7.26174,38.72107],[-7.03848,38.87221],[-7.051,38.907],[-6.95211,39.0243],[-6.97004,39.07619],[-7.04011,39.11919],[-7.10692,39.10275],[-7.14929,39.11287],[-7.12811,39.17101],[-7.23566,39.20132],[-7.23403,39.27579],[-7.3149,39.34857],[-7.2927,39.45847],[-7.49477,39.58794],[-7.54121,39.66717],[-7.33507,39.64569],[-7.24707,39.66576],[-7.01613,39.66877],[-6.97492,39.81488],[-6.91463,39.86618],[-6.86737,40.01986],[-6.94233,40.10716],[-7.00589,40.12087],[-7.02544,40.18564],[-7.00426,40.23169],[-6.86085,40.26776],[-6.86085,40.2976],[-6.80218,40.33239],[-6.78426,40.36468],[-6.84618,40.42177],[-6.84944,40.46394],[-6.7973,40.51723],[-6.80218,40.55067],[-6.84292,40.56801],[-6.79567,40.65955],[-6.82826,40.74603],[-6.82337,40.84472],[-6.79892,40.84842],[-6.80707,40.88047],[-6.84292,40.89771],[-6.8527,40.93958],[-6.9357,41.02888],[-6.913,41.03922],[-6.88843,41.03027],[-6.84781,41.02692],[-6.80942,41.03629],[-6.79241,41.05397],[-6.75655,41.10187],[-6.77319,41.13049],[-6.69711,41.1858],[-6.68286,41.21641],[-6.65046,41.24725],[-6.55937,41.24417],[-6.38551,41.35274],[-6.38553,41.38655],[-6.3306,41.37677],[-6.26777,41.48796],[-6.19128,41.57638],[-6.29863,41.66432],[-6.44204,41.68258],[-6.49907,41.65823],[-6.54633,41.68623],[-6.56426,41.74219],[-6.51374,41.8758],[-6.56752,41.88429],[-6.5447,41.94371],[-6.58544,41.96674],[-6.61967,41.94008],[-6.75004,41.94129],[-6.76959,41.98734],[-6.81196,41.99097],[-6.82174,41.94493],[-6.94396,41.94403],[-6.95537,41.96553],[-6.98144,41.9728],[-7.01078,41.94977],[-7.07596,41.94977],[-7.08574,41.97401],[-7.14115,41.98855],[-7.18549,41.97515],[-7.18677,41.88793],[-7.32366,41.8406],[-7.37092,41.85031],[-7.42864,41.80589],[-7.42854,41.83262],[-7.44759,41.84451],[-7.45566,41.86488],[-7.49803,41.87095],[-7.52737,41.83939],[-7.62188,41.83089],[-7.58603,41.87944],[-7.65774,41.88308],[-7.69848,41.90977],[-7.84188,41.88065],[-7.88055,41.84571],[-7.88751,41.92553],[-7.90707,41.92432],[-7.92336,41.8758],[-7.9804,41.87337],[-8.01136,41.83453],[-8.0961,41.81024],[-8.16455,41.81753],[-8.16944,41.87944],[-8.19551,41.87459],[-8.2185,41.91237],[-8.16232,41.9828],[-8.08796,42.01398],[-8.08847,42.05767],[-8.11729,42.08537],[-8.18178,42.06436],[-8.19406,42.12141],[-8.18947,42.13853],[-8.1986,42.15402],[-8.22406,42.1328],[-8.24681,42.13993],[-8.2732,42.12396],[-8.29809,42.106],[-8.32161,42.10218],[-8.33912,42.08358],[-8.36353,42.09065],[-8.38323,42.07683],[-8.40143,42.08052],[-8.42512,42.07199],[-8.44123,42.08218],[-8.48185,42.0811],[-8.52837,42.07658],[-8.5252,42.06264],[-8.54563,42.0537],[-8.58086,42.05147],[-8.59493,42.05708],[-8.63791,42.04691],[-8.64626,42.03668],[-8.65832,42.02972],[-8.6681,41.99703],[-8.69071,41.98862],[-8.7478,41.96282],[-8.74606,41.9469],[-8.75712,41.92833],[-8.81794,41.90375],[-8.87157,41.86488],[-11.19304,41.83075],[-10.39881,36.12218]]]]}},{type:"Feature",properties:{wikidata:"Q3311985",nameEn:"Guernsey",country:"GB",groups:["GG","830","Q185086","154","150","UN"],level:"subterritory",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01481"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.49556,49.79012],[-3.28154,49.57329],[-2.65349,49.15373],[-2.36485,49.48223],[-2.49556,49.79012]]]]}},{type:"Feature",properties:{wikidata:"Q3320166",nameEn:"Outermost Regions of the EU",aliases:["OMR"],level:"subunion"},geometry:null},{type:"Feature",properties:{wikidata:"Q3336843",nameEn:"Countries of the United Kingdom",aliases:["GB-UKM"],country:"GB",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q6736667",nameEn:"Mainland India",country:"IN",groups:["034","142","UN"],driveSide:"left",callingCodes:["91"]},geometry:{type:"MultiPolygon",coordinates:[[[[89.08044,21.41871],[89.07114,22.15335],[88.9367,22.58527],[88.94614,22.66941],[88.9151,22.75228],[88.96713,22.83346],[88.87063,22.95235],[88.88327,23.03885],[88.86377,23.08759],[88.99148,23.21134],[88.71133,23.2492],[88.79254,23.46028],[88.79351,23.50535],[88.74841,23.47361],[88.56507,23.64044],[88.58087,23.87105],[88.66189,23.87607],[88.73743,23.91751],[88.6976,24.14703],[88.74841,24.1959],[88.68801,24.31464],[88.50934,24.32474],[88.12296,24.51301],[88.08786,24.63232],[88.00683,24.66477],[88.15515,24.85806],[88.14004,24.93529],[88.21832,24.96642],[88.27325,24.88796],[88.33917,24.86803],[88.46277,25.07468],[88.44766,25.20149],[88.94067,25.18534],[89.00463,25.26583],[89.01105,25.30303],[88.85278,25.34679],[88.81296,25.51546],[88.677,25.46959],[88.4559,25.59227],[88.45103,25.66245],[88.242,25.80811],[88.13138,25.78773],[88.08804,25.91334],[88.16581,26.0238],[88.1844,26.14417],[88.34757,26.22216],[88.35153,26.29123],[88.51649,26.35923],[88.48749,26.45855],[88.36938,26.48683],[88.35153,26.45241],[88.33093,26.48929],[88.41196,26.63837],[88.4298,26.54489],[88.62144,26.46783],[88.69485,26.38353],[88.67837,26.26291],[88.78961,26.31093],[88.85004,26.23211],[89.05328,26.2469],[88.91321,26.37984],[88.92357,26.40711],[88.95612,26.4564],[89.08899,26.38845],[89.15869,26.13708],[89.35953,26.0077],[89.53515,26.00382],[89.57101,25.9682],[89.63968,26.22595],[89.70201,26.15138],[89.73581,26.15818],[89.77865,26.08387],[89.77728,26.04254],[89.86592,25.93115],[89.80585,25.82489],[89.84388,25.70042],[89.86129,25.61714],[89.81208,25.37244],[89.84086,25.31854],[89.83371,25.29548],[89.87629,25.28337],[89.90478,25.31038],[90.1155,25.22686],[90.40034,25.1534],[90.65042,25.17788],[90.87427,25.15799],[91.25517,25.20677],[91.63648,25.12846],[92.0316,25.1834],[92.33957,25.07593],[92.39147,25.01471],[92.49887,24.88796],[92.38626,24.86055],[92.25854,24.9191],[92.15796,24.54435],[92.11662,24.38997],[91.96603,24.3799],[91.89258,24.14674],[91.82596,24.22345],[91.76004,24.23848],[91.73257,24.14703],[91.65292,24.22095],[91.63782,24.1132],[91.55542,24.08687],[91.37414,24.10693],[91.35741,23.99072],[91.29587,24.0041],[91.22308,23.89616],[91.25192,23.83463],[91.15579,23.6599],[91.28293,23.37538],[91.36453,23.06612],[91.40848,23.07117],[91.4035,23.27522],[91.46615,23.2328],[91.54993,23.01051],[91.61571,22.93929],[91.7324,23.00043],[91.81634,23.08001],[91.76417,23.26619],[91.84789,23.42235],[91.95642,23.47361],[91.95093,23.73284],[92.04706,23.64229],[92.15417,23.73409],[92.26541,23.70392],[92.38214,23.28705],[92.37665,22.9435],[92.5181,22.71441],[92.60029,22.1522],[92.56616,22.13554],[92.60949,21.97638],[92.67532,22.03547],[92.70416,22.16017],[92.86208,22.05456],[92.89504,21.95143],[92.93899,22.02656],[92.99804,21.98964],[92.99255,22.05965],[93.04885,22.20595],[93.15734,22.18687],[93.14224,22.24535],[93.19991,22.25425],[93.18206,22.43716],[93.13537,22.45873],[93.11477,22.54374],[93.134,22.59573],[93.09417,22.69459],[93.134,22.92498],[93.12988,23.05772],[93.2878,23.00464],[93.38478,23.13698],[93.36862,23.35426],[93.38781,23.36139],[93.39981,23.38828],[93.38805,23.4728],[93.43475,23.68299],[93.3908,23.7622],[93.3908,23.92925],[93.36059,23.93176],[93.32351,24.04468],[93.34735,24.10151],[93.41415,24.07854],[93.46633,23.97067],[93.50616,23.94432],[93.62871,24.00922],[93.75952,24.0003],[93.80279,23.92549],[93.92089,23.95812],[94.14081,23.83333],[94.30215,24.23752],[94.32362,24.27692],[94.45279,24.56656],[94.50729,24.59281],[94.5526,24.70764],[94.60204,24.70889],[94.73937,25.00545],[94.74212,25.13606],[94.57458,25.20318],[94.68032,25.47003],[94.80117,25.49359],[95.18556,26.07338],[95.11428,26.1019],[95.12801,26.38397],[95.05798,26.45408],[95.23513,26.68499],[95.30339,26.65372],[95.437,26.7083],[95.81603,27.01335],[95.93002,27.04149],[96.04949,27.19428],[96.15591,27.24572],[96.40779,27.29818],[96.55761,27.29928],[96.73888,27.36638],[96.88445,27.25046],[96.85287,27.2065],[96.89132,27.17474],[97.14675,27.09041],[97.17422,27.14052],[96.91431,27.45752],[96.90112,27.62149],[97.29919,27.92233],[97.35824,27.87256],[97.38845,28.01329],[97.35412,28.06663],[97.31292,28.06784],[97.34547,28.21385],[97.1289,28.3619],[96.98882,28.32564],[96.88445,28.39452],[96.85561,28.4875],[96.6455,28.61657],[96.48895,28.42955],[96.40929,28.51526],[96.61391,28.72742],[96.3626,29.10607],[96.20467,29.02325],[96.18682,29.11087],[96.31316,29.18643],[96.05361,29.38167],[95.84899,29.31464],[95.75149,29.32063],[95.72086,29.20797],[95.50842,29.13487],[95.41091,29.13007],[95.3038,29.13847],[95.26122,29.07727],[95.2214,29.10727],[95.11291,29.09527],[95.0978,29.14446],[94.81353,29.17804],[94.69318,29.31739],[94.2752,29.11687],[94.35897,29.01965],[93.72797,28.68821],[93.44621,28.67189],[93.18069,28.50319],[93.14635,28.37035],[92.93075,28.25671],[92.67486,28.15018],[92.65472,28.07632],[92.73025,28.05814],[92.7275,27.98662],[92.42538,27.80092],[92.32101,27.79363],[92.27432,27.89077],[91.87057,27.7195],[91.84722,27.76325],[91.6469,27.76358],[91.55819,27.6144],[91.65007,27.48287],[92.01132,27.47352],[92.12019,27.27829],[92.04702,27.26861],[92.03457,27.07334],[92.11863,26.893],[92.05523,26.8692],[91.83181,26.87318],[91.50067,26.79223],[90.67715,26.77215],[90.48504,26.8594],[90.39271,26.90704],[90.30402,26.85098],[90.04535,26.72422],[89.86124,26.73307],[89.63369,26.74402],[89.42349,26.83727],[89.3901,26.84225],[89.38319,26.85963],[89.37913,26.86224],[89.1926,26.81329],[89.12825,26.81661],[89.09554,26.89089],[88.95807,26.92668],[88.92301,26.99286],[88.8714,26.97488],[88.86984,27.10937],[88.74219,27.144],[88.91901,27.32483],[88.82981,27.38814],[88.77517,27.45415],[88.88091,27.85192],[88.83559,28.01936],[88.63235,28.12356],[88.54858,28.06057],[88.25332,27.9478],[88.1278,27.95417],[88.13378,27.88015],[88.1973,27.85067],[88.19107,27.79285],[88.04008,27.49223],[88.07277,27.43007],[88.01646,27.21612],[88.01587,27.21388],[87.9887,27.11045],[88.11719,26.98758],[88.13422,26.98705],[88.12302,26.95324],[88.19107,26.75516],[88.1659,26.68177],[88.16452,26.64111],[88.09963,26.54195],[88.09414,26.43732],[88.00895,26.36029],[87.90115,26.44923],[87.89085,26.48565],[87.84193,26.43663],[87.7918,26.46737],[87.76004,26.40711],[87.67893,26.43501],[87.66803,26.40294],[87.59175,26.38342],[87.55274,26.40596],[87.51571,26.43106],[87.46566,26.44058],[87.37314,26.40815],[87.34568,26.34787],[87.26568,26.37294],[87.26587,26.40592],[87.24682,26.4143],[87.18863,26.40558],[87.14751,26.40542],[87.09147,26.45039],[87.0707,26.58571],[87.04691,26.58685],[87.01559,26.53228],[86.95912,26.52076],[86.94543,26.52076],[86.82898,26.43919],[86.76797,26.45892],[86.74025,26.42386],[86.69124,26.45169],[86.62686,26.46891],[86.61313,26.48658],[86.57073,26.49825],[86.54258,26.53819],[86.49726,26.54218],[86.31564,26.61925],[86.26235,26.61886],[86.22513,26.58863],[86.13596,26.60651],[86.02729,26.66756],[85.8492,26.56667],[85.85126,26.60866],[85.83126,26.61134],[85.76907,26.63076],[85.72315,26.67471],[85.73483,26.79613],[85.66239,26.84822],[85.61621,26.86721],[85.59461,26.85161],[85.5757,26.85955],[85.56471,26.84133],[85.47752,26.79292],[85.34302,26.74954],[85.21159,26.75933],[85.18046,26.80519],[85.19291,26.86909],[85.15883,26.86966],[85.02635,26.85381],[85.05592,26.88991],[85.00536,26.89523],[84.97186,26.9149],[84.96687,26.95599],[84.85754,26.98984],[84.82913,27.01989],[84.793,26.9968],[84.64496,27.04669],[84.69166,27.21294],[84.62161,27.33885],[84.29315,27.39],[84.25735,27.44941],[84.21376,27.45218],[84.10791,27.52399],[84.02229,27.43836],[83.93306,27.44939],[83.86182,27.4241],[83.85595,27.35797],[83.61288,27.47013],[83.39495,27.4798],[83.38872,27.39276],[83.35136,27.33885],[83.29999,27.32778],[83.2673,27.36235],[83.27197,27.38309],[83.19413,27.45632],[82.94938,27.46036],[82.93261,27.50328],[82.74119,27.49838],[82.70378,27.72122],[82.46405,27.6716],[82.06554,27.92222],[81.97214,27.93322],[81.91223,27.84995],[81.47867,28.08303],[81.48179,28.12148],[81.38683,28.17638],[81.32923,28.13521],[81.19847,28.36284],[81.03471,28.40054],[80.55142,28.69182],[80.50575,28.6706],[80.52443,28.54897],[80.44504,28.63098],[80.37188,28.63371],[80.12125,28.82346],[80.06957,28.82763],[80.05743,28.91479],[80.18085,29.13649],[80.23178,29.11626],[80.26602,29.13938],[80.24112,29.21414],[80.28626,29.20327],[80.31428,29.30784],[80.24322,29.44299],[80.37939,29.57098],[80.41858,29.63581],[80.38428,29.68513],[80.36803,29.73865],[80.41554,29.79451],[80.43458,29.80466],[80.48997,29.79566],[80.56247,29.86661],[80.57179,29.91422],[80.60226,29.95732],[80.67076,29.95732],[80.8778,30.13384],[80.86673,30.17321],[80.91143,30.22173],[80.92547,30.17193],[81.03953,30.20059],[80.83343,30.32023],[80.54504,30.44936],[80.20721,30.58541],[79.93255,30.88288],[79.59884,30.93943],[79.30694,31.17357],[79.14016,31.43403],[79.01931,31.42817],[78.89344,31.30481],[78.77898,31.31209],[78.71032,31.50197],[78.84516,31.60631],[78.69933,31.78723],[78.78036,31.99478],[78.74404,32.00384],[78.68754,32.10256],[78.49609,32.2762],[78.4645,32.45367],[78.38897,32.53938],[78.73916,32.69438],[78.7831,32.46873],[78.96713,32.33655],[78.99322,32.37948],[79.0979,32.38051],[79.13174,32.47766],[79.26768,32.53277],[79.46562,32.69668],[79.14016,33.02545],[79.15252,33.17156],[78.73636,33.56521],[78.67599,33.66445],[78.77349,33.73871],[78.73367,34.01121],[78.65657,34.03195],[78.66225,34.08858],[78.91769,34.15452],[78.99802,34.3027],[79.05364,34.32482],[78.74465,34.45174],[78.56475,34.50835],[78.54964,34.57283],[78.27781,34.61484],[78.18435,34.7998],[78.22692,34.88771],[78.00033,35.23954],[78.03466,35.3785],[78.11664,35.48022],[77.80532,35.52058],[77.70232,35.46244],[77.44277,35.46132],[76.96624,35.5932],[76.84539,35.67356],[76.77323,35.66062],[76.75475,35.52617],[76.85088,35.39754],[76.93465,35.39866],[77.11796,35.05419],[76.99251,34.93349],[76.87193,34.96906],[76.74514,34.92488],[76.74377,34.84039],[76.67648,34.76371],[76.47186,34.78965],[76.15463,34.6429],[76.04614,34.67566],[75.75438,34.51827],[75.38009,34.55021],[75.01479,34.64629],[74.6663,34.703],[74.58083,34.77386],[74.31239,34.79626],[74.12897,34.70073],[73.96423,34.68244],[73.93401,34.63386],[73.93951,34.57169],[73.89419,34.54568],[73.88732,34.48911],[73.74999,34.3781],[73.74862,34.34183],[73.8475,34.32935],[73.90517,34.35317],[73.98208,34.2522],[73.90677,34.10504],[73.88732,34.05105],[73.91341,34.01235],[74.21554,34.03853],[74.25262,34.01577],[74.26086,33.92237],[74.14001,33.83002],[74.05898,33.82089],[74.00891,33.75437],[73.96423,33.73071],[73.98968,33.66155],[73.97367,33.64061],[74.03576,33.56718],[74.10115,33.56392],[74.18121,33.4745],[74.17983,33.3679],[74.08782,33.26232],[74.01366,33.25199],[74.02144,33.18908],[74.15374,33.13477],[74.17571,33.07495],[74.31854,33.02891],[74.34875,32.97823],[74.31227,32.92795],[74.41467,32.90563],[74.45312,32.77755],[74.6289,32.75561],[74.64675,32.82604],[74.7113,32.84219],[74.65345,32.71225],[74.69542,32.66792],[74.64424,32.60985],[74.65251,32.56416],[74.67431,32.56676],[74.68362,32.49298],[74.84725,32.49075],[74.97634,32.45367],[75.03265,32.49538],[75.28259,32.36556],[75.38046,32.26836],[75.25649,32.10187],[75.00793,32.03786],[74.9269,32.0658],[74.86236,32.04485],[74.79919,31.95983],[74.58907,31.87824],[74.47771,31.72227],[74.57498,31.60382],[74.61517,31.55698],[74.59319,31.50197],[74.64713,31.45605],[74.59773,31.4136],[74.53223,31.30321],[74.51629,31.13829],[74.56023,31.08303],[74.60281,31.10419],[74.60006,31.13711],[74.6852,31.12771],[74.67971,31.05479],[74.5616,31.04153],[73.88993,30.36305],[73.95736,30.28466],[73.97225,30.19829],[73.80299,30.06969],[73.58665,30.01848],[73.3962,29.94707],[73.28094,29.56646],[73.05886,29.1878],[73.01337,29.16422],[72.94272,29.02487],[72.40402,28.78283],[72.29495,28.66367],[72.20329,28.3869],[71.9244,28.11555],[71.89921,27.96035],[70.79054,27.68423],[70.60927,28.02178],[70.37307,28.01208],[70.12502,27.8057],[70.03136,27.56627],[69.58519,27.18109],[69.50904,26.74892],[69.88555,26.56836],[70.05584,26.60398],[70.17532,26.55362],[70.17532,26.24118],[70.08193,26.08094],[70.0985,25.93238],[70.2687,25.71156],[70.37444,25.67443],[70.53649,25.68928],[70.60378,25.71898],[70.67382,25.68186],[70.66695,25.39314],[70.89148,25.15064],[70.94002,24.92843],[71.09405,24.69017],[70.97594,24.60904],[71.00341,24.46038],[71.12838,24.42662],[71.04461,24.34657],[70.94985,24.3791],[70.85784,24.30903],[70.88393,24.27398],[70.71502,24.23517],[70.57906,24.27774],[70.5667,24.43787],[70.11712,24.30915],[70.03428,24.172],[69.73335,24.17007],[69.59579,24.29777],[69.29778,24.28712],[69.19341,24.25646],[69.07806,24.29777],[68.97781,24.26021],[68.90914,24.33156],[68.7416,24.31904],[68.74643,23.97027],[68.39339,23.96838],[68.20763,23.85849],[68.11329,23.53945],[76.59015,5.591],[79.50447,8.91876],[79.42124,9.80115],[80.48418,10.20786],[89.08044,21.41871]]]]}},{type:"Feature",properties:{wikidata:"Q9143535",nameEn:"Akrotiri",country:"GB",groups:["Q644636","Q37362","BOTS","145","142","UN"],level:"subterritory",driveSide:"left",callingCodes:["357"]},geometry:{type:"MultiPolygon",coordinates:[[[[32.86014,34.70585],[32.82717,34.70622],[32.79433,34.67883],[32.76136,34.68318],[32.75515,34.64985],[32.74412,34.43926],[33.26744,34.49942],[33.0138,34.64424],[32.96968,34.64046],[32.96718,34.63446],[32.95891,34.62919],[32.95323,34.64075],[32.95471,34.64528],[32.94976,34.65204],[32.94796,34.6587],[32.95325,34.66462],[32.97079,34.66112],[32.97736,34.65277],[32.99014,34.65518],[32.98668,34.67268],[32.99135,34.68061],[32.95539,34.68471],[32.94683,34.67907],[32.94379,34.67111],[32.93693,34.67027],[32.93449,34.66241],[32.92807,34.66736],[32.93043,34.67091],[32.91398,34.67343],[32.9068,34.66102],[32.86167,34.68734],[32.86014,34.70585]]]]}},{type:"Feature",properties:{wikidata:"Q9206745",nameEn:"Dhekelia",country:"GB",groups:["Q644636","Q37362","BOTS","145","142","UN"],level:"subterritory",driveSide:"left",callingCodes:["357"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.70575,34.97947],[33.83531,34.73974],[33.98684,34.76642],[33.90075,34.96623],[33.86432,34.97592],[33.84811,34.97075],[33.83505,34.98108],[33.85621,34.98956],[33.85891,35.001],[33.85216,35.00579],[33.84045,35.00616],[33.82875,35.01685],[33.83055,35.02865],[33.81524,35.04192],[33.8012,35.04786],[33.82051,35.0667],[33.8355,35.05777],[33.85261,35.0574],[33.88367,35.07877],[33.89485,35.06873],[33.90247,35.07686],[33.91299,35.07579],[33.91789,35.08688],[33.89853,35.11377],[33.88737,35.11408],[33.88943,35.12007],[33.88561,35.12449],[33.87224,35.12293],[33.87622,35.10457],[33.87097,35.09389],[33.87479,35.08881],[33.8541,35.07201],[33.84168,35.06823],[33.82067,35.07826],[33.78581,35.05104],[33.76106,35.04253],[33.73824,35.05321],[33.71482,35.03722],[33.70209,35.04882],[33.7161,35.07279],[33.70861,35.07644],[33.69095,35.06237],[33.68474,35.06602],[33.67742,35.05963],[33.67678,35.03866],[33.69938,35.03123],[33.69731,35.01754],[33.71514,35.00294],[33.70639,34.99303],[33.70575,34.97947]],[[33.77312,34.9976],[33.77553,34.99518],[33.78516,34.99582],[33.79191,34.98914],[33.78917,34.98854],[33.78571,34.98951],[33.78318,34.98699],[33.78149,34.98854],[33.77843,34.988],[33.7778,34.98981],[33.76738,34.99188],[33.76605,34.99543],[33.75682,34.99916],[33.75994,35.00113],[33.77312,34.9976]],[[33.74144,35.01053],[33.7343,35.01178],[33.73781,35.02181],[33.74265,35.02329],[33.74983,35.02274],[33.7492,35.01319],[33.74144,35.01053]]]]}},{type:"Feature",properties:{wikidata:"Q16390686",nameEn:"Peninsular Spain",country:"ES",groups:["Q12837","EU","039","150","UN"],callingCodes:["34"]},geometry:{type:"MultiPolygon",coordinates:[[[[3.75438,42.33445],[3.17156,42.43545],[3.11379,42.43646],[3.10027,42.42621],[3.08167,42.42748],[3.03734,42.47363],[2.96518,42.46692],[2.94283,42.48174],[2.92107,42.4573],[2.88413,42.45938],[2.86983,42.46843],[2.85675,42.45444],[2.84335,42.45724],[2.77464,42.41046],[2.75497,42.42578],[2.72056,42.42298],[2.65311,42.38771],[2.6747,42.33974],[2.57934,42.35808],[2.55516,42.35351],[2.54382,42.33406],[2.48457,42.33933],[2.43508,42.37568],[2.43299,42.39423],[2.38504,42.39977],[2.25551,42.43757],[2.20578,42.41633],[2.16599,42.42314],[2.12789,42.41291],[2.11621,42.38393],[2.06241,42.35906],[2.00488,42.35399],[1.96482,42.37787],[1.9574,42.42401],[1.94084,42.43039],[1.94061,42.43333],[1.94292,42.44316],[1.93663,42.45439],[1.88853,42.4501],[1.83037,42.48395],[1.76335,42.48863],[1.72515,42.50338],[1.70571,42.48867],[1.66826,42.50779],[1.65674,42.47125],[1.58933,42.46275],[1.57953,42.44957],[1.55937,42.45808],[1.55073,42.43299],[1.5127,42.42959],[1.44529,42.43724],[1.43838,42.47848],[1.41648,42.48315],[1.46661,42.50949],[1.44759,42.54431],[1.41245,42.53539],[1.4234,42.55959],[1.44529,42.56722],[1.42512,42.58292],[1.44197,42.60217],[1.35562,42.71944],[1.15928,42.71407],[1.0804,42.78569],[.98292,42.78754],[.96166,42.80629],[.93089,42.79154],[.711,42.86372],[.66121,42.84021],[.65421,42.75872],[.67873,42.69458],[.40214,42.69779],[.36251,42.72282],[.29407,42.67431],[.25336,42.7174],[.17569,42.73424],[-.02468,42.68513],[-.10519,42.72761],[-.16141,42.79535],[-.17939,42.78974],[-.3122,42.84788],[-.38833,42.80132],[-.41319,42.80776],[-.44334,42.79939],[-.50863,42.82713],[-.55497,42.77846],[-.67637,42.88303],[-.69837,42.87945],[-.72608,42.89318],[-.73422,42.91228],[-.72037,42.92541],[-.75478,42.96916],[-.81652,42.95166],[-.97133,42.96239],[-1.00963,42.99279],[-1.10333,43.0059],[-1.22881,43.05534],[-1.25244,43.04164],[-1.30531,43.06859],[-1.30052,43.09581],[-1.27118,43.11961],[-1.32209,43.1127],[-1.34419,43.09665],[-1.35272,43.02658],[-1.44067,43.047],[-1.47555,43.08372],[-1.41562,43.12815],[-1.3758,43.24511],[-1.40942,43.27272],[-1.45289,43.27049],[-1.50992,43.29481],[-1.55963,43.28828],[-1.57674,43.25269],[-1.61341,43.25269],[-1.63052,43.28591],[-1.62481,43.30726],[-1.69407,43.31378],[-1.73074,43.29481],[-1.7397,43.32979],[-1.75079,43.3317],[-1.75334,43.34107],[-1.77068,43.34396],[-1.78714,43.35476],[-1.78332,43.36399],[-1.79319,43.37497],[-1.77289,43.38957],[-1.81005,43.59738],[-10.14298,44.17365],[-11.19304,41.83075],[-8.87157,41.86488],[-8.81794,41.90375],[-8.75712,41.92833],[-8.74606,41.9469],[-8.7478,41.96282],[-8.69071,41.98862],[-8.6681,41.99703],[-8.65832,42.02972],[-8.64626,42.03668],[-8.63791,42.04691],[-8.59493,42.05708],[-8.58086,42.05147],[-8.54563,42.0537],[-8.5252,42.06264],[-8.52837,42.07658],[-8.48185,42.0811],[-8.44123,42.08218],[-8.42512,42.07199],[-8.40143,42.08052],[-8.38323,42.07683],[-8.36353,42.09065],[-8.33912,42.08358],[-8.32161,42.10218],[-8.29809,42.106],[-8.2732,42.12396],[-8.24681,42.13993],[-8.22406,42.1328],[-8.1986,42.15402],[-8.18947,42.13853],[-8.19406,42.12141],[-8.18178,42.06436],[-8.11729,42.08537],[-8.08847,42.05767],[-8.08796,42.01398],[-8.16232,41.9828],[-8.2185,41.91237],[-8.19551,41.87459],[-8.16944,41.87944],[-8.16455,41.81753],[-8.0961,41.81024],[-8.01136,41.83453],[-7.9804,41.87337],[-7.92336,41.8758],[-7.90707,41.92432],[-7.88751,41.92553],[-7.88055,41.84571],[-7.84188,41.88065],[-7.69848,41.90977],[-7.65774,41.88308],[-7.58603,41.87944],[-7.62188,41.83089],[-7.52737,41.83939],[-7.49803,41.87095],[-7.45566,41.86488],[-7.44759,41.84451],[-7.42854,41.83262],[-7.42864,41.80589],[-7.37092,41.85031],[-7.32366,41.8406],[-7.18677,41.88793],[-7.18549,41.97515],[-7.14115,41.98855],[-7.08574,41.97401],[-7.07596,41.94977],[-7.01078,41.94977],[-6.98144,41.9728],[-6.95537,41.96553],[-6.94396,41.94403],[-6.82174,41.94493],[-6.81196,41.99097],[-6.76959,41.98734],[-6.75004,41.94129],[-6.61967,41.94008],[-6.58544,41.96674],[-6.5447,41.94371],[-6.56752,41.88429],[-6.51374,41.8758],[-6.56426,41.74219],[-6.54633,41.68623],[-6.49907,41.65823],[-6.44204,41.68258],[-6.29863,41.66432],[-6.19128,41.57638],[-6.26777,41.48796],[-6.3306,41.37677],[-6.38553,41.38655],[-6.38551,41.35274],[-6.55937,41.24417],[-6.65046,41.24725],[-6.68286,41.21641],[-6.69711,41.1858],[-6.77319,41.13049],[-6.75655,41.10187],[-6.79241,41.05397],[-6.80942,41.03629],[-6.84781,41.02692],[-6.88843,41.03027],[-6.913,41.03922],[-6.9357,41.02888],[-6.8527,40.93958],[-6.84292,40.89771],[-6.80707,40.88047],[-6.79892,40.84842],[-6.82337,40.84472],[-6.82826,40.74603],[-6.79567,40.65955],[-6.84292,40.56801],[-6.80218,40.55067],[-6.7973,40.51723],[-6.84944,40.46394],[-6.84618,40.42177],[-6.78426,40.36468],[-6.80218,40.33239],[-6.86085,40.2976],[-6.86085,40.26776],[-7.00426,40.23169],[-7.02544,40.18564],[-7.00589,40.12087],[-6.94233,40.10716],[-6.86737,40.01986],[-6.91463,39.86618],[-6.97492,39.81488],[-7.01613,39.66877],[-7.24707,39.66576],[-7.33507,39.64569],[-7.54121,39.66717],[-7.49477,39.58794],[-7.2927,39.45847],[-7.3149,39.34857],[-7.23403,39.27579],[-7.23566,39.20132],[-7.12811,39.17101],[-7.14929,39.11287],[-7.10692,39.10275],[-7.04011,39.11919],[-6.97004,39.07619],[-6.95211,39.0243],[-7.051,38.907],[-7.03848,38.87221],[-7.26174,38.72107],[-7.265,38.61674],[-7.32529,38.44336],[-7.15581,38.27597],[-7.09389,38.17227],[-6.93418,38.21454],[-7.00375,38.01914],[-7.05966,38.01966],[-7.10366,38.04404],[-7.12648,38.00296],[-7.24544,37.98884],[-7.27314,37.90145],[-7.33441,37.81193],[-7.41981,37.75729],[-7.51759,37.56119],[-7.46878,37.47127],[-7.43974,37.38913],[-7.43227,37.25152],[-7.41854,37.23813],[-7.41133,37.20314],[-7.39769,37.16868],[-7.37282,36.96896],[-7.2725,35.73269],[-5.10878,36.05227],[-2.27707,35.35051],[3.75438,42.33445]],[[-5.27801,36.14942],[-5.34064,36.03744],[-5.40526,36.15488],[-5.34536,36.15501],[-5.33822,36.15272],[-5.27801,36.14942]]],[[[1.99838,42.44682],[2.01564,42.45171],[1.99216,42.46208],[1.98579,42.47486],[1.99766,42.4858],[1.98916,42.49351],[1.98022,42.49569],[1.97697,42.48568],[1.97227,42.48487],[1.97003,42.48081],[1.96215,42.47854],[1.95606,42.45785],[1.96125,42.45364],[1.98378,42.44697],[1.99838,42.44682]]]]}},{type:"Feature",properties:{wikidata:"Q98059339",nameEn:"Mainland Norway",country:"NO",groups:["154","150","UN"],callingCodes:["47"]},geometry:{type:"MultiPolygon",coordinates:[[[[10.40861,58.38489],[10.64958,58.89391],[11.08911,58.98745],[11.15367,59.07862],[11.34459,59.11672],[11.4601,58.99022],[11.45199,58.89604],[11.65732,58.90177],[11.8213,59.24985],[11.69297,59.59442],[11.92112,59.69531],[11.87121,59.86039],[12.15641,59.8926],[12.36317,59.99259],[12.52003,60.13846],[12.59133,60.50559],[12.2277,61.02442],[12.69115,61.06584],[12.86939,61.35427],[12.57707,61.56547],[12.40595,61.57226],[12.14746,61.7147],[12.29187,62.25699],[12.07085,62.6297],[12.19919,63.00104],[11.98529,63.27487],[12.19919,63.47935],[12.14928,63.59373],[12.74105,64.02171],[13.23411,64.09087],[13.98222,64.00953],[14.16051,64.18725],[14.11117,64.46674],[13.64276,64.58402],[14.50926,65.31786],[14.53778,66.12399],[15.05113,66.15572],[15.49318,66.28509],[15.37197,66.48217],[16.35589,67.06419],[16.39154,67.21653],[16.09922,67.4364],[16.12774,67.52106],[16.38441,67.52923],[16.7409,67.91037],[17.30416,68.11591],[17.90787,67.96537],[18.13836,68.20874],[18.1241,68.53721],[18.39503,68.58672],[18.63032,68.50849],[18.97255,68.52416],[19.93508,68.35911],[20.22027,68.48759],[19.95647,68.55546],[20.22027,68.67246],[20.33435,68.80174],[20.28444,68.93283],[20.0695,69.04469],[20.55258,69.06069],[20.72171,69.11874],[21.05775,69.0356],[21.11099,69.10291],[20.98641,69.18809],[21.00732,69.22755],[21.27827,69.31281],[21.63833,69.27485],[22.27276,68.89514],[22.38367,68.71561],[22.53321,68.74393],[23.13064,68.64684],[23.68017,68.70276],[23.781,68.84514],[24.02299,68.81601],[24.18432,68.73936],[24.74898,68.65143],[24.90023,68.55579],[24.93048,68.61102],[25.10189,68.63307],[25.12206,68.78684],[25.42455,68.90328],[25.61613,68.89602],[25.75729,68.99383],[25.69679,69.27039],[25.96904,69.68397],[26.40261,69.91377],[26.64461,69.96565],[27.05802,69.92069],[27.57226,70.06215],[27.95542,70.0965],[27.97558,69.99671],[28.32849,69.88605],[28.36883,69.81658],[29.12697,69.69193],[29.31664,69.47994],[28.8629,69.22395],[28.81248,69.11997],[28.91738,69.04774],[29.0444,69.0119],[29.26623,69.13794],[29.27631,69.2811],[29.97205,69.41623],[30.16363,69.65244],[30.52662,69.54699],[30.95011,69.54699],[30.84095,69.80584],[31.59909,70.16571],[32.07813,72.01005],[-11.60274,67.73467],[7.28637,57.35913],[10.40861,58.38489]]]]}},{type:"Feature",properties:{wikidata:"Q98543636",nameEn:"Mainland Ecuador",country:"EC",groups:["005","419","019","UN"],callingCodes:["593"]},geometry:{type:"MultiPolygon",coordinates:[[[[-84.52388,-3.36941],[-80.30602,-3.39149],[-80.20647,-3.431],[-80.24123,-3.46124],[-80.24586,-3.48677],[-80.23651,-3.48652],[-80.22629,-3.501],[-80.20535,-3.51667],[-80.21642,-3.5888],[-80.19848,-3.59249],[-80.18741,-3.63994],[-80.19926,-3.68894],[-80.13232,-3.90317],[-80.46386,-4.01342],[-80.4822,-4.05477],[-80.45023,-4.20938],[-80.32114,-4.21323],[-80.46386,-4.41516],[-80.39256,-4.48269],[-80.13945,-4.29786],[-79.79722,-4.47558],[-79.59402,-4.46848],[-79.26248,-4.95167],[-79.1162,-4.97774],[-79.01659,-5.01481],[-78.85149,-4.66795],[-78.68394,-4.60754],[-78.34362,-3.38633],[-78.24589,-3.39907],[-78.22642,-3.51113],[-78.14324,-3.47653],[-78.19369,-3.36431],[-77.94147,-3.05454],[-76.6324,-2.58397],[-76.05203,-2.12179],[-75.57429,-1.55961],[-75.3872,-.9374],[-75.22862,-.95588],[-75.22862,-.60048],[-75.53615,-.19213],[-75.60169,-.18708],[-75.61997,-.10012],[-75.40192,-.17196],[-75.25764,-.11943],[-75.82927,.09578],[-76.23441,.42294],[-76.41215,.38228],[-76.4094,.24015],[-76.89177,.24736],[-77.52001,.40782],[-77.49984,.64476],[-77.67815,.73863],[-77.66416,.81604],[-77.68613,.83029],[-77.7148,.85003],[-77.85677,.80197],[-78.42749,1.15389],[-78.87137,1.47457],[-82.12561,4.00341],[-84.52388,-3.36941]]]]}},{type:"Feature",properties:{m49:"001",wikidata:"Q2",nameEn:"World",aliases:["Earth","Planet"],level:"world"},geometry:null},{type:"Feature",properties:{m49:"002",wikidata:"Q15",nameEn:"Africa",level:"region"},geometry:null},{type:"Feature",properties:{m49:"003",wikidata:"Q49",nameEn:"North America",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"005",wikidata:"Q18",nameEn:"South America",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"009",wikidata:"Q538",nameEn:"Oceania",level:"region"},geometry:null},{type:"Feature",properties:{m49:"011",wikidata:"Q4412",nameEn:"Western Africa",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"013",wikidata:"Q27611",nameEn:"Central America",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"014",wikidata:"Q27407",nameEn:"Eastern Africa",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"015",wikidata:"Q27381",nameEn:"Northern Africa",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"017",wikidata:"Q27433",nameEn:"Middle Africa",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"018",wikidata:"Q27394",nameEn:"Southern Africa",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"019",wikidata:"Q828",nameEn:"Americas",level:"region"},geometry:null},{type:"Feature",properties:{m49:"021",wikidata:"Q2017699",nameEn:"Northern America",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"029",wikidata:"Q664609",nameEn:"Caribbean",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"030",wikidata:"Q27231",nameEn:"Eastern Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"034",wikidata:"Q771405",nameEn:"Southern Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"035",wikidata:"Q11708",nameEn:"South-eastern Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"039",wikidata:"Q27449",nameEn:"Southern Europe",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"053",wikidata:"Q45256",nameEn:"Australia and New Zealand",aliases:["Australasia"],level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"054",wikidata:"Q37394",nameEn:"Melanesia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"057",wikidata:"Q3359409",nameEn:"Micronesia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"061",wikidata:"Q35942",nameEn:"Polynesia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"142",wikidata:"Q48",nameEn:"Asia",level:"region"},geometry:null},{type:"Feature",properties:{m49:"143",wikidata:"Q27275",nameEn:"Central Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"145",wikidata:"Q27293",nameEn:"Western Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"150",wikidata:"Q46",nameEn:"Europe",level:"region"},geometry:null},{type:"Feature",properties:{m49:"151",wikidata:"Q27468",nameEn:"Eastern Europe",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"154",wikidata:"Q27479",nameEn:"Northern Europe",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"155",wikidata:"Q27496",nameEn:"Western Europe",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"202",wikidata:"Q132959",nameEn:"Sub-Saharan Africa",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"419",wikidata:"Q72829598",nameEn:"Latin America and the Caribbean",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"680",wikidata:"Q3405693",nameEn:"Sark",country:"GB",groups:["GG","830","Q185086","154","150","UN"],level:"subterritory",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01481"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.36485,49.48223],[-2.65349,49.15373],[-2.09454,49.46288],[-2.36485,49.48223]]]]}},{type:"Feature",properties:{m49:"830",wikidata:"Q42314",nameEn:"Channel Islands",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{iso1A2:"AC",iso1A3:"ASC",wikidata:"Q46197",nameEn:"Ascension Island",aliases:["SH-AC"],country:"GB",groups:["SH","BOTS","011","202","002","UN"],isoStatus:"excRes",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["247"]},geometry:{type:"MultiPolygon",coordinates:[[[[-14.82771,-8.70814],[-13.33271,-8.07391],[-14.91926,-6.63386],[-14.82771,-8.70814]]]]}},{type:"Feature",properties:{iso1A2:"AD",iso1A3:"AND",iso1N3:"020",wikidata:"Q228",nameEn:"Andorra",groups:["Q12837","039","150","UN"],callingCodes:["376"]},geometry:{type:"MultiPolygon",coordinates:[[[[1.72515,42.50338],[1.73683,42.55492],[1.7858,42.57698],[1.72588,42.59098],[1.73452,42.61515],[1.68267,42.62533],[1.6625,42.61982],[1.63485,42.62957],[1.60085,42.62703],[1.55418,42.65669],[1.50867,42.64483],[1.48043,42.65203],[1.46718,42.63296],[1.47986,42.61346],[1.44197,42.60217],[1.42512,42.58292],[1.44529,42.56722],[1.4234,42.55959],[1.41245,42.53539],[1.44759,42.54431],[1.46661,42.50949],[1.41648,42.48315],[1.43838,42.47848],[1.44529,42.43724],[1.5127,42.42959],[1.55073,42.43299],[1.55937,42.45808],[1.57953,42.44957],[1.58933,42.46275],[1.65674,42.47125],[1.66826,42.50779],[1.70571,42.48867],[1.72515,42.50338]]]]}},{type:"Feature",properties:{iso1A2:"AE",iso1A3:"ARE",iso1N3:"784",wikidata:"Q878",nameEn:"United Arab Emirates",groups:["145","142","UN"],callingCodes:["971"]},geometry:{type:"MultiPolygon",coordinates:[[[[56.26534,25.62825],[56.25341,25.61443],[56.26636,25.60643],[56.25365,25.60211],[56.20473,25.61119],[56.18363,25.65508],[56.14826,25.66351],[56.13579,25.73524],[56.17416,25.77239],[56.13963,25.82765],[56.19334,25.9795],[56.15498,26.06828],[56.08666,26.05038],[55.81777,26.18798],[55.14145,25.62624],[53.97892,24.64436],[52.82259,25.51697],[52.35509,25.00368],[52.02277,24.75635],[51.83108,24.71675],[51.58834,24.66608],[51.41644,24.39615],[51.58871,24.27256],[51.59617,24.12041],[52.56622,22.94341],[55.13599,22.63334],[55.2137,22.71065],[55.22634,23.10378],[55.57358,23.669],[55.48677,23.94946],[55.73301,24.05994],[55.8308,24.01633],[56.01799,24.07426],[55.95472,24.2172],[55.83367,24.20193],[55.77658,24.23476],[55.76558,24.23227],[55.75257,24.23466],[55.75382,24.2466],[55.75939,24.26114],[55.76781,24.26209],[55.79145,24.27914],[55.80747,24.31069],[55.83395,24.32776],[55.83271,24.41521],[55.76461,24.5287],[55.83271,24.68567],[55.83408,24.77858],[55.81348,24.80102],[55.81116,24.9116],[55.85094,24.96858],[55.90849,24.96771],[55.96316,25.00857],[56.05715,24.95727],[56.05106,24.87461],[55.97467,24.89639],[55.97836,24.87673],[56.03535,24.81161],[56.06128,24.74457],[56.13684,24.73699],[56.20062,24.78565],[56.20568,24.85063],[56.30269,24.88334],[56.34873,24.93205],[56.3227,24.97284],[56.86325,25.03856],[56.82555,25.7713],[56.26534,25.62825]],[[56.26062,25.33108],[56.3005,25.31815],[56.3111,25.30107],[56.35172,25.30681],[56.34438,25.26653],[56.27628,25.23404],[56.24341,25.22867],[56.20872,25.24104],[56.20838,25.25668],[56.24465,25.27505],[56.25008,25.28843],[56.23362,25.31253],[56.26062,25.33108]]],[[[56.28423,25.26344],[56.29379,25.2754],[56.28102,25.28486],[56.2716,25.27916],[56.27086,25.26128],[56.28423,25.26344]]]]}},{type:"Feature",properties:{iso1A2:"AF",iso1A3:"AFG",iso1N3:"004",wikidata:"Q889",nameEn:"Afghanistan",groups:["034","142","UN"],callingCodes:["93"]},geometry:{type:"MultiPolygon",coordinates:[[[[70.61526,38.34774],[70.60407,38.28046],[70.54673,38.24541],[70.4898,38.12546],[70.17206,37.93276],[70.1863,37.84296],[70.27694,37.81258],[70.28243,37.66706],[70.15015,37.52519],[69.95971,37.5659],[69.93362,37.61378],[69.84435,37.60616],[69.80041,37.5746],[69.51888,37.5844],[69.44954,37.4869],[69.36645,37.40462],[69.45022,37.23315],[69.39529,37.16752],[69.25152,37.09426],[69.03274,37.25174],[68.96407,37.32603],[68.88168,37.33368],[68.91189,37.26704],[68.80889,37.32494],[68.81438,37.23862],[68.6798,37.27906],[68.61851,37.19815],[68.41888,37.13906],[68.41201,37.10402],[68.29253,37.10621],[68.27605,37.00977],[68.18542,37.02074],[68.02194,36.91923],[67.87917,37.0591],[67.7803,37.08978],[67.78329,37.1834],[67.51868,37.26102],[67.2581,37.17216],[67.2224,37.24545],[67.13039,37.27168],[67.08232,37.35469],[66.95598,37.40162],[66.64699,37.32958],[66.55743,37.35409],[66.30993,37.32409],[65.72274,37.55438],[65.64137,37.45061],[65.64263,37.34388],[65.51778,37.23881],[64.97945,37.21913],[64.61141,36.6351],[64.62514,36.44311],[64.57295,36.34362],[64.43288,36.24401],[64.05385,36.10433],[63.98519,36.03773],[63.56496,35.95106],[63.53475,35.90881],[63.29579,35.85985],[63.12276,35.86208],[63.10318,35.81782],[63.23262,35.67487],[63.10079,35.63024],[63.12276,35.53196],[63.0898,35.43131],[62.90853,35.37086],[62.74098,35.25432],[62.62288,35.22067],[62.48006,35.28796],[62.29878,35.13312],[62.29191,35.25964],[62.15871,35.33278],[62.05709,35.43803],[61.97743,35.4604],[61.77693,35.41341],[61.58742,35.43803],[61.27371,35.61482],[61.18187,35.30249],[61.0991,35.27845],[61.12831,35.09938],[61.06926,34.82139],[61.00197,34.70631],[60.99922,34.63064],[60.72316,34.52857],[60.91321,34.30411],[60.66502,34.31539],[60.50209,34.13992],[60.5838,33.80793],[60.5485,33.73422],[60.57762,33.59772],[60.69573,33.56054],[60.91133,33.55596],[60.88908,33.50219],[60.56485,33.12944],[60.86191,32.22565],[60.84541,31.49561],[61.70929,31.37391],[61.80569,31.16167],[61.80957,31.12576],[61.83257,31.0452],[61.8335,30.97669],[61.78268,30.92724],[61.80829,30.84224],[60.87231,29.86514],[62.47751,29.40782],[63.5876,29.50456],[64.12966,29.39157],[64.19796,29.50407],[64.62116,29.58903],[65.04005,29.53957],[66.24175,29.85181],[66.36042,29.9583],[66.23609,30.06321],[66.34869,30.404],[66.28413,30.57001],[66.39194,30.9408],[66.42645,30.95309],[66.58175,30.97532],[66.68166,31.07597],[66.72561,31.20526],[66.83273,31.26867],[67.04147,31.31561],[67.03323,31.24519],[67.29964,31.19586],[67.78854,31.33203],[67.7748,31.4188],[67.62374,31.40473],[67.58323,31.52772],[67.72056,31.52304],[67.86887,31.63536],[68.00071,31.6564],[68.1655,31.82691],[68.25614,31.80357],[68.27605,31.75863],[68.44222,31.76446],[68.57475,31.83158],[68.6956,31.75687],[68.79997,31.61665],[68.91078,31.59687],[68.95995,31.64822],[69.00939,31.62249],[69.11514,31.70782],[69.20577,31.85957],[69.3225,31.93186],[69.27032,32.14141],[69.27932,32.29119],[69.23599,32.45946],[69.2868,32.53938],[69.38155,32.56601],[69.44747,32.6678],[69.43649,32.7302],[69.38018,32.76601],[69.47082,32.85834],[69.5436,32.8768],[69.49854,32.88843],[69.49004,33.01509],[69.57656,33.09911],[69.71526,33.09911],[69.79766,33.13247],[69.85259,33.09451],[70.02563,33.14282],[70.07369,33.22557],[70.13686,33.21064],[70.32775,33.34496],[70.17062,33.53535],[70.20141,33.64387],[70.14785,33.6553],[70.14236,33.71701],[70.00503,33.73528],[69.85671,33.93719],[69.87307,33.9689],[69.90203,34.04194],[70.54336,33.9463],[70.88119,33.97933],[71.07345,34.06242],[71.06933,34.10564],[71.09307,34.11961],[71.09453,34.13524],[71.13078,34.16503],[71.12815,34.26619],[71.17662,34.36769],[71.02401,34.44835],[71.0089,34.54568],[71.11602,34.63047],[71.08718,34.69034],[71.28356,34.80882],[71.29472,34.87728],[71.50329,34.97328],[71.49917,35.00478],[71.55273,35.02615],[71.52938,35.09023],[71.67495,35.21262],[71.5541,35.28776],[71.54294,35.31037],[71.65435,35.4479],[71.49917,35.6267],[71.55273,35.71483],[71.37969,35.95865],[71.19505,36.04134],[71.60491,36.39429],[71.80267,36.49924],[72.18135,36.71838],[72.6323,36.84601],[73.82685,36.91421],[74.04856,36.82648],[74.43389,37.00977],[74.53739,36.96224],[74.56453,37.03023],[74.49981,37.24518],[74.80605,37.21565],[74.88887,37.23275],[74.8294,37.3435],[74.68383,37.3948],[74.56161,37.37734],[74.41055,37.3948],[74.23339,37.41116],[74.20308,37.34208],[73.8564,37.26158],[73.82552,37.22659],[73.64974,37.23643],[73.61129,37.27469],[73.76647,37.33913],[73.77197,37.4417],[73.29633,37.46495],[73.06884,37.31729],[72.79693,37.22222],[72.66381,37.02014],[72.54095,37.00007],[72.31676,36.98115],[71.83229,36.68084],[71.67083,36.67346],[71.57195,36.74943],[71.51502,36.89128],[71.48481,36.93218],[71.46923,36.99925],[71.45578,37.03094],[71.43097,37.05855],[71.44127,37.11856],[71.4494,37.18137],[71.4555,37.21418],[71.47386,37.2269],[71.48339,37.23937],[71.4824,37.24921],[71.48536,37.26017],[71.50674,37.31502],[71.49821,37.31975],[71.4862,37.33405],[71.47685,37.40281],[71.49612,37.4279],[71.5256,37.47971],[71.50616,37.50733],[71.49693,37.53527],[71.5065,37.60912],[71.51972,37.61945],[71.54186,37.69691],[71.55234,37.73209],[71.53053,37.76534],[71.54324,37.77104],[71.55752,37.78677],[71.59255,37.79956],[71.58843,37.92425],[71.51565,37.95349],[71.32871,37.88564],[71.296,37.93403],[71.2809,37.91995],[71.24969,37.93031],[71.27278,37.96496],[71.27622,37.99946],[71.28922,38.01272],[71.29878,38.04429],[71.36444,38.15358],[71.37803,38.25641],[71.33869,38.27335],[71.33114,38.30339],[71.21291,38.32797],[71.1451,38.40106],[71.10957,38.40671],[71.10592,38.42077],[71.09542,38.42517],[71.0556,38.40176],[71.03545,38.44779],[70.98693,38.48862],[70.92728,38.43021],[70.88719,38.46826],[70.84376,38.44688],[70.82538,38.45394],[70.81697,38.44507],[70.80521,38.44447],[70.79766,38.44944],[70.78702,38.45031],[70.78581,38.45502],[70.77132,38.45548],[70.75455,38.4252],[70.72485,38.4131],[70.69807,38.41861],[70.67438,38.40597],[70.6761,38.39144],[70.69189,38.37031],[70.64966,38.34999],[70.61526,38.34774]]]]}},{type:"Feature",properties:{iso1A2:"AG",iso1A3:"ATG",iso1N3:"028",wikidata:"Q781",nameEn:"Antigua and Barbuda",groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 268"]},geometry:{type:"MultiPolygon",coordinates:[[[[-61.66959,18.6782],[-62.58307,16.68909],[-62.1023,16.97277],[-61.23098,16.62484],[-61.66959,18.6782]]]]}},{type:"Feature",properties:{iso1A2:"AI",iso1A3:"AIA",iso1N3:"660",wikidata:"Q25228",nameEn:"Anguilla",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 264"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.79029,19.11219],[-63.35989,18.06012],[-62.62718,18.26185],[-63.79029,19.11219]]]]}},{type:"Feature",properties:{iso1A2:"AL",iso1A3:"ALB",iso1N3:"008",wikidata:"Q222",nameEn:"Albania",groups:["039","150","UN"],callingCodes:["355"]},geometry:{type:"MultiPolygon",coordinates:[[[[20.07761,42.55582],[20.01834,42.54622],[20.00842,42.5109],[19.9324,42.51699],[19.82333,42.46581],[19.76549,42.50237],[19.74731,42.57422],[19.77375,42.58517],[19.73244,42.66299],[19.65972,42.62774],[19.4836,42.40831],[19.42352,42.36546],[19.42,42.33019],[19.28623,42.17745],[19.40687,42.10024],[19.37548,42.06835],[19.36867,42.02564],[19.37691,41.96977],[19.34601,41.95675],[19.33812,41.90669],[19.37451,41.8842],[19.37597,41.84849],[19.26406,41.74971],[19.0384,40.35325],[19.95905,39.82857],[19.97622,39.78684],[19.92466,39.69533],[19.98042,39.6504],[20.00957,39.69227],[20.05189,39.69112],[20.12956,39.65805],[20.15988,39.652],[20.22376,39.64532],[20.22707,39.67459],[20.27412,39.69884],[20.31961,39.72799],[20.29152,39.80421],[20.30804,39.81563],[20.38572,39.78516],[20.41475,39.81437],[20.41546,39.82832],[20.31135,39.99438],[20.37911,39.99058],[20.42373,40.06777],[20.48487,40.06271],[20.51297,40.08168],[20.55593,40.06524],[20.61081,40.07866],[20.62566,40.0897],[20.67162,40.09433],[20.71789,40.27739],[20.78234,40.35803],[20.7906,40.42726],[20.83688,40.47882],[20.94925,40.46625],[20.96908,40.51526],[21.03932,40.56299],[21.05833,40.66586],[20.98134,40.76046],[20.95752,40.76982],[20.98396,40.79109],[20.97887,40.85475],[20.97693,40.90103],[20.94305,40.92399],[20.83671,40.92752],[20.81567,40.89662],[20.73504,40.9081],[20.71634,40.91781],[20.65558,41.08009],[20.63454,41.0889],[20.59832,41.09066],[20.58546,41.11179],[20.59715,41.13644],[20.51068,41.2323],[20.49432,41.33679],[20.52119,41.34381],[20.55976,41.4087],[20.51301,41.442],[20.49039,41.49277],[20.45331,41.51436],[20.45809,41.5549],[20.52103,41.56473],[20.55508,41.58113],[20.51769,41.65975],[20.52937,41.69292],[20.51301,41.72433],[20.53405,41.78099],[20.57144,41.7897],[20.55976,41.87068],[20.59524,41.8818],[20.57946,41.91593],[20.63069,41.94913],[20.59434,42.03879],[20.55633,42.08173],[20.56955,42.12097],[20.48857,42.25444],[20.3819,42.3029],[20.34479,42.32656],[20.24399,42.32168],[20.21797,42.41237],[20.17127,42.50469],[20.07761,42.55582]]]]}},{type:"Feature",properties:{iso1A2:"AM",iso1A3:"ARM",iso1N3:"051",wikidata:"Q399",nameEn:"Armenia",groups:["145","142","UN"],callingCodes:["374"]},geometry:{type:"MultiPolygon",coordinates:[[[[45.0133,41.29747],[44.93493,41.25685],[44.81437,41.30371],[44.80053,41.25949],[44.81749,41.23488],[44.84358,41.23088],[44.89911,41.21366],[44.87887,41.20195],[44.82084,41.21513],[44.72814,41.20338],[44.61462,41.24018],[44.59322,41.1933],[44.46791,41.18204],[44.34417,41.2382],[44.34337,41.20312],[44.32139,41.2079],[44.18148,41.24644],[44.16591,41.19141],[43.84835,41.16329],[43.74717,41.1117],[43.67712,41.13398],[43.4717,41.12611],[43.44984,41.0988],[43.47319,41.02251],[43.58683,40.98961],[43.67712,40.93084],[43.67712,40.84846],[43.74872,40.7365],[43.7425,40.66805],[43.63664,40.54159],[43.54791,40.47413],[43.60862,40.43267],[43.59928,40.34019],[43.71136,40.16673],[43.65221,40.14889],[43.65688,40.11199],[43.92307,40.01787],[44.1057,40.03555],[44.1778,40.02845],[44.26973,40.04866],[44.46635,39.97733],[44.61845,39.8281],[44.75779,39.7148],[44.88354,39.74432],[44.92869,39.72157],[45.06604,39.79277],[45.18554,39.67846],[45.17464,39.58614],[45.21784,39.58074],[45.23535,39.61373],[45.30385,39.61373],[45.29606,39.57654],[45.46992,39.49888],[45.70547,39.60174],[45.80804,39.56716],[45.83,39.46487],[45.79225,39.3695],[45.99774,39.28931],[46.02303,39.09978],[46.06973,39.0744],[46.14785,38.84206],[46.20601,38.85262],[46.34059,38.92076],[46.53497,38.86548],[46.51805,38.94982],[46.54296,39.07078],[46.44022,39.19636],[46.52584,39.18912],[46.54141,39.15895],[46.58032,39.21204],[46.63481,39.23013],[46.56476,39.24942],[46.50093,39.33736],[46.43244,39.35181],[46.37795,39.42039],[46.4013,39.45405],[46.53051,39.47809],[46.51027,39.52373],[46.57721,39.54414],[46.57098,39.56694],[46.52117,39.58734],[46.42465,39.57534],[46.40286,39.63651],[46.18493,39.60533],[45.96543,39.78859],[45.82533,39.82925],[45.7833,39.9475],[45.60895,39.97733],[45.59806,40.0131],[45.78642,40.03218],[45.83779,39.98925],[45.97944,40.181],[45.95609,40.27846],[45.65098,40.37696],[45.42994,40.53804],[45.45484,40.57707],[45.35366,40.65979],[45.4206,40.7424],[45.55914,40.78366],[45.60584,40.87436],[45.40814,40.97904],[45.44083,41.01663],[45.39725,41.02603],[45.35677,40.99784],[45.28859,41.03757],[45.26162,41.0228],[45.25897,41.0027],[45.1994,41.04518],[45.16493,41.05068],[45.1634,41.08082],[45.1313,41.09369],[45.12923,41.06059],[45.06784,41.05379],[45.08028,41.10917],[45.19942,41.13299],[45.1969,41.168],[45.11811,41.19967],[45.05201,41.19211],[45.02932,41.2101],[45.05497,41.2464],[45.0133,41.29747]],[[45.21324,40.9817],[45.21219,40.99001],[45.20518,40.99348],[45.19312,40.98998],[45.18382,41.0066],[45.20625,41.01484],[45.23487,41.00226],[45.23095,40.97828],[45.21324,40.9817]],[[45.00864,41.03411],[44.9903,41.05657],[44.96031,41.06345],[44.95383,41.07553],[44.97169,41.09176],[45.00864,41.09407],[45.03406,41.07931],[45.04517,41.06653],[45.03792,41.03938],[45.00864,41.03411]]],[[[45.50279,40.58424],[45.56071,40.64765],[45.51825,40.67382],[45.47927,40.65023],[45.50279,40.58424]]]]}},{type:"Feature",properties:{iso1A2:"AO",iso1A3:"AGO",iso1N3:"024",wikidata:"Q916",nameEn:"Angola",groups:["017","202","002","UN"],callingCodes:["244"]},geometry:{type:"MultiPolygon",coordinates:[[[[16.55507,-5.85631],[13.04371,-5.87078],[12.42245,-6.07585],[11.95767,-5.94705],[12.20376,-5.76338],[12.26557,-5.74031],[12.52318,-5.74353],[12.52301,-5.17481],[12.53599,-5.1618],[12.53586,-5.14658],[12.51589,-5.1332],[12.49815,-5.14058],[12.46297,-5.09408],[12.60251,-5.01715],[12.63465,-4.94632],[12.70868,-4.95505],[12.8733,-4.74346],[13.11195,-4.67745],[13.09648,-4.63739],[12.91489,-4.47907],[12.87096,-4.40315],[12.76844,-4.38709],[12.64835,-4.55937],[12.40964,-4.60609],[12.32324,-4.78415],[12.25587,-4.79437],[12.20901,-4.75642],[12.16068,-4.90089],[12.00924,-5.02627],[11.50888,-5.33417],[10.5065,-17.25284],[11.75063,-17.25013],[12.07076,-17.15165],[12.52111,-17.24495],[12.97145,-16.98567],[13.36212,-16.98048],[13.95896,-17.43141],[14.28743,-17.38814],[18.39229,-17.38927],[18.84226,-17.80375],[21.14283,-17.94318],[21.42741,-18.02787],[23.47474,-17.62877],[23.20038,-17.47563],[22.17217,-16.50269],[22.00323,-16.18028],[21.97988,-13.00148],[24.03339,-12.99091],[23.90937,-12.844],[24.06672,-12.29058],[23.98804,-12.13149],[24.02603,-11.15368],[24.00027,-10.89356],[23.86868,-11.02856],[23.45631,-10.946],[23.16602,-11.10577],[22.54205,-11.05784],[22.25951,-11.24911],[22.17954,-10.85884],[22.32604,-10.76291],[22.19039,-9.94628],[21.84856,-9.59871],[21.79824,-7.29628],[20.56263,-7.28566],[20.61689,-6.90876],[20.31846,-6.91953],[20.30218,-6.98955],[19.5469,-7.00195],[19.33698,-7.99743],[18.33635,-8.00126],[17.5828,-8.13784],[16.96282,-7.21787],[16.55507,-5.85631]]]]}},{type:"Feature",properties:{iso1A2:"AQ",iso1A3:"ATA",iso1N3:"010",wikidata:"Q51",nameEn:"Antarctica",level:"region",callingCodes:["672"]},geometry:{type:"MultiPolygon",coordinates:[[[[180,-60],[-180,-60],[-180,-90],[180,-90],[180,-60]]]]}},{type:"Feature",properties:{iso1A2:"AR",iso1A3:"ARG",iso1N3:"032",wikidata:"Q414",nameEn:"Argentina",aliases:["RA"],groups:["005","419","019","UN"],callingCodes:["54"]},geometry:{type:"MultiPolygon",coordinates:[[[[-72.31343,-50.58411],[-72.33873,-51.59954],[-71.99889,-51.98018],[-69.97824,-52.00845],[-68.41683,-52.33516],[-68.60702,-52.65781],[-68.60733,-54.9125],[-68.01394,-54.8753],[-67.46182,-54.92205],[-67.11046,-54.94199],[-66.07313,-55.19618],[-63.67376,-55.11859],[-54.78916,-36.21945],[-57.83001,-34.69099],[-58.34425,-34.15035],[-58.44442,-33.84033],[-58.40475,-33.11777],[-58.1224,-32.98842],[-58.22362,-32.52416],[-58.10036,-32.25338],[-58.20252,-31.86966],[-58.00076,-31.65016],[-58.0023,-31.53084],[-58.07569,-31.44916],[-57.98127,-31.3872],[-57.9908,-31.34924],[-57.86729,-31.06352],[-57.89476,-30.95994],[-57.8024,-30.77193],[-57.89115,-30.49572],[-57.64859,-30.35095],[-57.61478,-30.25165],[-57.65132,-30.19229],[-57.09386,-29.74211],[-56.81251,-29.48154],[-56.62789,-29.18073],[-56.57295,-29.11357],[-56.54171,-29.11447],[-56.05265,-28.62651],[-56.00458,-28.60421],[-56.01729,-28.51223],[-55.65418,-28.18304],[-55.6262,-28.17124],[-55.33303,-27.94661],[-55.16872,-27.86224],[-55.1349,-27.89759],[-54.90805,-27.73149],[-54.90159,-27.63132],[-54.67657,-27.57214],[-54.50416,-27.48232],[-54.41888,-27.40882],[-54.19268,-27.30751],[-54.19062,-27.27639],[-54.15978,-27.2889],[-53.80144,-27.09844],[-53.73372,-26.6131],[-53.68269,-26.33359],[-53.64505,-26.28089],[-53.64186,-26.25976],[-53.64632,-26.24798],[-53.63881,-26.25075],[-53.63739,-26.2496],[-53.65237,-26.23289],[-53.65018,-26.19501],[-53.73968,-26.10012],[-53.73391,-26.07006],[-53.7264,-26.0664],[-53.73086,-26.05842],[-53.73511,-26.04211],[-53.83691,-25.94849],[-53.90831,-25.55513],[-54.52926,-25.62846],[-54.5502,-25.58915],[-54.59398,-25.59224],[-54.62063,-25.91213],[-54.60664,-25.9691],[-54.67359,-25.98607],[-54.69333,-26.37705],[-54.70732,-26.45099],[-54.80868,-26.55669],[-55.00584,-26.78754],[-55.06351,-26.80195],[-55.16948,-26.96068],[-55.25243,-26.93808],[-55.39611,-26.97679],[-55.62322,-27.1941],[-55.59094,-27.32444],[-55.74475,-27.44485],[-55.89195,-27.3467],[-56.18313,-27.29851],[-56.85337,-27.5165],[-58.04205,-27.2387],[-58.59549,-27.29973],[-58.65321,-27.14028],[-58.3198,-26.83443],[-58.1188,-26.16704],[-57.87176,-25.93604],[-57.57431,-25.47269],[-57.80821,-25.13863],[-58.25492,-24.92528],[-58.33055,-24.97099],[-59.33886,-24.49935],[-59.45482,-24.34787],[-60.03367,-24.00701],[-60.28163,-24.04436],[-60.99754,-23.80934],[-61.0782,-23.62932],[-61.9756,-23.0507],[-62.22768,-22.55807],[-62.51761,-22.37684],[-62.64455,-22.25091],[-62.8078,-22.12534],[-62.81124,-21.9987],[-63.66482,-21.99918],[-63.68113,-22.0544],[-63.70963,-21.99934],[-63.93287,-21.99934],[-64.22918,-22.55807],[-64.31489,-22.88824],[-64.35108,-22.73282],[-64.4176,-22.67692],[-64.58888,-22.25035],[-64.67174,-22.18957],[-64.90014,-22.12136],[-64.99524,-22.08255],[-65.47435,-22.08908],[-65.57743,-22.07675],[-65.58694,-22.09794],[-65.61166,-22.09504],[-65.7467,-22.10105],[-65.9261,-21.93335],[-66.04832,-21.9187],[-66.03836,-21.84829],[-66.24077,-21.77837],[-66.29714,-22.08741],[-66.7298,-22.23644],[-67.18382,-22.81525],[-66.99632,-22.99839],[-67.33563,-24.04237],[-68.24825,-24.42596],[-68.56909,-24.69831],[-68.38372,-25.08636],[-68.57622,-25.32505],[-68.38372,-26.15353],[-68.56909,-26.28146],[-68.59048,-26.49861],[-68.27677,-26.90626],[-68.43363,-27.08414],[-68.77586,-27.16029],[-69.22504,-27.95042],[-69.66709,-28.44055],[-69.80969,-29.07185],[-69.99507,-29.28351],[-69.8596,-30.26131],[-70.14479,-30.36595],[-70.55832,-31.51559],[-69.88099,-33.34489],[-69.87386,-34.13344],[-70.49416,-35.24145],[-70.38008,-36.02375],[-70.95047,-36.4321],[-71.24279,-37.20264],[-70.89532,-38.6923],[-71.37826,-38.91474],[-71.92726,-40.72714],[-71.74901,-42.11711],[-72.15541,-42.15941],[-72.14828,-42.85321],[-71.64206,-43.64774],[-71.81318,-44.38097],[-71.16436,-44.46244],[-71.26418,-44.75684],[-72.06985,-44.81756],[-71.35687,-45.22075],[-71.75614,-45.61611],[-71.68577,-46.55385],[-71.94152,-47.13595],[-72.50478,-47.80586],[-72.27662,-48.28727],[-72.54042,-48.52392],[-72.56894,-48.81116],[-73.09655,-49.14342],[-73.45156,-49.79461],[-73.55259,-49.92488],[-73.15765,-50.78337],[-72.31343,-50.58411]]]]}},{type:"Feature",properties:{iso1A2:"AS",iso1A3:"ASM",iso1N3:"016",wikidata:"Q16641",nameEn:"American Samoa",aliases:["US-AS"],country:"US",groups:["Q1352230","061","009","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 684"]},geometry:{type:"MultiPolygon",coordinates:[[[[-171.39864,-10.21587],[-170.99605,-15.1275],[-166.32598,-15.26169],[-171.39864,-10.21587]]]]}},{type:"Feature",properties:{iso1A2:"AT",iso1A3:"AUT",iso1N3:"040",wikidata:"Q40",nameEn:"Austria",groups:["EU","155","150","UN"],callingCodes:["43"]},geometry:{type:"MultiPolygon",coordinates:[[[[15.34823,48.98444],[15.28305,48.98831],[15.26177,48.95766],[15.16358,48.94278],[15.15534,48.99056],[14.99878,49.01444],[14.97612,48.96983],[14.98917,48.90082],[14.95072,48.79101],[14.98032,48.77959],[14.9782,48.7766],[14.98112,48.77524],[14.9758,48.76857],[14.95641,48.75915],[14.94773,48.76268],[14.81545,48.7874],[14.80821,48.77711],[14.80584,48.73489],[14.72756,48.69502],[14.71794,48.59794],[14.66762,48.58215],[14.60808,48.62881],[14.56139,48.60429],[14.4587,48.64695],[14.43076,48.58855],[14.33909,48.55852],[14.20691,48.5898],[14.09104,48.5943],[14.01482,48.63788],[14.06151,48.66873],[13.84023,48.76988],[13.82266,48.75544],[13.81863,48.73257],[13.79337,48.71375],[13.81791,48.69832],[13.81283,48.68426],[13.81901,48.6761],[13.82609,48.62345],[13.80038,48.59487],[13.80519,48.58026],[13.76921,48.55324],[13.7513,48.5624],[13.74816,48.53058],[13.72802,48.51208],[13.66113,48.53558],[13.65186,48.55092],[13.62508,48.55501],[13.59705,48.57013],[13.57535,48.55912],[13.51291,48.59023],[13.50131,48.58091],[13.50663,48.57506],[13.46967,48.55157],[13.45214,48.56472],[13.43695,48.55776],[13.45727,48.51092],[13.42527,48.45711],[13.43929,48.43386],[13.40709,48.37292],[13.30897,48.31575],[13.26039,48.29422],[13.18093,48.29577],[13.126,48.27867],[13.0851,48.27711],[13.02083,48.25689],[12.95306,48.20629],[12.87126,48.20318],[12.84475,48.16556],[12.836,48.1647],[12.8362,48.15876],[12.82673,48.15245],[12.80676,48.14979],[12.78595,48.12445],[12.7617,48.12796],[12.74973,48.10885],[12.76141,48.07373],[12.8549,48.01122],[12.87476,47.96195],[12.91683,47.95647],[12.9211,47.95135],[12.91985,47.94069],[12.92668,47.93879],[12.93419,47.94063],[12.93642,47.94436],[12.93886,47.94046],[12.94163,47.92927],[13.00588,47.84374],[12.98543,47.82896],[12.96311,47.79957],[12.93202,47.77302],[12.94371,47.76281],[12.9353,47.74788],[12.91711,47.74026],[12.90274,47.72513],[12.91333,47.7178],[12.92969,47.71094],[12.98578,47.7078],[13.01382,47.72116],[13.07692,47.68814],[13.09562,47.63304],[13.06407,47.60075],[13.06641,47.58577],[13.04537,47.58183],[13.05355,47.56291],[13.03252,47.53373],[13.04537,47.49426],[12.9998,47.46267],[12.98344,47.48716],[12.9624,47.47452],[12.85256,47.52741],[12.84672,47.54556],[12.80699,47.54477],[12.77427,47.58025],[12.82101,47.61493],[12.76492,47.64485],[12.77777,47.66689],[12.7357,47.6787],[12.6071,47.6741],[12.57438,47.63238],[12.53816,47.63553],[12.50076,47.62293],[12.44117,47.6741],[12.43883,47.6977],[12.37222,47.68433],[12.336,47.69534],[12.27991,47.68827],[12.26004,47.67725],[12.24017,47.69534],[12.26238,47.73544],[12.2542,47.7433],[12.22571,47.71776],[12.18303,47.70065],[12.16217,47.70105],[12.16769,47.68167],[12.18347,47.66663],[12.18507,47.65984],[12.19895,47.64085],[12.20801,47.61082],[12.20398,47.60667],[12.18568,47.6049],[12.17737,47.60121],[12.18145,47.61019],[12.17824,47.61506],[12.13734,47.60639],[12.05788,47.61742],[12.02282,47.61033],[12.0088,47.62451],[11.85572,47.60166],[11.84052,47.58354],[11.63934,47.59202],[11.60681,47.57881],[11.58811,47.55515],[11.58578,47.52281],[11.52618,47.50939],[11.4362,47.51413],[11.38128,47.47465],[11.4175,47.44621],[11.33804,47.44937],[11.29597,47.42566],[11.27844,47.39956],[11.22002,47.3964],[11.25157,47.43277],[11.20482,47.43198],[11.12536,47.41222],[11.11835,47.39719],[10.97111,47.39561],[10.97111,47.41617],[10.98513,47.42882],[10.92437,47.46991],[10.93839,47.48018],[10.90918,47.48571],[10.87061,47.4786],[10.86945,47.5015],[10.91268,47.51334],[10.88814,47.53701],[10.77596,47.51729],[10.7596,47.53228],[10.6965,47.54253],[10.68832,47.55752],[10.63456,47.5591],[10.60337,47.56755],[10.56912,47.53584],[10.48849,47.54057],[10.47329,47.58552],[10.43473,47.58394],[10.44992,47.5524],[10.4324,47.50111],[10.44291,47.48453],[10.46278,47.47901],[10.47446,47.43318],[10.4359,47.41183],[10.4324,47.38494],[10.39851,47.37623],[10.33424,47.30813],[10.23257,47.27088],[10.17531,47.27167],[10.17648,47.29149],[10.2147,47.31014],[10.19998,47.32832],[10.23757,47.37609],[10.22774,47.38904],[10.2127,47.38019],[10.17648,47.38889],[10.16362,47.36674],[10.11805,47.37228],[10.09819,47.35724],[10.06897,47.40709],[10.1052,47.4316],[10.09001,47.46005],[10.07131,47.45531],[10.03859,47.48927],[10.00003,47.48216],[9.96029,47.53899],[9.92407,47.53111],[9.87733,47.54688],[9.87499,47.52953],[9.8189,47.54688],[9.82591,47.58158],[9.80254,47.59419],[9.76748,47.5934],[9.72736,47.53457],[9.55125,47.53629],[9.56312,47.49495],[9.58208,47.48344],[9.59482,47.46305],[9.60205,47.46165],[9.60484,47.46358],[9.60841,47.47178],[9.62158,47.45858],[9.62475,47.45685],[9.6423,47.45599],[9.65728,47.45383],[9.65863,47.44847],[9.64483,47.43842],[9.6446,47.43233],[9.65043,47.41937],[9.65136,47.40504],[9.6629,47.39591],[9.67334,47.39191],[9.67445,47.38429],[9.6711,47.37824],[9.66243,47.37136],[9.65427,47.36824],[9.62476,47.36639],[9.59978,47.34671],[9.58513,47.31334],[9.55857,47.29919],[9.54773,47.2809],[9.53116,47.27029],[9.56766,47.24281],[9.55176,47.22585],[9.56981,47.21926],[9.58264,47.20673],[9.56539,47.17124],[9.62623,47.14685],[9.63395,47.08443],[9.61216,47.07732],[9.60717,47.06091],[9.87935,47.01337],[9.88266,46.93343],[9.98058,46.91434],[10.10715,46.84296],[10.22675,46.86942],[10.24128,46.93147],[10.30031,46.92093],[10.36933,47.00212],[10.48376,46.93891],[10.47197,46.85698],[10.54783,46.84505],[10.66405,46.87614],[10.75753,46.82258],[10.72974,46.78972],[11.00764,46.76896],[11.10618,46.92966],[11.33355,46.99862],[11.50739,47.00644],[11.74789,46.98484],[12.19254,47.09331],[12.21781,47.03996],[12.11675,47.01241],[12.2006,46.88854],[12.27591,46.88651],[12.38708,46.71529],[12.59992,46.6595],[12.94445,46.60401],[13.27627,46.56059],[13.64088,46.53438],[13.7148,46.5222],[13.89837,46.52331],[14.00422,46.48474],[14.04002,46.49117],[14.12097,46.47724],[14.15989,46.43327],[14.28326,46.44315],[14.314,46.43327],[14.42608,46.44614],[14.45877,46.41717],[14.52176,46.42617],[14.56463,46.37208],[14.5942,46.43434],[14.66892,46.44936],[14.72185,46.49974],[14.81836,46.51046],[14.83549,46.56614],[14.86419,46.59411],[14.87129,46.61],[14.92283,46.60848],[14.96002,46.63459],[14.98024,46.6009],[15.01451,46.641],[15.14215,46.66131],[15.23711,46.63994],[15.41235,46.65556],[15.45514,46.63697],[15.46906,46.61321],[15.54431,46.6312],[15.55333,46.64988],[15.54533,46.66985],[15.59826,46.68908],[15.62317,46.67947],[15.63255,46.68069],[15.6365,46.6894],[15.6543,46.69228],[15.6543,46.70616],[15.67411,46.70735],[15.69523,46.69823],[15.72279,46.69548],[15.73823,46.70011],[15.76771,46.69863],[15.78518,46.70712],[15.8162,46.71897],[15.87691,46.7211],[15.94864,46.68769],[15.98512,46.68463],[15.99988,46.67947],[16.04036,46.6549],[16.04347,46.68694],[16.02808,46.71094],[15.99769,46.7266],[15.98432,46.74991],[15.99126,46.78199],[15.99054,46.82772],[16.05786,46.83927],[16.10983,46.867],[16.19904,46.94134],[16.22403,46.939],[16.27594,46.9643],[16.28202,47.00159],[16.51369,47.00084],[16.43936,47.03548],[16.52176,47.05747],[16.46134,47.09395],[16.52863,47.13974],[16.44932,47.14418],[16.46442,47.16845],[16.4523,47.18812],[16.42801,47.18422],[16.41739,47.20649],[16.43663,47.21127],[16.44142,47.25079],[16.47782,47.25918],[16.45104,47.41181],[16.49908,47.39416],[16.52414,47.41007],[16.57152,47.40868],[16.6718,47.46139],[16.64821,47.50155],[16.71059,47.52692],[16.64193,47.63114],[16.58699,47.61772],[16.4222,47.66537],[16.55129,47.72268],[16.53514,47.73837],[16.54779,47.75074],[16.61183,47.76171],[16.65679,47.74197],[16.72089,47.73469],[16.7511,47.67878],[16.82938,47.68432],[16.86509,47.72268],[16.87538,47.68895],[17.08893,47.70928],[17.05048,47.79377],[17.07039,47.81129],[17.00997,47.86245],[17.08275,47.87719],[17.11022,47.92461],[17.09786,47.97336],[17.16001,48.00636],[17.07039,48.0317],[17.09168,48.09366],[17.05735,48.14179],[17.02919,48.13996],[16.97701,48.17385],[16.89461,48.31332],[16.90903,48.32519],[16.84243,48.35258],[16.83317,48.38138],[16.83588,48.3844],[16.8497,48.38321],[16.85204,48.44968],[16.94611,48.53614],[16.93955,48.60371],[16.90354,48.71541],[16.79779,48.70998],[16.71883,48.73806],[16.68518,48.7281],[16.67008,48.77699],[16.46134,48.80865],[16.40915,48.74576],[16.37345,48.729],[16.06034,48.75436],[15.84404,48.86921],[15.78087,48.87644],[15.75341,48.8516],[15.6921,48.85973],[15.61622,48.89541],[15.51357,48.91549],[15.48027,48.94481],[15.34823,48.98444]]]]}},{type:"Feature",properties:{iso1A2:"AU",iso1A3:"AUS",iso1N3:"036",wikidata:"Q408",nameEn:"Australia"},geometry:null},{type:"Feature",properties:{iso1A2:"AW",iso1A3:"ABW",iso1N3:"533",wikidata:"Q21203",nameEn:"Aruba",aliases:["NL-AW"],country:"NL",groups:["Q1451600","029","003","419","019","UN"],callingCodes:["297"]},geometry:{type:"MultiPolygon",coordinates:[[[[-70.00823,12.98375],[-70.35625,12.58277],[-69.60231,12.17],[-70.00823,12.98375]]]]}},{type:"Feature",properties:{iso1A2:"AX",iso1A3:"ALA",iso1N3:"248",wikidata:"Q5689",nameEn:"\xC5land Islands",country:"FI",groups:["EU","154","150","UN"],callingCodes:["358 18","358 457"]},geometry:{type:"MultiPolygon",coordinates:[[[[19.08191,60.19152],[20.5104,59.15546],[21.35468,59.67511],[21.02509,60.12142],[21.08159,60.20167],[21.15143,60.54555],[20.96741,60.71528],[19.23413,60.61414],[19.08191,60.19152]]]]}},{type:"Feature",properties:{iso1A2:"AZ",iso1A3:"AZE",iso1N3:"031",wikidata:"Q227",nameEn:"Azerbaijan",groups:["145","142","UN"],callingCodes:["994"]},geometry:{type:"MultiPolygon",coordinates:[[[[46.42738,41.91323],[46.3984,41.84399],[46.30863,41.79133],[46.23962,41.75811],[46.20538,41.77205],[46.17891,41.72094],[46.19759,41.62327],[46.24429,41.59883],[46.26531,41.63339],[46.28182,41.60089],[46.3253,41.60912],[46.34039,41.5947],[46.34126,41.57454],[46.29794,41.5724],[46.33925,41.4963],[46.40307,41.48464],[46.4669,41.43331],[46.63658,41.37727],[46.72375,41.28609],[46.66148,41.20533],[46.63969,41.09515],[46.55096,41.1104],[46.48558,41.0576],[46.456,41.09984],[46.37661,41.10805],[46.27698,41.19011],[46.13221,41.19479],[45.95786,41.17956],[45.80842,41.2229],[45.69946,41.29545],[45.75705,41.35157],[45.71035,41.36208],[45.68389,41.3539],[45.45973,41.45898],[45.4006,41.42402],[45.31352,41.47168],[45.26285,41.46433],[45.1797,41.42231],[45.09867,41.34065],[45.0133,41.29747],[45.05497,41.2464],[45.02932,41.2101],[45.05201,41.19211],[45.11811,41.19967],[45.1969,41.168],[45.19942,41.13299],[45.08028,41.10917],[45.06784,41.05379],[45.12923,41.06059],[45.1313,41.09369],[45.1634,41.08082],[45.16493,41.05068],[45.1994,41.04518],[45.25897,41.0027],[45.26162,41.0228],[45.28859,41.03757],[45.35677,40.99784],[45.39725,41.02603],[45.44083,41.01663],[45.40814,40.97904],[45.60584,40.87436],[45.55914,40.78366],[45.4206,40.7424],[45.35366,40.65979],[45.45484,40.57707],[45.42994,40.53804],[45.65098,40.37696],[45.95609,40.27846],[45.97944,40.181],[45.83779,39.98925],[45.78642,40.03218],[45.59806,40.0131],[45.60895,39.97733],[45.7833,39.9475],[45.82533,39.82925],[45.96543,39.78859],[46.18493,39.60533],[46.40286,39.63651],[46.42465,39.57534],[46.52117,39.58734],[46.57098,39.56694],[46.57721,39.54414],[46.51027,39.52373],[46.53051,39.47809],[46.4013,39.45405],[46.37795,39.42039],[46.43244,39.35181],[46.50093,39.33736],[46.56476,39.24942],[46.63481,39.23013],[46.58032,39.21204],[46.54141,39.15895],[46.52584,39.18912],[46.44022,39.19636],[46.54296,39.07078],[46.51805,38.94982],[46.53497,38.86548],[46.75752,39.03231],[46.83822,39.13143],[46.92539,39.16644],[46.95341,39.13505],[47.05771,39.20143],[47.05927,39.24846],[47.31301,39.37492],[47.38978,39.45999],[47.50099,39.49615],[47.84774,39.66285],[47.98977,39.70999],[48.34264,39.42935],[48.37385,39.37584],[48.15984,39.30028],[48.12404,39.25208],[48.15361,39.19419],[48.31239,39.09278],[48.33884,39.03022],[48.28437,38.97186],[48.08627,38.94434],[48.07734,38.91616],[48.01409,38.90333],[48.02581,38.82705],[48.24773,38.71883],[48.3146,38.59958],[48.45084,38.61013],[48.58793,38.45076],[48.62217,38.40198],[48.70001,38.40564],[48.78979,38.45026],[48.81072,38.44853],[48.84969,38.45015],[48.88288,38.43975],[52.39847,39.43556],[48.80971,41.95365],[48.5867,41.84306],[48.55078,41.77917],[48.42301,41.65444],[48.40277,41.60441],[48.2878,41.56221],[48.22064,41.51472],[48.07587,41.49957],[47.87973,41.21798],[47.75831,41.19455],[47.62288,41.22969],[47.54504,41.20275],[47.49004,41.26366],[47.34579,41.27884],[47.10762,41.59044],[47.03757,41.55434],[46.99554,41.59743],[47.00955,41.63583],[46.8134,41.76252],[46.75269,41.8623],[46.58924,41.80547],[46.5332,41.87389],[46.42738,41.91323]],[[45.50279,40.58424],[45.47927,40.65023],[45.51825,40.67382],[45.56071,40.64765],[45.50279,40.58424]]],[[[45.00864,41.03411],[45.03792,41.03938],[45.04517,41.06653],[45.03406,41.07931],[45.00864,41.09407],[44.97169,41.09176],[44.95383,41.07553],[44.96031,41.06345],[44.9903,41.05657],[45.00864,41.03411]]],[[[45.21324,40.9817],[45.23095,40.97828],[45.23487,41.00226],[45.20625,41.01484],[45.18382,41.0066],[45.19312,40.98998],[45.20518,40.99348],[45.21219,40.99001],[45.21324,40.9817]]],[[[45.46992,39.49888],[45.29606,39.57654],[45.30385,39.61373],[45.23535,39.61373],[45.21784,39.58074],[45.17464,39.58614],[45.18554,39.67846],[45.06604,39.79277],[44.92869,39.72157],[44.88354,39.74432],[44.75779,39.7148],[44.80977,39.65768],[44.81043,39.62677],[44.88916,39.59653],[44.96746,39.42998],[45.05932,39.36435],[45.08751,39.35052],[45.16168,39.21952],[45.30489,39.18333],[45.40148,39.09007],[45.40452,39.07224],[45.44811,39.04927],[45.44966,38.99243],[45.6131,38.964],[45.6155,38.94304],[45.65172,38.95199],[45.83883,38.90768],[45.90266,38.87739],[45.94624,38.89072],[46.00228,38.87376],[46.06766,38.87861],[46.14785,38.84206],[46.06973,39.0744],[46.02303,39.09978],[45.99774,39.28931],[45.79225,39.3695],[45.83,39.46487],[45.80804,39.56716],[45.70547,39.60174],[45.46992,39.49888]]]]}},{type:"Feature",properties:{iso1A2:"BA",iso1A3:"BIH",iso1N3:"070",wikidata:"Q225",nameEn:"Bosnia and Herzegovina",groups:["039","150","UN"],callingCodes:["387"]},geometry:{type:"MultiPolygon",coordinates:[[[[17.84826,45.04489],[17.66571,45.13408],[17.59104,45.10816],[17.51469,45.10791],[17.47589,45.12656],[17.45615,45.12523],[17.4498,45.16119],[17.41229,45.13335],[17.33573,45.14521],[17.32092,45.16246],[17.26815,45.18444],[17.25131,45.14957],[17.24325,45.146],[17.18438,45.14764],[17.0415,45.20759],[16.9385,45.22742],[16.92405,45.27607],[16.83804,45.18951],[16.81137,45.18434],[16.78219,45.19002],[16.74845,45.20393],[16.64962,45.20714],[16.60194,45.23042],[16.56559,45.22307],[16.5501,45.2212],[16.52982,45.22713],[16.49155,45.21153],[16.4634,45.14522],[16.40023,45.1147],[16.38309,45.05955],[16.38219,45.05139],[16.3749,45.05206],[16.35863,45.03529],[16.35404,45.00241],[16.29036,44.99732],[16.12153,45.09616],[15.98412,45.23088],[15.83512,45.22459],[15.76371,45.16508],[15.78842,45.11519],[15.74585,45.0638],[15.78568,44.97401],[15.74723,44.96818],[15.76096,44.87045],[15.79472,44.8455],[15.72584,44.82334],[15.8255,44.71501],[15.89348,44.74964],[16.05828,44.61538],[16.00884,44.58605],[16.03012,44.55572],[16.10566,44.52586],[16.16814,44.40679],[16.12969,44.38275],[16.21346,44.35231],[16.18688,44.27012],[16.36864,44.08263],[16.43662,44.07523],[16.43629,44.02826],[16.50528,44.0244],[16.55472,43.95326],[16.70922,43.84887],[16.75316,43.77157],[16.80736,43.76011],[17.00585,43.58037],[17.15828,43.49376],[17.24411,43.49376],[17.29699,43.44542],[17.25579,43.40353],[17.286,43.33065],[17.46986,43.16559],[17.64268,43.08595],[17.70879,42.97223],[17.5392,42.92787],[17.6444,42.88641],[17.68151,42.92725],[17.7948,42.89556],[17.80854,42.9182],[17.88201,42.83668],[18.24318,42.6112],[18.36197,42.61423],[18.43735,42.55921],[18.49778,42.58409],[18.53751,42.57376],[18.55504,42.58409],[18.52232,42.62279],[18.57373,42.64429],[18.54841,42.68328],[18.54603,42.69171],[18.55221,42.69045],[18.56789,42.72074],[18.47324,42.74992],[18.45921,42.81682],[18.47633,42.85829],[18.4935,42.86433],[18.49661,42.89306],[18.49076,42.95553],[18.52232,43.01451],[18.66254,43.03928],[18.64735,43.14766],[18.66605,43.2056],[18.71747,43.2286],[18.6976,43.25243],[18.76538,43.29838],[18.85342,43.32426],[18.84794,43.33735],[18.83912,43.34795],[18.90911,43.36383],[18.95819,43.32899],[18.95001,43.29327],[19.00844,43.24988],[19.04233,43.30008],[19.08206,43.29668],[19.08673,43.31453],[19.04071,43.397],[19.01078,43.43854],[18.96053,43.45042],[18.95469,43.49367],[18.91379,43.50299],[19.01078,43.55806],[19.04934,43.50384],[19.13933,43.5282],[19.15685,43.53943],[19.22807,43.5264],[19.24774,43.53061],[19.2553,43.5938],[19.33426,43.58833],[19.36653,43.60921],[19.41941,43.54056],[19.42696,43.57987],[19.50455,43.58385],[19.5176,43.71403],[19.3986,43.79668],[19.23465,43.98764],[19.24363,44.01502],[19.38439,43.96611],[19.52515,43.95573],[19.56498,43.99922],[19.61836,44.01464],[19.61991,44.05254],[19.57467,44.04716],[19.55999,44.06894],[19.51167,44.08158],[19.47321,44.1193],[19.48386,44.14332],[19.47338,44.15034],[19.43905,44.13088],[19.40927,44.16722],[19.3588,44.18353],[19.34773,44.23244],[19.32464,44.27185],[19.26945,44.26957],[19.23306,44.26097],[19.20508,44.2917],[19.18328,44.28383],[19.16741,44.28648],[19.13332,44.31492],[19.13556,44.338],[19.11547,44.34218],[19.1083,44.3558],[19.11865,44.36712],[19.10298,44.36924],[19.10365,44.37795],[19.10704,44.38249],[19.10749,44.39421],[19.11785,44.40313],[19.14681,44.41463],[19.14837,44.45253],[19.12278,44.50132],[19.13369,44.52521],[19.16699,44.52197],[19.26388,44.65412],[19.32543,44.74058],[19.36722,44.88164],[19.18183,44.92055],[19.01994,44.85493],[18.8704,44.85097],[18.76347,44.90669],[18.76369,44.93707],[18.80661,44.93561],[18.78357,44.97741],[18.65723,45.07544],[18.47939,45.05871],[18.41896,45.11083],[18.32077,45.1021],[18.24387,45.13699],[18.1624,45.07654],[18.03121,45.12632],[18.01594,45.15163],[17.99479,45.14958],[17.97834,45.13831],[17.97336,45.12245],[17.93706,45.08016],[17.87148,45.04645],[17.84826,45.04489]]]]}},{type:"Feature",properties:{iso1A2:"BB",iso1A3:"BRB",iso1N3:"052",wikidata:"Q244",nameEn:"Barbados",groups:["029","003","419","019","UN"],driveSide:"left",callingCodes:["1 246"]},geometry:{type:"MultiPolygon",coordinates:[[[[-58.56442,13.24471],[-59.80731,13.87556],[-59.82929,12.70644],[-58.56442,13.24471]]]]}},{type:"Feature",properties:{iso1A2:"BD",iso1A3:"BGD",iso1N3:"050",wikidata:"Q902",nameEn:"Bangladesh",groups:["034","142","UN"],driveSide:"left",callingCodes:["880"]},geometry:{type:"MultiPolygon",coordinates:[[[[89.15869,26.13708],[89.08899,26.38845],[88.95612,26.4564],[88.92357,26.40711],[88.91321,26.37984],[89.05328,26.2469],[88.85004,26.23211],[88.78961,26.31093],[88.67837,26.26291],[88.69485,26.38353],[88.62144,26.46783],[88.4298,26.54489],[88.41196,26.63837],[88.33093,26.48929],[88.35153,26.45241],[88.36938,26.48683],[88.48749,26.45855],[88.51649,26.35923],[88.35153,26.29123],[88.34757,26.22216],[88.1844,26.14417],[88.16581,26.0238],[88.08804,25.91334],[88.13138,25.78773],[88.242,25.80811],[88.45103,25.66245],[88.4559,25.59227],[88.677,25.46959],[88.81296,25.51546],[88.85278,25.34679],[89.01105,25.30303],[89.00463,25.26583],[88.94067,25.18534],[88.44766,25.20149],[88.46277,25.07468],[88.33917,24.86803],[88.27325,24.88796],[88.21832,24.96642],[88.14004,24.93529],[88.15515,24.85806],[88.00683,24.66477],[88.08786,24.63232],[88.12296,24.51301],[88.50934,24.32474],[88.68801,24.31464],[88.74841,24.1959],[88.6976,24.14703],[88.73743,23.91751],[88.66189,23.87607],[88.58087,23.87105],[88.56507,23.64044],[88.74841,23.47361],[88.79351,23.50535],[88.79254,23.46028],[88.71133,23.2492],[88.99148,23.21134],[88.86377,23.08759],[88.88327,23.03885],[88.87063,22.95235],[88.96713,22.83346],[88.9151,22.75228],[88.94614,22.66941],[88.9367,22.58527],[89.07114,22.15335],[89.08044,21.41871],[92.47409,20.38654],[92.26071,21.05697],[92.17752,21.17445],[92.20087,21.337],[92.37939,21.47764],[92.43158,21.37025],[92.55105,21.3856],[92.60187,21.24615],[92.68152,21.28454],[92.59775,21.6092],[92.62187,21.87037],[92.60949,21.97638],[92.56616,22.13554],[92.60029,22.1522],[92.5181,22.71441],[92.37665,22.9435],[92.38214,23.28705],[92.26541,23.70392],[92.15417,23.73409],[92.04706,23.64229],[91.95093,23.73284],[91.95642,23.47361],[91.84789,23.42235],[91.76417,23.26619],[91.81634,23.08001],[91.7324,23.00043],[91.61571,22.93929],[91.54993,23.01051],[91.46615,23.2328],[91.4035,23.27522],[91.40848,23.07117],[91.36453,23.06612],[91.28293,23.37538],[91.15579,23.6599],[91.25192,23.83463],[91.22308,23.89616],[91.29587,24.0041],[91.35741,23.99072],[91.37414,24.10693],[91.55542,24.08687],[91.63782,24.1132],[91.65292,24.22095],[91.73257,24.14703],[91.76004,24.23848],[91.82596,24.22345],[91.89258,24.14674],[91.96603,24.3799],[92.11662,24.38997],[92.15796,24.54435],[92.25854,24.9191],[92.38626,24.86055],[92.49887,24.88796],[92.39147,25.01471],[92.33957,25.07593],[92.0316,25.1834],[91.63648,25.12846],[91.25517,25.20677],[90.87427,25.15799],[90.65042,25.17788],[90.40034,25.1534],[90.1155,25.22686],[89.90478,25.31038],[89.87629,25.28337],[89.83371,25.29548],[89.84086,25.31854],[89.81208,25.37244],[89.86129,25.61714],[89.84388,25.70042],[89.80585,25.82489],[89.86592,25.93115],[89.77728,26.04254],[89.77865,26.08387],[89.73581,26.15818],[89.70201,26.15138],[89.63968,26.22595],[89.57101,25.9682],[89.53515,26.00382],[89.35953,26.0077],[89.15869,26.13708]]]]}},{type:"Feature",properties:{iso1A2:"BE",iso1A3:"BEL",iso1N3:"056",wikidata:"Q31",nameEn:"Belgium",groups:["EU","155","150","UN"],callingCodes:["32"]},geometry:{type:"MultiPolygon",coordinates:[[[[4.93295,51.44945],[4.93909,51.44632],[4.9524,51.45014],[4.95244,51.45207],[4.93295,51.44945]]],[[[4.91493,51.4353],[4.92652,51.43329],[4.92952,51.42984],[4.93986,51.43064],[4.94265,51.44003],[4.93471,51.43861],[4.93416,51.44185],[4.94025,51.44193],[4.93544,51.44634],[4.92879,51.44161],[4.92815,51.43856],[4.92566,51.44273],[4.92811,51.4437],[4.92287,51.44741],[4.91811,51.44621],[4.92227,51.44252],[4.91935,51.43634],[4.91493,51.4353]]],[[[4.82946,51.4213],[4.82409,51.44736],[4.84139,51.4799],[4.78803,51.50284],[4.77321,51.50529],[4.74578,51.48937],[4.72935,51.48424],[4.65442,51.42352],[4.57489,51.4324],[4.53521,51.4243],[4.52846,51.45002],[4.54675,51.47265],[4.5388,51.48184],[4.47736,51.4778],[4.38122,51.44905],[4.39747,51.43316],[4.38064,51.41965],[4.43777,51.36989],[4.39292,51.35547],[4.34086,51.35738],[4.33265,51.37687],[4.21923,51.37443],[4.24024,51.35371],[4.16721,51.29348],[4.05165,51.24171],[4.01957,51.24504],[3.97889,51.22537],[3.90125,51.20371],[3.78783,51.2151],[3.78999,51.25766],[3.58939,51.30064],[3.51502,51.28697],[3.52698,51.2458],[3.43488,51.24135],[3.41704,51.25933],[3.38289,51.27331],[3.35847,51.31572],[3.38696,51.33436],[3.36263,51.37112],[2.56575,51.85301],[2.18458,51.52087],[2.55904,51.07014],[2.57551,51.00326],[2.63074,50.94746],[2.59093,50.91751],[2.63331,50.81457],[2.71165,50.81295],[2.81056,50.71773],[2.8483,50.72276],[2.86985,50.7033],[2.87937,50.70298],[2.88504,50.70656],[2.90069,50.69263],[2.91036,50.6939],[2.90873,50.702],[2.95019,50.75138],[2.96778,50.75242],[3.00537,50.76588],[3.04314,50.77674],[3.09163,50.77717],[3.10614,50.78303],[3.11206,50.79416],[3.11987,50.79188],[3.1257,50.78603],[3.15017,50.79031],[3.16476,50.76843],[3.18339,50.74981],[3.18811,50.74025],[3.20064,50.73547],[3.19017,50.72569],[3.20845,50.71662],[3.22042,50.71019],[3.24593,50.71389],[3.26063,50.70086],[3.26141,50.69151],[3.2536,50.68977],[3.264,50.67668],[3.23951,50.6585],[3.2729,50.60718],[3.28575,50.52724],[3.37693,50.49538],[3.44629,50.51009],[3.47385,50.53397],[3.51564,50.5256],[3.49509,50.48885],[3.5683,50.50192],[3.58361,50.49049],[3.61014,50.49568],[3.64426,50.46275],[3.66153,50.45165],[3.67494,50.40239],[3.67262,50.38663],[3.65709,50.36873],[3.66976,50.34563],[3.71009,50.30305],[3.70987,50.3191],[3.73911,50.34809],[3.84314,50.35219],[3.90781,50.32814],[3.96771,50.34989],[4.0268,50.35793],[4.0689,50.3254],[4.10237,50.31247],[4.10957,50.30234],[4.11954,50.30425],[4.13665,50.25609],[4.16808,50.25786],[4.15524,50.2833],[4.17347,50.28838],[4.17861,50.27443],[4.20651,50.27333],[4.21945,50.25539],[4.15524,50.21103],[4.16014,50.19239],[4.13561,50.13078],[4.20147,50.13535],[4.23101,50.06945],[4.16294,50.04719],[4.13508,50.01976],[4.14239,49.98034],[4.20532,49.95803],[4.31963,49.97043],[4.35051,49.95315],[4.43488,49.94122],[4.51098,49.94659],[4.5414,49.96911],[4.68695,49.99685],[4.70064,50.09384],[4.75237,50.11314],[4.82438,50.16878],[4.83279,50.15331],[4.88602,50.15182],[4.8382,50.06738],[4.78827,49.95609],[4.88529,49.9236],[4.85134,49.86457],[4.86965,49.82271],[4.85464,49.78995],[4.96714,49.79872],[5.09249,49.76193],[5.14545,49.70287],[5.26232,49.69456],[5.31465,49.66846],[5.33039,49.6555],[5.30214,49.63055],[5.3137,49.61225],[5.33851,49.61599],[5.34837,49.62889],[5.3974,49.61596],[5.43713,49.5707],[5.46734,49.52648],[5.46541,49.49825],[5.55001,49.52729],[5.60909,49.51228],[5.64505,49.55146],[5.75649,49.54321],[5.7577,49.55915],[5.77435,49.56298],[5.79195,49.55228],[5.81838,49.54777],[5.84143,49.5533],[5.84692,49.55663],[5.8424,49.56082],[5.87256,49.57539],[5.86986,49.58756],[5.84971,49.58674],[5.84826,49.5969],[5.8762,49.60898],[5.87609,49.62047],[5.88393,49.62802],[5.88552,49.63507],[5.90599,49.63853],[5.90164,49.6511],[5.9069,49.66377],[5.86175,49.67862],[5.86527,49.69291],[5.88677,49.70951],[5.86503,49.72739],[5.84193,49.72161],[5.82562,49.72395],[5.83149,49.74729],[5.82245,49.75048],[5.78871,49.7962],[5.75409,49.79239],[5.74953,49.81428],[5.74364,49.82058],[5.74844,49.82435],[5.7404,49.83452],[5.74076,49.83823],[5.74975,49.83933],[5.74953,49.84709],[5.75884,49.84811],[5.74567,49.85368],[5.75861,49.85631],[5.75269,49.8711],[5.78415,49.87922],[5.73621,49.89796],[5.77314,49.93646],[5.77291,49.96056],[5.80833,49.96451],[5.81163,49.97142],[5.83467,49.97823],[5.83968,49.9892],[5.82331,49.99662],[5.81866,50.01286],[5.8551,50.02683],[5.86904,50.04614],[5.85474,50.06342],[5.8857,50.07824],[5.89488,50.11476],[5.95929,50.13295],[5.96453,50.17259],[6.02488,50.18283],[6.03093,50.16362],[6.06406,50.15344],[6.08577,50.17246],[6.12028,50.16374],[6.1137,50.13668],[6.1379,50.12964],[6.15298,50.14126],[6.14132,50.14971],[6.14588,50.17106],[6.18739,50.1822],[6.18364,50.20815],[6.16853,50.2234],[6.208,50.25179],[6.28797,50.27458],[6.29949,50.30887],[6.32488,50.32333],[6.35701,50.31139],[6.40641,50.32425],[6.40785,50.33557],[6.3688,50.35898],[6.34406,50.37994],[6.36852,50.40776],[6.37219,50.45397],[6.34005,50.46083],[6.3465,50.48833],[6.30809,50.50058],[6.26637,50.50272],[6.22335,50.49578],[6.20599,50.52089],[6.19193,50.5212],[6.18716,50.52653],[6.19579,50.5313],[6.19735,50.53576],[6.17802,50.54179],[6.17739,50.55875],[6.20281,50.56952],[6.22581,50.5907],[6.24005,50.58732],[6.24888,50.59869],[6.2476,50.60392],[6.26957,50.62444],[6.17852,50.6245],[6.11707,50.72231],[6.04428,50.72861],[6.0406,50.71848],[6.0326,50.72647],[6.03889,50.74618],[6.01976,50.75398],[5.97545,50.75441],[5.95942,50.7622],[5.89132,50.75124],[5.89129,50.75125],[5.88734,50.77092],[5.84888,50.75448],[5.84548,50.76542],[5.80673,50.7558],[5.77513,50.78308],[5.76533,50.78159],[5.74356,50.7691],[5.73904,50.75674],[5.72216,50.76398],[5.69469,50.75529],[5.68091,50.75804],[5.70107,50.7827],[5.68995,50.79641],[5.70118,50.80764],[5.65259,50.82309],[5.64009,50.84742],[5.64504,50.87107],[5.67886,50.88142],[5.69858,50.91046],[5.71626,50.90796],[5.72644,50.91167],[5.72545,50.92312],[5.74644,50.94723],[5.75927,50.95601],[5.74752,50.96202],[5.72875,50.95428],[5.71864,50.96092],[5.76242,50.99703],[5.77688,51.02483],[5.75961,51.03113],[5.77258,51.06196],[5.79835,51.05834],[5.79903,51.09371],[5.82921,51.09328],[5.83226,51.10585],[5.8109,51.10861],[5.80798,51.11661],[5.85508,51.14445],[5.82564,51.16753],[5.77697,51.1522],[5.77735,51.17845],[5.74617,51.18928],[5.70344,51.1829],[5.65528,51.18736],[5.65145,51.19788],[5.5603,51.22249],[5.5569,51.26544],[5.515,51.29462],[5.48476,51.30053],[5.46519,51.2849],[5.4407,51.28169],[5.41672,51.26248],[5.347,51.27502],[5.33886,51.26314],[5.29716,51.26104],[5.26461,51.26693],[5.23814,51.26064],[5.22542,51.26888],[5.24244,51.30495],[5.2002,51.32243],[5.16222,51.31035],[5.13377,51.31592],[5.13105,51.34791],[5.07102,51.39469],[5.10456,51.43163],[5.07891,51.4715],[5.04774,51.47022],[5.03281,51.48679],[5.0106,51.47167],[5.00393,51.44406],[4.92152,51.39487],[4.90016,51.41404],[4.84988,51.41502],[4.78941,51.41102],[4.77229,51.41337],[4.76577,51.43046],[4.78314,51.43319],[4.82946,51.4213]]]]}},{type:"Feature",properties:{iso1A2:"BF",iso1A3:"BFA",iso1N3:"854",wikidata:"Q965",nameEn:"Burkina Faso",groups:["011","202","002","UN"],callingCodes:["226"]},geometry:{type:"MultiPolygon",coordinates:[[[[.23859,15.00135],[.06588,14.96961],[-.24673,15.07805],[-.72004,15.08655],[-1.05875,14.7921],[-1.32166,14.72774],[-1.68083,14.50023],[-1.97945,14.47709],[-1.9992,14.19011],[-2.10223,14.14878],[-2.47587,14.29671],[-2.66175,14.14713],[-2.84667,14.05532],[-2.90831,13.81174],[-2.88189,13.64921],[-3.26407,13.70699],[-3.28396,13.5422],[-3.23599,13.29035],[-3.43507,13.27272],[-3.4313,13.1588],[-3.54454,13.1781],[-3.7911,13.36665],[-3.96282,13.38164],[-3.90558,13.44375],[-3.96501,13.49778],[-4.34477,13.12927],[-4.21819,12.95722],[-4.238,12.71467],[-4.47356,12.71252],[-4.41412,12.31922],[-4.57703,12.19875],[-4.54841,12.1385],[-4.62546,12.13204],[-4.62987,12.06531],[-4.70692,12.06746],[-4.72893,12.01579],[-5.07897,11.97918],[-5.26389,11.84778],[-5.40258,11.8327],[-5.26389,11.75728],[-5.29251,11.61715],[-5.22867,11.60421],[-5.20665,11.43811],[-5.25509,11.36905],[-5.25949,11.24816],[-5.32553,11.21578],[-5.32994,11.13371],[-5.49284,11.07538],[-5.41579,10.84628],[-5.47083,10.75329],[-5.46643,10.56074],[-5.51058,10.43177],[-5.39602,10.2929],[-5.12465,10.29788],[-4.96453,9.99923],[-4.96621,9.89132],[-4.6426,9.70696],[-4.31392,9.60062],[-4.25999,9.76012],[-3.69703,9.94279],[-3.31779,9.91125],[-3.27228,9.84981],[-3.19306,9.93781],[-3.16609,9.85147],[-3.00765,9.74019],[-2.93012,9.57403],[-2.76494,9.40778],[-2.68802,9.49343],[-2.76534,9.56589],[-2.74174,9.83172],[-2.83108,10.40252],[-2.94232,10.64281],[-2.83373,11.0067],[-.67143,10.99811],[-.61937,10.91305],[-.44298,11.04292],[-.42391,11.11661],[-.38219,11.12596],[-.35955,11.07801],[-.28566,11.12713],[-.27374,11.17157],[-.13493,11.14075],[.50388,11.01011],[.48852,10.98561],[.50521,10.98035],[.4958,10.93269],[.66104,10.99964],[.91245,10.99597],[.9813,11.08876],[1.03409,11.04719],[1.42823,11.46822],[2.00988,11.42227],[2.29983,11.68254],[2.39723,11.89473],[2.05785,12.35539],[2.26349,12.41915],[.99167,13.10727],[.99253,13.37515],[1.18873,13.31771],[1.21217,13.37853],[1.24516,13.33968],[1.28509,13.35488],[1.24429,13.39373],[1.20088,13.38951],[1.02813,13.46635],[.99514,13.5668],[.77637,13.64442],[.77377,13.6866],[.61924,13.68491],[.38051,14.05575],[.16936,14.51654],[.23859,15.00135]]]]}},{type:"Feature",properties:{iso1A2:"BG",iso1A3:"BGR",iso1N3:"100",wikidata:"Q219",nameEn:"Bulgaria",groups:["EU","151","150","UN"],callingCodes:["359"]},geometry:{type:"MultiPolygon",coordinates:[[[[23.05288,43.79494],[22.85314,43.84452],[22.83753,43.88055],[22.87873,43.9844],[23.01674,44.01946],[23.04988,44.07694],[22.67173,44.21564],[22.61711,44.16938],[22.61688,44.06534],[22.41449,44.00514],[22.35558,43.81281],[22.41043,43.69566],[22.47582,43.6558],[22.53397,43.47225],[22.82036,43.33665],[22.89727,43.22417],[23.00806,43.19279],[22.98104,43.11199],[22.89521,43.03625],[22.78397,42.98253],[22.74826,42.88701],[22.54302,42.87774],[22.43309,42.82057],[22.4997,42.74144],[22.43983,42.56851],[22.55669,42.50144],[22.51961,42.3991],[22.47498,42.3915],[22.45919,42.33822],[22.34773,42.31725],[22.38136,42.30339],[22.47251,42.20393],[22.50289,42.19527],[22.51224,42.15457],[22.67701,42.06614],[22.86749,42.02275],[22.90254,41.87587],[22.96682,41.77137],[23.01239,41.76527],[23.03342,41.71034],[22.95513,41.63265],[22.96331,41.35782],[22.93334,41.34104],[23.1833,41.31755],[23.21953,41.33773],[23.22771,41.37106],[23.31301,41.40525],[23.33639,41.36317],[23.40416,41.39999],[23.52453,41.40262],[23.63203,41.37632],[23.67644,41.41139],[23.76525,41.40175],[23.80148,41.43943],[23.89613,41.45257],[23.91483,41.47971],[23.96975,41.44118],[24.06908,41.46132],[24.06323,41.53222],[24.10063,41.54796],[24.18126,41.51735],[24.27124,41.57682],[24.30513,41.51297],[24.52599,41.56808],[24.61129,41.42278],[24.71529,41.41928],[24.8041,41.34913],[24.82514,41.4035],[24.86136,41.39298],[24.90928,41.40876],[24.942,41.38685],[25.11611,41.34212],[25.28322,41.23411],[25.48187,41.28506],[25.52394,41.2798],[25.55082,41.31667],[25.61042,41.30614],[25.66183,41.31316],[25.70507,41.29209],[25.8266,41.34563],[25.87919,41.30526],[26.12926,41.35878],[26.16548,41.42278],[26.20288,41.43943],[26.14796,41.47533],[26.176,41.50072],[26.17951,41.55409],[26.14328,41.55496],[26.15146,41.60828],[26.07083,41.64584],[26.06148,41.70345],[26.16841,41.74858],[26.21325,41.73223],[26.22888,41.74139],[26.2654,41.71544],[26.30255,41.70925],[26.35957,41.71149],[26.32952,41.73637],[26.33589,41.76802],[26.36952,41.82265],[26.53968,41.82653],[26.57961,41.90024],[26.56051,41.92995],[26.62996,41.97644],[26.79143,41.97386],[26.95638,42.00741],[27.03277,42.0809],[27.08486,42.08735],[27.19251,42.06028],[27.22376,42.10152],[27.27411,42.10409],[27.45478,41.96591],[27.52379,41.93756],[27.55191,41.90928],[27.69949,41.97515],[27.81235,41.94803],[27.83492,41.99709],[27.91479,41.97902],[28.02971,41.98066],[28.32297,41.98371],[29.24336,43.70874],[28.23293,43.76],[27.99558,43.84193],[27.92008,44.00761],[27.73468,43.95326],[27.64542,44.04958],[27.60834,44.01206],[27.39757,44.0141],[27.26845,44.12602],[26.95141,44.13555],[26.62712,44.05698],[26.38764,44.04356],[26.10115,43.96908],[26.05584,43.90925],[25.94911,43.85745],[25.72792,43.69263],[25.39528,43.61866],[25.17144,43.70261],[25.10718,43.6831],[24.96682,43.72693],[24.73542,43.68523],[24.62281,43.74082],[24.50264,43.76314],[24.35364,43.70211],[24.18149,43.68218],[23.73978,43.80627],[23.61687,43.79289],[23.4507,43.84936],[23.26772,43.84843],[23.05288,43.79494]]]]}},{type:"Feature",properties:{iso1A2:"BH",iso1A3:"BHR",iso1N3:"048",wikidata:"Q398",nameEn:"Bahrain",groups:["145","142","UN"],callingCodes:["973"]},geometry:{type:"MultiPolygon",coordinates:[[[[50.93865,26.30758],[50.71771,26.73086],[50.38162,26.53976],[50.26923,26.08243],[50.302,25.87592],[50.57069,25.57887],[50.80824,25.54641],[50.7801,25.595],[50.86149,25.6965],[50.81266,25.88946],[50.93865,26.30758]]]]}},{type:"Feature",properties:{iso1A2:"BI",iso1A3:"BDI",iso1N3:"108",wikidata:"Q967",nameEn:"Burundi",groups:["014","202","002","UN"],callingCodes:["257"]},geometry:{type:"MultiPolygon",coordinates:[[[[30.54501,-2.41404],[30.42933,-2.31064],[30.14034,-2.43626],[29.95911,-2.33348],[29.88237,-2.75105],[29.36805,-2.82933],[29.32234,-2.6483],[29.0562,-2.58632],[29.04081,-2.7416],[29.00167,-2.78523],[29.00404,-2.81978],[29.0505,-2.81774],[29.09119,-2.87871],[29.09797,-2.91935],[29.16037,-2.95457],[29.17258,-2.99385],[29.25633,-3.05471],[29.21463,-3.3514],[29.23708,-3.75856],[29.43673,-4.44845],[29.63827,-4.44681],[29.75109,-4.45836],[29.77289,-4.41733],[29.82885,-4.36153],[29.88172,-4.35743],[30.03323,-4.26631],[30.22042,-4.01738],[30.45915,-3.56532],[30.84165,-3.25152],[30.83823,-2.97837],[30.6675,-2.98987],[30.57926,-2.89791],[30.4987,-2.9573],[30.40662,-2.86151],[30.52747,-2.65841],[30.41789,-2.66266],[30.54501,-2.41404]]]]}},{type:"Feature",properties:{iso1A2:"BJ",iso1A3:"BEN",iso1N3:"204",wikidata:"Q962",nameEn:"Benin",aliases:["DY"],groups:["011","202","002","UN"],callingCodes:["229"]},geometry:{type:"MultiPolygon",coordinates:[[[[3.59375,11.70269],[3.48187,11.86092],[3.31613,11.88495],[3.25352,12.01467],[2.83978,12.40585],[2.6593,12.30631],[2.37783,12.24804],[2.39657,12.10952],[2.45824,11.98672],[2.39723,11.89473],[2.29983,11.68254],[2.00988,11.42227],[1.42823,11.46822],[1.03409,11.04719],[.9813,11.08876],[.91245,10.99597],[.8804,10.803],[.80358,10.71459],[.77666,10.37665],[1.35507,9.99525],[1.36624,9.5951],[1.33675,9.54765],[1.41746,9.3226],[1.5649,9.16941],[1.61838,9.0527],[1.64249,6.99562],[1.55877,6.99737],[1.61812,6.74843],[1.58105,6.68619],[1.76906,6.43189],[1.79826,6.28221],[1.62913,6.24075],[1.67336,6.02702],[2.74181,6.13349],[2.70566,6.38038],[2.70464,6.50831],[2.74334,6.57291],[2.7325,6.64057],[2.78204,6.70514],[2.78823,6.76356],[2.73405,6.78508],[2.74024,6.92802],[2.71702,6.95722],[2.76965,7.13543],[2.74489,7.42565],[2.79442,7.43486],[2.78668,7.5116],[2.73405,7.5423],[2.73095,7.7755],[2.67523,7.87825],[2.77907,9.06924],[3.08017,9.10006],[3.14147,9.28375],[3.13928,9.47167],[3.25093,9.61632],[3.34726,9.70696],[3.32099,9.78032],[3.35383,9.83641],[3.54429,9.87739],[3.66908,10.18136],[3.57275,10.27185],[3.6844,10.46351],[3.78292,10.40538],[3.84243,10.59316],[3.71505,11.13015],[3.49175,11.29765],[3.59375,11.70269]]]]}},{type:"Feature",properties:{iso1A2:"BL",iso1A3:"BLM",iso1N3:"652",wikidata:"Q25362",nameEn:"Saint-Barth\xE9lemy",country:"FR",groups:["EU","Q1451600","029","003","419","019","UN"],callingCodes:["590"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.62718,18.26185],[-63.1055,17.86651],[-62.34423,17.49165],[-62.62718,18.26185]]]]}},{type:"Feature",properties:{iso1A2:"BM",iso1A3:"BMU",iso1N3:"060",wikidata:"Q23635",nameEn:"Bermuda",country:"GB",groups:["BOTS","021","003","019","UN"],driveSide:"left",callingCodes:["1 441"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.20987,32.6953],[-65.31453,32.68437],[-65.63955,31.43417],[-63.20987,32.6953]]]]}},{type:"Feature",properties:{iso1A2:"BN",iso1A3:"BRN",iso1N3:"096",wikidata:"Q921",nameEn:"Brunei",groups:["Q36117","035","142","UN"],driveSide:"left",callingCodes:["673"]},geometry:{type:"MultiPolygon",coordinates:[[[[115.16236,5.01011],[115.02521,5.35005],[114.10166,4.76112],[114.07448,4.58441],[114.15813,4.57],[114.26876,4.49878],[114.32176,4.34942],[114.32176,4.2552],[114.4416,4.27588],[114.49922,4.13108],[114.64211,4.00694],[114.78539,4.12205],[114.88039,4.4257],[114.83189,4.42387],[114.77303,4.72871],[114.8266,4.75062],[114.88841,4.81905],[114.96982,4.81146],[114.99417,4.88201],[115.05038,4.90275],[115.02955,4.82087],[115.02278,4.74137],[115.04064,4.63706],[115.07737,4.53418],[115.09978,4.39123],[115.31275,4.30806],[115.36346,4.33563],[115.2851,4.42295],[115.27819,4.63661],[115.20737,4.8256],[115.15092,4.87604],[115.16236,5.01011]]]]}},{type:"Feature",properties:{iso1A2:"BO",iso1A3:"BOL",iso1N3:"068",wikidata:"Q750",nameEn:"Bolivia",groups:["005","419","019","UN"],callingCodes:["591"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.90248,-12.52544],[-64.22539,-12.45267],[-64.30708,-12.46398],[-64.99778,-11.98604],[-65.30027,-11.48749],[-65.28141,-10.86289],[-65.35402,-10.78685],[-65.37923,-10.35141],[-65.29019,-9.86253],[-65.40615,-9.63894],[-65.56244,-9.84266],[-65.68343,-9.75323],[-67.17784,-10.34016],[-68.71533,-11.14749],[-68.7651,-11.0496],[-68.75179,-11.03688],[-68.75265,-11.02383],[-68.74802,-11.00891],[-69.42792,-10.93451],[-69.47839,-10.95254],[-69.57156,-10.94555],[-68.98115,-11.8979],[-68.65044,-12.50689],[-68.85615,-12.87769],[-68.8864,-13.40792],[-69.05265,-13.68546],[-68.88135,-14.18639],[-69.36254,-14.94634],[-69.14856,-15.23478],[-69.40336,-15.61358],[-69.20291,-16.16668],[-69.09986,-16.22693],[-68.96238,-16.194],[-68.79464,-16.33272],[-68.98358,-16.42165],[-69.04027,-16.57214],[-69.00853,-16.66769],[-69.16896,-16.72233],[-69.62883,-17.28142],[-69.46863,-17.37466],[-69.46897,-17.4988],[-69.46623,-17.60518],[-69.34126,-17.72753],[-69.28671,-17.94844],[-69.07496,-18.03715],[-69.14807,-18.16893],[-69.07432,-18.28259],[-68.94987,-18.93302],[-68.87082,-19.06003],[-68.80602,-19.08355],[-68.61989,-19.27584],[-68.41218,-19.40499],[-68.66761,-19.72118],[-68.54611,-19.84651],[-68.57132,-20.03134],[-68.74273,-20.08817],[-68.7276,-20.46178],[-68.44023,-20.62701],[-68.55383,-20.7355],[-68.53957,-20.91542],[-68.40403,-20.94562],[-68.18816,-21.28614],[-67.85114,-22.87076],[-67.54284,-22.89771],[-67.18382,-22.81525],[-66.7298,-22.23644],[-66.29714,-22.08741],[-66.24077,-21.77837],[-66.03836,-21.84829],[-66.04832,-21.9187],[-65.9261,-21.93335],[-65.7467,-22.10105],[-65.61166,-22.09504],[-65.58694,-22.09794],[-65.57743,-22.07675],[-65.47435,-22.08908],[-64.99524,-22.08255],[-64.90014,-22.12136],[-64.67174,-22.18957],[-64.58888,-22.25035],[-64.4176,-22.67692],[-64.35108,-22.73282],[-64.31489,-22.88824],[-64.22918,-22.55807],[-63.93287,-21.99934],[-63.70963,-21.99934],[-63.68113,-22.0544],[-63.66482,-21.99918],[-62.81124,-21.9987],[-62.8078,-22.12534],[-62.64455,-22.25091],[-62.2757,-21.06657],[-62.26883,-20.55311],[-61.93912,-20.10053],[-61.73723,-19.63958],[-60.00638,-19.2981],[-59.06965,-19.29148],[-58.23216,-19.80058],[-58.16225,-20.16193],[-57.8496,-19.98346],[-58.14215,-19.76276],[-57.78463,-19.03259],[-57.71113,-19.03161],[-57.69134,-19.00544],[-57.71995,-18.97546],[-57.71995,-18.89573],[-57.76764,-18.90087],[-57.56807,-18.25655],[-57.48237,-18.24219],[-57.69877,-17.8431],[-57.73949,-17.56095],[-57.90082,-17.44555],[-57.99661,-17.5273],[-58.32935,-17.28195],[-58.5058,-16.80958],[-58.30918,-16.3699],[-58.32431,-16.25861],[-58.41506,-16.32636],[-60.16069,-16.26479],[-60.23797,-15.50267],[-60.58224,-15.09887],[-60.23968,-15.09515],[-60.27887,-14.63021],[-60.46037,-14.22496],[-60.48053,-13.77981],[-61.05527,-13.50054],[-61.81151,-13.49564],[-63.76259,-12.42952],[-63.90248,-12.52544]]]]}},{type:"Feature",properties:{iso1A2:"BQ",iso1A3:"BES",iso1N3:"535",wikidata:"Q27561",nameEn:"Caribbean Netherlands",country:"NL"},geometry:null},{type:"Feature",properties:{iso1A2:"BR",iso1A3:"BRA",iso1N3:"076",wikidata:"Q155",nameEn:"Brazil",groups:["005","419","019","UN"],callingCodes:["55"]},geometry:{type:"MultiPolygon",coordinates:[[[[-59.69361,4.34069],[-59.78878,4.45637],[-60.15953,4.53456],[-60.04189,4.69801],[-59.98129,5.07097],[-60.20944,5.28754],[-60.32352,5.21299],[-60.73204,5.20931],[-60.5802,4.94312],[-60.86539,4.70512],[-60.98303,4.54167],[-61.15703,4.49839],[-61.31457,4.54167],[-61.29675,4.44216],[-61.48569,4.43149],[-61.54629,4.2822],[-62.13094,4.08309],[-62.44822,4.18621],[-62.57656,4.04754],[-62.74411,4.03331],[-62.7655,3.73099],[-62.98296,3.59935],[-63.21111,3.96219],[-63.4464,3.9693],[-63.42233,3.89995],[-63.50611,3.83592],[-63.67099,4.01731],[-63.70218,3.91417],[-63.86082,3.94796],[-63.99183,3.90172],[-64.14512,4.12932],[-64.57648,4.12576],[-64.72977,4.28931],[-64.84028,4.24665],[-64.48379,3.7879],[-64.02908,2.79797],[-64.0257,2.48156],[-63.39114,2.4317],[-63.39827,2.16098],[-64.06135,1.94722],[-64.08274,1.64792],[-64.34654,1.35569],[-64.38932,1.5125],[-65.11657,1.12046],[-65.57288,.62856],[-65.50158,.92086],[-65.6727,1.01353],[-66.28507,.74585],[-66.85795,1.22998],[-67.08222,1.17441],[-67.15784,1.80439],[-67.299,1.87494],[-67.40488,2.22258],[-67.9292,1.82455],[-68.18632,2.00091],[-68.26699,1.83463],[-68.18128,1.72881],[-69.38621,1.70865],[-69.53746,1.76408],[-69.83491,1.69353],[-69.82987,1.07864],[-69.26017,1.06856],[-69.14422,.84172],[-69.20976,.57958],[-69.47696,.71065],[-70.04162,.55437],[-70.03658,-.19681],[-69.603,-.51947],[-69.59796,-.75136],[-69.4215,-1.01853],[-69.43395,-1.42219],[-69.94708,-4.2431],[-70.00888,-4.37833],[-70.11305,-4.27281],[-70.19582,-4.3607],[-70.33236,-4.15214],[-70.77601,-4.15717],[-70.96814,-4.36915],[-71.87003,-4.51661],[-72.64391,-5.0391],[-72.83973,-5.14765],[-73.24579,-6.05764],[-73.12983,-6.43852],[-73.73986,-6.87919],[-73.77011,-7.28944],[-73.96938,-7.58465],[-73.65485,-7.77897],[-73.76576,-7.89884],[-72.92886,-9.04074],[-73.21498,-9.40904],[-72.72216,-9.41397],[-72.31883,-9.5184],[-72.14742,-9.98049],[-71.23394,-9.9668],[-70.53373,-9.42628],[-70.58453,-9.58303],[-70.55429,-9.76692],[-70.62487,-9.80666],[-70.64134,-11.0108],[-70.51395,-10.92249],[-70.38791,-11.07096],[-69.90896,-10.92744],[-69.57835,-10.94051],[-69.57156,-10.94555],[-69.47839,-10.95254],[-69.42792,-10.93451],[-68.74802,-11.00891],[-68.75265,-11.02383],[-68.75179,-11.03688],[-68.7651,-11.0496],[-68.71533,-11.14749],[-67.17784,-10.34016],[-65.68343,-9.75323],[-65.56244,-9.84266],[-65.40615,-9.63894],[-65.29019,-9.86253],[-65.37923,-10.35141],[-65.35402,-10.78685],[-65.28141,-10.86289],[-65.30027,-11.48749],[-64.99778,-11.98604],[-64.30708,-12.46398],[-64.22539,-12.45267],[-63.90248,-12.52544],[-63.76259,-12.42952],[-61.81151,-13.49564],[-61.05527,-13.50054],[-60.48053,-13.77981],[-60.46037,-14.22496],[-60.27887,-14.63021],[-60.23968,-15.09515],[-60.58224,-15.09887],[-60.23797,-15.50267],[-60.16069,-16.26479],[-58.41506,-16.32636],[-58.32431,-16.25861],[-58.30918,-16.3699],[-58.5058,-16.80958],[-58.32935,-17.28195],[-57.99661,-17.5273],[-57.90082,-17.44555],[-57.73949,-17.56095],[-57.69877,-17.8431],[-57.48237,-18.24219],[-57.56807,-18.25655],[-57.76764,-18.90087],[-57.71995,-18.89573],[-57.71995,-18.97546],[-57.69134,-19.00544],[-57.71113,-19.03161],[-57.78463,-19.03259],[-58.14215,-19.76276],[-57.8496,-19.98346],[-58.16225,-20.16193],[-57.84536,-20.93155],[-57.93492,-21.65505],[-57.88239,-21.6868],[-57.94642,-21.73799],[-57.98625,-22.09157],[-56.6508,-22.28387],[-56.5212,-22.11556],[-56.45893,-22.08072],[-56.23206,-22.25347],[-55.8331,-22.29008],[-55.74941,-22.46436],[-55.741,-22.52018],[-55.72366,-22.5519],[-55.6986,-22.56268],[-55.68742,-22.58407],[-55.62493,-22.62765],[-55.63849,-22.95122],[-55.5446,-23.22811],[-55.52288,-23.2595],[-55.5555,-23.28237],[-55.43585,-23.87157],[-55.44117,-23.9185],[-55.41784,-23.9657],[-55.12292,-23.99669],[-55.0518,-23.98666],[-55.02691,-23.97317],[-54.6238,-23.83078],[-54.32807,-24.01865],[-54.28207,-24.07305],[-54.4423,-25.13381],[-54.62033,-25.46026],[-54.60196,-25.48397],[-54.59509,-25.53696],[-54.59398,-25.59224],[-54.5502,-25.58915],[-54.52926,-25.62846],[-53.90831,-25.55513],[-53.83691,-25.94849],[-53.73511,-26.04211],[-53.73086,-26.05842],[-53.7264,-26.0664],[-53.73391,-26.07006],[-53.73968,-26.10012],[-53.65018,-26.19501],[-53.65237,-26.23289],[-53.63739,-26.2496],[-53.63881,-26.25075],[-53.64632,-26.24798],[-53.64186,-26.25976],[-53.64505,-26.28089],[-53.68269,-26.33359],[-53.73372,-26.6131],[-53.80144,-27.09844],[-54.15978,-27.2889],[-54.19062,-27.27639],[-54.19268,-27.30751],[-54.41888,-27.40882],[-54.50416,-27.48232],[-54.67657,-27.57214],[-54.90159,-27.63132],[-54.90805,-27.73149],[-55.1349,-27.89759],[-55.16872,-27.86224],[-55.33303,-27.94661],[-55.6262,-28.17124],[-55.65418,-28.18304],[-56.01729,-28.51223],[-56.00458,-28.60421],[-56.05265,-28.62651],[-56.54171,-29.11447],[-56.57295,-29.11357],[-56.62789,-29.18073],[-56.81251,-29.48154],[-57.09386,-29.74211],[-57.65132,-30.19229],[-57.22502,-30.26121],[-56.90236,-30.02578],[-56.49267,-30.39471],[-56.4795,-30.3899],[-56.4619,-30.38457],[-55.87388,-31.05053],[-55.58866,-30.84117],[-55.5634,-30.8686],[-55.55373,-30.8732],[-55.55218,-30.88193],[-55.54572,-30.89051],[-55.53431,-30.89714],[-55.53276,-30.90218],[-55.52712,-30.89997],[-55.51862,-30.89828],[-55.50841,-30.9027],[-55.50821,-30.91349],[-54.17384,-31.86168],[-53.76024,-32.0751],[-53.39572,-32.58596],[-53.37671,-32.57005],[-53.1111,-32.71147],[-53.53459,-33.16843],[-53.52794,-33.68908],[-53.44031,-33.69344],[-53.39593,-33.75169],[-53.37138,-33.74313],[-52.83257,-34.01481],[-28.34015,-20.99094],[-28.99601,1.86593],[-51.35485,4.8383],[-51.63798,4.51394],[-51.61983,4.14596],[-51.79599,3.89336],[-51.82312,3.85825],[-51.85573,3.83427],[-52.31787,3.17896],[-52.6906,2.37298],[-52.96539,2.1881],[-53.78743,2.34412],[-54.16286,2.10779],[-54.6084,2.32856],[-55.01919,2.564],[-55.71493,2.40342],[-55.96292,2.53188],[-56.13054,2.27723],[-55.92159,2.05236],[-55.89863,1.89861],[-55.99278,1.83137],[-56.47045,1.95135],[-56.7659,1.89509],[-57.07092,1.95304],[-57.09109,2.01854],[-57.23981,1.95808],[-57.35073,1.98327],[-57.55743,1.69605],[-57.77281,1.73344],[-57.97336,1.64566],[-58.01873,1.51966],[-58.33887,1.58014],[-58.4858,1.48399],[-58.53571,1.29154],[-58.84229,1.17749],[-58.92072,1.31293],[-59.25583,1.40559],[-59.74066,1.87596],[-59.7264,2.27497],[-59.91177,2.36759],[-59.99733,2.92312],[-59.79769,3.37162],[-59.86899,3.57089],[-59.51963,3.91951],[-59.73353,4.20399],[-59.69361,4.34069]]]]}},{type:"Feature",properties:{iso1A2:"BS",iso1A3:"BHS",iso1N3:"044",wikidata:"Q778",nameEn:"The Bahamas",groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 242"]},geometry:{type:"MultiPolygon",coordinates:[[[[-72.98446,20.4801],[-71.70065,25.7637],[-78.91214,27.76553],[-80.65727,23.71953],[-72.98446,20.4801]]]]}},{type:"Feature",properties:{iso1A2:"BT",iso1A3:"BTN",iso1N3:"064",wikidata:"Q917",nameEn:"Bhutan",groups:["034","142","UN"],driveSide:"left",callingCodes:["975"]},geometry:{type:"MultiPolygon",coordinates:[[[[91.6469,27.76358],[91.5629,27.84823],[91.48973,27.93903],[91.46327,28.0064],[91.25779,28.07509],[91.20019,27.98715],[90.69894,28.07784],[90.58842,28.02838],[90.13387,28.19178],[89.79762,28.23979],[89.59525,28.16433],[89.12825,27.62502],[89.0582,27.60985],[88.97213,27.51671],[88.95355,27.4106],[89.00216,27.32532],[88.96947,27.30319],[88.93678,27.33777],[88.91901,27.32483],[88.74219,27.144],[88.86984,27.10937],[88.8714,26.97488],[88.92301,26.99286],[88.95807,26.92668],[89.09554,26.89089],[89.12825,26.81661],[89.1926,26.81329],[89.37913,26.86224],[89.38319,26.85963],[89.3901,26.84225],[89.42349,26.83727],[89.63369,26.74402],[89.86124,26.73307],[90.04535,26.72422],[90.30402,26.85098],[90.39271,26.90704],[90.48504,26.8594],[90.67715,26.77215],[91.50067,26.79223],[91.83181,26.87318],[92.05523,26.8692],[92.11863,26.893],[92.03457,27.07334],[92.04702,27.26861],[92.12019,27.27829],[92.01132,27.47352],[91.65007,27.48287],[91.55819,27.6144],[91.6469,27.76358]]]]}},{type:"Feature",properties:{iso1A2:"BV",iso1A3:"BVT",iso1N3:"074",wikidata:"Q23408",nameEn:"Bouvet Island",country:"NO",groups:["005","419","019","UN"]},geometry:{type:"MultiPolygon",coordinates:[[[[4.54042,-54.0949],[2.28941,-54.13089],[3.35353,-55.17558],[4.54042,-54.0949]]]]}},{type:"Feature",properties:{iso1A2:"BW",iso1A3:"BWA",iso1N3:"072",wikidata:"Q963",nameEn:"Botswana",groups:["018","202","002","UN"],driveSide:"left",callingCodes:["267"]},geometry:{type:"MultiPolygon",coordinates:[[[[25.26433,-17.79571],[25.16882,-17.78253],[25.05895,-17.84452],[24.95586,-17.79674],[24.73364,-17.89338],[24.71887,-17.9218],[24.6303,-17.9863],[24.57485,-18.07151],[24.40577,-17.95726],[24.19416,-18.01919],[23.61088,-18.4881],[23.29618,-17.99855],[23.0996,-18.00075],[21.45556,-18.31795],[20.99904,-18.31743],[20.99751,-22.00026],[19.99912,-21.99991],[19.99817,-24.76768],[20.02809,-24.78725],[20.03678,-24.81004],[20.29826,-24.94869],[20.64795,-25.47827],[20.86081,-26.14892],[20.61754,-26.4692],[20.63275,-26.78181],[20.68596,-26.9039],[20.87031,-26.80047],[21.13353,-26.86661],[21.37869,-26.82083],[21.69322,-26.86152],[21.7854,-26.79199],[21.77114,-26.69015],[21.83291,-26.65959],[21.90703,-26.66808],[22.06192,-26.61882],[22.21206,-26.3773],[22.41921,-26.23078],[22.56365,-26.19668],[22.70808,-25.99186],[22.86012,-25.50572],[23.03497,-25.29971],[23.47588,-25.29971],[23.9244,-25.64286],[24.18287,-25.62916],[24.36531,-25.773],[24.44703,-25.73021],[24.67319,-25.81749],[24.8946,-25.80723],[25.01718,-25.72507],[25.12266,-25.75931],[25.33076,-25.76616],[25.58543,-25.6343],[25.6643,-25.4491],[25.69661,-25.29284],[25.72702,-25.25503],[25.88571,-24.87802],[25.84295,-24.78661],[25.8515,-24.75727],[26.39409,-24.63468],[26.46346,-24.60358],[26.51667,-24.47219],[26.84165,-24.24885],[26.99749,-23.65486],[27.33768,-23.40917],[27.52393,-23.37952],[27.6066,-23.21894],[27.74154,-23.2137],[27.93539,-23.04941],[27.93729,-22.96194],[28.04752,-22.90243],[28.04562,-22.8394],[28.34874,-22.5694],[28.63287,-22.55887],[28.91889,-22.44299],[29.0151,-22.22907],[29.10881,-22.21202],[29.15268,-22.21399],[29.18974,-22.18599],[29.21955,-22.17771],[29.37703,-22.19581],[29.3533,-22.18363],[29.24648,-22.05967],[29.1974,-22.07472],[29.14501,-22.07275],[29.08495,-22.04867],[29.04108,-22.00563],[29.02191,-21.95665],[29.02191,-21.90647],[29.04023,-21.85864],[29.07763,-21.81877],[28.58114,-21.63455],[28.49942,-21.66634],[28.29416,-21.59037],[28.01669,-21.57624],[27.91407,-21.31621],[27.69171,-21.08409],[27.72972,-20.51735],[27.69361,-20.48531],[27.28865,-20.49873],[27.29831,-20.28935],[27.21278,-20.08244],[26.72246,-19.92707],[26.17227,-19.53709],[25.96226,-19.08152],[25.99837,-19.02943],[25.94326,-18.90362],[25.82353,-18.82808],[25.79217,-18.6355],[25.68859,-18.56165],[25.53465,-18.39041],[25.39972,-18.12691],[25.31799,-18.07091],[25.23909,-17.90832],[25.26433,-17.79571]]]]}},{type:"Feature",properties:{iso1A2:"BY",iso1A3:"BLR",iso1N3:"112",wikidata:"Q184",nameEn:"Belarus",groups:["151","150","UN"],callingCodes:["375"]},geometry:{type:"MultiPolygon",coordinates:[[[[28.15217,56.16964],[27.97865,56.11849],[27.63065,55.89687],[27.61683,55.78558],[27.3541,55.8089],[27.27804,55.78299],[27.1559,55.85032],[26.97153,55.8102],[26.87448,55.7172],[26.76872,55.67658],[26.71802,55.70645],[26.64888,55.70515],[26.63231,55.67968],[26.63167,55.57887],[26.55094,55.5093],[26.5522,55.40277],[26.44937,55.34832],[26.5709,55.32572],[26.6714,55.33902],[26.80929,55.31642],[26.83266,55.30444],[26.835,55.28182],[26.73017,55.24226],[26.72983,55.21788],[26.68075,55.19787],[26.69243,55.16718],[26.54753,55.14181],[26.51481,55.16051],[26.46249,55.12814],[26.35121,55.1525],[26.30628,55.12536],[26.23202,55.10439],[26.26941,55.08032],[26.20397,54.99729],[26.13386,54.98924],[26.05907,54.94631],[25.99129,54.95705],[25.89462,54.93438],[25.74122,54.80108],[25.75977,54.57252],[25.68045,54.5321],[25.64813,54.48704],[25.62203,54.4656],[25.63371,54.42075],[25.5376,54.33158],[25.55425,54.31591],[25.68513,54.31727],[25.78553,54.23327],[25.78563,54.15747],[25.71084,54.16704],[25.64875,54.1259],[25.54724,54.14925],[25.51452,54.17799],[25.56823,54.25212],[25.509,54.30267],[25.35559,54.26544],[25.22705,54.26271],[25.19199,54.219],[25.0728,54.13419],[24.991,54.14241],[24.96894,54.17589],[24.77131,54.11091],[24.85311,54.02862],[24.74279,53.96663],[24.69185,53.96543],[24.69652,54.01901],[24.62275,54.00217],[24.44411,53.90076],[24.34128,53.90076],[24.19638,53.96405],[23.98837,53.92554],[23.95098,53.9613],[23.81309,53.94205],[23.80543,53.89558],[23.71726,53.93379],[23.61677,53.92691],[23.51284,53.95052],[23.62004,53.60942],[23.81995,53.24131],[23.85657,53.22923],[23.91393,53.16469],[23.87548,53.0831],[23.92184,53.02079],[23.94689,52.95919],[23.91805,52.94016],[23.93763,52.71332],[23.73615,52.6149],[23.58296,52.59868],[23.45112,52.53774],[23.34141,52.44845],[23.18196,52.28812],[23.20071,52.22848],[23.47859,52.18215],[23.54314,52.12148],[23.61,52.11264],[23.64066,52.07626],[23.68733,51.9906],[23.61523,51.92066],[23.62691,51.78208],[23.53198,51.74298],[23.57053,51.55938],[23.56236,51.53673],[23.62751,51.50512],[23.6736,51.50255],[23.60906,51.62122],[23.7766,51.66809],[23.91118,51.63316],[23.8741,51.59734],[23.99907,51.58369],[24.13075,51.66979],[24.3163,51.75063],[24.29021,51.80841],[24.37123,51.88222],[24.98784,51.91273],[25.20228,51.97143],[25.46163,51.92205],[25.73673,51.91973],[25.80574,51.94556],[25.83217,51.92587],[26.00408,51.92967],[26.19084,51.86781],[26.39367,51.87315],[26.46962,51.80501],[26.69759,51.82284],[26.80043,51.75777],[26.9489,51.73788],[26.99422,51.76933],[27.20602,51.77291],[27.20948,51.66713],[27.26613,51.65957],[27.24828,51.60161],[27.47212,51.61184],[27.51058,51.5854],[27.55727,51.63486],[27.71932,51.60672],[27.67125,51.50854],[27.76052,51.47604],[27.85253,51.62293],[27.91844,51.61952],[27.95827,51.56065],[28.10658,51.57857],[28.23452,51.66988],[28.37592,51.54505],[28.47051,51.59734],[28.64429,51.5664],[28.69161,51.44695],[28.73143,51.46236],[28.75615,51.41442],[28.78224,51.45294],[28.76027,51.48802],[28.81795,51.55552],[28.95528,51.59222],[28.99098,51.56833],[29.1187,51.65872],[29.16402,51.64679],[29.20659,51.56918],[29.25603,51.57089],[29.25191,51.49828],[29.32881,51.37843],[29.42357,51.4187],[29.49773,51.39814],[29.54372,51.48372],[29.7408,51.53417],[29.77376,51.4461],[30.17888,51.51025],[30.34642,51.42555],[30.36153,51.33984],[30.56203,51.25655],[30.64992,51.35014],[30.51946,51.59649],[30.68804,51.82806],[30.76443,51.89739],[30.90897,52.00699],[30.95589,52.07775],[31.13332,52.1004],[31.25142,52.04131],[31.38326,52.12991],[31.7822,52.11406],[31.77877,52.18636],[31.6895,52.1973],[31.70735,52.26711],[31.57971,52.32146],[31.62084,52.33849],[31.61397,52.48843],[31.56316,52.51518],[31.63869,52.55361],[31.50406,52.69707],[31.57277,52.71613],[31.592,52.79011],[31.35667,52.97854],[31.24147,53.031],[31.32283,53.04101],[31.33519,53.08805],[31.3915,53.09712],[31.36403,53.13504],[31.40523,53.21406],[31.56316,53.19432],[31.62496,53.22886],[31.787,53.18033],[31.82373,53.10042],[32.15368,53.07594],[32.40773,53.18856],[32.51725,53.28431],[32.73257,53.33494],[32.74968,53.45597],[32.47777,53.5548],[32.40499,53.6656],[32.50112,53.68594],[32.45717,53.74039],[32.36663,53.7166],[32.12621,53.81586],[31.89137,53.78099],[31.77028,53.80015],[31.85019,53.91801],[31.88744,54.03653],[31.89599,54.0837],[31.57002,54.14535],[31.30791,54.25315],[31.3177,54.34067],[31.22945,54.46585],[31.08543,54.50361],[31.21399,54.63113],[31.19339,54.66947],[30.99187,54.67046],[30.98226,54.68872],[31.0262,54.70698],[30.97127,54.71967],[30.95479,54.74346],[30.75165,54.80699],[30.8264,54.90062],[30.81759,54.94064],[30.93144,54.9585],[30.95754,54.98609],[30.9081,55.02232],[30.94243,55.03964],[31.00972,55.02783],[31.02071,55.06167],[30.97369,55.17134],[30.87944,55.28223],[30.81946,55.27931],[30.8257,55.3313],[30.93144,55.3914],[30.90123,55.46621],[30.95204,55.50667],[30.93419,55.6185],[30.86003,55.63169],[30.7845,55.58514],[30.72957,55.66268],[30.67464,55.64176],[30.63344,55.73079],[30.51037,55.76568],[30.51346,55.78982],[30.48257,55.81066],[30.30987,55.83592],[30.27776,55.86819],[30.12136,55.8358],[29.97975,55.87281],[29.80672,55.79569],[29.61446,55.77716],[29.51283,55.70294],[29.3604,55.75862],[29.44692,55.95978],[29.21717,55.98971],[29.08299,56.03427],[28.73418,55.97131],[28.63668,56.07262],[28.68337,56.10173],[28.5529,56.11705],[28.43068,56.09407],[28.37987,56.11399],[28.36888,56.05805],[28.30571,56.06035],[28.15217,56.16964]]]]}},{type:"Feature",properties:{iso1A2:"BZ",iso1A3:"BLZ",iso1N3:"084",wikidata:"Q242",nameEn:"Belize",groups:["013","003","419","019","UN"],roadSpeedUnit:"mph",callingCodes:["501"]},geometry:{type:"MultiPolygon",coordinates:[[[[-88.3268,18.49048],[-88.48242,18.49164],[-88.71505,18.0707],[-88.8716,17.89535],[-89.03839,18.0067],[-89.15105,17.95104],[-89.14985,17.81563],[-89.15025,17.04813],[-89.22683,15.88619],[-89.17418,15.90898],[-89.02415,15.9063],[-88.95358,15.88698],[-88.40779,16.09624],[-86.92368,17.61462],[-87.84815,18.18511],[-87.85693,18.18266],[-87.86657,18.19971],[-87.87604,18.18313],[-87.90671,18.15213],[-88.03165,18.16657],[-88.03238,18.41778],[-88.26593,18.47617],[-88.29909,18.47591],[-88.3268,18.49048]]]]}},{type:"Feature",properties:{iso1A2:"CA",iso1A3:"CAN",iso1N3:"124",wikidata:"Q16",nameEn:"Canada",groups:["021","003","019","UN"],callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-67.20349,45.1722],[-67.19603,45.16771],[-67.15965,45.16179],[-67.11316,45.11176],[-67.0216,44.95333],[-66.96824,44.90965],[-66.98249,44.87071],[-66.96824,44.83078],[-66.93432,44.82597],[-67.16117,44.20069],[-61.98255,37.34815],[-56.27503,47.39728],[-53.12387,41.40385],[-46.37635,57.3249],[-77.52957,77.23408],[-68.21821,80.48551],[-49.33696,84.57952],[-140.97446,84.39275],[-141.00116,60.30648],[-140.5227,60.22077],[-140.45648,60.30919],[-139.98024,60.18027],[-139.68991,60.33693],[-139.05831,60.35205],[-139.20603,60.08896],[-139.05365,59.99655],[-138.71149,59.90728],[-138.62145,59.76431],[-137.60623,59.24465],[-137.4925,58.89415],[-136.82619,59.16198],[-136.52365,59.16752],[-136.47323,59.46617],[-136.33727,59.44466],[-136.22381,59.55526],[-136.31566,59.59083],[-135.48007,59.79937],[-135.03069,59.56208],[-135.00267,59.28745],[-134.7047,59.2458],[-134.55699,59.1297],[-134.48059,59.13231],[-134.27175,58.8634],[-133.84645,58.73543],[-133.38523,58.42773],[-131.8271,56.62247],[-130.77769,56.36185],[-130.33965,56.10849],[-130.10173,56.12178],[-130.00093,56.00325],[-130.00857,55.91344],[-130.15373,55.74895],[-129.97513,55.28029],[-130.08035,55.21556],[-130.18765,55.07744],[-130.27203,54.97174],[-130.44184,54.85377],[-130.64499,54.76912],[-130.61931,54.70835],[-133.92876,54.62289],[-133.36909,48.51151],[-125.03842,48.53282],[-123.50039,48.21223],[-123.15614,48.35395],[-123.26565,48.6959],[-123.0093,48.76586],[-123.0093,48.83186],[-123.32163,49.00419],[-95.15355,48.9996],[-95.15357,49.384],[-95.12903,49.37056],[-95.05825,49.35311],[-95.01419,49.35647],[-94.99532,49.36579],[-94.95681,49.37035],[-94.85381,49.32492],[-94.8159,49.32299],[-94.82487,49.29483],[-94.77355,49.11998],[-94.75017,49.09931],[-94.687,48.84077],[-94.70087,48.8339],[-94.70486,48.82365],[-94.69669,48.80918],[-94.69335,48.77883],[-94.58903,48.71803],[-94.54885,48.71543],[-94.53826,48.70216],[-94.44258,48.69223],[-94.4174,48.71049],[-94.27153,48.70232],[-94.25172,48.68404],[-94.25104,48.65729],[-94.23215,48.65202],[-93.85769,48.63284],[-93.83288,48.62745],[-93.80676,48.58232],[-93.80939,48.52439],[-93.79267,48.51631],[-93.66382,48.51845],[-93.47022,48.54357],[-93.44472,48.59147],[-93.40693,48.60948],[-93.39758,48.60364],[-93.3712,48.60599],[-93.33946,48.62787],[-93.25391,48.64266],[-92.94973,48.60866],[-92.7287,48.54005],[-92.6342,48.54133],[-92.62747,48.50278],[-92.69927,48.49573],[-92.71323,48.46081],[-92.65606,48.43471],[-92.50712,48.44921],[-92.45588,48.40624],[-92.48147,48.36609],[-92.37185,48.22259],[-92.27167,48.25046],[-92.30939,48.31251],[-92.26662,48.35651],[-92.202,48.35252],[-92.14732,48.36578],[-92.05339,48.35958],[-91.98929,48.25409],[-91.86125,48.21278],[-91.71231,48.19875],[-91.70451,48.11805],[-91.55649,48.10611],[-91.58025,48.04339],[-91.45829,48.07454],[-91.43248,48.04912],[-91.25025,48.08522],[-91.08016,48.18096],[-90.87588,48.2484],[-90.75045,48.09143],[-90.56444,48.12184],[-90.56312,48.09488],[-90.07418,48.11043],[-89.89974,47.98109],[-89.77248,48.02607],[-89.57972,48.00023],[-89.48837,48.01412],[-88.37033,48.30586],[-84.85871,46.88881],[-84.55635,46.45974],[-84.47607,46.45225],[-84.4481,46.48972],[-84.42101,46.49853],[-84.34174,46.50683],[-84.29893,46.49127],[-84.26351,46.49508],[-84.2264,46.53337],[-84.1945,46.54061],[-84.17723,46.52753],[-84.12885,46.53068],[-84.11196,46.50248],[-84.13451,46.39218],[-84.11254,46.32329],[-84.11615,46.2681],[-84.09756,46.25512],[-84.1096,46.23987],[-83.95399,46.05634],[-83.90453,46.05922],[-83.83329,46.12169],[-83.57017,46.105],[-83.43746,45.99749],[-83.59589,45.82131],[-82.48419,45.30225],[-82.42469,42.992],[-82.4146,42.97626],[-82.4253,42.95423],[-82.45331,42.93139],[-82.4826,42.8068],[-82.46613,42.76615],[-82.51063,42.66025],[-82.51858,42.611],[-82.57583,42.5718],[-82.58873,42.54984],[-82.64242,42.55594],[-82.82964,42.37355],[-83.02253,42.33045],[-83.07837,42.30978],[-83.09837,42.28877],[-83.12724,42.2376],[-83.14962,42.04089],[-83.11184,41.95671],[-82.67862,41.67615],[-78.93684,42.82887],[-78.90712,42.89733],[-78.90905,42.93022],[-78.93224,42.95229],[-78.96312,42.95509],[-78.98126,42.97],[-79.02074,42.98444],[-79.02424,43.01983],[-78.99941,43.05612],[-79.01055,43.06659],[-79.07486,43.07845],[-79.05671,43.10937],[-79.06881,43.12029],[-79.0427,43.13934],[-79.04652,43.16396],[-79.05384,43.17418],[-79.05002,43.20133],[-79.05544,43.21224],[-79.05512,43.25375],[-79.06921,43.26183],[-79.25796,43.54052],[-76.79706,43.63099],[-76.43859,44.09393],[-76.35324,44.13493],[-76.31222,44.19894],[-76.244,44.19643],[-76.1664,44.23051],[-76.16285,44.28262],[-76.00018,44.34896],[-75.95947,44.34463],[-75.8217,44.43176],[-75.76813,44.51537],[-75.41441,44.76614],[-75.2193,44.87821],[-75.01363,44.95608],[-74.99101,44.98051],[-74.8447,45.00606],[-74.66689,45.00646],[-74.32699,44.99029],[-73.35025,45.00942],[-71.50067,45.01357],[-71.48735,45.07784],[-71.42778,45.12624],[-71.40364,45.21382],[-71.44252,45.2361],[-71.37133,45.24624],[-71.29371,45.29996],[-71.22338,45.25184],[-71.19723,45.25438],[-71.14568,45.24128],[-71.08364,45.30623],[-71.01866,45.31573],[-71.0107,45.34819],[-70.95193,45.33895],[-70.91169,45.29849],[-70.89864,45.2398],[-70.84816,45.22698],[-70.80236,45.37444],[-70.82638,45.39828],[-70.78372,45.43269],[-70.65383,45.37592],[-70.62518,45.42286],[-70.72651,45.49771],[-70.68516,45.56964],[-70.54019,45.67291],[-70.38934,45.73215],[-70.41523,45.79497],[-70.25976,45.89675],[-70.24694,45.95138],[-70.31025,45.96424],[-70.23855,46.1453],[-70.29078,46.18832],[-70.18547,46.35357],[-70.05812,46.41768],[-69.99966,46.69543],[-69.22119,47.46461],[-69.05148,47.42012],[-69.05073,47.30076],[-69.05039,47.2456],[-68.89222,47.1807],[-68.70125,47.24399],[-68.60575,47.24659],[-68.57914,47.28431],[-68.38332,47.28723],[-68.37458,47.35851],[-68.23244,47.35712],[-67.94843,47.1925],[-67.87993,47.10377],[-67.78578,47.06473],[-67.78111,45.9392],[-67.75196,45.91814],[-67.80961,45.87531],[-67.75654,45.82324],[-67.80653,45.80022],[-67.80705,45.69528],[-67.6049,45.60725],[-67.43815,45.59162],[-67.42144,45.50584],[-67.50578,45.48971],[-67.42394,45.37969],[-67.48201,45.27351],[-67.34927,45.122],[-67.29754,45.14865],[-67.29748,45.18173],[-67.27039,45.1934],[-67.22751,45.16344],[-67.20349,45.1722]]]]}},{type:"Feature",properties:{iso1A2:"CC",iso1A3:"CCK",iso1N3:"166",wikidata:"Q36004",nameEn:"Cocos (Keeling) Islands",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[96.61846,-10.82438],[96.02343,-12.68334],[97.93979,-12.33309],[96.61846,-10.82438]]]]}},{type:"Feature",properties:{iso1A2:"CD",iso1A3:"COD",iso1N3:"180",wikidata:"Q974",nameEn:"Democratic Republic of the Congo",aliases:["ZR"],groups:["017","202","002","UN"],callingCodes:["243"]},geometry:{type:"MultiPolygon",coordinates:[[[[27.44012,5.07349],[27.09575,5.22305],[26.93064,5.13535],[26.85579,5.03887],[26.74572,5.10685],[26.48595,5.04984],[26.13371,5.25594],[25.86073,5.19455],[25.53271,5.37431],[25.34558,5.29101],[25.31256,5.03668],[24.71816,4.90509],[24.46719,5.0915],[23.38847,4.60013],[22.94817,4.82392],[22.89094,4.79321],[22.84691,4.69887],[22.78526,4.71423],[22.6928,4.47285],[22.60915,4.48821],[22.5431,4.22041],[22.45504,4.13039],[22.27682,4.11347],[22.10721,4.20723],[21.6405,4.317],[21.55904,4.25553],[21.25744,4.33676],[21.21341,4.29285],[21.11214,4.33895],[21.08793,4.39603],[20.90383,4.44877],[20.60184,4.42394],[18.62755,3.47564],[18.63857,3.19342],[18.10683,2.26876],[18.08034,1.58553],[17.85887,1.04327],[17.86989,.58873],[17.95255,.48128],[17.93877,.32424],[17.81204,.23884],[17.66051,-.26535],[17.72112,-.52707],[17.32438,-.99265],[16.97999,-1.12762],[16.70724,-1.45815],[16.50336,-1.8795],[16.16173,-2.16586],[16.22785,-2.59528],[16.1755,-3.25014],[16.21407,-3.2969],[15.89448,-3.9513],[15.53081,-4.042],[15.48121,-4.22062],[15.41785,-4.28381],[15.32693,-4.27282],[15.25411,-4.31121],[15.1978,-4.32388],[14.83101,-4.80838],[14.67948,-4.92093],[14.5059,-4.84956],[14.41499,-4.8825],[14.37366,-4.56125],[14.47284,-4.42941],[14.3957,-4.36623],[14.40672,-4.28381],[13.9108,-4.50906],[13.81162,-4.41842],[13.71794,-4.44864],[13.70417,-4.72601],[13.50305,-4.77818],[13.41764,-4.89897],[13.11182,-4.5942],[13.09648,-4.63739],[13.11195,-4.67745],[12.8733,-4.74346],[12.70868,-4.95505],[12.63465,-4.94632],[12.60251,-5.01715],[12.46297,-5.09408],[12.49815,-5.14058],[12.51589,-5.1332],[12.53586,-5.14658],[12.53599,-5.1618],[12.52301,-5.17481],[12.52318,-5.74353],[12.26557,-5.74031],[12.20376,-5.76338],[11.95767,-5.94705],[12.42245,-6.07585],[13.04371,-5.87078],[16.55507,-5.85631],[16.96282,-7.21787],[17.5828,-8.13784],[18.33635,-8.00126],[19.33698,-7.99743],[19.5469,-7.00195],[20.30218,-6.98955],[20.31846,-6.91953],[20.61689,-6.90876],[20.56263,-7.28566],[21.79824,-7.29628],[21.84856,-9.59871],[22.19039,-9.94628],[22.32604,-10.76291],[22.17954,-10.85884],[22.25951,-11.24911],[22.54205,-11.05784],[23.16602,-11.10577],[23.45631,-10.946],[23.86868,-11.02856],[24.00027,-10.89356],[24.34528,-11.06816],[24.42612,-11.44975],[25.34069,-11.19707],[25.33058,-11.65767],[26.01777,-11.91488],[26.88687,-12.01868],[27.04351,-11.61312],[27.22541,-11.60323],[27.21025,-11.76157],[27.59932,-12.22123],[28.33199,-12.41375],[29.01918,-13.41353],[29.60531,-13.21685],[29.65078,-13.41844],[29.81551,-13.44683],[29.8139,-12.14898],[29.48404,-12.23604],[29.4992,-12.43843],[29.18592,-12.37921],[28.48357,-11.87532],[28.37241,-11.57848],[28.65032,-10.65133],[28.62795,-9.92942],[28.68532,-9.78],[28.56208,-9.49122],[28.51627,-9.44726],[28.52636,-9.35379],[28.36562,-9.30091],[28.38526,-9.23393],[28.9711,-8.66935],[28.88917,-8.4831],[30.79243,-8.27382],[30.2567,-7.14121],[29.52552,-6.2731],[29.43673,-4.44845],[29.23708,-3.75856],[29.21463,-3.3514],[29.25633,-3.05471],[29.17258,-2.99385],[29.16037,-2.95457],[29.09797,-2.91935],[29.09119,-2.87871],[29.0505,-2.81774],[29.00404,-2.81978],[29.00167,-2.78523],[29.04081,-2.7416],[29.00357,-2.70596],[28.94346,-2.69124],[28.89793,-2.66111],[28.90226,-2.62385],[28.89288,-2.55848],[28.87943,-2.55165],[28.86193,-2.53185],[28.86209,-2.5231],[28.87497,-2.50887],[28.88846,-2.50493],[28.89342,-2.49017],[28.89132,-2.47557],[28.86846,-2.44866],[28.86826,-2.41888],[28.89601,-2.37321],[28.95642,-2.37321],[29.00051,-2.29001],[29.105,-2.27043],[29.17562,-2.12278],[29.11847,-1.90576],[29.24458,-1.69663],[29.24323,-1.66826],[29.36322,-1.50887],[29.45038,-1.5054],[29.53062,-1.40499],[29.59061,-1.39016],[29.58388,-.89821],[29.63006,-.8997],[29.62708,-.71055],[29.67176,-.55714],[29.67474,-.47969],[29.65091,-.46777],[29.72687,-.08051],[29.7224,.07291],[29.77454,.16675],[29.81922,.16824],[29.87284,.39166],[29.97413,.52124],[29.95477,.64486],[29.98307,.84295],[30.1484,.89805],[30.22139,.99635],[30.24671,1.14974],[30.48503,1.21675],[31.30127,2.11006],[31.28042,2.17853],[31.20148,2.2217],[31.1985,2.29462],[31.12104,2.27676],[31.07934,2.30207],[31.06593,2.35862],[30.96911,2.41071],[30.91102,2.33332],[30.83059,2.42559],[30.74271,2.43601],[30.75612,2.5863],[30.8857,2.83923],[30.8574,2.9508],[30.77101,3.04897],[30.84251,3.26908],[30.93486,3.40737],[30.94081,3.50847],[30.85153,3.48867],[30.85997,3.5743],[30.80713,3.60506],[30.78512,3.67097],[30.56277,3.62703],[30.57378,3.74567],[30.55396,3.84451],[30.47691,3.83353],[30.27658,3.95653],[30.22374,3.93896],[30.1621,4.10586],[30.06964,4.13221],[29.79666,4.37809],[29.82087,4.56246],[29.49726,4.7007],[29.43341,4.50101],[29.22207,4.34297],[29.03054,4.48784],[28.8126,4.48784],[28.6651,4.42638],[28.20719,4.35614],[27.79551,4.59976],[27.76469,4.79284],[27.65462,4.89375],[27.56656,4.89375],[27.44012,5.07349]]]]}},{type:"Feature",properties:{iso1A2:"CF",iso1A3:"CAF",iso1N3:"140",wikidata:"Q929",nameEn:"Central African Republic",groups:["017","202","002","UN"],callingCodes:["236"]},geometry:{type:"MultiPolygon",coordinates:[[[[22.87758,10.91915],[22.45889,11.00246],[21.72139,10.64136],[21.71479,10.29932],[21.63553,10.217],[21.52766,10.2105],[21.34934,9.95907],[21.26348,9.97642],[20.82979,9.44696],[20.36748,9.11019],[19.06421,9.00367],[18.86388,8.87971],[19.11044,8.68172],[18.79783,8.25929],[18.67455,8.22226],[18.62612,8.14163],[18.64153,8.08714],[18.6085,8.05009],[18.02731,8.01085],[17.93926,7.95853],[17.67288,7.98905],[16.8143,7.53971],[16.6668,7.67281],[16.658,7.75353],[16.59415,7.76444],[16.58315,7.88657],[16.41583,7.77971],[16.40703,7.68809],[15.79942,7.44149],[15.73118,7.52006],[15.49743,7.52179],[15.23397,7.25135],[15.04717,6.77085],[14.96311,6.75693],[14.79966,6.39043],[14.80122,6.34866],[14.74206,6.26356],[14.56149,6.18928],[14.43073,6.08867],[14.42917,6.00508],[14.49455,5.91683],[14.60974,5.91838],[14.62375,5.70466],[14.58951,5.59777],[14.62531,5.51411],[14.52724,5.28319],[14.57083,5.23979],[14.65489,5.21343],[14.73383,4.6135],[15.00825,4.41458],[15.08609,4.30282],[15.10644,4.1362],[15.17482,4.05131],[15.07686,4.01805],[15.73522,3.24348],[15.77725,3.26835],[16.05449,3.02306],[16.08252,2.45708],[16.19357,2.21537],[16.50126,2.84739],[16.46701,2.92512],[16.57598,3.47999],[16.68283,3.54257],[17.01746,3.55136],[17.35649,3.63045],[17.46876,3.70515],[17.60966,3.63705],[17.83421,3.61068],[17.85842,3.53378],[18.05656,3.56893],[18.14902,3.54476],[18.17323,3.47665],[18.24148,3.50302],[18.2723,3.57992],[18.39558,3.58212],[18.49245,3.63924],[18.58711,3.49423],[18.62755,3.47564],[20.60184,4.42394],[20.90383,4.44877],[21.08793,4.39603],[21.11214,4.33895],[21.21341,4.29285],[21.25744,4.33676],[21.55904,4.25553],[21.6405,4.317],[22.10721,4.20723],[22.27682,4.11347],[22.45504,4.13039],[22.5431,4.22041],[22.60915,4.48821],[22.6928,4.47285],[22.78526,4.71423],[22.84691,4.69887],[22.89094,4.79321],[22.94817,4.82392],[23.38847,4.60013],[24.46719,5.0915],[24.71816,4.90509],[25.31256,5.03668],[25.34558,5.29101],[25.53271,5.37431],[25.86073,5.19455],[26.13371,5.25594],[26.48595,5.04984],[26.74572,5.10685],[26.85579,5.03887],[26.93064,5.13535],[27.09575,5.22305],[27.44012,5.07349],[27.26886,5.25876],[27.23017,5.37167],[27.28621,5.56382],[27.22705,5.62889],[27.22705,5.71254],[26.51721,6.09655],[26.58259,6.1987],[26.32729,6.36272],[26.38022,6.63493],[25.90076,7.09549],[25.37461,7.33024],[25.35281,7.42595],[25.20337,7.50312],[25.20649,7.61115],[25.29214,7.66675],[25.25319,7.8487],[24.98855,7.96588],[24.85156,8.16933],[24.35965,8.26177],[24.13238,8.36959],[24.25691,8.69288],[23.51905,8.71749],[23.59065,8.99743],[23.44744,8.99128],[23.4848,9.16959],[23.56263,9.19418],[23.64358,9.28637],[23.64981,9.44303],[23.62179,9.53823],[23.69155,9.67566],[23.67164,9.86923],[23.3128,10.45214],[23.02221,10.69235],[22.87758,10.91915]]]]}},{type:"Feature",properties:{iso1A2:"CG",iso1A3:"COG",iso1N3:"178",wikidata:"Q971",nameEn:"Republic of the Congo",groups:["017","202","002","UN"],callingCodes:["242"]},geometry:{type:"MultiPolygon",coordinates:[[[[18.62755,3.47564],[18.58711,3.49423],[18.49245,3.63924],[18.39558,3.58212],[18.2723,3.57992],[18.24148,3.50302],[18.17323,3.47665],[18.14902,3.54476],[18.05656,3.56893],[17.85842,3.53378],[17.83421,3.61068],[17.60966,3.63705],[17.46876,3.70515],[17.35649,3.63045],[17.01746,3.55136],[16.68283,3.54257],[16.57598,3.47999],[16.46701,2.92512],[16.50126,2.84739],[16.19357,2.21537],[16.15568,2.18955],[16.08563,2.19733],[16.05294,1.9811],[16.14634,1.70259],[16.02647,1.65591],[16.02959,1.76483],[15.48942,1.98265],[15.34776,1.91264],[15.22634,2.03243],[15.00996,1.98887],[14.61145,2.17866],[13.29457,2.16106],[13.13461,1.57238],[13.25447,1.32339],[13.15519,1.23368],[13.89582,1.4261],[14.25186,1.39842],[14.48179,.9152],[14.26066,.57255],[14.10909,.58563],[13.88648,.26652],[13.90632,-.2287],[14.06862,-.20826],[14.2165,-.38261],[14.41887,-.44799],[14.52569,-.57818],[14.41838,-1.89412],[14.25932,-1.97624],[14.23518,-2.15671],[14.16202,-2.23916],[14.23829,-2.33715],[14.10442,-2.49268],[13.85846,-2.46935],[13.92073,-2.35581],[13.75884,-2.09293],[13.47977,-2.43224],[13.02759,-2.33098],[12.82172,-1.91091],[12.61312,-1.8129],[12.44656,-1.92025],[12.47925,-2.32626],[12.04895,-2.41704],[11.96866,-2.33559],[11.74605,-2.39936],[11.57637,-2.33379],[11.64487,-2.61865],[11.5359,-2.85654],[11.64798,-2.81146],[11.80365,-3.00424],[11.70558,-3.0773],[11.70227,-3.17465],[11.96554,-3.30267],[11.8318,-3.5812],[11.92719,-3.62768],[11.87083,-3.71571],[11.68608,-3.68942],[11.57949,-3.52798],[11.48764,-3.51089],[11.22301,-3.69888],[11.12647,-3.94169],[10.75913,-4.39519],[11.50888,-5.33417],[12.00924,-5.02627],[12.16068,-4.90089],[12.20901,-4.75642],[12.25587,-4.79437],[12.32324,-4.78415],[12.40964,-4.60609],[12.64835,-4.55937],[12.76844,-4.38709],[12.87096,-4.40315],[12.91489,-4.47907],[13.09648,-4.63739],[13.11182,-4.5942],[13.41764,-4.89897],[13.50305,-4.77818],[13.70417,-4.72601],[13.71794,-4.44864],[13.81162,-4.41842],[13.9108,-4.50906],[14.40672,-4.28381],[14.3957,-4.36623],[14.47284,-4.42941],[14.37366,-4.56125],[14.41499,-4.8825],[14.5059,-4.84956],[14.67948,-4.92093],[14.83101,-4.80838],[15.1978,-4.32388],[15.25411,-4.31121],[15.32693,-4.27282],[15.41785,-4.28381],[15.48121,-4.22062],[15.53081,-4.042],[15.89448,-3.9513],[16.21407,-3.2969],[16.1755,-3.25014],[16.22785,-2.59528],[16.16173,-2.16586],[16.50336,-1.8795],[16.70724,-1.45815],[16.97999,-1.12762],[17.32438,-.99265],[17.72112,-.52707],[17.66051,-.26535],[17.81204,.23884],[17.93877,.32424],[17.95255,.48128],[17.86989,.58873],[17.85887,1.04327],[18.08034,1.58553],[18.10683,2.26876],[18.63857,3.19342],[18.62755,3.47564]]]]}},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[8.72809,47.69282],[8.72617,47.69651],[8.73671,47.7169],[8.70543,47.73121],[8.74251,47.75168],[8.71778,47.76571],[8.68985,47.75686],[8.68022,47.78599],[8.65292,47.80066],[8.64425,47.76398],[8.62408,47.7626],[8.61657,47.79998],[8.56415,47.80633],[8.56814,47.78001],[8.48868,47.77215],[8.45771,47.7493],[8.44807,47.72426],[8.40569,47.69855],[8.4211,47.68407],[8.40473,47.67499],[8.41346,47.66676],[8.42264,47.66667],[8.44711,47.65379],[8.4667,47.65747],[8.46605,47.64103],[8.49656,47.64709],[8.5322,47.64687],[8.52801,47.66059],[8.56141,47.67088],[8.57683,47.66158],[8.6052,47.67258],[8.61113,47.66332],[8.62884,47.65098],[8.62049,47.63757],[8.60412,47.63735],[8.61471,47.64514],[8.60701,47.65271],[8.59545,47.64298],[8.60348,47.61204],[8.57586,47.59537],[8.55756,47.62394],[8.51686,47.63476],[8.50747,47.61897],[8.45578,47.60121],[8.46637,47.58389],[8.48949,47.588],[8.49431,47.58107],[8.43235,47.56617],[8.39477,47.57826],[8.38273,47.56608],[8.35512,47.57014],[8.32735,47.57133],[8.30277,47.58607],[8.29524,47.5919],[8.29722,47.60603],[8.2824,47.61225],[8.26313,47.6103],[8.25863,47.61571],[8.23809,47.61204],[8.22577,47.60385],[8.22011,47.6181],[8.20617,47.62141],[8.19378,47.61636],[8.1652,47.5945],[8.14947,47.59558],[8.13823,47.59147],[8.13662,47.58432],[8.11543,47.5841],[8.10395,47.57918],[8.10002,47.56504],[8.08557,47.55768],[8.06663,47.56374],[8.04383,47.55443],[8.02136,47.55096],[8.00113,47.55616],[7.97581,47.55493],[7.95682,47.55789],[7.94494,47.54511],[7.91251,47.55031],[7.90673,47.57674],[7.88664,47.58854],[7.84412,47.5841],[7.81901,47.58798],[7.79486,47.55691],[7.75261,47.54599],[7.71961,47.54219],[7.69642,47.53297],[7.68101,47.53232],[7.6656,47.53752],[7.66174,47.54554],[7.65083,47.54662],[7.63338,47.56256],[7.67655,47.56435],[7.68904,47.57133],[7.67115,47.5871],[7.68486,47.59601],[7.69385,47.60099],[7.68229,47.59905],[7.67395,47.59212],[7.64599,47.59695],[7.64213,47.5944],[7.64309,47.59151],[7.61929,47.57683],[7.60459,47.57869],[7.60523,47.58519],[7.58945,47.59017],[7.58386,47.57536],[7.56684,47.57785],[7.56548,47.57617],[7.55689,47.57232],[7.55652,47.56779],[7.53634,47.55553],[7.52831,47.55347],[7.51723,47.54578],[7.50873,47.54546],[7.49691,47.53821],[7.50588,47.52856],[7.51904,47.53515],[7.53199,47.5284],[7.5229,47.51644],[7.49804,47.51798],[7.51076,47.49651],[7.47534,47.47932],[7.43356,47.49712],[7.42923,47.48628],[7.4583,47.47216],[7.4462,47.46264],[7.43088,47.45846],[7.40308,47.43638],[7.35603,47.43432],[7.33526,47.44186],[7.24669,47.4205],[7.17026,47.44312],[7.19583,47.49455],[7.16249,47.49025],[7.12781,47.50371],[7.07425,47.48863],[7.0231,47.50522],[6.98425,47.49432],[7.0024,47.45264],[6.93953,47.43388],[6.93744,47.40714],[6.88542,47.37262],[6.87959,47.35335],[7.03125,47.36996],[7.0564,47.35134],[7.05305,47.33304],[6.94316,47.28747],[6.95108,47.26428],[6.9508,47.24338],[6.8489,47.15933],[6.76788,47.1208],[6.68823,47.06616],[6.71531,47.0494],[6.43341,46.92703],[6.46456,46.88865],[6.43216,46.80336],[6.45209,46.77502],[6.38351,46.73171],[6.27135,46.68251],[6.11084,46.57649],[6.1567,46.54402],[6.07269,46.46244],[6.08427,46.44305],[6.06407,46.41676],[6.09926,46.40768],[6.15016,46.3778],[6.15985,46.37721],[6.16987,46.36759],[6.15738,46.3491],[6.13876,46.33844],[6.1198,46.31157],[6.11697,46.29547],[6.1013,46.28512],[6.11926,46.2634],[6.12446,46.25059],[6.10071,46.23772],[6.08563,46.24651],[6.07072,46.24085],[6.0633,46.24583],[6.05029,46.23518],[6.04602,46.23127],[6.03342,46.2383],[6.02461,46.23313],[5.97542,46.21525],[5.96515,46.19638],[5.99573,46.18587],[5.98846,46.17046],[5.98188,46.17392],[5.97508,46.15863],[5.9641,46.14412],[5.95781,46.12925],[5.97893,46.13303],[5.9871,46.14499],[6.01791,46.14228],[6.03614,46.13712],[6.04564,46.14031],[6.05203,46.15191],[6.07491,46.14879],[6.09199,46.15191],[6.09926,46.14373],[6.13397,46.1406],[6.15305,46.15194],[6.18116,46.16187],[6.18871,46.16644],[6.18707,46.17999],[6.19552,46.18401],[6.19807,46.18369],[6.20539,46.19163],[6.21114,46.1927],[6.21273,46.19409],[6.21603,46.19507],[6.21844,46.19837],[6.22222,46.19888],[6.22175,46.20045],[6.23544,46.20714],[6.23913,46.20511],[6.24821,46.20531],[6.26007,46.21165],[6.27694,46.21566],[6.29663,46.22688],[6.31041,46.24417],[6.29474,46.26221],[6.26749,46.24745],[6.24952,46.26255],[6.23775,46.27822],[6.25137,46.29014],[6.24826,46.30175],[6.21981,46.31304],[6.25432,46.3632],[6.53358,46.45431],[6.82312,46.42661],[6.8024,46.39171],[6.77152,46.34784],[6.86052,46.28512],[6.78968,46.14058],[6.89321,46.12548],[6.87868,46.03855],[6.93862,46.06502],[7.00946,45.9944],[7.04151,45.92435],[7.10685,45.85653],[7.56343,45.97421],[7.85949,45.91485],[7.9049,45.99945],[7.98881,45.99867],[8.02906,46.10331],[8.11383,46.11577],[8.16866,46.17817],[8.08814,46.26692],[8.31162,46.38044],[8.30648,46.41587],[8.42464,46.46367],[8.46317,46.43712],[8.45032,46.26869],[8.62242,46.12112],[8.75697,46.10395],[8.80778,46.10085],[8.85617,46.0748],[8.79414,46.00913],[8.78585,45.98973],[8.79362,45.99207],[8.8319,45.9879],[8.85121,45.97239],[8.86688,45.96135],[8.88904,45.95465],[8.93649,45.86775],[8.94372,45.86587],[8.93504,45.86245],[8.91129,45.8388],[8.94737,45.84285],[8.9621,45.83707],[8.99663,45.83466],[9.00324,45.82055],[9.0298,45.82127],[9.03279,45.82865],[9.03793,45.83548],[9.03505,45.83976],[9.04059,45.8464],[9.04546,45.84968],[9.06642,45.8761],[9.09065,45.89906],[8.99257,45.9698],[9.01618,46.04928],[9.24503,46.23616],[9.29226,46.32717],[9.25502,46.43743],[9.28136,46.49685],[9.36128,46.5081],[9.40487,46.46621],[9.45936,46.50873],[9.46117,46.37481],[9.57015,46.2958],[9.71273,46.29266],[9.73086,46.35071],[9.95249,46.38045],[10.07055,46.21668],[10.14439,46.22992],[10.17862,46.25626],[10.10506,46.3372],[10.165,46.41051],[10.03715,46.44479],[10.10307,46.61003],[10.23674,46.63484],[10.25309,46.57432],[10.46136,46.53164],[10.49375,46.62049],[10.44686,46.64162],[10.40475,46.63671],[10.38659,46.67847],[10.47197,46.85698],[10.48376,46.93891],[10.36933,47.00212],[10.30031,46.92093],[10.24128,46.93147],[10.22675,46.86942],[10.10715,46.84296],[9.98058,46.91434],[9.88266,46.93343],[9.87935,47.01337],[9.60717,47.06091],[9.55721,47.04762],[9.54041,47.06495],[9.47548,47.05257],[9.47139,47.06402],[9.51362,47.08505],[9.52089,47.10019],[9.51044,47.13727],[9.48774,47.17402],[9.4891,47.19346],[9.50318,47.22153],[9.52406,47.24959],[9.53116,47.27029],[9.54773,47.2809],[9.55857,47.29919],[9.58513,47.31334],[9.59978,47.34671],[9.62476,47.36639],[9.65427,47.36824],[9.66243,47.37136],[9.6711,47.37824],[9.67445,47.38429],[9.67334,47.39191],[9.6629,47.39591],[9.65136,47.40504],[9.65043,47.41937],[9.6446,47.43233],[9.64483,47.43842],[9.65863,47.44847],[9.65728,47.45383],[9.6423,47.45599],[9.62475,47.45685],[9.62158,47.45858],[9.60841,47.47178],[9.60484,47.46358],[9.60205,47.46165],[9.59482,47.46305],[9.58208,47.48344],[9.56312,47.49495],[9.55125,47.53629],[9.25619,47.65939],[9.18203,47.65598],[9.17593,47.65399],[9.1755,47.65584],[9.1705,47.65513],[9.15181,47.66904],[9.13845,47.66389],[9.09891,47.67801],[9.02093,47.6868],[8.94093,47.65596],[8.89946,47.64769],[8.87625,47.65441],[8.87383,47.67045],[8.85065,47.68209],[8.86989,47.70504],[8.82002,47.71458],[8.80663,47.73821],[8.77309,47.72059],[8.76965,47.7075],[8.79966,47.70222],[8.79511,47.67462],[8.75856,47.68969],[8.72809,47.69282]],[[8.95861,45.96485],[8.96668,45.98436],[8.97741,45.98317],[8.97604,45.96151],[8.95861,45.96485]],[[8.70847,47.68904],[8.68985,47.69552],[8.66837,47.68437],[8.65769,47.68928],[8.67508,47.6979],[8.66416,47.71367],[8.70237,47.71453],[8.71773,47.69088],[8.70847,47.68904]]]]},properties:{iso1A2:"CH",iso1A3:"CHE",iso1N3:"756",wikidata:"Q39",nameEn:"Switzerland",groups:["155","150","UN"],callingCodes:["41"]}},{type:"Feature",properties:{iso1A2:"CI",iso1A3:"CIV",iso1N3:"384",wikidata:"Q1008",nameEn:"C\xF4te d'Ivoire",groups:["011","202","002","UN"],callingCodes:["225"]},geometry:{type:"MultiPolygon",coordinates:[[[[-7.52774,3.7105],[-3.34019,4.17519],[-3.10675,5.08515],[-3.11073,5.12675],[-3.063,5.13665],[-2.96554,5.10397],[-2.95261,5.12477],[-2.75502,5.10657],[-2.73074,5.1364],[-2.77625,5.34621],[-2.72737,5.34789],[-2.76614,5.60963],[-2.85378,5.65156],[-2.93132,5.62137],[-2.96671,5.6415],[-2.95323,5.71865],[-3.01896,5.71697],[-3.25999,6.62521],[-3.21954,6.74407],[-3.23327,6.81744],[-2.95438,7.23737],[-2.97822,7.27165],[-2.92339,7.60847],[-2.79467,7.86002],[-2.78395,7.94974],[-2.74819,7.92613],[-2.67787,8.02055],[-2.61232,8.02645],[-2.62901,8.11495],[-2.49037,8.20872],[-2.58243,8.7789],[-2.66357,9.01771],[-2.77799,9.04949],[-2.69814,9.22717],[-2.68802,9.49343],[-2.76494,9.40778],[-2.93012,9.57403],[-3.00765,9.74019],[-3.16609,9.85147],[-3.19306,9.93781],[-3.27228,9.84981],[-3.31779,9.91125],[-3.69703,9.94279],[-4.25999,9.76012],[-4.31392,9.60062],[-4.6426,9.70696],[-4.96621,9.89132],[-4.96453,9.99923],[-5.12465,10.29788],[-5.39602,10.2929],[-5.51058,10.43177],[-5.65135,10.46767],[-5.78124,10.43952],[-5.99478,10.19694],[-6.18851,10.24244],[-6.1731,10.46983],[-6.24795,10.74248],[-6.325,10.68624],[-6.40646,10.69922],[-6.42847,10.5694],[-6.52974,10.59104],[-6.63541,10.66893],[-6.68164,10.35074],[-6.93921,10.35291],[-7.01186,10.25111],[-6.97444,10.21644],[-7.00966,10.15794],[-7.0603,10.14711],[-7.13331,10.24877],[-7.3707,10.24677],[-7.44555,10.44602],[-7.52261,10.4655],[-7.54462,10.40921],[-7.63048,10.46334],[-7.92107,10.15577],[-7.97971,10.17117],[-8.01225,10.1021],[-8.11921,10.04577],[-8.15652,9.94288],[-8.09434,9.86936],[-8.14657,9.55062],[-8.03463,9.39604],[-7.85056,9.41812],[-7.90777,9.20456],[-7.73862,9.08422],[-7.92518,8.99332],[-7.95503,8.81146],[-7.69882,8.66148],[-7.65653,8.36873],[-7.92518,8.50652],[-8.22991,8.48438],[-8.2411,8.24196],[-8.062,8.16071],[-7.98675,8.20134],[-7.99919,8.11023],[-7.94695,8.00925],[-8.06449,8.04989],[-8.13414,7.87991],[-8.09931,7.78626],[-8.21374,7.54466],[-8.4003,7.6285],[-8.47114,7.55676],[-8.41935,7.51203],[-8.37458,7.25794],[-8.29249,7.1691],[-8.31736,6.82837],[-8.59456,6.50612],[-8.48652,6.43797],[-8.45666,6.49977],[-8.38453,6.35887],[-8.3298,6.36381],[-8.17557,6.28222],[-8.00642,6.31684],[-7.90692,6.27728],[-7.83478,6.20309],[-7.8497,6.08932],[-7.79747,6.07696],[-7.78254,5.99037],[-7.70294,5.90625],[-7.67309,5.94337],[-7.48155,5.80974],[-7.46165,5.84934],[-7.43677,5.84687],[-7.43926,5.74787],[-7.37209,5.61173],[-7.43428,5.42355],[-7.36463,5.32944],[-7.46165,5.26256],[-7.48901,5.14118],[-7.55369,5.08667],[-7.53876,4.94294],[-7.59349,4.8909],[-7.53259,4.35145],[-7.52774,3.7105]]]]}},{type:"Feature",properties:{iso1A2:"CK",iso1A3:"COK",iso1N3:"184",wikidata:"Q26988",nameEn:"Cook Islands",country:"NZ",groups:["061","009","UN"],driveSide:"left",callingCodes:["682"]},geometry:{type:"MultiPolygon",coordinates:[[[[-168.15106,-10.26955],[-156.45576,-31.75456],[-156.48634,-15.52824],[-156.50903,-7.4975],[-168.15106,-10.26955]]]]}},{type:"Feature",properties:{iso1A2:"CL",iso1A3:"CHL",iso1N3:"152",wikidata:"Q298",nameEn:"Chile",groups:["005","419","019","UN"],callingCodes:["56"]},geometry:{type:"MultiPolygon",coordinates:[[[[-68.60702,-52.65781],[-68.41683,-52.33516],[-69.97824,-52.00845],[-71.99889,-51.98018],[-72.33873,-51.59954],[-72.31343,-50.58411],[-73.15765,-50.78337],[-73.55259,-49.92488],[-73.45156,-49.79461],[-73.09655,-49.14342],[-72.56894,-48.81116],[-72.54042,-48.52392],[-72.27662,-48.28727],[-72.50478,-47.80586],[-71.94152,-47.13595],[-71.68577,-46.55385],[-71.75614,-45.61611],[-71.35687,-45.22075],[-72.06985,-44.81756],[-71.26418,-44.75684],[-71.16436,-44.46244],[-71.81318,-44.38097],[-71.64206,-43.64774],[-72.14828,-42.85321],[-72.15541,-42.15941],[-71.74901,-42.11711],[-71.92726,-40.72714],[-71.37826,-38.91474],[-70.89532,-38.6923],[-71.24279,-37.20264],[-70.95047,-36.4321],[-70.38008,-36.02375],[-70.49416,-35.24145],[-69.87386,-34.13344],[-69.88099,-33.34489],[-70.55832,-31.51559],[-70.14479,-30.36595],[-69.8596,-30.26131],[-69.99507,-29.28351],[-69.80969,-29.07185],[-69.66709,-28.44055],[-69.22504,-27.95042],[-68.77586,-27.16029],[-68.43363,-27.08414],[-68.27677,-26.90626],[-68.59048,-26.49861],[-68.56909,-26.28146],[-68.38372,-26.15353],[-68.57622,-25.32505],[-68.38372,-25.08636],[-68.56909,-24.69831],[-68.24825,-24.42596],[-67.33563,-24.04237],[-66.99632,-22.99839],[-67.18382,-22.81525],[-67.54284,-22.89771],[-67.85114,-22.87076],[-68.18816,-21.28614],[-68.40403,-20.94562],[-68.53957,-20.91542],[-68.55383,-20.7355],[-68.44023,-20.62701],[-68.7276,-20.46178],[-68.74273,-20.08817],[-68.57132,-20.03134],[-68.54611,-19.84651],[-68.66761,-19.72118],[-68.41218,-19.40499],[-68.61989,-19.27584],[-68.80602,-19.08355],[-68.87082,-19.06003],[-68.94987,-18.93302],[-69.07432,-18.28259],[-69.14807,-18.16893],[-69.07496,-18.03715],[-69.28671,-17.94844],[-69.34126,-17.72753],[-69.46623,-17.60518],[-69.46897,-17.4988],[-69.66483,-17.65083],[-69.79087,-17.65563],[-69.82868,-17.72048],[-69.75305,-17.94605],[-69.81607,-18.12582],[-69.96732,-18.25992],[-70.16394,-18.31737],[-70.31267,-18.31258],[-70.378,-18.3495],[-70.59118,-18.35072],[-113.52687,-26.52828],[-68.11646,-58.14883],[-66.07313,-55.19618],[-67.11046,-54.94199],[-67.46182,-54.92205],[-68.01394,-54.8753],[-68.60733,-54.9125],[-68.60702,-52.65781]]]]}},{type:"Feature",properties:{iso1A2:"CM",iso1A3:"CMR",iso1N3:"120",wikidata:"Q1009",nameEn:"Cameroon",groups:["017","202","002","UN"],callingCodes:["237"]},geometry:{type:"MultiPolygon",coordinates:[[[[14.83314,12.62963],[14.55058,12.78256],[14.56101,12.91036],[14.46881,13.08259],[14.08251,13.0797],[14.20204,12.53405],[14.17523,12.41916],[14.22215,12.36533],[14.4843,12.35223],[14.6474,12.17466],[14.61612,11.7798],[14.55207,11.72001],[14.64591,11.66166],[14.6124,11.51283],[14.17821,11.23831],[13.97489,11.30258],[13.78945,11.00154],[13.7403,11.00593],[13.70753,10.94451],[13.73434,10.9255],[13.54964,10.61236],[13.5705,10.53183],[13.43644,10.13326],[13.34111,10.12299],[13.25025,10.03647],[13.25323,10.00127],[13.286,9.9822],[13.27409,9.93232],[13.24132,9.91031],[13.25025,9.86042],[13.29941,9.8296],[13.25472,9.76795],[13.22642,9.57266],[13.02385,9.49334],[12.85628,9.36698],[12.91958,9.33905],[12.90022,9.11411],[12.81085,8.91992],[12.79,8.75361],[12.71701,8.7595],[12.68722,8.65938],[12.44146,8.6152],[12.4489,8.52536],[12.26123,8.43696],[12.24782,8.17904],[12.19271,8.10826],[12.20909,7.97553],[11.99908,7.67302],[12.01844,7.52981],[11.93205,7.47812],[11.84864,7.26098],[11.87396,7.09398],[11.63117,6.9905],[11.55818,6.86186],[11.57755,6.74059],[11.51499,6.60892],[11.42264,6.5882],[11.42041,6.53789],[11.09495,6.51717],[11.09644,6.68437],[10.94302,6.69325],[10.8179,6.83377],[10.83727,6.9358],[10.60789,7.06885],[10.59746,7.14719],[10.57214,7.16345],[10.53639,6.93432],[10.21466,6.88996],[10.15135,7.03781],[9.86314,6.77756],[9.77824,6.79088],[9.70674,6.51717],[9.51757,6.43874],[8.84209,5.82562],[8.88156,5.78857],[8.83687,5.68483],[8.92029,5.58403],[8.78027,5.1243],[8.60302,4.87353],[8.34397,4.30689],[9.22018,3.72052],[9.81162,2.33797],[9.82123,2.35097],[9.83754,2.32428],[9.83238,2.29079],[9.84716,2.24676],[9.89012,2.20457],[9.90749,2.20049],[9.991,2.16561],[11.3561,2.17217],[11.37116,2.29975],[13.28534,2.25716],[13.29457,2.16106],[14.61145,2.17866],[15.00996,1.98887],[15.22634,2.03243],[15.34776,1.91264],[15.48942,1.98265],[16.02959,1.76483],[16.02647,1.65591],[16.14634,1.70259],[16.05294,1.9811],[16.08563,2.19733],[16.15568,2.18955],[16.19357,2.21537],[16.08252,2.45708],[16.05449,3.02306],[15.77725,3.26835],[15.73522,3.24348],[15.07686,4.01805],[15.17482,4.05131],[15.10644,4.1362],[15.08609,4.30282],[15.00825,4.41458],[14.73383,4.6135],[14.65489,5.21343],[14.57083,5.23979],[14.52724,5.28319],[14.62531,5.51411],[14.58951,5.59777],[14.62375,5.70466],[14.60974,5.91838],[14.49455,5.91683],[14.42917,6.00508],[14.43073,6.08867],[14.56149,6.18928],[14.74206,6.26356],[14.80122,6.34866],[14.79966,6.39043],[14.96311,6.75693],[15.04717,6.77085],[15.23397,7.25135],[15.49743,7.52179],[15.56964,7.58936],[15.59272,7.7696],[15.50743,7.79302],[15.20426,8.50892],[15.09484,8.65982],[14.83566,8.80557],[14.35707,9.19611],[14.37094,9.2954],[13.97544,9.6365],[14.01793,9.73169],[14.1317,9.82413],[14.20411,10.00055],[14.4673,10.00264],[14.80082,9.93818],[14.95722,9.97926],[15.05999,9.94845],[15.14043,9.99246],[15.24618,9.99246],[15.41408,9.92876],[15.68761,9.99344],[15.50535,10.1098],[15.30874,10.31063],[15.23724,10.47764],[15.14936,10.53915],[15.15532,10.62846],[15.06737,10.80921],[15.09127,10.87431],[15.04957,11.02347],[15.10021,11.04101],[15.0585,11.40481],[15.13149,11.5537],[15.06595,11.71126],[15.11579,11.79313],[15.04808,11.8731],[15.05786,12.0608],[15.0349,12.10698],[15.00146,12.1223],[14.96952,12.0925],[14.89019,12.16593],[14.90827,12.3269],[14.83314,12.62963]]]]}},{type:"Feature",properties:{iso1A2:"CN",iso1A3:"CHN",iso1N3:"156",wikidata:"Q148",nameEn:"People's Republic of China"},geometry:null},{type:"Feature",properties:{iso1A2:"CO",iso1A3:"COL",iso1N3:"170",wikidata:"Q739",nameEn:"Colombia",groups:["005","419","019","UN"],callingCodes:["57"]},geometry:{type:"MultiPolygon",coordinates:[[[[-71.19849,12.65801],[-81.58685,18.0025],[-82.06974,14.49418],[-82.56142,11.91792],[-78.79327,9.93766],[-77.58292,9.22278],[-77.32389,8.81247],[-77.45064,8.49991],[-77.17257,7.97422],[-77.57185,7.51147],[-77.72514,7.72348],[-77.72157,7.47612],[-77.81426,7.48319],[-77.89178,7.22681],[-78.06168,7.07793],[-82.12561,4.00341],[-78.87137,1.47457],[-78.42749,1.15389],[-77.85677,.80197],[-77.7148,.85003],[-77.68613,.83029],[-77.66416,.81604],[-77.67815,.73863],[-77.49984,.64476],[-77.52001,.40782],[-76.89177,.24736],[-76.4094,.24015],[-76.41215,.38228],[-76.23441,.42294],[-75.82927,.09578],[-75.25764,-.11943],[-75.18513,-.0308],[-74.42701,-.50218],[-74.26675,-.97229],[-73.65312,-1.26222],[-72.92587,-2.44514],[-71.75223,-2.15058],[-70.94377,-2.23142],[-70.04609,-2.73906],[-70.71396,-3.7921],[-70.52393,-3.87553],[-70.3374,-3.79505],[-69.94708,-4.2431],[-69.43395,-1.42219],[-69.4215,-1.01853],[-69.59796,-.75136],[-69.603,-.51947],[-70.03658,-.19681],[-70.04162,.55437],[-69.47696,.71065],[-69.20976,.57958],[-69.14422,.84172],[-69.26017,1.06856],[-69.82987,1.07864],[-69.83491,1.69353],[-69.53746,1.76408],[-69.38621,1.70865],[-68.18128,1.72881],[-68.26699,1.83463],[-68.18632,2.00091],[-67.9292,1.82455],[-67.40488,2.22258],[-67.299,1.87494],[-67.15784,1.80439],[-67.08222,1.17441],[-66.85795,1.22998],[-67.21967,2.35778],[-67.65696,2.81691],[-67.85862,2.79173],[-67.85862,2.86727],[-67.30945,3.38393],[-67.50067,3.75812],[-67.62671,3.74303],[-67.85358,4.53249],[-67.83341,5.31104],[-67.59141,5.5369],[-67.63914,5.64963],[-67.58558,5.84537],[-67.43513,5.98835],[-67.4625,6.20625],[-67.60654,6.2891],[-69.41843,6.1072],[-70.10716,6.96516],[-70.7596,7.09799],[-71.03941,6.98163],[-71.37234,7.01588],[-71.42212,7.03854],[-71.44118,7.02116],[-71.82441,7.04314],[-72.04895,7.03837],[-72.19437,7.37034],[-72.43132,7.40034],[-72.47415,7.48928],[-72.45321,7.57232],[-72.47827,7.65604],[-72.46763,7.79518],[-72.44454,7.86031],[-72.46183,7.90682],[-72.45806,7.91141],[-72.47042,7.92306],[-72.48183,7.92909],[-72.48801,7.94329],[-72.47213,7.96106],[-72.39137,8.03534],[-72.35163,8.01163],[-72.36987,8.19976],[-72.4042,8.36513],[-72.65474,8.61428],[-72.77415,9.10165],[-72.94052,9.10663],[-73.02119,9.27584],[-73.36905,9.16636],[-72.98085,9.85253],[-72.88002,10.44309],[-72.4767,11.1117],[-72.24983,11.14138],[-71.9675,11.65536],[-71.3275,11.85],[-70.92579,11.96275],[-71.19849,12.65801]]]]}},{type:"Feature",properties:{iso1A2:"CP",iso1A3:"CPT",wikidata:"Q161258",nameEn:"Clipperton Island",country:"FR",groups:["EU","013","003","019","UN"],isoStatus:"excRes"},geometry:{type:"MultiPolygon",coordinates:[[[[-110.36279,9.79626],[-108.755,9.84085],[-109.04145,11.13245],[-110.36279,9.79626]]]]}},{type:"Feature",properties:{iso1A2:"CR",iso1A3:"CRI",iso1N3:"188",wikidata:"Q800",nameEn:"Costa Rica",groups:["013","003","419","019","UN"],callingCodes:["506"]},geometry:{type:"MultiPolygon",coordinates:[[[[-83.68276,11.01562],[-83.66597,10.79916],[-83.90838,10.71161],[-84.68197,11.07568],[-84.92439,10.9497],[-85.60529,11.22607],[-85.71223,11.06868],[-86.14524,11.09059],[-87.41779,5.02401],[-82.94503,7.93865],[-82.89978,8.04083],[-82.89137,8.05755],[-82.88641,8.10219],[-82.9388,8.26634],[-83.05209,8.33394],[-82.93056,8.43465],[-82.8679,8.44042],[-82.8382,8.48117],[-82.83322,8.52464],[-82.83975,8.54755],[-82.82739,8.60153],[-82.8794,8.6981],[-82.92068,8.74832],[-82.91377,8.774],[-82.88253,8.83331],[-82.72126,8.97125],[-82.93516,9.07687],[-82.93516,9.46741],[-82.84871,9.4973],[-82.87919,9.62645],[-82.77206,9.59573],[-82.66667,9.49746],[-82.61345,9.49881],[-82.56507,9.57279],[-82.51044,9.65379],[-83.54024,10.96805],[-83.68276,11.01562]]]]}},{type:"Feature",properties:{iso1A2:"CU",iso1A3:"CUB",iso1N3:"192",wikidata:"Q241",nameEn:"Cuba",groups:["029","003","419","019","UN"],callingCodes:["53"]},geometry:{type:"MultiPolygon",coordinates:[[[[-73.62304,20.6935],[-82.02215,24.23074],[-85.77883,21.92705],[-74.81171,18.82201],[-73.62304,20.6935]]]]}},{type:"Feature",properties:{iso1A2:"CV",iso1A3:"CPV",iso1N3:"132",wikidata:"Q1011",nameEn:"Cape Verde",groups:["Q105472","011","202","002","UN"],callingCodes:["238"]},geometry:{type:"MultiPolygon",coordinates:[[[[-28.81604,14.57305],[-20.39702,14.12816],[-23.37101,19.134],[-28.81604,14.57305]]]]}},{type:"Feature",properties:{iso1A2:"CW",iso1A3:"CUW",iso1N3:"531",wikidata:"Q25279",nameEn:"Cura\xE7ao",aliases:["NL-CW"],country:"NL",groups:["Q1451600","029","003","419","019","UN"],callingCodes:["599"]},geometry:{type:"MultiPolygon",coordinates:[[[[-68.90012,12.62309],[-69.59009,12.46019],[-68.99639,11.79035],[-68.33524,11.78151],[-68.90012,12.62309]]]]}},{type:"Feature",properties:{iso1A2:"CX",iso1A3:"CXR",iso1N3:"162",wikidata:"Q31063",nameEn:"Christmas Island",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[105.66835,-9.31927],[104.67494,-11.2566],[106.66176,-11.14349],[105.66835,-9.31927]]]]}},{type:"Feature",properties:{iso1A2:"CY",iso1A3:"CYP",iso1N3:"196",wikidata:"Q229",nameEn:"Republic of Cyprus",groups:["Q644636","EU","145","142","UN"],driveSide:"left",callingCodes:["357"]},geometry:{type:"MultiPolygon",coordinates:[[[[32.46489,35.48584],[30.15137,34.08517],[32.74412,34.43926],[32.75515,34.64985],[32.76136,34.68318],[32.79433,34.67883],[32.82717,34.70622],[32.86014,34.70585],[32.86167,34.68734],[32.9068,34.66102],[32.91398,34.67343],[32.93043,34.67091],[32.92807,34.66736],[32.93449,34.66241],[32.93693,34.67027],[32.94379,34.67111],[32.94683,34.67907],[32.95539,34.68471],[32.99135,34.68061],[32.98668,34.67268],[32.99014,34.65518],[32.97736,34.65277],[32.97079,34.66112],[32.95325,34.66462],[32.94796,34.6587],[32.94976,34.65204],[32.95471,34.64528],[32.95323,34.64075],[32.95891,34.62919],[32.96718,34.63446],[32.96968,34.64046],[33.0138,34.64424],[33.26744,34.49942],[33.83531,34.73974],[33.70575,34.97947],[33.70639,34.99303],[33.71514,35.00294],[33.69731,35.01754],[33.69938,35.03123],[33.67678,35.03866],[33.63765,35.03869],[33.61215,35.0527],[33.59658,35.03635],[33.567,35.04803],[33.57478,35.06049],[33.53975,35.08151],[33.48915,35.06594],[33.47666,35.00701],[33.45256,35.00288],[33.45178,35.02078],[33.47825,35.04103],[33.48136,35.0636],[33.46813,35.10564],[33.41675,35.16325],[33.4076,35.20062],[33.38575,35.2018],[33.37248,35.18698],[33.3717,35.1788],[33.36569,35.17479],[33.35612,35.17402],[33.35596,35.17942],[33.34964,35.17803],[33.35056,35.18328],[33.31955,35.18096],[33.3072,35.16816],[33.27068,35.16815],[33.15138,35.19504],[33.11105,35.15639],[33.08249,35.17319],[33.01192,35.15639],[32.94471,35.09422],[32.86406,35.1043],[32.85733,35.07742],[32.70779,35.14127],[32.70947,35.18328],[32.64864,35.19967],[32.60361,35.16647],[32.46489,35.48584]]],[[[33.74144,35.01053],[33.7492,35.01319],[33.74983,35.02274],[33.74265,35.02329],[33.73781,35.02181],[33.7343,35.01178],[33.74144,35.01053]]],[[[33.77312,34.9976],[33.75994,35.00113],[33.75682,34.99916],[33.76605,34.99543],[33.76738,34.99188],[33.7778,34.98981],[33.77843,34.988],[33.78149,34.98854],[33.78318,34.98699],[33.78571,34.98951],[33.78917,34.98854],[33.79191,34.98914],[33.78516,34.99582],[33.77553,34.99518],[33.77312,34.9976]]]]}},{type:"Feature",properties:{iso1A2:"CZ",iso1A3:"CZE",iso1N3:"203",wikidata:"Q213",nameEn:"Czechia",groups:["EU","151","150","UN"],callingCodes:["420"]},geometry:{type:"MultiPolygon",coordinates:[[[[14.82803,50.86966],[14.79139,50.81438],[14.70661,50.84096],[14.61993,50.86049],[14.63434,50.8883],[14.65259,50.90513],[14.64802,50.93241],[14.58024,50.91443],[14.56374,50.922],[14.59702,50.96148],[14.59908,50.98685],[14.58215,50.99306],[14.56432,51.01008],[14.53438,51.00374],[14.53321,51.01679],[14.49873,51.02242],[14.50809,51.0427],[14.49991,51.04692],[14.49154,51.04382],[14.49202,51.02286],[14.45827,51.03712],[14.41335,51.02086],[14.30098,51.05515],[14.25665,50.98935],[14.28776,50.97718],[14.32353,50.98556],[14.32793,50.97379],[14.30251,50.96606],[14.31422,50.95243],[14.39848,50.93866],[14.38691,50.89907],[14.30098,50.88448],[14.27123,50.89386],[14.24314,50.88761],[14.22331,50.86049],[14.02982,50.80662],[13.98864,50.8177],[13.89113,50.78533],[13.89444,50.74142],[13.82942,50.7251],[13.76316,50.73487],[13.70204,50.71771],[13.65977,50.73096],[13.52474,50.70394],[13.53748,50.67654],[13.5226,50.64721],[13.49742,50.63133],[13.46413,50.60102],[13.42189,50.61243],[13.37485,50.64931],[13.37805,50.627],[13.32264,50.60317],[13.32594,50.58009],[13.29454,50.57904],[13.25158,50.59268],[13.19043,50.50237],[13.13424,50.51709],[13.08301,50.50132],[13.0312,50.50944],[13.02038,50.4734],[13.02147,50.44763],[12.98433,50.42016],[12.94058,50.40944],[12.82465,50.45738],[12.73476,50.43237],[12.73044,50.42268],[12.70731,50.39948],[12.67261,50.41949],[12.51356,50.39694],[12.48747,50.37278],[12.49214,50.35228],[12.48256,50.34784],[12.46643,50.35527],[12.43722,50.33774],[12.43371,50.32506],[12.39924,50.32302],[12.40158,50.29521],[12.36594,50.28289],[12.35425,50.23993],[12.33263,50.24367],[12.32445,50.20442],[12.33847,50.19432],[12.32596,50.17146],[12.29232,50.17524],[12.28063,50.19544],[12.28755,50.22429],[12.23943,50.24594],[12.24791,50.25525],[12.26953,50.25189],[12.25119,50.27079],[12.20823,50.2729],[12.18013,50.32146],[12.10907,50.32041],[12.13716,50.27396],[12.09287,50.25032],[12.19335,50.19997],[12.21484,50.16399],[12.1917,50.13434],[12.2073,50.10315],[12.23709,50.10213],[12.27433,50.0771],[12.26111,50.06331],[12.30798,50.05719],[12.49908,49.97305],[12.47264,49.94222],[12.55197,49.92094],[12.48256,49.83575],[12.46603,49.78882],[12.40489,49.76321],[12.4462,49.70233],[12.52553,49.68415],[12.53544,49.61888],[12.56188,49.6146],[12.60155,49.52887],[12.64782,49.52565],[12.64121,49.47628],[12.669,49.42935],[12.71227,49.42363],[12.75854,49.3989],[12.78168,49.34618],[12.88414,49.33541],[12.88249,49.35479],[12.94859,49.34079],[13.03618,49.30417],[13.02957,49.27399],[13.05883,49.26259],[13.17665,49.16713],[13.17019,49.14339],[13.20405,49.12303],[13.23689,49.11412],[13.28242,49.1228],[13.39479,49.04812],[13.40802,48.98851],[13.50221,48.93752],[13.50552,48.97441],[13.58319,48.96899],[13.61624,48.9462],[13.67739,48.87886],[13.73854,48.88538],[13.76994,48.83537],[13.78977,48.83319],[13.8096,48.77877],[13.84023,48.76988],[14.06151,48.66873],[14.01482,48.63788],[14.09104,48.5943],[14.20691,48.5898],[14.33909,48.55852],[14.43076,48.58855],[14.4587,48.64695],[14.56139,48.60429],[14.60808,48.62881],[14.66762,48.58215],[14.71794,48.59794],[14.72756,48.69502],[14.80584,48.73489],[14.80821,48.77711],[14.81545,48.7874],[14.94773,48.76268],[14.95641,48.75915],[14.9758,48.76857],[14.98112,48.77524],[14.9782,48.7766],[14.98032,48.77959],[14.95072,48.79101],[14.98917,48.90082],[14.97612,48.96983],[14.99878,49.01444],[15.15534,48.99056],[15.16358,48.94278],[15.26177,48.95766],[15.28305,48.98831],[15.34823,48.98444],[15.48027,48.94481],[15.51357,48.91549],[15.61622,48.89541],[15.6921,48.85973],[15.75341,48.8516],[15.78087,48.87644],[15.84404,48.86921],[16.06034,48.75436],[16.37345,48.729],[16.40915,48.74576],[16.46134,48.80865],[16.67008,48.77699],[16.68518,48.7281],[16.71883,48.73806],[16.79779,48.70998],[16.90354,48.71541],[16.93955,48.60371],[17.00215,48.70887],[17.11202,48.82925],[17.19355,48.87602],[17.29054,48.85546],[17.3853,48.80936],[17.45671,48.85004],[17.5295,48.81117],[17.7094,48.86721],[17.73126,48.87885],[17.77944,48.92318],[17.87831,48.92679],[17.91814,49.01784],[18.06885,49.03157],[18.1104,49.08624],[18.15022,49.24518],[18.18456,49.28909],[18.36446,49.3267],[18.4139,49.36517],[18.4084,49.40003],[18.44686,49.39467],[18.54848,49.47059],[18.53063,49.49022],[18.57183,49.51162],[18.6144,49.49824],[18.67757,49.50895],[18.74761,49.492],[18.84521,49.51672],[18.84786,49.5446],[18.80479,49.6815],[18.72838,49.68163],[18.69817,49.70473],[18.62676,49.71983],[18.62943,49.74603],[18.62645,49.75002],[18.61368,49.75426],[18.61278,49.7618],[18.57183,49.83334],[18.60341,49.86256],[18.57045,49.87849],[18.57697,49.91565],[18.54299,49.92537],[18.54495,49.9079],[18.53423,49.89906],[18.41604,49.93498],[18.33562,49.94747],[18.33278,49.92415],[18.31914,49.91565],[18.27794,49.93863],[18.27107,49.96779],[18.21752,49.97309],[18.20241,49.99958],[18.10628,50.00223],[18.07898,50.04535],[18.03212,50.06574],[18.00396,50.04954],[18.04585,50.03311],[18.04585,50.01194],[18.00191,50.01723],[17.86886,49.97452],[17.77669,50.02253],[17.7506,50.07896],[17.6888,50.12037],[17.66683,50.10275],[17.59404,50.16437],[17.70528,50.18812],[17.76296,50.23382],[17.72176,50.25665],[17.74648,50.29966],[17.69292,50.32859],[17.67764,50.28977],[17.58889,50.27837],[17.3702,50.28123],[17.34548,50.2628],[17.34273,50.32947],[17.27681,50.32246],[17.19991,50.3654],[17.19579,50.38817],[17.14498,50.38117],[17.1224,50.39494],[16.89229,50.45117],[16.85933,50.41093],[16.90877,50.38642],[16.94448,50.31281],[16.99803,50.30316],[17.02138,50.27772],[16.99803,50.25753],[17.02825,50.23118],[17.00353,50.21449],[16.98018,50.24172],[16.8456,50.20834],[16.7014,50.09659],[16.63137,50.1142],[16.55446,50.16613],[16.56407,50.21009],[16.42674,50.32509],[16.39379,50.3207],[16.3622,50.34875],[16.36495,50.37679],[16.30289,50.38292],[16.28118,50.36891],[16.22821,50.41054],[16.21585,50.40627],[16.19526,50.43291],[16.31413,50.50274],[16.34572,50.49575],[16.44597,50.58041],[16.33611,50.66579],[16.23174,50.67101],[16.20839,50.63096],[16.10265,50.66405],[16.02437,50.60046],[15.98317,50.61528],[16.0175,50.63009],[15.97219,50.69799],[15.87331,50.67188],[15.81683,50.75666],[15.73186,50.73885],[15.43798,50.80833],[15.3803,50.77187],[15.36656,50.83956],[15.2773,50.8907],[15.27043,50.97724],[15.2361,50.99886],[15.1743,50.9833],[15.16744,51.01959],[15.11937,50.99021],[15.10152,51.01095],[15.06218,51.02269],[15.03895,51.0123],[15.02433,51.0242],[14.96419,50.99108],[15.01088,50.97984],[14.99852,50.86817],[14.82803,50.86966]]]]}},{type:"Feature",properties:{iso1A2:"DE",iso1A3:"DEU",iso1N3:"276",wikidata:"Q183",nameEn:"Germany",groups:["EU","155","150","UN"],callingCodes:["49"]},geometry:{type:"MultiPolygon",coordinates:[[[[8.70847,47.68904],[8.71773,47.69088],[8.70237,47.71453],[8.66416,47.71367],[8.67508,47.6979],[8.65769,47.68928],[8.66837,47.68437],[8.68985,47.69552],[8.70847,47.68904]]],[[[8.72617,47.69651],[8.72809,47.69282],[8.75856,47.68969],[8.79511,47.67462],[8.79966,47.70222],[8.76965,47.7075],[8.77309,47.72059],[8.80663,47.73821],[8.82002,47.71458],[8.86989,47.70504],[8.85065,47.68209],[8.87383,47.67045],[8.87625,47.65441],[8.89946,47.64769],[8.94093,47.65596],[9.02093,47.6868],[9.09891,47.67801],[9.13845,47.66389],[9.15181,47.66904],[9.1705,47.65513],[9.1755,47.65584],[9.17593,47.65399],[9.18203,47.65598],[9.25619,47.65939],[9.55125,47.53629],[9.72736,47.53457],[9.76748,47.5934],[9.80254,47.59419],[9.82591,47.58158],[9.8189,47.54688],[9.87499,47.52953],[9.87733,47.54688],[9.92407,47.53111],[9.96029,47.53899],[10.00003,47.48216],[10.03859,47.48927],[10.07131,47.45531],[10.09001,47.46005],[10.1052,47.4316],[10.06897,47.40709],[10.09819,47.35724],[10.11805,47.37228],[10.16362,47.36674],[10.17648,47.38889],[10.2127,47.38019],[10.22774,47.38904],[10.23757,47.37609],[10.19998,47.32832],[10.2147,47.31014],[10.17648,47.29149],[10.17531,47.27167],[10.23257,47.27088],[10.33424,47.30813],[10.39851,47.37623],[10.4324,47.38494],[10.4359,47.41183],[10.47446,47.43318],[10.46278,47.47901],[10.44291,47.48453],[10.4324,47.50111],[10.44992,47.5524],[10.43473,47.58394],[10.47329,47.58552],[10.48849,47.54057],[10.56912,47.53584],[10.60337,47.56755],[10.63456,47.5591],[10.68832,47.55752],[10.6965,47.54253],[10.7596,47.53228],[10.77596,47.51729],[10.88814,47.53701],[10.91268,47.51334],[10.86945,47.5015],[10.87061,47.4786],[10.90918,47.48571],[10.93839,47.48018],[10.92437,47.46991],[10.98513,47.42882],[10.97111,47.41617],[10.97111,47.39561],[11.11835,47.39719],[11.12536,47.41222],[11.20482,47.43198],[11.25157,47.43277],[11.22002,47.3964],[11.27844,47.39956],[11.29597,47.42566],[11.33804,47.44937],[11.4175,47.44621],[11.38128,47.47465],[11.4362,47.51413],[11.52618,47.50939],[11.58578,47.52281],[11.58811,47.55515],[11.60681,47.57881],[11.63934,47.59202],[11.84052,47.58354],[11.85572,47.60166],[12.0088,47.62451],[12.02282,47.61033],[12.05788,47.61742],[12.13734,47.60639],[12.17824,47.61506],[12.18145,47.61019],[12.17737,47.60121],[12.18568,47.6049],[12.20398,47.60667],[12.20801,47.61082],[12.19895,47.64085],[12.18507,47.65984],[12.18347,47.66663],[12.16769,47.68167],[12.16217,47.70105],[12.18303,47.70065],[12.22571,47.71776],[12.2542,47.7433],[12.26238,47.73544],[12.24017,47.69534],[12.26004,47.67725],[12.27991,47.68827],[12.336,47.69534],[12.37222,47.68433],[12.43883,47.6977],[12.44117,47.6741],[12.50076,47.62293],[12.53816,47.63553],[12.57438,47.63238],[12.6071,47.6741],[12.7357,47.6787],[12.77777,47.66689],[12.76492,47.64485],[12.82101,47.61493],[12.77427,47.58025],[12.80699,47.54477],[12.84672,47.54556],[12.85256,47.52741],[12.9624,47.47452],[12.98344,47.48716],[12.9998,47.46267],[13.04537,47.49426],[13.03252,47.53373],[13.05355,47.56291],[13.04537,47.58183],[13.06641,47.58577],[13.06407,47.60075],[13.09562,47.63304],[13.07692,47.68814],[13.01382,47.72116],[12.98578,47.7078],[12.92969,47.71094],[12.91333,47.7178],[12.90274,47.72513],[12.91711,47.74026],[12.9353,47.74788],[12.94371,47.76281],[12.93202,47.77302],[12.96311,47.79957],[12.98543,47.82896],[13.00588,47.84374],[12.94163,47.92927],[12.93886,47.94046],[12.93642,47.94436],[12.93419,47.94063],[12.92668,47.93879],[12.91985,47.94069],[12.9211,47.95135],[12.91683,47.95647],[12.87476,47.96195],[12.8549,48.01122],[12.76141,48.07373],[12.74973,48.10885],[12.7617,48.12796],[12.78595,48.12445],[12.80676,48.14979],[12.82673,48.15245],[12.8362,48.15876],[12.836,48.1647],[12.84475,48.16556],[12.87126,48.20318],[12.95306,48.20629],[13.02083,48.25689],[13.0851,48.27711],[13.126,48.27867],[13.18093,48.29577],[13.26039,48.29422],[13.30897,48.31575],[13.40709,48.37292],[13.43929,48.43386],[13.42527,48.45711],[13.45727,48.51092],[13.43695,48.55776],[13.45214,48.56472],[13.46967,48.55157],[13.50663,48.57506],[13.50131,48.58091],[13.51291,48.59023],[13.57535,48.55912],[13.59705,48.57013],[13.62508,48.55501],[13.65186,48.55092],[13.66113,48.53558],[13.72802,48.51208],[13.74816,48.53058],[13.7513,48.5624],[13.76921,48.55324],[13.80519,48.58026],[13.80038,48.59487],[13.82609,48.62345],[13.81901,48.6761],[13.81283,48.68426],[13.81791,48.69832],[13.79337,48.71375],[13.81863,48.73257],[13.82266,48.75544],[13.84023,48.76988],[13.8096,48.77877],[13.78977,48.83319],[13.76994,48.83537],[13.73854,48.88538],[13.67739,48.87886],[13.61624,48.9462],[13.58319,48.96899],[13.50552,48.97441],[13.50221,48.93752],[13.40802,48.98851],[13.39479,49.04812],[13.28242,49.1228],[13.23689,49.11412],[13.20405,49.12303],[13.17019,49.14339],[13.17665,49.16713],[13.05883,49.26259],[13.02957,49.27399],[13.03618,49.30417],[12.94859,49.34079],[12.88249,49.35479],[12.88414,49.33541],[12.78168,49.34618],[12.75854,49.3989],[12.71227,49.42363],[12.669,49.42935],[12.64121,49.47628],[12.64782,49.52565],[12.60155,49.52887],[12.56188,49.6146],[12.53544,49.61888],[12.52553,49.68415],[12.4462,49.70233],[12.40489,49.76321],[12.46603,49.78882],[12.48256,49.83575],[12.55197,49.92094],[12.47264,49.94222],[12.49908,49.97305],[12.30798,50.05719],[12.26111,50.06331],[12.27433,50.0771],[12.23709,50.10213],[12.2073,50.10315],[12.1917,50.13434],[12.21484,50.16399],[12.19335,50.19997],[12.09287,50.25032],[12.13716,50.27396],[12.10907,50.32041],[12.18013,50.32146],[12.20823,50.2729],[12.25119,50.27079],[12.26953,50.25189],[12.24791,50.25525],[12.23943,50.24594],[12.28755,50.22429],[12.28063,50.19544],[12.29232,50.17524],[12.32596,50.17146],[12.33847,50.19432],[12.32445,50.20442],[12.33263,50.24367],[12.35425,50.23993],[12.36594,50.28289],[12.40158,50.29521],[12.39924,50.32302],[12.43371,50.32506],[12.43722,50.33774],[12.46643,50.35527],[12.48256,50.34784],[12.49214,50.35228],[12.48747,50.37278],[12.51356,50.39694],[12.67261,50.41949],[12.70731,50.39948],[12.73044,50.42268],[12.73476,50.43237],[12.82465,50.45738],[12.94058,50.40944],[12.98433,50.42016],[13.02147,50.44763],[13.02038,50.4734],[13.0312,50.50944],[13.08301,50.50132],[13.13424,50.51709],[13.19043,50.50237],[13.25158,50.59268],[13.29454,50.57904],[13.32594,50.58009],[13.32264,50.60317],[13.37805,50.627],[13.37485,50.64931],[13.42189,50.61243],[13.46413,50.60102],[13.49742,50.63133],[13.5226,50.64721],[13.53748,50.67654],[13.52474,50.70394],[13.65977,50.73096],[13.70204,50.71771],[13.76316,50.73487],[13.82942,50.7251],[13.89444,50.74142],[13.89113,50.78533],[13.98864,50.8177],[14.02982,50.80662],[14.22331,50.86049],[14.24314,50.88761],[14.27123,50.89386],[14.30098,50.88448],[14.38691,50.89907],[14.39848,50.93866],[14.31422,50.95243],[14.30251,50.96606],[14.32793,50.97379],[14.32353,50.98556],[14.28776,50.97718],[14.25665,50.98935],[14.30098,51.05515],[14.41335,51.02086],[14.45827,51.03712],[14.49202,51.02286],[14.49154,51.04382],[14.49991,51.04692],[14.50809,51.0427],[14.49873,51.02242],[14.53321,51.01679],[14.53438,51.00374],[14.56432,51.01008],[14.58215,50.99306],[14.59908,50.98685],[14.59702,50.96148],[14.56374,50.922],[14.58024,50.91443],[14.64802,50.93241],[14.65259,50.90513],[14.63434,50.8883],[14.61993,50.86049],[14.70661,50.84096],[14.79139,50.81438],[14.82803,50.86966],[14.81664,50.88148],[14.89681,50.9422],[14.89252,50.94999],[14.92942,50.99744],[14.95529,51.04552],[14.97938,51.07742],[14.98229,51.11354],[14.99689,51.12205],[14.99079,51.14284],[14.99646,51.14365],[15.00083,51.14974],[14.99414,51.15813],[14.99311,51.16249],[15.0047,51.16874],[15.01242,51.21285],[15.04288,51.28387],[14.98008,51.33449],[14.96899,51.38367],[14.9652,51.44793],[14.94749,51.47155],[14.73219,51.52922],[14.72652,51.53902],[14.73047,51.54606],[14.71125,51.56209],[14.7727,51.61263],[14.75759,51.62318],[14.75392,51.67445],[14.69065,51.70842],[14.66386,51.73282],[14.64625,51.79472],[14.60493,51.80473],[14.59089,51.83302],[14.6588,51.88359],[14.6933,51.9044],[14.70601,51.92944],[14.7177,51.94048],[14.72163,51.95188],[14.71836,51.95606],[14.7139,51.95643],[14.70488,51.97679],[14.71339,52.00337],[14.76026,52.06624],[14.72971,52.09167],[14.6917,52.10283],[14.67683,52.13936],[14.70616,52.16927],[14.68344,52.19612],[14.71319,52.22144],[14.70139,52.25038],[14.58149,52.28007],[14.56378,52.33838],[14.55228,52.35264],[14.54423,52.42568],[14.63056,52.48993],[14.60081,52.53116],[14.6289,52.57136],[14.61073,52.59847],[14.22071,52.81175],[14.13806,52.82392],[14.12256,52.84311],[14.15873,52.87715],[14.14056,52.95786],[14.25954,53.00264],[14.35044,53.05829],[14.38679,53.13669],[14.36696,53.16444],[14.37853,53.20405],[14.40662,53.21098],[14.45125,53.26241],[14.44133,53.27427],[14.4215,53.27724],[14.35209,53.49506],[14.3273,53.50587],[14.30416,53.55499],[14.31904,53.61581],[14.2853,53.63392],[14.28477,53.65955],[14.27133,53.66613],[14.2836,53.67721],[14.26782,53.69866],[14.27249,53.74464],[14.21323,53.8664],[14.20823,53.90776],[14.18544,53.91258],[14.20647,53.91671],[14.22634,53.9291],[14.20811,54.12784],[13.93395,54.84044],[12.85844,54.82438],[11.90309,54.38543],[11.00303,54.63689],[10.31111,54.65968],[10.16755,54.73883],[9.89314,54.84171],[9.73563,54.8247],[9.61187,54.85548],[9.62734,54.88057],[9.58937,54.88785],[9.4659,54.83131],[9.43155,54.82586],[9.41213,54.84254],[9.38532,54.83968],[9.36496,54.81749],[9.33849,54.80233],[9.32771,54.80602],[9.2474,54.8112],[9.23445,54.83432],[9.24631,54.84726],[9.20571,54.85841],[9.14275,54.87421],[9.04629,54.87249],[8.92795,54.90452],[8.81178,54.90518],[8.76387,54.8948],[8.63979,54.91069],[8.55769,54.91837],[8.45719,55.06747],[8.02459,55.09613],[5.45168,54.20039],[6.91025,53.44221],[7.00198,53.32672],[7.19052,53.31866],[7.21679,53.20058],[7.22681,53.18165],[7.17898,53.13817],[7.21694,53.00742],[7.07253,52.81083],[7.04557,52.63318],[6.77307,52.65375],[6.71641,52.62905],[6.69507,52.488],[6.94293,52.43597],[6.99041,52.47235],[7.03417,52.40237],[7.07044,52.37805],[7.02703,52.27941],[7.06365,52.23789],[7.03729,52.22695],[6.9897,52.2271],[6.97189,52.20329],[6.83984,52.11728],[6.76117,52.11895],[6.68128,52.05052],[6.83035,51.9905],[6.82357,51.96711],[6.72319,51.89518],[6.68386,51.91861],[6.58556,51.89386],[6.50231,51.86313],[6.47179,51.85395],[6.38815,51.87257],[6.40704,51.82771],[6.30593,51.84998],[6.29872,51.86801],[6.21443,51.86801],[6.15349,51.90439],[6.11551,51.89769],[6.16902,51.84094],[6.10337,51.84829],[6.06705,51.86136],[5.99848,51.83195],[5.94568,51.82786],[5.98665,51.76944],[5.95003,51.7493],[6.04091,51.71821],[6.02767,51.6742],[6.11759,51.65609],[6.09055,51.60564],[6.18017,51.54096],[6.21724,51.48568],[6.20654,51.40049],[6.22641,51.39948],[6.22674,51.36135],[6.16977,51.33169],[6.07889,51.24432],[6.07889,51.17038],[6.17384,51.19589],[6.16706,51.15677],[5.98292,51.07469],[5.9541,51.03496],[5.9134,51.06736],[5.86735,51.05182],[5.87849,51.01969],[5.90493,51.00198],[5.90296,50.97356],[5.95282,50.98728],[6.02697,50.98303],[6.01615,50.93367],[6.09297,50.92066],[6.07486,50.89307],[6.08805,50.87223],[6.07693,50.86025],[6.07431,50.84674],[6.05702,50.85179],[6.05623,50.8572],[6.01921,50.84435],[6.02328,50.81694],[6.00462,50.80065],[5.98404,50.80988],[5.97497,50.79992],[6.02624,50.77453],[6.01976,50.75398],[6.03889,50.74618],[6.0326,50.72647],[6.0406,50.71848],[6.04428,50.72861],[6.11707,50.72231],[6.17852,50.6245],[6.26957,50.62444],[6.2476,50.60392],[6.24888,50.59869],[6.24005,50.58732],[6.22581,50.5907],[6.20281,50.56952],[6.17739,50.55875],[6.17802,50.54179],[6.19735,50.53576],[6.19579,50.5313],[6.18716,50.52653],[6.19193,50.5212],[6.20599,50.52089],[6.22335,50.49578],[6.26637,50.50272],[6.30809,50.50058],[6.3465,50.48833],[6.34005,50.46083],[6.37219,50.45397],[6.36852,50.40776],[6.34406,50.37994],[6.3688,50.35898],[6.40785,50.33557],[6.40641,50.32425],[6.35701,50.31139],[6.32488,50.32333],[6.29949,50.30887],[6.28797,50.27458],[6.208,50.25179],[6.16853,50.2234],[6.18364,50.20815],[6.18739,50.1822],[6.14588,50.17106],[6.14132,50.14971],[6.15298,50.14126],[6.1379,50.12964],[6.12055,50.09171],[6.11274,50.05916],[6.13458,50.04141],[6.13044,50.02929],[6.14666,50.02207],[6.13794,50.01466],[6.13273,50.02019],[6.1295,50.01849],[6.13806,50.01056],[6.14948,50.00908],[6.14147,49.99563],[6.1701,49.98518],[6.16466,49.97086],[6.17872,49.9537],[6.18554,49.95622],[6.18045,49.96611],[6.19089,49.96991],[6.19856,49.95053],[6.22094,49.94955],[6.22608,49.929],[6.21882,49.92403],[6.22926,49.92096],[6.23496,49.89972],[6.26146,49.88203],[6.28874,49.87592],[6.29692,49.86685],[6.30963,49.87021],[6.32303,49.85133],[6.32098,49.83728],[6.33585,49.83785],[6.34267,49.84974],[6.36576,49.85032],[6.40022,49.82029],[6.42521,49.81591],[6.42905,49.81091],[6.44131,49.81443],[6.45425,49.81164],[6.47111,49.82263],[6.48718,49.81267],[6.50647,49.80916],[6.51215,49.80124],[6.52121,49.81338],[6.53122,49.80666],[6.52169,49.79787],[6.50534,49.78952],[6.51669,49.78336],[6.51056,49.77515],[6.51828,49.76855],[6.51646,49.75961],[6.50174,49.75292],[6.50193,49.73291],[6.51805,49.72425],[6.51397,49.72058],[6.50261,49.72718],[6.49535,49.72645],[6.49694,49.72205],[6.5042,49.71808],[6.50647,49.71353],[6.49785,49.71118],[6.48014,49.69767],[6.46048,49.69092],[6.44654,49.67799],[6.42937,49.66857],[6.42726,49.66078],[6.43768,49.66021],[6.4413,49.65722],[6.41861,49.61723],[6.39822,49.60081],[6.385,49.59946],[6.37464,49.58886],[6.38342,49.5799],[6.38024,49.57593],[6.36676,49.57813],[6.35825,49.57053],[6.38228,49.55855],[6.38072,49.55171],[6.35666,49.52931],[6.36788,49.50377],[6.36907,49.48931],[6.36778,49.46937],[6.38352,49.46463],[6.39168,49.4667],[6.40274,49.46546],[6.42432,49.47683],[6.55404,49.42464],[6.533,49.40748],[6.60091,49.36864],[6.58807,49.35358],[6.572,49.35027],[6.60186,49.31055],[6.66583,49.28065],[6.69274,49.21661],[6.71843,49.2208],[6.73256,49.20486],[6.71137,49.18808],[6.73765,49.16375],[6.78265,49.16793],[6.83385,49.15162],[6.84703,49.15734],[6.86225,49.18185],[6.85016,49.19354],[6.85119,49.20038],[6.83555,49.21249],[6.85939,49.22376],[6.89298,49.20863],[6.91875,49.22261],[6.93831,49.2223],[6.94028,49.21641],[6.95963,49.203],[6.97273,49.2099],[7.01318,49.19018],[7.03459,49.19096],[7.0274,49.17042],[7.03178,49.15734],[7.04662,49.13724],[7.04409,49.12123],[7.04843,49.11422],[7.05548,49.11185],[7.06642,49.11415],[7.07162,49.1255],[7.09007,49.13094],[7.07859,49.15031],[7.10715,49.15631],[7.10384,49.13787],[7.12504,49.14253],[7.1358,49.1282],[7.1593,49.1204],[7.23473,49.12971],[7.29514,49.11426],[7.3195,49.14231],[7.35995,49.14399],[7.3662,49.17308],[7.44052,49.18354],[7.44455,49.16765],[7.49473,49.17],[7.49172,49.13915],[7.53012,49.09818],[7.56416,49.08136],[7.62575,49.07654],[7.63618,49.05428],[7.75948,49.04562],[7.79557,49.06583],[7.86386,49.03499],[7.93641,49.05544],[7.97783,49.03161],[8.14189,48.97833],[8.22604,48.97352],[8.20031,48.95856],[8.19989,48.95825],[8.12813,48.87985],[8.10253,48.81829],[8.06802,48.78957],[8.0326,48.79017],[8.01534,48.76085],[7.96994,48.75606],[7.96812,48.72491],[7.89002,48.66317],[7.84098,48.64217],[7.80057,48.5857],[7.80167,48.54758],[7.80647,48.51239],[7.76833,48.48945],[7.73109,48.39192],[7.74562,48.32736],[7.69022,48.30018],[7.6648,48.22219],[7.57137,48.12292],[7.56966,48.03265],[7.62302,47.97898],[7.55673,47.87371],[7.52921,47.77747],[7.54761,47.72912],[7.53722,47.71635],[7.51266,47.70197],[7.51915,47.68335],[7.52067,47.66437],[7.53384,47.65115],[7.5591,47.63849],[7.57423,47.61628],[7.58851,47.60794],[7.59301,47.60058],[7.58945,47.59017],[7.60523,47.58519],[7.60459,47.57869],[7.61929,47.57683],[7.64309,47.59151],[7.64213,47.5944],[7.64599,47.59695],[7.67395,47.59212],[7.68229,47.59905],[7.69385,47.60099],[7.68486,47.59601],[7.67115,47.5871],[7.68904,47.57133],[7.67655,47.56435],[7.63338,47.56256],[7.65083,47.54662],[7.66174,47.54554],[7.6656,47.53752],[7.68101,47.53232],[7.69642,47.53297],[7.71961,47.54219],[7.75261,47.54599],[7.79486,47.55691],[7.81901,47.58798],[7.84412,47.5841],[7.88664,47.58854],[7.90673,47.57674],[7.91251,47.55031],[7.94494,47.54511],[7.95682,47.55789],[7.97581,47.55493],[8.00113,47.55616],[8.02136,47.55096],[8.04383,47.55443],[8.06663,47.56374],[8.08557,47.55768],[8.10002,47.56504],[8.10395,47.57918],[8.11543,47.5841],[8.13662,47.58432],[8.13823,47.59147],[8.14947,47.59558],[8.1652,47.5945],[8.19378,47.61636],[8.20617,47.62141],[8.22011,47.6181],[8.22577,47.60385],[8.23809,47.61204],[8.25863,47.61571],[8.26313,47.6103],[8.2824,47.61225],[8.29722,47.60603],[8.29524,47.5919],[8.30277,47.58607],[8.32735,47.57133],[8.35512,47.57014],[8.38273,47.56608],[8.39477,47.57826],[8.43235,47.56617],[8.49431,47.58107],[8.48949,47.588],[8.46637,47.58389],[8.45578,47.60121],[8.50747,47.61897],[8.51686,47.63476],[8.55756,47.62394],[8.57586,47.59537],[8.60348,47.61204],[8.59545,47.64298],[8.60701,47.65271],[8.61471,47.64514],[8.60412,47.63735],[8.62049,47.63757],[8.62884,47.65098],[8.61113,47.66332],[8.6052,47.67258],[8.57683,47.66158],[8.56141,47.67088],[8.52801,47.66059],[8.5322,47.64687],[8.49656,47.64709],[8.46605,47.64103],[8.4667,47.65747],[8.44711,47.65379],[8.42264,47.66667],[8.41346,47.66676],[8.40473,47.67499],[8.4211,47.68407],[8.40569,47.69855],[8.44807,47.72426],[8.45771,47.7493],[8.48868,47.77215],[8.56814,47.78001],[8.56415,47.80633],[8.61657,47.79998],[8.62408,47.7626],[8.64425,47.76398],[8.65292,47.80066],[8.68022,47.78599],[8.68985,47.75686],[8.71778,47.76571],[8.74251,47.75168],[8.70543,47.73121],[8.73671,47.7169],[8.72617,47.69651]]]]}},{type:"Feature",properties:{iso1A2:"DG",iso1A3:"DGA",wikidata:"Q184851",nameEn:"Diego Garcia",country:"GB",groups:["IO","BOTS","014","202","002","UN"],isoStatus:"excRes",callingCodes:["246"]},geometry:{type:"MultiPolygon",coordinates:[[[[73.14823,-7.76302],[73.09982,-6.07324],[71.43792,-7.73904],[73.14823,-7.76302]]]]}},{type:"Feature",properties:{iso1A2:"DJ",iso1A3:"DJI",iso1N3:"262",wikidata:"Q977",nameEn:"Djibouti",groups:["014","202","002","UN"],callingCodes:["253"]},geometry:{type:"MultiPolygon",coordinates:[[[[43.90659,12.3823],[43.90659,12.3823],[43.32909,12.59711],[43.29075,12.79154],[42.86195,12.58747],[42.7996,12.42629],[42.6957,12.36201],[42.46941,12.52661],[42.4037,12.46478],[41.95461,11.81157],[41.82878,11.72361],[41.77727,11.49902],[41.8096,11.33606],[41.80056,10.97127],[42.06302,10.92599],[42.13691,10.97586],[42.42669,10.98493],[42.62989,11.09711],[42.75111,11.06992],[42.79037,10.98493],[42.95776,10.98533],[43.90659,12.3823]]]]}},{type:"Feature",properties:{iso1A2:"DK",iso1A3:"DNK",iso1N3:"208",wikidata:"Q756617",nameEn:"Kingdom of Denmark"},geometry:null},{type:"Feature",properties:{iso1A2:"DM",iso1A3:"DMA",iso1N3:"212",wikidata:"Q784",nameEn:"Dominica",groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 767"]},geometry:{type:"MultiPolygon",coordinates:[[[[-61.32485,14.91445],[-60.86656,15.82603],[-61.95646,15.5094],[-61.32485,14.91445]]]]}},{type:"Feature",properties:{iso1A2:"DO",iso1A3:"DOM",iso1N3:"214",wikidata:"Q786",nameEn:"Dominican Republic",groups:["029","003","419","019","UN"],callingCodes:["1 809","1 829","1 849"]},geometry:{type:"MultiPolygon",coordinates:[[[[-67.87844,21.7938],[-72.38946,20.27111],[-71.77419,19.73128],[-71.75865,19.70231],[-71.7429,19.58445],[-71.71449,19.55364],[-71.71268,19.53374],[-71.6802,19.45008],[-71.69448,19.37866],[-71.77766,19.33823],[-71.73229,19.26686],[-71.62642,19.21212],[-71.65337,19.11759],[-71.69938,19.10916],[-71.71088,19.08353],[-71.74088,19.0437],[-71.88102,18.95007],[-71.77766,18.95007],[-71.72624,18.87802],[-71.71885,18.78423],[-71.82556,18.62551],[-71.95412,18.64939],[-72.00201,18.62312],[-71.88102,18.50125],[-71.90875,18.45821],[-71.69952,18.34101],[-71.78271,18.18302],[-71.75465,18.14405],[-71.74994,18.11115],[-71.73783,18.07177],[-71.75671,18.03456],[-72.29523,17.48026],[-68.39466,16.14167],[-67.87844,21.7938]]]]}},{type:"Feature",properties:{iso1A2:"DZ",iso1A3:"DZA",iso1N3:"012",wikidata:"Q262",nameEn:"Algeria",groups:["015","002","UN"],callingCodes:["213"]},geometry:{type:"MultiPolygon",coordinates:[[[[8.59123,37.14286],[5.10072,39.89531],[-2.27707,35.35051],[-2.21248,35.08532],[-2.21445,35.04378],[-2.04734,34.93218],[-1.97833,34.93218],[-1.97469,34.886],[-1.73707,34.74226],[-1.84569,34.61907],[-1.69788,34.48056],[-1.78042,34.39018],[-1.64666,34.10405],[-1.73494,33.71721],[-1.59508,33.59929],[-1.67067,33.27084],[-1.46249,33.0499],[-1.54244,32.95499],[-1.37794,32.73628],[-.9912,32.52467],[-1.24998,32.32993],[-1.24453,32.1917],[-1.15735,32.12096],[-1.22829,32.07832],[-2.46166,32.16603],[-2.93873,32.06557],[-2.82784,31.79459],[-3.66314,31.6339],[-3.66386,31.39202],[-3.77647,31.31912],[-3.77103,31.14984],[-3.54944,31.0503],[-3.65418,30.85566],[-3.64735,30.67539],[-4.31774,30.53229],[-4.6058,30.28343],[-5.21671,29.95253],[-5.58831,29.48103],[-5.72121,29.52322],[-5.75616,29.61407],[-6.69965,29.51623],[-6.78351,29.44634],[-6.95824,29.50924],[-7.61585,29.36252],[-8.6715,28.71194],[-8.66879,27.6666],[-8.66674,27.31569],[-4.83423,24.99935],[1.15698,21.12843],[1.20992,20.73533],[3.24648,19.81703],[3.12501,19.1366],[3.36082,18.9745],[4.26651,19.14224],[5.8153,19.45101],[7.38361,20.79165],[7.48273,20.87258],[11.96886,23.51735],[11.62498,24.26669],[11.41061,24.21456],[10.85323,24.5595],[10.33159,24.5465],[10.02432,24.98124],[10.03146,25.35635],[9.38834,26.19288],[9.51696,26.39148],[9.89569,26.57696],[9.78136,29.40961],[9.3876,30.16738],[9.55544,30.23971],[9.07483,32.07865],[8.35999,32.50101],[8.31895,32.83483],[8.1179,33.05086],[8.11433,33.10175],[7.83028,33.18851],[7.73687,33.42114],[7.54088,33.7726],[7.52851,34.06493],[7.66174,34.20167],[7.74207,34.16492],[7.81242,34.21841],[7.86264,34.3987],[8.20482,34.57575],[8.29655,34.72798],[8.25189,34.92009],[8.30727,34.95378],[8.3555,35.10007],[8.47318,35.23376],[8.30329,35.29884],[8.36086,35.47774],[8.35371,35.66373],[8.26472,35.73669],[8.2626,35.91733],[8.40731,36.42208],[8.18936,36.44939],[8.16167,36.48817],[8.47609,36.66607],[8.46537,36.7706],[8.57613,36.78062],[8.67706,36.8364],[8.62972,36.86499],[8.64044,36.9401],[8.59123,37.14286]]]]}},{type:"Feature",properties:{iso1A2:"EA",wikidata:"Q28868874",nameEn:"Ceuta, Melilla",country:"ES",level:"territory",isoStatus:"excRes"},geometry:null},{type:"Feature",properties:{iso1A2:"EC",iso1A3:"ECU",iso1N3:"218",wikidata:"Q736",nameEn:"Ecuador"},geometry:null},{type:"Feature",properties:{iso1A2:"EE",iso1A3:"EST",iso1N3:"233",wikidata:"Q191",nameEn:"Estonia",aliases:["EW"],groups:["EU","154","150","UN"],callingCodes:["372"]},geometry:{type:"MultiPolygon",coordinates:[[[[26.32936,60.00121],[20.5104,59.15546],[19.84909,57.57876],[22.80496,57.87798],[23.20055,57.56697],[24.26221,57.91787],[24.3579,57.87471],[25.19484,58.0831],[25.28237,57.98539],[25.29581,58.08288],[25.73499,57.90193],[26.05949,57.84744],[26.0324,57.79037],[26.02456,57.78342],[26.027,57.78158],[26.0266,57.77441],[26.02069,57.77169],[26.02415,57.76865],[26.03332,57.7718],[26.0543,57.76105],[26.08098,57.76619],[26.2029,57.7206],[26.1866,57.6849],[26.29253,57.59244],[26.46527,57.56885],[26.54675,57.51813],[26.90364,57.62823],[27.34698,57.52242],[27.31919,57.57672],[27.40393,57.62125],[27.3746,57.66834],[27.52615,57.72843],[27.50171,57.78842],[27.56689,57.83356],[27.78526,57.83963],[27.81841,57.89244],[27.67282,57.92627],[27.62393,58.09462],[27.48541,58.22615],[27.55489,58.39525],[27.36366,58.78381],[27.74429,58.98351],[27.80482,59.1116],[27.87978,59.18097],[27.90911,59.24353],[28.00689,59.28351],[28.14215,59.28934],[28.19284,59.35791],[28.20537,59.36491],[28.21137,59.38058],[28.19061,59.39962],[28.04187,59.47017],[27.85643,59.58538],[26.90044,59.63819],[26.32936,60.00121]]]]}},{type:"Feature",properties:{iso1A2:"EG",iso1A3:"EGY",iso1N3:"818",wikidata:"Q79",nameEn:"Egypt",groups:["015","002","UN"],callingCodes:["20"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.62659,31.82938],[26.92891,33.39516],[24.8458,31.39877],[25.01077,30.73861],[24.71117,30.17441],[24.99968,29.24574],[24.99885,21.99535],[33.17563,22.00405],[34.0765,22.00501],[37.8565,22.00903],[34.4454,27.91479],[34.8812,29.36878],[34.92298,29.45305],[34.26742,31.21998],[34.24012,31.29591],[34.23572,31.2966],[34.21853,31.32363],[34.052,31.46619],[33.62659,31.82938]]]]}},{type:"Feature",properties:{iso1A2:"EH",iso1A3:"ESH",iso1N3:"732",wikidata:"Q6250",nameEn:"Western Sahara",groups:["015","002"],callingCodes:["212"]},geometry:{type:"MultiPolygon",coordinates:[[[[-8.66879,27.6666],[-8.77527,27.66663],[-8.71787,26.9898],[-9.08698,26.98639],[-9.56957,26.90042],[-9.81998,26.71379],[-10.68417,26.90984],[-11.35695,26.8505],[-11.23622,26.72023],[-11.38635,26.611],[-11.62052,26.05229],[-12.06001,26.04442],[-12.12281,25.13682],[-12.92147,24.39502],[-13.00628,24.01923],[-13.75627,23.77231],[-14.10361,22.75501],[-14.1291,22.41636],[-14.48112,22.00886],[-14.47329,21.63839],[-14.78487,21.36587],[-16.44269,21.39745],[-16.9978,21.36239],[-17.02707,21.34022],[-17.21511,21.34226],[-17.35589,20.80492],[-17.0471,20.76408],[-17.0695,20.85742],[-17.06781,20.92697],[-17.0396,20.9961],[-17.0357,21.05368],[-16.99806,21.12142],[-16.95474,21.33997],[-13.01525,21.33343],[-13.08438,22.53866],[-13.15313,22.75649],[-13.10753,22.89493],[-13.00412,23.02297],[-12.5741,23.28975],[-12.36213,23.3187],[-12.14969,23.41935],[-12.00251,23.4538],[-12.0002,25.9986],[-8.66721,25.99918],[-8.66674,27.31569],[-8.66879,27.6666]]]]}},{type:"Feature",properties:{iso1A2:"ER",iso1A3:"ERI",iso1N3:"232",wikidata:"Q986",nameEn:"Eritrea",groups:["014","202","002","UN"],callingCodes:["291"]},geometry:{type:"MultiPolygon",coordinates:[[[[40.99158,15.81743],[39.63762,18.37348],[38.57727,17.98125],[38.45916,17.87167],[38.37133,17.66269],[38.13362,17.53906],[37.50967,17.32199],[37.42694,17.04041],[36.99777,17.07172],[36.92193,16.23451],[36.76371,15.80831],[36.69761,15.75323],[36.54276,15.23478],[36.44337,15.14963],[36.54376,14.25597],[36.56536,14.26177],[36.55659,14.28237],[36.63364,14.31172],[36.85787,14.32201],[37.01622,14.2561],[37.09486,14.27155],[37.13206,14.40746],[37.3106,14.44657],[37.47319,14.2149],[37.528,14.18413],[37.91287,14.89447],[38.0364,14.72745],[38.25562,14.67287],[38.3533,14.51323],[38.45748,14.41445],[38.78306,14.4754],[38.98058,14.54895],[39.02834,14.63717],[39.16074,14.65187],[39.14772,14.61827],[39.19547,14.56996],[39.23888,14.56365],[39.26927,14.48801],[39.2302,14.44598],[39.2519,14.40393],[39.37685,14.54402],[39.52756,14.49011],[39.50585,14.55735],[39.58182,14.60987],[39.76632,14.54264],[39.9443,14.41024],[40.07236,14.54264],[40.14649,14.53969],[40.21128,14.39342],[40.25686,14.41445],[40.9167,14.11152],[41.25097,13.60787],[41.62864,13.38626],[42.05841,12.80912],[42.21469,12.75832],[42.2798,12.6355],[42.4037,12.46478],[42.46941,12.52661],[42.6957,12.36201],[42.7996,12.42629],[42.86195,12.58747],[43.29075,12.79154],[40.99158,15.81743]]]]}},{type:"Feature",properties:{iso1A2:"ES",iso1A3:"ESP",iso1N3:"724",wikidata:"Q29",nameEn:"Spain"},geometry:null},{type:"Feature",properties:{iso1A2:"ET",iso1A3:"ETH",iso1N3:"231",wikidata:"Q115",nameEn:"Ethiopia",groups:["014","202","002","UN"],callingCodes:["251"]},geometry:{type:"MultiPolygon",coordinates:[[[[42.4037,12.46478],[42.2798,12.6355],[42.21469,12.75832],[42.05841,12.80912],[41.62864,13.38626],[41.25097,13.60787],[40.9167,14.11152],[40.25686,14.41445],[40.21128,14.39342],[40.14649,14.53969],[40.07236,14.54264],[39.9443,14.41024],[39.76632,14.54264],[39.58182,14.60987],[39.50585,14.55735],[39.52756,14.49011],[39.37685,14.54402],[39.2519,14.40393],[39.2302,14.44598],[39.26927,14.48801],[39.23888,14.56365],[39.19547,14.56996],[39.14772,14.61827],[39.16074,14.65187],[39.02834,14.63717],[38.98058,14.54895],[38.78306,14.4754],[38.45748,14.41445],[38.3533,14.51323],[38.25562,14.67287],[38.0364,14.72745],[37.91287,14.89447],[37.528,14.18413],[37.47319,14.2149],[37.3106,14.44657],[37.13206,14.40746],[37.09486,14.27155],[37.01622,14.2561],[36.85787,14.32201],[36.63364,14.31172],[36.55659,14.28237],[36.56536,14.26177],[36.54376,14.25597],[36.44653,13.95666],[36.48824,13.83954],[36.38993,13.56459],[36.24545,13.36759],[36.13374,12.92665],[36.16651,12.88019],[36.14268,12.70879],[36.01458,12.72478],[35.70476,12.67101],[35.24302,11.91132],[35.11492,11.85156],[35.05832,11.71158],[35.09556,11.56278],[34.95704,11.24448],[35.01215,11.19626],[34.93172,10.95946],[34.97789,10.91559],[34.97491,10.86147],[34.86916,10.78832],[34.86618,10.74588],[34.77532,10.69027],[34.77383,10.74588],[34.59062,10.89072],[34.4372,10.781],[34.2823,10.53508],[34.34783,10.23914],[34.32102,10.11599],[34.22718,10.02506],[34.20484,9.9033],[34.13186,9.7492],[34.08717,9.55243],[34.10229,9.50238],[34.14304,9.04654],[34.14453,8.60204],[34.01346,8.50041],[33.89579,8.4842],[33.87195,8.41938],[33.71407,8.3678],[33.66938,8.44442],[33.54575,8.47094],[33.3119,8.45474],[33.19721,8.40317],[33.1853,8.29264],[33.18083,8.13047],[33.08401,8.05822],[33.0006,7.90333],[33.04944,7.78989],[33.24637,7.77939],[33.32531,7.71297],[33.44745,7.7543],[33.71407,7.65983],[33.87642,7.5491],[34.02984,7.36449],[34.03878,7.27437],[34.01495,7.25664],[34.19369,7.12807],[34.19369,7.04382],[34.35753,6.91963],[34.47669,6.91076],[34.53925,6.82794],[34.53776,6.74808],[34.65096,6.72589],[34.77459,6.5957],[34.87736,6.60161],[35.01738,6.46991],[34.96227,6.26415],[35.00546,5.89387],[35.12611,5.68937],[35.13058,5.62118],[35.31188,5.50106],[35.29938,5.34042],[35.50792,5.42431],[35.8576,5.33413],[35.81968,5.10757],[35.82118,4.77382],[35.9419,4.61933],[35.95449,4.53244],[36.03924,4.44406],[36.84474,4.44518],[37.07724,4.33503],[38.14168,3.62487],[38.45812,3.60445],[38.52336,3.62551],[38.91938,3.51198],[39.07736,3.5267],[39.19954,3.47834],[39.49444,3.45521],[39.51551,3.40895],[39.55132,3.39634],[39.58339,3.47434],[39.76808,3.67058],[39.86043,3.86974],[40.77498,4.27683],[41.1754,3.94079],[41.89488,3.97375],[42.07619,4.17667],[42.55853,4.20518],[42.84526,4.28357],[42.97746,4.44032],[43.04177,4.57923],[43.40263,4.79289],[44.02436,4.9451],[44.98104,4.91821],[47.97917,8.00124],[47.92477,8.00111],[46.99339,7.9989],[44.19222,8.93028],[43.32613,9.59205],[43.23518,9.84605],[43.0937,9.90579],[42.87643,10.18441],[42.69452,10.62672],[42.95776,10.98533],[42.79037,10.98493],[42.75111,11.06992],[42.62989,11.09711],[42.42669,10.98493],[42.13691,10.97586],[42.06302,10.92599],[41.80056,10.97127],[41.8096,11.33606],[41.77727,11.49902],[41.82878,11.72361],[41.95461,11.81157],[42.4037,12.46478]]]]}},{type:"Feature",properties:{iso1A2:"EU",iso1A3:"EUE",wikidata:"Q458",nameEn:"European Union",level:"union",isoStatus:"excRes"},geometry:null},{type:"Feature",properties:{iso1A2:"FI",iso1A3:"FIN",iso1N3:"246",wikidata:"Q33",nameEn:"Finland",aliases:["SF"]},geometry:null},{type:"Feature",properties:{iso1A2:"FJ",iso1A3:"FJI",iso1N3:"242",wikidata:"Q712",nameEn:"Fiji",groups:["054","009","UN"],driveSide:"left",callingCodes:["679"]},geometry:{type:"MultiPolygon",coordinates:[[[[174.245,-23.1974],[179.99999,-22.5],[179.99999,-11.5],[174,-11.5],[174.245,-23.1974]]],[[[-176.76826,-14.95183],[-180,-14.96041],[-180,-22.90585],[-176.74538,-22.89767],[-176.76826,-14.95183]]]]}},{type:"Feature",properties:{iso1A2:"FK",iso1A3:"FLK",iso1N3:"238",wikidata:"Q9648",nameEn:"Falkland Islands",country:"GB",groups:["BOTS","005","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["500"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.67376,-55.11859],[-54.56126,-51.26248],[-61.26735,-50.63919],[-63.67376,-55.11859]]]]}},{type:"Feature",properties:{iso1A2:"FM",iso1A3:"FSM",iso1N3:"583",wikidata:"Q702",nameEn:"Federated States of Micronesia",groups:["057","009","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["691"]},geometry:{type:"MultiPolygon",coordinates:[[[[138.20583,13.3783],[136.27107,6.73747],[156.88247,-1.39237],[165.19726,6.22546],[138.20583,13.3783]]]]}},{type:"Feature",properties:{iso1A2:"FO",iso1A3:"FRO",iso1N3:"234",wikidata:"Q4628",nameEn:"Faroe Islands",country:"DK",groups:["154","150","UN"],callingCodes:["298"]},geometry:{type:"MultiPolygon",coordinates:[[[[-8.51774,62.35338],[-6.51083,60.95272],[-5.70102,62.77194],[-8.51774,62.35338]]]]}},{type:"Feature",properties:{iso1A2:"FR",iso1A3:"FRA",iso1N3:"250",wikidata:"Q142",nameEn:"France"},geometry:null},{type:"Feature",properties:{iso1A2:"FX",iso1A3:"FXX",iso1N3:"249",wikidata:"Q212429",nameEn:"Metropolitan France",country:"FR",groups:["EU","155","150","UN"],isoStatus:"excRes",callingCodes:["33"]},geometry:{type:"MultiPolygon",coordinates:[[[[2.55904,51.07014],[2.18458,51.52087],[1.17405,50.74239],[-2.02963,49.91866],[-2.09454,49.46288],[-1.83944,49.23037],[-2.00491,48.86706],[-2.65349,49.15373],[-6.28985,48.93406],[-1.81005,43.59738],[-1.77289,43.38957],[-1.79319,43.37497],[-1.78332,43.36399],[-1.78714,43.35476],[-1.77068,43.34396],[-1.75334,43.34107],[-1.75079,43.3317],[-1.7397,43.32979],[-1.73074,43.29481],[-1.69407,43.31378],[-1.62481,43.30726],[-1.63052,43.28591],[-1.61341,43.25269],[-1.57674,43.25269],[-1.55963,43.28828],[-1.50992,43.29481],[-1.45289,43.27049],[-1.40942,43.27272],[-1.3758,43.24511],[-1.41562,43.12815],[-1.47555,43.08372],[-1.44067,43.047],[-1.35272,43.02658],[-1.34419,43.09665],[-1.32209,43.1127],[-1.27118,43.11961],[-1.30052,43.09581],[-1.30531,43.06859],[-1.25244,43.04164],[-1.22881,43.05534],[-1.10333,43.0059],[-1.00963,42.99279],[-.97133,42.96239],[-.81652,42.95166],[-.75478,42.96916],[-.72037,42.92541],[-.73422,42.91228],[-.72608,42.89318],[-.69837,42.87945],[-.67637,42.88303],[-.55497,42.77846],[-.50863,42.82713],[-.44334,42.79939],[-.41319,42.80776],[-.38833,42.80132],[-.3122,42.84788],[-.17939,42.78974],[-.16141,42.79535],[-.10519,42.72761],[-.02468,42.68513],[.17569,42.73424],[.25336,42.7174],[.29407,42.67431],[.36251,42.72282],[.40214,42.69779],[.67873,42.69458],[.65421,42.75872],[.66121,42.84021],[.711,42.86372],[.93089,42.79154],[.96166,42.80629],[.98292,42.78754],[1.0804,42.78569],[1.15928,42.71407],[1.35562,42.71944],[1.44197,42.60217],[1.47986,42.61346],[1.46718,42.63296],[1.48043,42.65203],[1.50867,42.64483],[1.55418,42.65669],[1.60085,42.62703],[1.63485,42.62957],[1.6625,42.61982],[1.68267,42.62533],[1.73452,42.61515],[1.72588,42.59098],[1.7858,42.57698],[1.73683,42.55492],[1.72515,42.50338],[1.76335,42.48863],[1.83037,42.48395],[1.88853,42.4501],[1.93663,42.45439],[1.94292,42.44316],[1.94061,42.43333],[1.94084,42.43039],[1.9574,42.42401],[1.96482,42.37787],[2.00488,42.35399],[2.06241,42.35906],[2.11621,42.38393],[2.12789,42.41291],[2.16599,42.42314],[2.20578,42.41633],[2.25551,42.43757],[2.38504,42.39977],[2.43299,42.39423],[2.43508,42.37568],[2.48457,42.33933],[2.54382,42.33406],[2.55516,42.35351],[2.57934,42.35808],[2.6747,42.33974],[2.65311,42.38771],[2.72056,42.42298],[2.75497,42.42578],[2.77464,42.41046],[2.84335,42.45724],[2.85675,42.45444],[2.86983,42.46843],[2.88413,42.45938],[2.92107,42.4573],[2.94283,42.48174],[2.96518,42.46692],[3.03734,42.47363],[3.08167,42.42748],[3.10027,42.42621],[3.11379,42.43646],[3.17156,42.43545],[3.75438,42.33445],[7.60802,41.05927],[10.09675,41.44089],[9.56115,43.20816],[7.50102,43.51859],[7.42422,43.72209],[7.40903,43.7296],[7.41113,43.73156],[7.41291,43.73168],[7.41298,43.73311],[7.41233,43.73439],[7.42062,43.73977],[7.42299,43.74176],[7.42443,43.74087],[7.42809,43.74396],[7.43013,43.74895],[7.43624,43.75014],[7.43708,43.75197],[7.4389,43.75151],[7.4379,43.74963],[7.47823,43.73341],[7.53006,43.78405],[7.50423,43.84345],[7.49355,43.86551],[7.51162,43.88301],[7.56075,43.89932],[7.56858,43.94506],[7.60771,43.95772],[7.65266,43.9763],[7.66848,43.99943],[7.6597,44.03009],[7.72508,44.07578],[7.66878,44.12795],[7.68694,44.17487],[7.63245,44.17877],[7.62155,44.14881],[7.36364,44.11882],[7.34547,44.14359],[7.27827,44.1462],[7.16929,44.20352],[7.00764,44.23736],[6.98221,44.28289],[6.89171,44.36637],[6.88784,44.42043],[6.94504,44.43112],[6.86233,44.49834],[6.85507,44.53072],[6.96042,44.62129],[6.95133,44.66264],[7.00582,44.69364],[7.07484,44.68073],[7.00401,44.78782],[7.02217,44.82519],[6.93499,44.8664],[6.90774,44.84322],[6.75518,44.89915],[6.74519,44.93661],[6.74791,45.01939],[6.66981,45.02324],[6.62803,45.11175],[6.7697,45.16044],[6.85144,45.13226],[6.96706,45.20841],[7.07074,45.21228],[7.13115,45.25386],[7.10572,45.32924],[7.18019,45.40071],[7.00037,45.509],[6.98948,45.63869],[6.80785,45.71864],[6.80785,45.83265],[6.95315,45.85163],[7.04151,45.92435],[7.00946,45.9944],[6.93862,46.06502],[6.87868,46.03855],[6.89321,46.12548],[6.78968,46.14058],[6.86052,46.28512],[6.77152,46.34784],[6.8024,46.39171],[6.82312,46.42661],[6.53358,46.45431],[6.25432,46.3632],[6.21981,46.31304],[6.24826,46.30175],[6.25137,46.29014],[6.23775,46.27822],[6.24952,46.26255],[6.26749,46.24745],[6.29474,46.26221],[6.31041,46.24417],[6.29663,46.22688],[6.27694,46.21566],[6.26007,46.21165],[6.24821,46.20531],[6.23913,46.20511],[6.23544,46.20714],[6.22175,46.20045],[6.22222,46.19888],[6.21844,46.19837],[6.21603,46.19507],[6.21273,46.19409],[6.21114,46.1927],[6.20539,46.19163],[6.19807,46.18369],[6.19552,46.18401],[6.18707,46.17999],[6.18871,46.16644],[6.18116,46.16187],[6.15305,46.15194],[6.13397,46.1406],[6.09926,46.14373],[6.09199,46.15191],[6.07491,46.14879],[6.05203,46.15191],[6.04564,46.14031],[6.03614,46.13712],[6.01791,46.14228],[5.9871,46.14499],[5.97893,46.13303],[5.95781,46.12925],[5.9641,46.14412],[5.97508,46.15863],[5.98188,46.17392],[5.98846,46.17046],[5.99573,46.18587],[5.96515,46.19638],[5.97542,46.21525],[6.02461,46.23313],[6.03342,46.2383],[6.04602,46.23127],[6.05029,46.23518],[6.0633,46.24583],[6.07072,46.24085],[6.08563,46.24651],[6.10071,46.23772],[6.12446,46.25059],[6.11926,46.2634],[6.1013,46.28512],[6.11697,46.29547],[6.1198,46.31157],[6.13876,46.33844],[6.15738,46.3491],[6.16987,46.36759],[6.15985,46.37721],[6.15016,46.3778],[6.09926,46.40768],[6.06407,46.41676],[6.08427,46.44305],[6.07269,46.46244],[6.1567,46.54402],[6.11084,46.57649],[6.27135,46.68251],[6.38351,46.73171],[6.45209,46.77502],[6.43216,46.80336],[6.46456,46.88865],[6.43341,46.92703],[6.71531,47.0494],[6.68823,47.06616],[6.76788,47.1208],[6.8489,47.15933],[6.9508,47.24338],[6.95108,47.26428],[6.94316,47.28747],[7.05305,47.33304],[7.0564,47.35134],[7.03125,47.36996],[6.87959,47.35335],[6.88542,47.37262],[6.93744,47.40714],[6.93953,47.43388],[7.0024,47.45264],[6.98425,47.49432],[7.0231,47.50522],[7.07425,47.48863],[7.12781,47.50371],[7.16249,47.49025],[7.19583,47.49455],[7.17026,47.44312],[7.24669,47.4205],[7.33526,47.44186],[7.35603,47.43432],[7.40308,47.43638],[7.43088,47.45846],[7.4462,47.46264],[7.4583,47.47216],[7.42923,47.48628],[7.43356,47.49712],[7.47534,47.47932],[7.51076,47.49651],[7.49804,47.51798],[7.5229,47.51644],[7.53199,47.5284],[7.51904,47.53515],[7.50588,47.52856],[7.49691,47.53821],[7.50873,47.54546],[7.51723,47.54578],[7.52831,47.55347],[7.53634,47.55553],[7.55652,47.56779],[7.55689,47.57232],[7.56548,47.57617],[7.56684,47.57785],[7.58386,47.57536],[7.58945,47.59017],[7.59301,47.60058],[7.58851,47.60794],[7.57423,47.61628],[7.5591,47.63849],[7.53384,47.65115],[7.52067,47.66437],[7.51915,47.68335],[7.51266,47.70197],[7.53722,47.71635],[7.54761,47.72912],[7.52921,47.77747],[7.55673,47.87371],[7.62302,47.97898],[7.56966,48.03265],[7.57137,48.12292],[7.6648,48.22219],[7.69022,48.30018],[7.74562,48.32736],[7.73109,48.39192],[7.76833,48.48945],[7.80647,48.51239],[7.80167,48.54758],[7.80057,48.5857],[7.84098,48.64217],[7.89002,48.66317],[7.96812,48.72491],[7.96994,48.75606],[8.01534,48.76085],[8.0326,48.79017],[8.06802,48.78957],[8.10253,48.81829],[8.12813,48.87985],[8.19989,48.95825],[8.20031,48.95856],[8.22604,48.97352],[8.14189,48.97833],[7.97783,49.03161],[7.93641,49.05544],[7.86386,49.03499],[7.79557,49.06583],[7.75948,49.04562],[7.63618,49.05428],[7.62575,49.07654],[7.56416,49.08136],[7.53012,49.09818],[7.49172,49.13915],[7.49473,49.17],[7.44455,49.16765],[7.44052,49.18354],[7.3662,49.17308],[7.35995,49.14399],[7.3195,49.14231],[7.29514,49.11426],[7.23473,49.12971],[7.1593,49.1204],[7.1358,49.1282],[7.12504,49.14253],[7.10384,49.13787],[7.10715,49.15631],[7.07859,49.15031],[7.09007,49.13094],[7.07162,49.1255],[7.06642,49.11415],[7.05548,49.11185],[7.04843,49.11422],[7.04409,49.12123],[7.04662,49.13724],[7.03178,49.15734],[7.0274,49.17042],[7.03459,49.19096],[7.01318,49.19018],[6.97273,49.2099],[6.95963,49.203],[6.94028,49.21641],[6.93831,49.2223],[6.91875,49.22261],[6.89298,49.20863],[6.85939,49.22376],[6.83555,49.21249],[6.85119,49.20038],[6.85016,49.19354],[6.86225,49.18185],[6.84703,49.15734],[6.83385,49.15162],[6.78265,49.16793],[6.73765,49.16375],[6.71137,49.18808],[6.73256,49.20486],[6.71843,49.2208],[6.69274,49.21661],[6.66583,49.28065],[6.60186,49.31055],[6.572,49.35027],[6.58807,49.35358],[6.60091,49.36864],[6.533,49.40748],[6.55404,49.42464],[6.42432,49.47683],[6.40274,49.46546],[6.39168,49.4667],[6.38352,49.46463],[6.36778,49.46937],[6.3687,49.4593],[6.28818,49.48465],[6.27875,49.503],[6.25029,49.50609],[6.2409,49.51408],[6.19543,49.50536],[6.17386,49.50934],[6.15366,49.50226],[6.16115,49.49297],[6.14321,49.48796],[6.12814,49.49365],[6.12346,49.4735],[6.10325,49.4707],[6.09845,49.46351],[6.10072,49.45268],[6.08373,49.45594],[6.07887,49.46399],[6.05553,49.46663],[6.04176,49.44801],[6.02743,49.44845],[6.02648,49.45451],[5.97693,49.45513],[5.96876,49.49053],[5.94224,49.49608],[5.94128,49.50034],[5.86571,49.50015],[5.83389,49.52152],[5.83467,49.52717],[5.84466,49.53027],[5.83648,49.5425],[5.81664,49.53775],[5.80871,49.5425],[5.81838,49.54777],[5.79195,49.55228],[5.77435,49.56298],[5.7577,49.55915],[5.75649,49.54321],[5.64505,49.55146],[5.60909,49.51228],[5.55001,49.52729],[5.46541,49.49825],[5.46734,49.52648],[5.43713,49.5707],[5.3974,49.61596],[5.34837,49.62889],[5.33851,49.61599],[5.3137,49.61225],[5.30214,49.63055],[5.33039,49.6555],[5.31465,49.66846],[5.26232,49.69456],[5.14545,49.70287],[5.09249,49.76193],[4.96714,49.79872],[4.85464,49.78995],[4.86965,49.82271],[4.85134,49.86457],[4.88529,49.9236],[4.78827,49.95609],[4.8382,50.06738],[4.88602,50.15182],[4.83279,50.15331],[4.82438,50.16878],[4.75237,50.11314],[4.70064,50.09384],[4.68695,49.99685],[4.5414,49.96911],[4.51098,49.94659],[4.43488,49.94122],[4.35051,49.95315],[4.31963,49.97043],[4.20532,49.95803],[4.14239,49.98034],[4.13508,50.01976],[4.16294,50.04719],[4.23101,50.06945],[4.20147,50.13535],[4.13561,50.13078],[4.16014,50.19239],[4.15524,50.21103],[4.21945,50.25539],[4.20651,50.27333],[4.17861,50.27443],[4.17347,50.28838],[4.15524,50.2833],[4.16808,50.25786],[4.13665,50.25609],[4.11954,50.30425],[4.10957,50.30234],[4.10237,50.31247],[4.0689,50.3254],[4.0268,50.35793],[3.96771,50.34989],[3.90781,50.32814],[3.84314,50.35219],[3.73911,50.34809],[3.70987,50.3191],[3.71009,50.30305],[3.66976,50.34563],[3.65709,50.36873],[3.67262,50.38663],[3.67494,50.40239],[3.66153,50.45165],[3.64426,50.46275],[3.61014,50.49568],[3.58361,50.49049],[3.5683,50.50192],[3.49509,50.48885],[3.51564,50.5256],[3.47385,50.53397],[3.44629,50.51009],[3.37693,50.49538],[3.28575,50.52724],[3.2729,50.60718],[3.23951,50.6585],[3.264,50.67668],[3.2536,50.68977],[3.26141,50.69151],[3.26063,50.70086],[3.24593,50.71389],[3.22042,50.71019],[3.20845,50.71662],[3.19017,50.72569],[3.20064,50.73547],[3.18811,50.74025],[3.18339,50.74981],[3.16476,50.76843],[3.15017,50.79031],[3.1257,50.78603],[3.11987,50.79188],[3.11206,50.79416],[3.10614,50.78303],[3.09163,50.77717],[3.04314,50.77674],[3.00537,50.76588],[2.96778,50.75242],[2.95019,50.75138],[2.90873,50.702],[2.91036,50.6939],[2.90069,50.69263],[2.88504,50.70656],[2.87937,50.70298],[2.86985,50.7033],[2.8483,50.72276],[2.81056,50.71773],[2.71165,50.81295],[2.63331,50.81457],[2.59093,50.91751],[2.63074,50.94746],[2.57551,51.00326],[2.55904,51.07014]],[[1.99838,42.44682],[1.98378,42.44697],[1.96125,42.45364],[1.95606,42.45785],[1.96215,42.47854],[1.97003,42.48081],[1.97227,42.48487],[1.97697,42.48568],[1.98022,42.49569],[1.98916,42.49351],[1.99766,42.4858],[1.98579,42.47486],[1.99216,42.46208],[2.01564,42.45171],[1.99838,42.44682]]]]}},{type:"Feature",properties:{iso1A2:"GA",iso1A3:"GAB",iso1N3:"266",wikidata:"Q1000",nameEn:"Gabon",groups:["017","202","002","UN"],callingCodes:["241"]},geometry:{type:"MultiPolygon",coordinates:[[[[13.29457,2.16106],[13.28534,2.25716],[11.37116,2.29975],[11.3561,2.17217],[11.35307,1.00251],[9.79648,1.0019],[9.75065,1.06753],[9.66433,1.06723],[7.24416,-.64092],[10.75913,-4.39519],[11.12647,-3.94169],[11.22301,-3.69888],[11.48764,-3.51089],[11.57949,-3.52798],[11.68608,-3.68942],[11.87083,-3.71571],[11.92719,-3.62768],[11.8318,-3.5812],[11.96554,-3.30267],[11.70227,-3.17465],[11.70558,-3.0773],[11.80365,-3.00424],[11.64798,-2.81146],[11.5359,-2.85654],[11.64487,-2.61865],[11.57637,-2.33379],[11.74605,-2.39936],[11.96866,-2.33559],[12.04895,-2.41704],[12.47925,-2.32626],[12.44656,-1.92025],[12.61312,-1.8129],[12.82172,-1.91091],[13.02759,-2.33098],[13.47977,-2.43224],[13.75884,-2.09293],[13.92073,-2.35581],[13.85846,-2.46935],[14.10442,-2.49268],[14.23829,-2.33715],[14.16202,-2.23916],[14.23518,-2.15671],[14.25932,-1.97624],[14.41838,-1.89412],[14.52569,-.57818],[14.41887,-.44799],[14.2165,-.38261],[14.06862,-.20826],[13.90632,-.2287],[13.88648,.26652],[14.10909,.58563],[14.26066,.57255],[14.48179,.9152],[14.25186,1.39842],[13.89582,1.4261],[13.15519,1.23368],[13.25447,1.32339],[13.13461,1.57238],[13.29457,2.16106]]]]}},{type:"Feature",properties:{iso1A2:"GB",iso1A3:"GBR",iso1N3:"826",wikidata:"Q145",ccTLD:".uk",nameEn:"United Kingdom",aliases:["UK"]},geometry:null},{type:"Feature",properties:{iso1A2:"GD",iso1A3:"GRD",iso1N3:"308",wikidata:"Q769",nameEn:"Grenada",aliases:["WG"],groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 473"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.64026,12.69984],[-61.77886,11.36496],[-59.94058,12.34011],[-62.64026,12.69984]]]]}},{type:"Feature",properties:{iso1A2:"GE",iso1A3:"GEO",iso1N3:"268",wikidata:"Q230",nameEn:"Georgia",groups:["145","142","UN"],callingCodes:["995"]},geometry:{type:"MultiPolygon",coordinates:[[[[46.42738,41.91323],[45.61676,42.20768],[45.78692,42.48358],[45.36501,42.55268],[45.15318,42.70598],[44.88754,42.74934],[44.80941,42.61277],[44.70002,42.74679],[44.54202,42.75699],[43.95517,42.55396],[43.73119,42.62043],[43.81453,42.74297],[43.0419,43.02413],[43.03322,43.08883],[42.75889,43.19651],[42.66667,43.13917],[42.40563,43.23226],[41.64935,43.22331],[40.65957,43.56212],[40.10657,43.57344],[40.04445,43.47776],[40.03312,43.44262],[40.01007,43.42411],[40.01552,43.42025],[40.00853,43.40578],[40.0078,43.38551],[39.81147,43.06294],[40.89217,41.72528],[41.54366,41.52185],[41.7148,41.4932],[41.7124,41.47417],[41.81939,41.43621],[41.95134,41.52466],[42.26387,41.49346],[42.51772,41.43606],[42.59202,41.58183],[42.72794,41.59714],[42.84471,41.58912],[42.78995,41.50126],[42.84899,41.47265],[42.8785,41.50516],[43.02956,41.37891],[43.21707,41.30331],[43.13373,41.25503],[43.1945,41.25242],[43.23096,41.17536],[43.36118,41.2028],[43.44973,41.17666],[43.4717,41.12611],[43.67712,41.13398],[43.74717,41.1117],[43.84835,41.16329],[44.16591,41.19141],[44.18148,41.24644],[44.32139,41.2079],[44.34337,41.20312],[44.34417,41.2382],[44.46791,41.18204],[44.59322,41.1933],[44.61462,41.24018],[44.72814,41.20338],[44.82084,41.21513],[44.87887,41.20195],[44.89911,41.21366],[44.84358,41.23088],[44.81749,41.23488],[44.80053,41.25949],[44.81437,41.30371],[44.93493,41.25685],[45.0133,41.29747],[45.09867,41.34065],[45.1797,41.42231],[45.26285,41.46433],[45.31352,41.47168],[45.4006,41.42402],[45.45973,41.45898],[45.68389,41.3539],[45.71035,41.36208],[45.75705,41.35157],[45.69946,41.29545],[45.80842,41.2229],[45.95786,41.17956],[46.13221,41.19479],[46.27698,41.19011],[46.37661,41.10805],[46.456,41.09984],[46.48558,41.0576],[46.55096,41.1104],[46.63969,41.09515],[46.66148,41.20533],[46.72375,41.28609],[46.63658,41.37727],[46.4669,41.43331],[46.40307,41.48464],[46.33925,41.4963],[46.29794,41.5724],[46.34126,41.57454],[46.34039,41.5947],[46.3253,41.60912],[46.28182,41.60089],[46.26531,41.63339],[46.24429,41.59883],[46.19759,41.62327],[46.17891,41.72094],[46.20538,41.77205],[46.23962,41.75811],[46.30863,41.79133],[46.3984,41.84399],[46.42738,41.91323]]]]}},{type:"Feature",properties:{iso1A2:"GF",iso1A3:"GUF",iso1N3:"254",wikidata:"Q3769",nameEn:"French Guiana",country:"FR",groups:["Q3320166","EU","005","419","019","UN"],callingCodes:["594"]},geometry:{type:"MultiPolygon",coordinates:[[[[-51.35485,4.8383],[-53.7094,6.2264],[-54.01074,5.68785],[-54.01877,5.52789],[-54.26916,5.26909],[-54.4717,4.91964],[-54.38444,4.13222],[-54.19367,3.84387],[-54.05128,3.63557],[-53.98914,3.627],[-53.9849,3.58697],[-54.28534,2.67798],[-54.42864,2.42442],[-54.6084,2.32856],[-54.16286,2.10779],[-53.78743,2.34412],[-52.96539,2.1881],[-52.6906,2.37298],[-52.31787,3.17896],[-51.85573,3.83427],[-51.82312,3.85825],[-51.79599,3.89336],[-51.61983,4.14596],[-51.63798,4.51394],[-51.35485,4.8383]]]]}},{type:"Feature",properties:{iso1A2:"GG",iso1A3:"GGY",iso1N3:"831",wikidata:"Q25230",nameEn:"Bailiwick of Guernsey",country:"GB"},geometry:null},{type:"Feature",properties:{iso1A2:"GH",iso1A3:"GHA",iso1N3:"288",wikidata:"Q117",nameEn:"Ghana",groups:["011","202","002","UN"],callingCodes:["233"]},geometry:{type:"MultiPolygon",coordinates:[[[[-.13493,11.14075],[-.27374,11.17157],[-.28566,11.12713],[-.35955,11.07801],[-.38219,11.12596],[-.42391,11.11661],[-.44298,11.04292],[-.61937,10.91305],[-.67143,10.99811],[-2.83373,11.0067],[-2.94232,10.64281],[-2.83108,10.40252],[-2.74174,9.83172],[-2.76534,9.56589],[-2.68802,9.49343],[-2.69814,9.22717],[-2.77799,9.04949],[-2.66357,9.01771],[-2.58243,8.7789],[-2.49037,8.20872],[-2.62901,8.11495],[-2.61232,8.02645],[-2.67787,8.02055],[-2.74819,7.92613],[-2.78395,7.94974],[-2.79467,7.86002],[-2.92339,7.60847],[-2.97822,7.27165],[-2.95438,7.23737],[-3.23327,6.81744],[-3.21954,6.74407],[-3.25999,6.62521],[-3.01896,5.71697],[-2.95323,5.71865],[-2.96671,5.6415],[-2.93132,5.62137],[-2.85378,5.65156],[-2.76614,5.60963],[-2.72737,5.34789],[-2.77625,5.34621],[-2.73074,5.1364],[-2.75502,5.10657],[-2.95261,5.12477],[-2.96554,5.10397],[-3.063,5.13665],[-3.11073,5.12675],[-3.10675,5.08515],[-3.34019,4.17519],[1.07031,5.15655],[1.27574,5.93551],[1.19771,6.11522],[1.19966,6.17069],[1.09187,6.17074],[1.05969,6.22998],[1.03108,6.24064],[.99652,6.33779],[.89283,6.33779],[.71048,6.53083],[.74862,6.56517],[.63659,6.63857],[.6497,6.73682],[.58176,6.76049],[.57406,6.80348],[.52853,6.82921],[.56508,6.92971],[.52098,6.94391],[.52217,6.9723],[.59606,7.01252],[.65327,7.31643],[.62943,7.41099],[.57223,7.39326],[.52455,7.45354],[.51979,7.58706],[.58295,7.62368],[.62943,7.85751],[.58891,8.12779],[.6056,8.13959],[.61156,8.18324],[.5913,8.19622],[.63897,8.25873],[.73432,8.29529],[.64731,8.48866],[.47211,8.59945],[.37319,8.75262],[.52455,8.87746],[.45424,9.04581],[.56388,9.40697],[.49118,9.48339],[.36485,9.49749],[.33148,9.44812],[.25758,9.42696],[.2254,9.47869],[.31241,9.50337],[.30406,9.521],[.2409,9.52335],[.23851,9.57389],[.38153,9.58682],[.36008,9.6256],[.29334,9.59387],[.26712,9.66437],[.28261,9.69022],[.32313,9.6491],[.34816,9.66907],[.34816,9.71607],[.32075,9.72781],[.36366,10.03309],[.41252,10.02018],[.41371,10.06361],[.35293,10.09412],[.39584,10.31112],[.33028,10.30408],[.29453,10.41546],[.18846,10.4096],[.12886,10.53149],[-.05945,10.63458],[-.09141,10.7147],[-.07327,10.71845],[-.07183,10.76794],[-.0228,10.81916],[-.02685,10.8783],[-.00908,10.91644],[-.0063,10.96417],[.03355,10.9807],[.02395,11.06229],[.00342,11.08317],[-.00514,11.10763],[-.0275,11.11202],[-.05733,11.08628],[-.14462,11.10811],[-.13493,11.14075]]]]}},{type:"Feature",properties:{iso1A2:"GI",iso1A3:"GIB",iso1N3:"292",wikidata:"Q1410",nameEn:"Gibraltar",country:"GB",groups:["Q12837","BOTS","039","150","UN"],callingCodes:["350"]},geometry:{type:"MultiPolygon",coordinates:[[[[-5.34064,36.03744],[-5.27801,36.14942],[-5.33822,36.15272],[-5.34536,36.15501],[-5.40526,36.15488],[-5.34064,36.03744]]]]}},{type:"Feature",properties:{iso1A2:"GL",iso1A3:"GRL",iso1N3:"304",wikidata:"Q223",nameEn:"Greenland",country:"DK",groups:["Q1451600","021","003","019","UN"],callingCodes:["299"]},geometry:{type:"MultiPolygon",coordinates:[[[[-49.33696,84.57952],[-68.21821,80.48551],[-77.52957,77.23408],[-46.37635,57.3249],[-9.68082,72.73731],[-5.7106,84.28058],[-49.33696,84.57952]]]]}},{type:"Feature",properties:{iso1A2:"GM",iso1A3:"GMB",iso1N3:"270",wikidata:"Q1005",nameEn:"The Gambia",groups:["011","202","002","UN"],callingCodes:["220"]},geometry:{type:"MultiPolygon",coordinates:[[[[-15.14917,13.57989],[-14.36795,13.23033],[-13.79409,13.34472],[-13.8955,13.59126],[-14.34721,13.46578],[-14.93719,13.80173],[-15.36504,13.79313],[-15.47902,13.58758],[-17.43598,13.59273],[-17.43966,13.04579],[-16.74676,13.06025],[-16.69343,13.16791],[-15.80355,13.16729],[-15.80478,13.34832],[-15.26908,13.37768],[-15.14917,13.57989]]]]}},{type:"Feature",properties:{iso1A2:"GN",iso1A3:"GIN",iso1N3:"324",wikidata:"Q1006",nameEn:"Guinea",groups:["011","202","002","UN"],callingCodes:["224"]},geometry:{type:"MultiPolygon",coordinates:[[[[-11.37536,12.40788],[-11.46267,12.44559],[-11.91331,12.42008],[-12.35415,12.32758],[-12.87336,12.51892],[-13.06603,12.49342],[-13.05296,12.64003],[-13.70523,12.68013],[-13.7039,12.60313],[-13.65089,12.49515],[-13.64168,12.42764],[-13.70851,12.24978],[-13.92745,12.24077],[-13.94589,12.16869],[-13.7039,12.00869],[-13.7039,11.70195],[-14.09799,11.63649],[-14.26623,11.67486],[-14.31513,11.60713],[-14.51173,11.49708],[-14.66677,11.51188],[-14.77786,11.36323],[-14.95993,10.99244],[-15.07174,10.89557],[-15.96748,10.162],[-14.36218,8.64107],[-13.29911,9.04245],[-13.18586,9.0925],[-13.08953,9.0409],[-12.94095,9.26335],[-12.76788,9.3133],[-12.47254,9.86834],[-12.24262,9.92386],[-12.12634,9.87203],[-11.91023,9.93927],[-11.89624,9.99763],[-11.2118,10.00098],[-10.6534,9.29919],[-10.74484,9.07998],[-10.5783,9.06386],[-10.56197,8.81225],[-10.47707,8.67669],[-10.61422,8.5314],[-10.70565,8.29235],[-10.63934,8.35326],[-10.54891,8.31174],[-10.37257,8.48941],[-10.27575,8.48711],[-10.203,8.47991],[-10.14579,8.52665],[-10.05375,8.50697],[-10.05873,8.42578],[-9.77763,8.54633],[-9.47415,8.35195],[-9.50898,8.18455],[-9.41445,8.02448],[-9.44928,7.9284],[-9.35724,7.74111],[-9.37465,7.62032],[-9.48161,7.37122],[-9.41943,7.41809],[-9.305,7.42056],[-9.20798,7.38109],[-9.18311,7.30461],[-9.09107,7.1985],[-8.93435,7.2824],[-8.85724,7.26019],[-8.8448,7.35149],[-8.72789,7.51429],[-8.67814,7.69428],[-8.55874,7.70167],[-8.55874,7.62525],[-8.47114,7.55676],[-8.4003,7.6285],[-8.21374,7.54466],[-8.09931,7.78626],[-8.13414,7.87991],[-8.06449,8.04989],[-7.94695,8.00925],[-7.99919,8.11023],[-7.98675,8.20134],[-8.062,8.16071],[-8.2411,8.24196],[-8.22991,8.48438],[-7.92518,8.50652],[-7.65653,8.36873],[-7.69882,8.66148],[-7.95503,8.81146],[-7.92518,8.99332],[-7.73862,9.08422],[-7.90777,9.20456],[-7.85056,9.41812],[-8.03463,9.39604],[-8.14657,9.55062],[-8.09434,9.86936],[-8.15652,9.94288],[-8.11921,10.04577],[-8.01225,10.1021],[-7.97971,10.17117],[-7.9578,10.2703],[-8.10207,10.44649],[-8.22711,10.41722],[-8.32614,10.69273],[-8.2667,10.91762],[-8.35083,11.06234],[-8.66923,10.99397],[-8.40058,11.37466],[-8.80854,11.66715],[-8.94784,12.34842],[-9.13689,12.50875],[-9.38067,12.48446],[-9.32097,12.29009],[-9.63938,12.18312],[-9.714,12.0226],[-10.30604,12.24634],[-10.71897,11.91552],[-10.80355,12.1053],[-10.99758,12.24634],[-11.24136,12.01286],[-11.50006,12.17826],[-11.37536,12.40788]]]]}},{type:"Feature",properties:{iso1A2:"GP",iso1A3:"GLP",iso1N3:"312",wikidata:"Q17012",nameEn:"Guadeloupe",country:"FR",groups:["Q3320166","EU","029","003","419","019","UN"],callingCodes:["590"]},geometry:{type:"MultiPolygon",coordinates:[[[[-60.03183,16.1129],[-61.60296,16.73066],[-63.00549,15.26166],[-60.03183,16.1129]]]]}},{type:"Feature",properties:{iso1A2:"GQ",iso1A3:"GNQ",iso1N3:"226",wikidata:"Q983",nameEn:"Equatorial Guinea",groups:["017","202","002","UN"],callingCodes:["240"]},geometry:{type:"MultiPolygon",coordinates:[[[[9.22018,3.72052],[8.34397,4.30689],[7.71762,.6674],[3.35016,-3.29031],[9.66433,1.06723],[9.75065,1.06753],[9.79648,1.0019],[11.35307,1.00251],[11.3561,2.17217],[9.991,2.16561],[9.90749,2.20049],[9.89012,2.20457],[9.84716,2.24676],[9.83238,2.29079],[9.83754,2.32428],[9.82123,2.35097],[9.81162,2.33797],[9.22018,3.72052]]]]}},{type:"Feature",properties:{iso1A2:"GR",iso1A3:"GRC",iso1N3:"300",wikidata:"Q41",nameEn:"Greece",aliases:["EL"],groups:["EU","039","150","UN"],callingCodes:["30"]},geometry:{type:"MultiPolygon",coordinates:[[[[26.03489,40.73051],[26.0754,40.72772],[26.08638,40.73214],[26.12495,40.74283],[26.12854,40.77339],[26.15685,40.80709],[26.21351,40.83298],[26.20856,40.86048],[26.26169,40.9168],[26.29441,40.89119],[26.28623,40.93005],[26.32259,40.94042],[26.35894,40.94292],[26.33297,40.98388],[26.3606,41.02027],[26.31928,41.07386],[26.32259,41.24929],[26.39861,41.25053],[26.5209,41.33993],[26.5837,41.32131],[26.62997,41.34613],[26.61767,41.42281],[26.59742,41.48058],[26.59196,41.60491],[26.5209,41.62592],[26.47958,41.67037],[26.35957,41.71149],[26.30255,41.70925],[26.2654,41.71544],[26.22888,41.74139],[26.21325,41.73223],[26.16841,41.74858],[26.06148,41.70345],[26.07083,41.64584],[26.15146,41.60828],[26.14328,41.55496],[26.17951,41.55409],[26.176,41.50072],[26.14796,41.47533],[26.20288,41.43943],[26.16548,41.42278],[26.12926,41.35878],[25.87919,41.30526],[25.8266,41.34563],[25.70507,41.29209],[25.66183,41.31316],[25.61042,41.30614],[25.55082,41.31667],[25.52394,41.2798],[25.48187,41.28506],[25.28322,41.23411],[25.11611,41.34212],[24.942,41.38685],[24.90928,41.40876],[24.86136,41.39298],[24.82514,41.4035],[24.8041,41.34913],[24.71529,41.41928],[24.61129,41.42278],[24.52599,41.56808],[24.30513,41.51297],[24.27124,41.57682],[24.18126,41.51735],[24.10063,41.54796],[24.06323,41.53222],[24.06908,41.46132],[23.96975,41.44118],[23.91483,41.47971],[23.89613,41.45257],[23.80148,41.43943],[23.76525,41.40175],[23.67644,41.41139],[23.63203,41.37632],[23.52453,41.40262],[23.40416,41.39999],[23.33639,41.36317],[23.31301,41.40525],[23.22771,41.37106],[23.21953,41.33773],[23.1833,41.31755],[22.93334,41.34104],[22.81199,41.3398],[22.76408,41.32225],[22.74538,41.16321],[22.71266,41.13945],[22.65306,41.18168],[22.62852,41.14385],[22.58295,41.11568],[22.5549,41.13065],[22.42285,41.11921],[22.26744,41.16409],[22.17629,41.15969],[22.1424,41.12449],[22.06527,41.15617],[21.90869,41.09191],[21.91102,41.04786],[21.7556,40.92525],[21.69601,40.9429],[21.57448,40.86076],[21.53007,40.90759],[21.41555,40.9173],[21.35595,40.87578],[21.25779,40.86165],[21.21105,40.8855],[21.15262,40.85546],[20.97887,40.85475],[20.98396,40.79109],[20.95752,40.76982],[20.98134,40.76046],[21.05833,40.66586],[21.03932,40.56299],[20.96908,40.51526],[20.94925,40.46625],[20.83688,40.47882],[20.7906,40.42726],[20.78234,40.35803],[20.71789,40.27739],[20.67162,40.09433],[20.62566,40.0897],[20.61081,40.07866],[20.55593,40.06524],[20.51297,40.08168],[20.48487,40.06271],[20.42373,40.06777],[20.37911,39.99058],[20.31135,39.99438],[20.41546,39.82832],[20.41475,39.81437],[20.38572,39.78516],[20.30804,39.81563],[20.29152,39.80421],[20.31961,39.72799],[20.27412,39.69884],[20.22707,39.67459],[20.22376,39.64532],[20.15988,39.652],[20.12956,39.65805],[20.05189,39.69112],[20.00957,39.69227],[19.98042,39.6504],[19.92466,39.69533],[19.97622,39.78684],[19.95905,39.82857],[19.0384,40.35325],[19.20409,39.7532],[22.5213,33.45682],[29.73302,35.92555],[29.69611,36.10365],[29.61805,36.14179],[29.61002,36.1731],[29.48192,36.18377],[29.30783,36.01033],[28.23708,36.56812],[27.95037,36.46155],[27.89482,36.69898],[27.46117,36.53789],[27.24613,36.71622],[27.45627,36.9008],[27.20312,36.94571],[27.14757,37.32],[26.95583,37.64989],[26.99377,37.69034],[27.16428,37.72343],[27.05537,37.9131],[26.21136,38.17558],[26.24183,38.44695],[26.32173,38.48731],[26.21136,38.65436],[26.61814,38.81372],[26.70773,39.0312],[26.43357,39.43096],[25.94257,39.39358],[25.61285,40.17161],[26.04292,40.3958],[25.94795,40.72797],[26.03489,40.73051]]]]}},{type:"Feature",properties:{iso1A2:"GS",iso1A3:"SGS",iso1N3:"239",wikidata:"Q35086",nameEn:"South Georgia and South Sandwich Islands",country:"GB",groups:["BOTS","005","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["500"]},geometry:{type:"MultiPolygon",coordinates:[[[[-35.26394,-43.68272],[-53.39656,-59.87088],[-22.31757,-59.85974],[-35.26394,-43.68272]]]]}},{type:"Feature",properties:{iso1A2:"GT",iso1A3:"GTM",iso1N3:"320",wikidata:"Q774",nameEn:"Guatemala",groups:["013","003","419","019","UN"],callingCodes:["502"]},geometry:{type:"MultiPolygon",coordinates:[[[[-89.14985,17.81563],[-90.98678,17.81655],[-90.99199,17.25192],[-91.43809,17.25373],[-91.04436,16.92175],[-90.69064,16.70697],[-90.61212,16.49832],[-90.40499,16.40524],[-90.44567,16.07573],[-91.73182,16.07371],[-92.20983,15.26077],[-92.0621,15.07406],[-92.1454,14.98143],[-92.1423,14.88647],[-92.18161,14.84147],[-92.1454,14.6804],[-92.2261,14.53423],[-92.37213,14.39277],[-90.55276,12.8866],[-90.11344,13.73679],[-90.10505,13.85104],[-89.88937,14.0396],[-89.81807,14.07073],[-89.76103,14.02923],[-89.73251,14.04133],[-89.75569,14.07073],[-89.70756,14.1537],[-89.61844,14.21937],[-89.52397,14.22628],[-89.50614,14.26084],[-89.58814,14.33165],[-89.57441,14.41637],[-89.39028,14.44561],[-89.34776,14.43013],[-89.35189,14.47553],[-89.23719,14.58046],[-89.15653,14.57802],[-89.13132,14.71582],[-89.23467,14.85596],[-89.15149,14.97775],[-89.18048,14.99967],[-89.15149,15.07392],[-88.97343,15.14039],[-88.32467,15.63665],[-88.31459,15.66942],[-88.24022,15.69247],[-88.22552,15.72294],[-88.20359,16.03858],[-88.40779,16.09624],[-88.95358,15.88698],[-89.02415,15.9063],[-89.17418,15.90898],[-89.22683,15.88619],[-89.15025,17.04813],[-89.14985,17.81563]]]]}},{type:"Feature",properties:{iso1A2:"GU",iso1A3:"GUM",iso1N3:"316",wikidata:"Q16635",nameEn:"Guam",aliases:["US-GU"],country:"US",groups:["Q1352230","Q153732","057","009","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 671"]},geometry:{type:"MultiPolygon",coordinates:[[[[146.25931,13.85876],[143.82485,13.92273],[144.61642,12.82462],[146.25931,13.85876]]]]}},{type:"Feature",properties:{iso1A2:"GW",iso1A3:"GNB",iso1N3:"624",wikidata:"Q1007",nameEn:"Guinea-Bissau",groups:["011","202","002","UN"],callingCodes:["245"]},geometry:{type:"MultiPolygon",coordinates:[[[[-14.31513,11.60713],[-14.26623,11.67486],[-14.09799,11.63649],[-13.7039,11.70195],[-13.7039,12.00869],[-13.94589,12.16869],[-13.92745,12.24077],[-13.70851,12.24978],[-13.64168,12.42764],[-13.65089,12.49515],[-13.7039,12.60313],[-13.70523,12.68013],[-15.17582,12.6847],[-15.67302,12.42974],[-16.20591,12.46157],[-16.38191,12.36449],[-16.70562,12.34803],[-17.4623,11.92379],[-15.96748,10.162],[-15.07174,10.89557],[-14.95993,10.99244],[-14.77786,11.36323],[-14.66677,11.51188],[-14.51173,11.49708],[-14.31513,11.60713]]]]}},{type:"Feature",properties:{iso1A2:"GY",iso1A3:"GUY",iso1N3:"328",wikidata:"Q734",nameEn:"Guyana",groups:["005","419","019","UN"],driveSide:"left",callingCodes:["592"]},geometry:{type:"MultiPolygon",coordinates:[[[[-56.84822,6.73257],[-59.54058,8.6862],[-59.98508,8.53046],[-59.85562,8.35213],[-59.80661,8.28906],[-59.83156,8.23261],[-59.97059,8.20791],[-60.02407,8.04557],[-60.38056,7.8302],[-60.51959,7.83373],[-60.64793,7.56877],[-60.71923,7.55817],[-60.59802,7.33194],[-60.63367,7.25061],[-60.54098,7.14804],[-60.44116,7.20817],[-60.28074,7.1162],[-60.39419,6.94847],[-60.54873,6.8631],[-61.13632,6.70922],[-61.20762,6.58174],[-61.15058,6.19558],[-61.4041,5.95304],[-60.73204,5.20931],[-60.32352,5.21299],[-60.20944,5.28754],[-59.98129,5.07097],[-60.04189,4.69801],[-60.15953,4.53456],[-59.78878,4.45637],[-59.69361,4.34069],[-59.73353,4.20399],[-59.51963,3.91951],[-59.86899,3.57089],[-59.79769,3.37162],[-59.99733,2.92312],[-59.91177,2.36759],[-59.7264,2.27497],[-59.74066,1.87596],[-59.25583,1.40559],[-58.92072,1.31293],[-58.84229,1.17749],[-58.53571,1.29154],[-58.4858,1.48399],[-58.33887,1.58014],[-58.01873,1.51966],[-57.97336,1.64566],[-57.77281,1.73344],[-57.55743,1.69605],[-57.35073,1.98327],[-57.23981,1.95808],[-57.09109,2.01854],[-57.07092,1.95304],[-56.7659,1.89509],[-56.47045,1.95135],[-56.55439,2.02003],[-56.70519,2.02964],[-57.35891,3.32121],[-58.0307,3.95513],[-57.8699,4.89394],[-57.37442,5.0208],[-57.22536,5.15605],[-57.31629,5.33714],[-56.84822,6.73257]]]]}},{type:"Feature",properties:{iso1A2:"HK",iso1A3:"HKG",iso1N3:"344",wikidata:"Q8646",nameEn:"Hong Kong",country:"CN",groups:["030","142","UN"],driveSide:"left",callingCodes:["852"]},geometry:{type:"MultiPolygon",coordinates:[[[[113.92195,22.13873],[114.50148,22.15017],[114.44998,22.55977],[114.25154,22.55977],[114.22888,22.5436],[114.22185,22.55343],[114.20655,22.55706],[114.18338,22.55444],[114.17247,22.55944],[114.1597,22.56041],[114.15123,22.55163],[114.1482,22.54091],[114.13823,22.54319],[114.12665,22.54003],[114.11656,22.53415],[114.11181,22.52878],[114.1034,22.5352],[114.09692,22.53435],[114.09048,22.53716],[114.08606,22.53276],[114.07817,22.52997],[114.07267,22.51855],[114.06272,22.51617],[114.05729,22.51104],[114.05438,22.5026],[114.03113,22.5065],[113.86771,22.42972],[113.81621,22.2163],[113.83338,22.1826],[113.92195,22.13873]]]]}},{type:"Feature",properties:{iso1A2:"HM",iso1A3:"HMD",iso1N3:"334",wikidata:"Q131198",nameEn:"Heard Island and McDonald Islands",country:"AU",groups:["053","009","UN"],driveSide:"left"},geometry:{type:"MultiPolygon",coordinates:[[[[71.08716,-53.87687],[75.44182,-53.99822],[72.87012,-51.48322],[71.08716,-53.87687]]]]}},{type:"Feature",properties:{iso1A2:"HN",iso1A3:"HND",iso1N3:"340",wikidata:"Q783",nameEn:"Honduras",groups:["013","003","419","019","UN"],callingCodes:["504"]},geometry:{type:"MultiPolygon",coordinates:[[[[-83.86109,17.73736],[-88.20359,16.03858],[-88.22552,15.72294],[-88.24022,15.69247],[-88.31459,15.66942],[-88.32467,15.63665],[-88.97343,15.14039],[-89.15149,15.07392],[-89.18048,14.99967],[-89.15149,14.97775],[-89.23467,14.85596],[-89.13132,14.71582],[-89.15653,14.57802],[-89.23719,14.58046],[-89.35189,14.47553],[-89.34776,14.43013],[-89.04187,14.33644],[-88.94608,14.20207],[-88.85785,14.17763],[-88.815,14.11652],[-88.73182,14.10919],[-88.70661,14.04317],[-88.49738,13.97224],[-88.48982,13.86458],[-88.25791,13.91108],[-88.23018,13.99915],[-88.07641,13.98447],[-88.00331,13.86948],[-87.7966,13.91353],[-87.68821,13.80829],[-87.73106,13.75443],[-87.78148,13.52906],[-87.71657,13.50577],[-87.72115,13.46083],[-87.73841,13.44169],[-87.77354,13.45767],[-87.83467,13.44655],[-87.84675,13.41078],[-87.80177,13.35689],[-87.73714,13.32715],[-87.69751,13.25228],[-87.55124,13.12523],[-87.37107,12.98646],[-87.06306,13.00892],[-87.03785,12.98682],[-86.93197,13.05313],[-86.93383,13.18677],[-86.87066,13.30641],[-86.71267,13.30348],[-86.76812,13.79605],[-86.35219,13.77157],[-86.14801,14.04317],[-86.00685,14.08474],[-86.03458,13.99181],[-85.75477,13.8499],[-85.73964,13.9698],[-85.45762,14.11304],[-85.32149,14.2562],[-85.18602,14.24929],[-85.1575,14.53934],[-84.90082,14.80489],[-84.82596,14.82212],[-84.70119,14.68078],[-84.48373,14.63249],[-84.10584,14.76353],[-83.89551,14.76697],[-83.62101,14.89448],[-83.49268,15.01158],[-83.13724,15.00002],[-83.04763,15.03256],[-82.06974,14.49418],[-81.58685,18.0025],[-83.86109,17.73736]]]]}},{type:"Feature",properties:{iso1A2:"HR",iso1A3:"HRV",iso1N3:"191",wikidata:"Q224",nameEn:"Croatia",groups:["EU","039","150","UN"],callingCodes:["385"]},geometry:{type:"MultiPolygon",coordinates:[[[[17.6444,42.88641],[17.5392,42.92787],[17.70879,42.97223],[17.64268,43.08595],[17.46986,43.16559],[17.286,43.33065],[17.25579,43.40353],[17.29699,43.44542],[17.24411,43.49376],[17.15828,43.49376],[17.00585,43.58037],[16.80736,43.76011],[16.75316,43.77157],[16.70922,43.84887],[16.55472,43.95326],[16.50528,44.0244],[16.43629,44.02826],[16.43662,44.07523],[16.36864,44.08263],[16.18688,44.27012],[16.21346,44.35231],[16.12969,44.38275],[16.16814,44.40679],[16.10566,44.52586],[16.03012,44.55572],[16.00884,44.58605],[16.05828,44.61538],[15.89348,44.74964],[15.8255,44.71501],[15.72584,44.82334],[15.79472,44.8455],[15.76096,44.87045],[15.74723,44.96818],[15.78568,44.97401],[15.74585,45.0638],[15.78842,45.11519],[15.76371,45.16508],[15.83512,45.22459],[15.98412,45.23088],[16.12153,45.09616],[16.29036,44.99732],[16.35404,45.00241],[16.35863,45.03529],[16.3749,45.05206],[16.38219,45.05139],[16.38309,45.05955],[16.40023,45.1147],[16.4634,45.14522],[16.49155,45.21153],[16.52982,45.22713],[16.5501,45.2212],[16.56559,45.22307],[16.60194,45.23042],[16.64962,45.20714],[16.74845,45.20393],[16.78219,45.19002],[16.81137,45.18434],[16.83804,45.18951],[16.92405,45.27607],[16.9385,45.22742],[17.0415,45.20759],[17.18438,45.14764],[17.24325,45.146],[17.25131,45.14957],[17.26815,45.18444],[17.32092,45.16246],[17.33573,45.14521],[17.41229,45.13335],[17.4498,45.16119],[17.45615,45.12523],[17.47589,45.12656],[17.51469,45.10791],[17.59104,45.10816],[17.66571,45.13408],[17.84826,45.04489],[17.87148,45.04645],[17.93706,45.08016],[17.97336,45.12245],[17.97834,45.13831],[17.99479,45.14958],[18.01594,45.15163],[18.03121,45.12632],[18.1624,45.07654],[18.24387,45.13699],[18.32077,45.1021],[18.41896,45.11083],[18.47939,45.05871],[18.65723,45.07544],[18.78357,44.97741],[18.80661,44.93561],[18.76369,44.93707],[18.76347,44.90669],[18.8704,44.85097],[19.01994,44.85493],[18.98957,44.90645],[19.02871,44.92541],[19.06853,44.89915],[19.15573,44.95409],[19.05205,44.97692],[19.1011,45.01191],[19.07952,45.14668],[19.14063,45.12972],[19.19144,45.17863],[19.43589,45.17137],[19.41941,45.23475],[19.28208,45.23813],[19.10774,45.29547],[18.97446,45.37528],[18.99918,45.49333],[19.08364,45.48804],[19.07471,45.53086],[18.94562,45.53712],[18.88776,45.57253],[18.96691,45.66731],[18.90305,45.71863],[18.85783,45.85493],[18.81394,45.91329],[18.80211,45.87995],[18.6792,45.92057],[18.57483,45.80772],[18.44368,45.73972],[18.12439,45.78905],[18.08869,45.76511],[17.99805,45.79671],[17.87377,45.78522],[17.66545,45.84207],[17.56821,45.93728],[17.35672,45.95209],[17.14592,46.16697],[16.8903,46.28122],[16.8541,46.36255],[16.7154,46.39523],[16.6639,46.45203],[16.59527,46.47524],[16.52604,46.47831],[16.5007,46.49644],[16.44036,46.5171],[16.38771,46.53608],[16.37193,46.55008],[16.29793,46.5121],[16.26733,46.51505],[16.26759,46.50566],[16.23961,46.49653],[16.25124,46.48067],[16.27398,46.42875],[16.27329,46.41467],[16.30162,46.40437],[16.30233,46.37837],[16.18824,46.38282],[16.14859,46.40547],[16.05281,46.39141],[16.05065,46.3833],[16.07314,46.36458],[16.07616,46.3463],[15.97965,46.30652],[15.79284,46.25811],[15.78817,46.21719],[15.75479,46.20336],[15.75436,46.21969],[15.67395,46.22478],[15.6434,46.21396],[15.64904,46.19229],[15.59909,46.14761],[15.6083,46.11992],[15.62317,46.09103],[15.72977,46.04682],[15.71246,46.01196],[15.70327,46.00015],[15.70636,45.92116],[15.67967,45.90455],[15.68383,45.88867],[15.68232,45.86819],[15.70411,45.8465],[15.66662,45.84085],[15.64185,45.82915],[15.57952,45.84953],[15.52234,45.82195],[15.47325,45.8253],[15.47531,45.79802],[15.40836,45.79491],[15.25423,45.72275],[15.30872,45.69014],[15.34919,45.71623],[15.4057,45.64727],[15.38952,45.63682],[15.34214,45.64702],[15.34695,45.63382],[15.31027,45.6303],[15.27747,45.60504],[15.29837,45.5841],[15.30249,45.53224],[15.38188,45.48752],[15.33051,45.45258],[15.27758,45.46678],[15.16862,45.42309],[15.05187,45.49079],[15.02385,45.48533],[14.92266,45.52788],[14.90554,45.47769],[14.81992,45.45913],[14.80124,45.49515],[14.71718,45.53442],[14.68605,45.53006],[14.69694,45.57366],[14.59576,45.62812],[14.60977,45.66403],[14.57397,45.67165],[14.53816,45.6205],[14.5008,45.60852],[14.49769,45.54424],[14.36693,45.48642],[14.32487,45.47142],[14.27681,45.4902],[14.26611,45.48239],[14.24239,45.50607],[14.22371,45.50388],[14.20348,45.46896],[14.07116,45.48752],[14.00578,45.52352],[13.96063,45.50825],[13.99488,45.47551],[13.97309,45.45258],[13.90771,45.45149],[13.88124,45.42637],[13.81742,45.43729],[13.7785,45.46787],[13.67398,45.4436],[13.62902,45.45898],[13.56979,45.4895],[13.45644,45.59464],[13.05142,45.33128],[13.12821,44.48877],[16.15283,42.18525],[18.45131,42.21682],[18.54128,42.39171],[18.52152,42.42302],[18.43588,42.48556],[18.44307,42.51077],[18.43735,42.55921],[18.36197,42.61423],[18.24318,42.6112],[17.88201,42.83668],[17.80854,42.9182],[17.7948,42.89556],[17.68151,42.92725],[17.6444,42.88641]]]]}},{type:"Feature",properties:{iso1A2:"HT",iso1A3:"HTI",iso1N3:"332",wikidata:"Q790",nameEn:"Haiti",aliases:["RH"],groups:["029","003","419","019","UN"],callingCodes:["509"]},geometry:{type:"MultiPolygon",coordinates:[[[[-71.71885,18.78423],[-71.72624,18.87802],[-71.77766,18.95007],[-71.88102,18.95007],[-71.74088,19.0437],[-71.71088,19.08353],[-71.69938,19.10916],[-71.65337,19.11759],[-71.62642,19.21212],[-71.73229,19.26686],[-71.77766,19.33823],[-71.69448,19.37866],[-71.6802,19.45008],[-71.71268,19.53374],[-71.71449,19.55364],[-71.7429,19.58445],[-71.75865,19.70231],[-71.77419,19.73128],[-72.38946,20.27111],[-73.37289,20.43199],[-74.7289,18.71009],[-74.76465,18.06252],[-72.29523,17.48026],[-71.75671,18.03456],[-71.73783,18.07177],[-71.74994,18.11115],[-71.75465,18.14405],[-71.78271,18.18302],[-71.69952,18.34101],[-71.90875,18.45821],[-71.88102,18.50125],[-72.00201,18.62312],[-71.95412,18.64939],[-71.82556,18.62551],[-71.71885,18.78423]]]]}},{type:"Feature",properties:{iso1A2:"HU",iso1A3:"HUN",iso1N3:"348",wikidata:"Q28",nameEn:"Hungary",groups:["EU","151","150","UN"],callingCodes:["36"]},geometry:{type:"MultiPolygon",coordinates:[[[[21.72525,48.34628],[21.67134,48.3989],[21.6068,48.50365],[21.44063,48.58456],[21.11516,48.49546],[20.83248,48.5824],[20.5215,48.53336],[20.29943,48.26104],[20.24312,48.2784],[19.92452,48.1283],[19.63338,48.25006],[19.52489,48.19791],[19.47957,48.09437],[19.28182,48.08336],[19.23924,48.0595],[19.01952,48.07052],[18.82176,48.04206],[18.76134,47.97499],[18.76821,47.87469],[18.8506,47.82308],[18.74074,47.8157],[18.66521,47.76772],[18.56496,47.76588],[18.29305,47.73541],[18.02938,47.75665],[17.71215,47.7548],[17.23699,48.02094],[17.16001,48.00636],[17.09786,47.97336],[17.11022,47.92461],[17.08275,47.87719],[17.00997,47.86245],[17.07039,47.81129],[17.05048,47.79377],[17.08893,47.70928],[16.87538,47.68895],[16.86509,47.72268],[16.82938,47.68432],[16.7511,47.67878],[16.72089,47.73469],[16.65679,47.74197],[16.61183,47.76171],[16.54779,47.75074],[16.53514,47.73837],[16.55129,47.72268],[16.4222,47.66537],[16.58699,47.61772],[16.64193,47.63114],[16.71059,47.52692],[16.64821,47.50155],[16.6718,47.46139],[16.57152,47.40868],[16.52414,47.41007],[16.49908,47.39416],[16.45104,47.41181],[16.47782,47.25918],[16.44142,47.25079],[16.43663,47.21127],[16.41739,47.20649],[16.42801,47.18422],[16.4523,47.18812],[16.46442,47.16845],[16.44932,47.14418],[16.52863,47.13974],[16.46134,47.09395],[16.52176,47.05747],[16.43936,47.03548],[16.51369,47.00084],[16.28202,47.00159],[16.27594,46.9643],[16.22403,46.939],[16.19904,46.94134],[16.10983,46.867],[16.14365,46.8547],[16.15711,46.85434],[16.21892,46.86961],[16.2365,46.87775],[16.2941,46.87137],[16.34547,46.83836],[16.3408,46.80641],[16.31303,46.79838],[16.30966,46.7787],[16.37816,46.69975],[16.42641,46.69228],[16.41863,46.66238],[16.38594,46.6549],[16.39217,46.63673],[16.50139,46.56684],[16.52885,46.53303],[16.52604,46.5051],[16.59527,46.47524],[16.6639,46.45203],[16.7154,46.39523],[16.8541,46.36255],[16.8903,46.28122],[17.14592,46.16697],[17.35672,45.95209],[17.56821,45.93728],[17.66545,45.84207],[17.87377,45.78522],[17.99805,45.79671],[18.08869,45.76511],[18.12439,45.78905],[18.44368,45.73972],[18.57483,45.80772],[18.6792,45.92057],[18.80211,45.87995],[18.81394,45.91329],[18.99712,45.93537],[19.01284,45.96529],[19.0791,45.96458],[19.10388,46.04015],[19.14543,45.9998],[19.28826,45.99694],[19.52473,46.1171],[19.56113,46.16824],[19.66007,46.19005],[19.81491,46.1313],[19.93508,46.17553],[20.01816,46.17696],[20.03533,46.14509],[20.09713,46.17315],[20.26068,46.12332],[20.28324,46.1438],[20.35573,46.16629],[20.45377,46.14405],[20.49718,46.18721],[20.63863,46.12728],[20.76085,46.21002],[20.74574,46.25467],[20.86797,46.28884],[21.06572,46.24897],[21.16872,46.30118],[21.28061,46.44941],[21.26929,46.4993],[21.33214,46.63035],[21.43926,46.65109],[21.5151,46.72147],[21.48935,46.7577],[21.52028,46.84118],[21.59307,46.86935],[21.59581,46.91628],[21.68645,46.99595],[21.648,47.03902],[21.78395,47.11104],[21.94463,47.38046],[22.01055,47.37767],[22.03389,47.42508],[22.00917,47.50492],[22.31816,47.76126],[22.41979,47.7391],[22.46559,47.76583],[22.67247,47.7871],[22.76617,47.8417],[22.77991,47.87211],[22.89849,47.95851],[22.84276,47.98602],[22.87847,48.04665],[22.81804,48.11363],[22.73427,48.12005],[22.66835,48.09162],[22.58733,48.10813],[22.59007,48.15121],[22.49806,48.25189],[22.38133,48.23726],[22.2083,48.42534],[22.14689,48.4005],[21.83339,48.36242],[21.8279,48.33321],[21.72525,48.34628]]]]}},{type:"Feature",properties:{iso1A2:"IC",wikidata:"Q5813",nameEn:"Canary Islands",country:"ES",groups:["Q3320166","Q105472","EU","039","150","UN"],isoStatus:"excRes",callingCodes:["34"]},geometry:{type:"MultiPolygon",coordinates:[[[[-12.00985,30.24121],[-25.3475,27.87574],[-14.43883,27.02969],[-12.00985,30.24121]]]]}},{type:"Feature",properties:{iso1A2:"ID",iso1A3:"IDN",iso1N3:"360",wikidata:"Q252",nameEn:"Indonesia",aliases:["RI"]},geometry:null},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-6.26218,54.09785],[-6.29003,54.11278],[-6.32694,54.09337],[-6.36279,54.11248],[-6.36605,54.07234],[-6.47849,54.06947],[-6.62842,54.03503],[-6.66264,54.0666],[-6.6382,54.17071],[-6.70175,54.20218],[-6.74575,54.18788],[-6.81583,54.22791],[-6.85179,54.29176],[-6.87775,54.34682],[-7.02034,54.4212],[-7.19145,54.31296],[-7.14908,54.22732],[-7.25012,54.20063],[-7.26316,54.13863],[-7.29493,54.12013],[-7.29687,54.1354],[-7.28017,54.16714],[-7.29157,54.17191],[-7.34005,54.14698],[-7.30553,54.11869],[-7.32834,54.11475],[-7.44567,54.1539],[-7.4799,54.12239],[-7.55812,54.12239],[-7.69501,54.20731],[-7.81397,54.20159],[-7.8596,54.21779],[-7.87101,54.29299],[-8.04555,54.36292],[-8.179,54.46763],[-8.04538,54.48941],[-7.99812,54.54427],[-7.8596,54.53671],[-7.70315,54.62077],[-7.93293,54.66603],[-7.83352,54.73854],[-7.75041,54.7103],[-7.64449,54.75265],[-7.54671,54.74606],[-7.54508,54.79401],[-7.47626,54.83084],[-7.4473,54.87003],[-7.44404,54.9403],[-7.40004,54.94498],[-7.4033,55.00391],[-7.34464,55.04688],[-7.2471,55.06933],[-6.34755,55.49206],[-7.75229,55.93854],[-11.75,54],[-11,51],[-6.03913,51.13217],[-5.37267,53.63269],[-6.26218,54.09785]]]]},properties:{iso1A2:"IE",iso1A3:"IRL",iso1N3:"372",wikidata:"Q27",nameEn:"Republic of Ireland",groups:["EU","Q22890","154","150","UN"],driveSide:"left",callingCodes:["353"]}},{type:"Feature",properties:{iso1A2:"IL",iso1A3:"ISR",iso1N3:"376",wikidata:"Q801",nameEn:"Israel",groups:["145","142","UN"],callingCodes:["972"]},geometry:{type:"MultiPolygon",coordinates:[[[[34.052,31.46619],[34.29262,31.70393],[34.48681,31.59711],[34.56797,31.54197],[34.48892,31.48365],[34.40077,31.40926],[34.36505,31.36404],[34.37381,31.30598],[34.36523,31.28963],[34.29417,31.24194],[34.26742,31.21998],[34.92298,29.45305],[34.97718,29.54294],[34.98207,29.58147],[35.02147,29.66343],[35.14108,30.07374],[35.19183,30.34636],[35.16218,30.43535],[35.19595,30.50297],[35.21379,30.60401],[35.29311,30.71365],[35.33456,30.81224],[35.33984,30.8802],[35.41371,30.95565],[35.43658,31.12444],[35.40316,31.25535],[35.47672,31.49578],[35.39675,31.49572],[35.22921,31.37445],[35.13033,31.3551],[35.02459,31.35979],[34.92571,31.34337],[34.88932,31.37093],[34.87833,31.39321],[34.89756,31.43891],[34.93258,31.47816],[34.94356,31.50743],[34.9415,31.55601],[34.95249,31.59813],[35.00879,31.65426],[35.08226,31.69107],[35.10782,31.71594],[35.11895,31.71454],[35.12933,31.7325],[35.13931,31.73012],[35.15119,31.73634],[35.15474,31.73352],[35.16478,31.73242],[35.18023,31.72067],[35.20538,31.72388],[35.21937,31.71578],[35.22392,31.71899],[35.23972,31.70896],[35.24315,31.71244],[35.2438,31.7201],[35.24981,31.72543],[35.25182,31.73945],[35.26319,31.74846],[35.25225,31.7678],[35.26058,31.79064],[35.25573,31.81362],[35.26404,31.82567],[35.251,31.83085],[35.25753,31.8387],[35.24816,31.8458],[35.2304,31.84222],[35.2249,31.85433],[35.22817,31.8638],[35.22567,31.86745],[35.22294,31.87889],[35.22014,31.88264],[35.2136,31.88241],[35.21276,31.88153],[35.21016,31.88237],[35.20945,31.8815],[35.20791,31.8821],[35.20673,31.88151],[35.20381,31.86716],[35.21128,31.863],[35.216,31.83894],[35.21469,31.81835],[35.19461,31.82687],[35.18169,31.82542],[35.18603,31.80901],[35.14174,31.81325],[35.07677,31.85627],[35.05617,31.85685],[35.01978,31.82944],[34.9724,31.83352],[34.99712,31.85569],[35.03489,31.85919],[35.03978,31.89276],[35.03489,31.92448],[35.00124,31.93264],[34.98682,31.96935],[35.00261,32.027],[34.9863,32.09551],[34.99437,32.10962],[34.98507,32.12606],[34.99039,32.14626],[34.96009,32.17503],[34.95703,32.19522],[34.98885,32.20758],[35.01841,32.23981],[35.02939,32.2671],[35.01119,32.28684],[35.01772,32.33863],[35.04243,32.35008],[35.05142,32.3667],[35.0421,32.38242],[35.05311,32.4024],[35.05423,32.41754],[35.07059,32.4585],[35.08564,32.46948],[35.09236,32.47614],[35.10024,32.47856],[35.10882,32.4757],[35.15937,32.50466],[35.2244,32.55289],[35.25049,32.52453],[35.29306,32.50947],[35.30685,32.51024],[35.35212,32.52047],[35.40224,32.50136],[35.42034,32.46009],[35.41598,32.45593],[35.41048,32.43706],[35.42078,32.41562],[35.55807,32.38674],[35.55494,32.42687],[35.57485,32.48669],[35.56614,32.64393],[35.59813,32.65159],[35.61669,32.67999],[35.66527,32.681],[35.68467,32.70715],[35.75983,32.74803],[35.78745,32.77938],[35.83758,32.82817],[35.84021,32.8725],[35.87012,32.91976],[35.89298,32.9456],[35.87188,32.98028],[35.84802,33.1031],[35.81911,33.11077],[35.81911,33.1336],[35.84285,33.16673],[35.83846,33.19397],[35.81647,33.2028],[35.81295,33.24841],[35.77513,33.27342],[35.813,33.3172],[35.77477,33.33609],[35.62019,33.27278],[35.62283,33.24226],[35.58502,33.26653],[35.58326,33.28381],[35.56523,33.28969],[35.55555,33.25844],[35.54544,33.25513],[35.54808,33.236],[35.5362,33.23196],[35.54228,33.19865],[35.52573,33.11921],[35.50335,33.114],[35.50272,33.09056],[35.448,33.09264],[35.43059,33.06659],[35.35223,33.05617],[35.31429,33.10515],[35.1924,33.08743],[35.10645,33.09318],[34.78515,33.20368],[33.62659,31.82938],[34.052,31.46619]]]]}},{type:"Feature",properties:{iso1A2:"IM",iso1A3:"IMN",iso1N3:"833",wikidata:"Q9676",nameEn:"Isle of Man",country:"GB",groups:["Q185086","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01624","44 07624","44 07524","44 07924"]},geometry:{type:"MultiPolygon",coordinates:[[[[-3.98763,54.07351],[-4.1819,54.57861],[-5.6384,53.81157],[-3.98763,54.07351]]]]}},{type:"Feature",properties:{iso1A2:"IN",iso1A3:"IND",iso1N3:"356",wikidata:"Q668",nameEn:"India"},geometry:null},{type:"Feature",properties:{iso1A2:"IO",iso1A3:"IOT",iso1N3:"086",wikidata:"Q43448",nameEn:"British Indian Ocean Territory",country:"GB"},geometry:null},{type:"Feature",properties:{iso1A2:"IQ",iso1A3:"IRQ",iso1N3:"368",wikidata:"Q796",nameEn:"Iraq",groups:["145","142","UN"],callingCodes:["964"]},geometry:{type:"MultiPolygon",coordinates:[[[[42.78887,37.38615],[42.56725,37.14878],[42.35724,37.10998],[42.36697,37.0627],[41.81736,36.58782],[41.40058,36.52502],[41.28864,36.35368],[41.2564,36.06012],[41.37027,35.84095],[41.38184,35.62502],[41.26569,35.42708],[41.21654,35.1508],[41.2345,34.80049],[41.12388,34.65742],[40.97676,34.39788],[40.64314,34.31604],[38.79171,33.37328],[39.08202,32.50304],[38.98762,32.47694],[39.04251,32.30203],[39.26157,32.35555],[39.29903,32.23259],[40.01521,32.05667],[42.97601,30.72204],[42.97796,30.48295],[44.72255,29.19736],[46.42415,29.05947],[46.5527,29.10283],[46.89695,29.50584],[47.15166,30.01044],[47.37192,30.10421],[47.7095,30.10453],[48.01114,29.98906],[48.06782,30.02906],[48.17332,30.02448],[48.40479,29.85763],[48.59531,29.66815],[48.83867,29.78572],[48.61441,29.93675],[48.51011,29.96238],[48.44785,30.00148],[48.4494,30.04456],[48.43384,30.08233],[48.38869,30.11062],[48.38714,30.13485],[48.41671,30.17254],[48.41117,30.19846],[48.26393,30.3408],[48.24385,30.33846],[48.21279,30.31644],[48.19425,30.32796],[48.18321,30.39703],[48.14585,30.44133],[48.02443,30.4789],[48.03221,30.9967],[47.68219,31.00004],[47.6804,31.39086],[47.86337,31.78422],[47.64771,32.07666],[47.52474,32.15972],[47.57144,32.20583],[47.37529,32.47808],[47.17218,32.45393],[46.46788,32.91992],[46.32298,32.9731],[46.17198,32.95612],[46.09103,32.98354],[46.15175,33.07229],[46.03966,33.09577],[46.05367,33.13097],[46.11905,33.11924],[46.20623,33.20395],[45.99919,33.5082],[45.86687,33.49263],[45.96183,33.55751],[45.89801,33.63661],[45.77814,33.60938],[45.50261,33.94968],[45.42789,33.9458],[45.41077,33.97421],[45.47264,34.03099],[45.56176,34.15088],[45.58667,34.30147],[45.53552,34.35148],[45.49171,34.3439],[45.46697,34.38221],[45.43879,34.45949],[45.51883,34.47692],[45.53219,34.60441],[45.59074,34.55558],[45.60224,34.55057],[45.73923,34.54416],[45.70031,34.69277],[45.65672,34.7222],[45.68284,34.76624],[45.70031,34.82322],[45.73641,34.83975],[45.79682,34.85133],[45.78904,34.91135],[45.86532,34.89858],[45.89477,34.95805],[45.87864,35.03441],[45.92173,35.0465],[45.92203,35.09538],[45.93108,35.08148],[45.94756,35.09188],[46.06508,35.03699],[46.07747,35.0838],[46.11763,35.07551],[46.19116,35.11097],[46.15642,35.1268],[46.16229,35.16984],[46.19738,35.18536],[46.18457,35.22561],[46.11367,35.23729],[46.15474,35.2883],[46.13152,35.32548],[46.05358,35.38568],[45.98453,35.49848],[46.01518,35.52012],[45.97584,35.58132],[46.03028,35.57416],[46.01307,35.59756],[46.0165,35.61501],[45.99452,35.63574],[46.0117,35.65059],[46.01631,35.69139],[46.23736,35.71414],[46.34166,35.78363],[46.32921,35.82655],[46.17198,35.8013],[46.08325,35.8581],[45.94711,35.82218],[45.89784,35.83708],[45.81442,35.82107],[45.76145,35.79898],[45.6645,35.92872],[45.60018,35.96069],[45.55245,35.99943],[45.46594,36.00042],[45.38275,35.97156],[45.33916,35.99424],[45.37652,36.06222],[45.37312,36.09917],[45.32235,36.17383],[45.30038,36.27769],[45.26261,36.3001],[45.27394,36.35846],[45.23953,36.43257],[45.11811,36.40751],[45.00759,36.5402],[45.06985,36.62645],[45.06985,36.6814],[45.01537,36.75128],[44.84725,36.77622],[44.83479,36.81362],[44.90173,36.86096],[44.91199,36.91468],[44.89862,37.01897],[44.81611,37.04383],[44.75229,37.11958],[44.78319,37.1431],[44.76698,37.16162],[44.63179,37.19229],[44.42631,37.05825],[44.38117,37.05825],[44.35315,37.04955],[44.35937,37.02843],[44.30645,36.97373],[44.25975,36.98119],[44.18503,37.09551],[44.22239,37.15756],[44.27998,37.16501],[44.2613,37.25055],[44.13521,37.32486],[44.02002,37.33229],[43.90949,37.22453],[43.84878,37.22205],[43.82699,37.19477],[43.8052,37.22825],[43.7009,37.23692],[43.63085,37.21957],[43.56702,37.25675],[43.50787,37.24436],[43.33508,37.33105],[43.30083,37.30629],[43.11403,37.37436],[42.93705,37.32015],[42.78887,37.38615]]]]}},{type:"Feature",properties:{iso1A2:"IR",iso1A3:"IRN",iso1N3:"364",wikidata:"Q794",nameEn:"Iran",groups:["034","142","UN"],callingCodes:["98"]},geometry:{type:"MultiPolygon",coordinates:[[[[44.96746,39.42998],[44.88916,39.59653],[44.81043,39.62677],[44.71806,39.71124],[44.65422,39.72163],[44.6137,39.78393],[44.47298,39.68788],[44.48111,39.61579],[44.41849,39.56659],[44.42832,39.4131],[44.37921,39.4131],[44.29818,39.378],[44.22452,39.4169],[44.03667,39.39223],[44.1043,39.19842],[44.20946,39.13975],[44.18863,38.93881],[44.30322,38.81581],[44.26155,38.71427],[44.28065,38.6465],[44.32058,38.62752],[44.3207,38.49799],[44.3119,38.37887],[44.38309,38.36117],[44.44386,38.38295],[44.50115,38.33939],[44.42476,38.25763],[44.22509,37.88859],[44.3883,37.85433],[44.45948,37.77065],[44.55498,37.783],[44.62096,37.71985],[44.56887,37.6429],[44.61401,37.60165],[44.58449,37.45018],[44.81021,37.2915],[44.75986,37.21549],[44.7868,37.16644],[44.78319,37.1431],[44.75229,37.11958],[44.81611,37.04383],[44.89862,37.01897],[44.91199,36.91468],[44.90173,36.86096],[44.83479,36.81362],[44.84725,36.77622],[45.01537,36.75128],[45.06985,36.6814],[45.06985,36.62645],[45.00759,36.5402],[45.11811,36.40751],[45.23953,36.43257],[45.27394,36.35846],[45.26261,36.3001],[45.30038,36.27769],[45.32235,36.17383],[45.37312,36.09917],[45.37652,36.06222],[45.33916,35.99424],[45.38275,35.97156],[45.46594,36.00042],[45.55245,35.99943],[45.60018,35.96069],[45.6645,35.92872],[45.76145,35.79898],[45.81442,35.82107],[45.89784,35.83708],[45.94711,35.82218],[46.08325,35.8581],[46.17198,35.8013],[46.32921,35.82655],[46.34166,35.78363],[46.23736,35.71414],[46.01631,35.69139],[46.0117,35.65059],[45.99452,35.63574],[46.0165,35.61501],[46.01307,35.59756],[46.03028,35.57416],[45.97584,35.58132],[46.01518,35.52012],[45.98453,35.49848],[46.05358,35.38568],[46.13152,35.32548],[46.15474,35.2883],[46.11367,35.23729],[46.18457,35.22561],[46.19738,35.18536],[46.16229,35.16984],[46.15642,35.1268],[46.19116,35.11097],[46.11763,35.07551],[46.07747,35.0838],[46.06508,35.03699],[45.94756,35.09188],[45.93108,35.08148],[45.92203,35.09538],[45.92173,35.0465],[45.87864,35.03441],[45.89477,34.95805],[45.86532,34.89858],[45.78904,34.91135],[45.79682,34.85133],[45.73641,34.83975],[45.70031,34.82322],[45.68284,34.76624],[45.65672,34.7222],[45.70031,34.69277],[45.73923,34.54416],[45.60224,34.55057],[45.59074,34.55558],[45.53219,34.60441],[45.51883,34.47692],[45.43879,34.45949],[45.46697,34.38221],[45.49171,34.3439],[45.53552,34.35148],[45.58667,34.30147],[45.56176,34.15088],[45.47264,34.03099],[45.41077,33.97421],[45.42789,33.9458],[45.50261,33.94968],[45.77814,33.60938],[45.89801,33.63661],[45.96183,33.55751],[45.86687,33.49263],[45.99919,33.5082],[46.20623,33.20395],[46.11905,33.11924],[46.05367,33.13097],[46.03966,33.09577],[46.15175,33.07229],[46.09103,32.98354],[46.17198,32.95612],[46.32298,32.9731],[46.46788,32.91992],[47.17218,32.45393],[47.37529,32.47808],[47.57144,32.20583],[47.52474,32.15972],[47.64771,32.07666],[47.86337,31.78422],[47.6804,31.39086],[47.68219,31.00004],[48.03221,30.9967],[48.02443,30.4789],[48.14585,30.44133],[48.18321,30.39703],[48.19425,30.32796],[48.21279,30.31644],[48.24385,30.33846],[48.26393,30.3408],[48.41117,30.19846],[48.41671,30.17254],[48.38714,30.13485],[48.38869,30.11062],[48.43384,30.08233],[48.4494,30.04456],[48.44785,30.00148],[48.51011,29.96238],[48.61441,29.93675],[48.83867,29.78572],[49.98877,27.87827],[50.37726,27.89227],[54.39838,25.68383],[55.14145,25.62624],[55.81777,26.18798],[56.2644,26.58649],[56.68954,26.76645],[56.79239,26.41236],[56.82555,25.7713],[56.86325,25.03856],[61.46682,24.57869],[61.6433,25.27541],[61.683,25.66638],[61.83968,25.7538],[61.83831,26.07249],[61.89391,26.26251],[62.05117,26.31647],[62.21304,26.26601],[62.31484,26.528],[62.77352,26.64099],[63.1889,26.65072],[63.18688,26.83844],[63.25005,26.84212],[63.25005,27.08692],[63.32283,27.14437],[63.19649,27.25674],[62.80604,27.22412],[62.79684,27.34381],[62.84905,27.47627],[62.7638,28.02992],[62.79412,28.28108],[62.59499,28.24842],[62.40259,28.42703],[61.93581,28.55284],[61.65978,28.77937],[61.53765,29.00507],[61.31508,29.38903],[60.87231,29.86514],[61.80829,30.84224],[61.78268,30.92724],[61.8335,30.97669],[61.83257,31.0452],[61.80957,31.12576],[61.80569,31.16167],[61.70929,31.37391],[60.84541,31.49561],[60.86191,32.22565],[60.56485,33.12944],[60.88908,33.50219],[60.91133,33.55596],[60.69573,33.56054],[60.57762,33.59772],[60.5485,33.73422],[60.5838,33.80793],[60.50209,34.13992],[60.66502,34.31539],[60.91321,34.30411],[60.72316,34.52857],[60.99922,34.63064],[61.00197,34.70631],[61.06926,34.82139],[61.12831,35.09938],[61.0991,35.27845],[61.18187,35.30249],[61.27371,35.61482],[61.22719,35.67038],[61.26152,35.80749],[61.22444,35.92879],[61.12007,35.95992],[61.22719,36.12759],[61.1393,36.38782],[61.18187,36.55348],[61.14516,36.64644],[60.34767,36.63214],[60.00768,37.04102],[59.74678,37.12499],[59.55178,37.13594],[59.39385,37.34257],[59.39797,37.47892],[59.33507,37.53146],[59.22905,37.51161],[58.9338,37.67374],[58.6921,37.64548],[58.5479,37.70526],[58.47786,37.6433],[58.39959,37.63134],[58.22999,37.6856],[58.21399,37.77281],[57.79534,37.89299],[57.35042,37.98546],[57.37236,38.09321],[57.21169,38.28965],[57.03453,38.18717],[56.73928,38.27887],[56.62255,38.24005],[56.43303,38.26054],[56.32454,38.18502],[56.33278,38.08132],[55.97847,38.08024],[55.76561,38.12238],[55.44152,38.08564],[55.13412,37.94705],[54.851,37.75739],[54.77684,37.62264],[54.81804,37.61285],[54.77822,37.51597],[54.67247,37.43532],[54.58664,37.45809],[54.36211,37.34912],[54.24565,37.32047],[53.89734,37.3464],[48.88288,38.43975],[48.84969,38.45015],[48.81072,38.44853],[48.78979,38.45026],[48.70001,38.40564],[48.62217,38.40198],[48.58793,38.45076],[48.45084,38.61013],[48.3146,38.59958],[48.24773,38.71883],[48.02581,38.82705],[48.01409,38.90333],[48.07734,38.91616],[48.08627,38.94434],[48.28437,38.97186],[48.33884,39.03022],[48.31239,39.09278],[48.15361,39.19419],[48.12404,39.25208],[48.15984,39.30028],[48.37385,39.37584],[48.34264,39.42935],[47.98977,39.70999],[47.84774,39.66285],[47.50099,39.49615],[47.38978,39.45999],[47.31301,39.37492],[47.05927,39.24846],[47.05771,39.20143],[46.95341,39.13505],[46.92539,39.16644],[46.83822,39.13143],[46.75752,39.03231],[46.53497,38.86548],[46.34059,38.92076],[46.20601,38.85262],[46.14785,38.84206],[46.06766,38.87861],[46.00228,38.87376],[45.94624,38.89072],[45.90266,38.87739],[45.83883,38.90768],[45.65172,38.95199],[45.6155,38.94304],[45.6131,38.964],[45.44966,38.99243],[45.44811,39.04927],[45.40452,39.07224],[45.40148,39.09007],[45.30489,39.18333],[45.16168,39.21952],[45.08751,39.35052],[45.05932,39.36435],[44.96746,39.42998]]]]}},{type:"Feature",properties:{iso1A2:"IS",iso1A3:"ISL",iso1N3:"352",wikidata:"Q189",nameEn:"Iceland",groups:["154","150","UN"],callingCodes:["354"]},geometry:{type:"MultiPolygon",coordinates:[[[[-33.15676,62.62995],[-8.25539,63.0423],[-15.70914,69.67442],[-33.15676,62.62995]]]]}},{type:"Feature",properties:{iso1A2:"IT",iso1A3:"ITA",iso1N3:"380",wikidata:"Q38",nameEn:"Italy",groups:["EU","039","150","UN"],callingCodes:["39"]},geometry:{type:"MultiPolygon",coordinates:[[[[8.95861,45.96485],[8.97604,45.96151],[8.97741,45.98317],[8.96668,45.98436],[8.95861,45.96485]]],[[[7.63035,43.57419],[9.56115,43.20816],[10.09675,41.44089],[7.60802,41.05927],[7.89009,38.19924],[11.2718,37.6713],[12.13667,34.20326],[14.02721,36.53141],[17.67657,35.68918],[18.83516,40.36999],[16.15283,42.18525],[13.12821,44.48877],[13.05142,45.33128],[13.45644,45.59464],[13.6076,45.64761],[13.7198,45.59352],[13.74587,45.59811],[13.78445,45.5825],[13.84106,45.58185],[13.86771,45.59898],[13.8695,45.60835],[13.9191,45.6322],[13.87933,45.65207],[13.83422,45.68703],[13.83332,45.70855],[13.8235,45.7176],[13.66986,45.79955],[13.59784,45.8072],[13.58858,45.83503],[13.57563,45.8425],[13.58644,45.88173],[13.59565,45.89446],[13.60857,45.89907],[13.61931,45.91782],[13.63815,45.93607],[13.6329,45.94894],[13.64307,45.98326],[13.63458,45.98947],[13.62074,45.98388],[13.58903,45.99009],[13.56759,45.96991],[13.52963,45.96588],[13.50104,45.98078],[13.47474,46.00546],[13.49702,46.01832],[13.50998,46.04498],[13.49568,46.04839],[13.50104,46.05986],[13.57072,46.09022],[13.64053,46.13587],[13.66472,46.17392],[13.64451,46.18966],[13.56682,46.18703],[13.56114,46.2054],[13.47587,46.22725],[13.42218,46.20758],[13.37671,46.29668],[13.44808,46.33507],[13.43418,46.35992],[13.47019,46.3621],[13.5763,46.40915],[13.5763,46.42613],[13.59777,46.44137],[13.68684,46.43881],[13.7148,46.5222],[13.64088,46.53438],[13.27627,46.56059],[12.94445,46.60401],[12.59992,46.6595],[12.38708,46.71529],[12.27591,46.88651],[12.2006,46.88854],[12.11675,47.01241],[12.21781,47.03996],[12.19254,47.09331],[11.74789,46.98484],[11.50739,47.00644],[11.33355,46.99862],[11.10618,46.92966],[11.00764,46.76896],[10.72974,46.78972],[10.75753,46.82258],[10.66405,46.87614],[10.54783,46.84505],[10.47197,46.85698],[10.38659,46.67847],[10.40475,46.63671],[10.44686,46.64162],[10.49375,46.62049],[10.46136,46.53164],[10.25309,46.57432],[10.23674,46.63484],[10.10307,46.61003],[10.03715,46.44479],[10.165,46.41051],[10.10506,46.3372],[10.17862,46.25626],[10.14439,46.22992],[10.07055,46.21668],[9.95249,46.38045],[9.73086,46.35071],[9.71273,46.29266],[9.57015,46.2958],[9.46117,46.37481],[9.45936,46.50873],[9.40487,46.46621],[9.36128,46.5081],[9.28136,46.49685],[9.25502,46.43743],[9.29226,46.32717],[9.24503,46.23616],[9.01618,46.04928],[8.99257,45.9698],[9.09065,45.89906],[9.06642,45.8761],[9.04546,45.84968],[9.04059,45.8464],[9.03505,45.83976],[9.03793,45.83548],[9.03279,45.82865],[9.0298,45.82127],[9.00324,45.82055],[8.99663,45.83466],[8.9621,45.83707],[8.94737,45.84285],[8.91129,45.8388],[8.93504,45.86245],[8.94372,45.86587],[8.93649,45.86775],[8.88904,45.95465],[8.86688,45.96135],[8.85121,45.97239],[8.8319,45.9879],[8.79362,45.99207],[8.78585,45.98973],[8.79414,46.00913],[8.85617,46.0748],[8.80778,46.10085],[8.75697,46.10395],[8.62242,46.12112],[8.45032,46.26869],[8.46317,46.43712],[8.42464,46.46367],[8.30648,46.41587],[8.31162,46.38044],[8.08814,46.26692],[8.16866,46.17817],[8.11383,46.11577],[8.02906,46.10331],[7.98881,45.99867],[7.9049,45.99945],[7.85949,45.91485],[7.56343,45.97421],[7.10685,45.85653],[7.04151,45.92435],[6.95315,45.85163],[6.80785,45.83265],[6.80785,45.71864],[6.98948,45.63869],[7.00037,45.509],[7.18019,45.40071],[7.10572,45.32924],[7.13115,45.25386],[7.07074,45.21228],[6.96706,45.20841],[6.85144,45.13226],[6.7697,45.16044],[6.62803,45.11175],[6.66981,45.02324],[6.74791,45.01939],[6.74519,44.93661],[6.75518,44.89915],[6.90774,44.84322],[6.93499,44.8664],[7.02217,44.82519],[7.00401,44.78782],[7.07484,44.68073],[7.00582,44.69364],[6.95133,44.66264],[6.96042,44.62129],[6.85507,44.53072],[6.86233,44.49834],[6.94504,44.43112],[6.88784,44.42043],[6.89171,44.36637],[6.98221,44.28289],[7.00764,44.23736],[7.16929,44.20352],[7.27827,44.1462],[7.34547,44.14359],[7.36364,44.11882],[7.62155,44.14881],[7.63245,44.17877],[7.68694,44.17487],[7.66878,44.12795],[7.72508,44.07578],[7.6597,44.03009],[7.66848,43.99943],[7.65266,43.9763],[7.60771,43.95772],[7.56858,43.94506],[7.56075,43.89932],[7.51162,43.88301],[7.49355,43.86551],[7.50423,43.84345],[7.53006,43.78405],[7.63035,43.57419]],[[12.45181,41.90056],[12.44834,41.90095],[12.44582,41.90194],[12.44815,41.90326],[12.44984,41.90545],[12.45091,41.90625],[12.45543,41.90738],[12.45561,41.90629],[12.45762,41.9058],[12.45755,41.9033],[12.45826,41.90281],[12.45834,41.90174],[12.4577,41.90115],[12.45691,41.90125],[12.45626,41.90172],[12.45435,41.90143],[12.45446,41.90028],[12.45181,41.90056]],[[12.45648,43.89369],[12.44184,43.90498],[12.41641,43.89991],[12.40935,43.9024],[12.41233,43.90956],[12.40733,43.92379],[12.41551,43.92984],[12.41165,43.93769],[12.40506,43.94325],[12.40415,43.95485],[12.41414,43.95273],[12.42005,43.9578],[12.43662,43.95698],[12.44684,43.96597],[12.46205,43.97463],[12.47853,43.98052],[12.49406,43.98492],[12.50678,43.99113],[12.51463,43.99122],[12.5154,43.98508],[12.51064,43.98165],[12.51109,43.97201],[12.50622,43.97131],[12.50875,43.96198],[12.50655,43.95796],[12.51427,43.94897],[12.51553,43.94096],[12.50496,43.93017],[12.50269,43.92363],[12.49724,43.92248],[12.49247,43.91774],[12.49429,43.90973],[12.48771,43.89706],[12.45648,43.89369]]]]}},{type:"Feature",properties:{iso1A2:"JE",iso1A3:"JEY",iso1N3:"832",wikidata:"Q785",nameEn:"Bailiwick of Jersey",country:"GB",groups:["830","Q185086","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01534"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.00491,48.86706],[-1.83944,49.23037],[-2.09454,49.46288],[-2.65349,49.15373],[-2.00491,48.86706]]]]}},{type:"Feature",properties:{iso1A2:"JM",iso1A3:"JAM",iso1N3:"388",wikidata:"Q766",nameEn:"Jamaica",aliases:["JA"],groups:["029","003","419","019","UN"],driveSide:"left",callingCodes:["1 876","1 658"]},geometry:{type:"MultiPolygon",coordinates:[[[[-74.09729,17.36817],[-78.9741,19.59515],[-78.34606,16.57862],[-74.09729,17.36817]]]]}},{type:"Feature",properties:{iso1A2:"JO",iso1A3:"JOR",iso1N3:"400",wikidata:"Q810",nameEn:"Jordan",groups:["145","142","UN"],callingCodes:["962"]},geometry:{type:"MultiPolygon",coordinates:[[[[39.04251,32.30203],[38.98762,32.47694],[39.08202,32.50304],[38.79171,33.37328],[36.83946,32.31293],[36.40959,32.37908],[36.23948,32.50108],[36.20875,32.49529],[36.20379,32.52751],[36.08074,32.51463],[36.02239,32.65911],[35.96633,32.66237],[35.93307,32.71966],[35.88405,32.71321],[35.75983,32.74803],[35.68467,32.70715],[35.66527,32.681],[35.61669,32.67999],[35.59813,32.65159],[35.56614,32.64393],[35.57485,32.48669],[35.55494,32.42687],[35.55807,32.38674],[35.57111,32.21877],[35.52012,32.04076],[35.54375,31.96587],[35.52758,31.9131],[35.55941,31.76535],[35.47672,31.49578],[35.40316,31.25535],[35.43658,31.12444],[35.41371,30.95565],[35.33984,30.8802],[35.33456,30.81224],[35.29311,30.71365],[35.21379,30.60401],[35.19595,30.50297],[35.16218,30.43535],[35.19183,30.34636],[35.14108,30.07374],[35.02147,29.66343],[34.98207,29.58147],[34.97718,29.54294],[34.92298,29.45305],[34.8812,29.36878],[36.07081,29.18469],[36.50005,29.49696],[36.75083,29.86903],[37.4971,29.99949],[37.66395,30.33245],[37.99354,30.49998],[36.99791,31.50081],[38.99233,31.99721],[39.29903,32.23259],[39.26157,32.35555],[39.04251,32.30203]]]]}},{type:"Feature",properties:{iso1A2:"JP",iso1A3:"JPN",iso1N3:"392",wikidata:"Q17",nameEn:"Japan",groups:["030","142","UN"],driveSide:"left",callingCodes:["81"]},geometry:{type:"MultiPolygon",coordinates:[[[[145.82361,43.38904],[145.23667,43.76813],[145.82343,44.571],[140.9182,45.92937],[133.61399,37.41],[129.2669,34.87122],[122.26612,25.98197],[123.92912,17.8782],[155.16731,23.60141],[145.82361,43.38904]]]]}},{type:"Feature",properties:{iso1A2:"KE",iso1A3:"KEN",iso1N3:"404",wikidata:"Q114",nameEn:"Kenya",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["254"]},geometry:{type:"MultiPolygon",coordinates:[[[[35.9419,4.61933],[35.51424,4.61643],[35.42366,4.76969],[35.47843,4.91872],[35.30992,4.90402],[35.34151,5.02364],[34.47601,4.72162],[33.9873,4.23316],[34.06046,4.15235],[34.15429,3.80464],[34.45815,3.67385],[34.44922,3.51627],[34.39112,3.48802],[34.41794,3.44342],[34.40006,3.37949],[34.45815,3.18319],[34.56242,3.11478],[34.60114,2.93034],[34.65774,2.8753],[34.73967,2.85447],[34.78137,2.76223],[34.77244,2.70272],[34.95267,2.47209],[34.90947,2.42447],[34.98692,1.97348],[34.9899,1.6668],[34.92734,1.56109],[34.87819,1.5596],[34.7918,1.36752],[34.82606,1.30944],[34.82606,1.26626],[34.80223,1.22754],[34.67562,1.21265],[34.58029,1.14712],[34.57427,1.09868],[34.52369,1.10692],[34.43349,.85254],[34.40041,.80266],[34.31516,.75693],[34.27345,.63182],[34.20196,.62289],[34.13493,.58118],[34.11408,.48884],[34.08727,.44713],[34.10067,.36372],[33.90936,.10581],[33.98449,-.13079],[33.9264,-.54188],[33.93107,-.99298],[34.02286,-1.00779],[34.03084,-1.05101],[34.0824,-1.02264],[37.67199,-3.06222],[37.71745,-3.304],[37.5903,-3.42735],[37.63099,-3.50723],[37.75036,-3.54243],[37.81321,-3.69179],[39.21631,-4.67835],[39.44306,-4.93877],[39.62121,-4.68136],[41.75542,-1.85308],[41.56362,-1.66375],[41.56,-1.59812],[41.00099,-.83068],[40.98767,2.82959],[41.31368,3.14314],[41.89488,3.97375],[41.1754,3.94079],[40.77498,4.27683],[39.86043,3.86974],[39.76808,3.67058],[39.58339,3.47434],[39.55132,3.39634],[39.51551,3.40895],[39.49444,3.45521],[39.19954,3.47834],[39.07736,3.5267],[38.91938,3.51198],[38.52336,3.62551],[38.45812,3.60445],[38.14168,3.62487],[37.07724,4.33503],[36.84474,4.44518],[36.03924,4.44406],[35.95449,4.53244],[35.9419,4.61933]]]]}},{type:"Feature",properties:{iso1A2:"KG",iso1A3:"KGZ",iso1N3:"417",wikidata:"Q813",nameEn:"Kyrgyzstan",groups:["143","142","UN"],callingCodes:["996"]},geometry:{type:"MultiPolygon",coordinates:[[[[74.88756,42.98612],[74.75,42.99029],[74.70331,43.02519],[74.64615,43.05881],[74.57491,43.13702],[74.22489,43.24657],[73.55634,43.03071],[73.50992,42.82356],[73.44393,42.43098],[71.88792,42.83578],[71.62405,42.76613],[71.53272,42.8014],[71.2724,42.77853],[71.22785,42.69248],[71.17807,42.67381],[71.15232,42.60486],[70.97717,42.50147],[70.85973,42.30188],[70.94483,42.26238],[71.13263,42.28356],[71.28719,42.18033],[70.69777,41.92554],[70.17682,41.5455],[70.48909,41.40335],[70.67586,41.47953],[70.78572,41.36419],[70.77885,41.24813],[70.86263,41.23833],[70.9615,41.16393],[71.02193,41.19494],[71.11806,41.15359],[71.25813,41.18796],[71.27187,41.11015],[71.34877,41.16807],[71.40198,41.09436],[71.46148,41.13958],[71.43814,41.19644],[71.46688,41.31883],[71.57227,41.29175],[71.6787,41.42111],[71.65914,41.49599],[71.73054,41.54713],[71.71132,41.43012],[71.76625,41.4466],[71.83914,41.3546],[71.91457,41.2982],[71.85964,41.19081],[72.07249,41.11739],[72.10745,41.15483],[72.16433,41.16483],[72.17594,41.15522],[72.14864,41.13363],[72.1792,41.10621],[72.21061,41.05607],[72.17594,41.02377],[72.18339,40.99571],[72.324,41.03381],[72.34026,41.04539],[72.34757,41.06104],[72.36138,41.04384],[72.38511,41.02785],[72.45206,41.03018],[72.48742,40.97136],[72.55109,40.96046],[72.59136,40.86947],[72.68157,40.84942],[72.84291,40.85512],[72.94454,40.8094],[73.01869,40.84681],[73.13267,40.83512],[73.13412,40.79122],[73.0612,40.76678],[72.99133,40.76457],[72.93296,40.73089],[72.8722,40.71111],[72.85372,40.7116],[72.84754,40.67229],[72.80137,40.67856],[72.74866,40.60873],[72.74894,40.59592],[72.75982,40.57273],[72.74862,40.57131],[72.74768,40.58051],[72.73995,40.58409],[72.69579,40.59778],[72.66713,40.59076],[72.66713,40.5219],[72.47795,40.5532],[72.40517,40.61917],[72.34406,40.60144],[72.41714,40.55736],[72.38384,40.51535],[72.41513,40.50856],[72.44191,40.48222],[72.40346,40.4007],[72.24368,40.46091],[72.18648,40.49893],[71.96401,40.31907],[72.05464,40.27586],[71.85002,40.25647],[71.82646,40.21872],[71.73054,40.14818],[71.71719,40.17886],[71.69621,40.18492],[71.70569,40.20391],[71.68386,40.26984],[71.61931,40.26775],[71.61725,40.20615],[71.51549,40.22986],[71.51215,40.26943],[71.4246,40.28619],[71.36663,40.31593],[71.13042,40.34106],[71.05901,40.28765],[70.95789,40.28761],[70.9818,40.22392],[70.80495,40.16813],[70.7928,40.12797],[70.65827,40.0981],[70.65946,39.9878],[70.58912,39.95211],[70.55033,39.96619],[70.47557,39.93216],[70.57384,39.99394],[70.58297,40.00891],[70.01283,40.23288],[69.67001,40.10639],[69.64704,40.12165],[69.57615,40.10524],[69.55555,40.12296],[69.53794,40.11833],[69.53855,40.0887],[69.5057,40.03277],[69.53615,39.93991],[69.43557,39.92877],[69.43134,39.98431],[69.35649,40.01994],[69.26938,39.8127],[69.3594,39.52516],[69.68677,39.59281],[69.87491,39.53882],[70.11111,39.58223],[70.2869,39.53141],[70.44757,39.60128],[70.64087,39.58792],[70.7854,39.38933],[71.06418,39.41586],[71.08752,39.50704],[71.49814,39.61397],[71.55856,39.57588],[71.5517,39.45722],[71.62688,39.44056],[71.76816,39.45456],[71.80164,39.40631],[71.7522,39.32031],[71.79202,39.27355],[71.90601,39.27674],[72.04059,39.36704],[72.09689,39.26823],[72.17242,39.2661],[72.23834,39.17248],[72.33173,39.33093],[72.62027,39.39696],[72.85934,39.35116],[73.18454,39.35536],[73.31912,39.38615],[73.45096,39.46677],[73.59831,39.46425],[73.87018,39.47879],[73.94683,39.60733],[73.92354,39.69565],[73.9051,39.75073],[73.83006,39.76136],[73.97049,40.04378],[74.25533,40.13191],[74.35063,40.09742],[74.69875,40.34668],[74.85996,40.32857],[74.78168,40.44886],[74.82013,40.52197],[75.08243,40.43945],[75.22834,40.45382],[75.5854,40.66874],[75.69663,40.28642],[75.91361,40.2948],[75.96168,40.38064],[76.33659,40.3482],[76.5261,40.46114],[76.75681,40.95354],[76.99302,41.0696],[77.28004,41.0033],[77.3693,41.0375],[77.52723,41.00227],[77.76206,41.01574],[77.81287,41.14307],[78.12873,41.23091],[78.15757,41.38565],[78.3732,41.39603],[79.92977,42.04113],[80.17842,42.03211],[80.17807,42.21166],[79.97364,42.42816],[79.52921,42.44778],[79.19763,42.804],[78.91502,42.76839],[78.48469,42.89649],[75.82823,42.94848],[75.72174,42.79672],[75.29966,42.86183],[75.22619,42.85528],[74.88756,42.98612]],[[70.74189,39.86319],[70.63105,39.77923],[70.59667,39.83542],[70.54998,39.85137],[70.52631,39.86989],[70.53651,39.89155],[70.74189,39.86319]],[[71.86463,39.98598],[71.84316,39.95582],[71.7504,39.93701],[71.71511,39.96348],[71.78838,40.01404],[71.86463,39.98598]],[[71.21139,40.03369],[71.1427,39.95026],[71.23067,39.93581],[71.16101,39.88423],[71.10531,39.91354],[71.04979,39.89808],[71.10501,39.95568],[71.09063,39.99],[71.11668,39.99291],[71.11037,40.01984],[71.01035,40.05481],[71.00236,40.18154],[71.06305,40.1771],[71.12218,40.03052],[71.21139,40.03369]]]]}},{type:"Feature",properties:{iso1A2:"KH",iso1A3:"KHM",iso1N3:"116",wikidata:"Q424",nameEn:"Cambodia",groups:["035","142","UN"],callingCodes:["855"]},geometry:{type:"MultiPolygon",coordinates:[[[[105.87328,11.55953],[105.81645,11.56876],[105.80867,11.60536],[105.8507,11.66635],[105.88962,11.67854],[105.95188,11.63738],[106.00792,11.7197],[106.02038,11.77457],[106.06708,11.77761],[106.13158,11.73283],[106.18539,11.75171],[106.26478,11.72122],[106.30525,11.67549],[106.37219,11.69836],[106.44691,11.66787],[106.45158,11.68616],[106.41577,11.76999],[106.44535,11.8279],[106.44068,11.86294],[106.4687,11.86751],[106.4111,11.97413],[106.70687,11.96956],[106.79405,12.0807],[106.92325,12.06548],[106.99953,12.08983],[107.15831,12.27547],[107.34511,12.33327],[107.42917,12.24657],[107.4463,12.29373],[107.55059,12.36824],[107.5755,12.52177],[107.55993,12.7982],[107.49611,12.88926],[107.49144,13.01215],[107.62843,13.3668],[107.61909,13.52577],[107.53503,13.73908],[107.45252,13.78897],[107.46498,13.91593],[107.44318,13.99751],[107.38247,13.99147],[107.35757,14.02319],[107.37158,14.07906],[107.33577,14.11832],[107.40427,14.24509],[107.39493,14.32655],[107.44941,14.41552],[107.48521,14.40346],[107.52569,14.54665],[107.52102,14.59034],[107.55371,14.628],[107.54361,14.69092],[107.47238,14.61523],[107.44435,14.52785],[107.37897,14.54443],[107.3276,14.58812],[107.29803,14.58963],[107.26534,14.54292],[107.256,14.48716],[107.21241,14.48716],[107.17038,14.41782],[107.09722,14.3937],[107.03962,14.45099],[107.04585,14.41782],[106.98825,14.36806],[106.9649,14.3198],[106.90574,14.33639],[106.8497,14.29416],[106.80767,14.31226],[106.73762,14.42687],[106.63333,14.44194],[106.59908,14.50977],[106.57106,14.50525],[106.54148,14.59565],[106.50723,14.58963],[106.45898,14.55045],[106.47766,14.50977],[106.43874,14.52032],[106.40916,14.45249],[106.32355,14.44043],[106.25194,14.48415],[106.21302,14.36203],[106.00131,14.36957],[105.99509,14.32734],[106.02311,14.30623],[106.04801,14.20363],[106.10872,14.18401],[106.11962,14.11307],[106.18656,14.06324],[106.16632,14.01794],[106.10094,13.98471],[106.10405,13.9137],[105.90791,13.92881],[105.78182,14.02247],[105.78338,14.08438],[105.5561,14.15684],[105.44869,14.10703],[105.36775,14.09948],[105.2759,14.17496],[105.20894,14.34967],[105.17748,14.34432],[105.14012,14.23873],[105.08408,14.20402],[105.02804,14.23722],[104.97667,14.38806],[104.69335,14.42726],[104.55014,14.36091],[104.27616,14.39861],[103.93836,14.3398],[103.70175,14.38052],[103.71109,14.4348],[103.53518,14.42575],[103.39353,14.35639],[103.16469,14.33075],[102.93275,14.19044],[102.91251,14.01531],[102.77864,13.93374],[102.72727,13.77806],[102.56848,13.69366],[102.5481,13.6589],[102.58635,13.6286],[102.62483,13.60883],[102.57573,13.60461],[102.5358,13.56933],[102.44601,13.5637],[102.36859,13.57488],[102.33828,13.55613],[102.361,13.50551],[102.35563,13.47307],[102.35692,13.38274],[102.34611,13.35618],[102.36001,13.31142],[102.36146,13.26006],[102.43422,13.09061],[102.46011,13.08057],[102.52275,12.99813],[102.48694,12.97537],[102.49335,12.92711],[102.53053,12.77506],[102.4994,12.71736],[102.51963,12.66117],[102.57567,12.65358],[102.7796,12.43781],[102.78116,12.40284],[102.73134,12.37091],[102.70176,12.1686],[102.77026,12.06815],[102.78427,11.98746],[102.83957,11.8519],[102.90973,11.75613],[102.91449,11.65512],[102.52395,11.25257],[102.47649,9.66162],[103.99198,10.48391],[104.43778,10.42386],[104.47963,10.43046],[104.49869,10.4057],[104.59018,10.53073],[104.87933,10.52833],[104.95094,10.64003],[105.09571,10.72722],[105.02722,10.89236],[105.08326,10.95656],[105.11449,10.96332],[105.34011,10.86179],[105.42884,10.96878],[105.50045,10.94586],[105.77751,11.03671],[105.86376,10.89839],[105.84603,10.85873],[105.93403,10.83853],[105.94535,10.9168],[106.06708,10.8098],[106.18539,10.79451],[106.14301,10.98176],[106.20095,10.97795],[106.1757,11.07301],[106.1527,11.10476],[106.10444,11.07879],[105.86782,11.28343],[105.88962,11.43605],[105.87328,11.55953]]]]}},{type:"Feature",properties:{iso1A2:"KI",iso1A3:"KIR",iso1N3:"296",wikidata:"Q710",nameEn:"Kiribati",groups:["057","009","UN"],driveSide:"left",callingCodes:["686"]},geometry:{type:"MultiPolygon",coordinates:[[[[169,3.9],[169,-3.5],[178,-3.5],[178,3.9],[169,3.9]]],[[[-161.06795,5.2462],[-158.12991,-1.86122],[-175.33482,-1.40631],[-175.31804,-7.54825],[-156.50903,-7.4975],[-156.48634,-15.52824],[-135.59706,-4.70473],[-161.06795,5.2462]]]]}},{type:"Feature",properties:{iso1A2:"KM",iso1A3:"COM",iso1N3:"174",wikidata:"Q970",nameEn:"Comoros",groups:["014","202","002","UN"],callingCodes:["269"]},geometry:{type:"MultiPolygon",coordinates:[[[[42.63904,-10.02522],[43.28731,-13.97126],[45.4971,-11.75965],[42.63904,-10.02522]]]]}},{type:"Feature",properties:{iso1A2:"KN",iso1A3:"KNA",iso1N3:"659",wikidata:"Q763",nameEn:"St. Kitts and Nevis",groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 869"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.29333,17.43155],[-62.76692,17.64353],[-63.09677,17.21372],[-62.63813,16.65446],[-62.29333,17.43155]]]]}},{type:"Feature",properties:{iso1A2:"KP",iso1A3:"PRK",iso1N3:"408",wikidata:"Q423",nameEn:"North Korea",groups:["030","142","UN"],callingCodes:["850"]},geometry:{type:"MultiPolygon",coordinates:[[[[130.26095,42.9027],[130.09764,42.91425],[130.12957,42.98361],[129.96409,42.97306],[129.95082,43.01051],[129.8865,43.00395],[129.85261,42.96494],[129.83277,42.86746],[129.80719,42.79218],[129.7835,42.76521],[129.77183,42.69435],[129.75294,42.59409],[129.72541,42.43739],[129.60482,42.44461],[129.54701,42.37254],[129.42882,42.44702],[129.28541,42.41574],[129.22423,42.3553],[129.22285,42.26491],[129.15178,42.17224],[128.96068,42.06657],[128.94007,42.03537],[128.04487,42.01769],[128.15119,41.74568],[128.30716,41.60322],[128.20061,41.40895],[128.18546,41.41279],[128.12967,41.37931],[128.03311,41.39232],[128.02633,41.42103],[127.92943,41.44291],[127.29712,41.49473],[127.17841,41.59714],[126.90729,41.79955],[126.60631,41.65565],[126.53189,41.35206],[126.242,41.15454],[126.00335,40.92835],[125.76869,40.87908],[125.71172,40.85223],[124.86913,40.45387],[124.40719,40.13655],[124.38556,40.11047],[124.3322,40.05573],[124.37089,40.03004],[124.35029,39.95639],[124.23201,39.9248],[124.17532,39.8232],[123.90497,38.79949],[123.85601,37.49093],[124.67666,38.05679],[124.84224,37.977],[124.87921,37.80827],[125.06408,37.66334],[125.37112,37.62643],[125.81159,37.72949],[126.13074,37.70512],[126.18776,37.74728],[126.19097,37.81462],[126.24402,37.83113],[126.43239,37.84095],[126.46818,37.80873],[126.56709,37.76857],[126.59918,37.76364],[126.66067,37.7897],[126.68793,37.83728],[126.68793,37.9175],[126.67023,37.95852],[126.84961,38.0344],[126.88106,38.10246],[126.95887,38.1347],[126.95338,38.17735],[127.04479,38.25518],[127.15749,38.30722],[127.38727,38.33227],[127.49672,38.30647],[127.55013,38.32257],[128.02917,38.31861],[128.27652,38.41657],[128.31105,38.58462],[128.37487,38.62345],[128.65655,38.61914],[131.95041,41.5445],[130.65022,42.32281],[130.66367,42.38024],[130.64181,42.41422],[130.60805,42.4317],[130.56835,42.43281],[130.55143,42.52158],[130.50123,42.61636],[130.44361,42.54849],[130.41826,42.6011],[130.2385,42.71127],[130.23068,42.80125],[130.26095,42.9027]]]]}},{type:"Feature",properties:{iso1A2:"KR",iso1A3:"KOR",iso1N3:"410",wikidata:"Q884",nameEn:"South Korea",groups:["030","142","UN"],callingCodes:["82"]},geometry:{type:"MultiPolygon",coordinates:[[[[133.11729,37.53115],[128.65655,38.61914],[128.37487,38.62345],[128.31105,38.58462],[128.27652,38.41657],[128.02917,38.31861],[127.55013,38.32257],[127.49672,38.30647],[127.38727,38.33227],[127.15749,38.30722],[127.04479,38.25518],[126.95338,38.17735],[126.95887,38.1347],[126.88106,38.10246],[126.84961,38.0344],[126.67023,37.95852],[126.68793,37.9175],[126.68793,37.83728],[126.66067,37.7897],[126.59918,37.76364],[126.56709,37.76857],[126.46818,37.80873],[126.43239,37.84095],[126.24402,37.83113],[126.19097,37.81462],[126.18776,37.74728],[126.13074,37.70512],[125.81159,37.72949],[125.37112,37.62643],[125.06408,37.66334],[124.87921,37.80827],[124.84224,37.977],[124.67666,38.05679],[123.85601,37.49093],[122.80525,33.30571],[125.99728,32.63328],[129.2669,34.87122],[133.11729,37.53115]]]]}},{type:"Feature",properties:{iso1A2:"KW",iso1A3:"KWT",iso1N3:"414",wikidata:"Q817",nameEn:"Kuwait",groups:["145","142","UN"],callingCodes:["965"]},geometry:{type:"MultiPolygon",coordinates:[[[[49.00421,28.81495],[48.59531,29.66815],[48.40479,29.85763],[48.17332,30.02448],[48.06782,30.02906],[48.01114,29.98906],[47.7095,30.10453],[47.37192,30.10421],[47.15166,30.01044],[46.89695,29.50584],[46.5527,29.10283],[47.46202,29.0014],[47.58376,28.83382],[47.59863,28.66798],[47.70561,28.5221],[48.42991,28.53628],[49.00421,28.81495]]]]}},{type:"Feature",properties:{iso1A2:"KY",iso1A3:"CYM",iso1N3:"136",wikidata:"Q5785",nameEn:"Cayman Islands",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 345"]},geometry:{type:"MultiPolygon",coordinates:[[[[-82.11509,19.60401],[-80.36068,18.11751],[-79.32727,20.06742],[-82.11509,19.60401]]]]}},{type:"Feature",properties:{iso1A2:"KZ",iso1A3:"KAZ",iso1N3:"398",wikidata:"Q232",nameEn:"Kazakhstan",groups:["143","142","UN"],callingCodes:["7"]},geometry:{type:"MultiPolygon",coordinates:[[[[68.90865,55.38148],[68.19206,55.18823],[68.26661,55.09226],[68.21308,54.98645],[65.20174,54.55216],[65.24663,54.35721],[65.11033,54.33028],[64.97216,54.4212],[63.97686,54.29763],[64.02715,54.22679],[63.91224,54.20013],[63.80604,54.27079],[62.58651,54.05871],[62.56876,53.94047],[62.45931,53.90737],[62.38535,54.03961],[62.00966,54.04134],[62.03913,53.94768],[61.65318,54.02445],[61.56941,53.95703],[61.47603,54.08048],[61.3706,54.08464],[61.26863,53.92797],[60.99796,53.93699],[61.14283,53.90063],[61.22574,53.80268],[60.90626,53.62937],[61.55706,53.57144],[61.57185,53.50112],[61.37957,53.45887],[61.29082,53.50992],[61.14291,53.41481],[61.19024,53.30536],[62.14574,53.09626],[62.12799,52.99133],[62.0422,52.96105],[61.23462,53.03227],[61.05842,52.92217],[60.71989,52.75923],[60.71693,52.66245],[60.84118,52.63912],[60.84709,52.52228],[60.98021,52.50068],[61.05417,52.35096],[60.78201,52.22067],[60.72581,52.15538],[60.48915,52.15175],[60.19925,51.99173],[59.99809,51.98263],[60.09867,51.87135],[60.50986,51.7964],[60.36787,51.66815],[60.5424,51.61675],[60.92401,51.61124],[60.95655,51.48615],[61.50677,51.40687],[61.55114,51.32746],[61.6813,51.25716],[61.56889,51.23679],[61.4431,50.80679],[60.81833,50.6629],[60.31914,50.67705],[60.17262,50.83312],[60.01288,50.8163],[59.81172,50.54451],[59.51886,50.49937],[59.48928,50.64216],[58.87974,50.70852],[58.3208,51.15151],[57.75578,51.13852],[57.74986,50.93017],[57.44221,50.88354],[57.17302,51.11253],[56.17906,50.93204],[56.11398,50.7471],[55.67774,50.54508],[54.72067,51.03261],[54.56685,51.01958],[54.71476,50.61214],[54.55797,50.52006],[54.41894,50.61214],[54.46331,50.85554],[54.12248,51.11542],[53.69299,51.23466],[53.46165,51.49445],[52.54329,51.48444],[52.36119,51.74161],[51.8246,51.67916],[51.77431,51.49536],[51.301,51.48799],[51.26254,51.68466],[50.59695,51.61859],[50.26859,51.28677],[49.97277,51.2405],[49.76866,51.11067],[49.39001,51.09396],[49.41959,50.85927],[49.12673,50.78639],[48.86936,50.61589],[48.57946,50.63278],[48.90782,50.02281],[48.68352,49.89546],[48.42564,49.82283],[48.24519,49.86099],[48.10044,50.09242],[47.58551,50.47867],[47.30448,50.30894],[47.34589,50.09308],[47.18319,49.93721],[46.9078,49.86707],[46.78398,49.34026],[47.04658,49.19834],[47.00857,49.04921],[46.78392,48.95352],[46.49011,48.43019],[47.11516,48.27188],[47.12107,47.83687],[47.38731,47.68176],[47.41689,47.83687],[47.64973,47.76559],[48.15348,47.74545],[48.45173,47.40818],[48.52326,47.4102],[49.01136,46.72716],[48.51142,46.69268],[48.54988,46.56267],[49.16518,46.38542],[49.32259,46.26944],[49.88945,46.04554],[49.2134,44.84989],[52.26048,41.69249],[52.47884,41.78034],[52.97575,42.1308],[54.20635,42.38477],[54.95182,41.92424],[55.45471,41.25609],[56.00314,41.32584],[55.97584,44.99322],[55.97584,44.99328],[55.97584,44.99338],[55.97584,44.99343],[55.97584,44.99348],[55.97584,44.99353],[55.97584,44.99359],[55.97584,44.99369],[55.97584,44.99374],[55.97584,44.99384],[55.97584,44.9939],[55.97584,44.994],[55.97584,44.99405],[55.97584,44.99415],[55.97584,44.99421],[55.97584,44.99426],[55.97584,44.99431],[55.97584,44.99436],[55.97584,44.99441],[55.97594,44.99446],[55.97605,44.99452],[55.97605,44.99457],[55.97605,44.99462],[55.97605,44.99467],[55.97605,44.99477],[55.97615,44.99477],[55.97615,44.99483],[55.97615,44.99493],[55.97615,44.99498],[55.97615,44.99503],[55.97615,44.99508],[55.97625,44.99514],[55.97636,44.99519],[55.97636,44.99524],[55.97646,44.99529],[55.97646,44.99534],[55.97656,44.99539],[55.97667,44.99545],[55.97677,44.9955],[55.97677,44.99555],[55.97677,44.9956],[55.97687,44.9956],[55.97698,44.99565],[55.97698,44.9957],[55.97708,44.99576],[55.97718,44.99581],[55.97729,44.99586],[55.97739,44.99586],[55.97739,44.99591],[55.97749,44.99591],[55.9776,44.99591],[55.9777,44.99596],[55.9777,44.99601],[55.9778,44.99607],[55.97791,44.99607],[55.97801,44.99607],[55.97801,44.99612],[55.97811,44.99617],[55.97822,44.99617],[55.97832,44.99622],[55.97842,44.99622],[58.59711,45.58671],[61.01475,44.41383],[62.01711,43.51008],[63.34656,43.64003],[64.53885,43.56941],[64.96464,43.74748],[65.18666,43.48835],[65.53277,43.31856],[65.85194,42.85481],[66.09482,42.93426],[66.00546,41.94455],[66.53302,41.87388],[66.69129,41.1311],[67.9644,41.14611],[67.98511,41.02794],[68.08273,41.08148],[68.1271,41.0324],[67.96736,40.83798],[68.49983,40.56437],[68.63,40.59358],[68.58444,40.91447],[68.49983,40.99669],[68.62221,41.03019],[68.65662,40.93861],[68.73945,40.96989],[68.7217,41.05025],[69.01308,41.22804],[69.05006,41.36183],[69.15137,41.43078],[69.17701,41.43769],[69.18528,41.45175],[69.20439,41.45391],[69.22671,41.46298],[69.23332,41.45847],[69.25059,41.46693],[69.29778,41.43673],[69.35554,41.47211],[69.37468,41.46555],[69.45081,41.46246],[69.39485,41.51518],[69.45751,41.56863],[69.49545,41.545],[70.94483,42.26238],[70.85973,42.30188],[70.97717,42.50147],[71.15232,42.60486],[71.17807,42.67381],[71.22785,42.69248],[71.2724,42.77853],[71.53272,42.8014],[71.62405,42.76613],[71.88792,42.83578],[73.44393,42.43098],[73.50992,42.82356],[73.55634,43.03071],[74.22489,43.24657],[74.57491,43.13702],[74.64615,43.05881],[74.70331,43.02519],[74.75,42.99029],[74.88756,42.98612],[75.22619,42.85528],[75.29966,42.86183],[75.72174,42.79672],[75.82823,42.94848],[78.48469,42.89649],[78.91502,42.76839],[79.19763,42.804],[79.52921,42.44778],[79.97364,42.42816],[80.17807,42.21166],[80.26841,42.23797],[80.16892,42.61137],[80.26886,42.8366],[80.38169,42.83142],[80.58999,42.9011],[80.3735,43.01557],[80.62913,43.141],[80.78817,43.14235],[80.77771,43.30065],[80.69718,43.32589],[80.75156,43.44948],[80.40031,44.10986],[80.40229,44.23319],[80.38384,44.63073],[79.8987,44.89957],[80.11169,45.03352],[81.73278,45.3504],[82.51374,45.1755],[82.58474,45.40027],[82.21792,45.56619],[83.04622,47.19053],[83.92184,46.98912],[84.73077,47.01394],[84.93995,46.87399],[85.22443,47.04816],[85.54294,47.06171],[85.69696,47.2898],[85.61067,47.49753],[85.5169,48.05493],[85.73581,48.3939],[86.38069,48.46064],[86.75343,48.70331],[86.73568,48.99918],[86.87238,49.12432],[87.28386,49.11626],[87.31465,49.23603],[87.03071,49.25142],[86.82606,49.51796],[86.61307,49.60239],[86.79056,49.74787],[86.63674,49.80136],[86.18709,49.50259],[85.24047,49.60239],[84.99198,50.06793],[84.29385,50.27257],[83.8442,50.87375],[83.14607,51.00796],[82.55443,50.75412],[81.94999,50.79307],[81.46581,50.77658],[81.41248,50.97524],[81.06091,50.94833],[81.16999,51.15662],[80.80318,51.28262],[80.44819,51.20855],[80.4127,50.95581],[80.08138,50.77658],[79.11255,52.01171],[77.90383,53.29807],[76.54243,53.99329],[76.44076,54.16017],[76.82266,54.1798],[76.91052,54.4677],[75.3668,54.07439],[75.43398,53.98652],[75.07405,53.80831],[73.39218,53.44623],[73.25412,53.61532],[73.68921,53.86522],[73.74778,54.07194],[73.37963,53.96132],[72.71026,54.1161],[72.43415,53.92685],[72.17477,54.36303],[71.96141,54.17736],[71.10379,54.13326],[71.08706,54.33376],[71.24185,54.64965],[71.08288,54.71253],[70.96009,55.10558],[70.76493,55.3027],[70.19179,55.1476],[69.74917,55.35545],[69.34224,55.36344],[68.90865,55.38148]]]]}},{type:"Feature",properties:{iso1A2:"LA",iso1A3:"LAO",iso1N3:"418",wikidata:"Q819",nameEn:"Laos",groups:["035","142","UN"],callingCodes:["856"]},geometry:{type:"MultiPolygon",coordinates:[[[[102.1245,22.43372],[102.03633,22.46164],[101.98487,22.42766],[101.91344,22.44417],[101.90714,22.38688],[101.86828,22.38397],[101.7685,22.50337],[101.68973,22.46843],[101.61306,22.27515],[101.56789,22.28876],[101.53638,22.24794],[101.60675,22.13513],[101.57525,22.13026],[101.62566,21.96574],[101.7791,21.83019],[101.74555,21.72852],[101.83257,21.61562],[101.80001,21.57461],[101.7475,21.5873],[101.7727,21.51794],[101.74224,21.48276],[101.74014,21.30967],[101.84412,21.25291],[101.83887,21.20983],[101.76745,21.21571],[101.79266,21.19025],[101.7622,21.14813],[101.70548,21.14911],[101.66977,21.20004],[101.60886,21.17947],[101.59491,21.18621],[101.6068,21.23329],[101.54563,21.25668],[101.29326,21.17254],[101.2229,21.23271],[101.26912,21.36482],[101.19349,21.41959],[101.2124,21.56422],[101.15156,21.56129],[101.16198,21.52808],[101.00234,21.39612],[100.80173,21.2934],[100.72716,21.31786],[100.63578,21.05639],[100.55281,21.02796],[100.50974,20.88574],[100.64628,20.88279],[100.60112,20.8347],[100.51079,20.82194],[100.36375,20.82783],[100.1957,20.68247],[100.08404,20.36626],[100.09999,20.31614],[100.09337,20.26293],[100.11785,20.24787],[100.1712,20.24324],[100.16668,20.2986],[100.22076,20.31598],[100.25769,20.3992],[100.33383,20.4028],[100.37439,20.35156],[100.41473,20.25625],[100.44992,20.23644],[100.4537,20.19971],[100.47567,20.19133],[100.51052,20.14928],[100.55218,20.17741],[100.58808,20.15791],[100.5094,19.87904],[100.398,19.75047],[100.49604,19.53504],[100.58219,19.49164],[100.64606,19.55884],[100.77231,19.48324],[100.90302,19.61901],[101.08928,19.59748],[101.26545,19.59242],[101.26991,19.48324],[101.21347,19.46223],[101.20604,19.35296],[101.24911,19.33334],[101.261,19.12717],[101.35606,19.04716],[101.25803,18.89545],[101.22832,18.73377],[101.27585,18.68875],[101.06047,18.43247],[101.18227,18.34367],[101.15108,18.25624],[101.19118,18.2125],[101.1793,18.0544],[101.02185,17.87637],[100.96541,17.57926],[101.15108,17.47586],[101.44667,17.7392],[101.72294,17.92867],[101.78087,18.07559],[101.88485,18.02474],[102.11359,18.21532],[102.45523,17.97106],[102.59234,17.96127],[102.60971,17.95411],[102.61432,17.92273],[102.5896,17.84889],[102.59485,17.83537],[102.68194,17.80151],[102.69946,17.81686],[102.67543,17.84529],[102.68538,17.86653],[102.75954,17.89561],[102.79044,17.93612],[102.81988,17.94233],[102.86323,17.97531],[102.95812,18.0054],[102.9912,17.9949],[103.01998,17.97095],[103.0566,18.00144],[103.07823,18.03833],[103.07343,18.12351],[103.1493,18.17799],[103.14994,18.23172],[103.17093,18.2618],[103.29757,18.30475],[103.23818,18.34875],[103.24779,18.37807],[103.30977,18.4341],[103.41044,18.4486],[103.47773,18.42841],[103.60957,18.40528],[103.699,18.34125],[103.82449,18.33979],[103.85642,18.28666],[103.93916,18.33914],[103.97725,18.33631],[104.06533,18.21656],[104.10927,18.10826],[104.21776,17.99335],[104.2757,17.86139],[104.35432,17.82871],[104.45404,17.66788],[104.69867,17.53038],[104.80061,17.39367],[104.80716,17.19025],[104.73712,17.01404],[104.7373,16.91125],[104.76442,16.84752],[104.7397,16.81005],[104.76099,16.69302],[104.73349,16.565],[104.88057,16.37311],[105.00262,16.25627],[105.06204,16.09792],[105.42001,16.00657],[105.38508,15.987],[105.34115,15.92737],[105.37959,15.84074],[105.42285,15.76971],[105.46573,15.74742],[105.61756,15.68792],[105.60446,15.53301],[105.58191,15.41031],[105.47635,15.3796],[105.4692,15.33709],[105.50662,15.32054],[105.58043,15.32724],[105.46661,15.13132],[105.61162,15.00037],[105.5121,14.80802],[105.53864,14.55731],[105.43783,14.43865],[105.20894,14.34967],[105.2759,14.17496],[105.36775,14.09948],[105.44869,14.10703],[105.5561,14.15684],[105.78338,14.08438],[105.78182,14.02247],[105.90791,13.92881],[106.10405,13.9137],[106.10094,13.98471],[106.16632,14.01794],[106.18656,14.06324],[106.11962,14.11307],[106.10872,14.18401],[106.04801,14.20363],[106.02311,14.30623],[105.99509,14.32734],[106.00131,14.36957],[106.21302,14.36203],[106.25194,14.48415],[106.32355,14.44043],[106.40916,14.45249],[106.43874,14.52032],[106.47766,14.50977],[106.45898,14.55045],[106.50723,14.58963],[106.54148,14.59565],[106.57106,14.50525],[106.59908,14.50977],[106.63333,14.44194],[106.73762,14.42687],[106.80767,14.31226],[106.8497,14.29416],[106.90574,14.33639],[106.9649,14.3198],[106.98825,14.36806],[107.04585,14.41782],[107.03962,14.45099],[107.09722,14.3937],[107.17038,14.41782],[107.21241,14.48716],[107.256,14.48716],[107.26534,14.54292],[107.29803,14.58963],[107.3276,14.58812],[107.37897,14.54443],[107.44435,14.52785],[107.47238,14.61523],[107.54361,14.69092],[107.51579,14.79282],[107.59285,14.87795],[107.48277,14.93751],[107.46516,15.00982],[107.61486,15.0566],[107.61926,15.13949],[107.58844,15.20111],[107.62587,15.2266],[107.60605,15.37524],[107.62367,15.42193],[107.53341,15.40496],[107.50699,15.48771],[107.3815,15.49832],[107.34408,15.62345],[107.27583,15.62769],[107.27143,15.71459],[107.21859,15.74638],[107.21419,15.83747],[107.34188,15.89464],[107.39471,15.88829],[107.46296,16.01106],[107.44975,16.08511],[107.33968,16.05549],[107.25822,16.13587],[107.14595,16.17816],[107.15035,16.26271],[107.09091,16.3092],[107.02597,16.31132],[106.97385,16.30204],[106.96638,16.34938],[106.88067,16.43594],[106.88727,16.52671],[106.84104,16.55415],[106.74418,16.41904],[106.65832,16.47816],[106.66052,16.56892],[106.61477,16.60713],[106.58267,16.6012],[106.59013,16.62259],[106.55485,16.68704],[106.55265,16.86831],[106.52183,16.87884],[106.51963,16.92097],[106.54824,16.92729],[106.55045,17.0031],[106.50862,16.9673],[106.43597,17.01362],[106.31929,17.20509],[106.29287,17.3018],[106.24444,17.24714],[106.18991,17.28227],[106.09019,17.36399],[105.85744,17.63221],[105.76612,17.67147],[105.60381,17.89356],[105.64784,17.96687],[105.46292,18.22008],[105.38366,18.15315],[105.15942,18.38691],[105.10408,18.43533],[105.1327,18.58355],[105.19654,18.64196],[105.12829,18.70453],[104.64617,18.85668],[104.5361,18.97747],[103.87125,19.31854],[104.06058,19.43484],[104.10832,19.51575],[104.05617,19.61743],[104.06498,19.66926],[104.23229,19.70242],[104.41281,19.70035],[104.53169,19.61743],[104.64837,19.62365],[104.68359,19.72729],[104.8355,19.80395],[104.8465,19.91783],[104.9874,20.09573],[104.91695,20.15567],[104.86852,20.14121],[104.61315,20.24452],[104.62195,20.36633],[104.72102,20.40554],[104.66158,20.47774],[104.47886,20.37459],[104.40621,20.3849],[104.38199,20.47155],[104.63957,20.6653],[104.27412,20.91433],[104.11121,20.96779],[103.98024,20.91531],[103.82282,20.8732],[103.73478,20.6669],[103.68633,20.66324],[103.45737,20.82382],[103.38032,20.79501],[103.21497,20.89832],[103.12055,20.89994],[103.03469,21.05821],[102.97745,21.05821],[102.89825,21.24707],[102.80794,21.25736],[102.88939,21.3107],[102.94223,21.46034],[102.86297,21.4255],[102.98846,21.58936],[102.97965,21.74076],[102.86077,21.71213],[102.85637,21.84501],[102.81894,21.83888],[102.82115,21.73667],[102.74189,21.66713],[102.67145,21.65894],[102.62301,21.91447],[102.49092,21.99002],[102.51734,22.02676],[102.18712,22.30403],[102.14099,22.40092],[102.1245,22.43372]]]]}},{type:"Feature",properties:{iso1A2:"LB",iso1A3:"LBN",iso1N3:"422",wikidata:"Q822",nameEn:"Lebanon",aliases:["RL"],groups:["145","142","UN"],callingCodes:["961"]},geometry:{type:"MultiPolygon",coordinates:[[[[35.94816,33.47886],[35.94465,33.52774],[36.05723,33.57904],[35.9341,33.6596],[36.06778,33.82927],[36.14517,33.85118],[36.3967,33.83365],[36.38263,33.86579],[36.28589,33.91981],[36.41078,34.05253],[36.50576,34.05982],[36.5128,34.09916],[36.62537,34.20251],[36.59195,34.2316],[36.58667,34.27667],[36.60778,34.31009],[36.56556,34.31881],[36.53039,34.3798],[36.55853,34.41609],[36.46179,34.46541],[36.4442,34.50165],[36.34745,34.5002],[36.3369,34.52629],[36.39846,34.55672],[36.41429,34.61175],[36.45299,34.59438],[36.46003,34.6378],[36.42941,34.62505],[36.35384,34.65447],[36.35135,34.68516],[36.32399,34.69334],[36.29165,34.62991],[35.98718,34.64977],[35.97386,34.63322],[35.48515,34.70851],[34.78515,33.20368],[35.10645,33.09318],[35.1924,33.08743],[35.31429,33.10515],[35.35223,33.05617],[35.43059,33.06659],[35.448,33.09264],[35.50272,33.09056],[35.50335,33.114],[35.52573,33.11921],[35.54228,33.19865],[35.5362,33.23196],[35.54808,33.236],[35.54544,33.25513],[35.55555,33.25844],[35.56523,33.28969],[35.58326,33.28381],[35.58502,33.26653],[35.62283,33.24226],[35.62019,33.27278],[35.77477,33.33609],[35.81324,33.36354],[35.82577,33.40479],[35.88668,33.43183],[35.94816,33.47886]]]]}},{type:"Feature",properties:{iso1A2:"LC",iso1A3:"LCA",iso1N3:"662",wikidata:"Q760",nameEn:"St. Lucia",aliases:["WL"],groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 758"]},geometry:{type:"MultiPolygon",coordinates:[[[[-59.95997,14.20285],[-61.69315,14.26451],[-59.94058,12.34011],[-59.95997,14.20285]]]]}},{type:"Feature",properties:{iso1A2:"LI",iso1A3:"LIE",iso1N3:"438",wikidata:"Q347",nameEn:"Liechtenstein",aliases:["FL"],groups:["155","150","UN"],callingCodes:["423"]},geometry:{type:"MultiPolygon",coordinates:[[[[9.60717,47.06091],[9.61216,47.07732],[9.63395,47.08443],[9.62623,47.14685],[9.56539,47.17124],[9.58264,47.20673],[9.56981,47.21926],[9.55176,47.22585],[9.56766,47.24281],[9.53116,47.27029],[9.52406,47.24959],[9.50318,47.22153],[9.4891,47.19346],[9.48774,47.17402],[9.51044,47.13727],[9.52089,47.10019],[9.51362,47.08505],[9.47139,47.06402],[9.47548,47.05257],[9.54041,47.06495],[9.55721,47.04762],[9.60717,47.06091]]]]}},{type:"Feature",properties:{iso1A2:"LK",iso1A3:"LKA",iso1N3:"144",wikidata:"Q854",nameEn:"Sri Lanka",groups:["034","142","UN"],driveSide:"left",callingCodes:["94"]},geometry:{type:"MultiPolygon",coordinates:[[[[76.59015,5.591],[85.15017,5.21497],[80.48418,10.20786],[79.42124,9.80115],[79.50447,8.91876],[76.59015,5.591]]]]}},{type:"Feature",properties:{iso1A2:"LR",iso1A3:"LBR",iso1N3:"430",wikidata:"Q1014",nameEn:"Liberia",groups:["011","202","002","UN"],callingCodes:["231"]},geometry:{type:"MultiPolygon",coordinates:[[[[-8.47114,7.55676],[-8.55874,7.62525],[-8.55874,7.70167],[-8.67814,7.69428],[-8.72789,7.51429],[-8.8448,7.35149],[-8.85724,7.26019],[-8.93435,7.2824],[-9.09107,7.1985],[-9.18311,7.30461],[-9.20798,7.38109],[-9.305,7.42056],[-9.41943,7.41809],[-9.48161,7.37122],[-9.37465,7.62032],[-9.35724,7.74111],[-9.44928,7.9284],[-9.41445,8.02448],[-9.50898,8.18455],[-9.47415,8.35195],[-9.77763,8.54633],[-10.05873,8.42578],[-10.05375,8.50697],[-10.14579,8.52665],[-10.203,8.47991],[-10.27575,8.48711],[-10.30084,8.30008],[-10.31635,8.28554],[-10.29839,8.21283],[-10.35227,8.15223],[-10.45023,8.15627],[-10.51554,8.1393],[-10.57523,8.04829],[-10.60492,8.04072],[-10.60422,7.7739],[-11.29417,7.21576],[-11.4027,6.97746],[-11.50429,6.92704],[-12.15048,6.15992],[-7.52774,3.7105],[-7.53259,4.35145],[-7.59349,4.8909],[-7.53876,4.94294],[-7.55369,5.08667],[-7.48901,5.14118],[-7.46165,5.26256],[-7.36463,5.32944],[-7.43428,5.42355],[-7.37209,5.61173],[-7.43926,5.74787],[-7.43677,5.84687],[-7.46165,5.84934],[-7.48155,5.80974],[-7.67309,5.94337],[-7.70294,5.90625],[-7.78254,5.99037],[-7.79747,6.07696],[-7.8497,6.08932],[-7.83478,6.20309],[-7.90692,6.27728],[-8.00642,6.31684],[-8.17557,6.28222],[-8.3298,6.36381],[-8.38453,6.35887],[-8.45666,6.49977],[-8.48652,6.43797],[-8.59456,6.50612],[-8.31736,6.82837],[-8.29249,7.1691],[-8.37458,7.25794],[-8.41935,7.51203],[-8.47114,7.55676]]]]}},{type:"Feature",properties:{iso1A2:"LS",iso1A3:"LSO",iso1N3:"426",wikidata:"Q1013",nameEn:"Lesotho",groups:["018","202","002","UN"],driveSide:"left",callingCodes:["266"]},geometry:{type:"MultiPolygon",coordinates:[[[[29.33204,-29.45598],[29.44883,-29.3772],[29.40524,-29.21246],[28.68043,-28.58744],[28.65091,-28.57025],[28.40612,-28.6215],[28.30518,-28.69531],[28.2348,-28.69471],[28.1317,-28.7293],[28.02503,-28.85991],[27.98675,-28.8787],[27.9392,-28.84864],[27.88933,-28.88156],[27.8907,-28.91612],[27.75458,-28.89839],[27.55974,-29.18954],[27.5158,-29.2261],[27.54258,-29.25575],[27.48679,-29.29349],[27.45125,-29.29708],[27.47254,-29.31968],[27.4358,-29.33465],[27.33464,-29.48161],[27.01016,-29.65439],[27.09489,-29.72796],[27.22719,-30.00718],[27.29603,-30.05473],[27.32555,-30.14785],[27.40778,-30.14577],[27.37293,-30.19401],[27.36649,-30.27246],[27.38108,-30.33456],[27.45452,-30.32239],[27.56901,-30.42504],[27.56781,-30.44562],[27.62137,-30.50509],[27.6521,-30.51707],[27.67819,-30.53437],[27.69467,-30.55862],[27.74814,-30.60635],[28.12073,-30.68072],[28.2319,-30.28476],[28.399,-30.1592],[28.68627,-30.12885],[28.80222,-30.10579],[28.9338,-30.05072],[29.16548,-29.91706],[29.12553,-29.76266],[29.28545,-29.58456],[29.33204,-29.45598]]]]}},{type:"Feature",properties:{iso1A2:"LT",iso1A3:"LTU",iso1N3:"440",wikidata:"Q37",nameEn:"Lithuania",groups:["EU","154","150","UN"],callingCodes:["370"]},geometry:{type:"MultiPolygon",coordinates:[[[[24.89005,56.46666],[24.83686,56.41565],[24.70022,56.40483],[24.57353,56.31525],[24.58143,56.29125],[24.42746,56.26522],[24.32334,56.30226],[24.13139,56.24881],[24.02657,56.3231],[23.75726,56.37282],[23.49803,56.34307],[23.40486,56.37689],[23.31606,56.3827],[23.17312,56.36795],[23.09531,56.30511],[22.96988,56.41213],[22.83048,56.367],[22.69354,56.36284],[22.56441,56.39305],[22.3361,56.4016],[22.09728,56.42851],[22.00548,56.41508],[21.74558,56.33181],[21.57888,56.31406],[21.49736,56.29106],[21.24644,56.16917],[21.15016,56.07818],[20.68447,56.04073],[20.60454,55.40986],[20.95181,55.27994],[21.26425,55.24456],[21.35465,55.28427],[21.38446,55.29348],[21.46766,55.21115],[21.51095,55.18507],[21.55605,55.20311],[21.64954,55.1791],[21.85521,55.09493],[21.96505,55.07353],[21.99543,55.08691],[22.03984,55.07888],[22.02582,55.05078],[22.06087,55.02935],[22.11697,55.02131],[22.14267,55.05345],[22.31562,55.0655],[22.47688,55.04408],[22.58907,55.07085],[22.60075,55.01863],[22.65451,54.97037],[22.68723,54.9811],[22.76422,54.92521],[22.85083,54.88711],[22.87317,54.79492],[22.73631,54.72952],[22.73397,54.66604],[22.75467,54.6483],[22.74225,54.64339],[22.7522,54.63525],[22.68021,54.58486],[22.71293,54.56454],[22.67788,54.532],[22.70208,54.45312],[22.7253,54.41732],[22.79705,54.36264],[22.83756,54.40827],[23.00584,54.38514],[22.99649,54.35927],[23.05726,54.34565],[23.04323,54.31567],[23.104,54.29794],[23.13905,54.31567],[23.15526,54.31076],[23.15938,54.29894],[23.24656,54.25701],[23.3494,54.25155],[23.39525,54.21672],[23.42418,54.17911],[23.45223,54.17775],[23.49196,54.14764],[23.52702,54.04622],[23.48261,53.98855],[23.51284,53.95052],[23.61677,53.92691],[23.71726,53.93379],[23.80543,53.89558],[23.81309,53.94205],[23.95098,53.9613],[23.98837,53.92554],[24.19638,53.96405],[24.34128,53.90076],[24.44411,53.90076],[24.62275,54.00217],[24.69652,54.01901],[24.69185,53.96543],[24.74279,53.96663],[24.85311,54.02862],[24.77131,54.11091],[24.96894,54.17589],[24.991,54.14241],[25.0728,54.13419],[25.19199,54.219],[25.22705,54.26271],[25.35559,54.26544],[25.509,54.30267],[25.56823,54.25212],[25.51452,54.17799],[25.54724,54.14925],[25.64875,54.1259],[25.71084,54.16704],[25.78563,54.15747],[25.78553,54.23327],[25.68513,54.31727],[25.55425,54.31591],[25.5376,54.33158],[25.63371,54.42075],[25.62203,54.4656],[25.64813,54.48704],[25.68045,54.5321],[25.75977,54.57252],[25.74122,54.80108],[25.89462,54.93438],[25.99129,54.95705],[26.05907,54.94631],[26.13386,54.98924],[26.20397,54.99729],[26.26941,55.08032],[26.23202,55.10439],[26.30628,55.12536],[26.35121,55.1525],[26.46249,55.12814],[26.51481,55.16051],[26.54753,55.14181],[26.69243,55.16718],[26.68075,55.19787],[26.72983,55.21788],[26.73017,55.24226],[26.835,55.28182],[26.83266,55.30444],[26.80929,55.31642],[26.6714,55.33902],[26.5709,55.32572],[26.44937,55.34832],[26.5522,55.40277],[26.55094,55.5093],[26.63167,55.57887],[26.63231,55.67968],[26.58248,55.6754],[26.46661,55.70375],[26.39561,55.71156],[26.18509,55.86813],[26.03815,55.95884],[25.90047,56.0013],[25.85893,56.00188],[25.81773,56.05444],[25.69246,56.08892],[25.68588,56.14725],[25.53621,56.16663],[25.39751,56.15707],[25.23099,56.19147],[25.09325,56.1878],[25.05762,56.26742],[24.89005,56.46666]]]]}},{type:"Feature",properties:{iso1A2:"LU",iso1A3:"LUX",iso1N3:"442",wikidata:"Q32",nameEn:"Luxembourg",groups:["EU","155","150","UN"],callingCodes:["352"]},geometry:{type:"MultiPolygon",coordinates:[[[[6.1379,50.12964],[6.1137,50.13668],[6.12028,50.16374],[6.08577,50.17246],[6.06406,50.15344],[6.03093,50.16362],[6.02488,50.18283],[5.96453,50.17259],[5.95929,50.13295],[5.89488,50.11476],[5.8857,50.07824],[5.85474,50.06342],[5.86904,50.04614],[5.8551,50.02683],[5.81866,50.01286],[5.82331,49.99662],[5.83968,49.9892],[5.83467,49.97823],[5.81163,49.97142],[5.80833,49.96451],[5.77291,49.96056],[5.77314,49.93646],[5.73621,49.89796],[5.78415,49.87922],[5.75269,49.8711],[5.75861,49.85631],[5.74567,49.85368],[5.75884,49.84811],[5.74953,49.84709],[5.74975,49.83933],[5.74076,49.83823],[5.7404,49.83452],[5.74844,49.82435],[5.74364,49.82058],[5.74953,49.81428],[5.75409,49.79239],[5.78871,49.7962],[5.82245,49.75048],[5.83149,49.74729],[5.82562,49.72395],[5.84193,49.72161],[5.86503,49.72739],[5.88677,49.70951],[5.86527,49.69291],[5.86175,49.67862],[5.9069,49.66377],[5.90164,49.6511],[5.90599,49.63853],[5.88552,49.63507],[5.88393,49.62802],[5.87609,49.62047],[5.8762,49.60898],[5.84826,49.5969],[5.84971,49.58674],[5.86986,49.58756],[5.87256,49.57539],[5.8424,49.56082],[5.84692,49.55663],[5.84143,49.5533],[5.81838,49.54777],[5.80871,49.5425],[5.81664,49.53775],[5.83648,49.5425],[5.84466,49.53027],[5.83467,49.52717],[5.83389,49.52152],[5.86571,49.50015],[5.94128,49.50034],[5.94224,49.49608],[5.96876,49.49053],[5.97693,49.45513],[6.02648,49.45451],[6.02743,49.44845],[6.04176,49.44801],[6.05553,49.46663],[6.07887,49.46399],[6.08373,49.45594],[6.10072,49.45268],[6.09845,49.46351],[6.10325,49.4707],[6.12346,49.4735],[6.12814,49.49365],[6.14321,49.48796],[6.16115,49.49297],[6.15366,49.50226],[6.17386,49.50934],[6.19543,49.50536],[6.2409,49.51408],[6.25029,49.50609],[6.27875,49.503],[6.28818,49.48465],[6.3687,49.4593],[6.36778,49.46937],[6.36907,49.48931],[6.36788,49.50377],[6.35666,49.52931],[6.38072,49.55171],[6.38228,49.55855],[6.35825,49.57053],[6.36676,49.57813],[6.38024,49.57593],[6.38342,49.5799],[6.37464,49.58886],[6.385,49.59946],[6.39822,49.60081],[6.41861,49.61723],[6.4413,49.65722],[6.43768,49.66021],[6.42726,49.66078],[6.42937,49.66857],[6.44654,49.67799],[6.46048,49.69092],[6.48014,49.69767],[6.49785,49.71118],[6.50647,49.71353],[6.5042,49.71808],[6.49694,49.72205],[6.49535,49.72645],[6.50261,49.72718],[6.51397,49.72058],[6.51805,49.72425],[6.50193,49.73291],[6.50174,49.75292],[6.51646,49.75961],[6.51828,49.76855],[6.51056,49.77515],[6.51669,49.78336],[6.50534,49.78952],[6.52169,49.79787],[6.53122,49.80666],[6.52121,49.81338],[6.51215,49.80124],[6.50647,49.80916],[6.48718,49.81267],[6.47111,49.82263],[6.45425,49.81164],[6.44131,49.81443],[6.42905,49.81091],[6.42521,49.81591],[6.40022,49.82029],[6.36576,49.85032],[6.34267,49.84974],[6.33585,49.83785],[6.32098,49.83728],[6.32303,49.85133],[6.30963,49.87021],[6.29692,49.86685],[6.28874,49.87592],[6.26146,49.88203],[6.23496,49.89972],[6.22926,49.92096],[6.21882,49.92403],[6.22608,49.929],[6.22094,49.94955],[6.19856,49.95053],[6.19089,49.96991],[6.18045,49.96611],[6.18554,49.95622],[6.17872,49.9537],[6.16466,49.97086],[6.1701,49.98518],[6.14147,49.99563],[6.14948,50.00908],[6.13806,50.01056],[6.1295,50.01849],[6.13273,50.02019],[6.13794,50.01466],[6.14666,50.02207],[6.13044,50.02929],[6.13458,50.04141],[6.11274,50.05916],[6.12055,50.09171],[6.1379,50.12964]]]]}},{type:"Feature",properties:{iso1A2:"LV",iso1A3:"LVA",iso1N3:"428",wikidata:"Q211",nameEn:"Latvia",groups:["EU","154","150","UN"],callingCodes:["371"]},geometry:{type:"MultiPolygon",coordinates:[[[[27.34698,57.52242],[26.90364,57.62823],[26.54675,57.51813],[26.46527,57.56885],[26.29253,57.59244],[26.1866,57.6849],[26.2029,57.7206],[26.08098,57.76619],[26.0543,57.76105],[26.03332,57.7718],[26.02415,57.76865],[26.02069,57.77169],[26.0266,57.77441],[26.027,57.78158],[26.02456,57.78342],[26.0324,57.79037],[26.05949,57.84744],[25.73499,57.90193],[25.29581,58.08288],[25.28237,57.98539],[25.19484,58.0831],[24.3579,57.87471],[24.26221,57.91787],[23.20055,57.56697],[22.80496,57.87798],[19.84909,57.57876],[19.64795,57.06466],[20.68447,56.04073],[21.15016,56.07818],[21.24644,56.16917],[21.49736,56.29106],[21.57888,56.31406],[21.74558,56.33181],[22.00548,56.41508],[22.09728,56.42851],[22.3361,56.4016],[22.56441,56.39305],[22.69354,56.36284],[22.83048,56.367],[22.96988,56.41213],[23.09531,56.30511],[23.17312,56.36795],[23.31606,56.3827],[23.40486,56.37689],[23.49803,56.34307],[23.75726,56.37282],[24.02657,56.3231],[24.13139,56.24881],[24.32334,56.30226],[24.42746,56.26522],[24.58143,56.29125],[24.57353,56.31525],[24.70022,56.40483],[24.83686,56.41565],[24.89005,56.46666],[25.05762,56.26742],[25.09325,56.1878],[25.23099,56.19147],[25.39751,56.15707],[25.53621,56.16663],[25.68588,56.14725],[25.69246,56.08892],[25.81773,56.05444],[25.85893,56.00188],[25.90047,56.0013],[26.03815,55.95884],[26.18509,55.86813],[26.39561,55.71156],[26.46661,55.70375],[26.58248,55.6754],[26.63231,55.67968],[26.64888,55.70515],[26.71802,55.70645],[26.76872,55.67658],[26.87448,55.7172],[26.97153,55.8102],[27.1559,55.85032],[27.27804,55.78299],[27.3541,55.8089],[27.61683,55.78558],[27.63065,55.89687],[27.97865,56.11849],[28.15217,56.16964],[28.23716,56.27588],[28.16599,56.37806],[28.19057,56.44637],[28.10069,56.524],[28.13526,56.57989],[28.04768,56.59004],[27.86101,56.88204],[27.66511,56.83921],[27.86101,57.29402],[27.52453,57.42826],[27.56832,57.53728],[27.34698,57.52242]]]]}},{type:"Feature",properties:{iso1A2:"LY",iso1A3:"LBY",iso1N3:"434",wikidata:"Q1016",nameEn:"Libya",groups:["015","002","UN"],callingCodes:["218"]},geometry:{type:"MultiPolygon",coordinates:[[[[26.92891,33.39516],[11.58941,33.36891],[11.55852,33.1409],[11.51549,33.09826],[11.46037,32.6307],[11.57828,32.48013],[11.53898,32.4138],[11.04234,32.2145],[10.7315,31.97235],[10.62788,31.96629],[10.48497,31.72956],[10.31364,31.72648],[10.12239,31.42098],[10.29516,30.90337],[9.88152,30.34074],[9.76848,30.34366],[9.55544,30.23971],[9.3876,30.16738],[9.78136,29.40961],[9.89569,26.57696],[9.51696,26.39148],[9.38834,26.19288],[10.03146,25.35635],[10.02432,24.98124],[10.33159,24.5465],[10.85323,24.5595],[11.41061,24.21456],[11.62498,24.26669],[11.96886,23.51735],[13.5631,23.16574],[14.22918,22.61719],[14.99751,23.00539],[15.99566,23.49639],[23.99539,19.49944],[23.99715,20.00038],[24.99794,19.99661],[24.99885,21.99535],[24.99968,29.24574],[24.71117,30.17441],[25.01077,30.73861],[24.8458,31.39877],[26.92891,33.39516]]]]}},{type:"Feature",properties:{iso1A2:"MA",iso1A3:"MAR",iso1N3:"504",wikidata:"Q1028",nameEn:"Morocco",groups:["015","002","UN"],callingCodes:["212"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.27707,35.35051],[-5.10878,36.05227],[-7.2725,35.73269],[-14.43883,27.02969],[-17.27295,21.93519],[-17.21511,21.34226],[-17.02707,21.34022],[-16.9978,21.36239],[-16.44269,21.39745],[-14.78487,21.36587],[-14.47329,21.63839],[-14.48112,22.00886],[-14.1291,22.41636],[-14.10361,22.75501],[-13.75627,23.77231],[-13.00628,24.01923],[-12.92147,24.39502],[-12.12281,25.13682],[-12.06001,26.04442],[-11.62052,26.05229],[-11.38635,26.611],[-11.23622,26.72023],[-11.35695,26.8505],[-10.68417,26.90984],[-9.81998,26.71379],[-9.56957,26.90042],[-9.08698,26.98639],[-8.71787,26.9898],[-8.77527,27.66663],[-8.66879,27.6666],[-8.6715,28.71194],[-7.61585,29.36252],[-6.95824,29.50924],[-6.78351,29.44634],[-6.69965,29.51623],[-5.75616,29.61407],[-5.72121,29.52322],[-5.58831,29.48103],[-5.21671,29.95253],[-4.6058,30.28343],[-4.31774,30.53229],[-3.64735,30.67539],[-3.65418,30.85566],[-3.54944,31.0503],[-3.77103,31.14984],[-3.77647,31.31912],[-3.66386,31.39202],[-3.66314,31.6339],[-2.82784,31.79459],[-2.93873,32.06557],[-2.46166,32.16603],[-1.22829,32.07832],[-1.15735,32.12096],[-1.24453,32.1917],[-1.24998,32.32993],[-.9912,32.52467],[-1.37794,32.73628],[-1.54244,32.95499],[-1.46249,33.0499],[-1.67067,33.27084],[-1.59508,33.59929],[-1.73494,33.71721],[-1.64666,34.10405],[-1.78042,34.39018],[-1.69788,34.48056],[-1.84569,34.61907],[-1.73707,34.74226],[-1.97469,34.886],[-1.97833,34.93218],[-2.04734,34.93218],[-2.21445,35.04378],[-2.21248,35.08532],[-2.27707,35.35051]],[[-2.91909,35.33927],[-2.92272,35.27509],[-2.93893,35.26737],[-2.95065,35.26576],[-2.95431,35.2728],[-2.96516,35.27967],[-2.96826,35.28296],[-2.96507,35.28801],[-2.97035,35.28852],[-2.96978,35.29459],[-2.96648,35.30475],[-2.96038,35.31609],[-2.91909,35.33927]],[[-3.90602,35.21494],[-3.89343,35.22728],[-3.88372,35.20767],[-3.90602,35.21494]],[[-4.30191,35.17419],[-4.29436,35.17149],[-4.30112,35.17058],[-4.30191,35.17419]],[[-2.40316,35.16893],[-2.45965,35.16527],[-2.43262,35.20652],[-2.40316,35.16893]],[[-5.38491,35.92591],[-5.21179,35.90091],[-5.34379,35.8711],[-5.35844,35.87375],[-5.37338,35.88417],[-5.38491,35.92591]]]]}},{type:"Feature",properties:{iso1A2:"MC",iso1A3:"MCO",iso1N3:"492",wikidata:"Q235",nameEn:"Monaco",groups:["155","150","UN"],callingCodes:["377"]},geometry:{type:"MultiPolygon",coordinates:[[[[7.47823,43.73341],[7.4379,43.74963],[7.4389,43.75151],[7.43708,43.75197],[7.43624,43.75014],[7.43013,43.74895],[7.42809,43.74396],[7.42443,43.74087],[7.42299,43.74176],[7.42062,43.73977],[7.41233,43.73439],[7.41298,43.73311],[7.41291,43.73168],[7.41113,43.73156],[7.40903,43.7296],[7.42422,43.72209],[7.47823,43.73341]]]]}},{type:"Feature",properties:{iso1A2:"MD",iso1A3:"MDA",iso1N3:"498",wikidata:"Q217",nameEn:"Moldova",groups:["151","150","UN"],callingCodes:["373"]},geometry:{type:"MultiPolygon",coordinates:[[[[27.74422,48.45926],[27.6658,48.44034],[27.59027,48.46311],[27.5889,48.49224],[27.46942,48.454],[27.44333,48.41209],[27.37741,48.41026],[27.37604,48.44398],[27.32159,48.4434],[27.27855,48.37534],[27.13434,48.37288],[27.08078,48.43214],[27.0231,48.42485],[27.03821,48.37653],[26.93384,48.36558],[26.85556,48.41095],[26.71274,48.40388],[26.82809,48.31629],[26.79239,48.29071],[26.6839,48.35828],[26.62823,48.25804],[26.81161,48.25049],[26.87708,48.19919],[26.94265,48.1969],[26.98042,48.15752],[26.96119,48.13003],[27.04118,48.12522],[27.02985,48.09083],[27.15622,47.98538],[27.1618,47.92391],[27.29069,47.73722],[27.25519,47.71366],[27.32202,47.64009],[27.3979,47.59473],[27.47942,47.48113],[27.55731,47.46637],[27.60263,47.32507],[27.68706,47.28962],[27.73172,47.29248],[27.81892,47.1381],[28.09095,46.97621],[28.12173,46.82283],[28.24808,46.64305],[28.22281,46.50481],[28.25769,46.43334],[28.18902,46.35283],[28.19864,46.31869],[28.10937,46.22852],[28.13684,46.18099],[28.08612,46.01105],[28.13111,45.92819],[28.16568,45.6421],[28.08927,45.6051],[28.18741,45.47358],[28.21139,45.46895],[28.30201,45.54744],[28.41836,45.51715],[28.43072,45.48538],[28.51449,45.49982],[28.49252,45.56716],[28.54196,45.58062],[28.51587,45.6613],[28.47879,45.66994],[28.52823,45.73803],[28.70401,45.78019],[28.69852,45.81753],[28.78503,45.83475],[28.74383,45.96664],[28.98004,46.00385],[29.00613,46.04962],[28.94643,46.09176],[29.06656,46.19716],[28.94953,46.25852],[28.98478,46.31803],[29.004,46.31495],[28.9306,46.45699],[29.01241,46.46177],[29.02409,46.49582],[29.23547,46.55435],[29.24886,46.37912],[29.35357,46.49505],[29.49914,46.45889],[29.5939,46.35472],[29.6763,46.36041],[29.66359,46.4215],[29.74496,46.45605],[29.88329,46.35851],[29.94114,46.40114],[30.09103,46.38694],[30.16794,46.40967],[30.02511,46.45132],[29.88916,46.54302],[29.94409,46.56002],[29.9743,46.75325],[29.94522,46.80055],[29.98814,46.82358],[29.87405,46.88199],[29.75458,46.8604],[29.72986,46.92234],[29.57056,46.94766],[29.62137,47.05069],[29.61038,47.09932],[29.53044,47.07851],[29.49732,47.12878],[29.57696,47.13581],[29.54996,47.24962],[29.59665,47.25521],[29.5733,47.36508],[29.48678,47.36043],[29.47854,47.30366],[29.39889,47.30179],[29.3261,47.44664],[29.18603,47.43387],[29.11743,47.55001],[29.22414,47.60012],[29.22242,47.73607],[29.27255,47.79953],[29.20663,47.80367],[29.27804,47.88893],[29.19839,47.89261],[29.1723,47.99013],[28.9306,47.96255],[28.8414,48.03392],[28.85232,48.12506],[28.69896,48.13106],[28.53921,48.17453],[28.48428,48.0737],[28.42454,48.12047],[28.43701,48.15832],[28.38712,48.17567],[28.34009,48.13147],[28.30609,48.14018],[28.30586,48.1597],[28.34912,48.1787],[28.36996,48.20543],[28.35519,48.24957],[28.32508,48.23384],[28.2856,48.23202],[28.19314,48.20749],[28.17666,48.25963],[28.07504,48.23494],[28.09873,48.3124],[28.04527,48.32661],[27.95883,48.32368],[27.88391,48.36699],[27.87533,48.4037],[27.81902,48.41874],[27.79225,48.44244],[27.74422,48.45926]]]]}},{type:"Feature",properties:{iso1A2:"ME",iso1A3:"MNE",iso1N3:"499",wikidata:"Q236",nameEn:"Montenegro",groups:["039","150","UN"],callingCodes:["382"]},geometry:{type:"MultiPolygon",coordinates:[[[[19.22807,43.5264],[19.15685,43.53943],[19.13933,43.5282],[19.04934,43.50384],[19.01078,43.55806],[18.91379,43.50299],[18.95469,43.49367],[18.96053,43.45042],[19.01078,43.43854],[19.04071,43.397],[19.08673,43.31453],[19.08206,43.29668],[19.04233,43.30008],[19.00844,43.24988],[18.95001,43.29327],[18.95819,43.32899],[18.90911,43.36383],[18.83912,43.34795],[18.84794,43.33735],[18.85342,43.32426],[18.76538,43.29838],[18.6976,43.25243],[18.71747,43.2286],[18.66605,43.2056],[18.64735,43.14766],[18.66254,43.03928],[18.52232,43.01451],[18.49076,42.95553],[18.49661,42.89306],[18.4935,42.86433],[18.47633,42.85829],[18.45921,42.81682],[18.47324,42.74992],[18.56789,42.72074],[18.55221,42.69045],[18.54603,42.69171],[18.54841,42.68328],[18.57373,42.64429],[18.52232,42.62279],[18.55504,42.58409],[18.53751,42.57376],[18.49778,42.58409],[18.43735,42.55921],[18.44307,42.51077],[18.43588,42.48556],[18.52152,42.42302],[18.54128,42.39171],[18.45131,42.21682],[19.26406,41.74971],[19.37597,41.84849],[19.37451,41.8842],[19.33812,41.90669],[19.34601,41.95675],[19.37691,41.96977],[19.36867,42.02564],[19.37548,42.06835],[19.40687,42.10024],[19.28623,42.17745],[19.42,42.33019],[19.42352,42.36546],[19.4836,42.40831],[19.65972,42.62774],[19.73244,42.66299],[19.77375,42.58517],[19.74731,42.57422],[19.76549,42.50237],[19.82333,42.46581],[19.9324,42.51699],[20.00842,42.5109],[20.01834,42.54622],[20.07761,42.55582],[20.0969,42.65559],[20.02915,42.71147],[20.02088,42.74789],[20.04898,42.77701],[20.2539,42.76245],[20.27869,42.81945],[20.35692,42.8335],[20.34528,42.90676],[20.16415,42.97177],[20.14896,42.99058],[20.12325,42.96237],[20.05431,42.99571],[20.04729,43.02732],[19.98887,43.0538],[19.96549,43.11098],[19.92576,43.08539],[19.79255,43.11951],[19.76918,43.16044],[19.64063,43.19027],[19.62661,43.2286],[19.54598,43.25158],[19.52962,43.31623],[19.48171,43.32644],[19.44315,43.38846],[19.22229,43.47926],[19.22807,43.5264]]]]}},{type:"Feature",properties:{iso1A2:"MF",iso1A3:"MAF",iso1N3:"663",wikidata:"Q126125",nameEn:"Saint-Martin",country:"FR",groups:["Q3320166","EU","029","003","419","019","UN"],callingCodes:["590"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.93924,18.02904],[-62.62718,18.26185],[-63.35989,18.06012],[-63.33064,17.9615],[-63.13502,18.05445],[-63.11042,18.05339],[-63.09686,18.04608],[-63.07759,18.04943],[-63.0579,18.06614],[-63.04039,18.05619],[-63.02323,18.05757],[-62.93924,18.02904]]]]}},{type:"Feature",properties:{iso1A2:"MG",iso1A3:"MDG",iso1N3:"450",wikidata:"Q1019",nameEn:"Madagascar",aliases:["RM"],groups:["014","202","002","UN"],callingCodes:["261"]},geometry:{type:"MultiPolygon",coordinates:[[[[51.93891,-10.85085],[45.84651,-12.77177],[42.14681,-19.63341],[45.80092,-33.00974],[51.93891,-10.85085]]]]}},{type:"Feature",properties:{iso1A2:"MH",iso1A3:"MHL",iso1N3:"584",wikidata:"Q709",nameEn:"Marshall Islands",groups:["057","009","UN"],roadSpeedUnit:"mph",callingCodes:["692"]},geometry:{type:"MultiPolygon",coordinates:[[[[169,3.9],[173.53711,5.70687],[169.29099,15.77133],[159.04653,10.59067],[169,3.9]]]]}},{type:"Feature",properties:{iso1A2:"MK",iso1A3:"MKD",iso1N3:"807",wikidata:"Q221",nameEn:"North Macedonia",groups:["039","150","UN"],callingCodes:["389"]},geometry:{type:"MultiPolygon",coordinates:[[[[22.34773,42.31725],[22.29275,42.34913],[22.29605,42.37477],[22.16384,42.32103],[22.02908,42.29848],[21.94405,42.34669],[21.91595,42.30392],[21.84654,42.3247],[21.77176,42.2648],[21.70111,42.23789],[21.58992,42.25915],[21.52145,42.24465],[21.50823,42.27156],[21.43882,42.2789],[21.43882,42.23609],[21.38428,42.24465],[21.30496,42.1418],[21.29913,42.13954],[21.31983,42.10993],[21.22728,42.08909],[21.16614,42.19815],[21.11491,42.20794],[20.75464,42.05229],[20.76786,41.91839],[20.68523,41.85318],[20.59524,41.8818],[20.55976,41.87068],[20.57144,41.7897],[20.53405,41.78099],[20.51301,41.72433],[20.52937,41.69292],[20.51769,41.65975],[20.55508,41.58113],[20.52103,41.56473],[20.45809,41.5549],[20.45331,41.51436],[20.49039,41.49277],[20.51301,41.442],[20.55976,41.4087],[20.52119,41.34381],[20.49432,41.33679],[20.51068,41.2323],[20.59715,41.13644],[20.58546,41.11179],[20.59832,41.09066],[20.63454,41.0889],[20.65558,41.08009],[20.71634,40.91781],[20.73504,40.9081],[20.81567,40.89662],[20.83671,40.92752],[20.94305,40.92399],[20.97693,40.90103],[20.97887,40.85475],[21.15262,40.85546],[21.21105,40.8855],[21.25779,40.86165],[21.35595,40.87578],[21.41555,40.9173],[21.53007,40.90759],[21.57448,40.86076],[21.69601,40.9429],[21.7556,40.92525],[21.91102,41.04786],[21.90869,41.09191],[22.06527,41.15617],[22.1424,41.12449],[22.17629,41.15969],[22.26744,41.16409],[22.42285,41.11921],[22.5549,41.13065],[22.58295,41.11568],[22.62852,41.14385],[22.65306,41.18168],[22.71266,41.13945],[22.74538,41.16321],[22.76408,41.32225],[22.81199,41.3398],[22.93334,41.34104],[22.96331,41.35782],[22.95513,41.63265],[23.03342,41.71034],[23.01239,41.76527],[22.96682,41.77137],[22.90254,41.87587],[22.86749,42.02275],[22.67701,42.06614],[22.51224,42.15457],[22.50289,42.19527],[22.47251,42.20393],[22.38136,42.30339],[22.34773,42.31725]]]]}},{type:"Feature",properties:{iso1A2:"ML",iso1A3:"MLI",iso1N3:"466",wikidata:"Q912",nameEn:"Mali",groups:["011","202","002","UN"],callingCodes:["223"]},geometry:{type:"MultiPolygon",coordinates:[[[[-4.83423,24.99935],[-6.57191,25.0002],[-5.60725,16.49919],[-5.33435,16.33354],[-5.50165,15.50061],[-9.32979,15.50032],[-9.31106,15.69412],[-9.33314,15.7044],[-9.44673,15.60553],[-9.40447,15.4396],[-10.71721,15.4223],[-10.90932,15.11001],[-11.43483,15.62339],[-11.70705,15.51558],[-11.94903,14.76143],[-12.23936,14.76324],[-11.93043,13.84505],[-12.06897,13.71049],[-11.83345,13.33333],[-11.63025,13.39174],[-11.39935,12.97808],[-11.37536,12.40788],[-11.50006,12.17826],[-11.24136,12.01286],[-10.99758,12.24634],[-10.80355,12.1053],[-10.71897,11.91552],[-10.30604,12.24634],[-9.714,12.0226],[-9.63938,12.18312],[-9.32097,12.29009],[-9.38067,12.48446],[-9.13689,12.50875],[-8.94784,12.34842],[-8.80854,11.66715],[-8.40058,11.37466],[-8.66923,10.99397],[-8.35083,11.06234],[-8.2667,10.91762],[-8.32614,10.69273],[-8.22711,10.41722],[-8.10207,10.44649],[-7.9578,10.2703],[-7.97971,10.17117],[-7.92107,10.15577],[-7.63048,10.46334],[-7.54462,10.40921],[-7.52261,10.4655],[-7.44555,10.44602],[-7.3707,10.24677],[-7.13331,10.24877],[-7.0603,10.14711],[-7.00966,10.15794],[-6.97444,10.21644],[-7.01186,10.25111],[-6.93921,10.35291],[-6.68164,10.35074],[-6.63541,10.66893],[-6.52974,10.59104],[-6.42847,10.5694],[-6.40646,10.69922],[-6.325,10.68624],[-6.24795,10.74248],[-6.1731,10.46983],[-6.18851,10.24244],[-5.99478,10.19694],[-5.78124,10.43952],[-5.65135,10.46767],[-5.51058,10.43177],[-5.46643,10.56074],[-5.47083,10.75329],[-5.41579,10.84628],[-5.49284,11.07538],[-5.32994,11.13371],[-5.32553,11.21578],[-5.25949,11.24816],[-5.25509,11.36905],[-5.20665,11.43811],[-5.22867,11.60421],[-5.29251,11.61715],[-5.26389,11.75728],[-5.40258,11.8327],[-5.26389,11.84778],[-5.07897,11.97918],[-4.72893,12.01579],[-4.70692,12.06746],[-4.62987,12.06531],[-4.62546,12.13204],[-4.54841,12.1385],[-4.57703,12.19875],[-4.41412,12.31922],[-4.47356,12.71252],[-4.238,12.71467],[-4.21819,12.95722],[-4.34477,13.12927],[-3.96501,13.49778],[-3.90558,13.44375],[-3.96282,13.38164],[-3.7911,13.36665],[-3.54454,13.1781],[-3.4313,13.1588],[-3.43507,13.27272],[-3.23599,13.29035],[-3.28396,13.5422],[-3.26407,13.70699],[-2.88189,13.64921],[-2.90831,13.81174],[-2.84667,14.05532],[-2.66175,14.14713],[-2.47587,14.29671],[-2.10223,14.14878],[-1.9992,14.19011],[-1.97945,14.47709],[-1.68083,14.50023],[-1.32166,14.72774],[-1.05875,14.7921],[-.72004,15.08655],[-.24673,15.07805],[.06588,14.96961],[.23859,15.00135],[.72632,14.95898],[.96711,14.98275],[1.31275,15.27978],[3.01806,15.34571],[3.03134,15.42221],[3.50368,15.35934],[4.19893,16.39923],[4.21787,17.00118],[4.26762,17.00432],[4.26651,19.14224],[3.36082,18.9745],[3.12501,19.1366],[3.24648,19.81703],[1.20992,20.73533],[1.15698,21.12843],[-4.83423,24.99935]]]]}},{type:"Feature",properties:{iso1A2:"MM",iso1A3:"MMR",iso1N3:"104",wikidata:"Q836",nameEn:"Myanmar",aliases:["Burma","BU"],groups:["035","142","UN"],callingCodes:["95"]},geometry:{type:"MultiPolygon",coordinates:[[[[92.62187,21.87037],[92.59775,21.6092],[92.68152,21.28454],[92.60187,21.24615],[92.55105,21.3856],[92.43158,21.37025],[92.37939,21.47764],[92.20087,21.337],[92.17752,21.17445],[92.26071,21.05697],[92.47409,20.38654],[92.61042,13.76986],[94.6371,13.81803],[97.63455,9.60854],[98.12555,9.44056],[98.33094,9.91973],[98.47298,9.95782],[98.52291,9.92389],[98.55174,9.92804],[98.7391,10.31488],[98.81944,10.52761],[98.77275,10.62548],[98.78511,10.68351],[98.86819,10.78336],[99.0069,10.85485],[98.99701,10.92962],[99.02337,10.97217],[99.06938,10.94857],[99.32756,11.28545],[99.31573,11.32081],[99.39485,11.3925],[99.47598,11.62434],[99.5672,11.62732],[99.64108,11.78948],[99.64891,11.82699],[99.53424,12.02317],[99.56445,12.14805],[99.47519,12.1353],[99.409,12.60603],[99.29254,12.68921],[99.18905,12.84799],[99.18748,12.9898],[99.10646,13.05804],[99.12225,13.19847],[99.20617,13.20575],[99.16695,13.72621],[98.97356,14.04868],[98.56762,14.37701],[98.24874,14.83013],[98.18821,15.13125],[98.22,15.21327],[98.30446,15.30667],[98.40522,15.25268],[98.41906,15.27103],[98.39351,15.34177],[98.4866,15.39154],[98.56027,15.33471],[98.58598,15.46821],[98.541,15.65406],[98.59853,15.87197],[98.57019,16.04578],[98.69585,16.13353],[98.8376,16.11706],[98.92656,16.36425],[98.84485,16.42354],[98.68074,16.27068],[98.63817,16.47424],[98.57912,16.55983],[98.5695,16.62826],[98.51113,16.64503],[98.51833,16.676],[98.51472,16.68521],[98.51579,16.69433],[98.51043,16.70107],[98.49713,16.69022],[98.50253,16.7139],[98.46994,16.73613],[98.53833,16.81934],[98.49603,16.8446],[98.52624,16.89979],[98.39441,17.06266],[98.34566,17.04822],[98.10439,17.33847],[98.11185,17.36829],[97.91829,17.54504],[97.76407,17.71595],[97.66794,17.88005],[97.73723,17.97912],[97.60841,18.23846],[97.64116,18.29778],[97.56219,18.33885],[97.50383,18.26844],[97.34522,18.54596],[97.36444,18.57138],[97.5258,18.4939],[97.76752,18.58097],[97.73836,18.88478],[97.66487,18.9371],[97.73654,18.9812],[97.73797,19.04261],[97.83479,19.09972],[97.84024,19.22217],[97.78606,19.26769],[97.84186,19.29526],[97.78769,19.39429],[97.88423,19.5041],[97.84715,19.55782],[98.04364,19.65755],[98.03314,19.80941],[98.13829,19.78541],[98.24884,19.67876],[98.51182,19.71303],[98.56065,19.67807],[98.83661,19.80931],[98.98679,19.7419],[99.0735,20.10298],[99.20328,20.12877],[99.416,20.08614],[99.52943,20.14811],[99.5569,20.20676],[99.46077,20.36198],[99.46008,20.39673],[99.68255,20.32077],[99.81096,20.33687],[99.86383,20.44371],[99.88211,20.44488],[99.88451,20.44596],[99.89168,20.44548],[99.89301,20.44311],[99.89692,20.44789],[99.90499,20.4487],[99.91616,20.44986],[99.95721,20.46301],[100.08404,20.36626],[100.1957,20.68247],[100.36375,20.82783],[100.51079,20.82194],[100.60112,20.8347],[100.64628,20.88279],[100.50974,20.88574],[100.55281,21.02796],[100.63578,21.05639],[100.72716,21.31786],[100.80173,21.2934],[101.00234,21.39612],[101.16198,21.52808],[101.15156,21.56129],[101.11744,21.77659],[100.87265,21.67396],[100.72143,21.51898],[100.57861,21.45637],[100.4811,21.46148],[100.42892,21.54325],[100.35201,21.53176],[100.25863,21.47043],[100.18447,21.51898],[100.1625,21.48704],[100.12542,21.50365],[100.10757,21.59945],[100.17486,21.65306],[100.12679,21.70539],[100.04956,21.66843],[99.98654,21.71064],[99.94003,21.82782],[99.99084,21.97053],[99.96612,22.05965],[99.85351,22.04183],[99.47585,22.13345],[99.33166,22.09656],[99.1552,22.15874],[99.19176,22.16983],[99.17318,22.18025],[99.28771,22.4105],[99.37972,22.50188],[99.38247,22.57544],[99.31243,22.73893],[99.45654,22.85726],[99.43537,22.94086],[99.54218,22.90014],[99.52214,23.08218],[99.34127,23.13099],[99.25741,23.09025],[99.04601,23.12215],[99.05975,23.16382],[98.88597,23.18656],[98.92515,23.29535],[98.93958,23.31414],[98.87573,23.33038],[98.92104,23.36946],[98.87683,23.48995],[98.82877,23.47908],[98.80294,23.5345],[98.88396,23.59555],[98.81775,23.694],[98.82933,23.72921],[98.79607,23.77947],[98.68209,23.80492],[98.67797,23.9644],[98.89632,24.10612],[98.87998,24.15624],[98.85319,24.13042],[98.59256,24.08371],[98.54476,24.13119],[98.20666,24.11406],[98.07806,24.07988],[98.06703,24.08028],[98.0607,24.07812],[98.05671,24.07961],[98.05302,24.07408],[98.04709,24.07616],[97.99583,24.04932],[97.98691,24.03897],[97.93951,24.01953],[97.90998,24.02094],[97.88616,24.00463],[97.88414,23.99405],[97.88814,23.98605],[97.89683,23.98389],[97.89676,23.97931],[97.8955,23.97758],[97.88811,23.97446],[97.86545,23.97723],[97.84328,23.97603],[97.79416,23.95663],[97.79456,23.94836],[97.72302,23.89288],[97.64667,23.84574],[97.5247,23.94032],[97.62363,24.00506],[97.72903,24.12606],[97.75305,24.16902],[97.72799,24.18883],[97.72998,24.2302],[97.76799,24.26365],[97.71941,24.29652],[97.66723,24.30027],[97.65624,24.33781],[97.7098,24.35658],[97.66998,24.45288],[97.60029,24.4401],[97.52757,24.43748],[97.56286,24.54535],[97.56525,24.72838],[97.54675,24.74202],[97.5542,24.74943],[97.56383,24.75535],[97.56648,24.76475],[97.64354,24.79171],[97.70181,24.84557],[97.73127,24.83015],[97.76481,24.8289],[97.79949,24.85655],[97.72903,24.91332],[97.72216,25.08508],[97.77023,25.11492],[97.83614,25.2715],[97.92541,25.20815],[98.14925,25.41547],[98.12591,25.50722],[98.18084,25.56298],[98.16848,25.62739],[98.25774,25.6051],[98.31268,25.55307],[98.40606,25.61129],[98.54064,25.85129],[98.63128,25.79937],[98.70818,25.86241],[98.60763,26.01512],[98.57085,26.11547],[98.63128,26.15492],[98.66884,26.09165],[98.7329,26.17218],[98.67797,26.24487],[98.72741,26.36183],[98.77547,26.61994],[98.7333,26.85615],[98.69582,27.56499],[98.43353,27.67086],[98.42529,27.55404],[98.32641,27.51385],[98.13964,27.9478],[98.15337,28.12114],[97.90069,28.3776],[97.79632,28.33168],[97.70705,28.5056],[97.56835,28.55628],[97.50518,28.49716],[97.47085,28.2688],[97.41729,28.29783],[97.34547,28.21385],[97.31292,28.06784],[97.35412,28.06663],[97.38845,28.01329],[97.35824,27.87256],[97.29919,27.92233],[96.90112,27.62149],[96.91431,27.45752],[97.17422,27.14052],[97.14675,27.09041],[96.89132,27.17474],[96.85287,27.2065],[96.88445,27.25046],[96.73888,27.36638],[96.55761,27.29928],[96.40779,27.29818],[96.15591,27.24572],[96.04949,27.19428],[95.93002,27.04149],[95.81603,27.01335],[95.437,26.7083],[95.30339,26.65372],[95.23513,26.68499],[95.05798,26.45408],[95.12801,26.38397],[95.11428,26.1019],[95.18556,26.07338],[94.80117,25.49359],[94.68032,25.47003],[94.57458,25.20318],[94.74212,25.13606],[94.73937,25.00545],[94.60204,24.70889],[94.5526,24.70764],[94.50729,24.59281],[94.45279,24.56656],[94.32362,24.27692],[94.30215,24.23752],[94.14081,23.83333],[93.92089,23.95812],[93.80279,23.92549],[93.75952,24.0003],[93.62871,24.00922],[93.50616,23.94432],[93.46633,23.97067],[93.41415,24.07854],[93.34735,24.10151],[93.32351,24.04468],[93.36059,23.93176],[93.3908,23.92925],[93.3908,23.7622],[93.43475,23.68299],[93.38805,23.4728],[93.39981,23.38828],[93.38781,23.36139],[93.36862,23.35426],[93.38478,23.13698],[93.2878,23.00464],[93.12988,23.05772],[93.134,22.92498],[93.09417,22.69459],[93.134,22.59573],[93.11477,22.54374],[93.13537,22.45873],[93.18206,22.43716],[93.19991,22.25425],[93.14224,22.24535],[93.15734,22.18687],[93.04885,22.20595],[92.99255,22.05965],[92.99804,21.98964],[92.93899,22.02656],[92.89504,21.95143],[92.86208,22.05456],[92.70416,22.16017],[92.67532,22.03547],[92.60949,21.97638],[92.62187,21.87037]]]]}},{type:"Feature",properties:{iso1A2:"MN",iso1A3:"MNG",iso1N3:"496",wikidata:"Q711",nameEn:"Mongolia",groups:["030","142","UN"],callingCodes:["976"]},geometry:{type:"MultiPolygon",coordinates:[[[[102.14032,51.35566],[101.5044,51.50467],[101.39085,51.45753],[100.61116,51.73028],[99.89203,51.74903],[99.75578,51.90108],[99.27888,51.96876],[98.87768,52.14563],[98.74142,51.8637],[98.33222,51.71832],[98.22053,51.46579],[98.05257,51.46696],[97.83305,51.00248],[98.01472,50.86652],[97.9693,50.78044],[98.06393,50.61262],[98.31373,50.4996],[98.29481,50.33561],[97.85197,49.91339],[97.76871,49.99861],[97.56432,49.92801],[97.56811,49.84265],[97.24639,49.74737],[96.97388,49.88413],[95.80056,50.04239],[95.74757,49.97915],[95.02465,49.96941],[94.97166,50.04725],[94.6121,50.04239],[94.49477,50.17832],[94.39258,50.22193],[94.30823,50.57498],[92.99595,50.63183],[93.01109,50.79001],[92.44714,50.78762],[92.07173,50.69585],[91.86048,50.73734],[89.59711,49.90851],[89.70687,49.72535],[88.82499,49.44808],[88.42449,49.48821],[88.17223,49.46934],[88.15543,49.30314],[87.98977,49.18147],[87.81333,49.17354],[87.88171,48.95853],[87.73822,48.89582],[88.0788,48.71436],[87.96361,48.58478],[88.58939,48.34531],[88.58316,48.21893],[88.8011,48.11302],[88.93186,48.10263],[89.0711,47.98528],[89.55453,48.0423],[89.76624,47.82745],[90.06512,47.88177],[90.10871,47.7375],[90.33598,47.68303],[90.48854,47.41826],[90.48542,47.30438],[90.76108,46.99399],[90.84035,46.99525],[91.03649,46.72916],[91.0147,46.58171],[91.07696,46.57315],[90.89639,46.30711],[90.99672,46.14207],[91.03026,46.04194],[90.70907,45.73437],[90.65114,45.49314],[90.89169,45.19667],[91.64048,45.07408],[93.51161,44.95964],[94.10003,44.71016],[94.71959,44.35284],[95.01191,44.25274],[95.39772,44.2805],[95.32891,44.02407],[95.52594,43.99353],[95.89543,43.2528],[96.35658,42.90363],[96.37926,42.72055],[97.1777,42.7964],[99.50671,42.56535],[100.33297,42.68231],[100.84979,42.67087],[101.80515,42.50074],[102.07645,42.22519],[102.72403,42.14675],[103.92804,41.78246],[104.52258,41.8706],[104.51667,41.66113],[105.0123,41.63188],[106.76517,42.28741],[107.24774,42.36107],[107.29755,42.41395],[107.49681,42.46221],[107.57258,42.40898],[108.84489,42.40246],[109.00679,42.45302],[109.452,42.44842],[109.89402,42.63111],[110.08401,42.6411],[110.4327,42.78293],[111.0149,43.3289],[111.59087,43.51207],[111.79758,43.6637],[111.93776,43.68709],[111.96289,43.81596],[111.40498,44.3461],[111.76275,44.98032],[111.98695,45.09074],[112.4164,45.06858],[112.74662,44.86297],[113.70918,44.72891],[114.5166,45.27189],[114.54801,45.38337],[114.74612,45.43585],[114.94546,45.37377],[115.60329,45.44717],[116.16989,45.68603],[116.27366,45.78637],[116.24012,45.8778],[116.26678,45.96479],[116.58612,46.30211],[116.75551,46.33083],[116.83166,46.38637],[117.36609,46.36335],[117.41782,46.57862],[117.60748,46.59771],[117.69554,46.50991],[118.30534,46.73519],[118.78747,46.68689],[118.8337,46.77742],[118.89974,46.77139],[118.92616,46.72765],[119.00541,46.74273],[119.10448,46.65516],[119.24978,46.64761],[119.32827,46.61433],[119.42827,46.63783],[119.65265,46.62342],[119.68127,46.59015],[119.77373,46.62947],[119.80455,46.67631],[119.89261,46.66423],[119.91242,46.90091],[119.85518,46.92196],[119.71209,47.19192],[119.62403,47.24575],[119.56019,47.24874],[119.54918,47.29505],[119.31964,47.42617],[119.35892,47.48104],[119.13995,47.53997],[119.12343,47.66458],[118.7564,47.76947],[118.55766,47.99277],[118.29654,48.00246],[118.22677,48.03853],[118.11009,48.04],[118.03676,48.00982],[117.80196,48.01661],[117.50181,47.77216],[117.37875,47.63627],[116.9723,47.87285],[116.67405,47.89039],[116.4465,47.83662],[116.21879,47.88505],[115.94296,47.67741],[115.57128,47.91988],[115.52082,48.15367],[115.811,48.25699],[115.78876,48.51781],[116.06565,48.81716],[116.03781,48.87014],[116.71193,49.83813],[116.62502,49.92919],[116.22402,50.04477],[115.73602,49.87688],[115.26068,49.97367],[114.9703,50.19254],[114.325,50.28098],[113.20216,49.83356],[113.02647,49.60772],[110.64493,49.1816],[110.39891,49.25083],[110.24373,49.16676],[109.51325,49.22859],[109.18017,49.34709],[108.53969,49.32325],[108.27937,49.53167],[107.95387,49.66659],[107.96116,49.93191],[107.36407,49.97612],[107.1174,50.04239],[107.00007,50.1977],[106.80326,50.30177],[106.58373,50.34044],[106.51122,50.34408],[106.49628,50.32436],[106.47156,50.31909],[106.07865,50.33474],[106.05562,50.40582],[105.32528,50.4648],[103.70343,50.13952],[102.71178,50.38873],[102.32194,50.67982],[102.14032,51.35566]]]]}},{type:"Feature",properties:{iso1A2:"MO",iso1A3:"MAC",iso1N3:"446",wikidata:"Q14773",nameEn:"Macau",aliases:["Macao"],country:"CN",groups:["030","142","UN"],driveSide:"left",callingCodes:["853"]},geometry:{type:"MultiPolygon",coordinates:[[[[113.54942,22.14519],[113.54839,22.10909],[113.57191,22.07696],[113.63011,22.10782],[113.60504,22.20464],[113.57123,22.20416],[113.56865,22.20973],[113.5508,22.21672],[113.54333,22.21688],[113.54093,22.21314],[113.53593,22.2137],[113.53301,22.21235],[113.53552,22.20607],[113.52659,22.18271],[113.54093,22.15497],[113.54942,22.14519]]]]}},{type:"Feature",properties:{iso1A2:"MP",iso1A3:"MNP",iso1N3:"580",wikidata:"Q16644",nameEn:"Northern Mariana Islands",aliases:["US-MP"],country:"US",groups:["Q1352230","Q153732","057","009","UN"],roadSpeedUnit:"mph",callingCodes:["1 670"]},geometry:{type:"MultiPolygon",coordinates:[[[[135.52896,14.32623],[152.19114,13.63487],[145.05972,21.28731],[135.52896,14.32623]]]]}},{type:"Feature",properties:{iso1A2:"MQ",iso1A3:"MTQ",iso1N3:"474",wikidata:"Q17054",nameEn:"Martinique",country:"FR",groups:["Q3320166","EU","029","003","419","019","UN"],callingCodes:["596"]},geometry:{type:"MultiPolygon",coordinates:[[[[-59.95997,14.20285],[-61.07821,15.25109],[-61.69315,14.26451],[-59.95997,14.20285]]]]}},{type:"Feature",properties:{iso1A2:"MR",iso1A3:"MRT",iso1N3:"478",wikidata:"Q1025",nameEn:"Mauritania",groups:["011","202","002","UN"],callingCodes:["222"]},geometry:{type:"MultiPolygon",coordinates:[[[[-5.60725,16.49919],[-6.57191,25.0002],[-4.83423,24.99935],[-8.66674,27.31569],[-8.66721,25.99918],[-12.0002,25.9986],[-12.00251,23.4538],[-12.14969,23.41935],[-12.36213,23.3187],[-12.5741,23.28975],[-13.00412,23.02297],[-13.10753,22.89493],[-13.15313,22.75649],[-13.08438,22.53866],[-13.01525,21.33343],[-16.95474,21.33997],[-16.99806,21.12142],[-17.0357,21.05368],[-17.0396,20.9961],[-17.06781,20.92697],[-17.0695,20.85742],[-17.0471,20.76408],[-17.15288,16.07139],[-16.50854,16.09032],[-16.48967,16.0496],[-16.44814,16.09753],[-16.4429,16.20605],[-16.27016,16.51565],[-15.6509,16.50315],[-15.00557,16.64997],[-14.32144,16.61495],[-13.80075,16.13961],[-13.43135,16.09022],[-13.11029,15.52116],[-12.23936,14.76324],[-11.94903,14.76143],[-11.70705,15.51558],[-11.43483,15.62339],[-10.90932,15.11001],[-10.71721,15.4223],[-9.40447,15.4396],[-9.44673,15.60553],[-9.33314,15.7044],[-9.31106,15.69412],[-9.32979,15.50032],[-5.50165,15.50061],[-5.33435,16.33354],[-5.60725,16.49919]]]]}},{type:"Feature",properties:{iso1A2:"MS",iso1A3:"MSR",iso1N3:"500",wikidata:"Q13353",nameEn:"Montserrat",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 664"]},geometry:{type:"MultiPolygon",coordinates:[[[[-61.91508,16.51165],[-62.1023,16.97277],[-62.58307,16.68909],[-61.91508,16.51165]]]]}},{type:"Feature",properties:{iso1A2:"MT",iso1A3:"MLT",iso1N3:"470",wikidata:"Q233",nameEn:"Malta",groups:["EU","039","150","UN"],driveSide:"left",callingCodes:["356"]},geometry:{type:"MultiPolygon",coordinates:[[[[15.70991,35.79901],[14.07544,36.41525],[13.27636,35.20764],[15.70991,35.79901]]]]}},{type:"Feature",properties:{iso1A2:"MU",iso1A3:"MUS",iso1N3:"480",wikidata:"Q1027",nameEn:"Mauritius",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["230"]},geometry:{type:"MultiPolygon",coordinates:[[[[56.09755,-9.55401],[57.50644,-31.92637],[68.4673,-19.15185],[56.09755,-9.55401]]]]}},{type:"Feature",properties:{iso1A2:"MV",iso1A3:"MDV",iso1N3:"462",wikidata:"Q826",nameEn:"Maldives",groups:["034","142","UN"],driveSide:"left",callingCodes:["960"]},geometry:{type:"MultiPolygon",coordinates:[[[[71.9161,8.55531],[72.57428,-3.7623],[76.59015,5.591],[71.9161,8.55531]]]]}},{type:"Feature",properties:{iso1A2:"MW",iso1A3:"MWI",iso1N3:"454",wikidata:"Q1020",nameEn:"Malawi",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["265"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.48052,-9.62442],[33.31581,-9.48554],[33.14925,-9.49322],[32.99397,-9.36712],[32.95389,-9.40138],[33.00476,-9.5133],[33.00256,-9.63053],[33.05485,-9.61316],[33.10163,-9.66525],[33.12144,-9.58929],[33.2095,-9.61099],[33.31517,-9.82364],[33.36581,-9.81063],[33.37902,-9.9104],[33.31297,-10.05133],[33.53863,-10.20148],[33.54797,-10.36077],[33.70675,-10.56896],[33.47636,-10.78465],[33.28022,-10.84428],[33.25998,-10.88862],[33.39697,-11.15296],[33.29267,-11.3789],[33.29267,-11.43536],[33.23663,-11.40637],[33.24252,-11.59302],[33.32692,-11.59248],[33.33937,-11.91252],[33.25998,-12.14242],[33.3705,-12.34931],[33.47636,-12.32498],[33.54485,-12.35996],[33.37517,-12.54085],[33.28177,-12.54692],[33.18837,-12.61377],[33.05917,-12.59554],[32.94397,-12.76868],[32.96733,-12.88251],[33.02181,-12.88707],[32.98289,-13.12671],[33.0078,-13.19492],[32.86113,-13.47292],[32.84176,-13.52794],[32.73683,-13.57682],[32.68436,-13.55769],[32.66468,-13.60019],[32.68654,-13.64268],[32.7828,-13.64805],[32.84528,-13.71576],[32.76962,-13.77224],[32.79015,-13.80755],[32.88985,-13.82956],[32.99042,-13.95689],[33.02977,-14.05022],[33.07568,-13.98447],[33.16749,-13.93992],[33.24249,-14.00019],[33.66677,-14.61306],[33.7247,-14.4989],[33.88503,-14.51652],[33.92898,-14.47929],[34.08588,-14.48893],[34.18733,-14.43823],[34.22355,-14.43607],[34.34453,-14.3985],[34.35843,-14.38652],[34.39277,-14.39467],[34.4192,-14.43191],[34.44641,-14.47746],[34.45053,-14.49873],[34.47628,-14.53363],[34.48932,-14.53646],[34.49636,-14.55091],[34.52366,-14.5667],[34.53962,-14.59776],[34.55112,-14.64494],[34.53516,-14.67782],[34.52057,-14.68263],[34.54503,-14.74672],[34.567,-14.77345],[34.61522,-14.99583],[34.57503,-15.30619],[34.43126,-15.44778],[34.44981,-15.60864],[34.25195,-15.90321],[34.43126,-16.04737],[34.40344,-16.20923],[35.04805,-16.83167],[35.13771,-16.81687],[35.17017,-16.93521],[35.04805,-17.00027],[35.0923,-17.13235],[35.3062,-17.1244],[35.27065,-16.93817],[35.30929,-16.82871],[35.27219,-16.69402],[35.14235,-16.56812],[35.25828,-16.4792],[35.30157,-16.2211],[35.43355,-16.11371],[35.52365,-16.15414],[35.70107,-16.10147],[35.80487,-16.03907],[35.85303,-15.41913],[35.78799,-15.17428],[35.91812,-14.89514],[35.87212,-14.89478],[35.86945,-14.67481],[35.5299,-14.27714],[35.47989,-14.15594],[34.86229,-13.48958],[34.60253,-13.48487],[34.37831,-12.17408],[34.46088,-12.0174],[34.70739,-12.15652],[34.82903,-12.04837],[34.57917,-11.87849],[34.64241,-11.57499],[34.96296,-11.57354],[34.91153,-11.39799],[34.79375,-11.32245],[34.63305,-11.11731],[34.61161,-11.01611],[34.67047,-10.93796],[34.65946,-10.6828],[34.57581,-10.56271],[34.51911,-10.12279],[34.54499,-10.0678],[34.03865,-9.49398],[33.95829,-9.54066],[33.9638,-9.62206],[33.93298,-9.71647],[33.76677,-9.58516],[33.48052,-9.62442]]]]}},{type:"Feature",properties:{iso1A2:"MX",iso1A3:"MEX",iso1N3:"484",wikidata:"Q96",nameEn:"Mexico",groups:["013","003","419","019","UN"],callingCodes:["52"]},geometry:{type:"MultiPolygon",coordinates:[[[[-117.1243,32.53427],[-118.48109,32.5991],[-120.12904,18.41089],[-92.37213,14.39277],[-92.2261,14.53423],[-92.1454,14.6804],[-92.18161,14.84147],[-92.1423,14.88647],[-92.1454,14.98143],[-92.0621,15.07406],[-92.20983,15.26077],[-91.73182,16.07371],[-90.44567,16.07573],[-90.40499,16.40524],[-90.61212,16.49832],[-90.69064,16.70697],[-91.04436,16.92175],[-91.43809,17.25373],[-90.99199,17.25192],[-90.98678,17.81655],[-89.14985,17.81563],[-89.15105,17.95104],[-89.03839,18.0067],[-88.8716,17.89535],[-88.71505,18.0707],[-88.48242,18.49164],[-88.3268,18.49048],[-88.29909,18.47591],[-88.26593,18.47617],[-88.03238,18.41778],[-88.03165,18.16657],[-87.90671,18.15213],[-87.87604,18.18313],[-87.86657,18.19971],[-87.85693,18.18266],[-87.84815,18.18511],[-86.92368,17.61462],[-85.9092,21.8218],[-96.92418,25.97377],[-97.13927,25.96583],[-97.35946,25.92189],[-97.37332,25.83854],[-97.42511,25.83969],[-97.45669,25.86874],[-97.49828,25.89877],[-97.52025,25.88518],[-97.66511,26.01708],[-97.95155,26.0625],[-97.97017,26.05232],[-98.24603,26.07191],[-98.27075,26.09457],[-98.30491,26.10475],[-98.35126,26.15129],[-99.00546,26.3925],[-99.03053,26.41249],[-99.08477,26.39849],[-99.53573,27.30926],[-99.49744,27.43746],[-99.482,27.47128],[-99.48045,27.49016],[-99.50208,27.50021],[-99.52955,27.49747],[-99.51478,27.55836],[-99.55409,27.61314],[-100.50029,28.66117],[-100.51222,28.70679],[-100.5075,28.74066],[-100.52313,28.75598],[-100.59809,28.88197],[-100.63689,28.90812],[-100.67294,29.09744],[-100.79696,29.24688],[-100.87982,29.296],[-100.94056,29.33371],[-100.94579,29.34523],[-100.96725,29.3477],[-101.01128,29.36947],[-101.05686,29.44738],[-101.47277,29.7744],[-102.60596,29.8192],[-103.15787,28.93865],[-104.37752,29.54255],[-104.39363,29.55396],[-104.3969,29.57105],[-104.5171,29.64671],[-104.77674,30.4236],[-106.00363,31.39181],[-106.09025,31.40569],[-106.20346,31.46305],[-106.23711,31.51262],[-106.24612,31.54193],[-106.28084,31.56173],[-106.30305,31.62154],[-106.33419,31.66303],[-106.34864,31.69663],[-106.3718,31.71165],[-106.38003,31.73151],[-106.41773,31.75196],[-106.43419,31.75478],[-106.45244,31.76523],[-106.46726,31.75998],[-106.47298,31.75054],[-106.48815,31.74769],[-106.50111,31.75714],[-106.50962,31.76155],[-106.51251,31.76922],[-106.52266,31.77509],[-106.529,31.784],[-108.20899,31.78534],[-108.20979,31.33316],[-111.07523,31.33232],[-114.82011,32.49609],[-114.79524,32.55731],[-114.81141,32.55543],[-114.80584,32.62028],[-114.76736,32.64094],[-114.71871,32.71894],[-115.88053,32.63624],[-117.1243,32.53427]]]]}},{type:"Feature",properties:{iso1A2:"MY",iso1A3:"MYS",iso1N3:"458",wikidata:"Q833",nameEn:"Malaysia"},geometry:null},{type:"Feature",properties:{iso1A2:"MZ",iso1A3:"MOZ",iso1N3:"508",wikidata:"Q1029",nameEn:"Mozambique",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["258"]},geometry:{type:"MultiPolygon",coordinates:[[[[40.74206,-10.25691],[40.44265,-10.4618],[40.00295,-10.80255],[39.58249,-10.96043],[39.24395,-11.17433],[38.88996,-11.16978],[38.47258,-11.4199],[38.21598,-11.27289],[37.93618,-11.26228],[37.8388,-11.3123],[37.76614,-11.53352],[37.3936,-11.68949],[36.80309,-11.56836],[36.62068,-11.72884],[36.19094,-11.70008],[36.19094,-11.57593],[35.82767,-11.41081],[35.63599,-11.55927],[34.96296,-11.57354],[34.64241,-11.57499],[34.57917,-11.87849],[34.82903,-12.04837],[34.70739,-12.15652],[34.46088,-12.0174],[34.37831,-12.17408],[34.60253,-13.48487],[34.86229,-13.48958],[35.47989,-14.15594],[35.5299,-14.27714],[35.86945,-14.67481],[35.87212,-14.89478],[35.91812,-14.89514],[35.78799,-15.17428],[35.85303,-15.41913],[35.80487,-16.03907],[35.70107,-16.10147],[35.52365,-16.15414],[35.43355,-16.11371],[35.30157,-16.2211],[35.25828,-16.4792],[35.14235,-16.56812],[35.27219,-16.69402],[35.30929,-16.82871],[35.27065,-16.93817],[35.3062,-17.1244],[35.0923,-17.13235],[35.04805,-17.00027],[35.17017,-16.93521],[35.13771,-16.81687],[35.04805,-16.83167],[34.40344,-16.20923],[34.43126,-16.04737],[34.25195,-15.90321],[34.44981,-15.60864],[34.43126,-15.44778],[34.57503,-15.30619],[34.61522,-14.99583],[34.567,-14.77345],[34.54503,-14.74672],[34.52057,-14.68263],[34.53516,-14.67782],[34.55112,-14.64494],[34.53962,-14.59776],[34.52366,-14.5667],[34.49636,-14.55091],[34.48932,-14.53646],[34.47628,-14.53363],[34.45053,-14.49873],[34.44641,-14.47746],[34.4192,-14.43191],[34.39277,-14.39467],[34.35843,-14.38652],[34.34453,-14.3985],[34.22355,-14.43607],[34.18733,-14.43823],[34.08588,-14.48893],[33.92898,-14.47929],[33.88503,-14.51652],[33.7247,-14.4989],[33.66677,-14.61306],[33.24249,-14.00019],[30.22098,-14.99447],[30.41902,-15.62269],[30.42568,-15.9962],[30.91597,-15.99924],[30.97761,-16.05848],[31.13171,-15.98019],[31.30563,-16.01193],[31.42451,-16.15154],[31.67988,-16.19595],[31.90223,-16.34388],[31.91324,-16.41569],[32.02772,-16.43892],[32.28529,-16.43892],[32.42838,-16.4727],[32.71017,-16.59932],[32.69917,-16.66893],[32.78943,-16.70267],[32.97655,-16.70689],[32.91051,-16.89446],[32.84113,-16.92259],[32.96554,-17.11971],[33.00517,-17.30477],[33.0426,-17.3468],[32.96554,-17.48964],[32.98536,-17.55891],[33.0492,-17.60298],[32.94133,-17.99705],[33.03159,-18.35054],[33.02278,-18.4696],[32.88629,-18.51344],[32.88629,-18.58023],[32.95013,-18.69079],[32.9017,-18.7992],[32.82465,-18.77419],[32.70137,-18.84712],[32.73439,-18.92628],[32.69917,-18.94293],[32.72118,-19.02204],[32.84006,-19.0262],[32.87088,-19.09279],[32.85107,-19.29238],[32.77966,-19.36098],[32.78282,-19.47513],[32.84446,-19.48343],[32.84666,-19.68462],[32.95013,-19.67219],[33.06461,-19.77787],[33.01178,-20.02007],[32.93032,-20.03868],[32.85987,-20.16686],[32.85987,-20.27841],[32.66174,-20.56106],[32.55167,-20.56312],[32.48122,-20.63319],[32.51644,-20.91929],[32.37115,-21.133],[32.48236,-21.32873],[32.41234,-21.31246],[31.38336,-22.36919],[31.30611,-22.422],[31.55779,-23.176],[31.56539,-23.47268],[31.67942,-23.60858],[31.70223,-23.72695],[31.77445,-23.90082],[31.87707,-23.95293],[31.90368,-24.18892],[31.9835,-24.29983],[32.03196,-25.10785],[32.01676,-25.38117],[31.97875,-25.46356],[32.00631,-25.65044],[31.92649,-25.84216],[31.974,-25.95387],[32.00916,-25.999],[32.08599,-26.00978],[32.10435,-26.15656],[32.07352,-26.40185],[32.13409,-26.5317],[32.13315,-26.84345],[32.19409,-26.84032],[32.22302,-26.84136],[32.29584,-26.852],[32.35222,-26.86027],[34.51034,-26.91792],[42.99868,-12.65261],[40.74206,-10.25691]]]]}},{type:"Feature",properties:{iso1A2:"NA",iso1A3:"NAM",iso1N3:"516",wikidata:"Q1030",nameEn:"Namibia",groups:["018","202","002","UN"],driveSide:"left",callingCodes:["264"]},geometry:{type:"MultiPolygon",coordinates:[[[[14.28743,-17.38814],[13.95896,-17.43141],[13.36212,-16.98048],[12.97145,-16.98567],[12.52111,-17.24495],[12.07076,-17.15165],[11.75063,-17.25013],[10.5065,-17.25284],[12.51595,-32.27486],[16.45332,-28.63117],[16.46592,-28.57126],[16.59922,-28.53246],[16.90446,-28.057],[17.15405,-28.08573],[17.4579,-28.68718],[18.99885,-28.89165],[19.99882,-28.42622],[19.99817,-24.76768],[19.99912,-21.99991],[20.99751,-22.00026],[20.99904,-18.31743],[21.45556,-18.31795],[23.0996,-18.00075],[23.29618,-17.99855],[23.61088,-18.4881],[24.19416,-18.01919],[24.40577,-17.95726],[24.57485,-18.07151],[24.6303,-17.9863],[24.71887,-17.9218],[24.73364,-17.89338],[24.95586,-17.79674],[25.05895,-17.84452],[25.16882,-17.78253],[25.26433,-17.79571],[25.00198,-17.58221],[24.70864,-17.49501],[24.5621,-17.52963],[24.38712,-17.46818],[24.32811,-17.49082],[24.23619,-17.47489],[23.47474,-17.62877],[21.42741,-18.02787],[21.14283,-17.94318],[18.84226,-17.80375],[18.39229,-17.38927],[14.28743,-17.38814]]]]}},{type:"Feature",properties:{iso1A2:"NC",iso1A3:"NCL",iso1N3:"540",wikidata:"Q33788",nameEn:"New Caledonia",country:"FR",groups:["EU","Q1451600","054","009","UN"],callingCodes:["687"]},geometry:{type:"MultiPolygon",coordinates:[[[[159.77159,-28.41151],[174.245,-23.1974],[156.73836,-14.50464],[159.77159,-28.41151]]]]}},{type:"Feature",properties:{iso1A2:"NE",iso1A3:"NER",iso1N3:"562",wikidata:"Q1032",nameEn:"Niger",aliases:["RN"],groups:["011","202","002","UN"],callingCodes:["227"]},geometry:{type:"MultiPolygon",coordinates:[[[[14.22918,22.61719],[13.5631,23.16574],[11.96886,23.51735],[7.48273,20.87258],[7.38361,20.79165],[5.8153,19.45101],[4.26651,19.14224],[4.26762,17.00432],[4.21787,17.00118],[4.19893,16.39923],[3.50368,15.35934],[3.03134,15.42221],[3.01806,15.34571],[1.31275,15.27978],[.96711,14.98275],[.72632,14.95898],[.23859,15.00135],[.16936,14.51654],[.38051,14.05575],[.61924,13.68491],[.77377,13.6866],[.77637,13.64442],[.99514,13.5668],[1.02813,13.46635],[1.20088,13.38951],[1.24429,13.39373],[1.28509,13.35488],[1.24516,13.33968],[1.21217,13.37853],[1.18873,13.31771],[.99253,13.37515],[.99167,13.10727],[2.26349,12.41915],[2.05785,12.35539],[2.39723,11.89473],[2.45824,11.98672],[2.39657,12.10952],[2.37783,12.24804],[2.6593,12.30631],[2.83978,12.40585],[3.25352,12.01467],[3.31613,11.88495],[3.48187,11.86092],[3.59375,11.70269],[3.61075,11.69181],[3.67988,11.75429],[3.67122,11.80865],[3.63063,11.83042],[3.61955,11.91847],[3.67775,11.97599],[3.63136,12.11826],[3.66364,12.25884],[3.65111,12.52223],[3.94339,12.74979],[4.10006,12.98862],[4.14367,13.17189],[4.14186,13.47586],[4.23456,13.47725],[4.4668,13.68286],[4.87425,13.78],[4.9368,13.7345],[5.07396,13.75052],[5.21026,13.73627],[5.27797,13.75474],[5.35437,13.83567],[5.52957,13.8845],[6.15771,13.64564],[6.27411,13.67835],[6.43053,13.6006],[6.69617,13.34057],[6.94445,12.99825],[7.0521,13.00076],[7.12676,13.02445],[7.22399,13.1293],[7.39241,13.09717],[7.81085,13.34902],[8.07997,13.30847],[8.25185,13.20369],[8.41853,13.06166],[8.49493,13.07519],[8.60431,13.01768],[8.64251,12.93985],[8.97413,12.83661],[9.65995,12.80614],[10.00373,13.18171],[10.19993,13.27129],[10.46731,13.28819],[10.66004,13.36422],[11.4535,13.37773],[11.88236,13.2527],[12.04209,13.14452],[12.16189,13.10056],[12.19315,13.12423],[12.47095,13.06673],[12.58033,13.27805],[12.6793,13.29157],[12.87376,13.48919],[13.05085,13.53984],[13.19844,13.52802],[13.33213,13.71195],[13.6302,13.71094],[13.47559,14.40881],[13.48259,14.46704],[13.68573,14.55276],[13.67878,14.64013],[13.809,14.72915],[13.78991,14.87519],[13.86301,15.04043],[14.37425,15.72591],[15.50373,16.89649],[15.6032,18.77402],[15.75098,19.93002],[15.99632,20.35364],[15.6721,20.70069],[15.59841,20.74039],[15.56004,20.79488],[15.55382,20.86507],[15.57248,20.92138],[15.62515,20.95395],[15.28332,21.44557],[15.20213,21.49365],[15.19692,21.99339],[14.99751,23.00539],[14.22918,22.61719]]]]}},{type:"Feature",properties:{iso1A2:"NF",iso1A3:"NFK",iso1N3:"574",wikidata:"Q31057",nameEn:"Norfolk Island",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["672 3"]},geometry:{type:"MultiPolygon",coordinates:[[[[169.82316,-28.16667],[166.29505,-28.29175],[167.94076,-30.60745],[169.82316,-28.16667]]]]}},{type:"Feature",properties:{iso1A2:"NG",iso1A3:"NGA",iso1N3:"566",wikidata:"Q1033",nameEn:"Nigeria",groups:["011","202","002","UN"],callingCodes:["234"]},geometry:{type:"MultiPolygon",coordinates:[[[[6.15771,13.64564],[5.52957,13.8845],[5.35437,13.83567],[5.27797,13.75474],[5.21026,13.73627],[5.07396,13.75052],[4.9368,13.7345],[4.87425,13.78],[4.4668,13.68286],[4.23456,13.47725],[4.14186,13.47586],[4.14367,13.17189],[4.10006,12.98862],[3.94339,12.74979],[3.65111,12.52223],[3.66364,12.25884],[3.63136,12.11826],[3.67775,11.97599],[3.61955,11.91847],[3.63063,11.83042],[3.67122,11.80865],[3.67988,11.75429],[3.61075,11.69181],[3.59375,11.70269],[3.49175,11.29765],[3.71505,11.13015],[3.84243,10.59316],[3.78292,10.40538],[3.6844,10.46351],[3.57275,10.27185],[3.66908,10.18136],[3.54429,9.87739],[3.35383,9.83641],[3.32099,9.78032],[3.34726,9.70696],[3.25093,9.61632],[3.13928,9.47167],[3.14147,9.28375],[3.08017,9.10006],[2.77907,9.06924],[2.67523,7.87825],[2.73095,7.7755],[2.73405,7.5423],[2.78668,7.5116],[2.79442,7.43486],[2.74489,7.42565],[2.76965,7.13543],[2.71702,6.95722],[2.74024,6.92802],[2.73405,6.78508],[2.78823,6.76356],[2.78204,6.70514],[2.7325,6.64057],[2.74334,6.57291],[2.70464,6.50831],[2.70566,6.38038],[2.74181,6.13349],[5.87055,3.78489],[8.34397,4.30689],[8.60302,4.87353],[8.78027,5.1243],[8.92029,5.58403],[8.83687,5.68483],[8.88156,5.78857],[8.84209,5.82562],[9.51757,6.43874],[9.70674,6.51717],[9.77824,6.79088],[9.86314,6.77756],[10.15135,7.03781],[10.21466,6.88996],[10.53639,6.93432],[10.57214,7.16345],[10.59746,7.14719],[10.60789,7.06885],[10.83727,6.9358],[10.8179,6.83377],[10.94302,6.69325],[11.09644,6.68437],[11.09495,6.51717],[11.42041,6.53789],[11.42264,6.5882],[11.51499,6.60892],[11.57755,6.74059],[11.55818,6.86186],[11.63117,6.9905],[11.87396,7.09398],[11.84864,7.26098],[11.93205,7.47812],[12.01844,7.52981],[11.99908,7.67302],[12.20909,7.97553],[12.19271,8.10826],[12.24782,8.17904],[12.26123,8.43696],[12.4489,8.52536],[12.44146,8.6152],[12.68722,8.65938],[12.71701,8.7595],[12.79,8.75361],[12.81085,8.91992],[12.90022,9.11411],[12.91958,9.33905],[12.85628,9.36698],[13.02385,9.49334],[13.22642,9.57266],[13.25472,9.76795],[13.29941,9.8296],[13.25025,9.86042],[13.24132,9.91031],[13.27409,9.93232],[13.286,9.9822],[13.25323,10.00127],[13.25025,10.03647],[13.34111,10.12299],[13.43644,10.13326],[13.5705,10.53183],[13.54964,10.61236],[13.73434,10.9255],[13.70753,10.94451],[13.7403,11.00593],[13.78945,11.00154],[13.97489,11.30258],[14.17821,11.23831],[14.6124,11.51283],[14.64591,11.66166],[14.55207,11.72001],[14.61612,11.7798],[14.6474,12.17466],[14.4843,12.35223],[14.22215,12.36533],[14.17523,12.41916],[14.20204,12.53405],[14.08251,13.0797],[13.6302,13.71094],[13.33213,13.71195],[13.19844,13.52802],[13.05085,13.53984],[12.87376,13.48919],[12.6793,13.29157],[12.58033,13.27805],[12.47095,13.06673],[12.19315,13.12423],[12.16189,13.10056],[12.04209,13.14452],[11.88236,13.2527],[11.4535,13.37773],[10.66004,13.36422],[10.46731,13.28819],[10.19993,13.27129],[10.00373,13.18171],[9.65995,12.80614],[8.97413,12.83661],[8.64251,12.93985],[8.60431,13.01768],[8.49493,13.07519],[8.41853,13.06166],[8.25185,13.20369],[8.07997,13.30847],[7.81085,13.34902],[7.39241,13.09717],[7.22399,13.1293],[7.12676,13.02445],[7.0521,13.00076],[6.94445,12.99825],[6.69617,13.34057],[6.43053,13.6006],[6.27411,13.67835],[6.15771,13.64564]]]]}},{type:"Feature",properties:{iso1A2:"NI",iso1A3:"NIC",iso1N3:"558",wikidata:"Q811",nameEn:"Nicaragua",groups:["013","003","419","019","UN"],callingCodes:["505"]},geometry:{type:"MultiPolygon",coordinates:[[[[-83.13724,15.00002],[-83.49268,15.01158],[-83.62101,14.89448],[-83.89551,14.76697],[-84.10584,14.76353],[-84.48373,14.63249],[-84.70119,14.68078],[-84.82596,14.82212],[-84.90082,14.80489],[-85.1575,14.53934],[-85.18602,14.24929],[-85.32149,14.2562],[-85.45762,14.11304],[-85.73964,13.9698],[-85.75477,13.8499],[-86.03458,13.99181],[-86.00685,14.08474],[-86.14801,14.04317],[-86.35219,13.77157],[-86.76812,13.79605],[-86.71267,13.30348],[-86.87066,13.30641],[-86.93383,13.18677],[-86.93197,13.05313],[-87.03785,12.98682],[-87.06306,13.00892],[-87.37107,12.98646],[-87.55124,13.12523],[-87.7346,13.13228],[-88.11443,12.63306],[-86.14524,11.09059],[-85.71223,11.06868],[-85.60529,11.22607],[-84.92439,10.9497],[-84.68197,11.07568],[-83.90838,10.71161],[-83.66597,10.79916],[-83.68276,11.01562],[-82.56142,11.91792],[-82.06974,14.49418],[-83.04763,15.03256],[-83.13724,15.00002]]]]}},{type:"Feature",properties:{iso1A2:"NL",iso1A3:"NLD",iso1N3:"528",wikidata:"Q29999",nameEn:"Kingdom of the Netherlands"},geometry:null},{type:"Feature",properties:{iso1A2:"NO",iso1A3:"NOR",iso1N3:"578",wikidata:"Q20",nameEn:"Norway"},geometry:null},{type:"Feature",properties:{iso1A2:"NP",iso1A3:"NPL",iso1N3:"524",wikidata:"Q837",nameEn:"Nepal",groups:["034","142","UN"],driveSide:"left",callingCodes:["977"]},geometry:{type:"MultiPolygon",coordinates:[[[[88.13378,27.88015],[87.82681,27.95248],[87.72718,27.80938],[87.56996,27.84517],[87.11696,27.84104],[87.03757,27.94835],[86.75582,28.04182],[86.74181,28.10638],[86.56265,28.09569],[86.51609,27.96623],[86.42736,27.91122],[86.22966,27.9786],[86.18607,28.17364],[86.088,28.09264],[86.08333,28.02121],[86.12069,27.93047],[86.06309,27.90021],[85.94946,27.9401],[85.97813,27.99023],[85.90743,28.05144],[85.84672,28.18187],[85.74864,28.23126],[85.71907,28.38064],[85.69105,28.38475],[85.60854,28.25045],[85.59765,28.30529],[85.4233,28.32996],[85.38127,28.28336],[85.10729,28.34092],[85.18668,28.54076],[85.19135,28.62825],[85.06059,28.68562],[84.85511,28.58041],[84.62317,28.73887],[84.47528,28.74023],[84.2231,28.89571],[84.24801,29.02783],[84.18107,29.23451],[83.97559,29.33091],[83.82303,29.30513],[83.63156,29.16249],[83.44787,29.30513],[83.28131,29.56813],[83.07116,29.61957],[82.73024,29.81695],[82.5341,29.9735],[82.38622,30.02608],[82.16984,30.0692],[82.19475,30.16884],[82.10757,30.23745],[82.10135,30.35439],[81.99082,30.33423],[81.62033,30.44703],[81.5459,30.37688],[81.41018,30.42153],[81.39928,30.21862],[81.33355,30.15303],[81.2623,30.14596],[81.29032,30.08806],[81.24362,30.0126],[81.12842,30.01395],[81.03953,30.20059],[80.92547,30.17193],[80.91143,30.22173],[80.86673,30.17321],[80.8778,30.13384],[80.67076,29.95732],[80.60226,29.95732],[80.57179,29.91422],[80.56247,29.86661],[80.48997,29.79566],[80.43458,29.80466],[80.41554,29.79451],[80.36803,29.73865],[80.38428,29.68513],[80.41858,29.63581],[80.37939,29.57098],[80.24322,29.44299],[80.31428,29.30784],[80.28626,29.20327],[80.24112,29.21414],[80.26602,29.13938],[80.23178,29.11626],[80.18085,29.13649],[80.05743,28.91479],[80.06957,28.82763],[80.12125,28.82346],[80.37188,28.63371],[80.44504,28.63098],[80.52443,28.54897],[80.50575,28.6706],[80.55142,28.69182],[81.03471,28.40054],[81.19847,28.36284],[81.32923,28.13521],[81.38683,28.17638],[81.48179,28.12148],[81.47867,28.08303],[81.91223,27.84995],[81.97214,27.93322],[82.06554,27.92222],[82.46405,27.6716],[82.70378,27.72122],[82.74119,27.49838],[82.93261,27.50328],[82.94938,27.46036],[83.19413,27.45632],[83.27197,27.38309],[83.2673,27.36235],[83.29999,27.32778],[83.35136,27.33885],[83.38872,27.39276],[83.39495,27.4798],[83.61288,27.47013],[83.85595,27.35797],[83.86182,27.4241],[83.93306,27.44939],[84.02229,27.43836],[84.10791,27.52399],[84.21376,27.45218],[84.25735,27.44941],[84.29315,27.39],[84.62161,27.33885],[84.69166,27.21294],[84.64496,27.04669],[84.793,26.9968],[84.82913,27.01989],[84.85754,26.98984],[84.96687,26.95599],[84.97186,26.9149],[85.00536,26.89523],[85.05592,26.88991],[85.02635,26.85381],[85.15883,26.86966],[85.19291,26.86909],[85.18046,26.80519],[85.21159,26.75933],[85.34302,26.74954],[85.47752,26.79292],[85.56471,26.84133],[85.5757,26.85955],[85.59461,26.85161],[85.61621,26.86721],[85.66239,26.84822],[85.73483,26.79613],[85.72315,26.67471],[85.76907,26.63076],[85.83126,26.61134],[85.85126,26.60866],[85.8492,26.56667],[86.02729,26.66756],[86.13596,26.60651],[86.22513,26.58863],[86.26235,26.61886],[86.31564,26.61925],[86.49726,26.54218],[86.54258,26.53819],[86.57073,26.49825],[86.61313,26.48658],[86.62686,26.46891],[86.69124,26.45169],[86.74025,26.42386],[86.76797,26.45892],[86.82898,26.43919],[86.94543,26.52076],[86.95912,26.52076],[87.01559,26.53228],[87.04691,26.58685],[87.0707,26.58571],[87.09147,26.45039],[87.14751,26.40542],[87.18863,26.40558],[87.24682,26.4143],[87.26587,26.40592],[87.26568,26.37294],[87.34568,26.34787],[87.37314,26.40815],[87.46566,26.44058],[87.51571,26.43106],[87.55274,26.40596],[87.59175,26.38342],[87.66803,26.40294],[87.67893,26.43501],[87.76004,26.40711],[87.7918,26.46737],[87.84193,26.43663],[87.89085,26.48565],[87.90115,26.44923],[88.00895,26.36029],[88.09414,26.43732],[88.09963,26.54195],[88.16452,26.64111],[88.1659,26.68177],[88.19107,26.75516],[88.12302,26.95324],[88.13422,26.98705],[88.11719,26.98758],[87.9887,27.11045],[88.01587,27.21388],[88.01646,27.21612],[88.07277,27.43007],[88.04008,27.49223],[88.19107,27.79285],[88.1973,27.85067],[88.13378,27.88015]]]]}},{type:"Feature",properties:{iso1A2:"NR",iso1A3:"NRU",iso1N3:"520",wikidata:"Q697",nameEn:"Nauru",groups:["057","009","UN"],driveSide:"left",callingCodes:["674"]},geometry:{type:"MultiPolygon",coordinates:[[[[166.95155,.14829],[166.21778,-.7977],[167.60042,-.88259],[166.95155,.14829]]]]}},{type:"Feature",properties:{iso1A2:"NU",iso1A3:"NIU",iso1N3:"570",wikidata:"Q34020",nameEn:"Niue",country:"NZ",groups:["061","009","UN"],driveSide:"left",callingCodes:["683"]},geometry:{type:"MultiPolygon",coordinates:[[[[-170.83899,-18.53439],[-170.82274,-20.44429],[-168.63096,-18.60489],[-170.83899,-18.53439]]]]}},{type:"Feature",properties:{iso1A2:"NZ",iso1A3:"NZL",iso1N3:"554",wikidata:"Q664",nameEn:"New Zealand"},geometry:null},{type:"Feature",properties:{iso1A2:"OM",iso1A3:"OMN",iso1N3:"512",wikidata:"Q842",nameEn:"Oman",groups:["145","142","UN"],callingCodes:["968"]},geometry:{type:"MultiPolygon",coordinates:[[[[56.82555,25.7713],[56.79239,26.41236],[56.68954,26.76645],[56.2644,26.58649],[55.81777,26.18798],[56.08666,26.05038],[56.15498,26.06828],[56.19334,25.9795],[56.13963,25.82765],[56.17416,25.77239],[56.13579,25.73524],[56.14826,25.66351],[56.18363,25.65508],[56.20473,25.61119],[56.25365,25.60211],[56.26636,25.60643],[56.25341,25.61443],[56.26534,25.62825],[56.82555,25.7713]]],[[[56.26062,25.33108],[56.23362,25.31253],[56.25008,25.28843],[56.24465,25.27505],[56.20838,25.25668],[56.20872,25.24104],[56.24341,25.22867],[56.27628,25.23404],[56.34438,25.26653],[56.35172,25.30681],[56.3111,25.30107],[56.3005,25.31815],[56.26062,25.33108]],[[56.28423,25.26344],[56.27086,25.26128],[56.2716,25.27916],[56.28102,25.28486],[56.29379,25.2754],[56.28423,25.26344]]],[[[61.45114,22.55394],[56.86325,25.03856],[56.3227,24.97284],[56.34873,24.93205],[56.30269,24.88334],[56.20568,24.85063],[56.20062,24.78565],[56.13684,24.73699],[56.06128,24.74457],[56.03535,24.81161],[55.97836,24.87673],[55.97467,24.89639],[56.05106,24.87461],[56.05715,24.95727],[55.96316,25.00857],[55.90849,24.96771],[55.85094,24.96858],[55.81116,24.9116],[55.81348,24.80102],[55.83408,24.77858],[55.83271,24.68567],[55.76461,24.5287],[55.83271,24.41521],[55.83395,24.32776],[55.80747,24.31069],[55.79145,24.27914],[55.76781,24.26209],[55.75939,24.26114],[55.75382,24.2466],[55.75257,24.23466],[55.76558,24.23227],[55.77658,24.23476],[55.83367,24.20193],[55.95472,24.2172],[56.01799,24.07426],[55.8308,24.01633],[55.73301,24.05994],[55.48677,23.94946],[55.57358,23.669],[55.22634,23.10378],[55.2137,22.71065],[55.66469,21.99658],[54.99756,20.00083],[52.00311,19.00083],[52.78009,17.35124],[52.74267,17.29519],[52.81185,17.28568],[57.49095,8.14549],[61.45114,22.55394]]]]}},{type:"Feature",properties:{iso1A2:"PA",iso1A3:"PAN",iso1N3:"591",wikidata:"Q804",nameEn:"Panama",groups:["013","003","419","019","UN"],callingCodes:["507"]},geometry:{type:"MultiPolygon",coordinates:[[[[-77.32389,8.81247],[-77.58292,9.22278],[-78.79327,9.93766],[-82.51044,9.65379],[-82.56507,9.57279],[-82.61345,9.49881],[-82.66667,9.49746],[-82.77206,9.59573],[-82.87919,9.62645],[-82.84871,9.4973],[-82.93516,9.46741],[-82.93516,9.07687],[-82.72126,8.97125],[-82.88253,8.83331],[-82.91377,8.774],[-82.92068,8.74832],[-82.8794,8.6981],[-82.82739,8.60153],[-82.83975,8.54755],[-82.83322,8.52464],[-82.8382,8.48117],[-82.8679,8.44042],[-82.93056,8.43465],[-83.05209,8.33394],[-82.9388,8.26634],[-82.88641,8.10219],[-82.89137,8.05755],[-82.89978,8.04083],[-82.94503,7.93865],[-82.13751,6.97312],[-78.06168,7.07793],[-77.89178,7.22681],[-77.81426,7.48319],[-77.72157,7.47612],[-77.72514,7.72348],[-77.57185,7.51147],[-77.17257,7.97422],[-77.45064,8.49991],[-77.32389,8.81247]]]]}},{type:"Feature",properties:{iso1A2:"PE",iso1A3:"PER",iso1N3:"604",wikidata:"Q419",nameEn:"Peru",groups:["005","419","019","UN"],callingCodes:["51"]},geometry:{type:"MultiPolygon",coordinates:[[[[-74.26675,-.97229],[-74.42701,-.50218],[-75.18513,-.0308],[-75.25764,-.11943],[-75.40192,-.17196],[-75.61997,-.10012],[-75.60169,-.18708],[-75.53615,-.19213],[-75.22862,-.60048],[-75.22862,-.95588],[-75.3872,-.9374],[-75.57429,-1.55961],[-76.05203,-2.12179],[-76.6324,-2.58397],[-77.94147,-3.05454],[-78.19369,-3.36431],[-78.14324,-3.47653],[-78.22642,-3.51113],[-78.24589,-3.39907],[-78.34362,-3.38633],[-78.68394,-4.60754],[-78.85149,-4.66795],[-79.01659,-5.01481],[-79.1162,-4.97774],[-79.26248,-4.95167],[-79.59402,-4.46848],[-79.79722,-4.47558],[-80.13945,-4.29786],[-80.39256,-4.48269],[-80.46386,-4.41516],[-80.32114,-4.21323],[-80.45023,-4.20938],[-80.4822,-4.05477],[-80.46386,-4.01342],[-80.13232,-3.90317],[-80.19926,-3.68894],[-80.18741,-3.63994],[-80.19848,-3.59249],[-80.21642,-3.5888],[-80.20535,-3.51667],[-80.22629,-3.501],[-80.23651,-3.48652],[-80.24586,-3.48677],[-80.24123,-3.46124],[-80.20647,-3.431],[-80.30602,-3.39149],[-84.52388,-3.36941],[-85.71054,-21.15413],[-70.59118,-18.35072],[-70.378,-18.3495],[-70.31267,-18.31258],[-70.16394,-18.31737],[-69.96732,-18.25992],[-69.81607,-18.12582],[-69.75305,-17.94605],[-69.82868,-17.72048],[-69.79087,-17.65563],[-69.66483,-17.65083],[-69.46897,-17.4988],[-69.46863,-17.37466],[-69.62883,-17.28142],[-69.16896,-16.72233],[-69.00853,-16.66769],[-69.04027,-16.57214],[-68.98358,-16.42165],[-68.79464,-16.33272],[-68.96238,-16.194],[-69.09986,-16.22693],[-69.20291,-16.16668],[-69.40336,-15.61358],[-69.14856,-15.23478],[-69.36254,-14.94634],[-68.88135,-14.18639],[-69.05265,-13.68546],[-68.8864,-13.40792],[-68.85615,-12.87769],[-68.65044,-12.50689],[-68.98115,-11.8979],[-69.57156,-10.94555],[-69.57835,-10.94051],[-69.90896,-10.92744],[-70.38791,-11.07096],[-70.51395,-10.92249],[-70.64134,-11.0108],[-70.62487,-9.80666],[-70.55429,-9.76692],[-70.58453,-9.58303],[-70.53373,-9.42628],[-71.23394,-9.9668],[-72.14742,-9.98049],[-72.31883,-9.5184],[-72.72216,-9.41397],[-73.21498,-9.40904],[-72.92886,-9.04074],[-73.76576,-7.89884],[-73.65485,-7.77897],[-73.96938,-7.58465],[-73.77011,-7.28944],[-73.73986,-6.87919],[-73.12983,-6.43852],[-73.24579,-6.05764],[-72.83973,-5.14765],[-72.64391,-5.0391],[-71.87003,-4.51661],[-70.96814,-4.36915],[-70.77601,-4.15717],[-70.33236,-4.15214],[-70.19582,-4.3607],[-70.11305,-4.27281],[-70.00888,-4.37833],[-69.94708,-4.2431],[-70.3374,-3.79505],[-70.52393,-3.87553],[-70.71396,-3.7921],[-70.04609,-2.73906],[-70.94377,-2.23142],[-71.75223,-2.15058],[-72.92587,-2.44514],[-73.65312,-1.26222],[-74.26675,-.97229]]]]}},{type:"Feature",properties:{iso1A2:"PF",iso1A3:"PYF",iso1N3:"258",wikidata:"Q30971",nameEn:"French Polynesia",country:"FR",groups:["EU","Q1451600","061","009","UN"],callingCodes:["689"]},geometry:{type:"MultiPolygon",coordinates:[[[[-135.59706,-4.70473],[-156.48634,-15.52824],[-156.45576,-31.75456],[-133.59543,-28.4709],[-135.59706,-4.70473]]]]}},{type:"Feature",properties:{iso1A2:"PG",iso1A3:"PNG",iso1N3:"598",wikidata:"Q691",nameEn:"Papua New Guinea",groups:["054","009","UN"],driveSide:"left",callingCodes:["675"]},geometry:{type:"MultiPolygon",coordinates:[[[[141.03157,2.12829],[140.99813,-6.3233],[140.85295,-6.72996],[140.90448,-6.85033],[141.01763,-6.90181],[141.01842,-9.35091],[141.88934,-9.36111],[142.19246,-9.15378],[142.48658,-9.36754],[143.29772,-9.33993],[143.87386,-9.02382],[145.2855,-9.62524],[156.73836,-14.50464],[154.74815,-7.33315],[155.60735,-6.92266],[155.69784,-6.92661],[155.92557,-6.84664],[156.03993,-6.65703],[156.03296,-6.55528],[160.43769,-4.17974],[141.03157,2.12829]]]]}},{type:"Feature",properties:{iso1A2:"PH",iso1A3:"PHL",iso1N3:"608",wikidata:"Q928",nameEn:"Philippines",aliases:["PI","RP"],groups:["035","142","UN"],callingCodes:["63"]},geometry:{type:"MultiPolygon",coordinates:[[[[129.19694,7.84182],[121.8109,21.77688],[120.69238,21.52331],[118.82252,14.67191],[115.39742,10.92666],[116.79524,7.43869],[117.17735,7.52841],[117.93857,6.89845],[117.98544,6.27477],[119.52945,5.35672],[118.93936,4.09009],[118.06469,4.16638],[121.14448,2.12444],[129.19694,7.84182]]]]}},{type:"Feature",properties:{iso1A2:"PK",iso1A3:"PAK",iso1N3:"586",wikidata:"Q843",nameEn:"Pakistan",groups:["034","142","UN"],driveSide:"left",callingCodes:["92"]},geometry:{type:"MultiPolygon",coordinates:[[[[75.72737,36.7529],[75.45562,36.71971],[75.40481,36.95382],[75.13839,37.02622],[74.56453,37.03023],[74.53739,36.96224],[74.43389,37.00977],[74.04856,36.82648],[73.82685,36.91421],[72.6323,36.84601],[72.18135,36.71838],[71.80267,36.49924],[71.60491,36.39429],[71.19505,36.04134],[71.37969,35.95865],[71.55273,35.71483],[71.49917,35.6267],[71.65435,35.4479],[71.54294,35.31037],[71.5541,35.28776],[71.67495,35.21262],[71.52938,35.09023],[71.55273,35.02615],[71.49917,35.00478],[71.50329,34.97328],[71.29472,34.87728],[71.28356,34.80882],[71.08718,34.69034],[71.11602,34.63047],[71.0089,34.54568],[71.02401,34.44835],[71.17662,34.36769],[71.12815,34.26619],[71.13078,34.16503],[71.09453,34.13524],[71.09307,34.11961],[71.06933,34.10564],[71.07345,34.06242],[70.88119,33.97933],[70.54336,33.9463],[69.90203,34.04194],[69.87307,33.9689],[69.85671,33.93719],[70.00503,33.73528],[70.14236,33.71701],[70.14785,33.6553],[70.20141,33.64387],[70.17062,33.53535],[70.32775,33.34496],[70.13686,33.21064],[70.07369,33.22557],[70.02563,33.14282],[69.85259,33.09451],[69.79766,33.13247],[69.71526,33.09911],[69.57656,33.09911],[69.49004,33.01509],[69.49854,32.88843],[69.5436,32.8768],[69.47082,32.85834],[69.38018,32.76601],[69.43649,32.7302],[69.44747,32.6678],[69.38155,32.56601],[69.2868,32.53938],[69.23599,32.45946],[69.27932,32.29119],[69.27032,32.14141],[69.3225,31.93186],[69.20577,31.85957],[69.11514,31.70782],[69.00939,31.62249],[68.95995,31.64822],[68.91078,31.59687],[68.79997,31.61665],[68.6956,31.75687],[68.57475,31.83158],[68.44222,31.76446],[68.27605,31.75863],[68.25614,31.80357],[68.1655,31.82691],[68.00071,31.6564],[67.86887,31.63536],[67.72056,31.52304],[67.58323,31.52772],[67.62374,31.40473],[67.7748,31.4188],[67.78854,31.33203],[67.29964,31.19586],[67.03323,31.24519],[67.04147,31.31561],[66.83273,31.26867],[66.72561,31.20526],[66.68166,31.07597],[66.58175,30.97532],[66.42645,30.95309],[66.39194,30.9408],[66.28413,30.57001],[66.34869,30.404],[66.23609,30.06321],[66.36042,29.9583],[66.24175,29.85181],[65.04005,29.53957],[64.62116,29.58903],[64.19796,29.50407],[64.12966,29.39157],[63.5876,29.50456],[62.47751,29.40782],[60.87231,29.86514],[61.31508,29.38903],[61.53765,29.00507],[61.65978,28.77937],[61.93581,28.55284],[62.40259,28.42703],[62.59499,28.24842],[62.79412,28.28108],[62.7638,28.02992],[62.84905,27.47627],[62.79684,27.34381],[62.80604,27.22412],[63.19649,27.25674],[63.32283,27.14437],[63.25005,27.08692],[63.25005,26.84212],[63.18688,26.83844],[63.1889,26.65072],[62.77352,26.64099],[62.31484,26.528],[62.21304,26.26601],[62.05117,26.31647],[61.89391,26.26251],[61.83831,26.07249],[61.83968,25.7538],[61.683,25.66638],[61.6433,25.27541],[61.46682,24.57869],[68.11329,23.53945],[68.20763,23.85849],[68.39339,23.96838],[68.74643,23.97027],[68.7416,24.31904],[68.90914,24.33156],[68.97781,24.26021],[69.07806,24.29777],[69.19341,24.25646],[69.29778,24.28712],[69.59579,24.29777],[69.73335,24.17007],[70.03428,24.172],[70.11712,24.30915],[70.5667,24.43787],[70.57906,24.27774],[70.71502,24.23517],[70.88393,24.27398],[70.85784,24.30903],[70.94985,24.3791],[71.04461,24.34657],[71.12838,24.42662],[71.00341,24.46038],[70.97594,24.60904],[71.09405,24.69017],[70.94002,24.92843],[70.89148,25.15064],[70.66695,25.39314],[70.67382,25.68186],[70.60378,25.71898],[70.53649,25.68928],[70.37444,25.67443],[70.2687,25.71156],[70.0985,25.93238],[70.08193,26.08094],[70.17532,26.24118],[70.17532,26.55362],[70.05584,26.60398],[69.88555,26.56836],[69.50904,26.74892],[69.58519,27.18109],[70.03136,27.56627],[70.12502,27.8057],[70.37307,28.01208],[70.60927,28.02178],[70.79054,27.68423],[71.89921,27.96035],[71.9244,28.11555],[72.20329,28.3869],[72.29495,28.66367],[72.40402,28.78283],[72.94272,29.02487],[73.01337,29.16422],[73.05886,29.1878],[73.28094,29.56646],[73.3962,29.94707],[73.58665,30.01848],[73.80299,30.06969],[73.97225,30.19829],[73.95736,30.28466],[73.88993,30.36305],[74.5616,31.04153],[74.67971,31.05479],[74.6852,31.12771],[74.60006,31.13711],[74.60281,31.10419],[74.56023,31.08303],[74.51629,31.13829],[74.53223,31.30321],[74.59773,31.4136],[74.64713,31.45605],[74.59319,31.50197],[74.61517,31.55698],[74.57498,31.60382],[74.47771,31.72227],[74.58907,31.87824],[74.79919,31.95983],[74.86236,32.04485],[74.9269,32.0658],[75.00793,32.03786],[75.25649,32.10187],[75.38046,32.26836],[75.28259,32.36556],[75.03265,32.49538],[74.97634,32.45367],[74.84725,32.49075],[74.68362,32.49298],[74.67431,32.56676],[74.65251,32.56416],[74.64424,32.60985],[74.69542,32.66792],[74.65345,32.71225],[74.7113,32.84219],[74.64675,32.82604],[74.6289,32.75561],[74.45312,32.77755],[74.41467,32.90563],[74.31227,32.92795],[74.34875,32.97823],[74.31854,33.02891],[74.17571,33.07495],[74.15374,33.13477],[74.02144,33.18908],[74.01366,33.25199],[74.08782,33.26232],[74.17983,33.3679],[74.18121,33.4745],[74.10115,33.56392],[74.03576,33.56718],[73.97367,33.64061],[73.98968,33.66155],[73.96423,33.73071],[74.00891,33.75437],[74.05898,33.82089],[74.14001,33.83002],[74.26086,33.92237],[74.25262,34.01577],[74.21554,34.03853],[73.91341,34.01235],[73.88732,34.05105],[73.90677,34.10504],[73.98208,34.2522],[73.90517,34.35317],[73.8475,34.32935],[73.74862,34.34183],[73.74999,34.3781],[73.88732,34.48911],[73.89419,34.54568],[73.93951,34.57169],[73.93401,34.63386],[73.96423,34.68244],[74.12897,34.70073],[74.31239,34.79626],[74.58083,34.77386],[74.6663,34.703],[75.01479,34.64629],[75.38009,34.55021],[75.75438,34.51827],[76.04614,34.67566],[76.15463,34.6429],[76.47186,34.78965],[76.67648,34.76371],[76.74377,34.84039],[76.74514,34.92488],[76.87193,34.96906],[76.99251,34.93349],[77.11796,35.05419],[76.93465,35.39866],[76.85088,35.39754],[76.75475,35.52617],[76.77323,35.66062],[76.50961,35.8908],[76.33453,35.84296],[76.14913,35.82848],[76.15325,35.9264],[75.93028,36.13136],[76.00906,36.17511],[76.0324,36.41198],[75.92391,36.56986],[75.72737,36.7529]]]]}},{type:"Feature",properties:{iso1A2:"PL",iso1A3:"POL",iso1N3:"616",wikidata:"Q36",nameEn:"Poland",groups:["EU","151","150","UN"],callingCodes:["48"]},geometry:{type:"MultiPolygon",coordinates:[[[[18.57853,55.25302],[14.20811,54.12784],[14.22634,53.9291],[14.20647,53.91671],[14.18544,53.91258],[14.20823,53.90776],[14.21323,53.8664],[14.27249,53.74464],[14.26782,53.69866],[14.2836,53.67721],[14.27133,53.66613],[14.28477,53.65955],[14.2853,53.63392],[14.31904,53.61581],[14.30416,53.55499],[14.3273,53.50587],[14.35209,53.49506],[14.4215,53.27724],[14.44133,53.27427],[14.45125,53.26241],[14.40662,53.21098],[14.37853,53.20405],[14.36696,53.16444],[14.38679,53.13669],[14.35044,53.05829],[14.25954,53.00264],[14.14056,52.95786],[14.15873,52.87715],[14.12256,52.84311],[14.13806,52.82392],[14.22071,52.81175],[14.61073,52.59847],[14.6289,52.57136],[14.60081,52.53116],[14.63056,52.48993],[14.54423,52.42568],[14.55228,52.35264],[14.56378,52.33838],[14.58149,52.28007],[14.70139,52.25038],[14.71319,52.22144],[14.68344,52.19612],[14.70616,52.16927],[14.67683,52.13936],[14.6917,52.10283],[14.72971,52.09167],[14.76026,52.06624],[14.71339,52.00337],[14.70488,51.97679],[14.7139,51.95643],[14.71836,51.95606],[14.72163,51.95188],[14.7177,51.94048],[14.70601,51.92944],[14.6933,51.9044],[14.6588,51.88359],[14.59089,51.83302],[14.60493,51.80473],[14.64625,51.79472],[14.66386,51.73282],[14.69065,51.70842],[14.75392,51.67445],[14.75759,51.62318],[14.7727,51.61263],[14.71125,51.56209],[14.73047,51.54606],[14.72652,51.53902],[14.73219,51.52922],[14.94749,51.47155],[14.9652,51.44793],[14.96899,51.38367],[14.98008,51.33449],[15.04288,51.28387],[15.01242,51.21285],[15.0047,51.16874],[14.99311,51.16249],[14.99414,51.15813],[15.00083,51.14974],[14.99646,51.14365],[14.99079,51.14284],[14.99689,51.12205],[14.98229,51.11354],[14.97938,51.07742],[14.95529,51.04552],[14.92942,50.99744],[14.89252,50.94999],[14.89681,50.9422],[14.81664,50.88148],[14.82803,50.86966],[14.99852,50.86817],[15.01088,50.97984],[14.96419,50.99108],[15.02433,51.0242],[15.03895,51.0123],[15.06218,51.02269],[15.10152,51.01095],[15.11937,50.99021],[15.16744,51.01959],[15.1743,50.9833],[15.2361,50.99886],[15.27043,50.97724],[15.2773,50.8907],[15.36656,50.83956],[15.3803,50.77187],[15.43798,50.80833],[15.73186,50.73885],[15.81683,50.75666],[15.87331,50.67188],[15.97219,50.69799],[16.0175,50.63009],[15.98317,50.61528],[16.02437,50.60046],[16.10265,50.66405],[16.20839,50.63096],[16.23174,50.67101],[16.33611,50.66579],[16.44597,50.58041],[16.34572,50.49575],[16.31413,50.50274],[16.19526,50.43291],[16.21585,50.40627],[16.22821,50.41054],[16.28118,50.36891],[16.30289,50.38292],[16.36495,50.37679],[16.3622,50.34875],[16.39379,50.3207],[16.42674,50.32509],[16.56407,50.21009],[16.55446,50.16613],[16.63137,50.1142],[16.7014,50.09659],[16.8456,50.20834],[16.98018,50.24172],[17.00353,50.21449],[17.02825,50.23118],[16.99803,50.25753],[17.02138,50.27772],[16.99803,50.30316],[16.94448,50.31281],[16.90877,50.38642],[16.85933,50.41093],[16.89229,50.45117],[17.1224,50.39494],[17.14498,50.38117],[17.19579,50.38817],[17.19991,50.3654],[17.27681,50.32246],[17.34273,50.32947],[17.34548,50.2628],[17.3702,50.28123],[17.58889,50.27837],[17.67764,50.28977],[17.69292,50.32859],[17.74648,50.29966],[17.72176,50.25665],[17.76296,50.23382],[17.70528,50.18812],[17.59404,50.16437],[17.66683,50.10275],[17.6888,50.12037],[17.7506,50.07896],[17.77669,50.02253],[17.86886,49.97452],[18.00191,50.01723],[18.04585,50.01194],[18.04585,50.03311],[18.00396,50.04954],[18.03212,50.06574],[18.07898,50.04535],[18.10628,50.00223],[18.20241,49.99958],[18.21752,49.97309],[18.27107,49.96779],[18.27794,49.93863],[18.31914,49.91565],[18.33278,49.92415],[18.33562,49.94747],[18.41604,49.93498],[18.53423,49.89906],[18.54495,49.9079],[18.54299,49.92537],[18.57697,49.91565],[18.57045,49.87849],[18.60341,49.86256],[18.57183,49.83334],[18.61278,49.7618],[18.61368,49.75426],[18.62645,49.75002],[18.62943,49.74603],[18.62676,49.71983],[18.69817,49.70473],[18.72838,49.68163],[18.80479,49.6815],[18.84786,49.5446],[18.84521,49.51672],[18.94536,49.52143],[18.97283,49.49914],[18.9742,49.39557],[19.18019,49.41165],[19.25435,49.53391],[19.36009,49.53747],[19.37795,49.574],[19.45348,49.61583],[19.52626,49.57311],[19.53313,49.52856],[19.57845,49.46077],[19.64162,49.45184],[19.6375,49.40897],[19.72127,49.39288],[19.78581,49.41701],[19.82237,49.27806],[19.75286,49.20751],[19.86409,49.19316],[19.90529,49.23532],[19.98494,49.22904],[20.08238,49.1813],[20.13738,49.31685],[20.21977,49.35265],[20.31453,49.34817],[20.31728,49.39914],[20.39939,49.3896],[20.46422,49.41612],[20.5631,49.375],[20.61666,49.41791],[20.72274,49.41813],[20.77971,49.35383],[20.9229,49.29626],[20.98733,49.30774],[21.09799,49.37176],[21.041,49.41791],[21.12477,49.43666],[21.19756,49.4054],[21.27858,49.45988],[21.43376,49.41433],[21.62328,49.4447],[21.77983,49.35443],[21.82927,49.39467],[21.96385,49.3437],[22.04427,49.22136],[22.56155,49.08865],[22.89122,49.00725],[22.86336,49.10513],[22.72009,49.20288],[22.748,49.32759],[22.69444,49.49378],[22.64534,49.53094],[22.78304,49.65543],[22.80261,49.69098],[22.83179,49.69875],[22.99329,49.84249],[23.28221,50.0957],[23.67635,50.33385],[23.71382,50.38248],[23.79445,50.40481],[23.99563,50.41289],[24.03668,50.44507],[24.07048,50.5071],[24.0996,50.60752],[24.0595,50.71625],[23.95925,50.79271],[23.99254,50.83847],[24.0952,50.83262],[24.14524,50.86128],[24.04576,50.90196],[23.92217,51.00836],[23.90376,51.07697],[23.80678,51.18405],[23.63858,51.32182],[23.69905,51.40871],[23.62751,51.50512],[23.56236,51.53673],[23.57053,51.55938],[23.53198,51.74298],[23.62691,51.78208],[23.61523,51.92066],[23.68733,51.9906],[23.64066,52.07626],[23.61,52.11264],[23.54314,52.12148],[23.47859,52.18215],[23.20071,52.22848],[23.18196,52.28812],[23.34141,52.44845],[23.45112,52.53774],[23.58296,52.59868],[23.73615,52.6149],[23.93763,52.71332],[23.91805,52.94016],[23.94689,52.95919],[23.92184,53.02079],[23.87548,53.0831],[23.91393,53.16469],[23.85657,53.22923],[23.81995,53.24131],[23.62004,53.60942],[23.51284,53.95052],[23.48261,53.98855],[23.52702,54.04622],[23.49196,54.14764],[23.45223,54.17775],[23.42418,54.17911],[23.39525,54.21672],[23.3494,54.25155],[23.24656,54.25701],[23.15938,54.29894],[23.15526,54.31076],[23.13905,54.31567],[23.104,54.29794],[23.04323,54.31567],[23.05726,54.34565],[22.99649,54.35927],[23.00584,54.38514],[22.83756,54.40827],[22.79705,54.36264],[21.41123,54.32395],[20.63871,54.3706],[19.8038,54.44203],[19.64312,54.45423],[18.57853,55.25302]]]]}},{type:"Feature",properties:{iso1A2:"PM",iso1A3:"SPM",iso1N3:"666",wikidata:"Q34617",nameEn:"Saint Pierre and Miquelon",country:"FR",groups:["EU","Q1451600","021","003","019","UN"],callingCodes:["508"]},geometry:{type:"MultiPolygon",coordinates:[[[[-56.72993,46.65575],[-55.90758,46.6223],[-56.27503,47.39728],[-56.72993,46.65575]]]]}},{type:"Feature",properties:{iso1A2:"PN",iso1A3:"PCN",iso1N3:"612",wikidata:"Q35672",nameEn:"Pitcairn Islands",country:"GB",groups:["BOTS","061","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[-133.59543,-28.4709],[-122.0366,-24.55017],[-133.61511,-21.93325],[-133.59543,-28.4709]]]]}},{type:"Feature",properties:{iso1A2:"PR",iso1A3:"PRI",iso1N3:"630",wikidata:"Q1183",nameEn:"Puerto Rico",aliases:["US-PR"],country:"US",groups:["Q1352230","029","003","419","019","UN"],roadSpeedUnit:"mph",callingCodes:["1 787","1 939"]},geometry:{type:"MultiPolygon",coordinates:[[[[-65.27974,17.56928],[-65.02435,18.73231],[-67.99519,18.97186],[-68.23894,17.84663],[-65.27974,17.56928]]]]}},{type:"Feature",properties:{iso1A2:"PS",iso1A3:"PSE",iso1N3:"275",wikidata:"Q219060",nameEn:"Palestine"},geometry:null},{type:"Feature",properties:{iso1A2:"PT",iso1A3:"PRT",iso1N3:"620",wikidata:"Q45",nameEn:"Portugal"},geometry:null},{type:"Feature",properties:{iso1A2:"PW",iso1A3:"PLW",iso1N3:"585",wikidata:"Q695",nameEn:"Palau",groups:["057","009","UN"],roadSpeedUnit:"mph",callingCodes:["680"]},geometry:{type:"MultiPolygon",coordinates:[[[[128.97621,3.08804],[136.39296,1.54187],[136.04605,12.45908],[128.97621,3.08804]]]]}},{type:"Feature",properties:{iso1A2:"PY",iso1A3:"PRY",iso1N3:"600",wikidata:"Q733",nameEn:"Paraguay",groups:["005","419","019","UN"],callingCodes:["595"]},geometry:{type:"MultiPolygon",coordinates:[[[[-58.16225,-20.16193],[-58.23216,-19.80058],[-59.06965,-19.29148],[-60.00638,-19.2981],[-61.73723,-19.63958],[-61.93912,-20.10053],[-62.26883,-20.55311],[-62.2757,-21.06657],[-62.64455,-22.25091],[-62.51761,-22.37684],[-62.22768,-22.55807],[-61.9756,-23.0507],[-61.0782,-23.62932],[-60.99754,-23.80934],[-60.28163,-24.04436],[-60.03367,-24.00701],[-59.45482,-24.34787],[-59.33886,-24.49935],[-58.33055,-24.97099],[-58.25492,-24.92528],[-57.80821,-25.13863],[-57.57431,-25.47269],[-57.87176,-25.93604],[-58.1188,-26.16704],[-58.3198,-26.83443],[-58.65321,-27.14028],[-58.59549,-27.29973],[-58.04205,-27.2387],[-56.85337,-27.5165],[-56.18313,-27.29851],[-55.89195,-27.3467],[-55.74475,-27.44485],[-55.59094,-27.32444],[-55.62322,-27.1941],[-55.39611,-26.97679],[-55.25243,-26.93808],[-55.16948,-26.96068],[-55.06351,-26.80195],[-55.00584,-26.78754],[-54.80868,-26.55669],[-54.70732,-26.45099],[-54.69333,-26.37705],[-54.67359,-25.98607],[-54.60664,-25.9691],[-54.62063,-25.91213],[-54.59398,-25.59224],[-54.59509,-25.53696],[-54.60196,-25.48397],[-54.62033,-25.46026],[-54.4423,-25.13381],[-54.28207,-24.07305],[-54.32807,-24.01865],[-54.6238,-23.83078],[-55.02691,-23.97317],[-55.0518,-23.98666],[-55.12292,-23.99669],[-55.41784,-23.9657],[-55.44117,-23.9185],[-55.43585,-23.87157],[-55.5555,-23.28237],[-55.52288,-23.2595],[-55.5446,-23.22811],[-55.63849,-22.95122],[-55.62493,-22.62765],[-55.68742,-22.58407],[-55.6986,-22.56268],[-55.72366,-22.5519],[-55.741,-22.52018],[-55.74941,-22.46436],[-55.8331,-22.29008],[-56.23206,-22.25347],[-56.45893,-22.08072],[-56.5212,-22.11556],[-56.6508,-22.28387],[-57.98625,-22.09157],[-57.94642,-21.73799],[-57.88239,-21.6868],[-57.93492,-21.65505],[-57.84536,-20.93155],[-58.16225,-20.16193]]]]}},{type:"Feature",properties:{iso1A2:"QA",iso1A3:"QAT",iso1N3:"634",wikidata:"Q846",nameEn:"Qatar",groups:["145","142","UN"],callingCodes:["974"]},geometry:{type:"MultiPolygon",coordinates:[[[[50.92992,24.54396],[51.09638,24.46907],[51.29972,24.50747],[51.39468,24.62785],[51.58834,24.66608],[51.83108,24.71675],[51.83682,26.70231],[50.93865,26.30758],[50.81266,25.88946],[50.86149,25.6965],[50.7801,25.595],[50.80824,25.54641],[50.57069,25.57887],[50.8133,24.74049],[50.92992,24.54396]]]]}},{type:"Feature",properties:{iso1A2:"RE",iso1A3:"REU",iso1N3:"638",wikidata:"Q17070",nameEn:"R\xE9union",country:"FR",groups:["Q3320166","EU","014","202","002","UN"],callingCodes:["262"]},geometry:{type:"MultiPolygon",coordinates:[[[[53.37984,-21.23941],[56.73473,-21.9174],[56.62373,-20.2711],[53.37984,-21.23941]]]]}},{type:"Feature",properties:{iso1A2:"RO",iso1A3:"ROU",iso1N3:"642",wikidata:"Q218",nameEn:"Romania",groups:["EU","151","150","UN"],callingCodes:["40"]},geometry:{type:"MultiPolygon",coordinates:[[[[27.15622,47.98538],[27.02985,48.09083],[27.04118,48.12522],[26.96119,48.13003],[26.98042,48.15752],[26.94265,48.1969],[26.87708,48.19919],[26.81161,48.25049],[26.62823,48.25804],[26.55202,48.22445],[26.33504,48.18418],[26.17711,47.99246],[26.05901,47.9897],[25.77723,47.93919],[25.63878,47.94924],[25.23778,47.89403],[25.11144,47.75203],[24.88896,47.7234],[24.81893,47.82031],[24.70632,47.84428],[24.61994,47.95062],[24.43578,47.97131],[24.34926,47.9244],[24.22566,47.90231],[24.11281,47.91487],[24.06466,47.95317],[24.02999,47.95087],[24.00801,47.968],[23.98553,47.96076],[23.96337,47.96672],[23.94192,47.94868],[23.89352,47.94512],[23.8602,47.9329],[23.80904,47.98142],[23.75188,47.99705],[23.66262,47.98786],[23.63894,48.00293],[23.5653,48.00499],[23.52803,48.01818],[23.4979,47.96858],[23.33577,48.0237],[23.27397,48.08245],[23.15999,48.12188],[23.1133,48.08061],[23.08858,48.00716],[23.0158,47.99338],[22.92241,48.02002],[22.94301,47.96672],[22.89849,47.95851],[22.77991,47.87211],[22.76617,47.8417],[22.67247,47.7871],[22.46559,47.76583],[22.41979,47.7391],[22.31816,47.76126],[22.00917,47.50492],[22.03389,47.42508],[22.01055,47.37767],[21.94463,47.38046],[21.78395,47.11104],[21.648,47.03902],[21.68645,46.99595],[21.59581,46.91628],[21.59307,46.86935],[21.52028,46.84118],[21.48935,46.7577],[21.5151,46.72147],[21.43926,46.65109],[21.33214,46.63035],[21.26929,46.4993],[21.28061,46.44941],[21.16872,46.30118],[21.06572,46.24897],[20.86797,46.28884],[20.74574,46.25467],[20.76085,46.21002],[20.63863,46.12728],[20.49718,46.18721],[20.45377,46.14405],[20.35573,46.16629],[20.28324,46.1438],[20.26068,46.12332],[20.35862,45.99356],[20.54818,45.89939],[20.65645,45.82801],[20.70069,45.7493],[20.77416,45.75601],[20.78446,45.78522],[20.82364,45.77738],[20.80361,45.65875],[20.76798,45.60969],[20.83321,45.53567],[20.77217,45.49788],[20.86026,45.47295],[20.87948,45.42743],[21.09894,45.30144],[21.17612,45.32566],[21.20392,45.2677],[21.29398,45.24148],[21.48278,45.19557],[21.51299,45.15345],[21.4505,45.04294],[21.35855,45.01941],[21.54938,44.9327],[21.56328,44.89502],[21.48202,44.87199],[21.44013,44.87613],[21.35643,44.86364],[21.38802,44.78133],[21.55007,44.77304],[21.60019,44.75208],[21.61942,44.67059],[21.67504,44.67107],[21.71692,44.65349],[21.7795,44.66165],[21.99364,44.63395],[22.08016,44.49844],[22.13234,44.47444],[22.18315,44.48179],[22.30844,44.6619],[22.45301,44.7194],[22.61917,44.61489],[22.69196,44.61587],[22.76749,44.54446],[22.70981,44.51852],[22.61368,44.55719],[22.56493,44.53419],[22.54021,44.47836],[22.45436,44.47258],[22.56012,44.30712],[22.68166,44.28206],[22.67173,44.21564],[23.04988,44.07694],[23.01674,44.01946],[22.87873,43.9844],[22.83753,43.88055],[22.85314,43.84452],[23.05288,43.79494],[23.26772,43.84843],[23.4507,43.84936],[23.61687,43.79289],[23.73978,43.80627],[24.18149,43.68218],[24.35364,43.70211],[24.50264,43.76314],[24.62281,43.74082],[24.73542,43.68523],[24.96682,43.72693],[25.10718,43.6831],[25.17144,43.70261],[25.39528,43.61866],[25.72792,43.69263],[25.94911,43.85745],[26.05584,43.90925],[26.10115,43.96908],[26.38764,44.04356],[26.62712,44.05698],[26.95141,44.13555],[27.26845,44.12602],[27.39757,44.0141],[27.60834,44.01206],[27.64542,44.04958],[27.73468,43.95326],[27.92008,44.00761],[27.99558,43.84193],[28.23293,43.76],[29.24336,43.70874],[30.04414,45.08461],[29.69272,45.19227],[29.65428,45.25629],[29.68175,45.26885],[29.59798,45.38857],[29.42632,45.44545],[29.24779,45.43388],[28.96077,45.33164],[28.94292,45.28045],[28.81383,45.3384],[28.78911,45.24179],[28.71358,45.22631],[28.5735,45.24759],[28.34554,45.32102],[28.28504,45.43907],[28.21139,45.46895],[28.18741,45.47358],[28.08927,45.6051],[28.16568,45.6421],[28.13111,45.92819],[28.08612,46.01105],[28.13684,46.18099],[28.10937,46.22852],[28.19864,46.31869],[28.18902,46.35283],[28.25769,46.43334],[28.22281,46.50481],[28.24808,46.64305],[28.12173,46.82283],[28.09095,46.97621],[27.81892,47.1381],[27.73172,47.29248],[27.68706,47.28962],[27.60263,47.32507],[27.55731,47.46637],[27.47942,47.48113],[27.3979,47.59473],[27.32202,47.64009],[27.25519,47.71366],[27.29069,47.73722],[27.1618,47.92391],[27.15622,47.98538]]]]}},{type:"Feature",properties:{iso1A2:"RS",iso1A3:"SRB",iso1N3:"688",wikidata:"Q403",nameEn:"Serbia",groups:["039","150","UN"],callingCodes:["381"]},geometry:{type:"MultiPolygon",coordinates:[[[[19.66007,46.19005],[19.56113,46.16824],[19.52473,46.1171],[19.28826,45.99694],[19.14543,45.9998],[19.10388,46.04015],[19.0791,45.96458],[19.01284,45.96529],[18.99712,45.93537],[18.81394,45.91329],[18.85783,45.85493],[18.90305,45.71863],[18.96691,45.66731],[18.88776,45.57253],[18.94562,45.53712],[19.07471,45.53086],[19.08364,45.48804],[18.99918,45.49333],[18.97446,45.37528],[19.10774,45.29547],[19.28208,45.23813],[19.41941,45.23475],[19.43589,45.17137],[19.19144,45.17863],[19.14063,45.12972],[19.07952,45.14668],[19.1011,45.01191],[19.05205,44.97692],[19.15573,44.95409],[19.06853,44.89915],[19.02871,44.92541],[18.98957,44.90645],[19.01994,44.85493],[19.18183,44.92055],[19.36722,44.88164],[19.32543,44.74058],[19.26388,44.65412],[19.16699,44.52197],[19.13369,44.52521],[19.12278,44.50132],[19.14837,44.45253],[19.14681,44.41463],[19.11785,44.40313],[19.10749,44.39421],[19.10704,44.38249],[19.10365,44.37795],[19.10298,44.36924],[19.11865,44.36712],[19.1083,44.3558],[19.11547,44.34218],[19.13556,44.338],[19.13332,44.31492],[19.16741,44.28648],[19.18328,44.28383],[19.20508,44.2917],[19.23306,44.26097],[19.26945,44.26957],[19.32464,44.27185],[19.34773,44.23244],[19.3588,44.18353],[19.40927,44.16722],[19.43905,44.13088],[19.47338,44.15034],[19.48386,44.14332],[19.47321,44.1193],[19.51167,44.08158],[19.55999,44.06894],[19.57467,44.04716],[19.61991,44.05254],[19.61836,44.01464],[19.56498,43.99922],[19.52515,43.95573],[19.38439,43.96611],[19.24363,44.01502],[19.23465,43.98764],[19.3986,43.79668],[19.5176,43.71403],[19.50455,43.58385],[19.42696,43.57987],[19.41941,43.54056],[19.36653,43.60921],[19.33426,43.58833],[19.2553,43.5938],[19.24774,43.53061],[19.22807,43.5264],[19.22229,43.47926],[19.44315,43.38846],[19.48171,43.32644],[19.52962,43.31623],[19.54598,43.25158],[19.62661,43.2286],[19.64063,43.19027],[19.76918,43.16044],[19.79255,43.11951],[19.92576,43.08539],[19.96549,43.11098],[19.98887,43.0538],[20.04729,43.02732],[20.05431,42.99571],[20.12325,42.96237],[20.14896,42.99058],[20.16415,42.97177],[20.34528,42.90676],[20.35692,42.8335],[20.40594,42.84853],[20.43734,42.83157],[20.53484,42.8885],[20.48692,42.93208],[20.59929,43.01067],[20.64557,43.00826],[20.69515,43.09641],[20.59929,43.20492],[20.68688,43.21335],[20.73811,43.25068],[20.82145,43.26769],[20.88685,43.21697],[20.83727,43.17842],[20.96287,43.12416],[21.00749,43.13984],[21.05378,43.10707],[21.08952,43.13471],[21.14465,43.11089],[21.16734,42.99694],[21.2041,43.02277],[21.23877,43.00848],[21.23534,42.95523],[21.2719,42.8994],[21.32974,42.90424],[21.36941,42.87397],[21.44047,42.87276],[21.39045,42.74888],[21.47498,42.74695],[21.59154,42.72643],[21.58755,42.70418],[21.6626,42.67813],[21.75025,42.70125],[21.79413,42.65923],[21.75672,42.62695],[21.7327,42.55041],[21.70522,42.54176],[21.7035,42.51899],[21.62556,42.45106],[21.64209,42.41081],[21.62887,42.37664],[21.59029,42.38042],[21.57021,42.3647],[21.53467,42.36809],[21.5264,42.33634],[21.56772,42.30946],[21.58992,42.25915],[21.70111,42.23789],[21.77176,42.2648],[21.84654,42.3247],[21.91595,42.30392],[21.94405,42.34669],[22.02908,42.29848],[22.16384,42.32103],[22.29605,42.37477],[22.29275,42.34913],[22.34773,42.31725],[22.45919,42.33822],[22.47498,42.3915],[22.51961,42.3991],[22.55669,42.50144],[22.43983,42.56851],[22.4997,42.74144],[22.43309,42.82057],[22.54302,42.87774],[22.74826,42.88701],[22.78397,42.98253],[22.89521,43.03625],[22.98104,43.11199],[23.00806,43.19279],[22.89727,43.22417],[22.82036,43.33665],[22.53397,43.47225],[22.47582,43.6558],[22.41043,43.69566],[22.35558,43.81281],[22.41449,44.00514],[22.61688,44.06534],[22.61711,44.16938],[22.67173,44.21564],[22.68166,44.28206],[22.56012,44.30712],[22.45436,44.47258],[22.54021,44.47836],[22.56493,44.53419],[22.61368,44.55719],[22.70981,44.51852],[22.76749,44.54446],[22.69196,44.61587],[22.61917,44.61489],[22.45301,44.7194],[22.30844,44.6619],[22.18315,44.48179],[22.13234,44.47444],[22.08016,44.49844],[21.99364,44.63395],[21.7795,44.66165],[21.71692,44.65349],[21.67504,44.67107],[21.61942,44.67059],[21.60019,44.75208],[21.55007,44.77304],[21.38802,44.78133],[21.35643,44.86364],[21.44013,44.87613],[21.48202,44.87199],[21.56328,44.89502],[21.54938,44.9327],[21.35855,45.01941],[21.4505,45.04294],[21.51299,45.15345],[21.48278,45.19557],[21.29398,45.24148],[21.20392,45.2677],[21.17612,45.32566],[21.09894,45.30144],[20.87948,45.42743],[20.86026,45.47295],[20.77217,45.49788],[20.83321,45.53567],[20.76798,45.60969],[20.80361,45.65875],[20.82364,45.77738],[20.78446,45.78522],[20.77416,45.75601],[20.70069,45.7493],[20.65645,45.82801],[20.54818,45.89939],[20.35862,45.99356],[20.26068,46.12332],[20.09713,46.17315],[20.03533,46.14509],[20.01816,46.17696],[19.93508,46.17553],[19.81491,46.1313],[19.66007,46.19005]]]]}},{type:"Feature",properties:{iso1A2:"RU",iso1A3:"RUS",iso1N3:"643",wikidata:"Q159",nameEn:"Russia"},geometry:null},{type:"Feature",properties:{iso1A2:"RW",iso1A3:"RWA",iso1N3:"646",wikidata:"Q1037",nameEn:"Rwanda",groups:["014","202","002","UN"],callingCodes:["250"]},geometry:{type:"MultiPolygon",coordinates:[[[[30.47194,-1.0555],[30.35212,-1.06896],[30.16369,-1.34303],[29.912,-1.48269],[29.82657,-1.31187],[29.59061,-1.39016],[29.53062,-1.40499],[29.45038,-1.5054],[29.36322,-1.50887],[29.24323,-1.66826],[29.24458,-1.69663],[29.11847,-1.90576],[29.17562,-2.12278],[29.105,-2.27043],[29.00051,-2.29001],[28.95642,-2.37321],[28.89601,-2.37321],[28.86826,-2.41888],[28.86846,-2.44866],[28.89132,-2.47557],[28.89342,-2.49017],[28.88846,-2.50493],[28.87497,-2.50887],[28.86209,-2.5231],[28.86193,-2.53185],[28.87943,-2.55165],[28.89288,-2.55848],[28.90226,-2.62385],[28.89793,-2.66111],[28.94346,-2.69124],[29.00357,-2.70596],[29.04081,-2.7416],[29.0562,-2.58632],[29.32234,-2.6483],[29.36805,-2.82933],[29.88237,-2.75105],[29.95911,-2.33348],[30.14034,-2.43626],[30.42933,-2.31064],[30.54501,-2.41404],[30.83915,-2.35795],[30.89303,-2.08223],[30.80802,-1.91477],[30.84079,-1.64652],[30.71974,-1.43244],[30.57123,-1.33264],[30.50889,-1.16412],[30.45116,-1.10641],[30.47194,-1.0555]]]]}},{type:"Feature",properties:{iso1A2:"SA",iso1A3:"SAU",iso1N3:"682",wikidata:"Q851",nameEn:"Saudi Arabia",groups:["145","142","UN"],callingCodes:["966"]},geometry:{type:"MultiPolygon",coordinates:[[[[40.01521,32.05667],[39.29903,32.23259],[38.99233,31.99721],[36.99791,31.50081],[37.99354,30.49998],[37.66395,30.33245],[37.4971,29.99949],[36.75083,29.86903],[36.50005,29.49696],[36.07081,29.18469],[34.8812,29.36878],[34.4454,27.91479],[37.8565,22.00903],[39.63762,18.37348],[40.99158,15.81743],[42.15205,16.40211],[42.76801,16.40371],[42.94625,16.39721],[42.94351,16.49467],[42.97215,16.51093],[43.11601,16.53166],[43.15274,16.67248],[43.22066,16.65179],[43.21325,16.74416],[43.25857,16.75304],[43.26303,16.79479],[43.24801,16.80613],[43.22956,16.80613],[43.22012,16.83932],[43.18338,16.84852],[43.1398,16.90696],[43.19328,16.94703],[43.1813,16.98438],[43.18233,17.02673],[43.23967,17.03428],[43.17787,17.14717],[43.20156,17.25901],[43.32653,17.31179],[43.22533,17.38343],[43.29185,17.53224],[43.43005,17.56148],[43.70631,17.35762],[44.50126,17.47475],[46.31018,17.20464],[46.76494,17.29151],[47.00571,16.94765],[47.48245,17.10808],[47.58351,17.50366],[48.19996,18.20584],[49.04884,18.59899],[52.00311,19.00083],[54.99756,20.00083],[55.66469,21.99658],[55.2137,22.71065],[55.13599,22.63334],[52.56622,22.94341],[51.59617,24.12041],[51.58871,24.27256],[51.41644,24.39615],[51.58834,24.66608],[51.39468,24.62785],[51.29972,24.50747],[51.09638,24.46907],[50.92992,24.54396],[50.8133,24.74049],[50.57069,25.57887],[50.302,25.87592],[50.26923,26.08243],[50.38162,26.53976],[50.71771,26.73086],[50.37726,27.89227],[49.98877,27.87827],[49.00421,28.81495],[48.42991,28.53628],[47.70561,28.5221],[47.59863,28.66798],[47.58376,28.83382],[47.46202,29.0014],[46.5527,29.10283],[46.42415,29.05947],[44.72255,29.19736],[42.97796,30.48295],[42.97601,30.72204],[40.01521,32.05667]]]]}},{type:"Feature",properties:{iso1A2:"SB",iso1A3:"SLB",iso1N3:"090",wikidata:"Q685",nameEn:"Solomon Islands",groups:["054","009","UN"],driveSide:"left",callingCodes:["677"]},geometry:{type:"MultiPolygon",coordinates:[[[[172.71443,-12.01327],[160.43769,-4.17974],[156.03296,-6.55528],[156.03993,-6.65703],[155.92557,-6.84664],[155.69784,-6.92661],[155.60735,-6.92266],[154.74815,-7.33315],[156.73836,-14.50464],[172.71443,-12.01327]]]]}},{type:"Feature",properties:{iso1A2:"SC",iso1A3:"SYC",iso1N3:"690",wikidata:"Q1042",nameEn:"Seychelles",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["248"]},geometry:{type:"MultiPolygon",coordinates:[[[[43.75112,-10.38913],[54.83239,-10.93575],[66.3222,5.65313],[43.75112,-10.38913]]]]}},{type:"Feature",properties:{iso1A2:"SD",iso1A3:"SDN",iso1N3:"729",wikidata:"Q1049",nameEn:"Sudan",groups:["015","002","UN"],callingCodes:["249"]},geometry:{type:"MultiPolygon",coordinates:[[[[37.8565,22.00903],[34.0765,22.00501],[33.99686,21.76784],[33.57251,21.72406],[33.17563,22.00405],[24.99885,21.99535],[24.99794,19.99661],[23.99715,20.00038],[23.99539,19.49944],[23.99997,15.69575],[23.62785,15.7804],[23.38812,15.69649],[23.10792,15.71297],[22.93201,15.55107],[22.92579,15.47007],[22.99584,15.40105],[22.99584,15.22989],[22.66115,14.86308],[22.70474,14.69149],[22.38562,14.58907],[22.44944,14.24986],[22.55997,14.23024],[22.5553,14.11704],[22.22995,13.96754],[22.08674,13.77863],[22.29689,13.3731],[22.1599,13.19281],[22.02914,13.13976],[21.94819,13.05637],[21.81432,12.81362],[21.89371,12.68001],[21.98711,12.63292],[22.15679,12.66634],[22.22684,12.74682],[22.46345,12.61925],[22.38873,12.45514],[22.50548,12.16769],[22.48369,12.02766],[22.64092,12.07485],[22.54907,11.64372],[22.7997,11.40424],[22.93124,11.41645],[22.97249,11.21955],[22.87758,10.91915],[23.02221,10.69235],[23.3128,10.45214],[23.67164,9.86923],[23.69155,9.67566],[24.09319,9.66572],[24.12744,9.73784],[24.49389,9.79962],[24.84653,9.80643],[24.97739,9.9081],[25.05688,10.06776],[25.0918,10.33718],[25.78141,10.42599],[25.93163,10.38159],[25.93241,10.17941],[26.21338,9.91545],[26.35815,9.57946],[26.70685,9.48735],[27.14427,9.62858],[27.90704,9.61323],[28.99983,9.67155],[29.06988,9.74826],[29.53844,9.75133],[29.54,10.07949],[29.94629,10.29245],[30.00389,10.28633],[30.53005,9.95992],[30.82893,9.71451],[30.84605,9.7498],[31.28504,9.75287],[31.77539,10.28939],[31.99177,10.65065],[32.46967,11.04662],[32.39358,11.18207],[32.39578,11.70208],[32.10079,11.95203],[32.73921,11.95203],[32.73921,12.22757],[33.25876,12.22111],[33.13988,11.43248],[33.26977,10.83632],[33.24645,10.77913],[33.52294,10.64382],[33.66604,10.44254],[33.80913,10.32994],[33.90159,10.17179],[33.96984,10.15446],[33.99185,9.99623],[33.96323,9.80972],[33.9082,9.762],[33.87958,9.49937],[34.10229,9.50238],[34.08717,9.55243],[34.13186,9.7492],[34.20484,9.9033],[34.22718,10.02506],[34.32102,10.11599],[34.34783,10.23914],[34.2823,10.53508],[34.4372,10.781],[34.59062,10.89072],[34.77383,10.74588],[34.77532,10.69027],[34.86618,10.74588],[34.86916,10.78832],[34.97491,10.86147],[34.97789,10.91559],[34.93172,10.95946],[35.01215,11.19626],[34.95704,11.24448],[35.09556,11.56278],[35.05832,11.71158],[35.11492,11.85156],[35.24302,11.91132],[35.70476,12.67101],[36.01458,12.72478],[36.14268,12.70879],[36.16651,12.88019],[36.13374,12.92665],[36.24545,13.36759],[36.38993,13.56459],[36.48824,13.83954],[36.44653,13.95666],[36.54376,14.25597],[36.44337,15.14963],[36.54276,15.23478],[36.69761,15.75323],[36.76371,15.80831],[36.92193,16.23451],[36.99777,17.07172],[37.42694,17.04041],[37.50967,17.32199],[38.13362,17.53906],[38.37133,17.66269],[38.45916,17.87167],[38.57727,17.98125],[39.63762,18.37348],[37.8565,22.00903]]]]}},{type:"Feature",properties:{iso1A2:"SE",iso1A3:"SWE",iso1N3:"752",wikidata:"Q34",nameEn:"Sweden",groups:["EU","154","150","UN"],callingCodes:["46"]},geometry:{type:"MultiPolygon",coordinates:[[[[24.15791,65.85385],[23.90497,66.15802],[23.71339,66.21299],[23.64982,66.30603],[23.67591,66.3862],[23.63776,66.43568],[23.85959,66.56434],[23.89488,66.772],[23.98059,66.79585],[23.98563,66.84149],[23.56214,67.17038],[23.58735,67.20752],[23.54701,67.25435],[23.75372,67.29914],[23.75372,67.43688],[23.39577,67.46974],[23.54701,67.59306],[23.45627,67.85297],[23.65793,67.9497],[23.40081,68.05545],[23.26469,68.15134],[23.15377,68.14759],[23.10336,68.26551],[22.73028,68.40881],[22.00429,68.50692],[21.03001,68.88969],[20.90649,68.89696],[20.85104,68.93142],[20.91658,68.96764],[20.78802,69.03087],[20.55258,69.06069],[20.0695,69.04469],[20.28444,68.93283],[20.33435,68.80174],[20.22027,68.67246],[19.95647,68.55546],[20.22027,68.48759],[19.93508,68.35911],[18.97255,68.52416],[18.63032,68.50849],[18.39503,68.58672],[18.1241,68.53721],[18.13836,68.20874],[17.90787,67.96537],[17.30416,68.11591],[16.7409,67.91037],[16.38441,67.52923],[16.12774,67.52106],[16.09922,67.4364],[16.39154,67.21653],[16.35589,67.06419],[15.37197,66.48217],[15.49318,66.28509],[15.05113,66.15572],[14.53778,66.12399],[14.50926,65.31786],[13.64276,64.58402],[14.11117,64.46674],[14.16051,64.18725],[13.98222,64.00953],[13.23411,64.09087],[12.74105,64.02171],[12.14928,63.59373],[12.19919,63.47935],[11.98529,63.27487],[12.19919,63.00104],[12.07085,62.6297],[12.29187,62.25699],[12.14746,61.7147],[12.40595,61.57226],[12.57707,61.56547],[12.86939,61.35427],[12.69115,61.06584],[12.2277,61.02442],[12.59133,60.50559],[12.52003,60.13846],[12.36317,59.99259],[12.15641,59.8926],[11.87121,59.86039],[11.92112,59.69531],[11.69297,59.59442],[11.8213,59.24985],[11.65732,58.90177],[11.45199,58.89604],[11.4601,58.99022],[11.34459,59.11672],[11.15367,59.07862],[11.08911,58.98745],[10.64958,58.89391],[10.40861,58.38489],[12.16597,56.60205],[12.07466,56.29488],[12.65312,56.04345],[12.6372,55.91371],[12.88472,55.63369],[12.60345,55.42675],[12.84405,55.13257],[14.28399,55.1553],[14.89259,55.5623],[15.79951,55.54655],[19.64795,57.06466],[19.84909,57.57876],[20.5104,59.15546],[19.08191,60.19152],[19.23413,60.61414],[20.15877,63.06556],[24.14112,65.39731],[24.15107,65.81427],[24.14798,65.83466],[24.15791,65.85385]]]]}},{type:"Feature",properties:{iso1A2:"SG",iso1A3:"SGP",iso1N3:"702",wikidata:"Q334",nameEn:"Singapore",groups:["035","142","UN"],driveSide:"left",callingCodes:["65"]},geometry:{type:"MultiPolygon",coordinates:[[[[104.00131,1.42405],[103.93384,1.42926],[103.89565,1.42841],[103.86383,1.46288],[103.81181,1.47953],[103.76395,1.45183],[103.74161,1.4502],[103.7219,1.46108],[103.67468,1.43166],[103.62738,1.35255],[103.56591,1.19719],[103.66049,1.18825],[103.74084,1.12902],[104.03085,1.26954],[104.12282,1.27714],[104.08072,1.35998],[104.09162,1.39694],[104.08871,1.42015],[104.07348,1.43322],[104.04622,1.44691],[104.02277,1.4438],[104.00131,1.42405]]]]}},{type:"Feature",properties:{iso1A2:"SH",iso1A3:"SHN",iso1N3:"654",wikidata:"Q192184",nameEn:"Saint Helena, Ascension and Tristan da Cunha",country:"GB"},geometry:null},{type:"Feature",properties:{iso1A2:"SI",iso1A3:"SVN",iso1N3:"705",wikidata:"Q215",nameEn:"Slovenia",groups:["EU","039","150","UN"],callingCodes:["386"]},geometry:{type:"MultiPolygon",coordinates:[[[[16.50139,46.56684],[16.39217,46.63673],[16.38594,46.6549],[16.41863,46.66238],[16.42641,46.69228],[16.37816,46.69975],[16.30966,46.7787],[16.31303,46.79838],[16.3408,46.80641],[16.34547,46.83836],[16.2941,46.87137],[16.2365,46.87775],[16.21892,46.86961],[16.15711,46.85434],[16.14365,46.8547],[16.10983,46.867],[16.05786,46.83927],[15.99054,46.82772],[15.99126,46.78199],[15.98432,46.74991],[15.99769,46.7266],[16.02808,46.71094],[16.04347,46.68694],[16.04036,46.6549],[15.99988,46.67947],[15.98512,46.68463],[15.94864,46.68769],[15.87691,46.7211],[15.8162,46.71897],[15.78518,46.70712],[15.76771,46.69863],[15.73823,46.70011],[15.72279,46.69548],[15.69523,46.69823],[15.67411,46.70735],[15.6543,46.70616],[15.6543,46.69228],[15.6365,46.6894],[15.63255,46.68069],[15.62317,46.67947],[15.59826,46.68908],[15.54533,46.66985],[15.55333,46.64988],[15.54431,46.6312],[15.46906,46.61321],[15.45514,46.63697],[15.41235,46.65556],[15.23711,46.63994],[15.14215,46.66131],[15.01451,46.641],[14.98024,46.6009],[14.96002,46.63459],[14.92283,46.60848],[14.87129,46.61],[14.86419,46.59411],[14.83549,46.56614],[14.81836,46.51046],[14.72185,46.49974],[14.66892,46.44936],[14.5942,46.43434],[14.56463,46.37208],[14.52176,46.42617],[14.45877,46.41717],[14.42608,46.44614],[14.314,46.43327],[14.28326,46.44315],[14.15989,46.43327],[14.12097,46.47724],[14.04002,46.49117],[14.00422,46.48474],[13.89837,46.52331],[13.7148,46.5222],[13.68684,46.43881],[13.59777,46.44137],[13.5763,46.42613],[13.5763,46.40915],[13.47019,46.3621],[13.43418,46.35992],[13.44808,46.33507],[13.37671,46.29668],[13.42218,46.20758],[13.47587,46.22725],[13.56114,46.2054],[13.56682,46.18703],[13.64451,46.18966],[13.66472,46.17392],[13.64053,46.13587],[13.57072,46.09022],[13.50104,46.05986],[13.49568,46.04839],[13.50998,46.04498],[13.49702,46.01832],[13.47474,46.00546],[13.50104,45.98078],[13.52963,45.96588],[13.56759,45.96991],[13.58903,45.99009],[13.62074,45.98388],[13.63458,45.98947],[13.64307,45.98326],[13.6329,45.94894],[13.63815,45.93607],[13.61931,45.91782],[13.60857,45.89907],[13.59565,45.89446],[13.58644,45.88173],[13.57563,45.8425],[13.58858,45.83503],[13.59784,45.8072],[13.66986,45.79955],[13.8235,45.7176],[13.83332,45.70855],[13.83422,45.68703],[13.87933,45.65207],[13.9191,45.6322],[13.8695,45.60835],[13.86771,45.59898],[13.84106,45.58185],[13.78445,45.5825],[13.74587,45.59811],[13.7198,45.59352],[13.6076,45.64761],[13.45644,45.59464],[13.56979,45.4895],[13.62902,45.45898],[13.67398,45.4436],[13.7785,45.46787],[13.81742,45.43729],[13.88124,45.42637],[13.90771,45.45149],[13.97309,45.45258],[13.99488,45.47551],[13.96063,45.50825],[14.00578,45.52352],[14.07116,45.48752],[14.20348,45.46896],[14.22371,45.50388],[14.24239,45.50607],[14.26611,45.48239],[14.27681,45.4902],[14.32487,45.47142],[14.36693,45.48642],[14.49769,45.54424],[14.5008,45.60852],[14.53816,45.6205],[14.57397,45.67165],[14.60977,45.66403],[14.59576,45.62812],[14.69694,45.57366],[14.68605,45.53006],[14.71718,45.53442],[14.80124,45.49515],[14.81992,45.45913],[14.90554,45.47769],[14.92266,45.52788],[15.02385,45.48533],[15.05187,45.49079],[15.16862,45.42309],[15.27758,45.46678],[15.33051,45.45258],[15.38188,45.48752],[15.30249,45.53224],[15.29837,45.5841],[15.27747,45.60504],[15.31027,45.6303],[15.34695,45.63382],[15.34214,45.64702],[15.38952,45.63682],[15.4057,45.64727],[15.34919,45.71623],[15.30872,45.69014],[15.25423,45.72275],[15.40836,45.79491],[15.47531,45.79802],[15.47325,45.8253],[15.52234,45.82195],[15.57952,45.84953],[15.64185,45.82915],[15.66662,45.84085],[15.70411,45.8465],[15.68232,45.86819],[15.68383,45.88867],[15.67967,45.90455],[15.70636,45.92116],[15.70327,46.00015],[15.71246,46.01196],[15.72977,46.04682],[15.62317,46.09103],[15.6083,46.11992],[15.59909,46.14761],[15.64904,46.19229],[15.6434,46.21396],[15.67395,46.22478],[15.75436,46.21969],[15.75479,46.20336],[15.78817,46.21719],[15.79284,46.25811],[15.97965,46.30652],[16.07616,46.3463],[16.07314,46.36458],[16.05065,46.3833],[16.05281,46.39141],[16.14859,46.40547],[16.18824,46.38282],[16.30233,46.37837],[16.30162,46.40437],[16.27329,46.41467],[16.27398,46.42875],[16.25124,46.48067],[16.23961,46.49653],[16.26759,46.50566],[16.26733,46.51505],[16.29793,46.5121],[16.37193,46.55008],[16.38771,46.53608],[16.44036,46.5171],[16.5007,46.49644],[16.52604,46.47831],[16.59527,46.47524],[16.52604,46.5051],[16.52885,46.53303],[16.50139,46.56684]]]]}},{type:"Feature",properties:{iso1A2:"SJ",iso1A3:"SJM",iso1N3:"744",wikidata:"Q842829",nameEn:"Svalbard and Jan Mayen",country:"NO"},geometry:null},{type:"Feature",properties:{iso1A2:"SK",iso1A3:"SVK",iso1N3:"703",wikidata:"Q214",nameEn:"Slovakia",groups:["EU","151","150","UN"],callingCodes:["421"]},geometry:{type:"MultiPolygon",coordinates:[[[[19.82237,49.27806],[19.78581,49.41701],[19.72127,49.39288],[19.6375,49.40897],[19.64162,49.45184],[19.57845,49.46077],[19.53313,49.52856],[19.52626,49.57311],[19.45348,49.61583],[19.37795,49.574],[19.36009,49.53747],[19.25435,49.53391],[19.18019,49.41165],[18.9742,49.39557],[18.97283,49.49914],[18.94536,49.52143],[18.84521,49.51672],[18.74761,49.492],[18.67757,49.50895],[18.6144,49.49824],[18.57183,49.51162],[18.53063,49.49022],[18.54848,49.47059],[18.44686,49.39467],[18.4084,49.40003],[18.4139,49.36517],[18.36446,49.3267],[18.18456,49.28909],[18.15022,49.24518],[18.1104,49.08624],[18.06885,49.03157],[17.91814,49.01784],[17.87831,48.92679],[17.77944,48.92318],[17.73126,48.87885],[17.7094,48.86721],[17.5295,48.81117],[17.45671,48.85004],[17.3853,48.80936],[17.29054,48.85546],[17.19355,48.87602],[17.11202,48.82925],[17.00215,48.70887],[16.93955,48.60371],[16.94611,48.53614],[16.85204,48.44968],[16.8497,48.38321],[16.83588,48.3844],[16.83317,48.38138],[16.84243,48.35258],[16.90903,48.32519],[16.89461,48.31332],[16.97701,48.17385],[17.02919,48.13996],[17.05735,48.14179],[17.09168,48.09366],[17.07039,48.0317],[17.16001,48.00636],[17.23699,48.02094],[17.71215,47.7548],[18.02938,47.75665],[18.29305,47.73541],[18.56496,47.76588],[18.66521,47.76772],[18.74074,47.8157],[18.8506,47.82308],[18.76821,47.87469],[18.76134,47.97499],[18.82176,48.04206],[19.01952,48.07052],[19.23924,48.0595],[19.28182,48.08336],[19.47957,48.09437],[19.52489,48.19791],[19.63338,48.25006],[19.92452,48.1283],[20.24312,48.2784],[20.29943,48.26104],[20.5215,48.53336],[20.83248,48.5824],[21.11516,48.49546],[21.44063,48.58456],[21.6068,48.50365],[21.67134,48.3989],[21.72525,48.34628],[21.8279,48.33321],[21.83339,48.36242],[22.14689,48.4005],[22.16023,48.56548],[22.21379,48.6218],[22.34151,48.68893],[22.42934,48.92857],[22.48296,48.99172],[22.54338,49.01424],[22.56155,49.08865],[22.04427,49.22136],[21.96385,49.3437],[21.82927,49.39467],[21.77983,49.35443],[21.62328,49.4447],[21.43376,49.41433],[21.27858,49.45988],[21.19756,49.4054],[21.12477,49.43666],[21.041,49.41791],[21.09799,49.37176],[20.98733,49.30774],[20.9229,49.29626],[20.77971,49.35383],[20.72274,49.41813],[20.61666,49.41791],[20.5631,49.375],[20.46422,49.41612],[20.39939,49.3896],[20.31728,49.39914],[20.31453,49.34817],[20.21977,49.35265],[20.13738,49.31685],[20.08238,49.1813],[19.98494,49.22904],[19.90529,49.23532],[19.86409,49.19316],[19.75286,49.20751],[19.82237,49.27806]]]]}},{type:"Feature",properties:{iso1A2:"SL",iso1A3:"SLE",iso1N3:"694",wikidata:"Q1044",nameEn:"Sierra Leone",groups:["011","202","002","UN"],callingCodes:["232"]},geometry:{type:"MultiPolygon",coordinates:[[[[-10.27575,8.48711],[-10.37257,8.48941],[-10.54891,8.31174],[-10.63934,8.35326],[-10.70565,8.29235],[-10.61422,8.5314],[-10.47707,8.67669],[-10.56197,8.81225],[-10.5783,9.06386],[-10.74484,9.07998],[-10.6534,9.29919],[-11.2118,10.00098],[-11.89624,9.99763],[-11.91023,9.93927],[-12.12634,9.87203],[-12.24262,9.92386],[-12.47254,9.86834],[-12.76788,9.3133],[-12.94095,9.26335],[-13.08953,9.0409],[-13.18586,9.0925],[-13.29911,9.04245],[-14.36218,8.64107],[-12.15048,6.15992],[-11.50429,6.92704],[-11.4027,6.97746],[-11.29417,7.21576],[-10.60422,7.7739],[-10.60492,8.04072],[-10.57523,8.04829],[-10.51554,8.1393],[-10.45023,8.15627],[-10.35227,8.15223],[-10.29839,8.21283],[-10.31635,8.28554],[-10.30084,8.30008],[-10.27575,8.48711]]]]}},{type:"Feature",properties:{iso1A2:"SM",iso1A3:"SMR",iso1N3:"674",wikidata:"Q238",nameEn:"San Marino",groups:["039","150","UN"],callingCodes:["378"]},geometry:{type:"MultiPolygon",coordinates:[[[[12.45648,43.89369],[12.48771,43.89706],[12.49429,43.90973],[12.49247,43.91774],[12.49724,43.92248],[12.50269,43.92363],[12.50496,43.93017],[12.51553,43.94096],[12.51427,43.94897],[12.50655,43.95796],[12.50875,43.96198],[12.50622,43.97131],[12.51109,43.97201],[12.51064,43.98165],[12.5154,43.98508],[12.51463,43.99122],[12.50678,43.99113],[12.49406,43.98492],[12.47853,43.98052],[12.46205,43.97463],[12.44684,43.96597],[12.43662,43.95698],[12.42005,43.9578],[12.41414,43.95273],[12.40415,43.95485],[12.40506,43.94325],[12.41165,43.93769],[12.41551,43.92984],[12.40733,43.92379],[12.41233,43.90956],[12.40935,43.9024],[12.41641,43.89991],[12.44184,43.90498],[12.45648,43.89369]]]]}},{type:"Feature",properties:{iso1A2:"SN",iso1A3:"SEN",iso1N3:"686",wikidata:"Q1041",nameEn:"Senegal",groups:["011","202","002","UN"],callingCodes:["221"]},geometry:{type:"MultiPolygon",coordinates:[[[[-14.32144,16.61495],[-15.00557,16.64997],[-15.6509,16.50315],[-16.27016,16.51565],[-16.4429,16.20605],[-16.44814,16.09753],[-16.48967,16.0496],[-16.50854,16.09032],[-17.15288,16.07139],[-18.35085,14.63444],[-17.43598,13.59273],[-15.47902,13.58758],[-15.36504,13.79313],[-14.93719,13.80173],[-14.34721,13.46578],[-13.8955,13.59126],[-13.79409,13.34472],[-14.36795,13.23033],[-15.14917,13.57989],[-15.26908,13.37768],[-15.80478,13.34832],[-15.80355,13.16729],[-16.69343,13.16791],[-16.74676,13.06025],[-17.43966,13.04579],[-17.4623,11.92379],[-16.70562,12.34803],[-16.38191,12.36449],[-16.20591,12.46157],[-15.67302,12.42974],[-15.17582,12.6847],[-13.70523,12.68013],[-13.05296,12.64003],[-13.06603,12.49342],[-12.87336,12.51892],[-12.35415,12.32758],[-11.91331,12.42008],[-11.46267,12.44559],[-11.37536,12.40788],[-11.39935,12.97808],[-11.63025,13.39174],[-11.83345,13.33333],[-12.06897,13.71049],[-11.93043,13.84505],[-12.23936,14.76324],[-13.11029,15.52116],[-13.43135,16.09022],[-13.80075,16.13961],[-14.32144,16.61495]]]]}},{type:"Feature",properties:{iso1A2:"SO",iso1A3:"SOM",iso1N3:"706",wikidata:"Q1045",nameEn:"Somalia",groups:["014","202","002","UN"],callingCodes:["252"]},geometry:{type:"MultiPolygon",coordinates:[[[[51.12877,12.56479],[43.90659,12.3823],[42.95776,10.98533],[42.69452,10.62672],[42.87643,10.18441],[43.0937,9.90579],[43.23518,9.84605],[43.32613,9.59205],[44.19222,8.93028],[46.99339,7.9989],[47.92477,8.00111],[47.97917,8.00124],[44.98104,4.91821],[44.02436,4.9451],[43.40263,4.79289],[43.04177,4.57923],[42.97746,4.44032],[42.84526,4.28357],[42.55853,4.20518],[42.07619,4.17667],[41.89488,3.97375],[41.31368,3.14314],[40.98767,2.82959],[41.00099,-.83068],[41.56,-1.59812],[41.56362,-1.66375],[41.75542,-1.85308],[57.49095,8.14549],[51.12877,12.56479]]]]}},{type:"Feature",properties:{iso1A2:"SR",iso1A3:"SUR",iso1N3:"740",wikidata:"Q730",nameEn:"Suriname",groups:["005","419","019","UN"],driveSide:"left",callingCodes:["597"]},geometry:{type:"MultiPolygon",coordinates:[[[[-54.26916,5.26909],[-54.01877,5.52789],[-54.01074,5.68785],[-53.7094,6.2264],[-56.84822,6.73257],[-57.31629,5.33714],[-57.22536,5.15605],[-57.37442,5.0208],[-57.8699,4.89394],[-58.0307,3.95513],[-57.35891,3.32121],[-56.70519,2.02964],[-56.55439,2.02003],[-56.47045,1.95135],[-55.99278,1.83137],[-55.89863,1.89861],[-55.92159,2.05236],[-56.13054,2.27723],[-55.96292,2.53188],[-55.71493,2.40342],[-55.01919,2.564],[-54.6084,2.32856],[-54.42864,2.42442],[-54.28534,2.67798],[-53.9849,3.58697],[-53.98914,3.627],[-54.05128,3.63557],[-54.19367,3.84387],[-54.38444,4.13222],[-54.4717,4.91964],[-54.26916,5.26909]]]]}},{type:"Feature",properties:{iso1A2:"SS",iso1A3:"SSD",iso1N3:"728",wikidata:"Q958",nameEn:"South Sudan",groups:["014","202","002","UN"],callingCodes:["211"]},geometry:{type:"MultiPolygon",coordinates:[[[[34.10229,9.50238],[33.87958,9.49937],[33.9082,9.762],[33.96323,9.80972],[33.99185,9.99623],[33.96984,10.15446],[33.90159,10.17179],[33.80913,10.32994],[33.66604,10.44254],[33.52294,10.64382],[33.24645,10.77913],[33.26977,10.83632],[33.13988,11.43248],[33.25876,12.22111],[32.73921,12.22757],[32.73921,11.95203],[32.10079,11.95203],[32.39578,11.70208],[32.39358,11.18207],[32.46967,11.04662],[31.99177,10.65065],[31.77539,10.28939],[31.28504,9.75287],[30.84605,9.7498],[30.82893,9.71451],[30.53005,9.95992],[30.00389,10.28633],[29.94629,10.29245],[29.54,10.07949],[29.53844,9.75133],[29.06988,9.74826],[28.99983,9.67155],[27.90704,9.61323],[27.14427,9.62858],[26.70685,9.48735],[26.35815,9.57946],[26.21338,9.91545],[25.93241,10.17941],[25.93163,10.38159],[25.78141,10.42599],[25.0918,10.33718],[25.05688,10.06776],[24.97739,9.9081],[24.84653,9.80643],[24.49389,9.79962],[24.12744,9.73784],[24.09319,9.66572],[23.69155,9.67566],[23.62179,9.53823],[23.64981,9.44303],[23.64358,9.28637],[23.56263,9.19418],[23.4848,9.16959],[23.44744,8.99128],[23.59065,8.99743],[23.51905,8.71749],[24.25691,8.69288],[24.13238,8.36959],[24.35965,8.26177],[24.85156,8.16933],[24.98855,7.96588],[25.25319,7.8487],[25.29214,7.66675],[25.20649,7.61115],[25.20337,7.50312],[25.35281,7.42595],[25.37461,7.33024],[25.90076,7.09549],[26.38022,6.63493],[26.32729,6.36272],[26.58259,6.1987],[26.51721,6.09655],[27.22705,5.71254],[27.22705,5.62889],[27.28621,5.56382],[27.23017,5.37167],[27.26886,5.25876],[27.44012,5.07349],[27.56656,4.89375],[27.65462,4.89375],[27.76469,4.79284],[27.79551,4.59976],[28.20719,4.35614],[28.6651,4.42638],[28.8126,4.48784],[29.03054,4.48784],[29.22207,4.34297],[29.43341,4.50101],[29.49726,4.7007],[29.82087,4.56246],[29.79666,4.37809],[30.06964,4.13221],[30.1621,4.10586],[30.22374,3.93896],[30.27658,3.95653],[30.47691,3.83353],[30.55396,3.84451],[30.57378,3.74567],[30.56277,3.62703],[30.78512,3.67097],[30.80713,3.60506],[30.85997,3.5743],[30.85153,3.48867],[30.97601,3.693],[31.16666,3.79853],[31.29476,3.8015],[31.50478,3.67814],[31.50776,3.63652],[31.72075,3.74354],[31.81459,3.82083],[31.86821,3.78664],[31.96205,3.6499],[31.95907,3.57408],[32.05187,3.589],[32.08491,3.56287],[32.08866,3.53543],[32.19888,3.50867],[32.20782,3.6053],[32.41337,3.748],[32.72021,3.77327],[32.89746,3.81339],[33.02852,3.89296],[33.18356,3.77812],[33.51264,3.75068],[33.9873,4.23316],[34.47601,4.72162],[35.34151,5.02364],[35.30992,4.90402],[35.47843,4.91872],[35.42366,4.76969],[35.51424,4.61643],[35.9419,4.61933],[35.82118,4.77382],[35.81968,5.10757],[35.8576,5.33413],[35.50792,5.42431],[35.29938,5.34042],[35.31188,5.50106],[35.13058,5.62118],[35.12611,5.68937],[35.00546,5.89387],[34.96227,6.26415],[35.01738,6.46991],[34.87736,6.60161],[34.77459,6.5957],[34.65096,6.72589],[34.53776,6.74808],[34.53925,6.82794],[34.47669,6.91076],[34.35753,6.91963],[34.19369,7.04382],[34.19369,7.12807],[34.01495,7.25664],[34.03878,7.27437],[34.02984,7.36449],[33.87642,7.5491],[33.71407,7.65983],[33.44745,7.7543],[33.32531,7.71297],[33.24637,7.77939],[33.04944,7.78989],[33.0006,7.90333],[33.08401,8.05822],[33.18083,8.13047],[33.1853,8.29264],[33.19721,8.40317],[33.3119,8.45474],[33.54575,8.47094],[33.66938,8.44442],[33.71407,8.3678],[33.87195,8.41938],[33.89579,8.4842],[34.01346,8.50041],[34.14453,8.60204],[34.14304,9.04654],[34.10229,9.50238]]]]}},{type:"Feature",properties:{iso1A2:"ST",iso1A3:"STP",iso1N3:"678",wikidata:"Q1039",nameEn:"S\xE3o Tom\xE9 and Principe",groups:["017","202","002","UN"],callingCodes:["239"]},geometry:{type:"MultiPolygon",coordinates:[[[[4.34149,1.91417],[6.6507,-.28606],[7.9035,1.92304],[4.34149,1.91417]]]]}},{type:"Feature",properties:{iso1A2:"SV",iso1A3:"SLV",iso1N3:"222",wikidata:"Q792",nameEn:"El Salvador",groups:["013","003","419","019","UN"],callingCodes:["503"]},geometry:{type:"MultiPolygon",coordinates:[[[[-89.34776,14.43013],[-89.39028,14.44561],[-89.57441,14.41637],[-89.58814,14.33165],[-89.50614,14.26084],[-89.52397,14.22628],[-89.61844,14.21937],[-89.70756,14.1537],[-89.75569,14.07073],[-89.73251,14.04133],[-89.76103,14.02923],[-89.81807,14.07073],[-89.88937,14.0396],[-90.10505,13.85104],[-90.11344,13.73679],[-90.55276,12.8866],[-88.11443,12.63306],[-87.7346,13.13228],[-87.55124,13.12523],[-87.69751,13.25228],[-87.73714,13.32715],[-87.80177,13.35689],[-87.84675,13.41078],[-87.83467,13.44655],[-87.77354,13.45767],[-87.73841,13.44169],[-87.72115,13.46083],[-87.71657,13.50577],[-87.78148,13.52906],[-87.73106,13.75443],[-87.68821,13.80829],[-87.7966,13.91353],[-88.00331,13.86948],[-88.07641,13.98447],[-88.23018,13.99915],[-88.25791,13.91108],[-88.48982,13.86458],[-88.49738,13.97224],[-88.70661,14.04317],[-88.73182,14.10919],[-88.815,14.11652],[-88.85785,14.17763],[-88.94608,14.20207],[-89.04187,14.33644],[-89.34776,14.43013]]]]}},{type:"Feature",properties:{iso1A2:"SX",iso1A3:"SXM",iso1N3:"534",wikidata:"Q26273",nameEn:"Sint Maarten",aliases:["NL-SX"],country:"NL",groups:["Q1451600","029","003","419","019","UN"],callingCodes:["1 721"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.33064,17.9615],[-63.1055,17.86651],[-62.93924,18.02904],[-63.02323,18.05757],[-63.04039,18.05619],[-63.0579,18.06614],[-63.07759,18.04943],[-63.09686,18.04608],[-63.11042,18.05339],[-63.13502,18.05445],[-63.33064,17.9615]]]]}},{type:"Feature",properties:{iso1A2:"SY",iso1A3:"SYR",iso1N3:"760",wikidata:"Q858",nameEn:"Syria",groups:["145","142","UN"],callingCodes:["963"]},geometry:{type:"MultiPolygon",coordinates:[[[[42.23683,37.2863],[42.21548,37.28026],[42.20454,37.28715],[42.22381,37.30238],[42.22257,37.31395],[42.2112,37.32491],[42.19301,37.31323],[42.18225,37.28569],[42.00894,37.17209],[41.515,37.08084],[41.21937,37.07665],[40.90856,37.13147],[40.69136,37.0996],[39.81589,36.75538],[39.21538,36.66834],[39.03217,36.70911],[38.74042,36.70629],[38.55908,36.84429],[38.38859,36.90064],[38.21064,36.91842],[37.81974,36.76055],[37.68048,36.75065],[37.49103,36.66904],[37.47253,36.63243],[37.21988,36.6736],[37.16177,36.66069],[37.10894,36.6704],[37.08279,36.63495],[37.02088,36.66422],[37.01647,36.69512],[37.04619,36.71101],[37.04399,36.73483],[36.99886,36.74012],[36.99557,36.75997],[36.66727,36.82901],[36.61581,36.74629],[36.62681,36.71189],[36.57398,36.65186],[36.58829,36.58295],[36.54206,36.49539],[36.6081,36.33772],[36.65653,36.33861],[36.68672,36.23677],[36.6125,36.22592],[36.50463,36.2419],[36.4617,36.20461],[36.39206,36.22088],[36.37474,36.01163],[36.33956,35.98687],[36.30099,36.00985],[36.28338,36.00273],[36.29769,35.96086],[36.27678,35.94839],[36.25366,35.96264],[36.19973,35.95195],[36.17441,35.92076],[36.1623,35.80925],[36.14029,35.81015],[36.13919,35.83692],[36.11827,35.85923],[35.99829,35.88242],[36.01844,35.92403],[36.00514,35.94113],[35.98499,35.94107],[35.931,35.92109],[35.51152,36.10954],[35.48515,34.70851],[35.97386,34.63322],[35.98718,34.64977],[36.29165,34.62991],[36.32399,34.69334],[36.35135,34.68516],[36.35384,34.65447],[36.42941,34.62505],[36.46003,34.6378],[36.45299,34.59438],[36.41429,34.61175],[36.39846,34.55672],[36.3369,34.52629],[36.34745,34.5002],[36.4442,34.50165],[36.46179,34.46541],[36.55853,34.41609],[36.53039,34.3798],[36.56556,34.31881],[36.60778,34.31009],[36.58667,34.27667],[36.59195,34.2316],[36.62537,34.20251],[36.5128,34.09916],[36.50576,34.05982],[36.41078,34.05253],[36.28589,33.91981],[36.38263,33.86579],[36.3967,33.83365],[36.14517,33.85118],[36.06778,33.82927],[35.9341,33.6596],[36.05723,33.57904],[35.94465,33.52774],[35.94816,33.47886],[35.88668,33.43183],[35.82577,33.40479],[35.81324,33.36354],[35.77477,33.33609],[35.813,33.3172],[35.77513,33.27342],[35.81295,33.24841],[35.81647,33.2028],[35.83846,33.19397],[35.84285,33.16673],[35.81911,33.1336],[35.81911,33.11077],[35.84802,33.1031],[35.87188,32.98028],[35.89298,32.9456],[35.87012,32.91976],[35.84021,32.8725],[35.83758,32.82817],[35.78745,32.77938],[35.75983,32.74803],[35.88405,32.71321],[35.93307,32.71966],[35.96633,32.66237],[36.02239,32.65911],[36.08074,32.51463],[36.20379,32.52751],[36.20875,32.49529],[36.23948,32.50108],[36.40959,32.37908],[36.83946,32.31293],[38.79171,33.37328],[40.64314,34.31604],[40.97676,34.39788],[41.12388,34.65742],[41.2345,34.80049],[41.21654,35.1508],[41.26569,35.42708],[41.38184,35.62502],[41.37027,35.84095],[41.2564,36.06012],[41.28864,36.35368],[41.40058,36.52502],[41.81736,36.58782],[42.36697,37.0627],[42.35724,37.10998],[42.32313,37.17814],[42.34735,37.22548],[42.2824,37.2798],[42.26039,37.27017],[42.23683,37.2863]]]]}},{type:"Feature",properties:{iso1A2:"SZ",iso1A3:"SWZ",iso1N3:"748",wikidata:"Q1050",nameEn:"Eswatini",aliases:["Swaziland"],groups:["018","202","002","UN"],driveSide:"left",callingCodes:["268"]},geometry:{type:"MultiPolygon",coordinates:[[[[31.86881,-25.99973],[31.4175,-25.71886],[31.31237,-25.7431],[31.13073,-25.91558],[30.95819,-26.26303],[30.78927,-26.48271],[30.81101,-26.84722],[30.88826,-26.79622],[30.97757,-26.92706],[30.96088,-27.0245],[31.15027,-27.20151],[31.49834,-27.31549],[31.97592,-27.31675],[31.97463,-27.11057],[32.00893,-26.8096],[32.09664,-26.80721],[32.13315,-26.84345],[32.13409,-26.5317],[32.07352,-26.40185],[32.10435,-26.15656],[32.08599,-26.00978],[32.00916,-25.999],[31.974,-25.95387],[31.86881,-25.99973]]]]}},{type:"Feature",properties:{iso1A2:"TA",iso1A3:"TAA",wikidata:"Q220982",nameEn:"Tristan da Cunha",aliases:["SH-TA"],country:"GB",groups:["SH","BOTS","011","202","002","UN"],isoStatus:"excRes",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["290 8","44 20"]},geometry:{type:"MultiPolygon",coordinates:[[[[-13.38232,-34.07258],[-16.67337,-41.9188],[-5.88482,-41.4829],[-13.38232,-34.07258]]]]}},{type:"Feature",properties:{iso1A2:"TC",iso1A3:"TCA",iso1N3:"796",wikidata:"Q18221",nameEn:"Turks and Caicos Islands",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 649"]},geometry:{type:"MultiPolygon",coordinates:[[[[-71.70065,25.7637],[-72.98446,20.4801],[-69.80718,21.35956],[-71.70065,25.7637]]]]}},{type:"Feature",properties:{iso1A2:"TD",iso1A3:"TCD",iso1N3:"148",wikidata:"Q657",nameEn:"Chad",groups:["017","202","002","UN"],callingCodes:["235"]},geometry:{type:"MultiPolygon",coordinates:[[[[23.99539,19.49944],[15.99566,23.49639],[14.99751,23.00539],[15.19692,21.99339],[15.20213,21.49365],[15.28332,21.44557],[15.62515,20.95395],[15.57248,20.92138],[15.55382,20.86507],[15.56004,20.79488],[15.59841,20.74039],[15.6721,20.70069],[15.99632,20.35364],[15.75098,19.93002],[15.6032,18.77402],[15.50373,16.89649],[14.37425,15.72591],[13.86301,15.04043],[13.78991,14.87519],[13.809,14.72915],[13.67878,14.64013],[13.68573,14.55276],[13.48259,14.46704],[13.47559,14.40881],[13.6302,13.71094],[14.08251,13.0797],[14.46881,13.08259],[14.56101,12.91036],[14.55058,12.78256],[14.83314,12.62963],[14.90827,12.3269],[14.89019,12.16593],[14.96952,12.0925],[15.00146,12.1223],[15.0349,12.10698],[15.05786,12.0608],[15.04808,11.8731],[15.11579,11.79313],[15.06595,11.71126],[15.13149,11.5537],[15.0585,11.40481],[15.10021,11.04101],[15.04957,11.02347],[15.09127,10.87431],[15.06737,10.80921],[15.15532,10.62846],[15.14936,10.53915],[15.23724,10.47764],[15.30874,10.31063],[15.50535,10.1098],[15.68761,9.99344],[15.41408,9.92876],[15.24618,9.99246],[15.14043,9.99246],[15.05999,9.94845],[14.95722,9.97926],[14.80082,9.93818],[14.4673,10.00264],[14.20411,10.00055],[14.1317,9.82413],[14.01793,9.73169],[13.97544,9.6365],[14.37094,9.2954],[14.35707,9.19611],[14.83566,8.80557],[15.09484,8.65982],[15.20426,8.50892],[15.50743,7.79302],[15.59272,7.7696],[15.56964,7.58936],[15.49743,7.52179],[15.73118,7.52006],[15.79942,7.44149],[16.40703,7.68809],[16.41583,7.77971],[16.58315,7.88657],[16.59415,7.76444],[16.658,7.75353],[16.6668,7.67281],[16.8143,7.53971],[17.67288,7.98905],[17.93926,7.95853],[18.02731,8.01085],[18.6085,8.05009],[18.64153,8.08714],[18.62612,8.14163],[18.67455,8.22226],[18.79783,8.25929],[19.11044,8.68172],[18.86388,8.87971],[19.06421,9.00367],[20.36748,9.11019],[20.82979,9.44696],[21.26348,9.97642],[21.34934,9.95907],[21.52766,10.2105],[21.63553,10.217],[21.71479,10.29932],[21.72139,10.64136],[22.45889,11.00246],[22.87758,10.91915],[22.97249,11.21955],[22.93124,11.41645],[22.7997,11.40424],[22.54907,11.64372],[22.64092,12.07485],[22.48369,12.02766],[22.50548,12.16769],[22.38873,12.45514],[22.46345,12.61925],[22.22684,12.74682],[22.15679,12.66634],[21.98711,12.63292],[21.89371,12.68001],[21.81432,12.81362],[21.94819,13.05637],[22.02914,13.13976],[22.1599,13.19281],[22.29689,13.3731],[22.08674,13.77863],[22.22995,13.96754],[22.5553,14.11704],[22.55997,14.23024],[22.44944,14.24986],[22.38562,14.58907],[22.70474,14.69149],[22.66115,14.86308],[22.99584,15.22989],[22.99584,15.40105],[22.92579,15.47007],[22.93201,15.55107],[23.10792,15.71297],[23.38812,15.69649],[23.62785,15.7804],[23.99997,15.69575],[23.99539,19.49944]]]]}},{type:"Feature",properties:{iso1A2:"TF",iso1A3:"ATF",iso1N3:"260",wikidata:"Q129003",nameEn:"French Southern Territories",country:"FR",groups:["EU","UN"]},geometry:null},{type:"Feature",properties:{iso1A2:"TG",iso1A3:"TGO",iso1N3:"768",wikidata:"Q945",nameEn:"Togo",groups:["011","202","002","UN"],callingCodes:["228"]},geometry:{type:"MultiPolygon",coordinates:[[[[.50388,11.01011],[-.13493,11.14075],[-.14462,11.10811],[-.05733,11.08628],[-.0275,11.11202],[-.00514,11.10763],[.00342,11.08317],[.02395,11.06229],[.03355,10.9807],[-.0063,10.96417],[-.00908,10.91644],[-.02685,10.8783],[-.0228,10.81916],[-.07183,10.76794],[-.07327,10.71845],[-.09141,10.7147],[-.05945,10.63458],[.12886,10.53149],[.18846,10.4096],[.29453,10.41546],[.33028,10.30408],[.39584,10.31112],[.35293,10.09412],[.41371,10.06361],[.41252,10.02018],[.36366,10.03309],[.32075,9.72781],[.34816,9.71607],[.34816,9.66907],[.32313,9.6491],[.28261,9.69022],[.26712,9.66437],[.29334,9.59387],[.36008,9.6256],[.38153,9.58682],[.23851,9.57389],[.2409,9.52335],[.30406,9.521],[.31241,9.50337],[.2254,9.47869],[.25758,9.42696],[.33148,9.44812],[.36485,9.49749],[.49118,9.48339],[.56388,9.40697],[.45424,9.04581],[.52455,8.87746],[.37319,8.75262],[.47211,8.59945],[.64731,8.48866],[.73432,8.29529],[.63897,8.25873],[.5913,8.19622],[.61156,8.18324],[.6056,8.13959],[.58891,8.12779],[.62943,7.85751],[.58295,7.62368],[.51979,7.58706],[.52455,7.45354],[.57223,7.39326],[.62943,7.41099],[.65327,7.31643],[.59606,7.01252],[.52217,6.9723],[.52098,6.94391],[.56508,6.92971],[.52853,6.82921],[.57406,6.80348],[.58176,6.76049],[.6497,6.73682],[.63659,6.63857],[.74862,6.56517],[.71048,6.53083],[.89283,6.33779],[.99652,6.33779],[1.03108,6.24064],[1.05969,6.22998],[1.09187,6.17074],[1.19966,6.17069],[1.19771,6.11522],[1.27574,5.93551],[1.67336,6.02702],[1.62913,6.24075],[1.79826,6.28221],[1.76906,6.43189],[1.58105,6.68619],[1.61812,6.74843],[1.55877,6.99737],[1.64249,6.99562],[1.61838,9.0527],[1.5649,9.16941],[1.41746,9.3226],[1.33675,9.54765],[1.36624,9.5951],[1.35507,9.99525],[.77666,10.37665],[.80358,10.71459],[.8804,10.803],[.91245,10.99597],[.66104,10.99964],[.4958,10.93269],[.50521,10.98035],[.48852,10.98561],[.50388,11.01011]]]]}},{type:"Feature",properties:{iso1A2:"TH",iso1A3:"THA",iso1N3:"764",wikidata:"Q869",nameEn:"Thailand",groups:["035","142","UN"],driveSide:"left",callingCodes:["66"]},geometry:{type:"MultiPolygon",coordinates:[[[[100.08404,20.36626],[99.95721,20.46301],[99.91616,20.44986],[99.90499,20.4487],[99.89692,20.44789],[99.89301,20.44311],[99.89168,20.44548],[99.88451,20.44596],[99.88211,20.44488],[99.86383,20.44371],[99.81096,20.33687],[99.68255,20.32077],[99.46008,20.39673],[99.46077,20.36198],[99.5569,20.20676],[99.52943,20.14811],[99.416,20.08614],[99.20328,20.12877],[99.0735,20.10298],[98.98679,19.7419],[98.83661,19.80931],[98.56065,19.67807],[98.51182,19.71303],[98.24884,19.67876],[98.13829,19.78541],[98.03314,19.80941],[98.04364,19.65755],[97.84715,19.55782],[97.88423,19.5041],[97.78769,19.39429],[97.84186,19.29526],[97.78606,19.26769],[97.84024,19.22217],[97.83479,19.09972],[97.73797,19.04261],[97.73654,18.9812],[97.66487,18.9371],[97.73836,18.88478],[97.76752,18.58097],[97.5258,18.4939],[97.36444,18.57138],[97.34522,18.54596],[97.50383,18.26844],[97.56219,18.33885],[97.64116,18.29778],[97.60841,18.23846],[97.73723,17.97912],[97.66794,17.88005],[97.76407,17.71595],[97.91829,17.54504],[98.11185,17.36829],[98.10439,17.33847],[98.34566,17.04822],[98.39441,17.06266],[98.52624,16.89979],[98.49603,16.8446],[98.53833,16.81934],[98.46994,16.73613],[98.50253,16.7139],[98.49713,16.69022],[98.51043,16.70107],[98.51579,16.69433],[98.51472,16.68521],[98.51833,16.676],[98.51113,16.64503],[98.5695,16.62826],[98.57912,16.55983],[98.63817,16.47424],[98.68074,16.27068],[98.84485,16.42354],[98.92656,16.36425],[98.8376,16.11706],[98.69585,16.13353],[98.57019,16.04578],[98.59853,15.87197],[98.541,15.65406],[98.58598,15.46821],[98.56027,15.33471],[98.4866,15.39154],[98.39351,15.34177],[98.41906,15.27103],[98.40522,15.25268],[98.30446,15.30667],[98.22,15.21327],[98.18821,15.13125],[98.24874,14.83013],[98.56762,14.37701],[98.97356,14.04868],[99.16695,13.72621],[99.20617,13.20575],[99.12225,13.19847],[99.10646,13.05804],[99.18748,12.9898],[99.18905,12.84799],[99.29254,12.68921],[99.409,12.60603],[99.47519,12.1353],[99.56445,12.14805],[99.53424,12.02317],[99.64891,11.82699],[99.64108,11.78948],[99.5672,11.62732],[99.47598,11.62434],[99.39485,11.3925],[99.31573,11.32081],[99.32756,11.28545],[99.06938,10.94857],[99.02337,10.97217],[98.99701,10.92962],[99.0069,10.85485],[98.86819,10.78336],[98.78511,10.68351],[98.77275,10.62548],[98.81944,10.52761],[98.7391,10.31488],[98.55174,9.92804],[98.52291,9.92389],[98.47298,9.95782],[98.33094,9.91973],[98.12555,9.44056],[97.63455,9.60854],[97.19814,8.18901],[99.31854,5.99868],[99.50117,6.44501],[99.91873,6.50233],[100.0756,6.4045],[100.12,6.42105],[100.19511,6.72559],[100.29651,6.68439],[100.30828,6.66462],[100.31618,6.66781],[100.31884,6.66423],[100.32671,6.66526],[100.32607,6.65933],[100.31929,6.65413],[100.35413,6.54932],[100.41152,6.52299],[100.41791,6.5189],[100.42351,6.51762],[100.43027,6.52389],[100.66986,6.45086],[100.74361,6.50811],[100.74822,6.46231],[100.81045,6.45086],[100.85884,6.24929],[101.10313,6.25617],[101.12618,6.19431],[101.06165,6.14161],[101.12388,6.11411],[101.087,5.9193],[101.02708,5.91013],[100.98815,5.79464],[101.14062,5.61613],[101.25755,5.71065],[101.25524,5.78633],[101.58019,5.93534],[101.69773,5.75881],[101.75074,5.79091],[101.80144,5.74505],[101.89188,5.8386],[101.91776,5.84269],[101.92819,5.85511],[101.94712,5.98421],[101.9714,6.00575],[101.97114,6.01992],[101.99209,6.04075],[102.01835,6.05407],[102.09182,6.14161],[102.07732,6.193],[102.08127,6.22679],[102.09086,6.23546],[102.46318,7.22462],[102.47649,9.66162],[102.52395,11.25257],[102.91449,11.65512],[102.90973,11.75613],[102.83957,11.8519],[102.78427,11.98746],[102.77026,12.06815],[102.70176,12.1686],[102.73134,12.37091],[102.78116,12.40284],[102.7796,12.43781],[102.57567,12.65358],[102.51963,12.66117],[102.4994,12.71736],[102.53053,12.77506],[102.49335,12.92711],[102.48694,12.97537],[102.52275,12.99813],[102.46011,13.08057],[102.43422,13.09061],[102.36146,13.26006],[102.36001,13.31142],[102.34611,13.35618],[102.35692,13.38274],[102.35563,13.47307],[102.361,13.50551],[102.33828,13.55613],[102.36859,13.57488],[102.44601,13.5637],[102.5358,13.56933],[102.57573,13.60461],[102.62483,13.60883],[102.58635,13.6286],[102.5481,13.6589],[102.56848,13.69366],[102.72727,13.77806],[102.77864,13.93374],[102.91251,14.01531],[102.93275,14.19044],[103.16469,14.33075],[103.39353,14.35639],[103.53518,14.42575],[103.71109,14.4348],[103.70175,14.38052],[103.93836,14.3398],[104.27616,14.39861],[104.55014,14.36091],[104.69335,14.42726],[104.97667,14.38806],[105.02804,14.23722],[105.08408,14.20402],[105.14012,14.23873],[105.17748,14.34432],[105.20894,14.34967],[105.43783,14.43865],[105.53864,14.55731],[105.5121,14.80802],[105.61162,15.00037],[105.46661,15.13132],[105.58043,15.32724],[105.50662,15.32054],[105.4692,15.33709],[105.47635,15.3796],[105.58191,15.41031],[105.60446,15.53301],[105.61756,15.68792],[105.46573,15.74742],[105.42285,15.76971],[105.37959,15.84074],[105.34115,15.92737],[105.38508,15.987],[105.42001,16.00657],[105.06204,16.09792],[105.00262,16.25627],[104.88057,16.37311],[104.73349,16.565],[104.76099,16.69302],[104.7397,16.81005],[104.76442,16.84752],[104.7373,16.91125],[104.73712,17.01404],[104.80716,17.19025],[104.80061,17.39367],[104.69867,17.53038],[104.45404,17.66788],[104.35432,17.82871],[104.2757,17.86139],[104.21776,17.99335],[104.10927,18.10826],[104.06533,18.21656],[103.97725,18.33631],[103.93916,18.33914],[103.85642,18.28666],[103.82449,18.33979],[103.699,18.34125],[103.60957,18.40528],[103.47773,18.42841],[103.41044,18.4486],[103.30977,18.4341],[103.24779,18.37807],[103.23818,18.34875],[103.29757,18.30475],[103.17093,18.2618],[103.14994,18.23172],[103.1493,18.17799],[103.07343,18.12351],[103.07823,18.03833],[103.0566,18.00144],[103.01998,17.97095],[102.9912,17.9949],[102.95812,18.0054],[102.86323,17.97531],[102.81988,17.94233],[102.79044,17.93612],[102.75954,17.89561],[102.68538,17.86653],[102.67543,17.84529],[102.69946,17.81686],[102.68194,17.80151],[102.59485,17.83537],[102.5896,17.84889],[102.61432,17.92273],[102.60971,17.95411],[102.59234,17.96127],[102.45523,17.97106],[102.11359,18.21532],[101.88485,18.02474],[101.78087,18.07559],[101.72294,17.92867],[101.44667,17.7392],[101.15108,17.47586],[100.96541,17.57926],[101.02185,17.87637],[101.1793,18.0544],[101.19118,18.2125],[101.15108,18.25624],[101.18227,18.34367],[101.06047,18.43247],[101.27585,18.68875],[101.22832,18.73377],[101.25803,18.89545],[101.35606,19.04716],[101.261,19.12717],[101.24911,19.33334],[101.20604,19.35296],[101.21347,19.46223],[101.26991,19.48324],[101.26545,19.59242],[101.08928,19.59748],[100.90302,19.61901],[100.77231,19.48324],[100.64606,19.55884],[100.58219,19.49164],[100.49604,19.53504],[100.398,19.75047],[100.5094,19.87904],[100.58808,20.15791],[100.55218,20.17741],[100.51052,20.14928],[100.47567,20.19133],[100.4537,20.19971],[100.44992,20.23644],[100.41473,20.25625],[100.37439,20.35156],[100.33383,20.4028],[100.25769,20.3992],[100.22076,20.31598],[100.16668,20.2986],[100.1712,20.24324],[100.11785,20.24787],[100.09337,20.26293],[100.09999,20.31614],[100.08404,20.36626]]]]}},{type:"Feature",properties:{iso1A2:"TJ",iso1A3:"TJK",iso1N3:"762",wikidata:"Q863",nameEn:"Tajikistan",groups:["143","142","UN"],callingCodes:["992"]},geometry:{type:"MultiPolygon",coordinates:[[[[70.45251,41.04438],[70.38028,41.02014],[70.36655,40.90296],[69.69434,40.62615],[69.59441,40.70181],[69.53021,40.77621],[69.38327,40.7918],[69.32834,40.70233],[69.3455,40.57988],[69.2643,40.57506],[69.21063,40.54469],[69.27066,40.49274],[69.28525,40.41894],[69.30774,40.36102],[69.33794,40.34819],[69.32833,40.29794],[69.30808,40.2821],[69.24817,40.30357],[69.25229,40.26362],[69.30104,40.24502],[69.30448,40.18774],[69.2074,40.21488],[69.15659,40.2162],[69.04544,40.22904],[68.85832,40.20885],[68.84357,40.18604],[68.79276,40.17555],[68.77902,40.20492],[68.5332,40.14826],[68.52771,40.11676],[68.62796,40.07789],[69.01523,40.15771],[69.01935,40.11466],[68.96579,40.06949],[68.84906,40.04952],[68.93695,39.91167],[68.88889,39.87163],[68.63071,39.85265],[68.61972,39.68905],[68.54166,39.53929],[68.12053,39.56317],[67.70992,39.66156],[67.62889,39.60234],[67.44899,39.57799],[67.46547,39.53564],[67.39681,39.52505],[67.46822,39.46146],[67.45998,39.315],[67.36522,39.31287],[67.33226,39.23739],[67.67833,39.14479],[67.68915,39.00775],[68.09704,39.02589],[68.19743,38.85985],[68.06948,38.82115],[68.12877,38.73677],[68.05598,38.71641],[68.0807,38.64136],[68.05873,38.56087],[68.11366,38.47169],[68.06274,38.39435],[68.13289,38.40822],[68.40343,38.19484],[68.27159,37.91477],[68.12635,37.93],[67.81566,37.43107],[67.8474,37.31594],[67.78329,37.1834],[67.7803,37.08978],[67.87917,37.0591],[68.02194,36.91923],[68.18542,37.02074],[68.27605,37.00977],[68.29253,37.10621],[68.41201,37.10402],[68.41888,37.13906],[68.61851,37.19815],[68.6798,37.27906],[68.81438,37.23862],[68.80889,37.32494],[68.91189,37.26704],[68.88168,37.33368],[68.96407,37.32603],[69.03274,37.25174],[69.25152,37.09426],[69.39529,37.16752],[69.45022,37.23315],[69.36645,37.40462],[69.44954,37.4869],[69.51888,37.5844],[69.80041,37.5746],[69.84435,37.60616],[69.93362,37.61378],[69.95971,37.5659],[70.15015,37.52519],[70.28243,37.66706],[70.27694,37.81258],[70.1863,37.84296],[70.17206,37.93276],[70.4898,38.12546],[70.54673,38.24541],[70.60407,38.28046],[70.61526,38.34774],[70.64966,38.34999],[70.69189,38.37031],[70.6761,38.39144],[70.67438,38.40597],[70.69807,38.41861],[70.72485,38.4131],[70.75455,38.4252],[70.77132,38.45548],[70.78581,38.45502],[70.78702,38.45031],[70.79766,38.44944],[70.80521,38.44447],[70.81697,38.44507],[70.82538,38.45394],[70.84376,38.44688],[70.88719,38.46826],[70.92728,38.43021],[70.98693,38.48862],[71.03545,38.44779],[71.0556,38.40176],[71.09542,38.42517],[71.10592,38.42077],[71.10957,38.40671],[71.1451,38.40106],[71.21291,38.32797],[71.33114,38.30339],[71.33869,38.27335],[71.37803,38.25641],[71.36444,38.15358],[71.29878,38.04429],[71.28922,38.01272],[71.27622,37.99946],[71.27278,37.96496],[71.24969,37.93031],[71.2809,37.91995],[71.296,37.93403],[71.32871,37.88564],[71.51565,37.95349],[71.58843,37.92425],[71.59255,37.79956],[71.55752,37.78677],[71.54324,37.77104],[71.53053,37.76534],[71.55234,37.73209],[71.54186,37.69691],[71.51972,37.61945],[71.5065,37.60912],[71.49693,37.53527],[71.50616,37.50733],[71.5256,37.47971],[71.49612,37.4279],[71.47685,37.40281],[71.4862,37.33405],[71.49821,37.31975],[71.50674,37.31502],[71.48536,37.26017],[71.4824,37.24921],[71.48339,37.23937],[71.47386,37.2269],[71.4555,37.21418],[71.4494,37.18137],[71.44127,37.11856],[71.43097,37.05855],[71.45578,37.03094],[71.46923,36.99925],[71.48481,36.93218],[71.51502,36.89128],[71.57195,36.74943],[71.67083,36.67346],[71.83229,36.68084],[72.31676,36.98115],[72.54095,37.00007],[72.66381,37.02014],[72.79693,37.22222],[73.06884,37.31729],[73.29633,37.46495],[73.77197,37.4417],[73.76647,37.33913],[73.61129,37.27469],[73.64974,37.23643],[73.82552,37.22659],[73.8564,37.26158],[74.20308,37.34208],[74.23339,37.41116],[74.41055,37.3948],[74.56161,37.37734],[74.68383,37.3948],[74.8294,37.3435],[74.88887,37.23275],[75.12328,37.31839],[75.09719,37.37297],[75.15899,37.41443],[75.06011,37.52779],[74.94338,37.55501],[74.8912,37.67576],[75.00935,37.77486],[74.92416,37.83428],[74.9063,38.03033],[74.82665,38.07359],[74.80331,38.19889],[74.69894,38.22155],[74.69619,38.42947],[74.51217,38.47034],[74.17022,38.65504],[73.97933,38.52945],[73.79806,38.61106],[73.80656,38.66449],[73.7033,38.84782],[73.7445,38.93867],[73.82964,38.91517],[73.81728,39.04007],[73.75823,39.023],[73.60638,39.24534],[73.54572,39.27567],[73.55396,39.3543],[73.5004,39.38402],[73.59241,39.40843],[73.59831,39.46425],[73.45096,39.46677],[73.31912,39.38615],[73.18454,39.35536],[72.85934,39.35116],[72.62027,39.39696],[72.33173,39.33093],[72.23834,39.17248],[72.17242,39.2661],[72.09689,39.26823],[72.04059,39.36704],[71.90601,39.27674],[71.79202,39.27355],[71.7522,39.32031],[71.80164,39.40631],[71.76816,39.45456],[71.62688,39.44056],[71.5517,39.45722],[71.55856,39.57588],[71.49814,39.61397],[71.08752,39.50704],[71.06418,39.41586],[70.7854,39.38933],[70.64087,39.58792],[70.44757,39.60128],[70.2869,39.53141],[70.11111,39.58223],[69.87491,39.53882],[69.68677,39.59281],[69.3594,39.52516],[69.26938,39.8127],[69.35649,40.01994],[69.43134,39.98431],[69.43557,39.92877],[69.53615,39.93991],[69.5057,40.03277],[69.53855,40.0887],[69.53794,40.11833],[69.55555,40.12296],[69.57615,40.10524],[69.64704,40.12165],[69.67001,40.10639],[70.01283,40.23288],[70.58297,40.00891],[70.57384,39.99394],[70.47557,39.93216],[70.55033,39.96619],[70.58912,39.95211],[70.65946,39.9878],[70.65827,40.0981],[70.7928,40.12797],[70.80495,40.16813],[70.9818,40.22392],[70.8607,40.217],[70.62342,40.17396],[70.56394,40.26421],[70.57149,40.3442],[70.37511,40.38605],[70.32626,40.45174],[70.49871,40.52503],[70.80009,40.72825],[70.45251,41.04438]]],[[[70.68112,40.90612],[70.6158,40.97661],[70.56077,41.00642],[70.54223,40.98787],[70.57501,40.98941],[70.6721,40.90555],[70.68112,40.90612]]],[[[70.74189,39.86319],[70.53651,39.89155],[70.52631,39.86989],[70.54998,39.85137],[70.59667,39.83542],[70.63105,39.77923],[70.74189,39.86319]]]]}},{type:"Feature",properties:{iso1A2:"TK",iso1A3:"TKL",iso1N3:"772",wikidata:"Q36823",nameEn:"Tokelau",country:"NZ",groups:["061","009","UN"],driveSide:"left",callingCodes:["690"]},geometry:{type:"MultiPolygon",coordinates:[[[[-168.251,-9.44289],[-174.18635,-7.80441],[-174.17993,-10.13616],[-168.251,-9.44289]]]]}},{type:"Feature",properties:{iso1A2:"TL",iso1A3:"TLS",iso1N3:"626",wikidata:"Q574",nameEn:"East Timor",aliases:["Timor-Leste","TP"],groups:["035","142","UN"],driveSide:"left",callingCodes:["670"]},geometry:{type:"MultiPolygon",coordinates:[[[[124.46701,-9.13002],[124.94011,-8.85617],[124.97742,-9.08128],[125.11764,-8.96359],[125.18632,-9.03142],[125.18907,-9.16434],[125.09434,-9.19669],[125.04044,-9.17093],[124.97892,-9.19281],[125.09025,-9.46406],[125.68138,-9.85176],[127.55165,-9.05052],[127.42116,-8.22471],[125.87691,-8.31789],[125.58506,-7.95311],[124.92337,-8.75859],[124.33472,-9.11416],[124.04628,-9.22671],[124.04286,-9.34243],[124.10539,-9.41206],[124.14517,-9.42324],[124.21247,-9.36904],[124.28115,-9.42189],[124.28115,-9.50453],[124.3535,-9.48493],[124.35258,-9.43002],[124.38554,-9.3582],[124.45971,-9.30263],[124.46701,-9.13002]]]]}},{type:"Feature",properties:{iso1A2:"TM",iso1A3:"TKM",iso1N3:"795",wikidata:"Q874",nameEn:"Turkmenistan",groups:["143","142","UN"],callingCodes:["993"]},geometry:{type:"MultiPolygon",coordinates:[[[[60.5078,41.21694],[60.06581,41.4363],[60.18117,41.60082],[60.06032,41.76287],[60.08504,41.80997],[60.33223,41.75058],[59.95046,41.97966],[60.0356,42.01028],[60.04659,42.08982],[59.96419,42.1428],[60.00539,42.212],[59.94633,42.27655],[59.4341,42.29738],[59.2955,42.37064],[59.17317,42.52248],[58.93422,42.5407],[58.6266,42.79314],[58.57991,42.64988],[58.27504,42.69632],[58.14321,42.62159],[58.29427,42.56497],[58.51674,42.30348],[58.40688,42.29535],[58.3492,42.43335],[57.99214,42.50021],[57.90975,42.4374],[57.92897,42.24047],[57.84932,42.18555],[57.6296,42.16519],[57.30275,42.14076],[57.03633,41.92043],[56.96218,41.80383],[57.03359,41.41777],[57.13796,41.36625],[57.03423,41.25435],[56.00314,41.32584],[55.45471,41.25609],[54.95182,41.92424],[54.20635,42.38477],[52.97575,42.1308],[52.47884,41.78034],[52.26048,41.69249],[51.7708,40.29239],[53.89734,37.3464],[54.24565,37.32047],[54.36211,37.34912],[54.58664,37.45809],[54.67247,37.43532],[54.77822,37.51597],[54.81804,37.61285],[54.77684,37.62264],[54.851,37.75739],[55.13412,37.94705],[55.44152,38.08564],[55.76561,38.12238],[55.97847,38.08024],[56.33278,38.08132],[56.32454,38.18502],[56.43303,38.26054],[56.62255,38.24005],[56.73928,38.27887],[57.03453,38.18717],[57.21169,38.28965],[57.37236,38.09321],[57.35042,37.98546],[57.79534,37.89299],[58.21399,37.77281],[58.22999,37.6856],[58.39959,37.63134],[58.47786,37.6433],[58.5479,37.70526],[58.6921,37.64548],[58.9338,37.67374],[59.22905,37.51161],[59.33507,37.53146],[59.39797,37.47892],[59.39385,37.34257],[59.55178,37.13594],[59.74678,37.12499],[60.00768,37.04102],[60.34767,36.63214],[61.14516,36.64644],[61.18187,36.55348],[61.1393,36.38782],[61.22719,36.12759],[61.12007,35.95992],[61.22444,35.92879],[61.26152,35.80749],[61.22719,35.67038],[61.27371,35.61482],[61.58742,35.43803],[61.77693,35.41341],[61.97743,35.4604],[62.05709,35.43803],[62.15871,35.33278],[62.29191,35.25964],[62.29878,35.13312],[62.48006,35.28796],[62.62288,35.22067],[62.74098,35.25432],[62.90853,35.37086],[63.0898,35.43131],[63.12276,35.53196],[63.10079,35.63024],[63.23262,35.67487],[63.10318,35.81782],[63.12276,35.86208],[63.29579,35.85985],[63.53475,35.90881],[63.56496,35.95106],[63.98519,36.03773],[64.05385,36.10433],[64.43288,36.24401],[64.57295,36.34362],[64.62514,36.44311],[64.61141,36.6351],[64.97945,37.21913],[65.51778,37.23881],[65.64263,37.34388],[65.64137,37.45061],[65.72274,37.55438],[66.30993,37.32409],[66.55743,37.35409],[66.52303,37.39827],[66.65761,37.45497],[66.52852,37.58568],[66.53676,37.80084],[66.67684,37.96776],[66.56697,38.0435],[66.41042,38.02403],[66.24013,38.16238],[65.83913,38.25733],[65.55873,38.29052],[64.32576,38.98691],[64.19086,38.95561],[63.70778,39.22349],[63.6913,39.27666],[62.43337,39.98528],[62.34273,40.43206],[62.11751,40.58242],[61.87856,41.12257],[61.4446,41.29407],[61.39732,41.19873],[61.33199,41.14946],[61.22212,41.14946],[61.03261,41.25691],[60.5078,41.21694]]]]}},{type:"Feature",properties:{iso1A2:"TN",iso1A3:"TUN",iso1N3:"788",wikidata:"Q948",nameEn:"Tunisia",groups:["015","002","UN"],callingCodes:["216"]},geometry:{type:"MultiPolygon",coordinates:[[[[11.2718,37.6713],[7.89009,38.19924],[8.59123,37.14286],[8.64044,36.9401],[8.62972,36.86499],[8.67706,36.8364],[8.57613,36.78062],[8.46537,36.7706],[8.47609,36.66607],[8.16167,36.48817],[8.18936,36.44939],[8.40731,36.42208],[8.2626,35.91733],[8.26472,35.73669],[8.35371,35.66373],[8.36086,35.47774],[8.30329,35.29884],[8.47318,35.23376],[8.3555,35.10007],[8.30727,34.95378],[8.25189,34.92009],[8.29655,34.72798],[8.20482,34.57575],[7.86264,34.3987],[7.81242,34.21841],[7.74207,34.16492],[7.66174,34.20167],[7.52851,34.06493],[7.54088,33.7726],[7.73687,33.42114],[7.83028,33.18851],[8.11433,33.10175],[8.1179,33.05086],[8.31895,32.83483],[8.35999,32.50101],[9.07483,32.07865],[9.55544,30.23971],[9.76848,30.34366],[9.88152,30.34074],[10.29516,30.90337],[10.12239,31.42098],[10.31364,31.72648],[10.48497,31.72956],[10.62788,31.96629],[10.7315,31.97235],[11.04234,32.2145],[11.53898,32.4138],[11.57828,32.48013],[11.46037,32.6307],[11.51549,33.09826],[11.55852,33.1409],[11.58941,33.36891],[11.2718,37.6713]]]]}},{type:"Feature",properties:{iso1A2:"TO",iso1A3:"TON",iso1N3:"776",wikidata:"Q678",nameEn:"Tonga",groups:["061","009","UN"],driveSide:"left",callingCodes:["676"]},geometry:{type:"MultiPolygon",coordinates:[[[[-176.74538,-22.89767],[-180,-22.90585],[-180,-24.21376],[-173.10761,-24.19665],[-173.13438,-14.94228],[-176.76826,-14.95183],[-176.74538,-22.89767]]]]}},{type:"Feature",properties:{iso1A2:"TR",iso1A3:"TUR",iso1N3:"792",wikidata:"Q43",nameEn:"Turkey",groups:["145","142","UN"],callingCodes:["90"]},geometry:{type:"MultiPolygon",coordinates:[[[[41.54366,41.52185],[40.89217,41.72528],[34.8305,42.4581],[28.32297,41.98371],[28.02971,41.98066],[27.91479,41.97902],[27.83492,41.99709],[27.81235,41.94803],[27.69949,41.97515],[27.55191,41.90928],[27.52379,41.93756],[27.45478,41.96591],[27.27411,42.10409],[27.22376,42.10152],[27.19251,42.06028],[27.08486,42.08735],[27.03277,42.0809],[26.95638,42.00741],[26.79143,41.97386],[26.62996,41.97644],[26.56051,41.92995],[26.57961,41.90024],[26.53968,41.82653],[26.36952,41.82265],[26.33589,41.76802],[26.32952,41.73637],[26.35957,41.71149],[26.47958,41.67037],[26.5209,41.62592],[26.59196,41.60491],[26.59742,41.48058],[26.61767,41.42281],[26.62997,41.34613],[26.5837,41.32131],[26.5209,41.33993],[26.39861,41.25053],[26.32259,41.24929],[26.31928,41.07386],[26.3606,41.02027],[26.33297,40.98388],[26.35894,40.94292],[26.32259,40.94042],[26.28623,40.93005],[26.29441,40.89119],[26.26169,40.9168],[26.20856,40.86048],[26.21351,40.83298],[26.15685,40.80709],[26.12854,40.77339],[26.12495,40.74283],[26.08638,40.73214],[26.0754,40.72772],[26.03489,40.73051],[25.94795,40.72797],[26.04292,40.3958],[25.61285,40.17161],[25.94257,39.39358],[26.43357,39.43096],[26.70773,39.0312],[26.61814,38.81372],[26.21136,38.65436],[26.32173,38.48731],[26.24183,38.44695],[26.21136,38.17558],[27.05537,37.9131],[27.16428,37.72343],[26.99377,37.69034],[26.95583,37.64989],[27.14757,37.32],[27.20312,36.94571],[27.45627,36.9008],[27.24613,36.71622],[27.46117,36.53789],[27.89482,36.69898],[27.95037,36.46155],[28.23708,36.56812],[29.30783,36.01033],[29.48192,36.18377],[29.61002,36.1731],[29.61805,36.14179],[29.69611,36.10365],[29.73302,35.92555],[32.82353,35.70297],[35.51152,36.10954],[35.931,35.92109],[35.98499,35.94107],[36.00514,35.94113],[36.01844,35.92403],[35.99829,35.88242],[36.11827,35.85923],[36.13919,35.83692],[36.14029,35.81015],[36.1623,35.80925],[36.17441,35.92076],[36.19973,35.95195],[36.25366,35.96264],[36.27678,35.94839],[36.29769,35.96086],[36.28338,36.00273],[36.30099,36.00985],[36.33956,35.98687],[36.37474,36.01163],[36.39206,36.22088],[36.4617,36.20461],[36.50463,36.2419],[36.6125,36.22592],[36.68672,36.23677],[36.65653,36.33861],[36.6081,36.33772],[36.54206,36.49539],[36.58829,36.58295],[36.57398,36.65186],[36.62681,36.71189],[36.61581,36.74629],[36.66727,36.82901],[36.99557,36.75997],[36.99886,36.74012],[37.04399,36.73483],[37.04619,36.71101],[37.01647,36.69512],[37.02088,36.66422],[37.08279,36.63495],[37.10894,36.6704],[37.16177,36.66069],[37.21988,36.6736],[37.47253,36.63243],[37.49103,36.66904],[37.68048,36.75065],[37.81974,36.76055],[38.21064,36.91842],[38.38859,36.90064],[38.55908,36.84429],[38.74042,36.70629],[39.03217,36.70911],[39.21538,36.66834],[39.81589,36.75538],[40.69136,37.0996],[40.90856,37.13147],[41.21937,37.07665],[41.515,37.08084],[42.00894,37.17209],[42.18225,37.28569],[42.19301,37.31323],[42.2112,37.32491],[42.22257,37.31395],[42.22381,37.30238],[42.20454,37.28715],[42.21548,37.28026],[42.23683,37.2863],[42.26039,37.27017],[42.2824,37.2798],[42.34735,37.22548],[42.32313,37.17814],[42.35724,37.10998],[42.56725,37.14878],[42.78887,37.38615],[42.93705,37.32015],[43.11403,37.37436],[43.30083,37.30629],[43.33508,37.33105],[43.50787,37.24436],[43.56702,37.25675],[43.63085,37.21957],[43.7009,37.23692],[43.8052,37.22825],[43.82699,37.19477],[43.84878,37.22205],[43.90949,37.22453],[44.02002,37.33229],[44.13521,37.32486],[44.2613,37.25055],[44.27998,37.16501],[44.22239,37.15756],[44.18503,37.09551],[44.25975,36.98119],[44.30645,36.97373],[44.35937,37.02843],[44.35315,37.04955],[44.38117,37.05825],[44.42631,37.05825],[44.63179,37.19229],[44.76698,37.16162],[44.78319,37.1431],[44.7868,37.16644],[44.75986,37.21549],[44.81021,37.2915],[44.58449,37.45018],[44.61401,37.60165],[44.56887,37.6429],[44.62096,37.71985],[44.55498,37.783],[44.45948,37.77065],[44.3883,37.85433],[44.22509,37.88859],[44.42476,38.25763],[44.50115,38.33939],[44.44386,38.38295],[44.38309,38.36117],[44.3119,38.37887],[44.3207,38.49799],[44.32058,38.62752],[44.28065,38.6465],[44.26155,38.71427],[44.30322,38.81581],[44.18863,38.93881],[44.20946,39.13975],[44.1043,39.19842],[44.03667,39.39223],[44.22452,39.4169],[44.29818,39.378],[44.37921,39.4131],[44.42832,39.4131],[44.41849,39.56659],[44.48111,39.61579],[44.47298,39.68788],[44.6137,39.78393],[44.65422,39.72163],[44.71806,39.71124],[44.81043,39.62677],[44.80977,39.65768],[44.75779,39.7148],[44.61845,39.8281],[44.46635,39.97733],[44.26973,40.04866],[44.1778,40.02845],[44.1057,40.03555],[43.92307,40.01787],[43.65688,40.11199],[43.65221,40.14889],[43.71136,40.16673],[43.59928,40.34019],[43.60862,40.43267],[43.54791,40.47413],[43.63664,40.54159],[43.7425,40.66805],[43.74872,40.7365],[43.67712,40.84846],[43.67712,40.93084],[43.58683,40.98961],[43.47319,41.02251],[43.44984,41.0988],[43.4717,41.12611],[43.44973,41.17666],[43.36118,41.2028],[43.23096,41.17536],[43.1945,41.25242],[43.13373,41.25503],[43.21707,41.30331],[43.02956,41.37891],[42.8785,41.50516],[42.84899,41.47265],[42.78995,41.50126],[42.84471,41.58912],[42.72794,41.59714],[42.59202,41.58183],[42.51772,41.43606],[42.26387,41.49346],[41.95134,41.52466],[41.81939,41.43621],[41.7124,41.47417],[41.7148,41.4932],[41.54366,41.52185]]]]}},{type:"Feature",properties:{iso1A2:"TT",iso1A3:"TTO",iso1N3:"780",wikidata:"Q754",nameEn:"Trinidad and Tobago",groups:["029","003","419","019","UN"],driveSide:"left",callingCodes:["1 868"]},geometry:{type:"MultiPolygon",coordinates:[[[[-61.62505,11.18974],[-62.08693,10.04435],[-60.89962,9.81445],[-60.07172,11.77667],[-61.62505,11.18974]]]]}},{type:"Feature",properties:{iso1A2:"TV",iso1A3:"TUV",iso1N3:"798",wikidata:"Q672",nameEn:"Tuvalu",groups:["061","009","UN"],driveSide:"left",callingCodes:["688"]},geometry:{type:"MultiPolygon",coordinates:[[[[174,-5],[174,-11.5],[179.99999,-11.5],[179.99999,-5],[174,-5]]]]}},{type:"Feature",properties:{iso1A2:"TW",iso1A3:"TWN",iso1N3:"158",wikidata:"Q865",nameEn:"Taiwan",aliases:["RC"],groups:["030","142"],callingCodes:["886"]},geometry:{type:"MultiPolygon",coordinates:[[[[121.8109,21.77688],[122.26612,25.98197],[120.5128,26.536],[120.0693,26.3959],[119.78816,26.2348],[119.98511,25.37624],[119.42295,25.0886],[118.6333,24.46259],[118.42453,24.54644],[118.35291,24.51645],[118.28244,24.51231],[118.11703,24.39734],[120.69238,21.52331],[121.8109,21.77688]]]]}},{type:"Feature",properties:{iso1A2:"TZ",iso1A3:"TZA",iso1N3:"834",wikidata:"Q924",nameEn:"Tanzania",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["255"]},geometry:{type:"MultiPolygon",coordinates:[[[[30.80408,-.99911],[30.76635,-.9852],[30.70631,-1.01175],[30.64166,-1.06601],[30.47194,-1.0555],[30.45116,-1.10641],[30.50889,-1.16412],[30.57123,-1.33264],[30.71974,-1.43244],[30.84079,-1.64652],[30.80802,-1.91477],[30.89303,-2.08223],[30.83915,-2.35795],[30.54501,-2.41404],[30.41789,-2.66266],[30.52747,-2.65841],[30.40662,-2.86151],[30.4987,-2.9573],[30.57926,-2.89791],[30.6675,-2.98987],[30.83823,-2.97837],[30.84165,-3.25152],[30.45915,-3.56532],[30.22042,-4.01738],[30.03323,-4.26631],[29.88172,-4.35743],[29.82885,-4.36153],[29.77289,-4.41733],[29.75109,-4.45836],[29.63827,-4.44681],[29.43673,-4.44845],[29.52552,-6.2731],[30.2567,-7.14121],[30.79243,-8.27382],[31.00796,-8.58615],[31.37533,-8.60769],[31.57147,-8.70619],[31.57147,-8.81388],[31.71158,-8.91386],[31.81587,-8.88618],[31.94663,-8.93846],[31.94196,-9.02303],[31.98866,-9.07069],[32.08206,-9.04609],[32.16146,-9.05993],[32.25486,-9.13371],[32.43543,-9.11988],[32.49147,-9.14754],[32.53661,-9.24281],[32.75611,-9.28583],[32.76233,-9.31963],[32.95389,-9.40138],[32.99397,-9.36712],[33.14925,-9.49322],[33.31581,-9.48554],[33.48052,-9.62442],[33.76677,-9.58516],[33.93298,-9.71647],[33.9638,-9.62206],[33.95829,-9.54066],[34.03865,-9.49398],[34.54499,-10.0678],[34.51911,-10.12279],[34.57581,-10.56271],[34.65946,-10.6828],[34.67047,-10.93796],[34.61161,-11.01611],[34.63305,-11.11731],[34.79375,-11.32245],[34.91153,-11.39799],[34.96296,-11.57354],[35.63599,-11.55927],[35.82767,-11.41081],[36.19094,-11.57593],[36.19094,-11.70008],[36.62068,-11.72884],[36.80309,-11.56836],[37.3936,-11.68949],[37.76614,-11.53352],[37.8388,-11.3123],[37.93618,-11.26228],[38.21598,-11.27289],[38.47258,-11.4199],[38.88996,-11.16978],[39.24395,-11.17433],[39.58249,-10.96043],[40.00295,-10.80255],[40.44265,-10.4618],[40.74206,-10.25691],[40.14328,-4.64201],[39.62121,-4.68136],[39.44306,-4.93877],[39.21631,-4.67835],[37.81321,-3.69179],[37.75036,-3.54243],[37.63099,-3.50723],[37.5903,-3.42735],[37.71745,-3.304],[37.67199,-3.06222],[34.0824,-1.02264],[34.03084,-1.05101],[34.02286,-1.00779],[33.93107,-.99298],[30.80408,-.99911]]]]}},{type:"Feature",properties:{iso1A2:"UA",iso1A3:"UKR",iso1N3:"804",wikidata:"Q212",nameEn:"Ukraine",groups:["151","150","UN"],callingCodes:["380"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.57318,46.10317],[33.61467,46.13561],[33.63854,46.14147],[33.61517,46.22615],[33.646,46.23028],[33.74047,46.18555],[33.79715,46.20482],[33.85234,46.19863],[33.91549,46.15938],[34.05272,46.10838],[34.07311,46.11769],[34.12929,46.10494],[34.181,46.06804],[34.25111,46.0532],[34.33912,46.06114],[34.41221,46.00245],[34.44155,45.95995],[34.48729,45.94267],[34.52011,45.95097],[34.55889,45.99347],[34.60861,45.99347],[34.66679,45.97136],[34.75479,45.90705],[34.80153,45.90047],[34.79905,45.81009],[34.96015,45.75634],[35.23066,45.79231],[37.62608,46.82615],[38.12112,46.86078],[38.3384,46.98085],[38.22955,47.12069],[38.23049,47.2324],[38.32112,47.2585],[38.33074,47.30508],[38.22225,47.30788],[38.28954,47.39255],[38.28679,47.53552],[38.35062,47.61631],[38.76379,47.69346],[38.79628,47.81109],[38.87979,47.87719],[39.73935,47.82876],[39.82213,47.96396],[39.77544,48.04206],[39.88256,48.04482],[39.83724,48.06501],[39.94847,48.22811],[40.00752,48.22445],[39.99241,48.31768],[39.97325,48.31399],[39.9693,48.29904],[39.95248,48.29972],[39.91465,48.26743],[39.90041,48.3049],[39.84273,48.30947],[39.84136,48.33321],[39.94847,48.35055],[39.88794,48.44226],[39.86196,48.46633],[39.84548,48.57821],[39.79764,48.58668],[39.67226,48.59368],[39.71765,48.68673],[39.73104,48.7325],[39.79466,48.83739],[39.97182,48.79398],[40.08168,48.87443],[40.03636,48.91957],[39.98967,48.86901],[39.78368,48.91596],[39.74874,48.98675],[39.72649,48.9754],[39.71353,48.98959],[39.6683,48.99454],[39.6836,49.05121],[39.93437,49.05709],[40.01988,49.1761],[40.22176,49.25683],[40.18331,49.34996],[40.14912,49.37681],[40.1141,49.38798],[40.03087,49.45452],[40.03636,49.52321],[40.16683,49.56865],[40.13249,49.61672],[39.84548,49.56064],[39.65047,49.61761],[39.59142,49.73758],[39.44496,49.76067],[39.27968,49.75976],[39.1808,49.88911],[38.9391,49.79524],[38.90477,49.86787],[38.73311,49.90238],[38.68677,50.00904],[38.65688,49.97176],[38.35408,50.00664],[38.32524,50.08866],[38.18517,50.08161],[38.21675,49.98104],[38.02999,49.90592],[38.02999,49.94482],[37.90776,50.04194],[37.79515,50.08425],[37.75807,50.07896],[37.61113,50.21976],[37.62879,50.24481],[37.62486,50.29966],[37.47243,50.36277],[37.48204,50.46079],[37.08468,50.34935],[36.91762,50.34963],[36.69377,50.26982],[36.64571,50.218],[36.56655,50.2413],[36.58371,50.28563],[36.47817,50.31457],[36.30101,50.29088],[36.20763,50.3943],[36.06893,50.45205],[35.8926,50.43829],[35.80388,50.41356],[35.73659,50.35489],[35.61711,50.35707],[35.58003,50.45117],[35.47463,50.49247],[35.39464,50.64751],[35.48116,50.66405],[35.47704,50.77274],[35.41367,50.80227],[35.39307,50.92145],[35.32598,50.94524],[35.40837,51.04119],[35.31774,51.08434],[35.20375,51.04723],[35.12685,51.16191],[35.14058,51.23162],[34.97304,51.2342],[34.82472,51.17483],[34.6874,51.18],[34.6613,51.25053],[34.38802,51.2746],[34.31661,51.23936],[34.23009,51.26429],[34.33446,51.363],[34.22048,51.4187],[34.30562,51.5205],[34.17599,51.63253],[34.07765,51.67065],[34.42922,51.72852],[34.41136,51.82793],[34.09413,52.00835],[34.11199,52.14087],[34.05239,52.20132],[33.78789,52.37204],[33.55718,52.30324],[33.48027,52.31499],[33.51323,52.35779],[33.18913,52.3754],[32.89937,52.2461],[32.85405,52.27888],[32.69475,52.25535],[32.54781,52.32423],[32.3528,52.32842],[32.38988,52.24946],[32.33083,52.23685],[32.34044,52.1434],[32.2777,52.10266],[32.23331,52.08085],[32.08813,52.03319],[31.92159,52.05144],[31.96141,52.08015],[31.85018,52.11305],[31.81722,52.09955],[31.7822,52.11406],[31.38326,52.12991],[31.25142,52.04131],[31.13332,52.1004],[30.95589,52.07775],[30.90897,52.00699],[30.76443,51.89739],[30.68804,51.82806],[30.51946,51.59649],[30.64992,51.35014],[30.56203,51.25655],[30.36153,51.33984],[30.34642,51.42555],[30.17888,51.51025],[29.77376,51.4461],[29.7408,51.53417],[29.54372,51.48372],[29.49773,51.39814],[29.42357,51.4187],[29.32881,51.37843],[29.25191,51.49828],[29.25603,51.57089],[29.20659,51.56918],[29.16402,51.64679],[29.1187,51.65872],[28.99098,51.56833],[28.95528,51.59222],[28.81795,51.55552],[28.76027,51.48802],[28.78224,51.45294],[28.75615,51.41442],[28.73143,51.46236],[28.69161,51.44695],[28.64429,51.5664],[28.47051,51.59734],[28.37592,51.54505],[28.23452,51.66988],[28.10658,51.57857],[27.95827,51.56065],[27.91844,51.61952],[27.85253,51.62293],[27.76052,51.47604],[27.67125,51.50854],[27.71932,51.60672],[27.55727,51.63486],[27.51058,51.5854],[27.47212,51.61184],[27.24828,51.60161],[27.26613,51.65957],[27.20948,51.66713],[27.20602,51.77291],[26.99422,51.76933],[26.9489,51.73788],[26.80043,51.75777],[26.69759,51.82284],[26.46962,51.80501],[26.39367,51.87315],[26.19084,51.86781],[26.00408,51.92967],[25.83217,51.92587],[25.80574,51.94556],[25.73673,51.91973],[25.46163,51.92205],[25.20228,51.97143],[24.98784,51.91273],[24.37123,51.88222],[24.29021,51.80841],[24.3163,51.75063],[24.13075,51.66979],[23.99907,51.58369],[23.8741,51.59734],[23.91118,51.63316],[23.7766,51.66809],[23.60906,51.62122],[23.6736,51.50255],[23.62751,51.50512],[23.69905,51.40871],[23.63858,51.32182],[23.80678,51.18405],[23.90376,51.07697],[23.92217,51.00836],[24.04576,50.90196],[24.14524,50.86128],[24.0952,50.83262],[23.99254,50.83847],[23.95925,50.79271],[24.0595,50.71625],[24.0996,50.60752],[24.07048,50.5071],[24.03668,50.44507],[23.99563,50.41289],[23.79445,50.40481],[23.71382,50.38248],[23.67635,50.33385],[23.28221,50.0957],[22.99329,49.84249],[22.83179,49.69875],[22.80261,49.69098],[22.78304,49.65543],[22.64534,49.53094],[22.69444,49.49378],[22.748,49.32759],[22.72009,49.20288],[22.86336,49.10513],[22.89122,49.00725],[22.56155,49.08865],[22.54338,49.01424],[22.48296,48.99172],[22.42934,48.92857],[22.34151,48.68893],[22.21379,48.6218],[22.16023,48.56548],[22.14689,48.4005],[22.2083,48.42534],[22.38133,48.23726],[22.49806,48.25189],[22.59007,48.15121],[22.58733,48.10813],[22.66835,48.09162],[22.73427,48.12005],[22.81804,48.11363],[22.87847,48.04665],[22.84276,47.98602],[22.89849,47.95851],[22.94301,47.96672],[22.92241,48.02002],[23.0158,47.99338],[23.08858,48.00716],[23.1133,48.08061],[23.15999,48.12188],[23.27397,48.08245],[23.33577,48.0237],[23.4979,47.96858],[23.52803,48.01818],[23.5653,48.00499],[23.63894,48.00293],[23.66262,47.98786],[23.75188,47.99705],[23.80904,47.98142],[23.8602,47.9329],[23.89352,47.94512],[23.94192,47.94868],[23.96337,47.96672],[23.98553,47.96076],[24.00801,47.968],[24.02999,47.95087],[24.06466,47.95317],[24.11281,47.91487],[24.22566,47.90231],[24.34926,47.9244],[24.43578,47.97131],[24.61994,47.95062],[24.70632,47.84428],[24.81893,47.82031],[24.88896,47.7234],[25.11144,47.75203],[25.23778,47.89403],[25.63878,47.94924],[25.77723,47.93919],[26.05901,47.9897],[26.17711,47.99246],[26.33504,48.18418],[26.55202,48.22445],[26.62823,48.25804],[26.6839,48.35828],[26.79239,48.29071],[26.82809,48.31629],[26.71274,48.40388],[26.85556,48.41095],[26.93384,48.36558],[27.03821,48.37653],[27.0231,48.42485],[27.08078,48.43214],[27.13434,48.37288],[27.27855,48.37534],[27.32159,48.4434],[27.37604,48.44398],[27.37741,48.41026],[27.44333,48.41209],[27.46942,48.454],[27.5889,48.49224],[27.59027,48.46311],[27.6658,48.44034],[27.74422,48.45926],[27.79225,48.44244],[27.81902,48.41874],[27.87533,48.4037],[27.88391,48.36699],[27.95883,48.32368],[28.04527,48.32661],[28.09873,48.3124],[28.07504,48.23494],[28.17666,48.25963],[28.19314,48.20749],[28.2856,48.23202],[28.32508,48.23384],[28.35519,48.24957],[28.36996,48.20543],[28.34912,48.1787],[28.30586,48.1597],[28.30609,48.14018],[28.34009,48.13147],[28.38712,48.17567],[28.43701,48.15832],[28.42454,48.12047],[28.48428,48.0737],[28.53921,48.17453],[28.69896,48.13106],[28.85232,48.12506],[28.8414,48.03392],[28.9306,47.96255],[29.1723,47.99013],[29.19839,47.89261],[29.27804,47.88893],[29.20663,47.80367],[29.27255,47.79953],[29.22242,47.73607],[29.22414,47.60012],[29.11743,47.55001],[29.18603,47.43387],[29.3261,47.44664],[29.39889,47.30179],[29.47854,47.30366],[29.48678,47.36043],[29.5733,47.36508],[29.59665,47.25521],[29.54996,47.24962],[29.57696,47.13581],[29.49732,47.12878],[29.53044,47.07851],[29.61038,47.09932],[29.62137,47.05069],[29.57056,46.94766],[29.72986,46.92234],[29.75458,46.8604],[29.87405,46.88199],[29.98814,46.82358],[29.94522,46.80055],[29.9743,46.75325],[29.94409,46.56002],[29.88916,46.54302],[30.02511,46.45132],[30.16794,46.40967],[30.09103,46.38694],[29.94114,46.40114],[29.88329,46.35851],[29.74496,46.45605],[29.66359,46.4215],[29.6763,46.36041],[29.5939,46.35472],[29.49914,46.45889],[29.35357,46.49505],[29.24886,46.37912],[29.23547,46.55435],[29.02409,46.49582],[29.01241,46.46177],[28.9306,46.45699],[29.004,46.31495],[28.98478,46.31803],[28.94953,46.25852],[29.06656,46.19716],[28.94643,46.09176],[29.00613,46.04962],[28.98004,46.00385],[28.74383,45.96664],[28.78503,45.83475],[28.69852,45.81753],[28.70401,45.78019],[28.52823,45.73803],[28.47879,45.66994],[28.51587,45.6613],[28.54196,45.58062],[28.49252,45.56716],[28.51449,45.49982],[28.43072,45.48538],[28.41836,45.51715],[28.30201,45.54744],[28.21139,45.46895],[28.28504,45.43907],[28.34554,45.32102],[28.5735,45.24759],[28.71358,45.22631],[28.78911,45.24179],[28.81383,45.3384],[28.94292,45.28045],[28.96077,45.33164],[29.24779,45.43388],[29.42632,45.44545],[29.59798,45.38857],[29.68175,45.26885],[29.65428,45.25629],[29.69272,45.19227],[30.04414,45.08461],[31.62627,45.50633],[33.54017,46.0123],[33.59087,46.06013],[33.57318,46.10317]]]]}},{type:"Feature",properties:{iso1A2:"UG",iso1A3:"UGA",iso1N3:"800",wikidata:"Q1036",nameEn:"Uganda",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["256"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.93107,-.99298],[33.9264,-.54188],[33.98449,-.13079],[33.90936,.10581],[34.10067,.36372],[34.08727,.44713],[34.11408,.48884],[34.13493,.58118],[34.20196,.62289],[34.27345,.63182],[34.31516,.75693],[34.40041,.80266],[34.43349,.85254],[34.52369,1.10692],[34.57427,1.09868],[34.58029,1.14712],[34.67562,1.21265],[34.80223,1.22754],[34.82606,1.26626],[34.82606,1.30944],[34.7918,1.36752],[34.87819,1.5596],[34.92734,1.56109],[34.9899,1.6668],[34.98692,1.97348],[34.90947,2.42447],[34.95267,2.47209],[34.77244,2.70272],[34.78137,2.76223],[34.73967,2.85447],[34.65774,2.8753],[34.60114,2.93034],[34.56242,3.11478],[34.45815,3.18319],[34.40006,3.37949],[34.41794,3.44342],[34.39112,3.48802],[34.44922,3.51627],[34.45815,3.67385],[34.15429,3.80464],[34.06046,4.15235],[33.9873,4.23316],[33.51264,3.75068],[33.18356,3.77812],[33.02852,3.89296],[32.89746,3.81339],[32.72021,3.77327],[32.41337,3.748],[32.20782,3.6053],[32.19888,3.50867],[32.08866,3.53543],[32.08491,3.56287],[32.05187,3.589],[31.95907,3.57408],[31.96205,3.6499],[31.86821,3.78664],[31.81459,3.82083],[31.72075,3.74354],[31.50776,3.63652],[31.50478,3.67814],[31.29476,3.8015],[31.16666,3.79853],[30.97601,3.693],[30.85153,3.48867],[30.94081,3.50847],[30.93486,3.40737],[30.84251,3.26908],[30.77101,3.04897],[30.8574,2.9508],[30.8857,2.83923],[30.75612,2.5863],[30.74271,2.43601],[30.83059,2.42559],[30.91102,2.33332],[30.96911,2.41071],[31.06593,2.35862],[31.07934,2.30207],[31.12104,2.27676],[31.1985,2.29462],[31.20148,2.2217],[31.28042,2.17853],[31.30127,2.11006],[30.48503,1.21675],[30.24671,1.14974],[30.22139,.99635],[30.1484,.89805],[29.98307,.84295],[29.95477,.64486],[29.97413,.52124],[29.87284,.39166],[29.81922,.16824],[29.77454,.16675],[29.7224,.07291],[29.72687,-.08051],[29.65091,-.46777],[29.67474,-.47969],[29.67176,-.55714],[29.62708,-.71055],[29.63006,-.8997],[29.58388,-.89821],[29.59061,-1.39016],[29.82657,-1.31187],[29.912,-1.48269],[30.16369,-1.34303],[30.35212,-1.06896],[30.47194,-1.0555],[30.64166,-1.06601],[30.70631,-1.01175],[30.76635,-.9852],[30.80408,-.99911],[33.93107,-.99298]]]]}},{type:"Feature",properties:{iso1A2:"UM",iso1A3:"UMI",iso1N3:"581",wikidata:"Q16645",nameEn:"United States Minor Outlying Islands",country:"US"},geometry:null},{type:"Feature",properties:{iso1A2:"UN",wikidata:"Q1065",nameEn:"United Nations",level:"unitedNations",isoStatus:"excRes"},geometry:null},{type:"Feature",properties:{iso1A2:"US",iso1A3:"USA",iso1N3:"840",wikidata:"Q30",nameEn:"United States of America"},geometry:null},{type:"Feature",properties:{iso1A2:"UY",iso1A3:"URY",iso1N3:"858",wikidata:"Q77",nameEn:"Uruguay",groups:["005","419","019","UN"],callingCodes:["598"]},geometry:{type:"MultiPolygon",coordinates:[[[[-57.65132,-30.19229],[-57.61478,-30.25165],[-57.64859,-30.35095],[-57.89115,-30.49572],[-57.8024,-30.77193],[-57.89476,-30.95994],[-57.86729,-31.06352],[-57.9908,-31.34924],[-57.98127,-31.3872],[-58.07569,-31.44916],[-58.0023,-31.53084],[-58.00076,-31.65016],[-58.20252,-31.86966],[-58.10036,-32.25338],[-58.22362,-32.52416],[-58.1224,-32.98842],[-58.40475,-33.11777],[-58.44442,-33.84033],[-58.34425,-34.15035],[-57.83001,-34.69099],[-54.78916,-36.21945],[-52.83257,-34.01481],[-53.37138,-33.74313],[-53.39593,-33.75169],[-53.44031,-33.69344],[-53.52794,-33.68908],[-53.53459,-33.16843],[-53.1111,-32.71147],[-53.37671,-32.57005],[-53.39572,-32.58596],[-53.76024,-32.0751],[-54.17384,-31.86168],[-55.50821,-30.91349],[-55.50841,-30.9027],[-55.51862,-30.89828],[-55.52712,-30.89997],[-55.53276,-30.90218],[-55.53431,-30.89714],[-55.54572,-30.89051],[-55.55218,-30.88193],[-55.55373,-30.8732],[-55.5634,-30.8686],[-55.58866,-30.84117],[-55.87388,-31.05053],[-56.4619,-30.38457],[-56.4795,-30.3899],[-56.49267,-30.39471],[-56.90236,-30.02578],[-57.22502,-30.26121],[-57.65132,-30.19229]]]]}},{type:"Feature",properties:{iso1A2:"UZ",iso1A3:"UZB",iso1N3:"860",wikidata:"Q265",nameEn:"Uzbekistan",groups:["143","142","UN"],callingCodes:["998"]},geometry:{type:"MultiPolygon",coordinates:[[[[65.85194,42.85481],[65.53277,43.31856],[65.18666,43.48835],[64.96464,43.74748],[64.53885,43.56941],[63.34656,43.64003],[62.01711,43.51008],[61.01475,44.41383],[58.59711,45.58671],[55.97842,44.99622],[55.97832,44.99622],[55.97822,44.99617],[55.97811,44.99617],[55.97801,44.99612],[55.97801,44.99607],[55.97791,44.99607],[55.9778,44.99607],[55.9777,44.99601],[55.9777,44.99596],[55.9776,44.99591],[55.97749,44.99591],[55.97739,44.99591],[55.97739,44.99586],[55.97729,44.99586],[55.97718,44.99581],[55.97708,44.99576],[55.97698,44.9957],[55.97698,44.99565],[55.97687,44.9956],[55.97677,44.9956],[55.97677,44.99555],[55.97677,44.9955],[55.97667,44.99545],[55.97656,44.99539],[55.97646,44.99534],[55.97646,44.99529],[55.97636,44.99524],[55.97636,44.99519],[55.97625,44.99514],[55.97615,44.99508],[55.97615,44.99503],[55.97615,44.99498],[55.97615,44.99493],[55.97615,44.99483],[55.97615,44.99477],[55.97605,44.99477],[55.97605,44.99467],[55.97605,44.99462],[55.97605,44.99457],[55.97605,44.99452],[55.97594,44.99446],[55.97584,44.99441],[55.97584,44.99436],[55.97584,44.99431],[55.97584,44.99426],[55.97584,44.99421],[55.97584,44.99415],[55.97584,44.99405],[55.97584,44.994],[55.97584,44.9939],[55.97584,44.99384],[55.97584,44.99374],[55.97584,44.99369],[55.97584,44.99359],[55.97584,44.99353],[55.97584,44.99348],[55.97584,44.99343],[55.97584,44.99338],[55.97584,44.99328],[55.97584,44.99322],[56.00314,41.32584],[57.03423,41.25435],[57.13796,41.36625],[57.03359,41.41777],[56.96218,41.80383],[57.03633,41.92043],[57.30275,42.14076],[57.6296,42.16519],[57.84932,42.18555],[57.92897,42.24047],[57.90975,42.4374],[57.99214,42.50021],[58.3492,42.43335],[58.40688,42.29535],[58.51674,42.30348],[58.29427,42.56497],[58.14321,42.62159],[58.27504,42.69632],[58.57991,42.64988],[58.6266,42.79314],[58.93422,42.5407],[59.17317,42.52248],[59.2955,42.37064],[59.4341,42.29738],[59.94633,42.27655],[60.00539,42.212],[59.96419,42.1428],[60.04659,42.08982],[60.0356,42.01028],[59.95046,41.97966],[60.33223,41.75058],[60.08504,41.80997],[60.06032,41.76287],[60.18117,41.60082],[60.06581,41.4363],[60.5078,41.21694],[61.03261,41.25691],[61.22212,41.14946],[61.33199,41.14946],[61.39732,41.19873],[61.4446,41.29407],[61.87856,41.12257],[62.11751,40.58242],[62.34273,40.43206],[62.43337,39.98528],[63.6913,39.27666],[63.70778,39.22349],[64.19086,38.95561],[64.32576,38.98691],[65.55873,38.29052],[65.83913,38.25733],[66.24013,38.16238],[66.41042,38.02403],[66.56697,38.0435],[66.67684,37.96776],[66.53676,37.80084],[66.52852,37.58568],[66.65761,37.45497],[66.52303,37.39827],[66.55743,37.35409],[66.64699,37.32958],[66.95598,37.40162],[67.08232,37.35469],[67.13039,37.27168],[67.2224,37.24545],[67.2581,37.17216],[67.51868,37.26102],[67.78329,37.1834],[67.8474,37.31594],[67.81566,37.43107],[68.12635,37.93],[68.27159,37.91477],[68.40343,38.19484],[68.13289,38.40822],[68.06274,38.39435],[68.11366,38.47169],[68.05873,38.56087],[68.0807,38.64136],[68.05598,38.71641],[68.12877,38.73677],[68.06948,38.82115],[68.19743,38.85985],[68.09704,39.02589],[67.68915,39.00775],[67.67833,39.14479],[67.33226,39.23739],[67.36522,39.31287],[67.45998,39.315],[67.46822,39.46146],[67.39681,39.52505],[67.46547,39.53564],[67.44899,39.57799],[67.62889,39.60234],[67.70992,39.66156],[68.12053,39.56317],[68.54166,39.53929],[68.61972,39.68905],[68.63071,39.85265],[68.88889,39.87163],[68.93695,39.91167],[68.84906,40.04952],[68.96579,40.06949],[69.01935,40.11466],[69.01523,40.15771],[68.62796,40.07789],[68.52771,40.11676],[68.5332,40.14826],[68.77902,40.20492],[68.79276,40.17555],[68.84357,40.18604],[68.85832,40.20885],[69.04544,40.22904],[69.15659,40.2162],[69.2074,40.21488],[69.30448,40.18774],[69.30104,40.24502],[69.25229,40.26362],[69.24817,40.30357],[69.30808,40.2821],[69.32833,40.29794],[69.33794,40.34819],[69.30774,40.36102],[69.28525,40.41894],[69.27066,40.49274],[69.21063,40.54469],[69.2643,40.57506],[69.3455,40.57988],[69.32834,40.70233],[69.38327,40.7918],[69.53021,40.77621],[69.59441,40.70181],[69.69434,40.62615],[70.36655,40.90296],[70.38028,41.02014],[70.45251,41.04438],[70.80009,40.72825],[70.49871,40.52503],[70.32626,40.45174],[70.37511,40.38605],[70.57149,40.3442],[70.56394,40.26421],[70.62342,40.17396],[70.8607,40.217],[70.9818,40.22392],[70.95789,40.28761],[71.05901,40.28765],[71.13042,40.34106],[71.36663,40.31593],[71.4246,40.28619],[71.51215,40.26943],[71.51549,40.22986],[71.61725,40.20615],[71.61931,40.26775],[71.68386,40.26984],[71.70569,40.20391],[71.69621,40.18492],[71.71719,40.17886],[71.73054,40.14818],[71.82646,40.21872],[71.85002,40.25647],[72.05464,40.27586],[71.96401,40.31907],[72.18648,40.49893],[72.24368,40.46091],[72.40346,40.4007],[72.44191,40.48222],[72.41513,40.50856],[72.38384,40.51535],[72.41714,40.55736],[72.34406,40.60144],[72.40517,40.61917],[72.47795,40.5532],[72.66713,40.5219],[72.66713,40.59076],[72.69579,40.59778],[72.73995,40.58409],[72.74768,40.58051],[72.74862,40.57131],[72.75982,40.57273],[72.74894,40.59592],[72.74866,40.60873],[72.80137,40.67856],[72.84754,40.67229],[72.85372,40.7116],[72.8722,40.71111],[72.93296,40.73089],[72.99133,40.76457],[73.0612,40.76678],[73.13412,40.79122],[73.13267,40.83512],[73.01869,40.84681],[72.94454,40.8094],[72.84291,40.85512],[72.68157,40.84942],[72.59136,40.86947],[72.55109,40.96046],[72.48742,40.97136],[72.45206,41.03018],[72.38511,41.02785],[72.36138,41.04384],[72.34757,41.06104],[72.34026,41.04539],[72.324,41.03381],[72.18339,40.99571],[72.17594,41.02377],[72.21061,41.05607],[72.1792,41.10621],[72.14864,41.13363],[72.17594,41.15522],[72.16433,41.16483],[72.10745,41.15483],[72.07249,41.11739],[71.85964,41.19081],[71.91457,41.2982],[71.83914,41.3546],[71.76625,41.4466],[71.71132,41.43012],[71.73054,41.54713],[71.65914,41.49599],[71.6787,41.42111],[71.57227,41.29175],[71.46688,41.31883],[71.43814,41.19644],[71.46148,41.13958],[71.40198,41.09436],[71.34877,41.16807],[71.27187,41.11015],[71.25813,41.18796],[71.11806,41.15359],[71.02193,41.19494],[70.9615,41.16393],[70.86263,41.23833],[70.77885,41.24813],[70.78572,41.36419],[70.67586,41.47953],[70.48909,41.40335],[70.17682,41.5455],[70.69777,41.92554],[71.28719,42.18033],[71.13263,42.28356],[70.94483,42.26238],[69.49545,41.545],[69.45751,41.56863],[69.39485,41.51518],[69.45081,41.46246],[69.37468,41.46555],[69.35554,41.47211],[69.29778,41.43673],[69.25059,41.46693],[69.23332,41.45847],[69.22671,41.46298],[69.20439,41.45391],[69.18528,41.45175],[69.17701,41.43769],[69.15137,41.43078],[69.05006,41.36183],[69.01308,41.22804],[68.7217,41.05025],[68.73945,40.96989],[68.65662,40.93861],[68.62221,41.03019],[68.49983,40.99669],[68.58444,40.91447],[68.63,40.59358],[68.49983,40.56437],[67.96736,40.83798],[68.1271,41.0324],[68.08273,41.08148],[67.98511,41.02794],[67.9644,41.14611],[66.69129,41.1311],[66.53302,41.87388],[66.00546,41.94455],[66.09482,42.93426],[65.85194,42.85481]],[[70.68112,40.90612],[70.6721,40.90555],[70.57501,40.98941],[70.54223,40.98787],[70.56077,41.00642],[70.6158,40.97661],[70.68112,40.90612]]],[[[71.21139,40.03369],[71.12218,40.03052],[71.06305,40.1771],[71.00236,40.18154],[71.01035,40.05481],[71.11037,40.01984],[71.11668,39.99291],[71.09063,39.99],[71.10501,39.95568],[71.04979,39.89808],[71.10531,39.91354],[71.16101,39.88423],[71.23067,39.93581],[71.1427,39.95026],[71.21139,40.03369]]],[[[71.86463,39.98598],[71.78838,40.01404],[71.71511,39.96348],[71.7504,39.93701],[71.84316,39.95582],[71.86463,39.98598]]]]}},{type:"Feature",properties:{iso1A2:"VA",iso1A3:"VAT",iso1N3:"336",wikidata:"Q237",nameEn:"Vatican City",aliases:["Holy See"],groups:["039","150"],callingCodes:["379","39 06"]},geometry:{type:"MultiPolygon",coordinates:[[[[12.45181,41.90056],[12.45446,41.90028],[12.45435,41.90143],[12.45626,41.90172],[12.45691,41.90125],[12.4577,41.90115],[12.45834,41.90174],[12.45826,41.90281],[12.45755,41.9033],[12.45762,41.9058],[12.45561,41.90629],[12.45543,41.90738],[12.45091,41.90625],[12.44984,41.90545],[12.44815,41.90326],[12.44582,41.90194],[12.44834,41.90095],[12.45181,41.90056]]]]}},{type:"Feature",properties:{iso1A2:"VC",iso1A3:"VCT",iso1N3:"670",wikidata:"Q757",nameEn:"St. Vincent and the Grenadines",aliases:["WV"],groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 784"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.64026,12.69984],[-59.94058,12.34011],[-61.69315,14.26451],[-62.64026,12.69984]]]]}},{type:"Feature",properties:{iso1A2:"VE",iso1A3:"VEN",iso1N3:"862",wikidata:"Q717",nameEn:"Venezuela",aliases:["YV"],groups:["005","419","019","UN"],callingCodes:["58"]},geometry:{type:"MultiPolygon",coordinates:[[[[-71.22331,13.01387],[-70.92579,11.96275],[-71.3275,11.85],[-71.9675,11.65536],[-72.24983,11.14138],[-72.4767,11.1117],[-72.88002,10.44309],[-72.98085,9.85253],[-73.36905,9.16636],[-73.02119,9.27584],[-72.94052,9.10663],[-72.77415,9.10165],[-72.65474,8.61428],[-72.4042,8.36513],[-72.36987,8.19976],[-72.35163,8.01163],[-72.39137,8.03534],[-72.47213,7.96106],[-72.48801,7.94329],[-72.48183,7.92909],[-72.47042,7.92306],[-72.45806,7.91141],[-72.46183,7.90682],[-72.44454,7.86031],[-72.46763,7.79518],[-72.47827,7.65604],[-72.45321,7.57232],[-72.47415,7.48928],[-72.43132,7.40034],[-72.19437,7.37034],[-72.04895,7.03837],[-71.82441,7.04314],[-71.44118,7.02116],[-71.42212,7.03854],[-71.37234,7.01588],[-71.03941,6.98163],[-70.7596,7.09799],[-70.10716,6.96516],[-69.41843,6.1072],[-67.60654,6.2891],[-67.4625,6.20625],[-67.43513,5.98835],[-67.58558,5.84537],[-67.63914,5.64963],[-67.59141,5.5369],[-67.83341,5.31104],[-67.85358,4.53249],[-67.62671,3.74303],[-67.50067,3.75812],[-67.30945,3.38393],[-67.85862,2.86727],[-67.85862,2.79173],[-67.65696,2.81691],[-67.21967,2.35778],[-66.85795,1.22998],[-66.28507,.74585],[-65.6727,1.01353],[-65.50158,.92086],[-65.57288,.62856],[-65.11657,1.12046],[-64.38932,1.5125],[-64.34654,1.35569],[-64.08274,1.64792],[-64.06135,1.94722],[-63.39827,2.16098],[-63.39114,2.4317],[-64.0257,2.48156],[-64.02908,2.79797],[-64.48379,3.7879],[-64.84028,4.24665],[-64.72977,4.28931],[-64.57648,4.12576],[-64.14512,4.12932],[-63.99183,3.90172],[-63.86082,3.94796],[-63.70218,3.91417],[-63.67099,4.01731],[-63.50611,3.83592],[-63.42233,3.89995],[-63.4464,3.9693],[-63.21111,3.96219],[-62.98296,3.59935],[-62.7655,3.73099],[-62.74411,4.03331],[-62.57656,4.04754],[-62.44822,4.18621],[-62.13094,4.08309],[-61.54629,4.2822],[-61.48569,4.43149],[-61.29675,4.44216],[-61.31457,4.54167],[-61.15703,4.49839],[-60.98303,4.54167],[-60.86539,4.70512],[-60.5802,4.94312],[-60.73204,5.20931],[-61.4041,5.95304],[-61.15058,6.19558],[-61.20762,6.58174],[-61.13632,6.70922],[-60.54873,6.8631],[-60.39419,6.94847],[-60.28074,7.1162],[-60.44116,7.20817],[-60.54098,7.14804],[-60.63367,7.25061],[-60.59802,7.33194],[-60.71923,7.55817],[-60.64793,7.56877],[-60.51959,7.83373],[-60.38056,7.8302],[-60.02407,8.04557],[-59.97059,8.20791],[-59.83156,8.23261],[-59.80661,8.28906],[-59.85562,8.35213],[-59.98508,8.53046],[-59.54058,8.6862],[-60.89962,9.81445],[-62.08693,10.04435],[-61.62505,11.18974],[-63.73917,11.92623],[-63.19938,16.44103],[-67.89186,12.4116],[-68.01417,11.77722],[-68.33524,11.78151],[-68.99639,11.79035],[-71.22331,13.01387]]]]}},{type:"Feature",properties:{iso1A2:"VG",iso1A3:"VGB",iso1N3:"092",wikidata:"Q25305",nameEn:"British Virgin Islands",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 284"]},geometry:{type:"MultiPolygon",coordinates:[[[[-64.47127,17.55688],[-63.88746,19.15706],[-65.02435,18.73231],[-64.86027,18.39056],[-64.64673,18.36549],[-64.47127,17.55688]]]]}},{type:"Feature",properties:{iso1A2:"VI",iso1A3:"VIR",iso1N3:"850",wikidata:"Q11703",nameEn:"United States Virgin Islands",aliases:["US-VI"],country:"US",groups:["Q1352230","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 340"]},geometry:{type:"MultiPolygon",coordinates:[[[[-65.02435,18.73231],[-65.27974,17.56928],[-64.47127,17.55688],[-64.64673,18.36549],[-64.86027,18.39056],[-65.02435,18.73231]]]]}},{type:"Feature",properties:{iso1A2:"VN",iso1A3:"VNM",iso1N3:"704",wikidata:"Q881",nameEn:"Vietnam",groups:["035","142","UN"],callingCodes:["84"]},geometry:{type:"MultiPolygon",coordinates:[[[[108.10003,21.47338],[108.0569,21.53604],[108.02926,21.54997],[107.97932,21.54503],[107.97383,21.53961],[107.97074,21.54072],[107.96774,21.53601],[107.95232,21.5388],[107.92652,21.58906],[107.90006,21.5905],[107.86114,21.65128],[107.80355,21.66141],[107.66967,21.60787],[107.56537,21.61945],[107.54047,21.5934],[107.49065,21.59774],[107.49532,21.62958],[107.47197,21.6672],[107.41593,21.64839],[107.38636,21.59774],[107.35989,21.60063],[107.35834,21.6672],[107.29296,21.74674],[107.24625,21.7077],[107.20734,21.71493],[107.10771,21.79879],[107.02615,21.81981],[107.00964,21.85948],[107.06101,21.88982],[107.05634,21.92303],[106.99252,21.95191],[106.97228,21.92592],[106.92714,21.93459],[106.9178,21.97357],[106.81038,21.97934],[106.74345,22.00965],[106.72551,21.97923],[106.69276,21.96013],[106.68274,21.99811],[106.70142,22.02409],[106.6983,22.15102],[106.67495,22.1885],[106.69986,22.22309],[106.6516,22.33977],[106.55976,22.34841],[106.57221,22.37],[106.55665,22.46498],[106.58395,22.474],[106.61269,22.60301],[106.65316,22.5757],[106.71698,22.58432],[106.72321,22.63606],[106.76293,22.73491],[106.82404,22.7881],[106.83685,22.8098],[106.81271,22.8226],[106.78422,22.81532],[106.71128,22.85982],[106.71387,22.88296],[106.6734,22.89587],[106.6516,22.86862],[106.60179,22.92884],[106.55976,22.92311],[106.51306,22.94891],[106.49749,22.91164],[106.34961,22.86718],[106.27022,22.87722],[106.19705,22.98475],[106.00179,22.99049],[105.99568,22.94178],[105.90119,22.94168],[105.8726,22.92756],[105.72382,23.06641],[105.57594,23.075],[105.56037,23.16806],[105.49966,23.20669],[105.42805,23.30824],[105.40782,23.28107],[105.32376,23.39684],[105.22569,23.27249],[105.17276,23.28679],[105.11672,23.25247],[105.07002,23.26248],[104.98712,23.19176],[104.96532,23.20463],[104.9486,23.17235],[104.91435,23.18666],[104.87992,23.17141],[104.87382,23.12854],[104.79478,23.12934],[104.8334,23.01484],[104.86765,22.95178],[104.84942,22.93631],[104.77114,22.90017],[104.72755,22.81984],[104.65283,22.83419],[104.60457,22.81841],[104.58122,22.85571],[104.47225,22.75813],[104.35593,22.69353],[104.25683,22.76534],[104.27084,22.8457],[104.11384,22.80363],[104.03734,22.72945],[104.01088,22.51823],[103.99247,22.51958],[103.97384,22.50634],[103.96783,22.51173],[103.96352,22.50584],[103.95191,22.5134],[103.94513,22.52553],[103.93286,22.52703],[103.87904,22.56683],[103.64506,22.79979],[103.56255,22.69499],[103.57812,22.65764],[103.52675,22.59155],[103.43646,22.70648],[103.43179,22.75816],[103.32282,22.8127],[103.28079,22.68063],[103.18895,22.64471],[103.15782,22.59873],[103.17961,22.55705],[103.07843,22.50097],[103.0722,22.44775],[102.9321,22.48659],[102.8636,22.60735],[102.60675,22.73376],[102.57095,22.7036],[102.51802,22.77969],[102.46665,22.77108],[102.42618,22.69212],[102.38415,22.67919],[102.41061,22.64184],[102.25339,22.4607],[102.26428,22.41321],[102.16621,22.43336],[102.14099,22.40092],[102.18712,22.30403],[102.51734,22.02676],[102.49092,21.99002],[102.62301,21.91447],[102.67145,21.65894],[102.74189,21.66713],[102.82115,21.73667],[102.81894,21.83888],[102.85637,21.84501],[102.86077,21.71213],[102.97965,21.74076],[102.98846,21.58936],[102.86297,21.4255],[102.94223,21.46034],[102.88939,21.3107],[102.80794,21.25736],[102.89825,21.24707],[102.97745,21.05821],[103.03469,21.05821],[103.12055,20.89994],[103.21497,20.89832],[103.38032,20.79501],[103.45737,20.82382],[103.68633,20.66324],[103.73478,20.6669],[103.82282,20.8732],[103.98024,20.91531],[104.11121,20.96779],[104.27412,20.91433],[104.63957,20.6653],[104.38199,20.47155],[104.40621,20.3849],[104.47886,20.37459],[104.66158,20.47774],[104.72102,20.40554],[104.62195,20.36633],[104.61315,20.24452],[104.86852,20.14121],[104.91695,20.15567],[104.9874,20.09573],[104.8465,19.91783],[104.8355,19.80395],[104.68359,19.72729],[104.64837,19.62365],[104.53169,19.61743],[104.41281,19.70035],[104.23229,19.70242],[104.06498,19.66926],[104.05617,19.61743],[104.10832,19.51575],[104.06058,19.43484],[103.87125,19.31854],[104.5361,18.97747],[104.64617,18.85668],[105.12829,18.70453],[105.19654,18.64196],[105.1327,18.58355],[105.10408,18.43533],[105.15942,18.38691],[105.38366,18.15315],[105.46292,18.22008],[105.64784,17.96687],[105.60381,17.89356],[105.76612,17.67147],[105.85744,17.63221],[106.09019,17.36399],[106.18991,17.28227],[106.24444,17.24714],[106.29287,17.3018],[106.31929,17.20509],[106.43597,17.01362],[106.50862,16.9673],[106.55045,17.0031],[106.54824,16.92729],[106.51963,16.92097],[106.52183,16.87884],[106.55265,16.86831],[106.55485,16.68704],[106.59013,16.62259],[106.58267,16.6012],[106.61477,16.60713],[106.66052,16.56892],[106.65832,16.47816],[106.74418,16.41904],[106.84104,16.55415],[106.88727,16.52671],[106.88067,16.43594],[106.96638,16.34938],[106.97385,16.30204],[107.02597,16.31132],[107.09091,16.3092],[107.15035,16.26271],[107.14595,16.17816],[107.25822,16.13587],[107.33968,16.05549],[107.44975,16.08511],[107.46296,16.01106],[107.39471,15.88829],[107.34188,15.89464],[107.21419,15.83747],[107.21859,15.74638],[107.27143,15.71459],[107.27583,15.62769],[107.34408,15.62345],[107.3815,15.49832],[107.50699,15.48771],[107.53341,15.40496],[107.62367,15.42193],[107.60605,15.37524],[107.62587,15.2266],[107.58844,15.20111],[107.61926,15.13949],[107.61486,15.0566],[107.46516,15.00982],[107.48277,14.93751],[107.59285,14.87795],[107.51579,14.79282],[107.54361,14.69092],[107.55371,14.628],[107.52102,14.59034],[107.52569,14.54665],[107.48521,14.40346],[107.44941,14.41552],[107.39493,14.32655],[107.40427,14.24509],[107.33577,14.11832],[107.37158,14.07906],[107.35757,14.02319],[107.38247,13.99147],[107.44318,13.99751],[107.46498,13.91593],[107.45252,13.78897],[107.53503,13.73908],[107.61909,13.52577],[107.62843,13.3668],[107.49144,13.01215],[107.49611,12.88926],[107.55993,12.7982],[107.5755,12.52177],[107.55059,12.36824],[107.4463,12.29373],[107.42917,12.24657],[107.34511,12.33327],[107.15831,12.27547],[106.99953,12.08983],[106.92325,12.06548],[106.79405,12.0807],[106.70687,11.96956],[106.4111,11.97413],[106.4687,11.86751],[106.44068,11.86294],[106.44535,11.8279],[106.41577,11.76999],[106.45158,11.68616],[106.44691,11.66787],[106.37219,11.69836],[106.30525,11.67549],[106.26478,11.72122],[106.18539,11.75171],[106.13158,11.73283],[106.06708,11.77761],[106.02038,11.77457],[106.00792,11.7197],[105.95188,11.63738],[105.88962,11.67854],[105.8507,11.66635],[105.80867,11.60536],[105.81645,11.56876],[105.87328,11.55953],[105.88962,11.43605],[105.86782,11.28343],[106.10444,11.07879],[106.1527,11.10476],[106.1757,11.07301],[106.20095,10.97795],[106.14301,10.98176],[106.18539,10.79451],[106.06708,10.8098],[105.94535,10.9168],[105.93403,10.83853],[105.84603,10.85873],[105.86376,10.89839],[105.77751,11.03671],[105.50045,10.94586],[105.42884,10.96878],[105.34011,10.86179],[105.11449,10.96332],[105.08326,10.95656],[105.02722,10.89236],[105.09571,10.72722],[104.95094,10.64003],[104.87933,10.52833],[104.59018,10.53073],[104.49869,10.4057],[104.47963,10.43046],[104.43778,10.42386],[103.99198,10.48391],[102.47649,9.66162],[104.81582,8.03101],[109.55486,8.10026],[111.60491,13.57105],[108.00365,17.98159],[108.10003,21.47338]]]]}},{type:"Feature",properties:{iso1A2:"VU",iso1A3:"VUT",iso1N3:"548",wikidata:"Q686",nameEn:"Vanuatu",groups:["054","009","UN"],callingCodes:["678"]},geometry:{type:"MultiPolygon",coordinates:[[[[156.73836,-14.50464],[174.245,-23.1974],[172.71443,-12.01327],[156.73836,-14.50464]]]]}},{type:"Feature",properties:{iso1A2:"WF",iso1A3:"WLF",iso1N3:"876",wikidata:"Q35555",nameEn:"Wallis and Futuna",country:"FR",groups:["EU","Q1451600","061","009","UN"],callingCodes:["681"]},geometry:{type:"MultiPolygon",coordinates:[[[[-178.66551,-14.32452],[-176.76826,-14.95183],[-175.59809,-12.61507],[-178.66551,-14.32452]]]]}},{type:"Feature",properties:{iso1A2:"WS",iso1A3:"WSM",iso1N3:"882",wikidata:"Q683",nameEn:"Samoa",groups:["061","009","UN"],driveSide:"left",callingCodes:["685"]},geometry:{type:"MultiPolygon",coordinates:[[[[-173.74402,-14.26669],[-170.99605,-15.1275],[-171.39864,-10.21587],[-173.74402,-14.26669]]]]}},{type:"Feature",properties:{iso1A2:"XK",iso1A3:"XKX",wikidata:"Q1246",nameEn:"Kosovo",aliases:["KV"],groups:["039","150"],isoStatus:"usrAssn",callingCodes:["383"]},geometry:{type:"MultiPolygon",coordinates:[[[[21.39045,42.74888],[21.44047,42.87276],[21.36941,42.87397],[21.32974,42.90424],[21.2719,42.8994],[21.23534,42.95523],[21.23877,43.00848],[21.2041,43.02277],[21.16734,42.99694],[21.14465,43.11089],[21.08952,43.13471],[21.05378,43.10707],[21.00749,43.13984],[20.96287,43.12416],[20.83727,43.17842],[20.88685,43.21697],[20.82145,43.26769],[20.73811,43.25068],[20.68688,43.21335],[20.59929,43.20492],[20.69515,43.09641],[20.64557,43.00826],[20.59929,43.01067],[20.48692,42.93208],[20.53484,42.8885],[20.43734,42.83157],[20.40594,42.84853],[20.35692,42.8335],[20.27869,42.81945],[20.2539,42.76245],[20.04898,42.77701],[20.02088,42.74789],[20.02915,42.71147],[20.0969,42.65559],[20.07761,42.55582],[20.17127,42.50469],[20.21797,42.41237],[20.24399,42.32168],[20.34479,42.32656],[20.3819,42.3029],[20.48857,42.25444],[20.56955,42.12097],[20.55633,42.08173],[20.59434,42.03879],[20.63069,41.94913],[20.57946,41.91593],[20.59524,41.8818],[20.68523,41.85318],[20.76786,41.91839],[20.75464,42.05229],[21.11491,42.20794],[21.16614,42.19815],[21.22728,42.08909],[21.31983,42.10993],[21.29913,42.13954],[21.30496,42.1418],[21.38428,42.24465],[21.43882,42.23609],[21.43882,42.2789],[21.50823,42.27156],[21.52145,42.24465],[21.58992,42.25915],[21.56772,42.30946],[21.5264,42.33634],[21.53467,42.36809],[21.57021,42.3647],[21.59029,42.38042],[21.62887,42.37664],[21.64209,42.41081],[21.62556,42.45106],[21.7035,42.51899],[21.70522,42.54176],[21.7327,42.55041],[21.75672,42.62695],[21.79413,42.65923],[21.75025,42.70125],[21.6626,42.67813],[21.58755,42.70418],[21.59154,42.72643],[21.47498,42.74695],[21.39045,42.74888]]]]}},{type:"Feature",properties:{iso1A2:"YE",iso1A3:"YEM",iso1N3:"887",wikidata:"Q805",nameEn:"Yemen",groups:["145","142","UN"],callingCodes:["967"]},geometry:{type:"MultiPolygon",coordinates:[[[[57.49095,8.14549],[52.81185,17.28568],[52.74267,17.29519],[52.78009,17.35124],[52.00311,19.00083],[49.04884,18.59899],[48.19996,18.20584],[47.58351,17.50366],[47.48245,17.10808],[47.00571,16.94765],[46.76494,17.29151],[46.31018,17.20464],[44.50126,17.47475],[43.70631,17.35762],[43.43005,17.56148],[43.29185,17.53224],[43.22533,17.38343],[43.32653,17.31179],[43.20156,17.25901],[43.17787,17.14717],[43.23967,17.03428],[43.18233,17.02673],[43.1813,16.98438],[43.19328,16.94703],[43.1398,16.90696],[43.18338,16.84852],[43.22012,16.83932],[43.22956,16.80613],[43.24801,16.80613],[43.26303,16.79479],[43.25857,16.75304],[43.21325,16.74416],[43.22066,16.65179],[43.15274,16.67248],[43.11601,16.53166],[42.97215,16.51093],[42.94351,16.49467],[42.94625,16.39721],[42.76801,16.40371],[42.15205,16.40211],[40.99158,15.81743],[43.29075,12.79154],[43.32909,12.59711],[43.90659,12.3823],[51.12877,12.56479],[57.49095,8.14549]]]]}},{type:"Feature",properties:{iso1A2:"YT",iso1A3:"MYT",iso1N3:"175",wikidata:"Q17063",nameEn:"Mayotte",country:"FR",groups:["Q3320166","EU","014","202","002","UN"],callingCodes:["262"]},geometry:{type:"MultiPolygon",coordinates:[[[[43.28731,-13.97126],[45.54824,-13.22353],[45.4971,-11.75965],[43.28731,-13.97126]]]]}},{type:"Feature",properties:{iso1A2:"ZA",iso1A3:"ZAF",iso1N3:"710",wikidata:"Q258",nameEn:"South Africa",groups:["018","202","002","UN"],driveSide:"left",callingCodes:["27"]},geometry:{type:"MultiPolygon",coordinates:[[[[31.30611,-22.422],[31.16344,-22.32599],[31.08932,-22.34884],[30.86696,-22.28907],[30.6294,-22.32599],[30.48686,-22.31368],[30.38614,-22.34533],[30.28351,-22.35587],[30.2265,-22.2961],[30.13147,-22.30841],[29.92242,-22.19408],[29.76848,-22.14128],[29.64609,-22.12917],[29.37703,-22.19581],[29.21955,-22.17771],[29.18974,-22.18599],[29.15268,-22.21399],[29.10881,-22.21202],[29.0151,-22.22907],[28.91889,-22.44299],[28.63287,-22.55887],[28.34874,-22.5694],[28.04562,-22.8394],[28.04752,-22.90243],[27.93729,-22.96194],[27.93539,-23.04941],[27.74154,-23.2137],[27.6066,-23.21894],[27.52393,-23.37952],[27.33768,-23.40917],[26.99749,-23.65486],[26.84165,-24.24885],[26.51667,-24.47219],[26.46346,-24.60358],[26.39409,-24.63468],[25.8515,-24.75727],[25.84295,-24.78661],[25.88571,-24.87802],[25.72702,-25.25503],[25.69661,-25.29284],[25.6643,-25.4491],[25.58543,-25.6343],[25.33076,-25.76616],[25.12266,-25.75931],[25.01718,-25.72507],[24.8946,-25.80723],[24.67319,-25.81749],[24.44703,-25.73021],[24.36531,-25.773],[24.18287,-25.62916],[23.9244,-25.64286],[23.47588,-25.29971],[23.03497,-25.29971],[22.86012,-25.50572],[22.70808,-25.99186],[22.56365,-26.19668],[22.41921,-26.23078],[22.21206,-26.3773],[22.06192,-26.61882],[21.90703,-26.66808],[21.83291,-26.65959],[21.77114,-26.69015],[21.7854,-26.79199],[21.69322,-26.86152],[21.37869,-26.82083],[21.13353,-26.86661],[20.87031,-26.80047],[20.68596,-26.9039],[20.63275,-26.78181],[20.61754,-26.4692],[20.86081,-26.14892],[20.64795,-25.47827],[20.29826,-24.94869],[20.03678,-24.81004],[20.02809,-24.78725],[19.99817,-24.76768],[19.99882,-28.42622],[18.99885,-28.89165],[17.4579,-28.68718],[17.15405,-28.08573],[16.90446,-28.057],[16.59922,-28.53246],[16.46592,-28.57126],[16.45332,-28.63117],[12.51595,-32.27486],[38.88176,-48.03306],[34.51034,-26.91792],[32.35222,-26.86027],[32.29584,-26.852],[32.22302,-26.84136],[32.19409,-26.84032],[32.13315,-26.84345],[32.09664,-26.80721],[32.00893,-26.8096],[31.97463,-27.11057],[31.97592,-27.31675],[31.49834,-27.31549],[31.15027,-27.20151],[30.96088,-27.0245],[30.97757,-26.92706],[30.88826,-26.79622],[30.81101,-26.84722],[30.78927,-26.48271],[30.95819,-26.26303],[31.13073,-25.91558],[31.31237,-25.7431],[31.4175,-25.71886],[31.86881,-25.99973],[31.974,-25.95387],[31.92649,-25.84216],[32.00631,-25.65044],[31.97875,-25.46356],[32.01676,-25.38117],[32.03196,-25.10785],[31.9835,-24.29983],[31.90368,-24.18892],[31.87707,-23.95293],[31.77445,-23.90082],[31.70223,-23.72695],[31.67942,-23.60858],[31.56539,-23.47268],[31.55779,-23.176],[31.30611,-22.422]],[[29.33204,-29.45598],[29.28545,-29.58456],[29.12553,-29.76266],[29.16548,-29.91706],[28.9338,-30.05072],[28.80222,-30.10579],[28.68627,-30.12885],[28.399,-30.1592],[28.2319,-30.28476],[28.12073,-30.68072],[27.74814,-30.60635],[27.69467,-30.55862],[27.67819,-30.53437],[27.6521,-30.51707],[27.62137,-30.50509],[27.56781,-30.44562],[27.56901,-30.42504],[27.45452,-30.32239],[27.38108,-30.33456],[27.36649,-30.27246],[27.37293,-30.19401],[27.40778,-30.14577],[27.32555,-30.14785],[27.29603,-30.05473],[27.22719,-30.00718],[27.09489,-29.72796],[27.01016,-29.65439],[27.33464,-29.48161],[27.4358,-29.33465],[27.47254,-29.31968],[27.45125,-29.29708],[27.48679,-29.29349],[27.54258,-29.25575],[27.5158,-29.2261],[27.55974,-29.18954],[27.75458,-28.89839],[27.8907,-28.91612],[27.88933,-28.88156],[27.9392,-28.84864],[27.98675,-28.8787],[28.02503,-28.85991],[28.1317,-28.7293],[28.2348,-28.69471],[28.30518,-28.69531],[28.40612,-28.6215],[28.65091,-28.57025],[28.68043,-28.58744],[29.40524,-29.21246],[29.44883,-29.3772],[29.33204,-29.45598]]]]}},{type:"Feature",properties:{iso1A2:"ZM",iso1A3:"ZMB",iso1N3:"894",wikidata:"Q953",nameEn:"Zambia",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["260"]},geometry:{type:"MultiPolygon",coordinates:[[[[32.95389,-9.40138],[32.76233,-9.31963],[32.75611,-9.28583],[32.53661,-9.24281],[32.49147,-9.14754],[32.43543,-9.11988],[32.25486,-9.13371],[32.16146,-9.05993],[32.08206,-9.04609],[31.98866,-9.07069],[31.94196,-9.02303],[31.94663,-8.93846],[31.81587,-8.88618],[31.71158,-8.91386],[31.57147,-8.81388],[31.57147,-8.70619],[31.37533,-8.60769],[31.00796,-8.58615],[30.79243,-8.27382],[28.88917,-8.4831],[28.9711,-8.66935],[28.38526,-9.23393],[28.36562,-9.30091],[28.52636,-9.35379],[28.51627,-9.44726],[28.56208,-9.49122],[28.68532,-9.78],[28.62795,-9.92942],[28.65032,-10.65133],[28.37241,-11.57848],[28.48357,-11.87532],[29.18592,-12.37921],[29.4992,-12.43843],[29.48404,-12.23604],[29.8139,-12.14898],[29.81551,-13.44683],[29.65078,-13.41844],[29.60531,-13.21685],[29.01918,-13.41353],[28.33199,-12.41375],[27.59932,-12.22123],[27.21025,-11.76157],[27.22541,-11.60323],[27.04351,-11.61312],[26.88687,-12.01868],[26.01777,-11.91488],[25.33058,-11.65767],[25.34069,-11.19707],[24.42612,-11.44975],[24.34528,-11.06816],[24.00027,-10.89356],[24.02603,-11.15368],[23.98804,-12.13149],[24.06672,-12.29058],[23.90937,-12.844],[24.03339,-12.99091],[21.97988,-13.00148],[22.00323,-16.18028],[22.17217,-16.50269],[23.20038,-17.47563],[23.47474,-17.62877],[24.23619,-17.47489],[24.32811,-17.49082],[24.38712,-17.46818],[24.5621,-17.52963],[24.70864,-17.49501],[25.00198,-17.58221],[25.26433,-17.79571],[25.51646,-17.86232],[25.6827,-17.81987],[25.85738,-17.91403],[25.85892,-17.97726],[26.08925,-17.98168],[26.0908,-17.93021],[26.21601,-17.88608],[26.55918,-17.99638],[26.68403,-18.07411],[26.74314,-18.0199],[26.89926,-17.98756],[27.14196,-17.81398],[27.30736,-17.60487],[27.61377,-17.34378],[27.62795,-17.24365],[27.83141,-16.96274],[28.73725,-16.5528],[28.76199,-16.51575],[28.81454,-16.48611],[28.8501,-16.04537],[28.9243,-15.93987],[29.01298,-15.93805],[29.21955,-15.76589],[29.4437,-15.68702],[29.8317,-15.6126],[30.35574,-15.6513],[30.41902,-15.62269],[30.22098,-14.99447],[33.24249,-14.00019],[33.16749,-13.93992],[33.07568,-13.98447],[33.02977,-14.05022],[32.99042,-13.95689],[32.88985,-13.82956],[32.79015,-13.80755],[32.76962,-13.77224],[32.84528,-13.71576],[32.7828,-13.64805],[32.68654,-13.64268],[32.66468,-13.60019],[32.68436,-13.55769],[32.73683,-13.57682],[32.84176,-13.52794],[32.86113,-13.47292],[33.0078,-13.19492],[32.98289,-13.12671],[33.02181,-12.88707],[32.96733,-12.88251],[32.94397,-12.76868],[33.05917,-12.59554],[33.18837,-12.61377],[33.28177,-12.54692],[33.37517,-12.54085],[33.54485,-12.35996],[33.47636,-12.32498],[33.3705,-12.34931],[33.25998,-12.14242],[33.33937,-11.91252],[33.32692,-11.59248],[33.24252,-11.59302],[33.23663,-11.40637],[33.29267,-11.43536],[33.29267,-11.3789],[33.39697,-11.15296],[33.25998,-10.88862],[33.28022,-10.84428],[33.47636,-10.78465],[33.70675,-10.56896],[33.54797,-10.36077],[33.53863,-10.20148],[33.31297,-10.05133],[33.37902,-9.9104],[33.36581,-9.81063],[33.31517,-9.82364],[33.2095,-9.61099],[33.12144,-9.58929],[33.10163,-9.66525],[33.05485,-9.61316],[33.00256,-9.63053],[33.00476,-9.5133],[32.95389,-9.40138]]]]}},{type:"Feature",properties:{iso1A2:"ZW",iso1A3:"ZWE",iso1N3:"716",wikidata:"Q954",nameEn:"Zimbabwe",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["263"]},geometry:{type:"MultiPolygon",coordinates:[[[[30.41902,-15.62269],[30.35574,-15.6513],[29.8317,-15.6126],[29.4437,-15.68702],[29.21955,-15.76589],[29.01298,-15.93805],[28.9243,-15.93987],[28.8501,-16.04537],[28.81454,-16.48611],[28.76199,-16.51575],[28.73725,-16.5528],[27.83141,-16.96274],[27.62795,-17.24365],[27.61377,-17.34378],[27.30736,-17.60487],[27.14196,-17.81398],[26.89926,-17.98756],[26.74314,-18.0199],[26.68403,-18.07411],[26.55918,-17.99638],[26.21601,-17.88608],[26.0908,-17.93021],[26.08925,-17.98168],[25.85892,-17.97726],[25.85738,-17.91403],[25.6827,-17.81987],[25.51646,-17.86232],[25.26433,-17.79571],[25.23909,-17.90832],[25.31799,-18.07091],[25.39972,-18.12691],[25.53465,-18.39041],[25.68859,-18.56165],[25.79217,-18.6355],[25.82353,-18.82808],[25.94326,-18.90362],[25.99837,-19.02943],[25.96226,-19.08152],[26.17227,-19.53709],[26.72246,-19.92707],[27.21278,-20.08244],[27.29831,-20.28935],[27.28865,-20.49873],[27.69361,-20.48531],[27.72972,-20.51735],[27.69171,-21.08409],[27.91407,-21.31621],[28.01669,-21.57624],[28.29416,-21.59037],[28.49942,-21.66634],[28.58114,-21.63455],[29.07763,-21.81877],[29.04023,-21.85864],[29.02191,-21.90647],[29.02191,-21.95665],[29.04108,-22.00563],[29.08495,-22.04867],[29.14501,-22.07275],[29.1974,-22.07472],[29.24648,-22.05967],[29.3533,-22.18363],[29.37703,-22.19581],[29.64609,-22.12917],[29.76848,-22.14128],[29.92242,-22.19408],[30.13147,-22.30841],[30.2265,-22.2961],[30.28351,-22.35587],[30.38614,-22.34533],[30.48686,-22.31368],[30.6294,-22.32599],[30.86696,-22.28907],[31.08932,-22.34884],[31.16344,-22.32599],[31.30611,-22.422],[31.38336,-22.36919],[32.41234,-21.31246],[32.48236,-21.32873],[32.37115,-21.133],[32.51644,-20.91929],[32.48122,-20.63319],[32.55167,-20.56312],[32.66174,-20.56106],[32.85987,-20.27841],[32.85987,-20.16686],[32.93032,-20.03868],[33.01178,-20.02007],[33.06461,-19.77787],[32.95013,-19.67219],[32.84666,-19.68462],[32.84446,-19.48343],[32.78282,-19.47513],[32.77966,-19.36098],[32.85107,-19.29238],[32.87088,-19.09279],[32.84006,-19.0262],[32.72118,-19.02204],[32.69917,-18.94293],[32.73439,-18.92628],[32.70137,-18.84712],[32.82465,-18.77419],[32.9017,-18.7992],[32.95013,-18.69079],[32.88629,-18.58023],[32.88629,-18.51344],[33.02278,-18.4696],[33.03159,-18.35054],[32.94133,-17.99705],[33.0492,-17.60298],[32.98536,-17.55891],[32.96554,-17.48964],[33.0426,-17.3468],[33.00517,-17.30477],[32.96554,-17.11971],[32.84113,-16.92259],[32.91051,-16.89446],[32.97655,-16.70689],[32.78943,-16.70267],[32.69917,-16.66893],[32.71017,-16.59932],[32.42838,-16.4727],[32.28529,-16.43892],[32.02772,-16.43892],[31.91324,-16.41569],[31.90223,-16.34388],[31.67988,-16.19595],[31.42451,-16.15154],[31.30563,-16.01193],[31.13171,-15.98019],[30.97761,-16.05848],[30.91597,-15.99924],[30.42568,-15.9962],[30.41902,-15.62269]]]]}}]},JF=ZF,a8={},gi={},eL=/(?=(?!^(and|the|of|el|la|de)$))(\b(and|the|of|el|la|de)\b)|[-_ .,'()&[\]/]/gi;function cE(i){let e=i||"";return e.charAt(0)==="."?e.toUpperCase():e.replace(eL,"").toUpperCase()}var lo=["subterritory","territory","subcountryGroup","country","sharedLandform","intermediateRegion","subregion","region","subunion","union","unitedNations","world"];tL(JF);function tL(i){let e=["iso1A2","iso1A3","m49","wikidata","emojiFlag","ccTLD","nameEn"],t=[];for(let y of i.features){let x=y.properties;x.id=x.iso1A2||x.m49||x.wikidata,n(y),o(y),a(y),l(y),s(y),p(y),g(y),y.geometry&&t.push(y)}for(let y of i.features)y.properties.groups=y.properties.groups.map(x=>gi[x].properties.id),m(y);for(let y of i.features)u(y),h(y),d(y),f(y),c(y);for(let y of i.features)y.properties.groups.sort((x,b)=>lo.indexOf(gi[x].properties.level)-lo.indexOf(gi[b].properties.level)),y.properties.members&&y.properties.members.sort((x,b)=>{let _=lo.indexOf(gi[x].properties.level)-lo.indexOf(gi[b].properties.level);return _===0?i.features.indexOf(gi[x])-i.features.indexOf(gi[b]):_});a8=(0,lE.default)({type:"FeatureCollection",features:t});function s(y){let x=y.properties;x.groups||(x.groups=[]),y.geometry&&x.country&&x.groups.push(x.country),x.m49!=="001"&&x.groups.push("001")}function n(y){let x=y.properties;!x.m49&&x.iso1N3&&(x.m49=x.iso1N3)}function o(y){let x=y.properties;x.level!=="unitedNations"&&!x.ccTLD&&x.iso1A2&&(x.ccTLD="."+x.iso1A2.toLowerCase())}function a(y){let x=y.properties;!x.isoStatus&&x.iso1A2&&(x.isoStatus="official")}function l(y){let x=y.properties;x.level||(x.country?!x.iso1A2||x.isoStatus==="official"?x.level="territory":x.level="subterritory":x.level="country")}function c(y){let x=y.properties;if(y.geometry||!x.members)return;let b=lo.indexOf(x.level),_=[];x.members.forEach((w,A)=>{let v=gi[w].properties.groups.filter(E=>E!==y.properties.id&&b<lo.indexOf(gi[E].properties.level));A===0?_=v:_=_.filter(E=>v.indexOf(E)!==-1)}),x.groups=x.groups.concat(_.filter(w=>x.groups.indexOf(w)===-1));for(let w of _){let A=gi[w];A.properties.members.indexOf(x.id)===-1&&A.properties.members.push(x.id)}}function u(y){let x=y.properties;if(y.geometry)x.roadSpeedUnit||(x.roadSpeedUnit="km/h");else if(x.members){let b=Array.from(new Set(x.members.map(_=>{let w=gi[_];if(w.geometry)return w.properties.roadSpeedUnit||"km/h"}).filter(Boolean)));b.length===1&&(x.roadSpeedUnit=b[0])}}function h(y){let x=y.properties;if(y.geometry)x.roadHeightUnit||(x.roadHeightUnit="m");else if(x.members){let b=Array.from(new Set(x.members.map(_=>{let w=gi[_];if(w.geometry)return w.properties.roadHeightUnit||"m"}).filter(Boolean)));b.length===1&&(x.roadHeightUnit=b[0])}}function d(y){let x=y.properties;if(y.geometry)x.driveSide||(x.driveSide="right");else if(x.members){let b=Array.from(new Set(x.members.map(_=>{let w=gi[_];if(w.geometry)return w.properties.driveSide||"right"}).filter(Boolean)));b.length===1&&(x.driveSide=b[0])}}function f(y){let x=y.properties;!y.geometry&&x.members&&(x.callingCodes=Array.from(new Set(x.members.reduce((b,_)=>{let w=gi[_];return w.geometry&&w.properties.callingCodes?b.concat(w.properties.callingCodes):b},[]))))}function p(y){if(!y.properties.iso1A2)return;let x=y.properties.iso1A2.replace(/./g,function(b){return String.fromCodePoint(b.charCodeAt(0)+127397)});y.properties.emojiFlag=x}function m(y){for(let x of y.properties.groups){let b=gi[x];b.properties.members||(b.properties.members=[]),b.properties.members.push(y.properties.id)}}function g(y){let x=[];for(let b of e){let _=y.properties[b];_&&x.push(_)}for(let b of y.properties.aliases||[])x.push(b);for(let b of x){let _=cE(b);gi[_]=y}}}function iL(i){return Array.isArray(i)?i:i.coordinates?i.coordinates:i.geometry.coordinates}function uE(i){let e=iL(i),t=a8(e);return t?gi[t.id]:null}function rL(i){let e=uE(i);if(!e)return null;let t=e.properties.country||e.properties.iso1A2;return gi[t]||null}var hE={level:void 0,maxLevel:void 0,withProp:void 0};function sL(i,e){let t=e.level||"country",r=e.maxLevel||"world",s=e.withProp,n=lo.indexOf(t);if(n===-1)return null;let o=lo.indexOf(r);if(o===-1||o<n)return null;if(t==="country"){let c=rL(i);if(c&&(!s||c.properties[s]))return c}return oL(i).find(c=>{let u=lo.indexOf(c.properties.level);return(c.properties.level===t||u>n&&u<=o)&&(!s||c.properties[s])?c:!1})||null}function l8(i){let e;return typeof i=="number"?(e=i.toString(),e.length===1?e="00"+e:e.length===2&&(e="0"+e)):e=cE(i),gi[e]||null}function nL(i){return a8.bbox(i).map(e=>gi[e.id])}function dE(i){return typeof i=="object"?uE(i):l8(i)}function V2(i,e=hE){return typeof i=="object"?sL(i,e):l8(i)}function ea(i,e=hE){e.withProp="iso1A2";let t=V2(i,e);return t&&t.properties.iso1A2||null}function oL(i,e){let t;if(Array.isArray(i)&&i.length===4)t=nL(i);else{let s=dE(i);t=s?[s]:[]}if(!t.length)return[];let r;!e||typeof i=="object"?r=t.slice():r=[];for(let s of t){let n=s.properties;for(let o of n.groups){let a=gi[o];r.indexOf(a)===-1&&r.push(a)}}return r}function aL(i,e){let t=l8(i);if(!t)return[];let r=[];e||r.push(t);let s=t.properties;for(let n of s.members||[])r.push(gi[n]);return r}function fE(i){var r;let e=aL(i,!1);if(e.length===0)return null;let t=[];for(let s of e)((r=s.geometry)==null?void 0:r.type)==="MultiPolygon"&&s.geometry.coordinates&&(t=t.concat(s.geometry.coordinates));return{type:"Feature",properties:e[0].properties,geometry:{type:"MultiPolygon",coordinates:t}}}function pE(i){let e=dE(i);return e&&e.properties.roadSpeedUnit||null}var kh=i=>()=>i;var W2=i=>{let e=i?(t,r)=>r.minus(t).abs().isLessThanOrEqualTo(i):kh(!1);return(t,r)=>e(t,r)?0:t.comparedTo(r)};function mE(i){let e=i?(t,r,s,n,o)=>t.exponentiatedBy(2).isLessThanOrEqualTo(n.minus(r).exponentiatedBy(2).plus(o.minus(s).exponentiatedBy(2)).times(i)):kh(!1);return(t,r,s)=>{let n=t.x,o=t.y,a=s.x,l=s.y,c=o.minus(l).times(r.x.minus(a)).minus(n.minus(a).times(r.y.minus(l)));return e(c,n,o,a,l)?0:c.comparedTo(0)}}var cL=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,c8=Math.ceil,Ss=Math.floor,Br="[BigNumber Error] ",gE=Br+"Number primitive has more than 15 significant digits: ",Qs=1e14,it=14,u8=9007199254740991,h8=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],ta=1e7,Oi=1e9;function yE(i){var e,t,r,s=x.prototype={constructor:x,toString:null,valueOf:null},n=new x(1),o=20,a=4,l=-7,c=21,u=-1e7,h=1e7,d=!1,f=1,p=0,m={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},g="0123456789abcdefghijklmnopqrstuvwxyz",y=!0;function x(v,E){var S,M,I,T,C,P,D,O,R=this;if(!(R instanceof x))return new x(v,E);if(E==null){if(v&&v._isBigNumber===!0){R.s=v.s,!v.c||v.e>h?R.c=R.e=null:v.e<u?R.c=[R.e=0]:(R.e=v.e,R.c=v.c.slice());return}if((P=typeof v=="number")&&v*0==0){if(R.s=1/v<0?(v=-v,-1):1,v===~~v){for(T=0,C=v;C>=10;C/=10,T++);T>h?R.c=R.e=null:(R.e=T,R.c=[v]);return}O=String(v)}else{if(!cL.test(O=String(v)))return r(R,O,P);R.s=O.charCodeAt(0)==45?(O=O.slice(1),-1):1}(T=O.indexOf("."))>-1&&(O=O.replace(".","")),(C=O.search(/e/i))>0?(T<0&&(T=C),T+=+O.slice(C+1),O=O.substring(0,C)):T<0&&(T=O.length)}else{if(ri(E,2,g.length,"Base"),E==10&&y)return R=new x(v),A(R,o+R.e+1,a);if(O=String(v),P=typeof v=="number"){if(v*0!=0)return r(R,O,P,E);if(R.s=1/v<0?(O=O.slice(1),-1):1,x.DEBUG&&O.replace(/^0\.0*|\./,"").length>15)throw Error(gE+v)}else R.s=O.charCodeAt(0)===45?(O=O.slice(1),-1):1;for(S=g.slice(0,E),T=C=0,D=O.length;C<D;C++)if(S.indexOf(M=O.charAt(C))<0){if(M=="."){if(C>T){T=D;continue}}else if(!I&&(O==O.toUpperCase()&&(O=O.toLowerCase())||O==O.toLowerCase()&&(O=O.toUpperCase()))){I=!0,C=-1,T=0;continue}return r(R,String(v),P,E)}P=!1,O=t(O,E,10,R.s),(T=O.indexOf("."))>-1?O=O.replace(".",""):T=O.length}for(C=0;O.charCodeAt(C)===48;C++);for(D=O.length;O.charCodeAt(--D)===48;);if(O=O.slice(C,++D)){if(D-=C,P&&x.DEBUG&&D>15&&(v>u8||v!==Ss(v)))throw Error(gE+R.s*v);if((T=T-C-1)>h)R.c=R.e=null;else if(T<u)R.c=[R.e=0];else{if(R.e=T,R.c=[],C=(T+1)%it,T<0&&(C+=it),C<D){for(C&&R.c.push(+O.slice(0,C)),D-=it;C<D;)R.c.push(+O.slice(C,C+=it));C=it-(O=O.slice(C)).length}else C-=D;for(;C--;O+="0");R.c.push(+O)}}else R.c=[R.e=0]}x.clone=yE,x.ROUND_UP=0,x.ROUND_DOWN=1,x.ROUND_CEIL=2,x.ROUND_FLOOR=3,x.ROUND_HALF_UP=4,x.ROUND_HALF_DOWN=5,x.ROUND_HALF_EVEN=6,x.ROUND_HALF_CEIL=7,x.ROUND_HALF_FLOOR=8,x.EUCLID=9,x.config=x.set=function(v){var E,S;if(v!=null)if(typeof v=="object"){if(v.hasOwnProperty(E="DECIMAL_PLACES")&&(S=v[E],ri(S,0,Oi,E),o=S),v.hasOwnProperty(E="ROUNDING_MODE")&&(S=v[E],ri(S,0,8,E),a=S),v.hasOwnProperty(E="EXPONENTIAL_AT")&&(S=v[E],S&&S.pop?(ri(S[0],-Oi,0,E),ri(S[1],0,Oi,E),l=S[0],c=S[1]):(ri(S,-Oi,Oi,E),l=-(c=S<0?-S:S))),v.hasOwnProperty(E="RANGE"))if(S=v[E],S&&S.pop)ri(S[0],-Oi,-1,E),ri(S[1],1,Oi,E),u=S[0],h=S[1];else if(ri(S,-Oi,Oi,E),S)u=-(h=S<0?-S:S);else throw Error(Br+E+" cannot be zero: "+S);if(v.hasOwnProperty(E="CRYPTO"))if(S=v[E],S===!!S)if(S)if(typeof crypto!="undefined"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))d=S;else throw d=!S,Error(Br+"crypto unavailable");else d=S;else throw Error(Br+E+" not true or false: "+S);if(v.hasOwnProperty(E="MODULO_MODE")&&(S=v[E],ri(S,0,9,E),f=S),v.hasOwnProperty(E="POW_PRECISION")&&(S=v[E],ri(S,0,Oi,E),p=S),v.hasOwnProperty(E="FORMAT"))if(S=v[E],typeof S=="object")m=S;else throw Error(Br+E+" not an object: "+S);if(v.hasOwnProperty(E="ALPHABET"))if(S=v[E],typeof S=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(S))y=S.slice(0,10)=="0123456789",g=S;else throw Error(Br+E+" invalid: "+S)}else throw Error(Br+"Object expected: "+v);return{DECIMAL_PLACES:o,ROUNDING_MODE:a,EXPONENTIAL_AT:[l,c],RANGE:[u,h],CRYPTO:d,MODULO_MODE:f,POW_PRECISION:p,FORMAT:m,ALPHABET:g}},x.isBigNumber=function(v){if(!v||v._isBigNumber!==!0)return!1;if(!x.DEBUG)return!0;var E,S,M=v.c,I=v.e,T=v.s;e:if({}.toString.call(M)=="[object Array]"){if((T===1||T===-1)&&I>=-Oi&&I<=Oi&&I===Ss(I)){if(M[0]===0){if(I===0&&M.length===1)return!0;break e}if(E=(I+1)%it,E<1&&(E+=it),String(M[0]).length==E){for(E=0;E<M.length;E++)if(S=M[E],S<0||S>=Qs||S!==Ss(S))break e;if(S!==0)return!0}}}else if(M===null&&I===null&&(T===null||T===1||T===-1))return!0;throw Error(Br+"Invalid BigNumber: "+v)},x.maximum=x.max=function(){return _(arguments,-1)},x.minimum=x.min=function(){return _(arguments,1)},x.random=function(){var v=9007199254740992,E=Math.random()*v&2097151?function(){return Ss(Math.random()*v)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(S){var M,I,T,C,P,D=0,O=[],R=new x(n);if(S==null?S=o:ri(S,0,Oi),C=c8(S/it),d)if(crypto.getRandomValues){for(M=crypto.getRandomValues(new Uint32Array(C*=2));D<C;)P=M[D]*131072+(M[D+1]>>>11),P>=9e15?(I=crypto.getRandomValues(new Uint32Array(2)),M[D]=I[0],M[D+1]=I[1]):(O.push(P%1e14),D+=2);D=C/2}else if(crypto.randomBytes){for(M=crypto.randomBytes(C*=7);D<C;)P=(M[D]&31)*281474976710656+M[D+1]*1099511627776+M[D+2]*4294967296+M[D+3]*16777216+(M[D+4]<<16)+(M[D+5]<<8)+M[D+6],P>=9e15?crypto.randomBytes(7).copy(M,D):(O.push(P%1e14),D+=7);D=C/7}else throw d=!1,Error(Br+"crypto unavailable");if(!d)for(;D<C;)P=E(),P<9e15&&(O[D++]=P%1e14);for(C=O[--D],S%=it,C&&S&&(P=h8[it-S],O[D]=Ss(C/P)*P);O[D]===0;O.pop(),D--);if(D<0)O=[T=0];else{for(T=-1;O[0]===0;O.splice(0,1),T-=it);for(D=1,P=O[0];P>=10;P/=10,D++);D<it&&(T-=it-D)}return R.e=T,R.c=O,R}}(),x.sum=function(){for(var v=1,E=arguments,S=new x(E[0]);v<E.length;)S=S.plus(E[v++]);return S},t=function(){var v="0123456789";function E(S,M,I,T){for(var C,P=[0],D,O=0,R=S.length;O<R;){for(D=P.length;D--;P[D]*=M);for(P[0]+=T.indexOf(S.charAt(O++)),C=0;C<P.length;C++)P[C]>I-1&&(P[C+1]==null&&(P[C+1]=0),P[C+1]+=P[C]/I|0,P[C]%=I)}return P.reverse()}return function(S,M,I,T,C){var P,D,O,R,N,F,B,$,U=S.indexOf("."),H=o,z=a;for(U>=0&&(R=p,p=0,S=S.replace(".",""),$=new x(M),F=$.pow(S.length-U),p=R,$.c=E(co(As(F.c),F.e,"0"),10,I,v),$.e=$.c.length),B=E(S,M,I,C?(P=g,v):(P=v,g)),O=R=B.length;B[--R]==0;B.pop());if(!B[0])return P.charAt(0);if(U<0?--O:(F.c=B,F.e=O,F.s=T,F=e(F,$,H,z,I),B=F.c,N=F.r,O=F.e),D=O+H+1,U=B[D],R=I/2,N=N||D<0||B[D+1]!=null,N=z<4?(U!=null||N)&&(z==0||z==(F.s<0?3:2)):U>R||U==R&&(z==4||N||z==6&&B[D-1]&1||z==(F.s<0?8:7)),D<1||!B[0])S=N?co(P.charAt(1),-H,P.charAt(0)):P.charAt(0);else{if(B.length=D,N)for(--I;++B[--D]>I;)B[D]=0,D||(++O,B=[1].concat(B));for(R=B.length;!B[--R];);for(U=0,S="";U<=R;S+=P.charAt(B[U++]));S=co(S,O,P.charAt(0))}return S}}(),e=function(){function v(M,I,T){var C,P,D,O,R=0,N=M.length,F=I%ta,B=I/ta|0;for(M=M.slice();N--;)D=M[N]%ta,O=M[N]/ta|0,C=B*D+O*F,P=F*D+C%ta*ta+R,R=(P/T|0)+(C/ta|0)+B*O,M[N]=P%T;return R&&(M=[R].concat(M)),M}function E(M,I,T,C){var P,D;if(T!=C)D=T>C?1:-1;else for(P=D=0;P<T;P++)if(M[P]!=I[P]){D=M[P]>I[P]?1:-1;break}return D}function S(M,I,T,C){for(var P=0;T--;)M[T]-=P,P=M[T]<I[T]?1:0,M[T]=P*C+M[T]-I[T];for(;!M[0]&&M.length>1;M.splice(0,1));}return function(M,I,T,C,P){var D,O,R,N,F,B,$,U,H,z,j,X,K,Y,oe,re,W,Z=M.s==I.s?1:-1,Q=M.c,q=I.c;if(!Q||!Q[0]||!q||!q[0])return new x(!M.s||!I.s||(Q?q&&Q[0]==q[0]:!q)?NaN:Q&&Q[0]==0||!q?Z*0:Z/0);for(U=new x(Z),H=U.c=[],O=M.e-I.e,Z=T+O+1,P||(P=Qs,O=Cs(M.e/it)-Cs(I.e/it),Z=Z/it|0),R=0;q[R]==(Q[R]||0);R++);if(q[R]>(Q[R]||0)&&O--,Z<0)H.push(1),N=!0;else{for(Y=Q.length,re=q.length,R=0,Z+=2,F=Ss(P/(q[0]+1)),F>1&&(q=v(q,F,P),Q=v(Q,F,P),re=q.length,Y=Q.length),K=re,z=Q.slice(0,re),j=z.length;j<re;z[j++]=0);W=q.slice(),W=[0].concat(W),oe=q[0],q[1]>=P/2&&oe++;do{if(F=0,D=E(q,z,re,j),D<0){if(X=z[0],re!=j&&(X=X*P+(z[1]||0)),F=Ss(X/oe),F>1)for(F>=P&&(F=P-1),B=v(q,F,P),$=B.length,j=z.length;E(B,z,$,j)==1;)F--,S(B,re<$?W:q,$,P),$=B.length,D=1;else F==0&&(D=F=1),B=q.slice(),$=B.length;if($<j&&(B=[0].concat(B)),S(z,B,j,P),j=z.length,D==-1)for(;E(q,z,re,j)<1;)F++,S(z,re<j?W:q,j,P),j=z.length}else D===0&&(F++,z=[0]);H[R++]=F,z[0]?z[j++]=Q[K]||0:(z=[Q[K]],j=1)}while((K++<Y||z[0]!=null)&&Z--);N=z[0]!=null,H[0]||H.splice(0,1)}if(P==Qs){for(R=1,Z=H[0];Z>=10;Z/=10,R++);A(U,T+(U.e=R+O*it-1)+1,C,N)}else U.e=O,U.r=+N;return U}}();function b(v,E,S,M){var I,T,C,P,D;if(S==null?S=a:ri(S,0,8),!v.c)return v.toString();if(I=v.c[0],C=v.e,E==null)D=As(v.c),D=M==1||M==2&&(C<=l||C>=c)?Ih(D,C):co(D,C,"0");else if(v=A(new x(v),E,S),T=v.e,D=As(v.c),P=D.length,M==1||M==2&&(E<=T||T<=l)){for(;P<E;D+="0",P++);D=Ih(D,T)}else if(E-=C,D=co(D,T,"0"),T+1>P){if(--E>0)for(D+=".";E--;D+="0");}else if(E+=T-P,E>0)for(T+1==P&&(D+=".");E--;D+="0");return v.s<0&&I?"-"+D:D}function _(v,E){for(var S,M,I=1,T=new x(v[0]);I<v.length;I++)M=new x(v[I]),(!M.s||(S=qa(T,M))===E||S===0&&T.s===E)&&(T=M);return T}function w(v,E,S){for(var M=1,I=E.length;!E[--I];E.pop());for(I=E[0];I>=10;I/=10,M++);return(S=M+S*it-1)>h?v.c=v.e=null:S<u?v.c=[v.e=0]:(v.e=S,v.c=E),v}r=function(){var v=/^(-?)0([xbo])(?=\w[\w.]*$)/i,E=/^([^.]+)\.$/,S=/^\.([^.]+)$/,M=/^-?(Infinity|NaN)$/,I=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(T,C,P,D){var O,R=P?C:C.replace(I,"");if(M.test(R))T.s=isNaN(R)?null:R<0?-1:1;else{if(!P&&(R=R.replace(v,function(N,F,B){return O=(B=B.toLowerCase())=="x"?16:B=="b"?2:8,!D||D==O?F:N}),D&&(O=D,R=R.replace(E,"$1").replace(S,"0.$1")),C!=R))return new x(R,O);if(x.DEBUG)throw Error(Br+"Not a"+(D?" base "+D:"")+" number: "+C);T.s=null}T.c=T.e=null}}();function A(v,E,S,M){var I,T,C,P,D,O,R,N=v.c,F=h8;if(N){e:{for(I=1,P=N[0];P>=10;P/=10,I++);if(T=E-I,T<0)T+=it,C=E,D=N[O=0],R=Ss(D/F[I-C-1]%10);else if(O=c8((T+1)/it),O>=N.length)if(M){for(;N.length<=O;N.push(0));D=R=0,I=1,T%=it,C=T-it+1}else break e;else{for(D=P=N[O],I=1;P>=10;P/=10,I++);T%=it,C=T-it+I,R=C<0?0:Ss(D/F[I-C-1]%10)}if(M=M||E<0||N[O+1]!=null||(C<0?D:D%F[I-C-1]),M=S<4?(R||M)&&(S==0||S==(v.s<0?3:2)):R>5||R==5&&(S==4||M||S==6&&(T>0?C>0?D/F[I-C]:0:N[O-1])%10&1||S==(v.s<0?8:7)),E<1||!N[0])return N.length=0,M?(E-=v.e+1,N[0]=F[(it-E%it)%it],v.e=-E||0):N[0]=v.e=0,v;if(T==0?(N.length=O,P=1,O--):(N.length=O+1,P=F[it-T],N[O]=C>0?Ss(D/F[I-C]%F[C])*P:0),M)for(;;)if(O==0){for(T=1,C=N[0];C>=10;C/=10,T++);for(C=N[0]+=P,P=1;C>=10;C/=10,P++);T!=P&&(v.e++,N[0]==Qs&&(N[0]=1));break}else{if(N[O]+=P,N[O]!=Qs)break;N[O--]=0,P=1}for(T=N.length;N[--T]===0;N.pop());}v.e>h?v.c=v.e=null:v.e<u&&(v.c=[v.e=0])}return v}function k(v){var E,S=v.e;return S===null?v.toString():(E=As(v.c),E=S<=l||S>=c?Ih(E,S):co(E,S,"0"),v.s<0?"-"+E:E)}return s.absoluteValue=s.abs=function(){var v=new x(this);return v.s<0&&(v.s=1),v},s.comparedTo=function(v,E){return qa(this,new x(v,E))},s.decimalPlaces=s.dp=function(v,E){var S,M,I,T=this;if(v!=null)return ri(v,0,Oi),E==null?E=a:ri(E,0,8),A(new x(T),v+T.e+1,E);if(!(S=T.c))return null;if(M=((I=S.length-1)-Cs(this.e/it))*it,I=S[I])for(;I%10==0;I/=10,M--);return M<0&&(M=0),M},s.dividedBy=s.div=function(v,E){return e(this,new x(v,E),o,a)},s.dividedToIntegerBy=s.idiv=function(v,E){return e(this,new x(v,E),0,1)},s.exponentiatedBy=s.pow=function(v,E){var S,M,I,T,C,P,D,O,R,N=this;if(v=new x(v),v.c&&!v.isInteger())throw Error(Br+"Exponent not an integer: "+k(v));if(E!=null&&(E=new x(E)),P=v.e>14,!N.c||!N.c[0]||N.c[0]==1&&!N.e&&N.c.length==1||!v.c||!v.c[0])return R=new x(Math.pow(+k(N),P?v.s*(2-Th(v)):+k(v))),E?R.mod(E):R;if(D=v.s<0,E){if(E.c?!E.c[0]:!E.s)return new x(NaN);M=!D&&N.isInteger()&&E.isInteger(),M&&(N=N.mod(E))}else{if(v.e>9&&(N.e>0||N.e<-1||(N.e==0?N.c[0]>1||P&&N.c[1]>=24e7:N.c[0]<8e13||P&&N.c[0]<=9999975e7)))return T=N.s<0&&Th(v)?-0:0,N.e>-1&&(T=1/T),new x(D?1/T:T);p&&(T=c8(p/it+2))}for(P?(S=new x(.5),D&&(v.s=1),O=Th(v)):(I=Math.abs(+k(v)),O=I%2),R=new x(n);;){if(O){if(R=R.times(N),!R.c)break;T?R.c.length>T&&(R.c.length=T):M&&(R=R.mod(E))}if(I){if(I=Ss(I/2),I===0)break;O=I%2}else if(v=v.times(S),A(v,v.e+1,1),v.e>14)O=Th(v);else{if(I=+k(v),I===0)break;O=I%2}N=N.times(N),T?N.c&&N.c.length>T&&(N.c.length=T):M&&(N=N.mod(E))}return M?R:(D&&(R=n.div(R)),E?R.mod(E):T?A(R,p,a,C):R)},s.integerValue=function(v){var E=new x(this);return v==null?v=a:ri(v,0,8),A(E,E.e+1,v)},s.isEqualTo=s.eq=function(v,E){return qa(this,new x(v,E))===0},s.isFinite=function(){return!!this.c},s.isGreaterThan=s.gt=function(v,E){return qa(this,new x(v,E))>0},s.isGreaterThanOrEqualTo=s.gte=function(v,E){return(E=qa(this,new x(v,E)))===1||E===0},s.isInteger=function(){return!!this.c&&Cs(this.e/it)>this.c.length-2},s.isLessThan=s.lt=function(v,E){return qa(this,new x(v,E))<0},s.isLessThanOrEqualTo=s.lte=function(v,E){return(E=qa(this,new x(v,E)))===-1||E===0},s.isNaN=function(){return!this.s},s.isNegative=function(){return this.s<0},s.isPositive=function(){return this.s>0},s.isZero=function(){return!!this.c&&this.c[0]==0},s.minus=function(v,E){var S,M,I,T,C=this,P=C.s;if(v=new x(v,E),E=v.s,!P||!E)return new x(NaN);if(P!=E)return v.s=-E,C.plus(v);var D=C.e/it,O=v.e/it,R=C.c,N=v.c;if(!D||!O){if(!R||!N)return R?(v.s=-E,v):new x(N?C:NaN);if(!R[0]||!N[0])return N[0]?(v.s=-E,v):new x(R[0]?C:a==3?-0:0)}if(D=Cs(D),O=Cs(O),R=R.slice(),P=D-O){for((T=P<0)?(P=-P,I=R):(O=D,I=N),I.reverse(),E=P;E--;I.push(0));I.reverse()}else for(M=(T=(P=R.length)<(E=N.length))?P:E,P=E=0;E<M;E++)if(R[E]!=N[E]){T=R[E]<N[E];break}if(T&&(I=R,R=N,N=I,v.s=-v.s),E=(M=N.length)-(S=R.length),E>0)for(;E--;R[S++]=0);for(E=Qs-1;M>P;){if(R[--M]<N[M]){for(S=M;S&&!R[--S];R[S]=E);--R[S],R[M]+=Qs}R[M]-=N[M]}for(;R[0]==0;R.splice(0,1),--O);return R[0]?w(v,R,O):(v.s=a==3?-1:1,v.c=[v.e=0],v)},s.modulo=s.mod=function(v,E){var S,M,I=this;return v=new x(v,E),!I.c||!v.s||v.c&&!v.c[0]?new x(NaN):!v.c||I.c&&!I.c[0]?new x(I):(f==9?(M=v.s,v.s=1,S=e(I,v,0,3),v.s=M,S.s*=M):S=e(I,v,0,f),v=I.minus(S.times(v)),!v.c[0]&&f==1&&(v.s=I.s),v)},s.multipliedBy=s.times=function(v,E){var S,M,I,T,C,P,D,O,R,N,F,B,$,U,H,z=this,j=z.c,X=(v=new x(v,E)).c;if(!j||!X||!j[0]||!X[0])return!z.s||!v.s||j&&!j[0]&&!X||X&&!X[0]&&!j?v.c=v.e=v.s=null:(v.s*=z.s,!j||!X?v.c=v.e=null:(v.c=[0],v.e=0)),v;for(M=Cs(z.e/it)+Cs(v.e/it),v.s*=z.s,D=j.length,N=X.length,D<N&&($=j,j=X,X=$,I=D,D=N,N=I),I=D+N,$=[];I--;$.push(0));for(U=Qs,H=ta,I=N;--I>=0;){for(S=0,F=X[I]%H,B=X[I]/H|0,C=D,T=I+C;T>I;)O=j[--C]%H,R=j[C]/H|0,P=B*O+R*F,O=F*O+P%H*H+$[T]+S,S=(O/U|0)+(P/H|0)+B*R,$[T--]=O%U;$[T]=S}return S?++M:$.splice(0,1),w(v,$,M)},s.negated=function(){var v=new x(this);return v.s=-v.s||null,v},s.plus=function(v,E){var S,M=this,I=M.s;if(v=new x(v,E),E=v.s,!I||!E)return new x(NaN);if(I!=E)return v.s=-E,M.minus(v);var T=M.e/it,C=v.e/it,P=M.c,D=v.c;if(!T||!C){if(!P||!D)return new x(I/0);if(!P[0]||!D[0])return D[0]?v:new x(P[0]?M:I*0)}if(T=Cs(T),C=Cs(C),P=P.slice(),I=T-C){for(I>0?(C=T,S=D):(I=-I,S=P),S.reverse();I--;S.push(0));S.reverse()}for(I=P.length,E=D.length,I-E<0&&(S=D,D=P,P=S,E=I),I=0;E;)I=(P[--E]=P[E]+D[E]+I)/Qs|0,P[E]=Qs===P[E]?0:P[E]%Qs;return I&&(P=[I].concat(P),++C),w(v,P,C)},s.precision=s.sd=function(v,E){var S,M,I,T=this;if(v!=null&&v!==!!v)return ri(v,1,Oi),E==null?E=a:ri(E,0,8),A(new x(T),v,E);if(!(S=T.c))return null;if(I=S.length-1,M=I*it+1,I=S[I]){for(;I%10==0;I/=10,M--);for(I=S[0];I>=10;I/=10,M++);}return v&&T.e+1>M&&(M=T.e+1),M},s.shiftedBy=function(v){return ri(v,-u8,u8),this.times("1e"+v)},s.squareRoot=s.sqrt=function(){var v,E,S,M,I,T=this,C=T.c,P=T.s,D=T.e,O=o+4,R=new x("0.5");if(P!==1||!C||!C[0])return new x(!P||P<0&&(!C||C[0])?NaN:C?T:1/0);if(P=Math.sqrt(+k(T)),P==0||P==1/0?(E=As(C),(E.length+D)%2==0&&(E+="0"),P=Math.sqrt(+E),D=Cs((D+1)/2)-(D<0||D%2),P==1/0?E="5e"+D:(E=P.toExponential(),E=E.slice(0,E.indexOf("e")+1)+D),S=new x(E)):S=new x(P+""),S.c[0]){for(D=S.e,P=D+O,P<3&&(P=0);;)if(I=S,S=R.times(I.plus(e(T,I,O,1))),As(I.c).slice(0,P)===(E=As(S.c)).slice(0,P))if(S.e<D&&--P,E=E.slice(P-3,P+1),E=="9999"||!M&&E=="4999"){if(!M&&(A(I,I.e+o+2,0),I.times(I).eq(T))){S=I;break}O+=4,P+=4,M=1}else{(!+E||!+E.slice(1)&&E.charAt(0)=="5")&&(A(S,S.e+o+2,1),v=!S.times(S).eq(T));break}}return A(S,S.e+o+1,a,v)},s.toExponential=function(v,E){return v!=null&&(ri(v,0,Oi),v++),b(this,v,E,1)},s.toFixed=function(v,E){return v!=null&&(ri(v,0,Oi),v=v+this.e+1),b(this,v,E)},s.toFormat=function(v,E,S){var M,I=this;if(S==null)v!=null&&E&&typeof E=="object"?(S=E,E=null):v&&typeof v=="object"?(S=v,v=E=null):S=m;else if(typeof S!="object")throw Error(Br+"Argument not an object: "+S);if(M=I.toFixed(v,E),I.c){var T,C=M.split("."),P=+S.groupSize,D=+S.secondaryGroupSize,O=S.groupSeparator||"",R=C[0],N=C[1],F=I.s<0,B=F?R.slice(1):R,$=B.length;if(D&&(T=P,P=D,D=T,$-=T),P>0&&$>0){for(T=$%P||P,R=B.substr(0,T);T<$;T+=P)R+=O+B.substr(T,P);D>0&&(R+=O+B.slice(T)),F&&(R="-"+R)}M=N?R+(S.decimalSeparator||"")+((D=+S.fractionGroupSize)?N.replace(new RegExp("\\d{"+D+"}\\B","g"),"$&"+(S.fractionGroupSeparator||"")):N):R}return(S.prefix||"")+M+(S.suffix||"")},s.toFraction=function(v){var E,S,M,I,T,C,P,D,O,R,N,F,B=this,$=B.c;if(v!=null&&(P=new x(v),!P.isInteger()&&(P.c||P.s!==1)||P.lt(n)))throw Error(Br+"Argument "+(P.isInteger()?"out of range: ":"not an integer: ")+k(P));if(!$)return new x(B);for(E=new x(n),O=S=new x(n),M=D=new x(n),F=As($),T=E.e=F.length-B.e-1,E.c[0]=h8[(C=T%it)<0?it+C:C],v=!v||P.comparedTo(E)>0?T>0?E:O:P,C=h,h=1/0,P=new x(F),D.c[0]=0;R=e(P,E,0,1),I=S.plus(R.times(M)),I.comparedTo(v)!=1;)S=M,M=I,O=D.plus(R.times(I=O)),D=I,E=P.minus(R.times(I=E)),P=I;return I=e(v.minus(S),M,0,1),D=D.plus(I.times(O)),S=S.plus(I.times(M)),D.s=O.s=B.s,T=T*2,N=e(O,M,T,a).minus(B).abs().comparedTo(e(D,S,T,a).minus(B).abs())<1?[O,M]:[D,S],h=C,N},s.toNumber=function(){return+k(this)},s.toPrecision=function(v,E){return v!=null&&ri(v,1,Oi),b(this,v,E,2)},s.toString=function(v){var E,S=this,M=S.s,I=S.e;return I===null?M?(E="Infinity",M<0&&(E="-"+E)):E="NaN":(v==null?E=I<=l||I>=c?Ih(As(S.c),I):co(As(S.c),I,"0"):v===10&&y?(S=A(new x(S),o+I+1,a),E=co(As(S.c),S.e,"0")):(ri(v,2,g.length,"Base"),E=t(co(As(S.c),I,"0"),10,v,M,!0)),M<0&&S.c[0]&&(E="-"+E)),E},s.valueOf=s.toJSON=function(){return k(this)},s._isBigNumber=!0,s[Symbol.toStringTag]="BigNumber",s[Symbol.for("nodejs.util.inspect.custom")]=s.valueOf,i!=null&&x.set(i),x}function Cs(i){var e=i|0;return i>0||i===e?e:e-1}function As(i){for(var e,t,r=1,s=i.length,n=i[0]+"";r<s;){for(e=i[r++]+"",t=it-e.length;t--;e="0"+e);n+=e}for(s=n.length;n.charCodeAt(--s)===48;);return n.slice(0,s+1||1)}function qa(i,e){var t,r,s=i.c,n=e.c,o=i.s,a=e.s,l=i.e,c=e.e;if(!o||!a)return null;if(t=s&&!s[0],r=n&&!n[0],t||r)return t?r?0:-a:o;if(o!=a)return o;if(t=o<0,r=l==c,!s||!n)return r?0:!s^t?1:-1;if(!r)return l>c^t?1:-1;for(a=(l=s.length)<(c=n.length)?l:c,o=0;o<a;o++)if(s[o]!=n[o])return s[o]>n[o]^t?1:-1;return l==c?0:l>c^t?1:-1}function ri(i,e,t,r){if(i<e||i>t||i!==Ss(i))throw Error(Br+(r||"Argument")+(typeof i=="number"?i<e||i>t?" out of range: ":" not an integer: ":" not a primitive number: ")+String(i))}function Th(i){var e=i.c.length-1;return Cs(i.e/it)==e&&i.c[e]%2!=0}function Ih(i,e){return(i.length>1?i.charAt(0)+"."+i.slice(1):i)+(e<0?"e":"e+")+e}function co(i,e,t){var r,s;if(e<0){for(s=t+".";++e;s+=t);i=s+i}else if(r=i.length,++e>r){for(s=t,e-=r;--e;s+=t);i+=s}else e<r&&(i=i.slice(0,e)+"."+i.slice(e));return i}var uL=yE(),ks=uL;var d8=class{constructor(e){ge(this,"key");ge(this,"left",null);ge(this,"right",null);this.key=e}},Qa=class extends d8{constructor(e){super(e)}};var f8=class{constructor(){ge(this,"size",0);ge(this,"modificationCount",0);ge(this,"splayCount",0)}splay(e){let t=this.root;if(t==null)return this.compare(e,e),-1;let r=null,s=null,n=null,o=null,a=t,l=this.compare,c;for(;;)if(c=l(a.key,e),c>0){let u=a.left;if(u==null||(c=l(u.key,e),c>0&&(a.left=u.right,u.right=a,a=u,u=a.left,u==null)))break;r==null?s=a:r.left=a,r=a,a=u}else if(c<0){let u=a.right;if(u==null||(c=l(u.key,e),c<0&&(a.right=u.left,u.left=a,a=u,u=a.right,u==null)))break;n==null?o=a:n.right=a,n=a,a=u}else break;return n!=null&&(n.right=a.left,a.left=o),r!=null&&(r.left=a.right,a.right=s),this.root!==a&&(this.root=a,this.splayCount++),c}splayMin(e){let t=e,r=t.left;for(;r!=null;){let s=r;t.left=s.right,s.right=t,t=s,r=t.left}return t}splayMax(e){let t=e,r=t.right;for(;r!=null;){let s=r;t.right=s.left,s.left=t,t=s,r=t.right}return t}_delete(e){if(this.root==null||this.splay(e)!=0)return null;let r=this.root,s=r,n=r.left;if(this.size--,n==null)this.root=r.right;else{let o=r.right;r=this.splayMax(n),r.right=o,this.root=r}return this.modificationCount++,s}addNewRoot(e,t){this.size++,this.modificationCount++;let r=this.root;if(r==null){this.root=e;return}t<0?(e.left=r,e.right=r.right,r.right=null):(e.right=r,e.left=r.left,r.left=null),this.root=e}_first(){let e=this.root;return e==null?null:(this.root=this.splayMin(e),this.root)}_last(){let e=this.root;return e==null?null:(this.root=this.splayMax(e),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(e){return this.validKey(e)&&this.splay(e)==0}defaultCompare(){return(e,t)=>e<t?-1:e>t?1:0}wrap(){return{getRoot:()=>this.root,setRoot:e=>{this.root=e},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:e=>{this.splayCount=e},splay:e=>this.splay(e),has:e=>this.has(e)}}};var hL,z1=class z1 extends f8{constructor(t,r){super();ge(this,"root",null);ge(this,"compare");ge(this,"validKey");ge(this,hL,"[object Set]");this.compare=t!=null?t:this.defaultCompare(),this.validKey=r!=null?r:s=>s!=null&&s!=null}delete(t){return this.validKey(t)?this._delete(t)!=null:!1}deleteAll(t){for(let r of t)this.delete(r)}forEach(t){let r=this[Symbol.iterator](),s;for(;s=r.next(),!s.done;)t(s.value,s.value,this)}add(t){let r=this.splay(t);return r!=0&&this.addNewRoot(new Qa(t),r),this}addAndReturn(t){let r=this.splay(t);return r!=0&&this.addNewRoot(new Qa(t),r),this.root.key}addAll(t){for(let r of t)this.add(r)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(t){if(t==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(t)<0)return this.root.key;let s=this.root.left;if(s==null)return null;let n=s.right;for(;n!=null;)s=n,n=s.right;return s.key}firstAfter(t){if(t==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(t)>0)return this.root.key;let s=this.root.right;if(s==null)return null;let n=s.left;for(;n!=null;)s=n,n=s.left;return s.key}retainAll(t){let r=new z1(this.compare,this.validKey),s=this.modificationCount;for(let n of t){if(s!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(n)&&this.splay(n)==0&&r.add(this.root.key)}r.size!=this.size&&(this.root=r.root,this.size=r.size,this.modificationCount++)}lookup(t){return!this.validKey(t)||this.splay(t)!=0?null:this.root.key}intersection(t){let r=new z1(this.compare,this.validKey);for(let s of this)t.has(s)&&r.add(s);return r}difference(t){let r=new z1(this.compare,this.validKey);for(let s of this)t.has(s)||r.add(s);return r}union(t){let r=this.clone();return r.addAll(t),r}clone(){let t=new z1(this.compare,this.validKey);return t.size=this.size,t.root=this.copyNode(this.root),t}copyNode(t){if(t==null)return null;function r(n,o){let a,l;do{if(a=n.left,l=n.right,a!=null){let c=new Qa(a.key);o.left=c,r(a,c)}if(l!=null){let c=new Qa(l.key);o.right=c,n=l,o=c}}while(l!=null)}let s=new Qa(t.key);return r(t,s),s}toSet(){return this.clone()}entries(){return new m8(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new p8(this.wrap())}};hL=Symbol.toStringTag;var uo=z1,Mh=class{constructor(e){ge(this,"tree");ge(this,"path",new Array);ge(this,"modificationCount",null);ge(this,"splayCount");this.tree=e,this.splayCount=e.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;let e=this.path[this.path.length-1];return this.getValue(e)}rebuildPath(e){this.path.splice(0,this.path.length),this.tree.splay(e),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(e){for(;e!=null;)this.path.push(e),e=e.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let r=this.tree.getRoot();for(;r!=null;)this.path.push(r),r=r.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let e=this.path[this.path.length-1],t=e.right;if(t!=null){for(;t!=null;)this.path.push(t),t=t.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===e;)e=this.path.pop();return this.path.length>0}},p8=class extends Mh{getValue(e){return e.key}},m8=class extends Mh{getValue(e){return[e.key,e.key]}};var xE=i=>i;var vE=i=>{if(i){let e=new uo(W2(i)),t=new uo(W2(i)),r=(n,o)=>o.addAndReturn(n),s=n=>({x:r(n.x,e),y:r(n.y,t)});return s({x:new ks(0),y:new ks(0)}),s}return xE};var g8=i=>({set:e=>{Ur=g8(e)},reset:()=>g8(i),compare:W2(i),snap:vE(i),orient:mE(i)}),Ur=g8();var j1=(i,e)=>i.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(i.ur.x)&&i.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(i.ur.y),X2=(i,e)=>{if(e.ur.x.isLessThan(i.ll.x)||i.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(i.ll.y)||i.ur.y.isLessThan(e.ll.y))return null;let t=i.ll.x.isLessThan(e.ll.x)?e.ll.x:i.ll.x,r=i.ur.x.isLessThan(e.ur.x)?i.ur.x:e.ur.x,s=i.ll.y.isLessThan(e.ll.y)?e.ll.y:i.ll.y,n=i.ur.y.isLessThan(e.ur.y)?i.ur.y:e.ur.y;return{ll:{x:t,y:s},ur:{x:r,y:n}}};var Ph=(i,e)=>i.x.times(e.y).minus(i.y.times(e.x)),wE=(i,e)=>i.x.times(e.x).plus(i.y.times(e.y)),Dh=i=>wE(i,i).sqrt(),EE=(i,e,t)=>{let r={x:e.x.minus(i.x),y:e.y.minus(i.y)},s={x:t.x.minus(i.x),y:t.y.minus(i.y)};return Ph(s,r).div(Dh(s)).div(Dh(r))},AE=(i,e,t)=>{let r={x:e.x.minus(i.x),y:e.y.minus(i.y)},s={x:t.x.minus(i.x),y:t.y.minus(i.y)};return wE(s,r).div(Dh(s)).div(Dh(r))},_E=(i,e,t)=>e.y.isZero()?null:{x:i.x.plus(e.x.div(e.y).times(t.minus(i.y))),y:t},bE=(i,e,t)=>e.x.isZero()?null:{x:t,y:i.y.plus(e.y.div(e.x).times(t.minus(i.x)))},SE=(i,e,t,r)=>{if(e.x.isZero())return bE(t,r,i.x);if(r.x.isZero())return bE(i,e,t.x);if(e.y.isZero())return _E(t,r,i.y);if(r.y.isZero())return _E(i,e,t.y);let s=Ph(e,r);if(s.isZero())return null;let n={x:t.x.minus(i.x),y:t.y.minus(i.y)},o=Ph(n,e).div(s),a=Ph(n,r).div(s),l=i.x.plus(a.times(e.x)),c=t.x.plus(o.times(r.x)),u=i.y.plus(a.times(e.y)),h=t.y.plus(o.times(r.y)),d=l.plus(c).div(2),f=u.plus(h).div(2);return{x:d,y:f}};var qi=class i{constructor(e,t){ge(this,"point");ge(this,"isLeft");ge(this,"segment");ge(this,"otherSE");ge(this,"consumedBy");e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}static compare(e,t){let r=i.comparePoints(e.point,t.point);return r!==0?r:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Cn.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x.isLessThan(t.x)?-1:e.x.isGreaterThan(t.x)?1:e.y.isLessThan(t.y)?-1:e.y.isGreaterThan(t.y)?1:0}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");let t=e.point.events;for(let r=0,s=t.length;r<s;r++){let n=t[r];this.point.events.push(n),n.point=this.point}this.checkForConsuming()}checkForConsuming(){let e=this.point.events.length;for(let t=0;t<e;t++){let r=this.point.events[t];if(r.segment.consumedBy===void 0)for(let s=t+1;s<e;s++){let n=this.point.events[s];n.consumedBy===void 0&&r.otherSE.point.events===n.otherSE.point.events&&r.segment.consume(n.segment)}}}getAvailableLinkedEvents(){let e=[];for(let t=0,r=this.point.events.length;t<r;t++){let s=this.point.events[t];s!==this&&!s.segment.ringOut&&s.segment.isInResult()&&e.push(s)}return e}getLeftmostComparator(e){let t=new Map,r=s=>{let n=s.otherSE;t.set(s,{sine:EE(this.point,e.point,n.point),cosine:AE(this.point,e.point,n.point)})};return(s,n)=>{t.has(s)||r(s),t.has(n)||r(n);let{sine:o,cosine:a}=t.get(s),{sine:l,cosine:c}=t.get(n);return o.isGreaterThanOrEqualTo(0)&&l.isGreaterThanOrEqualTo(0)?a.isLessThan(c)?1:a.isGreaterThan(c)?-1:0:o.isLessThan(0)&&l.isLessThan(0)?a.isLessThan(c)?-1:a.isGreaterThan(c)?1:0:l.isLessThan(o)?-1:l.isGreaterThan(o)?1:0}}};var dL=0,Cn=class i{constructor(e,t,r,s){ge(this,"id");ge(this,"leftSE");ge(this,"rightSE");ge(this,"rings");ge(this,"windings");ge(this,"ringOut");ge(this,"consumedBy");ge(this,"prev");ge(this,"_prevInResult");ge(this,"_beforeState");ge(this,"_afterState");ge(this,"_isInResult");this.id=++dL,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=r,this.windings=s}static compare(e,t){let r=e.leftSE.point.x,s=t.leftSE.point.x,n=e.rightSE.point.x,o=t.rightSE.point.x;if(o.isLessThan(r))return 1;if(n.isLessThan(s))return-1;let a=e.leftSE.point.y,l=t.leftSE.point.y,c=e.rightSE.point.y,u=t.rightSE.point.y;if(r.isLessThan(s)){if(l.isLessThan(a)&&l.isLessThan(c))return 1;if(l.isGreaterThan(a)&&l.isGreaterThan(c))return-1;let h=e.comparePoint(t.leftSE.point);if(h<0)return 1;if(h>0)return-1;let d=t.comparePoint(e.rightSE.point);return d!==0?d:-1}if(r.isGreaterThan(s)){if(a.isLessThan(l)&&a.isLessThan(u))return-1;if(a.isGreaterThan(l)&&a.isGreaterThan(u))return 1;let h=t.comparePoint(e.leftSE.point);if(h!==0)return h;let d=e.comparePoint(t.rightSE.point);return d<0?1:d>0?-1:1}if(a.isLessThan(l))return-1;if(a.isGreaterThan(l))return 1;if(n.isLessThan(o)){let h=t.comparePoint(e.rightSE.point);if(h!==0)return h}if(n.isGreaterThan(o)){let h=e.comparePoint(t.rightSE.point);if(h<0)return 1;if(h>0)return-1}if(!n.eq(o)){let h=c.minus(a),d=n.minus(r),f=u.minus(l),p=o.minus(s);if(h.isGreaterThan(d)&&f.isLessThan(p))return 1;if(h.isLessThan(d)&&f.isGreaterThan(p))return-1}return n.isGreaterThan(o)?1:n.isLessThan(o)||c.isLessThan(u)?-1:c.isGreaterThan(u)?1:e.id<t.id?-1:e.id>t.id?1:0}static fromRing(e,t,r){let s,n,o,a=qi.comparePoints(e,t);if(a<0)s=e,n=t,o=1;else if(a>0)s=t,n=e,o=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);let l=new qi(s,!0),c=new qi(n,!1);return new i(l,c,[r],[o])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){let e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(t)?e:t},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(t)?e:t}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return Ur.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){let t=this.bbox(),r=e.bbox(),s=X2(t,r);if(s===null)return null;let n=this.leftSE.point,o=this.rightSE.point,a=e.leftSE.point,l=e.rightSE.point,c=j1(t,a)&&this.comparePoint(a)===0,u=j1(r,n)&&e.comparePoint(n)===0,h=j1(t,l)&&this.comparePoint(l)===0,d=j1(r,o)&&e.comparePoint(o)===0;if(u&&c)return d&&!h?o:!d&&h?l:null;if(u)return h&&n.x.eq(l.x)&&n.y.eq(l.y)?null:n;if(c)return d&&o.x.eq(a.x)&&o.y.eq(a.y)?null:a;if(d&&h)return null;if(d)return o;if(h)return l;let f=SE(n,this.vector(),a,e.vector());return f===null||!j1(s,f)?null:Ur.snap(f)}split(e){let t=[],r=e.events!==void 0,s=new qi(e,!0),n=new qi(e,!1),o=this.rightSE;this.replaceRightSE(n),t.push(n),t.push(s);let a=new i(s,o,this.rings.slice(),this.windings.slice());return qi.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),qi.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(s.checkForConsuming(),n.checkForConsuming()),t}swapEvents(){let e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,r=this.windings.length;t<r;t++)this.windings[t]*=-1}consume(e){let t=this,r=e;for(;t.consumedBy;)t=t.consumedBy;for(;r.consumedBy;)r=r.consumedBy;let s=i.compare(t,r);if(s!==0){if(s>0){let n=t;t=r,r=n}if(t.prev===r){let n=t;t=r,r=n}for(let n=0,o=r.rings.length;n<o;n++){let a=r.rings[n],l=r.windings[n],c=t.rings.indexOf(a);c===-1?(t.rings.push(a),t.windings.push(l)):t.windings[c]+=l}r.rings=null,r.windings=null,r.consumedBy=t,r.leftSE.consumedBy=t.leftSE,r.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{let e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;let e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};let t=this._afterState.rings,r=this._afterState.windings,s=this._afterState.multiPolys;for(let a=0,l=this.rings.length;a<l;a++){let c=this.rings[a],u=this.windings[a],h=t.indexOf(c);h===-1?(t.push(c),r.push(u)):r[h]+=u}let n=[],o=[];for(let a=0,l=t.length;a<l;a++){if(r[a]===0)continue;let c=t[a],u=c.poly;if(o.indexOf(u)===-1)if(c.isExterior)n.push(u);else{o.indexOf(u)===-1&&o.push(u);let h=n.indexOf(c.poly);h!==-1&&n.splice(h,1)}}for(let a=0,l=n.length;a<l;a++){let c=n[a].multiPoly;s.indexOf(c)===-1&&s.push(c)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;let e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(V1.type){case"union":{let r=e.length===0,s=t.length===0;this._isInResult=r!==s;break}case"intersection":{let r,s;e.length<t.length?(r=e.length,s=t.length):(r=t.length,s=e.length),this._isInResult=s===V1.numMultiPolys&&r<s;break}case"xor":{let r=Math.abs(e.length-t.length);this._isInResult=r%2===1;break}case"difference":{let r=s=>s.length===1&&s[0].isSubject;this._isInResult=r(e)!==r(t);break}}return this._isInResult}};var Rh=class{constructor(e,t,r){ge(this,"poly");ge(this,"isExterior");ge(this,"segments");ge(this,"bbox");if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=r,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let s=Ur.snap({x:new ks(e[0][0]),y:new ks(e[0][1])});this.bbox={ll:{x:s.x,y:s.y},ur:{x:s.x,y:s.y}};let n=s;for(let o=1,a=e.length;o<a;o++){if(typeof e[o][0]!="number"||typeof e[o][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let l=Ur.snap({x:new ks(e[o][0]),y:new ks(e[o][1])});l.x.eq(n.x)&&l.y.eq(n.y)||(this.segments.push(Cn.fromRing(n,l,this)),l.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=l.x),l.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=l.y),l.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=l.x),l.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=l.y),n=l)}(!s.x.eq(n.x)||!s.y.eq(n.y))&&this.segments.push(Cn.fromRing(n,s,this))}getSweepEvents(){let e=[];for(let t=0,r=this.segments.length;t<r;t++){let s=this.segments[t];e.push(s.leftSE),e.push(s.rightSE)}return e}},y8=class{constructor(e,t){ge(this,"multiPoly");ge(this,"exteriorRing");ge(this,"interiorRings");ge(this,"bbox");if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Rh(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let r=1,s=e.length;r<s;r++){let n=new Rh(e[r],this,!1);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.interiorRings.push(n)}this.multiPoly=t}getSweepEvents(){let e=this.exteriorRing.getSweepEvents();for(let t=0,r=this.interiorRings.length;t<r;t++){let s=this.interiorRings[t].getSweepEvents();for(let n=0,o=s.length;n<o;n++)e.push(s[n])}return e}},q2=class{constructor(e,t){ge(this,"isSubject");ge(this,"polys");ge(this,"bbox");if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch(r){}this.polys=[],this.bbox={ll:{x:new ks(Number.POSITIVE_INFINITY),y:new ks(Number.POSITIVE_INFINITY)},ur:{x:new ks(Number.NEGATIVE_INFINITY),y:new ks(Number.NEGATIVE_INFINITY)}};for(let r=0,s=e.length;r<s;r++){let n=new y8(e[r],this);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.polys.push(n)}this.isSubject=t}getSweepEvents(){let e=[];for(let t=0,r=this.polys.length;t<r;t++){let s=this.polys[t].getSweepEvents();for(let n=0,o=s.length;n<o;n++)e.push(s[n])}return e}};var Nh=class i{constructor(e){ge(this,"events");ge(this,"poly");ge(this,"_isExteriorRing");ge(this,"_enclosingRing");this.events=e;for(let t=0,r=e.length;t<r;t++)e[t].segment.ringOut=this;this.poly=null}static factory(e){let t=[];for(let r=0,s=e.length;r<s;r++){let n=e[r];if(!n.isInResult()||n.ringOut)continue;let o=null,a=n.leftSE,l=n.rightSE,c=[a],u=a.point,h=[];for(;o=a,a=l,c.push(a),a.point!==u;)for(;;){let d=a.getAvailableLinkedEvents();if(d.length===0){let m=c[0].point,g=c[c.length-1].point;throw new Error(`Unable to complete output ring starting at [${m.x}, ${m.y}]. Last matching segment found ends at [${g.x}, ${g.y}].`)}if(d.length===1){l=d[0].otherSE;break}let f=null;for(let m=0,g=h.length;m<g;m++)if(h[m].point===a.point){f=m;break}if(f!==null){let m=h.splice(f)[0],g=c.splice(m.index);g.unshift(g[0].otherSE),t.push(new i(g.reverse()));continue}h.push({index:c.length,point:a.point});let p=a.getLeftmostComparator(o);l=d.sort(p)[0].otherSE;break}t.push(new i(c))}return t}getGeom(){let e=this.events[0].point,t=[e];for(let c=1,u=this.events.length-1;c<u;c++){let h=this.events[c].point,d=this.events[c+1].point;Ur.orient(h,e,d)!==0&&(t.push(h),e=h)}if(t.length===1)return null;let r=t[0],s=t[1];Ur.orient(r,e,s)===0&&t.shift(),t.push(t[0]);let n=this.isExteriorRing()?1:-1,o=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,l=[];for(let c=o;c!=a;c+=n)l.push([t[c].x.toNumber(),t[c].y.toNumber()]);return l}isExteriorRing(){if(this._isExteriorRing===void 0){let e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var s,n;let e=this.events[0];for(let o=1,a=this.events.length;o<a;o++){let l=this.events[o];qi.compare(e,l)>0&&(e=l)}let t=e.segment.prevInResult(),r=t?t.prevInResult():null;for(;;){if(!t)return null;if(!r)return t.ringOut;if(r.ringOut!==t.ringOut)return((s=r.ringOut)==null?void 0:s.enclosingRing())!==t.ringOut?t.ringOut:(n=t.ringOut)==null?void 0:n.enclosingRing();t=r.prevInResult(),r=t?t.prevInResult():null}}},Fh=class{constructor(e){ge(this,"exteriorRing");ge(this,"interiorRings");this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){let e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,r=this.interiorRings.length;t<r;t++){let s=this.interiorRings[t].getGeom();s!==null&&e.push(s)}return e}},Lh=class{constructor(e){ge(this,"rings");ge(this,"polys");this.rings=e,this.polys=this._composePolys(e)}getGeom(){let e=[];for(let t=0,r=this.polys.length;t<r;t++){let s=this.polys[t].getGeom();s!==null&&e.push(s)}return e}_composePolys(e){var r;let t=[];for(let s=0,n=e.length;s<n;s++){let o=e[s];if(!o.poly)if(o.isExteriorRing())t.push(new Fh(o));else{let a=o.enclosingRing();a!=null&&a.poly||t.push(new Fh(a)),(r=a==null?void 0:a.poly)==null||r.addInterior(o)}}return t}};var Q2=class{constructor(e,t=Cn.compare){ge(this,"queue");ge(this,"tree");ge(this,"segments");this.queue=e,this.tree=new uo(t),this.segments=[]}process(e){let t=e.segment,r=[];if(e.consumedBy)return e.isLeft?this.queue.delete(e.otherSE):this.tree.delete(t),r;e.isLeft&&this.tree.add(t);let s=t,n=t;do s=this.tree.lastBefore(s);while(s!=null&&s.consumedBy!=null);do n=this.tree.firstAfter(n);while(n!=null&&n.consumedBy!=null);if(e.isLeft){let o=null;if(s){let l=s.getIntersection(t);if(l!==null&&(t.isAnEndpoint(l)||(o=l),!s.isAnEndpoint(l))){let c=this._splitSafely(s,l);for(let u=0,h=c.length;u<h;u++)r.push(c[u])}}let a=null;if(n){let l=n.getIntersection(t);if(l!==null&&(t.isAnEndpoint(l)||(a=l),!n.isAnEndpoint(l))){let c=this._splitSafely(n,l);for(let u=0,h=c.length;u<h;u++)r.push(c[u])}}if(o!==null||a!==null){let l=null;o===null?l=a:a===null?l=o:l=qi.comparePoints(o,a)<=0?o:a,this.queue.delete(t.rightSE),r.push(t.rightSE);let c=t.split(l);for(let u=0,h=c.length;u<h;u++)r.push(c[u])}r.length>0?(this.tree.delete(t),r.push(e)):(this.segments.push(t),t.prev=s)}else{if(s&&n){let o=s.getIntersection(n);if(o!==null){if(!s.isAnEndpoint(o)){let a=this._splitSafely(s,o);for(let l=0,c=a.length;l<c;l++)r.push(a[l])}if(!n.isAnEndpoint(o)){let a=this._splitSafely(n,o);for(let l=0,c=a.length;l<c;l++)r.push(a[l])}}}this.tree.delete(t)}return r}_splitSafely(e,t){this.tree.delete(e);let r=e.rightSE;this.queue.delete(r);let s=e.split(t);return s.push(r),e.consumedBy===void 0&&this.tree.add(e),s}};var x8=class{constructor(){ge(this,"type");ge(this,"numMultiPolys")}run(e,t,r){Y2.type=e;let s=[new q2(t,!0)];for(let u=0,h=r.length;u<h;u++)s.push(new q2(r[u],!1));if(Y2.numMultiPolys=s.length,Y2.type==="difference"){let u=s[0],h=1;for(;h<s.length;)X2(s[h].bbox,u.bbox)!==null?h++:s.splice(h,1)}if(Y2.type==="intersection")for(let u=0,h=s.length;u<h;u++){let d=s[u];for(let f=u+1,p=s.length;f<p;f++)if(X2(d.bbox,s[f].bbox)===null)return[]}let n=new uo(qi.compare);for(let u=0,h=s.length;u<h;u++){let d=s[u].getSweepEvents();for(let f=0,p=d.length;f<p;f++)n.add(d[f])}let o=new Q2(n),a=null;for(n.size!=0&&(a=n.first(),n.delete(a));a;){let u=o.process(a);for(let h=0,d=u.length;h<d;h++){let f=u[h];f.consumedBy===void 0&&n.add(f)}n.size!=0?(a=n.first(),n.delete(a)):a=null}Ur.reset();let l=Nh.factory(o.segments);return new Lh(l).getGeom()}},Y2=new x8,V1=Y2;var Oh=(i,...e)=>V1.run("union",i,e);var CE=(i,...e)=>V1.run("difference",i,e),mle=Ur.set;var K2=et(w8(),1),rA=et(YE(),1),sA=et(KE(),1),nA=et(eA(),1),k8=class{constructor(e){this._cache={},this.strict=!0,e&&e.type==="FeatureCollection"&&Array.isArray(e.features)&&e.features.forEach(r=>{r.properties=r.properties||{};let s=r.properties,n=r.id||s.id;if(!(!n||!/^\S+\.geojson$/i.test(n))){if(n=n.toLowerCase(),r.id=n,s.id=n,!s.area){let o=K2.default.geometry(r.geometry)/1e6;s.area=Number(o.toFixed(2))}this._cache[n]=r}});let t=tA(V2("Q2"));t.geometry={type:"Polygon",coordinates:[[[-180,-90],[180,-90],[180,90],[-180,90],[-180,-90]]]},t.id="Q2",t.properties.id="Q2",t.properties.area=K2.default.geometry(t.geometry)/1e6,this._cache.Q2=t}validateLocation(e){if(Array.isArray(e)&&(e.length===2||e.length===3)){let t=e[0],r=e[1],s=e[2];if(Number.isFinite(t)&&t>=-180&&t<=180&&Number.isFinite(r)&&r>=-90&&r<=90&&(e.length===2||Number.isFinite(s)&&s>0)){let n="["+e.toString()+"]";return{type:"point",location:e,id:n}}}else if(typeof e=="string"&&/^\S+\.geojson$/i.test(e)){let t=e.toLowerCase();if(this._cache[t])return{type:"geojson",location:e,id:t}}else if(typeof e=="string"||typeof e=="number"){let t=V2(e);if(t){let r=t.properties.wikidata;return{type:"countrycoder",location:e,id:r}}}if(this.strict)throw new Error(`validateLocation:  Invalid location: "${e}".`);return null}resolveLocation(e){let t=this.validateLocation(e);if(!t)return null;let r=t.id;if(this._cache[r])return Object.assign(t,{feature:this._cache[r]});if(t.type==="point"){let s=e[0],n=e[1],o=e[2]||25,a=10,l=3,c=Math.PI*o*o,u=this._cache[r]=(0,sA.default)({type:"Feature",id:r,properties:{id:r,area:Number(c.toFixed(2))},geometry:(0,rA.default)([s,n],o*1e3,a)},l);return Object.assign(t,{feature:u})}else if(t.type!=="geojson"){if(t.type==="countrycoder"){let s=tA(V2(r)),n=s.properties;if(Array.isArray(n.members)){let o=fE(r);o.geometry.coordinates=Hh([o],"UNION").geometry.coordinates,s.geometry=o.geometry}if(!n.area){let o=K2.default.geometry(s.geometry)/1e6;n.area=Number(o.toFixed(2))}return s.id=r,n.id=r,this._cache[r]=s,Object.assign(t,{feature:s})}}if(this.strict)throw new Error(`resolveLocation:  Couldn't resolve location "${e}".`);return null}validateLocationSet(e){e=e||{};let t=this.validateLocation.bind(this),r=(e.include||[]).map(t).filter(Boolean),s=(e.exclude||[]).map(t).filter(Boolean);if(!r.length){if(this.strict)throw new Error("validateLocationSet:  LocationSet includes nothing.");e.include=["Q2"],r=[{type:"countrycoder",location:"Q2",id:"Q2"}]}r.sort(iA);let n="+["+r.map(o=>o.id).join(",")+"]";return s.length&&(s.sort(iA),n+="-["+s.map(o=>o.id).join(",")+"]"),{type:"locationset",locationSet:e,id:n}}resolveLocationSet(e){e=e||{};let t=this.validateLocationSet(e);if(!t)return null;let r=t.id;if(this._cache[r])return Object.assign(t,{feature:this._cache[r]});let s=this.resolveLocation.bind(this),n=(e.include||[]).map(s).filter(Boolean),o=(e.exclude||[]).map(s).filter(Boolean);if(n.length===1&&o.length===0)return Object.assign(t,{feature:n[0].feature});let a=Hh(n.map(h=>h.feature),"UNION"),l=Hh(o.map(h=>h.feature),"UNION"),c=l?Hh([a,l],"DIFFERENCE"):a,u=K2.default.geometry(c.geometry)/1e6;return c.id=r,c.properties={id:r,area:Number(u.toFixed(2))},this._cache[r]=c,Object.assign(t,{feature:c})}stringify(e,t){return(0,nA.default)(e,t)}};function Hh(i,e){if(!Array.isArray(i)||!i.length)return null;let t={UNION:Oh,DIFFERENCE:CE}[e],r=i.map(o=>o.geometry.coordinates),s=t.apply(null,r);return{type:"Feature",properties:{},geometry:{type:n(s),coordinates:s}};function n(o){return Array.isArray(o)&&Array.isArray(o[0])&&Array.isArray(o[0][0])&&Array.isArray(o[0][0][0])?"MultiPolygon":"Polygon"}}function tA(i){return JSON.parse(JSON.stringify(i))}function iA(i,e){let t={countrycoder:1,geojson:2,point:3},r=t[i.type],s=t[e.type];return r>s?1:r<s?-1:i.id.localeCompare(e.id)}var oA=k8;var T8=et(G2(),1),aA=et(w8(),1);var ho=new oA,Z2=class extends Ce{constructor(e){super(e),this.id="locations",this.dependencies=new Set,this._wp=null,this._resolved=new Map,this._knownLocationSets=new Map,this._locationIncludedIn=new Map,this._locationExcludedIn=new Map,this._blocks=[{locationSet:{include:["Q7835","ua"]},text:"Editing has been blocked in this region per request of the OSM Ukrainian community.",url:"https://wiki.openstreetmap.org/wiki/Russian%E2%80%93Ukrainian_war"}];let t=this._blocks.map(s=>{this._resolveLocationSet(s);let n=this._resolved.get(s.locationSetID);return Object.assign(n.properties,s),n});this._wpblocks=(0,T8.default)({type:"FeatureCollection",features:t});let r={locationSet:{include:["Q2"]}};this._resolveLocationSet(r),this._rebuildIndex()}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}_validateLocationSet(e){if(!e.locationSetID)try{let t=e.locationSet;if(!t)throw new Error("object missing locationSet property");t.include||(t.include=["Q2"]);let r=ho.validateLocationSet(t).id;if(e.locationSetID=r,this._knownLocationSets.has(r))return;let s=0;(t.include||[]).forEach(n=>{let o=ho.validateLocation(n).id,a=this._resolved.get(o);a||(a=ho.resolveLocation(n).feature,this._resolved.set(o,a)),s+=a.properties.area;let l=this._locationIncludedIn.get(o);l||(l=new Set,this._locationIncludedIn.set(o,l)),l.add(r)}),(t.exclude||[]).forEach(n=>{let o=ho.validateLocation(n).id,a=this._resolved.get(o);a||(a=ho.resolveLocation(n).feature,this._resolved.set(o,a)),s-=a.properties.area;let l=this._locationExcludedIn.get(o);l||(l=new Set,this._locationExcludedIn.set(o,l)),l.add(r)}),this._knownLocationSets.set(r,s)}catch(t){e.locationSet={include:["Q2"]},e.locationSetID="+[Q2]"}}_resolveLocationSet(e){if(this._validateLocationSet(e),!this._resolved.has(e.locationSetID))try{let t=ho.resolveLocationSet(e.locationSet),r=t.id;if(e.locationSetID=r,!t.feature.geometry.coordinates.length||!t.feature.properties.area)throw new Error(`locationSet ${r} resolves to an empty feature.`);let s=JSON.parse(JSON.stringify(t.feature));s.id=r,s.properties.id=r,this._resolved.set(r,s)}catch(t){e.locationSet={include:["Q2"]},e.locationSetID="+[Q2]"}}_rebuildIndex(){this._wp=(0,T8.default)({features:[...this._resolved.values()]}),this.emit("locationchange")}mergeCustomGeoJSON(e){!e||e.type!=="FeatureCollection"||!Array.isArray(e.features)||e.features.forEach(t=>{t.properties=t.properties||{};let r=t.properties,s=t.id||r.id;if(!(!s||!/^\S+\.geojson$/i.test(s))){if(s=s.toLowerCase(),t.id=s,r.id=s,!r.area){let n=aA.default.geometry(t.geometry)/1e6;r.area=Number(n.toFixed(2))}ho._cache[s]=t}})}mergeLocationSets(e){return Array.isArray(e)?(e.forEach(t=>this._validateLocationSet(t)),this._rebuildIndex(),Promise.resolve(e)):Promise.reject("nothing to do")}locationSetID(e){let t;try{t=ho.validateLocationSet(e).id}catch(r){t="+[Q2]"}return t}feature(e="+[Q2]"){return this._resolved.get(e)||this._resolved.get("+[Q2]")}locationSetsAt(e){let t={},r=this._wp(e,!0)||[],s=this;return r.forEach(n=>{if(n.id[0]!=="+")return;let o=n.id,a=s._knownLocationSets.get(o);a&&(t[o]=a)}),r.forEach(n=>{if(n.id[0]==="+")return;let o=n.id;(s._locationIncludedIn.get(o)||[]).forEach(l=>{let c=s._knownLocationSets.get(l);c&&(t[l]=c)})}),r.forEach(n=>{if(n.id[0]==="+")return;let o=n.id;(s._locationExcludedIn.get(o)||[]).forEach(l=>{delete t[l]})}),t}blocksAt(e){return this._blocks.length?this._wpblocks(e,!0)||[]:[]}loco(){return ho}wpblocks(){return this._wpblocks}};var CL="https://cdn.jsdelivr.net/npm/maplibre-gl@3/dist/maplibre-gl.min.js",kL="https://cdn.jsdelivr.net/npm/maplibre-gl@3/dist/maplibre-gl.min.css",lA="#01d4fa",J2=class extends Ce{constructor(e){super(e),this.id="map3d",this.autoStart=!1,this.dependencies=new Set(["map","urlhash"]),this.containerID="3d-buildings",this.maplibre=null,this._loadPromise=null,this._startPromise=null,this.building3dlayerSpec=this.get3dBuildingLayerSpec("3D Buildings","osmbuildings"),this.roadStrokelayerSpec=this.getRoadStrokeLayerSpec("Roads","osmroads"),this.roadCasinglayerSpec=this.getRoadCasingLayerSpec("Roads","osmroads"),this.roadSelectedlayerSpec=this.getRoadSelectedLayerSpec("Roads","osmroads"),this.areaLayerSpec=this.getAreaLayerSpec("Areas","osmareas")}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._startPromise?this._startPromise:this._startPromise=this._loadAssetsAsync().then(()=>{let e=window.maplibregl;if(!e)throw new Error("maplibre-gl not loaded");let t=this.context.systems.map,r=this.maplibre=new e.Map({container:this.containerID,pitch:30,style:{version:8,sources:{},layers:[{id:"Background",type:"background",layout:{visibility:"visible"},paint:{"background-color":"white"}}]}});return new Promise(s=>{r.on("load",()=>{r.setLight({anchor:"viewport",color:"#ff00ff",position:[1,200,30],intensity:.3}),r.jumpTo({zoom:t.zoom()-3,center:t.extent().center()}),r.addSource("osmareas",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r.addSource("osmroads",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r.addSource("osmbuildings",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r.addLayer(this.areaLayerSpec),r.addLayer(this.roadSelectedlayerSpec),r.addLayer(this.roadCasinglayerSpec),r.addLayer(this.roadStrokelayerSpec),r.addLayer(this.building3dlayerSpec),this._started=!0,s()})})}).catch(e=>{e instanceof Error&&console.error(e),this._startPromise=null})}_loadAssetsAsync(){return this._loadPromise?this._loadPromise:this._loadPromise=new Promise((e,t)=>{let r=0,s=()=>{++r===2&&e()},n=G("head");n.selectAll("#rapideditor-maplibre-css").data([0]).enter().append("link").attr("id","rapideditor-maplibre-css").attr("rel","stylesheet").attr("crossorigin","anonymous").attr("href",kL).on("load",s).on("error",t),n.selectAll("#rapideditor-maplibre-js").data([0]).enter().append("script").attr("id","rapideditor-maplibre-js").attr("crossorigin","anonymous").attr("src",CL).on("load",s).on("error",t)})}resetAsync(){return Promise.resolve()}get3dBuildingLayerSpec(e,t){return{id:e,type:"fill-extrusion",source:t,layout:{},paint:{"fill-extrusion-color":["match",["get","selected"],"true",lA,"#e06e5f"],"fill-extrusion-height":["get","height"],"fill-extrusion-base":["get","min_height"],"fill-extrusion-opacity":.85}}}getAreaLayerSpec(e,t){return{id:e,type:"fill",source:t,layout:{},paint:{"fill-color":["get","fillcolor"],"fill-outline-color":["get","strokecolor"],"fill-opacity":.5}}}getRoadCasingLayerSpec(e,t){return{id:e+"-casing",type:"line",source:t,minzoom:4,layout:{"line-cap":"butt","line-join":"round",visibility:"visible"},paint:{"line-color":["get","casingColor"],"line-width":this.getLineWidthSpecification(6)}}}getRoadSelectedLayerSpec(e,t){return{id:e+"-selected",type:"line",source:t,minzoom:4,layout:{"line-cap":"butt","line-join":"round",visibility:"visible"},paint:{"line-color":lA,"line-opacity":["match",["get","selected"],"true",.75,0],"line-width":this.getLineWidthSpecification(12)}}}getRoadStrokeLayerSpec(e,t){return{id:e+"-stroke",type:"line",source:t,minzoom:4,layout:{"line-cap":"butt","line-join":"round",visibility:"visible"},paint:{"line-color":["get","strokeColor"],"line-opacity":["match",["get","highway"],"unclassified",.8,"service",.2,1],"line-width":this.getLineWidthSpecification(4)}}}getLineWidthSpecification(e){return["interpolate",["linear",2],["zoom"],5,.5,16,["match",["get","highway"],["motorway","trunk","primary"],e*2,["secondary","unclassified"],Math.floor(.75*e*2),["tertiary"],Math.floor(.75*e*2)-1,["minor","service","track","footway","pedestrian","cycleway"],e,e],20,["match",["get","highway"],["motorway","trunk","primary"],e*2.5,["secondary","unclassified"],e*2.5,["tertiary"],e*2.5,["minor","service","track","footway","pedestrian","cycleway"],e*2,e*2]]}};var ee=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(ee||{}),I8=i=>{if(typeof i=="function"||typeof i=="object"&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");i=Si(Ne({},typeof i.extension!="object"?{type:i.extension}:i.extension),{ref:i})}if(typeof i=="object")i=Ne({},i);else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},cA=(i,e)=>{var t;return(t=I8(i).priority)!=null?t:e},ne={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(I8).forEach(e=>{e.type.forEach(t=>{var r,s;return(s=(r=this._removeHandlers)[t])==null?void 0:s.call(r,e)})}),this},add(...i){return i.map(I8).forEach(e=>{e.type.forEach(t=>{var n,o;let r=this._addHandlers,s=this._queue;r[t]?(n=r[t])==null||n.call(r,e):(s[t]=s[t]||[],(o=s[t])==null||o.push(e))})}),this},handle(i,e,t){var o;let r=this._addHandlers,s=this._removeHandlers;if(r[i]||s[i])throw new Error(`Extension type ${i} already has a handler`);r[i]=e,s[i]=t;let n=this._queue;return n[i]&&((o=n[i])==null||o.forEach(a=>e(a)),delete n[i]),this},handleByMap(i,e){return this.handle(i,t=>{t.name&&(e[t.name]=t.ref)},t=>{t.name&&delete e[t.name]})},handleByList(i,e,t=-1){return this.handle(i,r=>{e.includes(r.ref)||(e.push(r.ref),e.sort((s,n)=>cA(n,t)-cA(s,t)))},r=>{let s=e.indexOf(r.ref);s!==-1&&e.splice(s,1)})}};var ia=class{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}};var TL=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function IL(i){let e="";for(let t=0;t<i;++t)t>0&&(e+=`
else `),t<i-1&&(e+=`if(test == ${t}.0){}`);return e}function Gh(i,e){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");let t=e.createShader(e.FRAGMENT_SHADER);for(;;){let r=TL.replace(/%forloop%/gi,IL(i));if(e.shaderSource(t,r),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))i=i/2|0;else break}return i}var M8=0,P8=1,D8=2,R8=3,N8=4,F8=5,Bi=class i{constructor(){this.data=0,this.blendMode=Le.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<M8)}set blend(e){!!(this.data&1<<M8)!==e&&(this.data^=1<<M8)}get offsets(){return!!(this.data&1<<P8)}set offsets(e){!!(this.data&1<<P8)!==e&&(this.data^=1<<P8)}get culling(){return!!(this.data&1<<D8)}set culling(e){!!(this.data&1<<D8)!==e&&(this.data^=1<<D8)}get depthTest(){return!!(this.data&1<<R8)}set depthTest(e){!!(this.data&1<<R8)!==e&&(this.data^=1<<R8)}get depthMask(){return!!(this.data&1<<F8)}set depthMask(e){!!(this.data&1<<F8)!==e&&(this.data^=1<<F8)}get clockwiseFrontFace(){return!!(this.data&1<<N8)}set clockwiseFrontFace(e){!!(this.data&1<<N8)!==e&&(this.data^=1<<N8)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==Le.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){let e=new i;return e.depthTest=!1,e.blend=!0,e}};Bi.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};var e4=[];function X1(i,e){if(!i)return null;let t="";if(typeof i=="string"){let r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(t=r[1].toLowerCase())}for(let r=e4.length-1;r>=0;--r){let s=e4[r];if(s.test&&s.test(i,t))return new s(i,e)}throw new Error("Unrecognized source type to auto-detect Resource")}var vi=class{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,t,r,s,n,o,a,l){if(arguments.length>8)throw new Error("max arguments reached");let{name:c,items:u}=this;this._aliasCount++;for(let h=0,d=u.length;h<d;h++)u[h][c](e,t,r,s,n,o,a,l);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){let t=this.items.indexOf(e);return t!==-1&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}};Object.defineProperties(vi.prototype,{dispatch:{value:vi.prototype.emit},run:{value:vi.prototype.emit}});var Ar=class{constructor(e=0,t=0){this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new vi("setRealSize"),this.onUpdate=new vi("update"),this.onError=new vi("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,t,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,t){return!1}};var Ys=class extends Ar{constructor(e,t){var n;let{width:r,height:s}=t||{};if(!r||!s)throw new Error("BufferResource width or height invalid");super(r,s),this.data=e,this.unpackAlignment=(n=t.unpackAlignment)!=null?n:4}upload(e,t,r){let s=e.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===jt.UNPACK);let n=t.realWidth,o=t.realHeight;return r.width===n&&r.height===o?s.texSubImage2D(t.target,0,0,0,n,o,t.format,r.type,this.data):(r.width=n,r.height=o,s.texImage2D(t.target,0,r.internalFormat,n,o,0,t.format,r.type,this.data)),!0}dispose(){this.data=null}static test(e){return e===null||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}};var ML={scaleMode:Xi.NEAREST,alphaMode:jt.NPM},L8=class q1 extends pi.default{constructor(e=null,t=null){super(),t=Object.assign({},q1.defaultOptions,t);let{alphaMode:r,mipmap:s,anisotropicLevel:n,scaleMode:o,width:a,height:l,wrapMode:c,format:u,type:h,target:d,resolution:f,resourceOptions:p}=t;e&&!(e instanceof Ar)&&(e=X1(e,p),e.internal=!0),this.resolution=f||te.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((l||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=n,this._wrapMode=c,this._scaleMode=o,this.format=u,this.type=h,this.target=d,this.alphaMode=r,this.uid=An(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&l>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let r;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,r=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,r=!0),r&&this.dirtyStyleId++,this}setSize(e,t,r){return r=r||this.resolution,this.setRealSize(e*r,t*r,r)}setRealSize(e,t,r){return this.resolution=r||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=w2(this.realWidth)&&w2(this.realHeight)}setResolution(e){let t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Er[this.cacheId],delete Fi[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),q1.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,r=te.STRICT_TEXTURE_CACHE){let s=typeof e=="string",n=null;if(s)n=e;else{if(!e._pixiId){let a=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${a}_${An()}`}n=e._pixiId}let o=Er[n];if(s&&r&&!o)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return o||(o=new q1(e,t),o.cacheId=n,q1.addToCache(o,n)),o}static fromBuffer(e,t,r,s){e=e||new Float32Array(t*r*4);let n=new Ys(e,Ne({width:t,height:r},s==null?void 0:s.resourceOptions)),o,a;return e instanceof Float32Array?(o=le.RGBA,a=Se.FLOAT):e instanceof Int32Array?(o=le.RGBA_INTEGER,a=Se.INT):e instanceof Uint32Array?(o=le.RGBA_INTEGER,a=Se.UNSIGNED_INT):e instanceof Int16Array?(o=le.RGBA_INTEGER,a=Se.SHORT):e instanceof Uint16Array?(o=le.RGBA_INTEGER,a=Se.UNSIGNED_SHORT):e instanceof Int8Array?(o=le.RGBA,a=Se.BYTE):(o=le.RGBA,a=Se.UNSIGNED_BYTE),n.internal=!0,new q1(n,Object.assign({},ML,{type:a,format:o},s))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),Er[t]&&Er[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),Er[t]=e)}static removeFromCache(e){if(typeof e=="string"){let t=Er[e];if(t){let r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete Er[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete Er[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};L8.defaultOptions={mipmap:bi.POW2,anisotropicLevel:0,scaleMode:Xi.LINEAR,wrapMode:Lr.CLAMP,alphaMode:jt.UNPACK,target:oo.TEXTURE_2D,format:le.RGBA,type:Se.UNSIGNED_BYTE},L8._globalBatch=0;var Ae=L8;var ra=class{constructor(){this.texArray=null,this.blend=0,this.type=Fr.TRIANGLES,this.start=0,this.size=0,this.data=null}};var PL=0,Pt=class i{constructor(e,t=!0,r=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=t,this.id=PL++,this.disposeRunner=new vi("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?Or.ELEMENT_ARRAY_BUFFER:Or.ARRAY_BUFFER}get index(){return this.type===Or.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new i(e)}};var Q1=class i{constructor(e,t=0,r=!1,s=Se.FLOAT,n,o,a,l=1){this.buffer=e,this.size=t,this.normalized=r,this.type=s,this.stride=n,this.start=o,this.instance=a,this.divisor=l}destroy(){this.buffer=null}static from(e,t,r,s,n){return new i(e,t,r,s,n)}};var DL={Float32Array,Uint32Array,Int32Array,Uint8Array};function uA(i,e){let t=0,r=0,s={};for(let l=0;l<i.length;l++)r+=e[l],t+=i[l].length;let n=new ArrayBuffer(t*4),o=null,a=0;for(let l=0;l<i.length;l++){let c=e[l],u=i[l],h=Zo(u);s[h]||(s[h]=new DL[h](n)),o=s[h];for(let d=0;d<u.length;d++){let f=(d/c|0)*r+a,p=d%c;o[f+p]=u[d]}a+=c}return new Float32Array(n)}var hA={5126:4,5123:2,5121:1},RL=0,NL={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},Sr=class i{constructor(e=[],t={}){this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=RL++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new vi("disposeGeometry"),this.refCount=0}addAttribute(e,t,r=0,s=!1,n,o,a,l=!1){if(!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof Pt||(t instanceof Array&&(t=new Float32Array(t)),t=new Pt(t));let c=e.split("|");if(c.length>1){for(let h=0;h<c.length;h++)this.addAttribute(c[h],t,r,s,n);return this}let u=this.buffers.indexOf(t);return u===-1&&(this.buffers.push(t),u=this.buffers.length-1),this.attributes[e]=new Q1(u,r,s,n,o,a,l),this.instanced=this.instanced||l,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof Pt||(e instanceof Array&&(e=new Uint16Array(e)),e=new Pt(e)),e.type=Or.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;let e=[],t=[],r=new Pt,s;for(s in this.attributes){let n=this.attributes[s],o=this.buffers[n.buffer];e.push(o.data),t.push(n.size*hA[n.type]/4),n.buffer=0}for(r.data=uA(e,t),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(let e in this.attributes){let t=this.attributes[e];return this.buffers[t.buffer].data.length/(t.stride/4||t.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){let e=new i;for(let t=0;t<this.buffers.length;t++)e.buffers[t]=new Pt(this.buffers[t].data.slice(0));for(let t in this.attributes){let r=this.attributes[t];e.attributes[t]=new Q1(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=Or.ELEMENT_ARRAY_BUFFER),e}static merge(e){let t=new i,r=[],s=[],n=[],o;for(let a=0;a<e.length;a++){o=e[a];for(let l=0;l<o.buffers.length;l++)s[l]=s[l]||0,s[l]+=o.buffers[l].data.length,n[l]=0}for(let a=0;a<o.buffers.length;a++)r[a]=new NL[Zo(o.buffers[a].data)](s[a]),t.buffers[a]=new Pt(r[a]);for(let a=0;a<e.length;a++){o=e[a];for(let l=0;l<o.buffers.length;l++)r[l].set(o.buffers[l].data,n[l]),n[l]+=o.buffers[l].data.length}if(t.attributes=o.attributes,o.indexBuffer){t.indexBuffer=t.buffers[o.buffers.indexOf(o.indexBuffer)],t.indexBuffer.type=Or.ELEMENT_ARRAY_BUFFER;let a=0,l=0,c=0,u=0;for(let h=0;h<o.buffers.length;h++)if(o.buffers[h]!==o.indexBuffer){u=h;break}for(let h in o.attributes){let d=o.attributes[h];(d.buffer|0)===u&&(l+=d.size*hA[d.type]/4)}for(let h=0;h<e.length;h++){let d=e[h].indexBuffer.data;for(let f=0;f<d.length;f++)t.indexBuffer.data[f+c]+=a;a+=e[h].buffers[u].data.length/l,c+=d.length}}return t}};var Ka=class extends Sr{constructor(e=!1){super(),this._buffer=new Pt(null,e,!1),this._indexBuffer=new Pt(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,Se.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,Se.FLOAT).addAttribute("aColor",this._buffer,4,!0,Se.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,Se.FLOAT).addIndex(this._indexBuffer)}};var sa=Math.PI*2,O8=180/Math.PI,Ks=Math.PI/180,Lt=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(Lt||{});var _e=class i{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new i(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}};_e.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};var zh=[new _e,new _e,new _e,new _e],ve=class i{constructor(e=0,t=0,r=0,s=0){this.x=Number(e),this.y=Number(t),this.width=Number(r),this.height=Number(s),this.type=Lt.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new i(0,0,0,0)}clone(){return new i(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}intersects(e,t){if(!t){let v=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=v)return!1;let E=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>E}let r=this.left,s=this.right,n=this.top,o=this.bottom;if(s<=r||o<=n)return!1;let a=zh[0].set(e.left,e.top),l=zh[1].set(e.left,e.bottom),c=zh[2].set(e.right,e.top),u=zh[3].set(e.right,e.bottom);if(c.x<=a.x||l.y<=a.y)return!1;let h=Math.sign(t.a*t.d-t.b*t.c);if(h===0||(t.apply(a,a),t.apply(l,l),t.apply(c,c),t.apply(u,u),Math.max(a.x,l.x,c.x,u.x)<=r||Math.min(a.x,l.x,c.x,u.x)>=s||Math.max(a.y,l.y,c.y,u.y)<=n||Math.min(a.y,l.y,c.y,u.y)>=o))return!1;let d=h*(l.y-a.y),f=h*(a.x-l.x),p=d*r+f*n,m=d*s+f*n,g=d*r+f*o,y=d*s+f*o;if(Math.max(p,m,g,y)<=d*a.x+f*a.y||Math.min(p,m,g,y)>=d*u.x+f*u.y)return!1;let x=h*(a.y-c.y),b=h*(c.x-a.x),_=x*r+b*n,w=x*s+b*n,A=x*r+b*o,k=x*s+b*o;return!(Math.max(_,w,A,k)<=x*a.x+b*a.y||Math.min(_,w,A,k)>=x*u.x+b*u.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2,this}fit(e){let t=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),s=Math.max(this.y,e.y),n=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(r-t,0),this.y=s,this.height=Math.max(n-s,0),this}ceil(e=1,t=.001){let r=Math.ceil((this.x+this.width-t)*e)/e,s=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=r-this.x,this.height=s-this.y,this}enlarge(e){let t=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),s=Math.min(this.y,e.y),n=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=r-t,this.y=s,this.height=n-s,this}};ve.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};var fo=class i{constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.radius=r,this.type=Lt.CIRC}clone(){return new i(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;let r=this.radius*this.radius,s=this.x-e,n=this.y-t;return s*=s,n*=n,s+n<=r}getBounds(){return new ve(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}};fo.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};var Y1=class i{constructor(e=0,t=0,r=0,s=0){this.x=e,this.y=t,this.width=r,this.height=s,this.type=Lt.ELIP}clone(){return new i(this.x,this.y,this.width,this.height)}contains(e,t){if(this.width<=0||this.height<=0)return!1;let r=(e-this.x)/this.width,s=(t-this.y)/this.height;return r*=r,s*=s,r+s<=1}getBounds(){return new ve(this.x-this.width,this.y-this.height,this.width,this.height)}};Y1.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};var Ui=class i{constructor(...e){let t=Array.isArray(e[0])?e[0]:e;if(typeof t[0]!="number"){let r=[];for(let s=0,n=t.length;s<n;s++)r.push(t[s].x,t[s].y);t=r}this.points=t,this.type=Lt.POLY,this.closeStroke=!0}clone(){let e=this.points.slice(),t=new i(e);return t.closeStroke=this.closeStroke,t}contains(e,t){let r=!1,s=this.points.length/2;for(let n=0,o=s-1;n<s;o=n++){let a=this.points[n*2],l=this.points[n*2+1],c=this.points[o*2],u=this.points[o*2+1];l>t!=u>t&&e<(c-a)*((t-l)/(u-l))+a&&(r=!r)}return r}};Ui.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((i,e)=>`${i}, ${e}`,"")}]`};var K1=class i{constructor(e=0,t=0,r=0,s=0,n=20){this.x=e,this.y=t,this.width=r,this.height=s,this.radius=n,this.type=Lt.RREC}clone(){return new i(this.x,this.y,this.width,this.height,this.radius)}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){let r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+r&&t<=this.y+this.height-r||e>=this.x+r&&e<=this.x+this.width-r)return!0;let s=e-(this.x+r),n=t-(this.y+r),o=r*r;if(s*s+n*n<=o||(s=e-(this.x+this.width-r),s*s+n*n<=o)||(n=t-(this.y+this.height-r),s*s+n*n<=o)||(s=e-(this.x+r),s*s+n*n<=o))return!0}return!1}};K1.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};var rt=class i{constructor(e=1,t=0,r=0,s=1,n=0,o=0){this.array=null,this.a=e,this.b=t,this.c=r,this.d=s,this.tx=n,this.ty=o}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,r,s,n,o){return this.a=e,this.b=t,this.c=r,this.d=s,this.tx=n,this.ty=o,this}toArray(e,t){this.array||(this.array=new Float32Array(9));let r=t||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(e,t){t=t||new _e;let r=e.x,s=e.y;return t.x=this.a*r+this.c*s+this.tx,t.y=this.b*r+this.d*s+this.ty,t}applyInverse(e,t){t=t||new _e;let r=1/(this.a*this.d+this.c*-this.b),s=e.x,n=e.y;return t.x=this.d*r*s+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,t.y=this.a*r*n+-this.b*r*s+(-this.ty*this.a+this.tx*this.b)*r,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){let t=Math.cos(e),r=Math.sin(e),s=this.a,n=this.c,o=this.tx;return this.a=s*t-this.b*r,this.b=s*r+this.b*t,this.c=n*t-this.d*r,this.d=n*r+this.d*t,this.tx=o*t-this.ty*r,this.ty=o*r+this.ty*t,this}append(e){let t=this.a,r=this.b,s=this.c,n=this.d;return this.a=e.a*t+e.b*s,this.b=e.a*r+e.b*n,this.c=e.c*t+e.d*s,this.d=e.c*r+e.d*n,this.tx=e.tx*t+e.ty*s+this.tx,this.ty=e.tx*r+e.ty*n+this.ty,this}setTransform(e,t,r,s,n,o,a,l,c){return this.a=Math.cos(a+c)*n,this.b=Math.sin(a+c)*n,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=e-(r*this.a+s*this.c),this.ty=t-(r*this.b+s*this.d),this}prepend(e){let t=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){let r=this.a,s=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=s*e.a+this.d*e.c,this.d=s*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){let t=this.a,r=this.b,s=this.c,n=this.d,o=e.pivot,a=-Math.atan2(-s,n),l=Math.atan2(r,t),c=Math.abs(a+l);return c<1e-5||Math.abs(sa-c)<1e-5?(e.rotation=l,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=a,e.skew.y=l),e.scale.x=Math.sqrt(t*t+r*r),e.scale.y=Math.sqrt(s*s+n*n),e.position.x=this.tx+(o.x*t+o.y*s),e.position.y=this.ty+(o.x*r+o.y*n),e}invert(){let e=this.a,t=this.b,r=this.c,s=this.d,n=this.tx,o=e*s-t*r;return this.a=s/o,this.b=-t/o,this.c=-r/o,this.d=e/o,this.tx=(r*this.ty-s*n)/o,this.ty=-(e*this.ty-t*n)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){let e=new i;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return new i}static get TEMP_MATRIX(){return new i}};rt.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};var Za=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Ja=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],el=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],tl=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],B8=[],dA=[],jh=Math.sign;function FL(){for(let i=0;i<16;i++){let e=[];B8.push(e);for(let t=0;t<16;t++){let r=jh(Za[i]*Za[t]+el[i]*Ja[t]),s=jh(Ja[i]*Za[t]+tl[i]*Ja[t]),n=jh(Za[i]*el[t]+el[i]*tl[t]),o=jh(Ja[i]*el[t]+tl[i]*tl[t]);for(let a=0;a<16;a++)if(Za[a]===r&&Ja[a]===s&&el[a]===n&&tl[a]===o){e.push(a);break}}}for(let i=0;i<16;i++){let e=new rt;e.set(Za[i],Ja[i],el[i],tl[i],0,0),dA.push(e)}}FL();var Wt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>Za[i],uY:i=>Ja[i],vX:i=>el[i],vY:i=>tl[i],inv:i=>i&8?i&15:-i&7,add:(i,e)=>B8[i][e],sub:(i,e)=>B8[i][Wt.inv(e)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,e)=>Math.abs(i)*2<=Math.abs(e)?e>=0?Wt.S:Wt.N:Math.abs(e)*2<=Math.abs(i)?i>0?Wt.E:Wt.W:e>0?i>0?Wt.SE:Wt.SW:i>0?Wt.NE:Wt.NW,matrixAppendRotationInv:(i,e,t=0,r=0)=>{let s=dA[Wt.inv(e)];s.tx=t,s.ty=r,i.append(s)}};var sr=class i{constructor(e,t,r=0,s=0){this._x=r,this._y=s,this.cb=e,this.scope=t}clone(e=this.cb,t=this.scope){return new i(e,t,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}};sr.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};var U8=class{constructor(){this.worldTransform=new rt,this.localTransform=new rt,this.position=new sr(this.onChange,this,0,0),this.scale=new sr(this.onChange,this,1,1),this.pivot=new sr(this.onChange,this,0,0),this.skew=new sr(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){let i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){let e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){let t=i.worldTransform,r=this.worldTransform;r.a=e.a*t.a+e.b*t.c,r.b=e.a*t.b+e.b*t.d,r.c=e.c*t.a+e.d*t.c,r.d=e.c*t.b+e.d*t.d,r.tx=e.tx*t.a+e.ty*t.c+t.tx,r.ty=e.tx*t.b+e.ty*t.d+t.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}};U8.IDENTITY=new U8;var il=U8;il.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var fA=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`;var pA=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Vh(i,e,t){let r=i.createShader(e);return i.shaderSource(r,t),i.compileShader(r),r}function $8(i){let e=new Array(i);for(let t=0;t<e.length;t++)e[t]=!1;return e}function t4(i,e){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return $8(2*e);case"bvec3":return $8(3*e);case"bvec4":return $8(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var kn=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,e)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(e==null||e.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,e)=>i.type==="mat3"&&i.size===1&&!i.isArray&&e.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,e)=>i.type==="vec2"&&i.size===1&&!i.isArray&&e.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,e)=>i.type==="vec4"&&i.size===1&&!i.isArray&&e.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(i,e)=>i.type==="vec4"&&i.size===1&&!i.isArray&&e.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${i}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(i,e)=>i.type==="vec3"&&i.size===1&&!i.isArray&&e.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${i}"].location, v.red, v.green, v.blue)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}];var LL={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},OL={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function H8(i,e){var r;let t=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(let s in i.uniforms){let n=e[s];if(!n){((r=i.uniforms[s])==null?void 0:r.group)===!0&&(i.uniforms[s].ubo?t.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${s}, '${s}');
                    `):t.push(`
                        renderer.shader.syncUniformGroup(uv.${s}, syncData);
                    `));continue}let o=i.uniforms[s],a=!1;for(let l=0;l<kn.length;l++)if(kn[l].test(n,o)){t.push(kn[l].code(s,o)),a=!0;break}if(!a){let l=(n.size===1&&!n.isArray?LL:OL)[n.type].replace("location",`ud["${s}"].location`);t.push(`
            cu = ud["${s}"];
            cv = cu.value;
            v = uv["${s}"];
            ${l};`)}}return new Function("ud","uv","renderer","syncData",t.join(`
`))}var mA={},Z1=mA;function Wh(){if(Z1===mA||Z1!=null&&Z1.isContextLost()){let i=te.ADAPTER.createCanvas(),e;te.PREFER_ENV>=br.WEBGL2&&(e=i.getContext("webgl2",{})),e||(e=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),Z1=e}return Z1}var Xh;function G8(){if(!Xh){Xh=wr.MEDIUM;let i=Wh();if(i&&i.getShaderPrecisionFormat){let e=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);e&&(Xh=e.precision?wr.HIGH:wr.MEDIUM)}}return Xh}function gA(i,e){let t=i.getShaderSource(e).split(`
`).map((c,u)=>`${u}: ${c}`),r=i.getShaderInfoLog(e),s=r.split(`
`),n={},o=s.map(c=>parseFloat(c.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(c=>c&&!n[c]?(n[c]=!0,!0):!1),a=[""];o.forEach(c=>{t[c-1]=`%c${t[c-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});let l=t.join(`
`);a[0]=l,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function z8(i,e,t,r){i.getProgramParameter(e,i.LINK_STATUS)||(i.getShaderParameter(t,i.COMPILE_STATUS)||gA(i,t),i.getShaderParameter(r,i.COMPILE_STATUS)||gA(i,r),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(e)))}var BL={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function i4(i){return BL[i]}var qh=null,yA={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function r4(i,e){if(!qh){let t=Object.keys(yA);qh={};for(let r=0;r<t.length;++r){let s=t[r];qh[i[s]]=yA[s]}}return qh[e]}function Qh(i,e,t){if(i.substring(0,9)!=="precision"){let r=e;return e===wr.HIGH&&t!==wr.HIGH&&(r=wr.MEDIUM),`precision ${r} float;
${i}`}else if(t!==wr.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}var s4;function Yh(){if(typeof s4=="boolean")return s4;try{s4=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch(i){s4=!1}return s4}var UL=0,Kh={},j8=class J1{constructor(e,t,r="pixi-shader",s={}){this.extra={},this.id=UL++,this.vertexSrc=e||J1.defaultVertexSrc,this.fragmentSrc=t||J1.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Kh[r]?(Kh[r]++,r+=`-${Kh[r]}`):Kh[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=Qh(this.vertexSrc,J1.defaultVertexPrecision,wr.HIGH),this.fragmentSrc=Qh(this.fragmentSrc,J1.defaultFragmentPrecision,G8())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return pA}static get defaultFragmentSrc(){return fA}static from(e,t,r){let s=e+t,n=S2[s];return n||(S2[s]=n=new J1(e,t,r)),n}};j8.defaultVertexPrecision=wr.HIGH,j8.defaultFragmentPrecision=bs.apple.device?wr.HIGH:wr.MEDIUM;var nr=j8;var $L=0,Cr=class i{constructor(e,t,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=$L++,this.static=!!t,this.ubo=!!r,e instanceof Pt?(this.buffer=e,this.buffer.type=Or.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new Pt(new Float32Array(1)),this.buffer.type=Or.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,t,r){if(!this.ubo)this.uniforms[e]=new i(t,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(e,t,r){return new i(e,t,r)}static uboFrom(e,t){return new i(e,t!=null?t:!0,!0)}};var Qi=class i{constructor(e,t){this.uniformBindCount=0,this.program=e,t?t instanceof Cr?this.uniformGroup=t:this.uniformGroup=new Cr(t):this.uniformGroup=new Cr({}),this.disposeRunner=new vi("disposeShader")}checkUniformExists(e,t){if(t.uniforms[e])return!0;for(let r in t.uniforms){let s=t.uniforms[r];if(s.group===!0&&this.checkUniformExists(e,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,t,r){let s=nr.from(e,t);return new i(s,r)}};var n4=class{constructor(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},!t.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!t.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){let r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=n;this.defaultGroupCache[e]=Cr.from({uSamplers:r},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${e}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new nr(this.vertexSrc,s)}let t={tint:new Float32Array([1,1,1,1]),translationMatrix:new rt,default:this.defaultGroupCache[e]};return new Qi(this.programCache[e],t)}generateSampleSrc(e){let t="";t+=`
`,t+=`
`;for(let r=0;r<e;r++)r>0&&(t+=`
else `),r<e-1&&(t+=`if(vTextureId < ${r}.5)`),t+=`
{`,t+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,t+=`
}`;return t+=`
`,t+=`
`,t}};var na=class{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}};function xA(){return!bs.apple.device}function vA(i){let e=!0,t=te.ADAPTER.getNavigator();if(bs.tablet||bs.phone){if(bs.apple.device){let r=t.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(e=!1)}if(bs.android.device){let r=t.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(e=!1)}}return e?i:4}var Zs=class{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}};var _A=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`;var bA=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;var o4=class Js extends Zs{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=Ka,this.vertexSize=6,this.state=Bi.for2d(),this.size=Js.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){var e;return this._defaultMaxTextures=(e=this._defaultMaxTextures)!=null?e:vA(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){var e;return this._canUploadSameBuffer=(e=this._canUploadSameBuffer)!=null?e:xA(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return je("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return bA}static get defaultFragmentTemplate(){return _A}setShaderGenerator({vertex:e=Js.defaultVertexSrc,fragment:t=Js.defaultFragmentTemplate}={}){this.shaderGenerator=new n4(e,t)}contextChange(){let e=this.renderer.gl;te.PREFER_ENV===br.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),Js.defaultMaxTextures),this.maxTextures=Gh(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){let{_drawCallPool:e,_textureArrayPool:t}=Js,r=this.size/4,s=Math.floor(r/this.maxTextures)+1;for(;e.length<r;)e.push(new ra);for(;t.length<s;)t.push(new na);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){let{_bufferedTextures:e,maxTextures:t}=this,r=Js._textureArrayPool,s=this.renderer.batch,n=this._tempBoundTextures,o=this.renderer.textureGC.count,a=++Ae._globalBatch,l=0,c=r[0],u=0;s.copyBoundTextures(n,t);for(let h=0;h<this._bufferSize;++h){let d=e[h];e[h]=null,d._batchEnabled!==a&&(c.count>=t&&(s.boundArray(c,n,a,t),this.buildDrawCalls(c,u,h),u=h,c=r[++l],++a),d._batchEnabled=a,d.touched=o,c.elements[c.count++]=d)}c.count>0&&(s.boundArray(c,n,a,t),this.buildDrawCalls(c,u,this._bufferSize),++l,++a);for(let h=0;h<n.length;h++)n[h]=null;Ae._globalBatch=a}buildDrawCalls(e,t,r){let{_bufferedElements:s,_attributeBuffer:n,_indexBuffer:o,vertexSize:a}=this,l=Js._drawCallPool,c=this._dcIndex,u=this._aIndex,h=this._iIndex,d=l[c];d.start=this._iIndex,d.texArray=e;for(let f=t;f<r;++f){let p=s[f],m=p._texture.baseTexture,g=b2[m.alphaMode?1:0][p.blendMode];s[f]=null,t<f&&d.blend!==g&&(d.size=h-d.start,t=f,d=l[++c],d.texArray=e,d.start=h),this.packInterleavedGeometry(p,n,o,u,h),u+=p.vertexData.length/2*a,h+=p.indices.length,d.blend=g}t<r&&(d.size=h-d.start,++c),this._dcIndex=c,this._aIndex=u,this._iIndex=h}bindAndClearTexArray(e){let t=this.renderer.texture;for(let r=0;r<e.count;r++)t.bind(e.elements[r],e.ids[r]),e.elements[r]=null;e.count=0}updateGeometry(){let{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:r}=this;Js.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){let e=this._dcIndex,{gl:t,state:r}=this.renderer,s=Js._drawCallPool,n=null;for(let o=0;o<e;o++){let{texArray:a,type:l,size:c,start:u,blend:h}=s[o];n!==a&&(n=a,this.bindAndClearTexArray(a)),this.state.blendMode=h,r.set(this.state),t.drawElements(l,c,t.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Js.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){let t=Jo(Math.ceil(e/8)),r=E2(t),s=t*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._aBuffers[s];return n||(this._aBuffers[s]=n=new ia(s*this.vertexSize*4)),n}getIndexBuffer(e){let t=Jo(Math.ceil(e/12)),r=E2(t),s=t*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._iBuffers[r];return n||(this._iBuffers[r]=n=new Uint16Array(s)),n}packInterleavedGeometry(e,t,r,s,n){let{uint32View:o,float32View:a}=t,l=s/this.vertexSize,c=e.uvs,u=e.indices,h=e.vertexData,d=e._texture.baseTexture._batchLocation,f=Math.min(e.worldAlpha,1),p=we.shared.setValue(e._tintRGB).toPremultiplied(f,e._texture.baseTexture.alphaMode>0);for(let m=0;m<h.length;m+=2)a[s++]=h[m],a[s++]=h[m+1],a[s++]=c[m],a[s++]=c[m+1],o[s++]=p,a[s++]=d;for(let m=0;m<u.length;m++)r[n++]=l+u[m]}};o4.defaultBatchSize=4096,o4.extension={name:"batch",type:ee.RendererPlugin},o4._drawCallPool=[],o4._textureArrayPool=[];var po=o4;ne.add(po);var wA=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`;var EA=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var V8=class a4 extends Qi{constructor(e,t,r){let s=nr.from(e||a4.defaultVertexSrc,t||a4.defaultFragmentSrc);super(s,r),this.padding=0,this.resolution=a4.defaultResolution,this.multisample=a4.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Bi}apply(e,t,r,s,n){e.applyFilter(this,t,r,s)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return EA}static get defaultFragmentSrc(){return wA}};V8.defaultResolution=1,V8.defaultMultisample=bt.NONE;var ye=V8;var mo=class{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new we(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;let{backgroundColor:t,background:r,backgroundAlpha:s}=e,n=r!=null?r:t;n!==void 0&&(this.color=n),this.alpha=s}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}};mo.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},mo.extension={type:[ee.RendererSystem,ee.CanvasRendererSystem],name:"background"};ne.add(mo);var ec=class{constructor(e){this.renderer=e,this.emptyRenderer=new Zs(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,t){let{boundTextures:r}=this.renderer.texture;for(let s=t-1;s>=0;--s)e[s]=r[s]||null,e[s]&&(e[s]._batchLocation=s)}boundArray(e,t,r,s){let{elements:n,ids:o,count:a}=e,l=0;for(let c=0;c<a;c++){let u=n[c],h=u._batchLocation;if(h>=0&&h<s&&t[h]===u){o[c]=h;continue}for(;l<s;){let d=t[l];if(d&&d._batchEnabled===r&&d._batchLocation===l){l++;continue}o[c]=l,u._batchLocation=l,t[l]=u;break}}}destroy(){this.renderer=null}};ec.extension={type:ee.RendererSystem,name:"batch"};ne.add(ec);var AA=0,go=class{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=AA++}init(e){if(e.context)this.initFromContext(e.context);else{let t=this.renderer.background.alpha<1,r=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:t,premultipliedAlpha:r,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=AA++,this.renderer.runners.contextChange.emit(e);let t=this.renderer.view;t.addEventListener!==void 0&&(t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){let t=this.createContext(this.renderer.view,e);this.initFromContext(t)}createContext(e,t){let r;if(te.PREFER_ENV>=br.WEBGL2&&(r=e.getContext("webgl2",t)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){let{gl:e}=this,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){let e=this.renderer.view;this.renderer=null,e.removeEventListener!==void 0&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){let t=e.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");let s=r||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}};go.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},go.extension={type:ee.RendererSystem,name:"context"};ne.add(go);var oa=class{constructor(e,t){if(this.width=Math.round(e),this.height=Math.round(t),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new vi("disposeFramebuffer"),this.multisample=bt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,t){return this.colorTextures[e]=t||new Ae(null,{scaleMode:Xi.NEAREST,resolution:1,mipmap:bi.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new Ae(null,{scaleMode:Xi.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:bi.OFF,format:le.DEPTH_COMPONENT,type:Se.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,t){if(e=Math.round(e),t=Math.round(t),!e||!t)throw new Error("Framebuffer width and height must not be zero");if(!(e===this.width&&t===this.height)){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){let s=this.colorTextures[r],n=s.resolution;s.setSize(e/n,t/n)}if(this.depthTexture){let r=this.depthTexture.resolution;this.depthTexture.setSize(e/r,t/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}};var aa=class extends Ae{constructor(e={}){var t,r,s;if(typeof e=="number"){let n=arguments[0],o=arguments[1],a=arguments[2],l=arguments[3];e={width:n,height:o,scaleMode:a,resolution:l}}e.width=(t=e.width)!=null?t:100,e.height=(r=e.height)!=null?r:100,(s=e.multisample)!=null||(e.multisample=bt.NONE),super(null,e),this.mipmap=bi.OFF,this.valid=!0,this._clear=new we([0,0,0,0]),this.framebuffer=new oa(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}};var Ii=class extends Ar{constructor(e){let t=e,r=t.naturalWidth||t.videoWidth||t.displayWidth||t.width,s=t.naturalHeight||t.videoHeight||t.displayHeight||t.height;super(r,s),this.source=e,this.noSubImage=!1}static crossOrigin(e,t,r){r===void 0&&!t.startsWith("data:")?e.crossOrigin=xh(t):r!==!1&&(e.crossOrigin=typeof r=="string"?r:"anonymous")}upload(e,t,r,s){let n=e.gl,o=t.realWidth,a=t.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===jt.UNPACK),!this.noSubImage&&t.target===n.TEXTURE_2D&&r.width===o&&r.height===a?n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.format,r.type,s):(r.width=o,r.height=a,n.texImage2D(t.target,0,r.internalFormat,t.format,r.type,s)),!0}update(){if(this.destroyed)return;let e=this.source,t=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;this.resize(t,r),super.update()}dispose(){this.source=null}};var rl=class extends Ii{constructor(e,t){var r;if(t=t||{},typeof e=="string"){let s=new Image;Ii.crossOrigin(s,e,t.crossorigin),s.src=e,e=s}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=((r=t.createBitmap)!=null?r:te.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.bitmap=null,this._load=null,t.autoLoad!==!1&&this.load()}load(e){return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise((t,r)=>{let s=this.source;this.url=s.src;let n=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.update(),this._load=null,this.createBitmap?t(this.process()):t(this))};s.complete&&s.src?n():(s.onload=n,s.onerror=o=>{r(o),this.onError.emit(o)})}),this._load)}process(){let e=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);let t=globalThis.createImageBitmap,r=!e.crossOrigin||e.crossOrigin==="anonymous";return this._process=fetch(e.src,{mode:r?"cors":"no-cors"}).then(s=>s.blob()).then(s=>t(s,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===jt.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,t,r){if(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,t,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,t,r,this.bitmap),!this.preserveBitmap){let s=!0,n=t._glTextures;for(let o in n){let a=n[o];if(a!==r&&a.dirtyId!==t.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&(typeof e=="string"||e instanceof HTMLImageElement)}};var sl=class{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,r){let s=t.width,n=t.height;if(r){let o=e.width/2/s,a=e.height/2/n,l=e.x/s+o,c=e.y/n+a;r=Wt.add(r,Wt.NW),this.x0=l+o*Wt.uX(r),this.y0=c+a*Wt.uY(r),r=Wt.add(r,2),this.x1=l+o*Wt.uX(r),this.y1=c+a*Wt.uY(r),r=Wt.add(r,2),this.x2=l+o*Wt.uX(r),this.y2=c+a*Wt.uY(r),r=Wt.add(r,2),this.x3=l+o*Wt.uX(r),this.y3=c+a*Wt.uY(r)}else this.x0=e.x/s,this.y0=e.y/n,this.x1=(e.x+e.width)/s,this.y1=e.y/n,this.x2=(e.x+e.width)/s,this.y2=(e.y+e.height)/n,this.x3=e.x/s,this.y3=(e.y+e.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}};sl.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};var SA=new sl;function Zh(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}var xe=class i extends pi.default{constructor(e,t,r,s,n,o,a){if(super(),this.noFrame=!1,t||(this.noFrame=!0,t=new ve(0,0,1,1)),e instanceof i&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=s,this.valid=!1,this.destroyed=!1,this._uvs=SA,this.uvMatrix=null,this.orig=r||t,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new _e(o.x,o.y):new _e(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=t:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){let{resource:t}=this.baseTexture;t!=null&&t.url&&Fi[t.url]&&i.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,i.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var s;let e=this._frame.clone(),t=this._frame===this.orig?e:this.orig.clone(),r=new i(this.baseTexture,!this.noFrame&&e,t,(s=this.trim)==null?void 0:s.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=e),r}updateUvs(){this._uvs===SA&&(this._uvs=new sl),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,t={},r=te.STRICT_TEXTURE_CACHE){let s=typeof e=="string",n=null;if(s)n=e;else if(e instanceof Ae){if(!e.cacheId){let a=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e.cacheId=`${a}-${An()}`,Ae.addToCache(e,e.cacheId)}n=e.cacheId}else{if(!e._pixiId){let a=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${a}_${An()}`}n=e._pixiId}let o=Fi[n];if(s&&r&&!o)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!o&&!(e instanceof Ae)?(t.resolution||(t.resolution=C2(e)),o=new i(new Ae(e,t)),o.baseTexture.cacheId=n,Ae.addToCache(o.baseTexture,n),i.addToCache(o,n)):!o&&e instanceof Ae&&(o=new i(e),i.addToCache(o,n)),o}static fromURL(e,t){let r=Object.assign({autoLoad:!1},t==null?void 0:t.resourceOptions),s=i.from(e,Object.assign({resourceOptions:r},t),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then(()=>Promise.resolve(s))}static fromBuffer(e,t,r,s){return new i(Ae.fromBuffer(e,t,r,s))}static fromLoader(e,t,r,s){let n=new Ae(e,Object.assign({scaleMode:Ae.defaultOptions.scaleMode,resolution:C2(t)},s)),{resource:o}=n;o instanceof rl&&(o.url=t);let a=new i(n);return r||(r=t),Ae.addToCache(a.baseTexture,r),i.addToCache(a,r),r!==t&&(Ae.addToCache(a.baseTexture,t),i.addToCache(a,t)),a.baseTexture.valid?Promise.resolve(a):new Promise(l=>{a.baseTexture.once("loaded",()=>l(a))})}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),Fi[t]&&Fi[t]!==e&&console.warn(`Texture added to the cache with an id [${t}] that already had an entry`),Fi[t]=e)}static removeFromCache(e){if(typeof e=="string"){let t=Fi[e];if(t){let r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete Fi[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)Fi[e.textureCacheIds[t]]===e&&delete Fi[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;let{x:t,y:r,width:s,height:n}=e,o=t+s>this.baseTexture.width,a=r+n>this.baseTexture.height;if(o||a){let l=o&&a?"and":"or",c=`X: ${t} + ${s} = ${t+s} > ${this.baseTexture.width}`,u=`Y: ${r} + ${n} = ${r+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${c} ${l} ${u}`)}this.valid=s&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return i._EMPTY||(i._EMPTY=new i(new Ae),Zh(i._EMPTY),Zh(i._EMPTY.baseTexture)),i._EMPTY}static get WHITE(){if(!i._WHITE){let e=te.ADAPTER.createCanvas(16,16),t=e.getContext("2d");e.width=16,e.height=16,t.fillStyle="white",t.fillRect(0,0,16,16),i._WHITE=new i(Ae.from(e)),Zh(i._WHITE),Zh(i._WHITE.baseTexture)}return i._WHITE}};var ts=class i extends xe{constructor(e,t){super(e,t),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t,r=!0){let s=this.baseTexture.resolution,n=Math.round(e*s)/s,o=Math.round(t*s)/s;this.valid=n>0&&o>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=o,r&&this.baseTexture.resize(n,o),this.updateUvs()}setResolution(e){let{baseTexture:t}=this;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))}static create(e){return new i(new aa(e))}};var tc=class{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,t,r=bt.NONE){let s=new aa(Object.assign({width:e,height:t,resolution:1,multisample:r},this.textureOptions));return new ts(s)}getOptimalTexture(e,t,r=1,s=bt.NONE){let n;e=Math.max(Math.ceil(e*r-1e-6),1),t=Math.max(Math.ceil(t*r-1e-6),1),!this.enableFullScreen||e!==this._pixelsWidth||t!==this._pixelsHeight?(e=Jo(e),t=Jo(t),n=((e&65535)<<16|t&65535)>>>0,s>1&&(n+=s*4294967296)):n=s>1?-s:-1,this.texturePool[n]||(this.texturePool[n]=[]);let o=this.texturePool[n].pop();return o||(o=this.createTexture(e,t,s)),o.filterPoolKey=n,o.setResolution(r),o}getFilterTexture(e,t,r){let s=this.getOptimalTexture(e.width,e.height,t||e.resolution,r||bt.NONE);return s.filterFrame=e.filterFrame,s}returnTexture(e){let t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=e!==!1,e)for(let t in this.texturePool){let r=this.texturePool[t];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0)}this.texturePool={}}setScreenSize(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(let t in this.texturePool){if(!(Number(t)<0))continue;let r=this.texturePool[t];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}};tc.SCREEN_KEY=-1;var l4=class extends Sr{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}};var nl=class extends Sr{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Pt(this.vertices),this.uvBuffer=new Pt(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,t){let r=0,s=0;return this.uvs[0]=r,this.uvs[1]=s,this.uvs[2]=r+t.width/e.width,this.uvs[3]=s,this.uvs[4]=r+t.width/e.width,this.uvs[5]=s+t.height/e.height,this.uvs[6]=r,this.uvs[7]=s+t.height/e.height,r=t.x,s=t.y,this.vertices[0]=r,this.vertices[1]=s,this.vertices[2]=r+t.width,this.vertices[3]=s,this.vertices[4]=r+t.width,this.vertices[5]=s+t.height,this.vertices[6]=r,this.vertices[7]=s+t.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}};var c4=class{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=bt.NONE,this.sourceFrame=new ve,this.destinationFrame=new ve,this.bindingSourceFrame=new ve,this.bindingDestinationFrame=new ve,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}};var Jh=[new _e,new _e,new _e,new _e],W8=new rt,ic=class{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new tc,this.statePool=[],this.quad=new l4,this.quadUv=new nl,this.tempRect=new ve,this.activeState={},this.globalUniforms=new Cr({outputFrame:new ve,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,t){var g,y,x,b;let r=this.renderer,s=this.defaultFilterStack,n=this.statePool.pop()||new c4,o=r.renderTexture,a,l;if(o.current){let _=o.current;a=_.resolution,l=_.multisample}else a=r.resolution,l=r.multisample;let c=t[0].resolution||a,u=(g=t[0].multisample)!=null?g:l,h=t[0].padding,d=t[0].autoFit,f=(y=t[0].legacy)!=null?y:!0;for(let _=1;_<t.length;_++){let w=t[_];c=Math.min(c,w.resolution||a),u=Math.min(u,(x=w.multisample)!=null?x:l),h=this.useMaxPadding?Math.max(h,w.padding):h+w.padding,d=d&&w.autoFit,f=f||((b=w.legacy)!=null?b:!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),s.push(n),n.resolution=c,n.multisample=u,n.legacy=f,n.target=e,n.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),n.sourceFrame.pad(h);let p=this.tempRect.copyFrom(o.sourceFrame);r.projection.transform&&this.transformAABB(W8.copyFrom(r.projection.transform).invert(),p),d?(n.sourceFrame.fit(p),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(p)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,o.current?o.current.resolution:r.resolution,o.sourceFrame,o.destinationFrame,r.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,c,u),n.filters=t,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;let m=this.tempRect;m.x=0,m.y=0,m.width=n.sourceFrame.width,m.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(o.sourceFrame),n.bindingDestinationFrame.copyFrom(o.destinationFrame),n.transform=r.projection.transform,r.projection.transform=null,o.bind(n.renderTexture,n.sourceFrame,m),r.framebuffer.clear(0,0,0,0)}pop(){let e=this.defaultFilterStack,t=e.pop(),r=t.filters;this.activeState=t;let s=this.globalUniforms.uniforms;s.outputFrame=t.sourceFrame,s.resolution=t.resolution;let n=s.inputSize,o=s.inputPixel,a=s.inputClamp;if(n[0]=t.destinationFrame.width,n[1]=t.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=Math.round(n[0]*t.resolution),o[1]=Math.round(n[1]*t.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=t.sourceFrame.width*n[2]-.5*o[2],a[3]=t.sourceFrame.height*n[3]-.5*o[3],t.legacy){let c=s.filterArea;c[0]=t.destinationFrame.width,c[1]=t.destinationFrame.height,c[2]=t.sourceFrame.x,c[3]=t.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();let l=e[e.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,t.renderTexture,l.renderTexture,es.BLEND,t),this.returnFilterTexture(t.renderTexture);else{let c=t.renderTexture,u=this.getOptimalFilterTexture(c.width,c.height,t.resolution);u.filterFrame=c.filterFrame;let h=0;for(h=0;h<r.length-1;++h){h===1&&t.multisample>1&&(u=this.getOptimalFilterTexture(c.width,c.height,t.resolution),u.filterFrame=c.filterFrame),r[h].apply(this,c,u,es.CLEAR,t);let d=c;c=u,u=d}r[h].apply(this,c,l.renderTexture,es.BLEND,t),h>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(c),this.returnFilterTexture(u)}t.clear(),this.statePool.push(t)}bindAndClear(e,t=es.CLEAR){let{renderTexture:r,state:s}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e==null?void 0:e.filterFrame){let o=this.tempRect;o.x=0,o.y=0,o.width=e.filterFrame.width,o.height=e.filterFrame.height,r.bind(e,e.filterFrame,o)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);let n=s.stateId&1||this.forceClear;(t===es.CLEAR||t===es.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,t,r,s){let n=this.renderer;n.state.set(e.state),this.bindAndClear(r,s),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(Fr.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(Fr.TRIANGLE_STRIP))}calculateSpriteMatrix(e,t){let{sourceFrame:r,destinationFrame:s}=this.activeState,{orig:n}=t._texture,o=e.set(s.width,0,0,s.height,r.x,r.y),a=t.worldTransform.copyTo(rt.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/n.width,1/n.height),o.translate(t.anchor.x,t.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,t,r=1,s=bt.NONE){return this.texturePool.getOptimalTexture(e,t,r,s)}getFilterTexture(e,t,r){if(typeof e=="number"){let n=e;e=t,t=n}e=e||this.activeState.renderTexture;let s=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,r||bt.NONE);return s.filterFrame=e.filterFrame,s}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,t){let r=Jh[0],s=Jh[1],n=Jh[2],o=Jh[3];r.set(t.left,t.top),s.set(t.left,t.bottom),n.set(t.right,t.top),o.set(t.right,t.bottom),e.apply(r,r),e.apply(s,s),e.apply(n,n),e.apply(o,o);let a=Math.min(r.x,s.x,n.x,o.x),l=Math.min(r.y,s.y,n.y,o.y),c=Math.max(r.x,s.x,n.x,o.x),u=Math.max(r.y,s.y,n.y,o.y);t.x=a,t.y=l,t.width=c-a,t.height=u-l}roundFrame(e,t,r,s,n){if(!(e.width<=0||e.height<=0||r.width<=0||r.height<=0)){if(n){let{a:o,b:a,c:l,d:c}=n;if((Math.abs(a)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(c)>1e-4))return}n=n?W8.copyFrom(n):W8.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.transformAABB(n,e),e.ceil(t),this.transformAABB(n.invert(),e)}}};ic.extension={type:ee.RendererSystem,name:"filter"};ne.add(ic);var u4=class{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=bt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}};var HL=new ve,rc=class{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new oa(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);let e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new ve,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let t=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;te.PREFER_ENV===br.WEBGL_LEGACY&&(t=null,r=null),t?e.drawBuffers=s=>t.drawBuffersWEBGL(s):(this.hasMRT=!1,e.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,t,r=0){let{gl:s}=this;if(e){let n=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(e.dirtyId++,e.dirtyFormat++,n.mipLevel=r),n.dirtyId!==e.dirtyId&&(n.dirtyId=e.dirtyId,n.dirtyFormat!==e.dirtyFormat?(n.dirtyFormat=e.dirtyFormat,n.dirtySize=e.dirtySize,this.updateFramebuffer(e,r)):n.dirtySize!==e.dirtySize&&(n.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let o=0;o<e.colorTextures.length;o++){let a=e.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){let o=t.width>>r,a=t.height>>r,l=o/t.width;this.setViewport(t.x*l,t.y*l,o,a)}else{let o=e.width>>r,a=e.height>>r;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,t,r,s){let n=this.viewport;e=Math.round(e),t=Math.round(t),r=Math.round(r),s=Math.round(s),(n.width!==r||n.height!==s||n.x!==e||n.y!==t)&&(n.x=e,n.y=t,n.width=r,n.height=s,this.gl.viewport(e,t,r,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,t,r,s,n=ch.COLOR|ch.DEPTH){let{gl:o}=this;o.clearColor(e,t,r,s),o.clear(n)}initFramebuffer(e){let{gl:t}=this,r=new u4(t.createFramebuffer());return r.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(e),e.disposeRunner.add(this),r}resizeFramebuffer(e){let{gl:t}=this,r=e.glFramebuffers[this.CONTEXT_UID];if(r.stencil){t.bindRenderbuffer(t.RENDERBUFFER,r.stencil);let o;this.renderer.context.webGLVersion===1?o=t.DEPTH_STENCIL:e.depth&&e.stencil?o=t.DEPTH24_STENCIL8:e.depth?o=t.DEPTH_COMPONENT24:o=t.STENCIL_INDEX8,r.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,o,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,o,e.width,e.height)}let s=e.colorTextures,n=s.length;t.drawBuffers||(n=Math.min(n,1));for(let o=0;o<n;o++){let a=s[o],l=a.parentTextureArray||a;this.renderer.texture.bind(l,0),o===0&&r.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,r.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,t){let{gl:r}=this,s=e.glFramebuffers[this.CONTEXT_UID],n=e.colorTextures,o=n.length;r.drawBuffers||(o=Math.min(o,1)),s.multisample>1&&this.canMultisampleFramebuffer(e)?s.msaaBuffer=s.msaaBuffer||r.createRenderbuffer():s.msaaBuffer&&(r.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));let a=[];for(let l=0;l<o;l++){let c=n[l],u=c.parentTextureArray||c;this.renderer.texture.bind(u,0),l===0&&s.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,s.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,s.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+l,c.target,u._glTextures[this.CONTEXT_UID].texture,t),a.push(r.COLOR_ATTACHMENT0+l))}if(a.length>1&&r.drawBuffers(a),e.depthTexture&&this.writeDepthTexture){let l=e.depthTexture;this.renderer.texture.bind(l,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,l._glTextures[this.CONTEXT_UID].texture,t)}if((e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)){s.stencil=s.stencil||r.createRenderbuffer();let l,c;this.renderer.context.webGLVersion===1?(l=r.DEPTH_STENCIL_ATTACHMENT,c=r.DEPTH_STENCIL):e.depth&&e.stencil?(l=r.DEPTH_STENCIL_ATTACHMENT,c=r.DEPTH24_STENCIL8):e.depth?(l=r.DEPTH_ATTACHMENT,c=r.DEPTH_COMPONENT24):(l=r.STENCIL_ATTACHMENT,c=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,s.stencil),s.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,c,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,c,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,l,r.RENDERBUFFER,s.stencil)}else s.stencil&&(r.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){let{msaaSamples:t}=this,r=bt.NONE;if(e<=1||t===null)return r;for(let s=0;s<t.length;s++)if(t[s]<=e){r=t[s];break}return r===1&&(r=bt.NONE),r}blit(e,t,r){let{current:s,renderer:n,gl:o,CONTEXT_UID:a}=this;if(n.context.webGLVersion!==2||!s)return;let l=s.glFramebuffers[a];if(!l)return;if(!e){if(!l.msaaBuffer)return;let u=s.colorTextures[0];if(!u)return;l.blitFramebuffer||(l.blitFramebuffer=new oa(s.width,s.height),l.blitFramebuffer.addColorTexture(0,u)),e=l.blitFramebuffer,e.colorTextures[0]!==u&&(e.colorTextures[0]=u,e.dirtyId++,e.dirtyFormat++),(e.width!==s.width||e.height!==s.height)&&(e.width=s.width,e.height=s.height,e.dirtyId++,e.dirtySize++)}t||(t=HL,t.width=s.width,t.height=s.height),r||(r=t);let c=t.width===r.width&&t.height===r.height;this.bind(e),o.bindFramebuffer(o.READ_FRAMEBUFFER,l.framebuffer),o.blitFramebuffer(t.left,t.top,t.right,t.bottom,r.left,r.top,r.right,r.bottom,o.COLOR_BUFFER_BIT,c?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,t){let r=e.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!r)return;delete e.glFramebuffers[this.CONTEXT_UID];let n=this.managedFramebuffers.indexOf(e);n>=0&&this.managedFramebuffers.splice(n,1),e.disposeRunner.remove(this),t||(s.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&s.deleteRenderbuffer(r.msaaBuffer),r.stencil&&s.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,t)}disposeAll(e){let t=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<t.length;r++)this.disposeFramebuffer(t[r],e)}forceStencil(){let e=this.current;if(!e)return;let t=e.glFramebuffers[this.CONTEXT_UID];if(!t||t.stencil&&e.stencil)return;e.stencil=!0;let r=e.width,s=e.height,n=this.gl,o=t.stencil=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o);let a,l;this.renderer.context.webGLVersion===1?(a=n.DEPTH_STENCIL_ATTACHMENT,l=n.DEPTH_STENCIL):e.depth?(a=n.DEPTH_STENCIL_ATTACHMENT,l=n.DEPTH24_STENCIL8):(a=n.STENCIL_ATTACHMENT,l=n.STENCIL_INDEX8),t.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,t.multisample,l,r,s):n.renderbufferStorage(n.RENDERBUFFER,l,r,s),n.framebufferRenderbuffer(n.FRAMEBUFFER,a,n.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new ve}destroy(){this.renderer=null}};rc.extension={type:ee.RendererSystem,name:"framebuffer"};ne.add(rc);var X8={5126:4,5123:2,5121:1},sc=class{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);let e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,t.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;te.PREFER_ENV===br.WEBGL_LEGACY&&(r=null),r?(e.createVertexArray=()=>r.createVertexArrayOES(),e.bindVertexArray=s=>r.bindVertexArrayOES(s),e.deleteVertexArray=s=>r.deleteVertexArrayOES(s)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(t.webGLVersion!==2){let r=e.getExtension("ANGLE_instanced_arrays");r?(e.vertexAttribDivisor=(s,n)=>r.vertexAttribDivisorANGLE(s,n),e.drawElementsInstanced=(s,n,o,a,l)=>r.drawElementsInstancedANGLE(s,n,o,a,l),e.drawArraysInstanced=(s,n,o,a)=>r.drawArraysInstancedANGLE(s,n,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=t.webGLVersion===2||!!t.extensions.uint32ElementIndex}bind(e,t){t=t||this.renderer.shader.shader;let{gl:r}=this,s=e.glVertexArrayObjects[this.CONTEXT_UID],n=!1;s||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=s={},n=!0);let o=s[t.program.id]||this.initGeometryVao(e,t,n);this._activeGeometry=e,this._activeVao!==o&&(this._activeVao=o,this.hasVao?r.bindVertexArray(o):this.activateVao(e,t.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){let e=this._activeGeometry,t=this.renderer.buffer;for(let r=0;r<e.buffers.length;r++){let s=e.buffers[r];t.update(s)}}checkCompatibility(e,t){let r=e.attributes,s=t.attributeData;for(let n in s)if(!r[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(e,t){let r=e.attributes,s=t.attributeData,n=["g",e.id];for(let o in r)s[o]&&n.push(o,s[o].location);return n.join("-")}initGeometryVao(e,t,r=!0){let s=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,a=t.program;a.glPrograms[n]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,a);let l=this.getSignature(e,a),c=e.glVertexArrayObjects[this.CONTEXT_UID],u=c[l];if(u)return c[a.id]=u,u;let h=e.buffers,d=e.attributes,f={},p={};for(let m in h)f[m]=0,p[m]=0;for(let m in d)!d[m].size&&a.attributeData[m]?d[m].size=a.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[m].buffer]+=d[m].size*X8[d[m].type];for(let m in d){let g=d[m],y=g.size;g.stride===void 0&&(f[g.buffer]===y*X8[g.type]?g.stride=0:g.stride=f[g.buffer]),g.start===void 0&&(g.start=p[g.buffer],p[g.buffer]+=y*X8[g.type])}u=s.createVertexArray(),s.bindVertexArray(u);for(let m=0;m<h.length;m++){let g=h[m];o.bind(g),r&&g._glBuffers[n].refCount++}return this.activateVao(e,a),c[a.id]=u,c[l]=u,s.bindVertexArray(null),o.unbind(Or.ARRAY_BUFFER),u}disposeGeometry(e,t){var a;if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];let r=e.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,n=e.buffers,o=(a=this.renderer)==null?void 0:a.buffer;if(e.disposeRunner.remove(this),!!r){if(o)for(let l=0;l<n.length;l++){let c=n[l]._glBuffers[this.CONTEXT_UID];c&&(c.refCount--,c.refCount===0&&!t&&o.dispose(n[l],t))}if(!t){for(let l in r)if(l[0]==="g"){let c=r[l];this._activeVao===c&&this.unbind(),s.deleteVertexArray(c)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){let t=Object.keys(this.managedGeometries);for(let r=0;r<t.length;r++)this.disposeGeometry(this.managedGeometries[t[r]],e)}activateVao(e,t){let r=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,o=e.buffers,a=e.attributes;e.indexBuffer&&n.bind(e.indexBuffer);let l=null;for(let c in a){let u=a[c],h=o[u.buffer],d=h._glBuffers[s];if(t.attributeData[c]){l!==d&&(n.bind(h),l=d);let f=t.attributeData[c].location;if(r.enableVertexAttribArray(f),r.vertexAttribPointer(f,u.size,u.type||r.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)r.vertexAttribDivisor(f,u.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,t,r,s){let{gl:n}=this,o=this._activeGeometry;if(o.indexBuffer){let a=o.indexBuffer.data.BYTES_PER_ELEMENT,l=a===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(e,t||o.indexBuffer.data.length,l,(r||0)*a,s||1):n.drawElements(e,t||o.indexBuffer.data.length,l,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(e,r,t||o.getSize(),s||1):n.drawArrays(e,r,t||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}};sc.extension={type:ee.RendererSystem,name:"geometry"};ne.add(sc);var CA=new rt,la=class{constructor(e,t){this._texture=e,this.mapCoord=new rt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,t){t===void 0&&(t=e);let r=this.mapCoord;for(let s=0;s<e.length;s+=2){let n=e[s],o=e[s+1];t[s]=n*r.a+o*r.c+r.tx,t[s+1]=n*r.b+o*r.d+r.ty}return t}update(e){let t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;let r=t._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);let s=t.orig,n=t.trim;n&&(CA.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(CA));let o=t.baseTexture,a=this.uClampFrame,l=this.clampMargin/o.resolution,c=this.clampOffset;return a[0]=(t._frame.x+l+c)/o.width,a[1]=(t._frame.y+l+c)/o.height,a[2]=(t._frame.x+t._frame.width-l+c)/o.width,a[3]=(t._frame.y+t._frame.height-l+c)/o.height,this.uClampOffset[0]=c/o.realWidth,this.uClampOffset[1]=c/o.realHeight,this.isSimple=t._frame.width===o.width&&t._frame.height===o.height&&t.rotate===0,!0}};var kA=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`;var TA=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;var h4=class extends ye{constructor(e,t,r){let s=null;typeof e!="string"&&t===void 0&&r===void 0&&(s=e,e=void 0,t=void 0,r=void 0),super(e||TA,t||kA,r),this.maskSprite=s,this.maskMatrix=new rt}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,t,r,s){let n=this._maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new la(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,e.applyFilter(this,t,r,s))}};var d4=class{constructor(e=null){this.type=fi.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=ye.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=fi.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}};var nc=class{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,t){let r=t;if(!r.isMaskData){let n=this.maskDataPool.pop()||new d4;n.pooled=!0,n.maskObject=t,r=n}let s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(s),r._colorMask=s?s._colorMask:15,r.autoDetect&&this.detect(r),r._target=e,r.type!==fi.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case fi.SCISSOR:this.renderer.scissor.push(r);break;case fi.STENCIL:this.renderer.stencil.push(r);break;case fi.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case fi.COLOR:this.pushColorMask(r);break;default:break}r.type===fi.SPRITE&&this.maskStack.push(r)}pop(e){let t=this.maskStack.pop();if(!(!t||t._target!==e)){if(t.enabled)switch(t.type){case fi.SCISSOR:this.renderer.scissor.pop(t);break;case fi.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case fi.SPRITE:this.popSpriteMask(t);break;case fi.COLOR:this.popColorMask(t);break;default:break}if(t.reset(),t.pooled&&this.maskDataPool.push(t),this.maskStack.length!==0){let r=this.maskStack[this.maskStack.length-1];r.type===fi.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(e){let t=e.maskObject;t?t.isSprite?e.type=fi.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=fi.SCISSOR:e.type=fi.STENCIL:e.type=fi.COLOR}pushSpriteMask(e){let{maskObject:t}=e,r=e._target,s=e._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new h4])),s[0].resolution=e.resolution,s[0].multisample=e.multisample,s[0].maskSprite=t;let n=r.filterArea;r.filterArea=t.getBounds(!0),this.renderer.filter.push(r,s),r.filterArea=n,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){let t=e._colorMask,r=e._colorMask=t&e.colorMask;r!==t&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(e){let t=e._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==t&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}};nc.extension={type:ee.RendererSystem,name:"mask"};ne.add(nc);var oc=class{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){let{gl:t}=this.renderer,r=this.getStackLength();this.maskStack=e;let s=this.getStackLength();s!==r&&(s===0?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}};var IA=new rt,MA=[],PA=class ed extends oc{constructor(e){super(e),this.glConst=te.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){let e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){var a;if(e._scissorRectLocal)return;let t=e._scissorRect,{maskObject:r}=e,{renderer:s}=this,n=s.renderTexture,o=r.getBounds(!0,(a=MA.pop())!=null?a:new ve);this.roundFrameToPixels(o,n.current?n.current.resolution:s.resolution,n.sourceFrame,n.destinationFrame,s.projection.transform),t&&o.fit(t),e._scissorRectLocal=o}static isMatrixRotated(e){if(!e)return!1;let{a:t,b:r,c:s,d:n}=e;return(Math.abs(r)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4)}testScissor(e){let{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||ed.isMatrixRotated(t.worldTransform)||ed.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);let r=e._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(e,t,r,s,n){ed.isMatrixRotated(n)||(n=n?IA.copyFrom(n):IA.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.renderer.filter.transformAABB(n,e),e.fit(s),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);let{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){let{gl:t}=this.renderer;e&&MA.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){let e=this.maskStack[this.maskStack.length-1]._scissorRect,t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};PA.extension={type:ee.RendererSystem,name:"scissor"};var q8=PA;ne.add(q8);var ac=class extends oc{constructor(e){super(e),this.glConst=te.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){let e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){let t=e.maskObject,{gl:r}=this.renderer,s=e._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),e._stencilCounter++;let n=e._colorMask;n!==0&&(e._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,s,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(e._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(e){let t=this.renderer.gl;if(this.getStackLength()===0)t.disable(t.STENCIL_TEST);else{let r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=r?r._colorMask:15;s!==0&&(r._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(r._colorMask=s,t.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){let e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}};ac.extension={type:ee.RendererSystem,name:"stencil"};ne.add(ac);var lc=class{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return je("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract}},prepare:{enumerable:!1,get(){return je("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare}},interaction:{enumerable:!1,get(){return je("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events}}})}init(){let e=this.rendererPlugins;for(let t in e)this.plugins[t]=new e[t](this.renderer)}destroy(){for(let e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}};lc.extension={type:[ee.RendererSystem,ee.CanvasRendererSystem],name:"_plugin"};ne.add(lc);var cc=class{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new rt,this.transform=null}update(e,t,r,s){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,s),this.transform&&this.projectionMatrix.append(this.transform);let n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(e,t,r,s){let n=this.projectionMatrix,o=s?-1:1;n.identity(),n.a=1/t.width*2,n.d=o*(1/t.height*2),n.tx=-1-t.x*n.a,n.ty=-o-t.y*n.d}setTransform(e){}destroy(){this.renderer=null}};cc.extension={type:ee.RendererSystem,name:"projection"};ne.add(cc);var GL=new il,DA=new ve,uc=class{constructor(e){this.renderer=e,this._tempMatrix=new rt}generateTexture(e,t){var u;let c=t||{},{region:r}=c,s=m3(c,["region"]),n=(r==null?void 0:r.copyTo(DA))||e.getLocalBounds(DA,!0),o=s.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/o),n.height=Math.max(n.height,1/o),s.width=n.width,s.height=n.height,s.resolution=o,(u=s.multisample)!=null||(s.multisample=this.renderer.multisample);let a=ts.create(s);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;let l=e.transform;return e.transform=GL,this.renderer.render(e,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=l,a}destroy(){}};uc.extension={type:[ee.RendererSystem,ee.CanvasRendererSystem],name:"textureGenerator"};ne.add(uc);var ol=new ve,f4=new ve,hc=class{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new ve,this.destinationFrame=new ve,this.viewportFrame=new ve}contextChange(){var t;let e=(t=this.renderer)==null?void 0:t.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(e=null,t,r){let s=this.renderer;this.current=e;let n,o,a;e?(n=e.baseTexture,a=n.resolution,t||(ol.width=e.frame.width,ol.height=e.frame.height,t=ol),r||(f4.x=e.frame.x,f4.y=e.frame.y,f4.width=t.width,f4.height=t.height,r=f4),o=n.framebuffer):(a=s.resolution,t||(ol.width=s._view.screen.width,ol.height=s._view.screen.height,t=ol),r||(r=ol,r.width=t.width,r.height=t.height));let l=this.viewportFrame;l.x=r.x*a,l.y=r.y*a,l.width=r.width*a,l.height=r.height*a,e||(l.y=s.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(o,l),this.renderer.projection.update(r,t,a,!o),e?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(r)}clear(e,t){let r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=we.shared.setValue(e||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);let n=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=n.width!==o.width||n.height!==o.height;if(a){let{x:l,y:c,width:u,height:h}=this.viewportFrame;l=Math.round(l),c=Math.round(c),u=Math.round(u),h=Math.round(h),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,c,u,h)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,t),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}};hc.extension={type:ee.RendererSystem,name:"renderTexture"};ne.add(hc);var p4=class{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}};function RA(i,e){let t={},r=e.getProgramParameter(i,e.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){let n=e.getActiveAttrib(i,s);if(n.name.startsWith("gl_"))continue;let o=r4(e,n.type),a={type:o,name:n.name,size:i4(o),location:e.getAttribLocation(i,n.name)};t[n.name]=a}return t}function NA(i,e){let t={},r=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let s=0;s<r;s++){let n=e.getActiveUniform(i,s),o=n.name.replace(/\[.*?\]$/,""),a=!!n.name.match(/\[.*?\]$/),l=r4(e,n.type);t[o]={name:o,index:s,type:l,size:n.size,isArray:a,value:t4(l,n.size)}}return t}function Q8(i,e){var a;let t=Vh(i,i.VERTEX_SHADER,e.vertexSrc),r=Vh(i,i.FRAGMENT_SHADER,e.fragmentSrc),s=i.createProgram();i.attachShader(s,t),i.attachShader(s,r);let n=(a=e.extra)==null?void 0:a.transformFeedbackVaryings;if(n&&(typeof i.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):i.transformFeedbackVaryings(s,n.names,n.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(s),i.getProgramParameter(s,i.LINK_STATUS)||z8(i,s,t,r),e.attributeData=RA(s,i),e.uniformData=NA(s,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){let l=Object.keys(e.attributeData);l.sort((c,u)=>c>u?1:-1);for(let c=0;c<l.length;c++)e.attributeData[l[c]].location=c,i.bindAttribLocation(s,c,l[c]);i.linkProgram(s)}i.deleteShader(t),i.deleteShader(r);let o={};for(let l in e.uniformData){let c=e.uniformData[l];o[l]={location:i.getUniformLocation(s,l),value:t4(c.type,c.size)}}return new p4(s,o)}function zL(i,e,t,r,s){t.buffer.update(s)}var jL={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},FA={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function LA(i){let e=i.map(n=>({data:n,offset:0,dataLen:0,dirty:0})),t=0,r=0,s=0;for(let n=0;n<e.length;n++){let o=e[n];if(t=FA[o.data.type],o.data.size>1&&(t=Math.max(t,16)*o.data.size),o.dataLen=t,r%t!==0&&r<16){let a=r%t%16;r+=a,s+=a}r+t>16?(s=Math.ceil(s/16)*16,o.offset=s,s+=t,r=t):(o.offset=s,r+=t,s+=t)}return s=Math.ceil(s/16)*16,{uboElements:e,size:s}}function OA(i,e){let t=[];for(let r in i)e[r]&&t.push(e[r]);return t.sort((r,s)=>r.index-s.index),t}function Y8(i,e){if(!i.autoManage)return{size:0,syncFunc:zL};let t=OA(i.uniforms,e),{uboElements:r,size:s}=LA(t),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<r.length;o++){let a=r[o],l=i.uniforms[a.data.name],c=a.data.name,u=!1;for(let h=0;h<kn.length;h++){let d=kn[h];if(d.codeUbo&&d.test(a.data,l)){n.push(`offset = ${a.offset/4};`,kn[h].codeUbo(a.data.name,l)),u=!0;break}}if(!u)if(a.data.size>1){let h=i4(a.data.type),d=Math.max(FA[a.data.type]/16,1),f=h/d,p=(4-f%4)%4;n.push(`
                cv = ud.${c}.value;
                v = uv.${c};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{let h=jL[a.data.type];n.push(`
                cv = ud.${c}.value;
                v = uv.${c};
                offset = ${a.offset/4};
                ${h};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}var VL=0,td={textureCount:0,uboCount:0},dc=class{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=VL++}systemCheck(){if(!Yh())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;let r=e.program,s=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==r&&(this.program=r,this.gl.useProgram(s.program)),t||(td.textureCount=0,td.uboCount=0,this.syncUniformGroup(e.uniformGroup,td)),s}setUniforms(e){let t=this.shader.program,r=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(r.uniformData,e,this.renderer)}syncUniformGroup(e,t){let r=this.getGlProgram();(!e.static||e.dirtyId!==r.uniformDirtyGroups[e.id])&&(r.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,r,t))}syncUniforms(e,t,r){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,r)}createSyncGroups(e){let t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=H8(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,t){let r=this.getGlProgram();if(!e.static||e.dirtyId!==0||!r.uniformGroups[e.id]){e.dirtyId=0;let s=r.uniformGroups[e.id]||this.createSyncBufferGroup(e,r,t);e.buffer.update(),s(r.uniformData,e.uniforms,this.renderer,td,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,r.uniformBufferBindings[t])}createSyncBufferGroup(e,t,r){let{gl:s}=this.renderer;this.renderer.buffer.bind(e.buffer);let n=this.gl.getUniformBlockIndex(t.program,r);t.uniformBufferBindings[r]=this.shader.uniformBindCount,s.uniformBlockBinding(t.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;let o=this.getSignature(e,this.shader.program.uniformData,"ubo"),a=this._uboCache[o];if(a||(a=this._uboCache[o]=Y8(e,this.shader.program.uniformData)),e.autoManage){let l=new Float32Array(a.size/4);e.buffer.update(l)}return t.uniformGroups[e.id]=a.syncFunc,t.uniformGroups[e.id]}getSignature(e,t,r){let s=e.uniforms,n=[`${r}-`];for(let o in s)n.push(o),t[o]&&n.push(t[o].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){let t=this.gl,r=e.program,s=Q8(t,r);return r.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}};dc.extension={type:ee.RendererSystem,name:"shader"};ne.add(dc);var yo=class{constructor(e){this.renderer=e}run(e){let{renderer:t}=this;t.runners.init.emit(t.options),e.hello&&console.log(`PixiJS 7.4.0 - ${t.rendererLogId} - https://pixijs.com`),t.resize(t.screen.width,t.screen.height)}destroy(){}};yo.defaultOptions={hello:!1},yo.extension={type:[ee.RendererSystem,ee.CanvasRendererSystem],name:"startup"};ne.add(yo);function BA(i,e=[]){return e[Le.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.ADD]=[i.ONE,i.ONE],e[Le.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.NONE]=[0,0],e[Le.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],e[Le.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],e[Le.SRC_IN]=[i.DST_ALPHA,i.ZERO],e[Le.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],e[Le.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],e[Le.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],e[Le.DST_IN]=[i.ZERO,i.SRC_ALPHA],e[Le.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],e[Le.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],e[Le.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],e[Le.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],e}var WL=0,XL=1,qL=2,QL=3,YL=4,KL=5,UA=class K8{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=Le.NONE,this._blendEq=!1,this.map=[],this.map[WL]=this.setBlend,this.map[XL]=this.setOffset,this.map[qL]=this.setCullFace,this.map[QL]=this.setDepthTest,this.map[YL]=this.setFrontFace,this.map[KL]=this.setDepthMask,this.checks=[],this.defaultState=new Bi,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=BA(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,r=0;for(;t;)t&1&&this.map[r].call(this,!!(e.data&1<<r)),t=t>>1,r++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(K8.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(K8.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;let t=this.blendModes[e],r=this.gl;t.length===2?r.blendFunc(t[0],t[1]):r.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,r.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){let r=this.checks.indexOf(e);t&&r===-1?this.checks.push(e):!t&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};UA.extension={type:ee.RendererSystem,name:"state"};var Z8=UA;ne.add(Z8);var fc=class extends pi.default{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){var s;this.addRunners(...e.runners);let t=((s=e.priority)!=null?s:[]).filter(n=>e.systems[n]),r=[...t,...Object.keys(e.systems).filter(n=>!t.includes(n))];for(let n of r)this.addSystem(e.systems[n],n)}addRunners(...e){e.forEach(t=>{this.runners[t]=new vi(t)})}addSystem(e,t){let r=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=r,this._systemsHash[t]=r;for(let s in this.runners)this.runners[s].add(r);return this}emitWithCustomOptions(e,t){let r=Object.keys(this._systemsHash);e.items.forEach(s=>{let n=r.find(o=>this._systemsHash[o]===s);s[e.name](t[n])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}};var m4=class id{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=id.defaultMaxIdle,this.checkCountMax=id.defaultCheckCountMax,this.mode=id.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==uh.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){let e=this.renderer.texture,t=e.managedTextures,r=!1;for(let s=0;s<t.length;s++){let n=t[s];n.resource&&this.count-n.touched>this.maxIdle&&(e.destroyTexture(n,!0),t[s]=null,r=!0)}if(r){let s=0;for(let n=0;n<t.length;n++)t[n]!==null&&(t[s++]=t[n]);t.length=s}}unload(e){let t=this.renderer.texture,r=e._texture;r&&!r.framebuffer&&t.destroyTexture(r);for(let s=e.children.length-1;s>=0;s--)this.unload(e.children[s])}destroy(){this.renderer=null}};m4.defaultMode=uh.AUTO,m4.defaultMaxIdle=60*60,m4.defaultCheckCountMax=60*10,m4.extension={type:ee.RendererSystem,name:"textureGC"};var Tn=m4;ne.add(Tn);var al=class{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=Se.UNSIGNED_BYTE,this.internalFormat=le.RGBA,this.samplerType=0}};function $A(i){let e;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?e={[i.RGB]:Ee.FLOAT,[i.RGBA]:Ee.FLOAT,[i.ALPHA]:Ee.FLOAT,[i.LUMINANCE]:Ee.FLOAT,[i.LUMINANCE_ALPHA]:Ee.FLOAT,[i.R8]:Ee.FLOAT,[i.R8_SNORM]:Ee.FLOAT,[i.RG8]:Ee.FLOAT,[i.RG8_SNORM]:Ee.FLOAT,[i.RGB8]:Ee.FLOAT,[i.RGB8_SNORM]:Ee.FLOAT,[i.RGB565]:Ee.FLOAT,[i.RGBA4]:Ee.FLOAT,[i.RGB5_A1]:Ee.FLOAT,[i.RGBA8]:Ee.FLOAT,[i.RGBA8_SNORM]:Ee.FLOAT,[i.RGB10_A2]:Ee.FLOAT,[i.RGB10_A2UI]:Ee.FLOAT,[i.SRGB8]:Ee.FLOAT,[i.SRGB8_ALPHA8]:Ee.FLOAT,[i.R16F]:Ee.FLOAT,[i.RG16F]:Ee.FLOAT,[i.RGB16F]:Ee.FLOAT,[i.RGBA16F]:Ee.FLOAT,[i.R32F]:Ee.FLOAT,[i.RG32F]:Ee.FLOAT,[i.RGB32F]:Ee.FLOAT,[i.RGBA32F]:Ee.FLOAT,[i.R11F_G11F_B10F]:Ee.FLOAT,[i.RGB9_E5]:Ee.FLOAT,[i.R8I]:Ee.INT,[i.R8UI]:Ee.UINT,[i.R16I]:Ee.INT,[i.R16UI]:Ee.UINT,[i.R32I]:Ee.INT,[i.R32UI]:Ee.UINT,[i.RG8I]:Ee.INT,[i.RG8UI]:Ee.UINT,[i.RG16I]:Ee.INT,[i.RG16UI]:Ee.UINT,[i.RG32I]:Ee.INT,[i.RG32UI]:Ee.UINT,[i.RGB8I]:Ee.INT,[i.RGB8UI]:Ee.UINT,[i.RGB16I]:Ee.INT,[i.RGB16UI]:Ee.UINT,[i.RGB32I]:Ee.INT,[i.RGB32UI]:Ee.UINT,[i.RGBA8I]:Ee.INT,[i.RGBA8UI]:Ee.UINT,[i.RGBA16I]:Ee.INT,[i.RGBA16UI]:Ee.UINT,[i.RGBA32I]:Ee.INT,[i.RGBA32UI]:Ee.UINT,[i.DEPTH_COMPONENT16]:Ee.FLOAT,[i.DEPTH_COMPONENT24]:Ee.FLOAT,[i.DEPTH_COMPONENT32F]:Ee.FLOAT,[i.DEPTH_STENCIL]:Ee.FLOAT,[i.DEPTH24_STENCIL8]:Ee.FLOAT,[i.DEPTH32F_STENCIL8]:Ee.FLOAT}:e={[i.RGB]:Ee.FLOAT,[i.RGBA]:Ee.FLOAT,[i.ALPHA]:Ee.FLOAT,[i.LUMINANCE]:Ee.FLOAT,[i.LUMINANCE_ALPHA]:Ee.FLOAT,[i.DEPTH_STENCIL]:Ee.FLOAT},e}function HA(i){let e;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?e={[Se.UNSIGNED_BYTE]:{[le.RGBA]:i.RGBA8,[le.RGB]:i.RGB8,[le.RG]:i.RG8,[le.RED]:i.R8,[le.RGBA_INTEGER]:i.RGBA8UI,[le.RGB_INTEGER]:i.RGB8UI,[le.RG_INTEGER]:i.RG8UI,[le.RED_INTEGER]:i.R8UI,[le.ALPHA]:i.ALPHA,[le.LUMINANCE]:i.LUMINANCE,[le.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[Se.BYTE]:{[le.RGBA]:i.RGBA8_SNORM,[le.RGB]:i.RGB8_SNORM,[le.RG]:i.RG8_SNORM,[le.RED]:i.R8_SNORM,[le.RGBA_INTEGER]:i.RGBA8I,[le.RGB_INTEGER]:i.RGB8I,[le.RG_INTEGER]:i.RG8I,[le.RED_INTEGER]:i.R8I},[Se.UNSIGNED_SHORT]:{[le.RGBA_INTEGER]:i.RGBA16UI,[le.RGB_INTEGER]:i.RGB16UI,[le.RG_INTEGER]:i.RG16UI,[le.RED_INTEGER]:i.R16UI,[le.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[Se.SHORT]:{[le.RGBA_INTEGER]:i.RGBA16I,[le.RGB_INTEGER]:i.RGB16I,[le.RG_INTEGER]:i.RG16I,[le.RED_INTEGER]:i.R16I},[Se.UNSIGNED_INT]:{[le.RGBA_INTEGER]:i.RGBA32UI,[le.RGB_INTEGER]:i.RGB32UI,[le.RG_INTEGER]:i.RG32UI,[le.RED_INTEGER]:i.R32UI,[le.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[Se.INT]:{[le.RGBA_INTEGER]:i.RGBA32I,[le.RGB_INTEGER]:i.RGB32I,[le.RG_INTEGER]:i.RG32I,[le.RED_INTEGER]:i.R32I},[Se.FLOAT]:{[le.RGBA]:i.RGBA32F,[le.RGB]:i.RGB32F,[le.RG]:i.RG32F,[le.RED]:i.R32F,[le.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[Se.HALF_FLOAT]:{[le.RGBA]:i.RGBA16F,[le.RGB]:i.RGB16F,[le.RG]:i.RG16F,[le.RED]:i.R16F},[Se.UNSIGNED_SHORT_5_6_5]:{[le.RGB]:i.RGB565},[Se.UNSIGNED_SHORT_4_4_4_4]:{[le.RGBA]:i.RGBA4},[Se.UNSIGNED_SHORT_5_5_5_1]:{[le.RGBA]:i.RGB5_A1},[Se.UNSIGNED_INT_2_10_10_10_REV]:{[le.RGBA]:i.RGB10_A2,[le.RGBA_INTEGER]:i.RGB10_A2UI},[Se.UNSIGNED_INT_10F_11F_11F_REV]:{[le.RGB]:i.R11F_G11F_B10F},[Se.UNSIGNED_INT_5_9_9_9_REV]:{[le.RGB]:i.RGB9_E5},[Se.UNSIGNED_INT_24_8]:{[le.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[Se.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[le.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:e={[Se.UNSIGNED_BYTE]:{[le.RGBA]:i.RGBA,[le.RGB]:i.RGB,[le.ALPHA]:i.ALPHA,[le.LUMINANCE]:i.LUMINANCE,[le.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[Se.UNSIGNED_SHORT_5_6_5]:{[le.RGB]:i.RGB},[Se.UNSIGNED_SHORT_4_4_4_4]:{[le.RGBA]:i.RGBA},[Se.UNSIGNED_SHORT_5_5_5_1]:{[le.RGBA]:i.RGBA}},e}var pc=class{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Ae,this.hasIntegerTextures=!1}contextChange(){let e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=HA(e),this.samplerTypes=$A(e);let t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(let s=0;s<t;s++)this.boundTextures[s]=null;this.emptyTextures={};let r=new al(e.createTexture());e.bindTexture(e.TEXTURE_2D,r.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=r,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new al(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(e,t=0){let{gl:r}=this;if(e=e==null?void 0:e.castToBaseTexture(),(e==null?void 0:e.valid)&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;let s=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(e.target,s.texture)),s.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),this.updateTexture(e)):s.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[t]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){let{gl:t,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<r.length;s++)r[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<r.length;s++)r[s]===e&&(this.currentLocation!==s&&(t.activeTexture(t.TEXTURE0+s),this.currentLocation=s),t.bindTexture(e.target,this.emptyTextures[e.target].texture),r[s]=null)}ensureSamplerType(e){let{boundTextures:t,hasIntegerTextures:r,CONTEXT_UID:s}=this;if(r)for(let n=e-1;n>=0;--n){let o=t[n];o&&o._glTextures[s].samplerType!==Ee.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(e){let t=new al(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t}initTextureType(e,t){var r,s,n;t.internalFormat=(s=(r=this.internalFormats[e.type])==null?void 0:r[e.format])!=null?s:e.format,t.samplerType=(n=this.samplerTypes[t.internalFormat])!=null?n:Ee.FLOAT,this.webGLVersion===2&&e.type===Se.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type}updateTexture(e){var s;let t=e._glTextures[this.CONTEXT_UID];if(!t)return;let r=this.renderer;if(this.initTextureType(e,t),(s=e.resource)==null?void 0:s.upload(r,e,t))t.samplerType!==Ee.FLOAT&&(this.hasIntegerTextures=!0);else{let n=e.realWidth,o=e.realHeight,a=r.gl;(t.width!==n||t.height!==o||t.dirtyId<0)&&(t.width=n,t.height=o,a.texImage2D(e.target,0,t.internalFormat,n,o,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}destroyTexture(e,t){let{gl:r}=this;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),r.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){let s=this.managedTextures.indexOf(e);s!==-1&&mh(this.managedTextures,s,1)}}updateTextureStyle(e){var r;let t=e._glTextures[this.CONTEXT_UID];t&&((e.mipmap===bi.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?t.mipmap=!1:t.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?t.wrapMode=Lr.CLAMP:t.wrapMode=e.wrapMode,(r=e.resource)!=null&&r.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)}setStyle(e,t){let r=this.gl;if(t.mipmap&&e.mipmap!==bi.ON_MANUAL&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,t.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===Xi.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);let s=this.renderer.context.extensions.anisotropicFiltering;if(s&&e.anisotropicLevel>0&&e.scaleMode===Xi.LINEAR){let n=Math.min(e.anisotropicLevel,r.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(e.target,s.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===Xi.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode===Xi.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}};pc.extension={type:ee.RendererSystem,name:"texture"};ne.add(pc);var mc=class{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){let{gl:t,CONTEXT_UID:r}=this,s=e._glTransformFeedbacks[r]||this.createGLTransformFeedback(e);t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,s)}unbind(){let{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,t){let{gl:r,renderer:s}=this;t&&s.shader.bind(t),r.beginTransformFeedback(e)}endTransformFeedback(){let{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){let{gl:t,renderer:r,CONTEXT_UID:s}=this,n=t.createTransformFeedback();e._glTransformFeedbacks[s]=n,t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,n);for(let o=0;o<e.buffers.length;o++){let a=e.buffers[o];a&&(r.buffer.update(a),a._glBuffers[s].refCount++,t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[s].buffer||null))}return t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),n}disposeTransformFeedback(e,t){let r=e._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this);let n=this.renderer.buffer;if(n)for(let o=0;o<e.buffers.length;o++){let a=e.buffers[o];if(!a)continue;let l=a._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!t&&n.dispose(a,t))}r&&(t||s.deleteTransformFeedback(r),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}};mc.extension={type:ee.RendererSystem,name:"transformFeedback"};ne.add(mc);var xo=class{constructor(e){this.renderer=e}init(e){this.screen=new ve(0,0,e.width,e.height),this.element=e.view||te.ADAPTER.createCanvas(),this.resolution=e.resolution||te.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,t){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(t*this.resolution);let r=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=r,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",r,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){var t;e&&((t=this.element.parentNode)==null||t.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}};xo.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},xo.extension={type:[ee.RendererSystem,ee.CanvasRendererSystem],name:"_view"};ne.add(xo);te.PREFER_ENV=br.WEBGL2;te.STRICT_TEXTURE_CACHE=!1;te.RENDER_OPTIONS=Ne(Ne(Ne(Ne({},go.defaultOptions),mo.defaultOptions),xo.defaultOptions),yo.defaultOptions);Object.defineProperties(te,{WRAP_MODE:{get(){return Ae.defaultOptions.wrapMode},set(i){je("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),Ae.defaultOptions.wrapMode=i}},SCALE_MODE:{get(){return Ae.defaultOptions.scaleMode},set(i){je("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),Ae.defaultOptions.scaleMode=i}},MIPMAP_TEXTURES:{get(){return Ae.defaultOptions.mipmap},set(i){je("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),Ae.defaultOptions.mipmap=i}},ANISOTROPIC_LEVEL:{get(){return Ae.defaultOptions.anisotropicLevel},set(i){je("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),Ae.defaultOptions.anisotropicLevel=i}},FILTER_RESOLUTION:{get(){return je("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),ye.defaultResolution},set(i){ye.defaultResolution=i}},FILTER_MULTISAMPLE:{get(){return je("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),ye.defaultMultisample},set(i){ye.defaultMultisample=i}},SPRITE_MAX_TEXTURES:{get(){return po.defaultMaxTextures},set(i){je("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),po.defaultMaxTextures=i}},SPRITE_BATCH_SIZE:{get(){return po.defaultBatchSize},set(i){je("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),po.defaultBatchSize=i}},CAN_UPLOAD_SAME_BUFFER:{get(){return po.canUploadSameBuffer},set(i){je("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),po.canUploadSameBuffer=i}},GC_MODE:{get(){return Tn.defaultMode},set(i){je("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Tn.defaultMode=i}},GC_MAX_IDLE:{get(){return Tn.defaultMaxIdle},set(i){je("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Tn.defaultMaxIdle=i}},GC_MAX_CHECK_COUNT:{get(){return Tn.defaultCheckCountMax},set(i){je("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Tn.defaultCheckCountMax=i}},PRECISION_VERTEX:{get(){return nr.defaultVertexPrecision},set(i){je("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),nr.defaultVertexPrecision=i}},PRECISION_FRAGMENT:{get(){return nr.defaultFragmentPrecision},set(i){je("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),nr.defaultFragmentPrecision=i}}});var is=(i=>(i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(is||{});var gc=class{constructor(e,t=null,r=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=r,this.once=s}match(e,t=null){return this.fn===e&&this.context===t}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));let t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);let t=this.next;return this.next=e?null:t,this.previous=null,t}};var GA=class rs{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new gc(null,null,1/0),this.deltaMS=1/rs.targetFPMS,this.elapsedMS=1/rs.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,r=is.NORMAL){return this._addListener(new gc(e,t,r))}addOnce(e,t,r=is.NORMAL){return this._addListener(new gc(e,t,r,!0))}_addListener(e){let t=this._head.next,r=this._head;if(!t)e.connect(r);else{for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}return this._startIfPossible(),this}remove(e,t){let r=this._head.next;for(;r;)r.match(e,t)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){let n=e-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=e-n%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*rs.targetFPMS;let r=this._head,s=r.next;for(;s;)s=s.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){let t=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,t)/1e3,rs.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{let t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!rs._shared){let e=rs._shared=new rs;e.autoStart=!0,e._protected=!0}return rs._shared}static get system(){if(!rs._system){let e=rs._system=new rs;e.autoStart=!0,e._protected=!0}return rs._system}};GA.targetFPMS=.06;var wi=GA;Object.defineProperties(te,{TARGET_FPMS:{get(){return wi.targetFPMS},set(i){je("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),wi.targetFPMS=i}}});var g4=class{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,is.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?wi.shared:new wi,e.autoStart&&this.start()}static destroy(){if(this._ticker){let e=this._ticker;this.ticker=null,e.destroy()}}};g4.extension=ee.Application;ne.add(g4);var zA=[];ne.handleByList(ee.Renderer,zA);function J8(i){for(let e of zA)if(e.test(i))return new e(i);throw new Error("Unable to auto-detect a suitable renderer.")}var jA=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`;var VA=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var ep=jA,y4=VA;var x4=class{constructor(e){this.renderer=e}contextChange(e){let t;if(this.renderer.context.webGLVersion===1){let r=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,r)}else{let r=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,r)}t>=bt.HIGH?this.multisample=bt.HIGH:t>=bt.MEDIUM?this.multisample=bt.MEDIUM:t>=bt.LOW?this.multisample=bt.LOW:this.multisample=bt.NONE}destroy(){}};x4.extension={type:ee.RendererSystem,name:"_multisample"};ne.add(x4);var rd=class{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}};var v4=class{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){let{gl:t,CONTEXT_UID:r}=this,s=e._glBuffers[r]||this.createGLBuffer(e);t.bindBuffer(e.type,s.buffer)}unbind(e){let{gl:t}=this;t.bindBuffer(e,null)}bindBufferBase(e,t){let{gl:r,CONTEXT_UID:s}=this;if(this.boundBufferBases[t]!==e){let n=e._glBuffers[s]||this.createGLBuffer(e);this.boundBufferBases[t]=e,r.bindBufferBase(r.UNIFORM_BUFFER,t,n.buffer)}}bindBufferRange(e,t,r){let{gl:s,CONTEXT_UID:n}=this;r=r||0;let o=e._glBuffers[n]||this.createGLBuffer(e);s.bindBufferRange(s.UNIFORM_BUFFER,t||0,o.buffer,r*256,256)}update(e){let{gl:t,CONTEXT_UID:r}=this,s=e._glBuffers[r]||this.createGLBuffer(e);if(e._updateID!==s.updateID)if(s.updateID=e._updateID,t.bindBuffer(e.type,s.buffer),s.byteLength>=e.data.byteLength)t.bufferSubData(e.type,0,e.data);else{let n=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;s.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,n)}}dispose(e,t){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];let r=e._glBuffers[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this),r&&(t||s.deleteBuffer(r.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){let t=Object.keys(this.managedBuffers);for(let r=0;r<t.length;r++)this.dispose(this.managedBuffers[t[r]],e)}createGLBuffer(e){let{CONTEXT_UID:t,gl:r}=this;return e._glBuffers[t]=new rd(r.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[t]}};v4.extension={type:ee.RendererSystem,name:"buffer"};ne.add(v4);var _4=class{constructor(e){this.renderer=e}render(e,t){let r=this.renderer,s,n,o,a;if(t&&(s=t.renderTexture,n=t.clear,o=t.transform,a=t.skipUpdateTransform),this.renderingToScreen=!s,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=o,!r.context.isLost){if(s||(this.lastObjectRendered=e),!a){let l=e.enableTempParent();e.updateTransform(),e.disableTempParent(l)}r.renderTexture.bind(s),r.batch.currentRenderer.start(),(n!=null?n:r.background.clearBeforeRender)&&r.renderTexture.clear(),e.render(r),r.batch.currentRenderer.flush(),s&&(t.blit&&r.framebuffer.blit(),s.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}};_4.extension={type:ee.RendererSystem,name:"objectRenderer"};ne.add(_4);var sd=class tp extends fc{constructor(e){super(),this.type=V9.WEBGL,e=Object.assign({},te.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Cr({projectionMatrix:new rt},!0);let t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:tp.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(je("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha),this._plugin.rendererPlugins=tp.__plugins,this.options=e,this.startup.run(this.options)}static test(e){return e!=null&&e.forceCanvas?!1:hh()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return je("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return je("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return je("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return je("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){je("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return je("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){je("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return je("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};sd.extension={type:ee.Renderer,priority:1},sd.__plugins={},sd.__systems={};var nd=sd;ne.handleByMap(ee.RendererPlugin,nd.__plugins);ne.handleByMap(ee.RendererSystem,nd.__systems);ne.add(nd);var ca=class extends Ar{constructor(e,t){let{width:r,height:s}=t||{};super(r,s),this.items=[],this.itemDirtyIds=[];for(let n=0;n<e;n++){let o=new Ae;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,t){for(let r=0;r<this.length;r++)e[r]&&(e[r].castToBaseTexture?this.addBaseTextureAt(e[r].castToBaseTexture(),r):e[r]instanceof Ar?this.addResourceAt(e[r],r):this.addResourceAt(X1(e[r],t),r))}dispose(){for(let e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,t){if(!this.items[t])throw new Error(`Index ${t} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this}bind(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)}unbind(e){super.unbind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)}load(){if(this._load)return this._load;let e=this.items.map(t=>t.resource).filter(t=>t).map(t=>t.load());return this._load=Promise.all(e).then(()=>{let{realWidth:t,realHeight:r}=this.items[0];return this.resize(t,r),this.update(),Promise.resolve(this)}),this._load}};var b4=class extends ca{constructor(e,t){let{width:r,height:s}=t||{},n,o;Array.isArray(e)?(n=e,o=e.length):o=e,super(o,{width:r,height:s}),n&&this.initFromArray(n,t)}addBaseTextureAt(e,t){if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(e){super.bind(e),e.target=oo.TEXTURE_2D_ARRAY}upload(e,t,r){let{length:s,itemDirtyIds:n,items:o}=this,{gl:a}=e;r.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,s,0,t.format,r.type,null);for(let l=0;l<s;l++){let c=o[l];n[l]<c.dirtyId&&(n[l]=c.dirtyId,c.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,l,c.resource.width,c.resource.height,1,t.format,r.type,c.resource.source))}return!0}};var w4=class extends Ii{constructor(e){super(e)}static test(e){let{OffscreenCanvas:t}=globalThis;return t&&e instanceof t?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}};var WA=class E4 extends ca{constructor(e,t){let{width:r,height:s,autoLoad:n,linkBaseTexture:o}=t||{};if(e&&e.length!==E4.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:r,height:s});for(let a=0;a<E4.SIDES;a++)this.items[a].target=oo.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=o!==!1,e&&this.initFromArray(e,t),n!==!1&&this.load()}bind(e){super.bind(e),e.target=oo.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=oo.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,r){let s=this.itemDirtyIds;for(let n=0;n<E4.SIDES;n++){let o=this.items[n];(s[n]<o.dirtyId||r.dirtyId<t.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(e,o,r),s[n]=o.dirtyId):s[n]<-1&&(e.gl.texImage2D(o.target,0,r.internalFormat,t.realWidth,t.realHeight,0,t.format,r.type,null),s[n]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===E4.SIDES}};WA.SIDES=6;var ip=WA;var A4=class i extends Ii{constructor(e,t){var o,a;t=t||{};let r,s,n;typeof e=="string"?(r=i.EMPTY,s=e,n=!0):(r=e,s=null,n=!1),super(r),this.url=s,this.crossOrigin=(o=t.crossOrigin)!=null?o:!0,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.ownsImageBitmap=(a=t.ownsImageBitmap)!=null?a:n,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise((e,t)=>fe(this,null,function*(){if(this.url===null){e(this);return}try{let r=yield te.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;let s=yield r.blob();if(this.destroyed)return;let n=yield createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===jt.UNPACK?"premultiply":"none"});if(this.destroyed){n.close();return}this.source=n,this.update(),e(this)}catch(r){if(this.destroyed)return;t(r),this.onError.emit(r)}})),this._load)}upload(e,t,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),super.upload(e,t,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof e=="string"||e instanceof ImageBitmap)}static get EMPTY(){var e;return i._EMPTY=(e=i._EMPTY)!=null?e:te.ADAPTER.createCanvas(0,0),i._EMPTY}};var rp=class od extends Ii{constructor(e,t){t=t||{},super(te.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.update(),e(this)},od.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){let e=new Image;Ii.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;let t=e.width,r=e.height;if(!t||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=t*this.scale,n=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/r*t,n=this._overrideHeight||this._overrideWidth/t*r),s=Math.round(s),n=Math.round(n);let o=this.source;o.width=s,o.height=n,o._pixiId=`canvas_${An()}`,o.getContext("2d").drawImage(e,0,0,t,r,0,0,s,n),this._resolve(),this._resolve=null}}static getSize(e){let t=od.SVG_SIZE.exec(e),r={};return t&&(r[t[1]]=Math.round(parseFloat(t[3])),r[t[5]]=Math.round(parseFloat(t[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&od.SVG_XML.test(e)}};rp.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,rp.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var ua=rp;var ad=class extends Ii{constructor(e){super(e)}static test(e){return!!globalThis.VideoFrame&&e instanceof globalThis.VideoFrame}};var sp=class np extends Ii{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){let r=document.createElement("video");t.autoLoad!==!1&&r.setAttribute("preload","auto"),t.playsinline!==!1&&(r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline","")),t.muted===!0&&(r.setAttribute("muted",""),r.muted=!0),t.loop===!0&&r.setAttribute("loop",""),t.autoPlay!==!1&&r.setAttribute("autoplay",""),typeof e=="string"&&(e=[e]);let s=e[0].src||e[0];Ii.crossOrigin(r,s,t.crossorigin);for(let n=0;n<e.length;++n){let o=document.createElement("source"),{src:a,mime:l}=e[n];if(a=a||e[n],a.startsWith("data:"))l=a.slice(5,a.indexOf(";"));else if(!a.startsWith("blob:")){let c=a.split("?").shift().toLowerCase(),u=c.slice(c.lastIndexOf(".")+1);l=l||np.MIME_TYPES[u]||`video/${u}`}o.src=a,l&&(o.type=l),r.appendChild(o)}e=r}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){if(this._updateFPS){let t=wi.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;let e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((t,r)=>{this.valid?t(this):(this._resolve=t,this._reject=r,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){let e=this.source;return!e.paused&&!e.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){let e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);let t=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!t&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._configureAutoUpdate();let e=this.source;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(wi.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(wi.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(wi.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||np.TYPES.includes(t)}};sp.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],sp.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};var S4=sp;e4.push(A4,rl,w4,S4,ad,ua,Ys,ip,b4);var In=class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?ve.EMPTY:(e=e||new ve(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,t){let{a:r,b:s,c:n,d:o,tx:a,ty:l}=e,c=r*t.x+n*t.y+a,u=s*t.x+o*t.y+l;this.minX=Math.min(this.minX,c),this.maxX=Math.max(this.maxX,c),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(e){let t=this.minX,r=this.minY,s=this.maxX,n=this.maxY,o=e[0],a=e[1];t=o<t?o:t,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=e[2],a=e[3],t=o<t?o:t,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=e[4],a=e[5],t=o<t?o:t,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=e[6],a=e[7],t=o<t?o:t,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,this.minX=t,this.minY=r,this.maxX=s,this.maxY=n}addFrame(e,t,r,s,n){this.addFrameMatrix(e.worldTransform,t,r,s,n)}addFrameMatrix(e,t,r,s,n){let o=e.a,a=e.b,l=e.c,c=e.d,u=e.tx,h=e.ty,d=this.minX,f=this.minY,p=this.maxX,m=this.maxY,g=o*t+l*r+u,y=a*t+c*r+h;d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*s+l*r+u,y=a*s+c*r+h,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*t+l*n+u,y=a*t+c*n+h,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*s+l*n+u,y=a*s+c*n+h,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addVertexData(e,t,r){let s=this.minX,n=this.minY,o=this.maxX,a=this.maxY;for(let l=t;l<r;l+=2){let c=e[l],u=e[l+1];s=c<s?c:s,n=u<n?u:n,o=c>o?c:o,a=u>a?u:a}this.minX=s,this.minY=n,this.maxX=o,this.maxY=a}addVertices(e,t,r,s){this.addVerticesMatrix(e.worldTransform,t,r,s)}addVerticesMatrix(e,t,r,s,n=0,o=n){let a=e.a,l=e.b,c=e.c,u=e.d,h=e.tx,d=e.ty,f=this.minX,p=this.minY,m=this.maxX,g=this.maxY;for(let y=r;y<s;y+=2){let x=t[y],b=t[y+1],_=a*x+c*b+h,w=u*b+l*x+d;f=Math.min(f,_-n),m=Math.max(m,_+n),p=Math.min(p,w-o),g=Math.max(g,w+o)}this.minX=f,this.minY=p,this.maxX=m,this.maxY=g}addBounds(e){let t=this.minX,r=this.minY,s=this.maxX,n=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<r?e.minY:r,this.maxX=e.maxX>s?e.maxX:s,this.maxY=e.maxY>n?e.maxY:n}addBoundsMask(e,t){let r=e.minX>t.minX?e.minX:t.minX,s=e.minY>t.minY?e.minY:t.minY,n=e.maxX<t.maxX?e.maxX:t.maxX,o=e.maxY<t.maxY?e.maxY:t.maxY;if(r<=n&&s<=o){let a=this.minX,l=this.minY,c=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=s<l?s:l,this.maxX=n>c?n:c,this.maxY=o>u?o:u}}addBoundsMatrix(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,t){let r=e.minX>t.x?e.minX:t.x,s=e.minY>t.y?e.minY:t.y,n=e.maxX<t.x+t.width?e.maxX:t.x+t.width,o=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(r<=n&&s<=o){let a=this.minX,l=this.minY,c=this.maxX,u=this.maxY;this.minX=r<a?r:a,this.minY=s<l?s:l,this.maxX=n>c?n:c,this.maxY=o>u?o:u}}pad(e=0,t=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)}addFramePad(e,t,r,s,n,o){e-=n,t-=o,r+=n,s+=o,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>s?this.maxY:s}};var St=class i extends se.EventEmitter{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new il,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new In,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){let t=Object.keys(e);for(let r=0;r<t.length;++r){let s=t[r];Object.defineProperty(i.prototype,s,Object.getOwnPropertyDescriptor(e,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new ve),t=this._boundsRect),this._bounds.getRectangle(t)}getLocalBounds(e){var a;e||(this._localBoundsRect||(this._localBoundsRect=new ve),e=this._localBoundsRect),this._localBounds||(this._localBounds=new In);let t=this.transform,r=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(a=r==null?void 0:r.worldAlpha)!=null?a:1,this.transform=this._tempDisplayObjectParent.transform;let s=this._bounds,n=this._boundsID;this._bounds=this._localBounds;let o=this.getBounds(!1,e);return this.parent=r,this.transform=t,this._bounds=s,this._bounds.updateID+=this._boundsID-n,o}toGlobal(e,t,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)}toLocal(e,t,r,s){return t&&(e=t.toGlobal(e,r,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,r)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e=0,t=0,r=1,s=1,n=0,o=0,a=0,l=0,c=0){return this.position.x=e,this.position.y=t,this.scale.x=r||1,this.scale.y=s||1,this.rotation=n,this.skew.x=o,this.skew.y=a,this.pivot.x=l,this.pivot.y=c,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new ld),this.tempDisplayObjectParent}enableTempParent(){let e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*O8}set angle(e){this.transform.rotation=e*Ks}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex!==e&&(this._zIndex=e,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){let t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,t._maskRefCount===0&&(t.renderable=!0,t.isMask=!1))}if(this._mask=e,this._mask){let t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount===0&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}},ld=class extends St{constructor(){super(...arguments),this.sortDirty=null}};St.prototype.displayObjectUpdateTransform=St.prototype.updateTransform;var ZL=new rt;function JL(i,e){return i.zIndex===e.zIndex?i._lastSortedIndex-e._lastSortedIndex:i.zIndex-e.zIndex}var XA=class op extends St{constructor(){super(),this.children=[],this.sortableChildren=op.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{let t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;let r=this.getChildIndex(e),s=this.getChildIndex(t);this.children[r]=t,this.children[s]=e,this.onChildrenChange(r<s?r:s)}getChildIndex(e){let t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);let r=this.getChildIndex(e);se.removeItems(this.children,r,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{let t=e[0],r=this.children.indexOf(t);if(r===-1)return null;t.parent=null,t.transform._parentID=-1,se.removeItems(this.children,r,1),this._boundsID++,this.onChildrenChange(r),t.emit("removed",this),this.emit("childRemoved",t,this,r)}return e[0]}removeChildAt(e){let t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,se.removeItems(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){let r=e,s=t,n=s-r,o;if(n>0&&n<=s){o=this.children.splice(r,n);for(let a=0;a<o.length;++a)o[a].parent=null,o[a].transform&&(o[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let a=0;a<o.length;++a)o[a].emit("removed",this),this.emit("childRemoved",o[a],this,a);return o}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,r=this.children.length;t<r;++t){let s=this.children[t];s._lastSortedIndex=t,!e&&s.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(JL),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){let r=this.children[e];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){let t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){let r=t._mask.isMaskData?t._mask.maskObject:t._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(t._bounds,r._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){let r=super.getLocalBounds(e);if(!t)for(let s=0,n=this.children.length;s<n;++s){let o=this.children[s];o.visible&&o.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(e){let t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let r,s;this.cullArea?(r=this.cullArea,s=this.worldTransform):this._render!==op.prototype._render&&(r=this.getBounds(!0));let n=e.projection.transform;if(n&&(s?(s=ZL.copyFrom(s),s.prepend(n)):s=n),r&&t.intersects(r,s))this._render(e);else if(this.cullArea)return;for(let o=0,a=this.children.length;o<a;++o){let l=this.children[o],c=l.cullable;l.cullable=c||!this.cullArea,l.render(e),l.cullable=c}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let r=0,s=this.children.length;r<s;++r)this.children[r].render(e)}}renderAdvanced(e){var n,o,a;let t=this.filters,r=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let l=0;l<t.length;l++)t[l].enabled&&this._enabledFilters.push(t[l])}let s=t&&((n=this._enabledFilters)==null?void 0:n.length)||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==fi.NONE));if(s&&e.batch.flush(),t&&((o=this._enabledFilters)!=null&&o.length)&&e.filter.push(this,this._enabledFilters),r&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let l=0,c=this.children.length;l<c;++l)this.children[l].render(e)}s&&e.batch.flush(),r&&e.mask.pop(this),t&&((a=this._enabledFilters)!=null&&a.length)&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;let t=typeof e=="boolean"?e:e==null?void 0:e.children,r=this.removeChildren(0,this.children.length);if(t)for(let s=0;s<r.length;++s)r[s].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){let t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){let t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}};XA.defaultSortableChildren=!1;var Qe=XA;Qe.prototype.containerUpdateTransform=Qe.prototype.updateTransform;Object.defineProperties(te,{SORTABLE_CHILDREN:{get(){return Qe.defaultSortableChildren},set(i){se.deprecation("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Qe.defaultSortableChildren=i}}});var C4=new _e,eO=new Uint16Array([0,1,2,0,2,3]),Dt=class i extends Qe{constructor(e){super(),this._anchor=new sr(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new we(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=Le.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||xe.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=eO,this.pluginName="batch",this.isSprite=!0,this._roundPixels=te.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=se.sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=se.sign(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){let e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;let t=this.transform.worldTransform,r=t.a,s=t.b,n=t.c,o=t.d,a=t.tx,l=t.ty,c=this.vertexData,u=e.trim,h=e.orig,d=this._anchor,f=0,p=0,m=0,g=0;if(u?(p=u.x-d._x*h.width,f=p+u.width,g=u.y-d._y*h.height,m=g+u.height):(p=-d._x*h.width,f=p+h.width,g=-d._y*h.height,m=g+h.height),c[0]=r*p+n*g+a,c[1]=o*g+s*p+l,c[2]=r*f+n*g+a,c[3]=o*g+s*f+l,c[4]=r*f+n*m+a,c[5]=o*m+s*f+l,c[6]=r*p+n*m+a,c[7]=o*m+s*p+l,this._roundPixels){let y=te.RESOLUTION;for(let x=0;x<c.length;++x)c[x]=Math.round(c[x]*y)/y}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;let e=this._texture,t=this.vertexTrimmedData,r=e.orig,s=this._anchor,n=this.transform.worldTransform,o=n.a,a=n.b,l=n.c,c=n.d,u=n.tx,h=n.ty,d=-s._x*r.width,f=d+r.width,p=-s._y*r.height,m=p+r.height;if(t[0]=o*d+l*p+u,t[1]=c*p+a*d+h,t[2]=o*f+l*p+u,t[3]=c*p+a*f+h,t[4]=o*f+l*m+u,t[5]=c*m+a*f+h,t[6]=o*d+l*m+u,t[7]=c*m+a*d+h,this._roundPixels){let g=te.RESOLUTION;for(let y=0;y<t.length;++y)t[y]=Math.round(t[y]*g)/g}}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){let e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return this.children.length===0?(this._localBounds||(this._localBounds=new In),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new ve),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,C4);let t=this._texture.orig.width,r=this._texture.orig.height,s=-t*this.anchor.x,n=0;return C4.x>=s&&C4.x<s+t&&(n=-r*this.anchor.y,C4.y>=n&&C4.y<n+r)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof e=="boolean"?e:e==null?void 0:e.texture){let t=typeof e=="boolean"?e:e==null?void 0:e.baseTexture;this._texture.destroy(!!t)}this._texture=null}static from(e,t){let r=e instanceof xe?e:xe.from(e,t);return new i(r)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){let t=se.sign(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){let t=se.sign(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||xe.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}};var qA=new rt;St.prototype._cacheAsBitmap=!1;St.prototype._cacheData=null;St.prototype._cacheAsBitmapResolution=null;St.prototype._cacheAsBitmapMultisample=null;var ap=class{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}};Object.defineProperties(St.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(i){i!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(i){i!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(i){if(this._cacheAsBitmap===i)return;this._cacheAsBitmap=i;let e;i?(this._cacheData||(this._cacheData=new ap),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}});St.prototype._renderCached=function(i){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(i),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(i))};St.prototype._initCachedDisplayObject=function(i){var d,f,p;if((d=this._cacheData)!=null&&d.sprite)return;let e=this.alpha;this.alpha=1,i.batch.flush();let t=this.getLocalBounds(new ve,!0);if((f=this.filters)!=null&&f.length){let m=this.filters[0].padding;t.pad(m)}let r=this.cacheAsBitmapResolution||i.resolution;t.ceil(r),t.width=Math.max(t.width,1/r),t.height=Math.max(t.height,1/r);let s=i.renderTexture.current,n=i.renderTexture.sourceFrame.clone(),o=i.renderTexture.destinationFrame.clone(),a=i.projection.transform,l=ts.create({width:t.width,height:t.height,resolution:r,multisample:(p=this.cacheAsBitmapMultisample)!=null?p:i.multisample}),c=`cacheAsBitmap_${se.uid()}`;this._cacheData.textureCacheId=c,Ae.addToCache(l.baseTexture,c),xe.addToCache(l,c);let u=this.transform.localTransform.copyTo(qA).invert().translate(-t.x,-t.y);this.render=this._cacheData.originalRender,i.render(this,{renderTexture:l,clear:!0,transform:u,skipUpdateTransform:!1}),i.framebuffer.blit(),i.projection.transform=a,i.renderTexture.bind(s,n,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;let h=new Dt(l);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-(t.x/t.width),h.anchor.y=-(t.y/t.height),h.alpha=e,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=h.containsPoint.bind(h)};St.prototype._renderCachedCanvas=function(i){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(i),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(i))};St.prototype._initCachedDisplayObjectCanvas=function(i){var u;if((u=this._cacheData)!=null&&u.sprite)return;let e=this.getLocalBounds(new ve,!0),t=this.alpha;this.alpha=1;let r=i.canvasContext.activeContext,s=i._projTransform,n=this.cacheAsBitmapResolution||i.resolution;e.ceil(n),e.width=Math.max(e.width,1/n),e.height=Math.max(e.height,1/n);let o=ts.create({width:e.width,height:e.height,resolution:n}),a=`cacheAsBitmap_${se.uid()}`;this._cacheData.textureCacheId=a,Ae.addToCache(o.baseTexture,a),xe.addToCache(o,a);let l=qA;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=e.x,l.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,i.render(this,{renderTexture:o,clear:!0,transform:l,skipUpdateTransform:!1}),i.canvasContext.activeContext=r,i._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;let c=new Dt(o);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-(e.x/e.width),c.anchor.y=-(e.y/e.height),c.alpha=t,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=i._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=c.containsPoint.bind(c)};St.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};St.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};St.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Ae.removeFromCache(this._cacheData.textureCacheId),xe.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};St.prototype._cacheAsBitmapDestroy=function(i){this.cacheAsBitmap=!1,this.destroy(i)};St.prototype.name=null;Qe.prototype.getChildByName=function(i,e){for(let t=0,r=this.children.length;t<r;t++)if(this.children[t].name===i)return this.children[t];if(e)for(let t=0,r=this.children.length;t<r;t++){let s=this.children[t];if(!s.getChildByName)continue;let n=s.getChildByName(i,!0);if(n)return n}return null};St.prototype.getGlobalPosition=function(i=new _e,e=!1){return this.parent?this.parent.toGlobal(this.position,i,e):(i.x=this.position.x,i.y=this.position.y),i};var QA=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;var yc=class extends ye{constructor(e=1){super(ep,QA,{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}};var tO={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},iO=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function YA(i){let e=tO[i],t=e.length,r=iO,s="",n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;",o;for(let a=0;a<i;a++){let l=n.replace("%index%",a.toString());o=a,a>=t&&(o=i-a-1),l=l.replace("%value%",e[o].toString()),s+=l,s+=`
`}return r=r.replace("%blur%",s),r=r.replace("%size%",i.toString()),r}var rO=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function KA(i,e){let t=Math.ceil(i/2),r=rO,s="",n;e?n="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":n="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<i;o++){let a=n.replace("%index%",o.toString());a=a.replace("%sampleIndex%",`${o-(t-1)}.0`),s+=a,s+=`
`}return r=r.replace("%blur%",s),r=r.replace("%size%",i.toString()),r}var vo=class extends ye{constructor(e,t=8,r=4,s=ye.defaultResolution,n=5){let o=KA(n,e),a=YA(n);super(o,a),this.horizontal=e,this.resolution=s,this._quality=0,this.quality=r,this.blur=t}apply(e,t,r,s){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/t.width):this.uniforms.strength=1/r.height*(r.height/t.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/t.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/t.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)e.applyFilter(this,t,r,s);else{let n=e.getFilterTexture(),o=e.renderer,a=t,l=n;this.state.blend=!1,e.applyFilter(this,a,l,es.CLEAR);for(let c=1;c<this.passes-1;c++){e.bindAndClear(a,es.BLIT),this.uniforms.uSampler=l;let u=l;l=a,a=u,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,l,r,s),e.returnFilterTexture(n)}}get blur(){return this.strength}set blur(e){this.padding=1+Math.abs(e)*2,this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}};var k4=class extends ye{constructor(e=8,t=4,r=ye.defaultResolution,s=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new vo(!0,e,t,r,s),this.blurYFilter=new vo(!1,e,t,r,s),this.resolution=r,this.quality=t,this.blur=e,this.repeatEdgePixels=!1}apply(e,t,r,s){let n=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(n&&o){let a=e.getFilterTexture();this.blurXFilter.apply(e,t,a,es.CLEAR),this.blurYFilter.apply(e,a,r,s),e.returnFilterTexture(a)}else o?this.blurYFilter.apply(e,t,r,s):this.blurXFilter.apply(e,t,r,s)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}};var ZA=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;var en=class extends ye{constructor(){let e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(y4,ZA,e),this.alpha=1}_loadMatrix(e,t=!1){let r=e;t&&(this._multiply(r,this.uniforms.m,e),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(e,t,r){return e[0]=t[0]*r[0]+t[1]*r[5]+t[2]*r[10]+t[3]*r[15],e[1]=t[0]*r[1]+t[1]*r[6]+t[2]*r[11]+t[3]*r[16],e[2]=t[0]*r[2]+t[1]*r[7]+t[2]*r[12]+t[3]*r[17],e[3]=t[0]*r[3]+t[1]*r[8]+t[2]*r[13]+t[3]*r[18],e[4]=t[0]*r[4]+t[1]*r[9]+t[2]*r[14]+t[3]*r[19]+t[4],e[5]=t[5]*r[0]+t[6]*r[5]+t[7]*r[10]+t[8]*r[15],e[6]=t[5]*r[1]+t[6]*r[6]+t[7]*r[11]+t[8]*r[16],e[7]=t[5]*r[2]+t[6]*r[7]+t[7]*r[12]+t[8]*r[17],e[8]=t[5]*r[3]+t[6]*r[8]+t[7]*r[13]+t[8]*r[18],e[9]=t[5]*r[4]+t[6]*r[9]+t[7]*r[14]+t[8]*r[19]+t[9],e[10]=t[10]*r[0]+t[11]*r[5]+t[12]*r[10]+t[13]*r[15],e[11]=t[10]*r[1]+t[11]*r[6]+t[12]*r[11]+t[13]*r[16],e[12]=t[10]*r[2]+t[11]*r[7]+t[12]*r[12]+t[13]*r[17],e[13]=t[10]*r[3]+t[11]*r[8]+t[12]*r[13]+t[13]*r[18],e[14]=t[10]*r[4]+t[11]*r[9]+t[12]*r[14]+t[13]*r[19]+t[14],e[15]=t[15]*r[0]+t[16]*r[5]+t[17]*r[10]+t[18]*r[15],e[16]=t[15]*r[1]+t[16]*r[6]+t[17]*r[11]+t[18]*r[16],e[17]=t[15]*r[2]+t[16]*r[7]+t[17]*r[12]+t[18]*r[17],e[18]=t[15]*r[3]+t[16]*r[8]+t[17]*r[13]+t[18]*r[18],e[19]=t[15]*r[4]+t[16]*r[9]+t[17]*r[14]+t[18]*r[19]+t[19],e}_colorMatrix(e){let t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){let r=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(r,t)}tint(e,t){let[r,s,n]=we.shared.setValue(e).toArray(),o=[r,0,0,0,0,0,s,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(o,t)}greyscale(e,t){let r=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(r,t)}blackAndWhite(e){let t=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(t,e)}hue(e,t){e=(e||0)/180*Math.PI;let r=Math.cos(e),s=Math.sin(e),n=Math.sqrt,o=1/3,a=n(o),l=r+(1-r)*o,c=o*(1-r)-a*s,u=o*(1-r)+a*s,h=o*(1-r)+a*s,d=r+o*(1-r),f=o*(1-r)-a*s,p=o*(1-r)-a*s,m=o*(1-r)+a*s,g=r+o*(1-r),y=[l,c,u,0,0,h,d,f,0,0,p,m,g,0,0,0,0,0,1,0];this._loadMatrix(y,t)}contrast(e,t){let r=(e||0)+1,s=-.5*(r-1),n=[r,0,0,0,s,0,r,0,0,s,0,0,r,0,s,0,0,0,1,0];this._loadMatrix(n,t)}saturate(e=0,t){let r=e*2/3+1,s=(r-1)*-.5,n=[r,s,s,0,0,s,r,s,0,0,s,s,r,0,0,0,0,0,1,0];this._loadMatrix(n,t)}desaturate(){this.saturate(-1)}negative(e){let t=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(t,e)}sepia(e){let t=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(t,e)}technicolor(e){let t=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(t,e)}polaroid(e){let t=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(t,e)}toBGR(e){let t=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(t,e)}kodachrome(e){let t=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(t,e)}browni(e){let t=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(t,e)}vintage(e){let t=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(t,e)}colorTone(e,t,r,s,n){e=e||.2,t=t||.15,r=r||16770432,s=s||3375104;let o=we.shared,[a,l,c]=o.setValue(r).toArray(),[u,h,d]=o.setValue(s).toArray(),f=[.3,.59,.11,0,0,a,l,c,e,0,u,h,d,t,0,a-u,l-h,c-d,0,0];this._loadMatrix(f,n)}night(e,t){e=e||.1;let r=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(r,t)}predator(e,t){let r=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(r,t)}lsd(e){let t=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(t,e)}reset(){let e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}};en.prototype.grayscale=en.prototype.greyscale;var JA=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`;var eS=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;var T4=class extends ye{constructor(e,t){let r=new rt;e.renderable=!1,super(eS,JA,{mapSampler:e._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=r,t==null&&(t=20),this.scale=new _e(t,t)}apply(e,t,r,s){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;let n=this.maskSprite.worldTransform,o=Math.sqrt(n.a*n.a+n.b*n.b),a=Math.sqrt(n.c*n.c+n.d*n.d);o!==0&&a!==0&&(this.uniforms.rotation[0]=n.a/o,this.uniforms.rotation[1]=n.b/o,this.uniforms.rotation[2]=n.c/a,this.uniforms.rotation[3]=n.d/a),e.applyFilter(this,t,r,s)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}};var tS=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`;var iS=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;var I4=class extends ye{constructor(){super(iS,tS)}};var rS=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;var M4=class extends ye{constructor(e=.5,t=Math.random()){super(y4,rS,{uNoise:0,uSeed:0}),this.noise=e,this.seed=t}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}};var P4={AlphaFilter:yc,BlurFilter:k4,BlurFilterPass:vo,ColorMatrixFilter:en,DisplacementFilter:T4,FXAAFilter:I4,NoiseFilter:M4};Object.entries(P4).forEach(([i,e])=>{Object.defineProperty(P4,i,{get(){return se.deprecation("7.1.0",`filters.${i} has moved to ${i}`),e}})});var lp=class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(wi.system.add(this.tickerUpdate,this,is.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(wi.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}let e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&e.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}},Mn=new lp;var _o=class i{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=i.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new _e,this.page=new _e,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,t,r,s,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}};var Pn=class extends _o{constructor(){super(...arguments),this.client=new _e,this.movement=new _e,this.offset=new _e,this.global=new _e,this.screen=new _e}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,r){return e.worldTransform.applyInverse(r||this.global,t)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,r,s,n,o,a,l,c,u,h,d,f,p,m){throw new Error("Method not implemented.")}};var or=class extends Pn{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}};var tn=class extends Pn{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}};tn.DOM_DELTA_PIXEL=0,tn.DOM_DELTA_LINE=1,tn.DOM_DELTA_PAGE=2;var sO=2048,nO=new _e,cp=new _e,D4=class{constructor(e){this.dispatch=new se.EventEmitter,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((r,s)=>r.priority-s.priority)}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;let t=this.mappingTable[e.type];if(t)for(let r=0,s=t.length;r<s;r++)t[r].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){Mn.pauseUpdate=!0;let r=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",s=this[r](this.rootTarget,this.rootTarget.eventMode,nO.set(e,t),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(e,t){if(!e.target)return;let r=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let s=0,n=r.length-1;s<n;s++)if(e.currentTarget=r[s],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!(e.propagationStopped||e.propagationImmediatelyStopped)){e.eventPhase=e.BUBBLING_PHASE;for(let s=r.length-2;s>=0;s--)if(e.currentTarget=r[s],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,r=this._allInteractiveElements){if(r.length===0)return;e.eventPhase=e.BUBBLING_PHASE;let s=Array.isArray(t)?t:[t];for(let n=r.length-1;n>=0;n--)s.forEach(o=>{e.currentTarget=r[n],this.notifyTarget(e,o)})}propagationPath(e){let t=[e];for(let r=0;r<sO&&e!==this.rootTarget;r++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestMoveRecursive(e,t,r,s,n,o=!1){let a=!1;if(this._interactivePrune(e))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(Mn.pauseUpdate=!1),e.interactiveChildren&&e.children){let u=e.children;for(let h=u.length-1;h>=0;h--){let d=u[h],f=this.hitTestMoveRecursive(d,this._isInteractive(t)?t:d.eventMode,r,s,n,o||n(e,r));if(f){if(f.length>0&&!f[f.length-1].parent)continue;let p=e.isInteractive();(f.length>0||p)&&(p&&this._allInteractiveElements.push(e),f.push(e)),this._hitElements.length===0&&(this._hitElements=f),a=!0}}}let l=this._isInteractive(t),c=e.isInteractive();return l&&c&&this._allInteractiveElements.push(e),o||this._hitElements.length>0?null:a?this._hitElements:l&&!n(e,r)&&s(e,r)?c?[e]:[]:null}hitTestRecursive(e,t,r,s,n){if(this._interactivePrune(e)||n(e,r))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(Mn.pauseUpdate=!1),e.interactiveChildren&&e.children){let l=e.children;for(let c=l.length-1;c>=0;c--){let u=l[c],h=this.hitTestRecursive(u,this._isInteractive(t)?t:u.eventMode,r,s,n);if(h){if(h.length>0&&!h[h.length-1].parent)continue;let d=e.isInteractive();return(h.length>0||d)&&h.push(e),h}}}let o=this._isInteractive(t),a=e.isInteractive();return o&&s(e,r)?a?[e]:[]:null}_isInteractive(e){return e==="static"||e==="dynamic"}_interactivePrune(e){return!!(!e||e.isMask||!e.visible||!e.renderable||e.eventMode==="none"||e.eventMode==="passive"&&!e.interactiveChildren||e.isMask)}hitPruneFn(e,t){var r;if(e.hitArea&&(e.worldTransform.applyInverse(t,cp),!e.hitArea.contains(cp.x,cp.y)))return!0;if(e._mask){let s=e._mask.isMaskData?e._mask.maskObject:e._mask;if(s&&!((r=s.containsPoint)!=null&&r.call(s,t)))return!0}return!1}hitTestFn(e,t){return e.eventMode==="passive"?!1:e.hitArea?!0:e.containsPoint?e.containsPoint(t):!1}notifyTarget(e,t){var n,o;t=t!=null?t:e.type;let r=`on${t}`;(o=(n=e.currentTarget)[r])==null||o.call(n,e);let s=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this.notifyListeners(e,s),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof or)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),t.pointerType==="touch")this.dispatchEvent(t,"touchstart");else if(t.pointerType==="mouse"||t.pointerType==="pen"){let s=t.button===2;this.dispatchEvent(t,s?"rightdown":"mousedown")}let r=this.trackingData(e.pointerId);r.pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){var l,c,u;if(!(e instanceof or)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;let t=this.createPointerEvent(e);this._isPointerMoveEvent=!1;let r=t.pointerType==="mouse"||t.pointerType==="pen",s=this.trackingData(e.pointerId),n=this.findMountedTarget(s.overTargets);if(((l=s.overTargets)==null?void 0:l.length)>0&&n!==t.target){let h=e.type==="mousemove"?"mouseout":"pointerout",d=this.createPointerEvent(e,h,n);if(this.dispatchEvent(d,"pointerout"),r&&this.dispatchEvent(d,"mouseout"),!t.composedPath().includes(n)){let f=this.createPointerEvent(e,"pointerleave",n);for(f.eventPhase=f.AT_TARGET;f.target&&!t.composedPath().includes(f.target);)f.currentTarget=f.target,this.notifyTarget(f),r&&this.notifyTarget(f,"mouseleave"),f.target=f.target.parent;this.freeEvent(f)}this.freeEvent(d)}if(n!==t.target){let h=e.type==="mousemove"?"mouseover":"pointerover",d=this.clonePointerEvent(t,h);this.dispatchEvent(d,"pointerover"),r&&this.dispatchEvent(d,"mouseover");let f=n==null?void 0:n.parent;for(;f&&f!==this.rootTarget.parent&&f!==t.target;)f=f.parent;if(!f||f===this.rootTarget.parent){let p=this.clonePointerEvent(t,"pointerenter");for(p.eventPhase=p.AT_TARGET;p.target&&p.target!==n&&p.target!==this.rootTarget.parent;)p.currentTarget=p.target,this.notifyTarget(p),r&&this.notifyTarget(p,"mouseenter"),p.target=p.target.parent;this.freeEvent(p)}this.freeEvent(d)}let o=[],a=(c=this.enableGlobalMoveEvents)!=null?c:!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(t,"pointermove"),a&&o.push("globalpointermove"),t.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(t,"touchmove"),a&&o.push("globaltouchmove")),r&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(t,"mousemove"),a&&o.push("globalmousemove"),this.cursor=(u=t.target)==null?void 0:u.cursor),o.length>0&&this.all(t,o),this._allInteractiveElements.length=0,this._hitElements.length=0,s.overTargets=t.composedPath(),this.freeEvent(t)}mapPointerOver(e){var o;if(!(e instanceof or)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let t=this.trackingData(e.pointerId),r=this.createPointerEvent(e),s=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),s&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=(o=r.target)==null?void 0:o.cursor);let n=this.clonePointerEvent(r,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),s&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;t.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(n)}mapPointerOut(e){if(!(e instanceof or)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let t=this.trackingData(e.pointerId);if(t.overTargets){let r=e.pointerType==="mouse"||e.pointerType==="pen",s=this.findMountedTarget(t.overTargets),n=this.createPointerEvent(e,"pointerout",s);this.dispatchEvent(n),r&&this.dispatchEvent(n,"mouseout");let o=this.createPointerEvent(e,"pointerleave",s);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),r&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;t.overTargets=null,this.freeEvent(n),this.freeEvent(o)}this.cursor=null}mapPointerUp(e){if(!(e instanceof or)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let t=performance.now(),r=this.createPointerEvent(e);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){let a=r.button===2;this.dispatchEvent(r,a?"rightup":"mouseup")}let s=this.trackingData(e.pointerId),n=this.findMountedTarget(s.pressTargetsByButton[e.button]),o=n;if(n&&!r.composedPath().includes(n)){let a=n;for(;a&&!r.composedPath().includes(a);){if(r.currentTarget=a,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){let l=r.button===2;this.notifyTarget(r,l?"rightupoutside":"mouseupoutside")}a=a.parent}delete s.pressTargetsByButton[e.button],o=a}if(o){let a=this.clonePointerEvent(r,"click");a.target=o,a.path=null,s.clicksByButton[e.button]||(s.clicksByButton[e.button]={clickCount:0,target:a.target,timeStamp:t});let l=s.clicksByButton[e.button];if(l.target===a.target&&t-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=a.target,l.timeStamp=t,a.detail=l.clickCount,a.pointerType==="mouse"){let c=a.button===2;this.dispatchEvent(a,c?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(r)}mapPointerUpOutside(e){if(!(e instanceof or)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let t=this.trackingData(e.pointerId),r=this.findMountedTarget(t.pressTargetsByButton[e.button]),s=this.createPointerEvent(e);if(r){let n=r;for(;n;)s.currentTarget=n,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch"?this.notifyTarget(s,"touchendoutside"):(s.pointerType==="mouse"||s.pointerType==="pen")&&this.notifyTarget(s,s.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(s)}mapWheel(e){if(!(e instanceof tn)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}let t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let r=1;r<e.length&&e[r].parent===t;r++)t=e[r];return t}createPointerEvent(e,t,r){var n;let s=this.allocateEvent(or);return this.copyPointerData(e,s),this.copyMouseData(e,s),this.copyData(e,s),s.nativeEvent=e.nativeEvent,s.originalEvent=e,s.target=(n=r!=null?r:this.hitTest(s.global.x,s.global.y))!=null?n:this._hitElements[0],typeof t=="string"&&(s.type=t),s}createWheelEvent(e){let t=this.allocateEvent(tn);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){let r=this.allocateEvent(or);return r.nativeEvent=e.nativeEvent,r.originalEvent=e.originalEvent,this.copyPointerData(e,r),this.copyMouseData(e,r),this.copyData(e,r),r.target=e.target,r.path=e.composedPath().slice(),r.type=t!=null?t:r.type,r}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof or&&t instanceof or&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof Pn&&t instanceof Pn&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);let t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");let t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}notifyListeners(e,t){let r=e.currentTarget._events[t];if(r&&e.currentTarget.isInteractive())if("fn"in r)r.once&&e.currentTarget.removeListener(t,r.fn,void 0,!0),r.fn.call(r.context,e);else for(let s=0,n=r.length;s<n&&!e.propagationImmediatelyStopped;s++)r[s].once&&e.currentTarget.removeListener(t,r[s].fn,void 0,!0),r[s].fn.call(r[s].context,e)}};var oO=1,aO={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},up=class hp{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new D4(null),Mn.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new or(null),this.rootWheelEvent=new tn(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy(Ne({},hp.defaultEventFeatures),{set:(t,r,s)=>(r==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=s),t[r]=s,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){var s,n;let{view:t,resolution:r}=this.renderer;this.setTargetElement(t),this.resolution=r,hp._defaultEventMode=(s=e.eventMode)!=null?s:"auto",Object.assign(this.features,(n=e.eventFeatures)!=null?n:{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;let r=this.cursorStyles[e];if(r)switch(typeof r){case"string":t&&(this.domElement.style.cursor=r);break;case"function":r(e);break;case"object":t&&Object.assign(this.domElement.style,r);break}else t&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let r=0,s=t.length;r<s;r++){let n=t[r],o=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Mn.pointerMoved();let t=this.normalizeToPointerData(e);for(let r=0,s=t.length;r<s;r++){let n=this.bootstrapEvent(this.rootPointerEvent,t[r]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);let r=t!==this.domElement?"outside":"",s=this.normalizeToPointerData(e);for(let n=0,o=s.length;n<o;n++){let a=this.bootstrapEvent(this.rootPointerEvent,s[n]);a.type+=r,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=this.normalizeToPointerData(e);for(let r=0,s=t.length;r<s;r++){let n=this.bootstrapEvent(this.rootPointerEvent,t[r]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;let t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,Mn.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Mn.addTickerListener();let e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Mn.removeTickerListener();let e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,r){let s=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},n=1/this.resolution;e.x=(t-s.left)*(this.domElement.width/s.width)*n,e.y=(r-s.top)*(this.domElement.height/s.height)*n}normalizeToPointerData(e){let t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let r=0,s=e.changedTouches.length;r<s;r++){let n=e.changedTouches[r];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=e.type,t.push(n)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){let r=e;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=oO),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,t.push(r)}else t.push(e);return t}normalizeWheelEvent(e){let t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,e.type==="pointerleave"&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=aO[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};up.extension={name:"events",type:[ee.RendererSystem,ee.CanvasRendererSystem]},up.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};var R4=up;ne.add(R4);function sS(i){return i==="dynamic"||i==="static"}var nS={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){var i;return(i=this._internalInteractive)!=null?i:sS(R4.defaultEventMode)},set interactive(i){se.deprecation("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=i,this.eventMode=i?"static":"auto"},_internalEventMode:void 0,get eventMode(){var i;return(i=this._internalEventMode)!=null?i:R4.defaultEventMode},set eventMode(i){this._internalInteractive=sS(i),this._internalEventMode=i},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(i,e,t){let r=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,s=typeof t=="object"?t.signal:void 0,n=typeof t=="object"?t.once===!0:!1,o=typeof e=="function"?void 0:e;i=r?`${i}capture`:i;let a=typeof e=="function"?e:e.handleEvent,l=this;s&&s.addEventListener("abort",()=>{l.off(i,a,o)}),n?l.once(i,a,o):l.on(i,a,o)},removeEventListener(i,e,t){let r=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,s=typeof e=="function"?void 0:e;i=r?`${i}capture`:i,e=typeof e=="function"?e:e.handleEvent,this.off(i,e,s)},dispatchEvent(i){if(!(i instanceof _o))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return i.defaultPrevented=!1,i.path=null,i.target=this,i.manager.dispatchEvent(i),!i.defaultPrevented}};St.mixin(nS);var dp={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};St.mixin(dp);var lO=9,cd=100,cO=0,uO=0,oS=2,aS=1,hO=-1e3,dO=-1e3,fO=2,N4=class{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(se.isMobile.tablet||se.isMobile.phone)&&this.createTouchHook();let t=document.createElement("div");t.style.width=`${cd}px`,t.style.height=`${cd}px`,t.style.position="absolute",t.style.top=`${cO}px`,t.style.left=`${uO}px`,t.style.zIndex=oS.toString(),this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){let e=document.createElement("button");e.style.width=`${aS}px`,e.style.height=`${aS}px`,e.style.position="absolute",e.style.top=`${hO}px`,e.style.left=`${dO}px`,e.style.zIndex=fO.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var e;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(e=this.renderer.view.parentNode)==null||e.appendChild(this.div))}deactivate(){var e;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(e=this.div.parentNode)==null||e.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);let t=e.children;if(t)for(let r=0;r<t.length;r++)this.updateAccessibleObjects(t[r])}update(){let e=performance.now();if(se.isMobile.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);let{x:t,y:r,width:s,height:n}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:l}=this.renderer,c=s/o*l,u=n/a*l,h=this.div;h.style.left=`${t}px`,h.style.top=`${r}px`,h.style.width=`${o}px`,h.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){let f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,se.removeItems(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{h=f._accessibleDiv;let p=f.hitArea,m=f.worldTransform;f.hitArea?(h.style.left=`${(m.tx+p.x*m.a)*c}px`,h.style.top=`${(m.ty+p.y*m.d)*u}px`,h.style.width=`${p.width*m.a*c}px`,h.style.height=`${p.height*m.d*u}px`):(p=f.getBounds(),this.capHitArea(p),h.style.left=`${p.x*c}px`,h.style.top=`${p.y*u}px`,h.style.width=`${p.width*c}px`,h.style.height=`${p.height*u}px`,h.title!==f.accessibleTitle&&f.accessibleTitle!==null&&(h.title=f.accessibleTitle),h.getAttribute("aria-label")!==f.accessibleHint&&f.accessibleHint!==null&&h.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==h.title||f.tabIndex!==h.tabIndex)&&(h.title=f.accessibleTitle,h.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(h))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);let{width:t,height:r}=this.renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>r&&(e.height=r-e.y)}addChild(e){let t=this.pool.pop();t||(t=document.createElement("button"),t.style.width=`${cd}px`,t.style.height=`${cd}px`,t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=oS.toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?t.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(t.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&e.accessibleHint!==null&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){let{displayObject:r}=e.target,s=this.renderer.events.rootBoundary,n=Object.assign(new _o(s),{target:r});s.rootTarget=this.renderer.lastObjectRendered,t.forEach(o=>s.dispatchEvent(n,o))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){e.keyCode===lO&&this.activate()}_onMouseMove(e){e.movementX===0&&e.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}};N4.extension={name:"accessibility",type:[ee.RendererPlugin,ee.CanvasRendererPlugin]};ne.add(N4);var lS=class fp{constructor(e){this.stage=new Qe,e=Object.assign({forceCanvas:!1},e),this.renderer=J8(e),fp._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){var e;return(e=this.renderer)==null?void 0:e.view}get screen(){var e;return(e=this.renderer)==null?void 0:e.screen}destroy(e,t){let r=fp._plugins.slice(0);r.reverse(),r.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};lS._plugins=[];var xc=lS;ne.handleByList(ee.Application,xc._plugins);var F4=class{static init(e){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let t,r;if(this._resizeTo===globalThis.window)t=globalThis.innerWidth,r=globalThis.innerHeight;else{let{clientWidth:s,clientHeight:n}=this._resizeTo;t=s,r=n}this.renderer.resize(t,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}};F4.extension=ee.Application;ne.add(F4);var cS={loader:ee.LoadParser,resolver:ee.ResolveParser,cache:ee.CacheParser,detection:ee.DetectionParser};ne.handle(ee.Asset,i=>{let e=i.ref;Object.entries(cS).filter(([t])=>!!e[t]).forEach(([t,r])=>{var s;return ne.add(Object.assign(e[t],{extension:(s=e[t].extension)!=null?s:r}))})},i=>{let e=i.ref;Object.keys(cS).filter(t=>!!e[t]).forEach(t=>ne.remove(e[t]))});var ud=class{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(t=>{this._assetList.push(t)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}_next(){return fe(this,null,function*(){if(this._assetList.length&&this._isActive){this._isLoading=!0;let e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<t;r++)e.push(this._assetList.pop());yield this._loader.load(e),this._isLoading=!1,this._next()}})}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}};function $r(i,e){if(Array.isArray(e)){for(let t of e)if(i.startsWith(`data:${t}`))return!0;return!1}return i.startsWith(`data:${e}`)}function $i(i,e){let t=i.split("?")[0],r=se.path.extname(t).toLowerCase();return Array.isArray(e)?e.includes(r):r===e}var Yi=(i,e,t=!1)=>(Array.isArray(i)||(i=[i]),e?i.map(r=>typeof r=="string"||t?e(r):r):i);var ll=(i,e)=>{let t=e.split("?")[1];return t&&(i+=`?${t}`),i};function uS(i,e,t,r,s){let n=e[t];for(let o=0;o<n.length;o++){let a=n[o];t<e.length-1?uS(i.replace(r[t],a),e,t+1,r,s):s.push(i.replace(r[t],a))}}function hd(i){let e=/\{(.*?)\}/g,t=i.match(e),r=[];if(t){let s=[];t.forEach(n=>{let o=n.substring(1,n.length-1).split(",");s.push(o)}),uS(i,s,0,t,r)}else r.push(i);return r}var bo=i=>!Array.isArray(i);var pp=class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){let t=this._cache.get(e);return t||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){let r=Yi(e),s;for(let a=0;a<this.parsers.length;a++){let l=this.parsers[a];if(l.test(t)){s=l.getCacheableAssets(r,t);break}}s||(s={},r.forEach(a=>{s[a]=t}));let n=Object.keys(s),o={cacheKeys:n,keys:r};if(r.forEach(a=>{this._cacheMap.set(a,o)}),n.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==t&&console.warn("[Cache] already has key:",a),this._cache.set(a,s[a])}),t instanceof xe){let a=t;r.forEach(l=>{a.baseTexture!==xe.EMPTY.baseTexture&&Ae.addToCache(a.baseTexture,l),xe.addToCache(a,l)})}}remove(e){if(!this._cacheMap.has(e)){console.warn(`[Assets] Asset id ${e} was not found in the Cache`);return}let t=this._cacheMap.get(e);t.cacheKeys.forEach(r=>{this._cache.delete(r)}),t.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}},rn=new pp;var dd=class{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,r)=>(this._parsersValidated=!1,e[t]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){let r={promise:null,parser:null};return r.promise=fe(this,null,function*(){var o,a;let s=null,n=null;if(t.loadParser&&(n=this._parserHash[t.loadParser],n||console.warn(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`)),!n){for(let l=0;l<this.parsers.length;l++){let c=this.parsers[l];if(c.load&&((o=c.test)!=null&&o.call(c,e,t,this))){n=c;break}}if(!n)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}s=yield n.load(e,t,this),r.parser=n;for(let l=0;l<this.parsers.length;l++){let c=this.parsers[l];c.parse&&c.parse&&(yield(a=c.testParse)==null?void 0:a.call(c,s,t,this))&&(s=(yield c.parse(s,t,this))||s,r.parser=c)}return s}),r}load(e,t){return fe(this,null,function*(){this._parsersValidated||this._validateParsers();let r=0,s={},n=bo(e),o=Yi(e,c=>({alias:[c],src:c})),a=o.length,l=o.map(c=>fe(this,null,function*(){let u=se.path.toAbsolute(c.src);if(!s[c.src])try{this.promiseCache[u]||(this.promiseCache[u]=this._getLoadPromiseAndParser(u,c)),s[c.src]=yield this.promiseCache[u].promise,t&&t(++r/a)}catch(h){throw delete this.promiseCache[u],delete s[c.src],new Error(`[Loader.load] Failed to load ${u}.
${h}`)}}));return yield Promise.all(l),n?s[o[0].src]:s})}unload(e){return fe(this,null,function*(){let t=Yi(e,r=>({alias:[r],src:r})).map(r=>fe(this,null,function*(){var o,a;let s=se.path.toAbsolute(r.src),n=this.promiseCache[s];if(n){let l=yield n.promise;delete this.promiseCache[s],(a=(o=n.parser)==null?void 0:o.unload)==null||a.call(o,l,r,this)}}));yield Promise.all(t)})}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,t)=>(e[t.name]&&console.warn(`[Assets] loadParser name conflict "${t.name}"`),Si(Ne({},e),{[t.name]:t})),{})}};var si=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(si||{});var pO=".json",mO="application/json",mp={extension:{type:ee.LoadParser,priority:si.Low},name:"loadJson",test(i){return $r(i,mO)||$i(i,pO)},load(i){return fe(this,null,function*(){return yield(yield te.ADAPTER.fetch(i)).json()})}};ne.add(mp);var gO=".txt",yO="text/plain",gp={name:"loadTxt",extension:{type:ee.LoadParser,priority:si.Low},test(i){return $r(i,yO)||$i(i,gO)},load(i){return fe(this,null,function*(){return yield(yield te.ADAPTER.fetch(i)).text()})}};ne.add(gp);var xO=["normal","bold","100","200","300","400","500","600","700","800","900"],vO=[".ttf",".otf",".woff",".woff2"],_O=["font/ttf","font/otf","font/woff","font/woff2"],bO=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function yp(i){let e=se.path.extname(i),t=se.path.basename(i,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1)),r=t.length>0;for(let n of t)if(!n.match(bO)){r=!1;break}let s=t.join(" ");return r||(s=`"${s.replace(/[\\"]/g,"\\$&")}"`),s}var wO=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function EO(i){return wO.test(i)?i:encodeURI(i)}var xp={extension:{type:ee.LoadParser,priority:si.Low},name:"loadWebFont",test(i){return $r(i,_O)||$i(i,vO)},load(i,e){return fe(this,null,function*(){var r,s,n,o,a,l;let t=te.ADAPTER.getFontFaceSet();if(t){let c=[],u=(s=(r=e.data)==null?void 0:r.family)!=null?s:yp(i),h=(a=(o=(n=e.data)==null?void 0:n.weights)==null?void 0:o.filter(f=>xO.includes(f)))!=null?a:["normal"],d=(l=e.data)!=null?l:{};for(let f=0;f<h.length;f++){let p=h[f],m=new FontFace(u,`url(${EO(i)})`,Si(Ne({},d),{weight:p}));yield m.load(),t.add(m),c.push(m)}return c.length===1?c[0]:c}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null})},unload(i){(Array.isArray(i)?i:[i]).forEach(e=>te.ADAPTER.getFontFaceSet().delete(e))}};ne.add(xp);var AO=`(function() {
  "use strict";
  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
  async function checkImageBitmap() {
    try {
      if (typeof createImageBitmap != "function")
        return !1;
      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap.width === 1 && imageBitmap.height === 1;
    } catch {
      return !1;
    }
  }
  checkImageBitmap().then((result) => {
    self.postMessage(result);
  });
})();
`,vc=null,_c=class extends Worker{constructor(){vc||(vc=URL.createObjectURL(new Blob([AO],{type:"application/javascript"}))),super(vc)}};_c.revokeObjectURL=function(){vc&&(URL.revokeObjectURL(vc),vc=null)};var SO=`(function() {
  "use strict";
  async function loadImageBitmap(url) {
    const response = await fetch(url);
    if (!response.ok)
      throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
    const imageBlob = await response.blob();
    return await createImageBitmap(imageBlob);
  }
  self.onmessage = async (event) => {
    try {
      const imageBitmap = await loadImageBitmap(event.data.data[0]);
      self.postMessage({
        data: imageBitmap,
        uuid: event.data.uuid,
        id: event.data.id
      }, [imageBitmap]);
    } catch (e) {
      self.postMessage({
        error: e,
        uuid: event.data.uuid,
        id: event.data.id
      });
    }
  };
})();
`,bc=null,L4=class extends Worker{constructor(){bc||(bc=URL.createObjectURL(new Blob([SO],{type:"application/javascript"}))),super(bc)}};L4.revokeObjectURL=function(){bc&&(URL.revokeObjectURL(bc),bc=null)};var hS=0,vp,_p=class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{let t=new _c;t.addEventListener("message",r=>{t.terminate(),_c.revokeObjectURL(),e(r.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}_initWorkers(){return fe(this,null,function*(){this._initialized||(this._initialized=!0)})}getWorker(){vp===void 0&&(vp=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<vp&&(this._createdWorkers++,e=new L4,e.addEventListener("message",t=>{this.complete(t.data),this.returnWorker(t.target),this.next()})),e}returnWorker(e){this.workerPool.push(e)}complete(e){e.error!==void 0?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}_run(e,t){return fe(this,null,function*(){yield this._initWorkers();let r=new Promise((s,n)=>{this.queue.push({id:e,arguments:t,resolve:s,reject:n})});return this.next(),r})}next(){if(!this.queue.length)return;let e=this.getWorker();if(!e)return;let t=this.queue.pop(),r=t.id;this.resolveHash[hS]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:hS++,id:r})}},bp=new _p;function Ts(i,e,t){i.resource.internal=!0;let r=new xe(i),s=()=>{delete e.promiseCache[t],rn.has(t)&&rn.remove(t)};return r.baseTexture.once("destroyed",()=>{t in e.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),s())}),r.once("destroyed",()=>{i.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s())}),r}var CO=[".jpeg",".jpg",".png",".webp",".avif"],kO=["image/jpeg","image/png","image/webp","image/avif"];function wp(i){return fe(this,null,function*(){let e=yield te.ADAPTER.fetch(i);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${e.status} ${e.statusText}`);let t=yield e.blob();return yield createImageBitmap(t)})}var wo={name:"loadTextures",extension:{type:ee.LoadParser,priority:si.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(i){return $r(i,kO)||$i(i,CO)},load(i,e,t){return fe(this,null,function*(){var a,l;let r=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap,s;r?this.config.preferWorkers&&(yield bp.isImageBitmapSupported())?s=yield bp.loadImageBitmap(i):s=yield wp(i):s=yield new Promise((c,u)=>{let h=new Image;h.crossOrigin=this.config.crossOrigin,h.src=i,h.complete?c(h):(h.onload=()=>c(h),h.onerror=d=>u(d))});let n=Ne({},e.data);(a=n.resolution)!=null||(n.resolution=se.getResolutionOfUrl(i)),r&&((l=n.resourceOptions)==null?void 0:l.ownsImageBitmap)===void 0&&(n.resourceOptions=Ne({},n.resourceOptions),n.resourceOptions.ownsImageBitmap=!0);let o=new Ae(s,n);return o.resource.src=i,Ts(o,t,i)})},unload(i){i.destroy(!0)}};ne.add(wo);var TO=".svg",IO="image/svg+xml",Ep={extension:{type:ee.LoadParser,priority:si.High},name:"loadSVG",test(i){return $r(i,IO)||$i(i,TO)},testParse(i){return fe(this,null,function*(){return ua.test(i)})},parse(i,e,t){return fe(this,null,function*(){var n;let r=new ua(i,(n=e==null?void 0:e.data)==null?void 0:n.resourceOptions);yield r.load();let s=new Ae(r,Ne({resolution:se.getResolutionOfUrl(i)},e==null?void 0:e.data));return s.resource.src=e.src,Ts(s,t,e.src)})},load(i,e){return fe(this,null,function*(){return(yield te.ADAPTER.fetch(i)).text()})},unload:wo.unload};ne.add(Ep);var MO=[".mp4",".m4v",".webm",".ogv"],PO=["video/mp4","video/webm","video/ogg"],Ap={name:"loadVideo",extension:{type:ee.LoadParser,priority:si.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test(i){return $r(i,PO)||$i(i,MO)},load(i,e,t){return fe(this,null,function*(){var o;let r,s=yield(yield te.ADAPTER.fetch(i)).blob(),n=URL.createObjectURL(s);try{let a=Si(Ne({autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline},(o=e==null?void 0:e.data)==null?void 0:o.resourceOptions),{autoLoad:!0}),l=new S4(n,a);yield l.load();let c=new Ae(l,Ne({alphaMode:yield se.detectVideoAlphaMode(),resolution:se.getResolutionOfUrl(i)},e==null?void 0:e.data));c.resource.src=i,r=Ts(c,t,i),r.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(n)})}catch(a){throw URL.revokeObjectURL(n),a}return r})},unload(i){i.destroy(!0)}};ne.add(Ap);var fd=class{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){var t,r,s;if(this._bundleIdConnector=(t=e.connector)!=null?t:this._bundleIdConnector,this._createBundleAssetId=(r=e.createBundleAssetId)!=null?r:this._createBundleAssetId,this._extractAssetIdFromBundle=(s=e.extractAssetIdFromBundle)!=null?s:this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{let t=e;this._defaultSearchParams=Object.keys(t).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(t[r])}`).join("&")}}getAlias(e){let{alias:t,name:r,src:s,srcs:n}=e;return Yi(t||r||s||n,o=>{var a;return typeof o=="string"?o:Array.isArray(o)?o.map(l=>{var c,u;return(u=(c=l==null?void 0:l.src)!=null?c:l==null?void 0:l.srcs)!=null?u:l}):o!=null&&o.src||o!=null&&o.srcs?(a=o.src)!=null?a:o.srcs:o},!0)}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(t=>{this.addBundle(t.name,t.assets)})}addBundle(e,t){let r=[];Array.isArray(t)?t.forEach(s=>{var l,c;let n=(l=s.src)!=null?l:s.srcs,o=(c=s.alias)!=null?c:s.name,a;if(typeof o=="string"){let u=this._createBundleAssetId(e,o);r.push(u),a=[o,u]}else{let u=o.map(h=>this._createBundleAssetId(e,h));r.push(...u),a=[...o,...u]}this.add(Si(Ne({},s),{alias:a,src:n}))}):Object.keys(t).forEach(s=>{var o;let n=[s,this._createBundleAssetId(e,s)];if(typeof t[s]=="string")this.add({alias:n,src:t[s]});else if(Array.isArray(t[s]))this.add({alias:n,src:t[s]});else{let a=t[s],l=(o=a.src)!=null?o:a.srcs;this.add(Si(Ne({},a),{alias:n,src:Array.isArray(l)?l:[l]}))}r.push(...n)}),this._bundles[e]=r}add(e,t,r,s,n){let o=[];typeof e=="string"||Array.isArray(e)&&typeof e[0]=="string"?(se.deprecation("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),o.push({alias:e,src:t,data:r,format:s,loadParser:n})):Array.isArray(e)?o.push(...e):o.push(e);let a;a=l=>{this.hasKey(l)&&console.warn(`[Resolver] already has key: ${l} overwriting`)},Yi(o).forEach(l=>{let{src:c,srcs:u}=l,{data:h,format:d,loadParser:f}=l,p=Yi(c||u).map(y=>typeof y=="string"?hd(y):Array.isArray(y)?y:[y]),m=this.getAlias(l);Array.isArray(m)?m.forEach(a):a(m);let g=[];p.forEach(y=>{y.forEach(x=>{var _,w,A;let b={};if(typeof x!="object"){b.src=x;for(let k=0;k<this._parsers.length;k++){let v=this._parsers[k];if(v.test(x)){b=v.parse(x);break}}}else h=(_=x.data)!=null?_:h,d=(w=x.format)!=null?w:d,f=(A=x.loadParser)!=null?A:f,b=Ne(Ne({},b),x);if(!m)throw new Error(`[Resolver] alias is undefined for this asset: ${b.src}`);b=this.buildResolvedAsset(b,{aliases:m,data:h,format:d,loadParser:f}),g.push(b)})}),m.forEach(y=>{this._assetMap[y]=g})})}resolveBundle(e){let t=bo(e);e=Yi(e);let r={};return e.forEach(s=>{let n=this._bundles[s];if(n){let o=this.resolve(n),a={};for(let l in o){let c=o[l];a[this._extractAssetIdFromBundle(s,l)]=c}r[s]=a}}),t?r[e[0]]:r}resolveUrl(e){let t=this.resolve(e);if(typeof e!="string"){let r={};for(let s in t)r[s]=t[s].src;return r}return t.src}resolve(e){let t=bo(e);e=Yi(e);let r={};return e.forEach(s=>{var n;if(!this._resolverHash[s])if(this._assetMap[s]){let o=this._assetMap[s],a=o[0],l=this._getPreferredOrder(o);l==null||l.priority.forEach(c=>{l.params[c].forEach(u=>{let h=o.filter(d=>d[c]?d[c]===u:!1);h.length&&(o=h)})}),this._resolverHash[s]=(n=o[0])!=null?n:a}else this._resolverHash[s]=this.buildResolvedAsset({alias:[s],src:s},{});r[s]=this._resolverHash[s]}),t?r[e[0]]:r}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){let r=e[0],s=this._preferredOrder.find(n=>n.params.format.includes(r.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;let t=/\?/.test(e)?"&":"?";return`${e}${t}${this._defaultSearchParams}`}buildResolvedAsset(e,t){var a;let{aliases:r,data:s,loadParser:n,format:o}=t;return(this._basePath||this._rootPath)&&(e.src=se.path.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=(a=r!=null?r:e.alias)!=null?a:[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data=Ne(Ne({},s||{}),e.data),e.loadParser=n!=null?n:e.loadParser,e.format=o!=null?o:se.path.extname(e.src).slice(1),e.srcs=e.src,e.name=e.alias,e}};var pd=class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new fd,this.loader=new dd,this.cache=rn,this._backgroundLoader=new ud(this.loader),this._backgroundLoader.active=!0,this.reset()}init(){return fe(this,arguments,function*(e={}){var n,o,a;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let l=e.manifest;typeof l=="string"&&(l=yield this.load(l)),this.resolver.addManifest(l)}let t=(o=(n=e.texturePreference)==null?void 0:n.resolution)!=null?o:1,r=typeof t=="number"?[t]:t,s=yield this._detectFormats({preferredFormats:(a=e.texturePreference)==null?void 0:a.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:s,resolution:r}}),e.preferences&&this.setPreferences(e.preferences)})}add(e,t,r,s,n){this.resolver.add(e,t,r,s,n)}load(e,t){return fe(this,null,function*(){this._initialized||(yield this.init());let r=bo(e),s=Yi(e).map(a=>{if(typeof a!="string"){let l=this.resolver.getAlias(a);return l.some(c=>!this.resolver.hasKey(c))&&this.add(a),Array.isArray(l)?l[0]:l}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),n=this.resolver.resolve(s),o=yield this._mapLoadToResolve(n,t);return r?o[s[0]]:o})}addBundle(e,t){this.resolver.addBundle(e,t)}loadBundle(e,t){return fe(this,null,function*(){this._initialized||(yield this.init());let r=!1;typeof e=="string"&&(r=!0,e=[e]);let s=this.resolver.resolveBundle(e),n={},o=Object.keys(s),a=0,l=0,c=()=>{t==null||t(++a/l)},u=o.map(h=>{let d=s[h];return l+=Object.keys(d).length,this._mapLoadToResolve(d,c).then(f=>{n[h]=f})});return yield Promise.all(u),r?n[e[0]]:n})}backgroundLoad(e){return fe(this,null,function*(){this._initialized||(yield this.init()),typeof e=="string"&&(e=[e]);let t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))})}backgroundLoadBundle(e){return fe(this,null,function*(){this._initialized||(yield this.init()),typeof e=="string"&&(e=[e]);let t=this.resolver.resolveBundle(e);Object.values(t).forEach(r=>{this._backgroundLoader.add(Object.values(r))})})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return rn.get(e);let t={};for(let r=0;r<e.length;r++)t[r]=rn.get(e[r]);return t}_mapLoadToResolve(e,t){return fe(this,null,function*(){let r=Object.values(e),s=Object.keys(e);this._backgroundLoader.active=!1;let n=yield this.loader.load(r,t);this._backgroundLoader.active=!0;let o={};return r.forEach((a,l)=>{let c=n[a.src],u=[a.src];a.alias&&u.push(...a.alias),o[s[l]]=c,rn.set(u,c)}),o})}unload(e){return fe(this,null,function*(){this._initialized||(yield this.init());let t=Yi(e).map(s=>typeof s!="string"?s.src:s),r=this.resolver.resolve(t);yield this._unloadFromResolved(r)})}unloadBundle(e){return fe(this,null,function*(){this._initialized||(yield this.init()),e=Yi(e);let t=this.resolver.resolveBundle(e),r=Object.keys(t).map(s=>this._unloadFromResolved(t[s]));yield Promise.all(r)})}_unloadFromResolved(e){return fe(this,null,function*(){let t=Object.values(e);t.forEach(r=>{rn.remove(r.src)}),yield this.loader.unload(t)})}_detectFormats(e){return fe(this,null,function*(){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(let r of e.detections)e.skipDetections||(yield r.test())?t=yield r.add(t):e.skipDetections||(t=yield r.remove(t));return t=t.filter((r,s)=>t.indexOf(r)===s),t})}get detections(){return this._detections}get preferWorkers(){return wo.config.preferWorkers}set preferWorkers(e){se.deprecation("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(r=>r in e).forEach(r=>{t.config[r]=e[r]})})}},ha=new pd;ne.handleByList(ee.LoadParser,ha.loader.parsers).handleByList(ee.ResolveParser,ha.resolver.parsers).handleByList(ee.CacheParser,ha.cache.parsers).handleByList(ee.DetectionParser,ha.detections);var Sp={extension:ee.CacheParser,test:i=>Array.isArray(i)&&i.every(e=>e instanceof xe),getCacheableAssets:(i,e)=>{let t={};return i.forEach(r=>{e.forEach((s,n)=>{t[r+(n===0?"":n+1)]=s})}),t}};ne.add(Sp);function md(i){return fe(this,null,function*(){if("Image"in globalThis)return new Promise(e=>{let t=new Image;t.onload=()=>{e(!0)},t.onerror=()=>{e(!1)},t.src=i});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{let e=yield(yield fetch(i)).blob();yield createImageBitmap(e)}catch(e){return!1}return!0}return!1})}var Cp={extension:{type:ee.DetectionParser,priority:1},test:()=>fe(void 0,null,function*(){return md("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=")}),add:i=>fe(void 0,null,function*(){return[...i,"avif"]}),remove:i=>fe(void 0,null,function*(){return i.filter(e=>e!=="avif")})};ne.add(Cp);var kp={extension:{type:ee.DetectionParser,priority:0},test:()=>fe(void 0,null,function*(){return md("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=")}),add:i=>fe(void 0,null,function*(){return[...i,"webp"]}),remove:i=>fe(void 0,null,function*(){return i.filter(e=>e!=="webp")})};ne.add(kp);var dS=["png","jpg","jpeg"],Tp={extension:{type:ee.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:i=>fe(void 0,null,function*(){return[...i,...dS]}),remove:i=>fe(void 0,null,function*(){return i.filter(e=>!dS.includes(e))})};ne.add(Tp);var DO="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function wc(i){return DO?!1:document.createElement("video").canPlayType(i)!==""}var Ip={extension:{type:ee.DetectionParser,priority:0},test:()=>fe(void 0,null,function*(){return wc("video/webm")}),add:i=>fe(void 0,null,function*(){return[...i,"webm"]}),remove:i=>fe(void 0,null,function*(){return i.filter(e=>e!=="webm")})};ne.add(Ip);var Mp={extension:{type:ee.DetectionParser,priority:0},test:()=>fe(void 0,null,function*(){return wc("video/mp4")}),add:i=>fe(void 0,null,function*(){return[...i,"mp4","m4v"]}),remove:i=>fe(void 0,null,function*(){return i.filter(e=>e!=="mp4"&&e!=="m4v")})};ne.add(Mp);var Pp={extension:{type:ee.DetectionParser,priority:0},test:()=>fe(void 0,null,function*(){return wc("video/ogg")}),add:i=>fe(void 0,null,function*(){return[...i,"ogv"]}),remove:i=>fe(void 0,null,function*(){return i.filter(e=>e!=="ogv")})};ne.add(Pp);var Dp={extension:ee.ResolveParser,test:wo.test,parse:i=>{var e,t;return{resolution:parseFloat((t=(e=te.RETINA_PREFIX.exec(i))==null?void 0:e[1])!=null?t:"1"),format:se.path.extname(i).slice(1),src:i}}};ne.add(Dp);var Mi=(i=>(i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i[i.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",i[i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",i[i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",i[i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",i))(Mi||{}),da={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};var Dn,Ec;function fS(){Ec={s3tc:Dn.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Dn.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Dn.getExtension("WEBGL_compressed_texture_etc"),etc1:Dn.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Dn.getExtension("WEBGL_compressed_texture_pvrtc")||Dn.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Dn.getExtension("WEBGL_compressed_texture_atc"),astc:Dn.getExtension("WEBGL_compressed_texture_astc"),bptc:Dn.getExtension("EXT_texture_compression_bptc")}}var Rp={extension:{type:ee.DetectionParser,priority:2},test:()=>fe(void 0,null,function*(){let i=te.ADAPTER.createCanvas().getContext("webgl");return i?(Dn=i,!0):(console.warn("WebGL not available for compressed textures."),!1)}),add:i=>fe(void 0,null,function*(){Ec||fS();let e=[];for(let t in Ec)Ec[t]&&e.push(t);return[...e,...i]}),remove:i=>fe(void 0,null,function*(){return Ec||fS(),i.filter(e=>!(e in Ec))})};ne.add(Rp);var Ac=class extends Ys{constructor(e,t={width:1,height:1,autoLoad:!0}){let r,s;typeof e=="string"?(r=e,s=new Uint8Array):(r=null,s=e),super(s,t),this.origin=r,this.buffer=s?new ia(s):null,this._load=null,this.loaded=!1,this.origin!==null&&t.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>(this.data=new Uint32Array(e),this.buffer=new ia(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),this)),this._load)}};var Eo=class i extends Ac{constructor(e,t){super(e,t),this.format=t.format,this.levels=t.levels||1,this._width=t.width,this._height=t.height,this._extension=i._formatToExtension(this.format),(t.levelBuffers||this.buffer)&&(this._levelBuffers=t.levelBuffers||i._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,t,r){let s=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;s.pixelStorei(s.UNPACK_ALIGNMENT,4);for(let n=0,o=this.levels;n<o;n++){let{levelID:a,levelWidth:l,levelHeight:c,levelBuffer:u}=this._levelBuffers[n];s.compressedTexImage2D(s.TEXTURE_2D,a,this.format,l,c,0,u)}return!0}onBlobLoaded(){this._levelBuffers=i._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=35916&&e<=35919)return"s3tc_sRGB";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(e===36196)return"etc1";if(e===35986||e===35987||e===34798)return"atc";if(e>=36492&&e<=36495)return"bptc";if(e===37808)return"astc";throw new Error(`Invalid (compressed) texture format given: ${e}`)}static _createLevelBuffers(e,t,r,s,n,o,a){let l=new Array(r),c=e.byteOffset,u=o,h=a,d=u+s-1&~(s-1),f=h+n-1&~(n-1),p=d*f*da[t];for(let m=0;m<r;m++)l[m]={levelID:m,levelWidth:r>1?u:d,levelHeight:r>1?h:f,levelBuffer:new Uint8Array(e.buffer,c,p)},c+=p,u=u>>1||1,h=h>>1||1,d=u+s-1&~(s-1),f=h+n-1&~(n-1),p=d*f*da[t];return l}};var Np=4,gd=124,RO=32,pS=20,NO=542327876,yd={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},FO={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},xd={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},LO=1,OO=2,BO=4,UO=64,$O=512,HO=131072,GO=827611204,zO=861165636,jO=894720068,VO=808540228,WO=4,XO={[GO]:Mi.COMPRESSED_RGBA_S3TC_DXT1_EXT,[zO]:Mi.COMPRESSED_RGBA_S3TC_DXT3_EXT,[jO]:Mi.COMPRESSED_RGBA_S3TC_DXT5_EXT},qO={70:Mi.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Mi.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Mi.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Mi.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Mi.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Mi.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Mi.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Mi.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Mi.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:Mi.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:Mi.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:Mi.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:Mi.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function vd(i){let e=new Uint32Array(i);if(e[0]!==NO)throw new Error("Invalid DDS file magic word");let t=new Uint32Array(i,0,gd/Uint32Array.BYTES_PER_ELEMENT),r=t[yd.HEIGHT],s=t[yd.WIDTH],n=t[yd.MIPMAP_COUNT],o=new Uint32Array(i,yd.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,RO/Uint32Array.BYTES_PER_ELEMENT),a=o[LO];if(a&BO){let l=o[FO.FOURCC];if(l!==VO){let x=XO[l],b=Np+gd,_=new Uint8Array(i,b);return[new Eo(_,{format:x,width:s,height:r,levels:n})]}let c=Np+gd,u=new Uint32Array(e.buffer,c,pS/Uint32Array.BYTES_PER_ELEMENT),h=u[xd.DXGI_FORMAT],d=u[xd.RESOURCE_DIMENSION],f=u[xd.MISC_FLAG],p=u[xd.ARRAY_SIZE],m=qO[h];if(m===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${h}`);if(f===WO)throw new Error("DDSParser does not support cubemap textures");if(d===6)throw new Error("DDSParser does not supported 3D texture data");let g=new Array,y=Np+gd+pS;if(p===1)g.push(new Uint8Array(i,y));else{let x=da[m],b=0,_=s,w=r;for(let k=0;k<n;k++){let v=Math.max(1,_+3&-4),E=Math.max(1,w+3&-4),S=v*E*x;b+=S,_=_>>>1,w=w>>>1}let A=y;for(let k=0;k<p;k++)g.push(new Uint8Array(i,A,b)),A+=b}return g.map(x=>new Eo(x,{format:m,width:s,height:r,levels:n}))}throw a&UO?new Error("DDSParser does not support uncompressed texture data."):a&$O?new Error("DDSParser does not supported YUV uncompressed texture data."):a&HO?new Error("DDSParser does not support single-channel (lumninance) texture data!"):a&OO?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}var mS=[171,75,84,88,32,49,49,187,13,10,26,10],QO=67305985,sn={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Fp=64,_d={[Se.UNSIGNED_BYTE]:1,[Se.UNSIGNED_SHORT]:2,[Se.INT]:4,[Se.UNSIGNED_INT]:4,[Se.FLOAT]:4,[Se.HALF_FLOAT]:8},Lp={[le.RGBA]:4,[le.RGB]:3,[le.RG]:2,[le.RED]:1,[le.LUMINANCE]:1,[le.LUMINANCE_ALPHA]:2,[le.ALPHA]:1},Op={[Se.UNSIGNED_SHORT_4_4_4_4]:2,[Se.UNSIGNED_SHORT_5_5_5_1]:2,[Se.UNSIGNED_SHORT_5_6_5]:2};function bd(i,e,t=!1){let r=new DataView(e);if(!YO(i,r))return null;let s=r.getUint32(sn.ENDIANNESS,!0)===QO,n=r.getUint32(sn.GL_TYPE,s),o=r.getUint32(sn.GL_FORMAT,s),a=r.getUint32(sn.GL_INTERNAL_FORMAT,s),l=r.getUint32(sn.PIXEL_WIDTH,s),c=r.getUint32(sn.PIXEL_HEIGHT,s)||1,u=r.getUint32(sn.PIXEL_DEPTH,s)||1,h=r.getUint32(sn.NUMBER_OF_ARRAY_ELEMENTS,s)||1,d=r.getUint32(sn.NUMBER_OF_FACES,s),f=r.getUint32(sn.NUMBER_OF_MIPMAP_LEVELS,s),p=r.getUint32(sn.BYTES_OF_KEY_VALUE_DATA,s);if(c===0||u!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(h!==1)throw new Error("WebGL does not support array textures");let m=4,g=4,y=l+3&-4,x=c+3&-4,b=new Array(h),_=l*c;n===0&&(_=y*x);let w;if(n!==0?_d[n]?w=_d[n]*Lp[o]:w=Op[n]:w=da[a],w===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");let A=t?ZO(r,p,s):null,k=_*w,v=l,E=c,S=y,M=x,I=Fp+p;for(let T=0;T<f;T++){let C=r.getUint32(I,s),P=I+4;for(let D=0;D<h;D++){let O=b[D];O||(O=b[D]=new Array(f)),O[T]={levelID:T,levelWidth:f>1||n!==0?v:S,levelHeight:f>1||n!==0?E:M,levelBuffer:new Uint8Array(e,P,k)},P+=k}I+=C+4,I=I%4!==0?I+4-I%4:I,v=v>>1||1,E=E>>1||1,S=v+m-1&~(m-1),M=E+g-1&~(g-1),k=S*M*w}return n!==0?{uncompressed:b.map(T=>{let C=T[0].levelBuffer,P=!1;return n===Se.FLOAT?C=new Float32Array(T[0].levelBuffer.buffer,T[0].levelBuffer.byteOffset,T[0].levelBuffer.byteLength/4):n===Se.UNSIGNED_INT?(P=!0,C=new Uint32Array(T[0].levelBuffer.buffer,T[0].levelBuffer.byteOffset,T[0].levelBuffer.byteLength/4)):n===Se.INT&&(P=!0,C=new Int32Array(T[0].levelBuffer.buffer,T[0].levelBuffer.byteOffset,T[0].levelBuffer.byteLength/4)),{resource:new Ys(C,{width:T[0].levelWidth,height:T[0].levelHeight}),type:n,format:P?KO(o):o}}),kvData:A}:{compressed:b.map(T=>new Eo(null,{format:a,width:l,height:c,levels:f,levelBuffers:T})),kvData:A}}function YO(i,e){for(let t=0;t<mS.length;t++)if(e.getUint8(t)!==mS[t])return console.error(`${i} is not a valid *.ktx file!`),!1;return!0}function KO(i){switch(i){case le.RGBA:return le.RGBA_INTEGER;case le.RGB:return le.RGB_INTEGER;case le.RG:return le.RG_INTEGER;case le.RED:return le.RED_INTEGER;default:return i}}function ZO(i,e,t){let r=new Map,s=0;for(;s<e;){let n=i.getUint32(Fp+s,t),o=Fp+s+4,a=3-(n+3)%4;if(n===0||n>e-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<n&&i.getUint8(o+l)!==0;l++);if(l===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}let c=new TextDecoder().decode(new Uint8Array(i.buffer,o,l)),u=new DataView(i.buffer,o+l+1,n-l-1);r.set(c,u),s+=4+n+a}return r}var Bp={extension:{type:ee.LoadParser,priority:si.High},name:"loadDDS",test(i){return $i(i,".dds")},load(i,e,t){return fe(this,null,function*(){let r=yield(yield te.ADAPTER.fetch(i)).arrayBuffer(),s=vd(r).map(n=>{let o=new Ae(n,Ne({mipmap:bi.OFF,alphaMode:jt.NO_PREMULTIPLIED_ALPHA,resolution:se.getResolutionOfUrl(i)},e.data));return Ts(o,t,i)});return s.length===1?s[0]:s})},unload(i){Array.isArray(i)?i.forEach(e=>e.destroy(!0)):i.destroy(!0)}};ne.add(Bp);var Up={extension:{type:ee.LoadParser,priority:si.High},name:"loadKTX",test(i){return $i(i,".ktx")},load(i,e,t){return fe(this,null,function*(){let r=yield(yield te.ADAPTER.fetch(i)).arrayBuffer(),{compressed:s,uncompressed:n,kvData:o}=bd(i,r),a=s!=null?s:n,l=Ne({mipmap:bi.OFF,alphaMode:jt.NO_PREMULTIPLIED_ALPHA,resolution:se.getResolutionOfUrl(i)},e.data),c=a.map(u=>{var f;a===n&&Object.assign(l,{type:u.type,format:u.format});let h=(f=u.resource)!=null?f:u,d=new Ae(h,l);return d.ktxKeyValueData=o,Ts(d,t,i)});return c.length===1?c[0]:c})},unload(i){Array.isArray(i)?i.forEach(e=>e.destroy(!0)):i.destroy(!0)}};ne.add(Up);var $p={extension:ee.ResolveParser,test:i=>{let e=se.path.extname(i).slice(1);return["basis","ktx","dds"].includes(e)},parse:i=>{var t,r,s,n;let e=se.path.extname(i).slice(1);if(e==="ktx"){let o=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx",".bptc.ktx"];if(o.some(a=>i.endsWith(a)))return{resolution:parseFloat((r=(t=te.RETINA_PREFIX.exec(i))==null?void 0:t[1])!=null?r:"1"),format:o.find(a=>i.endsWith(a)),src:i}}return{resolution:parseFloat((n=(s=te.RETINA_PREFIX.exec(i))==null?void 0:s[1])!=null?n:"1"),format:e,src:i}}};ne.add($p);var wd=new ve,JO=4,gS=class O4{constructor(e){this.renderer=e,this._rendererPremultipliedAlpha=!1}contextChange(){var t;let e=(t=this.renderer)==null?void 0:t.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}image(e,t,r,s){return fe(this,null,function*(){let n=new Image;return n.src=yield this.base64(e,t,r,s),n})}base64(e,t,r,s){return fe(this,null,function*(){let n=this.canvas(e,s);if(n.toBlob!==void 0)return new Promise((o,a)=>{n.toBlob(l=>{if(!l){a(new Error("ICanvas.toBlob failed!"));return}let c=new FileReader;c.onload=()=>o(c.result),c.onerror=a,c.readAsDataURL(l)},t,r)});if(n.toDataURL!==void 0)return n.toDataURL(t,r);if(n.convertToBlob!==void 0){let o=yield n.convertToBlob({type:t,quality:r});return new Promise((a,l)=>{let c=new FileReader;c.onload=()=>a(c.result),c.onerror=l,c.readAsDataURL(o)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")})}canvas(e,t){let{pixels:r,width:s,height:n,flipY:o,premultipliedAlpha:a}=this._rawPixels(e,t);o&&O4._flipY(r,s,n),a&&O4._unpremultiplyAlpha(r);let l=new se.CanvasRenderTarget(s,n,1),c=new ImageData(new Uint8ClampedArray(r.buffer),s,n);return l.context.putImageData(c,0,0),l.canvas}pixels(e,t){let{pixels:r,width:s,height:n,flipY:o,premultipliedAlpha:a}=this._rawPixels(e,t);return o&&O4._flipY(r,s,n),a&&O4._unpremultiplyAlpha(r),r}_rawPixels(e,t){let r=this.renderer;if(!r)throw new Error("The Extract has already been destroyed");let s,n=!1,o=!1,a,l=!1;e&&(e instanceof ts?a=e:(a=r.generateTexture(e,{region:t,resolution:r.resolution,multisample:r.multisample}),l=!0,t&&(wd.width=t.width,wd.height=t.height,t=wd)));let c=r.gl;if(a){if(s=a.baseTexture.resolution,t=t!=null?t:a.frame,n=!1,o=a.baseTexture.alphaMode>0&&a.baseTexture.format===le.RGBA,!l){r.renderTexture.bind(a);let f=a.framebuffer.glFramebuffers[r.CONTEXT_UID];f.blitFramebuffer&&r.framebuffer.bind(f.blitFramebuffer)}}else s=r.resolution,t||(t=wd,t.width=r.width/s,t.height=r.height/s),n=!0,o=this._rendererPremultipliedAlpha,r.renderTexture.bind();let u=Math.max(Math.round(t.width*s),1),h=Math.max(Math.round(t.height*s),1),d=new Uint8Array(JO*u*h);return c.readPixels(Math.round(t.x*s),Math.round(t.y*s),u,h,c.RGBA,c.UNSIGNED_BYTE,d),l&&(a==null||a.destroy(!0)),{pixels:d,width:u,height:h,flipY:n,premultipliedAlpha:o}}destroy(){this.renderer=null}static _flipY(e,t,r){let s=t<<2,n=r>>1,o=new Uint8Array(s);for(let a=0;a<n;a++){let l=a*s,c=(r-a-1)*s;o.set(e.subarray(l,l+s)),e.copyWithin(l,c,c+s),e.set(o,c)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));let t=e.length;for(let r=0;r<t;r+=4){let s=e[r+3];if(s!==0){let n=255.001/s;e[r]=e[r]*n+.5,e[r+1]=e[r+1]*n+.5,e[r+2]=e[r+2]*n+.5}}}};gS.extension={name:"extract",type:ee.RendererSystem};var yS=gS;ne.add(yS);var fa={build(i){let e=i.points,t,r,s,n,o,a;if(i.type===Lt.CIRC){let p=i.shape;t=p.x,r=p.y,o=a=p.radius,s=n=0}else if(i.type===Lt.ELIP){let p=i.shape;t=p.x,r=p.y,o=p.width,a=p.height,s=n=0}else{let p=i.shape,m=p.width/2,g=p.height/2;t=p.x+m,r=p.y+g,o=a=Math.max(0,Math.min(p.radius,Math.min(m,g))),s=m-o,n=g-a}if(!(o>=0&&a>=0&&s>=0&&n>=0)){e.length=0;return}let l=Math.ceil(2.3*Math.sqrt(o+a)),c=l*8+(s?4:0)+(n?4:0);if(e.length=c,c===0)return;if(l===0){e.length=8,e[0]=e[6]=t+s,e[1]=e[3]=r+n,e[2]=e[4]=t-s,e[5]=e[7]=r-n;return}let u=0,h=l*4+(s?2:0)+2,d=h,f=c;{let p=s+o,m=n,g=t+p,y=t-p,x=r+m;if(e[u++]=g,e[u++]=x,e[--h]=x,e[--h]=y,n){let b=r-m;e[d++]=y,e[d++]=b,e[--f]=b,e[--f]=g}}for(let p=1;p<l;p++){let m=Math.PI/2*(p/l),g=s+Math.cos(m)*o,y=n+Math.sin(m)*a,x=t+g,b=t-g,_=r+y,w=r-y;e[u++]=x,e[u++]=_,e[--h]=_,e[--h]=b,e[d++]=b,e[d++]=w,e[--f]=w,e[--f]=x}{let p=s,m=n+a,g=t+p,y=t-p,x=r+m,b=r-m;e[u++]=g,e[u++]=x,e[--f]=b,e[--f]=g,s&&(e[u++]=y,e[u++]=x,e[--f]=b,e[--f]=y)}},triangulate(i,e){let t=i.points,r=e.points,s=e.indices;if(t.length===0)return;let n=r.length/2,o=n,a,l;if(i.type!==Lt.RREC){let u=i.shape;a=u.x,l=u.y}else{let u=i.shape;a=u.x+u.width/2,l=u.y+u.height/2}let c=i.matrix;r.push(i.matrix?c.a*a+c.c*l+c.tx:a,i.matrix?c.b*a+c.d*l+c.ty:l),n++,r.push(t[0],t[1]);for(let u=2;u<t.length;u+=2)r.push(t[u],t[u+1]),s.push(n++,o,n);s.push(o+1,o,n)}};function xS(i,e=!1){let t=i.length;if(t<6)return;let r=0;for(let s=0,n=i[t-2],o=i[t-1];s<t;s+=2){let a=i[s],l=i[s+1];r+=(a-n)*(l+o),n=a,o=l}if(!e&&r>0||e&&r<=0){let s=t/2;for(let n=s+s%2;n<t;n+=2){let o=t-n-2,a=t-n-1,l=n,c=n+1;[i[o],i[l]]=[i[l],i[o]],[i[a],i[c]]=[i[c],i[a]]}}}var Sc={build(i){i.points=i.shape.points.slice()},triangulate(i,e){let t=i.points,r=i.holes,s=e.points,n=e.indices;if(t.length>=6){xS(t,!1);let o=[];for(let c=0;c<r.length;c++){let u=r[c];xS(u.points,!0),o.push(t.length/2),t=t.concat(u.points)}let a=se.earcut(t,o,2);if(!a)return;let l=s.length/2;for(let c=0;c<a.length;c+=3)n.push(a[c]+l),n.push(a[c+1]+l),n.push(a[c+2]+l);for(let c=0;c<t.length;c++)s.push(t[c])}}};var Ed={build(i){let e=i.shape,t=e.x,r=e.y,s=e.width,n=e.height,o=i.points;o.length=0,s>=0&&n>=0&&o.push(t,r,t+s,r,t+s,r+n,t,r+n)},triangulate(i,e){let t=i.points,r=e.points;if(t.length===0)return;let s=r.length/2;r.push(t[0],t[1],t[2],t[3],t[6],t[7],t[4],t[5]),e.indices.push(s,s+1,s+2,s+1,s+2,s+3)}};var Ad={build(i){fa.build(i)},triangulate(i,e){fa.triangulate(i,e)}};var Ot=(i=>(i.MITER="miter",i.BEVEL="bevel",i.ROUND="round",i))(Ot||{}),Bt=(i=>(i.BUTT="butt",i.ROUND="round",i.SQUARE="square",i))(Bt||{}),Is={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(i,e=20){if(!this.adaptive||!i||isNaN(i))return e;let t=Math.ceil(i/this.maxLength);return t<this.minSegments?t=this.minSegments:t>this.maxSegments&&(t=this.maxSegments),t}};var pa=class{static curveTo(e,t,r,s,n,o){let a=o[o.length-2],l=o[o.length-1]-t,c=a-e,u=s-t,h=r-e,d=Math.abs(l*h-c*u);if(d<1e-8||n===0)return(o[o.length-2]!==e||o[o.length-1]!==t)&&o.push(e,t),null;let f=l*l+c*c,p=u*u+h*h,m=l*u+c*h,g=n*Math.sqrt(f)/d,y=n*Math.sqrt(p)/d,x=g*m/f,b=y*m/p,_=g*h+y*c,w=g*u+y*l,A=c*(y+x),k=l*(y+x),v=h*(g+b),E=u*(g+b),S=Math.atan2(k-w,A-_),M=Math.atan2(E-w,v-_);return{cx:_+e,cy:w+t,radius:n,startAngle:S,endAngle:M,anticlockwise:c*u>h*l}}static arc(e,t,r,s,n,o,a,l,c){let u=a-o,h=Is._segmentsCount(Math.abs(u)*n,Math.ceil(Math.abs(u)/sa)*40),d=u/(h*2),f=d*2,p=Math.cos(d),m=Math.sin(d),g=h-1,y=g%1/g;for(let x=0;x<=g;++x){let b=x+y*x,_=d+o+f*b,w=Math.cos(_),A=-Math.sin(_);c.push((p*w+m*A)*n+r,(p*-A+m*w)*n+s)}}};var cl=class{constructor(){this.reset()}begin(e,t,r){this.reset(),this.style=e,this.start=t,this.attribStart=r}end(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}};var ul=class i{static curveLength(e,t,r,s,n,o,a,l){let c=0,u=0,h=0,d=0,f=0,p=0,m=0,g=0,y=0,x=0,b=0,_=e,w=t;for(let A=1;A<=10;++A)u=A/10,h=u*u,d=h*u,f=1-u,p=f*f,m=p*f,g=m*e+3*p*u*r+3*f*h*n+d*a,y=m*t+3*p*u*s+3*f*h*o+d*l,x=_-g,b=w-y,_=g,w=y,c+=Math.sqrt(x*x+b*b);return c}static curveTo(e,t,r,s,n,o,a){let l=a[a.length-2],c=a[a.length-1];a.length-=2;let u=Is._segmentsCount(i.curveLength(l,c,e,t,r,s,n,o)),h=0,d=0,f=0,p=0,m=0;a.push(l,c);for(let g=1,y=0;g<=u;++g)y=g/u,h=1-y,d=h*h,f=d*h,p=y*y,m=p*y,a.push(f*l+3*d*y*e+3*h*p*r+m*n,f*c+3*d*y*t+3*h*p*s+m*o)}};function vS(i,e,t,r,s,n,o,a){let l=i-t*s,c=e-r*s,u=i+t*n,h=e+r*n,d,f;o?(d=r,f=-t):(d=-r,f=t);let p=l+d,m=c+f,g=u+d,y=h+f;return a.push(p,m,g,y),2}function hl(i,e,t,r,s,n,o,a){let l=t-i,c=r-e,u=Math.atan2(l,c),h=Math.atan2(s-i,n-e);a&&u<h?u+=Math.PI*2:!a&&u>h&&(h+=Math.PI*2);let d=u,f=h-u,p=Math.abs(f),m=Math.sqrt(l*l+c*c),g=(15*p*Math.sqrt(m)/Math.PI>>0)+1,y=f/g;if(d+=y,a){o.push(i,e,t,r);for(let x=1,b=d;x<g;x++,b+=y)o.push(i,e,i+Math.sin(b)*m,e+Math.cos(b)*m);o.push(i,e,s,n)}else{o.push(t,r,i,e);for(let x=1,b=d;x<g;x++,b+=y)o.push(i+Math.sin(b)*m,e+Math.cos(b)*m,i,e);o.push(s,n,i,e)}return g*2}function eB(i,e){let t=i.shape,r=i.points||t.points.slice(),s=e.closePointEps;if(r.length===0)return;let n=i.lineStyle,o=new _e(r[0],r[1]),a=new _e(r[r.length-2],r[r.length-1]),l=t.type!==Lt.POLY||t.closeStroke,c=Math.abs(o.x-a.x)<s&&Math.abs(o.y-a.y)<s;if(l){r=r.slice(),c&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));let O=(o.x+a.x)*.5,R=(a.y+o.y)*.5;r.unshift(O,R),r.push(O,R)}let u=e.points,h=r.length/2,d=r.length,f=u.length/2,p=n.width/2,m=p*p,g=n.miterLimit*n.miterLimit,y=r[0],x=r[1],b=r[2],_=r[3],w=0,A=0,k=-(x-_),v=y-b,E=0,S=0,M=Math.sqrt(k*k+v*v);k/=M,v/=M,k*=p,v*=p;let I=n.alignment,T=(1-I)*2,C=I*2;l||(n.cap===Bt.ROUND?d+=hl(y-k*(T-C)*.5,x-v*(T-C)*.5,y-k*T,x-v*T,y+k*C,x+v*C,u,!0)+2:n.cap===Bt.SQUARE&&(d+=vS(y,x,k,v,T,C,!0,u))),u.push(y-k*T,x-v*T,y+k*C,x+v*C);for(let O=1;O<h-1;++O){y=r[(O-1)*2],x=r[(O-1)*2+1],b=r[O*2],_=r[O*2+1],w=r[(O+1)*2],A=r[(O+1)*2+1],k=-(x-_),v=y-b,M=Math.sqrt(k*k+v*v),k/=M,v/=M,k*=p,v*=p,E=-(_-A),S=b-w,M=Math.sqrt(E*E+S*S),E/=M,S/=M,E*=p,S*=p;let R=b-y,N=x-_,F=b-w,B=A-_,$=R*F+N*B,U=N*F-B*R,H=U<0;if(Math.abs(U)<.001*Math.abs($)){u.push(b-k*T,_-v*T,b+k*C,_+v*C),$>=0&&(n.join===Ot.ROUND?d+=hl(b,_,b-k*T,_-v*T,b-E*T,_-S*T,u,!1)+4:d+=2,u.push(b-E*C,_-S*C,b+E*T,_+S*T));continue}let z=(-k+y)*(-v+_)-(-k+b)*(-v+x),j=(-E+w)*(-S+_)-(-E+b)*(-S+A),X=(R*j-F*z)/U,K=(B*z-N*j)/U,Y=(X-b)*(X-b)+(K-_)*(K-_),oe=b+(X-b)*T,re=_+(K-_)*T,W=b-(X-b)*C,Z=_-(K-_)*C,Q=Math.min(R*R+N*N,F*F+B*B),q=H?T:C,pe=Q+q*q*m,$e=Y<=pe,nt=n.join;if(nt===Ot.MITER&&Y/m>g&&(nt=Ot.BEVEL),$e)switch(nt){case Ot.MITER:{u.push(oe,re,W,Z);break}case Ot.BEVEL:{H?u.push(oe,re,b+k*C,_+v*C,oe,re,b+E*C,_+S*C):u.push(b-k*T,_-v*T,W,Z,b-E*T,_-S*T,W,Z),d+=2;break}case Ot.ROUND:{H?(u.push(oe,re,b+k*C,_+v*C),d+=hl(b,_,b+k*C,_+v*C,b+E*C,_+S*C,u,!0)+4,u.push(oe,re,b+E*C,_+S*C)):(u.push(b-k*T,_-v*T,W,Z),d+=hl(b,_,b-k*T,_-v*T,b-E*T,_-S*T,u,!1)+4,u.push(b-E*T,_-S*T,W,Z));break}}else{switch(u.push(b-k*T,_-v*T,b+k*C,_+v*C),nt){case Ot.MITER:{H?u.push(W,Z,W,Z):u.push(oe,re,oe,re),d+=2;break}case Ot.ROUND:{H?d+=hl(b,_,b+k*C,_+v*C,b+E*C,_+S*C,u,!0)+2:d+=hl(b,_,b-k*T,_-v*T,b-E*T,_-S*T,u,!1)+2;break}}u.push(b-E*T,_-S*T,b+E*C,_+S*C),d+=2}}y=r[(h-2)*2],x=r[(h-2)*2+1],b=r[(h-1)*2],_=r[(h-1)*2+1],k=-(x-_),v=y-b,M=Math.sqrt(k*k+v*v),k/=M,v/=M,k*=p,v*=p,u.push(b-k*T,_-v*T,b+k*C,_+v*C),l||(n.cap===Bt.ROUND?d+=hl(b-k*(T-C)*.5,_-v*(T-C)*.5,b-k*T,_-v*T,b+k*C,_+v*C,u,!1)+2:n.cap===Bt.SQUARE&&(d+=vS(b,_,k,v,T,C,!1,u)));let P=e.indices,D=Is.epsilon*Is.epsilon;for(let O=f;O<d+f-2;++O)y=u[O*2],x=u[O*2+1],b=u[(O+1)*2],_=u[(O+1)*2+1],w=u[(O+2)*2],A=u[(O+2)*2+1],!(Math.abs(y*(_-A)+b*(A-x)+w*(x-_))<D)&&P.push(O,O+1,O+2)}function tB(i,e){let t=0,r=i.shape,s=i.points||r.points,n=r.type!==Lt.POLY||r.closeStroke;if(s.length===0)return;let o=e.points,a=e.indices,l=s.length/2,c=o.length/2,u=c;for(o.push(s[0],s[1]),t=1;t<l;t++)o.push(s[t*2],s[t*2+1]),a.push(u,u+1),u++;n&&a.push(u,c)}function Cc(i,e){i.lineStyle.native?tB(i,e):eB(i,e)}var dl=class i{static curveLength(e,t,r,s,n,o){let a=e-2*r+n,l=t-2*s+o,c=2*r-2*e,u=2*s-2*t,h=4*(a*a+l*l),d=4*(a*c+l*u),f=c*c+u*u,p=2*Math.sqrt(h+d+f),m=Math.sqrt(h),g=2*h*m,y=2*Math.sqrt(f),x=d/m;return(g*p+m*d*(p-y)+(4*f*h-d*d)*Math.log((2*m+x+p)/(x+y)))/(4*g)}static curveTo(e,t,r,s,n){let o=n[n.length-2],a=n[n.length-1],l=Is._segmentsCount(i.curveLength(o,a,e,t,r,s)),c=0,u=0;for(let h=1;h<=l;++h){let d=h/l;c=o+(e-o)*d,u=a+(t-a)*d,n.push(c+(e+(r-e)*d-c)*d,u+(t+(s-t)*d-u)*d)}}};var kc={[Lt.POLY]:Sc,[Lt.CIRC]:fa,[Lt.ELIP]:fa,[Lt.RECT]:Ed,[Lt.RREC]:Ad},B4=[],fl=[];var Tc=class i{constructor(e,t=null,r=null,s=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=r,this.fillStyle=t,this.matrix=s,this.type=e.type}clone(){return new i(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}};var Ic=new _e,_S=class bS extends Ka{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new In,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),fl.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){let t=this.batches[e];t.reset(),B4.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,r=null,s=null){let n=new Tc(e,t,r,s);return this.graphicsData.push(n),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;let r=new Tc(e,null,null,t),s=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=s.lineStyle,s.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){let t=this.graphicsData;for(let r=0;r<t.length;++r){let s=t[r];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(e,Ic):Ic.copyFrom(e),s.shape.contains(Ic.x,Ic.y))){let n=!1;if(s.holes){for(let o=0;o<s.holes.length;o++)if(s.holes[o].shape.contains(Ic.x,Ic.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;let e=this.uvs,t=this.graphicsData,r=null,s=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],s=r.style);for(let l=this.shapeIndex;l<t.length;l++){this.shapeIndex++;let c=t[l],u=c.fillStyle,h=c.lineStyle;kc[c.type].build(c),c.matrix&&this.transformPoints(c.points,c.matrix),(u.visible||h.visible)&&this.processHoles(c.holes);for(let d=0;d<2;d++){let f=d===0?u:h;if(!f.visible)continue;let p=f.texture.baseTexture,m=this.indices.length,g=this.points.length/2;p.wrapMode=Lr.REPEAT,d===0?this.processFill(c):this.processLine(c);let y=this.points.length/2-g;y!==0&&(r&&!this._compareStyles(s,f)&&(r.end(m,g),r=null),r||(r=B4.pop()||new cl,r.begin(f,m,g),this.batches.push(r),s=f),this.addUvs(this.points,e,f.texture,g,y,f.matrix))}}let n=this.indices.length,o=this.points.length/2;if(r&&r.end(n,o),this.batches.length===0){this.batchable=!0;return}let a=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){let r=this.graphicsData[e],s=r.fillStyle,n=r.lineStyle;if(s&&!s.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);let e=this.batches;for(let t=0,r=e.length;t<r;t++){let s=e[t];for(let n=0;n<s.size;n++){let o=s.start+n;this.indicesUint16[o]=this.indicesUint16[o]-s.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;let e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<bS.BATCHABLE_SIZE*2}buildDrawCalls(){let e=++Ae._globalBatch;for(let h=0;h<this.drawCalls.length;h++)this.drawCalls[h].texArray.clear(),fl.push(this.drawCalls[h]);this.drawCalls.length=0;let t=this.colors,r=this.textureIds,s=fl.pop();s||(s=new ra,s.texArray=new na),s.texArray.count=0,s.start=0,s.size=0,s.type=Fr.TRIANGLES;let n=0,o=null,a=0,l=!1,c=Fr.TRIANGLES,u=0;this.drawCalls.push(s);for(let h=0;h<this.batches.length;h++){let d=this.batches[h],f=8,p=d.style,m=p.texture.baseTexture;l!==!!p.native&&(l=!!p.native,c=l?Fr.LINES:Fr.TRIANGLES,o=null,n=f,e++),o!==m&&(o=m,m._batchEnabled!==e&&(n===f&&(e++,n=0,s.size>0&&(s=fl.pop(),s||(s=new ra,s.texArray=new na),this.drawCalls.push(s)),s.start=u,s.size=0,s.texArray.count=0,s.type=c),m.touched=1,m._batchEnabled=e,m._batchLocation=n,m.wrapMode=Lr.REPEAT,s.texArray.elements[s.texArray.count++]=m,n++)),s.size+=d.size,u+=d.size,a=m._batchLocation,this.addColors(t,p.color,p.alpha,d.attribSize,d.attribStart),this.addTextureIds(r,a,d.attribSize,d.attribStart)}Ae._globalBatch=e,this.packAttributes()}packAttributes(){let e=this.points,t=this.uvs,r=this.colors,s=this.textureIds,n=new ArrayBuffer(e.length*3*4),o=new Float32Array(n),a=new Uint32Array(n),l=0;for(let c=0;c<e.length/2;c++)o[l++]=e[c*2],o[l++]=e[c*2+1],o[l++]=t[c*2],o[l++]=t[c*2+1],a[l++]=r[c],o[l++]=s[c];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?Sc.triangulate(e,this):kc[e.type].triangulate(e,this)}processLine(e){Cc(e,this);for(let t=0;t<e.holes.length;t++)Cc(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){let r=e[t];kc[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){let e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let r=0;r<e.length/2;r++){let s=e[r*2],n=e[r*2+1];e[r*2]=t.a*s+t.c*n+t.tx,e[r*2+1]=t.b*s+t.d*n+t.ty}}addColors(e,t,r,s,n=0){let o=we.shared.setValue(t).toLittleEndianNumber(),a=we.shared.setValue(o).toPremultiplied(r);e.length=Math.max(e.length,n+s);for(let l=0;l<s;l++)e[n+l]=a}addTextureIds(e,t,r,s=0){e.length=Math.max(e.length,s+r);for(let n=0;n<r;n++)e[s+n]=t}addUvs(e,t,r,s,n,o=null){let a=0,l=t.length,c=r.frame;for(;a<n;){let h=e[(s+a)*2],d=e[(s+a)*2+1];if(o){let f=o.a*h+o.c*d+o.tx;d=o.b*h+o.d*d+o.ty,h=f}a++,t.push(h/c.width,d/c.height)}let u=r.baseTexture;(c.width<u.width||c.height<u.height)&&this.adjustUvs(t,r,l,n)}adjustUvs(e,t,r,s){let n=t.baseTexture,o=1e-6,a=r+s*2,l=t.frame,c=l.width/n.width,u=l.height/n.height,h=l.x/l.width,d=l.y/l.height,f=Math.floor(e[r]+o),p=Math.floor(e[r+1]+o);for(let m=r+2;m<a;m+=2)f=Math.min(f,Math.floor(e[m]+o)),p=Math.min(p,Math.floor(e[m+1]+o));h-=f,d-=p;for(let m=r;m<a;m+=2)e[m]=(e[m]+h)*c,e[m+1]=(e[m+1]+d)*u}};_S.BATCHABLE_SIZE=100;var Hp=_S;var pl=class i{constructor(){this.color=16777215,this.alpha=1,this.texture=xe.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){let e=new i;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=xe.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}};var U4=class i extends pl{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Bt.BUTT,this.join=Ot.MITER,this.miterLimit=10}clone(){let e=new i;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=Bt.BUTT,this.join=Ot.MITER,this.miterLimit=10}};var Gp={},zp=class Sd extends Qe{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new pl,this._lineStyle=new U4,this._matrix=null,this._holeMode=!1,this.state=Bi.for2d(),this._geometry=e||new Hp,this._geometry.refCount++,this._transformID=-1,this._tintColor=new we(16777215),this.blendMode=Le.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Sd(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,r,s=.5,n=!1){return typeof e=="number"&&(e={width:e,color:t,alpha:r,alignment:s,native:n}),this.lineTextureStyle(e)}lineTextureStyle(e){let t={width:0,texture:xe.WHITE,color:e!=null&&e.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Bt.BUTT,join:Ot.MITER,miterLimit:10};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();let r=e.width>0&&e.alpha>0;return r?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:r},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){let e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new Ui,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new Ui,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);let r=this.currentPath.points,s=r[r.length-2],n=r[r.length-1];return(s!==e||n!==t)&&r.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,r,s){this._initCurve();let n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),dl.curveTo(e,t,r,s,n),this}bezierCurveTo(e,t,r,s,n,o){return this._initCurve(),ul.curveTo(e,t,r,s,n,o,this.currentPath.points),this}arcTo(e,t,r,s,n){this._initCurve(e,t);let o=this.currentPath.points,a=pa.curveTo(e,t,r,s,n,o);if(a){let{cx:l,cy:c,radius:u,startAngle:h,endAngle:d,anticlockwise:f}=a;this.arc(l,c,u,h,d,f)}return this}arc(e,t,r,s,n,o=!1){if(s===n)return this;if(!o&&n<=s?n+=sa:o&&s<=n&&(s+=sa),n-s===0)return this;let a=e+Math.cos(s)*r,l=t+Math.sin(s)*r,c=this._geometry.closePointEps,u=this.currentPath?this.currentPath.points:null;if(u){let h=Math.abs(u[u.length-2]-a),d=Math.abs(u[u.length-1]-l);h<c&&d<c||u.push(a,l)}else this.moveTo(a,l),u=this.currentPath.points;return pa.arc(a,l,e,t,r,s,n,o,u),this}beginFill(e=0,t){return this.beginTextureFill({texture:xe.WHITE,color:e,alpha:t})}normalizeColor(e){var r,s;let t=we.shared.setValue((r=e.color)!=null?r:0);e.color=t.toNumber(),(s=e.alpha)!=null||(e.alpha=t.alpha)}beginTextureFill(e){let t={texture:xe.WHITE,color:16777215,matrix:null};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();let r=e.alpha>0;return r?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:r},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,r,s){return this.drawShape(new ve(e,t,r,s))}drawRoundedRect(e,t,r,s,n){return this.drawShape(new K1(e,t,r,s,n))}drawCircle(e,t,r){return this.drawShape(new fo(e,t,r))}drawEllipse(e,t,r,s){return this.drawShape(new Y1(e,t,r,s))}drawPolygon(...e){let t,r=!0,s=e[0];s.points?(r=s.closeStroke,t=s.points):Array.isArray(e[0])?t=e[0]:t=e;let n=new Ui(t);return n.closeStroke=r,this.drawShape(n),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){let e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===Lt.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();let t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){let e=this._geometry,t=this.blendMode,r=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(e.points);for(let s=0;s<r;s++){let n=e.batches[s],o=n.style.color,a=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),l=new Float32Array(e.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),c=new Uint16Array(e.indicesUint16.buffer,n.start*2,n.size),u={vertexData:a,blendMode:t,indices:c,uvs:l,_batchRGB:we.shared.setValue(o).toRgbArray(),_tintRGB:o,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[s]=u}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,r=this.batches.length;t<r;t++){let s=this.batches[t];s.worldAlpha=this.worldAlpha*s.alpha,e.plugins[this.pluginName].render(s)}}}_renderDirect(e){let t=this._resolveDirectShader(e),r=this._geometry,s=this.worldAlpha,n=t.uniforms,o=r.drawCalls;n.translationMatrix=this.transform.worldTransform,we.shared.setValue(this._tintColor).premultiply(s).toArray(n.tint),e.shader.bind(t),e.geometry.bind(r,t),e.state.set(this.state);for(let a=0,l=o.length;a<l;a++)this._renderDrawCallDirect(e,r.drawCalls[a])}_renderDrawCallDirect(e,t){let{texArray:r,type:s,size:n,start:o}=t,a=r.count;for(let l=0;l<a;l++)e.texture.bind(r.elements[l],l);e.geometry.draw(s,n,o)}_resolveDirectShader(e){let t=this.shader,r=this.pluginName;if(!t){if(!Gp[r]){let{maxTextures:s}=e.plugins[r],n=new Int32Array(s);for(let l=0;l<s;l++)n[l]=l;let o={tint:new Float32Array([1,1,1,1]),translationMatrix:new rt,default:Cr.from({uSamplers:n},!0)},a=e.plugins[r]._shader.program;Gp[r]=new Qi(a,o)}t=Gp[r]}return t}_calculateBounds(){this.finishPoly();let e=this._geometry;if(!e.graphicsData.length)return;let{minX:t,minY:r,maxX:s,maxY:n}=e.bounds;this._bounds.addFrame(this.transform,t,r,s,n)}containsPoint(e){return this.worldTransform.applyInverse(e,Sd._TEMP_POINT),this._geometry.containsPoint(Sd._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){let t=this.batches[e];t._tintRGB=we.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){let e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;let t=this.transform.worldTransform,r=t.a,s=t.b,n=t.c,o=t.d,a=t.tx,l=t.ty,c=this._geometry.points,u=this.vertexData,h=0;for(let d=0;d<c.length;d+=2){let f=c[d],p=c[d+1];u[h++]=r*f+n*p+a,u[h++]=o*p+s*f+l}}closePath(){let e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};zp.curves=Is,zp._TEMP_POINT=new _e;var qe=zp;var wS={buildPoly:Sc,buildCircle:fa,buildRectangle:Ed,buildRoundedRectangle:Ad,buildLine:Cc,ArcUtils:pa,BezierUtils:ul,QuadraticUtils:dl,BatchPart:cl,FILL_COMMANDS:kc,BATCH_POOL:B4,DRAW_CALL_POOL:fl};var $4=class{constructor(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;let t=this.uvBuffer.data;(!this.data||this.data.length!==t.length)&&(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}};var jp=new _e,ES=new Ui,AS=class SS extends Qe{constructor(e,t,r,s=Fr.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=r||Bi.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=te.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){let t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Fr.TRIANGLES&&t.length<SS.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){let t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){let t=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;let s=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[s]),e.plugins[s].render(this)}calculateVertices(){let e=this.geometry.buffers[0],t=e.data,r=e._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==t.length&&(this.vertexData=new Float32Array(t.length));let s=this.transform.worldTransform,n=s.a,o=s.b,a=s.c,l=s.d,c=s.tx,u=s.ty,h=this.vertexData;for(let d=0;d<h.length/2;d++){let f=t[d*2],p=t[d*2+1];h[d*2]=n*f+a*p+c,h[d*2+1]=o*f+l*p+u}if(this._roundPixels){let d=te.RESOLUTION;for(let f=0;f<h.length;++f)h[f]=Math.round(h[f]*d)/d}this.vertexDirty=r}calculateUvs(){let e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new $4(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,jp);let t=this.geometry.getBuffer("aVertexPosition").data,r=ES.points,s=this.geometry.getIndex().data,n=s.length,o=this.drawMode===4?3:1;for(let a=0;a+2<n;a+=o){let l=s[a]*2,c=s[a+1]*2,u=s[a+2]*2;if(r[0]=t[l],r[1]=t[l+1],r[2]=t[c],r[3]=t[c+1],r[4]=t[u],r[5]=t[u+1],ES.contains(jp.x,jp.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};AS.BATCHABLE_SIZE=100;var Rn=AS;var Ao=class extends Sr{constructor(e,t,r){super();let s=new Pt(e),n=new Pt(t,!0),o=new Pt(r,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,Se.FLOAT).addAttribute("aTextureCoord",n,2,!1,Se.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}};var CS=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`;var kS=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;var Ms=class extends Qi{constructor(e,t){let r={uSampler:e,alpha:1,uTextureMatrix:rt.IDENTITY,uColor:new Float32Array([1,1,1,1])};t=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},t),t.uniforms&&Object.assign(r,t.uniforms),super(t.program||nr.from(kS,CS),r),this._colorDirty=!1,this.uvMatrix=new la(e),this.batchable=t.program===void 0,this.pluginName=t.pluginName,this._tintColor=new we(t.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=t.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this.tint&&(this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;let e=this.texture.baseTexture.alphaMode;we.shared.setValue(this._tintColor).premultiply(this._alpha,e).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}};var H4=class extends Ao{constructor(e=200,t,r=0){super(new Float32Array(t.length*4),new Float32Array(t.length*4),new Uint16Array((t.length-1)*6)),this.points=t,this._width=e,this.textureScale=r,this.build()}get width(){return this._width}build(){let e=this.points;if(!e)return;let t=this.getBuffer("aVertexPosition"),r=this.getBuffer("aTextureCoord"),s=this.getIndex();if(e.length<1)return;t.data.length/4!==e.length&&(t.data=new Float32Array(e.length*4),r.data=new Float32Array(e.length*4),s.data=new Uint16Array((e.length-1)*6));let n=r.data,o=s.data;n[0]=0,n[1]=0,n[2]=0,n[3]=1;let a=0,l=e[0],c=this._width*this.textureScale,u=e.length;for(let d=0;d<u;d++){let f=d*4;if(this.textureScale>0){let p=l.x-e[d].x,m=l.y-e[d].y,g=Math.sqrt(p*p+m*m);l=e[d],a+=g/c}else a=d/(u-1);n[f]=a,n[f+1]=0,n[f+2]=a,n[f+3]=1}let h=0;for(let d=0;d<u-1;d++){let f=d*2;o[h++]=f,o[h++]=f+1,o[h++]=f+2,o[h++]=f+2,o[h++]=f+1,o[h++]=f+3}r.update(),s.update(),this.updateVertices()}updateVertices(){let e=this.points;if(e.length<1)return;let t=e[0],r,s=0,n=0,o=this.buffers[0].data,a=e.length,l=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let c=0;c<a;c++){let u=e[c],h=c*4;c<e.length-1?r=e[c+1]:r=u,n=-(r.x-t.x),s=r.y-t.y;let d=(1-c/(a-1))*10;d>1&&(d=1);let f=Math.sqrt(s*s+n*n);f<1e-6?(s=0,n=0):(s/=f,n/=f,s*=l,n*=l),o[h]=u.x+s,o[h+1]=u.y+n,o[h+2]=u.x-s,o[h+3]=u.y-n,t=u}this.buffers[0].update()}update(){this.textureScale>0?this.build():this.updateVertices()}};var G4=class extends Rn{constructor(e,t,r=0){let s=new H4(e.height,t,r),n=new Ms(e);r>0&&(e.baseTexture.wrapMode=Lr.REPEAT),super(s,n),this.autoUpdate=!0}_render(e){let t=this.geometry;(this.autoUpdate||t._width!==this.shader.texture.height)&&(t._width=this.shader.texture.height,t.update()),super._render(e)}};var z4=class extends Qe{constructor(e=1500,t,r=16384,s=!1){super();let n=16384;r>n&&(r=n),this._properties=[!1,!0,!1,!1,!1],this._maxSize=e,this._batchSize=r,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=Le.NORMAL,this.autoResize=s,this.roundPixels=!0,this.baseTexture=null,this.setProperties(t),this._tintColor=new we(0),this.tintRgb=new Float32Array(3),this.tint=16777215}setProperties(e){e&&(this._properties[0]="vertices"in e||"scale"in e?!!e.vertices||!!e.scale:this._properties[0],this._properties[1]="position"in e?!!e.position:this._properties[1],this._properties[2]="rotation"in e?!!e.rotation:this._properties[2],this._properties[3]="uvs"in e?!!e.uvs:this._properties[3],this._properties[4]="tint"in e||"alpha"in e?!!e.tint||!!e.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintColor.toRgbArray(this.tintRgb)}render(e){!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",()=>this.onChildrenChange(0))),e.batch.setObjectRenderer(e.plugins.particle),e.plugins.particle.render(this))}onChildrenChange(e){let t=Math.floor(e/this._batchSize);for(;this._bufferUpdateIDs.length<t;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[t]=++this._updateID}dispose(){if(this._buffers){for(let e=0;e<this._buffers.length;++e)this._buffers[e].destroy();this._buffers=null}}destroy(e){super.destroy(e),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}};var j4=class{constructor(e,t,r){this.geometry=new Sr,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<e.length;++s){let n=e[s];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||Se.FLOAT,offset:n.offset},t[s]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){let e=this.geometry,t=0;this.indexBuffer=new Pt(se.createIndicesForQuads(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){let a=this.dynamicProperties[o];a.offset=t,t+=a.size,this.dynamicStride+=a.size}let r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new Pt(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){let a=this.staticProperties[o];a.offset=s,s+=a.size,this.staticStride+=a.size}let n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new Pt(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){let a=this.dynamicProperties[o];e.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===Se.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let o=0;o<this.staticProperties.length;++o){let a=this.staticProperties[o];e.addAttribute(a.attributeName,this.staticBuffer,0,a.type===Se.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(e,t,r){for(let s=0;s<this.dynamicProperties.length;s++){let n=this.dynamicProperties[s];n.uploadFunction(e,t,r,n.type===Se.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,t,r){for(let s=0;s<this.staticProperties.length;s++){let n=this.staticProperties[s];n.uploadFunction(e,t,r,n.type===Se.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}};var TS=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`;var IS=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;var V4=class extends Zs{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new rt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:Se.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Qi.from(IS,TS,{}),this.state=Bi.for2d()}render(e){let t=e.children,r=e._maxSize,s=e._batchSize,n=this.renderer,o=t.length;if(o===0)return;o>r&&!e.autoResize&&(o=r);let a=e._buffers;a||(a=e._buffers=this.generateBuffers(e));let l=t[0]._texture.baseTexture,c=l.alphaMode>0;this.state.blendMode=se.correctBlendMode(e.blendMode,c),n.state.set(this.state);let u=n.gl,h=e.worldTransform.copyTo(this.tempMatrix);h.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=h.toArray(!0),this.shader.uniforms.uColor=we.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,c).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<o;f+=s,p+=1){let m=o-f;m>s&&(m=s),p>=a.length&&a.push(this._generateOneMoreBuffer(e));let g=a[p];g.uploadDynamic(t,f,m);let y=e._bufferUpdateIDs[p]||0;d=d||g._updateID<y,d&&(g._updateID=e._updateID,g.uploadStatic(t,f,m)),n.geometry.bind(g.geometry),u.drawElements(u.TRIANGLES,m*6,u.UNSIGNED_SHORT,0)}}generateBuffers(e){let t=[],r=e._maxSize,s=e._batchSize,n=e._properties;for(let o=0;o<r;o+=s)t.push(new j4(this.properties,n,s));return t}_generateOneMoreBuffer(e){let t=e._batchSize,r=e._properties;return new j4(this.properties,r,t)}uploadVertices(e,t,r,s,n,o){let a=0,l=0,c=0,u=0;for(let h=0;h<r;++h){let d=e[t+h],f=d._texture,p=d.scale.x,m=d.scale.y,g=f.trim,y=f.orig;g?(l=g.x-d.anchor.x*y.width,a=l+g.width,u=g.y-d.anchor.y*y.height,c=u+g.height):(a=y.width*(1-d.anchor.x),l=y.width*-d.anchor.x,c=y.height*(1-d.anchor.y),u=y.height*-d.anchor.y),s[o]=l*p,s[o+1]=u*m,s[o+n]=a*p,s[o+n+1]=u*m,s[o+n*2]=a*p,s[o+n*2+1]=c*m,s[o+n*3]=l*p,s[o+n*3+1]=c*m,o+=n*4}}uploadPosition(e,t,r,s,n,o){for(let a=0;a<r;a++){let l=e[t+a].position;s[o]=l.x,s[o+1]=l.y,s[o+n]=l.x,s[o+n+1]=l.y,s[o+n*2]=l.x,s[o+n*2+1]=l.y,s[o+n*3]=l.x,s[o+n*3+1]=l.y,o+=n*4}}uploadRotation(e,t,r,s,n,o){for(let a=0;a<r;a++){let l=e[t+a].rotation;s[o]=l,s[o+n]=l,s[o+n*2]=l,s[o+n*3]=l,o+=n*4}}uploadUvs(e,t,r,s,n,o){for(let a=0;a<r;++a){let l=e[t+a]._texture._uvs;l?(s[o]=l.x0,s[o+1]=l.y0,s[o+n]=l.x1,s[o+n+1]=l.y1,s[o+n*2]=l.x2,s[o+n*2+1]=l.y2,s[o+n*3]=l.x3,s[o+n*3+1]=l.y3,o+=n*4):(s[o]=0,s[o+1]=0,s[o+n]=0,s[o+n+1]=0,s[o+n*2]=0,s[o+n*2+1]=0,s[o+n*3]=0,s[o+n*3+1]=0,o+=n*4)}}uploadTint(e,t,r,s,n,o){for(let a=0;a<r;++a){let l=e[t+a],c=we.shared.setValue(l._tintRGB).toPremultiplied(l.alpha,l.texture.baseTexture.alphaMode>0);s[o]=c,s[o+n]=c,s[o+n*2]=c,s[o+n*3]=c,o+=n*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}};V4.extension={name:"particle",type:ee.RendererPlugin};ne.add(V4);var ma=(i=>(i[i.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",i[i.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",i))(ma||{});var Cd={willReadFrequently:!0},Nn=class Oe{static get experimentalLetterSpacingSupported(){let e=Oe._experimentalLetterSpacingSupported;if(e!==void 0){let t=te.ADAPTER.getCanvasRenderingContext2D().prototype;e=Oe._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,r,s,n,o,a,l,c){this.text=e,this.style=t,this.width=r,this.height=s,this.lines=n,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=c}static measureText(e,t,r,s=Oe._canvas){r=r!=null?r:t.wordWrap;let n=t.toFontString(),o=Oe.measureFont(n);o.fontSize===0&&(o.fontSize=t.fontSize,o.ascent=t.fontSize);let a=s.getContext("2d",Cd);a.font=n;let l=(r?Oe.wordWrap(e,t,s):e).split(/(?:\r\n|\r|\n)/),c=new Array(l.length),u=0;for(let p=0;p<l.length;p++){let m=Oe._measureText(l[p],t.letterSpacing,a);c[p]=m,u=Math.max(u,m)}let h=u+t.strokeThickness;t.dropShadow&&(h+=t.dropShadowDistance);let d=t.lineHeight||o.fontSize+t.strokeThickness,f=Math.max(d,o.fontSize+t.strokeThickness*2)+t.leading+(l.length-1)*(d+t.leading);return t.dropShadow&&(f+=t.dropShadowDistance),new Oe(e,t,h,f,l,c,d+t.leading,u,o)}static _measureText(e,t,r){let s=!1;Oe.experimentalLetterSpacingSupported&&(Oe.experimentalLetterSpacing?(r.letterSpacing=`${t}px`,r.textLetterSpacing=`${t}px`,s=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let n=r.measureText(e).width;return n>0&&(s?n-=t:n+=(Oe.graphemeSegmenter(e).length-1)*t),n}static wordWrap(e,t,r=Oe._canvas){let s=r.getContext("2d",Cd),n=0,o="",a="",l=Object.create(null),{letterSpacing:c,whiteSpace:u}=t,h=Oe.collapseSpaces(u),d=Oe.collapseNewlines(u),f=!h,p=t.wordWrapWidth+c,m=Oe.tokenize(e);for(let g=0;g<m.length;g++){let y=m[g];if(Oe.isNewline(y)){if(!d){a+=Oe.addLine(o),f=!h,o="",n=0;continue}y=" "}if(h){let b=Oe.isBreakingSpace(y),_=Oe.isBreakingSpace(o[o.length-1]);if(b&&_)continue}let x=Oe.getFromCache(y,c,l,s);if(x>p)if(o!==""&&(a+=Oe.addLine(o),o="",n=0),Oe.canBreakWords(y,t.breakWords)){let b=Oe.wordWrapSplit(y);for(let _=0;_<b.length;_++){let w=b[_],A=w,k=1;for(;b[_+k];){let E=b[_+k];if(!Oe.canBreakChars(A,E,y,_,t.breakWords))w+=E;else break;A=E,k++}_+=k-1;let v=Oe.getFromCache(w,c,l,s);v+n>p&&(a+=Oe.addLine(o),f=!1,o="",n=0),o+=w,n+=v}}else{o.length>0&&(a+=Oe.addLine(o),o="",n=0);let b=g===m.length-1;a+=Oe.addLine(y,!b),f=!1,o="",n=0}else x+n>p&&(f=!1,a+=Oe.addLine(o),o="",n=0),(o.length>0||!Oe.isBreakingSpace(y)||f)&&(o+=y,n+=x)}return a+=Oe.addLine(o,!1),a}static addLine(e,t=!0){return e=Oe.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,r,s){let n=r[e];return typeof n!="number"&&(n=Oe._measureText(e,t,s)+t,r[e]=n),n}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){let r=e[t];if(!Oe.isBreakingSpace(r))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e!="string"?!1:Oe._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:Oe._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){let t=[],r="";if(typeof e!="string")return t;for(let s=0;s<e.length;s++){let n=e[s],o=e[s+1];if(Oe.isBreakingSpace(n,o)||Oe.isNewline(n)){r!==""&&(t.push(r),r=""),t.push(n);continue}r+=n}return r!==""&&t.push(r),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,r,s,n){return!0}static wordWrapSplit(e){return Oe.graphemeSegmenter(e)}static measureFont(e){if(Oe._fonts[e])return Oe._fonts[e];let t={ascent:0,descent:0,fontSize:0},r=Oe._canvas,s=Oe._context;s.font=e;let n=Oe.METRICS_STRING+Oe.BASELINE_SYMBOL,o=Math.ceil(s.measureText(n).width),a=Math.ceil(s.measureText(Oe.BASELINE_SYMBOL).width),l=Math.ceil(Oe.HEIGHT_MULTIPLIER*a);if(a=a*Oe.BASELINE_MULTIPLIER|0,o===0||l===0)return Oe._fonts[e]=t,t;r.width=o,r.height=l,s.fillStyle="#f00",s.fillRect(0,0,o,l),s.font=e,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(n,0,a);let c=s.getImageData(0,0,o,l).data,u=c.length,h=o*4,d=0,f=0,p=!1;for(d=0;d<a;++d){for(let m=0;m<h;m+=4)if(c[f+m]!==255){p=!0;break}if(!p)f+=h;else break}for(t.ascent=a-d,f=u-h,p=!1,d=l;d>a;--d){for(let m=0;m<h;m+=4)if(c[f+m]!==255){p=!0;break}if(!p)f-=h;else break}return t.descent=d-a,t.fontSize=t.ascent+t.descent,Oe._fonts[e]=t,t}static clearMetrics(e=""){e?delete Oe._fonts[e]:Oe._fonts={}}static get _canvas(){var e;if(!Oe.__canvas){let t;try{let r=new OffscreenCanvas(0,0);if((e=r.getContext("2d",Cd))!=null&&e.measureText)return Oe.__canvas=r,r;t=te.ADAPTER.createCanvas()}catch(r){t=te.ADAPTER.createCanvas()}t.width=t.height=10,Oe.__canvas=t}return Oe.__canvas}static get _context(){return Oe.__context||(Oe.__context=Oe._canvas.getContext("2d",Cd)),Oe.__context}};Nn.METRICS_STRING="|\xC9q\xC5",Nn.BASELINE_SYMBOL="M",Nn.BASELINE_MULTIPLIER=1.4,Nn.HEIGHT_MULTIPLIER=2,Nn.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){let i=new Intl.Segmenter;return e=>[...i.segment(e)].map(t=>t.segment)}return i=>[...i]})(),Nn.experimentalLetterSpacing=!1,Nn._fonts={},Nn._newlines=[10,13],Nn._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var Ps=Nn;var sB=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],MS=class W4{constructor(e){this.styleID=0,this.reset(),Wp(this,e,e)}clone(){let e={};return Wp(e,this,W4.defaultStyle),new W4(e)}reset(){Wp(this,W4.defaultStyle,W4.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){let t=Vp(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){let t=Vp(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){nB(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){let t=Vp(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){let e=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize,t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let r=t.length-1;r>=0;r--){let s=t[r].trim();!/([\"\'])[^\'\"]+\1/.test(s)&&!sB.includes(s)&&(s=`"${s}"`),t[r]=s}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};MS.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:ma.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};var Hi=MS;function Vp(i){let e=we.shared,t=r=>{let s=e.setValue(r);return s.alpha===1?s.toHex():s.toRgbaString()};return Array.isArray(i)?i.map(t):t(i)}function nB(i,e){if(!Array.isArray(i)||!Array.isArray(e)||i.length!==e.length)return!1;for(let t=0;t<i.length;++t)if(i[t]!==e[t])return!1;return!0}function Wp(i,e,t){for(let r in t)Array.isArray(e[r])?i[r]=e[r].slice():i[r]=e[r]}var oB={texture:!0,children:!1,baseTexture:!0},PS=class Xp extends Dt{constructor(e,t,r){var o;let s=!1;r||(r=te.ADAPTER.createCanvas(),s=!0),r.width=3,r.height=3;let n=xe.from(r);n.orig=new ve,n.trim=new ve,super(n),this._ownCanvas=s,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=(o=Xp.defaultResolution)!=null?o:te.RESOLUTION,this._autoResolution=Xp.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return Ps.experimentalLetterSpacing}static set experimentalLetterSpacing(e){se.deprecation("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Ps.experimentalLetterSpacing=e}updateText(e){let t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();let r=this.context,s=Ps.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=s.width,o=s.height,a=s.lines,l=s.lineHeight,c=s.lineWidths,u=s.maxLineWidth,h=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+t.padding*2)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=t.strokeThickness,r.textBaseline=t.textBaseline,r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit;let d,f,p=t.dropShadow?2:1;for(let m=0;m<p;++m){let g=t.dropShadow&&m===0,y=g?Math.ceil(Math.max(1,o)+t.padding*2):0,x=y*this._resolution;if(g){r.fillStyle="black",r.strokeStyle="black";let _=t.dropShadowColor,w=t.dropShadowBlur*this._resolution,A=t.dropShadowDistance*this._resolution;r.shadowColor=we.shared.setValue(_).setAlpha(t.dropShadowAlpha).toRgbaString(),r.shadowBlur=w,r.shadowOffsetX=Math.cos(t.dropShadowAngle)*A,r.shadowOffsetY=Math.sin(t.dropShadowAngle)*A+x}else r.fillStyle=this._generateFillStyle(t,a,s),r.strokeStyle=t.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let b=(l-h.fontSize)/2;l-h.fontSize<0&&(b=0);for(let _=0;_<a.length;_++)d=t.strokeThickness/2,f=t.strokeThickness/2+_*l+h.ascent+b,t.align==="right"?d+=u-c[_]:t.align==="center"&&(d+=(u-c[_])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(a[_],d+t.padding,f+t.padding-y,!0),t.fill&&this.drawLetterSpacing(a[_],d+t.padding,f+t.padding-y)}this.updateTexture()}drawLetterSpacing(e,t,r,s=!1){let n=this._style.letterSpacing,o=!1;if(Ps.experimentalLetterSpacingSupported&&(Ps.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),n===0||o){s?this.context.strokeText(e,t,r):this.context.fillText(e,t,r);return}let a=t,l=Ps.graphemeSegmenter(e),c=this.context.measureText(e).width,u=0;for(let h=0;h<l.length;++h){let d=l[h];s?this.context.strokeText(d,a,r):this.context.fillText(d,a,r);let f="";for(let p=h+1;p<l.length;++p)f+=l[p];u=this.context.measureText(f).width,a+=c-u+n,c=u}}updateTexture(){let e=this.canvas;if(this._style.trim){let o=se.trimCanvas(e);o.data&&(e.width=o.width,e.height=o.height,this.context.putImageData(o.data,0,0))}let t=this._texture,r=this._style,s=r.trim?0:r.padding,n=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-s,t.trim.y=-s,t.orig.width=t._frame.width-s*2,t.orig.height=t._frame.height-s*2,this._onTextureUpdate(),n.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),this._textureID===-1&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,r){let s=e.fill;if(Array.isArray(s)){if(s.length===1)return s[0]}else return s;let n,o=e.dropShadow?e.dropShadowDistance:0,a=e.padding||0,l=this.canvas.width/this._resolution-o-a*2,c=this.canvas.height/this._resolution-o-a*2,u=s.slice(),h=e.fillGradientStops.slice();if(!h.length){let d=u.length+1;for(let f=1;f<d;++f)h.push(f/d)}if(u.unshift(s[0]),h.unshift(0),u.push(s[s.length-1]),h.push(1),e.fillGradientType===ma.LINEAR_VERTICAL){n=this.context.createLinearGradient(l/2,a,l/2,c+a);let d=r.fontProperties.fontSize+e.strokeThickness;for(let f=0;f<t.length;f++){let p=r.lineHeight*(f-1)+d,m=r.lineHeight*f,g=m;f>0&&p>m&&(g=(m+p)/2);let y=m+d,x=r.lineHeight*(f+1),b=y;f+1<t.length&&x<y&&(b=(y+x)/2);let _=(b-g)/c;for(let w=0;w<u.length;w++){let A=0;typeof h[w]=="number"?A=h[w]:A=w/u.length;let k=Math.min(1,Math.max(0,g/c+A*_));k=Number(k.toFixed(5)),n.addColorStop(k,u[w])}}}else{n=this.context.createLinearGradient(a,c/2,l+a,c/2);let d=u.length+1,f=1;for(let p=0;p<u.length;p++){let m;typeof h[p]=="number"?m=h[p]:m=f/d,n.addColorStop(m,u[p]),f++}}return n}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},oB,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);let t=se.sign(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);let t=se.sign(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof Hi?this._style=e:this._style=new Hi(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e!=null?e:""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};PS.defaultAutoResolution=!0;var Mc=PS;var X4=class{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}};function aB(i,e){var r;let t=!1;if((r=i==null?void 0:i._textures)!=null&&r.length){for(let s=0;s<i._textures.length;s++)if(i._textures[s]instanceof xe){let n=i._textures[s].baseTexture;e.includes(n)||(e.push(n),t=!0)}}return t}function lB(i,e){if(i.baseTexture instanceof Ae){let t=i.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function cB(i,e){if(i._texture&&i._texture instanceof xe){let t=i._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function uB(i,e){return e instanceof Mc?(e.updateText(!0),!0):!1}function hB(i,e){if(e instanceof Hi){let t=e.toFontString();return Ps.measureFont(t),!0}return!1}function dB(i,e){if(i instanceof Mc){e.includes(i.style)||e.push(i.style),e.includes(i)||e.push(i);let t=i._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function fB(i,e){return i instanceof Hi?(e.includes(i)||e.push(i),!0):!1}var DS=class RS{constructor(e){this.limiter=new X4(RS.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(dB),this.registerFindHook(fB),this.registerFindHook(aB),this.registerFindHook(lB),this.registerFindHook(cB),this.registerUploadHook(uB),this.registerUploadHook(hB)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,wi.system.addOnce(this.tick,this,is.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){let e=this.queue[0],t=!1;if(e&&!e._destroyed){for(let r=0,s=this.uploadHooks.length;r<s;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)wi.system.addOnce(this.tick,this,is.UTILITY);else{this.ticking=!1;let e=this.completes.slice(0);this.completes.length=0;for(let t=0,r=e.length;t<r;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,r=this.addHooks.length;t<r&&!this.addHooks[t](e,this.queue);t++);if(e instanceof Qe)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&wi.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};DS.uploadsPerFrame=4;var Pc=DS;Object.defineProperties(te,{UPLOADS_PER_FRAME:{get(){return Pc.uploadsPerFrame},set(i){se.deprecation("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Pc.uploadsPerFrame=i}}});function NS(i,e){return e instanceof Ae?(e._glTextures[i.CONTEXT_UID]||i.texture.bind(e),!0):!1}function pB(i,e){if(!(e instanceof qe))return!1;let{geometry:t}=e;e.finishPoly(),t.updateBatches();let{batches:r}=t;for(let s=0;s<r.length;s++){let{texture:n}=r[s].style;n&&NS(i,n.baseTexture)}return t.batchable||i.geometry.bind(t,e._resolveDirectShader(i)),!0}function mB(i,e){return i instanceof qe?(e.push(i),!0):!1}var q4=class extends Pc{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(mB),this.registerUploadHook(NS),this.registerUploadHook(pB)}};q4.extension={name:"prepare",type:ee.RendererSystem};ne.add(q4);var Eve=new _e;var FS=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`;var LS=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`;var OS=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`;var qp=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`;var BS=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;var kd=new rt,Q4=class extends Zs{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new nl,this.state=Bi.for2d()}contextChange(){let e=this.renderer,t={globals:e.globalUniforms};this.simpleShader=Qi.from(qp,BS,t),this.shader=e.context.webGLVersion>1?Qi.from(LS,FS,t):Qi.from(qp,OS,t)}render(e){let t=this.renderer,r=this.quad,s=r.vertices;s[0]=s[6]=e._width*-e.anchor.x,s[1]=s[3]=e._height*-e.anchor.y,s[2]=s[4]=e._width*(1-e.anchor.x),s[5]=s[7]=e._height*(1-e.anchor.y);let n=e.uvRespectAnchor?e.anchor.x:0,o=e.uvRespectAnchor?e.anchor.y:0;s=r.uvs,s[0]=s[6]=-n,s[1]=s[3]=-o,s[2]=s[4]=1-n,s[5]=s[7]=1-o,r.invalidate();let a=e._texture,l=a.baseTexture,c=l.alphaMode>0,u=e.tileTransform.localTransform,h=e.uvMatrix,d=l.isPowerOfTwo&&a.frame.width===l.width&&a.frame.height===l.height;d&&(l._glTextures[t.CONTEXT_UID]?d=l.wrapMode!==Lr.CLAMP:l.wrapMode===Lr.CLAMP&&(l.wrapMode=Lr.REPEAT));let f=d?this.simpleShader:this.shader,p=a.width,m=a.height,g=e._width,y=e._height;kd.set(u.a*p/g,u.b*p/y,u.c*m/g,u.d*m/y,u.tx/g,u.ty/y),kd.invert(),d?kd.prepend(h.mapCoord):(f.uniforms.uMapCoord=h.mapCoord.toArray(!0),f.uniforms.uClampFrame=h.uClampFrame,f.uniforms.uClampOffset=h.uClampOffset),f.uniforms.uTransform=kd.toArray(!0),f.uniforms.uColor=we.shared.setValue(e.tint).premultiply(e.worldAlpha,c).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),f.uniforms.uSampler=a,t.shader.bind(f),t.geometry.bind(r),this.state.blendMode=se.correctBlendMode(e.blendMode,c),t.state.set(this.state),t.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}};Q4.extension={name:"tilingSprite",type:ee.RendererPlugin};ne.add(Q4);var US=class Y4{constructor(e,t,r){this.linkedSheets=[],(e instanceof Ae||e instanceof xe)&&(e={texture:e,data:t,resolutionFilename:r});let{texture:s,data:n,resolutionFilename:o=null,cachePrefix:a=""}=e;this.cachePrefix=a,this._texture=s instanceof xe?s:null,this.baseTexture=s instanceof Ae?s:this._texture.baseTexture,this.textures={},this.animations={},this.data=n;let l=this.baseTexture.resource;this.resolution=this._updateResolution(o||(l?l.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){let{scale:t}=this.data.meta,r=se.getResolutionOfUrl(e,null);return r===null&&(r=typeof t=="number"?t:parseFloat(t!=null?t:"1")),r!==1&&this.baseTexture.setResolution(r),r}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=Y4.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e,r=Y4.BATCH_SIZE;for(;t-e<r&&t<this._frameKeys.length;){let s=this._frameKeys[t],n=this._frames[s],o=n.frame;if(o){let a=null,l=null,c=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,u=new ve(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);n.rotated?a=new ve(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new ve(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(l=new ve(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[s]=new xe(this.baseTexture,a,u,l,n.rotated?2:0,n.anchor,n.borders),xe.addToCache(this.textures[s],this.cachePrefix+s.toString())}t++}}_processAnimations(){let e=this.data.animations||{};for(let t in e){this.animations[t]=[];for(let r=0;r<e[t].length;r++){let s=e[t][r];this.animations[t].push(this.textures[s])}}}_parseComplete(){let e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Y4.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Y4.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(let r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};US.BATCH_SIZE=1e3;var Td=US;var gB=["jpg","png","jpeg","avif","webp"];function $S(i,e,t){let r={};if(i.forEach(s=>{r[s]=e}),Object.keys(e.textures).forEach(s=>{r[`${e.cachePrefix}${s}`]=e.textures[s]}),!t){let s=se.path.dirname(i[0]);e.linkedSheets.forEach((n,o)=>{Object.assign(r,$S([`${s}/${e.data.meta.related_multi_packs[o]}`],n,!0))})}return r}var HS={extension:ee.Asset,cache:{test:i=>i instanceof Td,getCacheableAssets:(i,e)=>$S(i,e,!1)},resolver:{test:i=>{let e=i.split("?")[0].split("."),t=e.pop(),r=e.pop();return t==="json"&&gB.includes(r)},parse:i=>{var t,r;let e=i.split(".");return{resolution:parseFloat((r=(t=te.RETINA_PREFIX.exec(i))==null?void 0:t[1])!=null?r:"1"),format:e[e.length-2],src:i}}},loader:{name:"spritesheetLoader",extension:{type:ee.LoadParser,priority:si.Normal},testParse(i,e){return fe(this,null,function*(){return se.path.extname(e.src).toLowerCase()===".json"&&!!i.frames})},parse(i,e,t){return fe(this,null,function*(){var u,h,d;let{texture:r,imageFilename:s,cachePrefix:n}=(u=e==null?void 0:e.data)!=null?u:{},o=se.path.dirname(e.src);o&&o.lastIndexOf("/")!==o.length-1&&(o+="/");let a;if(r&&r.baseTexture)a=r;else{let f=ll(o+(s!=null?s:i.meta.image),e.src);a=(yield t.load([f]))[f]}let l=new Td({texture:a.baseTexture,data:i,resolutionFilename:e.src,cachePrefix:n});yield l.parse();let c=(h=i==null?void 0:i.meta)==null?void 0:h.related_multi_packs;if(Array.isArray(c)){let f=[];for(let m of c){if(typeof m!="string")continue;let g=o+m;(d=e.data)!=null&&d.ignoreMultiPack||(g=ll(g,e.src),f.push(t.load({src:g,data:{ignoreMultiPack:!0}})))}let p=yield Promise.all(f);l.linkedSheets=p,p.forEach(m=>{m.linkedSheets=[l].concat(l.linkedSheets.filter(g=>g!==m))})}return l})},unload(i){i.destroy(!0)}}};ne.add(HS);var Fn=class{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}};var So=class{static test(e){return typeof e=="string"&&e.startsWith("info face=")}static parse(e){let t=e.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(let n in t){let o=t[n].match(/^[a-z]+/gm)[0],a=t[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(let c in a){let u=a[c].split("="),h=u[0],d=u[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;l[h]=p}r[o].push(l)}let s=new Fn;return r.info.forEach(n=>s.info.push({face:n.face,size:parseInt(n.size,10)})),r.common.forEach(n=>s.common.push({lineHeight:parseInt(n.lineHeight,10)})),r.page.forEach(n=>s.page.push({id:parseInt(n.id,10),file:n.file})),r.char.forEach(n=>s.char.push({id:parseInt(n.id,10),page:parseInt(n.page,10),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10),xoffset:parseInt(n.xoffset,10),yoffset:parseInt(n.yoffset,10),xadvance:parseInt(n.xadvance,10)})),r.kerning.forEach(n=>s.kerning.push({first:parseInt(n.first,10),second:parseInt(n.second,10),amount:parseInt(n.amount,10)})),r.distanceField.forEach(n=>s.distanceField.push({distanceRange:parseInt(n.distanceRange,10),fieldType:n.fieldType})),s}};var ga=class{static test(e){let t=e;return typeof e!="string"&&"getElementsByTagName"in e&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(e){let t=new Fn,r=e.getElementsByTagName("info"),s=e.getElementsByTagName("common"),n=e.getElementsByTagName("page"),o=e.getElementsByTagName("char"),a=e.getElementsByTagName("kerning"),l=e.getElementsByTagName("distanceField");for(let c=0;c<r.length;c++)t.info.push({face:r[c].getAttribute("face"),size:parseInt(r[c].getAttribute("size"),10)});for(let c=0;c<s.length;c++)t.common.push({lineHeight:parseInt(s[c].getAttribute("lineHeight"),10)});for(let c=0;c<n.length;c++)t.page.push({id:parseInt(n[c].getAttribute("id"),10)||0,file:n[c].getAttribute("file")});for(let c=0;c<o.length;c++){let u=o[c];t.char.push({id:parseInt(u.getAttribute("id"),10),page:parseInt(u.getAttribute("page"),10)||0,x:parseInt(u.getAttribute("x"),10),y:parseInt(u.getAttribute("y"),10),width:parseInt(u.getAttribute("width"),10),height:parseInt(u.getAttribute("height"),10),xoffset:parseInt(u.getAttribute("xoffset"),10),yoffset:parseInt(u.getAttribute("yoffset"),10),xadvance:parseInt(u.getAttribute("xadvance"),10)})}for(let c=0;c<a.length;c++)t.kerning.push({first:parseInt(a[c].getAttribute("first"),10),second:parseInt(a[c].getAttribute("second"),10),amount:parseInt(a[c].getAttribute("amount"),10)});for(let c=0;c<l.length;c++)t.distanceField.push({fieldType:l[c].getAttribute("fieldType"),distanceRange:parseInt(l[c].getAttribute("distanceRange"),10)});return t}};var ya=class{static test(e){return typeof e=="string"&&e.includes("<font>")?ga.test(te.ADAPTER.parseXML(e)):!1}static parse(e){return ga.parse(te.ADAPTER.parseXML(e))}};var Qp=[So,ga,ya];function Yp(i){for(let e=0;e<Qp.length;e++)if(Qp[e].test(i))return Qp[e];return null}function Kp(i,e,t,r,s,n){let o=t.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let a,l=t.dropShadow?t.dropShadowDistance:0,c=t.padding||0,u=i.width/r-l-c*2,h=i.height/r-l-c*2,d=o.slice(),f=t.fillGradientStops.slice();if(!f.length){let p=d.length+1;for(let m=1;m<p;++m)f.push(m/p)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),t.fillGradientType===ma.LINEAR_VERTICAL){a=e.createLinearGradient(u/2,c,u/2,h+c);let p=0,m=(n.fontProperties.fontSize+t.strokeThickness)/h;for(let g=0;g<s.length;g++){let y=n.lineHeight*g;for(let x=0;x<d.length;x++){let b=0;typeof f[x]=="number"?b=f[x]:b=x/d.length;let _=y/h+b*m,w=Math.max(p,_);w=Math.min(w,1),a.addColorStop(w,d[x]),p=w}}}else{a=e.createLinearGradient(c,h/2,u+c,h/2);let p=d.length+1,m=1;for(let g=0;g<d.length;g++){let y;typeof f[g]=="number"?y=f[g]:y=m/p,a.addColorStop(y,d[g]),m++}}return a}function Zp(i,e,t,r,s,n,o){let a=t.text,l=t.fontProperties;e.translate(r,s),e.scale(n,n);let c=o.strokeThickness/2,u=-(o.strokeThickness/2);if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=Kp(i,e,o,n,[a],t),e.strokeStyle=o.stroke,o.dropShadow){let h=o.dropShadowColor,d=o.dropShadowBlur*n,f=o.dropShadowDistance*n;e.shadowColor=we.shared.setValue(h).setAlpha(o.dropShadowAlpha).toRgbaString(),e.shadowBlur=d,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*f,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*f}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,c,u+t.lineHeight-l.descent),o.fill&&e.fillText(a,c,u+t.lineHeight-l.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function ml(i){return i.codePointAt?i.codePointAt(0):i.charCodeAt(0)}function K4(i){return Array.from?Array.from(i):i.split("")}function Jp(i){typeof i=="string"&&(i=[i]);let e=[];for(let t=0,r=i.length;t<r;t++){let s=i[t];if(Array.isArray(s)){if(s.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);let n=s[0].charCodeAt(0),o=s[1].charCodeAt(0);if(o<n)throw new Error("[BitmapFont]: Invalid character range.");for(let a=n,l=o;a<=l;a++)e.push(String.fromCharCode(a))}else e.push(...K4(s))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}var xa=class Ln{constructor(e,t,r){var u,h;let[s]=e.info,[n]=e.common,[o]=e.page,[a]=e.distanceField,l=se.getResolutionOfUrl(o.file),c={};this._ownsTextures=r,this.font=s.face,this.size=s.size,this.lineHeight=n.lineHeight/l,this.chars={},this.pageTextures=c;for(let d=0;d<e.page.length;d++){let{id:f,file:p}=e.page[d];c[f]=t instanceof Array?t[d]:t[p],a!=null&&a.fieldType&&a.fieldType!=="none"&&(c[f].baseTexture.alphaMode=jt.NO_PREMULTIPLIED_ALPHA,c[f].baseTexture.mipmap=bi.OFF)}for(let d=0;d<e.char.length;d++){let{id:f,page:p}=e.char[d],{x:m,y:g,width:y,height:x,xoffset:b,yoffset:_,xadvance:w}=e.char[d];m/=l,g/=l,y/=l,x/=l,b/=l,_/=l,w/=l;let A=new ve(m+c[p].frame.x/l,g+c[p].frame.y/l,y,x);this.chars[f]={xOffset:b,yOffset:_,xAdvance:w,kerning:{},texture:new xe(c[p].baseTexture,A),page:p}}for(let d=0;d<e.kerning.length;d++){let{first:f,second:p,amount:m}=e.kerning[d];f/=l,p/=l,m/=l,this.chars[p]&&(this.chars[p].kerning[f]=m)}this.distanceFieldRange=a==null?void 0:a.distanceRange,this.distanceFieldType=(h=(u=a==null?void 0:a.fieldType)==null?void 0:u.toLowerCase())!=null?h:"none"}destroy(){for(let e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(let e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,r){let s;if(e instanceof Fn)s=e;else{let o=Yp(e);if(!o)throw new Error("Unrecognized data format for font.");s=o.parse(e)}t instanceof xe&&(t=[t]);let n=new Ln(s,t,r);return Ln.available[n.font]=n,n}static uninstall(e){let t=Ln.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete Ln.available[e]}static from(e,t,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");let k=Object.assign({},Ln.defaultOptions,r),{chars:s,padding:n,resolution:o,textureWidth:a,textureHeight:l}=k,c=m3(k,["chars","padding","resolution","textureWidth","textureHeight"]),u=Jp(s),h=t instanceof Hi?t:new Hi(t),d=a,f=new Fn;f.info[0]={face:h.fontFamily,size:h.fontSize},f.common[0]={lineHeight:h.fontSize};let p=0,m=0,g,y,x,b=0,_=[],w=[];for(let v=0;v<u.length;v++){g||(g=te.ADAPTER.createCanvas(),g.width=a,g.height=l,y=g.getContext("2d"),x=new Ae(g,Ne({resolution:o},c)),_.push(x),w.push(new xe(x)),f.page.push({id:w.length-1,file:""}));let E=u[v],S=Ps.measureText(E,h,!1,g),M=S.width,I=Math.ceil(S.height),T=Math.ceil((h.fontStyle==="italic"?2:1)*M);if(m>=l-I*o){if(m===0)throw new Error(`[BitmapFont] textureHeight ${l}px is too small (fontFamily: '${h.fontFamily}', fontSize: ${h.fontSize}px, char: '${E}')`);--v,g=null,y=null,x=null,m=0,p=0,b=0;continue}if(b=Math.max(I+S.fontProperties.descent,b),T*o+p>=d){if(p===0)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${h.fontFamily}', fontSize: ${h.fontSize}px, char: '${E}')`);--v,m+=b*o,m=Math.ceil(m),p=0,b=0;continue}Zp(g,y,S,p,m,o,h);let C=ml(S.text);f.char.push({id:C,page:w.length-1,x:p/o,y:m/o,width:T,height:I,xoffset:0,yoffset:0,xadvance:M-(h.dropShadow?h.dropShadowDistance:0)-(h.stroke?h.strokeThickness:0)}),p+=(T+2*n)*o,p=Math.ceil(p)}if(!(r!=null&&r.skipKerning))for(let v=0,E=u.length;v<E;v++){let S=u[v];for(let M=0;M<E;M++){let I=u[M],T=y.measureText(S).width,C=y.measureText(I).width,P=y.measureText(S+I).width-(T+C);P&&f.kerning.push({first:ml(S),second:ml(I),amount:P})}}let A=new Ln(f,w,!0);return Ln.available[e]!==void 0&&Ln.uninstall(e),Ln.available[e]=A,A}};xa.ALPHA=[["a","z"],["A","Z"]," "],xa.NUMERIC=[["0","9"]],xa.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],xa.ASCII=[[" ","~"]],xa.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:xa.ALPHANUMERIC},xa.available={};var Ki=xa;var GS=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`;var zS=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;var jS=[],VS=[],WS=[],XS=class qS extends Qe{constructor(e,t={}){super();let{align:r,tint:s,maxWidth:n,letterSpacing:o,fontName:a,fontSize:l}=Object.assign({},qS.styleDefaults,t);if(!Ki.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tintColor=new we(s),this._font=void 0,this._fontName=a,this._fontSize=l,this.text=e,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new sr(()=>{this.dirty=!0},this,0,0),this._roundPixels=te.ROUND_PIXELS,this.dirty=!0,this._resolution=te.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var M;let e=Ki.available[this._fontName],t=this.fontSize,r=t/e.size,s=new _e,n=[],o=[],a=[],l=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",c=K4(l),u=this._maxWidth*e.size/t,h=e.distanceFieldType==="none"?jS:VS,d=null,f=0,p=0,m=0,g=-1,y=0,x=0,b=0,_=0;for(let I=0;I<c.length;I++){let T=c[I],C=ml(T);if(/(?:\s)/.test(T)&&(g=I,y=f,_++),T==="\r"||T===`
`){o.push(f),a.push(-1),p=Math.max(p,f),++m,++x,s.x=0,s.y+=e.lineHeight,d=null,_=0;continue}let P=e.chars[C];if(!P)continue;d&&P.kerning[d]&&(s.x+=P.kerning[d]);let D=WS.pop()||{texture:xe.EMPTY,line:0,charCode:0,prevSpaces:0,position:new _e};D.texture=P.texture,D.line=m,D.charCode=C,D.position.x=Math.round(s.x+P.xOffset+this._letterSpacing/2),D.position.y=Math.round(s.y+P.yOffset),D.prevSpaces=_,n.push(D),f=D.position.x+Math.max(P.xAdvance-P.xOffset,P.texture.orig.width),s.x+=P.xAdvance+this._letterSpacing,b=Math.max(b,P.yOffset+P.texture.height),d=C,g!==-1&&u>0&&s.x>u&&(++x,se.removeItems(n,1+g-x,1+I-g),I=g,g=-1,o.push(y),a.push(n.length>0?n[n.length-1].prevSpaces:0),p=Math.max(p,y),m++,s.x=0,s.y+=e.lineHeight,d=null,_=0)}let w=c[c.length-1];w!=="\r"&&w!==`
`&&(/(?:\s)/.test(w)&&(f=y),o.push(f),p=Math.max(p,f),a.push(-1));let A=[];for(let I=0;I<=m;I++){let T=0;this._align==="right"?T=p-o[I]:this._align==="center"?T=(p-o[I])/2:this._align==="justify"&&(T=a[I]<0?0:(p-o[I])/a[I]),A.push(T)}let k=n.length,v={},E=[],S=this._activePagesMeshData;h.push(...S);for(let I=0;I<k;I++){let T=n[I].texture,C=T.baseTexture.uid;if(!v[C]){let P=h.pop();if(!P){let O=new Ao,R,N;e.distanceFieldType==="none"?(R=new Ms(xe.EMPTY),N=Le.NORMAL):(R=new Ms(xe.EMPTY,{program:nr.from(zS,GS),uniforms:{uFWidth:0}}),N=Le.NORMAL_NPM);let F=new Rn(O,R);F.blendMode=N,P={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:F,vertices:null,uvs:null,indices:null}}P.index=0,P.indexCount=0,P.vertexCount=0,P.uvsCount=0,P.total=0;let{_textureCache:D}=this;D[C]=D[C]||new xe(T.baseTexture),P.mesh.texture=D[C],P.mesh.tint=this._tintColor.value,E.push(P),v[C]=P}v[C].total++}for(let I=0;I<S.length;I++)E.includes(S[I])||this.removeChild(S[I].mesh);for(let I=0;I<E.length;I++)E[I].mesh.parent!==this&&this.addChild(E[I].mesh);this._activePagesMeshData=E;for(let I in v){let T=v[I],C=T.total;if(!(((M=T.indices)==null?void 0:M.length)>6*C)||T.vertices.length<Rn.BATCHABLE_SIZE*2)T.vertices=new Float32Array(4*2*C),T.uvs=new Float32Array(4*2*C),T.indices=new Uint16Array(6*C);else{let P=T.total,D=T.vertices;for(let O=P*4*2;O<D.length;O++)D[O]=0}T.mesh.size=6*C}for(let I=0;I<k;I++){let T=n[I],C=T.position.x+A[T.line]*(this._align==="justify"?T.prevSpaces:1);this._roundPixels&&(C=Math.round(C));let P=C*r,D=T.position.y*r,O=T.texture,R=v[O.baseTexture.uid],N=O.frame,F=O._uvs,B=R.index++;R.indices[B*6+0]=0+B*4,R.indices[B*6+1]=1+B*4,R.indices[B*6+2]=2+B*4,R.indices[B*6+3]=0+B*4,R.indices[B*6+4]=2+B*4,R.indices[B*6+5]=3+B*4,R.vertices[B*8+0]=P,R.vertices[B*8+1]=D,R.vertices[B*8+2]=P+N.width*r,R.vertices[B*8+3]=D,R.vertices[B*8+4]=P+N.width*r,R.vertices[B*8+5]=D+N.height*r,R.vertices[B*8+6]=P,R.vertices[B*8+7]=D+N.height*r,R.uvs[B*8+0]=F.x0,R.uvs[B*8+1]=F.y0,R.uvs[B*8+2]=F.x1,R.uvs[B*8+3]=F.y1,R.uvs[B*8+4]=F.x2,R.uvs[B*8+5]=F.y2,R.uvs[B*8+6]=F.x3,R.uvs[B*8+7]=F.y3}this._textWidth=p*r,this._textHeight=(s.y+e.lineHeight)*r;for(let I in v){let T=v[I];if(this.anchor.x!==0||this.anchor.y!==0){let O=0,R=this._textWidth*this.anchor.x,N=this._textHeight*this.anchor.y;for(let F=0;F<T.total;F++)T.vertices[O++]-=R,T.vertices[O++]-=N,T.vertices[O++]-=R,T.vertices[O++]-=N,T.vertices[O++]-=R,T.vertices[O++]-=N,T.vertices[O++]-=R,T.vertices[O++]-=N}this._maxLineHeight=b*r;let C=T.mesh.geometry.getBuffer("aVertexPosition"),P=T.mesh.geometry.getBuffer("aTextureCoord"),D=T.mesh.geometry.getIndex();C.data=T.vertices,P.data=T.uvs,D.data=T.indices,C.update(),P.update(),D.update()}for(let I=0;I<n.length;I++)WS.push(n[I]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);let{distanceFieldRange:t,distanceFieldType:r,size:s}=Ki.available[this._fontName];if(r!=="none"){let{a:n,b:o,c:a,d:l}=this.worldTransform,c=Math.sqrt(n*n+o*o),u=Math.sqrt(a*a+l*l),h=(Math.abs(c)+Math.abs(u))/2,d=this.fontSize/s,f=e._view.resolution;for(let p of this._activePagesMeshData)p.mesh.shader.uniforms.uFWidth=h*t*d*f}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){let e=Ki.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(e){if(this.tint!==e){this._tintColor.setValue(e);for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!Ki.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){var e;return(e=this._fontSize)!=null?e:Ki.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e!=null?e:""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){let{_textureCache:t}=this,r=Ki.available[this._fontName].distanceFieldType==="none"?jS:VS;r.push(...this._activePagesMeshData);for(let s of this._activePagesMeshData)this.removeChild(s.mesh);this._activePagesMeshData=[],r.filter(s=>t[s.mesh.texture.baseTexture.uid]).forEach(s=>{s.mesh.texture=xe.EMPTY});for(let s in t)t[s].destroy(),delete t[s];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(e)}};XS.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};var Z4=XS;var yB=[".xml",".fnt"],QS={extension:{type:ee.LoadParser,priority:si.Normal},name:"loadBitmapFont",test(i){return yB.includes(se.path.extname(i).toLowerCase())},testParse(i){return fe(this,null,function*(){return So.test(i)||ya.test(i)})},parse(i,e,t){return fe(this,null,function*(){let r=So.test(i)?So.parse(i):ya.parse(i),{src:s}=e,{page:n}=r,o=[];for(let c=0;c<n.length;++c){let u=n[c].file,h=se.path.join(se.path.dirname(s),u);h=ll(h,s),o.push(h)}let a=yield t.load(o),l=o.map(c=>a[c]);return Ki.install(r,l,!0)})},load(i,e){return fe(this,null,function*(){return(yield te.ADAPTER.fetch(i)).text()})},unload(i){i.destroy()}};ne.add(QS);var em=class Dc extends Hi{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(e){return new Dc(Object.keys(Dc.defaultOptions).reduce((t,r)=>Si(Ne({},t),{[r]:e[r]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(e=>{URL.revokeObjectURL(e.src),e.refs--,e.refs===0&&(e.fontFace&&document.fonts.delete(e.fontFace),delete Dc.availableFonts[e.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(e,t={}){let{availableFonts:r}=Dc;if(r[e]){let s=r[e];return this._fonts.push(s),s.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return te.ADAPTER.fetch(e).then(s=>s.blob()).then(s=>fe(this,null,function*(){return new Promise((n,o)=>{let a=URL.createObjectURL(s),l=new FileReader;l.onload=()=>n([a,l.result]),l.onerror=o,l.readAsDataURL(s)})})).then(o=>fe(this,[o],function*([s,n]){let a=Object.assign({family:se.path.basename(e,se.path.extname(e)),weight:"normal",style:"normal",display:"auto",src:s,dataSrc:n,refs:1,originalUrl:e,fontFace:null},t);r[e]=a,this._fonts.push(a),this.styleID++;let l=new FontFace(a.family,`url(${a.src})`,{weight:a.weight,style:a.style,display:a.display});a.fontFace=l,yield l.load(),document.fonts.add(l),yield document.fonts.ready,this.styleID++,this.fontsDirty=!0}))}addOverride(...e){let t=e.filter(r=>!this._overrides.includes(r));t.length>0&&(this._overrides.push(...t),this.styleID++)}removeOverride(...e){let t=e.filter(r=>this._overrides.includes(r));t.length>0&&(this._overrides=this._overrides.filter(r=>!t.includes(r)),this.styleID++)}toCSS(e){return[`transform: scale(${e})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((e,t)=>`${e}
            @font-face {
                font-family: "${t.family}";
                src: url('${t.dataSrc}');
                font-weight: ${t.weight};
                font-style: ${t.style};
                font-display: ${t.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){return Array.isArray(e)&&(e=se.rgb2hex(e)),typeof e=="number"?se.hex2string(e):e}dropShadowToCSS(){let e=this.normalizeColor(this.dropShadowColor),t=this.dropShadowAlpha,r=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),s=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&t<1&&(e+=(t*255|0).toString(16).padStart(2,"0"));let n=`${r}px ${s}px`;return this.dropShadowBlur>0?`text-shadow: ${n} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${n} ${e}`}reset(){Object.assign(this,Dc.defaultOptions)}onBeforeDraw(){let{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise(t=>setTimeout(t,100)):Promise.resolve()}get isSafari(){let{userAgent:e}=te.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(e){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(e){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(e){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(e){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};em.availableFonts={},em.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};var J4=em;var Id=class Rc extends Dt{constructor(e="",t={}){var h;super(xe.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;let r=new Image,s=xe.from(r,{scaleMode:te.SCALE_MODE,resourceOptions:{autoLoad:!1}});s.orig=new ve,s.trim=new ve,this.texture=s;let n="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xhtml",a=document.createElementNS(n,"svg"),l=document.createElementNS(n,"foreignObject"),c=document.createElementNS(o,"div"),u=document.createElementNS(o,"style");l.setAttribute("width","10000"),l.setAttribute("height","10000"),l.style.overflow="hidden",a.appendChild(l),this.maxWidth=Rc.defaultMaxWidth,this.maxHeight=Rc.defaultMaxHeight,this._domElement=c,this._styleElement=u,this._svgRoot=a,this._foreignObject=l,this._foreignObject.appendChild(u),this._foreignObject.appendChild(c),this._image=r,this._loadImage=new Image,this._autoResolution=Rc.defaultAutoResolution,this._resolution=(h=Rc.defaultResolution)!=null?h:te.RESOLUTION,this.text=e,this.style=t}measureText(e){var u,h;let{text:t,style:r,resolution:s}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:t,style:r.toCSS(s)}),this._styleElement.textContent=r.toGlobalCSS(),document.body.appendChild(this._svgRoot);let n=this._domElement.getBoundingClientRect();this._svgRoot.remove();let{width:o,height:a}=n;(o>this.maxWidth||a>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");let l=Math.min(this.maxWidth,Math.ceil(o)),c=Math.min(this.maxHeight,Math.ceil(a));return this._svgRoot.setAttribute("width",l.toString()),this._svgRoot.setAttribute("height",c.toString()),t!==this._text&&(this._domElement.innerHTML=this._text),r!==this._style&&(Object.assign(this._domElement,{style:(u=this._style)==null?void 0:u.toCSS(s)}),this._styleElement.textContent=(h=this._style)==null?void 0:h.toGlobalCSS()),{width:l+r.padding*2,height:c+r.padding*2}}updateText(e=!0){return fe(this,null,function*(){let{style:t,_image:r,_loadImage:s}=this;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;let{width:n,height:o}=this.measureText();r.width=s.width=Math.ceil(Math.max(1,n)),r.height=s.height=Math.ceil(Math.max(1,o)),this._updateID++;let a=this._updateID;yield new Promise(l=>{s.onload=()=>fe(this,null,function*(){if(a<this._updateID){l();return}yield t.onBeforeDraw(),r.src=s.src,s.onload=null,s.src="",this.updateTexture(),l()});let c=new XMLSerializer().serializeToString(this._svgRoot);s.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(c)}`})})}get source(){return this._image}updateTexture(){let{style:e,texture:t,_image:r,resolution:s}=this,{padding:n}=e,{baseTexture:o}=t;t.trim.width=t._frame.width=r.width/s,t.trim.height=t._frame.height=r.height/s,t.trim.x=-n,t.trim.y=-n,t.orig.width=t._frame.width-n*2,t.orig.height=t._frame.height-n*2,this._onTextureUpdate(),o.setRealSize(r.width,r.height,s),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){var r,s,n,o,a;typeof e=="boolean"&&(e={children:e}),e=Object.assign({},Rc.defaultDestroyOptions,e),super.destroy(e);let t=null;this.ownsStyle&&((r=this._style)==null||r.cleanFonts()),this._style=t,(s=this._svgRoot)==null||s.remove(),this._svgRoot=t,(n=this._domElement)==null||n.remove(),this._domElement=t,(o=this._foreignObject)==null||o.remove(),this._foreignObject=t,(a=this._styleElement)==null||a.remove(),this._styleElement=t,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=t,this._image.src="",this._image=t}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);let t=se.sign(this.scale.x)||1;this.scale.x=t*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);let t=se.sign(this.scale.y)||1;this.scale.y=t*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&(e=e||{},e instanceof J4?(this.ownsStyle=!1,this._style=e):e instanceof Hi?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=J4.from(e)):(this.ownsStyle=!0,this._style=new J4(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(e===""||e===null||e===void 0?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};Id.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Id.defaultMaxWidth=2024,Id.defaultMaxHeight=2024,Id.defaultAutoResolution=!0;var Md=class extends pi.default{constructor(e){super(),this._enabled=!1,this.renderer=e,this.context=e.context,this.pointerOverRenderer=!1,this.modifierKeys=new Set,this.coord=[0,0],this._wheelDefault=ei().os==="mac"?"auto":"zoom",this._click=this._click.bind(this),this._keydown=this._keydown.bind(this),this._keyup=this._keyup.bind(this),this._pointercancel=this._pointercancel.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerout=this._pointerout.bind(this),this._pointerover=this._pointerover.bind(this),this._pointerup=this._pointerup.bind(this),this._wheel=this._wheel.bind(this),this.enable()}get enabled(){return this._enabled}enable(){if(this._enabled)return;this._enabled=!0,this.modifierKeys.clear(),window.addEventListener("keydown",this._keydown),window.addEventListener("keyup",this._keyup),this.renderer.supersurface.node().addEventListener("wheel",this._wheel,{passive:!1});let t=this.context.pixi.view;t.addEventListener("pointerover",this._pointerover),t.addEventListener("pointerout",this._pointerout);let r=this.context.pixi.stage;r.addEventListener("click",this._click),r.addEventListener("pointerdown",this._pointerdown),r.addEventListener("pointermove",this._pointermove),r.addEventListener("pointerup",this._pointerup),r.addEventListener("pointerupoutside",this._pointercancel),r.addEventListener("pointercancel",this._pointercancel)}disable(){if(!this._enabled)return;this._enabled=!1,this.modifierKeys.clear(),window.removeEventListener("keydown",this._keydown),window.removeEventListener("keyup",this._keyup),this.renderer.supersurface.node().removeEventListener("wheel",this._wheel);let t=this.context.pixi.view;t.removeEventListener("pointerover",this._pointerover),t.removeEventListener("pointerout",this._pointerout);let r=this.context.pixi.stage;r.removeEventListener("click",this._click),r.removeEventListener("pointerdown",this._pointerdown),r.removeEventListener("pointermove",this._pointermove),r.removeEventListener("pointerup",this._pointerup),r.removeEventListener("pointerupoutside",this._pointercancel),r.removeEventListener("pointercancel",this._pointercancel)}setCursor(e){let t=this.context,r={areaCursor:`url(${t.assetPath}img/cursor-select-area.png), pointer`,connectLineCursor:`url(${t.assetPath}img/cursor-draw-connect-line.png) 9 9, crosshair`,connectVertexCursor:`url(${t.assetPath}img/cursor-draw-connect-vertex.png) 9 9, crosshair`,lineCursor:`url(${t.assetPath}img/cursor-select-line.png), pointer`,pointCursor:`url(${t.assetPath}img/cursor-select-point.png), pointer`,selectSplitCursor:`url(${t.assetPath}img/cursor-select-split.png), pointer`,vertexCursor:`url(${t.assetPath}img/cursor-select-vertex.png), pointer`};switch(e){case"areaCursor":this.renderer.pixi.view.style.cursor=r.areaCursor;break;case"connectLineCursor":this.renderer.pixi.view.style.cursor=r.connectLineCursor;break;case"connectVertexCursor":this.renderer.pixi.view.style.cursor=r.connectVertexCursor;break;case"lineCursor":this.renderer.pixi.view.style.cursor=r.lineCursor;break;case"pointCursor":this.renderer.pixi.view.style.cursor=r.pointCursor;break;case"selectSplitCursor":this.renderer.pixi.view.style.cursor=r.selectSplitCursor;break;case"vertexCursor":this.renderer.pixi.view.style.cursor=r.vertexCursor;break;default:this.renderer.pixi.view.style.cursor=e;break}}_observeModifierKeys(e){let t=this.modifierKeys,r=["Alt","Control","Meta","Shift"],s=!1;for(let n of r){let o=e.getModifierState(n),a=t.has(n);o&&!a?(t.add(n),s=!0):!o&&a&&(t.delete(n),s=!0)}s&&this.emit("modifierchange",t)}_keydown(e){this._observeModifierKeys(e),this.emit("keydown",e)}_keyup(e){this._observeModifierKeys(e),this.emit("keyup",e)}_pointerover(e){this._observeModifierKeys(e),this.pointerOverRenderer=!0,this.emit("pointerover",e)}_pointerout(e){this._observeModifierKeys(e),this.pointerOverRenderer=!1,this.emit("pointerout",e)}_pointerdown(e){this._observeModifierKeys(e),this.coord=[e.global.x,e.global.y],this.emit("pointerdown",e)}_pointermove(e){this._observeModifierKeys(e),this.coord=[e.global.x,e.global.y],this.emit("pointermove",e)}_pointerup(e){this._observeModifierKeys(e),this.coord=[e.global.x,e.global.y],this.emit("pointerup",e)}_pointercancel(e){this.emit("pointercancel",e)}_click(e){this.emit("click",e)}_wheel(e){var l;e.preventDefault(),e.stopImmediatePropagation();let[t,r]=this._normalizeWheelDelta(e);this.coord=[e.offsetX,e.offsetY];let s=typeof r=="number"&&isFinite(r)&&Math.floor(r)===r,n=!s&&e.ctrlKey&&!this.modifierKeys.has("Control"),o="zoom",a=3;if(n)o="zoom",a=6;else if(e.shiftKey)o="zoom",a=3;else{let u=(l=this.context.systems.storage.getItem("prefs.mouse_wheel.interaction"))!=null?l:this._wheelDefault;u==="pan"||u==="auto"&&(t||s)?(o="pan",a=1):(o="zoom",a=3)}e._gesture=o,e._normalizedDeltaX=t*a,e._normalizedDeltaY=r*a,this.emit("wheel",e)}_normalizeWheelDelta(e){let[t,r]=[e.deltaX,e.deltaY];r===0&&e.shiftKey&&([t,r]=[e.deltaY,e.deltaX]);let[s,n]=[Math.sign(t),Math.sign(r)],[o,a]=[Math.abs(t),Math.abs(r)],l=typeof a=="number"&&isFinite(o)&&Math.floor(o)===o,c=typeof a=="number"&&isFinite(a)&&Math.floor(a)===a,u=l?0:.001,h=c?0:.001;if(e.deltaMode!==WheelEvent.DOM_DELTA_PIXEL){let m;e.deltaMode===WheelEvent.DOM_DELTA_LINE?m=8:e.deltaMode===WheelEvent.DOM_DELTA_PAGE?m=24:m=1,o*=m,a*=m}let d=40,f=s*(Math.min(d,o)+u),p=n*(Math.min(d,a)+h);return[f,p]}};var xB=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,vB=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform float gamma;
uniform float contrast;
uniform float saturation;
uniform float brightness;
uniform float red;
uniform float green;
uniform float blue;
uniform float alpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (c.a > 0.0) {
        c.rgb /= c.a;

        vec3 rgb = pow(c.rgb, vec3(1. / gamma));
        rgb = mix(vec3(.5), mix(vec3(dot(vec3(.2125, .7154, .0721), rgb)), rgb, saturation), contrast);
        rgb.r *= red;
        rgb.g *= green;
        rgb.b *= blue;
        c.rgb = rgb * brightness;

        c.rgb *= c.a;
    }

    gl_FragColor = c * alpha;
}
`,Pd=class extends ye{constructor(e){super(xB,vB),this.gamma=1,this.saturation=1,this.contrast=1,this.brightness=1,this.red=1,this.green=1,this.blue=1,this.alpha=1,Object.assign(this,e)}apply(e,t,r,s){this.uniforms.gamma=Math.max(this.gamma,1e-4),this.uniforms.saturation=this.saturation,this.uniforms.contrast=this.contrast,this.uniforms.brightness=this.brightness,this.uniforms.red=this.red,this.uniforms.green=this.green,this.uniforms.blue=this.blue,this.uniforms.alpha=this.alpha,e.applyFilter(this,t,r,s)}};var _B=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,bB=`
varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec2 uOffset;

void main(void)
{
    vec4 color = vec4(0.0);

    // Sample top left pixel
    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y));

    // Sample top right pixel
    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y));

    // Sample bottom right pixel
    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y));

    // Sample bottom left pixel
    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y));

    // Average
    color *= 0.25;

    gl_FragColor = color;
}`,wB=`
varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec2 uOffset;
uniform vec4 filterClamp;

void main(void)
{
    vec4 color = vec4(0.0);

    // Sample top left pixel
    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));

    // Sample top right pixel
    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));

    // Sample bottom right pixel
    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));

    // Sample bottom left pixel
    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));

    // Average
    color *= 0.25;

    gl_FragColor = color;
}
`,va=class extends ye{constructor(e=4,t=3,r=!1){super(_B,r?wB:bB),this._kernels=[],this._blur=4,this._quality=3,this.uniforms.uOffset=new Float32Array(2),this._pixelSize=new _e,this.pixelSize=1,this._clamp=r,Array.isArray(e)?this.kernels=e:(this._blur=e,this.quality=t)}apply(e,t,r,s){let n=this._pixelSize.x/t._frame.width,o=this._pixelSize.y/t._frame.height,a;if(this._quality===1||this._blur===0)a=this._kernels[0]+.5,this.uniforms.uOffset[0]=a*n,this.uniforms.uOffset[1]=a*o,e.applyFilter(this,t,r,s);else{let l=e.getFilterTexture(),c=t,u=l,h,d=this._quality-1;for(let f=0;f<d;f++)a=this._kernels[f]+.5,this.uniforms.uOffset[0]=a*n,this.uniforms.uOffset[1]=a*o,e.applyFilter(this,c,u,1),h=c,c=u,u=h;a=this._kernels[d]+.5,this.uniforms.uOffset[0]=a*n,this.uniforms.uOffset[1]=a*o,e.applyFilter(this,c,r,s),e.returnFilterTexture(l)}}_updatePadding(){this.padding=Math.ceil(this._kernels.reduce((e,t)=>e+t+.5,0))}_generateKernels(){let e=this._blur,t=this._quality,r=[e];if(e>0){let s=e,n=e/t;for(let o=1;o<t;o++)s-=n,r.push(s)}this._kernels=r,this._updatePadding()}get kernels(){return this._kernels}set kernels(e){Array.isArray(e)&&e.length>0?(this._kernels=e,this._quality=e.length,this._blur=Math.max(...e)):(this._kernels=[0],this._quality=1)}get clamp(){return this._clamp}set pixelSize(e){typeof e=="number"?(this._pixelSize.x=e,this._pixelSize.y=e):Array.isArray(e)?(this._pixelSize.x=e[0],this._pixelSize.y=e[1]):e instanceof _e?(this._pixelSize.x=e.x,this._pixelSize.y=e.y):(this._pixelSize.x=1,this._pixelSize.y=1)}get pixelSize(){return this._pixelSize}get quality(){return this._quality}set quality(e){this._quality=Math.max(1,Math.round(e)),this._generateKernels()}get blur(){return this._blur}set blur(e){this._blur=e,this._generateKernels()}};var YS=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,EB=`
uniform sampler2D uSampler;
varying vec2 vTextureCoord;

uniform float threshold;

void main() {
    vec4 color = texture2D(uSampler, vTextureCoord);

    // A simple & fast algorithm for getting brightness.
    // It's inaccuracy , but good enought for this feature.
    float _max = max(max(color.r, color.g), color.b);
    float _min = min(min(color.r, color.g), color.b);
    float brightness = (_max + _min) * 0.5;

    if(brightness > threshold) {
        gl_FragColor = color;
    } else {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
    }
}
`,tm=class extends ye{constructor(e=.5){super(YS,EB),this.threshold=e}get threshold(){return this.uniforms.threshold}set threshold(e){this.uniforms.threshold=e}},AB=`uniform sampler2D uSampler;
varying vec2 vTextureCoord;

uniform sampler2D bloomTexture;
uniform float bloomScale;
uniform float brightness;

void main() {
    vec4 color = texture2D(uSampler, vTextureCoord);
    color.rgb *= brightness;
    vec4 bloomColor = vec4(texture2D(bloomTexture, vTextureCoord).rgb, 0.0);
    bloomColor.rgb *= bloomScale;
    gl_FragColor = color + bloomColor;
}
`,KS=class extends ye{constructor(i){super(YS,AB),this.bloomScale=1,this.brightness=1,this._resolution=te.FILTER_RESOLUTION,typeof i=="number"&&(i={threshold:i});let e=Object.assign(KS.defaults,i);this.bloomScale=e.bloomScale,this.brightness=e.brightness;let{kernels:t,blur:r,quality:s,pixelSize:n,resolution:o}=e;this._extractFilter=new tm(e.threshold),this._extractFilter.resolution=o,this._blurFilter=t?new va(t):new va(r,s),this.pixelSize=n,this.resolution=o}apply(i,e,t,r,s){let n=i.getFilterTexture();this._extractFilter.apply(i,e,n,1,s);let o=i.getFilterTexture();this._blurFilter.apply(i,n,o,1),this.uniforms.bloomScale=this.bloomScale,this.uniforms.brightness=this.brightness,this.uniforms.bloomTexture=o,i.applyFilter(this,e,t,r),i.returnFilterTexture(o),i.returnFilterTexture(n)}get resolution(){return this._resolution}set resolution(i){this._resolution=i,this._extractFilter&&(this._extractFilter.resolution=i),this._blurFilter&&(this._blurFilter.resolution=i)}get threshold(){return this._extractFilter.threshold}set threshold(i){this._extractFilter.threshold=i}get kernels(){return this._blurFilter.kernels}set kernels(i){this._blurFilter.kernels=i}get blur(){return this._blurFilter.blur}set blur(i){this._blurFilter.blur=i}get quality(){return this._blurFilter.quality}set quality(i){this._blurFilter.quality=i}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(i){this._blurFilter.pixelSize=i}},SB=KS;SB.defaults={threshold:.5,bloomScale:1,brightness:1,kernels:null,blur:8,quality:4,pixelSize:1,resolution:te.FILTER_RESOLUTION};var CB=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,kB=`uniform float radius;
uniform float strength;
uniform vec2 center;
uniform sampler2D uSampler;
varying vec2 vTextureCoord;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec2 dimensions;

void main()
{
    vec2 coord = vTextureCoord * filterArea.xy;
    coord -= center * dimensions.xy;
    float distance = length(coord);
    if (distance < radius) {
        float percent = distance / radius;
        if (strength > 0.0) {
            coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);
        } else {
            coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);
        }
    }
    coord += center * dimensions.xy;
    coord /= filterArea.xy;
    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);
    vec4 color = texture2D(uSampler, clampedCoord);
    if (coord != clampedCoord) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    gl_FragColor = color;
}
`,ZS=class extends ye{constructor(i){super(CB,kB),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,ZS.defaults,i)}apply(i,e,t,r){let{width:s,height:n}=e.filterFrame;this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,i.applyFilter(this,e,t,r)}get radius(){return this.uniforms.radius}set radius(i){this.uniforms.radius=i}get strength(){return this.uniforms.strength}set strength(i){this.uniforms.strength=i}get center(){return this.uniforms.center}set center(i){this.uniforms.center=i}},TB=ZS;TB.defaults={center:[.5,.5],radius:100,strength:1};var IB=`const float PI = 3.1415926538;
const float PI_2 = PI*2.;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;
uniform sampler2D uSampler;

const int TYPE_LINEAR = 0;
const int TYPE_RADIAL = 1;
const int TYPE_CONIC = 2;
const int MAX_STOPS = 32;

uniform int uNumStops;
uniform float uAlphas[3*MAX_STOPS];
uniform vec3 uColors[MAX_STOPS];
uniform float uOffsets[MAX_STOPS];
uniform int uType;
uniform float uAngle;
uniform float uAlpha;
uniform int uMaxColors;

struct ColorStop {
    float offset;
    vec3 color;
    float alpha;
};

mat2 rotate2d(float angle){
    return mat2(cos(angle), -sin(angle),
    sin(angle), cos(angle));
}

float projectLinearPosition(vec2 pos, float angle){
    vec2 center = vec2(0.5);
    vec2 result = pos - center;
    result = rotate2d(angle) * result;
    result = result + center;
    return clamp(result.x, 0., 1.);
}

float projectRadialPosition(vec2 pos) {
    float r = distance(vFilterCoord, vec2(0.5));
    return clamp(2.*r, 0., 1.);
}

float projectAnglePosition(vec2 pos, float angle) {
    vec2 center = pos - vec2(0.5);
    float polarAngle=atan(-center.y, center.x);
    return mod(polarAngle + angle, PI_2) / PI_2;
}

float projectPosition(vec2 pos, int type, float angle) {
    if (type == TYPE_LINEAR) {
        return projectLinearPosition(pos, angle);
    } else if (type == TYPE_RADIAL) {
        return projectRadialPosition(pos);
    } else if (type == TYPE_CONIC) {
        return projectAnglePosition(pos, angle);
    }

    return pos.y;
}

void main(void) {
    // current/original color
    vec4 currentColor = texture2D(uSampler, vTextureCoord);

    // skip calculations if gradient alpha is 0
    if (0.0 == uAlpha) {
        gl_FragColor = currentColor;
        return;
    }

    // project position
    float y = projectPosition(vFilterCoord, uType, radians(uAngle));

    // check gradient bounds
    float offsetMin = uOffsets[0];
    float offsetMax = 0.0;

    for (int i = 0; i < MAX_STOPS; i++) {
        if (i == uNumStops-1){ // last index
            offsetMax = uOffsets[i];
        }
    }

    if (y  < offsetMin || y > offsetMax) {
        gl_FragColor = currentColor;
        return;
    }

    // limit colors
    if (uMaxColors > 0) {
        float stepSize = 1./float(uMaxColors);
        float stepNumber = float(floor(y/stepSize));
        y = stepSize * (stepNumber + 0.5);// offset by 0.5 to use color from middle of segment
    }

    // find color stops
    ColorStop from;
    ColorStop to;

    for (int i = 0; i < MAX_STOPS; i++) {
        if (y >= uOffsets[i]) {
            from = ColorStop(uOffsets[i], uColors[i], uAlphas[i]);
            to = ColorStop(uOffsets[i+1], uColors[i+1], uAlphas[i+1]);
        }

        if (i == uNumStops-1){ // last index
            break;
        }
    }

    // mix colors from stops
    vec4 colorFrom = vec4(from.color * from.alpha, from.alpha);
    vec4 colorTo = vec4(to.color * to.alpha, to.alpha);

    float segmentHeight = to.offset - from.offset;
    float relativePos = y - from.offset;// position from 0 to [segmentHeight]
    float relativePercent = relativePos / segmentHeight;// position in percent between [from.offset] and [to.offset].

    float gradientAlpha = uAlpha * currentColor.a;
    vec4 gradientColor = mix(colorFrom, colorTo, relativePercent) * gradientAlpha;

    // mix resulting color with current color
    gl_FragColor = gradientColor + currentColor*(1.-gradientColor.a);
}
`,MB=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform vec4 inputSize;
uniform vec4 outputFrame;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
    vFilterCoord = vTextureCoord * inputSize.xy / outputFrame.zw;
}
`,gl=gl||{};gl.stringify=function(){var i={"visit_linear-gradient":function(e){return i.visit_gradient(e)},"visit_repeating-linear-gradient":function(e){return i.visit_gradient(e)},"visit_radial-gradient":function(e){return i.visit_gradient(e)},"visit_repeating-radial-gradient":function(e){return i.visit_gradient(e)},visit_gradient:function(e){var t=i.visit(e.orientation);return t&&(t+=", "),e.type+"("+t+i.visit(e.colorStops)+")"},visit_shape:function(e){var t=e.value,r=i.visit(e.at),s=i.visit(e.style);return s&&(t+=" "+s),r&&(t+=" at "+r),t},"visit_default-radial":function(e){var t="",r=i.visit(e.at);return r&&(t+=r),t},"visit_extent-keyword":function(e){var t=e.value,r=i.visit(e.at);return r&&(t+=" at "+r),t},"visit_position-keyword":function(e){return e.value},visit_position:function(e){return i.visit(e.value.x)+" "+i.visit(e.value.y)},"visit_%":function(e){return e.value+"%"},visit_em:function(e){return e.value+"em"},visit_px:function(e){return e.value+"px"},visit_literal:function(e){return i.visit_color(e.value,e)},visit_hex:function(e){return i.visit_color("#"+e.value,e)},visit_rgb:function(e){return i.visit_color("rgb("+e.value.join(", ")+")",e)},visit_rgba:function(e){return i.visit_color("rgba("+e.value.join(", ")+")",e)},visit_color:function(e,t){var r=e,s=i.visit(t.length);return s&&(r+=" "+s),r},visit_angular:function(e){return e.value+"deg"},visit_directional:function(e){return"to "+e.value},visit_array:function(e){var t="",r=e.length;return e.forEach(function(s,n){t+=i.visit(s),n<r-1&&(t+=", ")}),t},visit:function(e){if(!e)return"";var t="";if(e instanceof Array)return i.visit_array(e,t);if(e.type){var r=i["visit_"+e.type];if(r)return r(e);throw Error("Missing visitor visit_"+e.type)}else throw Error("Invalid node.")}};return function(e){return i.visit(e)}}();var gl=gl||{};gl.parse=function(){var i={linearGradient:/^(\-(webkit|o|ms|moz)\-)?(linear\-gradient)/i,repeatingLinearGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-linear\-gradient)/i,radialGradient:/^(\-(webkit|o|ms|moz)\-)?(radial\-gradient)/i,repeatingRadialGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-radial\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/^\#([0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^rgb/i,rgbaColor:/^rgba/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/},e="";function t(O){var R=new Error(e+": "+O);throw R.source=e,R}function r(){var O=s();return e.length>0&&t("Invalid input not EOF"),O}function s(){return b(n)}function n(){return o("linear-gradient",i.linearGradient,l)||o("repeating-linear-gradient",i.repeatingLinearGradient,l)||o("radial-gradient",i.radialGradient,h)||o("repeating-radial-gradient",i.repeatingRadialGradient,h)}function o(O,R,N){return a(R,function(F){var B=N();return B&&(P(i.comma)||t("Missing comma before color stops")),{type:O,orientation:B,colorStops:b(_)}})}function a(O,R){var N=P(O);if(N){P(i.startCall)||t("Missing (");var F=R(N);return P(i.endCall)||t("Missing )"),F}}function l(){return c()||u()}function c(){return C("directional",i.sideOrCorner,1)}function u(){return C("angular",i.angleValue,1)}function h(){var O,R=d(),N;return R&&(O=[],O.push(R),N=e,P(i.comma)&&(R=d(),R?O.push(R):e=N)),O}function d(){var O=f()||p();if(O)O.at=g();else{var R=m();if(R){O=R;var N=g();N&&(O.at=N)}else{var F=y();F&&(O={type:"default-radial",at:F})}}return O}function f(){var O=C("shape",/^(circle)/i,0);return O&&(O.style=T()||m()),O}function p(){var O=C("shape",/^(ellipse)/i,0);return O&&(O.style=M()||m()),O}function m(){return C("extent-keyword",i.extentKeywords,1)}function g(){if(C("position",/^at/,0)){var O=y();return O||t("Missing positioning value"),O}}function y(){var O=x();if(O.x||O.y)return{type:"position",value:O}}function x(){return{x:M(),y:M()}}function b(O){var R=O(),N=[];if(R)for(N.push(R);P(i.comma);)R=O(),R?N.push(R):t("One extra comma");return N}function _(){var O=w();return O||t("Expected color definition"),O.length=M(),O}function w(){return k()||E()||v()||A()}function A(){return C("literal",i.literalColor,0)}function k(){return C("hex",i.hexColor,1)}function v(){return a(i.rgbColor,function(){return{type:"rgb",value:b(S)}})}function E(){return a(i.rgbaColor,function(){return{type:"rgba",value:b(S)}})}function S(){return P(i.number)[1]}function M(){return C("%",i.percentageValue,1)||I()||T()}function I(){return C("position-keyword",i.positionKeywords,1)}function T(){return C("px",i.pixelValue,1)||C("em",i.emValue,1)}function C(O,R,N){var F=P(R);if(F)return{type:O,value:F[N]}}function P(O){var R,N;return N=/^[\n\r\t\s]+/.exec(e),N&&D(N[0].length),R=O.exec(e),R&&D(R[0].length),R}function D(O){e=e.substr(O)}return function(O){return e=O.toString(),r()}}();var PB=gl.parse;gl.stringify;var JS={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},eC={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function DB(i){var e,t=[],r=1,s;if(typeof i=="string")if(JS[i])t=JS[i].slice(),s="rgb";else if(i==="transparent")r=0,s="rgb",t=[0,0,0];else if(/^#[A-Fa-f0-9]+$/.test(i)){var n=i.slice(1),o=n.length,a=o<=4;r=1,a?(t=[parseInt(n[0]+n[0],16),parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16)],o===4&&(r=parseInt(n[3]+n[3],16)/255)):(t=[parseInt(n[0]+n[1],16),parseInt(n[2]+n[3],16),parseInt(n[4]+n[5],16)],o===8&&(r=parseInt(n[6]+n[7],16)/255)),t[0]||(t[0]=0),t[1]||(t[1]=0),t[2]||(t[2]=0),s="rgb"}else if(e=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(i)){var l=e[1],c=l==="rgb",n=l.replace(/a$/,"");s=n;var o=n==="cmyk"?4:n==="gray"?1:3;t=e[2].trim().split(/\s*[,\/]\s*|\s+/).map(function(d,f){if(/%$/.test(d))return f===o?parseFloat(d)/100:n==="rgb"?parseFloat(d)*255/100:parseFloat(d);if(n[f]==="h"){if(/deg$/.test(d))return parseFloat(d);if(eC[d]!==void 0)return eC[d]}return parseFloat(d)}),l===n&&t.push(1),r=c||t[o]===void 0?1:t[o],t=t.slice(0,o)}else i.length>10&&/[0-9](?:\s|\/)/.test(i)&&(t=i.match(/([0-9]+)/g).map(function(u){return parseFloat(u)}),s=i.match(/([a-z])/ig).join("").toLowerCase());else isNaN(i)?Array.isArray(i)||i.length?(t=[i[0],i[1],i[2]],s="rgb",r=i.length===4?i[3]:1):i instanceof Object&&(i.r!=null||i.red!=null||i.R!=null?(s="rgb",t=[i.r||i.red||i.R||0,i.g||i.green||i.G||0,i.b||i.blue||i.B||0]):(s="hsl",t=[i.h||i.hue||i.H||0,i.s||i.saturation||i.S||0,i.l||i.lightness||i.L||i.b||i.brightness]),r=i.a||i.alpha||i.opacity||1,i.opacity!=null&&(r/=100)):(s="rgb",t=[i>>>16,(i&65280)>>>8,i&255]);return{space:s,values:t,alpha:r}}var sm={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]},im={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var e=i[0]/360,t=i[1]/100,r=i[2]/100,s,n,o,a,l;if(t===0)return l=r*255,[l,l,l];r<.5?n=r*(1+t):n=r+t-r*t,s=2*r-n,a=[0,0,0];for(var c=0;c<3;c++)o=e+1/3*-(c-1),o<0?o++:o>1&&o--,6*o<1?l=s+(n-s)*6*o:2*o<1?l=n:3*o<2?l=s+(n-s)*(2/3-o)*6:l=s,a[c]=l*255;return a}};sm.hsl=function(i){var e=i[0]/255,t=i[1]/255,r=i[2]/255,s=Math.min(e,t,r),n=Math.max(e,t,r),o=n-s,a,l,c;return n===s?a=0:e===n?a=(t-r)/o:t===n?a=2+(r-e)/o:r===n&&(a=4+(e-t)/o),a=Math.min(a*60,360),a<0&&(a+=360),c=(s+n)/2,n===s?l=0:c<=.5?l=o/(n+s):l=o/(2-n-s),[a,l*100,c*100]};function RB(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments));var e,t=DB(i);if(!t.space)return[];let r=t.space[0]==="h"?im.min:sm.min,s=t.space[0]==="h"?im.max:sm.max;return e=Array(3),e[0]=Math.min(Math.max(t.values[0],r[0]),s[0]),e[1]=Math.min(Math.max(t.values[1],r[1]),s[1]),e[2]=Math.min(Math.max(t.values[2],r[2]),s[2]),t.space[0]==="h"&&(e=im.rgb(e)),e.push(Math.min(Math.max(t.alpha,0),1)),e}function sC(i){switch(typeof i){case"string":return NB(i);case"number":return se.hex2rgb(i);default:return i}}function NB(i){let e=RB(i);if(!e)throw new Error(`Unable to parse color "${i}" as RGBA.`);return[e[0]/255,e[1]/255,e[2]/255,e[3]]}function FB(i){let e=PB(jB(i));if(e.length===0)throw new Error("Invalid CSS gradient.");if(e.length!==1)throw new Error("Unsupported CSS gradient (multiple gradients is not supported).");let t=e[0],r=LB(t.type),s=OB(t.colorStops),n=GB(t.orientation);return{type:r,stops:s,angle:n}}function LB(i){let e={"linear-gradient":0,"radial-gradient":1};if(!(i in e))throw new Error(`Unsupported gradient type "${i}"`);return e[i]}function OB(i){let e=$B(i),t=[];for(let r=0;r<i.length;r++){let s=BB(i[r]);t.push({offset:e[r],color:s.slice(0,3),alpha:s[3]})}return t}function BB(i){return sC(UB(i))}function UB(i){switch(i.type){case"hex":return`#${i.value}`;case"literal":return i.value;default:return`${i.type}(${i.value.join(",")})`}}function $B(i){let e=[];for(let s=0;s<i.length;s++){let n=i[s],o=-1;n.type==="literal"&&n.length&&"type"in n.length&&n.length.type==="%"&&"value"in n.length&&(o=parseFloat(n.length.value)/100),e.push(o)}let t=s=>{for(let n=s;n<e.length;n++)if(e[n]!==-1)return{indexDelta:n-s,offset:e[n]};return{indexDelta:e.length-1-s,offset:1}},r=0;for(let s=0;s<e.length;s++){let n=e[s];if(n!==-1)r=n;else if(s===0)e[s]=0;else if(s+1===e.length)e[s]=1;else{let o=t(s),a=(o.offset-r)/(1+o.indexDelta);for(let l=0;l<=o.indexDelta;l++)e[s+l]=r+(l+1)*a;s+=o.indexDelta,r=e[s]}}return e.map(HB)}function HB(i){return i.toString().length>6?parseFloat(i.toString().substring(0,6)):i}function GB(i){if(typeof i=="undefined")return 0;if("type"in i&&"value"in i)switch(i.type){case"angular":return parseFloat(i.value);case"directional":return zB(i.value)}return 0}function zB(i){let e={left:270,top:0,bottom:180,right:90,"left top":315,"top left":315,"left bottom":225,"bottom left":225,"right top":45,"top right":45,"right bottom":135,"bottom right":135};if(!(i in e))throw new Error(`Unsupported directional value "${i}"`);return e[i]}function jB(i){let e=i.replace(/\s{2,}/gu," ");return e=e.replace(/;/g,""),e=e.replace(/ ,/g,","),e=e.replace(/\( /g,"("),e=e.replace(/ \)/g,")"),e.trim()}var VB=Object.defineProperty,WB=Object.defineProperties,XB=Object.getOwnPropertyDescriptors,tC=Object.getOwnPropertySymbols,qB=Object.prototype.hasOwnProperty,QB=Object.prototype.propertyIsEnumerable,iC=(i,e,t)=>e in i?VB(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,rm=(i,e)=>{for(var t in e||(e={}))qB.call(e,t)&&iC(i,t,e[t]);if(tC)for(var t of tC(e))QB.call(e,t)&&iC(i,t,e[t]);return i},YB=(i,e)=>WB(i,XB(e)),rC=90;function KB(i){return[...i].sort((e,t)=>e.offset-t.offset)}var nm=class extends ye{constructor(i){i&&"css"in i&&(i=YB(rm({},FB(i.css||"")),{alpha:i.alpha,maxColors:i.maxColors}));let e=rm(rm({},nm.defaults),i);if(!e.stops||e.stops.length<2)throw new Error("ColorGradientFilter requires at least 2 color stops.");super(MB,IB),this._stops=[],this.autoFit=!1,Object.assign(this,e)}get stops(){return this._stops}set stops(i){let e=KB(i),t=new Float32Array(e.length*3),r=0,s=1,n=2;for(let o=0;o<e.length;o++){let a=sC(e[o].color),l=o*3;t[l+r]=a[r],t[l+s]=a[s],t[l+n]=a[n]}this.uniforms.uColors=t,this.uniforms.uOffsets=e.map(o=>o.offset),this.uniforms.uAlphas=e.map(o=>o.alpha),this.uniforms.uNumStops=e.length,this._stops=e}set type(i){this.uniforms.uType=i}get type(){return this.uniforms.uType}set angle(i){this.uniforms.uAngle=i-rC}get angle(){return this.uniforms.uAngle+rC}set alpha(i){this.uniforms.uAlpha=i}get alpha(){return this.uniforms.uAlpha}set maxColors(i){this.uniforms.uMaxColors=i}get maxColors(){return this.uniforms.uMaxColors}},Dd=nm;Dd.LINEAR=0,Dd.RADIAL=1,Dd.CONIC=2,Dd.defaults={type:nm.LINEAR,stops:[{offset:0,color:16711680,alpha:1},{offset:1,color:255,alpha:1}],alpha:1,angle:90,maxColors:0};var ZB=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,JB=`precision mediump float;

varying mediump vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec2 texelSize;
uniform float matrix[9];

void main(void)
{
   vec4 c11 = texture2D(uSampler, vTextureCoord - texelSize); // top left
   vec4 c12 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - texelSize.y)); // top center
   vec4 c13 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y - texelSize.y)); // top right

   vec4 c21 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y)); // mid left
   vec4 c22 = texture2D(uSampler, vTextureCoord); // mid center
   vec4 c23 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y)); // mid right

   vec4 c31 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y + texelSize.y)); // bottom left
   vec4 c32 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + texelSize.y)); // bottom center
   vec4 c33 = texture2D(uSampler, vTextureCoord + texelSize); // bottom right

   gl_FragColor =
       c11 * matrix[0] + c12 * matrix[1] + c13 * matrix[2] +
       c21 * matrix[3] + c22 * matrix[4] + c23 * matrix[5] +
       c31 * matrix[6] + c32 * matrix[7] + c33 * matrix[8];

   gl_FragColor.a = c22.a;
}
`,Rd=class extends ye{constructor(e,t=200,r=200){super(ZB,JB),this.uniforms.texelSize=new Float32Array(2),this.uniforms.matrix=new Float32Array(9),e!==void 0&&(this.matrix=e),this.width=t,this.height=r}get matrix(){return this.uniforms.matrix}set matrix(e){e.forEach((t,r)=>{this.uniforms.matrix[r]=t})}get width(){return 1/this.uniforms.texelSize[0]}set width(e){this.uniforms.texelSize[0]=1/e}get height(){return 1/this.uniforms.texelSize[1]}set height(e){this.uniforms.texelSize[1]=1/e}};var eU=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,tU=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec4 filterArea;
uniform vec2 dimensions;

const float SQRT_2 = 1.414213;

const float light = 1.0;

uniform float curvature;
uniform float lineWidth;
uniform float lineContrast;
uniform bool verticalLine;
uniform float noise;
uniform float noiseSize;

uniform float vignetting;
uniform float vignettingAlpha;
uniform float vignettingBlur;

uniform float seed;
uniform float time;

float rand(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main(void)
{
    vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;
    vec2 dir = vec2(vTextureCoord.xy * filterArea.xy / dimensions - vec2(0.5, 0.5));
    
    gl_FragColor = texture2D(uSampler, vTextureCoord);
    vec3 rgb = gl_FragColor.rgb;

    if (noise > 0.0 && noiseSize > 0.0)
    {
        pixelCoord.x = floor(pixelCoord.x / noiseSize);
        pixelCoord.y = floor(pixelCoord.y / noiseSize);
        float _noise = rand(pixelCoord * noiseSize * seed) - 0.5;
        rgb += _noise * noise;
    }

    if (lineWidth > 0.0)
    {
        float _c = curvature > 0. ? curvature : 1.;
        float k = curvature > 0. ?(length(dir * dir) * 0.25 * _c * _c + 0.935 * _c) : 1.;
        vec2 uv = dir * k;

        float v = (verticalLine ? uv.x * dimensions.x : uv.y * dimensions.y) * min(1.0, 2.0 / lineWidth ) / _c;
        float j = 1. + cos(v * 1.2 - time) * 0.5 * lineContrast;
        rgb *= j;
        float segment = verticalLine ? mod((dir.x + .5) * dimensions.x, 4.) : mod((dir.y + .5) * dimensions.y, 4.);
        rgb *= 0.99 + ceil(segment) * 0.015;
    }

    if (vignetting > 0.0)
    {
        float outter = SQRT_2 - vignetting * SQRT_2;
        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignettingBlur * SQRT_2), 0.0, 1.0);
        rgb *= darker + (1.0 - darker) * (1.0 - vignettingAlpha);
    }

    gl_FragColor.rgb = rgb;
}
`,nC=class extends ye{constructor(i){super(eU,tU),this.time=0,this.seed=0,this.uniforms.dimensions=new Float32Array(2),Object.assign(this,nC.defaults,i)}apply(i,e,t,r){let{width:s,height:n}=e.filterFrame;this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,this.uniforms.seed=this.seed,this.uniforms.time=this.time,i.applyFilter(this,e,t,r)}set curvature(i){this.uniforms.curvature=i}get curvature(){return this.uniforms.curvature}set lineWidth(i){this.uniforms.lineWidth=i}get lineWidth(){return this.uniforms.lineWidth}set lineContrast(i){this.uniforms.lineContrast=i}get lineContrast(){return this.uniforms.lineContrast}set verticalLine(i){this.uniforms.verticalLine=i}get verticalLine(){return this.uniforms.verticalLine}set noise(i){this.uniforms.noise=i}get noise(){return this.uniforms.noise}set noiseSize(i){this.uniforms.noiseSize=i}get noiseSize(){return this.uniforms.noiseSize}set vignetting(i){this.uniforms.vignetting=i}get vignetting(){return this.uniforms.vignetting}set vignettingAlpha(i){this.uniforms.vignettingAlpha=i}get vignettingAlpha(){return this.uniforms.vignettingAlpha}set vignettingBlur(i){this.uniforms.vignettingBlur=i}get vignettingBlur(){return this.uniforms.vignettingBlur}},iU=nC;iU.defaults={curvature:1,lineWidth:1,lineContrast:.25,verticalLine:!1,noise:0,noiseSize:1,seed:0,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3,time:0};var rU=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,sU=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float alpha;
uniform vec3 color;

uniform vec2 shift;
uniform vec4 inputSize;

void main(void){
    vec4 sample = texture2D(uSampler, vTextureCoord - shift * inputSize.zw);

    // Premultiply alpha
    sample.rgb = color.rgb * sample.a;

    // alpha user alpha
    sample *= alpha;

    gl_FragColor = sample;
}`,nU=Object.defineProperty,oC=Object.getOwnPropertySymbols,oU=Object.prototype.hasOwnProperty,aU=Object.prototype.propertyIsEnumerable,aC=(i,e,t)=>e in i?nU(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,lC=(i,e)=>{for(var t in e||(e={}))oU.call(e,t)&&aC(i,t,e[t]);if(oC)for(var t of oC(e))aU.call(e,t)&&aC(i,t,e[t]);return i},om=class extends ye{constructor(i){super(),this.angle=45,this._distance=5,this._resolution=te.FILTER_RESOLUTION;let e=i?lC(lC({},om.defaults),i):om.defaults,{kernels:t,blur:r,quality:s,pixelSize:n,resolution:o}=e;this._offset=new sr(this._updatePadding,this),this._tintFilter=new ye(rU,sU),this._tintFilter.uniforms.color=new Float32Array(4),this._tintFilter.uniforms.shift=this._offset,this._tintFilter.resolution=o,this._blurFilter=t?new va(t):new va(r,s),this.pixelSize=n,this.resolution=o;let{shadowOnly:a,rotation:l,distance:c,offset:u,alpha:h,color:d}=e;this.shadowOnly=a,l!==void 0&&c!==void 0?(this.rotation=l,this.distance=c):this.offset=u,this.alpha=h,this.color=d}apply(i,e,t,r){let s=i.getFilterTexture();this._tintFilter.apply(i,e,s,1),this._blurFilter.apply(i,s,t,r),this.shadowOnly!==!0&&i.applyFilter(this,e,t,0),i.returnFilterTexture(s)}_updatePadding(){let i=Math.max(Math.abs(this._offset.x),Math.abs(this._offset.y));this.padding=i+this.blur*2}_updateShift(){this._tintFilter.uniforms.shift.set(this.distance*Math.cos(this.angle),this.distance*Math.sin(this.angle))}set offset(i){this._offset.copyFrom(i),this._updatePadding()}get offset(){return this._offset}get resolution(){return this._resolution}set resolution(i){this._resolution=i,this._tintFilter&&(this._tintFilter.resolution=i),this._blurFilter&&(this._blurFilter.resolution=i)}get distance(){return this._distance}set distance(i){se.deprecation("5.3.0","DropShadowFilter distance is deprecated, use offset"),this._distance=i,this._updatePadding(),this._updateShift()}get rotation(){return this.angle/Ks}set rotation(i){se.deprecation("5.3.0","DropShadowFilter rotation is deprecated, use offset"),this.angle=i*Ks,this._updateShift()}get alpha(){return this._tintFilter.uniforms.alpha}set alpha(i){this._tintFilter.uniforms.alpha=i}get color(){return se.rgb2hex(this._tintFilter.uniforms.color)}set color(i){se.hex2rgb(i,this._tintFilter.uniforms.color)}get kernels(){return this._blurFilter.kernels}set kernels(i){this._blurFilter.kernels=i}get blur(){return this._blurFilter.blur}set blur(i){this._blurFilter.blur=i,this._updatePadding()}get quality(){return this._blurFilter.quality}set quality(i){this._blurFilter.quality=i}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(i){this._blurFilter.pixelSize=i}},lU=om;lU.defaults={offset:{x:4,y:4},color:0,alpha:.5,shadowOnly:!1,kernels:null,blur:2,quality:3,pixelSize:1,resolution:te.FILTER_RESOLUTION};var cU=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,uU=`// precision highp float;

varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec2 dimensions;
uniform float aspect;

uniform sampler2D displacementMap;
uniform float offset;
uniform float sinDir;
uniform float cosDir;
uniform int fillMode;

uniform float seed;
uniform vec2 red;
uniform vec2 green;
uniform vec2 blue;

const int TRANSPARENT = 0;
const int ORIGINAL = 1;
const int LOOP = 2;
const int CLAMP = 3;
const int MIRROR = 4;

void main(void)
{
    vec2 coord = (vTextureCoord * filterArea.xy) / dimensions;

    if (coord.x > 1.0 || coord.y > 1.0) {
        return;
    }

    float cx = coord.x - 0.5;
    float cy = (coord.y - 0.5) * aspect;
    float ny = (-sinDir * cx + cosDir * cy) / aspect + 0.5;

    // displacementMap: repeat
    // ny = ny > 1.0 ? ny - 1.0 : (ny < 0.0 ? 1.0 + ny : ny);

    // displacementMap: mirror
    ny = ny > 1.0 ? 2.0 - ny : (ny < 0.0 ? -ny : ny);

    vec4 dc = texture2D(displacementMap, vec2(0.5, ny));

    float displacement = (dc.r - dc.g) * (offset / filterArea.x);

    coord = vTextureCoord + vec2(cosDir * displacement, sinDir * displacement * aspect);

    if (fillMode == CLAMP) {
        coord = clamp(coord, filterClamp.xy, filterClamp.zw);
    } else {
        if( coord.x > filterClamp.z ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.x -= filterClamp.z;
            } else if (fillMode == MIRROR) {
                coord.x = filterClamp.z * 2.0 - coord.x;
            }
        } else if( coord.x < filterClamp.x ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.x += filterClamp.z;
            } else if (fillMode == MIRROR) {
                coord.x *= -filterClamp.z;
            }
        }

        if( coord.y > filterClamp.w ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.y -= filterClamp.w;
            } else if (fillMode == MIRROR) {
                coord.y = filterClamp.w * 2.0 - coord.y;
            }
        } else if( coord.y < filterClamp.y ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.y += filterClamp.w;
            } else if (fillMode == MIRROR) {
                coord.y *= -filterClamp.w;
            }
        }
    }

    gl_FragColor.r = texture2D(uSampler, coord + red * (1.0 - seed * 0.4) / filterArea.xy).r;
    gl_FragColor.g = texture2D(uSampler, coord + green * (1.0 - seed * 0.3) / filterArea.xy).g;
    gl_FragColor.b = texture2D(uSampler, coord + blue * (1.0 - seed * 0.2) / filterArea.xy).b;
    gl_FragColor.a = texture2D(uSampler, coord).a;
}
`,am=class extends ye{constructor(i){super(cU,uU),this.offset=100,this.fillMode=am.TRANSPARENT,this.average=!1,this.seed=0,this.minSize=8,this.sampleSize=512,this._slices=0,this._offsets=new Float32Array(1),this._sizes=new Float32Array(1),this._direction=-1,this.uniforms.dimensions=new Float32Array(2),this._canvas=document.createElement("canvas"),this._canvas.width=4,this._canvas.height=this.sampleSize,this.texture=xe.from(this._canvas,{scaleMode:Xi.NEAREST}),Object.assign(this,am.defaults,i)}apply(i,e,t,r){let{width:s,height:n}=e.filterFrame;this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,this.uniforms.aspect=n/s,this.uniforms.seed=this.seed,this.uniforms.offset=this.offset,this.uniforms.fillMode=this.fillMode,i.applyFilter(this,e,t,r)}_randomizeSizes(){let i=this._sizes,e=this._slices-1,t=this.sampleSize,r=Math.min(this.minSize/t,.9/this._slices);if(this.average){let s=this._slices,n=1;for(let o=0;o<e;o++){let a=n/(s-o),l=Math.max(a*(1-Math.random()*.6),r);i[o]=l,n-=l}i[e]=n}else{let s=1,n=Math.sqrt(1/this._slices);for(let o=0;o<e;o++){let a=Math.max(n*s*Math.random(),r);i[o]=a,s-=a}i[e]=s}this.shuffle()}shuffle(){let i=this._sizes,e=this._slices-1;for(let t=e;t>0;t--){let r=Math.random()*t>>0,s=i[t];i[t]=i[r],i[r]=s}}_randomizeOffsets(){for(let i=0;i<this._slices;i++)this._offsets[i]=Math.random()*(Math.random()<.5?-1:1)}refresh(){this._randomizeSizes(),this._randomizeOffsets(),this.redraw()}redraw(){let i=this.sampleSize,e=this.texture,t=this._canvas.getContext("2d");t.clearRect(0,0,8,i);let r,s=0;for(let n=0;n<this._slices;n++){r=Math.floor(this._offsets[n]*256);let o=this._sizes[n]*i,a=r>0?r:0,l=r<0?-r:0;t.fillStyle=`rgba(${a}, ${l}, 0, 1)`,t.fillRect(0,s>>0,i,o+1>>0),s+=o}e.baseTexture.update(),this.uniforms.displacementMap=e}set sizes(i){let e=Math.min(this._slices,i.length);for(let t=0;t<e;t++)this._sizes[t]=i[t]}get sizes(){return this._sizes}set offsets(i){let e=Math.min(this._slices,i.length);for(let t=0;t<e;t++)this._offsets[t]=i[t]}get offsets(){return this._offsets}get slices(){return this._slices}set slices(i){this._slices!==i&&(this._slices=i,this.uniforms.slices=i,this._sizes=this.uniforms.slicesWidth=new Float32Array(i),this._offsets=this.uniforms.slicesOffset=new Float32Array(i),this.refresh())}get direction(){return this._direction}set direction(i){if(this._direction===i)return;this._direction=i;let e=i*Ks;this.uniforms.sinDir=Math.sin(e),this.uniforms.cosDir=Math.cos(e)}get red(){return this.uniforms.red}set red(i){this.uniforms.red=i}get green(){return this.uniforms.green}set green(i){this.uniforms.green=i}get blue(){return this.uniforms.blue}set blue(i){this.uniforms.blue=i}destroy(){var i;(i=this.texture)==null||i.destroy(!0),this.texture=this._canvas=this.red=this.green=this.blue=this._sizes=this._offsets=null}},Nc=am;Nc.defaults={slices:5,offset:100,direction:0,fillMode:0,average:!1,seed:0,red:[0,0],green:[0,0],blue:[0,0],minSize:8,sampleSize:512},Nc.TRANSPARENT=0,Nc.ORIGINAL=1,Nc.LOOP=2,Nc.CLAMP=3,Nc.MIRROR=4;var hU=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,dU=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

uniform float outerStrength;
uniform float innerStrength;

uniform vec4 glowColor;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform bool knockout;
uniform float alpha;

const float PI = 3.14159265358979323846264;

const float DIST = __DIST__;
const float ANGLE_STEP_SIZE = min(__ANGLE_STEP_SIZE__, PI * 2.0);
const float ANGLE_STEP_NUM = ceil(PI * 2.0 / ANGLE_STEP_SIZE);

const float MAX_TOTAL_ALPHA = ANGLE_STEP_NUM * DIST * (DIST + 1.0) / 2.0;

void main(void) {
    vec2 px = vec2(1.0 / filterArea.x, 1.0 / filterArea.y);

    float totalAlpha = 0.0;

    vec2 direction;
    vec2 displaced;
    vec4 curColor;

    for (float angle = 0.0; angle < PI * 2.0; angle += ANGLE_STEP_SIZE) {
       direction = vec2(cos(angle), sin(angle)) * px;

       for (float curDistance = 0.0; curDistance < DIST; curDistance++) {
           displaced = clamp(vTextureCoord + direction * 
                   (curDistance + 1.0), filterClamp.xy, filterClamp.zw);

           curColor = texture2D(uSampler, displaced);

           totalAlpha += (DIST - curDistance) * curColor.a;
       }
    }
    
    curColor = texture2D(uSampler, vTextureCoord);

    float alphaRatio = (totalAlpha / MAX_TOTAL_ALPHA);

    float innerGlowAlpha = (1.0 - alphaRatio) * innerStrength * curColor.a;
    float innerGlowStrength = min(1.0, innerGlowAlpha);
    
    vec4 innerColor = mix(curColor, glowColor, innerGlowStrength);

    float outerGlowAlpha = alphaRatio * outerStrength * (1. - curColor.a);
    float outerGlowStrength = min(1.0 - innerColor.a, outerGlowAlpha);

    if (knockout) {
      float resultAlpha = (outerGlowAlpha + innerGlowAlpha) * alpha;
      gl_FragColor = vec4(glowColor.rgb * resultAlpha, resultAlpha);
    }
    else {
      vec4 outerGlowColor = outerGlowStrength * glowColor.rgba * alpha;
      gl_FragColor = innerColor + outerGlowColor;
    }
}
`,cC=class extends ye{constructor(i){let e=Object.assign({},cC.defaults,i),{outerStrength:t,innerStrength:r,color:s,knockout:n,quality:o,alpha:a}=e,l=Math.round(e.distance);super(hU,dU.replace(/__ANGLE_STEP_SIZE__/gi,`${(1/o/l).toFixed(7)}`).replace(/__DIST__/gi,`${l.toFixed(0)}.0`)),this.uniforms.glowColor=new Float32Array([0,0,0,1]),this.uniforms.alpha=1,Object.assign(this,{color:s,outerStrength:t,innerStrength:r,padding:l,knockout:n,alpha:a})}get color(){return se.rgb2hex(this.uniforms.glowColor)}set color(i){se.hex2rgb(i,this.uniforms.glowColor)}get outerStrength(){return this.uniforms.outerStrength}set outerStrength(i){this.uniforms.outerStrength=i}get innerStrength(){return this.uniforms.innerStrength}set innerStrength(i){this.uniforms.innerStrength=i}get knockout(){return this.uniforms.knockout}set knockout(i){this.uniforms.knockout=i}get alpha(){return this.uniforms.alpha}set alpha(i){this.uniforms.alpha=i}},On=cC;On.defaults={distance:10,outerStrength:4,innerStrength:0,color:16777215,quality:.1,knockout:!1,alpha:1};var fU=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,pU=`vec3 mod289(vec3 x)
{
    return x - floor(x * (1.0 / 289.0)) * 289.0;
}
vec4 mod289(vec4 x)
{
    return x - floor(x * (1.0 / 289.0)) * 289.0;
}
vec4 permute(vec4 x)
{
    return mod289(((x * 34.0) + 1.0) * x);
}
vec4 taylorInvSqrt(vec4 r)
{
    return 1.79284291400159 - 0.85373472095314 * r;
}
vec3 fade(vec3 t)
{
    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);
}
// Classic Perlin noise, periodic variant
float pnoise(vec3 P, vec3 rep)
{
    vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period
    vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period
    Pi0 = mod289(Pi0);
    Pi1 = mod289(Pi1);
    vec3 Pf0 = fract(P); // Fractional part for interpolation
    vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
    vec4 iy = vec4(Pi0.yy, Pi1.yy);
    vec4 iz0 = Pi0.zzzz;
    vec4 iz1 = Pi1.zzzz;
    vec4 ixy = permute(permute(ix) + iy);
    vec4 ixy0 = permute(ixy + iz0);
    vec4 ixy1 = permute(ixy + iz1);
    vec4 gx0 = ixy0 * (1.0 / 7.0);
    vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
    gx0 = fract(gx0);
    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
    vec4 sz0 = step(gz0, vec4(0.0));
    gx0 -= sz0 * (step(0.0, gx0) - 0.5);
    gy0 -= sz0 * (step(0.0, gy0) - 0.5);
    vec4 gx1 = ixy1 * (1.0 / 7.0);
    vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
    gx1 = fract(gx1);
    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
    vec4 sz1 = step(gz1, vec4(0.0));
    gx1 -= sz1 * (step(0.0, gx1) - 0.5);
    gy1 -= sz1 * (step(0.0, gy1) - 0.5);
    vec3 g000 = vec3(gx0.x, gy0.x, gz0.x);
    vec3 g100 = vec3(gx0.y, gy0.y, gz0.y);
    vec3 g010 = vec3(gx0.z, gy0.z, gz0.z);
    vec3 g110 = vec3(gx0.w, gy0.w, gz0.w);
    vec3 g001 = vec3(gx1.x, gy1.x, gz1.x);
    vec3 g101 = vec3(gx1.y, gy1.y, gz1.y);
    vec3 g011 = vec3(gx1.z, gy1.z, gz1.z);
    vec3 g111 = vec3(gx1.w, gy1.w, gz1.w);
    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
    g000 *= norm0.x;
    g010 *= norm0.y;
    g100 *= norm0.z;
    g110 *= norm0.w;
    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
    g001 *= norm1.x;
    g011 *= norm1.y;
    g101 *= norm1.z;
    g111 *= norm1.w;
    float n000 = dot(g000, Pf0);
    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
    float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
    float n111 = dot(g111, Pf1);
    vec3 fade_xyz = fade(Pf0);
    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);
    return 2.2 * n_xyz;
}
float turb(vec3 P, vec3 rep, float lacunarity, float gain)
{
    float sum = 0.0;
    float sc = 1.0;
    float totalgain = 1.0;
    for (float i = 0.0; i < 6.0; i++)
    {
        sum += totalgain * pnoise(P * sc, rep);
        sc *= lacunarity;
        totalgain *= gain;
    }
    return abs(sum);
}
`,mU=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterArea;
uniform vec2 dimensions;

uniform vec2 light;
uniform bool parallel;
uniform float aspect;

uniform float gain;
uniform float lacunarity;
uniform float time;
uniform float alpha;

\${perlin}

void main(void) {
    vec2 coord = vTextureCoord * filterArea.xy / dimensions.xy;

    float d;

    if (parallel) {
        float _cos = light.x;
        float _sin = light.y;
        d = (_cos * coord.x) + (_sin * coord.y * aspect);
    } else {
        float dx = coord.x - light.x / dimensions.x;
        float dy = (coord.y - light.y / dimensions.y) * aspect;
        float dis = sqrt(dx * dx + dy * dy) + 0.00001;
        d = dy / dis;
    }

    vec3 dir = vec3(d, d, 0.0);

    float noise = turb(dir + vec3(time, 0.0, 62.1 + time) * 0.05, vec3(480.0, 320.0, 480.0), lacunarity, gain);
    noise = mix(noise, 0.0, 0.3);
    //fade vertically.
    vec4 mist = vec4(noise, noise, noise, 1.0) * (1.0 - coord.y);
    mist.a = 1.0;
    // apply user alpha
    mist *= alpha;

    gl_FragColor = texture2D(uSampler, vTextureCoord) + mist;

}
`,uC=class extends ye{constructor(i){super(fU,mU.replace("${perlin}",pU)),this.parallel=!0,this.time=0,this._angle=0,this.uniforms.dimensions=new Float32Array(2);let e=Object.assign(uC.defaults,i);this._angleLight=new _e,this.angle=e.angle,this.gain=e.gain,this.lacunarity=e.lacunarity,this.alpha=e.alpha,this.parallel=e.parallel,this.center=e.center,this.time=e.time}apply(i,e,t,r){let{width:s,height:n}=e.filterFrame;this.uniforms.light=this.parallel?this._angleLight:this.center,this.uniforms.parallel=this.parallel,this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,this.uniforms.aspect=n/s,this.uniforms.time=this.time,this.uniforms.alpha=this.alpha,i.applyFilter(this,e,t,r)}get angle(){return this._angle}set angle(i){this._angle=i;let e=i*Ks;this._angleLight.x=Math.cos(e),this._angleLight.y=Math.sin(e)}get gain(){return this.uniforms.gain}set gain(i){this.uniforms.gain=i}get lacunarity(){return this.uniforms.lacunarity}set lacunarity(i){this.uniforms.lacunarity=i}get alpha(){return this.uniforms.alpha}set alpha(i){this.uniforms.alpha=i}},gU=uC;gU.defaults={angle:30,gain:.5,lacunarity:2.5,time:0,parallel:!0,center:[0,0],alpha:1};var yU=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,xU=`precision mediump float;

varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float uHue;
uniform float uAlpha;
uniform bool uColorize;
uniform float uSaturation;
uniform float uLightness;

// https://en.wikipedia.org/wiki/Luma_(video)
const vec3 weight = vec3(0.299, 0.587, 0.114);

float getWeightedAverage(vec3 rgb) {
    return rgb.r * weight.r + rgb.g * weight.g + rgb.b * weight.b;
}

// https://gist.github.com/mairod/a75e7b44f68110e1576d77419d608786?permalink_comment_id=3195243#gistcomment-3195243
const vec3 k = vec3(0.57735, 0.57735, 0.57735);

vec3 hueShift(vec3 color, float angle) {
    float cosAngle = cos(angle);
    return vec3(
    color * cosAngle +
    cross(k, color) * sin(angle) +
    k * dot(k, color) * (1.0 - cosAngle)
    );
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    vec4 result = color;

    // colorize
    if (uColorize) {
        result.rgb = vec3(getWeightedAverage(result.rgb), 0., 0.);
    }

    // hue
    result.rgb = hueShift(result.rgb, uHue);

    // saturation
    // https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/huesaturation.js
    float average = (result.r + result.g + result.b) / 3.0;

    if (uSaturation > 0.) {
        result.rgb += (average - result.rgb) * (1. - 1. / (1.001 - uSaturation));
    } else {
        result.rgb -= (average - result.rgb) * uSaturation;
    }

    // lightness
    result.rgb = mix(result.rgb, vec3(ceil(uLightness)) * color.a, abs(uLightness));

    // alpha
    gl_FragColor = mix(color, result, uAlpha);
}
`,hC=class extends ye{constructor(i){super(yU,xU),this._hue=0;let e=Object.assign({},hC.defaults,i);Object.assign(this,e)}get hue(){return this._hue}set hue(i){this._hue=i,this.uniforms.uHue=this._hue*(Math.PI/180)}get alpha(){return this.uniforms.uAlpha}set alpha(i){this.uniforms.uAlpha=i}get colorize(){return this.uniforms.uColorize}set colorize(i){this.uniforms.uColorize=i}get lightness(){return this.uniforms.uLightness}set lightness(i){this.uniforms.uLightness=i}get saturation(){return this.uniforms.uSaturation}set saturation(i){this.uniforms.uSaturation=i}},vU=hC;vU.defaults={hue:0,saturation:0,lightness:0,colorize:!1,alpha:1};var _U=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,bU=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterArea;
uniform vec2 dimensions;

uniform float sepia;
uniform float noise;
uniform float noiseSize;
uniform float scratch;
uniform float scratchDensity;
uniform float scratchWidth;
uniform float vignetting;
uniform float vignettingAlpha;
uniform float vignettingBlur;
uniform float seed;

const float SQRT_2 = 1.414213;
const vec3 SEPIA_RGB = vec3(112.0 / 255.0, 66.0 / 255.0, 20.0 / 255.0);

float rand(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

vec3 Overlay(vec3 src, vec3 dst)
{
    // if (dst <= 0.5) then: 2 * src * dst
    // if (dst > 0.5) then: 1 - 2 * (1 - dst) * (1 - src)
    return vec3((dst.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)),
                (dst.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)),
                (dst.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)));
}


void main()
{
    gl_FragColor = texture2D(uSampler, vTextureCoord);
    vec3 color = gl_FragColor.rgb;

    if (sepia > 0.0)
    {
        float gray = (color.x + color.y + color.z) / 3.0;
        vec3 grayscale = vec3(gray);

        color = Overlay(SEPIA_RGB, grayscale);

        color = grayscale + sepia * (color - grayscale);
    }

    vec2 coord = vTextureCoord * filterArea.xy / dimensions.xy;

    if (vignetting > 0.0)
    {
        float outter = SQRT_2 - vignetting * SQRT_2;
        vec2 dir = vec2(vec2(0.5, 0.5) - coord);
        dir.y *= dimensions.y / dimensions.x;
        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignettingBlur * SQRT_2), 0.0, 1.0);
        color.rgb *= darker + (1.0 - darker) * (1.0 - vignettingAlpha);
    }

    if (scratchDensity > seed && scratch != 0.0)
    {
        float phase = seed * 256.0;
        float s = mod(floor(phase), 2.0);
        float dist = 1.0 / scratchDensity;
        float d = distance(coord, vec2(seed * dist, abs(s - seed * dist)));
        if (d < seed * 0.6 + 0.4)
        {
            highp float period = scratchDensity * 10.0;

            float xx = coord.x * period + phase;
            float aa = abs(mod(xx, 0.5) * 4.0);
            float bb = mod(floor(xx / 0.5), 2.0);
            float yy = (1.0 - bb) * aa + bb * (2.0 - aa);

            float kk = 2.0 * period;
            float dw = scratchWidth / dimensions.x * (0.75 + seed);
            float dh = dw * kk;

            float tine = (yy - (2.0 - dh));

            if (tine > 0.0) {
                float _sign = sign(scratch);

                tine = s * tine / period + scratch + 0.1;
                tine = clamp(tine + 1.0, 0.5 + _sign * 0.5, 1.5 + _sign * 0.5);

                color.rgb *= tine;
            }
        }
    }

    if (noise > 0.0 && noiseSize > 0.0)
    {
        vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;
        pixelCoord.x = floor(pixelCoord.x / noiseSize);
        pixelCoord.y = floor(pixelCoord.y / noiseSize);
        // vec2 d = pixelCoord * noiseSize * vec2(1024.0 + seed * 512.0, 1024.0 - seed * 512.0);
        // float _noise = snoise(d) * 0.5;
        float _noise = rand(pixelCoord * noiseSize * seed) - 0.5;
        color += _noise * noise;
    }

    gl_FragColor.rgb = color;
}
`,dC=class extends ye{constructor(i,e=0){super(_U,bU),this.seed=0,this.uniforms.dimensions=new Float32Array(2),typeof i=="number"?(this.seed=i,i=void 0):this.seed=e,Object.assign(this,dC.defaults,i)}apply(i,e,t,r){var s,n;this.uniforms.dimensions[0]=(s=e.filterFrame)==null?void 0:s.width,this.uniforms.dimensions[1]=(n=e.filterFrame)==null?void 0:n.height,this.uniforms.seed=this.seed,i.applyFilter(this,e,t,r)}set sepia(i){this.uniforms.sepia=i}get sepia(){return this.uniforms.sepia}set noise(i){this.uniforms.noise=i}get noise(){return this.uniforms.noise}set noiseSize(i){this.uniforms.noiseSize=i}get noiseSize(){return this.uniforms.noiseSize}set scratch(i){this.uniforms.scratch=i}get scratch(){return this.uniforms.scratch}set scratchDensity(i){this.uniforms.scratchDensity=i}get scratchDensity(){return this.uniforms.scratchDensity}set scratchWidth(i){this.uniforms.scratchWidth=i}get scratchWidth(){return this.uniforms.scratchWidth}set vignetting(i){this.uniforms.vignetting=i}get vignetting(){return this.uniforms.vignetting}set vignettingAlpha(i){this.uniforms.vignettingAlpha=i}get vignettingAlpha(){return this.uniforms.vignettingAlpha}set vignettingBlur(i){this.uniforms.vignettingBlur=i}get vignettingBlur(){return this.uniforms.vignettingBlur}},wU=dC;wU.defaults={sepia:.3,noise:.3,noiseSize:1,scratch:.5,scratchDensity:.3,scratchWidth:1,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3};var EU=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,AU=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterClamp;

uniform float uAlpha;
uniform vec2 uThickness;
uniform vec4 uColor;
uniform bool uKnockout;

const float DOUBLE_PI = 2. * 3.14159265358979323846264;
const float ANGLE_STEP = \${angleStep};

float outlineMaxAlphaAtPos(vec2 pos) {
    if (uThickness.x == 0. || uThickness.y == 0.) {
        return 0.;
    }

    vec4 displacedColor;
    vec2 displacedPos;
    float maxAlpha = 0.;

    for (float angle = 0.; angle <= DOUBLE_PI; angle += ANGLE_STEP) {
        displacedPos.x = vTextureCoord.x + uThickness.x * cos(angle);
        displacedPos.y = vTextureCoord.y + uThickness.y * sin(angle);
        displacedColor = texture2D(uSampler, clamp(displacedPos, filterClamp.xy, filterClamp.zw));
        maxAlpha = max(maxAlpha, displacedColor.a);
    }

    return maxAlpha;
}

void main(void) {
    vec4 sourceColor = texture2D(uSampler, vTextureCoord);
    vec4 contentColor = sourceColor * float(!uKnockout);
    float outlineAlpha = uAlpha * outlineMaxAlphaAtPos(vTextureCoord.xy) * (1.-sourceColor.a);
    vec4 outlineColor = vec4(vec3(uColor) * outlineAlpha, outlineAlpha);
    gl_FragColor = contentColor + outlineColor;
}
`,Nd=class extends ye{constructor(i=1,e=0,t=.1,r=1,s=!1){super(EU,AU.replace(/\$\{angleStep\}/,Nd.getAngleStep(t))),this._thickness=1,this._alpha=1,this._knockout=!1,this.uniforms.uThickness=new Float32Array([0,0]),this.uniforms.uColor=new Float32Array([0,0,0,1]),this.uniforms.uAlpha=r,this.uniforms.uKnockout=s,Object.assign(this,{thickness:i,color:e,quality:t,alpha:r,knockout:s})}static getAngleStep(i){let e=Math.max(i*Nd.MAX_SAMPLES,Nd.MIN_SAMPLES);return(Math.PI*2/e).toFixed(7)}apply(i,e,t,r){this.uniforms.uThickness[0]=this._thickness/e._frame.width,this.uniforms.uThickness[1]=this._thickness/e._frame.height,this.uniforms.uAlpha=this._alpha,this.uniforms.uKnockout=this._knockout,i.applyFilter(this,e,t,r)}get alpha(){return this._alpha}set alpha(i){this._alpha=i}get color(){return se.rgb2hex(this.uniforms.uColor)}set color(i){se.hex2rgb(i,this.uniforms.uColor)}get knockout(){return this._knockout}set knockout(i){this._knockout=i}get thickness(){return this._thickness}set thickness(i){this._thickness=i,this.padding=i}},fC=Nd;fC.MIN_SAMPLES=1,fC.MAX_SAMPLES=100;var SU=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,CU=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec2 dimensions;

uniform bool mirror;
uniform float boundary;
uniform vec2 amplitude;
uniform vec2 waveLength;
uniform vec2 alpha;
uniform float time;

float rand(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main(void)
{
    vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;
    vec2 coord = pixelCoord / dimensions;

    if (coord.y < boundary) {
        gl_FragColor = texture2D(uSampler, vTextureCoord);
        return;
    }

    float k = (coord.y - boundary) / (1. - boundary + 0.0001);
    float areaY = boundary * dimensions.y / filterArea.y;
    float v = areaY + areaY - vTextureCoord.y;
    float y = mirror ? v : vTextureCoord.y;

    float _amplitude = ((amplitude.y - amplitude.x) * k + amplitude.x ) / filterArea.x;
    float _waveLength = ((waveLength.y - waveLength.x) * k + waveLength.x) / filterArea.y;
    float _alpha = (alpha.y - alpha.x) * k + alpha.x;

    float x = vTextureCoord.x + cos(v * 6.28 / _waveLength - time) * _amplitude;
    x = clamp(x, filterClamp.x, filterClamp.z);

    vec4 color = texture2D(uSampler, vec2(x, y));

    gl_FragColor = color * _alpha;
}
`,pC=class extends ye{constructor(i){super(SU,CU),this.time=0,this.uniforms.amplitude=new Float32Array(2),this.uniforms.waveLength=new Float32Array(2),this.uniforms.alpha=new Float32Array(2),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,pC.defaults,i)}apply(i,e,t,r){var s,n;this.uniforms.dimensions[0]=(s=e.filterFrame)==null?void 0:s.width,this.uniforms.dimensions[1]=(n=e.filterFrame)==null?void 0:n.height,this.uniforms.time=this.time,i.applyFilter(this,e,t,r)}set mirror(i){this.uniforms.mirror=i}get mirror(){return this.uniforms.mirror}set boundary(i){this.uniforms.boundary=i}get boundary(){return this.uniforms.boundary}set amplitude(i){this.uniforms.amplitude[0]=i[0],this.uniforms.amplitude[1]=i[1]}get amplitude(){return this.uniforms.amplitude}set waveLength(i){this.uniforms.waveLength[0]=i[0],this.uniforms.waveLength[1]=i[1]}get waveLength(){return this.uniforms.waveLength}set alpha(i){this.uniforms.alpha[0]=i[0],this.uniforms.alpha[1]=i[1]}get alpha(){return this.uniforms.alpha}},kU=pC;kU.defaults={mirror:!0,boundary:.5,amplitude:[0,20],waveLength:[30,100],alpha:[1,1],time:0};var TU=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,IU=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterArea;
uniform vec4 filterClamp;

uniform vec2 center;

uniform float amplitude;
uniform float wavelength;
// uniform float power;
uniform float brightness;
uniform float speed;
uniform float radius;

uniform float time;

const float PI = 3.14159;

void main()
{
    float halfWavelength = wavelength * 0.5 / filterArea.x;
    float maxRadius = radius / filterArea.x;
    float currentRadius = time * speed / filterArea.x;

    float fade = 1.0;

    if (maxRadius > 0.0) {
        if (currentRadius > maxRadius) {
            gl_FragColor = texture2D(uSampler, vTextureCoord);
            return;
        }
        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);
    }

    vec2 dir = vec2(vTextureCoord - center / filterArea.xy);
    dir.y *= filterArea.y / filterArea.x;
    float dist = length(dir);

    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {
        gl_FragColor = texture2D(uSampler, vTextureCoord);
        return;
    }

    vec2 diffUV = normalize(dir);

    float diff = (dist - currentRadius) / halfWavelength;

    float p = 1.0 - pow(abs(diff), 2.0);

    // float powDiff = diff * pow(p, 2.0) * ( amplitude * fade );
    float powDiff = 1.25 * sin(diff * PI) * p * ( amplitude * fade );

    vec2 offset = diffUV * powDiff / filterArea.xy;

    // Do clamp :
    vec2 coord = vTextureCoord + offset;
    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);
    vec4 color = texture2D(uSampler, clampedCoord);
    if (coord != clampedCoord) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    // No clamp :
    // gl_FragColor = texture2D(uSampler, vTextureCoord + offset);

    color.rgb *= 1.0 + (brightness - 1.0) * p * fade;

    gl_FragColor = color;
}
`,mC=class extends ye{constructor(i=[0,0],e,t=0){super(TU,IU),this.center=i,Object.assign(this,mC.defaults,e),this.time=t}apply(i,e,t,r){this.uniforms.time=this.time,i.applyFilter(this,e,t,r)}get center(){return this.uniforms.center}set center(i){this.uniforms.center=i}get amplitude(){return this.uniforms.amplitude}set amplitude(i){this.uniforms.amplitude=i}get wavelength(){return this.uniforms.wavelength}set wavelength(i){this.uniforms.wavelength=i}get brightness(){return this.uniforms.brightness}set brightness(i){this.uniforms.brightness=i}get speed(){return this.uniforms.speed}set speed(i){this.uniforms.speed=i}get radius(){return this.uniforms.radius}set radius(i){this.uniforms.radius=i}},MU=mC;MU.defaults={amplitude:30,wavelength:160,brightness:1,speed:500,radius:-1};var PU=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,DU=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float blur;
uniform float gradientBlur;
uniform vec2 start;
uniform vec2 end;
uniform vec2 delta;
uniform vec2 texSize;

float random(vec3 scale, float seed)
{
    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
}

void main(void)
{
    vec4 color = vec4(0.0);
    float total = 0.0;

    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
    vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));
    float radius = smoothstep(0.0, 1.0, abs(dot(vTextureCoord * texSize - start, normal)) / gradientBlur) * blur;

    for (float t = -30.0; t <= 30.0; t++)
    {
        float percent = (t + offset - 0.5) / 30.0;
        float weight = 1.0 - abs(percent);
        vec4 sample = texture2D(uSampler, vTextureCoord + delta / texSize * percent * radius);
        sample.rgb *= sample.a;
        color += sample * weight;
        total += weight;
    }

    color /= total;
    color.rgb /= color.a + 0.00001;

    gl_FragColor = color;
}
`,Fd=class extends ye{constructor(e){var t,r;super(PU,DU),this.uniforms.blur=e.blur,this.uniforms.gradientBlur=e.gradientBlur,this.uniforms.start=(t=e.start)!=null?t:new _e(0,window.innerHeight/2),this.uniforms.end=(r=e.end)!=null?r:new _e(600,window.innerHeight/2),this.uniforms.delta=new _e(30,30),this.uniforms.texSize=new _e(window.innerWidth,window.innerHeight),this.updateDelta()}updateDelta(){this.uniforms.delta.x=0,this.uniforms.delta.y=0}get blur(){return this.uniforms.blur}set blur(e){this.uniforms.blur=e}get gradientBlur(){return this.uniforms.gradientBlur}set gradientBlur(e){this.uniforms.gradientBlur=e}get start(){return this.uniforms.start}set start(e){this.uniforms.start=e,this.updateDelta()}get end(){return this.uniforms.end}set end(e){this.uniforms.end=e,this.updateDelta()}},lm=class extends Fd{updateDelta(){let e=this.uniforms.end.x-this.uniforms.start.x,t=this.uniforms.end.y-this.uniforms.start.y,r=Math.sqrt(e*e+t*t);this.uniforms.delta.x=e/r,this.uniforms.delta.y=t/r}},cm=class extends Fd{updateDelta(){let e=this.uniforms.end.x-this.uniforms.start.x,t=this.uniforms.end.y-this.uniforms.start.y,r=Math.sqrt(e*e+t*t);this.uniforms.delta.x=-t/r,this.uniforms.delta.y=e/r}},gC=class extends ye{constructor(i,e,t,r){super(),typeof i=="number"&&(se.deprecation("5.3.0","TiltShiftFilter constructor arguments is deprecated, use options."),i={blur:i,gradientBlur:e,start:t,end:r}),i=Object.assign({},gC.defaults,i),this.tiltShiftXFilter=new lm(i),this.tiltShiftYFilter=new cm(i)}apply(i,e,t,r){let s=i.getFilterTexture();this.tiltShiftXFilter.apply(i,e,s,1),this.tiltShiftYFilter.apply(i,s,t,r),i.returnFilterTexture(s)}get blur(){return this.tiltShiftXFilter.blur}set blur(i){this.tiltShiftXFilter.blur=this.tiltShiftYFilter.blur=i}get gradientBlur(){return this.tiltShiftXFilter.gradientBlur}set gradientBlur(i){this.tiltShiftXFilter.gradientBlur=this.tiltShiftYFilter.gradientBlur=i}get start(){return this.tiltShiftXFilter.start}set start(i){this.tiltShiftXFilter.start=this.tiltShiftYFilter.start=i}get end(){return this.tiltShiftXFilter.end}set end(i){this.tiltShiftXFilter.end=this.tiltShiftYFilter.end=i}},RU=gC;RU.defaults={blur:100,gradientBlur:600,start:void 0,end:void 0};var NU=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,FU=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform vec4 filterArea;

vec2 mapCoord( vec2 coord )
{
    coord *= filterArea.xy;
    coord += filterArea.zw;

    return coord;
}

vec2 unmapCoord( vec2 coord )
{
    coord -= filterArea.zw;
    coord /= filterArea.xy;

    return coord;
}

vec2 twist(vec2 coord)
{
    coord -= offset;

    float dist = length(coord);

    if (dist < radius)
    {
        float ratioDist = (radius - dist) / radius;
        float angleMod = ratioDist * ratioDist * angle;
        float s = sin(angleMod);
        float c = cos(angleMod);
        coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);
    }

    coord += offset;

    return coord;
}

void main(void)
{

    vec2 coord = mapCoord(vTextureCoord);

    coord = twist(coord);

    coord = unmapCoord(coord);

    gl_FragColor = texture2D(uSampler, coord );

}
`,yC=class extends ye{constructor(i){super(NU,FU),Object.assign(this,yC.defaults,i)}get offset(){return this.uniforms.offset}set offset(i){this.uniforms.offset=i}get radius(){return this.uniforms.radius}set radius(i){this.uniforms.radius=i}get angle(){return this.uniforms.angle}set angle(i){this.uniforms.angle=i}},LU=yC;LU.defaults={radius:200,angle:4,padding:20,offset:new _e};var OU=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,BU=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform vec4 filterArea;

uniform vec2 uCenter;
uniform float uStrength;
uniform float uInnerRadius;
uniform float uRadius;

const float MAX_KERNEL_SIZE = \${maxKernelSize};

// author: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/
highp float rand(vec2 co, float seed) {
    const highp float a = 12.9898, b = 78.233, c = 43758.5453;
    highp float dt = dot(co + seed, vec2(a, b)), sn = mod(dt, 3.14159);
    return fract(sin(sn) * c + seed);
}

void main() {

    float minGradient = uInnerRadius * 0.3;
    float innerRadius = (uInnerRadius + minGradient * 0.5) / filterArea.x;

    float gradient = uRadius * 0.3;
    float radius = (uRadius - gradient * 0.5) / filterArea.x;

    float countLimit = MAX_KERNEL_SIZE;

    vec2 dir = vec2(uCenter.xy / filterArea.xy - vTextureCoord);
    float dist = length(vec2(dir.x, dir.y * filterArea.y / filterArea.x));

    float strength = uStrength;

    float delta = 0.0;
    float gap;
    if (dist < innerRadius) {
        delta = innerRadius - dist;
        gap = minGradient;
    } else if (radius >= 0.0 && dist > radius) { // radius < 0 means it's infinity
        delta = dist - radius;
        gap = gradient;
    }

    if (delta > 0.0) {
        float normalCount = gap / filterArea.x;
        delta = (normalCount - delta) / normalCount;
        countLimit *= delta;
        strength *= delta;
        if (countLimit < 1.0)
        {
            gl_FragColor = texture2D(uSampler, vTextureCoord);
            return;
        }
    }

    // randomize the lookup values to hide the fixed number of samples
    float offset = rand(vTextureCoord, 0.0);

    float total = 0.0;
    vec4 color = vec4(0.0);

    dir *= strength;

    for (float t = 0.0; t < MAX_KERNEL_SIZE; t++) {
        float percent = (t + offset) / MAX_KERNEL_SIZE;
        float weight = 4.0 * (percent - percent * percent);
        vec2 p = vTextureCoord + dir * percent;
        vec4 sample = texture2D(uSampler, p);

        // switch to pre-multiplied alpha to correctly blur transparent images
        // sample.rgb *= sample.a;

        color += sample * weight;
        total += weight;

        if (t > countLimit){
            break;
        }
    }

    color /= total;
    // switch back from pre-multiplied alpha
    // color.rgb /= color.a + 0.00001;

    gl_FragColor = color;
}
`,xC=Object.getOwnPropertySymbols,UU=Object.prototype.hasOwnProperty,$U=Object.prototype.propertyIsEnumerable,HU=(i,e)=>{var t={};for(var r in i)UU.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&xC)for(var r of xC(i))e.indexOf(r)<0&&$U.call(i,r)&&(t[r]=i[r]);return t},vC=class extends ye{constructor(i){let e=Object.assign(vC.defaults,i),{maxKernelSize:t}=e,r=HU(e,["maxKernelSize"]);super(OU,BU.replace("${maxKernelSize}",t.toFixed(1))),Object.assign(this,r)}get center(){return this.uniforms.uCenter}set center(i){this.uniforms.uCenter=i}get strength(){return this.uniforms.uStrength}set strength(i){this.uniforms.uStrength=i}get innerRadius(){return this.uniforms.uInnerRadius}set innerRadius(i){this.uniforms.uInnerRadius=i}get radius(){return this.uniforms.uRadius}set radius(i){(i<0||i===1/0)&&(i=-1),this.uniforms.uRadius=i}},GU=vC;GU.defaults={strength:.1,center:[0,0],innerRadius:0,radius:-1,maxKernelSize:32};function _C(i){return i instanceof Set?i:new Set(i!==void 0&&[].concat(i))}var yt=class{constructor(e,t){this.scene=e,this.renderer=e.renderer,this.context=e.context,this.layerID=t,this._enabled=!1,this.features=new Map,this.retained=new Map,this._featureHasData=new Map,this._dataHasFeature=new Map,this._parentHasChildren=new Map,this._childHasParents=new Map,this._dataHasClass=new Map,this._classHasData=new Map}reset(){this._featureHasData.clear(),this._dataHasFeature.clear(),this._parentHasChildren.clear(),this._childHasParents.clear(),this._dataHasClass.clear(),this._classHasData.clear();for(let e of this.features.values())e.destroy();this.features.clear(),this.retained.clear()}render(){}cull(e){for(let[t,r]of this.features){let s=this.retained.get(t);s!==e&&(r.visible=!1,e-s>20&&r.destroy())}}addFeature(e){this.features.set(e.id,e)}removeFeature(e){this.unbindData(e.id),this.retained.delete(e.id),this.features.delete(e.id)}retainFeature(e,t){e.lod>0&&(e.visible=!0),this.retained.set(e.id,t)}syncFeatureClasses(e){var n;let t=e.id,r=this._featureHasData.get(t);if(!r)return;let s=(n=this._dataHasClass.get(r))!=null?n:new Set;e.selected=s.has("selected"),e.hovered=s.has("hovered"),e.drawing=s.has("drawing"),e.active=s.has("drawing"),e.highlighted=s.has("highlighted")}isDrawing(e){let t=this._dataHasClass.get(e);return t==null?void 0:t.has("drawing")}isHovered(e){let t=this._dataHasClass.get(e);return t==null?void 0:t.has("hovered")}bindData(e,t){this.unbindData(e);let r=this._dataHasFeature.get(t);r||(r=new Set,this._dataHasFeature.set(t,r)),r.add(e),this._featureHasData.set(e,t)}unbindData(e){let t=this._featureHasData.get(e);if(!t)return;let r=this._dataHasFeature.get(t);r&&(r.delete(e),r.size||(this._dataHasFeature.delete(t),this._parentHasChildren.delete(t),this._childHasParents.delete(t))),this._featureHasData.delete(e)}addChildData(e,t){let r=this._parentHasChildren.get(e);r||(r=new Set,this._parentHasChildren.set(e,r)),r.add(t);let s=this._childHasParents.get(t);s||(s=new Set,this._childHasParents.set(t,s)),s.add(e)}removeChildData(e,t){let r=this._parentHasChildren.get(e);r&&(r.delete(t),r.size||this._parentHasChildren.get(t)||this._parentHasChildren.delete(t));let s=this._childHasParents.get(t);s&&(s.delete(t),s.size||this._childHasParents.delete(t))}clearChildData(e){var r;let t=(r=this._parentHasChildren.get(e))!=null?r:new Set;for(let s of t)this.removeChildData(e,s)}getSelfAndDescendants(e,t){var s;t instanceof Set?t.add(e):t=new Set([e]);let r=(s=this._parentHasChildren.get(e))!=null?s:new Set;for(let n of r)t.has(n)||this.getSelfAndDescendants(n,t);return t}getSelfAndAncestors(e,t){var s;t instanceof Set?t.add(e):t=new Set([e]);let r=(s=this._childHasParents.get(e))!=null?s:new Set;for(let n of r)t.has(n)||this.getSelfAndAncestors(n,t);return t}getSelfAndSiblings(e,t){var s,n;t instanceof Set?t.add(e):t=new Set([e]);let r=(s=this._childHasParents.get(e))!=null?s:new Set;for(let o of r){let a=(n=this._parentHasChildren.get(o))!=null?n:new Set;for(let l of a)t.add(l)}return t}classData(e,t){let r=this._dataHasClass.get(e);r||(r=new Set,this._dataHasClass.set(e,r)),r.add(t);let s=this._classHasData.get(t);s||(s=new Set,this._classHasData.set(t,s)),s.add(e)}unclassData(e,t){let r=this._dataHasClass.get(e);r&&(r.delete(t),r.size||this._dataHasClass.delete(e));let s=this._classHasData.get(t);s&&(s.delete(e),s.size||this._classHasData.delete(t))}clearClass(e){var r;let t=(r=this._classHasData.get(e))!=null?r:new Set;for(let s of t)this.unclassData(s,e)}dirtyLayer(){for(let e of this.features.values())e.dirty=!0}dirtyFeatures(e){for(let t of _C(e)){let r=this.features.get(t);r&&(r.dirty=!0)}}dirtyData(e){for(let t of _C(e)){let r=this._dataHasFeature.get(t);r&&this.dirtyFeatures(r)}}get id(){return this.layerID}get supported(){return!0}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,this.dirtyLayer())}};var bC=16776960,zU=[0,-.0125,0,-.0125,.5,-.0125,0,-.0125,0],Fc=class extends yt{constructor(e,t,r){super(e,t),this.enabled=!0,this.isMinimap=r;let s=this.scene.groups.get("background");s.eventMode="none",this.filters={brightness:1,contrast:1,saturation:1,sharpness:1},this._tileMaps=new Map,this._failed=new Set,this._tiler=new Jt}reset(){super.reset(),this.destroyAll(),this._tileMaps.clear(),this._failed.clear()}render(e,t){let r=this.context.systems.imagery,s=this.scene.groups.get("background"),n=new Map,o=r.baseLayerSource();o&&o.id!=="none"&&n.set(o.id,o);for(let c of r.overlayLayerSources())n.set(c.id,c);let a=0;for(let[c,u]of n){let h=this.getSourceContainer(c);h.zIndex=u.isLocatorOverlay()?999:a++,!this.isMinimap&&u===o&&this.applyFilters(h);let d=this._tileMaps.get(c);d||(d=new Map,this._tileMaps.set(c,d));let f=window.performance.now();this.renderSource(f,t,u,h,d)}let l=new Set;for(let c of s.children){let u=c.name;n.has(u)||l.add(u)}for(let c of l)this.destroySource(c)}renderSource(e,t,r,s,n){let o=this.context,a=this.renderer.textures,l=o.services.osm;if(isNaN(t._x)||isNaN(t._y))return;let c=!1,u;this.isMinimap||(c=o.getDebug("tile"),u=this.scene.layers.get("map-ui").container.getChildByName("tile-debug"),u.visible=c);let h=r.tileSize||256,d=t.scale(),f=Yr(d,h),p=mr(r.offset,Math.pow(2,f));s.position.set(p[0],p[1]);let m=new Map,g=Math.round(f),y=Math.max(0,g-5),x=!1;for(let b=g;!x&&b>=y;b--){if(!r.validZoom(b)||r.isLocatorOverlay()&&g>17)continue;let _=this._tiler.skipNullIsland(!!r.overlay).zoomRange(b).getTiles(this.isMinimap?t:o.projection),w=!1;for(let A of _.tiles){if(!this.isMinimap&&b>=10&&l&&r.isLocatorOverlay()){let k=A.wgs84Extent.center();if(l.isDataLoaded(k))continue}A.url=r.url(A.xyz),!A.url||this._failed.has(A.url)?w=!0:m.set(A.id,A)}x=!w}for(let[b,_]of m){if(n.has(b))continue;let w=`${r.id}-${b}`,A=new Dt;A.name=w,A.anchor.set(0,1),A.zIndex=_.xyz[2],s.addChild(A),_.sprite=A,n.set(b,_);let k=new Image;k.crossOrigin="anonymous",k.src=_.url,_.image=k,_.loaded=!1,k.onload=()=>{if(this._failed.delete(_.url),!_.sprite||!_.image)return;let v=_.image.naturalWidth,E=_.image.naturalHeight;_.sprite.texture=a.allocate("tile",_.sprite.name,v,E,_.image),_.loaded=!0,_.image=null,o.systems.map.deferredRedraw()},k.onerror=()=>{_.image=null,this._failed.add(_.url),o.systems.map.deferredRedraw()}}for(let[b,_]of n){let w=!1;if(m.has(b)?(w=!0,_.timestamp=e):r.overlay||(w=e-_.timestamp<3e3),w){let[A,k]=t.project(_.wgs84Extent.min);_.sprite.position.set(A,k);let v=h*Math.pow(2,f-_.xyz[2]);if(_.sprite.width=v,_.sprite.height=v,c&&u&&!r.overlay){if(!_.debug){_.debug=new qe,_.debug.name=`debug-${b}`,_.debug.eventMode="none",_.debug.sortableChildren=!1,u.addChild(_.debug);let E=new Z4(b,{fontName:"debug"});E.name=`label-${b}`,E.tint=bC,E.position.set(2,2),_.debug.addChild(E)}_.debug.position.set(A,k-v),_.debug.clear().lineStyle(2,bC).drawRect(0,0,v,v)}}else this.destroyTile(_),n.delete(b)}}destroyAll(){let e=this.scene.groups.get("background"),t=new Set;for(let r of e.children){let s=r.name;t.add(s)}for(let r of t)this.destroySource(r)}destroySource(e){let t=this._tileMaps.get(e);for(let[n,o]of t)this.destroyTile(o),t.delete(n);this._tileMaps.delete(e);let s=this.scene.groups.get("background").getChildByName(e);s&&s.destroy({children:!0})}destroyTile(e){let t=this.renderer.textures;e.sprite&&(e.sprite.texture=null,e.loaded&&t.free("tile",e.sprite.name),e.sprite.destroy({children:!0,texture:!1,baseTexture:!1})),e.debug&&e.debug.destroy({children:!0}),e.image=null,e.sprite=null,e.debug=null}getSourceContainer(e){let t=this.scene.groups.get("background"),r=t.getChildByName(e);return r||(r=new Qe,r.name=e,r.eventMode="none",r.sortableChildren=!0,t.addChild(r)),r}applyFilters(e){let t=new Pd({brightness:this.filters.brightness,contrast:this.filters.contrast,saturation:this.filters.saturation});if(e.filters=[t],this.filters.sharpness>1){let r=zU.map((s,n)=>{if(n===4){let o=qt(1,2)(this.filters.sharpness);return s*o}else return s});this.convolutionFilter=new Rd(r),e.filters.push(this.convolutionFilter)}else if(this.filters.sharpness<1){let r=qt(1,8)(1-this.filters.sharpness);this.blurFilter=new P4.BlurFilter(r,4),e.filters.push(this.blurFilter)}}setBrightness(e){this.filters.brightness=e}setContrast(e){this.filters.contrast=e}setSaturation(e){this.filters.saturation=e}setSharpness(e){this.filters.sharpness=e}};function ar(i,e){return Array.from(i.getElementsByTagName(e))}function Od(i){return i[0]==="#"?i:`#${i}`}function jU(i,e,t){return Array.from(i.getElementsByTagNameNS(t,e))}function Zi(i){return i==null||i.normalize(),i&&i.textContent||""}function Tr(i,e,t){let r=i.getElementsByTagName(e),s=r.length?r[0]:null;return s&&t&&t(s),s}function Ds(i,e,t){let r={};if(!i)return r;let s=i.getElementsByTagName(e),n=s.length?s[0]:null;return n&&t?t(n,r):r}function xl(i,e,t){let r=Zi(Tr(i,e));return r&&t?t(r)||{}:{}}function wC(i,e,t){let r=parseFloat(Zi(Tr(i,e)));if(!isNaN(r))return r&&t?t(r)||{}:{}}function yl(i,e,t){let r=parseFloat(Zi(Tr(i,e)));if(!isNaN(r))return t&&t(r),r}function eu(i,e){let t={};for(let r of e)xl(i,r,s=>{t[r]=s});return t}function dm(i){return(i==null?void 0:i.nodeType)===1}function EC(i){return Ds(i,"line",e=>Object.assign({},xl(e,"color",r=>({stroke:`#${r}`})),wC(e,"opacity",r=>({"stroke-opacity":r})),wC(e,"width",r=>({"stroke-width":r*96/25.4}))))}function AC(i){let e=[];if(i===null)return e;for(let t of Array.from(i.childNodes)){if(!dm(t))continue;let r=VU(t.nodeName);if(r==="gpxtpx:TrackPointExtension")e=e.concat(AC(t));else{let s=Zi(t);e.push([r,WU(s)])}}return e}function VU(i){return["heart","gpxtpx:hr","hr"].includes(i)?"heart":i}function WU(i){let e=parseFloat(i);return isNaN(e)?i:e}function SC(i){let e=[parseFloat(i.getAttribute("lon")||""),parseFloat(i.getAttribute("lat")||"")];if(isNaN(e[0])||isNaN(e[1]))return null;yl(i,"ele",r=>{e.push(r)});let t=Tr(i,"time");return{coordinates:e,time:t?Zi(t):null,extendedValues:AC(Tr(i,"extensions"))}}function fm(i){var s;let e=eu(i,["name","cmt","desc","type","time","keywords"]),t=Array.from(i.getElementsByTagNameNS("http://www.garmin.com/xmlschemas/GpxExtensions/v3","*"));for(let n of t)((s=n.parentNode)==null?void 0:s.parentNode)===i&&(e[n.tagName.replace(":","_")]=Zi(n));let r=ar(i,"link");return r.length&&(e.links=r.map(n=>Object.assign({href:n.getAttribute("href")},eu(n,["text","type"])))),e}function CC(i,e){let t=ar(i,e),r=[],s=[],n={};for(let o=0;o<t.length;o++){let a=SC(t[o]);if(a){r.push(a.coordinates),a.time&&s.push(a.time);for(let[l,c]of a.extendedValues){let u=l==="heart"?l:l.replace("gpxtpx:","")+"s";n[u]||(n[u]=Array(t.length).fill(null)),n[u][o]=c}}}if(!(r.length<2))return{line:r,times:s,extendedValues:n}}function XU(i){let e=CC(i,"rtept");if(e)return{type:"Feature",properties:Object.assign({_gpxType:"rte"},fm(i),EC(Tr(i,"extensions"))),geometry:{type:"LineString",coordinates:e.line}}}function qU(i){let e=ar(i,"trkseg"),t=[],r=[],s=[];for(let a of e){let l=CC(a,"trkpt");l&&(s.push(l),l.times&&l.times.length&&r.push(l.times))}if(s.length===0)return null;let n=s.length>1,o=Object.assign({_gpxType:"trk"},fm(i),EC(Tr(i,"extensions")),r.length?{coordinateProperties:{times:n?r:r[0]}}:{});for(let a of s){t.push(a.line),o.coordinateProperties||(o.coordinateProperties={});let l=o.coordinateProperties,c=Object.entries(a.extendedValues);for(let u=0;u<c.length;u++){let[h,d]=c[u];n?(l[h]||(l[h]=s.map(f=>new Array(f.line.length).fill(null))),l[h][u]=d):l[h]=d}}return{type:"Feature",properties:o,geometry:n?{type:"MultiLineString",coordinates:t}:{type:"LineString",coordinates:t[0]}}}function QU(i){let e=Object.assign(fm(i),eu(i,["sym"])),t=SC(i);return t?{type:"Feature",properties:e,geometry:{type:"Point",coordinates:t.coordinates}}:null}function*YU(i){for(let e of ar(i,"trk")){let t=qU(e);t&&(yield t)}for(let e of ar(i,"rte")){let t=XU(e);t&&(yield t)}for(let e of ar(i,"wpt")){let t=QU(e);t&&(yield t)}}function Ud(i){return{type:"FeatureCollection",features:Array.from(YU(i))}}function kC(i,e){let t={},r=e=="stroke"||e==="fill"?e:e+"-color";return i[0]==="#"&&(i=i.substring(1)),i.length===6||i.length===3?t[r]="#"+i:i.length===8&&(t[e+"-opacity"]=parseInt(i.substring(0,2),16)/255,t[r]="#"+i.substring(6,8)+i.substring(4,6)+i.substring(2,4)),t}function Bd(i,e,t){let r={};return yl(i,e,s=>{r[t]=s}),r}function pm(i,e){return Ds(i,"color",t=>kC(Zi(t),e))}function TC(i){return Ds(i,"Icon",(e,t)=>(xl(e,"href",r=>{t.icon=r}),t))}function KU(i){return Ds(i,"IconStyle",e=>Object.assign(pm(e,"icon"),Bd(e,"scale","icon-scale"),Bd(e,"heading","icon-heading"),Ds(e,"hotSpot",t=>{let r=parseFloat(t.getAttribute("x")||""),s=parseFloat(t.getAttribute("y")||""),n=t.getAttribute("xunits")||"",o=t.getAttribute("yunits")||"";return!isNaN(r)&&!isNaN(s)?{"icon-offset":[r,s],"icon-offset-units":[n,o]}:{}}),TC(e)))}function ZU(i){return Ds(i,"LabelStyle",e=>Object.assign(pm(e,"label"),Bd(e,"scale","label-scale")))}function JU(i){return Ds(i,"LineStyle",e=>Object.assign(pm(e,"stroke"),Bd(e,"width","stroke-width")))}function e$(i){return Ds(i,"PolyStyle",(e,t)=>Object.assign(t,Ds(e,"color",r=>kC(Zi(r),"fill")),xl(e,"fill",r=>{if(r==="0")return{"fill-opacity":0}}),xl(e,"outline",r=>{if(r==="0")return{"stroke-opacity":0}})))}function mm(i){return Object.assign({},e$(i),JU(i),ZU(i),KU(i))}var Lc=i=>Number(i),um={string:i=>i,int:Lc,uint:Lc,short:Lc,ushort:Lc,float:Lc,double:Lc,bool:i=>!!i};function IC(i,e){return Ds(i,"ExtendedData",(t,r)=>{for(let s of ar(t,"Data"))r[s.getAttribute("name")||""]=Zi(Tr(s,"value"));for(let s of ar(t,"SimpleData")){let n=s.getAttribute("name")||"",o=e[n]||um.string;r[n]=o(Zi(s))}return r})}function MC(i){let e=Tr(i,"description");for(let t of Array.from((e==null?void 0:e.childNodes)||[]))if(t.nodeType===4)return{description:{"@type":"html",value:Zi(t)}};return{}}function PC(i){return Ds(i,"TimeSpan",e=>({timespan:{begin:Zi(Tr(e,"begin")),end:Zi(Tr(e,"end"))}}))}function DC(i){return Ds(i,"TimeStamp",e=>({timestamp:Zi(Tr(e,"when"))}))}function RC(i,e){return xl(i,"styleUrl",t=>(t=Od(t),e[t]?Object.assign({styleUrl:t},e[t]):{styleUrl:t}))}var t$=/\s*/g,i$=/^\s*|\s*$/g,r$=/\s+/;function NC(i){return i.replace(t$,"").split(",").map(parseFloat).filter(e=>!isNaN(e)).slice(0,3)}function hm(i){return i.replace(i$,"").split(r$).map(NC).filter(e=>e.length>=2)}function s$(i){let e=ar(i,"coord");e.length===0&&(e=jU(i,"coord","*"));let t=e.map(r=>Zi(r).split(" ").map(parseFloat));return t.length===0?null:{geometry:t.length>2?{type:"LineString",coordinates:t}:{type:"Point",coordinates:t[0]},times:ar(i,"when").map(r=>Zi(r))}}function FC(i){if(i.length===0)return i;let e=i[0],t=i[i.length-1],r=!0;for(let s=0;s<Math.max(e.length,t.length);s++)if(e[s]!==t[s]){r=!1;break}return r?i:i.concat([i[0]])}function Ld(i){return Zi(Tr(i,"coordinates"))}function LC(i){let e=[],t=[];for(let r=0;r<i.childNodes.length;r++){let s=i.childNodes.item(r);if(dm(s))switch(s.tagName){case"MultiGeometry":case"MultiTrack":case"gx:MultiTrack":{let n=LC(s);e=e.concat(n.geometries),t=t.concat(n.coordTimes);break}case"Point":{let n=NC(Ld(s));n.length>=2&&e.push({type:"Point",coordinates:n});break}case"LinearRing":case"LineString":{let n=hm(Ld(s));n.length>=2&&e.push({type:"LineString",coordinates:n});break}case"Polygon":{let n=[];for(let o of ar(s,"LinearRing")){let a=FC(hm(Ld(o)));a.length>=4&&n.push(a)}n.length&&e.push({type:"Polygon",coordinates:n});break}case"Track":case"gx:Track":{let n=s$(s);if(!n)break;let{times:o,geometry:a}=n;e.push(a),o.length&&t.push(o);break}}}return{geometries:e,coordTimes:t}}function n$(i){return i.length===0?null:i.length===1?i[0]:{type:"GeometryCollection",geometries:i}}function o$(i,e,t,r){var c;let{coordTimes:s,geometries:n}=LC(i),o=n$(n);if(!o&&r.skipNullGeometry)return null;let a={type:"Feature",geometry:o,properties:Object.assign(eu(i,["name","address","visibility","open","phoneNumber","description"]),MC(i),RC(i,e),mm(i),IC(i,t),PC(i),DC(i),s.length?{coordinateProperties:{times:s.length===1?s[0]:s}}:{})};((c=a.properties)==null?void 0:c.visibility)!==void 0&&(a.properties.visibility=a.properties.visibility!=="0");let l=i.getAttribute("id");return l!==null&&l!==""&&(a.id=l),a}function a$(i){return Tr(i,"gx:LatLonQuad")?{geometry:{type:"Polygon",coordinates:[FC(hm(Ld(i)))]}}:u$(i)}var l$=Math.PI/180;function c$(i,e,t){let r=[(i[0]+i[2])/2,(i[1]+i[3])/2];return[e[0].map(s=>{let n=s[1]-r[1],o=s[0]-r[0],a=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),l=Math.atan2(n,o)+t*l$;return[r[0]+Math.cos(l)*a,r[1]+Math.sin(l)*a]})]}function u$(i){let e=Tr(i,"LatLonBox");if(e){let t=yl(e,"north"),r=yl(e,"west"),s=yl(e,"east"),n=yl(e,"south"),o=yl(e,"rotation");if(typeof t=="number"&&typeof n=="number"&&typeof r=="number"&&typeof s=="number"){let a=[r,n,s,t],l=[[[r,t],[s,t],[s,n],[r,n],[r,t]]];return typeof o=="number"&&(l=c$(a,l,o)),{bbox:a,geometry:{type:"Polygon",coordinates:l}}}}return null}function h$(i,e,t,r){var l;let s=a$(i),n=(s==null?void 0:s.geometry)||null;if(!n&&r.skipNullGeometry)return null;let o={type:"Feature",geometry:n,properties:Object.assign({"@geometry-type":"groundoverlay"},eu(i,["name","address","visibility","open","phoneNumber","description"]),MC(i),RC(i,e),mm(i),TC(i),IC(i,t),PC(i),DC(i))};s!=null&&s.bbox&&(o.bbox=s.bbox),((l=o.properties)==null?void 0:l.visibility)!==void 0&&(o.properties.visibility=o.properties.visibility!=="0");let a=i.getAttribute("id");return a!==null&&a!==""&&(o.id=a),o}function d$(i){let e=i.getAttribute("id"),t=i.parentNode;return!e&&dm(t)&&t.localName==="CascadingStyle"&&(e=t.getAttribute("kml:id")||t.getAttribute("id")),Od(e||"")}function f$(i){let e={};for(let t of ar(i,"Style"))e[d$(t)]=mm(t);for(let t of ar(i,"StyleMap")){let r=Od(t.getAttribute("id")||"");xl(t,"styleUrl",s=>{s=Od(s),e[s]&&(e[r]=e[s])})}return e}function p$(i){let e={};for(let t of ar(i,"SimpleField"))e[t.getAttribute("name")||""]=um[t.getAttribute("type")||""]||um.string;return e}function*m$(i,e={skipNullGeometry:!1}){let t=f$(i),r=p$(i);for(let s of ar(i,"Placemark")){let n=o$(s,t,r,e);n&&(yield n)}for(let s of ar(i,"GroundOverlay")){let n=h$(s,t,r,e);n&&(yield n)}}function OC(i,e={skipNullGeometry:!1}){return{type:"FeatureCollection",features:Array.from(m$(i,e))}}var WC=et(tu(),1);var g$={dash:[10,5],width:1,color:16777215,alpha:1,scale:1,useTexture:!1,alignment:.5},HC=class _a{constructor(e,t={}){this.cursor=new _e,this.scale=1,this.graphics=e,t=Ne(Ne({},g$),t),this.dash=t.dash,this.dashSize=this.dash.reduce((r,s)=>r+s),this.useTexture=t.useTexture,this.options=t,this.setLineStyle()}setLineStyle(){let e=this.options;if(this.useTexture){let t=_a.getTexture(e,this.dashSize);this.graphics.lineTextureStyle({width:e.width*e.scale,color:e.color,alpha:e.alpha,texture:t,alignment:e.alignment}),this.activeTexture=t}else this.graphics.lineStyle({width:e.width*e.scale,color:e.color,alpha:e.alpha,cap:e.cap,join:e.join,alignment:e.alignment});this.scale=e.scale}static distance(e,t,r,s){return Math.sqrt(Math.pow(r-e,2)+Math.pow(s-t,2))}moveTo(e,t){return this.lineLength=0,this.cursor.set(e,t),this.start=new _e(e,t),this.graphics.moveTo(this.cursor.x,this.cursor.y),this}lineTo(e,t,r){typeof this.lineLength===void 0&&this.moveTo(0,0);let[s,n]=[this.cursor.x,this.cursor.y],o=_a.distance(s,n,e,t);if(o<1)return this;let a=Math.atan2(t-n,e-s),l=Math.cos(a),c=Math.sin(a),u=r&&e===this.start.x&&t===this.start.y;if(this.useTexture)if(this.graphics.moveTo(s,n),this.adjustLineStyle(a),u&&this.dash.length%2===0){let h=Math.min(this.dash[this.dash.length-1],o);this.graphics.lineTo(e-l*h,t-c*h),this.graphics.closePath()}else this.graphics.lineTo(e,t);else{this.setLineStyle();let h=this.lineLength%(this.dashSize*this.scale),d=0,f=0,p=0;for(let g=0;g<this.dash.length;g++){let y=this.dash[g]*this.scale;if(h<p+y){d=g,f=h-p;break}else p+=y}let m=o;for(;m>1;){let g=this.dash[d]*this.scale-f,y=m>g?g:m;if(u&&_a.distance(s+l*y,n+c*y,this.start.x,this.start.y)<=y){if(d%2===0){let b=_a.distance(s,n,this.start.x,this.start.y)-this.dash[this.dash.length-1]*this.scale;s+=l*b,n+=c*b,this.graphics.lineTo(s,n),this.lineLength+=b,this.cursor.set(s,n)}break}s+=l*y,n+=c*y,d%2?this.graphics.moveTo(s,n):this.graphics.lineTo(s,n),this.lineLength+=y,this.cursor.set(s,n),m-=y,d++,d=d===this.dash.length?0:d,f=0}}return this}closePath(){this.lineTo(this.start.x,this.start.y,!0)}drawCircle(e,t,r,s=80,n){let o=Math.PI*2/s,a=0,l=new _e(e+Math.cos(a)*r,t+Math.sin(a)*r);n?(n.apply(l,l),this.moveTo(l[0],l[1])):this.moveTo(l.x,l.y),a+=o;for(let c=1;c<s+1;c++){let u=c===s?[l.x,l.y]:[e+Math.cos(a)*r,t+Math.sin(a)*r];this.lineTo(u[0],u[1]),a+=o}return this}drawEllipse(e,t,r,s,n=80,o){let a=Math.PI*2/n,l,c=new _e,u=0;for(let h=0;h<Math.PI*2;h+=a){let d=e-r*Math.sin(h),f=t-s*Math.cos(h);o&&(c.set(d,f),o.apply(c,c),d=c.x,f=c.y),h===0?(this.moveTo(d,f),l={x:d,y:f}):this.lineTo(d,f)}return this.lineTo(l.x,l.y,!0),this}drawPolygon(e,t){let r=new _e;if(typeof e[0]=="number")if(t){r.set(e[0],e[1]),t.apply(r,r),this.moveTo(r.x,r.y);for(let s=2;s<e.length;s+=2)r.set(e[s],e[s+1]),t.apply(r,r),this.lineTo(r.x,r.y,s===e.length-2)}else{this.moveTo(e[0],e[1]);for(let s=2;s<e.length;s+=2)this.lineTo(e[s],e[s+1],s===e.length-2)}else if(t){let s=e[0];r.copyFrom(s),t.apply(r,r),this.moveTo(r.x,r.y);for(let n=1;n<e.length;n++){let o=e[n];r.copyFrom(o),t.apply(r,r),this.lineTo(r.x,r.y,n===e.length-1)}}else{let s=e[0];this.moveTo(s.x,s.y);for(let n=1;n<e.length;n++){let o=e[n];this.lineTo(o.x,o.y,n===e.length-1)}}return this}drawRect(e,t,r,s,n){if(n){let o=new _e;o.set(e,t),n.apply(o,o),this.moveTo(o.x,o.y),o.set(e+r,t),n.apply(o,o),this.lineTo(o.x,o.y),o.set(e+r,t+s),n.apply(o,o),this.lineTo(o.x,o.y),o.set(e,t+s),n.apply(o,o),this.lineTo(o.x,o.y),o.set(e,t),n.apply(o,o),this.lineTo(o.x,o.y,!0)}else this.moveTo(e,t).lineTo(e+r,t).lineTo(e+r,t+s).lineTo(e,t+s).lineTo(e,t,!0);return this}adjustLineStyle(e){let t=this.graphics.line;t.matrix=new rt,e&&t.matrix.rotate(e),this.scale!==1&&t.matrix.scale(this.scale,this.scale);let r=-this.lineLength;t.matrix.translate(this.cursor.x+r*Math.cos(e),this.cursor.y+r*Math.sin(e)),this.graphics.lineStyle(t)}static getTexture(e,t){let r=e.dash.toString();if(_a.dashTextureCache[r])return _a.dashTextureCache[r];let s=document.createElement("canvas");s.width=t,s.height=Math.ceil(e.width);let n=s.getContext("2d");if(!n)return console.warn("Did not get context from canvas"),null;n.strokeStyle="white",n.globalAlpha=e.alpha,n.lineWidth=e.width;let o=0,a=e.width/2;n.moveTo(o,a);for(let c=0;c<e.dash.length;c+=2)o+=e.dash[c],n.lineTo(o,a),e.dash.length!==c+1&&(o+=e.dash[c+1],n.moveTo(o,a));n.stroke();let l=_a.dashTextureCache[r]=xe.from(s);return l.baseTexture.scaleMode=Xi.NEAREST,l}};HC.dashTextureCache={};var nn=HC;var VC=et(jC(),1),Hd=class{constructor(){this.type=null,this.dirty=!0,this.reset()}destroy(){this.reset()}reset(){this.origCoords=null,this.origExtent=null,this.origHull=null,this.origCentroid=null,this.origPoi=null,this.origSsr=null,this.coords=null,this.extent=null,this.hull=null,this.centroid=null,this.poi=null,this.ssr=null,this.outer=null,this.flatOuter=null,this.holes=null,this.flatHoles=null,this.width=0,this.height=0,this.lod=0}update(e){if(!this.dirty||!this.origCoords||!this.origExtent)return;if(this.dirty=!1,this.coords=null,this.extent=null,this.outer=null,this.flatOuter=null,this.holes=null,this.flatHoles=null,this.hull=null,this.centroid=null,this.poi=null,this.ssr=null,this.type==="point"){this.coords=e.project(this.origCoords),this.extent=new ie(this.coords),this.centroid=this.coords,this.width=0,this.height=0,this.lod=2;return}this.extent=new ie,this.extent.min=e.project([this.origExtent.min[0],this.origExtent.max[1]]),this.extent.max=e.project([this.origExtent.max[0],this.origExtent.min[1]]);let[t,r]=this.extent.min,[s,n]=this.extent.max;if(this.width=s-t,this.height=n-r,this.width<4&&this.height<4){this.lod=0;return}let o=this.type==="line"?[this.origCoords]:this.origCoords,a=new Array(o.length),l=new Array(o.length);for(let c=0;c<o.length;++c){let u=o[c];a[c]=new Array(u.length),l[c]=new Array(u.length*2);for(let h=0;h<u.length;++h){let d=e.project(u[h]);a[c][h]=d,l[c][h*2]=d[0],l[c][h*2+1]=d[1]}}if(this.type==="line"?(this.coords=a[0],this.outer=a[0],this.flatOuter=l[0],this.holes=null,this.flatHoles=null):(this.coords=a,this.outer=a[0],this.flatOuter=l[0],this.holes=a.slice(1),this.flatHoles=l.slice(1)),this.outer.length!==0)if(this.outer.length===1)this.centroid=this.outer[0],this.origCentroid=e.invert(this.centroid),this.poi=this.centroid,this.origPoi=this.origCentroid;else if(this.outer.length===2)this.centroid=ct(this.outer[0],this.outer[1],.5),this.origCentroid=e.invert(this.centroid),this.poi=this.centroid,this.origPoi=this.origCentroid;else{if(this.origHull){this.hull=new Array(this.origHull.length);for(let c=0;c<this.origHull.length;++c)this.hull[c]=e.project(this.origHull[c])}else if(this.hull=Hs(this.outer),this.hull){this.origHull=new Array(this.hull.length);for(let c=0;c<this.origHull.length;++c)this.origHull[c]=e.invert(this.hull[c])}if(this.origCentroid?this.centroid=e.project(this.origCentroid):this.hull&&(this.hull.length===2?this.centroid=ct(this.hull[0],this.hull[1],.5):this.centroid=Pr(this.hull),this.origCentroid=e.invert(this.centroid)),this.origPoi?this.poi=e.project(this.origPoi):(this.poi=(0,VC.default)(this.coords),this.origPoi=e.invert(this.poi)),this.origSsr){this.ssr={angle:this.origSsr.angle,poly:new Array(this.origSsr.poly.length)};for(let c=0;c<this.origSsr.poly.length;++c)this.ssr.poly[c]=e.project(this.origSsr.poly[c])}else if(this.hull&&(this.ssr=r1(this.hull),this.ssr)){this.origSsr={angle:this.ssr.angle,poly:new Array(this.ssr.poly.length)};for(let c=0;c<this.ssr.poly.length;++c)this.origSsr.poly[c]=e.invert(this.ssr.poly[c])}}this.lod=2}setCoords(e){let t=this._inferType(e);if(!t)return;this.reset(),this.type=t,this.origCoords=e,this.origExtent=new ie;let r=this.origExtent;if(t==="point")r.min=e,r.max=e,this.origCentroid=e;else{let s=this.type==="line"?[this.origCoords]:this.origCoords;for(let n=0;n<s.length;++n){let o=s[n];for(let a=0;a<o.length;++a){let[l,c]=o[a];r.min=[Math.min(r.min[0],l),Math.min(r.min[1],c)],r.max=[Math.max(r.max[0],l),Math.max(r.max[1],c)]}}}this.dirty=!0}_inferType(e){let t=Array.isArray(e)&&e[0];if(typeof t=="number")return"point";let r=Array.isArray(t)&&t[0];return typeof r=="number"?"line":typeof(Array.isArray(r)&&r[0])=="number"?"polygon":null}};var wa=class{constructor(e,t){this.type="unknown",this.layer=e,this.scene=e.scene,this.renderer=e.renderer,this.context=e.context,this.featureID=t;let r=new Qe;this.container=r,r.__feature__=this,r.name=t,r.sortableChildren=!1,r.visible=!0,this._allowInteraction=!0,this._active=!1,r.eventMode="static",this.v=-1,this.lod=2,this.halo=null,this.geometry=new Hd,this._style=null,this._styleDirty=!0,this._label=null,this._labelDirty=!0,this._dataID=null,this._data=null,this._selected=!1,this._highlighted=!1,this._hovered=!1,this._drawing=!1,this.sceneBounds=new ve,this.layer.addFeature(this),this.scene.addFeature(this)}destroy(){this.layer.removeFeature(this),this.scene.removeFeature(this),this.container.filters=null,this.container.__feature__=null,this.container.destroy({children:!0}),this.container=null,this.layer=null,this.scene=null,this.renderer=null,this.context=null,this.halo&&(this.halo.destroy({children:!0}),this.halo=null),this.geometry.destroy(),this.geometry=null,this._style=null,this._label=null,this._dataID=null,this._data=null,this.sceneBounds=null}update(e,t){this.dirty&&(this.geometry.update(e,t),this._styleDirty=!1)}updateHalo(){}get id(){return this.featureID}get parentContainer(){return this.container.parent}set parentContainer(e){let t=this.container.parent;e&&e!==t?this.container.setParent(e):!e&&t&&t.removeChild(this.container)}get visible(){return this.container.visible}set visible(e){e!==this.container.visible&&(this.container.visible=e,this.updateHalo(),this._labelDirty=!0)}get allowInteraction(){return this._allowInteraction}set allowInteraction(e){e!==this._allowInteraction&&(this._allowInteraction=e,this.container&&(this.container.eventMode=this._allowInteraction&&!this._active?"static":"none"))}get active(){return this._active}set active(e){e!==this._active&&(this._active=e,this.container&&(this.container.eventMode=this._allowInteraction&&!this._active?"static":"none"))}get dirty(){return this.geometry.dirty||this._styleDirty}set dirty(e){this.geometry.dirty=e,this._styleDirty=e,this._labelDirty=e}get hovered(){return this._hovered}set hovered(e){e!==this._hovered&&(this._hovered=e,this._styleDirty=!0)}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._styleDirty=!0,this._labelDirty=!0)}get highlighted(){return this._highlighted}set highlighted(e){e!==this._highlighted&&(this._highlighted=e,this._styleDirty=!0,this._labelDirty=!0)}get drawing(){return this._drawing}set drawing(e){e!==this._drawing&&(this._drawing=e,this._styleDirty=!0)}get style(){return this._style}set style(e){this._style=e,this._styleDirty=!0}get label(){return this._label}set label(e){e!==this._label&&(this._label=e,this._labelDirty=!0)}get data(){return this._data}get dataID(){return this._dataID}setData(e,t){this._dataID=e,this._data=t,this.layer.bindData(this.id,e),this.dirty=!0}addChildData(e,t){this.layer.addChildData(e,t),this.dirty=!0}clearChildData(e){this.layer.clearChildData(e),this.dirty=!0}};function Oc(i,e={}){let r=[i[0],i[1]],s=[i[i.length-2],i[i.length-1]],n=We(r,s,1e-4),o=new Ui(i);e.native=!1,o.closeStroke=!1;let a={shape:o,lineStyle:e},l={closePointEps:1e-4,indices:[],points:[],uvs:[]};wS.buildLine(a,l);let c=l.points,u=l.indices,h=new Map,d=[],f=[],p,m,g=0,y=0,x,b,_,w,A,k;for(let I=0;I<u.length;I+=3){let T=u[I],C=u[I+1],P=u[I+2],D=[c[T*2],c[T*2+1]],O=[c[C*2],c[C*2+1]],R=[c[P*2],c[P*2+1]];if(I===0)h.set(T,!0),h.set(C,!1),h.set(P,!0),d.push(D),f.push(O),d.push(R),m=O,p=R,g=Ue(D,R);else{let N=h.get(T),F=h.get(C),B=h.get(P);N===void 0&&We(D,x,1e-4)&&(N=h.get(w),h.set(T,N)),F===void 0&&We(O,b,1e-4)&&(F=h.get(A),h.set(C,F)),B===void 0&&We(R,_,1e-4)&&(B=h.get(k),h.set(P,B));let $,U,H;N===void 0&&($=T,U=D,H=!B),F===void 0&&($=C,U=O,H=!N),B===void 0&&($=P,U=R,H=!F),$!==void 0&&(h.set($,H),H===!0?(d.push(U),g+=Ue(p,U),p=U):(f.push(U),y+=Ue(m,U),m=U))}x=D,b=O,_=R,w=T,A=C,k=P}let v={},E=d.length+f.length+1,S=new Array(E*2),M=0;for(let I=0;I<d.length;++M,++I)S[M*2]=d[I][0],S[M*2+1]=d[I][1];f.reverse();for(let I=0;I<f.length;++M,++I)S[M*2]=f[I][0],S[M*2+1]=f[I][1];if(S[S.length-2]=S[0],S[S.length-1]=S[1],v.perimeter=S,n){let I=new Array((d.length+1)*2);for(let C=0;C<d.length;++C)I[C*2]=d[C][0],I[C*2+1]=d[C][1];I[I.length-2]=d[0][0],I[I.length-1]=d[0][1];let T=new Array((f.length+1)*2);for(let C=0;C<f.length;++C)T[C*2]=f[C][0],T[C*2+1]=f[C][1];T[T.length-2]=f[0][0],T[T.length-1]=f[0][1],g>y?(v.outer=I,v.inner=T):(v.outer=T,v.inner=I)}return v}function ru(i,e,t=!1,r=!1){let n=e,o,a=[];for(let l=0;l<i.length;l++){let c=i[l];if(o){let u=Ue(o,c)-n;if(u>=0){let h=$t(o,c),d=e*Math.cos(h),f=e*Math.sin(h),p=0,m=0;t&&(p=7*Math.cos(h+Math.PI/2),m=7*Math.sin(h+Math.PI/2));let g=[o[0]+n*Math.cos(h)+p,o[1]+n*Math.sin(h)+m],y=[o,g];for(r&&u>=e*100&&(e=Math.floor(u/100)),u-=e;u>=0;u-=e)g=dt(g,[d,f]),y.push(g);y.push(c),a.push({coords:y.slice(1,-1),angle:h+(t?Math.PI/2:0)})}n=-u}o=c}return a}function xm(i){let e=new Array(i.length/2);for(let t=0;t<i.length;t+=2)e[t/2]=new _e(i[t],i[t+1]);return e}function vm(i){return i==="butt"?Bt.BUTT:i==="square"?Bt.SQUARE:Bt.ROUND}function _m(i){return i==="bevel"?Ot.BEVEL:i==="miter"?Ot.MITER:Ot.ROUND}var E$=35,A$=30,Hr=class extends wa{constructor(e,t){super(e,t),this.type="line",this._bufferdata=null;let r=new qe;r.name="casing",r.eventMode="none",r.sortableChildren=!1,this.casing=r;let s=new qe;s.name="stroke",s.eventMode="none",s.sortableChildren=!1,this.stroke=s,this.container.addChild(r,s)}destroy(){super.destroy(),this.casing=null,this.stroke=null,this._bufferdata&&(delete this._bufferdata.inner,delete this._bufferdata.outer,delete this._bufferdata.perimeter,this._bufferdata=null)}update(e,t){if(!this.dirty)return;let r=this.context.systems.map.wireframeMode,s=this.renderer.textures,n=this.container,o=this._style;if(this.geometry.dirty){this.geometry.update(e,t);let[l,c]=this.geometry.extent.min,[u,h]=this.geometry.extent.max,[d,f]=[u-l,h-c];this.sceneBounds.x=l,this.sceneBounds.y=c,this.sceneBounds.width=d,this.sceneBounds.height=f,this.updateHitArea()}if(this._styleDirty){let{width:l,height:c}=this.sceneBounds,u=!0;l<4&&c<4?(this.lod=0,this.visible=!1,this.stroke.renderable=!1,this.casing.renderable=!1,u=!1):(this.visible=!0,this.stroke.renderable=!0,t<16?(this.lod=1,this.casing.renderable=!1,u=!1):(this.lod=2,this.casing.renderable=!0,u=!0));let h=n.getChildByName("lineMarkers");if(u&&(o.lineMarkerTexture||o.lineMarkerName||o.sidedMarkerTexture||o.sidedMarkerName)){h||(h=new Qe,h.name="lineMarkers",h.eventMode="none",h.sortableChildren=!1,h.roundPixels=!1,n.addChild(h));let d=o.lineMarkerTexture||s.get(o.lineMarkerName)||xe.WHITE,f=o.sidedMarkerTexture||s.get(o.sidedMarkerName)||xe.WHITE,p=o.sidedMarkerName==="sided",m=o.lineMarkerName==="oneway";h.removeChildren(),m&&ru(this.geometry.coords,E$,!1,!0).forEach(y=>{y.coords.forEach(([x,b])=>{let _=new Dt(d);_.eventMode="none",_.sortableChildren=!1,_.anchor.set(.5,.5),_.position.set(x,b),_.rotation=y.angle,_.tint=o.lineMarkerTint,h.addChild(_)})}),p&&ru(this.geometry.coords,A$,!0,!0).forEach(y=>{y.coords.forEach(([x,b])=>{let _=new Dt(f);_.eventMode="none",_.sortableChildren=!1,_.anchor.set(.5,.5),_.position.set(x,b),_.rotation=y.angle,_.tint=o.stroke.color,h.addChild(_)})})}else h&&(n.removeChild(h),h.destroy({children:!0}));this._styleDirty=!1}this.casing.renderable&&a("casing",this.casing,this.geometry.coords,o,r),this.stroke.renderable&&a("stroke",this.stroke,this.geometry.coords,o,r),this.updateHalo();function a(l,c,u,h,d){let f=l==="casing"?3:2,p=h[l].width;t<16?p-=4:t<17&&(p-=2),p<f&&(p=f),d&&(p=1);let m=c.clear();h[l].alpha!==0&&(h[l].dash?m=new nn(m,{dash:h[l].dash,color:h[l].color,width:p,alpha:h[l].alpha||1,join:_m(h[l].join),cap:vm(h[l].cap)}):m=m.lineStyle({color:h[l].color,width:p,alpha:h[l].alpha||1,join:_m(h[l].join),cap:vm(h[l].cap)}),u.forEach(([g,y],x)=>{x===0?m.moveTo(g,y):m.lineTo(g,y)}))}}updateHitArea(){if(!this.geometry.flatOuter){this.container.hitArea=null;return}let t={alignment:.5,color:0,width:Math.max(3,this._style.casing.width||0)+10,alpha:1,join:Ot.BEVEL,cap:Bt.BUTT};this._bufferdata=Oc(this.geometry.flatOuter,t),this.container.hitArea=new Ui(this._bufferdata.perimeter)}updateHalo(){let e=this.visible&&this.hovered,t=this.visible&&this.selected,r=this.visible&&this.highlighted;if(e){if(!this.container.filters){let s=new On({distance:15,outerStrength:3,color:16776960});s.resolution=2,this.container.filters=[s]}}else if(r){if(!this.container.filters){let s=new On({distance:15,outerStrength:3,color:7377663});s.resolution=2,this.container.filters=[s]}}else this.container.filters&&(this.container.filters=null);if(t){this.halo||(this.halo=new qe,this.halo.name=`${this.id}-halo`,this.scene.layers.get("map-ui").container.addChild(this.halo));let s={alpha:.9,dash:[6,3],width:2,color:16776960};this.halo.clear();let n=new nn(this.halo,s);this._bufferdata&&(this._bufferdata.outer&&this._bufferdata.inner?(n.drawPolygon(this._bufferdata.outer),n.drawPolygon(this._bufferdata.inner)):n.drawPolygon(this._bufferdata.perimeter))}else this.halo&&(this.halo.destroy({children:!0}),this.halo=null)}get style(){return this._style}set style(e){this._style=Object.assign({},S$,e),this._styleDirty=!0}},S$={lineMarkerName:"",lineMarkerTint:0,labelTint:15658734,fill:{width:2,color:11184810,alpha:.3},casing:{width:5,color:4473924,alpha:1,cap:"round",join:"round"},stroke:{width:3,color:13421772,alpha:1,cap:"round",join:"round"}};var Ct=class extends wa{constructor(e,t){super(e,t),this.type="point",this._viewfieldCount=0,this._viewfieldName=null,this._isCircular=!1;let r=new Dt;r.name="marker",r.eventMode="none",r.sortableChildren=!1,r.visible=!0,this.marker=r;let s=new Dt;s.name="icon",s.eventMode="none",s.sortableChildren=!1,s.visible=!1,this.icon=s,this.viewfields=null,this.container.addChild(r,s)}destroy(){super.destroy(),this.marker=null,this.icon=null,this.viewfields=null}update(e,t){if(!this.dirty)return;this.updateGeometry(e,t),this.updateStyle(t);let r=this.container.position;this.sceneBounds=this.container.getLocalBounds().clone(),this.sceneBounds.x+=r.x,this.sceneBounds.y+=r.y,this.updateHitArea(),this.updateHalo()}updateGeometry(e,t){if(!this.geometry.dirty)return;this.geometry.update(e,t);let[r,s]=this.geometry.coords;this.container.position.set(r,s);let n=-this.geometry.origCoords[1];this.container.zIndex=this._viewfieldCount>0?n+1e3:n}updateStyle(e){var h,d,f,p;if(!this._styleDirty)return;let r=this.context.systems.map.wireframeMode,s=this.renderer.textures,n=this._style,o=["pin","boldPin","improveosm","osmose"].includes(n.markerName),a=this.marker,l=this.icon,c=this.geometry.origCoords[1];if(n.markerTexture||n.markerName?(a.alpha=(h=n.markerAlpha)!=null?h:1,a.tint=n.markerTint,a.visible=!0):a.visible=!1,n.iconTexture||n.iconName){l.texture=n.iconTexture||s.get(n.iconName),l.anchor.set(((d=n.anchor)==null?void 0:d.x)||.5,((f=n.anchor)==null?void 0:f.y)||.5);let m=11;l.width=m,l.height=m,l.alpha=(p=n.iconAlpha)!=null?p:1,l.tint=n.iconTint,l.visible=!0}else l.visible=!1;let u=n.viewfieldAngles||[];if(u.length>0){let m=n.viewfieldTexture||s.get(n.viewfieldName)||xe.WHITE;if(this.container.zIndex=-c+1e3,this.viewfields||(this.viewfields=new Qe,this.viewfields.name="viewfields",this.viewfields.eventMode="none",this.viewfields.sortableChildren=!1,this.viewfields.visible=!0,this.container.addChildAt(this.viewfields,0)),this._viewfieldCount!==u.length||this._viewfieldName!==n.viewfieldName){this.viewfields.removeChildren();for(let g=0;g<u.length;g++){let y=new Dt(m);y.eventMode="none",y.anchor.set(.5,.5),this.active&&(this.container.zIndex=99e3),this.viewfields.addChild(y)}this._viewfieldCount=u.length}for(let g=0;g<u.length;g++){let y=this.viewfields.getChildAt(g);y.tint=n.viewfieldTint||3355443,y.scale.set((n.scale||1)*n.fovWidth||1,(n.scale||1)*n.fovLength||1),y.angle=u[g]}}else this.viewfields&&(this.viewfields.destroy({children:!0}),this.viewfields=null,this.container.zIndex=-c,this._viewfieldCount=0);if(e<16)this.lod=0,this.visible=!1;else if(e<17||r){this.lod=1,this.visible=!0,this.container.scale.set(.8,.8),this.viewfields&&(this.viewfields.renderable=!1);let m=o?"largeCircle":n.markerName;this._isCircular=!n.markerTexture&&/(circle|midpoint)$/i.test(m),a.texture=n.markerTexture||s.get(m),a.anchor.set(.5,.5),l.position.set(0,0)}else{this.lod=2,this.visible=!0,this.container.scale.set(1,1),this.viewfields&&(this.viewfields.renderable=!0);let m=o&&u.length?"largeCircle":n.markerName;this._isCircular=!n.markerTexture&&/(circle|midpoint)$/i.test(m),a.texture=n.markerTexture||s.get(m),o&&!this._isCircular?(a.anchor.set(.5,1),l.position.set(0,-14)):(a.anchor.set(.5,.5),l.position.set(0,0))}this._styleDirty=a.texture===xe.EMPTY||l.texture===xe.EMPTY}updateHitArea(){if(!this.visible)return;if(this._drawing){this.container.hitArea=null;return}let e=20,t=this.marker.getLocalBounds().clone();if(this._isCircular){let r=t.width/2;r<e/2&&(r=e/2),r=r+2;let s=new fo(0,0,r);this.container.hitArea=s}else t.width<e&&t.pad((e-t.width)/2,0),t.height<e&&t.pad(0,(e-t.height)/2),t.pad(4),this.container.hitArea=t}updateHalo(){let e=this.visible&&this.hovered,t=this.visible&&this.selected&&!this.virtual,r=this.visible&&this.highlighted;if(e){if(!this.container.filters){let s=new On({distance:15,outerStrength:3,color:16776960});s.resolution=2,this.container.filters=[s]}}else if(r){if(!this.container.filters){let s=new On({distance:15,outerStrength:3,color:7377663});s.resolution=2,this.container.filters=[s]}}else this.container.filters&&(this.container.filters=null);if(t){this.halo||(this.halo=new qe,this.halo.name=`${this.id}-halo`,this.scene.layers.get("map-ui").container.addChild(this.halo));let s={alpha:.9,dash:[6,3],width:2,color:16776960};this.halo.clear();let n=this.container.hitArea;n instanceof fo?new nn(this.halo,s).drawCircle(n.x,n.y,n.radius,20):n instanceof ve&&new nn(this.halo,s).drawRect(n.x,n.y,n.width,n.height),this.halo.position=this.container.position}else this.halo&&(this.halo.destroy({children:!0}),this.halo=null)}get style(){return this._style}set style(e){this._style=Object.assign({},C$,e),this._styleDirty=!0}},C$={iconAlpha:1,iconName:"",iconTint:1118481,labelTint:15658734,markerAlpha:1,markerName:"smallCircle",markerTint:16777215,viewfieldAngles:[],viewfieldName:"viewfield",viewfieldTint:16777215};var Gd=32,Bn=class extends wa{constructor(e,t){super(e,t),this.type="polygon",this._ssrdata=null;let r=new Dt;r.name="lowRes",r.anchor.set(.5,.5),r.visible=!1,r.eventMode="static",this.lowRes=r;let s=new qe;s.name="fill",s.eventMode="static",s.sortableChildren=!1,this.fill=s;let n=new qe;n.name="stroke",n.eventMode="none",n.sortableChildren=!1,this.stroke=n;let o=new Rn(null,new Ms(xe.WHITE));o.name="mask",o.eventMode="static",o.visible=!1,this.mask=o,this.container.addChild(r,s,n,o)}destroy(){super.destroy(),this.lowRes=null,this.fill=null,this.mask=null,this._ssrdata&&(delete this._ssrdata.ssr,delete this._ssrdata.origSsr,delete this._ssrdata.origAxis1,delete this._ssrdata.origAxis2,delete this._ssrdata.origCenter,delete this._ssrdata.shapeType,this._ssrdata=null),this._bufferdata&&(this._bufferdata=null)}update(e,t){var A,k;if(!this.dirty)return;let r=this.context.systems.map.wireframeMode;if(this.geometry.dirty){if(this.geometry.update(e,t),this._ssrdata=null,(A=this.geometry.ssr)!=null&&A.poly){let v=this.geometry.ssr.poly,E=[(v[0][0]+v[1][0])/2,(v[0][1]+v[1][1])/2],S=[(v[2][0]+v[3][0])/2,(v[2][1]+v[3][1])/2],M=[(v[3][0]+v[0][0])/2,(v[3][1]+v[0][1])/2],I=[(v[1][0]+v[2][0])/2,(v[1][1]+v[2][1])/2],T=[E,S],C=[M,I],P=[(E[0]+S[0])/2,(E[1]+S[1])/2],D=.1,O,R,N,F;this.geometry.outer.forEach($=>{O||(O=We($,v[0],D)),R||(R=We($,v[1],D)),N||(N=We($,v[2],D)),F||(F=We($,v[3],D))});let B=O||R||N||F;this._ssrdata={ssr:this.geometry.ssr,origSsr:this.geometry.origSsr,origAxis1:T.map($=>e.invert($)),origAxis2:C.map($=>e.invert($)),origCenter:e.invert(P),shapeType:B?"square":"circle"}}if(this._bufferdata=null,this.geometry.flatOuter){let v={alignment:.5,color:0,width:16,alpha:1,join:Ot.BEVEL,cap:Bt.BUTT};this._bufferdata=Oc(this.geometry.flatOuter,v)}}let[s,n]=this.geometry.extent.min,[o,a]=this.geometry.extent.max,[l,c]=[o-s,a-n];this.sceneBounds.x=s,this.sceneBounds.y=n,this.sceneBounds.width=l,this.sceneBounds.height=c;let u=this._style,h=this.renderer.textures,d=u.fill.color||11184810,f=u.fill.alpha||.3,p=u.fill.pattern,m=u.stroke.dash||null,g=p&&h.getPatternTexture(p)||xe.WHITE,y,b=(k=this.context.systems.storage.getItem("area-fill"))!=null?k:"partial",_=!u.requireFill&&b==="partial",w=2*Gd+5;if((l<w||c<w)&&(_=!1),(l<Gd||c<Gd)&&(g=xe.WHITE),l<4&&c<4)this.lod=0,this.visible=!1,this.fill.visible=!1,this.stroke.visible=!1,this.mask.visible=!1,this.lowRes.visible=!1;else if(this._ssrdata&&l<20&&c<20){this.lod=1,this.visible=!0;let v=this._ssrdata;this.fill.visible=!1,this.stroke.visible=!1,this.mask.visible=!1,this.lowRes.visible=!0;let S=`lowres${r?"-unfilled":""}-${v.shapeType}`,[M,I]=e.project(v.origCenter),T=v.ssr.angle,C=v.origAxis1.map(R=>e.project(R)),P=v.origAxis2.map(R=>e.project(R)),D=Ue(C[0],C[1]),O=Ue(P[0],P[1]);this.lowRes.texture=h.get(S)||xe.WHITE,this.lowRes.position.set(M,I),this.lowRes.scale.set(D/10,O/10),this.lowRes.rotation=T,this.lowRes.tint=d}else this.lod=2,this.visible=!0,this.fill.visible=!0,this.stroke.visible=!0,this.lowRes.visible=!1,y={outer:new Ui(this.geometry.flatOuter),holes:(this.geometry.flatHoles||[]).map(v=>new Ui(v))};if(y&&this.stroke.visible){let v=r?1:u.fill.width||2;if(!m)this.stroke.clear().lineStyle({alpha:1,width:v,color:d}).drawShape(y.outer),y.holes.forEach(E=>this.stroke.drawShape(E));else{let E={alpha:1,dash:m,width:v,color:d};this.stroke.clear();let S=new nn(this.stroke,E),M=xm(y.outer.points);S.drawPolygon(M),y.holes.forEach(I=>S.drawPolygon(xm(I.points)))}}if(r?(this.fill.visible=!1,this.fill.clear(),this._bufferdata&&(this.container.hitArea=new Ui(this._bufferdata.perimeter))):this.container.hitArea=null,y&&this.fill.visible)if(this.fill.clear().beginTextureFill({alpha:f,color:d,texture:g}).drawShape(y.outer),y.holes.length&&(this.fill.beginHole(),y.holes.forEach(v=>this.fill.drawShape(v)),this.fill.endHole()),this.fill.endFill(),_){let v=new qe().clear().lineTextureStyle({alpha:1,alignment:0,color:0,cap:Bt.BUTT,join:Ot.BEVEL,width:Gd,texture:xe.WHITE});v.drawShape(y.outer),y.holes.length&&y.holes.forEach(E=>v.drawShape(E)),v.geometry.updateBatches(!0),this.mask.geometry=new Sr().addAttribute("aVertexPosition",v.geometry.points,2).addAttribute("aTextureCoord",v.geometry.uvs,2).addIndex(v.geometry.indices),this.mask.visible=!0,this.fill.mask=this.mask}else this.mask.visible=!1,this.fill.mask=null;this._styleDirty=!1,this.updateHalo()}updateHalo(){let e=this.context.systems.map.wireframeMode,t=this.visible&&this.hovered,r=this.visible&&this.selected,s=this.visible&&this.highlighted;if(t){if(!this.container.filters){let n=new On({distance:15,outerStrength:3,color:16776960});n.resolution=2,this.container.filters=[n]}}else if(s){if(!this.container.filters){let n=new On({distance:15,outerStrength:3,color:7377663});n.resolution=2,this.container.filters=[n]}}else this.container.filters&&(this.container.filters=null);if(r){this.halo||(this.halo=new qe,this.halo.name=`${this.id}-halo`,this.scene.layers.get("map-ui").container.addChild(this.halo));let n={alpha:.9,dash:[6,3],width:2,color:16776960};this.halo.clear();let o=new nn(this.halo,n);this._bufferdata&&(o.drawPolygon(this._bufferdata.outer),e&&o.drawPolygon(this._bufferdata.inner))}else this.halo&&(this.halo.destroy({children:!0}),this.halo=null)}get style(){return this._style}set style(e){this._style=Object.assign({},k$,e),this._styleDirty=!0}},k$={requireFill:!1,lineMarkerName:"",lineMarkerTint:0,labelTint:15658734,fill:{width:2,color:11184810,alpha:.3},casing:{width:5,color:4473924,alpha:1,cap:"round",join:"round"},stroke:{width:3,color:13421772,alpha:1,cap:"round",join:"round"}};var vl=65535,zd=class extends yt{constructor(e,t){super(e,t),this._dataUsed=null,this._fileList=null,this._template=null,this._url=null,this._geojson=null,this._geojsonExtent=null,this._fileReader=new FileReader,this._hashchange=this._hashchange.bind(this),this._updateHash=this._updateHash.bind(this),this._setFile=this._setFile.bind(this),this.setFileList=this.setFileList.bind(this);function r(s){s.stopPropagation(),s.preventDefault(),s.dataTransfer.dropEffect="copy"}this.context.container().attr("dropzone","copy").on("dragenter.draganddrop",r).on("dragexit.draganddrop",r).on("dragover.draganddrop",r).on("drop.draganddrop",s=>{s.stopPropagation(),s.preventDefault(),this.setFileList(s.dataTransfer.files)}),this.context.systems.urlhash.on("hashchange",this._hashchange),e.on("layerchange",this._updateHash)}render(e,t,r){if(!this.enabled||!this.hasData())return;let s=this.context.services.vectortile,n=[];this._template&&s?(r>=13&&s.loadTiles(this._template),n=s.getData(this._template).map(h=>h.geojson)):n=this._getFeatures(this._geojson);let o=n.filter(h=>h.geometry.type==="Polygon"||h.geometry.type==="MultiPolygon"),a=n.filter(h=>h.geometry.type==="LineString"||h.geometry.type==="MultiLineString"),l=n.filter(h=>h.geometry.type==="Point"||h.geometry.type==="MultiPoint");this.renderPolygons(e,t,r,o);let c=this.createGridLines(a),u={stroke:{width:.5,color:65535,alpha:.5,cap:Bt.ROUND}};this.renderLines(e,t,r,a),this.renderLines(e,t,r,c,u),this.renderPoints(e,t,r,l)}createGridLines(e){let t=this.context.systems.imagery.numGridSplits,r=[];if(this.context.systems.rapid.isTaskRectangular&&t>0){let s=e[0],n=s.geometry.coordinates.map(f=>f[0]),o=s.geometry.coordinates.map(f=>f[1]),a=Math.min(...n),l=Math.min(...o),c=Math.max(...n),u=Math.max(...o),h=(c-a)/t,d=(u-l)/t;for(let f=1;f<t;f++){let p=a+h*f,m=l+d*f;r.push({type:"Feature",geometry:{type:"LineString",coordinates:[[a,m],[c,m]]},id:t+"gridcol"+f}),r.push({type:"Feature",geometry:{type:"LineString",coordinates:[[p,l],[p,u]]},id:t+"gridrow"+f})}}return r}renderPolygons(e,t,r,s){let n=this.context.systems.l10n,o=this.scene.groups.get("basemap"),a={fill:{color:vl,alpha:.3},stroke:{width:2,color:vl,alpha:1,cap:Bt.ROUND},labelTint:vl};for(let l of s){let c=l.__featurehash__,u=l.v||0,h=l.geometry.type==="Polygon"?[l.geometry.coordinates]:l.geometry.type==="MultiPolygon"?l.geometry.coordinates:[];for(let d=0;d<h.length;++d){let f=h[d],p=`${this.layerID}-${c}-${d}`,m=this.features.get(p);m&&m.type!=="polygon"&&(m.destroy(),m=null),m||(m=new Bn(this,p),m.style=a,m.parentContainer=o),m.v!==u&&(m.v=u,m.geometry.setCoords(f),m.label=n.displayName(l.properties),m.setData(c,l)),this.syncFeatureClasses(m),m.update(t,r),this.retainFeature(m,e)}}}renderLines(e,t,r,s,n){let o=this.context.systems.l10n,a=this.scene.groups.get("basemap"),l=n||{stroke:{width:2,color:vl,alpha:1,cap:Bt.ROUND},labelTint:vl};for(let c of s){let u=c.__featurehash__,h=c.v||0,d=c.geometry.type==="LineString"?[c.geometry.coordinates]:c.geometry.type==="MultiLineString"?c.geometry.coordinates:[];for(let f=0;f<d.length;++f){let p=d[f],m=`${this.layerID}-${u}-${f}`,g=this.features.get(m);g&&g.type!=="line"&&(g.destroy(),g=null),g||(g=new Hr(this,m),g.style=l,g.parentContainer=a),g.v!==h&&(g.v=h,g.geometry.setCoords(p),g.label=o.displayName(c.properties),g.setData(u,c)),this.syncFeatureClasses(g),g.update(t,r),this.retainFeature(g,e)}}}renderPoints(e,t,r,s){let n=this.context.systems.l10n,o=this.scene.groups.get("points"),a={markerName:"largeCircle",markerTint:vl,iconName:"maki-circle-stroked",labelTint:vl};for(let l of s){let c=l.__featurehash__,u=l.v||0,h=l.geometry.type==="Point"?[l.geometry.coordinates]:l.geometry.type==="MultiPoint"?l.geometry.coordinates:[];for(let d=0;d<h.length;++d){let f=h[d],p=`${this.layerID}-${c}-${d}`,m=this.features.get(p);m&&m.type!=="point"&&(m.destroy(),m=null),m||(m=new Ct(this,p),m.style=a,m.parentContainer=o),m.v!==u&&(m.v=u,m.geometry.setCoords(f),m.label=n.displayName(l.properties),m.setData(c,l)),this.syncFeatureClasses(m),m.update(t,r),this.retainFeature(m,e)}}}hasData(){return!!(this._template||this._geojson)}dataUsed(){return this._dataUsed?[this._dataUsed]:[]}fitZoom(){let e=this._geojsonExtent;e&&this.context.systems.map.trimmedExtent(e)}getFileList(){return this._fileList}setFileList(e){if(this._fileList=e,this._dataUsed=null,this._geojson=null,this._geojsonExtent=null,this._template=null,this._url=null,this.scene.disableLayers(this.layerID),!e||!e.length)return;let t=e[0],r=this._getExtension(t.name);this._fileReader.onload=s=>{this._fileReader.onload=null,this._setFile(s.target.result,r)},this._fileReader.readAsText(t)}setUrl(e){if(this._url=e,this._dataUsed=null,this._fileList=null,this._geojson=null,this._geojsonExtent=null,this._template=null,this.scene.disableLayers(this.layerID),!e)return;let t=e.toLowerCase().split(/[?#]/)[0],r=t.includes("project")&&t.includes("task")&&t.includes("gpx"),s=r?".gpx":this._getExtension(t);s?fetch(e).then(Me).then(n=>{this._setFile(n,s),r&&(this._dataUsed=null,this.context.systems.rapid.setTaskExtentByGpxData(n))}).catch(n=>console.error(n)):this._setUrlTemplate(e)}_setUrlTemplate(e){var r;let t=this.context.services.osm;if(t){let s=(r=t.imageryBlocklists)!=null?r:[],n=!1,o=0,a;for(a of s)if(n=a.test(e),o++,n)return;if(!o&&(a=/.*\.google(apis)?\..*\/(vt|kh)[\?\/].*([xyz]=.*){3}.*/,n=a.test(e),n))return}this._template=e,this._dataUsed="vectortile:"+e.split(/[?#]/)[0],this.scene.enableLayers(this.layerID)}_setFile(e,t){if(!e)return;let r;switch(t){case".gpx":r=Ud(e instanceof Document?e:s(e));break;case".kml":r=OC(e instanceof Document?e:s(e));break;case".geojson":case".json":r=e instanceof Object?e:JSON.parse(e);break}r=r||{},Object.keys(r).length&&(this._dataUsed=`${t} data file`,this._geojson=this._ensureIDs(r),(0,WC.default)(this._geojson),this._geojsonExtent=this._calcExtent(r),this.fitZoom(),this.scene.enableLayers(this.layerID));function s(n){return new DOMParser().parseFromString(n,"text/xml")}}_ensureIDs(e){if(!e)return null;for(let t of this._getFeatures(e))this._ensureFeatureID(t);return e}_ensureFeatureID(e){if(!e)return;let r=this.context.services.vectortile.getNextID();return e.id=r,e.__featurehash__=r,e}_getFeatures(e){return e?e.type==="FeatureCollection"?e.features:[e]:[]}_calcExtent(e){let t=new ie;if(!e)return t;for(let s of this._getFeatures(e)){let n=s.geometry;if(!n)continue;let o=n.type,a=n.coordinates,l=/^Multi/.test(o)?a:[a];if(/Polygon$/.test(o))for(let c of l){let u=c[0];for(let h of u)r(h)}else if(/LineString$/.test(o))for(let c of l)for(let u of c)r(u);else if(/Point$/.test(o))for(let c of l)r(c)}return t;function r(s){t.min=[Math.min(t.min[0],s[0]),Math.min(t.min[1],s[1])],t.max=[Math.max(t.max[0],s[0]),Math.max(t.max[1],s[1])]}}_getExtension(e){if(!e)return;let t=/\.(gpx|kml|(geo)?json)$/i,r=e.match(t);return r&&r.length&&r[0]}_hashchange(e,t){let r=e.get("data")||e.get("gpx"),s=t.get("data")||t.get("gpx");r!==s&&this.setUrl(r)}_updateHash(){let e=this.context.systems.urlhash;e.setParam("gpx",null),e.setParam("data",null),!(!this.enabled||typeof this._url!="string")&&(/gpx/i.test(this._url)?e.setParam("gpx",this._url):e.setParam("data",this._url))}};var T$=4,jd=class extends yt{constructor(e,t){super(e,t),this.enabled=!0}get enabled(){return!0}set enabled(e){this._enabled=!0}render(e,t,r){let s;if(r>=T$){let a=this.context.systems.map.extent().rectangle();s=this.context.systems.locations.wpblocks().bbox(a),this.renderEditBlocks(e,t,r,s)}else s=[];let n=this.context.container().select(".main-content > .map-footer").selectAll(".api-status.blocks").data(s,a=>a.id);n.exit().remove();let o=n.enter().insert("div",".api-status").attr("class","api-status blocks error");o.append("span").attr("class","explanation-item").text(a=>a.text),o.append("a").attr("target","_blank").attr("href",a=>a.url).text("More Info")}renderEditBlocks(e,t,r,s){let n=this.context.systems.locations,o=this.scene.groups.get("blocks"),a={requireFill:!0,fill:{pattern:"construction",color:1,alpha:.7}};for(let l of s){let c=n.feature(l.locationSetID).geometry;if(!c)continue;let u=c.type==="Polygon"?[c.coordinates]:c.type==="MultiPolygon"?c.coordinates:[];for(let h=0;h<u.length;++h){let d=u[h],f=`${this.layerID}-${l.locationSetID}-${h}`,p=this.features.get(f);p||(p=new Bn(this,f),p.geometry.setCoords(d),p.style=a,p.parentContainer=o,p.container.cursor="not-allowed",p.setData(l.locationSetID,l)),this.syncFeatureClasses(p),p.update(t,r),this.retainFeature(p,e)}}}};var I$=12,Vd=class extends yt{constructor(e,t){super(e,t)}get supported(){return!!this.context.services.improveOSM}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.improveOSM.startAsync()))}renderMarkers(e,t,r){let s=this.context.services.improveOSM;if(!(s!=null&&s.started))return;let n=this.scene.groups.get("qa"),o=s.getData();for(let a of o){let l=`${this.layerID}-${a.id}`,c=this.features.get(l);if(!c){let u={markerName:"improveosm",markerTint:s.getColor(a.itemType),iconName:a.icon};c=new Ct(this,l),c.geometry.setCoords(a.loc),c.style=u,c.parentContainer=n,c.setData(a.id,a)}this.syncFeatureClasses(c),c.update(t,r),c._isCircular||c.icon.position.set(0,-17),this.retainFeature(c,e)}}render(e,t,r){let s=this.context.services.improveOSM;!this.enabled||!(s!=null&&s.started)||r<I$||(s.loadTiles(),this.renderMarkers(e,t,r))}};var M$=12,bm=2147583,P$={casing:{alpha:0},stroke:{alpha:.9,width:4,color:bm}},D$={markerName:"mediumCircle",markerTint:bm,viewfieldName:"viewfield",viewfieldTint:bm},Wd=class extends yt{constructor(e,t){super(e,t)}get supported(){return!!this.context.services.kartaview}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.kartaview.startAsync()))}filterImages(e){let t=this.context.systems.photos,r=t.fromDate,s=t.toDate;if(r){let n=new Date(r).getTime();e=e.filter(o=>new Date(o.captured_at).getTime()>=n)}if(s){let n=new Date(s).getTime();e=e.filter(o=>new Date(o.captured_at).getTime()<=n)}return e}filterSequences(e){let t=this.context.systems.photos,r=t.fromDate,s=t.toDate;if(r){let n=new Date(r).getTime();e=e.filter(o=>new Date(o.properties.captured_at).getTime()>=n)}if(s){let n=new Date(s).getTime();e=e.filter(o=>new Date(o.properties.captured_at).getTime()<=n)}return e}renderMarkers(e,t,r){let s=this.context.services.kartaview;if(!(s!=null&&s.started))return;let n=this.scene.groups.get("streetview"),o=s.getImages(),a=s.getSequences(),l=this.filterSequences(a),c=this.filterImages(o);for(let u of l){let h=`${this.layerID}-sequence-${u.properties.id}`,d=u.properties.v||0,f=this.features.get(h);f||(f=new Hr(this,h),f.style=P$,f.parentContainer=n,f.container.zIndex=-100),f.v!==d&&(f.v=d,f.geometry.setCoords(u.coordinates),f.setData(u.properties.id,u)),this.syncFeatureClasses(f),f.update(t,r),this.retainFeature(f,e)}for(let u of c){let h=`${this.layerID}-photo-${u.id}`,d=this.features.get(h);if(!d){let f=Object.assign({},D$);Number.isFinite(u.ca)&&(f.viewfieldAngles=[u.ca]),u.isPano&&(f.viewfieldName="pano"),d=new Ct(this,h),d.geometry.setCoords(u.loc),d.style=f,d.parentContainer=n,d.setData(u.id,u),u.sequenceID&&d.addChildData(u.sequenceID,u.id)}this.syncFeatureClasses(d),d.update(t,r),this.retainFeature(d,e)}}render(e,t,r){let s=this.context.services.kartaview;!this.enabled||!(s!=null&&s.started)||r<M$||(s.loadTiles(),this.renderMarkers(e,t,r))}};var R$=12,Xd=class extends yt{constructor(e,t){super(e,t)}get supported(){return!!this.context.services.keepRight}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.keepRight.startAsync()))}renderMarkers(e,t,r){let s=this.context.services.keepRight;if(!(s!=null&&s.started))return;let n=this.scene.groups.get("qa"),o=s.getData();for(let a of o){let l=`${this.layerID}-${a.id}`,c=this.features.get(l);if(!c){let u={markerName:"keepright",markerTint:s.getColor(a.parentIssueType)};c=new Ct(this,l),c.geometry.setCoords(a.loc),c.style=u,c.parentContainer=n,c.setData(a.id,a)}this.syncFeatureClasses(c),c.update(t,r),this.retainFeature(c,e)}}render(e,t,r){let s=this.context.services.keepRight;!this.enabled||!(s!=null&&s.started)||r<R$||(s.loadTiles(),this.renderMarkers(e,t,r))}};var qC=et(Zr(),1);var N$=12,wm={fill:3355443,fontFamily:"Arial, Helvetica, sans-serif",fontSize:11,fontWeight:600,lineJoin:"round",stroke:16777215,strokeThickness:2.7},XC={fill:3355443,fontFamily:"Arial, Helvetica, sans-serif",fontSize:11,fontStyle:"italic",fontWeight:600,lineJoin:"round",stroke:16777215,strokeThickness:2.7},qd=class{constructor(e,t,r){this.id=e,this.type=t,this.options=r,this.displayObject=null}},Qd=class extends yt{constructor(e,t){super(e,t),this.enabled=!0;let r=this.scene.groups.get("labels");r.eventMode="none";let s=new z4(5e4);s.name="debug",s.eventMode="none",s.roundPixels=!1,s.sortableChildren=!1,this.debugContainer=s;let n=new Qe;n.name="labels",n.eventMode="none",n.sortableChildren=!0,this.labelContainer=n,r.addChild(s,n),this._rbush=new qC.default,this._avoidBoxes=new Map,this._labelBoxes=new Map,this._labels=new Map,this._oldk=0,Ki.from("label-normal",wm,{chars:Ki.ASCII,padding:0,resolution:2}),this._textStyleNormal=new Hi(wm),this._textStyleItalic=new Hi(XC)}reset(){super.reset();for(let e of this._labels.values())e.displayObject&&(e.displayObject.destroy({children:!0,texture:!1,baseTexture:!1}),e.displayObject=null);this._avoidBoxes.clear(),this._labelBoxes.clear(),this._labels.clear(),this._rbush.clear()}resetFeature(e){let t=new Set,r=new Set;(this._labelBoxes.get(e)||[]).forEach(s=>t.add(s)),(this._avoidBoxes.get(e)||[]).forEach(s=>t.add(s));for(let s of t.values())this._rbush.remove(s),s.labelID&&r.add(s.labelID);this._labelBoxes.delete(e),this._avoidBoxes.delete(e);for(let s of r.values()){let n=this._labels.get(s);n&&n.displayObject&&(n.displayObject.destroy({children:!0,texture:!1,baseTexture:!1}),n.displayObject=null),this._labels.delete(s)}}render(e,t,r){if(this.enabled&&r>=N$){this.labelContainer.visible=!0,this.debugContainer.visible=this.context.getDebug("label");let s=t.scale();s!==this._oldk&&(this.reset(),this._oldk=s);for(let l of this.scene.features.values())l._labelDirty&&(this.resetFeature(l.id),l._labelDirty=!1);this.gatherAvoids();let n=[],o=[],a=[];for(let l of this.scene.features.values())l.label&&l.visible&&!this._labelBoxes.has(l.id)&&(l.type==="point"?n.push(l):l.type==="line"?o.push(l):l.type==="polygon"&&a.push(l));this.labelPoints(n),this.labelLines(o),this.labelPolygons(a),this.renderObjects(t)}else this.labelContainer.visible=!1,this.debugContainer.visible=!1}getLabelSprite(e,t="normal"){let r=`${e}-${t}`,s=this.renderer.textures,n=s.getTexture("text",r);if(!n){let a=0,l=e.match(new RegExp("\\p{M}","gu"));l&&l.length>0&&(a=10),l&&l.length>20&&(a=50);let c;if(a){let g=Object.assign({},t==="normal"?wm:XC,{padding:a});c=new Hi(g)}else c=t==="normal"?this._textStyleNormal:this._textStyleItalic;let u=new Mc(e,c);u.resolution=2,u.updateText(!1);let[h,d]=[a*2,0],[f,p]=[u.canvas.width-a*4,u.canvas.height],m=u.context.getImageData(h,d,f,p);n=s.allocate("text",e,f,p,m),n.orig=u.texture.orig.clone(),n.orig.width=f/2,n.orig.height=p/2,u.destroy()}let o=new Dt(n);return o.name=e,o.anchor.set(.5,.5),o}gatherAvoids(){let e=this.context.getDebug("label"),t=l.bind(this),r=[],n=this.scene.layers.get("map-ui").container.getChildByName("selected");n&&r.push(n);let o=this.scene.groups.get("points");o&&r.push(o);let a=[];r.forEach(c=>c.children.forEach(t)),a.length&&this._rbush.load(a);function l(c){if(!c.visible||!c.renderable)return;let u=c.name;if(this._avoidBoxes.has(u))return;let h=this.scene.features.get(u),d=h&&h.sceneBounds;if(!d)return;let f=.01,p={type:"avoid",boxID:`${u}-avoid`,featureID:u,minX:d.x+f,minY:d.y+f,maxX:d.x+d.width-f,maxY:d.y+d.height-f};this._avoidBoxes.set(u,[p]),a.push(p);let m=this._rbush.search(p);for(let g of m)if(g.type==="label"){let y=this.scene.features.get(g.featureID);y&&(y._labelDirty=!0)}}}labelPoints(e){e.sort((t,r)=>r.geometry.origCoords[1]-t.geometry.origCoords[1]);for(let t of e){if(this._labelBoxes.has(t.id)||(this._labelBoxes.set(t.id,[]),!t.label))continue;let r;/^[\x20-\x7E]*$/.test(t.label)?(r=new Z4(t.label,{fontName:"label-normal"}),r.updateText(),r.name=t.label,r.anchor.set(.5,1)):r=this.getLabelSprite(t.label,"normal"),this.placeTextLabel(t,r)}}labelLines(e){function t(r){let s=parseInt(r.container.parent.name,10);return isNaN(s)?999:s}e.sort((r,s)=>t(s)-t(r));for(let r of e){let s=r.id;if(this._labelBoxes.has(s)||(this._labelBoxes.set(s,[]),!r.label)||!r.geometry.coords||!r.container.visible||!r.container.renderable||r.geometry.width<40&&r.geometry.height<40)continue;let n=this.getLabelSprite(r.label,"normal");this.placeRopeLabel(r,n,r.geometry.coords)}}labelPolygons(e){for(let t of e){let r=t.id;if(this._labelBoxes.has(r)||(this._labelBoxes.set(r,[]),!t.label)||!t.geometry.flatOuter||!t.container.visible||!t.container.renderable||t.geometry.width<600&&t.geometry.height<600)continue;let s=this.getLabelSprite(t.label,"italic"),n={alignment:.5,color:0,width:24,alpha:1,join:Ot.BEVEL,cap:Bt.BUTT},o=Oc(t.geometry.flatOuter,n);if(!o.inner)continue;let a=new Array(o.inner.length/2);for(let l=0;l<o.inner.length/2;++l)a[l]=[o.inner[l*2],o.inner[l*2+1]];this.placeRopeLabel(t,s,a)}}placeTextLabel(e,t){if(!e||!e.sceneBounds)return;let r=e.container;if(!r.visible||!r.renderable)return;let s=e.id,n=e.sceneBounds.clone().pad(1,0),o=n.x,a=n.y,l=n.width,c=n.height,u=n.x+l,h=n.x+l*.5,d=n.y+c,f=e.type==="point"?n.y+c-14:n.y+c*.5,p=t.getLocalBounds().clone().pad(0,-1),m=5,g=10,y=p.width,x=p.height,b=y*.5,_=x*.5,w={t1:[h-g,a-_],t2:[h-m,a-_],t3:[h,a-_],t4:[h+m,a-_],t5:[h+g,a-_],b1:[h-g,d+_],b2:[h-m,d+_],b3:[h,d+_],b4:[h+m,d+_],b5:[h+g,d+_],r1:[u+b,f-g],r2:[u+b,f-m],r3:[u+b,f],r4:[u+b,f+m],r5:[u+b,f+g],l1:[o-b,f-g],l2:[o-b,f-m],l3:[o-b,f],l4:[o-b,f+m],l5:[o-b,f+g]},A;this.context.systems.l10n.isRTL()?A=["l3","l4","l2","b3","b2","b4","b1","b5","t3","t2","t4","t1","t5","r3","r4","r2","l5","l1","r5","r1"]:A=["r3","r4","r2","b3","b4","b2","b5","b1","l3","l4","l2","t3","t4","t2","t5","t1","r5","r1","l5","l1"];let v=null;for(let E=0;!v&&E<A.length;E++){let S=A[E],[M,I]=w[S],T=.01,C={type:"label",boxID:`${s}-${S}`,featureID:s,labelID:s,minX:M-b+T,minY:I-_+T,maxX:M+b-T,maxY:I+_-T};if(!this._rbush.collides(C)){let P=new qd(s,"text",{str:e.label,labelObj:t,x:M,y:I,tint:e.style.labelTint||15658734});this._labels.set(s,P),this._labelBoxes.get(s).push(C),this._rbush.insert(C),v=S}}}placeRopeLabel(e,t,r){if(!e||!t||!r||!e.container.visible||!e.container.renderable)return;let s=e.id,n=t.getLocalBounds(),o=n.width,a=n.height,l=Math.PI/8,c=a+4,u=c*.5,h=Math.ceil(o/c)+1,d=o/((h-1)*c),f=h+15,p=ru(r,c),m=[],g=[],y=[],x=null;function b(){let _=y.length>=h;_&&g.push(y),y.forEach(w=>{w.box.candidate=_,m.push(w.box)}),y=[]}p.forEach((_,w)=>{let A=_.angle;A<0&&(A+=Math.PI),_.coords.forEach((k,v)=>{let[E,S]=k,M=.01,I={type:"label",boxID:`${s}-${w}-${v}`,featureID:s,minX:E-u+M,minY:S-u+M,maxX:E+u-M,maxY:S+u-M},T=!1;if(x!==null){let C=Math.abs(A-x);T=Math.min(2*Math.PI-C,C)>l}x=A,T?(b(),I.bendy=!0,m.push(I)):this._rbush.collides(I)?(b(),I.collides=!0,m.push(I)):(y.push({box:I,coord:k,angle:A}),y.length===f&&b())})}),b(),g.forEach((_,w)=>{let A=Math.floor((_.length-h)/2),k=`${s}-rope-${w}`,v=[];for(let T=A;T<A+h;T++){v.push(_[T].coord);let C=_[T].box;C.labelID=k,this._rbush.insert(C),this._labelBoxes.get(s).push(C)}if(!v.length)return;v[0][0]>v[v.length-1][0]&&v.reverse();let E=$t(v[0],v[v.length-1]),S=v.reduce((T,C)=>dt(T,C),[0,0]),M=mr(S,1/v.length);v=v.map(T=>Ze(T,M)),v=Zn(v,-E,[0,0]),v=v.map(([T,C])=>[T*d,C]),v=Zn(v,E,[0,0]),v=v.map(T=>dt(T,M));let I=new qd(k,"rope",{str:e.label,coords:v,labelObj:t,tint:e.style.labelTint||15658734});this._labels.set(k,I)})}renderObjects(e){let t=this.context,r=t.getDebug("label"),s=t.pixi.screen,n=t.pixi.stage.position,o=new ie([s.x-n.x,s.y-n.y],[s.width-n.x,s.height-n.y]),a=new Set,l=this._rbush.search(o.bbox());for(let c of l)c.labelID&&a.add(c.labelID);for(let c of a.values()){let u=this._labels.get(c);if(!u)continue;let h=u.options;if(!u.displayObject){if(u.type==="text"){let d=h.labelObj;d.tint=h.tint||16777215,d.position.set(h.x,h.y),u.displayObject=d,this.labelContainer.addChild(d)}else if(u.type==="rope"){let d=h.labelObj,f=h.coords.map(([m,g])=>new _e(m,g)),p=new G4(d.texture,f);p.name=c,p.autoUpdate=!1,p.sortableChildren=!1,p.tint=h.tint||16777215,u.displayObject=p,this.labelContainer.addChild(p)}}}}};var F$=12,Yd=class extends yt{constructor(e,t){super(e,t)}get supported(){return!!this.context.services.mapillary}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.mapillary.startAsync()))}filterDetections(e){let t=this.context.systems.photos,r=t.fromDate,s=t.toDate;if(r){let n=new Date(r).getTime();e=e.filter(o=>new Date(o.last_seen_at).getTime()>=n)}if(s){let n=new Date(s).getTime();e=e.filter(o=>new Date(o.first_seen_at).getTime()>=n)}return e}renderMarkers(e,t,r){let s=this.context.services.mapillary;if(!(s!=null&&s.started))return;let n=this.scene.groups.get("points"),o=s.getData("points");o=this.filterDetections(o);for(let a of o){let l=`${this.layerID}-${a.id}`,c=this.features.get(l);if(!c){let u={markerName:a.value};c=new Ct(this,l),c.geometry.setCoords(a.loc),c.style=u,c.parentContainer=n,c.setData(a.id,a)}this.syncFeatureClasses(c),c.update(t,r),this.retainFeature(c,e)}}render(e,t,r){let s=this.context.services.mapillary;this.enabled&&(s!=null&&s.started)&&r>=F$?(s.loadTiles("points"),s.showFeatureDetections(!0),this.renderMarkers(e,t,r)):s==null||s.showFeatureDetections(!1)}};function QC(i,e){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(e).domain(i);break}return this}function Em(i){return function(){return i}}function Am(i){return+i}var YC=[0,1];function Bc(i){return i}function Sm(i,e){return(e-=i=+i)?function(t){return(t-i)/e}:Em(isNaN(e)?NaN:.5)}function L$(i,e){var t;return i>e&&(t=i,i=e,e=t),function(r){return Math.max(i,Math.min(e,r))}}function O$(i,e,t){var r=i[0],s=i[1],n=e[0],o=e[1];return s<r?(r=Sm(s,r),n=t(o,n)):(r=Sm(r,s),n=t(n,o)),function(a){return n(r(a))}}function B$(i,e,t){var r=Math.min(i.length,e.length)-1,s=new Array(r),n=new Array(r),o=-1;for(i[r]<i[0]&&(i=i.slice().reverse(),e=e.slice().reverse());++o<r;)s[o]=Sm(i[o],i[o+1]),n[o]=t(e[o],e[o+1]);return function(a){var l=m7(i,a,1,r)-1;return n[l](s[l](a))}}function KC(i,e){return e.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function U$(){var i=YC,e=YC,t=pn,r,s,n,o=Bc,a,l,c;function u(){var d=Math.min(i.length,e.length);return o!==Bc&&(o=L$(i[0],i[d-1])),a=d>2?B$:O$,l=c=null,h}function h(d){return d==null||isNaN(d=+d)?n:(l||(l=a(i.map(r),e,t)))(r(o(d)))}return h.invert=function(d){return o(s((c||(c=a(e,i.map(r),qt)))(d)))},h.domain=function(d){return arguments.length?(i=Array.from(d,Am),u()):i.slice()},h.range=function(d){return arguments.length?(e=Array.from(d),u()):e.slice()},h.rangeRound=function(d){return e=Array.from(d),t=W7,u()},h.clamp=function(d){return arguments.length?(o=d?!0:Bc,u()):o!==Bc},h.interpolate=function(d){return arguments.length?(t=d,u()):t},h.unknown=function(d){return arguments.length?(n=d,h):n},function(d,f){return r=d,s=f,u()}}function Cm(){return U$()(Bc,Bc)}function ZC(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function _l(i,e){if((t=(i=e?i.toExponential(e-1):i.toExponential()).indexOf("e"))<0)return null;var t,r=i.slice(0,t);return[r.length>1?r[0]+r.slice(2):r,+i.slice(t+1)]}function Un(i){return i=_l(Math.abs(i)),i?i[1]:NaN}function JC(i,e){return function(t,r){for(var s=t.length,n=[],o=0,a=i[0],l=0;s>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),n.push(t.substring(s-=a,s+a)),!((l+=a+1)>r));)a=i[o=(o+1)%i.length];return n.reverse().join(e)}}function ek(i){return function(e){return e.replace(/[0-9]/g,function(t){return i[+t]})}}var $$=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ea(i){if(!(e=$$.exec(i)))throw new Error("invalid format: "+i);var e;return new Kd({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Ea.prototype=Kd.prototype;function Kd(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}Kd.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function tk(i){e:for(var e=i.length,t=1,r=-1,s;t<e;++t)switch(i[t]){case".":r=s=t;break;case"0":r===0&&(r=t),s=t;break;default:if(!+i[t])break e;r>0&&(r=0);break}return r>0?i.slice(0,r)+i.slice(s+1):i}var km;function ik(i,e){var t=_l(i,e);if(!t)return i+"";var r=t[0],s=t[1],n=s-(km=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,o=r.length;return n===o?r:n>o?r+new Array(n-o+1).join("0"):n>0?r.slice(0,n)+"."+r.slice(n):"0."+new Array(1-n).join("0")+_l(i,Math.max(0,e+n-1))[0]}function Tm(i,e){var t=_l(i,e);if(!t)return i+"";var r=t[0],s=t[1];return s<0?"0."+new Array(-s).join("0")+r:r.length>s+1?r.slice(0,s+1)+"."+r.slice(s+1):r+new Array(s-r.length+2).join("0")}var Im={"%":(i,e)=>(i*100).toFixed(e),b:i=>Math.round(i).toString(2),c:i=>i+"",d:ZC,e:(i,e)=>i.toExponential(e),f:(i,e)=>i.toFixed(e),g:(i,e)=>i.toPrecision(e),o:i=>Math.round(i).toString(8),p:(i,e)=>Tm(i*100,e),r:Tm,s:ik,X:i=>Math.round(i).toString(16).toUpperCase(),x:i=>Math.round(i).toString(16)};function Mm(i){return i}var rk=Array.prototype.map,sk=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function nk(i){var e=i.grouping===void 0||i.thousands===void 0?Mm:JC(rk.call(i.grouping,Number),i.thousands+""),t=i.currency===void 0?"":i.currency[0]+"",r=i.currency===void 0?"":i.currency[1]+"",s=i.decimal===void 0?".":i.decimal+"",n=i.numerals===void 0?Mm:ek(rk.call(i.numerals,String)),o=i.percent===void 0?"%":i.percent+"",a=i.minus===void 0?"\u2212":i.minus+"",l=i.nan===void 0?"NaN":i.nan+"";function c(h){h=Ea(h);var d=h.fill,f=h.align,p=h.sign,m=h.symbol,g=h.zero,y=h.width,x=h.comma,b=h.precision,_=h.trim,w=h.type;w==="n"?(x=!0,w="g"):Im[w]||(b===void 0&&(b=12),_=!0,w="g"),(g||d==="0"&&f==="=")&&(g=!0,d="0",f="=");var A=m==="$"?t:m==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",k=m==="$"?r:/[%p]/.test(w)?o:"",v=Im[w],E=/[defgprs%]/.test(w);b=b===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function S(M){var I=A,T=k,C,P,D;if(w==="c")T=v(M)+T,M="";else{M=+M;var O=M<0||1/M<0;if(M=isNaN(M)?l:v(Math.abs(M),b),_&&(M=tk(M)),O&&+M==0&&p!=="+"&&(O=!1),I=(O?p==="("?p:a:p==="-"||p==="("?"":p)+I,T=(w==="s"?sk[8+km/3]:"")+T+(O&&p==="("?")":""),E){for(C=-1,P=M.length;++C<P;)if(D=M.charCodeAt(C),48>D||D>57){T=(D===46?s+M.slice(C+1):M.slice(C))+T,M=M.slice(0,C);break}}}x&&!g&&(M=e(M,1/0));var R=I.length+M.length+T.length,N=R<y?new Array(y-R+1).join(d):"";switch(x&&g&&(M=e(N+M,N.length?y-T.length:1/0),N=""),f){case"<":M=I+M+T+N;break;case"=":M=I+N+M+T;break;case"^":M=N.slice(0,R=N.length>>1)+I+M+T+N.slice(R);break;default:M=N+I+M+T;break}return n(M)}return S.toString=function(){return h+""},S}function u(h,d){var f=c((h=Ea(h),h.type="f",h)),p=Math.max(-8,Math.min(8,Math.floor(Un(d)/3)))*3,m=Math.pow(10,-p),g=sk[8+p/3];return function(y){return f(m*y)+g}}return{format:c,formatPrefix:u}}var Zd,Jd,e6;Pm({thousands:",",grouping:[3],currency:["$",""]});function Pm(i){return Zd=nk(i),Jd=Zd.format,e6=Zd.formatPrefix,Zd}function Dm(i){return Math.max(0,-Un(Math.abs(i)))}function Rm(i,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Un(e)/3)))*3-Un(Math.abs(i)))}function Nm(i,e){return i=Math.abs(i),e=Math.abs(e)-i,Math.max(0,Un(e)-Un(i))+1}function Fm(i,e,t,r){var s=y7(i,e,t),n;switch(r=Ea(r==null?",f":r),r.type){case"s":{var o=Math.max(Math.abs(i),Math.abs(e));return r.precision==null&&!isNaN(n=Rm(s,o))&&(r.precision=n),e6(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(n=Nm(s,Math.max(Math.abs(i),Math.abs(e))))&&(r.precision=n-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(n=Dm(s))&&(r.precision=n-(r.type==="%")*2);break}}return Jd(r)}function H$(i){var e=i.domain;return i.ticks=function(t){var r=e();return D3(r[0],r[r.length-1],t==null?10:t)},i.tickFormat=function(t,r){var s=e();return Fm(s[0],s[s.length-1],t==null?10:t,r)},i.nice=function(t){t==null&&(t=10);var r=e(),s=0,n=r.length-1,o=r[s],a=r[n],l,c,u=10;for(a<o&&(c=o,o=a,a=c,c=s,s=n,n=c);u-- >0;){if(c=v0(o,a,t),c===l)return r[s]=o,r[n]=a,e(r);if(c>0)o=Math.floor(o/c)*c,a=Math.ceil(a/c)*c;else if(c<0)o=Math.ceil(o*c)/c,a=Math.floor(a*c)/c;else break;l=c}return i},i}function Uc(){var i=Cm();return i.copy=function(){return KC(i,Uc())},QC.apply(i,arguments),H$(i)}var G$=12,su=379747,ok=16772608,nu={min:0,max:3},z$=Uc([nu.min,nu.max],[1,.5]),j$=Uc([nu.min,nu.max],[1,2]),V$={casing:{alpha:0},stroke:{alpha:.9,width:4,color:su}},W$={markerName:"mediumCircle",markerTint:su,viewfieldName:"viewfield",viewfieldTint:su},t6=class extends yt{constructor(e,t){if(super(e,t),this._handleBearingChange=this._handleBearingChange.bind(this),this._handleFovChange=this._handleFovChange.bind(this),this._handleZoomRetrieval=this._handleZoomRetrieval.bind(this),this._viewerCompassAngle=null,this._viewerZoom=nu.min,this.supported){let r=this.context.services.mapillary;r.on("bearingChanged",this._handleBearingChange),r.on("fovChanged",this._handleFovChange)}}_handleBearingChange(e){this._viewerCompassAngle=e.bearing}_handleFovChange(){this.context.services.mapillary._mlyViewer.getZoom().then(this._handleZoomRetrieval)}_handleZoomRetrieval(e){this._viewerZoom=e}get supported(){return!!this.context.services.mapillary}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.mapillary.startAsync()))}filterImages(e){let t=this.context.systems.photos,r=t.fromDate,s=t.toDate,n=t.usernames,o=t.showsPhotoType("flat"),a=t.showsPhotoType("panoramic");if(!o&&!a)return[];if(a&&!o?e=e.filter(l=>l.isPano):!a&&o&&(e=e.filter(l=>!l.isPano)),r){let l=new Date(r).getTime();e=e.filter(c=>new Date(c.captured_at).getTime()>=l)}if(s){let l=new Date(s).getTime();e=e.filter(c=>new Date(c.captured_at).getTime()<=l)}return n&&(e=e.filter(l=>n.indexOf(l.captured_by)!==-1)),e}filterSequences(e){let t=this.context.systems.photos,r=t.fromDate,s=t.toDate,n=t.usernames,o=t.showsPhotoType("flat"),a=t.showsPhotoType("panoramic");if(!o&&!a)return[];if(a&&!o?e=e.filter(l=>l[0].properties.is_pano):!a&&o&&(e=e.filter(l=>!l[0].properties.is_pano)),r){let l=new Date(r).getTime();e=e.filter(c=>new Date(c[0].properties.captured_at).getTime()>=l)}if(s){let l=new Date(s).getTime();e=e.filter(c=>new Date(c[0].properties.captured_at).getTime()<=l)}return n&&(e=e.filter(l=>n.indexOf(l[0].properties.captured_by)!==-1)),e}renderMarkers(e,t,r){var h;let s=this.context.services.mapillary,n=(h=this._classHasData.get("active"))!=null?h:new Set;if(!(s!=null&&s.started))return;let o=this.scene.groups.get("streetview"),a=s.getSequences(),l=s.getData("images"),c=this.filterSequences(a),u=this.filterImages(l);for(let d of c)for(let f=0;f<d.length;++f){let p=d[f],m=p.properties.id,g=`${this.layerID}-sequence-${m}-${f}`,y=this.features.get(g);y||(y=new Hr(this,g),y.geometry.setCoords(p.geometry.coordinates),y.style=V$,y.parentContainer=o,y.container.zIndex=-100,y.setData(m,p)),this.syncFeatureClasses(y),y.update(t,r),this.retainFeature(y,e)}for(let d of u){let f=`${this.layerID}-photo-${d.id}`,p=this.features.get(f);if(!p){let m=Object.assign({},W$);Number.isFinite(d.ca)&&(m.viewfieldAngles=[d.ca]),d.isPano&&(m.viewfieldName="pano"),p=new Ct(this,f),p.geometry.setCoords(d.loc),p.style=m,p.parentContainer=o,p.setData(d.id,d),d.sequenceID&&p.addChildData(d.sequenceID,d.id)}this.syncFeatureClasses(p),n.has(d.id)?(p.active=!0,p.style.viewfieldAngles=[this._viewerCompassAngle],p.style.viewfieldName="viewfield",p.style.viewfieldTint=ok,p.style.markerTint=ok,p.style.scale=2,p.style.fovWidth=z$(this._viewerZoom),p.style.fovLength=j$(this._viewerZoom)):(p.active=!1,p.style.viewfieldName=d.isPano?"pano":"viewfield",p.style.viewfieldTint=su,p.style.markerTint=su,p.style.scale=1,p.style.fovWidth=1,p.style.fovLength=1),p.update(t,r),this.retainFeature(p,e)}}render(e,t,r){let s=this.context.services.mapillary;!this.enabled||!(s!=null&&s.started)||r<G$||(s.loadTiles("images"),this.renderMarkers(e,t,r))}};var X$=12,i6=class extends yt{constructor(e,t){super(e,t)}get supported(){return!!this.context.services.mapillary}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.mapillary.startAsync()))}filterDetections(e){let t=this.context.systems.photos,r=t.fromDate,s=t.toDate;if(r){let n=new Date(r).getTime();e=e.filter(o=>new Date(o.last_seen_at).getTime()>=n)}if(s){let n=new Date(s).getTime();e=e.filter(o=>new Date(o.first_seen_at).getTime()>=n)}return e}renderMarkers(e,t,r){let s=this.context.services.mapillary;if(!(s!=null&&s.started))return;let n=this.scene.groups.get("points"),o=s.getData("signs");o=this.filterDetections(o);for(let a of o){let l=`${this.layerID}-${a.id}`,c=this.features.get(l);if(!c){let u={markerName:a.value};c=new Ct(this,l),c.geometry.setCoords(a.loc),c.style=u,c.parentContainer=n,c.setData(a.id,a)}this.syncFeatureClasses(c),c.update(t,r),this.retainFeature(c,e)}}render(e,t,r){let s=this.context.services.mapillary;this.enabled&&(s!=null&&s.started)&&r>=X$?(s.loadTiles("signs"),s.showSignDetections(!0),this.renderMarkers(e,t,r)):s==null||s.showSignDetections(!1)}};var r6=class extends yt{constructor(e,t){super(e,t),this.enabled=!0;let r=new Qe;r.name=t,r.sortableChildren=!0,this.container=r,this.scene.groups.get("ui").addChild(r),this._oldk=0,this._geolocationData=null,this._geolocationDirty=!1;let n=new Qe;n.name="geolocation",n.eventMode="none",n.sortableChildren=!1,n.visible=!1,this.geolocationContainer=n;let o=new Qe;o.name="tile-debug",o.eventMode="none",o.sortableChildren=!1,o.visible=!1,this.tileDebugContainer=o;let a=new Qe;a.name="selected",a.sortableChildren=!0,a.visible=!0,this.selectedContainer=a,this._lassoPolygonData=null,this._lassoPolygonDirty=!1,this._lassoLineGraphics=new qe,this._lassoFillGraphics=new qe;let l=new Qe;l.name="lasso",l.eventMode="none",l.sortableChildren=!1,l.visible=!0,l.addChild(this._lassoLineGraphics,this._lassoFillGraphics),this.lassoContainer=l,this.container.addChild(n,o,a,l)}get enabled(){return!0}set enabled(e){this._enabled=!0}get geolocationData(){return this._geolocationData}set geolocationData(e){this._geolocationData=e,this._geolocationDirty=!0}get lassoPolygonData(){return this._lassoPolygonData}set lassoPolygonData(e){this._lassoPolygonData=e,this._lassoPolygonDirty=!0}render(e,t){let r=t.scale();r!==this._oldk&&(this._geolocationDirty=!0,this._lassoPolygonDirty=!0,this._oldk=r),this._geolocationDirty&&this.renderGeolocation(e,t),this._lassoPolygonDirty&&this.renderLasso(e,t)}renderLasso(e,t){var s;this._lassoPolygonDirty&&(this._lassoPolygonDirty=!1);let r={alpha:.7,dash:[6,3],width:1,color:16777215};if(!this._lassoPolygonData&&this._lassoLineGraphics.parent)this.lassoContainer.removeChildren();else if(this._lassoLineGraphics.parent||(this.lassoContainer.addChild(this._lassoLineGraphics),this.lassoContainer.addChild(this._lassoFillGraphics)),this._lassoLineGraphics.clear(),this._lassoFillGraphics.clear(),((s=this._lassoPolygonData)==null?void 0:s.length)>0){let n=this._lassoPolygonData.map(o=>t.project(o));new nn(this._lassoLineGraphics,r).drawPolygon(n.flat()),this._lassoFillGraphics.beginFill(11184810,.5).drawPolygon(n.flat()).endFill()}}renderGeolocation(e,t){if(this._geolocationDirty)if(this._geolocationDirty=!1,this.geolocationContainer.removeChildren(),this.geolocationData&&this.geolocationData.coords){let r=this.geolocationData.coords,s=[r.longitude,r.latitude],[n,o]=t.project(s),a=ki(r.accuracy,s[1]),l=[r.longitude+a,r.latitude],c=t.project(l)[0],u=Math.max(Math.abs(c-n),15),h=942335,d=new qe().beginFill(h,.4).drawCircle(n,o,u).endFill();if(d.name="aura",this.geolocationContainer.addChild(d),r.heading!==null&&!isNaN(r.heading)){let p=this.renderer.textures,m=new Dt(p.get("viewfieldDark"));m.anchor.set(.5,1),m.angle=r.heading,m.name="heading",m.position.set(n,o),this.geolocationContainer.addChild(m)}let f=new qe().lineStyle(1.5,16777215,1).beginFill(h,1).drawCircle(n,o,6.5).endFill();f.name="position",this.geolocationContainer.addChild(f),this.geolocationContainer.visible=!0}else this.geolocationContainer.visible=!1}};var ak=et(tu(),1);var q$=12,s6=class extends yt{constructor(e,t){super(e,t),this.enabled=!0;let r=this.scene.groups.get("basemap");this._resolved=new Map;let s=new Qe;s.name=`${this.layerID}-areas`,s.sortableChildren=!0,this.areaContainer=s;let n=new Qe;n.name=`${this.layerID}-lines`,n.sortableChildren=!0,this.lineContainer=n,r.addChild(s,n)}get supported(){return!!this.context.services.osm}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.osm.startAsync()))}reset(){super.reset(),this._resolved.clear()}render(e,t,r){var x,b,_,w,A,k;let s=this.context.services.osm;if(!this.enabled||!(s!=null&&s.started)||r<q$)return;let n=this.context,o=n.systems.editor,a=n.systems.filters,l=n.systems.map,c=o.staging.graph;n.loadTiles(n.projection);let u=o.intersects(l.extent());u=a.filter(u,c);let h={polygons:new Map,lines:new Map,points:new Map,vertices:new Map};for(let v of u){let E=v.geometry(c);E==="point"?h.points.set(v.id,v):E==="vertex"?h.vertices.set(v.id,v):E==="line"?h.lines.set(v.id,v):E==="area"&&h.polygons.set(v.id,v)}this.renderPolygons(e,t,r,h),this.renderLines(e,t,r,h),this.renderPoints(e,t,r,h);let d=(x=this._classHasData.get("selected"))!=null?x:new Set,f=(b=this._classHasData.get("hovered"))!=null?b:new Set,p=(_=this._classHasData.get("drawing"))!=null?_:new Set,m=new Set([...d,...f,...p]);for(let v of m){let E=c.hasEntity(v);if((E==null?void 0:E.type)==="node")continue;let S=(w=this._dataHasFeature.get(v))!=null?w:new Set,M=!1;for(let I of S){let T=(A=this.features.get(I))==null?void 0:A.geometry;if(!(!T||T.type==="point")&&T.width<25&&T.height<25){M=!0;break}}M&&m.delete(v)}let g=new Set(m);for(let v of m){let E=c.hasEntity(v);if((E==null?void 0:E.type)==="node")for(let S of c.parentWays(E))g.add(S.id)}let y={descendantIDs:new Set,siblingIDs:new Set};for(let v of g)this.getSelfAndDescendants(v,y.descendantIDs),this.getSelfAndSiblings(v,y.siblingIDs);this.renderVertices(e,t,r,h,y),((k=n.mode)==null?void 0:k.id)==="select-osm"&&this.renderMidpoints(e,t,r,h,y)}renderPolygons(e,t,r,s){var p,m;let n=s.polygons,o=this.context,a=o.systems.editor.staging.graph,l=o.systems.l10n,c=o.systems.presets,u=o.systems.styles,h=this.scene.groups.get("points"),d=o.systems.filters.isEnabled("points");function f(g){return!g||g.isFallback()||/^(address|building|indoor|landuse|man_made|military|natural|playground)/.test(g.id)?!1:!!(/^(attraction|club|craft|emergency|healthcare|office|power|shop|telecom|tourism)/.test(g.id)||/^amenity\/(?!parking|shelter)/.test(g.id)||/^leisure\/(?!garden|firepit|picnic_table|pitch|swimming_pool)/.test(g.id))}for(let[g,y]of n){let x=y.v||0,b=this._resolved.get(g);(b==null?void 0:b.v)!==x&&(b=null),b||(b=(0,ak.default)(y.asGeoJSON(a),!0),b.v=x,this._resolved.set(g,b));let _=b.type==="Polygon"?[b.coordinates]:b.type==="MultiPolygon"?b.coordinates:[];for(let w=0;w<_.length;++w){let A=_[w],k=`${this.layerID}-${g}-fill-${w}`,v=this.features.get(k);if(v&&v.type!=="polygon"&&(v.destroy(),v=null),v||(v=new Bn(this,k),v.parentContainer=this.areaContainer),v.v!==x){v.v=x,v.geometry.setCoords(A);let E=v.geometry.origExtent.area();v.container.zIndex=-E,v.setData(g,y),v.clearChildData(g),y.type==="relation"&&y.members.forEach(S=>v.addChildData(g,S.id)),y.type==="way"&&y.nodes.forEach(S=>v.addChildData(g,S))}if(this.syncFeatureClasses(v),v.dirty){let E=c.match(y,a),S=u.styleMatch(y.tags);S.labelTint=(m=(p=S.fill.color)!=null?p:S.stroke.color)!=null?m:15658734,v.style=S;let M=l.displayPOIName(y.tags);v.label=M,d&&(M||f(E))?(v.poiFeatureID=`${this.layerID}-${g}-poi-${w}`,v.poiPreset=E):(v.poiFeatureID=null,v.poiPreset=null)}if(v.update(t,r),this.retainFeature(v,e),v.poiFeatureID&&v.poiPreset&&v.geometry.origPoi){let E=this.features.get(v.poiFeatureID);if(E||(E=new Ct(this,v.poiFeatureID),E.virtual=!0,E.parentContainer=h),E.v!==x&&(E.v=x,E.geometry.setCoords(v.geometry.origPoi),E.setData(g,y)),this.syncFeatureClasses(E),E.dirty){let S={iconName:v.poiPreset.icon,iconTint:1118481,markerName:"pin",markerTint:16777215};Lm(y)&&(S.iconTint=4473924,S.labelTint=14540253,S.markerName="boldPin",S.markerTint=14540253),E.style=S,E.label=v.label}E.update(t,r),this.retainFeature(E,e)}}}}renderLines(e,t,r,s){let n=s.lines,o=this.context,a=o.systems.editor.staging.graph,l=o.systems.l10n,c=o.systems.styles,u=this.lineContainer;for(let[d,f]of n){let p=typeof f.layer=="function"?f.layer():0,m=h(p.toString()),g=Y$(f.tags),y=f.v||0,x=this._resolved.get(d);(x==null?void 0:x.v)!==y&&(x=null),x||(x=f.asGeoJSON(a),x.v=y,x.type==="LineString"&&f.tags.oneway==="-1"&&x.coordinates.reverse(),this._resolved.set(d,x));let b=x.type==="LineString"?[[x.coordinates]]:x.type==="Polygon"?[x.coordinates]:x.type==="MultiPolygon"?x.coordinates:[];for(let _=0;_<b.length;++_){let w=b[_];for(let A=0;A<w.length;++A){let k=w[A],v=`${this.layerID}-${d}-${_}-${A}`,E=this.features.get(v);if(E&&E.type!=="line"&&(E.destroy(),E=null),E||(E=new Hr(this,v)),E.v!==y&&(E.v=y,E.geometry.setCoords(k),E.parentContainer=m,E.container.zIndex=g,E.setData(d,f),E.clearChildData(d),f.type==="relation"&&f.members.forEach(S=>E.addChildData(d,S.id)),f.type==="way"&&f.nodes.forEach(S=>E.addChildData(d,S))),this.syncFeatureClasses(E),E.dirty){let S=f.tags,M=f.geometry(a);if(!f.hasInterestingTags()){let T=a.parentRelations(f).find(C=>C.isMultipolygon());T&&(S=T.tags,M="area")}let I=c.styleMatch(S);M==="line"?(I.lineMarkerName=f.isOneWay()?"oneway":"",I.sidedMarkerName=f.isSided()?"sided":""):(I.casing.width=0,I.stroke.color=I.fill.color,I.stroke.width=2,I.stroke.alpha=1),E.style=I,E.label=l.displayName(f.tags)}E.update(t,r),this.retainFeature(E,e)}}}function h(d){let f=u.getChildByName(d);return f||(f=new Qe,f.name=d.toString(),f.sortableChildren=!0,f.zIndex=d,u.addChild(f)),f}}renderVertices(e,t,r,s,n){let o=s.vertices,a=this.context,l=a.systems.editor.staging.graph,c=a.systems.l10n,u=a.systems.presets,d=this.scene.layers.get("map-ui").container.getChildByName("selected"),f=this.scene.groups.get("points");function p(g){return g.hasInterestingTags()||g.isEndpoint(l)||g.isIntersection(l)}function m(g){return n.descendantIDs.has(g)||n.siblingIDs.has(g)}for(let[g,y]of o){let x=null;if(r>=16&&p(y)&&(x=f),m(g)&&(x=d),!x)continue;let b=`${this.layerID}-${g}`,_=y.v||0,w=this.features.get(b);if(w&&w.type!=="point"&&(w.destroy(),w=null),w||(w=new Ct(this,b)),w.v!==_&&(w.v=_,w.geometry.setCoords(y.loc),w.setData(g,y)),this.syncFeatureClasses(w),w.parentContainer=x,w.dirty){let A=u.match(y,l),k=A==null?void 0:A.icon,v=y.directions(l,a.projection),E={iconName:k,iconTint:1118481,labelTint:15658734,markerName:"smallCircle",markerTint:16777215,viewfieldAngles:v,viewfieldName:"viewfieldDark",viewfieldTint:16777215};k?(E.markerName="largeCircle",E.iconName=k):y.hasInterestingTags()&&(E.markerName="taggedCircle"),Lm(y)&&(E.iconTint=4473924,E.labelTint=14540253,E.markerTint=14540253),l.isShared(y)&&(E.iconTint=1118481,E.labelTint=12303291,E.markerTint=12303291),w.style=E,w.label=c.displayName(y.tags)}w.update(t,r),this.retainFeature(w,e)}}renderPoints(e,t,r,s){let n=s.points,o=this.context,a=o.systems.editor.staging.graph,l=o.systems.l10n,c=o.systems.presets,u=this.scene.groups.get("points");for(let[h,d]of n){let f=`${this.layerID}-${h}`,p=d.v||0,m=this.features.get(f);if(m&&m.type!=="point"&&(m.destroy(),m=null),m||(m=new Ct(this,f),m.parentContainer=u),m.v!==p&&(m.v=p,m.geometry.setCoords(d.loc),m.setData(h,d)),this.syncFeatureClasses(m),m.dirty){let g=c.match(d,a),y=g==null?void 0:g.icon;y||(g=c.matchTags(d.tags,"vertex"),y=g==null?void 0:g.icon);let x=d.directions(a,o.projection),b={iconName:y,iconTint:1118481,markerName:"pin",markerTint:16777215,viewfieldAngles:x,viewfieldName:"viewfieldDark",viewfieldTint:16777215};Lm(d)&&(b.iconTint=4473924,b.labelTint=14540253,b.markerName="boldPin",b.markerTint=14540253),g.id==="address"&&(b.iconName="maki-circle-stroked",b.markerName="largeCircle"),m.style=b,m.label=l.displayName(d.tags)}m.update(t,r),this.retainFeature(m,e)}}renderMidpoints(e,t,r,s,n){let l=this.context.systems.editor.staging.graph,c=new Map([...s.lines,...s.polygons]),h=this.scene.layers.get("map-ui").container.getChildByName("selected"),d=new Map,f={markerName:"midpoint"};for(let[p,m]of c){if(!n.descendantIDs.has(p))continue;let g=l.childNodes(m);if(!g.length)continue;let y=g.map(x=>({id:x.id,point:t.project(x.loc)}));m.tags.oneway==="-1"&&y.reverse(),y.slice(0,-1).forEach((x,b)=>{let _=y[b],w=y[b+1],A=[_.id,w.id].sort().join("-");if(Ue(_.point,w.point)<40)return;let v=ct(_.point,w.point,.5),E=$t(_.point,w.point),S=t.invert(v),M={type:"midpoint",id:A,a:_,b:w,way:m,loc:S,rot:E};d.has(A)||d.set(A,M)})}for(let[p,m]of d){let g=`${this.layerID}-${p}`,y=this.features.get(g);y||(y=new Ct(this,g),y.style=f,y.parentContainer=h),y.v!==m.loc&&(y.v=m.loc,y.geometry.setCoords(m.loc),y.container.rotation=m.rot,y.setData(p,m),y.addChildData(m.way.id,p)),this.syncFeatureClasses(y),y.update(t,r),this.retainFeature(y,e)}}},Q$={motorway:0,motorway_link:-1,trunk:-2,trunk_link:-3,primary:-4,primary_link:-5,secondary:-6,tertiary:-7,unclassified:-8,residential:-9,service:-10,busway:-11,track:-12,footway:-20};function Y$(i){return Q$[i.highway]||0}function Lm(i){return i.tags.wikidata||i.tags["flag:wikidata"]||i.tags["brand:wikidata"]||i.tags["network:wikidata"]||i.tags["operator:wikidata"]}var K$=12,n6=class extends yt{constructor(e,t){super(e,t)}get supported(){return!!this.context.services.osm}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.osm.startAsync()))}renderMarkers(e,t,r){let s=this.context.services.osm;if(!(s!=null&&s.started))return;let n=this.scene.groups.get("qa"),o=s.notes(this.context.projection);for(let a of o){let l=`${this.layerID}-${a.id}`,c=this.features.get(l);if(!c){let u=16724736,h="rapid-icon-close";a.status==="closed"&&(u=5627136,h="rapid-icon-apply"),a.isNew()&&(u=16772608,h="rapid-icon-plus");let d={markerName:"osmnote",markerTint:u,iconName:h,anchor:{y:.65}};c=new Ct(this,l),c.geometry.setCoords(a.loc),c.style=d,c.parentContainer=n,c.setData(a.id,a)}this.syncFeatureClasses(c),c.update(t,r),this.retainFeature(c,e)}}render(e,t,r){let s=this.context.services.osm;!this.enabled||!(s!=null&&s.started)||r<K$||(s.loadNotes(this.context.projection),this.renderMarkers(e,t,r))}};var Z$=12,o6=class extends yt{constructor(e,t){super(e,t)}get supported(){return!!this.context.services.osmose}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.osmose.startAsync()))}renderMarkers(e,t,r){let s=this.context.services.osmose;if(!(s!=null&&s.started))return;let n=this.scene.groups.get("qa"),o=s.getData();for(let a of o){let l=`${this.layerID}-${a.id}`,c=this.features.get(l);if(!c){let u={markerName:"osmose",markerTint:s.getColor(a.item),iconName:a.icon};c=new Ct(this,l),c.geometry.setCoords(a.loc),c.style=u,c.parentContainer=n,c.setData(a.id,a)}this.syncFeatureClasses(c),c.update(t,r),c._isCircular||c.icon.position.set(0,-17),this.retainFeature(c,e)}}render(e,t,r){let s=this.context.services.osmose;!this.enabled||!(s!=null&&s.started)||r<Z$||(s.loadTiles(),this.renderMarkers(e,t,r))}};var lk=et(tu(),1);var J$=12,a6=class extends yt{constructor(e,t){super(e,t),this.enabled=!0,this._resolved=new Map}get supported(){let e=this.context.services;return!!e.mapwithai||!!e.esri}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.mapwithai.startAsync(),this.context.services.esri.startAsync()))}reset(){super.reset(),this._resolved.clear()}render(e,t,r){let s=this.context.systems.rapid;if(!(!this.enabled||!s.datasets.size||r<J$))for(let n of s.datasets.values())this.renderDataset(n,e,t,r)}renderDataset(e,t,r,s){let n=this.context,o=n.systems.rapid;if(!(e.added&&e.enabled))return;let l=n.services[e.service];if(!(l!=null&&l.started))return;let c=e.id+(e.conflated?"-conflated":""),u=l.graph(c);function h(b){return o.acceptIDs.has(b.id)||o.ignoreIDs.has(b.id)}let d={points:[],vertices:new Set,lines:[],polygons:[]};if(e.service==="mapwithai"){s>=15&&l.loadTiles(c);let b=l.getData(c).filter(_=>_.type==="way"&&!h(_));if(e.id==="fbRoads"||e.id==="rapid_intro_graph"){d.lines=b.filter(_=>_.geometry(u)==="line"&&!!_.tags.highway);for(let _ of d.lines){let w=u.entity(_.first()),A=u.entity(_.last());d.vertices.add(w),d.vertices.add(A)}}else d.polygons=b.filter(_=>_.geometry(u)==="area")}else if(e.service==="esri"){s>=14&&l.loadTiles(c);let b=l.getData(c);for(let _ of b){if(h(_))continue;let w=_.geometry(u);w==="point"&&_.__fbid__?d.points.push(_):w==="line"?d.lines.push(_):w==="area"&&d.polygons.push(_)}}let f=this.scene.groups.get("points"),p=this.scene.groups.get("basemap"),m=`${this.layerID}-${e.id}-areas`,g=`${this.layerID}-${e.id}-lines`,y=p.getChildByName(m);y||(y=new Qe,y.name=m,y.sortableChildren=!0,p.addChild(y));let x=p.getChildByName(g);x||(x=new Qe,x.name=g,x.sortableChildren=!0,p.addChild(x)),this.renderPolygons(y,e,u,t,r,s,d),this.renderLines(x,e,u,t,r,s,d),this.renderPoints(f,e,u,t,r,s,d)}renderPolygons(e,t,r,s,n,o,a){let l=new we(t.color),c=this.context.systems.l10n;for(let u of a.polygons){let h=this._resolved.get(u.id);h||(h=(0,lk.default)(u.asGeoJSON(r),!0),this._resolved.set(u.id,h));let d=h.type==="Polygon"?[h.coordinates]:h.type==="MultiPolygon"?h.coordinates:[];for(let f=0;f<d.length;++f){let p=d[f],m=`${this.layerID}-${t.id}-${u.id}-${f}`,g=this.features.get(m);if(!g){g=new Bn(this,m),g.geometry.setCoords(p);let y=g.geometry.origExtent.area();g.container.zIndex=-y,g.parentContainer=e,g.rapidFeature=!0,g.setData(u.id,u)}if(this.syncFeatureClasses(g),g.dirty){let y={labelTint:l,fill:{width:2,color:l,alpha:.3}};g.style=y,g.label=c.displayName(u.tags),g.update(n,o)}this.retainFeature(g,s)}}}renderLines(e,t,r,s,n,o,a){let l=new we(t.color),c=this.context.systems.l10n;for(let u of a.lines){let h=`${this.layerID}-${t.id}-${u.id}`,d=this.features.get(h);if(!d){let p=u.asGeoJSON(r).coordinates;u.tags.oneway==="-1"&&p.reverse(),d=new Hr(this,h),d.geometry.setCoords(p),d.parentContainer=e,d.rapidFeature=!0,d.setData(u.id,u)}if(this.syncFeatureClasses(d),d.dirty){let f={labelTint:l,casing:{width:5,color:4473924},stroke:{width:3,color:l}};f.lineMarkerName=u.isOneWay()?"oneway":"",d.style=f,d.label=c.displayName(u.tags),d.update(n,o)}this.retainFeature(d,s)}}renderPoints(e,t,r,s,n,o,a){let l=new we(t.color),c=this.context.systems.l10n,u={markerName:"largeCircle",markerTint:l,iconName:"maki-circle-stroked",labelTint:l},h={markerName:"smallCircle",markerTint:l,labelTint:l};for(let d of a.points){let f=`${this.layerID}-${t.id}-${d.id}`,p=this.features.get(f);if(p||(p=new Ct(this,f),p.geometry.setCoords(d.loc),p.parentContainer=e,p.rapidFeature=!0,p.setData(d.id,d)),this.syncFeatureClasses(p),p.dirty){p.style=u,p.label=c.displayName(d.tags);let m=d.tags["addr:housenumber"];!p.label&&m&&(p.label=m),p.update(n,o)}this.retainFeature(p,s)}for(let d of a.vertices){let f=`${this.layerID}-${d.id}`,p=this.features.get(f);if(p||(p=new Ct(this,f),p.geometry.setCoords(d.loc),p.parentContainer=e,p.rapidFeature=!0,p.allowInteraction=!1,p.setData(d.id,d)),this.syncFeatureClasses(p),p.dirty){p.style=h,p.label=c.displayName(d.tags);let m=d.tags["addr:housenumber"];!p.label&&m&&(p.label=m),p.update(n,o)}this.retainFeature(p,s)}}};var eH=12,Om=1048516,tH={casing:{alpha:0},stroke:{alpha:.9,width:4,color:Om}},iH={markerName:"mediumCircle",markerTint:Om,viewfieldName:"viewfield",viewfieldTint:Om},l6=class extends yt{constructor(e,t){super(e,t),this._handleBearingChange=this._handleBearingChange.bind(this),this._viewerYawAngle=0,this.supported&&this.context.services.streetside.on("viewerChanged",this._handleBearingChange)}_handleBearingChange(){let e=this.context.services.streetside;this._viewerYawAngle=e._pannellumViewer.getYaw()}get supported(){return!!this.context.services.streetside}get enabled(){return this._enabled}set enabled(e){this.supported||(e=!1),e!==this._enabled&&(this._enabled=e,e&&(this.dirtyLayer(),this.context.services.streetside.startAsync()))}filterImages(e){let t=this.context.systems.photos,r=t.fromDate,s=t.toDate,n=t.usernames;if(r){let o=new Date(r).getTime();e=e.filter(a=>new Date(a.captured_at).getTime()>=o)}if(s){let o=new Date(s).getTime();e=e.filter(a=>new Date(a.captured_at).getTime()<=o)}return n&&(e=e.filter(o=>n.includes(o.captured_by))),e}filterSequences(e){let t=this.context.systems.photos,r=t.fromDate,s=t.toDate,n=t.usernames;if(r){let o=new Date(r).getTime();e=e.filter(a=>new Date(a.captured_at).getTime()>=o)}if(s){let o=new Date(s).getTime();e=e.filter(a=>new Date(a.captured_at).getTime()<=o)}return n&&(e=e.filter(o=>n.includes(o.captured_by))),e}renderMarkers(e,t,r){var h;let s=this.context.services.streetside,n=(h=this._classHasData.get("active"))!=null?h:new Set;if(!(s!=null&&s.started))return;let o=this.scene.groups.get("streetview"),a=s.getImages(),l=s.getSequences(),c=this.filterSequences(l),u=this.filterImages(a);for(let d of c){let f=d.id,p=`${this.layerID}-sequence-${f}`,m=d.v||0,g=this.features.get(p);g||(g=new Hr(this,p),g.style=tH,g.parentContainer=o,g.container.zIndex=-100),g.v!==m&&(g.v=m,g.geometry.setCoords(d.coordinates),g.setData(f,d),g.clearChildData(f),d.bubbleIDs.forEach(y=>g.addChildData(f,y))),this.syncFeatureClasses(g),g.update(t,r),this.retainFeature(g,e)}for(let d of u){let f=d.id,p=`${this.layerID}-photo-${f}`,m=this.features.get(p);if(!m){let g=Object.assign({},iH);Number.isFinite(d.ca)&&(g.viewfieldAngles=[d.ca]),d.isPano&&(g.viewfieldName="pano"),m=new Ct(this,p),m.geometry.setCoords(d.loc),m.style=g,m.parentContainer=o,m.setData(f,d)}n.has(d.id)?(m.drawing=!0,m.style.viewfieldAngles=[d.ca+this._viewerYawAngle],m.style.viewfieldName="viewfield"):(m.drawing=!1,m.style.viewfieldName=d.isPano?"pano":"viewfield"),this.syncFeatureClasses(m),m.update(t,r),this.retainFeature(m,e)}}render(e,t,r){let s=this.context.services.streetside;!this.enabled||!(s!=null&&s.started)||r<eH||(s.loadTiles(),this.renderMarkers(e,t,r))}};function $c(i){return i instanceof Set?i:new Set(i!==void 0&&[].concat(i))}var c6=class extends pi.default{constructor(e){super(),this.renderer=e,this.context=e.context,this.groups=new Map,this.layers=new Map,this.features=new Map,["background","basemap","points","streetview","qa","labels","blocks","ui"].forEach((t,r)=>{let s=new Qe;s.name=t,s.sortableChildren=!0,s.zIndex=r,this.renderer.stage.addChild(s),this.groups.set(t,s)}),[new Fc(this,"background"),new s6(this,"osm"),new a6(this,"rapid"),new Yd(this,"mapillary-map-features"),new i6(this,"mapillary-signs"),new zd(this,"custom-data"),new n6(this,"notes"),new Vd(this,"improveOSM"),new Xd(this,"keepRight"),new o6(this,"osmose"),new t6(this,"mapillary"),new Wd(this,"kartaview"),new l6(this,"streetside"),new Qd(this,"labels"),new jd(this,"edit-blocks"),new r6(this,"map-ui")].forEach(t=>this.layers.set(t.id,t))}reset(){for(let e of this.layers.values())e.reset()}render(e,t,r){for(let s of this.layers.values())s.render(e,t,r),s.cull(e)}enableLayers(e){for(let t of $c(e)){let r=this.layers.get(t);r&&(r.enabled=!0)}this.emit("layerchange")}disableLayers(e){for(let t of $c(e)){let r=this.layers.get(t);r&&(r.enabled=!1)}this.emit("layerchange")}toggleLayers(e){for(let t of $c(e)){let r=this.layers.get(t);r&&(r.enabled=!r.enabled)}this.emit("layerchange")}onlyLayers(e){let t=$c(e);for(let r of this.layers.values())r.enabled=t.has(r.id);this.emit("layerchange")}addFeature(e){this.features.set(e.id,e)}removeFeature(e){this.features.delete(e.id)}classData(e,t,r){var s;(s=this.layers.get(e))==null||s.classData(t,r)}unclassData(e,t,r){var s;(s=this.layers.get(e))==null||s.unclassData(t,r)}clearClass(e){for(let t of this.layers.values())t.clearClass(e)}dirtyScene(){for(let e of this.features.values())e.dirty=!0}dirtyLayers(e){var t;for(let r of $c(e))(t=this.layers.get(r))==null||t.dirtyLayer()}dirtyFeatures(e){for(let t of $c(e)){let r=this.features.get(t);r&&(r.dirty=!0)}}dirtyData(e,t){var r;(r=this.layers.get(e))==null||r.dirtyData(t)}};var Ei=class bl{static makeArea(e,t,r){return e|t<<15|r<<30}static getOpenOffset(e){return e&32767}static getCloseOffset(e){return e>>15&32767}static getOrientation(e){return e>>30&1}static setOpenOffset(e,t){return bl.makeArea(t,bl.getCloseOffset(e),bl.getOrientation(e))}static setCloseOffset(e,t){return bl.makeArea(bl.getOpenOffset(t),t,bl.getOrientation(e))}},rH=class extends Ar{constructor(i,e){super(i,e),this.managedItems=[]}upload(i,e,t){let r=i.gl,s=e.realWidth,n=e.realHeight;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===jt.UNPACK),(t.width!==s||t.height!==n)&&(t.width=s,t.height=n,r.texImage2D(e.target,0,e.format,s,n,0,e.format,e.type,void 0));let o=this.managedItems;for(let a=0,l=o.length;a<l;a++)this.uploadItem(i,e.target,e.format,e.type,o[a]);return!0}uploadItem(i,e,t,r,s){let n=i.gl,o=n instanceof WebGL2RenderingContext,a=s.frame,l=s.source;if(!o){if(l instanceof ImageData)l=l.data;else if(l instanceof HTMLCanvasElement){let c=l.getContext("2d"),[u,h]=[l.width,l.height];l=c.getImageData(0,0,u,h).data}else if(l instanceof HTMLImageElement){let[c,u]=[l.naturalWidth,l.naturalHeight],h=document.createElement("canvas");h.width=c,h.height=u;let d=h.getContext("2d");d.drawImage(l,0,0),l=d.getImageData(0,0,c,u).data}}n.texSubImage2D(e,0,a.x,a.y,a.width,a.height,t,r,l),s.updateId=s.dirtyId}};var ck=new ve,uk=class{constructor(i,e){this._width=i,this._height=e,this._root=[null,Ei.makeArea(0,this._height,0),!1]}allocate(i,e,t){let r=this.findArea(i,e);if(!r)return null;t||(t=new ve),this.getFrame(r,t);let s=new ve(t.x,t.y,i,e),n=this.split(r,t,s);return t.copyFrom(s),t.__mem_area=n,t}free(i){let e=i.__mem_area;e[2]=!1,this.merge(e)}get width(){return this._width}get height(){return this._height}getAreaField(i){return i[1]}getFrame(i,e){e||(e=new ve);let t=this.getAreaField(i),r=this.getParent(i),s=Ei.getOrientation(t),n=Ei.getOpenOffset(t),o=Ei.getCloseOffset(t),a=r?Ei.getOpenOffset(r[1]):0,l=r?Ei.getCloseOffset(r[1]):this._width;return s?(e.x=n,e.y=a,e.width=o-e.x,e.height=l-a):(e.x=a,e.y=n,e.width=l-e.x,e.height=o-e.y),e}getParent(i){return i[0]}hasChildren(i){return Array.isArray(i[2])&&i[2].length!==0}getChildren(i){if(!Array.isArray(i[2]))throw new Error("Children don't exist");return i[2]}addChild(i,...e){i[2]=Array.isArray(i[2])?i[2]:[],i[2].push(...e)}findArea(i,e){return this.findAreaRecursive(this._root,i,e)}findAreaRecursive(i,e,t){let r=this.getFrame(i,ck);if(r.width<e||r.height<t)return null;if(!this.hasChildren(i)){let a=r.width-e,l=r.height-t;return a<0||l<0||i[2]?null:i}let s=this.getChildren(i),n=null,o=1/0;for(let a=0,l=s.length;a<l;a++){let c=this.findAreaRecursive(s[a],e,t);if(!c)continue;let u=this.getFrame(c,ck),h=u.width-e,d=u.height-t;if(h<0||d<0)continue;if(!h&&!d)return c;let f=Math.min(h,d);o>f&&(n=c,o=f)}return n}splitOrientation(i,e){if(e.width===i.width&&e.height===i.height)return 2;if(e.width===i.width)return 1;if(e.height===i.height)return 0;let t=Math.abs((i.width-e.width)*i.height-e.width*(i.height-e.height)),r=Math.abs(i.width*(i.height-e.height)-(i.width-e.width)*e.height);return t>r?0:1}split(i,e,t,r=this.getParent(i)?this.splitOrientation(e,t):0){if(i[2]===!0)throw new Error("Cannot deallocate");return r===2?(i[2]=!0,i):this[r===0?"splitPrimaryHorizontal":"splitPrimaryVertical"](i,e,t)}splitPrimaryHorizontal(i,e,t){let r=this.getAreaField(i),s=Ei.getOrientation(r),n=this.getParent(i);if(this.hasChildren(i))throw new Error("Can't split non-leaf node");let o=[i,Ei.makeArea(e.left,e.x+t.width,1),[]],a=[i,Ei.makeArea(e.x+t.width,e.right,1),!1];if(s===0)this.addChild(i,o,a);else{let l=this.getChildren(n).indexOf(i);o[0]=n,a[0]=n,this.getChildren(n).splice(l,1,o,a)}if(t.height!==e.height){let l=[o,Ei.makeArea(e.top,e.y+t.height,0),!0],c=[o,Ei.makeArea(e.y+t.height,e.bottom,0),!1];return this.addChild(o,l,c),l}else o[2]=!0;return o}splitPrimaryVertical(i,e,t){let r=this.getAreaField(i),s=Ei.getOrientation(r),n=this.getParent(i);if(this.hasChildren(i))throw new Error("Can't split non-leaf node");let o=[i,Ei.makeArea(e.top,e.y+t.height,0),[]],a=[i,Ei.makeArea(e.y+t.height,e.bottom,0),!1];if(s===1)this.addChild(i,o,a);else{let l=this.getChildren(n).indexOf(i);o[0]=n,a[0]=n,this.getChildren(n).splice(l,1,o,a)}if(t.width!==e.height){let l=[o,Ei.makeArea(e.left,e.x+t.width,1),!0],c=[o,Ei.makeArea(e.x+t.width,e.right,1),!1];return this.addChild(o,l,c),l}else o[2]=!0;return o}merge(i){if(this.hasChildren(i))throw new Error("Cannot merge a non-leaf node");let e=this.getParent(i);if(!e)return;let t=this.getChildren(e),r=t.indexOf(i),s=t[r-1],n=t[r+1];n&&n[2]===!1&&(i[1]=Ei.setCloseOffset(i[1],Ei.getCloseOffset(n[1])),t.splice(r+1,1)),s&&s[2]===!1&&(i[1]=Ei.setOpenOffset(i[1],Ei.getOpenOffset(s[1])),t.splice(r-1,1)),t.length===1&&(e[2]=!1,this.merge(e))}printState(i){this.hasChildren(i)?this.getChildren(i).forEach(e=>this.printState(e)):console.log(Ne({},this.getFrame(i)),i[2])}},Bm=new ve,sH=class{constructor(i=2048,e=2048){this.slabWidth=i,this.slabHeight=e,this.textureSlabs=[]}get maxWidth(){return this.slabWidth-2*this.calculatePadding(this.slabWidth,this.slabHeight)}get maxHeight(){return this.slabHeight-2*this.calculatePadding(this.slabWidth,this.slabHeight)}allocate(i,e,t=this.calculatePadding(i,e)){if(i+2*t>this.slabWidth||e+2*t>this.slabHeight)return null;let r=this.textureSlabs;for(let n=0,o=r.length;n<o;n++){let a=r[n],l=this.issueTexture(a,i,e,t);if(l)return l}let s=this.createSlab();return this.textureSlabs.unshift(s),this.issueTexture(s,i,e,t)}free(i){let e=i.baseTexture,t=this.textureSlabs.find(s=>s.slab===e);if(!t)throw new Error("The texture cannot be freed because its base-texture is not pooled by this allocator. This is either a bug in TextureAllocator or you tried to free a texture that was never allocated by one.");let r=t.managedTextures.find(s=>s.texture===i);if(!r)throw new Error("The texture cannot be freed because it was not found in the managed list of issued textures on its slab. This may be because you duplicated this texture or a bug in TextureAllocator");t.managedArea.free(r.area),t.managedTextures.splice(t.managedTextures.indexOf(r),1)}calculatePadding(i,e){let t=Math.max(i,e);return t<64?2:t<128?4:t<1024?8:16}createSlab(){return{managedArea:new uk(this.slabWidth,this.slabHeight),managedTextures:[],slab:new Ae(null,{width:this.slabWidth,height:this.slabHeight})}}createTexture(i,e){return new xe(i,e)}issueTexture(i,e,t,r=0){let s=i.managedArea.allocate(e+2*r,t+2*r);if(!s)return null;Bm.copyFrom(s),Bm.pad(-r);let n=i.slab,o=this.createTexture(n,Bm.clone());return i.managedTextures.push({area:s,texture:o}),o}},u6=class extends sH{createSlab(){return{managedArea:new uk(this.slabWidth,this.slabHeight),managedTextures:[],slab:new Ae(new rH(this.slabWidth,this.slabHeight),{width:this.slabWidth,height:this.slabHeight})}}allocate(i,e,t,r){let s;typeof t=="number"?s=t:(s=this.calculatePadding(i,e),r=t);let n=super.allocate(i,e,s);if(r){let o=n.baseTexture.resource,a={frame:n.frame,source:r,dirtyId:r instanceof HTMLImageElement&&!r.complete?-1:0,updateId:-1,texture:n};o.managedItems.push(a),r instanceof HTMLImageElement&&!r.complete&&r.addEventListener("load",()=>{n.baseTexture.valid&&!n.baseTexture.destroyed&&o.managedItems.indexOf(a)>=0&&(a.dirtyId++,n.baseTexture.update())}),n.baseTexture.update()}return n}free(i){super.free(i);let e=i.baseTexture.resource,t=e.managedItems.find(r=>r.texture===i);t&&e.managedItems.splice(e.managedItems.indexOf(t),1)}};var h6=class{constructor(e){this.context=e,this.loaded=!1,this._atlas={symbol:new u6,text:new u6,tile:new u6},this._textureData=new Map,this._svgIcons=new Map;let t=["bushes","cemetery","cemetery_buddhist","cemetery_christian","cemetery_jewish","cemetery_muslim","construction","dots","farmland","farmyard","forest","forest_broadleaved","forest_leafless","forest_needleleaved","grass","landfill","lines","orchard","pond","quarry","vineyard","waves","wetland","wetland_bog","wetland_marsh","wetland_reedbed","wetland_swamp"],r={};for(let s of t)r[s]=e.asset(`img/pattern/${s}.png`);ha.addBundle("patterns",r),ha.loadBundle(["patterns"]).then(s=>{for(let[n,o]of Object.entries(s.patterns))this._textureData.set(n,{texture:o,refcount:1});this.loaded=!0}).catch(s=>console.error(s)),this._cacheGraphics()}get(e){return this.getTexture("symbol",e)}getTexture(e,t){let r=`${e}-${t}`,s=this._textureData.get(r);return s?s.texture:this._svgIcons.has(t)?(this.svgIconToTexture(t),xe.EMPTY):null}getPatternTexture(e){let t=this._textureData.get(e);return t==null?void 0:t.texture}getDebugTexture(e){var n;let t=this._atlas[e];if(!t)return null;let r=new ve(0,0,t.slabWidth,t.slabHeight),s=(n=t.textureSlabs[0])==null?void 0:n.slab;return s?new xe(s,r):null}allocate(e,t,r,s,n){let o=this._atlas[e];if(!o)return null;let a=`${e}-${t}`,l=this._textureData.get(a);if(l)return l.refcount++,l.texture;let c=e==="symbol"?1:0,u=o.allocate(r,s,c,n);if(!u)throw new Error(`Couldn't allocate texture ${a}`);if(e==="tile"){let h=u.frame.clone().pad(-.5);u.frame=h}return this._textureData.set(a,{texture:u,refcount:1}),u}free(e,t){let r=this._atlas[e];if(!r)return;let s=`${e}-${t}`,n=this._textureData.get(s);n&&(n.refcount--,n.refcount===0&&(r.free(n.texture),n.texture.destroy(!1),n.texture=null,this._textureData.delete(s)))}graphicToTexture(e,t,r){let s=this.context.pixi.renderer;r.multisample=bt.NONE;let n=s.generateTexture(t,r),o=n.baseTexture;if(o.format!==le.RGBA||o.type!==Se.UNSIGNED_BYTE)return;let a=o.framebuffer;if(!a)return n;let l=a.width,c=a.height,u=new Uint8Array(l*c*4),h=s.context.gl,d=a.glFramebuffers[1],f=d==null?void 0:d.framebuffer;if(!h||!f)return n;h.bindFramebuffer(h.FRAMEBUFFER,f),h.readPixels(0,0,l,c,o.format,o.type,u);let p=this.allocate("symbol",e,l,c,u);p.orig=n.orig.clone(),n.destroy(!0)}addSvgIcon(e,t){this._svgIcons.set(e,t)}svgIconToTexture(e){let t=this._svgIcons.get(e);if(!t)return;this._svgIcons.set(e,null);let r=32,s={autoLoad:!1,height:r,width:r},n=new ua(t,s);n.load().then(()=>{this.allocate("symbol",e,r,r,n.source),this._svgIcons.delete(e)})}_cacheGraphics(){let e={resolution:2},r={region:new ve(-13,0,26,52),resolution:3},s=new qe().lineStyle(1,4473924).beginFill(16777215,.75).moveTo(-2,26).lineTo(2,26).lineTo(12,4).bezierCurveTo(12,0,-12,0,-12,4).closePath().endFill(),n=new qe().lineStyle(1,13421772).beginFill(3355443,.75).moveTo(-2,26).lineTo(2,26).lineTo(12,4).bezierCurveTo(12,0,-12,0,-12,4).closePath().endFill(),o=new qe().lineStyle(1,13421772).beginFill(16777215,0).moveTo(-2,26).lineTo(2,26).lineTo(12,4).bezierCurveTo(12,0,-12,0,-12,4).closePath().endFill();this.graphicToTexture("viewfield",s,r),this.graphicToTexture("viewfieldDark",n,r),this.graphicToTexture("viewfieldOutline",o,r);let a=new qe().lineStyle(1,4473924).beginFill(16777215,.75).drawCircle(0,0,20).endFill(),l=new qe().lineStyle(1,13421772).beginFill(3355443,.75).drawCircle(0,0,20).endFill(),c=new qe().lineStyle(1,13421772).beginFill(16777215,0).drawCircle(0,0,20).endFill();this.graphicToTexture("pano",a,e),this.graphicToTexture("panoDark",l,e),this.graphicToTexture("panoOutline",c,e);let u=new qe().lineStyle(1,4473924).beginFill(16777215,1).moveTo(0,0).bezierCurveTo(-2,-2,-8,-10,-8,-15).bezierCurveTo(-8,-19,-4,-23,0,-23).bezierCurveTo(4,-23,8,-19,8,-15).bezierCurveTo(8,-10,2,-2,0,0).closePath().endFill(),h=new qe().lineStyle(1.5,6710886).beginFill(14540253,1).moveTo(0,0).bezierCurveTo(-2,-2,-8,-10,-8,-15).bezierCurveTo(-8,-19,-4,-23,0,-23).bezierCurveTo(4,-23,8,-19,8,-15).bezierCurveTo(8,-10,2,-2,0,0).closePath().endFill(),d=new qe().lineStyle(1,4473924).beginFill(16777215,1).drawCircle(0,0,8).endFill(),f=new qe().lineStyle(1,4473924).beginFill(16777215,1).drawCircle(0,0,6).endFill(),p=new qe().lineStyle(1,4473924).beginFill(16777215,1).drawCircle(0,0,4.5).endFill(),m=new qe().lineStyle(1,4473924).beginFill(16777215,1).drawCircle(0,0,4.5).beginFill(0,1).drawCircle(0,0,1.5).endFill();this.graphicToTexture("pin",u,e),this.graphicToTexture("boldPin",h,e),this.graphicToTexture("largeCircle",d,e),this.graphicToTexture("mediumCircle",f,e),this.graphicToTexture("smallCircle",p,e),this.graphicToTexture("taggedCircle",m,e);let g=new qe().lineStyle(1,3355443).beginFill(16777215).moveTo(15,6.5).lineTo(10.8,6.5).bezierCurveTo(12.2,1.3,11.7,.8,11.2,.8).lineTo(6.2,.8).bezierCurveTo(5.8,.7,5.4,1,5.4,1.5).lineTo(4.2,10.2).bezierCurveTo(4.1,10.8,4.6,11.2,5,11.2).lineTo(9.3,11.2).lineTo(7.6,18.3).bezierCurveTo(7.5,18.8,8,19.3,8.5,19.3).bezierCurveTo(8.8,19.3,9.1,19.1,9.2,18.8).lineTo(15.6,7.8).bezierCurveTo(16,7.2,15.6,6.5,15,6.5).endFill().closePath(),y=new qe().lineStyle(1,3355443).beginFill(16777215).drawPolygon([16,3,4,3,1,6,1,17,4,20,7,20,10,27,13,20,16,20,19,17.033,19,6]).endFill().closePath(),x=new qe().lineStyle(1.5,3355443).beginFill(16777215,1).moveTo(17.5,0).lineTo(2.5,0).bezierCurveTo(1.13,0,0,1.12,0,2.5).lineTo(0,13.75).bezierCurveTo(0,15.12,1.12,16.25,2.5,16.25).lineTo(6.25,16.25).lineTo(6.25,19.53).bezierCurveTo(6.25,19.91,6.68,20.13,7,19.9).lineTo(11.87,16.25).lineTo(17.49,16.25).bezierCurveTo(18.86,16.25,20,15.12,20,13.75).lineTo(20,2.5).bezierCurveTo(20,1.13,18.87,0,17.5,0).closePath().endFill(),b=new qe().lineStyle(1,3355443).beginFill(16777215).drawPolygon([16,3,4,3,1,6,1,17,4,20,7,20,10,27,13,20,16,20,19,17.033,19,6]).endFill().closePath();this.graphicToTexture("keepright",g,e),this.graphicToTexture("improveosm",y,e),this.graphicToTexture("osmnote",x,e),this.graphicToTexture("osmose",b,e);let _=new qe().lineStyle(1,4473924).beginFill(16777215,1).drawPolygon([-3,4,7,0,-3,-4]).endFill(),w=new qe().beginFill(16777215,1).drawPolygon([5,3,0,3,0,2,5,2,5,0,10,2.5,5,5]).endFill(),A=new qe().beginFill(16777215,1).drawPolygon([0,5,5,0,0,-5]).endFill();this.graphicToTexture("midpoint",_,e),this.graphicToTexture("oneway",w,e),this.graphicToTexture("sided",A,e);let k=new qe().lineStyle(1,16777215).beginFill(16777215,.6).drawRect(-5,-5,10,10).endFill(),v=new qe().lineStyle(1,16777215).beginFill(16777215,.6).drawPolygon([-5,-5,5,-5,5,5,1,5,1,1,-5,1,-5,-5]).endFill(),E=new qe().lineStyle(1,16777215).beginFill(16777215,.6).drawCircle(0,0,5).endFill();this.graphicToTexture("lowres-square",k,e),this.graphicToTexture("lowres-ell",v,e),this.graphicToTexture("lowres-circle",E,e);let S=new qe().lineStyle(1,16777215).beginFill(0,0).drawRect(-5,-5,10,10).endFill(),M=new qe().lineStyle(1,16777215).beginFill(0,0).drawPolygon([-5,-5,5,-5,5,5,1,5,1,1,-5,1,-5,-5]).endFill(),I=new qe().lineStyle(1,16777215).beginFill(0,0).drawCircle(0,0,5).endFill();this.graphicToTexture("lowres-unfilled-square",S,e),this.graphicToTexture("lowres-unfilled-ell",M,e),this.graphicToTexture("lowres-unfilled-circle",I,e)}};var Um,nH=250,d6=class extends pi.default{constructor(e,t,r,s){super(),this.context=e,this.supersurface=t,this.surface=r,this.overlay=s,this._frame=0,this._timeToNextRender=0,this._appPending=!1,this._drawPending=!1,this.pixiProjection=new gr,this._transformDraw=null,this._isTransformed=!1,this._transformEase=null,this._tick=this._tick.bind(this),this._onHoverChange=this._onHoverChange.bind(this),this._onModeChange=this._onModeChange.bind(this),Ae.defaultOptions.mipmap=bi.OFF,te.PREFER_ENV=br.WEBGL2,this.pixi=new xc({antialias:!0,autoDensity:!0,autoStart:!1,events:{move:!1,globalMove:!1,click:!0,wheel:!1},resizeTo:t.node(),resolution:window.devicePixelRatio,sharedLoader:!0,sharedTicker:!0,view:r.node()}),globalThis.__PIXI_APP__=this.pixi,e.pixi=this.pixi,Ki.from("debug",{fill:16777215,fontSize:14,stroke:3355443,strokeThickness:2},{chars:Ki.ASCII,padding:0,resolution:2});let n=this.pixi.ticker,o=n._head.next;n.remove(o.fn,o.context),n.add(this._tick,this),n.start();let a=this.pixi.stage;a.name="stage",a.sortableChildren=!0,a.eventMode="static",a.hitArea=new ve(-1e7,-1e7,2e7,2e7),this.stage=a,this.scene=new c6(this),this.events=new Md(this),Um||(Um=new h6(e)),this.textures=Um,e.on("modechange",this._onModeChange),e.behaviors.hover.on("hoverchange",this._onHoverChange)}_onModeChange(e){this.scene.clearClass("selected");for(let[t,r]of this.context.selectedData()){let s=null;r instanceof _t?s="notes":r instanceof ut&&r.service==="improveOSM"?s=r.service:r.__fbid__?s="rapid":r.__featurehash__?s="custom-data":e.id==="select-osm"&&(s="osm"),s&&this.scene.classData(s,t,"selected")}this.render()}_onHoverChange(e){var a;let t=e.target,r=t==null?void 0:t.layerID,s=t==null?void 0:t.dataID,n=t==null?void 0:t.data,o=(a=this.context.mode)==null?void 0:a.id;o!=="select"&&o!=="select-osm"&&this.context.systems.ui.sidebar.hover(n?[n]:[]),this.scene.clearClass("hovered"),r&&s&&this.scene.classData(r,s,"hovered"),this.render()}_tick(){let e=this.pixi.ticker;if(this._drawPending){let t=this._frame,r=`draw-${t}-start`,s=`draw-${t}-end`;window.performance.mark(r),this._draw(),window.performance.mark(s),window.performance.measure(`draw-${t}`,r,s);return}if(this._tform(),this._appPending){if(this._timeToNextRender-=e.deltaMS,this._timeToNextRender>=0)return;{let t=this._frame,r=`app-${t}-start`,s=`app-${t}-end`;window.performance.mark(r),this._app(),window.performance.mark(s),window.performance.measure(`app-${t}`,r,s);return}}}deferredRender(){this._appPending=!0}render(){this._timeToNextRender=0,this._appPending=!0}setTransformAsync(e,t=0){let r=window.performance.now(),s=this.context.projection.transform(),n;if(this._transformEase&&(this.context.projection.transform(s),this._transformEase.resolve(s),this._transformEase=null),t>0){let o;n=new Promise(a=>{o=a}),this._transformEase={time0:r,time1:r+t,xform0:s,xform1:e,promise:n,resolve:o}}else this.context.projection.transform(e),n=Promise.resolve(e);return this._appPending=!0,n}resize(e,t){this.pixi.renderer.resize(e,t),this._appPending=!0}_tform(){if(this._drawPending)return;if(this._transformEase){let{time0:s,time1:n,xform0:o,xform1:a,resolve:l}=this._transformEase,[c,u,h]=[o.x,o.y,o.k],[d,f,p]=[a.x,a.y,a.k],m=window.performance.now(),g=Math.max(0,Math.min(1,(m-s)/(n-s))),y=c+(d-c)*g,x=u+(f-u)*g,b=h+(p-h)*g,_={x:y,y:x,k:b};this.context.projection.transform(_),g===1&&(l(_),this._transformEase=null),this._appPending=!0}let e=this.context.projection.transform(),t=this._transformDraw;if(!t)return;if(this._isTransformed||t.x!==e.x||t.y!==e.y||t.k!==e.k){let s=e.k/t.k,n=(e.x/s-t.x)*s,o=(e.y/s-t.y)*s;gs(this.supersurface,n,o,s),gs(this.overlay,-n,-o),this._isTransformed=!0,this.emit("move")}}_app(){var d;if(!((d=this.textures)!=null&&d.loaded))return;let e=this.context,t=e.systems.map;if(t.paused)return;let r=this.pixiProjection,s=r.transform(),n=e.projection.transform(),o=t.effectiveZoom(),a=[s.x,s.y],l=[n.x,n.y],c=Ue(a,l),u;s.k!==n.k||c>1e5?(u=[0,0],r.transform(n),this.scene.dirtyScene()):u=Ze(a,l),this.pixi.stage.position.set(-u[0],-u[1]),this.scene.render(this._frame,r,o),this._appPending=!1,this._drawPending=!0}_draw(){this.pixi.render(),this._transformDraw=this.context.projection.transform(),this._timeToNextRender=nH,this._isTransformed&&(gs(this.supersurface,0,0),gs(this.overlay,0,0),this._isTransformed=!1,this.emit("move")),this._drawPending=!1,this.emit("draw"),this._frame++}};var Ie=function(i){let e=ei();return e.os==="mac"?i:e.os==="win"&&i==="\u2318\u21E7Z"?"\u2303Y":i.replace("\u2318","\u2303")};Ie.display=function(i,e){if(e.length!==1)return e;let t=i.systems.l10n,s=ei().os==="mac";return{"\u2318":s?"\u2318 "+t.t("shortcuts.key.cmd"):t.t("shortcuts.key.ctrl"),"\u21E7":s?"\u21E7 "+t.t("shortcuts.key.shift"):t.t("shortcuts.key.shift"),"\u2325":s?"\u2325 "+t.t("shortcuts.key.option"):t.t("shortcuts.key.alt"),"\u2303":s?"\u2303 "+t.t("shortcuts.key.ctrl"):t.t("shortcuts.key.ctrl"),"\u232B":s?"\u232B "+t.t("shortcuts.key.delete"):t.t("shortcuts.key.backspace"),"\u2326":s?"\u2326 "+t.t("shortcuts.key.del"):t.t("shortcuts.key.del"),"\u2196":s?"\u2196 "+t.t("shortcuts.key.pgup"):t.t("shortcuts.key.pgup"),"\u2198":s?"\u2198 "+t.t("shortcuts.key.pgdn"):t.t("shortcuts.key.pgdn"),"\u21DE":s?"\u21DE "+t.t("shortcuts.key.home"):t.t("shortcuts.key.home"),"\u21DF":s?"\u21DF "+t.t("shortcuts.key.end"):t.t("shortcuts.key.end"),"\u21B5":s?"\u23CE "+t.t("shortcuts.key.return"):t.t("shortcuts.key.enter"),"\u238B":s?"\u238B "+t.t("shortcuts.key.esc"):t.t("shortcuts.key.esc"),"\u2630":s?"\u2630 "+t.t("shortcuts.key.menu"):t.t("shortcuts.key.menu")}[e]||e};var ou=256,$m=2,f6=24,hk=Ti($m,ou),dk=Ti(f6,ou);function $n(i,e,t){return Math.max(e,Math.min(i,t))}var au=class extends Ce{constructor(e){super(e),this.id="map",this.dependencies=new Set(["editor","filters","imagery","photos","storage","l10n","urlhash","styles"]),this.supersurface=G(null),this.surface=G(null),this.overlay=G(null),this.areaFillOptions=["wireframe","partial","full"],this._highlightEdits=!1,this._currFillMode="partial",this._toggleFillMode="partial",this._renderer=null,this._dimensions=[1,1],this._initPromise=null,this._hashchange=this._hashchange.bind(this),this._updateHash=this._updateHash.bind(this),this.render=this.render.bind(this),this.immediateRedraw=this.immediateRedraw.bind(this),this.deferredRedraw=this.deferredRedraw.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let n of this.dependencies)if(!this.context.systems[n])return Promise.reject(`Cannot init:  ${this.id} requires ${n}`);let e=this.context,t=e.systems.storage,r=e.systems.l10n;e.systems.urlhash.on("hashchange",this._hashchange);let s=Promise.all([t.initAsync(),r.initAsync()]);return this._initPromise=s.then(()=>{this._currFillMode=t.getItem("area-fill")||"partial",this._toggleFillMode=t.getItem("area-fill-toggle")||"partial";let n=r.t("area_fill.wireframe.key"),o=r.t("map_data.highlight_edits.key");e.keybinding().on(n,a=>{a.preventDefault(),a.stopPropagation(),this.wireframeMode=!this.wireframeMode}).on(Ie("\u2325"+n),a=>{a.preventDefault(),a.stopPropagation();let l=e.mode;l&&/^draw/.test(l.id)||(this.scene.toggleLayers("osm"),e.enter("browse"))}).on(o,a=>{a.preventDefault(),this.highlightEdits=!this.highlightEdits})})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){var e,t;return(t=(e=this._renderer)==null?void 0:e.scene)==null||t.reset(),this.immediateRedraw(),Promise.resolve()}pause(){this._paused=!0}resume(){this._paused=!1,this.immediateRedraw()}render(e){let t=this.context;e.on("contextmenu",u=>u.preventDefault()).on("wheel.map mousewheel.map",u=>u.preventDefault()),this.supersurface=e.append("div").attr("class","supersurface"),this.surface=this.supersurface.append("canvas").attr("class","surface"),this.overlay=this.supersurface.append("div").attr("class","overlay"),this._renderer||(this._renderer=new d6(t,this.supersurface,this.surface,this.overlay),this._renderer.on("move",()=>this.emit("move")).on("draw",()=>{this._updateHash(),this.emit("draw",{full:!0})})),this.dimensions=Kr(e);let r=t.systems.editor,s=t.systems.filters,n=t.systems.imagery,o=t.systems.photos,a=t.systems.styles,l=this._renderer.scene;r.on("merge",u=>{u&&l.dirtyData("osm",u),this.deferredRedraw()}).on("stagingchange",u=>{let h=u.complete();for(let d of h.values())d&&(d.touch(),s.clearEntity(d));this.immediateRedraw()}).on("historyjump",(u,h)=>{var A,k,v;let d=r.history[u],f=r.history[h],m=(A=h===u-1&&d)!=null?A:f,g=this.transform(),y=m.transform;y&&(g.x!==y.x||g.y!==y.y||g.k!==y.k)&&this.transformEase(y);let x=(k=t.mode)==null?void 0:k.id;if(/^draw/.test(x))return;let b=m.graph,w=((v=m.selectedIDs)!=null?v:[]).filter(E=>b.hasEntity(E));w.length?t.enter("select-osm",{selection:{osm:w}}):t.enter("browse")}),s.on("filterchange",()=>{l.dirtyLayers("osm"),this.immediateRedraw()}),n.on("imagerychange",this.immediateRedraw),o.on("photochange",this.immediateRedraw),l.on("layerchange",this.immediateRedraw),a.on("stylechange",this.immediateRedraw);let c=t.services.osm;c&&c.on("authchange",this.immediateRedraw)}_hashchange(e,t){var a;let r=e.get("map"),s=t.get("map");if(!r||r!==s){let l,c,u,h;typeof r=="string"&&([l,c,u,h]=r.split("/",4).map(Number)),(isNaN(l)||!isFinite(l))&&(l=2),(isNaN(c)||!isFinite(c))&&(c=0),(isNaN(u)||!isFinite(u))&&(u=0),(isNaN(h)||!isFinite(h))&&(h=0),l=$n(l,2,24),c=$n(c,-90,90),u=$n(u,-180,180),h=$n(h,0,360),this.centerZoom([u,c],l)}let n=e.get("id"),o=t.get("id");if(n!==o&&typeof n=="string"){let l=n.split(",").map(u=>u.trim()).filter(Boolean),c=(a=this.mode)==null?void 0:a.id;l.length&&c!=="save"&&this.selectEntityID(l[0])}}_updateHash(){let[e,t]=this.center(),r=this.zoom(),s=0,n=Math.max(0,Math.ceil(Math.log(r)/Math.LN2)),o=.1;if(isNaN(r)||!isFinite(r)||isNaN(t)||!isFinite(t)||isNaN(e)||!isFinite(e)||isNaN(s)||!isFinite(s))return;let a=r.toFixed(2),l=t.toFixed(n),c=e.toFixed(n),u=s.toFixed(1),h=`${a}/${l}/${c}`;Math.abs(s)>o&&(h+=`/${u}`),this.context.systems.urlhash.setParam("map",h)}deferredRedraw(){var e;(e=this._renderer)==null||e.deferredRender()}immediateRedraw(){var e;(e=this._renderer)==null||e.render()}get dimensions(){return this._dimensions}set dimensions(e){let[t,r]=e;this._dimensions=e,this.context.projection.dimensions([[0,0],[t,r]]),this._renderer.resize(t,r)}centerPoint(){return mr(this._dimensions,.5)}centerLoc(){return this.context.projection.invert(this.centerPoint())}mouse(){return this._renderer.events.coord||this.centerPoint()}mouseLoc(){return this.context.projection.invert(this.mouse())}transform(e,t){return e===void 0?this.context.projection.transform():(t===void 0&&(t=0),this._renderer.setTransformAsync(e,t),this)}setTransformAsync(e,t=0){return this._renderer.setTransformAsync(e,t)}centerZoom(e,t,r=0){let s=this.center(),n=this.zoom();if(e[0]===s[0]&&e[1]===s[1]&&t===n)return this;let o=$n(Ti(t,ou),hk,dk),a=new gr;a.transform(this.context.projection.transform()),a.scale(o);let l=a.translate(),c=a.project(e),u=this.centerPoint(),h=Ze(u,c);return l=dt(l,h),this.transform({x:l[0],y:l[1],k:o},r)}setCenterZoomAsync(e,t,r=0){let s=this.center(),n=this.zoom();if(e[0]===s[0]&&e[1]===s[1]&&t===n)return new Promise.resolve(this.context.projection.transform());let o=$n(Ti(t,ou),hk,dk),a=new gr;a.transform(this.context.projection.transform()),a.scale(o);let l=a.translate(),c=a.project(e),u=this.centerPoint(),h=Ze(u,c);return l=dt(l,h),this.setTransformAsync({x:l[0],y:l[1],k:o},r)}center(e,t){return e===void 0?this.context.projection.invert(this.centerPoint()):(t===void 0&&(t=0),e[0]=$n(e[0]||0,-180,180),e[1]=$n(e[1]||0,-90,90),this.centerZoom(e,this.zoom(),t))}zoom(e,t){return e===void 0?Math.max(0,Yr(this.context.projection.scale(),ou)):(t===void 0&&(t=0),e=$n(e||0,$m,f6),this.centerZoom(this.center(),e,t))}pan(e,t=0){let r=this.context.projection.transform();return this.transform({x:r.x+e[0],y:r.y+e[1],k:r.k},t)}fitEntities(e,t=0){let r,n=this.context.systems.editor.staging.graph;if(Array.isArray(e)?r=ft(e,n):r=e.extent(n),!isFinite(r.area()))return this;let o=$n(this.trimmedExtentZoom(r),0,20);return this.centerZoom(r.center(),o,t)}selectEntityID(e,t=!1){let r=this.context,s=r.systems.editor,n=l=>{var m;let c=r.selectedIDs();(((m=r.mode)==null?void 0:m.id)!=="select-osm"||!c.includes(e))&&r.enter("select-osm",{selection:{osm:[l.id]}});let u=s.staging.graph,h=l.extent(u),d=Math.min(this.trimmedExtentZoom(h),20),f=h.percentContainedIn(this.extent())<.8,p=this.zoom()<d-2;(t||f||p)&&this.fitEntities(l)},a=s.staging.graph.hasEntity(e);a?n(a):r.loadEntity(e,(l,c)=>{l||(a=c.data.find(u=>u.id===e),a&&n(a))})}_zoomIn(e){return this.centerZoom(this.center(),~~this.zoom()+e,250)}_zoomOut(e){return this.centerZoom(this.center(),~~this.zoom()-e,250)}zoomIn(){return this._zoomIn(1)}zoomInFurther(){return this._zoomIn(4)}canZoomIn(){return this.zoom()<f6}zoomOut(){return this._zoomOut(1)}zoomOutFurther(){return this._zoomOut(4)}canZoomOut(){return this.zoom()>$m}transformEase(e,t=250){return this.transform(e,t)}centerZoomEase(e,t,r=250){return this.centerZoom(e,t,r)}centerEase(e,t=250){return this.center(e,t)}zoomEase(e,t=250){return this.zoom(e,t)}fitEntitiesEase(e,t=250){return this.fitEntities(e,t)}effectiveZoom(){let e=this.center()[1],t=this.zoom(),r=ki(1,e),s=ki(1,0),n=Math.log(r/s)/Math.LN2;return Math.min(t+n,f6)}extent(e){return e===void 0?new ie(this.context.projection.invert([0,this._dimensions[1]]),this.context.projection.invert([this._dimensions[0],0])):this.centerZoom(e.center(),this.extentZoom(e))}trimmedExtent(e){return e===void 0?new ie(this.context.projection.invert([10,this._dimensions[1]-30-10]),this.context.projection.invert([this._dimensions[0]-10,81])):this.centerZoom(e.center(),this.trimmedExtentZoom(e))}extentZoom(e,t){let[r,s]=t||this._dimensions,n=this.context.projection.project([e.min[0],e.max[1]]),o=this.context.projection.project([e.max[0],e.min[1]]),a=(o[0]-n[0])/r,l=(o[1]-n[1])/s,c=Math.log(Math.abs(a))/Math.LN2,u=Math.log(Math.abs(l))/Math.LN2,h=Math.max(c,u),d=this.zoom(),f=Math.max(d,19);return isFinite(h)?d-h:f}trimmedExtentZoom(e){let s=Ze(this._dimensions,[40,140]);return this.extentZoom(e,s)}get highlightEdits(){return this._highlightEdits}set highlightEdits(e){this._highlightEdits!==e&&(this._highlightEdits=e,this._renderer.scene.dirtyScene(),this.immediateRedraw(),this.emit("mapchange"))}get areaFillMode(){return this._currFillMode}set areaFillMode(e){let t=this.context.systems.storage,r=this._currFillMode;r!==e&&(r!=="wireframe"&&(this._toggleFillMode=r,t.setItem("area-fill-toggle",r)),this._currFillMode=e,t.setItem("area-fill",e),this._renderer.scene.dirtyScene(),this.immediateRedraw(),this.emit("mapchange"))}get wireframeMode(){return this._currFillMode==="wireframe"}set wireframeMode(e){e?this.areaFillMode!=="wireframe"&&(this.areaFillMode="wireframe"):this.areaFillMode=this._toggleFillMode}get scene(){var e;return(e=this._renderer)==null?void 0:e.scene}get renderer(){return this._renderer}};var lu=class extends Ce{constructor(e){super(e),this.id="photos",this.dependencies=new Set(["map","urlhash"]),this._LAYERIDS=["streetside","mapillary","mapillary-map-features","mapillary-signs","kartaview"],this._LAYERNAMES={streetside:"Bing Streetside",mapillary:"Mapillary","mapillary-map-features":"Mapillary Map Features","mapillary-signs":"Mapillary Street Signs",kartaview:"KartaView"},this._PHOTOTYPES=["flat","panoramic"],this._DATEFILTERS=["fromDate","toDate"],this._shownPhotoTypes=new Set(this._PHOTOTYPES),this._fromDate=null,this._toDate=null,this._usernames=null,this._currLayerID=null,this._currPhotoID=null,this._initPromise=null,this._startPromise=null,this._hashchange=this._hashchange.bind(this),this._updateHash=this._updateHash.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let n of this.dependencies)if(!this.context.systems[n])return Promise.reject(`Cannot init:  ${this.id} requires ${n}`);let e=this.context,t=e.systems.map,r=e.systems.urlhash,s=Promise.all([t.initAsync(),r.initAsync()]);return this._initPromise=s.then(()=>r.on("hashchange",this._hashchange))}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context.systems.map,t=e.startAsync();return this._startPromise=t.then(()=>{e.scene.on("layerchange",this._updateHash),this._started=!0})}resetAsync(){return Promise.resolve()}_hashchange(e,t){let s=this.context.scene(),n=e.get("photo_overlay"),o=t.get("photo_overlay");if(n!==o){let f=new Set;typeof n=="string"&&(f=new Set(n.replace(/;/g,",").split(",")));for(let p of this._LAYERIDS){let m=s.layers.get(p);m&&(m.enabled=f.has(m.id))}}let a=e.get("photo_dates"),l=t.get("photo_dates");if(a!==l)if(typeof a=="string"){let f=/^(.*)[_](.*)$/g.exec(a.trim());this.setDateFilter("fromDate",f&&f.length>=2&&f[1]),this.setDateFilter("toDate",f&&f.length>=3&&f[2])}else this._toDate=this._fromDate=null;let c=e.get("photo_username"),u=t.get("photo_username");c!==u&&this.setUsernameFilter(c);let h=e.get("photo"),d=t.get("photo");if(h!==d&&typeof h=="string"){let[f,p]=h.split("/",2).filter(Boolean);f&&p?this.selectPhoto(f,p):this.selectPhoto()}}_updateHash(){let e=this.context.systems.urlhash,t=this.context.scene(),r=[];for(let o of this._LAYERIDS){let a=t.layers.get(o);a&&a.supported&&a.enabled&&r.push(o)}e.setParam("photo_overlay",r.length?r.join(","):null);let s;this._currLayerID&&this._currPhotoID&&(s=`${this._currLayerID}/${this._currPhotoID}`),e.setParam("photo",s);let n;(this._fromDate||this._toDate)&&(n=(this._fromDate||"")+"_"+(this._toDate||"")),e.setParam("photo_dates",n),e.setParam("photo_username",this._usernames?this._usernames.join(","):null)}photosUsed(){let e=this._currLayerID;return e?[this._LAYERNAMES[e]]:[]}get overlayLayerIDs(){return this._LAYERIDS}get allPhotoTypes(){return this._PHOTOTYPES}get dateFilters(){return this._DATEFILTERS}get fromDate(){return this._fromDate}get toDate(){return this._toDate}get usernames(){return this._usernames}selectPhoto(e=null,t=null){if(e===this._currLayerID&&t===this._currPhotoID)return;e!==null&&(this._currLayerID=e);let r=this._currPhotoID;this._currPhotoID=t;let s=this.context,n=s.scene();if(n.unclassData(e,r,"selected"),n.unclassData(e,r,"active"),e!==null&&t!==null&&n.clearClass("active"),e&&t){let o=s.services[e];if(!o)return null;n.enableLayers(e),n.classData(e,t,"selected"),n.classData(e,t,"active"),o.startAsync().then(()=>o.selectImageAsync(t)).then(()=>o.showViewer())}this._updateHash(),this.emit("photochange")}dateFilterValue(e){return e==="fromDate"?this._fromDate:e==="toDate"?this._toDate:null}setDateFilter(e,t){let r=t&&new Date(t);r&&!isNaN(r)?t=r.toISOString().slice(0,10):t=null;let s=!1;e==="fromDate"&&(this._fromDate=t,s=!0,this._fromDate&&this._toDate&&new Date(this._toDate)<new Date(this._fromDate)&&(this._toDate=this._fromDate)),e==="toDate"&&(this._toDate=t,s=!0,this._fromDate&&this._toDate&&new Date(this._toDate)<new Date(this._fromDate)&&(this._fromDate=this._toDate)),s&&(this._updateHash(),this.emit("photochange"))}setUsernameFilter(e){e&&typeof e=="string"&&(e=e.replace(/;/g,",").split(",")),e&&(e=e.map(t=>t.trim()).filter(Boolean),e.length||(e=null)),this._usernames=e,this._updateHash(),this.emit("photochange")}togglePhotoType(e){this._PHOTOTYPES.includes(e)&&(this._shownPhotoTypes.has(e)?this._shownPhotoTypes.delete(e):this._shownPhotoTypes.add(e),this.emit("photochange"))}_showsLayer(e){let t=this.context.scene().layers.get(e);return t==null?void 0:t.enabled}shouldFilterByDate(){return this._showsLayer("mapillary")||this._showsLayer("kartaview")||this._showsLayer("streetside")}shouldFilterByPhotoType(){return this._showsLayer("mapillary")||this._showsLayer("streetside")&&this._showsLayer("kartaview")}shouldFilterByUsername(){return!this._showsLayer("mapillary")&&this._showsLayer("kartaview")&&!this._showsLayer("streetside")}showsPhotoType(e){return this.shouldFilterByPhotoType()?this._shownPhotoTypes.has(e):!0}showsFlat(){return this.showsPhotoType("flat")}showsPanoramic(){return this.showsPhotoType("panoramic")}};function wl(i,e){let t=i.systems.editor,r=i.systems.l10n,s=ue("change"),n=[],o=[],a=G(null),l=G(null),c=G(null),u=G(null),h,d,f=[],p,m=e.presetField.options;if(Array.isArray(m))for(let _ of m)n.push(_==="undefined"?void 0:_),o.push(e.tHtml(`options.${_}`,{default:_}));else n=[void 0,"yes"],o=[r.tHtml("inspector.unknown"),r.tHtml("inspector.check.yes")],e.type!=="defaultCheck"&&(n.push("no"),o.push(r.tHtml("inspector.check.no")));function g(){if(d=e.id==="oneway_yes",e.id==="oneway"&&f.length){let w=t.staging.graph.entity(f[0]);for(let A in w.tags)if(A in No&&w.tags[A]in No[A]){d=!0,o[0]=r.tHtml("_tagging.presets.fields.oneway_yes.options.undefined");break}}}function y(){return i.container().select("div.inspector-hover").empty()?!(p==="yes"||d&&!p):!0}function x(_){let w=t.staging.graph,A=f.length&&w.hasEntity(f[0]);if(y()||!A)return _;let k=A.first(),v=A.isClosed()?A.nodes[A.nodes.length-2]:A.last(),S=k<v?"#rapid-icon-forward":"#rapid-icon-backward";return _.selectAll(".reverser-span").html(r.tHtml("inspector.check.reverser")).call(V(S,"inline")),_}let b=function(_){g(),c=_.selectAll(".form-field-input-wrap").data([0]);let w=c.enter().append("label").attr("class","form-field-input-wrap form-field-input-check");w.append("input").property("indeterminate",e.type!=="defaultCheck").attr("type","checkbox").attr("id",e.uid),w.append("span").html(o[0]).attr("class","value"),e.type==="onewayCheck"&&w.append("button").attr("class","reverser"+(y()?" hide":"")).append("span").attr("class","reverser-span"),c=c.merge(w),a=c.selectAll("input"),l=c.selectAll("span.value"),a.on("click",function(A){A.stopPropagation();let k=e.key,v={};Array.isArray(h[k])?n.indexOf("yes")!==-1?v[k]="yes":v[k]=n[0]:v[k]=n[(n.indexOf(p)+1)%n.length],(v[k]==="reversible"||v[k]==="alternating")&&(v[k]=n[0]),s.call("change",this,v)}),e.type==="onewayCheck"&&(u=c.selectAll(".reverser"),u.call(x).on("click",function(A){if(A.preventDefault(),A.stopPropagation(),!f.length)return;let k=v=>{for(let E of f)v=hs(E)(v);return v};t.perform(k),t.commit({annotation:r.t("operations.reverse.annotation.line",{n:1}),selectedIDs:f}),G(this).call(x)}))};return b.entityIDs=function(_){return arguments.length?(f=_,b):f},b.tags=function(_){h=_;let w=e.key;function A(E){return E!=="no"&&E!==""&&E!==void 0&&E!==null}function k(E){E===""&&(E=void 0);let S=n.indexOf(E);return S===-1?`"${E}"`:o[S]}g();let v=Array.isArray(_[w]);p=!v&&_[w]&&_[w].toLowerCase(),e.type==="onewayCheck"&&(p==="1"||p==="-1")&&(p="yes"),a.property("indeterminate",v||e.type!=="defaultCheck"&&!p).property("checked",A(p)),l.html(v?r.tHtml("inspector.multiple_values"):k(p)).classed("mixed",v),c.classed("set",!!p),e.type==="onewayCheck"&&u.classed("hide",y()).call(x)},b.focus=function(){a.node().focus()},me(b,s,"on")}var p6;function st(i,e){var t=ue("accept","cancel"),r=i.container(),s=[],n=[],o={},a=null,l=!0,c=!1,u=!1,h=2,d=0,f,p,m=function(y,x){x(n.filter(function(b){var _=b.terms||[];return _.push(b.value),_.some(function(w){return w.toString().toLowerCase().indexOf(y.toLowerCase())!==-1})}))},g=function(y,x){if(!y||y.empty())return;y.classed("combobox-input",!0).on("focus.combo-input",w).on("blur.combo-input",A).on("keydown.combo-input",E).on("keyup.combo-input",S).on("input.combo-input",M).on("mousedown.combo-input",b).each(function(){var F=this.parentNode,B=this.nextSibling;G(F).selectAll(".combobox-caret").filter(function($){return $===y.node()}).data([y.node()]).enter().insert("div",function(){return B}).attr("class","combobox-caret").on("mousedown.combo-caret",function($){$.preventDefault(),y.node().focus(),b($)}).on("mouseup.combo-caret",function($){$.preventDefault(),_($)})});function b(F){if(F.button===0){d=+new Date;var B=y.property("selectionStart"),$=y.property("selectionEnd");if(B!==$){var U=be(y);y.node().setSelectionRange(U.length,U.length);return}y.on("mouseup.combo-input",_)}}function _(F){if(y.on("mouseup.combo-input",null),F.button===0&&y.node()===document.activeElement){var B=y.property("selectionStart"),$=y.property("selectionEnd");if(B===$){var U=r.selectAll(".combobox");if(U.empty()||U.datum()!==y.node()){var H=d;window.setTimeout(function(){H===d&&P("",function(){k(),O()})},250)}else v()}}}function w(){P("")}function A(){p6=window.setTimeout(v,75)}function k(){v(),r.insert("div",":first-child").datum(y.node()).attr("class","combobox"+(e?" combobox-"+e:"")).style("position","absolute").style("display","block").style("left","0px").on("mousedown.combo-container",function(F){F.preventDefault()}),r.on("scroll.combo-scroll",O,!0)}function v(){p6&&(window.clearTimeout(p6),p6=void 0),r.selectAll(".combobox").remove(),r.on("scroll.combo-scroll",null)}function E(F){var B=!r.selectAll(".combobox").empty(),$=y.node()?y.node().tagName.toLowerCase():"";switch(F.keyCode){case 8:case 46:F.stopPropagation(),a=null,O(),y.on("input.combo-input",function(){var U=y.property("selectionStart");y.node().setSelectionRange(U,U),y.on("input.combo-input",M)});break;case 9:R(F);break;case 13:F.preventDefault(),F.stopPropagation();break;case 38:if($==="textarea"&&!B)return;F.preventDefault(),$==="input"&&!B&&k(),I(-1);break;case 40:if($==="textarea"&&!B)return;F.preventDefault(),$==="input"&&!B&&k(),I(1);break}}function S(F){switch(F.keyCode){case 27:N();break;case 13:R(F);break}}function M(){P(C(),function(){a=null;var F=y.property("value");if(s.length&&(y.property("selectionEnd")===F.length&&(a=D()),a||(a=F)),F.length){var B=r.selectAll(".combobox");B.empty()&&k()}else v();O()})}function I(F){if(s.length){for(var B=-1,$=0;$<s.length;$++)if(a&&s[$].value===a){B=$;break}B=Math.max(Math.min(B+F,s.length-1),0),a=s[B].value,y.property("value",a)}O(),T()}function T(){var F=r.selectAll(".combobox");if(!F.empty()){var B=r.node().getBoundingClientRect(),$=F.node().getBoundingClientRect();if($.bottom>B.bottom){var U=x?x.node():y.node();U.scrollIntoView({behavior:"instant",block:"center"}),O()}var H=F.selectAll(".combobox-option.selected").node();H&&H.scrollIntoView({behavior:"smooth",block:"nearest"})}}function C(){var F=y.property("value"),B=y.property("selectionStart"),$=y.property("selectionEnd");return B&&$&&(F=F.substring(0,B)),F}function P(F,B){u=!1,m.call(y,F,function($){u||(s=$,$.forEach(function(U){o[U.value]=U}),B&&B())})}function D(){if(l){var F=c?C():C().toLowerCase();if(F&&!(!isNaN(parseFloat(F))&&isFinite(F))){for(var B=-1,$=0;$<s.length;$++){var U=s[$].value,H=c?U:U.toLowerCase();if(H===F){B=$;break}else B===-1&&H.indexOf(F)===0&&(B=$)}if(B!==-1){var z=s[B].value;return y.property("value",z),y.node().setSelectionRange(F.length,z.length),z}}}}function O(){if(s.length<h||document.activeElement!==y.node()){v();return}var F=!r.selectAll(".combobox").empty();if(F){var B=r.selectAll(".combobox"),$=B.selectAll(".combobox-option").data(s,function(j){return j.value});$.exit().remove(),$.enter().append("a").attr("class",function(j){return"combobox-option "+(j.klass||"")}).attr("title",function(j){return j.title}).each(function(j,X,K){let Y=G(K[X]);typeof j.display=="function"?Y.call(j.display):j.display?Y.html(j.display):Y.text(j.value)}).on("mouseenter",f).on("mouseleave",p).merge($).classed("selected",function(j){return j.value===a}).on("click.combo-option",R).order();var U=x?x.node():y.node(),H=r.node().getBoundingClientRect(),z=U.getBoundingClientRect();B.style("left",z.left+5-H.left+"px").style("width",z.width-10+"px").style("top",z.height+z.top-H.top+"px")}}function R(F,B){u=!0;var $=y.node();B&&(be(y,B.value),o1(y,"change"));var U=be(y);$.setSelectionRange(U.length,U.length),B=o[U],t.call("accept",$,B,U),v()}function N(){u=!0;var F=y.node(),B=be(y),$=y.property("selectionStart"),U=y.property("selectionEnd");B=B.slice(0,$)+B.slice(U),be(y,B),F.setSelectionRange(B.length,B.length),t.call("cancel",F),v()}};return g.canAutocomplete=function(y){return arguments.length?(l=y,g):l},g.caseSensitive=function(y){return arguments.length?(c=y,g):c},g.data=function(y){return arguments.length?(n=y,g):n},g.fetcher=function(y){return arguments.length?(m=y,g):m},g.minItems=function(y){return arguments.length?(h=y,g):h},g.itemsMouseEnter=function(y){return arguments.length?(f=y,g):f},g.itemsMouseLeave=function(y){return arguments.length?(p=y,g):p},me(g,t,"on")}st.off=function(i,e){i.on("focus.combo-input",null).on("blur.combo-input",null).on("keydown.combo-input",null).on("keyup.combo-input",null).on("input.combo-input",null).on("mousedown.combo-input",null).on("mouseup.combo-input",null),e.container().on("scroll.combo-scroll",null)};function ss(i,e){let t=i.systems.editor,r=i.systems.l10n,s=ue("change"),n=e.presetField;var o=e.type==="multiCombo"||e.type==="manyCombo",a=e.type==="networkCombo",l=e.type==="semiCombo",c=n.options,u=e.type!=="manyCombo"&&n.autoSuggestions!==!1,h=e.type!=="manyCombo"&&n.customValues!==!1,d=n.snake_case||n.snake_case===void 0,f=st(i,"combo-"+e.safeid).caseSensitive(n.caseSensitive).minItems(o||l?1:2),p=G(null),m=G(null),g=G(null),y=[],x=[],b=[],_,w,A,k=[];i.systems.dataloader.getDataAsync("deprecated").then(function(U){k=U}).catch(U=>console.error(U)),o&&e.key&&/[^:]$/.test(e.key)&&(e.key+=":");function E(U){return U.replace(/\s+/g,"_").toLowerCase()}function S(U){return U.split(";").map(H=>H.trim()).join(";")}function M(U){U=S(U||"");var H=y.find(function(z){return z.key&&S(z.value)===U});return H?H.key:e.type==="typeCombo"&&!U?"yes":(d?E(U):U)||void 0}function I(U){return U=U||"",e.hasTextForStringID("options."+U)?e.t(`options.${U}`,{default:U}):e.type==="typeCombo"&&U.toLowerCase()==="yes"?"":U}function T(U,H){return U.filter(function(z){return!H.some(function(j){return!j.isMixed&&z.value===j.value})})}function C(U,H){h||U.attr("readonly","readonly"),i.services.taginfo&&u?(U.call(f.fetcher(D),H),D("",O)):(U.call(f,H),P(O))}function P(U){c&&(y=c.map(function(H){return{key:H,value:e.t(`options.${H}`,{default:H}),title:H,display:e.tHtml(`options.${H}`,{default:H}),klass:e.hasTextForStringID(`options.${H}`)?"":"raw-option"}}),f.data(T(y,x)),U&&U(y))}function D(U,H){let z=i.services.taginfo,j=t.staging.graph;if(!z){y=[],H&&H(y);return}var X=o?z.multikeys:z.values,K=(o?e.key:"")+U,Y=a&&w&&w.indexOf(U.toLowerCase())===0;Y&&(K=w+":");var oe={debounce:U!=="",key:e.key,query:K};b.length&&(oe.geometry=j.geometry(b[0])),X(oe,function(re,W){if(!re){W=W.filter(function(Q){return e.type==="typeCombo"&&Q.value==="yes"?!1:!Q.count||Q.count>10});var Z=de.deprecatedTagValuesByKey(k)[e.key];Z&&(W=W.filter(function(Q){return Z.indexOf(Q.value)===-1})),Y&&(W=W.filter(function(Q){return Q.value.toLowerCase().indexOf(w+":")===0})),p.classed("empty-combobox",W.length===0),y=W.map(function(Q){var q=Q.value;o&&(q=q.replace(e.key,""));var pe=e.t(`options.${q}`,{default:q});return{key:q,value:pe,display:e.tHtml(`options.${q}`,{default:q}),title:Q.title||pe,klass:e.hasTextForStringID(`options.${q}`)?"":"raw-option"}}),y=T(y,x),H&&H(y)}})}function O(U){if(o||l)A=e.placeholder||r.t("inspector.add");else{var H=U.map(function(X){return X.value}).filter(function(X){return X.length<20}),z=H.length>1?H:U.map(function(X){return X.key});A=e.placeholder||z.slice(0,3).join(", ")}/(|\.\.\.)$/.test(A)||(A+="\u2026");var j;!o&&!l&&_&&Array.isArray(_[e.key])?j=r.t("inspector.multiple_values"):j=A,p.selectAll("input").attr("placeholder",j)}function R(){var U={},H;if(o||l){H=M(be(g))||"",p.classed("active",!1),be(g,"");var z=H.split(";").filter(Boolean);if(!z.length)return;if(o)Fe(z).forEach(function(K){var Y=(e.key||"")+K;if(_){var oe=_[Y];if(typeof oe=="string"&&oe.toLowerCase()!=="no")return}Y=i.cleanTagKey(Y),e.keys.push(Y),U[Y]="yes"});else if(l){var j=x.map(function(K){return K.key});j=j.concat(z),U[e.key]=i.cleanTagValue(Fe(j).filter(Boolean).join(";"))}window.setTimeout(function(){g.node().focus()},10)}else{var X=be(g);if(!X&&Array.isArray(_[e.key]))return;H=i.cleanTagValue(M(X)),U[e.key]=H||void 0}s.call("change",this,U)}function N(){let U=i.systems.rapid,H=(b==null?void 0:b.length)&&b[0];return H&&U.acceptIDs.has(H)}function F(U,H){U.preventDefault(),U.stopPropagation();let z=e.key;if(!(z==="source"&&N())){var j={};if(o)j[H.key]=void 0;else if(l){var X=x.map(function(K){return K.key===H.key?null:K.key}).filter(Boolean);X=Fe(X),j[z]=X.length?X.join(";"):void 0}s.call("change",this,j)}}function B(U){p=U.selectAll(".form-field-input-wrap").data([0]);var H=o||l?"multicombo":"combo";if(p=p.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+H).merge(p),o||l){p=p.selectAll(".chiplist").data([0]);var z="chiplist";(e.key==="destination"||e.key==="via")&&(z+=" full-line-chips"),p=p.enter().append("ul").attr("class",z).on("click",function(){window.setTimeout(function(){g.node().focus()},10)}).merge(p),m=p.selectAll(".input-wrap").data([0]),m=m.enter().append("li").attr("class","input-wrap").merge(m),g=m.selectAll("input").data([0])}else g=p.selectAll("input").data([0]);if(g=g.enter().append("input").attr("type","text").attr("id",e.uid).call(Re).call(C,U).merge(g),a){var j=e.entityExtent,X=j&&ea(j.center());w=X&&X.toLowerCase()}g.on("change",R).on("blur",R),g.on("keydown.field",function(K){switch(K.keyCode){case 13:g.node().blur(),K.stopPropagation();break}}),(o||l)&&(f.on("accept",function(){g.node().blur(),g.node().focus()}),g.on("focus",function(){p.classed("active",!0)}))}B.tags=function(U){_=U;let H=e.key,z=e.keys;if(o||l){x=[];var j;if(o){for(var X in U)if(!(H&&X.indexOf(H)!==0)&&!(!H&&z.indexOf(X)===-1)){var K=U[X];if(!(!K||typeof K=="string"&&K.toLowerCase()==="no")){var Y=H?X.slice(H.length):X;x.push({key:X,value:I(Y),isMixed:Array.isArray(K)})}}H?(z=x.map(function(mt){return mt.key}),j=i.maxCharsForTagKey-f7(H)):j=i.maxCharsForTagKey}else if(l){var oe=[],re;Array.isArray(U[H])?(U[H].forEach(function(mt){var Ve=Fe((mt||"").split(";")).filter(Boolean);oe=oe.concat(Ve),re?re=re.filter(It=>Ve.includes(It)):re=Ve}),oe=Fe(oe).filter(Boolean)):(oe=Fe((U[H]||"").split(";")).filter(Boolean),re=oe),x=oe.map(function(mt){return{key:mt,value:I(mt),isMixed:!re.includes(mt)}});var W=f7(re.join(";"));j=i.maxCharsForTagValue-W,W>0&&(j-=1)}j=Math.max(0,j);var Z=l&&!Array.isArray(U[H]),Q=T(y,x);f.data(Q);var q=!h&&!Q.length||j<=0;p.selectAll(".chiplist .input-wrap").style("display",q?"none":null);var pe=p.selectAll(".chip").data(x);pe.exit().remove();var $e=pe.enter().insert("li",".input-wrap").attr("class","chip");$e.append("span"),$e.append("a"),pe=pe.merge($e).order().classed("raw-value",function(mt){var Ve=mt.key;return o&&(Ve=Ve.replace(H,"")),!e.hasTextForStringID("options."+Ve)}).classed("draggable",Z).classed("mixed",function(mt){return mt.isMixed}).attr("title",function(mt){return mt.isMixed?r.t("inspector.unshared_value_tooltip"):null}),Z&&$(pe),pe.select("span").text(mt=>mt.value),e.key==="source"&&N()||pe.select("a").attr("href","#").on("click",F).attr("class","remove").text("\xD7")}else{var nt=Array.isArray(U[H]),lt=nt&&U[H].map(function(mt){return I(mt)}).filter(Boolean),Tt=!nt&&U[H]&&!(e.type==="typeCombo"&&U[H]==="yes"),Yt=Tt&&!e.hasTextForStringID("options."+U[H]),zi=Tt&&!Yt,oi=!h||zi;be(g,nt?"":I(U[H])).classed("raw-value",Yt).classed("known-value",zi).attr("readonly",oi?"readonly":void 0).attr("title",nt?lt.join(`
`):void 0).attr("placeholder",nt?r.t("inspector.multiple_values"):A||"").classed("mixed",nt).on("keydown.deleteCapture",function(mt){if(oi&&zi&&(mt.keyCode===He.keyCodes["\u232B"]||mt.keyCode===He.keyCodes["\u2326"])){mt.preventDefault(),mt.stopPropagation();var Ve={};Ve[H]=void 0,s.call("change",this,Ve)}})}};function $(U){let H=e.key;var z,j;U.call(L0().on("start",function(X){z={x:X.x,y:X.y},j=null}).on("drag",function(X){var K=X.x-z.x,Y=X.y-z.y;if(!(!G(this).classed("dragging")&&Math.sqrt(Math.pow(K,2)+Math.pow(Y,2))<=5)){var oe=U.nodes().indexOf(this);G(this).classed("dragging",!0),j=null;var re=null,W=G(this).node().offsetWidth;H==="destination"||H==="via"?p.selectAll(".chip").style("transform",function(Z,Q){var q=G(this).node();return oe===Q?"translate("+K+"px, "+Y+"px)":Q>oe&&X.y>q.offsetTop?((j===null||Q>j)&&(j=Q),"translateY(-100%)"):Q<oe&&X.y<q.offsetTop+q.offsetHeight?((j===null||Q<j)&&(j=Q),"translateY(100%)"):null}):p.selectAll(".chip").each(function(Z,Q){var q=G(this).node();oe!==Q&&X.x<q.offsetLeft+q.offsetWidth+5&&X.x>q.offsetLeft&&X.y<q.offsetTop+q.offsetHeight&&X.y>q.offsetTop&&(j=Q,re=q.offsetTop)}).style("transform",function(Z,Q){var q=G(this).node();if(oe===Q)return"translate("+K+"px, "+Y+"px)";if(q.offsetTop===re){if(Q<oe&&Q>=j)return"translateX("+W+"px)";if(Q>oe&&Q<=j)return"translateX(-"+W+"px)"}return null})}}).on("end",function(){if(G(this).classed("dragging")){var X=U.nodes().indexOf(this);if(G(this).classed("dragging",!1),p.selectAll(".chip").style("transform",null),typeof j=="number"){var K=x[X];x.splice(X,1),x.splice(j,0,K);var Y={};x.length?Y[H]=x.map(function(oe){return oe.key}).join(";"):Y[H]=void 0,s.call("change",this,Y)}z=void 0,j=void 0}}))}return B.focus=function(){g.node().focus()},B.entityIDs=function(U){return arguments.length?(b=U||[],B):b},me(B,s,"on")}function Gr(i,e){let t=i.systems.dataloader,r=i.systems.editor,s=i.systems.l10n,n=i.systems.presets,o=ue("change"),a=G(null),l=G(null),c=[],u,h={};e.type==="tel"&&t.getDataAsync("phone_formats").then(x=>{h=x,p()}).catch(x=>console.error(x));function d(){let x=r.staging.graph,_=["brand","network","operator","flag"].includes(e.id)&&c.length&&c.some(w=>{let A=x.hasEntity(w);if(!A)return!1;if(A.tags.wikidata)return!0;let k=n.match(A,x),v=k==null?void 0:k.suggestion,E=e.id;return v&&!!A.tags[E]&&!!A.tags[E+":wikidata"]});e.locked(_)}function f(x){var A;let b=e.presetField;d();let _=e.locked(),w=x.selectAll(".form-field-input-wrap").data([0]);if(w=w.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(w),a=w.selectAll("input").data([0]),a=a.enter().append("input").attr("type",e.type==="identifier"||e.type==="roadheight"?"text":e.type).attr("id",e.uid).classed(e.type,!0).call(Re).merge(a),a.classed("disabled",!!_).attr("readonly",_||null).on("input",y(!0)).on("blur",y()).on("change",y()),e.type==="tel")p();else if(e.type==="number"){a.attr("type","text");let k=(A=b.increment())!=null?A:1,v=w.selectAll(".increment, .decrement").data(s.isRTL()?[k,-k]:[-k,k]);v.enter().append("button").attr("class",function(E){return`form-field-button ${E>0?"increment":"decrement"}`}).merge(v).on("click",function(E,S){E.preventDefault();let I=(a.node().value||"0").split(";");I=I.map(T=>{let C=parseFloat(T.trim(),10);return isFinite(C)?g(C+S):T.trim()}),a.node().value=I.join(";"),y()()})}else e.type==="identifier"&&b.urlFormat&&b.pattern?(a.attr("type","text"),l=w.selectAll(".foreign-id-permalink").data([0]),l.enter().append("button").call(V("#rapid-icon-out-link")).attr("class","form-field-button foreign-id-permalink").attr("title",function(){let k=/^https?:\/\/(.{1,}?)\//.exec(b.urlFormat);if(k.length>=2&&k[1]){let v=k[1];return s.t("icons.view_on",{domain:v})}return""}).on("click",function(k){k.preventDefault();let v=m();if(v){let E=b.urlFormat.replace(/{value}/,encodeURIComponent(v));window.open(E,"_blank")}}).merge(l)):e.type==="url"&&(a.attr("type","text"),l=w.selectAll(".foreign-id-permalink").data([0]),l.enter().append("button").call(V("#rapid-icon-out-link")).attr("class","form-field-button foreign-id-permalink").attr("title",()=>s.t("icons.visit_website")).on("click",function(k){k.preventDefault();let v=m();v&&window.open(v,"_blank")}).merge(l))}function p(){if(a.empty()||!Object.keys(h).length)return;let x=e.entityExtent,b=x&&ea(x.center()),_=b&&h[b.toLowerCase()];_&&a.attr("placeholder",_)}function m(){let x=e.presetField.pattern,b=be(a).trim().split(";")[0];return e.type==="url"&&/^https?:\/\//i.test(b)?b:e.type==="identifier"&&x?b&&b.match(new RegExp(x)):null}function g(x){let b=e.presetField;return b.minValue!==void 0&&(x=Math.max(x,b.minValue)),b.maxValue!==void 0&&(x=Math.min(x,b.maxValue)),x}function y(x){return function(){let b=e.key,_={},w=be(a);if(x||(w=i.cleanTagValue(w)),!(!w&&Array.isArray(u[b]))){if(!x){if(e.type==="number"&&w){let A=w.split(";");A=A.map(k=>{let v=parseFloat(k.trim(),10);return isFinite(v)?g(v):k.trim()}),w=A.join(";")}be(a,w)}_[b]=w||void 0,o.call("change",this,_,x)}}}return f.entityIDs=function(x){return arguments.length?(c=x,f):c},f.tags=function(x){u=x;let b=e.key,_=Array.isArray(x[b]);if(be(a,!_&&x[b]?x[b]:"").attr("title",_?x[b].filter(Boolean).join(`
`):void 0).attr("placeholder",_?s.t("inspector.multiple_values"):e.placeholder||s.t("inspector.unknown")).classed("mixed",_),l&&!l.empty()){let w=!m();l.classed("disabled",w)}},f.focus=function(){let x=a.node();x&&x.focus()},me(f,o,"on")}function Hm(i,e){let t=i.systems.l10n,r=ue("change"),s=G(null),n;function o(c){let u=c.selectAll(".form-field-input-wrap").data([0]);u=u.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(u);let h=u.selectAll("ul").data([0]);h=h.enter().append("ul").attr("class","rows").merge(h),s=h.selectAll("li").data(e.keys);let d=s.enter().append("li").attr("class",f=>`labeled-input preset-access-${f}`);d.append("span").attr("class","label preset-label-access").attr("for",f=>`preset-input-access-${f}`).html(f=>e.tHtml(`types.${f}`)),d.append("div").attr("class","preset-input-access-wrap").append("input").attr("type","text").attr("class",f=>`preset-input-access preset-input-access-${f}`).call(Re).each((f,p,m)=>{G(m[p]).call(st(i,`access-${f}`).data(o.options(f)))}),s=s.merge(d),u.selectAll(".preset-input-access").on("change",a).on("blur",a)}function a(c,u){let h={},d=i.cleanTagValue(be(G(this)));!d&&typeof n[u]!="string"||(h[u]=d||void 0,r.call("change",this,h))}o.options=function(c){let u=["no","permissive","private","permit","destination"];return c!=="access"&&(u.unshift("yes"),u.push("designated"),c==="bicycle"&&u.push("dismount")),u.map(h=>({title:e.t(`options.${h}.description`),value:h}))};let l={footway:{foot:"designated",motor_vehicle:"no"},steps:{foot:"yes",motor_vehicle:"no",bicycle:"no",horse:"no"},pedestrian:{foot:"yes",motor_vehicle:"no"},cycleway:{motor_vehicle:"no",bicycle:"designated"},bridleway:{motor_vehicle:"no",horse:"designated"},path:{foot:"yes",motor_vehicle:"no",bicycle:"yes",horse:"yes"},motorway:{foot:"no",motor_vehicle:"yes",bicycle:"no",horse:"no"},trunk:{motor_vehicle:"yes"},primary:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},secondary:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},tertiary:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},residential:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},unclassified:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},service:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},motorway_link:{foot:"no",motor_vehicle:"yes",bicycle:"no",horse:"no"},trunk_link:{motor_vehicle:"yes"},primary_link:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},secondary_link:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},tertiary_link:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},busway:{access:"no",bus:"designated",emergency:"yes"}};return o.tags=function(c){n=c,be(s.selectAll(".preset-input-access"),u=>typeof c[u]=="string"?c[u]:"").classed("mixed",u=>c[u]&&Array.isArray(c[u])).attr("title",u=>c[u]&&Array.isArray(c[u])&&c[u].filter(Boolean).join(`
`)).attr("placeholder",u=>{if(c[u]&&Array.isArray(c[u]))return t.t("inspector.multiple_values");if(u==="access")return"yes";if(c.access&&typeof c.access=="string")return c.access;if(c.highway)if(typeof c.highway=="string"){if(l[c.highway]&&l[c.highway][u])return l[c.highway][u]}else{let h=c.highway.filter(Boolean).map(d=>l[d]&&l[d][u]).filter(Boolean);if(h.length===c.highway.length&&new Set(h).size===1)return h[0]}return e.placeholder})},o.focus=function(){s.selectAll(".preset-input-access").node().focus()},me(o,r,"on")}function Gm(i,e){let t=i.systems.dataloader,r=i.systems.editor,s=i.systems.l10n,n=ue("change"),o=G(null),a=G(null),l=[],c,u,h=[{format:[["housenumber","street"],["city","postcode"]]}];t.getDataAsync("address_formats").then(_=>{h=_,o.empty()||o.call(g)}).catch(_=>console.error(_));function d(){let _=e.entityExtent.center(),w=new ie(_).padByMeters(200),A=r.intersects(w).filter(k).map(v=>{let E=i.projection.project(_),S=ti(r.staging.graph.childNodes(v),E,i.projection);return{title:v.tags.name,value:v.tags.name,dist:S.distance}}).sort((v,E)=>v.dist-E.dist);return Nl(A,"value");function k(v){return v.tags.highway&&v.tags.name&&v.type==="way"}}function f(){let _=e.entityExtent.center(),w=new ie(_).padByMeters(200),A=r.intersects(w).filter(k).map(v=>({title:v.tags["addr:city"]||v.tags.name,value:v.tags["addr:city"]||v.tags.name,dist:at(v.extent(r.staging.graph).center(),_)})).sort((v,E)=>v.dist-E.dist);return Nl(A,"value");function k(v){return!!(v.tags.name&&(v.tags.admin_level==="8"&&v.tags.boundary==="administrative"||v.tags.border_type==="city"||v.tags.place==="city"||v.tags.place==="town"||v.tags.place==="village")||v.tags["addr:city"])}}function p(_){let w=e.entityExtent.center(),A=new ie(w).padByMeters(200),k=r.intersects(A).filter(v).map(E=>({title:E.tags[_],value:E.tags[_],dist:at(E.extent(r.staging.graph).center(),w)})).sort((E,S)=>E.dist-S.dist);return Nl(k,"value");function v(E){return!l.includes(E.id)&&E.tags[_]}}function m(){if(!u)return;let _;for(let S=0;S<h.length;S++){let M=h[S];if(!M.countryCodes)_=M;else if(M.countryCodes.includes(u)){_=M;break}}let w=_.dropdowns||["city","county","country","district","hamlet","neighbourhood","place","postcode","province","quarter","state","street","subdistrict","suburb"],A=_.widths||{housenumber:1/3,street:2/3,city:2/3,state:1/4,postcode:1/3};function k(S){let M=S.reduce((I,T)=>I+(A[T]||.5),0);return S.map(I=>({id:I,width:(A[I]||.5)/M}))}let v=a.selectAll(".addr-row").data(_.format,S=>S.toString());v.exit().remove(),v.enter().append("div").attr("class","addr-row").selectAll("input").data(k).enter().append("input").property("type","text").call(x).attr("class",S=>`addr-${S.id}`).call(Re).each(E).style("width",S=>S.width*100+"%");function E(S){if(!w.includes(S.id))return;let M=S.id==="street"?d:S.id==="city"?f:p;G(this).call(st(i,`address-${S.id}`).minItems(1).caseSensitive(!0).fetcher(function(I,T){T(M(`addr:${S.id}`))}))}a.selectAll("input").on("blur",y()).on("change",y()),a.selectAll("input:not(.combobox-input)").on("input",y(!0)),c&&b(c)}function g(_){o=_,a=_.selectAll(".form-field-input-wrap").data([0]),a=a.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(a);let w=e.entityExtent.center(),A;i.inIntro?A=s.t("intro.graph.countrycode"):A=ea(w),A&&(u=A.toLowerCase(),m())}function y(_){return function(){let w={};a.selectAll("input").each((A,k,v)=>{let E=v[k],S=e.key+":"+A.id,M=_?E.value:i.cleanTagValue(E.value);Array.isArray(c[S])&&!M||(w[S]=M||void 0)}),n.call("change",this,w,_)}}function x(_){return _.attr("placeholder",function(w){let A=e.key+":"+w.id;if(c&&Array.isArray(c[A]))return s.t("inspector.multiple_values");if(u){let k=w.id+"!"+u,v=e.hasTextForStringID("placeholders."+k)?k:w.id;return e.presetField.t(`placeholders.${v}`)}})}function b(_){be(a.selectAll("input"),function(w){let A=e.key+":"+w.id,k=_[A];return typeof k=="string"?k:""}).attr("title",w=>{let A=e.key+":"+w.id,k=_[A];return k&&Array.isArray(k)&&k.filter(Boolean).join(`
`)}).classed("mixed",w=>{let A=e.key+":"+w.id;return Array.isArray(_[A])}).call(x)}return g.entityIDs=function(_){return arguments.length?(l=_,g):l},g.tags=function(_){c=_,b(_)},g.focus=function(){let _=a.selectAll("input").node();_&&_.focus()},me(g,n,"on")}function zm(i,e){let t=i.systems.l10n,r=ue("change");var s=G(null),n=G(null),o;function a(c){function u(p){return p.replace(":","")}n=c.selectAll(".form-field-input-wrap").data([0]),n=n.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(n);var h=n.selectAll("ul").data([0]);h=h.enter().append("ul").attr("class","rows").merge(h);var d=["cycleway:left","cycleway:right"];s=h.selectAll("li").data(d);var f=s.enter().append("li").attr("class",function(p){return"labeled-input preset-cycleway-"+u(p)});f.append("span").attr("class","label preset-label-cycleway").attr("for",function(p){return"preset-input-cycleway-"+u(p)}).html(function(p){return e.tHtml("types."+p)}),f.append("div").attr("class","preset-input-cycleway-wrap").append("input").attr("type","text").attr("class",function(p){return"preset-input-cycleway preset-input-"+u(p)}).call(Re).each(function(p){G(this).call(st(i,"cycleway-"+u(p)).data(a.options(p)))}),s=s.merge(f),n.selectAll(".preset-input-cycleway").on("change",l).on("blur",l)}function l(c,u){var h=i.cleanTagValue(be(G(this)));if(!(!h&&(Array.isArray(o.cycleway)||Array.isArray(o[u])))){(h==="none"||h==="")&&(h=void 0);var d=u==="cycleway:left"?"cycleway:right":"cycleway:left",f=typeof o.cycleway=="string"?o.cycleway:o[d];f&&Array.isArray(f)&&(f=f[0]),(f==="none"||f==="")&&(f=void 0);var p={};h===f?p={cycleway:h,"cycleway:left":void 0,"cycleway:right":void 0}:(p={cycleway:void 0},p[u]=h,p[d]=f),r.call("change",this,p)}}return a.options=function(){return e.presetField.options.map(function(c){return{title:e.t(`options.${c}.description`),value:c}})},a.tags=function(c){o=c;var u=typeof c.cycleway=="string"&&c.cycleway;be(s.selectAll(".preset-input-cycleway"),function(h){return u||(!c.cycleway&&typeof c[h]=="string"?c[h]:"")}).attr("title",function(h){if(Array.isArray(c.cycleway)||Array.isArray(c[h])){var d=[];return Array.isArray(c.cycleway)&&(d=d.concat(c.cycleway)),Array.isArray(c[h])&&(d=d.concat(c[h])),d.filter(Boolean).join(`
`)}return null}).attr("placeholder",function(h){return Array.isArray(c.cycleway)||Array.isArray(c[h])?t.t("inspector.multiple_values"):e.placeholder}).classed("mixed",function(h){return Array.isArray(c.cycleway)||Array.isArray(c[h])})},a.focus=function(){var c=n.selectAll("input").node();c&&c.focus()},me(a,r,"on")}function m6(i,e){var t=ue("change"),r=40,s=200,n=[];function o(a){let c=i.systems.editor.staging.graph.entity(n[0]).lanes();if(!i.container().select(".inspector-wrap.inspector-hidden").empty()||!a.node().parentNode){a.call(o.off);return}var u=a.selectAll(".form-field-input-wrap").data([0]);u=u.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(u);var h=u.selectAll(".surface").data([0]),d=Kr(u),f=d[0]-c.lanes.length*r*1.5+r*.5;h=h.enter().append("svg").attr("width",d[0]).attr("height",300).attr("class","surface").merge(h);var p=h.selectAll(".lanes").data([0]);p=p.enter().append("g").attr("class","lanes").merge(p),p.attr("transform",function(){return"translate("+f/2+", 0)"});var m=p.selectAll(".lane").data(c.lanes);m.exit().remove();var g=m.enter().append("g").attr("class","lane");g.append("g").append("rect").attr("y",50).attr("width",r).attr("height",s),g.append("g").attr("class","forward").append("text").attr("y",40).attr("x",14).text("\u25B2"),g.append("g").attr("class","bothways").append("text").attr("y",40).attr("x",14).text("\u25B2\u25BC"),g.append("g").attr("class","backward").append("text").attr("y",40).attr("x",14).text("\u25BC"),m=m.merge(g),m.attr("transform",function(y){return"translate("+r*y.index*1.5+", 0)"}),m.select(".forward").style("visibility",function(y){return y.direction==="forward"?"visible":"hidden"}),m.select(".bothways").style("visibility",function(y){return y.direction==="bothways"?"visible":"hidden"}),m.select(".backward").style("visibility",function(y){return y.direction==="backward"?"visible":"hidden"})}return o.entityIDs=function(a){n=a},o.tags=function(){},o.focus=function(){},o.off=function(){},me(o,t,"on")}m6.supportsMultiselection=!1;var oH=0;function g6(i,e){var t=oH++,r=G(null),s=function(x){r=x,x.each(d)},n=kt(!1),o=kt("top"),a=kt("center"),l=kt(G(null)),c,u=kt(""),h=kt(!0);s.displayType=function(x){return arguments.length?(u=kt(x),s):u},s.hasArrow=function(x){return arguments.length?(h=kt(x),s):h},s.placement=function(x){return arguments.length?(o=kt(x),s):o},s.alignment=function(x){return arguments.length?(a=kt(x),s):a},s.scrollContainer=function(x){return arguments.length?(l=kt(x),s):l},s.content=function(x){return arguments.length?(c=x,s):c},s.isShown=function(){var x=r.select(".popover-"+t);return!x.empty()&&x.classed("in")},s.show=function(){r.each(f)},s.updateContent=function(){r.each(p)},s.hide=function(){r.each(g)},s.toggle=function(){r.each(y)},s.destroy=function(x,b){b=b||".popover-"+t,x.on("pointerenter.popover",null).on("pointerleave.popover",null).on("pointerup.popover",null).on("pointerdown.popover",null).on("click.popover",null).selectAll(b).remove()},s.destroyAny=function(x){x.call(s.destroy,".popover")};function d(){var x=G(this),b=n.apply(this,arguments),_=x.selectAll(".popover-"+t).data([0]),w=_.enter().append("div").attr("class","popover popover-"+t+" "+(e||"")).classed("arrowed",h.apply(this,arguments));w.append("div").attr("class","popover-arrow"),w.append("div").attr("class","popover-inner"),_=w.merge(_),b&&_.classed("fade",!0);var A=u.apply(this,arguments);if(A==="hover"){var k;x.on("pointerenter.popover",function(v){if(v.pointerType){if(v.pointerType!=="mouse"){k=v.timeStamp;return}else if(k&&v.timeStamp-k<1500)return}v.buttons===0&&f.apply(this,arguments)}).on("pointerleave.popover",function(){g.apply(this,arguments)}).on("focus.popover",function(){f.apply(this,arguments)}).on("blur.popover",function(){g.apply(this,arguments)})}else A==="clickFocus"&&(x.on("pointerdown.popover",function(v){v.preventDefault(),v.stopPropagation()}).on("pointerup.popover",function(v){v.preventDefault(),v.stopPropagation()}).on("click.popover",y),_.attr("tabindex",0).on("blur.popover",function(){x.each(function(){g.apply(this,arguments)})}))}function f(){var x=G(this),b=x.selectAll(".popover-"+t);b.empty()&&(x.call(s.destroy),x.each(d),b=x.selectAll(".popover-"+t)),b.classed("in",!0);var _=u.apply(this,arguments);_==="clickFocus"&&(x.classed("active",!0),b.node().focus()),x.each(p)}function p(){var x=G(this);c&&x.selectAll(".popover-"+t+" > .popover-inner").call(c.apply(this,arguments)),m.apply(this,arguments),m.apply(this,arguments),m.apply(this,arguments)}function m(){var x=G(this),b=x.selectAll(".popover-"+t),_=l&&l.apply(this,arguments),w=_&&!_.empty()&&_.node(),A=w?w.scrollLeft:0,k=w?w.scrollTop:0,v=o.apply(this,arguments);b.classed("left",!1).classed("right",!1).classed("top",!1).classed("bottom",!1).classed(v,!0);var E=a.apply(this,arguments),S=.5;E==="leading"?S=0:E==="trailing"&&(S=1);var M=O(x.node()),I=O(b.node()),T;switch(v){case"top":T={x:M.x+(M.w-I.w)*S,y:M.y-I.h};break;case"bottom":T={x:M.x+(M.w-I.w)*S,y:M.y+M.h};break;case"left":T={x:M.x-I.w,y:M.y+(M.h-I.h)*S};break;case"right":T={x:M.x+M.w,y:M.y+(M.h-I.h)*S};break}if(T){if(w&&(v==="top"||v==="bottom")){var C=T.x;T.x+I.w>w.offsetWidth-10?T.x=w.offsetWidth-10-I.w:T.x<10&&(T.x=10);var P=x.selectAll(".popover-"+t+" > .popover-arrow"),D=Math.min(Math.max(I.w/2-(T.x-C),10),I.w-10);P.style("left",~~D+"px")}b.style("left",~~T.x+"px").style("top",~~T.y+"px")}else b.style("left",null).style("top",null);function O(R){var N=G(R).style("position");return N==="absolute"||N==="static"?{x:R.offsetLeft-A,y:R.offsetTop-k,w:R.offsetWidth,h:R.offsetHeight}:{x:0,y:0,w:R.offsetWidth,h:R.offsetHeight}}}function g(){var x=G(this);u.apply(this,arguments)==="clickFocus"&&x.classed("active",!1),x.selectAll(".popover-"+t).classed("in",!1)}function y(){G(this).select(".popover-"+t).classed("in")?g.apply(this,arguments):f.apply(this,arguments)}return s}function he(i){let e=i.systems.l10n,t=g6(i,"tooltip").displayType("hover"),r=kt(null),s=kt(null),n=kt(null);return t.title=function(o){return arguments.length?(r=kt(o),t):r},t.heading=function(o){return arguments.length?(s=kt(o),t):s},t.shortcut=function(o){return arguments.length?(n=kt(o),t):n},t.content(function(){let o=s.apply(this,arguments),a=r.apply(this,arguments),l=n.apply(this,arguments);return function(c){let u=c.selectAll(".tooltip-heading").data(o?[o]:[]);u.exit().remove(),u.enter().append("div").attr("class","tooltip-heading").merge(u).text(m=>m);let h=c.selectAll(".tooltip-text").data(a?[a]:[]);h.exit().remove(),h.enter().append("div").attr("class","tooltip-text").merge(h).html(m=>m);let d=c.selectAll(".tooltip-keyhint").data(l?[l]:[]);d.exit().remove(),d.enter().append("div").attr("class","tooltip-keyhint").text(m=>m.length===1?e.t("tooltip_keyhint"):null).append("span").attr("class","tooltip-keys").selectAll("kbd.shortcut").data(m=>typeof m=="string"?m.split(""):[]).enter().each((m,g,y)=>{let x=G(y[g]);x.append("kbd").attr("class","shortcut").text(b=>Ie.display(i,b)),g<l.length-1&&x.append("span").text("+")})}}),t}var Hc=[];function jm(i,e){let t=i.systems.dataloader,r=i.systems.editor,s=i.systems.l10n,n=i.systems.presets;var o=ue("change","input"),a=i.services.wikipedia,l=G(null),c=G(null),u,h;t.getDataAsync("languages").then(b).catch(T=>console.error(T));var d={};t.getDataAsync("territory_languages").then(function(T){d=T}).catch(T=>console.error(T));var f=st(i,"localized-lang").fetcher(S).minItems(0),p=G(null),m=[],g=he(i).title(s.t("translate.translate")).placement("left"),y,x=[];function b(T){if(Hc.length===0){var C={sr:"sr-Cyrl","sr-Cyrl":!1};for(var P in T)if(C[P]!==!1){var D=P;C[P]&&(D=C[P]),Hc.push({localName:s.languageName(D,{localOnly:!0}),nativeName:T[D].nativeName,code:P,label:s.languageName(D)})}}}function _(){let T=r.staging.graph;var C=e.id==="name"&&x.length&&x.some(function(P){var D=T.hasEntity(P);if(!D)return!1;if(D.tags.wikidata||D.tags["name:etymology:wikidata"])return!0;var O=n.match(D,T);if(O){var R=O.suggestion,N=O.fields(),F=N.some(function(z){return z.id==="brand"}),B=N.some(function(z){return z.id==="operator"}),$=O.addTags.name,U=O.addTags["brand:wikidata"],H=O.addTags["operator:wikidata"];return R&&$&&(U&&!F||H&&!B)}return!1});e.locked(C)}function w(T){var C=m.map(function(N){return N.lang}),P=new Set(C.filter(Boolean));for(var D in T){var O=D.match(/^(.*):([a-z]{2,3}(?:-[A-Z][a-z]{3})?(?:-[A-Z]{2})?)$/);if(O&&O[1]===e.key&&O[2]){var R={lang:O[2],value:T[D]};P.has(R.lang)?(m[C.indexOf(R.lang)].value=R.value,P.delete(R.lang)):m.push(R)}}m.forEach(function(N){N.lang&&P.has(N.lang)&&(N.value="")})}function A(T){p=T,_();var C=e.locked(),P=T.selectAll(".form-field-input-wrap").data([0]);P=P.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(P),l=P.selectAll(".localized-main").data([0]),l=l.enter().append("input").attr("type","text").attr("id",e.uid).attr("class","localized-main").call(Re).merge(l),l.classed("disabled",!!C).attr("readonly",C||null).on("input",R(!0)).on("blur",R()).on("change",R());var D=P.selectAll(".localized-add").data([0]);D=D.enter().append("button").attr("class","localized-add form-field-button").call(V("#rapid-icon-plus")).merge(D),D.classed("disabled",!!C).call(C?g.destroy:g).on("click",O),h&&!m.length&&w(h),c=T.selectAll(".localized-multilingual").data([0]),c=c.enter().append("div").attr("class","localized-multilingual").merge(c),c.call(M),c.selectAll("button, input").classed("disabled",!!C).attr("readonly",C||null);function O(N){if(N.preventDefault(),!e.locked()){var F=s.languageCode().toLowerCase(),B=m.find(function(U){return U.lang===F}),$=F.indexOf("en")>-1;($||B)&&(F="",B=m.find(function(U){return U.lang===F})),B||(m.unshift({lang:F,value:""}),c.call(M))}}function R(N){return function(F){if(e.locked()){F.preventDefault();return}var B=be(G(this));if(N||(B=i.cleanTagValue(B)),!(!B&&Array.isArray(h[e.key]))){var $={};$[e.key]=B||void 0,o.call("change",this,$,N)}}}}function k(T){return e.key+":"+T}function v(T,C){var P={},D=be(G(this)).toLowerCase(),O=Hc.find(function(F){return F.label.toLowerCase()===D||F.localName&&F.localName.toLowerCase()===D||F.nativeName&&F.nativeName.toLowerCase()===D});O&&(D=O.code),C.lang&&C.lang!==D&&(P[k(C.lang)]=void 0);var R=D&&i.cleanTagKey(k(D)),N=be(G(this.parentNode).selectAll(".localized-value"));R&&N?P[R]=N:R&&y&&y[C.lang]&&(P[R]=y[C.lang]),C.lang=D,o.call("change",this,P)}function E(T,C){if(C.lang){var P=i.cleanTagValue(be(G(this)))||void 0;if(!(!P&&Array.isArray(C.value))){var D={};D[k(C.lang)]=P,C.value=P,o.call("change",this,D)}}}function S(T,C){var P=T.toLowerCase(),D=[s.localeCode(),s.languageCode()];u&&d[u]&&(D=D.concat(d[u]));var O=[];D.forEach(function(R){var N=Hc.find(function(F){return F.code===R});N&&O.push(N)}),O=Fe(O.concat(Hc)),C(O.filter(function(R){return R.label.toLowerCase().indexOf(P)>=0||R.localName&&R.localName.toLowerCase().indexOf(P)>=0||R.nativeName&&R.nativeName.toLowerCase().indexOf(P)>=0||R.code.toLowerCase().indexOf(P)>=0}).map(function(R){return{value:R.label}}))}function M(T){var C=T.selectAll("div.entry").data(m,function(D){return D.lang});C.exit().style("top","0").style("max-height","240px").transition().duration(200).style("opacity","0").style("max-height","0px").remove();var P=C.enter().append("div").attr("class","entry").each(function(D,O){var R=G(this),N=us(O),F=R.append("label").attr("class","field-label").attr("for",N),B=F.append("span").attr("class","label-text");B.append("span").attr("class","label-textvalue").html(s.tHtml("translate.localized_translation_label")),B.append("span").attr("class","label-textannotation"),F.append("button").attr("class","remove-icon-multilingual").on("click",function($,U){if(!e.locked()){$.preventDefault(),m.splice(m.indexOf(U),1);var H=U.lang&&k(U.lang);if(H&&H in h){delete h[H];var z={};z[H]=void 0,o.call("change",this,z);return}M(T)}}).call(V("#rapid-operation-delete")),R.append("input").attr("class","localized-lang").attr("id",N).attr("type","text").attr("placeholder",s.t("translate.localized_translation_language")).on("blur",v).on("change",v).call(f),R.append("input").attr("type","text").attr("class","localized-value").on("blur",E).on("change",E)});P.style("margin-top","0px").style("max-height","0px").style("opacity","0").transition().duration(200).style("margin-top","10px").style("max-height","240px").style("opacity","1").on("end",function(){G(this).style("max-height","").style("overflow","visible")}),C=C.merge(P),C.order(),C.classed("present",!0),be(C.select(".localized-lang"),function(D){var O=Hc.find(function(R){return R.code===D.lang});return O?O.label:D.lang}),be(C.select(".localized-value"),function(D){return typeof D.value=="string"?D.value:""}).attr("title",function(D){return Array.isArray(D.value)?D.value.filter(Boolean).join(`
`):null}).attr("placeholder",function(D){return Array.isArray(D.value)?s.t("inspector.multiple_values"):s.t("translate.localized_translation_name")}).classed("mixed",function(D){return Array.isArray(D.value)})}A.tags=function(T){if(h=T,typeof T.wikipedia=="string"&&!y){y={};var C=T.wikipedia.match(/([^:]+):(.+)/);C&&C[0]&&C[1]&&a.translations(C[1],C[2],function(D,O){D||!O||(y=O)})}var P=Array.isArray(T[e.key]);be(l,typeof T[e.key]=="string"?T[e.key]:"").attr("title",P?T[e.key].filter(Boolean).join(`
`):void 0).attr("placeholder",P?s.t("inspector.multiple_values"):e.placeholder).classed("mixed",P),w(T),p.call(A)},A.focus=function(){l.node().focus()},A.entityIDs=function(T){return arguments.length?(x=T,m=[],I(),A):x};function I(){var T=e.entityExtent,C=T&&ea(T.center());u=C&&C.toLowerCase()}return me(A,o,"on")}function Vm(i,e){let t=i.systems.l10n,r=ue("change");var s=G(null),n=G(null),o,a,l=st(i,"roadspeed"),c=st(i,"roadspeed-unit").data(["km/h","mph"].map(p)),u=[20,30,40,50,60,70,80,90,100,110,120],h=[5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80];function d(g){var y=g.selectAll(".form-field-input-wrap").data([0]);y=y.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(y),n=y.selectAll("input.roadspeed-number").data([0]),n=n.enter().append("input").attr("type","text").attr("class","roadspeed-number").attr("id",e.uid).call(Re).call(l).merge(n),n.on("change",m).on("blur",m);var x=e.entityExtent.center();a=pE(x)==="mph",s=y.selectAll("input.roadspeed-unit").data([0]),s=s.enter().append("input").attr("type","text").attr("class","roadspeed-unit").call(c).merge(s),s.on("blur",b).on("change",b);function b(){a=be(s)==="mph",be(s,a?"mph":"km/h"),f(),m()}}function f(){l.data((a?h:u).map(p)),be(s,a?"mph":"km/h")}function p(g){return{value:g.toString(),title:g.toString()}}function m(){var g={},y=be(n).trim();let x=e.key;!y&&Array.isArray(o[x])||(y?isNaN(y)||!a?g[x]=i.cleanTagValue(y):g[x]=i.cleanTagValue(y+" mph"):g[x]=void 0,r.call("change",this,g))}return d.tags=function(g){o=g;let y=e.key;var x=g[y],b=Array.isArray(x);b||(x&&x.indexOf("mph")>=0?(x=parseInt(x,10).toString(),a=!0):x&&(a=!1)),f(),be(n,typeof x=="string"?x:"").attr("title",b?x.filter(Boolean).join(`
`):null).attr("placeholder",b?t.t("inspector.multiple_values"):e.placeholder).classed("mixed",b)},d.focus=function(){n.node().focus()},me(d,r,"on")}function Hn(i,e){let t=i.systems.l10n,r=i.services[e.qid?"wikidata":"osmwikibase"],s={},n=G(null),o=G(null),a,l;function c(){r&&(n.classed("tag-reference-loading",!0),r.getDocs(e,u))}function u(f,p){if(o.html(""),!p||!p.title){o.append("p").attr("class","tag-reference-description").html(t.tHtml("inspector.no_documentation_key")),h();return}p.imageURL?o.append("img").attr("class","tag-reference-wiki-image").attr("src",p.imageURL).on("load",()=>h()).on("error",function(){G(this).remove(),h()}):h();let m;p.description?m=t.htmlForLocalizedText(p.description,p.descriptionLocaleCode):m=t.tHtml("inspector.no_documentation_key"),o.append("p").attr("class","tag-reference-description").html(m).append("a").attr("class","tag-reference-edit").attr("target","_blank").attr("title",t.t("inspector.edit_reference")).attr("href",p.editURL).call(V("#rapid-icon-edit","inline")),p.wiki&&o.append("a").attr("class","tag-reference-link").attr("target","_blank").attr("href",p.wiki.url).call(V("#rapid-icon-out-link","inline")).append("span").html(t.tHtml(p.wiki.text)),e.key==="comment"&&o.append("a").attr("class","tag-reference-comment-link").attr("target","_blank").call(V("#rapid-icon-out-link","inline")).attr("href",t.t("commit.about_changeset_comments_link")).append("span").html(t.tHtml("commit.about_changeset_comments"))}function h(){a=!0,n.classed("tag-reference-loading",!1),o.classed("expanded",!0).transition().duration(200).style("max-height","200px").style("opacity","1"),l=!0,n.selectAll("svg.icon use").each((f,p,m)=>{let g=G(m[p]);g.attr("href")==="#rapid-icon-info"&&g.attr("href","#rapid-icon-info-filled")})}function d(){o.transition().duration(200).style("max-height","0px").style("opacity","0").on("end",()=>{o.classed("expanded",!1)}),l=!1,n.selectAll("svg.icon use").each((f,p,m)=>{let g=G(m[p]);g.attr("href")==="#rapid-icon-info-filled"&&g.attr("href","#rapid-icon-info")})}return s.button=function(f,p,m){n=f.selectAll(".tag-reference-button").data([0]),n=n.enter().append("button").attr("class","tag-reference-button "+(p||"")).attr("title",t.t("icons.information")).call(V("#rapid-icon-"+(m||"inspect"))).merge(n),n.on("click",function(g){g.stopPropagation(),g.preventDefault(),this.blur(),l?d():a?h():c()})},s.body=function(f){let p=e.qid||e.key+"-"+(e.value||"");o=f.selectAll(".tag-reference-body").data([p],m=>m),o.exit().remove(),o=o.enter().append("div").attr("class","tag-reference-body").style("max-height","0").style("opacity","0").merge(o),l===!1&&d()},s.showing=function(f){return arguments.length?(l=f,s):l},s}var zr=class{constructor(e,t,r=[],s={}){this.context=e,this.presetField=t,this.entityIDs=r,this.options=Object.assign({show:!0,wrap:!0,remove:!0,revert:!0,info:!0},s),this.id=t.id,this.type=t.type,this.title=t.title(),this.label=t.label(),this.terms=t.terms(),this.placeholder=t.placeholder(),this.default=t.default,this.key=t.key,this.keys=t.keys,this.safeid=t.safeid,this.t=t.t,this.tHtml=t.tHtml,this.hasTextForStringID=t.hasTextForStringID,this.uid=us(`form-field-${t.safeid}`),this._show=this.options.show,this._internal=null,this._state="",this._tags={};let o=e.systems.editor.staging.graph,a=e.systems.l10n;this.entityExtent=null,r!=null&&r.length&&(this.entityExtent=ft(r,o)),this._locked=!1,this._lockedTip=he(e).title(a.t("inspector.lock.suggestion",{label:this.label})).placement("bottom"),this.dispatch=ue("change","revert"),me(this,this.dispatch,"on"),this.isAllowed=this.isAllowed.bind(this),this.isModified=this.isModified.bind(this),this.isShown=this.isShown.bind(this),this.remove=this.remove.bind(this),this.render=this.render.bind(this),this.revert=this.revert.bind(this),this.tagsContainFieldKey=this.tagsContainFieldKey.bind(this),this._show&&this._createField()}_createField(){this._internal||(this._internal=Gc[this.type](this.context,this).on("change",(e,t)=>{this.dispatch.call("change",this,e,t)}),typeof this._internal.entityIDs=="function"&&this._internal.entityIDs(this.entityIDs))}isModified(){var s;if(!((s=this.entityIDs)!=null&&s.length))return!1;let e=this.context.systems.editor,t=e.base.graph,r=e.staging.graph;return this.entityIDs.some(n=>{let o=t.hasEntity(n),a=r.hasEntity(n);return this.keys.some(l=>o?a.tags[l]!==o.tags[l]:a.tags[l])})}tagsContainFieldKey(){return this.keys.some(e=>{if(this.type==="multiCombo"){for(let t in this._tags)if(t.indexOf(e)===0)return!0;return!1}else return this._tags[e]!==void 0})}revert(e){var r;if(e.stopPropagation(),e.preventDefault(),!((r=this.entityIDs)!=null&&r.length)||this._locked)return;let t=new Set(this.keys);t.has("crossing")&&(t.add("crossing:markings"),t.add("crossing:signals")),(t.has("crossing:markings")||t.has("crossing:signals"))&&t.add("crossing"),this.dispatch.call("revert",this,[...t])}remove(e){if(e.stopPropagation(),e.preventDefault(),this._locked)return;let t=new Set(this.keys);t.has("crossing")&&(t.add("crossing:markings"),t.add("crossing:signals")),(t.has("crossing:markings")||t.has("crossing:signals"))&&t.add("crossing");let r={};for(let s of t)r[s]=void 0;this.dispatch.call("change",this,r)}render(e){let t=this.context.systems.l10n,r=e.selectAll(".form-field").data([this]),s=r.enter().append("div").attr("class",`form-field form-field-${this.safeid}`).classed("nowrap",!this.options.wrap);if(this.options.wrap){let a=s.append("label").attr("class","field-label").attr("for",this.uid),l=a.append("span").attr("class","label-text");l.append("span").attr("class","label-textvalue").html(this.label),l.append("span").attr("class","label-textannotation"),this.options.remove&&a.append("button").attr("class","remove-icon").attr("title",t.t("icons.remove")).call(V("#rapid-operation-delete")),this.options.revert&&a.append("button").attr("class","modified-icon").attr("title",t.t("icons.undo")).call(V(t.isRTL()?"#rapid-icon-redo":"#rapid-icon-undo"))}r=r.merge(s),r.select(".field-label > .remove-icon").on("click",this.remove),r.select(".field-label > .modified-icon").on("click",this.revert),r.each((a,l,c)=>{let u=G(c[l]);this._internal||this._createField();let h;if(this.options.wrap&&this.options.info){let d=this.key||"";this.type==="multiCombo"&&(d=d.replace(/:$/,"")),h=Hn(this.context,this.reference||{key:d}),this._state==="hover"&&h.showing(!1)}u.call(this._internal),h&&u.call(h.body).select(".field-label").call(h.button),this._internal.tags(this._tags)}),r.classed("locked",this._locked).classed("modified",this.isModified()).classed("present",this.tagsContainFieldKey());let o=r.selectAll(".field-label .label-textannotation").selectAll(".icon").data(this._locked?[0]:[]);o.exit().remove(),o.enter().append("svg").attr("class","icon").append("use").attr("xlink:href","#fas-lock"),r.call(this._locked?this._lockedTip:this._lockedTip.destroy)}state(e){return e===void 0?this._state:(this._state=e,this)}tags(e){return e===void 0?this._tags:(this._tags=e,this.tagsContainFieldKey()&&!this._show&&(this._show=!0,this._internal||this._createField()),this)}locked(e){return e===void 0?this._locked:(this._locked=e,this)}show(){if(this._show=!0,this._internal||this._createField(),this.default&&this.key&&this._tags[this.key]!==this.default){let e={};e[this.key]=this.default,this.dispatch.call("change",this,e)}}isShown(){return this._show}isAllowed(){var o;let e=this.context,t=e.systems.editor.staging.graph,r=e.systems.locations,s=this.presetField;if(!((o=this.entityIDs)!=null&&o.length))return!0;if(this.entityIDs.length>1&&Gc[this.type].supportsMultiselection===!1||s.geometry&&!this.entityIDs.every(a=>s.matchGeometry(t.geometry(a)))||this.entityExtent&&s.locationSetID&&!r.locationSetsAt(this.entityExtent.center())[s.locationSetID])return!1;let n=s.prerequisiteTag;return!(n&&!this.tagsContainFieldKey()&&!this.entityIDs.every(l=>{let c=t.entity(l);if(n.key){let u=c.tags[n.key];if(!u)return!1;if(n.valueNot)return n.valueNot!==u;if(n.value)return n.value===u}else if(n.keyNot&&c.tags[n.keyNot])return!1;return!0}))}focus(){this._internal&&this._internal.focus()}};function cu(i,e){let t=i.systems.l10n,r=ue("change");var s=G(null),n=G(null),o=G(null),a=G(null),l=(e.presetField.options||e.keys).slice(),c,u,h={},d=[];function f(){var b=n.selectAll(".form-field-input-radio label.active input");return!b.empty()&&b.datum()}function p(b){b.classed("preset-radio",!0),n=b.selectAll(".form-field-input-wrap").data([0]);var _=n.enter().append("div").attr("class","form-field-input-wrap form-field-input-radio");_.append("span").attr("class","placeholder"),n=n.merge(_),s=n.selectAll(".placeholder"),o=n.selectAll("label").data(l),_=o.enter().append("label"),_.append("input").attr("type","radio").attr("name",e.id).attr("value",function(w){return e.t(`options.${w}`,{default:w})}).attr("checked",!1),_.append("span").html(function(w){return e.tHtml(`options.${w}`,{default:w})}),o=o.merge(_),a=o.selectAll("input").on("change",x)}function m(b,_){var w=f()||_.layer!==void 0,A=i.systems.presets,k=A.field(w),v=A.field("layer"),E=w==="bridge"||w==="tunnel"||_.layer!==void 0,S=b.selectAll(".structure-extras-wrap").data(w?[0]:[]);S.exit().remove(),S=S.enter().append("div").attr("class","structure-extras-wrap").merge(S);var M=S.selectAll("ul").data([0]);M=M.enter().append("ul").attr("class","rows").merge(M),k?((!c||c.id!==w)&&(c=new zr(i,k,d,{wrap:!1}).on("change",g)),c.tags(_)):c=null;var I=M.selectAll(".structure-type-item").data(c?[c]:[],function(D){return D.id});I.exit().remove();var T=I.enter().insert("li",":first-child").attr("class","labeled-input structure-type-item");T.append("span").attr("class","label structure-label-type").attr("for","preset-input-"+w).html(t.tHtml("inspector.radio.structure.type")),T.append("div").attr("class","structure-input-type-wrap"),I=I.merge(T),c&&I.selectAll(".structure-input-type-wrap").call(c.render),v&&E?(u||(u=new zr(i,v,d,{wrap:!1}).on("change",y)),u.tags(_),e.keys=Gt(e.keys,["layer"])):(u=null,e.keys=e.keys.filter(function(D){return D!=="layer"}));var C=M.selectAll(".structure-layer-item").data(u?[u]:[]);C.exit().remove();var P=C.enter().append("li").attr("class","labeled-input structure-layer-item");P.append("span").attr("class","label structure-label-layer").attr("for","preset-input-layer").html(t.tHtml("inspector.radio.structure.layer")),P.append("div").attr("class","structure-input-layer-wrap"),C=C.merge(P),u&&C.selectAll(".structure-input-layer-wrap").call(u.render)}function g(b,_){var w=f();if(w){var A=b[w];A!=="no"&&(h[w]=A),e.type==="structureRadio"&&((A==="no"||w!=="bridge"&&w!=="tunnel"||w==="tunnel"&&A==="building_passage")&&(b.layer=void 0),b.layer===void 0&&(w==="bridge"&&A!=="no"&&(b.layer="1"),w==="tunnel"&&A!=="no"&&A!=="building_passage"&&(b.layer="-1"))),r.call("change",this,b,_)}}function y(b,_){b.layer==="0"&&(b.layer=void 0),r.call("change",this,b,_)}function x(){var b={},_;e.key&&(b[e.key]=void 0),a.each(function(w){var A=G(this).property("checked");if(A&&(_=w),e.key)A&&(b[e.key]=w);else{var k=h[_]||"yes";b[w]=A?k:void 0}}),e.type==="structureRadio"&&(_==="bridge"?b.layer="1":_==="tunnel"&&b.tunnel!=="building_passage"?b.layer="-1":b.layer=void 0),r.call("change",this,b)}return p.tags=function(b){a.property("checked",function(A){return e.key?b[e.key]===A:typeof b[A]=="string"&&b[A].toLowerCase()!=="no"});function _(A){return e.key?Array.isArray(b[e.key])&&b[e.key].includes(A):Array.isArray(b[A])}o.classed("active",function(A){return e.key?Array.isArray(b[e.key])&&b[e.key].includes(A)||b[e.key]===A:Array.isArray(b[A])||!!(b[A]&&b[A].toLowerCase()!=="no")}).classed("mixed",_).attr("title",function(A){return _(A)?t.t("inspector.unshared_value_tooltip"):null});var w=a.filter(function(){return this.checked});w.empty()?s.html(t.tHtml("inspector.none")):(s.html(w.attr("value")),h[w.datum()]=b[w.datum()]),e.type==="structureRadio"&&(b.waterway&&!h.tunnel&&(h.tunnel="culvert"),n.call(m,b))},p.focus=function(){a.node().focus()},p.entityIDs=function(b){return arguments.length?(d=b,h={},p):d},p.isAllowed=function(){return d.length===1},me(p,r,"on")}function Wm(i,e){let t=i.systems.l10n,r=ue("change"),s=G(null),n;function o(l){let c=l.selectAll(".form-field-input-wrap").data([0]);c=c.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(c),s=c.selectAll("textarea").data([0]),s=s.enter().append("textarea").attr("id",e.uid).call(Re).on("input",a(!0)).on("blur",a()).on("change",a()).merge(s)}function a(l){return function(){let c=e.key,u=be(s);if(l||(u=i.cleanTagValue(u)),!u&&Array.isArray(n[c]))return;let h={};h[c]=u||void 0,r.call("change",this,h,l)}}return o.tags=function(l){n=l;let c=e.key,u=Array.isArray(l[c]),h=u?t.t("inspector.multiple_values"):e.placeholder||t.t("inspector.unknown");be(s,!u&&l[c]?l[c]:"").attr("title",u?l[c].filter(Boolean).join(`
`):void 0).attr("placeholder",h).classed("mixed",u)},o.focus=function(){s.node().focus()},me(o,r,"on")}function Xm(i,e){let t=i.systems.editor,r=i.systems.l10n,s=i.services.wikidata,n=ue("change");var o=G(null),a=G(null),l=null,c=null,u="",h=[],d=e.keys&&e.keys.find(function(_){return _.includes("wikipedia")}),f=e.key==="wikidata"?"name":e.key.split(":")[0],p=st(i,"combo-"+e.safeid).caseSensitive(!0).minItems(1);function m(_){o=_;var w=_.selectAll(".form-field-input-wrap").data([0]);w=w.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(w);var A=w.selectAll("ul").data([0]);A=A.enter().append("ul").attr("class","rows").merge(A);var k=A.selectAll("li.wikidata-search").data([0]),v=k.enter().append("li").attr("class","wikidata-search");v.append("input").attr("type","text").attr("id",e.uid).style("flex","1").call(Re).on("focus",function(){var I=G(this).node();I.setSelectionRange(0,I.value.length)}).on("blur",function(){x()}).call(p.fetcher(g)),p.on("accept",function(I){I&&(l=I.id,y())}).on("cancel",function(){x()}),v.append("button").attr("class","form-field-button wiki-link").attr("title",r.t("icons.view_on",{domain:"wikidata.org"})).call(V("#rapid-icon-out-link")).on("click",function(I){I.preventDefault(),u&&window.open(u,"_blank")}),k=k.merge(v),a=k.select("input");var E=["description","identifier"],S=A.selectAll("li.labeled-input").data(E),M=S.enter().append("li").attr("class",function(I){return"labeled-input preset-wikidata-"+I});M.append("span").attr("class","label").html(function(I){return r.tHtml("wikidata."+I)}),M.append("input").attr("type","text").call(Re).classed("disabled","true").attr("readonly","true"),M.append("button").attr("class","form-field-button").attr("title",r.t("icons.copy")).call(V("#rapid-operation-copy")).on("click",function(I){I.preventDefault(),G(this.parentNode).select("input").node().select(),document.execCommand("copy")})}function g(_,w){if(!_&&f){let k=t.staging.graph;for(var A in h){let v=k.hasEntity(h[A]);if(v.tags[f]){_=v.tags[f];break}}}s.itemsForSearchQuery(_,function(k,v){if(!k){var E=v.map(function(S){return{id:S.id,value:S.label+" ("+S.id+")",title:S.description,terms:S.aliases}});w&&w(E)}})}function y(){let _=e.key,w={};if(w[_]=l,n.call("change",this,w),!d)return;let A=t.staging.graph,k=h;s.entityByQID(l,(v,E)=>{if(v||!(E!=null&&E.sitelinks))return;let S=t.staging.graph;if(S!==A)return;let M=new Set(s.languagesToQuery());for(let C of["labels","descriptions"]){if(!E[C])continue;let P=Object.keys(E[C]);P.length!==0&&M.add(P[0])}let I,T=!1;for(let C of M){let P=C.replace("-","_")+"wiki";if(E.sitelinks[P]){T=!0,I=C+":"+E.sitelinks[P].title;break}}if(!T){let C=Object.keys(E.sitelinks).filter(P=>P.endsWith("wiki"));if(C.length===0)I=null;else{let P=C[0];I=P.slice(0,-4).replace("_","-")+":"+E.sitelinks[P].title}}if(I&&(I=i.cleanTagValue(I)),typeof I!="undefined")for(let C of k){let P=S.entity(C),D=Object.assign({},P.tags);if(I===null){if(!D[d])continue;delete D[d]}else{if(D[d]===I)continue;D[d]=I}t.perform(vt(C,D))}})}function x(){var _="";c&&(_=b(c,"labels"),_.length===0&&(_=c.id.toString())),be(a,_)}m.tags=function(_){let w=e.key;var A=Array.isArray(_[w]);if(a.attr("title",A?_[w].filter(Boolean).join(`
`):null).attr("placeholder",A?r.t("inspector.multiple_values"):"").classed("mixed",A),l=typeof _[w]=="string"&&_[w]||"",!/^Q[0-9]*$/.test(l)){k();return}u="https://wikidata.org/wiki/"+l,s.entityByQID(l,function(v,E){if(v){k();return}c=E,x();var S=b(E,"descriptions");o.select("button.wiki-link").classed("disabled",!1),o.select(".preset-wikidata-description").style("display",function(){return S.length>0?"flex":"none"}).select("input").attr("value",S),o.select(".preset-wikidata-identifier").style("display",function(){return E.id?"flex":"none"}).select("input").attr("value",E.id)});function k(){c=null,x(),o.select(".preset-wikidata-description").style("display","none"),o.select(".preset-wikidata-identifier").style("display","none"),o.select("button.wiki-link").classed("disabled",!0),l&&l!==""?u="https://wikidata.org/wiki/Special:Search?search="+l:u=""}};function b(_,w){if(!_[w])return"";var A=_[w],k=Object.keys(A);if(k.length===0)return"";var v=s.languagesToQuery();for(var E in v){var S=v[E],M=A[S];if(M&&M.value&&M.value.length>0)return M.value}return A[k[0]].value}return m.entityIDs=function(_){return arguments.length?(h=_,m):h},m.focus=function(){a.node().focus()},me(m,n,"on")}function y6(i,e){let t=i.systems.dataloader,r=i.systems.editor,s=i.systems.l10n,n=i.services.wikipedia,o=i.services.wikidata,a=ue("change"),l=G(null),c=G(null),u="",h,d,f=[];t.getDataAsync("wmf_sitematrix").then(A=>{f=A,d&&w(d)}).catch(A=>console.error(A));let p=st(i,"wikipedia-lang").fetcher((A,k)=>{let v=A.toLowerCase();k(f.filter(E=>E[0].toLowerCase().indexOf(v)>=0||E[1].toLowerCase().indexOf(v)>=0||E[2].toLowerCase().indexOf(v)>=0).map(E=>({value:E[1]})))}),m=st(i,"wikipedia-title").fetcher((A,k)=>{if(!A){A="";let E=r.staging.graph;for(let S in h){let M=E.hasEntity(h[S]);if(M.tags.name){A=M.tags.name;break}}}(A.length>7?n.search:n.suggestions)(x()[2],A,(E,S)=>{k(S.map(M=>({value:M})))})});function g(A){let k=A.selectAll(".form-field-input-wrap").data([0]);k=k.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(k);let v=k.selectAll(".wiki-lang-container").data([0]);v=v.enter().append("div").attr("class","wiki-lang-container").merge(v),l=v.selectAll("input.wiki-lang").data([0]),l=l.enter().append("input").attr("type","text").attr("class","wiki-lang").attr("placeholder",s.t("translate.localized_translation_language")).call(Re).call(p).merge(l),l.on("blur",b).on("change",b);let E=k.selectAll(".wiki-title-container").data([0]);E=E.enter().append("div").attr("class","wiki-title-container").merge(E),c=E.selectAll("input.wiki-title").data([0]),c=c.enter().append("input").attr("type","text").attr("class","wiki-title").attr("id",e.uid).call(Re).call(m).merge(c),c.on("blur",function(){_(!0)}).on("change",function(){_(!1)});let S=E.selectAll(".wiki-link").data([0]);S=S.enter().append("button").attr("class","form-field-button wiki-link").attr("title",s.t("icons.view_on",{domain:"wikipedia.org"})).call(V("#rapid-icon-out-link")).merge(S),S.on("click",M=>{M.preventDefault(),u&&window.open(u,"_blank")})}function y(A){let k=s.languageCode().toLowerCase();for(let v in f){let E=f[v];if(E[2]===k)return E}return A?["","",""]:["English","English","en"]}function x(A){let k=be(l).toLowerCase();for(let v in f){let E=f[v];if(E[0].toLowerCase()===k||E[1].toLowerCase()===k||E[2]===k)return E}return y(A)}function b(){be(l,x()[1]),_(!0)}function _(A){let k=be(c),v=k.match(/https?:\/\/([-a-z]+)\.wikipedia\.org\/(?:wiki|\1-[-a-z]+)\/([^#]+)(?:#(.+))?/),E=v&&f.find(T=>v[1]===T[2]),S={};if(E){let T=E[1];if(k=decodeURIComponent(v[2]).replace(/_/g," "),v[3]){let C;C=decodeURIComponent(v[3]),k+="#"+C.replace(/_/g," ")}k=k.slice(0,1).toUpperCase()+k.slice(1),be(l,T),be(c,k)}if(k?S.wikipedia=i.cleanTagValue(x()[2]+":"+k):S.wikipedia=void 0,a.call("change",this,S),A||!k||!x()[2])return;let M=r.staging.graph,I=h;o.itemsByTitle(x()[2],k,(T,C)=>{if(T||!C||!Object.keys(C).length)return;let P=r.staging.graph;if(P!==M)return;let D=Object.keys(C),O=D&&D.find(R=>R.match(/^Q\d+$/));for(let R of I){let N=P.entity(R),F=Object.assign({},N.tags);F.wikidata!==O&&(F.wikidata=O,r.perform(vt(R,F)))}})}g.tags=A=>{d=A,w(A)};function w(A){let k=e.key,v=typeof A[k]=="string"?A[k]:"",E=v.match(/([^:]+):([^#]+)(?:#(.+))?/),S=E&&E[1],M=E&&E[2],I=E&&E[3],T=S&&f.find(C=>S===C[2]);if(T){let C=T[1];if(be(l,C),be(c,M+(I?"#"+I:"")),I)try{I=encodeURIComponent(I.replace(/ /g,"_")).replace(/%/g,".")}catch(P){I=I.replace(/ /g,"_")}u="https://"+S+".wikipedia.org/wiki/"+M.replace(/ /g,"_")+(I?"#"+I:"")}else if(be(c,v),v&&v!=="")be(l,""),u=`https://${y()[2]}.wikipedia.org/w/index.php?fulltext=1&search=${v}`;else{let C=x(!0);be(l,C[1]),u=""}}return g.entityIDs=A=>arguments.length?(h=A,g):h,g.focus=()=>{c.node().focus()},me(g,a,"on")}y6.supportsMultiselection=!1;var Gc={access:Hm,address:Gm,check:wl,combo:ss,cycleway:zm,defaultCheck:wl,email:Gr,identifier:Gr,lanes:m6,localized:jm,roadspeed:Vm,roadheight:Gr,manyCombo:ss,multiCombo:ss,networkCombo:ss,number:Gr,onewayCheck:wl,radio:cu,semiCombo:ss,structureRadio:cu,tel:Gr,text:Gr,textarea:Wm,typeCombo:ss,url:Gr,wikidata:Xm,wikipedia:y6};var aH=!0,lH=30,cH=6,uu=class extends Ce{constructor(e){super(e),this.id="presets",this.dependencies=new Set(["dataloader","l10n","locations","storage","urlhash"]),this.geometries=["point","vertex","line","area","relation"];let t=new vn(e,"point",{name:"Point",tags:{},geometry:["point","vertex"],matchScore:.1}),r=new vn(e,"line",{name:"Line",tags:{},geometry:["line"],matchScore:.1}),s=new vn(e,"area",{name:"Area",tags:{area:"yes"},geometry:["area"],matchScore:.1}),n=new vn(e,"relation",{name:"Relation",tags:{},geometry:["relation"],matchScore:.1});this.collection=new xn(e,[t,r,s,n]),this._defaults={point:[],vertex:[],line:[],area:[],relation:[]},this._presets={point:t,line:r,area:s,relation:n},this._fields={},this._categories={},this._universal=[],this._recentIDs=null,this.addablePresetIDs=null,this._geometryIndex={point:{},vertex:{},line:{},area:{},relation:{}},this._initPromise=null}initAsync(){if(this._initPromise)return this._initPromise;for(let s of this.dependencies)if(!this.context.systems[s])return Promise.reject(`Cannot init:  ${this.id} requires ${s}`);let e=this.context.systems.dataloader,t=this.context.systems.urlhash,r=Promise.all([e.initAsync(),t.initAsync()]);return this._initPromise=r.then(()=>{let s=t.initialHashParams.get("presets");if(s){let n=s.split(",").map(o=>o.trim()).filter(Boolean);this.addablePresetIDs=new Set(n)}return Promise.all([e.getDataAsync("preset_categories"),e.getDataAsync("preset_defaults"),e.getDataAsync("preset_presets"),e.getDataAsync("preset_fields"),e.getDataAsync("preset_overrides")])}).then(s=>{this.merge({categories:s[0],defaults:s[1],presets:s[2],fields:s[3]}),this.merge(s[4]),S3(this.areaKeys()),C3(this.pointTags()),k3(this.vertexTags())})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}merge(e){let t=[],r=this.context,s=r.systems.locations;if(e.fields)for(let[o,a]of Object.entries(e.fields))if(a){if(!Gc[a.type]){aH&&console.warn(`"${a.type}" type not supported for ${o}`);continue}let l=new x1(r,o,a,this._fields);l.locationSet&&t.push(l),this._fields[o]=l}else delete this._fields[o];if(e.presets)for(let[o,a]of Object.entries(e.presets)){let l=this._presets[o],c=l==null?void 0:l.isFallback();if(a){a.icon&&(a.icon=a.icon.replace(/^iD-/,"rapid-")),o==="address"&&(a.icon="maki-circle-stroked"),o==="highway/turning_loop"&&(a.icon="maki-circle"),a.icon==="roentgen-needleleaved_tree"&&(a.icon="temaki-tree_needleleaved"),a.icon==="roentgen-tree"&&(a.icon="temaki-tree_broadleaved");let u=new vn(r,o,a,this._fields,this._presets);u.locationSet&&t.push(u),this._presets[o]=u}else c||delete this._presets[o]}if(e.categories)for(let[o,a]of Object.entries(e.categories))if(a){a.icon&&(a.icon=a.icon.replace(/^iD-/,"rapid-"));let l=new d1(r,o,a,this._presets);l.locationSet&&t.push(l),this._categories[o]=l}else delete this._categories[o];if(e.defaults)for(let[o,a]of Object.entries(e.defaults))Array.isArray(a)?this._defaults[o]=a.map(l=>this._presets[l]||this._categories[l]).filter(l=>l&&!l.isFallback()):this._defaults[o]=[];let n=Object.values(this._presets).concat(Object.values(this._categories));return this.collection=new xn(r,n),this._universal=Object.values(this._fields).filter(o=>o.universal),Object.values(this._presets).forEach(o=>o.resetFields()),this._geometryIndex={point:{},vertex:{},line:{},area:{},relation:{}},n.forEach(o=>{(o.geometry||[]).forEach(a=>{let l=this._geometryIndex[a];for(let c in o.tags){l[c]=l[c]||{};let u=o.tags[c];(l[c][u]=l[c][u]||[]).push(o)}})}),e.featureCollection&&Array.isArray(e.featureCollection.features)&&s.mergeCustomGeoJSON(e.featureCollection),t.length&&s.mergeLocationSets(t),this}item(e){return this.collection.item(e)}index(e){return this.collection.index(e)}fallback(e){return this.collection.fallback(e)}matchGeometry(e){return this.collection.matchGeometry(e)}matchAllGeometry(e){return this.collection.matchAllGeometry(e)}search(e,t,r){return this.collection.search(e,t,r)}match(e,t){return t.transient(e,"presetMatch",()=>{let r=e.geometry(t);r==="vertex"&&e.isOnAddressLine(t)&&(r="point");let s=e.extent(t);return this.matchTags(e.tags,r,s.center())})}matchTags(e,t,r){let s=this._geometryIndex[t],n=-1,o,a=[];for(let c in e){let u=[],h=s[c];if(!h)continue;let d=h[e[c]];d&&u.push(...d);let f=h["*"];if(f&&u.push(...f),u.length!==0)for(let p=0;p<u.length;p++){let m=u[p],g=m.matchScore(e);g!==-1&&(a.push({score:g,candidate:m}),g>n&&(n=g,o=m))}}let l=this.context.systems.locations;if(o&&o.locationSetID&&o.locationSetID!=="+[Q2]"&&Array.isArray(r)){let c=l.locationSetsAt(r);if(!c[o.locationSetID]){a.sort((u,h)=>u.score<h.score?1:-1);for(let u=0;u<a.length;u++){let h=a[u];if(!h.candidate.locationSetID||c[h.candidate.locationSetID]){o=h.candidate,n=h.score;break}}}}if(!o||o.isFallback()){for(let c in e)if(/^addr:/.test(c)&&s["addr:*"]&&s["addr:*"]["*"]){o=s["addr:*"]["*"][0];break}}return o||this.fallback(t)}allowsVertex(e,t){return e.type!=="node"?!1:Object.keys(e.tags).length===0?!0:t.transient(e,"vertexMatch",()=>{if(e.isOnAddressLine(t))return!0;let r=Ro(e.tags);return r.vertex?!0:!r.point})}areaKeys(){let e=["barrier","highway","footway","railway","junction","type"],t={},r=Object.values(this._presets).filter(s=>!s.suggestion&&!s.replacement);for(let s of r){let n=Object.keys(s.tags)[0];n&&(e.includes(n)||s.geometry.includes("area")&&(t[n]=t[n]||{}))}for(let s of r)if(s.geometry.includes("line"))for(let[n,o]of Object.entries(s.addTags))n in t&&o!=="*"&&(t[n][o]=!0);return t}pointTags(){let e={},t=Object.values(this._presets).filter(r=>!r.suggestion&&!r.replacement&&r.searchable!==!1);for(let r of t){if(!r.geometry.includes("point"))continue;let s=Object.keys(r.tags)[0],n=Object.values(r.tags)[0];!s||!n||(e[s]=e[s]||{},e[s][n]=!0)}return e}vertexTags(){let e={},t=Object.values(this._presets).filter(r=>!r.suggestion&&!r.replacement&&r.searchable!==!1);for(let r of t){if(!r.geometry.includes("vertex"))continue;let s=Object.keys(r.tags)[0],n=Object.values(r.tags)[0];!s||!n||(e[s]=e[s]||{},e[s][n]=!0)}return e}field(e){return this._fields[e]}universal(){return this._universal}defaults(e,t=10,r=!0,s=null){let n=new Map;if(r)for(let l of this.getRecents())n.size<cH&&l.matchGeometry(e)&&n.set(l.id,l);if(this.addablePresetIDs instanceof Set)for(let l of this.addablePresetIDs){let c=this.item(l);c!=null&&c.matchGeometry(e)&&n.set(l,c)}else for(let l of this._defaults[e])l.matchGeometry(e)&&n.set(l.id,l);let o=this.fallback(e);o&&!n.has(o.id)&&n.set(o.id,o);let a=[...n.values()];if(Array.isArray(s)){let c=this.context.systems.locations.locationSetsAt(s);a=a.filter(u=>!u.locationSetID||c[u.locationSetID])}return new xn(this.context,a.slice(0,t-1))}getRecents(){let e=this._recentIDs;if(!e){let r=this.context.systems.storage;e=JSON.parse(r.getItem("preset_recents"))||[]}let t=e.map(r=>{let s=(r==null?void 0:r.id)||r;return this._presets[s]}).filter(Boolean);return this._recentIDs||(this._recentIDs=t.map(r=>r.id)),t}setMostRecent(e){if(e.searchable===!1)return;this._recentIDs.unshift(e.id),this._recentIDs=Fe(this._recentIDs).slice(0,lH),this.context.systems.storage.setItem("preset_recents",JSON.stringify(this._recentIDs))}};var fk="#da26d3",qm=["#ff0000","#ffa500","#ffd700","#00ff00","#00ffff","#1e90ff","#da26d3","#ffc0cb","#d3d3d3","#faf0e6"],hu=class extends Ce{constructor(e){super(e),this.id="rapid",this.dependencies=new Set(["editor","l10n","urlhash"]),this.acceptIDs=new Set,this.ignoreIDs=new Set,this._datasets=new Map,this._taskExtent=null,this._isTaskBoundsRect=null,this._hadPoweruser=!1,this._initPromise=null,this._hashchange=this._hashchange.bind(this),this._stablechange=this._stablechange.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let a of this.dependencies)if(!this.context.systems[a])return Promise.reject(`Cannot init:  ${this.id} requires ${a}`);let e=this.context,t=e.systems.editor,r=e.systems.l10n,s=e.systems.map,n=e.systems.urlhash,o=Promise.all([t.initAsync(),s.initAsync(),r.initAsync(),n.initAsync()]);return this._initPromise=o.then(()=>{n.on("hashchange",this._hashchange),t.on("stablechange",this._stablechange),this._datasets.set("fbRoads",{id:"fbRoads",beta:!1,added:!0,enabled:!1,conflated:!0,service:"mapwithai",color:fk,dataUsed:["mapwithai","Facebook Roads"],label:r.t("rapid_feature_toggle.fbRoads.label"),license_markdown:r.t("rapid_feature_toggle.fbRoads.license_markdown")}),this._datasets.set("msBuildings",{id:"msBuildings",beta:!1,added:!0,enabled:!1,conflated:!0,service:"mapwithai",color:fk,dataUsed:["mapwithai","Microsoft Buildings"],label:r.t("rapid_feature_toggle.msBuildings.label"),license_markdown:r.t("rapid_feature_toggle.msBuildings.license_markdown")})})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this.acceptIDs.clear(),this.ignoreIDs.clear(),Promise.resolve()}get colors(){return qm}get datasets(){return this._datasets}get taskExtent(){return this._taskExtent}isTaskRectangular(){return!!this._taskExtent&&this._isTaskBoundsRect}get hadPoweruser(){return this._hadPoweruser}setTaskExtentByGpxData(e){let t=Ud(e),r=t.features.reduce((n,o)=>n+(o.geometry.type==="LineString"?1:0),0);if(t.type==="FeatureCollection"){let n,o,a,l;t.features.forEach(c=>{if(c.geometry.type==="Point"){let u=c.geometry.coordinates[0],h=c.geometry.coordinates[1];(n===void 0||h<n)&&(n=h),(o===void 0||u<o)&&(o=u),(a===void 0||h>a)&&(a=h),(l===void 0||u>l)&&(l=u)}else if(c.geometry.type==="LineString"&&r===1){let u=c.geometry.coordinates.map(m=>m[0]),h=c.geometry.coordinates.map(m=>m[1]),d=u.filter(s),f=h.filter(s),p=!0;d.forEach(m=>{c.geometry.coordinates.filter(y=>y[0]===m).map(y=>y[1]).filter(s).length!==2&&(p=!1)}),d.length===2&&f.length===2&&p?this._isTaskBoundsRect=!0:this._isTaskBoundsRect=!1}}),this._taskExtent=new ie([o,n],[l,a]),this.emit("taskchanged")}function s(n,o,a){return a.indexOf(n)===o}}_stablechange(){let t=this.context.systems.editor;this.acceptIDs.clear(),this.ignoreIDs.clear();let r=t.history,s=t.index;for(let n=1;n<=s;n++){let a=r[n].annotation;(a==null?void 0:a.type)==="rapid_accept_feature"?a.entityID&&this.acceptIDs.add(a.entityID):(a==null?void 0:a.type)==="rapid_ignore_feature"&&a.entityID&&this.ignoreIDs.add(a.entityID)}}_openBuildingsTitle(e){return e.startsWith("Google Buildings for")?"Google Open Buildings":e}_hashchange(e,t){e.get("poweruser")==="true"&&(this._hadPoweruser=!0);let r=new Set,s=e.get("datasets"),n=t.get("datasets");if(s!==n){typeof s=="string"&&(r=new Set(s.split(",")));for(let[a,l]of this._datasets)r.has(a)?(l.enabled=!0,r.delete(a)):l.enabled=!1}let o=this.context.services.esri;!o||!r.size||o.startAsync().then(()=>o.loadDatasetsAsync()).then(a=>{let l=this.context.systems.l10n;for(let c of r){let u=a[c];if(!u)continue;o.loadLayerAsync(u.id);let h=u.groupCategories.some(m=>m.toLowerCase()==="/categories/preview"),d=u.groupCategories.some(m=>m.toLowerCase()==="/categories/buildings"),f=this._datasets.size%qm.length,p={id:u.id,beta:h,added:!0,enabled:!0,conflated:!1,service:"esri",color:qm[f],dataUsed:["esri",this._openBuildingsTitle(u.title)],label:u.title,license_markdown:l.t("rapid_feature_toggle.esri.license_markdown")};u.extent&&(p.extent=new ie(u.extent[0],u.extent[1])),d&&(p.conflated=!0,p.service="mapwithai"),this._datasets.set(u.id,p)}})}};var du=class extends Ce{constructor(e){super(e),this.id="storage",this.dependencies=new Set,this._storage=null;try{this._storage=window.localStorage}catch(t){this._mock=new Map,this._storage={isMocked:!0,hasItem:r=>this._mock.has(r),getItem:r=>this._mock.get(r),setItem:(r,s)=>this._mock.set(r,s),removeItem:r=>this._mock.delete(r),clear:()=>this._mock.clear()}}}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}hasItem(e){return!!this._storage.getItem(e)}getItem(e){return this._storage.getItem(e)}setItem(e,t){try{return this._storage.setItem(e,t),!this._storage.isMocked}catch(r){console.error("localStorage quota exceeded")}return!1}removeItem(e){this._storage.removeItem(e)}clear(){this._storage.clear()}};var uH=new Set(["motorway","trunk","primary","secondary","tertiary","residential","motorway_link","trunk_link","primary_link","secondary_link","tertiary_link","unclassified","road","service","track","living_street","bus_guideway","busway"]),fu=new Set(["abandoned","construction","demolished","destroyed","dismantled","disused","intermittent","obliterated","planned","proposed","razed","removed","was"]),hH=new RegExp("^("+Array.from(fu).join("|")+"):"),pu=class extends Ce{constructor(e){super(e),this.id="styles",this.context=e,this.dependencies=new Set(["dataloader"]),this.autoStart=!0,this.protanopiaMatrix=[.567,.433,0,0,0,.558,.442,0,0,0,0,.242,.758,0,0,0,0,0,1,0],this.deuteranopiaMatrix=[.625,.375,0,0,0,.7,.3,0,0,0,0,.3,.7,0,0,0,0,0,1,0],this.tritanopiaMatrix=[.95,.05,0,0,0,0,.433,.567,0,0,0,.475,.525,0,0,0,0,0,1,0],this.STYLE_DECLARATIONS={DEFAULTS:{fill:{width:2,color:11184810,alpha:.3},casing:{width:5,color:4473924,alpha:1,cap:"round",join:"round"},stroke:{width:3,color:13421772,alpha:1,cap:"round",join:"round"}},LIFECYCLE:{casing:{alpha:0},stroke:{dash:[7,3],cap:"butt"}},red:{fill:{color:14708319,alpha:.3}},green:{fill:{color:9228383,alpha:.3}},blue:{fill:{color:7853278,alpha:.3}},yellow:{fill:{color:16777108,alpha:.25}},gold:{fill:{color:12893721,alpha:.3}},orange:{fill:{color:14059546,alpha:.3}},pink:{fill:{color:14918901,alpha:.3}},teal:{fill:{color:10084778,alpha:.3}},lightgreen:{fill:{color:12511295,alpha:.3}},tan:{fill:{color:16112826,alpha:.3}},darkgray:{fill:{color:9211020,alpha:.5}},lightgray:{fill:{color:11184810,alpha:.3}},motorway:{casing:{width:10,color:7354159},stroke:{width:8,color:13574273}},trunk:{casing:{width:10,color:7354159},stroke:{width:8,color:14495522}},primary:{casing:{width:10,color:7354159},stroke:{width:8,color:16357382}},secondary:{casing:{width:10,color:7354159},stroke:{width:8,color:15987474}},tertiary:{casing:{width:10,color:7354159},stroke:{width:8,color:16775603}},unclassified:{casing:{width:10,color:4473924},stroke:{width:8,color:14535850}},residential:{casing:{width:10,color:4473924},stroke:{width:8,color:16777215}},living_street:{casing:{width:7,color:16777215},stroke:{width:5,color:13421772}},service:{casing:{width:7,color:4473924},stroke:{width:5,color:16777215}},special_service:{casing:{width:7,color:4473924},stroke:{width:5,color:14535850}},track:{casing:{width:7,color:7630703},stroke:{width:5,color:12957087}},pedestrian:{casing:{width:7,color:16777215},stroke:{width:5,color:10061960,dash:[8,8],cap:"butt"}},path:{casing:{width:5,color:14535850},stroke:{width:3,color:10061960,dash:[6,6],cap:"butt"}},footway:{casing:{width:5,color:16777215},stroke:{width:3,color:10061960,dash:[6,6],cap:"butt"}},crossing_marked:{casing:{width:5,color:14535850},stroke:{width:3,color:4998212,dash:[6,3],cap:"butt"}},crossing_unmarked:{casing:{width:5,color:14535850},stroke:{width:3,color:7826026,dash:[6,4],cap:"butt"}},cycleway:{casing:{width:5,color:16777215},stroke:{width:3,color:5810669,dash:[6,6],cap:"butt"}},bridleway:{casing:{width:5,color:16777215},stroke:{width:3,color:14708063,dash:[6,6],cap:"butt"}},corridor:{casing:{width:5,color:16777215},stroke:{width:3,color:9228383,dash:[2,8],cap:"round"}},steps:{casing:{width:5,color:16777215},stroke:{width:3,color:8507996,dash:[3,3],cap:"butt"}},river:{fill:{color:7853278,alpha:.3},casing:{width:10,color:4473924},stroke:{width:8,color:7855581}},stream:{fill:{color:7853278,alpha:.3},casing:{width:7,color:4473924},stroke:{width:5,color:7855581}},ridge:{stroke:{width:2,color:9228383}},runway:{casing:{width:10,color:0,cap:"butt"},stroke:{width:8,color:16777215,dash:[24,48],cap:"butt"}},taxiway:{casing:{width:7,color:4473924},stroke:{width:5,color:16776960}},railway:{casing:{width:7,color:5592405,cap:"butt"},stroke:{width:2,color:15658734,dash:[12,12],cap:"butt"}},ferry:{casing:{alpha:0},stroke:{width:3,color:5810669,dash:[12,8],cap:"butt"}},boundary:{casing:{width:6,color:8566270,cap:"butt"},stroke:{width:2,color:16777215,dash:[20,5,5,5],cap:"butt"}},boundary_park:{casing:{width:6,color:8566270,cap:"butt"},stroke:{width:2,color:11592344,dash:[20,5,5,5],cap:"butt"}},barrier:{casing:{alpha:0},stroke:{width:3,color:14540253,dash:[10,5,2,5],cap:"round"}},barrier_wall:{casing:{alpha:0},stroke:{width:3,color:14540253,dash:[10,5,2,5],cap:"round"}},barrier_hedge:{fill:{color:9228383,alpha:.3},casing:{alpha:0},stroke:{width:3,color:9228383,dash:[10,5,2,5],cap:"round"}},tree_row:{casing:{width:7,color:4473924},stroke:{width:5,color:9228383}},construction:{casing:{width:10,color:16777215},stroke:{width:8,color:16542740,dash:[10,10],cap:"butt"}},pipeline:{casing:{width:7,color:4473924},stroke:{width:5,color:14540253,dash:[80,2],cap:"butt"}},roller_coaster:{casing:{width:7,color:4473924},stroke:{width:5,color:14540253,dash:[10,1],cap:"butt"}}},this.STYLE_SELECTORS={aeroway:{runway:"runway",taxiway:"taxiway"},amenity:{childcare:"yellow",college:"yellow",fountain:"blue",kindergarten:"yellow",parking:"darkgray",research_institute:"yellow",school:"yellow",university:"yellow"},building:{"*":"red"},barrier:{city_wall:"barrier_wall",hedge:"barrier_hedge",retaining_wall:"barrier_wall",wall:"barrier_wall","*":"barrier"},boundary:{protected_area:"boundary_park",national_park:"boundary_park","*":"boundary"},crossing:{marked:"crossing_marked",traffic_signals:"crossing_marked",uncontrolled:"crossing_marked",zebra:"crossing_marked","*":"crossing_unmarked"},golf:{green:"lightgreen"},highway:{bridleway:"bridleway",bus_guideway:"railway",busway:"special_service",corridor:"corridor",construction:"construction",cycleway:"cycleway",footway:"footway",living_street:"living_street",living_street_link:"living_street",motorway:"motorway",motorway_link:"motorway",path:"path",pedestrian:"pedestrian",primary:"primary",primary_link:"primary",residential:"residential",residential_link:"residential",secondary:"secondary",secondary_link:"secondary",service:"service",service_link:"service",steps:"steps",tertiary:"tertiary",tertiary_link:"tertiary",track:"track",trunk:"trunk",trunk_link:"trunk",unclassified:"unclassified",unclassified_link:"unclassified"},landuse:{cemetery:"lightgreen",commercial:"orange",construction:"gold",farmland:"lightgreen",farmyard:"tan",flowerbed:"green",forest:"green",grass:"green",industrial:"pink",landfill:"orange",meadow:"lightgreen",military:"orange",orchard:"lightgreen",quarry:"darkgray",railway:"darkgray",recreation_ground:"green",residential:"gold",retail:"orange",village_green:"green",vineyard:"lightgreen"},leisure:{garden:"green",golf_course:"green",nature_reserve:"green",park:"green",pitch:"green",swimming_pool:"blue",track:"yellow"},man_made:{adit:"darkgray",breakwater:"barrier_wall",groyne:"barrier_wall",pipeline:"pipeline"},military:{"*":"orange"},natural:{bare_rock:"darkgray",bay:"blue",beach:"yellow",cave_entrance:"darkgray",cliff:"darkgray",glacier:"lightgray",ridge:"ridge",rock:"darkgray",sand:"yellow",scree:"darkgray",scrub:"yellow",shingle:"darkgray",stone:"darkgray",strait:"blue",tree_row:"tree_row",water:"blue",wetland:"teal","*":"green"},power:{plant:"pink"},railway:{platform:"footway","*":"railway"},roller_coaster:{track:"roller_coaster"},route:{ferry:"ferry"},sport:{baseball:"yellow",basketball:"darkgray",beachvolleyball:"yellow",skateboard:"darkgray",softball:"yellow"},type:{waterway:"river"},waterway:{river:"river",dam:"DEFAULTS",weir:"DEFAULTS","*":"stream"},service:{alley:"special_service",driveway:"special_service","drive-through":"special_service",parking_aisle:"special_service","*":"special_service"}},this.PATTERN_DECLARATIONS=["bushes","cemetery","cemetery_buddhist","cemetery_christian","cemetery_jewish","cemetery_muslim","construction","dots","farmland","farmyard","forest","forest_broadleaved","forest_leafless","forest_needleleaved","grass","landfill","lines","orchard","pond","quarry","vineyard","waves","wetland","wetland_bog","wetland_marsh","wetland_reedbed","wetland_swamp"],this.PATTERN_SELECTORS={amenity:{fountain:"pond",grave_yard:"cemetery"},golf:{green:"grass"},landuse:{cemetery:"cemetery",construction:"construction",farmland:"farmland",farmyard:"farmyard",forest:"forest",grass:"grass",grave_yard:"cemetery",landfill:"landfill",meadow:"grass",military:"construction",orchard:"orchard",quarry:"quarry",vineyard:"vineyard"},leaf_type:{broadleaved:"forest_broadleaved",leafless:"forest_leafless",needleleaved:"forest_needleleaved"},natural:{bay:"waves",beach:"dots",grassland:"grass",sand:"dots",scrub:"bushes",strait:"waves",water:"waves",wetland:"wetland",wood:"forest"},religion:{buddhist:"cemetery_buddhist",christian:"cemetery_christian",jewish:"cemetery_jewish",muslim:"cemetery_muslim"},surface:{grass:"grass"},water:{pond:"pond",reservoir:"lines"},wetland:{bog:"wetland_bog",marsh:"wetland_marsh",reedbed:"wetland_reedbed",swamp:"wetland_swamp"}},this.styleMatch=this.styleMatch.bind(this)}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init: ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}styleMatch(e){var b,_;let t=this.STYLE_DECLARATIONS.DEFAULTS,r=t,s=999,n,o;for(let[w,A]of Object.entries(e)){let k=this.STYLE_SELECTORS[w];if(!k||!A||w==="service"&&x(e,"highway")===void 0)continue;let v=(b=k[A])!=null?b:k["*"],E=Object.keys(k).length;if(fu.has(A)&&(E=999),v&&E<=s){let S=this.STYLE_DECLARATIONS[v];if(!S){console.error(`invalid styleID: ${v}`);continue}if(r=S,s=E,n=w,o=A,s===1)break}}let a=!1;for(let[w,A]of Object.entries(e))if(fu.has(w)&&A!=="no"){a=!0;break}else if((!n||w===n)&&fu.has(A)){a=!0;break}else if(!n&&hH.test(w)&&A!=="no"){a=!0;break}let l={};for(let w of["fill","casing","stroke"]){l[w]={};for(let A of["width","color","alpha","cap","dash"]){let k=r[w]&&r[w][A];if(k!==void 0)l[w][A]=k;else{let v=t[w]&&t[w][A];v!==void 0&&(l[w][A]=v)}}}let c=x(e,"bridge"),u=x(e,"building"),h=x(e,"cutting"),d=x(e,"embankment"),f=x(e,"highway"),p=x(e,"tracktype"),m=x(e,"tunnel"),g=x(e,"surface");if(f==="track"&&p!=="grade1"&&(g=g||"dirt"),(c||d||h)&&(l.casing.width+=7,l.casing.color=0,l.casing.cap="butt",(d||h)&&(l.casing.dash=[2,4])),m&&(l.stroke.alpha=.5),g&&uH.has(f)&&!Ma.surface[g]&&(c||(l.casing.color=13421772),l.casing.cap="butt",l.casing.dash=[4,4]),a){let w=this.STYLE_DECLARATIONS.LIFECYCLE;for(let A of["fill","casing","stroke"])for(let k of["width","color","alpha","cap","dash"]){let v=w[A]&&w[A][k];v!==void 0&&(l[A][k]=v)}}if(u)return l;if(l.fill.pattern)if(!this.PATTERN_DECLARATIONS.includes(l.fill.pattern))console.error(`invalid patternID: ${patternID}`);else return l;let y=999;for(let[w,A]of Object.entries(e)){let k=this.PATTERN_SELECTORS[w];if(!k||!A)continue;let v=(_=k[A])!=null?_:k["*"],E=Object.keys(k).length;if(fu.has(A)&&(E=999),v&&E<=y){if(!this.PATTERN_DECLARATIONS.includes(v)){console.error(`invalid patternID: ${v}`);continue}if(l.fill.pattern=v,y=E,y===1)break}}return l;function x(w,A){return w[A]==="no"?void 0:w[A]}}};function x6(i){let e=i.systems.l10n,t=i.services.osm;function r(o){!t||!t.authenticated()?s(o,null):t.userDetails((a,l)=>s(o,l))}function s(o,a){let l=o.select(".userInfo"),c=o.select(".loginLogout");if(!a)l.html("").classed("hide",!0);else{l.html("").classed("hide",!1);let u=l.append("a").attr("href",t.userURL(a.display_name)).attr("target","_blank");a.image_url?u.append("img").attr("class","icon pre-text user-icon").attr("src",a.image_url):u.call(V("#rapid-icon-avatar","pre-text light")),u.append("span").attr("class","label").text(a.display_name)}t?t.authenticated()?c.classed("hide",!1).select("a").text(e.t("logout")).on("click",u=>{u.preventDefault(),t.logout(),n()}):c.classed("hide",!1).select("a").text(e.t("login")).on("click",u=>{u.preventDefault(),t.authenticate()}):c.classed("hide",!0)}function n(){if(!t)return;let o=t.wwwroot+"/logout?referer=%2Flogin",a=600,l=550,c=[["width",a],["height",l],["left",window.screen.width/2-a/2],["top",window.screen.height/2-l/2]].map(u=>u.join("=")).join(",");window.open(o,"_blank",c)}return function(o){t&&(o.append("li").attr("class","userInfo").classed("hide",!0),o.append("li").attr("class","loginLogout").classed("hide",!0).append("a").attr("href","#"),t.on("authchange",()=>r(o)),r(o))}}var dH="Expected a function";function fH(i,e,t){var r=!0,s=!0;if(typeof i!="function")throw new TypeError(dH);return Xa(t)&&(r="leading"in t?!!t.leading:r,s="trailing"in t?!!t.trailing:s),wt(i,e,{leading:r,maxWait:e,trailing:s})}var on=fH;function v6(i){let e=i.systems.imagery,t=i.systems.l10n,r=i.systems.map,s=G(null);function n(a,l,c){let u=a.selectAll(`.${c}`).data([0]);u=u.enter().append("div").attr("class",c).merge(u);let h=u.selectAll(".attribution").data(l,f=>f.id);h.exit().remove(),h=h.enter().append("span").attr("class","attribution").each((f,p,m)=>{let g=G(m[p]);if(f.terms_html){g.html(f.terms_html);return}f.terms_url&&(g=g.append("a").attr("href",f.terms_url).attr("target","_blank"));let y=t.t(`imagery.${f.idtx}.attribution.text`,{default:f.terms_text||f.id||f.name});f.icon&&!f.overlay&&g.append("img").attr("class","source-image").attr("src",f.icon),g.append("span").attr("class","attribution-text").text(y)}).merge(h);let d=h.selectAll(".copyright-notice").data(f=>{let p=f.copyrightNotices(r.zoom(),r.extent());return p?[p]:[]});d.exit().remove(),d=d.enter().append("span").attr("class","copyright-notice").merge(d),d.text(String)}function o(){let a=e.baseLayerSource();s.call(n,a?[a]:[],"base-layer-attribution");let l=r.zoom(),c=e.overlayLayerSources()||[];s.call(n,c.filter(u=>u.validZoom(l)),"overlay-layer-attribution")}return function(a){s=a,e.on("imagerychange",o),r.on("draw",on(o,400,{leading:!1})),o()}}function zc(i){let e=i.systems.l10n,t=st(i,"more-fields").minItems(1),r=[],s="",n="",o="";function a(l){let c=r.filter(w=>w.isAllowed()),u=c.filter(w=>w.isShown()),h=c.filter(w=>!w.isShown()),d=l.selectAll(".form-fields-container").data([0]);d=d.enter().append("div").attr("class","form-fields-container "+(o||"")).merge(d);let f=d.selectAll(".wrap-form-field").data(u,w=>w.id+(w.entityIDs?w.entityIDs.join():""));f.exit().remove();let p=f.enter().append("div").attr("class",w=>`wrap-form-field wrap-form-field-${w.safeid}`);f=f.merge(p),f.order().each((w,A,k)=>{G(k[A]).call(w.render)});let m=[],g=h.map(w=>{let A=w.title;m.push(A);let k=w.terms;return w.key&&k.push(w.key),w.keys&&(k=k.concat(w.keys)),{display:w.label,value:A,title:A,field:w,terms:k}}),y=m.slice(0,3).join(", ")+(m.length>3?"\u2026":""),x=l.selectAll(".more-fields").data(n==="hover"||g.length===0?[]:[0]);x.exit().remove();let b=x.enter().append("div").attr("class","more-fields").append("label");b.append("span").text(e.t("inspector.add_fields")),x=b.merge(x);let _=x.selectAll(".value").data([0]);_.exit().remove(),_=_.enter().append("input").attr("class","value").attr("type","text").attr("placeholder",y).call(Re).merge(_),_.call(be,"").call(t.data(g).on("accept",w=>{if(!w)return;let A=w.field;A.show(),l.call(a),A.focus()})),s!==y&&(_.attr("placeholder",y),s=y)}return a.fieldsArr=function(l){return arguments.length?(r=l||[],a):r},a.state=function(l){return arguments.length?(n=l,a):n},a.klass=function(l){return arguments.length?(o=l,a):o},a}function _6(i){let e=i.systems.l10n,t=ue("change");var r=zc(i),s=st(i,"comment").caseSensitive(!0),n,o,a;function l(u){c(u)}function c(u){var h=!1;if(!n){h=!0;var d=i.systems.presets;n=[new zr(i,d.field("comment"),null,{show:!0,revert:!1}),new zr(i,d.field("source"),null,{show:!1,revert:!1}),new zr(i,d.field("hashtags"),null,{show:!1,revert:!1})],n.forEach(function(b){b.on("change",function(_,w){t.call("change",b,void 0,_,w)})})}if(n.forEach(function(b){b.tags(o)}),u.call(r.fieldsArr(n)),h){var f=u.select(".form-field-comment textarea"),p=f.node();p&&(p.focus(),p.select()),o1(f,"blur");var m=i.services.osm;m&&m.userChangesets(function(b,_){if(!b){var w=_.map(function(A){var k=A.tags.comment;return k?{title:k,value:k}:null}).filter(Boolean);f.call(s.data(Nl(w,"title")))}})}var g=o.comment.match(/google/i),y=u.select(".form-field-comment").selectAll(".comment-warning").data(g?[0]:[]);y.exit().transition().duration(200).style("opacity",0).remove();var x=y.enter().insert("div",".tag-reference-body").attr("class","field-warning comment-warning").style("opacity",0);x.append("a").attr("target","_blank").call(V("#rapid-icon-alert","inline")).attr("href",e.t("commit.google_warning_link")).append("span").text(e.t("commit.google_warning")),x.transition().duration(200).style("opacity",1)}return l.tags=function(u){return arguments.length?(o=u,l):o},l.changesetID=function(u){return arguments.length?(a===u||(a=u,n=null),l):a},me(l,t,"on")}var gk=et(f1(),1);var Gn=new function(){var i="keyValue",e="keyAttributes",t="@",r=[],s=/^\s*$/,n=/^(?:true|false)$/i;function o(h){return s.test(h)?null:n.test(h)?h.toLowerCase()==="true":isFinite(h)?parseFloat(h):isFinite(Date.parse(h))?new Date(h):h}function a(){}a.prototype.toString=function(){return"null"},a.prototype.valueOf=function(){return null};function l(h){return h===null?new a:h instanceof Object?h:new h.constructor(h)}function c(h,d,f,p){var m=r.length,g=h.hasChildNodes(),y=h.hasAttributes(),x=!!(d&2),b,_,w=0,A="",k=x?{}:!0;if(g)for(var v,E=0;E<h.childNodes.length;E++)v=h.childNodes.item(E),v.nodeType===4?A+=v.nodeValue:v.nodeType===3?A+=v.nodeValue.trim():v.nodeType===1&&!v.prefix&&r.push(v);var S=r.length,M=o(A);!x&&(g||y)&&(k=d===0?l(M):{});for(var I=m;I<S;I++)b=r[I].nodeName.toLowerCase(),_=c(r[I],d,f,p),k.hasOwnProperty(b)?(k[b].constructor!==Array&&(k[b]=[k[b]]),k[b].push(_)):(k[b]=_,w++);if(y){for(var T=h.attributes.length,C=p?"":t,P=p?{}:k,D,O=0;O<T;w++,O++)D=h.attributes.item(O),P[C+D.name.toLowerCase()]=o(D.value.trim());p&&(f&&Object.freeze(P),k[e]=P,w-=T-1)}return d===3||(d===2||d===1&&w>0)&&A?k[i]=M:!x&&w===0&&A&&(k=M),f&&(x||w>0)&&Object.freeze(k),r.length=m,k}function u(h,d,f){var p,m;f instanceof String||f instanceof Number||f instanceof Boolean?d.appendChild(h.createTextNode(f.toString())):f.constructor===Date&&d.appendChild(h.createTextNode(f.toGMTString()));for(var g in f)if(p=f[g],!(isFinite(g)||p instanceof Function))if(g===i)p!==null&&p!==!0&&d.appendChild(h.createTextNode(p.constructor===Date?p.toGMTString():String(p)));else if(g===e)for(var y in p)d.setAttribute(y,p[y]);else if(g.charAt(0)===t)d.setAttribute(g.slice(1),p);else if(p.constructor===Array)for(var x=0;x<p.length;x++)m=h.createElement(g),u(h,m,p[x]),d.appendChild(m);else m=h.createElement(g),p instanceof Object?u(h,m,p):p!==null&&p!==!0&&m.appendChild(h.createTextNode(p.toString())),d.appendChild(m)}this.build=function(h,d,f,p){var m=arguments.length>1&&typeof d=="number"?d&3:1;return c(h,m,f||!1,arguments.length>3?p:m===3)},this.unbuild=function(h){var d=document.implementation.createDocument("","",null);return u(d,d,h),d},this.stringify=function(h){return new XMLSerializer().serializeToString(Gn.unbuild(h))}};function jc(i,e){return function(t){t.style("opacity",i?0:1).classed("hide",!1).transition().style("opacity",i?1:0).on("end",function(){G(this).classed("hide",!i).style("opacity",null),e&&e.apply(this)})}}function El(i,e){let t=i.systems.l10n,r=i.systems.storage,s=ue("toggled"),n=!0,o=!0,a,l=kt(""),c=function(){},u=function(d){o&&(n=(r.getItem(`disclosure.${e}.expanded`)||"true")==="true"),a!==void 0&&(n=a);let f=d.selectAll(`.hide-toggle-${e}`).data([0]),p=f.enter().append("a").attr("href","#").attr("class",`hide-toggle hide-toggle-${e}`).call(V("","pre-text hide-toggle-icon"));p.append("span").attr("class","hide-toggle-text"),f=p.merge(f),f.on("click",x).classed("expanded",n),f.selectAll(".hide-toggle-text").text(l());let m=t.isRTL(),g=n?"down":m?"backward":"forward";f.selectAll(".hide-toggle-icon > use").attr("xlink:href",`#rapid-icon-${g}`);let y=d.selectAll(".disclosure-wrap").data([0]);y=y.enter().append("div").attr("class",`disclosure-wrap disclosure-wrap-${e}`).merge(y).classed("hide",!n),n&&y.call(c);function x(b){b.preventDefault(),n=!n,o&&a===void 0&&r.setItem(`disclosure.${e}.expanded`,n),a=void 0,f.classed("expanded",n);let _=n?"down":m?"backward":"forward";f.selectAll(".hide-toggle-icon > use").attr("xlink:href",`#rapid-icon-${_}`),y.call(jc(n)),n&&y.call(c),s.call("toggled",this,n)}};return u.expanded=h=>arguments.length?(n=h,u):n,u.checkPreference=h=>arguments.length?(o=h,u):o,u.expandOverride=h=>arguments.length?(a=h,u):a,u.label=h=>arguments.length?(l=kt(h),u):l,u.content=h=>arguments.length?(c=h,u):c,me(u,s,"on")}function Ge(i,e){let t=kt(""),r=G(null),s,n,o,a,l,c,u={id:e};u.selection=function(){return r},u.classes=function(d){return arguments.length?(t=kt(d),u):t},u.label=function(d){return arguments.length?(a=kt(d),u):a},u.shouldDisplay=function(d){return arguments.length?(s=kt(d),u):s},u.content=function(d){return arguments.length?(n=d,u):n},u.disclosureContent=function(d){return arguments.length?(l=d,u):l},u.disclosureExpandOverride=function(d){return arguments.length?(c=d,u):c},u.render=function(f){r=f.selectAll(`.section-${e}`).data([0]),r=r.enter().append("div").attr("class",`section section-${e} `+(t&&t()||"")).merge(r),r.call(h)},u.reRender=function(){r.call(h)};function h(d){if(typeof s=="function"){let f=s();if(d.classed("hide",!f),!f){d.html("");return}}l?(o||(o=El(i,e.replace(/-/g,"_")).label(a||"").content(l)),o.expandOverride(c),d.call(o)):n&&d.call(n)}return u}function b6(i){let e=i.systems.dataloader,t=i.systems.editor,r=i.systems.l10n,s=ei(),n={};e.getDataAsync("discarded").then(l=>n=l).catch(()=>{});let o=Ge(i,"changes-list").label(()=>{let l=t.difference().summary();return r.t("inspector.title_count",{title:r.t("commit.changes"),count:l.size})}).disclosureContent(a);function a(l){let c=[...t.difference().summary().values()],u=l.selectAll(".commit-section").data([0]),h=u.enter().append("div").attr("class","commit-section");h.append("ul").attr("class","changeset-list"),u=h.merge(u);let d=u.select("ul").selectAll("li").data(c),f=d.enter().append("li").attr("class","change-item"),p=f.append("button").on("mouseover",w).on("mouseout",A).on("click",k);p.each((v,E,S)=>{let M=v.entity.geometry(v.graph);G(S[E]).call(V(`#rapid-icon-${M}`,`pre-text ${v.changeType}`))}),p.append("span").attr("class","change-type").text(v=>r.t(`commit.${v.changeType}`)+" "),p.append("strong").attr("class","entity-type").text(v=>{let E=i.systems.presets.match(v.entity,v.graph);return E&&E.name()||r.displayType(v.entity.id)}),p.append("span").attr("class","entity-name").text(v=>{let E=r.displayName(v.entity.tags),S="";return E!==""&&(S+=":"),S+=" "+E}),d=f.merge(d);let m=new vr().update({id:void 0}),g=t.changes(to(t.difference(),n));delete m.id;let y=Gn.stringify(m.osmChangeJXON(g)),x=new Blob([y],{type:"text/xml;charset=utf-8;"}),b="changes.osc",_=u.selectAll(".download-changes").data([0]).enter().append("a").attr("class","download-changes");s.download?_.attr("href",window.URL.createObjectURL(x)).attr("download",b):_.attr("target","_blank").on("click.download",()=>navigator.msSaveBlob(x,b)),_.call(V("#rapid-icon-load","inline")).append("span").text(r.t("commit.download_changes"));function w(v){v.entity&&i.surface().selectAll(m0([v.entity.id],t.staging.graph)).classed("hover",!0)}function A(){i.surface().selectAll(".hover").classed("hover",!1)}function k(v,E){if(E.changeType!=="deleted"){let S=E.entity;i.systems.map.fitEntitiesEase(S),i.surface().selectAll(m0([S.id],t.staging.graph)).classed("hover",!0)}}}return o}function w6(i){let e=i.systems.editor,t=i.systems.l10n,r=i.systems.validator;function s(n){let o=r.getIssuesBySeverity({what:"edited",where:"all",includeDisabledRules:!0});for(let a in o){let l=o[a];a!=="error"&&(l=l.filter(g=>g.type!=="help_request"));let c=`${a}-section`,u=`${a}-item`,h=n.selectAll("."+c).data(l.length?[0]:[]);h.exit().remove();let d=h.enter().append("div").attr("class","modal-section "+c+" fillL2");d.append("h3").html(a==="warning"?t.tHtml("commit.warnings"):t.tHtml("commit.errors")),d.append("ul").attr("class","changeset-list"),h=d.merge(h);let f=h.select("ul").selectAll("li").data(l,g=>g.key);f.exit().remove();let p=f.enter().append("li").attr("class",u),m=p.append("button").on("mouseover",(g,y)=>{if(y.entityIds){let x=e.staging.graph;i.surface().selectAll(m0(y.entityIds,x)).classed("hover",!0)}}).on("mouseout",()=>{i.surface().selectAll(".hover").classed("hover",!1)}).on("click",(g,y)=>{r.focusIssue(y)});m.call(V("#rapid-icon-alert","pre-text")),m.append("strong").attr("class","issue-message"),f=p.merge(f),f.selectAll(".issue-message").html(g=>g.message(i))}}return s}function Aa(i,e){let t=i.systems.dataloader,r=i.systems.editor,s=i.systems.l10n,n=i.systems.storage,o=i.services.taginfo,a=ue("change"),l=[{id:"list",icon:"#fas-th-list"},{id:"text",icon:"#fas-i-cursor"}],c=Ge(i,e).classes("raw-tag-editor").label(()=>{let B=Object.keys(b).filter(Boolean).length;return s.t("inspector.title_count",{title:s.t("inspector.tags"),count:B})}).disclosureContent(w),u=new Set;t.getDataAsync("discarded").then(B=>u=new Set(Object.keys(B)));let h=n.getItem("raw-tag-editor-view")||"list",d=[],f=[],p=!1,m=!1,g=null,y,x,b,_;function w(B){f=f.filter(q=>b[q]!==void 0);let $=Object.keys(b).sort(),U=Di($,f);for(let q in U)f.push(U[q]);let H=f.map((q,pe)=>({index:pe,key:q,value:b[q]}));(!H.length||m)&&(m=!1,H.push({index:H.length,key:"",value:""})),B.selectAll(".raw-tag-options").data([0]).enter().insert("div",":first-child").attr("class","raw-tag-options").selectAll(".raw-tag-option").data(l,q=>q.id).enter().append("button").attr("class",q=>`raw-tag-option raw-tag-option-${q.id}`+(h===q.id?" selected":"")).attr("title",q=>s.t(`icons.${q.id}`)).on("click",function(q,pe){h=pe.id,n.setItem("raw-tag-editor-view",pe.id),B.selectAll(".raw-tag-option").classed("selected",$e=>$e===pe),B.selectAll(".tag-text").classed("hide",pe.id!=="text").each(v),B.selectAll(".tag-list, .add-row").classed("hide",pe.id!=="list")}).each((q,pe,$e)=>{G($e[pe]).call(V(q.icon))});let K=M(H),Y=B.selectAll(".tag-text").data([0]);Y=Y.enter().append("textarea").attr("class","tag-text"+(h!=="text"?" hide":"")).call(Re).attr("placeholder",s.t("inspector.key_value")).attr("spellcheck","false").merge(Y),Y.call(be,K).each(v).on("input",v).on("focus",N).on("blur",I).on("change",I);let oe=B.selectAll(".tag-list").data([0]);oe=oe.enter().append("ul").attr("class","tag-list"+(h!=="list"?" hide":"")).merge(oe);let re=B.selectAll(".add-row").data([0]).enter().append("div").attr("class","add-row"+(h!=="list"?" hide":""));re.append("button").attr("class","add-tag").call(V("#rapid-icon-plus","light")).on("click",R),re.append("div").attr("class","space-value"),re.append("div").attr("class","space-buttons");let W=oe.selectAll(".tag-row").data(H,q=>q.key);W.exit().each((q,pe,$e)=>{G($e[pe]).selectAll("input.key, input.value").call(st.off,i)}).remove();let Z=W.enter().append("li").attr("class","tag-row").classed("readonly",A),Q=Z.append("div").attr("class","inner-wrap");Q.append("div").attr("class","key-wrap").append("input").property("type","text").attr("class","key").call(Re).on("focus",N).on("blur",P).on("change",P),Q.append("div").attr("class","value-wrap").append("input").property("type","text").attr("class","value").call(Re).on("focus",N).on("blur",D).on("change",D).on("keydown.push-more",T),Q.append("button").attr("class","form-field-button remove").attr("title",s.t("icons.remove")).call(V("#rapid-operation-delete")),W=W.merge(Z).sort((q,pe)=>q.index-pe.index),W.each((q,pe,$e)=>{let nt=G($e[pe]);nt.select("input.key"),nt.select("input.value"),_&&o&&y!=="hover"&&C(nt);let lt={key:q.key};k(q)||(lt.value=q.value);let Tt=Hn(i,lt);y==="hover"&&Tt.showing(!1),nt.select(".inner-wrap").call(Tt.button),nt.call(Tt.body),nt.select("button.remove")}),W.selectAll("input.key").attr("title",q=>q.key).attr("readonly",q=>A(q)||k(q)||null).call(be,q=>q.key),W.selectAll("input.value").classed("mixed",k).attr("title",q=>k(q)?q.value.filter(Boolean).join(`
`):q.value).attr("readonly",q=>A(q)||null).attr("placeholder",q=>k(q)?s.t("inspector.multiple_values"):null).call(be,q=>k(q)?"":q.value),W.selectAll("button.remove").on(("PointerEvent"in window?"pointer":"mouse")+"down",O)}function A(B){for(let $ of d)if($.test(B.key))return!0;return!1}function k(B){return Array.isArray(B.value)}function v(){if(h!=="text")return;let B=G(this),$=B.node().value.match(/\n/g),U=2+Number($&&$.length);B.style("height",U*20+"px")}function E(B){return JSON.stringify(B).slice(1,-1)}function S(B){let $="",U="";return(B.length<1||B.charAt(0)!=='"')&&($='"'),(B.length<2||B.charAt(B.length-1)!=='"'||B.charAt(B.length-1)==='"'&&B.charAt(B.length-2)==="\\")&&(U='"'),JSON.parse($+B+U)}function M(B){let $=B.filter(U=>U.key&&U.key.trim()!=="").map(U=>{let H=U.value;typeof H!="string"&&(H="*");let z=H?E(H):"";return E(U.key)+"="+z}).join(`
`);return y!=="hover"&&$.length?$+`
`:$}function I(){let B=this.value.trim(),$={};B.split(`
`).forEach(H=>{let z=H.match(/^\s*([^=]+)=(.*)$/);if(z!==null){let j=i.cleanTagKey(S(z[1].trim())),X=i.cleanTagValue(S(z[2].trim()));$[j]=X}});let U=jn(b,$);if(U.length){if(g=g||{},U.forEach(function(H){A({key:H.key})||H.newVal==="*"&&typeof H.oldVal!="string"||(H.type==="-"?g[H.key]=void 0:H.type==="+"&&(g[H.key]=H.newVal||""))}),Object.keys(g).length===0){g=null;return}F()}}function T(B){B.keyCode===9&&!B.shiftKey&&c.selection().selectAll(".tag-list li:last-child input.value").node()===this&&be(G(this))&&R()}function C(B){let $=B.datum(),U=B.select("input.key"),H=B.select("input.value");if(A($))return;if(k($)){H.call(st(i,"tag-value").minItems(1).fetcher(function(K,Y){let oe=be(U);if(!b[oe])return;let re=b[oe].filter(Boolean).map(W=>({value:W,title:W}));Y(re)}));return}let j=r.staging.graph.geometry(_[0]);U.call(st(i,"tag-key").fetcher(function(K,Y){o.keys({debounce:!0,geometry:j,query:K},function(oe,re){if(!oe){let W=re.filter(Z=>!(/_\d$/.test(Z.value)||u.has(Z.value)||b[Z.value]!==void 0));Y(X(K,W))}})})),H.call(st(i,"tag-value").fetcher(function(K,Y){o.values({debounce:!0,key:be(U),geometry:j,query:K},function(oe,re){oe||Y(X(K,re))})}));function X(K,Y){let oe=[],re=[];for(let W of Y)W.value.substring(0,K.length)===K?oe.push(W):re.push(W);return oe.concat(re)}}function P(B,$){if(G(this).attr("readonly"))return;let U=$.key;if(g&&g.hasOwnProperty(U)&&g[U]===void 0)return;let H=i.cleanTagKey(this.value.trim());if(A({key:H})){this.value=U;return}if(H&&H!==U&&b[H]!==void 0){this.value=U,c.selection().selectAll(".tag-list input.value").each((Y,oe,re)=>{if(Y.key===H){let W=re[oe];W.focus(),W.select()}});return}let z=this.parentNode.parentNode,j=G(z).selectAll("input.value"),X=i.cleanTagValue(be(j));g=g||{},U&&(g[U]=void 0),g[H]=X;let K=f.indexOf(U);K!==-1&&(f[K]=H),$.key=H,$.value=X,this.value=H,be(j,X),F()}function D(B,$){A($)||k($)&&!this.value||g&&g.hasOwnProperty($.key)&&g[$.key]===void 0||(g=g||{},g[$.key]=i.cleanTagValue(this.value),F())}function O(B,$){A($)||($.key===""?(m=!1,c.reRender()):(f=f.filter(U=>U!==$.key),g=g||{},g[$.key]=void 0,F()))}function R(){window.setTimeout(function(){m=!0,c.reRender(),c.selection().selectAll(".tag-list li:last-child input.key").node().focus()},20)}function N(){p=!0}function F(){let B=_;window.setTimeout(function(){g&&(a.call("change",this,B,g),g=null)},10)}return c.state=function(B){return arguments.length?(y!==B&&(p=!1,f=[],y=B),c):y},c.presets=function(B){return arguments.length?(x=B,x&&x.length&&x[0].isFallback()||p?c.disclosureExpandOverride(!0):c.disclosureExpandOverride(void 0),c):x},c.tags=function(B){return arguments.length?(b=B,c):b},c.entityIDs=function(B){return arguments.length?((!_||!B||!ai(_,B))&&(p=!1,f=[],_=B),c):_},c.readOnlyTags=function(B){return arguments.length?(d=B,c):d},me(c,a,"on")}var pk=[/^closed:/,/^ideditor:/,/^rapid:/,/^resolved:/,/^warnings:/,/^changesets_count$/,/^created_by$/,/^(imagery|photos|data)_used$/,/^host$/,/^locale$/],mk=/(#[^\u2000-\u206F\u2E00-\u2E7F\s\\'!"#$%()*,.\/:;<=>?@\[\]^`{|}~]+)/g;function E6(i){let e=i.systems.editor,t=i.systems.l10n,r=i.systems.rapid,s=i.systems.storage,n=i.systems.uploader,o=i.systems.urlhash,a=i.systems.validator,l=ue("cancel"),c,u,h=_6(i).on("change",_),d=Aa(i,"changeset-tag-editor").on("change",_).readOnlyTags(pk),f=b6(i),p=w6(i);function m(v){u=v,n.changeset||g(),y(),v.call(x)}function g(){let v=t.localeCode(),E=+s.getItem("commentDate")||0,S=Date.now(),M=2*86400*1e3;(E>S||S-E>M)&&(s.removeItem("comment"),s.removeItem("hashtags"),s.removeItem("source"));let I=o.initialHashParams.get("comment"),T=o.initialHashParams.get("source"),C=o.initialHashParams.get("hashtags");I&&(s.setItem("comment",I),s.setItem("commentDate",Date.now())),T&&(s.setItem("source",T),s.setItem("commentDate",Date.now())),C&&(s.setItem("hashtags",C),s.setItem("commentDate",Date.now()));let P=ei(),D={comment:s.getItem("comment")||"",created_by:i.cleanTagValue("Rapid "+i.version),host:i.cleanTagValue(P.host),locale:i.cleanTagValue(v)};w(D,!0);let O=s.getItem("hashtags");O&&(D.hashtags=O);let R=s.getItem("source");R&&(D.source=R),n.changeset=new vr({tags:D})}function y(){let v=Object.assign({},n.changeset.tags);r.hadPoweruser?v["rapid:poweruser"]="true":delete v["rapid:poweruser"];let E=e.sourcesUsed(),S=new Set((v.source||"").split(";")),M=["aerial imagery","streetlevel imagery","mapillary","kartaview","streetside","mapwithai","esri"];for(let U of M)S.delete(U);let I;E.imagery.size&&(S.add("aerial imagery"),I=i.cleanTagValue(Array.from(E.imagery).filter(Boolean).join(";"))),I?v.imagery_used=I:delete v.imagery_used;let T;if(E.photos.size){S.add("streetlevel imagery");for(let U of E.photos){let H=U.match(/(mapillary|kartaview|streetside)/i);H!==null&&S.add(H[1])}T=i.cleanTagValue(Array.from(E.photos).filter(Boolean).join(";"))}T?v.photos_used=T:delete v.photos_used;let C;if(E.data.size){for(let U of E.data){let H=U.match(/(mapwithai|esri)/i);H!==null&&S.add(H[1])}C=i.cleanTagValue(Array.from(E.data).filter(Boolean).join(";"))}C?v.data_used=C:delete v.data_used;let P=i.cleanTagValue(Array.from(S).filter(Boolean).join(";"));P?v.source=P:delete v.source;for(let U of Object.keys(v))/^(closed|warnings|resolved):/.test(U)&&delete v[U];let D=i.services.osm;if(D){let U=D.getClosedIDs();U.length&&(v["closed:note"]=i.cleanTagValue(U.join(";")))}let O=i.services.keepRight;if(O){let U=O.getClosedIDs();U.length&&(v["closed:keepright"]=i.cleanTagValue(U.join(";")))}let R=i.services.improveOSM;if(R){let U=R.getClosedCounts();for(let H in U)v[`closed:improveosm:${H}`]=i.cleanTagValue(U[H].toString())}let N=i.services.osmose;if(N){let U=N.getClosedCounts();for(let H in U)v[`closed:osmose:${H}`]=i.cleanTagValue(U[H].toString())}let F=a.getIssuesBySeverity({what:"edited",where:"all",includeIgnored:!0,includeDisabledRules:!0}).warning.filter(U=>U.type!=="help_request");$(F,"warnings");let B=a.getResolvedIssues();$(B,"resolved"),n.changeset=n.changeset.update({tags:v});function $(U,H){let z=Ut(U,"type");for(let j in z){let X=z[j];if(X[0].subtype){let K=Ut(X,"subtype");for(let Y in K){let oe=K[Y];v[H+":"+j+":"+Y]=i.cleanTagValue(oe.length.toString())}}else v[H+":"+j]=i.cleanTagValue(X.length.toString())}}}function x(v){let E=i.services.osm;if(!E)return;let M=v.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");M.append("div").append("h3").html(t.tHtml("commit.title")),M.append("button").attr("class","close").on("click",function(){l.call("cancel",this)}).call(V("#rapid-icon-close"));let I=v.selectAll(".body").data([0]);I=I.enter().append("div").attr("class","body").merge(I);let T=I.selectAll(".changeset-editor").data([0]);T=T.enter().append("div").attr("class","modal-section changeset-editor").merge(T),T.call(h.changesetID(n.changeset.id).tags(n.changeset.tags)),I.call(p);let C=I.selectAll(".save-section").data([0]);C=C.enter().append("div").attr("class","modal-section save-section fillL").merge(C);let P=C.selectAll(".commit-info").data([0]);P.enter().size()&&(c=null),P=P.enter().append("p").attr("class","commit-info").html(t.tHtml("commit.upload_explanation")).merge(P),E.userDetails(function(K,Y){if(K||c===Y)return;c=Y;let oe=G(document.createElement("div"));Y.image_url&&oe.append("img").attr("src",Y.image_url).attr("class","icon pre-text user-icon"),oe.append("a").attr("class","user-info").html(Y.display_name).attr("href",E.userURL(Y.display_name)).attr("target","_blank"),P.html(t.tHtml("commit.upload_explanation_with_user",{user:oe.html()}))});let D=C.selectAll(".request-review").data([0]),O=D.enter().append("div").attr("class","request-review"),R=us("commit-input-request-review"),N=O.append("label").attr("for",R);N.empty()||N.call(he(i).title(t.t("commit.request_review_info")).placement("top")),N.append("input").attr("type","checkbox").attr("id",R),N.append("span").html(t.tHtml("commit.request_review")),D=D.merge(O);let F=D.selectAll("input").property("checked",A(n.changeset.tags)).on("change",X),B=C.selectAll(".buttons").data([0]),$=B.enter().append("div").attr("class","buttons fillL");$.append("button").attr("class","secondary-action button cancel-button").append("span").attr("class","label").html(t.tHtml("commit.cancel")),$.append("button").attr("class","action button save-button").append("span").attr("class","label").html(t.tHtml("commit.save"));let H=b();B=B.merge($),B.selectAll(".cancel-button").on("click.cancel",function(){l.call("cancel",this)}),B.selectAll(".save-button").classed("disabled",H!==null).on("click.save",function(){if(!G(this).classed("disabled")){this.blur();let K=n.changeset.tags;for(let[Y,oe]of Object.entries(K))(!Y||!oe)&&delete K[Y];n.save()}}),he(i).destroyAny(B.selectAll(".save-button")),H&&B.selectAll(".save-button").call(he(i).title(H).placement("top"));let z=I.selectAll(".tag-section.raw-tag-editor").data([0]);z=z.enter().append("div").attr("class","modal-section tag-section raw-tag-editor").merge(z),z.call(d.tags(Object.assign({},n.changeset.tags)).render);let j=I.selectAll(".commit-changes-section").data([0]);j=j.enter().append("div").attr("class","modal-section commit-changes-section").merge(j),j.call(f.render);function X(){let K=F.property("checked");k({review_requested:K?"yes":void 0}),z.call(d.tags(Object.assign({},n.changeset.tags)).render)}}function b(){var E,S,M;let v=a.getIssuesBySeverity({what:"edited",where:"all"}).error;return v.length?t.t("commit.outstanding_errors_message",{count:v.length}):((M=(S=(E=n.changeset)==null?void 0:E.tags)==null?void 0:S.comment)!=null?M:"").trim().length?null:t.t("commit.comment_needed_message")}function _(v,E,S){E.hasOwnProperty("comment")&&(E.comment===void 0&&(E.comment=""),S||(s.setItem("comment",E.comment),s.setItem("commentDate",Date.now()))),E.hasOwnProperty("source")&&(E.source===void 0?s.removeItem("source"):S||(s.setItem("source",E.source),s.setItem("commentDate",Date.now()))),k(E,S),u&&u.call(x)}function w(v,E){let S=I();S.length&&s.removeItem("hashtags"),(!S.length||!E)&&(S=S.concat(T()));let M=new Set;return S.filter(C=>{let P=C.toLowerCase();return M.has(P)?!1:(M.add(P),!0)});function I(){return(v.comment||"").replace(/http\S*/g,"").match(mk)||[]}function T(){return(v.hashtags||"").split(/[,;\s]+/).map(function(P){P[0]!=="#"&&(P="#"+P);let D=P.match(mk);return D&&D[0]}).filter(Boolean)||[]}}function A(v){let E=v.review_requested;return E===void 0?!1:(E=E.trim().toLowerCase(),!(E===""||E==="no"))}function k(v,E){let S=Object.assign({},n.changeset.tags);if(Object.keys(v).forEach(function(M){let I=v[M];M=i.cleanTagKey(M),pk.indexOf(M)===-1&&(I===void 0?delete S[M]:E?S[M]=I:S[M]=i.cleanTagValue(I))}),!E){let M=v.hasOwnProperty("comment")&&v.comment!=="",I=w(S,M);I.length?(S.hashtags=i.cleanTagValue(I.join(";")),s.setItem("hashtags",S.hashtags)):(delete S.hashtags,s.removeItem("hashtags"))}if(c&&c.changesets_count!==void 0){let M=parseInt(c.changesets_count,10)+1;if(S.changesets_count=String(M),M<=100){let I;I=s.getItem("walkthrough_completed"),I&&(S["ideditor:walkthrough_completed"]=I),I=s.getItem("walkthrough_progress"),I&&(S["ideditor:walkthrough_progress"]=I),I=s.getItem("walkthrough_started"),I&&(S["ideditor:walkthrough_started"]=I)}}else delete S.changesets_count;(0,gk.default)(n.changeset.tags,S)||(n.changeset=n.changeset.update({tags:S}))}return me(m,l,"on")}function Sa(i,e){let t=i.systems.l10n,r=Vt(e);r.select(".modal").classed("modal-alert",!0);let s=r.select(".content");s.append("div").attr("class","modal-section header"),s.append("div").attr("class","modal-section message-text");let n=s.append("div").attr("class","modal-section buttons cf");return r.okButton=function(){return n.append("button").attr("class","button ok-button action").on("click.confirm",()=>r.remove()).text(t.t("confirm.okay")).node().focus(),r},r}function A6(i){let e=i.systems.editor,t=i.systems.l10n,r=i.systems.map,s=ue("cancel","save"),n=He("conflicts"),o,a,l;function c(){G(document).call(n.on("\u238B",d,!0))}function u(){G(document).call(n.unbind)}function h(){u(),s.call("save")}function d(){u(),s.call("cancel")}function f(x){c();let b=x.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");b.append("button").attr("class","fr").on("click",d).call(V("#rapid-icon-close")),b.append("h3").html(t.tHtml("save.conflict.header"));let _=x.selectAll(".body").data([0]).enter().append("div").attr("class","body fillL"),w=_.append("div").attr("class","conflicts-help").html(t.tHtml("save.conflict.help")),A=ei(),k=new vr;delete k.id;let v=Gn.stringify(k.osmChangeJXON(o)),E=new Blob([v],{type:"text/xml;charset=utf-8;"}),S="changes.osc",M=w.selectAll(".download-changes").append("a").attr("class","download-changes");A.download?M.attr("href",window.URL.createObjectURL(E)).attr("download",S):M.attr("target","_blank").on("click.download",()=>navigator.msSaveBlob(E,S)),M.call(V("#rapid-icon-load","inline")).append("span").html(t.tHtml("save.conflict.download_changes")),_.append("div").attr("class","conflict-container fillL3").call(p,0),_.append("div").attr("class","conflicts-done").attr("opacity",0).style("display","none").html(t.tHtml("save.conflict.done"));let I=_.append("div").attr("class","buttons col12 joined conflicts-buttons");I.append("button").attr("disabled",a.length>1).attr("class","action conflicts-button col6").html(t.tHtml("save.title")).on("click.try_again",h),I.append("button").attr("class","secondary-action conflicts-button col6").html(t.tHtml("confirm.cancel")).on("click.cancel",d)}function p(x,b){b=n1(b,a.length),l=b;let _=G(x.node().parentNode);b===a.length-1&&window.setTimeout(()=>{_.select(".conflicts-button").attr("disabled",null),_.select(".conflicts-done").transition().attr("opacity",1).style("display","block")},250);let w=x.selectAll(".conflict").data([a[b]]);w.exit().remove();let A=w.enter().append("div").attr("class","conflict");A.append("h4").attr("class","conflict-count").html(t.tHtml("save.conflict.count",{num:b+1,total:a.length})),A.append("a").attr("class","conflict-description").attr("href","#").text(v=>v.name).on("click",(v,E)=>{v.preventDefault(),y(E.id)});let k=A.append("div").attr("class","conflict-detail-container");k.append("ul").attr("class","conflict-detail-list").selectAll("li").data(v=>v.details||[]).enter().append("li").attr("class","conflict-detail-item").html(v=>v),k.append("div").attr("class","conflict-choices").call(m),k.append("div").attr("class","conflict-nav-buttons joined cf").selectAll("button").data(["previous","next"]).enter().append("button").html(v=>t.tHtml(`save.conflict.${v}`)).attr("class","conflict-nav-button action col6").attr("disabled",(v,E)=>E===0&&b===0||E===1&&b===a.length-1||null).on("click",(v,E)=>{v.preventDefault();let S=_.selectAll(".conflict-container"),M=E==="previous"?-1:1;S.selectAll(".conflict").remove(),S.call(p,b+M)})}function m(x){let b=x.append("ul").attr("class","layer-list").selectAll("li").data(A=>A.choices||[]),_=b.enter().append("li").attr("class","layer"),w=_.append("label");w.append("input").attr("type","radio").attr("name",A=>A.id).on("change",function(A,k){let v=this.parentNode.parentNode.parentNode;v.__data__.chosen=k.id,g(A,v,k)}),w.append("span").text(A=>A.text),_.merge(b).each((A,k,v)=>{let E=v[k].parentNode;E.__data__.chosen===A.id&&g(null,E,A)})}function g(x,b,_){x&&x.preventDefault(),G(b).selectAll("li").classed("active",v=>v===_).selectAll("input").property("checked",v=>v===_);let w=new ie,A,k;A=e.staging.graph,k=A.hasEntity(_.id),k&&(w=w.extend(k.extent(A))),_.action(),A=e.staging.graph,k=A.hasEntity(_.id),k&&(w=w.extend(k.extent(A))),y(_.id,w)}function y(x,b){let w=e.staging.graph.hasEntity(x);w&&(b?r.trimmedExtent(b):r.fitEntitiesEase(w))}return f.conflictList=function(x){return arguments.length?(a=x,f):a},f.origChanges=function(x){return arguments.length?(o=x,f):o},f.shownEntityIds=function(){return a&&typeof l=="number"?[a[l].id]:[]},me(f,s,"on")}function S6(i){let e=i.systems.editor,t=i.systems.l10n,r=i.systems.map,s=i.services.osm;var n=wt(function(){c()},1e3),o=4,a=!1,l=G(null);function c(){if(!s)return;let u={};e.intersects(r.extent()).forEach(function(y){y&&y.user&&(u[y.user]=!0)});let d=Object.keys(u),f=d.slice(0,d.length>o?o-1:o);l.html("").call(V("#rapid-icon-nearby","pre-text light"));var p=G(document.createElement("span"));if(p.selectAll().data(f).enter().append("a").attr("class","user-link").attr("href",function(y){return s.userURL(y)}).attr("target","_blank").html(String),d.length>o){var m=G(document.createElement("span")),g=d.length-o+1;m.append("a").attr("target","_blank").attr("href",function(){return s.changesetsURL(r.center(),r.zoom())}).html(g),l.append("span").html(t.tHtml("contributors.truncated_list",{n:g,users:p.html(),count:m.html()}))}else l.append("span").html(t.tHtml("contributors.list",{users:p.html()}));d.length?a&&l.transition().style("opacity",1):(a=!0,l.transition().style("opacity",0))}return function(u){s&&(l=u,c(),s.on("loaded.contributors",n),r.on("draw",n))}}function C6(i){let e=i.systems.l10n,t;function r(s){let n=s.selectAll(".data-header").data(t?[t]:[],l=>l.__featurehash__);n.exit().remove();let o=n.enter().append("div").attr("class","data-header");o.append("div").attr("class","data-header-icon").append("div").attr("class","preset-icon-28").call(V("#rapid-icon-data")),o.append("div").attr("class","data-header-label").html(e.tHtml("map_data.layers.custom.title"))}return r.datum=function(s){return arguments.length?(t=s,this):t},r}function Vc(i){let e=i.systems.l10n,t=C6(i),r=Aa(i,"custom-data-tag-editor").readOnlyTags([/./]),s;function n(o){let l=o.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");l.append("button").attr("class","close").on("click",()=>i.enter("browse")).call(V("#rapid-icon-close")),l.append("h3").html(e.tHtml("map_data.title"));let c=o.selectAll(".body").data([0]);c=c.enter().append("div").attr("class","body").merge(c);let u=c.selectAll(".data-editor").data([0]);u.enter().append("div").attr("class","modal-section data-editor").merge(u).call(t.datum(s));let h=c.selectAll(".data-tag-editor").data([0]);h.enter().append("div").attr("class","data-tag-editor").merge(h).call(r.tags(s&&s.properties||{}).state("hover").render).selectAll("textarea.tag-text").attr("readonly",!0).classed("readonly",!0)}return n.datum=function(o){return arguments.length?(s=o,this):s},n}var Wc=class{constructor(e){this.context=e,this.parent=G(null),this.spritesheetIDs=["rapid","maki","temaki","fa","roentgen","community","mapillary-object","mapillary"],this.render=this.render.bind(this),this._spritesheetLoaded=this._spritesheetLoaded.bind(this)}render(e){let t=this.context;this.parent=e;let r=e.selectAll("defs").data([0]),s=r.enter().append("defs");r.merge(s).selectAll(".spritesheet").data(this.spritesheetIDs,n=>n).enter().append("g").attr("class",n=>`spritesheet spritesheet-${n}`).each((n,o,a)=>{let l=G(a[o]),c=t.asset(`img/${n}-sprite.svg`);fetch(c).then(Me).then(u=>l.call(this._spritesheetLoaded,n,u)).catch(u=>console.error(u))})}_spritesheetLoaded(e,t,r){var a;let s=e.node(),n=r.documentElement;n.setAttribute("id",t),s.appendChild(n),["maki","temaki","fa","roentgen","community"].includes(t)&&e.selectAll("path").attr("fill","currentColor");let o=(a=this.context.systems.map.renderer)==null?void 0:a.textures;if(!o)throw new Error(`TextureManager not ready to pack icons for ${t}`);e.selectAll("symbol").each((l,c,u)=>{let h=u[c],d=h.getAttribute("id"),f=h.getAttribute("viewBox"),p=32,g=`<svg xmlns="http://www.w3.org/2000/svg" height="${p}" width="${p}" color="#fff" viewBox="${f}">${h.innerHTML}</svg>`;o.addSvgIcon(d,g)})}};function k6(i){let e=ue("toggled"),t=i.systems.l10n,r=i.systems.map,s=i.systems.ui,n=85,o=45,a=35,l=10,c=4,u=210,h=G(null),d=[],f=new Map,p=[0,0],m=0,g="",y=!1,x,b,_=function(A){g===void 0&&(g="rightclick");let k=g.includes("touch")||g.includes("pen"),v=d.filter(R=>!k||!R.mouseOnly);if(!v.length)return;y=k;let E=!0,S=E?32:34;E?b=52+Math.min(120,6*Math.max.apply(Math,v.map(function(R){return R.title.length}))):b=44,x=c*2+v.length*S,m=i.projection.scale();let M=A.selectAll(".edit-menu").data([0]),I=M.enter().append("div").attr("class","edit-menu").classed("touch-menu",k).style("padding",c+"px 0");h=M.merge(I);let T=h.selectAll(".edit-menu-item").data(v,R=>R.id);T.exit().remove();let C=T.enter().append("button").attr("class",R=>`edit-menu-item edit-menu-item-${R.id}`).style("height",`${S}px`).on("click",O).on("pointerup",D).on("pointerdown mousedown",function(R){R.stopPropagation()}).on("mouseenter.highlight",function(R,N){!N.relatedEntityIds||G(this).classed("disabled")||Xe(N.relatedEntityIds(),!0,i)}).on("mouseleave.highlight",function(R,N){N.relatedEntityIds&&Xe(N.relatedEntityIds(),!1,i)});C.each((R,N,F)=>{let B=G(F[N]);B.append("div").attr("class","icon-wrap").call(V("","operation")),E&&B.append("span").attr("class","label");let $=he(i);f.set(R.id,$),B.call($)}),T=T.merge(C),T.each((R,N,F)=>{let B=G(F[N]);B.classed("disabled",U=>U.disabled()),B.selectAll(".icon-wrap use").attr("href",`#rapid-operation-${R.id}`),B.selectAll(".label").text(U=>U.title);let $=f.get(R.id);$&&$.heading(R.title).title(R.tooltip()).shortcut(R.keys[0])}),w(),r.off("move",w),r.on("move",w);let P;function D(R){P=R.pointerType}function O(R,N){R.stopPropagation(),N.relatedEntityIds&&Xe(N.relatedEntityIds(),!1,i),N.disabled()?(P==="touch"||P==="pen")&&s.flash.duration(4e3).iconName(`#rapid-operation-${N.id}`).iconClass("operation disabled").label(N.tooltip)():((P==="touch"||P==="pen")&&s.flash.duration(2e3).iconName(`#rapid-operation-${N.id}`).iconClass("operation").label(N.annotation()||N.title)(),N(),_.close()),P=null}e.call("toggled",this,!0)};function w(){if(!h||h.empty())return;if(m!==i.projection.scale()){_.close();return}let A=i.projection.project(p),k=i.surfaceRect();if(A[0]<0||A[0]>k.width||A[1]<0||A[1]>k.height){_.close();return}let v=T(k),E=[0,0];E[0]=v?-1*(l+b):l,y?A[1]-x<n?E[1]=-A[1]+n:E[1]=-x:A[1]+x>k.height-o?E[1]=-A[1]-x+k.height-o:E[1]=0;let[S,M]=dt(A,E);h.style("left",`${S}px`).style("top",`${M}px`);let I=C(k,v);for(let P of f.values())P.placement(I),P.isShown()&&P.updateContent();function T(P){return t.isRTL()?!(A[0]-l-b<a):A[0]+l+b>P.width-a}function C(P,D){return t.isRTL()?!D||A[0]-l-b-u<a?"right":"left":D||A[0]+l+b+u>P.width-a?"left":"right"}}return _.close=function(){r.off("move",w),h.remove(),f.clear(),e.call("toggled",this,!1)},_.anchorLoc=function(A){return arguments.length?(p=A,_):p},_.triggerType=function(A){return arguments.length?(g=A,_):g},_.operations=function(A){return arguments.length?(d=A,_):d},me(_,e,"on")}var Km=et(f1(),1);function T6(i){let e=i.systems.editor,t=i.systems.l10n,r=i.systems.map,s=i.systems.storage,n=i.systems.validator,a=(s.getItem("entity-issues.reference.expanded")||"true")==="true",l=[],c=[],u,h=Ge(i,"entity-issues").shouldDisplay(()=>c.length).label(()=>t.t("inspector.title_count",{title:t.t("issues.list_title"),count:c.length})).disclosureContent(p);function d(){c=n.getSharedEntityIssues(l,{includeDisabledRules:!0})}function f(y){u=y,h.selection().selectAll(".issue-container").classed("active",x=>x.id===u)}function p(y){y.classed("grouped-items-area",!0),u=c.length?c[0].id:null;let x=y.selectAll(".issue-container").data(c,I=>I.key);x.exit().remove();let b=x.enter().append("div").attr("class","issue-container"),_=b.append("div").attr("class",I=>`issue severity-${I.severity}`).on("mouseover.highlight",function(I,T){let C=T.entityIds.filter(P=>!l.includes(P));Xe(C,!0,i)}).on("mouseout.highlight",function(I,T){let C=T.entityIds.filter(P=>!l.includes(P));Xe(C,!1,i)}),w=_.append("div").attr("class","issue-label"),A=w.append("button").attr("class","issue-text").on("click",function(I,T){f(T.id);let C=e.staging.graph,P=T.extent(C);if(P){let D=Math.max(r.zoom(),19);r.centerZoomEase(P.center(),D)}});A.each((I,T,C)=>{let P=I.severity==="warning"?"alert":"error";G(C[T]).call(V(`#rapid-icon-${P}`,"issue-icon"))}),A.append("span").attr("class","issue-message"),w.append("button").attr("class","issue-info-button").attr("title",t.t("icons.information")).call(V("#rapid-icon-inspect")).on("click",function(I){I.stopPropagation(),I.preventDefault(),this.blur();let C=G(this.parentNode.parentNode.parentNode).selectAll(".issue-info"),P=C.classed("expanded");a=!P,s.setItem("entity-issues.reference.expanded",a),P?C.transition().duration(200).style("max-height","0px").style("opacity","0").on("end",()=>C.classed("expanded",!1)):C.classed("expanded",!0).transition().duration(200).style("max-height","200px").style("opacity","1").on("end",()=>C.style("max-height",null))}),_.append("ul").attr("class","issue-fix-list"),b.append("div").attr("class","issue-info"+(a?" expanded":"")).style("max-height",a?null:"0").style("opacity",a?"1":"0").each((I,T,C)=>{let P=G(C[T]);typeof I.reference=="function"?P.call(I.reference):P.text(t.t("inspector.no_documentation_key"))}),x=x.merge(b).classed("active",I=>I.id===u),x.selectAll(".issue-message").html(I=>I.message(i));let E=x.selectAll(".issue-fix-list").selectAll(".issue-fix-item").data(I=>I.fixes?I.fixes():[],I=>I.id);E.exit().remove();let S=E.enter().append("li").attr("class","issue-fix-item"),M=S.append("button").on("click",function(I,T){G(this).attr("disabled")||!T.onClick||T.issue.dateLastRanFix&&new Date-T.issue.dateLastRanFix<1e3||(T.issue.dateLastRanFix=new Date,Xe(T.issue.entityIds.concat(T.entityIds),!1,i),T.onClick())}).on("mouseover.highlight",(I,T)=>Xe(T.issue.entityIds,!0,i)).on("mouseout.highlight",(I,T)=>Xe(T.issue.entityIds,!1,i));M.each((I,T,C)=>{var D;let P=(D=I.icon)!=null?D:"rapid-icon-wrench";G(C[T]).call(V(`#${P}`,"fix-icon"))}),M.append("span").attr("class","fix-message").text(I=>I.title),S.merge(E).selectAll("button").classed("actionable",I=>typeof I.onClick=="function").attr("disabled",I=>typeof I.onClick=="function"?null:"true").attr("title",I=>{var T;return(T=I.disabledReason)!=null?T:null})}let m=()=>{d(),h.reRender()},g=y=>{f(y.id)};return n.off("validated",m),n.off("focusedIssue",g),n.on("validated",m),n.on("focusedIssue",g),h.entityIDs=function(y){return y===void 0?l:((!l||!y||!ai(l,y))&&(l=y,u=null,d()),h)},h}function Al(i){let e,t;function r(p,m){return p.icon?p.icon:m==="line"?"rapid-other-line":m==="vertex"?p.isFallback()?"":"temaki-vertex":"maki-marker-stroked"}function s(p,m){let y=new we(m.fill.color).toHex(),x=m.fill.alpha;p.append("svg").attr("class","preset-icon-category-border").attr("width","60px").attr("height","60px").attr("viewBox","0 0 60 60").append("path").attr("fill",y).attr("fill-opacity",x).attr("stroke",y).attr("d","M9.5,7.5 L25.5,7.5 L28.5,12.5 L49.5,12.5 C51.709139,12.5 53.5,14.290861 53.5,16.5 L53.5,43.5 C53.5,45.709139 51.709139,47.5 49.5,47.5 L10.5,47.5 C8.290861,47.5 6.5,45.709139 6.5,43.5 L6.5,12.5 L9.5,7.5 Z")}function n(p){p.append("svg").attr("class","preset-icon-point-border").attr("width","60px").attr("height","60px").attr("viewBox","-10 -27 20 30").append("path").attr("d","M 0,0 C -2,-2 -8,-10 -8,-15 C -8,-19 -4,-23 0,-23 C 4,-23 8,-19 8,-15 C 8,-10 2,-2 0,0 Z")}function o(p){p.append("svg").attr("class","preset-icon-vertex-border").attr("width","60px").attr("height","60px").attr("viewBox","0 0 60 60").append("circle").attr("cx",30).attr("cy",30).attr("r",40/2)}function a(p,m){let w=new we(m.fill.color).toHex(),A=m.fill.alpha,k=p.append("svg").attr("class","preset-icon-area-border").attr("width","60px").attr("height","60px").attr("viewBox","0 0 60 60");k.append("path").attr("fill",w).attr("fill-opacity",A).attr("stroke",w).attr("d","M10 10 L10 50 L50 50 L50 10 Z");let v=2.5;[[10,10],[10,50],[50,50],[50,10]].forEach(([S,M])=>{k.append("circle").attr("class","vertex").attr("cx",S).attr("cy",M).attr("r",v)});let E=1.25;[[10,30],[50,30],[30,10],[30,50]].forEach(([S,M])=>{k.append("circle").attr("class","midpoint").attr("cx",S).attr("cy",M).attr("r",E)})}function l(p,m){let y=Math.round(43.199999999999996),x=Math.round(60*.6),b=(60-x)/2,_=b+x,w=new we(m.casing.color).toHex(),A=new we(m.stroke.color).toHex(),k=m.stroke.dash,v=Array.isArray(k),E=p.append("svg").attr("class","preset-icon-line").attr("width","60px").attr("height","60px").attr("viewBox","0 0 60 60");E.append("path").attr("class","casing").attr("stroke",w).attr("stroke-opacity",v?1:.5).attr("d",`M${b} ${y} L${_} ${y}`),E.append("path").attr("class","stroke").attr("stroke",A).attr("stroke-dasharray",v?k.map(M=>M*.75).join(" "):null).attr("d",`M${b} ${y} L${_} ${y}`);let S=3;[[b-1,y],[_+1,y]].forEach(([M,I])=>{E.append("circle").attr("class","vertex").attr("cx",M).attr("cy",I).attr("r",S)})}function c(p){p.append("div").attr("class","preset-icon-route").call(V("#rapid-route","rapid-icon lowered"))}function u(p,m,g,y){p.append("div").attr("class","preset-icon").call(V(`#${m}`,g.join(" "))),p.selectAll(".preset-icon svg.icon").attr("color",y)}function h(p,m){p.selectAll("img.image-icon").data([m]).enter().append("img").attr("class","image-icon").attr("src",m).on("load",()=>p.classed("showing-img",!0)).on("error",()=>p.classed("showing-img",!1))}function d(p){var C;let m=p.selectAll(".preset-icon-container").data([0]);m=m.enter().append("div").attr("class","preset-icon-container").merge(m).html("");let g=e,y=t;if(!g||!y)return;let x=typeof g.setTags=="function",b=!x,_=x?g.setTags({},y):{};for(let P in _)_[P]==="*"&&(_[P]="yes");y==="relation"&&(_.type==="route"||_.type==="waterway")&&(y="route");let k=((C=i.systems.storage.getItem("preferences.privacy.thirdpartyicons"))!=null?C:"true")==="true"&&g.imageURL,v=r(g,y),E=x&&y==="vertex",S=x&&y==="line",M=x&&y==="area",I=x&&y==="route"&&g.id!=="type/route",T=i.systems.styles.styleMatch(_);if(m.classed("showing-img",!!k),b&&s(m,T),E&&o(m),M&&a(m,T),S&&l(m,T),I&&c(m),v){let P=S||I,D=b||S||I,O=/^rapid-/.test(v),R=[];O&&R.push("rapid-icon"),D&&R.push("shrunk"),P&&R.push("raised");let N="#333";(S||I)&&O&&(N=new we(T.stroke.color).toHex()),u(m,v,R,N)}k&&h(m,k)}f.preset=function(p){return arguments.length?(e=p,f):e},f.geometry=function(p){return arguments.length?(t=p,f):t};function f(p){p.call(d)}return f}function I6(i){let e=i.systems.editor,t=i.systems.l10n,r=ue("choose"),s=[],n=[],o,a=Ge(i,"feature-type").label(t.t("inspector.feature_type")).disclosureContent(l);function l(u){u.classed("preset-list-item",!0),u.classed("mixed-types",n.length>1);let h=u.selectAll(".preset-list-button-wrap").data([0]).enter().append("div").attr("class","preset-list-button-wrap"),d=h.append("button").attr("class","preset-list-button preset-reset").call(he(i).title(t.t("inspector.back_tooltip")).placement("bottom"));d.append("div").attr("class","preset-icon-container"),d.append("div").attr("class","label").append("div").attr("class","label-inner"),h.append("div").attr("class","accessory-buttons");let f=u.selectAll(".tag-reference-body-wrap").data([0]);f=f.enter().append("div").attr("class","tag-reference-body-wrap").merge(f),o&&(u.selectAll(".preset-list-button-wrap .accessory-buttons").style("display",n.length===1?null:"none").call(o.button),f.style("display",n.length===1?null:"none").call(o.body)),u.selectAll(".preset-reset").on("click",function(){r.call("choose",this,n)}).on("pointerdown pointerup mousedown mouseup",function(x){x.preventDefault(),x.stopPropagation()});let p=c();u.select(".preset-list-item button").call(Al(i).geometry(n.length===1?p.length===1&&p[0]:null).preset(n.length===1?n[0]:i.systems.presets.item("point")));let m=n.length===1?[n[0].nameLabel(),n[0].subtitleLabel()].filter(Boolean):[t.t("inspector.multiple_types")],y=u.select(".label-inner").selectAll(".namepart").data(m,x=>x);y.exit().remove(),y.enter().append("div").attr("class","namepart").html(x=>x)}a.entityIDs=function(u){return arguments.length?(s=u,a):s},a.presets=function(u){return arguments.length?(ai(u,n)||(n=u,n.length===1&&(o=Hn(i,n[0].reference()).showing(!1))),a):n};function c(){let u={},h=e.staging.graph;for(let d of s){let f=h.geometry(d);u[f]||(u[f]=0),u[f]+=1}return Object.keys(u).sort((d,f)=>u[f]-u[d])}return me(a,r,"on")}function M6(i){let e=i.systems.editor,t=i.systems.l10n,r=i.systems.presets,s=Ge(i,"preset-fields").label(t.t("inspector.fields")).disclosureContent(d),n=ue("change","revert"),o=zc(i),a,l,c=[],u,h;function d(f){if(!l){let p=e.staging.graph,m=Object.keys(h.reduce((v,E)=>(v[p.entity(E).geometry(p)]=!0,v),{})),g=[],y=[],x;for(let v of c){let E=v.fields(),S=v.moreFields();g=Gt(g,E),y=Gt(y,S),x?x=x.filter(M=>E.includes(M)||S.includes(M)):x=Gt(E,S)}let b=g.filter(v=>x.includes(v)),_=y.filter(v=>x.includes(v));l=[];for(let v of b)v.matchAllGeometry(m)&&l.push(new zr(i,v,h));let w=i.systems.l10n.localeCode(),A=Gt(_,r.universal());A.sort((v,E)=>v.label().localeCompare(E.label(),w));for(let v of A)!b.includes(v)&&v.matchAllGeometry(m)&&l.push(new zr(i,v,h,{show:!1}));let k=h.slice();for(let v of l)v.on("change",(E,S)=>{n.call("change",v,k,E,S)}),v.on("revert",E=>{n.call("revert",v,E)})}for(let p of l)p.state(a).tags(u);f.call(o.fieldsArr(l).state(a).klass("grouped-items-area")),f.selectAll(".wrap-form-field input").on("keydown",function(p){p.keyCode===13&&i.container().select(".combobox").empty()&&i.enter("browse")})}return s.presets=function(f){return arguments.length?((!c||!f||!ai(c,f))&&(c=f,l=null),s):c},s.state=function(f){return arguments.length?(a=f,s):a},s.tags=function(f){return arguments.length?(u=f,s):u},s.entityIDs=function(f){return arguments.length?((!f||!h||!ai(h,f))&&(h=f,l=null),s):h},me(s,n,"on")}var Qm=1e3;function P6(i){let e=i.systems.editor,t=i.systems.l10n,r=i.systems.map,s=i.systems.presets,n=i.services.taginfo,o=[],a=Ge(i,"raw-member-editor").shouldDisplay(function(){if(!o||o.length!==1)return!1;let x=e.staging.graph.hasEntity(o[0]);return(x==null?void 0:x.type)==="relation"}).label(function(){let x=e.staging.graph.hasEntity(o[0]);if(!x)return"";let _=(x.members.length>Qm?">":"")+x.members.slice(0,Qm).length;return t.t("inspector.title_count",{title:t.t("inspector.members"),count:_})}).disclosureContent(f);function l(y,x){y.preventDefault(),G(this.parentNode).classed("tag-reference-loading",!0),i.loadEntity(x.id,function(){a.reRender()})}function c(y,x){y.preventDefault();let _=e.staging.graph.entity(x.id);r.fitEntitiesEase(_),Xe([x.id],!0,i)}function u(y,x){y.preventDefault(),Xe([x.id],!1,i);let b=e.staging.graph,_=b.entity(x.id),w=r.extent();_.intersects(w,b)||r.fitEntitiesEase(_),i.enter("select-osm",{selection:{osm:[x.id]}})}function h(y,x){let b=x.role,_=i.cleanRelationRole(G(this).property("value"));if(b!==_){let w={id:x.id,type:x.type,role:_};e.perform(Vo(x.relation.id,w,x.index)),e.commit({annotation:t.t("operations.change_role.annotation",{n:1}),selectedIDs:[x.relation.id]})}}function d(y,x){Xe([x.id],!1,i),e.perform(Wo(x.relation.id,x.index)),e.commit({annotation:t.t("operations.delete_member.annotation",{n:1}),selectedIDs:[x.relation.id]}),e.staging.graph.hasEntity(x.relation.id)||i.enter("browse")}function f(y){let x=e.staging.graph,b=o[0],_=x.entity(b),w=[];_.members.slice(0,Qm).forEach((T,C)=>{w.push({index:C,id:T.id,type:T.type,role:T.role,relation:_,member:x.hasEntity(T.id),uid:us(`${b}-member-${C}`)})});let A=y.selectAll(".member-list").data([0]);A=A.enter().append("ul").attr("class","member-list").merge(A);let k=A.selectAll("li").data(w,T=>{let C=de.key(T.relation),P=T.member&&de.key(T.member)||"incomplete";return`${C},${T.index},${P}`});k.exit().each(g).remove();let v=k.enter().append("li").attr("class","member-row form-field").classed("member-incomplete",T=>!T.member);v.each((T,C,P)=>{let D=G(P[C]),O=D.append("label").attr("class","field-label").attr("for",T.uid);if(T.member){D.on("mouseover",()=>Xe([T.id],!0,i)).on("mouseout",()=>Xe([T.id],!1,i));let R=O.append("span").attr("class","label-text").append("a").attr("href","#").on("click",u);R.append("span").attr("class","member-entity-type").html(N=>{let F=s.match(N.member,e.staging.graph);return F&&F.name()||t.displayType(N.member.id)}),R.append("span").attr("class","member-entity-name").classed("has-color",N=>!!p(N.member)).style("border-color",N=>p(N.member)).text(N=>N.member?t.displayName(N.member.tags):""),O.append("button").attr("title",t.t("icons.remove")).attr("class","remove member-delete").call(V("#rapid-operation-delete")),O.append("button").attr("class","member-zoom").attr("title",t.t("icons.zoom_to")).call(V("#rapid-icon-framed-dot","monochrome")).on("click",c)}else{let R=O.append("span").attr("class","label-text");R.append("span").attr("class","member-entity-type").text(t.t(`inspector.${T.type}`,{id:T.id})),R.append("span").attr("class","member-entity-name").text(t.t("inspector.incomplete",{id:T.id})),O.append("button").attr("class","member-download").attr("title",t.t("icons.download")).call(V("#rapid-icon-load")).on("click",l)}});let E=v.append("div").attr("class","form-field-input-wrap form-field-input-member");E.append("input").attr("class","member-role").attr("id",T=>T.uid).property("type","text").attr("placeholder",t.t("inspector.role")).call(Re),n&&E.each(m),k=k.merge(v).order(),k.select("input.member-role").property("value",T=>T.role).on("blur",h).on("change",h),k.select("button.member-delete").on("click",d);let S,M,I;k.call(L0().on("start",function(T){S=T.x,M=T.y,I=null}).on("drag",function(T){let[C,P]=[T.x,T.y],[D,O]=Ze([C,P],[S,M]);if(!G(this).classed("dragging")&&Ue([D,O])<=5)return;let R=k.nodes().indexOf(this);G(this).classed("dragging",!0),I=null,y.selectAll("li.member-row").style("transform",function(N,F){let B=G(this).node();return R===F?`translate(${D}px, ${O}px)`:F>R&&P>B.offsetTop?((I===null||F>I)&&(I=F),"translateY(-100%)"):F<R&&P<B.offsetTop+B.offsetHeight?((I===null||F<I)&&(I=F),"translateY(100%)"):null})}).on("end",function(T,C){if(!G(this).classed("dragging"))return;let P=k.nodes().indexOf(this);G(this).classed("dragging",!1),y.selectAll("li.member-row").style("transform",null),I!==null&&(e.perform(L5(C.relation.id,P,I)),e.commit({annotation:t.t("operations.reorder_members.annotation"),selectedIDs:[C.relation.id]}))}))}a.entityIDs=function(y){return arguments.length?(o=y||[],a):o};function p(y){let x=(y==null?void 0:y.type)==="relation"&&(y==null?void 0:y.tags.colour);return x&&zo(x)?x:null}function m(y,x,b){let w=G(b[x]).selectAll("input.member-role"),A=w.property("value");function k(v,E){let S=[],M=[];for(let I of E)I.value.substring(0,v.length)===v?S.push(I):M.push(I);return S.concat(M)}w.call(st(i,"member-role").fetcher(function(v,E){let S;y.member?S=e.staging.graph.geometry(y.member.id):y.type==="relation"?S="relation":y.type==="way"?S="line":S="point",n.roles({debounce:!0,rtype:y.relation.tags.type||"",geometry:S,query:v},(M,I)=>{M||E(k(v,I))})}).on("cancel",()=>{w.property("value",A)}))}function g(y,x,b){G(b[x]).selectAll("input.member-role").call(st.off,i)}return a}function yk(i,e){return function(t){e.sort((s,n)=>n-s);for(var r in e)t=Wo(i,e[r])(t);return t}}var Ym=1e3;function D6(i){let e=i.systems.editor,t=i.systems.l10n,r=i.systems.map,s=i.systems.presets,n=i.services.taginfo;var o=Ge(i,"raw-membership-editor").shouldDisplay(function(){return c&&c.length}).label(function(){var w=h(),A=w.length>Ym?">":"",k=A+w.slice(0,Ym).length;return t.t("inspector.title_count",{title:t.t("inspector.relations"),count:k})}).disclosureContent(_),a=st(i,"parent-relation").minItems(1).fetcher(b).itemsMouseEnter(function(w,A){A.relation&&Xe([A.relation.id],!0,i)}).itemsMouseLeave(function(w,A){A.relation&&Xe([A.relation.id],!1,i)}),l=!1,c=[],u;function h(){for(var w=[],A=0;A<c.length;A++){var k=e.staging.graph.hasEntity(c[A]);if(k&&(A===0?w=e.staging.graph.parentRelations(k):w=Vi(w,e.staging.graph.parentRelations(k)),!w.length))break}return w}function d(){var w=[],A=h().slice(0,Ym),k=c.length>1,v,E,S,M,I,T;for(v=0;v<A.length;v++){for(E=A[v],S={relation:E,members:[],hash:de.key(E)},M=0;M<E.members.length;M++)I=E.members[M],c.indexOf(I.id)!==-1&&(T=Object.assign({},I,{index:M}),S.members.push(T),S.hash+=","+M.toString(),k||(w.push(S),S={relation:E,members:[],hash:de.key(E)}));S.members.length&&w.push(S)}return w.forEach(function(C){C.uid=us("membership-"+C.relation.id);var P=[];C.members.forEach(function(D){P.indexOf(D.role)===-1&&P.push(D.role)}),C.role=P.length===1?P[0]:P}),w}function f(w,A){w.preventDefault(),Xe([A.relation.id],!1,i),i.enter("select-osm",{selection:{osm:[A.relation.id]}})}function p(w,A){w.preventDefault();let v=e.staging.graph.entity(A.relation.id);r.fitEntitiesEase(v),Xe([A.relation.id],!0,i)}function m(w){let A=(w==null?void 0:w.type)==="relation"&&(w==null?void 0:w.tags.colour);return A&&zo(A)?A:null}function g(w,A){if(A!==0&&!l){var k=i.cleanRelationRole(G(this).property("value"));if(!(!k.trim()&&typeof A.role!="string")){var v=A.members.filter(function(E){return E.role!==k});if(v.length){l=!0;let E=S=>{for(let M of v){let I=Object.assign({},M,{role:k});delete I.index,S=Vo(A.relation.id,I,M.index)(S)}return S};e.perform(E),e.commit({annotation:t.t("operations.change_role.annotation",{n:v.length}),selectedIDs:[A.relation.id]})}l=!1}}}function y(w,A){this.blur(),u=!1;function k(E,S,M){return function(I){for(var T in S){var C={id:S[T],type:I.entity(S[T]).type,role:M};I=Ua(E,C)(I)}return I}}if(w.relation)e.perform(k(w.relation.id,c,A)),e.commit({annotation:t.t("operations.add_member.annotation",{n:c.length}),selectedIDs:[w.relation.id]});else{var v=Qt();e.perform(Mt(v),k(v.id,c,A)),e.commit({annotation:t.t("operations.add.annotation.relation"),selectedIDs:[v.id]}),i.enter("select-osm",{selection:{osm:[v.id]},newFeature:!0})}}function x(w,A){if(this.blur(),A!==0){Xe([A.relation.id],!1,i);var k=A.members.map(function(v){return v.index});e.perform(yk(A.relation.id,k)),e.commit({annotation:t.t("operations.delete_member.annotation",{n:c.length}),selectedIDs:[A.relation.id]})}}function b(w,A){var k={relation:null,value:t.t("inspector.new_relation"),display:t.t("inspector.new_relation")},v=c[0],E=[],S=e.staging.graph;function M(P){var D=s.match(P,S),O=D&&D.name()||t.t("inspector.relation"),R=t.displayName(P.tags)||"";return O+" "+R}function I(P){var D=s.match(P,S),O=D&&D.name()||t.t("inspector.relation"),R=t.displayName(P.tags)||"",N=m(P);return F=>{F.append("b").text(O+" "),F.append("span").classed("has-color",!!N).style("border-color",N).text(R)}}var T=w&&S.hasEntity(w.toLowerCase());if(T&&T.type==="relation"&&T.id!==v)E.push({relation:T,value:M(T)+" "+T.id,display:I(T)});else{e.intersects(r.extent()).forEach(function(P){if(!(P.type!=="relation"||P.id===v)){var D=M(P);w&&(D+" "+P.id).toLowerCase().indexOf(w.toLowerCase())===-1||E.push({relation:P,value:D,display:I(P)})}}),E.sort(function(P,D){return Qt.creationOrder(P.relation,D.relation)});var C=Object.values(Ut(E,"value")).filter(function(P){return P.length>1});C.forEach(function(P){P.forEach(function(D){D.value+=" "+D.relation.id})})}E.forEach(function(P){P.title=P.value}),E.unshift(k),A(E)}function _(w){var A=d(),k=w.selectAll(".member-list").data([0]);k=k.enter().append("ul").attr("class","member-list").merge(k);var v=k.selectAll("li.member-row-normal").data(A,function(H){return H.hash});v.exit().each(U).remove();var E=v.enter().append("li").attr("class","member-row member-row-normal form-field");E.on("mouseover",function(H,z){Xe([z.relation.id],!0,i)}).on("mouseout",function(H,z){Xe([z.relation.id],!1,i)});var S=E.append("label").attr("class","field-label").attr("for",function(H){return H.uid}),M=S.append("span").attr("class","label-text").append("a").attr("href","#").on("click",f);M.append("span").attr("class","member-entity-type").html(function(H){let z=s.match(H.relation,e.staging.graph);return z&&z.name()||t.t("inspector.relation")}),M.append("span").attr("class","member-entity-name").classed("has-color",H=>!!m(H.relation)).style("border-color",H=>m(H.relation)).text(function(H){let z=s.match(H.relation,e.staging.graph);return t.displayName(H.relation.tags,z.suggestion)}),S.append("button").attr("class","remove member-delete").call(V("#rapid-operation-delete")).on("click",x),S.append("button").attr("class","member-zoom").attr("title",t.t("icons.zoom_to")).call(V("#rapid-icon-framed-dot","monochrome")).on("click",p);var I=E.append("div").attr("class","form-field-input-wrap form-field-input-member");I.append("input").attr("class","member-role").attr("id",function(H){return H.uid}).property("type","text").property("value",function(H){return typeof H.role=="string"?H.role:""}).attr("title",function(H){return Array.isArray(H.role)?H.role.filter(Boolean).join(`
`):H.role}).attr("placeholder",function(H){return Array.isArray(H.role)?t.t("inspector.multiple_roles"):t.t("inspector.role")}).classed("mixed",function(H){return Array.isArray(H.role)}).call(Re).on("blur",g).on("change",g),n&&I.each($);var T=k.selectAll(".member-row-new").data(u?[0]:[]);T.exit().remove();var C=T.enter().append("li").attr("class","member-row member-row-new form-field"),P=C.append("label").attr("class","field-label");P.append("input").attr("placeholder",t.t("inspector.choose_relation")).attr("type","text").attr("class","member-entity-input").call(Re),P.append("button").attr("class","remove member-delete").call(V("#rapid-operation-delete")).on("click",function(){k.selectAll(".member-row-new").remove()});var D=C.append("div").attr("class","form-field-input-wrap form-field-input-member");D.append("input").attr("class","member-role").property("type","text").attr("placeholder",t.t("inspector.role")).call(Re),T=T.merge(C),T.selectAll(".member-entity-input").on("blur",B).call(a.on("accept",F).on("cancel",B));var O=w.selectAll(".add-row").data([0]),R=O.enter().append("div").attr("class","add-row"),N=R.append("button").attr("class","add-relation");N.call(V("#rapid-icon-plus","light")),N.call(he(i).title(t.t("inspector.add_to_relation")).placement(t.isRTL()?"left":"right")),R.append("div").attr("class","space-value"),R.append("div").attr("class","space-buttons"),O=O.merge(R),O.select(".add-relation").on("click",function(){u=!0,o.reRender(),k.selectAll(".member-entity-input").node().focus()});function F(H){if(!H){B();return}H.relation&&Xe([H.relation.id],!1,i);var z=i.cleanRelationRole(k.selectAll(".member-row-new .member-role").property("value"));y(H,z)}function B(){var H=T.selectAll(".member-entity-input");H.property("value",""),i.surface().selectAll(".highlighted").classed("highlighted",!1)}function $(H){var z=G(this),j=z.selectAll("input.member-role"),X=j.property("value");function K(Y,oe){for(var re=[],W=[],Z=0;Z<oe.length;Z++)oe[Z].value.substring(0,Y.length)===Y?re.push(oe[Z]):W.push(oe[Z]);return re.concat(W)}j.call(st(i,"member-role").fetcher(function(Y,oe){var re=H.relation.tags.type;n.roles({debounce:!0,rtype:re||"",geometry:e.staging.graph.geometry(c[0]),query:Y},function(W,Z){W||oe(K(Y,Z))})}).on("cancel",function(){j.property("value",X)}))}function U(){var H=G(this);H.selectAll("input.member-role").call(st.off,i)}}return o.entityIDs=function(w){return arguments.length?(c=w,u=!1,o):c},o}function R6(i){let e=i.systems.editor,t=i.systems.l10n,r=i.systems.presets,s=[],n=Ge(i,"selected-features").shouldDisplay(o).label(a).disclosureContent(u);n.entityIDs=function(h){return arguments.length?(s=h,n):s};function o(){return s.length>1}function a(){return t.t("inspector.title_count",{title:t.t("inspector.features"),count:s.length})}function l(h,d){i.enter("select-osm",{selection:{osm:[d.id]}})}function c(h,d){let f=s.slice(),p=f.indexOf(d.id);p>-1&&(f.splice(p,1),i.enter("select-osm",{selection:{osm:f}}))}function u(h){let d=e.staging.graph,f=h.selectAll(".feature-list").data([0]);f=f.enter().append("ul").attr("class","feature-list").merge(f);let p=s.map(x=>d.hasEntity(x)).filter(Boolean),m=f.selectAll(".feature-list-item").data(p,de.key);m.exit().remove();let g=m.enter().append("li").attr("class","feature-list-item").each((x,b,_)=>{G(_[b]).on("mouseover",()=>Xe([x.id],!0,i)).on("mouseout",()=>Xe([x.id],!1,i))}),y=g.append("button").attr("class","label").on("click",l);y.append("span").attr("class","entity-geom-icon").call(V("","pre-text")),y.append("span").attr("class","entity-type"),y.append("span").attr("class","entity-name"),g.append("button").attr("class","close").attr("title",t.t("icons.deselect")).on("click",c).call(V("#rapid-icon-close")),m=m.merge(g),m.selectAll(".entity-geom-icon use").attr("href",(x,b,_)=>"#rapid-icon-"+G(_[b])._groups[0][0].parentNode.parentNode.__data__.geometry(d)),m.selectAll(".entity-type").html(x=>r.match(x,d).name()),m.selectAll(".entity-name").html(x=>{let b=d.entity(x.id);return t.displayName(b.tags)})}return e.on("stablechange",()=>n.reRender()),n}var N6=[],xk=new Set(["crossing","crossing_ref","crossing:continuous","crossing:island","crossing:markings","crossing:signals"]);function F6(i){let e=i.systems.editor,t=i.systems.l10n,r=i.systems.presets,s=ue("choose"),n=[R6(i),I6(i).on("choose",function(_){s.call("choose",this,_)}),T6(i),M6(i).on("change",g).on("revert",y),Aa(i,"raw-tag-editor").on("change",m),P6(i),D6(i)],o=null,a="select",l=!1,c,u=[],h=[],d;e.off("stagingchange",p),e.on("stagingchange",p);function f(_){o=_;let w=b(u,e.staging.graph),A=t.isRTL(),k=_.selectAll(".header").data([0]),v=k.enter().append("div").attr("class","header fillL");v.append("button").attr("class","preset-reset preset-choose").call(V(A?"#rapid-icon-forward":"#rapid-icon-backward")),v.append("button").attr("class","close").on("click",()=>i.enter("browse")).call(V(l?"#rapid-icon-apply":"#rapid-icon-close")),v.append("h3"),k=k.merge(v),k.selectAll("h3").html(u.length===1?t.tHtml("inspector.edit"):t.tHtml("rapid_multiselect")),k.selectAll(".preset-reset").on("click",function(){s.call("choose",this,h)});let E=_.selectAll(".inspector-body").data([0]),S=E.enter().append("div").attr("class","entity-editor inspector-body");E=E.merge(S);for(let M of n)M.entityIDs&&M.entityIDs(u),M.presets&&M.presets(h),M.tags&&M.tags(w),M.state&&M.state(a),E.call(M.render)}f.modified=function(_){return arguments.length?(l=_,f):l},f.state=function(_){return arguments.length?(a=_,f):a},f.entityIDs=function(_){if(!arguments.length)return u;if(c=e.staging.graph,_&&u&&ai(u,_))return f;if(u=_,x(!0),o){let w=o.selectAll(".inspector-body").node();w&&w.scroll(0,0)}return f.modified(!1)},f.newFeature=function(_){return arguments.length?(d=_,f):d},f.presets=function(_){return arguments.length?(ai(_,h)||(h=_),f):h};function p(_){if(!_||!o||o.selectAll(".entity-editor").empty()||a==="hide"||!(_.didChange.properties||_.didChange.addition||_.didChange.deletion))return;let A=e.staging.graph;if(u=u.filter(E=>A.hasEntity(E)),!u.length)return;let k=h.length===1&&h[0];x();let v=h.length===1&&h[0];f.modified(c!==A),o.call(f),k!==v&&i.container().selectAll(".entity-editor button.preset-reset .label").style("background-color","#fff").transition().duration(750).style("background-color",null)}function m(_,w,A){g(_,w,A,!0)}function g(_,w,A,k=!1){let v=ai(u,N6);N6=u.slice(),e.beginTransaction();for(let E of u){let M=e.staging.graph.hasEntity(E);if(!M)continue;let I=Object.assign({},M.tags),T=!1;for(let[C,P]of Object.entries(w)){if(!C)continue;xk.has(C)&&(T=!0);let D=M.tags.source;M.__fbid__&&C==="source"&&(D==="digitalglobe"||D==="maxar")||(P!==void 0||I.hasOwnProperty(C))&&(I[C]=P)}A||(I=d7(I)),(0,Km.default)(M.tags,I)||(e.perform(vt(E,I)),!k&&T&&e.perform(Vs(E)))}if(!A){let E=t.t("operations.change_tags.annotation"),S={annotation:E,selectedIDs:u};v&&e.getUndoAnnotation()===E?e.commitAppend(S):e.commit(S)}e.endTransaction()}function y(_){var E;let w=ai(u,N6);N6=u.slice();let A=e.base.graph;e.beginTransaction();for(let S of u){let M=e.staging.graph,I=A.hasEntity(S),T=M.entity(S),C=Object.assign({},T.tags),P={};for(let O of _)P[O]=(E=I==null?void 0:I.tags[O])!=null?E:void 0;let D=!1;for(let[O,R]of Object.entries(P))O&&(xk.has(O)&&(D=!0),(R!==void 0||C.hasOwnProperty(O))&&(C[O]=R));C=d7(C),(0,Km.default)(T.tags,C)||(e.perform(vt(S,C)),D&&e.perform(Vs(S)))}let k=t.t("operations.change_tags.annotation"),v={annotation:k,selectedIDs:u};w&&e.getUndoAnnotation()===k?e.commitAppend(v):e.commit(v),e.endTransaction()}function x(_){let w=e.staging.graph,A={};for(let v of u){let E=w.hasEntity(v);if(!E)return;let S=r.match(E,w);A[S.id]=(A[S.id]||0)+1}let k=Object.keys(A).sort((v,E)=>A[E]-A[v]).map(v=>r.item(v));!_&&h.length===1&&!h[0].isFallback()&&Object.keys(h[0].addTags||{}).length===0&&k.length===1&&k[0].isFallback()||f.presets(k)}function b(_,w){var S;let A={},k={},v=_.map(M=>w.hasEntity(M)).filter(Boolean),E=new Set;for(let M of v)for(let I of Object.keys(M.tags))I&&E.add(I);for(let M of v)for(let I of E){let T=M.tags[I],C=A[I];C?Array.isArray(C)?C.includes(T)||C.push(T):C!==T&&(A[I]=[C,T]):A[I]=T;let P=`${I}=${T}`;k[P]=((S=k[P])!=null?S:0)+1}for(let[M,I]of Object.entries(A))Array.isArray(I)&&I.sort((T,C)=>{var O,R;let P=(O=k[`${M}=${T}`])!=null?O:0,D=(R=k[`${M}=${C}`])!=null?R:0;return D!==P?D-P:C&&T?T.localeCompare(C):T?1:-1});return A}return me(f,s,"on")}function vk(i){let e=i.systems.l10n,t=i.systems.filters,r=i.systems.ui;function s(n){let o=t.stats(),a=t.hidden(),l=0,c=Array.from(a).map(u=>o[u]?(l+=o[u],e.t("inspector.title_count",{title:e.tHtml(`feature.${u}.description`),count:o[u]})):null).filter(Boolean);if(n.html(""),c.length){let u=he(i).placement("top").title(()=>c.join("<br/>"));n.append("a").attr("class","chip").attr("href","#").html(e.tHtml("feature_info.hidden_warning",{count:l})).call(u).on("click",h=>{u.hide(),h.preventDefault(),r.togglePanes(i.container().select(".map-panes .map-data-pane"))})}n.classed("hide",!c.length)}return function(n){s(n),t.on("filterchange",()=>s(n))}}var wk=et(bk(),1);function L6(i){let e=i.systems.editor,t=i.systems.l10n,r=i.systems.map,s=i.services.nominatim,n=i.systems.presets,o;function a(l){l.append("div").attr("class","header fillL").append("h3").html(t.tHtml("inspector.feature_list"));let u=l.append("div").attr("class","search-header");u.call(V("#rapid-icon-search","pre-text"));let h=u.append("input").attr("placeholder",t.t("inspector.search")).attr("type","search").call(Re).on("keypress",g).on("keydown",m).on("input",y),f=l.append("div").attr("class","inspector-body").append("div").attr("class","feature-list");i.on("modechange",x),i.keybinding().on(Ie("\u2318F"),p);function p(S){var M;((M=i.mode)==null?void 0:M.id)==="browse"&&(S.preventDefault(),h.node().focus())}function m(S){S.keyCode===27&&h.node().blur()}function g(S){let M=h.property("value"),I=f.selectAll(".feature-list-item");S.keyCode===13&&M.length&&I.size()&&v(S,I.datum())}function y(){o=void 0,_()}function x(){h.property("value",""),_()}function b(){let S=e.staging.graph,M=r.centerLoc(),I=h.property("value").toLowerCase(),T=[];if(!I)return T;let C=wk.pair(I.toUpperCase())||I.match(/^(-?\d+\.?\d*)\s+(-?\d+\.?\d*)$/);if(C){let F=[parseFloat(C[0]),parseFloat(C[1])];T.push({id:-1,geometry:"point",type:t.t("inspector.location"),name:t.dmsCoordinatePair([F[1],F[0]]),location:F})}let P=!C&&I.match(/(?:^|\W)(node|way|relation|[nwr])\W?0*([1-9]\d*)(?:\W|$)/i);if(P){let F=P[1].charAt(0),B=P[2];T.push({id:F+B,geometry:F==="n"?"point":F==="w"?"line":"relation",type:t.displayType(F),name:B})}let D=S.base.entities,O=S.local.entities,R=new Set([...D.keys(),...O.keys()]),N=[];for(let F of R){if(O.has(F)&&O.get(F)===void 0)continue;let B=S.hasEntity(F);if(!B)continue;let $=t.displayName(B.tags)||"";if($.toLowerCase().indexOf(I)<0)continue;let U=n.match(B,S),H=U&&U.name()||t.displayType(B.id),z=B.extent(S),j=z?at(M,z.center()):0;if(N.push({id:B.id,entity:B,geometry:B.geometry(S),type:H,name:$,distance:j}),N.length>100)break}N=N.sort((F,B)=>F.distance-B.distance),T=T.concat(N);for(let F of o||[]){if(!F.osm_type||!F.osm_id)continue;let B=de.id.fromOSM(F.osm_type,F.osm_id),$={};$[F.class]=F.type;let U={id:B,type:F.osm_type,tags:$};F.osm_type==="way"&&(U.nodes=["a","a"]);let H=de(U),z=new di([H]),j=n.match(H,z),X=j&&j.name()||t.displayType(B);T.push({id:H.id,geometry:H.geometry(z),type:X,name:F.display_name,extent:new ie([parseFloat(F.boundingbox[3]),parseFloat(F.boundingbox[0])],[parseFloat(F.boundingbox[2]),parseFloat(F.boundingbox[1])])})}return I.match(/^[0-9]+$/)&&(T.push({id:"n"+I,geometry:"point",type:t.t("inspector.node"),name:I}),T.push({id:"w"+I,geometry:"line",type:t.t("inspector.way"),name:I}),T.push({id:"r"+I,geometry:"relation",type:t.t("inspector.relation"),name:I})),T}function _(){let S=h.property("value"),M=b();f.classed("filtered",S.length),f.selectAll(".no-results-item").data([0]).enter().append("button").property("disabled",!0).attr("class","no-results-item").call(V("#rapid-icon-alert","pre-text")).append("span").attr("class","entity-name"),f.selectAll(".no-results-item .entity-name").html(t.tHtml("geocoder.no_results_worldwide")),s&&f.selectAll(".geocode-item").data([0]).enter().append("button").attr("class","geocode-item secondary-action").on("click",E).append("div").attr("class","label").append("span").attr("class","entity-name").html(t.tHtml("geocoder.search")),f.selectAll(".no-results-item").style("display",S.length&&!M.length?"block":"none"),f.selectAll(".geocode-item").style("display",S&&o===void 0?"block":"none"),f.selectAll(".feature-list-item").data([-1]).remove();let T=f.selectAll(".feature-list-item").data(M,D=>D.id),C=T.enter().insert("button",".geocode-item").attr("class","feature-list-item").on("mouseover",A).on("mouseout",k).on("click",v),P=C.append("div").attr("class","label");P.each((D,O,R)=>{G(R[O]).call(V(`#rapid-icon-${D.geometry}`,"pre-text"))}),P.append("span").attr("class","entity-type").text(D=>D.type),P.append("span").attr("class","entity-name").classed("has-color",D=>!!w(D.entity)).style("border-color",D=>w(D.entity)).text(D=>D.name),C.style("opacity",0).transition().style("opacity",1),T.order(),T.exit().remove()}function w(S){let M=(S==null?void 0:S.type)==="relation"&&(S==null?void 0:S.tags.colour);return M&&zo(M)?M:null}function A(S,M){!M.id||M.id===-1||Xe([M.id],!0,i)}function k(S,M){!M.id||M.id===-1||Xe([M.id],!1,i)}function v(S,M){S.preventDefault(),M.location?r.centerZoomEase([M.location[1],M.location[0]],19):M.id!==-1&&(Xe([M.id],!1,i),r.selectEntityID(M.id,!0))}function E(){s.search(h.property("value"),(S,M)=>{o=M||[],_()})}}return a}function qc(i){var e,t=2e3,r="#rapid-icon-no",s="disabled",n="";function o(){e&&e.stop(),i.container().select(".main-footer-wrap").classed("footer-hide",!0).classed("footer-show",!1),i.container().select(".flash-wrap").classed("footer-hide",!1).classed("footer-show",!0);var a=i.container().select(".flash-wrap").selectAll(".flash-content").data([0]),l=a.enter().append("div").attr("class","flash-content"),c=l.append("svg").attr("class","flash-icon icon").append("g").attr("transform","translate(10,10)");return c.append("circle").attr("r",9),c.append("use").attr("transform","translate(-7,-7)").attr("width","14").attr("height","14"),l.append("div").attr("class","flash-text"),a=a.merge(l),a.selectAll(".flash-icon").attr("class","icon flash-icon "+(s||"")),a.selectAll(".flash-icon use").attr("xlink:href",r),a.selectAll(".flash-text").attr("class","flash-text").html(n),e=Yl(function(){e=null,i.container().select(".main-footer-wrap").classed("footer-hide",!1).classed("footer-show",!0),i.container().select(".flash-wrap").classed("footer-hide",!0).classed("footer-show",!1)},t),a}return o.duration=function(a){return arguments.length?(t=a,o):t},o.label=function(a){return arguments.length?(n=a,o):n},o.iconName=function(a){return arguments.length?(r=a,o):r},o.iconClass=function(a){return arguments.length?(s=a,o):s},o}function O6(i){var e=i.container().node();function t(){if(e.requestFullscreen)return e.requestFullscreen;if(e.msRequestFullscreen)return e.msRequestFullscreen;if(e.mozRequestFullScreen)return e.mozRequestFullScreen;if(e.webkitRequestFullscreen)return e.webkitRequestFullscreen}function r(){if(document.exitFullscreen)return document.exitFullscreen;if(document.msExitFullscreen)return document.msExitFullscreen;if(document.mozCancelFullScreen)return document.mozCancelFullScreen;if(document.webkitExitFullscreen)return document.webkitExitFullscreen}function s(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function n(){return!!t()}function o(a){a.preventDefault(),s()?r().apply(document):t().apply(e)}return function(){if(n()){var a=ei(),l=a.os==="mac"?[Ie("\u2303\u2318F"),"f11"]:["f11"];i.keybinding().on(l,o)}}}var xH=1e4,vH=2e3,Ek={enableHighAccuracy:!1,timeout:6e3};function B6(i){let e=i.systems.l10n,t=i.systems.map,r=i.systems.ui,s=Sn(i).message(e.tHtml("geolocate.locating")).blocking(!0),n=i.scene().layers.get("map-ui"),o=!1,a,l=G(null);function c(){i.inIntro||(o?(o=!1,n.geolocationData=null,t.deferredRedraw(),d()):(o=!0,l.classed("active",!0),i.enter("browse"),a=window.setTimeout(h,xH),i.container().call(s),navigator.geolocation.getCurrentPosition(u,h,Ek)))}function u(f){if(o){let p=f.coords,m=new ie([p.longitude,p.latitude]).padByMeters(p.accuracy);n.geolocationData=f,t.deferredRedraw(),a&&(window.clearTimeout(a),a=void 0,t.centerZoomEase(m.center(),Math.min(20,t.extentZoom(m)))),window.setTimeout(()=>{navigator.geolocation.getCurrentPosition(u,h,Ek)},vH)}d()}function h(){o&&r.flash.label(e.tHtml("geolocate.location_unavailable")).iconName("#rapid-icon-geolocate")(),o=!1,n.geolocationData=null,t.deferredRedraw(),d()}function d(){a&&(window.clearTimeout(a),a=void 0),s.close(),l.classed("active",o)}return function(f){if(!navigator.geolocation||!navigator.geolocation.getCurrentPosition)return;let p=e.isRTL();l=f.append("button").on("click",c).call(V("#rapid-icon-geolocate","light")).call(he(i).placement(p?"right":"left").title(e.t("geolocate.title")))}}function U6(i){let e=i.systems.l10n,t;function r(n){let o=i.services.improveOSM;if(!o)return;let a=n.selectAll(".comments-container").data([0]);a=a.enter().append("div").attr("class","comments-container").merge(a),o.getCommentsAsync(t).then(l=>{if(!l.comments)return;let c=a.selectAll(".comment").data(l.comments).enter().append("div").attr("class","comment");c.append("div").attr("class","comment-avatar").call(V("#rapid-icon-avatar","comment-avatar-icon"));let u=c.append("div").attr("class","comment-main"),h=u.append("div").attr("class","comment-metadata");h.append("div").attr("class","comment-author").each(function(d){let f=i.services.osm,p=G(this);f&&d.username&&(p=p.append("a").attr("class","comment-author-link").attr("href",f.userURL(d.username)).attr("target","_blank")),p.text(m=>m.username)}),h.append("div").attr("class","comment-date").html(d=>e.tHtml("note.status.commented",{when:s(d.timestamp)})),u.append("div").attr("class","comment-text").append("p").text(d=>d.text)}).catch(l=>console.log(l))}function s(n){if(!n)return null;let o={day:"numeric",month:"short",year:"numeric"},a=new Date(n*1e3);if(isNaN(a.getTime()))return null;let l=i.systems.l10n.localeCode();return a.toLocaleDateString(l,o)}return r.issue=function(n){return arguments.length?(t=n,r):t},r}function $6(i){let e=i.systems.editor,t=i.systems.filters,r=i.systems.l10n,s=i.systems.map,n=i.systems.presets,o;function a(c){if(c.desc)return c.desc;let u=c.issueKey;return c.replacements=c.replacements||{},c.replacements.default=r.tHtml("inspector.unknown"),r.tHtml(`QA.improveOSM.error_types.${u}.description`,c.replacements)}function l(c){let u=c.selectAll(".error-details").data(o?[o]:[],p=>`${p.id}-${p.status||0}`);u.exit().remove();let d=u.enter().append("div").attr("class","error-details qa-details-container").append("div").attr("class","qa-details-subsection");d.append("h4").html(r.tHtml("QA.keepRight.detail_description")),d.append("div").attr("class","qa-details-description-text").text(a);let f=[];d.selectAll(".error_entity_link, .error_object_link").attr("href","#").each((p,m,g)=>{let y=g[m],x=G(y),b=x.classed("error_object_link"),_=b?o.objectType.charAt(0)+o.objectId:y.textContent,w=e.staging.graph,A=w.hasEntity(_);if(f.push(_),x.on("mouseenter",()=>{Xe([_],!0,i)}).on("mouseleave",()=>{Xe([_],!1,i)}).on("click",k=>{k.preventDefault(),Xe([_],!1,i),s.scene.enableLayers("osm"),s.centerZoom(o.loc,20),s.selectEntityID(_)}),A){let k=r.displayName(A.tags);if(!k&&!b){let v=n.match(A,w);k=v&&!v.isFallback()&&v.name()}k&&(y.innerText=k)}}),t.forceVisible(f),s.immediateRedraw()}return l.issue=function(c){return arguments.length?(o=c,l):o},l}function H6(i){let e=i.systems.l10n,t;function r(n){let o=n.issueKey;return n.replacements=n.replacements||{},n.replacements.default=e.tHtml("inspector.unknown"),e.tHtml(`QA.improveOSM.error_types.${o}.title`,n.replacements)}function s(n){let o=16777215,a=i.services.improveOSM;a&&(o=a.getColor(t==null?void 0:t.itemType));let l=n.selectAll(".qa-header").data(t?[t]:[],h=>`${h.id}-${h.status||0}`);l.exit().remove();let c=l.enter().append("div").attr("class","qa-header"),u=c.append("div").attr("class","qa-header-icon").append("svg").attr("width","20px").attr("height","27px").attr("viewbox","0 0 20 27").attr("class",h=>`qaItem ${h.service}`);u.append("polygon").attr("fill",new we(o).toHex()).attr("stroke","#333").attr("points","16,3 4,3 1,6 1,17 4,20 7,20 10,27 13,20 16,20 19,17.033 19,6"),u.append("use").attr("class","icon-annotation").attr("width","13px").attr("height","13px").attr("transform","translate(3.5, 5)").attr("xlink:href",h=>h.icon?`#${h.icon}`:""),c.append("div").attr("class","qa-header-label").text(r)}return s.issue=function(n){return arguments.length?(t=n,s):t},s}function Qc(i){let e=i.systems.l10n,t=i.services.improveOSM,r=ue("change"),s=$6(i),n=U6(i),o=H6(i),a;function l(h){let d=h.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");d.append("button").attr("class","close").on("click",()=>i.enter("browse")).call(V("#rapid-icon-close")),d.append("h3").html(e.tHtml("QA.improveOSM.title"));let f=h.selectAll(".body").data([0]);f=f.enter().append("div").attr("class","body").merge(f);let p=f.selectAll(".qa-editor").data([0]);p.enter().append("div").attr("class","modal-section qa-editor").merge(p).call(o.issue(a)).call(s.issue(a)).call(n.issue(a)).call(c)}function c(h){let d=a==null?void 0:a.id,f=d&&i.selectedData().has(d),p=a&&(f||a.newComment||a.comment),m=h.selectAll(".qa-save").data(p?[a]:[],x=>`${x.id}-${x.status||0}`);m.exit().remove();let g=m.enter().append("div").attr("class","qa-save save-section cf");g.append("h4").attr("class",".qa-save-header").html(e.tHtml("note.newComment")),g.append("textarea").attr("class","new-comment-input").attr("placeholder",e.t("QA.keepRight.comment_placeholder")).attr("maxlength",1e3).property("value",x=>x.newComment).call(Re).on("input",y).on("blur",y),m=g.merge(m).call(u);function y(){let b=G(this).property("value").trim();b===""&&(b=void 0),a=a.update({newComment:b}),t&&t.replaceItem(a),m.call(u)}}function u(h){let d=a==null?void 0:a.id,f=d&&i.selectedData().has(d),p=h.selectAll(".buttons").data(f?[a]:[],g=>g.status+g.id);p.exit().remove();let m=p.enter().append("div").attr("class","buttons");m.append("button").attr("class","button comment-button action").html(e.tHtml("QA.keepRight.save_comment")),m.append("button").attr("class","button close-button action"),m.append("button").attr("class","button ignore-button action"),p=p.merge(m),p.select(".comment-button").attr("disabled",g=>g.newComment?null:!0).on("click.comment",function(g,y){this.blur(),t&&t.postUpdate(y,(x,b)=>r.call("change",b))}),p.select(".close-button").html(g=>{let y=g.newComment?"_comment":"";return e.tHtml(`QA.keepRight.close${y}`)}).on("click.close",function(g,y){this.blur(),t&&(y.newStatus="SOLVED",t.postUpdate(y,(x,b)=>r.call("change",b)))}),p.select(".ignore-button").html(g=>{let y=g.newComment?"_comment":"";return e.tHtml(`QA.keepRight.ignore${y}`)}).on("click.ignore",function(g,y){this.blur(),t&&(y.newStatus="INVALID",t.postUpdate(y,(x,b)=>r.call("change",b)))})}return l.error=function(h){return arguments.length?(a=h,l):a},me(l,r,"on")}function ke(i,e){return`<svg class="${"icon"+(e?` ${e}`:"")}"><use xlink:href="${i}"></use></svg>`}function ni(i){i.stopPropagation(),i.preventDefault()}var G6;function J(i,e,t){let r=i.systems.l10n,s=r.isRTL();G6||(G6={point_icon:ke("#rapid-icon-point","inline"),line_icon:ke("#rapid-icon-line","inline"),area_icon:ke("#rapid-icon-area","inline"),note_icon:ke("#rapid-icon-note","inline add-note"),plus:ke("#rapid-icon-plus","inline"),minus:ke("#rapid-icon-minus","inline"),layers_icon:ke("#rapid-icon-layers","inline"),data_icon:ke("#rapid-icon-data","inline"),inspect:ke("#rapid-icon-inspect","inline"),help_icon:ke("#rapid-icon-help","inline"),undo_icon:ke(s?"#rapid-icon-redo":"#rapid-icon-undo","inline"),redo_icon:ke(s?"#rapid-icon-undo":"#rapid-icon-redo","inline"),save_icon:ke("#rapid-icon-save","inline"),circularize_icon:ke("#rapid-operation-circularize","inline operation"),continue_icon:ke("#rapid-operation-continue","inline operation"),copy_icon:ke("#rapid-operation-copy","inline operation"),delete_icon:ke("#rapid-operation-delete","inline operation"),disconnect_icon:ke("#rapid-operation-disconnect","inline operation"),downgrade_icon:ke("#rapid-operation-downgrade","inline operation"),extract_icon:ke("#rapid-operation-extract","inline operation"),merge_icon:ke("#rapid-operation-merge","inline operation"),move_icon:ke("#rapid-operation-move","inline operation"),orthogonalize_icon:ke("#rapid-operation-orthogonalize","inline operation"),paste_icon:ke("#rapid-operation-paste","inline operation"),reflect_long_icon:ke("#rapid-operation-reflect-long","inline operation"),reflect_short_icon:ke("#rapid-operation-reflect-short","inline operation"),reverse_icon:ke("#rapid-operation-reverse","inline operation"),rotate_icon:ke("#rapid-operation-rotate","inline operation"),split_icon:ke("#rapid-operation-split","inline operation"),straighten_icon:ke("#rapid-operation-straighten","inline operation"),leftclick:ke("#rapid-walkthrough-mouse-left","inline operation"),rightclick:ke("#rapid-walkthrough-mouse-right","inline operation"),mousewheel_icon:ke("#rapid-walkthrough-mousewheel","inline operation"),tap_icon:ke("#rapid-walkthrough-tap","inline operation"),doubletap_icon:ke("#rapid-walkthrough-doubletap","inline operation"),longpress_icon:ke("#rapid-walkthrough-longpress","inline operation"),touchdrag_icon:ke("#rapid-walkthrough-touchdrag","inline operation"),pinch_icon:ke("#rapid-walkthrough-pinch-apart","inline operation"),shift:Ie.display(i,"\u21E7"),alt:Ie.display(i,"\u2325"),return:Ie.display(i,"\u21B5"),esc:r.tHtml("shortcuts.key.esc"),space:r.tHtml("shortcuts.key.space"),add_note_key:r.tHtml("modes.add_note.key"),help_key:r.tHtml("help.key"),shortcuts_key:r.tHtml("shortcuts.toggle.key"),save:r.tHtml("save.title"),undo:r.tHtml("undo.title"),redo:r.tHtml("redo.title"),upload:r.tHtml("commit.save"),point:r.tHtml("modes.add_point.title"),line:r.tHtml("modes.add_line.title"),area:r.tHtml("modes.add_area.title"),note:r.tHtml("modes.add_note.label"),circularize:r.tHtml("operations.circularize.title"),continue:r.tHtml("operations.continue.title"),copy:r.tHtml("operations.copy.title"),delete:r.tHtml("operations.delete.title"),disconnect:r.tHtml("operations.disconnect.title"),downgrade:r.tHtml("operations.downgrade.title"),extract:r.tHtml("operations.extract.title"),merge:r.tHtml("operations.merge.title"),move:r.tHtml("operations.move.title"),orthogonalize:r.tHtml("operations.orthogonalize.title"),paste:r.tHtml("operations.paste.title"),reflect_long:r.tHtml("operations.reflect.title.long"),reflect_short:r.tHtml("operations.reflect.title.short"),reverse:r.tHtml("operations.reverse.title"),rotate:r.tHtml("operations.rotate.title"),split:r.tHtml("operations.split.title"),straighten:r.tHtml("operations.straighten.title"),map_data:r.tHtml("map_data.title"),osm_notes:r.tHtml("map_data.layers.notes.title"),fields:r.tHtml("inspector.fields"),tags:r.tHtml("inspector.tags"),relations:r.tHtml("inspector.relations"),new_relation:r.tHtml("inspector.new_relation"),turn_restrictions:r.tHtml("_tagging.presets.fields.restrictions.label"),background_settings:r.tHtml("background.description"),imagery_offset:r.tHtml("background.fix_misalignment"),start_the_walkthrough:r.tHtml("splash.walkthrough"),help:r.tHtml("help.title"),ok:r.tHtml("intro.ok")});let n;return t?n=Object.assign(t,G6):n=G6,r.tHtml(e,n).replace(/\`(.*?)\`/g,"<kbd>$1</kbd>")}function Ak(i){return i.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}var Sk={};function Ck(i,e,t){if(i.systems.l10n.t(e,{default:void 0})===void 0){if(Sk.hasOwnProperty(e))return;Sk[e]=t;let s=`${e}: ${t}`;typeof console!="undefined"&&console.log(s)}}function eg(i,e){let t=i.systems.l10n,r,s=e.tags&&e.tags.name;s&&(r="intro.graph.name."+Ak(s),e.tags.name=t.t(r,{default:s}),Ck(i,r,s));let n=e.tags&&e.tags["addr:street"];if(n){r="intro.graph.name."+Ak(n),e.tags["addr:street"]=t.t(r,{default:n}),Ck(i,r,n);let o=["block_number","city","county","district","hamlet","neighbourhood","postcode","province","quarter","state","subdistrict","suburb"];for(let a of o){let l=`intro.graph.${a}`,c=`addr:${a}`,u=e.tags&&e.tags[c],h=t.t(l,{default:u});h&&(h.match(/^<.*>$/)!==null?delete e.tags[c]:e.tags[c]=h)}}return e}function kk(i){let t=Math.cos(75*Math.PI/180),r=Math.cos(15*Math.PI/180);for(let s=0;s<i.length;s++){let n=i[(s-1+i.length)%i.length],o=i[s],a=i[(s+1)%i.length],l=C5(n,a,o),c=Math.abs(l);if(c>t&&c<r)return!1}return!0}function _i(i,e){let t=at(i,e);return t<1e-4?0:t<200?500:1e3}function xt(i=300){return new Promise(e=>window.setTimeout(e,i))}function Ca(i,e,t){return Math.max(e,Math.min(i,t))}var z6=class{constructor(e){this.context=e,this._enabled=!1,this._revealOptions=null,this._containerRect=null,this._mapRect=null,this._revealRect=null,this._darknessDirty=!0,this._tooltipDirty=!0,this._inTransition=!1,this._curtain=G(null),this._tooltip=G(null),this.enable=this.enable.bind(this),this.disable=this.disable.bind(this),this.redraw=this.redraw.bind(this),this.resize=this.resize.bind(this)}enable(e){this._enabled||(this._enabled=!0,this._revealOptions=null,this._containerRect=null,this._mapRect=null,this._revealRect=null,this._darknessDirty=!0,this._tooltipDirty=!0,this._inTransition=!1,this._curtain=e.append("svg").attr("class","curtain").style("top",0).style("left",0),this._tooltip=e.append("div").attr("class","tooltip"),this._tooltip.append("div").attr("class","popover-arrow"),this._tooltip.append("div").attr("class","popover-inner"),G(window).on("resize.curtain",this.resize),this.context.systems.map.on("move",this.redraw),this.resize())}disable(){this._enabled&&(this._enabled=!1,this._curtain.remove(),this._curtain=G(null),this._tooltip.remove(),this._tooltip=G(null),this._revealOptions=null,this._containerRect=null,this._mapRect=null,this._revealRect=null,G(window).on("resize.curtain",null),this.context.systems.map.off("move",this.redraw))}resize(){let e=this.context.container().node();this._containerRect=this._copyRect(e.getBoundingClientRect());let t=this.context.container().select(".main-map").node();this._mapRect=this._copyRect(t.getBoundingClientRect());let[r,s]=[this._containerRect.width,this._containerRect.height];this._curtain.attr("width",r).attr("height",s),this._revealRect=null,this._darknessDirty=!0,this._curtain.selectAll("path").interrupt(),this._inTransition=!1,this.redraw()}hide(){this.reveal({duration:0})}reveal(e={}){return this._revealOptions=Object.assign({},e,{duration:250}),this._revealRect=null,this._darknessDirty=!0,this._tooltipDirty=!0,this.redrawDarkness(this._revealOptions.duration),this.redrawTooltip(),this._tooltip}redraw(){this._inTransition||(this.redrawDarkness(),this.redrawTooltip())}redrawDarkness(e=0){var p;if(!this._darknessDirty)return;let t=this._containerRect,r=this._mapRect;if(!t||!r)return;let s=this._revealOptions,n=(p=s==null?void 0:s.revealPadding)!=null?p:0,o,a;if(s){if(s.revealExtent instanceof ie){let m=this.context.projection,g=m.project([s.revealExtent.min[0],s.revealExtent.max[1]]),y=m.project([s.revealExtent.max[0],s.revealExtent.min[1]]);g=dt(g,[r.left,r.top]),y=dt(y,[r.left,r.top]),a=r,o={left:g[0],top:g[1],right:y[0],bottom:y[1],width:y[0]-g[0],height:y[1]-g[1]}}else s.revealSelector&&!s.revealNode&&(s.revealNode=G(s.revealSelector).node()),s.revealNode instanceof Element&&(a=t,o=this._copyRect(s.revealNode.getBoundingClientRect()));o&&(o.left=Ca(o.left-n,a.left,a.right),o.top=Ca(o.top-n,a.top,a.bottom),o.right=Ca(o.right+n,a.left,a.right),o.bottom=Ca(o.bottom+n,a.top,a.bottom),o.width=o.right-o.left,o.height=o.bottom-o.top,this._revealRect=o)}let l=t,c=o,u=`M${l.left},${l.top} L${l.left},${l.bottom} L${l.right},${l.bottom}, L${l.right},${l.top} Z`;c&&(u+=` M${c.left},${c.top} L${c.left},${c.bottom} L${c.right},${c.bottom}, L${c.right},${c.top} Z`);let h=this._curtain.selectAll("path").data([0]).interrupt(),d=h.enter().append("path").attr("x",0).attr("y",0).attr("class","curtain-darkness"),f=h.merge(d);e>0?(this._inTransition=!0,f=f.transition().duration(e).ease(Y0).on("end interrupt",()=>this._inTransition=!1)):this._inTransition=!1,f.attr("d",u),this._darknessDirty=s==null?void 0:s.revealExtent}redrawTooltip(){let e=this._containerRect;if(!e)return;let t=this._revealOptions,r;t&&(t.tipSelector&&!t.tipNode&&(t.tipNode=G(t.tipSelector).node()),t.tipNode instanceof Element&&(r=this._copyRect(t.tipNode.getBoundingClientRect())),!r&&this._revealRect&&(r=this._copyRect(this._revealRect)));let s=t==null?void 0:t.tipHtml;if(r&&s){let n="curtain-tooltip popover tooltip arrowed in "+(t.tooltipClass||"");this._tooltipDirty&&(s.indexOf("**")!==-1&&(s.indexOf("<span")===0?s=s.replace(/^(<span.*?>)(.+?)(\*\*)/,"$1<span>$2</span>$3"):s=s.replace(/^(.+?)(\*\*)/,"<span>$1</span>$2"),s=s.replace(/\*\*(.*?)\*\*/g,'<span class="instruction">$1</span>')),s=s.replace(/\*(.*?)\*/g,"<em>$1</em>"),s=s.replace(/\{br\}/g,"<br/><br/>"),t.buttonText&&t.buttonCallback&&(s+=`<div class="button-section"><button href="#" class="button action">${t.buttonText}</button></div>`),this._tooltip.attr("class",n).selectAll(".popover-inner").html(s),t.buttonText&&t.buttonCallback&&this._tooltip.selectAll("button.action").on("click",d=>{d.preventDefault(),t.buttonCallback()}),this._tooltipDirty=!1);let o=5,a=this._copyRect(this._tooltip.node().getBoundingClientRect()),l,c,u;r.left=Ca(r.left,e.left,e.right),r.top=Ca(r.top,e.top,e.bottom),r.right=Ca(r.right,e.left,e.right),r.bottom=Ca(r.bottom,e.top,e.bottom),r.width=r.right-r.left,r.height=r.bottom-r.top,r.bottom<100?(l="bottom",c=r.left+r.width/2-a.width/2,u=r.bottom):r.top>e.height-140?(l="top",c=r.left+r.width/2-a.width/2,u=r.top-a.height):(u=r.top+r.height/2-a.height/2,this.context.systems.l10n.textDirection()==="rtl"?r.left-a.width-o<70?(l="right",c=r.right+o):(l="left",c=r.left-a.width-o):r.right+o+a.width>e.width-70?(l="left",c=r.left-a.width-o):(l="right",c=r.right+o)),this._tooltip.style("left",`${c}px`).style("top",`${u}px`).attr("class",n+" "+l);let h=0;(l==="left"||l==="right")&&(u<60?h=60-u:u+a.height>e.height-100&&(h=e.height-u-a.height-100)),this._tooltip.selectAll(".popover-inner").style("top",`${h}px`)}else this._tooltip.classed("in",!1).call(jc(!1)),this._tooltipDirty=!1}_copyRect(e){return{left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height}}};function Tk(i,e){let t=ue("done"),r={title:"intro.welcome.title"},s=new ie([-85.63654,41.9429],[-85.63632,41.94307]),n=i.systems.l10n,o=i.systems.map,a=!1,l=null;function c(p){return a?Promise.reject():typeof p!="function"?Promise.resolve():p().then(m=>c(m)).catch(m=>(m instanceof Error&&console.error(m),c(p)))}function u(){return o.setCenterZoomAsync(s.center(),19).then(()=>new Promise((p,m)=>{l=m,e.reveal({revealSelector:".intro-nav-wrap .chapter-welcome",tipHtml:J(i,"intro.welcome.welcome"),buttonText:n.tHtml("intro.ok"),buttonCallback:()=>p(h)})}))}function h(){return new Promise((p,m)=>{l=m,e.reveal({revealSelector:".intro-nav-wrap .chapter-welcome",tipHtml:J(i,"intro.welcome.practice"),buttonText:n.tHtml("intro.ok"),buttonCallback:()=>p(d)})})}function d(){return new Promise((p,m)=>{l=m,e.reveal({revealSelector:".intro-nav-wrap .chapter-welcome",tipHtml:J(i,"intro.welcome.words"),buttonText:n.tHtml("intro.ok"),buttonCallback:()=>p(f)})})}function f(){return t.call("done"),e.reveal({revealSelector:".intro-nav-wrap .chapter-navigation",tipHtml:J(i,"intro.welcome.chapters",{next:n.t("intro.navigation.title")})}),Promise.resolve()}return r.enter=()=>{a=!1,l=null,c(u).catch(p=>{p instanceof Error&&console.error(p)})},r.exit=()=>{a=!0,l&&(l(),l=null)},r.restart=()=>{r.exit(),r.enter()},me(r,t,"on")}function Ik(i,e){let t=ue("done"),r={title:"intro.navigation.title"},s=i.container(),n=i.systems.editor,o=i.systems.l10n,a=i.systems.map,l=i.systems.presets,c=i.systems.ui,u="n2061",h=new ie([-85.63654,41.9429],[-85.63632,41.94307]),d="w397",f=new ie([-85.63588,41.94155],[-85.63574,41.94278]),p=l.field("oneway"),m=l.field("maxspeed"),g=!1,y=null,x=null,b=null;function _(){var j;if(!n.staging.graph.hasEntity(u)||((j=i.mode)==null?void 0:j.id)!=="select-osm")return!1;let z=i.selectedIDs();return z.length===1&&z[0]===u}function w(){return n.staging.graph.hasEntity(d)}function A(){var j;if(!n.staging.graph.hasEntity(d)||((j=i.mode)==null?void 0:j.id)!=="select-osm")return!1;let z=i.selectedIDs();return z.length===1&&z[0]===d}function k(H){return g?Promise.reject():typeof H!="function"?Promise.resolve():H().then(z=>k(z)).catch(z=>(z instanceof Error&&console.error(z),k(H)))}function v(){i.enter("browse"),n.restoreCheckpoint("initial");let H=h.center(),z=_i(H,a.center());return z>0&&e.hide(),a.setCenterZoomAsync(H,19,z).then(()=>new Promise((j,X)=>{y=X;let K=a.center(),Y=i.lastPointerType==="mouse"?"drag":"drag_touch",oe=J(i,"intro.navigation.map_info")+"{br}"+J(i,`intro.navigation.${Y}`);x=()=>{We(K,a.center())||j(E)},e.reveal({revealSelector:".main-map",tipHtml:oe})})).finally(()=>{x=null}).then(j=>xt(2e3).then(j))}function E(){return new Promise((H,z)=>{y=z;let j=a.zoom(),X=i.lastPointerType==="mouse"?"zoom":"zoom_touch",K=J(i,`intro.navigation.${X}`);x=()=>{j!==a.zoom()&&H(S)},e.reveal({revealSelector:".main-map",tipHtml:K})}).finally(()=>{x=null}).then(H=>xt(2e3).then(H))}function S(){return new Promise((H,z)=>{y=z,e.reveal({revealSelector:".main-map",tipHtml:J(i,"intro.navigation.features"),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>H(M)})})}function M(){return new Promise((H,z)=>{y=z,e.reveal({revealSelector:".main-map",tipHtml:J(i,"intro.navigation.points_lines_areas"),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>H(I)})})}function I(){return new Promise((H,z)=>{y=z,e.reveal({revealSelector:".main-map",tipHtml:J(i,"intro.navigation.nodes_ways"),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>H(T)})})}function T(){i.enter("browse"),n.restoreCheckpoint("initial");let H=h.center(),z=_i(H,a.center());return z>0&&e.hide(),a.setCenterZoomAsync(H,19,z).then(()=>new Promise((j,X)=>{y=X,b=()=>j(C);let K=i.lastPointerType==="mouse"?"click_townhall":"tap_townhall";e.reveal({revealExtent:h,tipHtml:J(i,`intro.navigation.${K}`)})})).finally(()=>{b=null})}function C(){return _()?new Promise((H,z)=>{y=z,b=z,e.reveal({revealExtent:h,tipHtml:J(i,"intro.navigation.selected_townhall"),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>H(P)})}).finally(()=>{b=null}):Promise.resolve(T)}function P(){return _()?new Promise((H,z)=>{y=z,b=z,c.sidebar.showEntityEditor(),s.select(".inspector-wrap").on("wheel.intro",ni),e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(i,"intro.navigation.editor_townhall"),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>H(D)})}).finally(()=>{b=null,s.select(".inspector-wrap").on("wheel.intro",null)}):Promise.resolve(T)}function D(){return _()?new Promise((H,z)=>{y=z,b=z,c.sidebar.showEntityEditor(),s.select(".inspector-wrap").on("wheel.intro",ni);let j=n.staging.graph,X=j.entity(i.selectedIDs()[0]),K=l.match(X,j);e.reveal({revealSelector:".entity-editor-pane .section-feature-type",revealPadding:5,tipHtml:J(i,"intro.navigation.preset_townhall",{preset:K.name()}),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>H(O)})}).finally(()=>{b=null,s.select(".inspector-wrap").on("wheel.intro",null)}):Promise.resolve(T)}function O(){return _()?new Promise((H,z)=>{y=z,b=z,c.sidebar.showEntityEditor(),s.select(".inspector-wrap").on("wheel.intro",ni),e.reveal({revealSelector:".entity-editor-pane .section-preset-fields",revealPadding:5,tipHtml:J(i,"intro.navigation.fields_townhall"),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>H(R)})}).finally(()=>{b=null,s.select(".inspector-wrap").on("wheel.intro",null)}):Promise.resolve(T)}function R(){return _()?new Promise((H,z)=>{y=z,b=()=>H(N),c.sidebar.showEntityEditor();let X=G(".entity-editor-pane button.close svg use").attr("href")||"#rapid-icon-close";e.reveal({revealSelector:".entity-editor-pane",tipSelector:".entity-editor-pane button.close",tipHtml:J(i,"intro.navigation.close_townhall",{button:ke(X,"inline")})})}).finally(()=>{b=null}):Promise.resolve(T)}function N(){i.enter("browse"),n.restoreCheckpoint("initial");let H=f.center(),z=_i(H,a.center());return z>0&&e.hide(),a.setCenterZoomAsync(H,19,z).then(()=>new Promise((j,X)=>{y=X,e.reveal({revealSelector:".search-header input",tipHtml:J(i,"intro.navigation.search_street",{name:o.t("intro.graph.name.spring-street")})}),s.select(".search-header input").on("keyup.intro",()=>j(F))})).finally(()=>{s.select(".search-header input").on("keyup.intro",null)})}function F(){return w()?new Promise((H,z)=>{y=z,b=()=>H(B),s.select(".search-header input").on("keyup.intro",()=>{let j=s.select(".feature-list-item:nth-child(0n+2)"),X=j.select(".entity-name"),K=o.t("intro.graph.name.spring-street");!X.empty()&&X.html()===K&&(e.reveal({revealNode:j.node(),revealPadding:5,tipHtml:J(i,"intro.navigation.choose_street",{name:K})}),s.select(".search-header input").on("keydown.intro",ni,!0).on("keyup.intro",null))})}).finally(()=>{b=null,s.select(".search-header input").on("keydown.intro",null).on("keyup.intro",null)}):Promise.resolve(N)}function B(){let H=f.center();return a.setCenterZoomAsync(H,19,0).then(()=>new Promise((z,j)=>{if(y=j,b=j,!A()){z(N);return}e.reveal({revealExtent:f,revealPadding:40,tipHtml:J(i,"intro.navigation.selected_street",{name:o.t("intro.graph.name.spring-street")}),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>z($)})})).finally(()=>{b=null})}function $(){return A()?new Promise((H,z)=>{y=z,b=()=>H(U),c.sidebar.showEntityEditor();let X=G(".entity-editor-pane button.close svg use").attr("href")||"#rapid-icon-close",K=J(i,"intro.navigation.street_different_fields")+"{br}"+J(i,"intro.navigation.editor_street",{button:ke(X,"inline"),field1:p.label(),field2:m.label()});e.reveal({revealSelector:".entity-editor-pane",tipHtml:K})}).finally(()=>{b=null}):Promise.resolve(N)}function U(){return t.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-point",tipHtml:J(i,"intro.navigation.play",{next:o.t("intro.points.title")}),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{g=!1,y=null,x=null,b=null,i.on("modechange",z),a.on("move",H),k(v).catch(j=>{j instanceof Error&&console.error(j)}).finally(()=>{i.off("modechange",z),a.off("move",H)});function H(...j){typeof x=="function"&&x(...j)}function z(...j){typeof b=="function"&&b(...j)}},r.exit=()=>{g=!0,y&&(y(),y=null)},r.restart=()=>{r.exit(),r.enter()},me(r,t,"on")}function Mk(i,e){let t=ue("done"),r={title:"intro.points.title"},s=i.container(),n=i.systems.editor,o=i.systems.l10n,a=i.systems.map,l=i.systems.presets,c=i.systems.ui,u=c.editMenu,h=new ie([-85.63261,41.94391],[-85.63222,41.94419]),d=l.item("amenity/cafe"),f=!1,p=null,m=null,g=null,y=null,x=null;function b(){let F=n.staging.graph;return x&&F.hasEntity(x)}function _(){var B;if(((B=i.mode)==null?void 0:B.id)!=="select-osm")return!1;let F=i.selectedIDs();return F.length===1&&F[0]===x}function w(F){return f?Promise.reject():typeof F!="function"?Promise.resolve():F().then(B=>w(B)).catch(B=>(B instanceof Error&&console.error(B),w(F)))}function A(){i.enter("browse"),n.restoreCheckpoint("initial"),x=null;let F=h.center(),B=_i(F,a.center());return B>0&&e.hide(),a.setCenterZoomAsync(F,20,B).then(()=>new Promise(($,U)=>{p=U,m=()=>$(k),e.reveal({revealSelector:"button.add-point",tipHtml:J(i,"intro.points.points_info")+"{br}"+J(i,"intro.points.add_point")}).selectAll(".popover-inner").insert("svg","span").attr("class","tooltip-illustration").append("use").attr("xlink:href","#rapid-graphic-points")})).finally(()=>{m=null})}function k(){var F;return((F=i.mode)==null?void 0:F.id)!=="add-point"?Promise.resolve(A):(x=null,new Promise((B,$)=>{p=$,m=()=>B(v),g=H=>{let z=H.created();z.length===1&&(x=z[0].id)};let U=i.lastPointerType==="mouse"?"place_point":"place_point_touch";e.reveal({revealExtent:h,tipHtml:J(i,`intro.points.${U}`)})}).finally(()=>{m=null,g=null}))}function v(){return xt().then(()=>new Promise((F,B)=>{if(p=B,!b()){F(A);return}_()||i.enter("select-osm",{selection:{osm:[x]}}),m=B,g=U=>{let H=U.modified();if(H.length===1){let z=n.staging.graph;l.match(H[0],z)===d?F(E):B()}},s.select(".inspector-wrap").on("wheel.intro",ni),c.sidebar.showPresetList(),e.reveal({revealSelector:".preset-search-input",tipHtml:J(i,"intro.points.search_cafe",{preset:d.name()})}),s.select(".preset-search-input").on("keydown.intro",null).on("keyup.intro",$);function $(){let U=s.select(".preset-list-item:first-child");U.classed("preset-amenity_cafe")&&(e.reveal({revealNode:U.select(".preset-list-button").node(),revealPadding:5,tipHtml:J(i,"intro.points.choose_cafe",{preset:d.name()})}),s.select(".preset-search-input").on("keydown.intro",ni,!0).on("keyup.intro",null))}})).finally(()=>{m=null,g=null,s.select(".inspector-wrap").on("wheel.intro",null),s.select(".preset-search-input").on("keydown.intro keyup.intro",null)})}function E(){return xt().then(()=>new Promise((F,B)=>{if(p=B,!b()){F(A);return}_()||i.enter("select-osm",{selection:{osm:[x]}}),m=()=>F(S),c.sidebar.showEntityEditor(),e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(i,"intro.points.feature_editor"),tipClass:"intro-points-describe",buttonText:o.tHtml("intro.ok"),buttonCallback:()=>F(S)})})).finally(()=>{m=null})}function S(){return xt().then(()=>new Promise((F,B)=>{if(p=B,!b()){F(A);return}_()||i.enter("select-osm",{selection:{osm:[x]}}),m=()=>F(I),y=()=>F(M),c.sidebar.showEntityEditor(),n.staging.graph.hasEntity(x).tags.name?e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(i,"intro.points.fields_info"),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>F(M)}).select(".instruction").style("display","none"):e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(i,"intro.points.fields_info")+"{br}"+J(i,"intro.points.add_name"),tipClass:"intro-points-describe"})})).finally(()=>{m=null,y=null})}function M(){return b()?(_()||i.enter("select-osm",{selection:{osm:[x]}}),new Promise((F,B)=>{p=B,m=()=>F(I),c.sidebar.showEntityEditor();let U=G(".entity-editor-pane button.close svg use").attr("href")||"#rapid-icon-close";e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(i,"intro.points.add_close",{button:ke(U,"inline")})})}).finally(()=>{m=null})):Promise.resolve(A)}function I(){if(!b())return Promise.resolve(A);let F=n.staging.graph,B=F.entity(x),$=l.match(B,F);return $!==d&&(n.perform(xr(x,$,d)),n.commit({annotation:o.t("operations.change_tags.annotation"),selectedIDs:[x]})),n.setCheckpoint("hasPoint"),Promise.resolve(T)}function T(){i.enter("browse"),n.restoreCheckpoint("hasPoint");let F=h.center(),B=_i(F,a.center());return B>0&&e.hide(),a.setCenterZoomAsync(F,20,B).then(()=>new Promise(($,U)=>{p=U,m=()=>$(C),e.reveal({revealExtent:h,tipHtml:J(i,"intro.points.reselect")})})).finally(()=>{m=null})}function C(){return xt().then(()=>new Promise((F,B)=>{if(p=B,!b()||!_()){F(T);return}m=B,y=()=>F(P),c.sidebar.showEntityEditor(),e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(i,"intro.points.update"),tipClass:"intro-points-describe"})})).finally(()=>{m=null,y=null})}function P(){return!b()||!_()?Promise.resolve(T):new Promise((F,B)=>{p=B,m=()=>F(D),c.sidebar.showEntityEditor(),e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(i,"intro.points.update_close",{button:ke("#rapid-icon-close","inline")})})}).finally(()=>{m=null})}function D(){var F;return b()?(["browse","select-osm"].includes((F=i.mode)==null?void 0:F.id)||i.enter("browse"),new Promise((B,$)=>{p=$,y=$;let U=i.lastPointerType==="mouse"?"rightclick":"edit_menu_touch";e.reveal({revealExtent:h,tipHtml:J(i,`intro.points.${U}`)}),u.on("toggled.intro",H=>{H&&B(O)})}).finally(()=>{y=null,u.on("toggled.intro",null)})):Promise.resolve(T)}function O(){return s.select(".edit-menu-item-delete").node()?xt().then(()=>new Promise((B,$)=>{if(p=$,m=()=>{b()&&$()},g=U=>{let H=U.deleted();H.length===1&&H[0].id===x&&B(R)},!b()||!_()){B(D);return}e.reveal({revealSelector:".edit-menu",revealPadding:50,tipHtml:J(i,"intro.points.delete")})})).finally(()=>{m=null,g=null}):Promise.resolve(D)}function R(){return new Promise((F,B)=>{p=B,g=()=>F(N),e.reveal({revealSelector:".top-toolbar button.undo-button",tipHtml:J(i,"intro.points.undo")})}).finally(()=>{g=null})}function N(){return t.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-area",tipHtml:J(i,"intro.points.play",{next:o.t("intro.areas.title")}),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{f=!1,p=null,m=null,g=null,y=null,i.on("modechange",F),n.on("stablechange",B),n.on("stagingchange",$),w(A).catch(U=>{U instanceof Error&&console.error(U)}).finally(()=>{i.off("modechange",F),n.off("stablechange",B),n.off("stagingchange",$)});function F(...U){typeof m=="function"&&m(...U)}function B(...U){typeof g=="function"&&g(...U)}function $(...U){typeof y=="function"&&y(...U)}},r.exit=()=>{f=!0,p&&(p(),p=null)},r.restart=()=>{r.exit(),r.enter()},me(r,t,"on")}function Pk(i,e){let t=ue("done"),r={title:"intro.areas.title"},s=i.container(),n=i.systems.editor,o=i.systems.l10n,a=i.systems.map,l=i.systems.presets,c=i.systems.ui,u=new ie([-85.63575,41.94137],[-85.63526,41.9418]),h=l.item("leisure/playground"),d=l.field("name"),f=l.field("description"),p=!1,m=null,g=null,y=null,x=null;function b(){let D=n.staging.graph;return x&&D.hasEntity(x)}function _(){var O;if(((O=i.mode)==null?void 0:O.id)!=="select-osm")return!1;let D=i.selectedIDs();return D.length===1&&D[0]===x}function w(D){return p?Promise.reject():typeof D!="function"?Promise.resolve():D().then(O=>w(O)).catch(O=>(O instanceof Error&&console.error(O),w(D)))}function A(){i.enter("browse"),n.restoreCheckpoint("initial"),x=null;let D=u.center(),O=_i(D,a.center());return O>0&&e.hide(),a.setCenterZoomAsync(D,19.5,O).then(()=>new Promise((R,N)=>{m=N,g=()=>R(k),e.reveal({revealSelector:"button.draw-area",tipHtml:J(i,"intro.areas.add_playground")}).selectAll(".popover-inner").insert("svg","span").attr("class","tooltip-illustration").append("use").attr("xlink:href","#rapid-graphic-areas")})).finally(()=>{g=null})}function k(){var D;return((D=i.mode)==null?void 0:D.id)!=="draw-area"?Promise.resolve(A):(x=null,new Promise((O,R)=>{m=R,g=R,y=B=>{for(let $ of B.created())$.type==="way"&&(x=$.id,O(v))};let N=i.lastPointerType==="mouse"?"click":"tap",F=J(i,"intro.areas.start_playground")+J(i,`intro.areas.starting_node_${N}`);e.reveal({revealExtent:u,tipHtml:F})}).finally(()=>{g=null,y=null}))}function v(){var D;return!b()||((D=i.mode)==null?void 0:D.id)!=="draw-area"?Promise.resolve(A):new Promise((O,R)=>{m=R,g=R,y=N=>{for(let F of N.modified())F.id===x&&F.nodes.length>5&&O(E)},e.reveal({revealExtent:u,tipHtml:J(i,"intro.areas.continue_playground")})}).finally(()=>{g=null,y=null})}function E(){var D;return!b()||((D=i.mode)==null?void 0:D.id)!=="draw-area"?Promise.resolve(A):new Promise((O,R)=>{m=R,g=()=>O(S);let N=i.lastPointerType==="mouse"?"click":"tap",F=J(i,`intro.areas.finish_area_${N}`)+J(i,"intro.areas.finish_playground");e.reveal({revealExtent:u,tipHtml:F})}).finally(()=>{g=null})}function S(){return xt().then(()=>new Promise((D,O)=>{if(m=O,!b()){D(A);return}_()||i.enter("select-osm",{selection:{osm:[x]}}),g=O,y=N=>{let F=N.modified();if(F.length===1){let B=n.staging.graph;l.match(F[0],B)===h?D(M):O()}},c.sidebar.showPresetList(),s.select(".inspector-wrap").on("wheel.intro",ni),e.reveal({revealSelector:".preset-search-input",tipHtml:J(i,"intro.areas.search_playground",{preset:h.name()})}),s.select(".preset-search-input").on("keydown.intro",null).on("keyup.intro",R);function R(){let N=s.select(".preset-list-item:first-child");N.classed("preset-leisure_playground")&&(e.reveal({revealNode:N.select(".preset-list-button").node(),revealPadding:5,tipHtml:J(i,"intro.areas.search_playground",{preset:h.name()})}),s.select(".preset-search-input").on("keydown.intro",ni,!0).on("keyup.intro",null))}})).finally(()=>{g=null,y=null,s.select(".inspector-wrap").on("wheel.intro",null),s.select(".preset-search-input").on("keydown.intro keyup.intro",null)})}function M(){return xt().then(()=>new Promise((D,O)=>{if(m=O,!b()){D(A);return}if(_()||i.enter("select-osm",{selection:{osm:[x]}}),!s.select(".form-field-description").empty()){D(T);return}if(n.staging.graph.entity(x).tags.description){D(P);return}g=O,c.sidebar.showEntityEditor(),s.select(".inspector-wrap").on("wheel.intro",ni);let F=s.select(".more-fields").node().getBoundingClientRect();if(F.top>300){let B=s.select(".entity-editor-pane .inspector-body"),$=B.node().scrollTop,U=$+(F.top-300);B.transition().duration(250).tween("scroll.inspector",()=>{let H=this,z=qt($,U);return function(j){H.scrollTop=z(j)}})}window.setTimeout(()=>{e.reveal({revealSelector:".more-fields .combobox-input",revealPadding:5,tipHtml:J(i,"intro.areas.add_field",{name:d.label(),description:f.label()})}),s.select(".more-fields .combobox-input").on("click.intro",()=>{let B=window.setInterval(()=>{s.select("div.combobox").empty()||(window.clearInterval(B),D(I))},300)})},300)})).finally(()=>{g=null,s.select(".inspector-wrap").on("wheel.intro",null),s.select(".more-fields .combobox-input").on("click.intro",null)})}function I(){if(!b())return Promise.resolve(A);if(!_())return Promise.resolve(S);if(!s.select(".form-field-description").empty())return Promise.resolve(T);if(s.select("div.combobox").empty())return Promise.resolve(M);let D;return new Promise((O,R)=>{m=R,g=R,D=window.setInterval(()=>{s.select("div.combobox").empty()&&(window.clearInterval(D),window.setTimeout(()=>{s.select(".form-field-description").empty()?O(C):O(T)},300))},300),c.sidebar.showEntityEditor(),e.reveal({revealSelector:"div.combobox",revealPadding:5,tipHtml:J(i,"intro.areas.choose_field",{field:f.label()})})}).finally(()=>{g=null,D&&window.clearInterval(D)})}function T(){return b()?_()?s.select(".form-field-description").empty()?Promise.resolve(C):new Promise((D,O)=>{m=O,g=()=>D(P),c.sidebar.showEntityEditor(),e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(i,"intro.areas.describe_playground",{button:ke("#rapid-icon-close","inline")})})}).finally(()=>{g=null}):Promise.resolve(S):Promise.resolve(A)}function C(){return b()?_()?new Promise((D,O)=>{m=O,g=O,c.sidebar.showEntityEditor(),e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(i,"intro.areas.retry_add_field",{field:f.label()}),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>D(M)})}).finally(()=>{g=null}):Promise.resolve(S):Promise.resolve(A)}function P(){return t.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-line",tipHtml:J(i,"intro.areas.play",{next:o.t("intro.lines.title")}),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{p=!1,m=null,g=null,y=null,i.on("modechange",D),n.on("stagingchange",O),w(A).catch(R=>{R instanceof Error&&console.error(R)}).finally(()=>{i.off("modechange",D),n.off("stagingchange",O)});function D(...R){typeof g=="function"&&g(...R)}function O(...R){typeof y=="function"&&y(...R)}},r.exit=()=>{p=!0,m&&(m(),m=null)},r.restart=()=>{r.exit(),r.enter()},me(r,t,"on")}function Dk(i,e){let t=ue("done"),r={title:"intro.lines.title"},s=i.container(),n=i.behaviors.drag,o=i.systems.editor,a=i.systems.l10n,l=i.systems.map,c=i.systems.presets,u=i.systems.ui,h=u.editMenu,d="w646",f=new ie([-85.63016,41.95749],[-85.62937,41.95843]),p=new ie([-85.63044,41.95686],[-85.629,41.95843]),m=[-85.629745,41.95742],g=c.item("category-road_minor"),y=c.item("highway/residential"),x="w525",b="n2862",_=new ie([-85.62457,41.95381],[-85.62326,41.9548]),w=[-85.6239,41.95397],A=[-85.62387,41.95467],k=[-85.62386,41.9543],v="w522",E="w1",S="n3550",M=new ie([-85.62304,41.95084],[-85.62087,41.95336]),I=[-85.622758,41.951884],T=!1,C=null,P=null,D=null,O=null,R=null,N=null;function F(){let ae=o.staging.graph;return N&&ae.hasEntity(N)}function B(){var ce;if(((ce=i.mode)==null?void 0:ce.id)!=="select-osm")return!1;let ae=i.selectedIDs();return ae.length===1&&ae[0]===N}function $(){let ae=o.staging.graph,ce=N&&ae.hasEntity(N),Pe=d&&ae.hasEntity(d);return!ce||!Pe?!1:ae.childNodes(ce).some(ot=>ae.parentWays(ot).some(Nt=>Nt.id===d))}function U(){let ae=o.staging.graph;return ae.hasEntity(x)&&ae.hasEntity(b)}function H(){var ce;if(((ce=i.mode)==null?void 0:ce.id)!=="select-osm")return!1;let ae=i.selectedIDs();return ae.length===1&&ae[0]===x}function z(){let ae=o.staging.graph;return ae.hasEntity(v)&&ae.hasEntity(E)&&ae.hasEntity(S)}function j(){let ae=o.staging.graph;return R&&ae.hasEntity(R)}function X(){var ce;if(((ce=i.mode)==null?void 0:ce.id)!=="select-osm")return!1;let ae=i.selectedIDs();return ae.length===1&&ae[0]===S}function K(ae){return T?Promise.reject():typeof ae!="function"?Promise.resolve():ae().then(ce=>K(ce)).catch(ce=>(ce instanceof Error&&console.error(ce),K(ae)))}function Y(){i.enter("browse"),o.restoreCheckpoint("initial"),N=null;let ae=f.center(),ce=_i(ae,l.center());return ce>0&&e.hide(),l.setCenterZoomAsync(ae,18.5,ce).then(()=>new Promise((Pe,De)=>{C=De,D=()=>Pe(oe),e.reveal({revealSelector:"button.draw-line",tipHtml:J(i,"intro.lines.add_line")}).selectAll(".popover-inner").insert("svg","span").attr("class","tooltip-illustration").append("use").attr("xlink:href","#rapid-graphic-lines")})).finally(()=>{D=null})}function oe(){var ae;return((ae=i.mode)==null?void 0:ae.id)!=="draw-line"?Promise.resolve(Y):(N=null,new Promise((ce,Pe)=>{C=Pe,D=Pe,O=Nt=>{for(let Kt of Nt.created())Kt.type==="way"&&(N=Kt.id,ce(re))};let De=i.lastPointerType==="mouse"?"start_line":"start_line_tap",ot=J(i,"intro.lines.missing_road")+"{br}"+J(i,"intro.lines.line_draw_info")+J(i,`intro.lines.${De}`);e.reveal({revealExtent:f,tipHtml:ot})}).finally(()=>{D=null,O=null}))}function re(){let ae=p.center(),ce=_i(ae,l.center());return l.setCenterZoomAsync(ae,18.5,ce).then(()=>new Promise((Pe,De)=>{var ot;if(C=De,!F()||((ot=i.mode)==null?void 0:ot.id)!=="draw-line"){Pe(Y);return}D=()=>Pe(W),O=()=>{$()&&Pe(Z)},e.reveal({revealExtent:p,tipHtml:J(i,"intro.lines.intersect",{name:a.t("intro.graph.name.flower-street")})})})).finally(()=>{D=null,O=null})}function W(){return new Promise((ae,ce)=>{C=ce,e.reveal({revealExtent:new ie(m).padByMeters(15),tipHtml:J(i,"intro.lines.retry_intersect",{name:a.t("intro.graph.name.flower-street")}),buttonText:a.tHtml("intro.ok"),buttonCallback:()=>ae(Y)})})}function Z(){let ae=p.center(),ce=_i(ae,l.center());return l.setCenterZoomAsync(ae,18.5,ce).then(()=>new Promise((Pe,De)=>{var Kt;if(C=De,!F()||((Kt=i.mode)==null?void 0:Kt.id)!=="draw-line"){Pe(Y);return}D=()=>Pe(Q);let ot=i.lastPointerType==="mouse"?"click":"tap",Nt=J(i,"intro.lines.continue_line")+"{br}"+J(i,`intro.lines.finish_line_${ot}`)+J(i,"intro.lines.finish_road");e.reveal({revealSelector:".main-map",tipHtml:Nt})})).finally(()=>{D=null})}function Q(){let ae;return xt().then(()=>new Promise((ce,Pe)=>{if(C=Pe,!F()){ce(Y);return}if(B()||i.enter("select-osm",{selection:{osm:[N]}}),D=Pe,s.select(".inspector-wrap").on("wheel.intro",ni),ae=s.select(".preset-category_road_minor .preset-list-button"),ae.empty()){Pe(new Error("no minor roads category?"));return}if(ae.classed("expanded")){ce(q);return}e.reveal({revealNode:ae.node(),revealPadding:5,tipHtml:J(i,"intro.lines.choose_category_road",{category:g.name()})}),ae.on("click.intro",()=>ce(q))})).finally(()=>{D=null,ae&&ae.on("click.intro",null),s.select(".inspector-wrap").on("wheel.intro",null)})}function q(){return xt().then(()=>new Promise((ae,ce)=>{if(C=ce,!F()){ae(Y);return}B()||i.enter("select-osm",{selection:{osm:[N]}}),s.select(".inspector-wrap").on("wheel.intro",ni);let Pe=s.select(".preset-category_road_minor .preset-list-button");if(Pe.empty()){ce(new Error("no minor roads category?"));return}if(!Pe.classed("expanded")){ae(Q);return}let De=s.select(".preset-category_road_minor .subgrid");if(De.empty()){ce(new Error("no minor roads presets?"));return}D=ce,O=ot=>{let Nt=ot.modified();if(Nt.length===1){let Kt=o.staging.graph;c.match(Nt[0],Kt)===y?ae($e):ae(pe)}},e.reveal({revealNode:De.node(),revealPadding:5,tipSelector:".preset-highway_residential .preset-list-button",tipHtml:J(i,"intro.lines.choose_preset_residential",{preset:y.name()})})})).finally(()=>{D=null,O=null,s.select(".inspector-wrap").on("wheel.intro",null)})}function pe(){return xt().then(()=>new Promise((ae,ce)=>{if(C=ce,!F()){ae(Y);return}B()||i.enter("select-osm",{selection:{osm:[N]}}),u.sidebar.showPresetList(),s.select(".inspector-wrap").on("wheel.intro",ni);let Pe=s.select(".preset-category_road_minor .preset-list-button");if(Pe.empty()){ce(new Error("no minor roads category?"));return}if(!Pe.classed("expanded")){ae(Q);return}let De=s.select(".preset-highway_residential .preset-list-button");if(De.empty()){ce(new Error("no residential road preset?"));return}D=ce,O=ot=>{let Nt=ot.modified();if(Nt.length===1){let Kt=o.staging.graph;c.match(Nt[0],Kt)===y?ae($e):ae(Q)}},e.reveal({revealNode:De.node(),revealPadding:5,tipHtml:J(i,"intro.lines.retry_preset_residential",{preset:y.name()})})})).finally(()=>{D=null,O=null,s.select(".inspector-wrap").on("wheel.intro",null)})}function $e(){return xt().then(()=>new Promise((ae,ce)=>{if(C=ce,!F()){ae(Y);return}B()||i.enter("select-osm",{selection:{osm:[N]}}),D=()=>ae(nt),u.sidebar.showEntityEditor(),e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(i,"intro.lines.name_road",{button:ke("#rapid-icon-close","inline")}),tooltipClass:"intro-lines-name_road"})})).finally(()=>{D=null})}function nt(){return F()?(o.setCheckpoint("doneAddLine"),new Promise((ae,ce)=>{C=ce,e.reveal({revealSelector:".main-map",tipHtml:J(i,"intro.lines.did_name_road"),buttonText:a.tHtml("intro.ok"),buttonCallback:()=>ae(lt)})})):Promise.resolve(Y)}function lt(){i.enter("browse"),o.restoreCheckpoint("doneAddLine"),U()||o.restoreCheckpoint("initial");let ae=_.center(),ce=_i(ae,l.center());return ce>0&&e.hide(),l.setCenterZoomAsync(ae,19,ce).then(()=>new Promise((Pe,De)=>{C=De,e.reveal({revealExtent:_,tipHtml:J(i,"intro.lines.update_line"),buttonText:a.tHtml("intro.ok"),buttonCallback:()=>Pe(Tt)})}))}function Tt(){return i.enter("browse"),U()?new Promise((ae,ce)=>{C=ce,D=De=>{["browse","select-osm"].includes(De.id)||ce()},O=De=>{De&&De.created().length===1?ae(Yt):ce()};let Pe=i.lastPointerType==="mouse"?"":"_touch";e.reveal({revealExtent:new ie(w).padByMeters(15),tipHtml:J(i,`intro.lines.add_node${Pe}`)})}).finally(()=>{D=null,O=null}):Promise.resolve(lt)}function Yt(){if(!U())return Promise.resolve(lt);let ae;return new Promise((ce,Pe)=>{C=Pe;let De=i.lastPointerType==="mouse"?"":"_touch",ot=J(i,`intro.lines.start_drag_endpoint${De}`)+J(i,"intro.lines.drag_to_intersection");e.reveal({revealExtent:new ie(A).padByMeters(20),tipHtml:ot}),ae=()=>{if(!U())Pe();else{let Kt=o.staging.graph.entity(b);at(Kt.loc,A)<=4&&ce(zi)}},n.on("move",ae)}).finally(()=>{ae&&n.off("move",ae)})}function zi(){if(!U())return Promise.resolve(lt);let ae;return new Promise((ce,Pe)=>{C=Pe,D=()=>ce(oi);let De=i.lastPointerType==="mouse"?"":"_touch",ot=J(i,"intro.lines.spot_looks_good")+J(i,`intro.lines.finish_drag_endpoint${De}`);e.reveal({revealExtent:new ie(A).padByMeters(20),tipHtml:ot}),ae=()=>{if(!U())Pe();else{let Kt=o.staging.graph.entity(b);at(Kt.loc,A)>4&&ce(Yt)}},n.on("move",ae)}).finally(()=>{D=null,ae&&n.off("move",ae)})}function oi(){return U()?(H()||i.enter("select-osm",{selection:{osm:[x]}}),new Promise((ae,ce)=>{C=ce,D=ce,O=Pe=>{Pe&&Pe.created().length===1&&ae(mt)},e.reveal({revealExtent:new ie(k).padByMeters(20),tipHtml:J(i,"intro.lines.start_drag_midpoint")})}).finally(()=>{D=null,O=null})):Promise.resolve(lt)}function mt(){return U()?new Promise((ae,ce)=>{C=ce,e.reveal({revealExtent:_,tipHtml:J(i,"intro.lines.continue_drag_midpoint"),buttonText:a.tHtml("intro.ok"),buttonCallback:()=>{o.setCheckpoint("doneUpdateLine"),ae(Ve)}})}):Promise.resolve(lt)}function Ve(){i.enter("browse"),o.restoreCheckpoint("doneUpdateLine"),z()||o.restoreCheckpoint("initial");let ae=M.center(),ce=_i(ae,l.center());return ce>0&&e.hide(),l.setCenterZoomAsync(ae,18,ce).then(()=>new Promise((Pe,De)=>{C=De,e.reveal({revealExtent:M,tipHtml:J(i,"intro.lines.delete_lines",{street:a.t("intro.graph.name.12th-avenue")}),buttonText:a.tHtml("intro.ok"),buttonCallback:()=>Pe(It)})}))}function It(){return i.enter("browse"),o.restoreCheckpoint("doneUpdateLine"),z()||o.restoreCheckpoint("initial"),R=null,new Promise((ae,ce)=>{C=ce,O=ce;let Pe=i.lastPointerType==="mouse"?"rightclick_intersection":"edit_menu_intersection_touch",De=J(i,"intro.lines.split_street",{street1:a.t("intro.graph.name.11th-avenue"),street2:a.t("intro.graph.name.washington-street")})+J(i,`intro.lines.${Pe}`);e.reveal({revealExtent:new ie(I).padByMeters(10),tipHtml:De}),h.on("toggled.intro",ot=>{ot&&ae(Fs)})}).finally(()=>{O=null,h.on("toggled.intro",null)})}function Fs(){return s.select(".edit-menu-item-split").node()?(R=null,xt().then(()=>new Promise((ce,Pe)=>{if(C=Pe,!z()){ce(Ve);return}X()||i.enter("select-osm",{selection:{osm:[S]}});let De=(ot=0)=>{let Nt=s.select(".edit-menu").node();Nt?e.reveal({duration:ot,revealNode:Nt,revealPadding:50,tipHtml:J(i,"intro.lines.split_intersection",{street:a.t("intro.graph.name.washington-street")})}):Pe()};D=Pe,O=ot=>{P=null,O=null,ot&&ot.created()?(R=ot.created()[0].id,ce()):Pe()},P=De,De(250)})).then(xt).then(()=>o.getUndoAnnotation()===a.t("operations.split.annotation.line",{n:1})?Mo:Vr).finally(()=>{D=null,O=null,P=null})):Promise.resolve(It)}function Vr(){return i.enter("browse"),new Promise((ae,ce)=>{C=ce,e.reveal({revealExtent:M,tipHtml:J(i,"intro.lines.retry_split"),buttonText:a.tHtml("intro.ok"),buttonCallback:()=>ae(It)})})}function Mo(){return z()?j()?new Promise((ae,ce)=>{C=ce,D=()=>ae(cs),O=ce;let De="intro.lines.did_split_"+(i.selectedIDs().length>1?"multi":"single"),ot=a.t("intro.graph.name.washington-street");e.reveal({revealExtent:M,tipHtml:J(i,De,{street1:ot,street2:ot})})}).finally(()=>{D=null,O=null}):Promise.resolve(It):Promise.resolve(Ve)}function cs(){if(!z())return Promise.resolve(Ve);if(!j())return Promise.resolve(It);let ae=i.selectedIDs(),ce=ae.indexOf(R)!==-1,Pe=ae.indexOf(E)!==-1;if(ce&&Pe)return Promise.resolve(ka);if(!ce&&!Pe)return Promise.resolve(Mo);let De,ot;ce?(De=a.t("intro.graph.name.washington-street"),ot=a.t("intro.graph.name.12th-avenue")):(De=a.t("intro.graph.name.12th-avenue"),ot=a.t("intro.graph.name.washington-street"));let Nt=i.lastPointerType==="mouse"?"click":"touch",Kt=J(i,"intro.lines.multi_select",{selected:De,other1:ot})+" "+J(i,`intro.lines.add_to_selection_${Nt}`,{selected:De,other2:ot});return e.reveal({revealExtent:M,tipHtml:Kt}),new Promise((Os,Xr)=>{C=Xr,D=Xr,O=Xr}).finally(()=>{D=null,O=null})}function ka(){if(!z())return Promise.resolve(Ve);if(!j())return Promise.resolve(It);let ae=i.selectedIDs(),ce=ae.indexOf(R)!==-1,Pe=ae.indexOf(E)!==-1;return!ce||!Pe?Promise.resolve(cs):new Promise((De,ot)=>{C=ot,D=ot,O=ot;let Nt=i.lastPointerType==="mouse"?"rightclick":"edit_menu_touch",Kt=J(i,"intro.lines.multi_select_success")+J(i,`intro.lines.multi_${Nt}`);e.reveal({revealExtent:M,tipHtml:Kt}),h.on("toggled.intro",Os=>{Os&&De(Wr)})}).finally(()=>{D=null,O=null,h.on("toggled.intro",null)})}function Wr(){return s.select(".edit-menu-item-delete").node()?xt().then(()=>new Promise((ce,Pe)=>{if(C=Pe,!z()){ce(Ve);return}if(!j()){ce(It);return}let De=i.selectedIDs(),ot=De.indexOf(R)!==-1,Nt=De.indexOf(E)!==-1;if(!ot||!Nt){ce(cs);return}let Kt=(Os=0)=>{let Xr=s.select(".edit-menu").node();Xr?e.reveal({duration:Os,revealNode:Xr,revealPadding:50,tipHtml:J(i,"intro.lines.multi_delete")}):Pe()};D=Os=>{let Xr=o.staging.graph;Os.id==="browse"&&!Xr.hasEntity(R)&&!Xr.hasEntity(E)?ce(Ls):ce(cs)},O=()=>{O=null,D=null;let Os=o.staging.graph;!Os.hasEntity(R)&&!Os.hasEntity(E)?ce(Ls):ce(ji)},P=Kt,Kt(250)})).finally(()=>{D=null,O=null,P=null}):Promise.resolve(cs)}function ji(){return i.enter("browse"),new Promise((ae,ce)=>{C=ce,e.reveal({revealExtent:M,tipHtml:J(i,"intro.lines.retry_delete"),buttonText:a.tHtml("intro.ok"),buttonCallback:()=>ae(cs)})})}function Ls(){return t.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-building",tipHtml:J(i,"intro.lines.play",{next:a.t("intro.buildings.title")}),buttonText:a.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{T=!1,C=null,P=null,D=null,O=null,i.on("modechange",ce),l.on("move",ae),o.on("stagingchange",Pe),K(Y).catch(De=>{De instanceof Error&&console.error(De)}).finally(()=>{i.off("modechange",ce),l.off("move",ae),o.off("stagingchange",Pe)});function ae(...De){typeof P=="function"&&P(...De)}function ce(...De){typeof D=="function"&&D(...De)}function Pe(...De){typeof O=="function"&&O(...De)}},r.exit=()=>{T=!0,C&&(C(),C=null)},r.restart=()=>{r.exit(),r.enter()},me(r,t,"on")}function Rk(i,e){let t=ue("done"),r={title:"intro.buildings.title"},s=i.container(),n=i.systems.editor,o=i.systems.l10n,a=i.systems.map,l=i.systems.presets,c=i.systems.ui,u=c.editMenu,h=new ie([-85.62836,41.95622],[-85.62791,41.95654]),d=new ie([-85.62766,41.95324],[-85.62695,41.95372]),f=l.item("category-building"),p=l.item("building/house"),m=l.item("man_made/storage_tank"),g=!1,y=null,x=null,b=null,_=null,w=null,A=null;function k(){let W=n.staging.graph;return w&&W.hasEntity(w)}function v(){var Z;if(((Z=i.mode)==null?void 0:Z.id)!=="select-osm")return!1;let W=i.selectedIDs();return W.length===1&&W[0]===w}function E(){let W=n.staging.graph;return A&&W.hasEntity(A)}function S(){var Z;if(((Z=i.mode)==null?void 0:Z.id)!=="select-osm")return!1;let W=i.selectedIDs();return W.length===1&&W[0]===A}function M(W){return g?Promise.reject():typeof W!="function"?Promise.resolve():W().then(Z=>M(Z)).catch(Z=>(Z instanceof Error&&console.error(Z),M(W)))}function I(){i.enter("browse"),n.restoreCheckpoint("initial"),w=null;let W=h.center(),Z=_i(W,a.center());return Z>0&&e.hide(),a.setCenterZoomAsync(W,19,Z).then(()=>new Promise((Q,q)=>{y=q,b=()=>Q(T),e.reveal({revealSelector:"button.draw-area",tipHtml:J(i,"intro.buildings.add_building")}).selectAll(".popover-inner").insert("svg","span").attr("class","tooltip-illustration").append("use").attr("xlink:href","#rapid-graphic-buildings")})).finally(()=>{b=null})}function T(){return w=null,a.setCenterZoomAsync(h.center(),20,200).then(()=>new Promise((W,Z)=>{var pe;if(y=Z,((pe=i.mode)==null?void 0:pe.id)!=="draw-area"){W(I);return}b=Z,_=$e=>{for(let nt of $e.created())nt.type==="way"&&(w=nt.id,W(C))};let Q=i.lastPointerType==="mouse"?"click":"tap",q=J(i,"intro.buildings.start_building")+J(i,`intro.buildings.building_corner_${Q}`);e.reveal({revealExtent:h,tipHtml:q})})).finally(()=>{b=null,_=null})}function C(){var W;return!k()||((W=i.mode)==null?void 0:W.id)!=="draw-area"?Promise.resolve(I):new Promise((Z,Q)=>{y=Q,b=()=>{if(k()&&v()){let $e=n.staging.graph,nt=$e.entity(w),lt=$e.childNodes(nt),Tt=Fe(lt).map(Yt=>i.projection.project(Yt.loc));kk(Tt)?Z(D):Z(P)}else Q()};let q=i.lastPointerType==="mouse"?"click":"tap",pe=J(i,"intro.buildings.continue_building")+"{br}"+J(i,`intro.areas.finish_area_${q}`)+J(i,"intro.buildings.finish_building");e.reveal({revealExtent:h,tipHtml:pe})}).finally(()=>{b=null})}function P(){return new Promise((W,Z)=>{y=Z,e.reveal({revealExtent:h,tipHtml:J(i,"intro.buildings.retry_building"),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>W(I)})})}function D(){return xt().then(()=>new Promise((W,Z)=>{if(y=Z,!k()){W(I);return}v()||i.enter("select-osm",{selection:{osm:[w]}}),b=Z,c.sidebar.showPresetList(),s.select(".inspector-wrap").on("wheel.intro",ni);let Q=s.select(".preset-category_building .preset-list-button");if(Q.empty()){W(I);return}e.reveal({revealNode:Q.node(),revealPadding:5,tipHtml:J(i,"intro.buildings.choose_category_building",{category:f.name()})}),Q.on("click.intro",()=>W(O))})).finally(()=>{b=null,s.select(".inspector-wrap").on("wheel.intro",null),s.select(".preset-list-button").on("click.intro",null)})}function O(){return xt().then(()=>new Promise((W,Z)=>{if(y=Z,!k()){W(I);return}v()||i.enter("select-osm",{selection:{osm:[w]}}),b=Z,_=q=>{let pe=q.modified();if(pe.length===1){let $e=n.staging.graph;l.match(pe[0],$e)===p?W(R):W(D)}},s.select(".inspector-wrap").on("wheel.intro",ni);let Q=s.select(".preset-building_house .preset-list-button");if(Q.empty()){W(I);return}e.reveal({revealNode:Q.node(),revealPadding:5,tipHtml:J(i,"intro.buildings.choose_preset_house",{preset:p.name()})})})).finally(()=>{b=null,_=null,s.select(".inspector-wrap").on("wheel.intro",null),s.select(".preset-list-button").on("click.intro",null)})}function R(){if(!k())return Promise.resolve(I);let W=n.staging.graph,Z=W.entity(w),Q=l.match(Z,W);return Q!==p&&(n.perform(xr(w,Q,p)),n.commit({annotation:o.t("operations.change_tags.annotation"),selectedIDs:[w]})),n.setCheckpoint("hasHouse"),Promise.resolve(N)}function N(){var Z;["browse","select-osm"].includes((Z=i.mode)==null?void 0:Z.id)||i.enter("browse"),n.restoreCheckpoint("hasHouse");let W=Math.max(a.zoom(),20);return a.setCenterZoomAsync(h.center(),W,100).then(()=>new Promise((Q,q)=>{y=q,_=q;let pe=i.lastPointerType==="mouse"?"rightclick_building":"edit_menu_building_touch";e.reveal({revealExtent:h,tipHtml:J(i,`intro.buildings.${pe}`)}),u.on("toggled.intro",$e=>{$e&&Q(F)})})).finally(()=>{_=null,u.on("toggled.intro",null)})}function F(){return s.select(".edit-menu-item-orthogonalize").node()?xt().then(()=>new Promise((Z,Q)=>{if(y=Q,!k()||!v()){Z(N);return}let q=(pe=0)=>{let $e=s.select(".edit-menu").node();$e?e.reveal({duration:pe,revealNode:$e,revealPadding:50,tipHtml:J(i,"intro.buildings.square_building")}):Q()};b=Q,_=()=>{_=null,x=null,e.reveal({revealExtent:h}),Z()},x=q,q(250)})).then(xt).then(()=>n.getUndoAnnotation()===o.t("operations.orthogonalize.annotation.feature",{n:1})?$:B).finally(()=>{x=null,b=null,_=null}):Promise.resolve(N)}function B(){return i.enter("browse"),new Promise((W,Z)=>{y=Z,e.reveal({revealExtent:h,tipHtml:J(i,"intro.buildings.retry_square"),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>W(N)})})}function $(){return n.setCheckpoint("doneSquare"),new Promise((W,Z)=>{y=Z,e.reveal({revealExtent:h,tipHtml:J(i,"intro.buildings.done_square"),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>W(U)})})}function U(){i.enter("browse"),n.restoreCheckpoint("doneSquare"),A=null;let W=d.center(),Z=_i(W,a.center());return Z>0&&e.hide(),a.setCenterZoomAsync(W,19.5,Z).then(()=>new Promise((Q,q)=>{y=q,b=()=>Q(H),e.reveal({revealSelector:"button.draw-area",tipHtml:J(i,"intro.buildings.add_tank")})})).finally(()=>{b=null})}function H(){var W;return((W=i.mode)==null?void 0:W.id)!=="draw-area"?Promise.resolve(U):(A=null,new Promise((Z,Q)=>{y=Q,b=Q,_=$e=>{for(let nt of $e.created())nt.type==="way"&&(A=nt.id,Z(z))};let q=i.lastPointerType==="mouse"?"click":"tap",pe=J(i,"intro.buildings.start_tank")+J(i,`intro.buildings.tank_edge_${q}`);e.reveal({revealExtent:d,tipHtml:pe})}).finally(()=>{b=null,_=null}))}function z(){var W;return((W=i.mode)==null?void 0:W.id)!=="draw-area"?Promise.resolve(U):new Promise((Z,Q)=>{y=Q,b=()=>{E()&&S()?Z(j):Q()};let q=i.lastPointerType==="mouse"?"click":"tap",pe=J(i,"intro.buildings.continue_tank")+"{br}"+J(i,`intro.areas.finish_area_${q}`)+J(i,"intro.buildings.finish_tank");e.reveal({revealExtent:d,tipHtml:pe})}).finally(()=>{b=null})}function j(){return xt().then(()=>new Promise((W,Z)=>{if(y=Z,!E()){W(U);return}S()||i.enter("select-osm",{selection:{osm:[A]}}),b=Z,_=q=>{let pe=q.modified();if(pe.length===1){let $e=n.staging.graph;l.match(pe[0],$e)===m?W(X):Z()}},s.select(".inspector-wrap").on("wheel.intro",ni),c.sidebar.showPresetList(),e.reveal({revealSelector:".preset-search-input",tipHtml:J(i,"intro.buildings.search_tank",{preset:m.name()})}),s.select(".preset-search-input").on("keydown.intro",null).on("keyup.intro",Q);function Q(){let q=s.select(".preset-list-item:first-child");q.classed("preset-man_made_storage_tank")&&(e.reveal({revealNode:q.select(".preset-list-button").node(),revealPadding:5,tipHtml:J(i,"intro.buildings.choose_tank",{preset:m.name()})}),s.select(".preset-search-input").on("keydown.intro",ni,!0).on("keyup.intro",null))}})).finally(()=>{b=null,_=null,s.select(".inspector-wrap").on("wheel.intro",null),s.select(".preset-search-input").on("keydown.intro keyup.intro",null)})}function X(){if(!E())return Promise.resolve(U);let W=n.staging.graph,Z=W.entity(A),Q=l.match(Z,W);return Q!==m&&(n.perform(xr(A,Q,m)),n.commit({annotation:o.t("operations.change_tags.annotation"),selectedIDs:[A]})),n.setCheckpoint("hasTank"),Promise.resolve(K)}function K(){var W;return["browse","select-osm"].includes((W=i.mode)==null?void 0:W.id)||i.enter("browse"),n.restoreCheckpoint("hasTank"),new Promise((Z,Q)=>{y=Q,_=Q;let q=i.lastPointerType==="mouse"?"rightclick_tank":"edit_menu_tank_touch";e.reveal({revealExtent:d,tipHtml:J(i,`intro.buildings.${q}`)}),u.on("toggled.intro",pe=>{pe&&Z(Y)})}).finally(()=>{_=null,u.on("toggled.intro",null)})}function Y(){return s.select(".edit-menu-item-circularize").node()?xt().then(()=>new Promise((Z,Q)=>{if(y=Q,!E()||!S()){Z(K);return}b=Q;let q=(pe=0)=>{let $e=s.select(".edit-menu").node();$e?e.reveal({duration:pe,revealNode:$e,revealPadding:50,tipHtml:J(i,"intro.buildings.circle_tank")}):Q()};_=()=>{x=null,_=null,e.reveal({revealExtent:d}),Z()},x=q,q(250)})).then(xt).then(()=>n.getUndoAnnotation()===o.t("operations.circularize.annotation.feature",{n:1})?re:oe).finally(()=>{x=null,b=null,_=null}):Promise.resolve(K)}function oe(){return i.enter("browse"),new Promise((W,Z)=>{y=Z,e.reveal({revealExtent:d,tipHtml:J(i,"intro.buildings.retry_circle"),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>W(K)})})}function re(){return t.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-rapid",tipHtml:J(i,"intro.buildings.play",{next:o.t("intro.rapid.title")}),buttonText:o.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{g=!1,y=null,x=null,b=null,_=null,i.on("modechange",Z),a.on("move",W),n.on("stablechange",Q),M(I).catch(q=>{q instanceof Error&&console.error(q)}).finally(()=>{i.off("modechange",Z),a.off("move",W),n.off("stablechange",Q)});function W(...q){typeof x=="function"&&x(...q)}function Z(...q){typeof b=="function"&&b(...q)}function Q(...q){typeof _=="function"&&_(...q)}},r.exit=()=>{g=!0,y&&(y(),y=null)},r.restart=()=>{r.exit(),r.enter()},me(r,t,"on")}function Nk(i,e){let t=ue("done"),r={title:"intro.startediting.title"},s=i.container(),n=i.systems.l10n,o=!1,a=null;function l(f){return o?Promise.reject():typeof f!="function"?Promise.resolve():f().then(p=>l(p)).catch(p=>(p instanceof Error&&console.error(p),l(f)))}function c(){return new Promise((f,p)=>{a=p,e.reveal({revealSelector:".map-control.help-control",tipHtml:J(i,"intro.startediting.help"),buttonText:n.tHtml("intro.ok"),buttonCallback:()=>f(u)})})}function u(){return new Promise((f,p)=>{a=p,e.reveal({revealSelector:".map-control.help-control",tipHtml:J(i,"intro.startediting.shortcuts"),buttonText:n.tHtml("intro.ok"),buttonCallback:()=>f(h)})})}function h(){return s.selectAll(".shaded").remove(),new Promise((f,p)=>{a=p,e.reveal({revealSelector:".top-toolbar button.save",tipHtml:J(i,"intro.startediting.save"),buttonText:n.tHtml("intro.ok"),buttonCallback:()=>f(d)})})}function d(){s.selectAll(".shaded").remove();let f=Vt(s);return f.select(".modal").attr("class","modal-splash modal"),f.selectAll(".close").remove(),new Promise((p,m)=>{a=m;let g=f.select(".content").attr("class","fillL").append("button").attr("class","modal-section huge-modal-button").on("click",()=>{p(),t.call("done")});g.append("svg").attr("class","illustration").append("use").attr("xlink:href","#rapid-logo-walkthrough"),g.append("h2").html(n.tHtml("intro.startediting.start"))}).finally(()=>{f.remove()})}return r.enter=()=>{o=!1,a=null,l(c).catch(f=>{f instanceof Error&&console.error(f)})},r.exit=()=>{s.selectAll(".shaded").remove(),o=!0,a&&(a(),a=null)},me(r,t,"on")}function Fk(i,e){let t=ue("done"),r={title:"intro.rapid.title"},s=i.systems.editor,n=i.systems.l10n,o=i.systems.map,a=i.systems.rapid,l=i.systems.ui,c="w-516",u=new ie([-85.62991,41.95568],[-85.627,41.95638]),h=!1,d=null,f=null;function p(){var P;if(!["select","select-osm"].includes((P=i.mode)==null?void 0:P.id))return!1;let C=i.selectedIDs();return C.length===1&&C[0]===c}function m(){return s.staging.graph.hasEntity(c)}function g(C){return h?Promise.reject():typeof C!="function"?Promise.resolve():C().then(P=>g(P)).catch(P=>(P instanceof Error&&console.error(P),g(C)))}function y(){i.enter("browse"),s.restoreCheckpoint("initial"),i.scene().enableLayers("rapid");let C=a.datasets.get("rapid_intro_graph");C.enabled=!0;let P=u.center(),D=_i(P,o.center());return D>0&&e.hide(),o.setCenterZoomAsync(P,18.5,D).then(()=>new Promise((O,R)=>{d=R,e.reveal({revealSelector:".intro-nav-wrap .chapter-rapid",tipHtml:J(i,"intro.rapid.start",{rapid:ke("#rapid-logo-rapid-wordmark","pre-text rapid")}),buttonText:n.tHtml("intro.ok"),buttonCallback:()=>O(x)})}))}function x(){return new Promise((C,P)=>{d=P,e.reveal({revealSelector:"button.rapid-features",tipHtml:J(i,"intro.rapid.ai_roads",{rapid:ke("#rapid-logo-rapid-wordmark","pre-text rapid")}),buttonText:n.tHtml("intro.ok"),buttonCallback:()=>C(b)})})}function b(){i.enter("browse"),s.restoreCheckpoint("initial"),l.togglePanes(),i.scene().enableLayers("rapid");let C=a.datasets.get("rapid_intro_graph");return C.enabled=!0,new Promise((P,D)=>{d=D,f=()=>P(_),G(".inspector-wrap").on("wheel.intro",ni),e.reveal({revealExtent:u,tipHtml:J(i,"intro.rapid.select_road")})}).finally(()=>{f=null,G(".inspector-wrap").on("wheel.intro",null)})}function _(){return xt().then(()=>new Promise((C,P)=>{if(d=P,!p()){C();return}f=C,e.reveal({revealSelector:".rapid-inspector-choice-accept",tipHtml:J(i,"intro.rapid.add_road")})})).then(()=>{var C;return((C=s.getUndoAnnotation())==null?void 0:C.type)==="rapid_accept_feature"?w:b}).finally(()=>{f=null})}function w(){return xt().then(()=>new Promise((C,P)=>{if(d=P,!m()){C(b);return}p()||i.enter("select-osm",{selection:{osm:[c]}}),f=P,e.reveal({revealExtent:u,tipHtml:J(i,"intro.rapid.add_road_not_saved_yet",{rapid:ke("#rapid-logo-rapid-wordmark","pre-text rapid")}),buttonText:n.t("intro.ok"),buttonCallback:()=>C(A)})})).finally(()=>{f=null})}function A(){if(!m())return Promise.resolve(b);p()||i.enter("select-osm",{selection:{osm:[c]}});let C=G("div.map-control.issues-control > button");return new Promise((P,D)=>{d=D,f=D,e.reveal({revealNode:C.node(),tipHtml:J(i,"intro.rapid.open_issues")}),C.on("click.intro",()=>P(k))}).finally(()=>{f=null,C.on("click.intro",null)})}function k(){return xt().then(()=>new Promise((C,P)=>{if(d=P,!m()){C(b);return}p()||i.enter("select-osm",{selection:{osm:[c]}});let D=G("li.issue.severity-warning");e.reveal({revealNode:D.node(),revealPadding:5,tipHtml:J(i,"intro.rapid.new_lints"),buttonText:n.t("intro.ok"),buttonCallback:()=>C(v)})}))}function v(){if(!m())return Promise.resolve(b);p()||i.enter("select-osm",{selection:{osm:[c]}});let C=G(".top-toolbar button.undo-button");return new Promise((P,D)=>{d=D,e.reveal({revealNode:C.node(),tipHtml:J(i,"intro.rapid.undo_road_add",{button:ke("#rapid-icon-undo","pre-text")})}),C.on("click.intro",()=>P(E))}).finally(()=>{C.on("click.intro",null)})}function E(){return m()?Promise.resolve(b):(l.togglePanes(),new Promise((C,P)=>{d=P,e.reveal({revealExtent:u,tipHtml:J(i,"intro.rapid.undo_road_add_aftermath"),buttonText:n.t("intro.ok"),buttonCallback:()=>C(S)})}))}function S(){i.enter("browse"),s.restoreCheckpoint("initial"),i.scene().enableLayers("rapid");let C=a.datasets.get("rapid_intro_graph");C.enabled=!0;let P=u.center(),D=_i(P,o.center());return D>0&&e.hide(),o.setCenterZoomAsync(P,18.5,D).then(()=>new Promise((O,R)=>{d=R,f=()=>{i.selectedIDs().includes(c)&&O(M)},e.reveal({revealExtent:u,tipHtml:J(i,"intro.rapid.select_road_again")})})).finally(()=>{f=null})}function M(){return xt().then(()=>new Promise((C,P)=>{if(d=P,!p()){C();return}f=C,e.reveal({revealSelector:".rapid-inspector-choice-ignore",tipHtml:J(i,"intro.rapid.ignore_road")})})).then(()=>{var C;return((C=s.getUndoAnnotation())==null?void 0:C.type)==="rapid_ignore_feature"?I:S}).finally(()=>{f=null})}function I(){return new Promise((C,P)=>{d=P,e.reveal({revealSelector:".map-control.help-control",tipHtml:J(i,"intro.rapid.help",{rapid:ke("#rapid-logo-rapid-wordmark","pre-text rapid"),button:ke("#rapid-icon-help","pre-text"),key:n.t("help.key")}),buttonText:n.t("intro.ok"),buttonCallback:()=>C(T)})})}function T(){return t.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-startEditing",tipHtml:J(i,"intro.rapid.done",{next:n.t("intro.startediting.title")}),buttonText:n.tHtml("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{i.scene().enableLayers("rapid"),h=!1,d=null,f=null,i.on("modechange",C),g(y).catch(P=>{P instanceof Error&&console.error(P)}).finally(()=>{i.off("modechange",C)});function C(...P){typeof f=="function"&&f(...P)}},r.exit=()=>{i.scene().disableLayers("rapid");let C=a.datasets.get("rapid_intro_graph");C.enabled=!1,h=!0,d&&(d(),d=null)},r.restart=()=>{r.exit(),r.enter()},me(r,t,"on")}var _H="EsriWorldImageryClarity",bH={welcome:Tk,navigation:Ik,point:Mk,area:Pk,line:Dk,building:Rk,rapid:Fk,startEditing:Nk},mu=["welcome","navigation","point","area","line","building","rapid","startEditing"];function an(i,e){let t=i.systems.dataloader,r=i.systems.editor,s=i.systems.imagery,n=i.systems.l10n,o=i.systems.map,a=i.services.mapwithai,l=i.services.osm,c=i.systems.rapid,u=i.systems.storage,h=i.systems.urlhash,d=i.systems.ui,f={},p={},m={},g=[],y,x,b,_;function w(E){Promise.all([t.getDataAsync("intro_rapid_graph"),t.getDataAsync("intro_graph")]).then(S=>{let M=S[0],I=S[1];for(let[T,C]of Object.entries(M))p[T]||(p[T]=de(eg(i,C)));for(let[T,C]of Object.entries(I))f[T]||(f[T]=de(eg(i,C)));E.call(A)})}function A(E){h.pause(),l==null||l.pause(),a==null||a.pause(),i.inIntro=!0,i.enter("browse"),m={hash:window.location.hash,transform:o.transform(),brightness:s.brightness,baseLayer:s.baseLayerSource(),overlayLayers:s.overlayLayerSources(),layersEnabled:new Set,datasetsEnabled:new Set,edits:r.toJSON()};for(let[C,P]of i.scene().layers)P.enabled&&m.layersEnabled.add(C);i.scene().onlyLayers(["background","osm","labels"]);for(let[C,P]of c.datasets)P.enabled&&(m.datasetsEnabled.add(C),P.enabled=!1);c.datasets.set("rapid_intro_graph",{id:"rapid_intro_graph",beta:!1,added:!0,enabled:!1,conflated:!1,service:"mapwithai",color:"#da26d3",dataUsed:[],label:"Rapid Walkthrough"}),d.sidebar.expand(),i.container().selectAll("button.sidebar-toggle").classed("disabled",!0);let S=s.getSource(_H)||s.getSource("Bing");s.baseLayerSource(S),m.overlayLayers.forEach(C=>s.toggleOverlayLayer(C)),s.brightness=1,b=new z6(i),E.call(b.enable),u.setItem("walkthrough_started","yes"),g=(u.getItem("walkthrough_progress")||"").split(";").filter(Boolean);let I=mu.map((C,P)=>{let D=bH[C](i,b).on("done",()=>{if(x.filter(O=>O.title===D.title).classed("finished",!0),g.push(C),u.setItem("walkthrough_progress",Fe(g).join(";")),P<mu.length-1){let O=mu[P+1];i.container().select(`button.chapter-${O}`).classed("next",!0)}else v()});return D});_=E.append("div").attr("class","intro-nav-wrap fillD"),_.append("svg").attr("class","intro-nav-wrap-logo").append("use").attr("xlink:href","#rapid-logo-walkthrough"),x=_.append("div").attr("class","joined").selectAll("button.chapter").data(I).enter().append("button").attr("class",(C,P)=>`chapter chapter-${mu[P]}`).on("click",k),x.append("span").html(C=>n.tHtml(C.title)),x.append("span").attr("class","status").call(V(n.isRTL()?"#rapid-icon-backward":"#rapid-icon-forward","inline")),i.resetAsync().then(()=>{r.merge(Object.values(f)),a==null||a.merge("rapid_intro_graph",Object.values(p)),r.setCheckpoint("initial"),k(null,I[e?6:0])})}function k(E,S){y&&y.exit(),i.enter("browse"),y=S,y.enter(),x.classed("next",!1).classed("active",M=>M.title===y.title)}function v(){Di(mu,g).length||u.setItem("walkthrough_completed","yes");for(let[S,M]of c.datasets)M.enabled=m.datasetsEnabled.has(S);c.datasets.delete("rapid_intro_graph"),b.disable(),_.remove(),i.container().selectAll("button.sidebar-toggle").classed("disabled",!1);for(let[S,M]of i.scene().layers)M.enabled=m.layersEnabled.has(S);s.baseLayerSource(m.baseLayer),m.overlayLayers.forEach(S=>s.toggleOverlayLayer(S)),s.brightness=m.brightness,o.transform(m.transform),window.location.replace(m.hash),i.inIntro=!1,l==null||l.resume(),a==null||a.resume(),h.resume(),i.resetAsync().then(()=>m.edits?r.fromJSONAsync(m.edits):Promise.resolve())}return w}var zn=class{constructor(e){this.context=e,this._enabled=!1}enable(){this._enabled=!0}disable(){this._enabled=!1}get enabled(){return this._enabled}};var Lk=["zoom","vintage","source","description","resolution","accuracy"],gu=class extends zn{constructor(e){super(e),this.id="background";let t=e.systems.l10n;this.title=t.t("info_panels.background.title"),this.key=t.t("info_panels.background.key"),this._selection=G(null),this._currSourceID=null,this._metadata={},this.render=this.render.bind(this),this.updateMetadata=this.updateMetadata.bind(this),this._deferredRender=wt(this.render,250),this._deferredUpdateMetadata=wt(this.updateMetadata,250)}enable(e){this._enabled||(this._enabled=!0,this._selection=e,this._currSourceID=null,this._metadata={},this.context.systems.map.on("draw",this._deferredRender).on("move",this._deferredUpdateMetadata))}disable(){this._enabled&&(this._deferredRender.cancel(),this._deferredUpdateMetadata.cancel(),this._selection.html(""),this._enabled=!1,this._selection=G(null),this._currSourceID=null,this._metadata={},this.context.systems.map.off("draw",this._deferredRender).off("move",this._deferredUpdateMetadata))}render(){if(!this._enabled)return;let e=this.context,t=this._selection,r=e.systems.imagery,s=e.systems.l10n,n=r.baseLayerSource();if(!n)return;this._currSourceID!==n.id&&(this._currSourceID=n.id,this._metadata={}),t.html("");let o=t.append("ul").attr("class","background-info");o.append("li").text(n.name),Lk.forEach(l=>{o.append("li").attr("class",`background-info-list-${l}`).classed("hide",!this._metadata[l]).text(s.t(`info_panels.background.${l}`)+":").append("span").attr("class",`background-info-span-${l}`).text(this._metadata[l])}),this._deferredUpdateMetadata();let a=e.getDebug("tile")?"hide_tiles":"show_tiles";t.append("a").text(s.t(`info_panels.background.${a}`)).attr("href","#").attr("class","button button-toggle-tiles").on("click",l=>{l.preventDefault(),e.setDebug("tile",!e.getDebug("tile")),this.render()})}updateMetadata(){if(!this._enabled)return;let e=this.context,t=this._selection,r=e.systems.imagery,s=e.systems.l10n,n=r.baseLayerSource();if(!n)return;this._currSourceID!==n.id&&(this._currSourceID=n.id,this._metadata={});let o=e.systems.map.center(),a=new ie(o),l=e.scene().layers.get("background"),c=l==null?void 0:l._tileMaps.get(n.id),u,h;if(c){for(let f of c.values())if(f.loaded&&f.wgs84Extent.contains(a)){u=f.xyz,h=f.xyz[2];break}}let d=h||Math.floor(e.systems.map.zoom());this._metadata.zoom=String(d),t.selectAll(".background-info-list-zoom").classed("hide",!1).selectAll(".background-info-span-zoom").text(this._metadata.zoom),u&&n.getMetadata(o,u,(f,p)=>{if(f||this._currSourceID!==n.id)return;let m=p.vintage;this._metadata.vintage=m&&m.range||s.t("info_panels.background.unknown"),t.selectAll(".background-info-list-vintage").classed("hide",!1).selectAll(".background-info-span-vintage").text(this._metadata.vintage),Lk.forEach(g=>{if(g==="zoom"||g==="vintage")return;let y=p[g];this._metadata[g]=y,t.selectAll(`.background-info-list-${g}`).classed("hide",!y).selectAll(`.background-info-span-${g}`).text(y)})})}};var yu=class extends zn{constructor(e){super(e),this.id="history";let t=e.systems.l10n;this.title=t.t("info_panels.history.title"),this.key=t.t("info_panels.history.key"),this._selection=G(null),this.render=this.render.bind(this),this.renderEntity=this.renderEntity.bind(this),this.renderNote=this.renderNote.bind(this),this.renderUser=this.renderUser.bind(this),this.renderChangeset=this.renderChangeset.bind(this),this.displayTimestamp=this.displayTimestamp.bind(this)}enable(e){this._enabled||(this._enabled=!0,this._selection=e,this.context.systems.map.on("draw",this.render),this.context.on("modechange",this.render))}disable(){this._enabled&&(this._selection.html(""),this._enabled=!1,this._selection=G(null),this.context.systems.map.off("draw",this.render),this.context.off("modechange",this.render))}render(){if(!this._enabled)return;let e=this.context,t=this._selection,r=e.systems.editor.staging.graph,s=e.systems.l10n;t.html("");let n,o,a;n=e.selectedIDs().filter(c=>r.hasEntity(c)),n.length&&(a=r.entity(n[0]));let l=n.length===1?n[0]:null;t.append("h4").attr("class","history-heading").text(l||s.t("info_panels.selected",{n:n.length})),l&&(a?t.call(this.renderEntity,a):o&&t.call(this.renderNote,o))}renderNote(e,t){let r=this.context,s=r.systems.l10n,n=r.services.osm;if(!t||t.isNew()){e.append("div").text(s.t("info_panels.history.note_no_history"));return}let o=e.append("ul");o.append("li").text(s.t("info_panels.history.note_comments")+":").append("span").text(t.comments.length),t.comments.length&&(o.append("li").text(s.t("info_panels.history.note_created_date")+":").append("span").text(this.displayTimestamp(t.comments[0].date)),o.append("li").text(s.t("info_panels.history.note_created_user")+":").call(this.renderUser,t.comments[0].user)),n&&e.append("a").attr("class","view-history-on-osm").attr("target","_blank").attr("href",n.noteURL(t)).call(V("#rapid-icon-out-link","inline")).append("span").text(s.t("info_panels.history.note_link_text"))}renderEntity(e,t){let r=this.context,s=r.systems.l10n,n=r.services.osm;if(!t||t.isNew()){e.append("div").text(s.t("info_panels.history.no_history"));return}let o=e.append("div").attr("class","links");n&&o.append("a").attr("class","view-history-on-osm").attr("href",n.historyURL(t)).attr("target","_blank").attr("title",s.t("info_panels.history.link_text")).text("OSM"),o.append("a").attr("class","pewu-history-viewer-link").attr("href","https://pewu.github.io/osm-history/#/"+t.type+"/"+t.osmId()).attr("target","_blank").attr("tabindex",-1).text("PeWu");let a=e.append("ul");a.append("li").text(s.t("info_panels.history.version")+":").append("span").text(t.version),a.append("li").text(s.t("info_panels.history.last_edit")+":").append("span").text(this.displayTimestamp(t.timestamp)),a.append("li").text(s.t("info_panels.history.edited_by")+":").call(this.renderUser,t.user),a.append("li").text(s.t("info_panels.history.changeset")+":").call(this.renderChangeset,t.changeset)}displayTimestamp(e){let t=this.context,r=t.systems.l10n;if(!e)return r.t("info_panels.history.unknown");let s={day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},n=new Date(e);if(isNaN(n.getTime()))return r.t("info_panels.history.unknown");let o=t.systems.l10n.localeCode();return n.toLocaleString(o,s)}renderUser(e,t){let r=this.context,s=r.systems.l10n,n=r.services.osm;if(!t){e.append("span").text(s.t("info_panels.history.unknown"));return}e.append("span").attr("class","user-name").text(t);let o=e.append("div").attr("class","links");n&&o.append("a").attr("class","user-osm-link").attr("href",n.userURL(t)).attr("target","_blank").text("OSM"),o.append("a").attr("class","user-hdyc-link").attr("href",`https://hdyc.neis-one.org/?${t}`).attr("target","_blank").attr("tabindex",-1).text("HDYC")}renderChangeset(e,t){let r=this.context,s=r.systems.l10n,n=r.services.osm;if(!t){e.append("span").text(s.t("info_panels.history.unknown"));return}e.append("span").attr("class","changeset-id").text(t);let o=e.append("div").attr("class","links");n&&o.append("a").attr("class","changeset-osm-link").attr("href",n.changesetURL(t)).attr("target","_blank").text("OSM"),o.append("a").attr("class","changeset-osmcha-link").attr("href",`https://osmcha.org/changesets/${t}`).attr("target","_blank").text("OSMCha"),o.append("a").attr("class","changeset-achavi-link").attr("href",`https://overpass-api.de/achavi/?changeset=${t}`).attr("target","_blank").text("Achavi")}};var xu=class extends zn{constructor(e){super(e),this.id="location";let t=e.systems.l10n;this.title=t.t("info_panels.location.title"),this.key=t.t("info_panels.location.key"),this._selection=G(null),this._currLocation=null,this.render=this.render.bind(this),this.updateLocation=this.updateLocation.bind(this),this._deferredUpdateLocation=wt(this.updateLocation,1e3)}enable(e){this._enabled||(this._enabled=!0,this._selection=e,this._currLocation=null,this.context.surface().on("pointermove.info-location",this.render))}disable(){this._enabled&&(this._deferredUpdateLocation.cancel(),this._selection.html(""),this._enabled=!1,this._selection=G(null),this._currLocation=null,this.context.surface().on("pointermove.info-location",null))}render(){if(!this._enabled)return;let e=this.context,t=this._selection,r=e.systems.l10n;t.html("");let s=t.append("ul"),n=e.systems.map.mouseLoc();n.some(isNaN)&&(n=e.systems.map.center()),s.append("li").text(r.dmsCoordinatePair(n)).append("li").text(r.decimalCoordinatePair(n)),t.append("div").attr("class","location-info").text(this._currLocation||" "),this._deferredUpdateLocation(n)}updateLocation(e){if(!this._enabled)return;let t=this._selection,r=this.context,s=r.systems.l10n,n=r.services.nominatim;n?n.reverse(e,(o,a)=>{this._currLocation=a?a.display_name:s.t("info_panels.location.unknown_location"),t.selectAll(".location-info").text(this._currLocation)}):(this._currLocation=s.t("info_panels.location.unknown_location"),t.selectAll(".location-info").text(this._currLocation))}};function wH(i){return i*63710071809e-4}function EH(i){return i/(4*Math.PI)*510065621724e3}function AH(i){if(i.type==="LineString")return i;let e={type:"LineString",coordinates:[]};return i.type==="Polygon"?e.coordinates=i.coordinates[0]:i.type==="MultiPolygon"&&(e.coordinates=i.coordinates[0][0]),e}var vu=class extends zn{constructor(e){super(e),this.id="measurement";let t=e.systems.l10n;this.title=t.t("info_panels.measurement.title"),this.key=t.t("info_panels.measurement.key"),this._selection=G(null),this._isImperial=!t.usesMetric(),this.render=this.render.bind(this)}enable(e){this._enabled||(this._enabled=!0,this._selection=e,this.context.systems.map.on("draw",this.render),this.context.on("modechange",this.render))}disable(){this._enabled&&(this._selection.html(""),this._enabled=!1,this._selection=G(null),this.context.systems.map.off("draw",this.render),this.context.off("modechange",this.render))}render(){if(!this._enabled)return;let e=this._selection,t=this.context,r=t.systems.l10n,s=t.systems.editor.staging.graph,n=r.localeCode();e.html("");let o,a,l,c,u,h,d,f=0,p=0,m,g=t.selectedIDs(),y=t.selectedData(),[x]=y.values();if(y.size===1&&x instanceof _t){let w=x;o=r.t("note.note")+" "+w.id,l=w.loc,h="note"}else{let w=g.map(A=>s.hasEntity(A)).filter(Boolean);if(w.length===1?o=w[0].id:o=r.t("info_panels.selected",{n:w.length}),w.length>0){let A=new ie;w.forEach(k=>{let v=k.extent(s),E=k.asGeoJSON(s);A=A.extend(v),h=k.geometry(s),(h==="line"||h==="area")&&(u=k.type==="relation"||k.isClosed()&&!k.isDegenerate(),f+=wH(F7(AH(E))),c=D7(E),(!c||!isFinite(c[0])||!isFinite(c[1]))&&(c=v.center()),u&&(p+=EH(k.area(s))))}),w.length>1&&(h=null,u=null,c=null),w.length===2&&w[0].type==="node"&&w[1].type==="node"&&(m=at(w[0].loc,w[1].loc)),w.length===1&&w[0].type==="node"?l=w[0].loc:d=Ft(g,s).length,!l&&!c&&(a=A.center())}}o&&e.append("h4").attr("class","measurement-heading").text(o);let b=e.append("ul"),_;if(h&&b.append("li").text(r.t("info_panels.measurement.geometry")+":").append("span").text(u?r.t("info_panels.measurement.closed_"+h):r.t("geometry."+h)),d&&b.append("li").text(r.t("info_panels.measurement.node_count")+":").append("span").text(d.toLocaleString(n)),p&&b.append("li").text(r.t("info_panels.measurement.area")+":").append("span").text(r.displayArea(p,this._isImperial)),f&&b.append("li").text(r.t("info_panels.measurement."+(u?"perimeter":"length"))+":").append("span").text(r.displayLength(f,this._isImperial)),typeof m=="number"&&b.append("li").text(r.t("info_panels.measurement.distance")+":").append("span").text(r.displayLength(m,this._isImperial)),l&&(_=b.append("li").text(r.t("info_panels.measurement.location")+":"),_.append("span").text(r.dmsCoordinatePair(l)),_.append("span").text(r.decimalCoordinatePair(l))),c&&(_=b.append("li").text(r.t("info_panels.measurement.centroid")+":"),_.append("span").text(r.dmsCoordinatePair(c)),_.append("span").text(r.decimalCoordinatePair(c))),a&&(_=b.append("li").text(r.t("info_panels.measurement.center")+":"),_.append("span").text(r.dmsCoordinatePair(a)),_.append("span").text(r.decimalCoordinatePair(a))),f||p||typeof m=="number"){let w=this._isImperial?"imperial":"metric";e.append("a").text(r.t(`info_panels.measurement.${w}`)).attr("href","#").attr("class","button button-toggle-units").on("click",A=>{A.preventDefault(),this._isImperial=!this._isImperial,this.render()})}}};function j6(i){let e=i.systems.l10n,t={background:new gu(i),history:new yu(i),location:new xu(i),measurement:new vu(i)},r=Object.keys(t),s=new Set,n=new Set;function o(a){function l(){let u=c.selectAll(".panel-container").data(Array.from(s),f=>f);u.exit().style("opacity",1).transition().duration(200).style("opacity",0).on("end",(f,p,m)=>{let g=G(m[p]);t[f].disable(),g.remove()});let h=u.enter().append("div").attr("class",f=>`fillD2 panel-container panel-container-${f}`);h.style("opacity",0).transition().duration(200).style("opacity",1);let d=h.append("div").attr("class","panel-title fillD2");d.append("h3").text(f=>t[f].title),d.append("button").attr("class","close").on("click",(f,p)=>{f.stopImmediatePropagation(),f.preventDefault(),o.toggle(p)}).call(V("#rapid-icon-close")),h.append("div").attr("class",f=>`panel-content panel-content-${f}`).each((f,p,m)=>{let g=G(m[p]);t[f].enable(g)}),c.selectAll(".panel-content").each(f=>t[f].render())}o.toggle=function(u){u?s.has(u)?(s.delete(u),n.size>1&&n.delete(u)):(s.add(u),n.add(u)):s.size?s.clear():(n.size||n.add("measurement"),s=new Set(n)),r.forEach(h=>{i.container().selectAll(`.${h}-panel-toggle-item`).classed("active",s.has(h)).select("input").property("checked",s.has(h))}),l()};let c=a.selectAll(".info-panels").data([0]);c=c.enter().append("div").attr("class","info-panels").merge(c),l(),i.keybinding().on(Ie("\u2318"+e.t("info_panels.key")),u=>{u.stopImmediatePropagation(),u.preventDefault(),o.toggle()}),r.forEach(u=>{let h=e.t(`info_panels.${u}.key`,{default:null});h&&i.keybinding().on(Ie("\u2318\u21E7"+h),d=>{d.stopImmediatePropagation(),d.preventDefault(),o.toggle(u)})})}return o}function ns(i,e){let t=i.systems.editor,r=t.staging.graph,s=i.systems.l10n,n=i.systems.map,o=i.systems.storage,a=e.length===1?"single":"multiple",l=e.map(m=>r.hasEntity(m)).filter(Boolean),c=l.every(m=>m.isNew()),u=eo(e),d=Ft(e,r).map(m=>m.loc),f=ft(l,r),p=function(){let m=t.staging.graph,g,y;if(l.length===1){let b=l[0],_=b.geometry(m),A=m.parentWays(b)[0];if(_==="vertex"){let k=A.nodes,v=k.indexOf(b.id);if(v===0)v++;else if(v===k.length-1)v--;else{let E=at(b.loc,m.entity(k[v-1]).loc),S=at(b.loc,m.entity(k[v+1]).loc);v=E<S?v-1:v+1}g=m.entity(k[v]),y=g.loc}}let x=p.annotation();t.perform(u),t.commit({annotation:x,selectedIDs:e}),g&&y?(n.centerEase(y),i.enter("select-osm",{selection:{osm:[g.id]}})):i.enter("browse")};return p.available=function(){return!0},p.disabled=function(){let m=t.staging.graph;if(!c&&g())return"too_large";if(!c&&y())return"not_downloaded";if(e.some(i.hasHiddenConnections))return"connected_to_hidden";if(e.some(_))return"part_of_relation";if(e.some(b))return"incomplete_relation";if(e.some(x))return"has_wikidata_tag";return!1;function g(){return!(o.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&f.percentContainedIn(n.extent())<.8}function y(){if(i.inIntro)return!1;let w=i.services.osm;if(w){let A=d.filter(k=>!w.isDataLoaded(k));if(A.length)return A.forEach(k=>i.loadTileAtLoc(k)),!0}return!1}function x(w){let A=m.entity(w);return A.tags.wikidata&&A.tags.wikidata.trim().length>0}function b(w){let A=m.entity(w);return A.type==="relation"&&!A.isComplete(m)}function _(w){let A=m.entity(w);if(A.type!=="way")return!1;let k=m.parentRelations(A);for(let v of k){let E=v.tags.type,S=v.memberById(w).role||"outer";if(E==="route"||E==="boundary"||E==="multipolygon"&&S==="outer")return!0}return!1}},p.tooltip=function(){let m=p.disabled();return m?s.t(`operations.delete.${m}.${a}`):s.t(`operations.delete.description.${a}`)},p.annotation=function(){let m=t.staging.graph;return e.length===1?s.t("operations.delete.annotation."+m.geometry(e[0])):s.t("operations.delete.annotation.feature",{n:e.length})},p.id="delete",p.keys=[Ie("\u2318\u232B"),Ie("\u2318\u2326"),Ie("\u2326")],p.title=s.t("operations.delete.title"),p.behavior=new ht(i,p),p}function V6(i){let e=i.systems.editor,t=i.systems.l10n,r=i.systems.filters,s=i.systems.presets,n=ue("cancel","choose"),o=null,a=[],l=null,c=[],u=null,h=null,d=new Set,f=!1,p=G(null),m=G(null);function g(k){if(o=k,!a.length)return;let v=t.isRTL(),E=k.selectAll(".header").data([0]),S=E.enter().append("div").attr("class","header fillL");S.append("h3").attr("class","preset-list-message").text(t.t("inspector.choose")),S.append("button").attr("class","preset-choose").on("click",function(){n.call("cancel",this)}).call(V(v?"#rapid-icon-backward":"#rapid-icon-forward"));let M=E.merge(S).selectAll(".preset-list-message"),I=k.selectAll(".search-header").data([0]),T=I.enter().append("div").attr("class","search-header");T.call(V("#rapid-icon-search","pre-text")),T.append("input").attr("class","preset-search-input").attr("placeholder",t.t("inspector.search")).attr("type","search").call(Re).on("keydown",D).on("keypress",R).on("input",wt(N)),I=I.merge(T),m=I.selectAll(".preset-search-input"),f&&setTimeout(()=>m.node().focus(),0);let C=k.selectAll(".inspector-body").data([0]),P=C.enter().append("div").attr("class","inspector-body");P.append("div").attr("class","preset-list-main preset-list"),p=C.merge(P).selectAll(".preset-list-main").call(y,h),r.off("filterchange",w),r.on("filterchange",w);function D(F){let B=m.property("value");B.length===0&&(F.keyCode===He.keyCodes["\u232B"]||F.keyCode===He.keyCodes["\u2326"])?(F.preventDefault(),F.stopPropagation(),ns(i,a)()):B.length===0&&(F.ctrlKey||F.metaKey)&&F.keyCode===He.keyCodes.z?(F.preventDefault(),F.stopPropagation(),e.undo()):!F.ctrlKey&&!F.metaKey&&(G(this).on("keydown",O),O.call(this,F))}function O(F){if(F.keyCode===He.keyCodes["\u2193"]&&m.node().selectionStart===m.property("value").length){F.preventDefault(),F.stopPropagation();let B=p.selectAll(".preset-list-button");B.empty()||B.node().focus()}}function R(F){let B=F.currentTarget.value;F.keyCode===13&&B.length&&p.selectAll(".preset-list-item:first-child").datum().choose()}function N(){let F=m.property("value");p.classed("filtered",F.length);let B=c[0],$,U;F.length?($=u.search(F,B,l),U=t.t("inspector.results",{n:$.array.length,search:F})):($=h,U=t.t("inspector.choose")),p.call(y,$),M.text(U)}}function y(k,v){let E=[];for(let I of v.array)I&&(I.members?E.push(new b(I)):E.push(new _(I)));let S=k.selectAll(":scope > .preset-list-item").data(E,I=>I.preset.id);S.exit().remove();let M=S.enter().append("div").attr("class",I=>`preset-list-item preset-${I.preset.safeid}`).style("opacity",0).transition().style("opacity",1);S=S.merge(M).order().each((I,T,C)=>G(C[T]).call(I.render)).classed("current",I=>d.has(I.preset.id)),w()}function x(k){let v=k.currentTarget,E=G(v),S=G(v.closest(".preset-list-item")),M=S.node(),I=G(M.parentNode.closest(".preset-list-item")),T=I.node(),C=t.isRTL();if(k.keyCode===He.keyCodes["\u2193"]){k.preventDefault(),k.stopPropagation();let P=G(M.nextElementSibling);P.empty()?T&&(P=G(T.nextElementSibling)):E.classed("expanded")&&(P=S.select(".subgrid .preset-list-item:first-child")),P.empty()||P.select(".preset-list-button").node().focus()}else if(k.keyCode===He.keyCodes["\u2191"]){k.preventDefault(),k.stopPropagation();let P=G(M.previousElementSibling);P.empty()?I.empty()||(P=I):P.select(".preset-list-button").classed("expanded")&&(P=P.select(".subgrid .preset-list-item:last-child")),P.empty()?m.node().focus():P.select(".preset-list-button").node().focus()}else k.keyCode===He.keyCodes[C?"\u2192":"\u2190"]?(k.preventDefault(),k.stopPropagation(),I.empty()||I.select(".preset-list-button").node().focus()):k.keyCode===He.keyCodes[C?"\u2190":"\u2192"]&&(k.preventDefault(),k.stopPropagation(),S.datum().choose())}class b{constructor(v){this.box=null,this.sublist=null,this.shown=!1,this.preset=v,this.choose=this.choose.bind(this),this.render=this.render.bind(this),this._click=this._click.bind(this),this._keydown=this._keydown.bind(this)}render(v){let E=this.preset,S=t.isRTL();v.selectAll(":scope > .preset-list-button-wrap").data([this],C=>C.preset.id).enter().append("div").attr("class","preset-list-button-wrap category").append("button").attr("class","preset-list-button").classed("expanded",!1).call(Al(i).geometry(c.length===1&&c[0]).preset(E)).on("click",this._click).on("keydown",this._keydown).append("div").attr("class","label").append("div").attr("class","label-inner").append("div").attr("class","namepart").call(V(S?"#rapid-icon-backward":"#rapid-icon-forward","inline")).append("span").html(()=>E.nameLabel()+"&hellip;"),this.box=v.append("div").attr("class","subgrid").style("max-height","0px").style("opacity",0),this.box.append("div").attr("class","arrow"),this.sublist=this.box.append("div").attr("class","preset-list preset-list-sub fillL3")}_keydown(v){let E=t.isRTL(),S=v.currentTarget,M=G(S);v.keyCode===He.keyCodes[E?"\u2190":"\u2192"]?(v.preventDefault(),v.stopPropagation(),M.classed("expanded")||this._click(v)):v.keyCode===He.keyCodes[E?"\u2192":"\u2190"]?(v.preventDefault(),v.stopPropagation(),M.classed("expanded")&&this._click(v)):x(v)}_click(v){let E=t.isRTL(),S=v.currentTarget,M=G(S),I=M.classed("expanded"),T=I?E?"#rapid-icon-backward":"#rapid-icon-forward":"#rapid-icon-down";M.classed("expanded",!I),M.selectAll("div.label-inner svg.icon use").attr("href",T),this.choose()}choose(){if(!(!this.box||!this.sublist))if(this.shown)this.shown=!1,this.box.transition().duration(200).style("opacity","0").style("max-height","0px").style("padding-bottom","0px");else{this.shown=!0;let v=this.preset.members.matchAllGeometry(c);this.sublist.call(y,v),this.box.transition().duration(200).style("opacity","1").style("max-height",200+v.array.length*190+"px").style("padding-bottom","10px")}}}class _{constructor(v){this.preset=v,this.reference=Hn(i,v.reference()),this.choose=this.choose.bind(this),this.render=this.render.bind(this)}render(v){let E=this.preset,S=v.selectAll(".preset-list-button-wrap").data([this],C=>C.preset.id).enter().append("div").attr("class","preset-list-button-wrap"),I=S.append("button").attr("class","preset-list-button").call(Al(i).geometry(c.length===1&&c[0]).preset(E)).on("click",this.choose).on("keydown",x).append("div").attr("class","label").append("div").attr("class","label-inner"),T=[E.nameLabel(),E.subtitleLabel()].filter(Boolean);I.selectAll(".namepart").data(T).enter().append("div").attr("class","namepart").html(C=>C),S.call(this.reference.button),v.call(this.reference.body)}choose(){let v=this.preset;i.inIntro||s.setMostRecent(v);let E=S=>{for(let M of a){let I=s.match(S.entity(M),S);S=xr(M,I,v)(S)}return S};e.perform(E),e.commit({annotation:t.t("operations.change_tags.annotation"),selectedIDs:a}),n.call("choose",this,v)}}function w(){let k=e.staging.graph;if(!a.every(E=>k.hasEntity(E)))return;let v=p.selectAll(".preset-list-button");v.call(he(i).destroyAny),v.each((E,S,M)=>{let I=G(M[S]),T;for(let P of c)if(T=r.isHiddenPreset(E.preset,P),T)break;let C=T&&!i.inIntro&&!d.has(E.preset.id);I.classed("disabled",C),C&&I.call(he(i).title(t.t("inspector.hidden_preset.manual",{features:t.t(`feature.${T}.description`)})).placement(S<2?"bottom":"top"))})}g.autofocus=function(k){return arguments.length?(f=k,g):f},g.entityIDs=function(k){if(!arguments.length)return a;if(a=k!=null?k:[],l=null,c=[],u=null,h=null,d=new Set,m.property("value",""),p.selectAll(".preset-list-item").remove(),a.length){let v=e.staging.graph;l=ft(a,v).center(),c=A(),u=s.matchAllGeometry(c),h=s.defaults(c[0],36,!i.inIntro,l);for(let E of a){let S=s.match(v.entity(E),v);S&&d.add(S.id)}}if(o){let v=o.selectAll(".inspector-body").node();v&&v.scroll(0,0)}return g},g.selected=function(k){if(!arguments.length)return d;if(d=new Set,Array.isArray(k))for(let v of k)v!=null&&v.id&&d.add(v.id);return g};function A(){let k=e.staging.graph,v={};for(let E of a){let S=k.entity(E),M=S.geometry(k);M==="vertex"&&S.isOnAddressLine(k)&&(M="point"),v[M]||(v[M]=0),v[M]+=1}return Object.keys(v).sort((E,S)=>v[S]-v[E])}return me(g,n,"on")}function Yc(i){let e=i.systems.l10n,t=i.services.osm,r;function s(n){let o;t&&r instanceof de&&!r.isNew()?o=t.entityURL(r):t&&r instanceof _t&&!r.isNew()&&(o=t.noteURL(r));let a=n.selectAll(".view-on-osm").data(o?[o]:[],c=>c);a.exit().remove(),a.enter().append("a").attr("class","view-on-osm").attr("target","_blank").attr("href",c=>c).call(V("#rapid-icon-out-link","inline")).append("span").text(e.t("inspector.view_on_osm"))}return s.what=function(n){return arguments.length?(r=n,s):r},s}function W6(i){let e=i.systems.editor,t=i.systems.validator,r=V6(i),s=F6(i),n=G(null),o=G(null),a=G(null),l,c="select",u,h=!1;e.off("merge",d),e.on("merge",d);function d(m){if(!(m instanceof Set)||!Array.isArray(u))return;let g=!1;for(let y of u)if(m.has(y)){g=!0;break}g&&p()}function f(m){l=m,p()}function p(){if(!l)return;let m=e.staging.graph;r.entityIDs(u).autofocus(h).on("choose",b=>f.setPreset(b)).on("cancel",()=>f.setPreset()),s.state(c).entityIDs(u).on("choose",b=>f.showPresetList(b,!0)),n=l.selectAll(".panewrap").data([0]);let g=n.enter().append("div").attr("class","panewrap");g.append("div").attr("class","preset-list-pane pane"),g.append("div").attr("class","entity-editor-pane pane"),n=n.merge(g),o=n.selectAll(".preset-list-pane"),a=n.selectAll(".entity-editor-pane"),x()?f.showPresetList():f.showEntityEditor();let y=l.selectAll(".footer").data([0]);y=y.enter().append("div").attr("class","footer").merge(y),y.call(Yc(i).what(m.hasEntity(u.length===1&&u[0])));function x(){if(c!=="select"||u.length!==1)return!1;let b=u[0],_=m.hasEntity(b);return!_||_.hasNonGeometryTags()?!1:h?!0:!(_.geometry(m)!=="vertex"||m.parentRelations(_).length||t.getEntityIssues(b).length||_.isHighwayIntersection(m))}}return f.showPresetList=function(m,g){o.classed("hide",!1),g?n.transition().styleTween("right",()=>pn("0%","-100%")).on("end",()=>a.classed("hide",!0)):(n.style("right","-100%"),a.classed("hide",!0)),Array.isArray(m)&&r.selected(m),o.call(r.autofocus(h||g))},f.showEntityEditor=function(m,g){a.classed("hide",!1),g?n.transition().styleTween("right",()=>pn("-100%","0%")).on("end",()=>o.classed("hide",!0)):(n.style("right","0%"),o.classed("hide",!0)),Array.isArray(m)&&s.presets(m),a.call(s)},f.setPreset=function(m){if((m==null?void 0:m.id)==="type/multipolygon")f.showPresetList();else{let g=m?[m]:null,y=o.select(".preset-search-input").node();y.value="",f.showEntityEditor(g,!0)}},f.state=function(m){return arguments.length?(c=m,s.state(c),i.container().selectAll(".field-help-body").remove(),f):c},f.entityIDs=function(m){return arguments.length?(u=m,f):u},f.newFeature=function(m){return arguments.length?(h=m,f):h},f}function X6(i){let e=i.systems.l10n,t=i.systems.storage,r=i.systems.ui,s=i.systems.validator,n={id:"warnings",count:0,iconID:"rapid-icon-alert",stringID:"issues.warnings_and_errors"},o={id:"resolved",count:0,iconID:"rapid-icon-apply",stringID:"issues.user_resolved_issues"};function a(l){var f,p;let c=[],u=s.getIssues({what:(f=t.getItem("validate-what"))!=null?f:"edited",where:(p=t.getItem("validate-where"))!=null?p:"all"});if(u.length&&(n.count=u.length,c.push(n)),t.getItem("validate-what")==="all"){let m=s.getResolvedIssues();m.length&&(o.count=m.length,c.push(o))}let h=l.selectAll(".chip").data(c,m=>m.id);h.exit().remove();let d=h.enter().append("a").attr("class",m=>`chip ${m.id}-count`).attr("href","#").each((m,g,y)=>{let x=G(y[g]),b=he(i).placement("top").title(e.t(m.stringID));x.call(b).on("click",_=>{_.preventDefault(),b.hide(),r.togglePanes(i.container().select(".map-panes .issues-pane"))}),x.call(V(`#${m.iconID}`))});d.append("span").attr("class","count"),d.merge(h).selectAll("span.count").text(m=>m.count.toString())}return function(c){a(c),s.on("validated",()=>a(c))}}function q6(i){let e=i.systems.editor,t=i.systems.filters,r=i.systems.l10n,s=i.systems.map,n=i.systems.presets,o;function a(c){let{itemType:u,parentIssueType:h}=c,d=r.tHtml("inspector.unknown"),f=c.replacements||{};f.default=d;let p=r.tHtml(`QA.keepRight.errorTypes.${u}.description`,f);return p===d&&(p=r.tHtml(`QA.keepRight.errorTypes.${h}.description`,f)),p}function l(c){let u=c.selectAll(".error-details").data(o?[o]:[],p=>`${p.id}-${p.status||0}`);u.exit().remove();let d=u.enter().append("div").attr("class","error-details qa-details-container").append("div").attr("class","qa-details-subsection");d.append("h4").html(r.tHtml("QA.keepRight.detail_description")),d.append("div").attr("class","qa-details-description-text").html(a);let f=[];d.selectAll(".error_entity_link, .error_object_link").attr("href","#").each((p,m,g)=>{let y=g[m],x=G(y),b=x.classed("error_object_link"),_=b?o.objectType.charAt(0)+o.objectId:y.textContent,w=e.staging.graph,A=w.hasEntity(_);if(f.push(_),x.on("mouseenter",()=>{Xe([_],!0,i)}).on("mouseleave",()=>{Xe([_],!1,i)}).on("click",k=>{k.preventDefault(),Xe([_],!1,i),s.scene.enableLayers("osm"),s.centerZoomEase(o.loc,20),s.selectEntityID(_)}),A){let k=r.displayName(A.tags);if(!k&&!b){let v=n.match(A,w);k=v&&!v.isFallback()&&v.name()}k&&(y.innerText=k)}}),t.forceVisible(f),s.immediateRedraw()}return l.issue=function(c){return arguments.length?(o=c,l):o},l}function Q6(i){let e=i.systems.l10n,t;function r(n){let o=e.tHtml("inspector.unknown"),a=n.replacements||{};a.default=o;let l=e.tHtml(`QA.keepRight.errorTypes.${n.itemType}.title`,a);return l===o&&(l=e.tHtml(`QA.keepRight.errorTypes.${n.parentIssueType}.title`,a)),l}function s(n){let o=16777215,a=i.services.keepRight;a&&(o=a.getColor(t==null?void 0:t.parentIssueType));let l=n.selectAll(".qa-header").data(t?[t]:[],u=>`${u.id}-${u.status||0}`);l.exit().remove();let c=l.enter().append("div").attr("class","qa-header");c.append("div").attr("class","qa-header-icon").append("div").attr("class",u=>`qaItem ${u.service}`).call(V("#rapid-icon-bolt")),c.append("div").attr("class","qa-header-label").html(r),c.selectAll(".qaItem svg.icon").attr("stroke","#333").attr("stroke-width","1.3px").attr("color",new we(o).toHex())}return s.issue=function(n){return arguments.length?(t=n,s):t},s}function Y6(i){let e=i.systems.l10n,t=i.services.keepRight,r;function s(n){let o;t&&r instanceof ut&&(o=t.issueURL(r));let a=n.selectAll(".view-on-keepRight").data(o?[o]:[],c=>c);a.exit().remove(),a.enter().append("a").attr("class","view-on-keepRight").attr("target","_blank").attr("rel","noopener").attr("href",c=>c).call(V("#rapid-icon-out-link","inline")).append("span").text(e.t("inspector.view_on_keepRight"))}return s.what=function(n){return arguments.length?(r=n,s):r},s}function Kc(i){let e=i.systems.l10n,t=i.services.keepRight,r=ue("change"),s=q6(i),n=Q6(i),o;function a(u){let h=u.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");h.append("button").attr("class","close").on("click",()=>i.enter("browse")).call(V("#rapid-icon-close")),h.append("h3").html(e.tHtml("QA.keepRight.title"));let d=u.selectAll(".body").data([0]);d=d.enter().append("div").attr("class","body").merge(d);let f=d.selectAll(".qa-editor").data([0]);f.enter().append("div").attr("class","modal-section qa-editor").merge(f).call(n.issue(o)).call(s.issue(o)).call(l);let p=u.selectAll(".footer").data([0]);p.enter().append("div").attr("class","footer").merge(p).call(Y6(i).what(o))}function l(u){let h=o==null?void 0:o.id,d=h&&i.selectedData().has(h),f=o&&(d||o.newComment||o.comment),p=u.selectAll(".qa-save").data(f?[o]:[],y=>`${y.id}-${y.status||0}`);p.exit().remove();let m=p.enter().append("div").attr("class","qa-save save-section cf");m.append("h4").attr("class",".qa-save-header").html(e.tHtml("QA.keepRight.comment")),m.append("textarea").attr("class","new-comment-input").attr("placeholder",e.t("QA.keepRight.comment_placeholder")).attr("maxlength",1e3).property("value",y=>y.newComment||y.comment).call(Re).on("input",g).on("blur",g),p=m.merge(p).call(c);function g(){let x=G(this).property("value").trim();x===o.comment&&(x=void 0),o=o.update({newComment:x}),t&&t.replaceItem(o),p.call(c)}}function c(u){let h=o==null?void 0:o.id,d=h&&i.selectedData().has(h),f=u.selectAll(".buttons").data(d?[o]:[],m=>m.status+m.id);f.exit().remove();let p=f.enter().append("div").attr("class","buttons");p.append("button").attr("class","button comment-button action").html(e.tHtml("QA.keepRight.save_comment")),p.append("button").attr("class","button close-button action"),p.append("button").attr("class","button ignore-button action"),f=f.merge(p),f.select(".comment-button").attr("disabled",m=>m.newComment?null:!0).on("click.comment",function(m,g){this.blur(),t&&t.postUpdate(g,(y,x)=>r.call("change",x))}),f.select(".close-button").html(m=>{let g=m.newComment?"_comment":"";return e.tHtml(`QA.keepRight.close${g}`)}).on("click.close",function(m,g){this.blur(),t&&(g.newStatus="ignore_t",t.postUpdate(g,(y,x)=>r.call("change",x)))}),f.select(".ignore-button").html(m=>{let g=m.newComment?"_comment":"";return e.tHtml(`QA.keepRight.ignore${g}`)}).on("click.ignore",function(m,g){this.blur(),t&&(g.newStatus="ignore",t.postUpdate(g,(y,x)=>r.call("change",x)))})}return a.error=function(u){return arguments.length?(o=u,a):o},me(a,r,"on")}function Sl(i){let e=i.systems.editor,t=i.systems.l10n,r=i.systems.map,s=i.systems.styles,n=i.systems.map3d,o=i.systems.urlhash;function a(l){let c=G(null),u=!o.getParam("map3d");function h(){u||(d(),f())}function d(){var w;let b=r.extent(),_=b.center();b.padByMeters(100),(w=n.maplibre)==null||w.jumpTo({center:_,bearing:0,zoom:r.zoom()-3})}function f(){let _=e.intersects(r.extent()).filter(v=>!v.id.startsWith("r")),w=_.filter(v=>Object.keys(v.tags).filter(S=>S.startsWith("building")).length>0),A=_.filter(v=>Object.keys(v.tags).filter(S=>S.startsWith("highway")).length>0),k=_.filter(v=>Object.keys(v.tags).filter(S=>S.startsWith("landuse")||S.startsWith("leisure")||S.startsWith("natural")||S.startsWith("area")).length>0);g(A),p(w),m(k)}function p(b){let _=[],w=i.selectedIDs(),A=e.staging.graph;for(let E of b){let S=E.asGeoJSON(A);if(S.type!=="Polygon"&&S.type!=="MultiPolygon")continue;if(!E.tags["building:part"]&&b.length<250){let I=!1;for(let T of E.nodes){let C=A.parentWays(A.hasEntity(T));for(let P of C)if(P.tags["building:part"]&&i1(E.nodes.map(D=>A.hasEntity(D).loc),P.nodes.map(D=>A.hasEntity(D).loc))){I=!0;break}}if(I)continue}let M={type:"Feature",properties:{extrude:!0,selected:w.includes(E.id).toString(),min_height:E.tags.min_height?parseFloat(E.tags.min_height):0,height:parseFloat(E.tags.height||E.tags["building:levels"]*3||0)},geometry:S};_.push(M)}let k=n.maplibre,v=k==null?void 0:k.getSource("osmbuildings");v&&v.setData({type:"FeatureCollection",features:_})}function m(b){let _=[],w=i.selectedIDs();for(let v of b){let E=v.asGeoJSON(e.staging.graph);if(E.type!=="Polygon"&&E.type!=="MultiPolygon")continue;let S=s.styleMatch(v.tags),M=new we(S.fill.color).toHex(),I=new we(S.stroke.color).toHex(),T={type:"Feature",properties:{selected:w.includes(v.id).toString(),fillcolor:M,strokecolor:I},geometry:E};_.push(T)}let A=n.maplibre,k=A==null?void 0:A.getSource("osmareas");k&&k.setData({type:"FeatureCollection",features:_})}function g(b){let _=[],w=i.selectedIDs();for(let v of b){let E=v.asGeoJSON(e.staging.graph);if(E.type!=="LineString")continue;let S=s.styleMatch(v.tags),M=new we(S.casing.color).toHex(),I=new we(S.stroke.color).toHex(),T={type:"Feature",properties:{selected:w.includes(v.id).toString(),highway:v.tags.highway,casingColor:M,strokeColor:I},geometry:E};_.push(T)}let A=n.maplibre,k=A==null?void 0:A.getSource("osmroads");k&&k.setData({type:"FeatureCollection",features:_})}function y(b){b&&b.preventDefault(),u=!u,i.container().select(".three-d-map-toggle-item").classed("active",!u).select("input").property("checked",!u),u?(c.style("display","block").style("opacity","1").transition().duration(200).style("opacity","0").on("end",()=>l.selectAll(".three-d-map").style("display","none")),o.setParam("map3d",null)):(c.style("display","block").style("opacity","0").transition().duration(200).style("opacity","1").on("end",()=>h()),o.setParam("map3d","true"))}Sl.toggle=y,c=l.selectAll(".three-d-map").data([0]),c=c.enter().append("div").attr("class","three-d-map").attr("id","3d-buildings").style("display",u?"none":"block").merge(c),n.startAsync(),r.on("draw",()=>h()),r.on("move",()=>h()),i.keybinding().on([Ie("\u2318"+t.t("background.3dmap.key"))],y),h()}return a}function Cl(i){let e=i.systems.l10n,t=i.systems.map;function r(s){let n=new gr,o=Jl().scaleExtent([Ti(.5),Ti(24)]).on("start",w).on("zoom",A).on("end",k),a=G(null),l=G(null),c=!0,u=!1,h=!1,d=null,f=6,p,m,g,y,x=null,b=null;function _(){c||(v(),E())}function w(){h||(g=y=n.transform(),d=null)}function A(C){if(h)return;let P=C.transform.x,D=C.transform.y,O=C.transform.k,R=O!==g.k,N=P!==g.x||D!==g.y;if(!R&&!N)return;d||(d=R?"zoom":"pan");let F=n.transform(),B,$,U;d==="zoom"?(U=O/F.k,B=(m[0]/U-m[0])*U,$=(m[1]/U-m[1])*U):(O=F.k,U=1,B=P-F.x,$=D-F.y),d==="pan"?(x.stage.x+=B,x.stage.y+=$):gs(l,0,0,U),u=!0,y=ps.translate(P,D).scale(O);let H=Yr(i.projection.scale()),z=Yr(O);f=H-z,_()}function k(){h||d==="pan"&&(v(),d=null,t.center(n.invert(m)))}function v(){let C=t.center(),P=i.projection.transform(),D=Yr(P.k),O=Math.max(D-f,.5),R=Ti(O);n.translate([P.x,P.y]).scale(R);let N=n.project(C),F=d==="pan"?Ze([y.x,y.y],[g.x,g.y]):[0,0],B=m[0]-N[0]+P.x+F[0],$=m[1]-N[1]+P.y+F[1];n.translate([B,$]).dimensions([[0,0],p]),y=n.transform(),u&&(x.stage.x=0,x.stage.y=0,gs(l,0,0),u=!1),o.scaleExtent([Ti(.5),Ti(D-3)]),h=!0,a.call(o.transform,y),h=!1}function E(){let C=t.extent().bbox(),P=n.project([C.minX,C.maxY]),D=n.project([C.maxX,C.minY]),O=Math.abs(D[0]-P[0]),R=Math.abs(D[1]-P[1]),N=x.stage,F=N.getChildByName("bbox");F||(F=new qe,F.name="bbox",F.eventMode="none",N.addChild(F)),F.clear().lineStyle(2,16776960).drawRect(P[0],P[1],O,R)}function S(C){C&&C.preventDefault(),c=!c,i.container().select(".minimap-toggle-item").classed("active",!c).select("input").property("checked",!c),c?a.style("display","block").style("opacity","1").transition().duration(200).style("opacity","0").on("end",()=>{s.selectAll(".map-in-map").style("display","none"),M()}):(_(),a.style("display","block").style("opacity","0").transition().duration(200).style("opacity","1"))}function M(){let C=x.stage,P=C.getChildByName("bbox");P&&C.removeChild(P),b&&b.destroyAll()}function I(){if(c)return;window.performance.mark("minimap-start"),b.render(0,n),x.render(),window.performance.mark("minimap-end"),window.performance.measure("minimap","minimap-start","minimap-end")}Cl.toggle=S,a=s.selectAll(".map-in-map").data([0]);let T=a.enter().append("div").attr("class","map-in-map").style("display",c?"none":"block").call(o).on("dblclick.zoom",null);if(!x){x=new xc({antialias:!0,autoDensity:!0,autoStart:!1,events:{move:!1,globalMove:!1,click:!0,wheel:!1},resolution:window.devicePixelRatio,sharedLoader:!0,sharedTicker:!1});let[C,P]=[200,150];x.renderer.resize(C,P);let D=x.ticker;D.maxFPS=10;let O=D._head.next;D.remove(O.fn,O.context),D.add(I,this),D.start();let R=x.stage;R.name="minimap-stage",R.eventMode="none",R.sortableChildren=!1;let N=t.renderer,F={context:i,pixi:x,stage:R,textures:N.textures},B={context:i,renderer:F,groups:new Map,layers:new Map,features:new Map},$=new Qe;$.name="background",R.addChild($),B.groups.set("background",$),b=new Fc(B,"minimap-background",!0),B.layers.set(b.id,b),p=[C,P],m=mr(p,.5),t.on("draw",()=>_())}T.each((C,P,D)=>{D[P].appendChild(x.view)}),a=T.merge(a),l=G(x.view),_(),i.keybinding().on(e.t("background.minimap.key"),S)}return r}function K6(i){let e=i.systems.l10n,t;function r(o){if(t.isNew())return;let a=o.selectAll(".comments-container").data([0]);a=a.enter().append("div").attr("class","comments-container").merge(a);let l=a.selectAll(".comment").data(t.comments).enter().append("div").attr("class","comment");l.append("div").attr("class",h=>`comment-avatar user-${h.uid}`).call(V("#rapid-icon-avatar","comment-avatar-icon"));let c=l.append("div").attr("class","comment-main"),u=c.append("div").attr("class","comment-metadata");u.append("div").attr("class","comment-author").each((h,d,f)=>{let p=G(f[d]),m=i.services.osm;m&&h.user&&(p=p.append("a").attr("class","comment-author-link").attr("href",m.userURL(h.user)).attr("target","_blank")),p.html(g=>g.user||e.tHtml("note.anonymous"))}),u.append("div").attr("class","comment-date").html(h=>e.t(`note.status.${h.action}`,{when:n(h.date)})),c.append("div").attr("class","comment-text").html(h=>h.html).selectAll("a").attr("rel","noopener nofollow").attr("target","_blank"),a.call(s)}function s(o){var h;let l=(h=i.systems.storage.getItem("preferences.privacy.thirdpartyicons"))!=null?h:"true",c=i.services.osm;if(l!=="true"||!c)return;let u=new Set;for(let d of t.comments)d.uid&&u.add(d.uid);for(let d of u)c.loadUser(d,(f,p)=>{!p||!p.image_url||o.selectAll(`.comment-avatar.user-${d}`).html("").append("img").attr("class","icon comment-avatar-icon").attr("src",p.image_url).attr("alt",p.display_name)})}function n(o){if(!o)return null;let a={day:"numeric",month:"short",year:"numeric"};o=o.replace(/-/g,"/");let l=new Date(o);if(isNaN(l.getTime()))return null;let c=i.systems.l10n.localeCode();return l.toLocaleDateString(c,a)}return r.note=function(o){return arguments.length?(t=o,r):t},r}function Z6(i){let e=i.systems.l10n,t;function r(s){let n=s.selectAll(".note-header").data(t?[t]:[],l=>l.status+l.id);n.exit().remove();let o=n.enter().append("div").attr("class","note-header"),a=o.append("div").attr("class",l=>`note-header-icon ${l.status}`).classed("new",l=>l.id<0);a.append("div").attr("class","preset-icon-28").call(V("#rapid-icon-note","note-fill")),a.each(l=>{let c;l.id<0?c="#rapid-icon-plus":l.status==="open"?c="#rapid-icon-close":c="#rapid-icon-apply",a.append("div").attr("class","note-icon-annotation").call(V(c,"icon-annotation"))}),o.append("div").attr("class","note-header-label").text(l=>t.isNew()?e.t("note.new"):e.t("note.note")+" "+l.id+" "+(l.status==="closed"?e.t("note.closed"):""))}return r.note=function(s){return arguments.length?(t=s,r):t},r}function J6(i){let e=i.systems.l10n,t;function r(s){let n,o=i.services.osm;o&&t instanceof _t&&!t.isNew()&&(n=o.noteReportURL(t));let a=s.selectAll(".note-report").data(n?[n]:[]);a.exit().remove(),a.enter().append("a").attr("class","note-report").attr("target","_blank").attr("href",c=>c).call(V("#rapid-icon-out-link","inline")).append("span").text(e.t("note.report"))}return r.note=function(s){return arguments.length?(t=s,r):t},r}function Zc(i){let e=i.systems.l10n,t=ue("change"),r=K6(i),s=Z6(i);var n,o;function a(m){var g=m.selectAll(".header").data([0]),y=g.enter().append("div").attr("class","header fillL");y.append("button").attr("class","close").on("click",function(){i.enter("browse")}).call(V("#rapid-icon-close")),y.append("h3").html(e.tHtml("note.title"));var x=m.selectAll(".body").data([0]);x=x.enter().append("div").attr("class","body").merge(x);var b=x.selectAll(".note-editor").data([0]);b.enter().append("div").attr("class","modal-section note-editor").merge(b).call(s.note(n)).call(r.note(n)).call(l);var _=m.selectAll(".footer").data([0]);_.enter().append("div").attr("class","footer").merge(_).call(Yc(i).what(n)).call(J6(i).note(n));var w=i.services.osm;w&&w.on("authchange",function(){m.call(a)})}function l(m){var g=n&&n.id===i.selectedIDs()[0],y=m.selectAll(".note-save").data(g?[n]:[],function(A){return A.status+A.id});y.exit().remove();var x=y.enter().append("div").attr("class","note-save save-section cf");x.append("h4").attr("class",".note-save-header").html(function(){return n.isNew()?e.t("note.newDescription"):e.t("note.newComment")});var b=x.append("textarea").attr("class","new-comment-input").attr("placeholder",e.t("note.inputPlaceholder")).attr("maxlength",1e3).property("value",function(A){return A.newComment}).call(Re).on("keydown.note-input",_).on("input.note-input",w).on("blur.note-input",w);!b.empty()&&o&&b.node().focus(),y=x.merge(y).call(c).call(u);function _(A){if(A.keyCode===13&&A.metaKey){var k=i.services.osm;if(k){var v=k.authenticated();v&&n.newComment&&(A.preventDefault(),G(this).on("keydown.note-input",null),window.setTimeout(function(){n.isNew()?(y.selectAll(".save-button").node().focus(),d(n)):(y.selectAll(".comment-button").node().focus(),p(n))},10))}}}function w(){var A=G(this),k=A.property("value").trim()||void 0;n=n.update({newComment:k});var v=i.services.osm;v&&v.replaceNote(n),y.call(u)}}function c(m){var g=m.selectAll(".detail-section").data([0]);g=g.enter().append("div").attr("class","detail-section").merge(g);var y=i.services.osm;if(y){var x=y.authenticated(),b=g.selectAll(".auth-warning").data(x?[]:[0]);b.exit().transition().duration(200).style("opacity",0).remove();var _=b.enter().insert("div",".tag-reference-body").attr("class","field-warning auth-warning").style("opacity",0);_.call(V("#rapid-icon-alert","inline")),_.append("span").html(e.tHtml("note.login")),_.append("a").attr("target","_blank").call(V("#rapid-icon-out-link","inline")).append("span").html(e.tHtml("login")).on("click.note-login",function(A){A.preventDefault(),y.authenticate()}),_.transition().duration(200).style("opacity",1);var w=g.selectAll(".note-save-prose").data(x?[0]:[]);w.exit().remove(),w=w.enter().append("p").attr("class","note-save-prose").html(e.tHtml("note.upload_explanation")).merge(w),y.userDetails(function(A,k){if(!A){var v=G(document.createElement("div"));k.image_url&&v.append("img").attr("src",k.image_url).attr("class","icon pre-text user-icon"),v.append("a").attr("class","user-info").text(k.display_name).attr("href",y.userURL(k.display_name)).attr("target","_blank"),w.html(e.tHtml("note.upload_explanation_with_user",{user:v.html()}))}})}}function u(m){var g=i.services.osm,y=g&&g.authenticated(),x=n&&n.id===i.selectedIDs()[0],b=m.selectAll(".buttons").data(x?[n]:[],function(A){return A.status+A.id});b.exit().remove();var _=b.enter().append("div").attr("class","buttons");n.isNew()?(_.append("button").attr("class","button cancel-button secondary-action").html(e.tHtml("confirm.cancel")),_.append("button").attr("class","button save-button action").html(e.tHtml("note.save"))):(_.append("button").attr("class","button status-button action"),_.append("button").attr("class","button comment-button action").html(e.tHtml("note.comment"))),b=b.merge(_),b.select(".cancel-button").on("click.cancel",h),b.select(".save-button").attr("disabled",w).on("click.save",d),b.select(".status-button").attr("disabled",y?null:!0).html(function(A){var k=A.status==="open"?"close":"open",v=A.newComment?"_comment":"";return e.t("note."+k+v)}).on("click.status",f),b.select(".comment-button").attr("disabled",w).on("click.comment",p);function w(A){return y&&A.status==="open"&&A.newComment?null:!0}}function h(m,g){this.blur();var y=i.services.osm;y&&y.removeNote(g),i.enter("browse"),t.call("change")}function d(m,g){this.blur();var y=i.services.osm;y&&y.postNoteCreate(g,function(x,b){t.call("change",b)})}function f(m,g){this.blur();var y=i.services.osm;if(y){var x=g.status==="open"?"closed":"open";y.postNoteUpdate(g,x,function(b,_){t.call("change",_)})}}function p(m,g){this.blur();var y=i.services.osm;y&&y.postNoteUpdate(g,g.status,function(x,b){t.call("change",b)})}return a.note=function(m){return arguments.length?(n=m,a):n},a.newNote=function(m){return arguments.length?(o=m,a):o},me(a,t,"on")}function ef(i){let e=i.systems.editor,t=i.systems.filters,r=i.systems.l10n,s=i.systems.map,n=i.services.osmose,o=i.systems.presets,a;function l(u,h){if(!n||!u)return"";let d=n.getStrings(u.itemType);return h in d?d[h]:""}function c(u){let h=u.selectAll(".error-details").data(a?[a]:[],m=>`${m.id}-${m.status||0}`);h.exit().remove();let d=h.enter().append("div").attr("class","error-details qa-details-container");if(l(a,"detail")){let m=d.append("div").attr("class","qa-details-subsection");m.append("h4").html(r.tHtml("QA.keepRight.detail_description")),m.append("p").attr("class","qa-details-description-text").html(g=>l(g,"detail")).selectAll("a").attr("rel","noopener").attr("target","_blank")}let f=d.append("div").attr("class","qa-details-subsection"),p=d.append("div").attr("class","qa-details-subsection");if(l(a,"fix")){let m=d.append("div").attr("class","qa-details-subsection");m.append("h4").html(r.tHtml("QA.osmose.fix_title")),m.append("p").html(g=>l(g,"fix")).selectAll("a").attr("rel","noopener").attr("target","_blank")}if(l(a,"trap")){let m=d.append("div").attr("class","qa-details-subsection");m.append("h4").html(r.tHtml("QA.osmose.trap_title")),m.append("p").html(g=>l(g,"trap")).selectAll("a").attr("rel","noopener").attr("target","_blank")}n&&n.loadIssueDetailAsync(a).then(m=>{a.id===m.id&&(!m.elems||m.elems.length===0||(m.detail&&(f.append("h4").html(r.tHtml("QA.osmose.detail_title")),f.append("p").html(g=>g.detail).selectAll("a").attr("rel","noopener").attr("target","_blank")),p.append("h4").html(r.tHtml("QA.osmose.elems_title")),p.append("ul").selectAll("li").data(m.elems).enter().append("li").append("a").attr("href","#").attr("class","error_entity_link").html(g=>g).each((g,y,x)=>{let b=x[y],_=G(b),w=b.textContent,A=e.staging.graph,k=A.hasEntity(w);if(_.on("mouseenter",()=>{Xe([w],!0,i)}).on("mouseleave",()=>{Xe([w],!1,i)}).on("click",v=>{v.preventDefault(),Xe([w],!1,i),s.scene.enableLayers("osm"),s.centerZoom(g.loc,20),s.selectEntityID(w)}),k){let v=r.displayName(k.tags);if(!v){let E=o.match(k,A);v=E&&!E.isFallback()&&E.name()}v&&(b.innerText=v)}}),t.forceVisible(m.elems),s.immediateRedraw()))}).catch(m=>console.error(m))}return c.issue=function(u){return arguments.length?(a=u,c):a},c}function tf(i){let e=i.systems.l10n,t=i.services.osmose,r;function s(o){let a=e.t("inspector.unknown");if(!t||!o)return a;let l=t.getStrings(o.itemType);return"title"in l?l.title:a}function n(o){let a=16777215;t&&(a=t.getColor(r==null?void 0:r.item));let l=o.selectAll(".qa-header").data(r?[r]:[],h=>`${h.id}-${h.status||0}`);l.exit().remove();let c=l.enter().append("div").attr("class","qa-header"),u=c.append("div").attr("class","qa-header-icon").append("svg").attr("width","20px").attr("height","27px").attr("viewbox","0 0 20 27").attr("class",h=>`qaItem ${h.service}`);u.append("polygon").attr("fill",new we(a).toHex()).attr("stroke","#333").attr("points","16,3 4,3 1,6 1,17 4,20 7,20 10,27 13,20 16,20 19,17.033 19,6"),u.append("use").attr("class","icon-annotation").attr("width","13px").attr("height","13px").attr("transform","translate(3.5, 5)").attr("xlink:href",h=>h.icon?`#${h.icon}`:""),c.append("div").attr("class","qa-header-label").html(s)}return n.issue=function(o){return arguments.length?(r=o,n):r},n}function rf(i){let e=i.systems.l10n,t=i.services.osmose,r;function s(n){let o;t&&r instanceof ut&&(o=t.itemURL(r));let a=n.selectAll(".view-on-osmose").data(o?[o]:[],c=>c);a.exit().remove(),a.enter().append("a").attr("class","view-on-osmose").attr("target","_blank").attr("rel","noopener").attr("href",c=>c).call(V("#rapid-icon-out-link","inline")).append("span").text(e.t("inspector.view_on_osmose"))}return s.what=function(n){return arguments.length?(r=n,s):r},s}function Jc(i){let e=i.systems.l10n,t=i.services.osmose,r=ue("change"),s=ef(i),n=tf(i),o;function a(u){let d=u.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");d.append("button").attr("class","close").on("click",()=>i.enter("browse")).call(V("#rapid-icon-close")),d.append("h3").html(e.tHtml("QA.osmose.title"));let f=u.selectAll(".body").data([0]);f=f.enter().append("div").attr("class","body").merge(f);let p=f.selectAll(".qa-editor").data([0]);p.enter().append("div").attr("class","modal-section qa-editor").merge(p).call(n.issue(o)).call(s.issue(o)).call(l);let m=u.selectAll(".footer").data([0]);m.enter().append("div").attr("class","footer").merge(m).call(rf(i).what(o))}function l(u){let h=o==null?void 0:o.id,d=h&&i.selectedData().has(h),f=o&&d,p=u.selectAll(".qa-save").data(f?[o]:[],g=>`${g.id}-${g.status||0}`);p.exit().remove(),p=p.enter().append("div").attr("class","qa-save save-section cf").merge(p).call(c)}function c(u){let h=o==null?void 0:o.id,d=h&&i.selectedData().has(h),f=u.selectAll(".buttons").data(d?[o]:[],m=>m.status+m.id);f.exit().remove();let p=f.enter().append("div").attr("class","buttons");p.append("button").attr("class","button close-button action"),p.append("button").attr("class","button ignore-button action"),f=f.merge(p),f.select(".close-button").html(e.tHtml("QA.keepRight.close")).on("click.close",function(m,g){this.blur(),t&&(g.newStatus="done",t.postUpdate(g,(y,x)=>r.call("change",x)))}),f.select(".ignore-button").html(e.tHtml("QA.keepRight.ignore")).on("click.ignore",function(m,g){this.blur(),t&&(g.newStatus="false",t.postUpdate(g,(y,x)=>r.call("change",x)))})}return a.error=function(u){return arguments.length?(o=u,a):o},me(a,r,"on")}function Rs(i,e){let t=i.systems.l10n,r=i.systems.ui,s=i.systems.validator,n,o="",a="",l="",c,u=G(null),h,d={id:e};d.label=function(p){return arguments.length?(o=p,d):o},d.key=function(p){return arguments.length?(n=p,d):n},d.description=function(p){return arguments.length?(a=p,d):a},d.iconName=function(p){return arguments.length?(l=p,d):l},d.sections=function(p){return arguments.length?(c=p,d):c},d.selection=function(){return u};function f(){r.togglePanes()}return d.togglePane=function(p){p&&p.preventDefault(),h.hide();let m=!u.classed("shown");r.togglePanes(m?u:void 0),d.id==="issues"&&m&&s.validateAsync()},d.renderToggleButton=function(p){if(!h){let m=t.isRTL();h=he(i).placement(m?"right":"left").title(a).shortcut(n)}p.append("button").on("click",d.togglePane).call(V(`#${l}`,"light")).call(h)},d.renderContent=function(p){if(c)for(let m of c)p.call(m.render)},d.renderPane=function(p){u=p.append("div").attr("class",`fillL map-pane hide ${e}-pane`).attr("pane",e);let m=u.append("div").attr("class","pane-heading");m.append("h2").text(o),m.append("button").on("click",f).call(V("#rapid-icon-close")),u.append("div").attr("class","pane-content").call(d.renderContent),n&&i.keybinding().on(n,d.togglePane)},d}function sf(i){let e=ue("resize");function t(r){r.append("button").attr("class","thumb-hide").on("click",()=>{for(let o of["mapillary","kartaview","streetside"]){let a=i.services[o];a==null||a.hideViewer()}}).append("div").call(V("#rapid-icon-close"));function s(o){o.preventDefault()}r.append("button").attr("class","resize-handle-xy").on("touchstart touchdown touchend",s).on("pointerdown",n(r,"resize",{resizeOnX:!0,resizeOnY:!0})),r.append("button").attr("class","resize-handle-x").on("touchstart touchdown touchend",s).on("pointerdown",n(r,"resize",{resizeOnX:!0})),r.append("button").attr("class","resize-handle-y").on("touchstart touchdown touchend",s).on("pointerdown",n(r,"resize",{resizeOnY:!0}));function n(o,a,l){let c=!!l.resizeOnX,u=!!l.resizeOnY,h=l.minHeight||240,d=l.minWidth||320,f,p,m,g,y;function x(w){if(f!==(w.pointerId||"mouse"))return;w.preventDefault(),w.stopPropagation();let A=i.systems.map.dimensions;if(c){let k=A[0],v=b(g+w.clientX-p,d,k);o.style("width",v+"px")}if(u){let k=A[1]-90,v=b(y+m-w.clientY,h,k);o.style("height",v+"px")}e.call(a,o,Kr(o,!0))}function b(w,A,k){return Math.max(A,Math.min(w,k))}function _(w){f===(w.pointerId||"mouse")&&(w.preventDefault(),w.stopPropagation(),G(window).on("."+a,null))}return function(A){A.preventDefault(),A.stopPropagation(),f=A.pointerId||"mouse",p=A.clientX,m=A.clientY;let k=o.node().getBoundingClientRect();g=k.width,y=k.height,G(window).on("pointermove."+a,x,!1).on("pointerup."+a,_,!1).on("pointercancel."+a,_,!1)}}}return t.onMapResize=function(){let r=i.container().select(".photoviewer"),s=i.container().select(".main-content"),n=Kr(s,!0),o=Kr(r,!0);if(o[0]>n[0]||o[1]>n[1]-90){let a=[Math.min(o[0],n[0]),Math.min(o[1],n[1]-90)];r.style("width",a[0]+"px").style("height",a[1]+"px"),e.call("resize",r,a)}},me(t,e,"on")}function nf(i,e){let t=ue("change","done"),r=()=>{};function s(c){let u=i.container().selectAll(".shaded");u.empty()||(u.selectAll(".colorpicker-popup").size()?r():l(u,c.currentTarget))}function n(c){let u=c.target,h=u&&u.className||"";/colorpicker/i.test(h)||(c.stopPropagation(),c.preventDefault(),r())}function o(c){let u=c.length<6,h=parseInt(u?c[1]+c[1]:c[1]+c[2],16),d=parseInt(u?c[2]+c[2]:c[3]+c[4],16),f=parseInt(u?c[3]+c[3]:c[5]+c[6],16);return(h*299+d*587+f*114)/1e3}function a(c){let u=c.selectAll(".rapid-colorpicker").data(d=>[d],d=>d.id),h=u.enter().append("div").attr("class","rapid-colorpicker").on("click",s);h.append("div").attr("class","rapid-colorpicker-fill").call(V("#fas-palette")),u.merge(h).selectAll(".rapid-colorpicker-fill").style("background",d=>d.color).select(".icon").style("color",d=>o(d.color)>140.5?"#333":"#fff")}function l(c,u){let h=i.systems.l10n.isRTL(),d=u.__data__,f=u.getBoundingClientRect(),p=180,m=f.bottom+15,g=h?f.right-.3333*p:f.left-.6666*p,y=h?.3333*p-f.width+10:.6666*p+10,x=e.close;e.close=()=>{},r=()=>{_.transition().duration(200).style("opacity",0).remove(),e.close=x;let E=He("modal");E.on(["\u232B","\u238B"],x),G(document).call(E),G(document).on("click.colorpicker",null),r=()=>{},t.call("done")};let b=He("modal");b.on(["\u232B","\u238B"],r),G(document).call(b),G(document).on("click.colorpicker",n);let _=c.append("div").attr("class","colorpicker-popup").style("opacity",0).style("width",p+"px").style("top",m+"px").style("left",g+"px");_.append("div").attr("class","colorpicker-arrow").style("left",y+"px");let A=_.append("div").attr("class","colorpicker-content").selectAll(".colorpicker-colors").data([0]);A=A.enter().append("div").attr("class","colorpicker-colors").merge(A);let k=A.selectAll(".colorpicker-option").data(i.systems.rapid.colors),v=k.enter().append("div").attr("class","colorpicker-option").style("color",E=>E).on("click",(E,S)=>{t.call("change",this,d.id,S),k.classed("selected",M=>M===S)});v.append("div").attr("class","colorpicker-option-fill"),k=k.merge(v),k.classed("selected",E=>E===d.color),_.transition().style("opacity",1)}return me(a,t,"on")}function of(i){let e=i.systems.l10n,t=i.systems.storage;return function(s){if(t.getItem("sawRapidSplash"))return;t.setItem("sawRapidSplash",!0);let n=Vt(s);n.select(".modal").attr("class","modal rapid-modal modal-splash");let o=n.select(".content");o.append("div").attr("class","modal-section").append("h3").text(e.t("rapid_splash.welcome")),o.append("div").attr("class","modal-section").append("p").html(e.t("rapid_splash.text",{rapidicon:ke("#rapid-logo-rapid-wordmark","logo-rapid"),walkthrough:ke("#rapid-logo-walkthrough","logo-walkthrough"),edit:ke("#rapid-logo-features","logo-features")}));let a=o.append("div").attr("class","modal-actions"),l=a.append("button").attr("class","walkthrough").on("click",()=>{i.container().call(an(i,!1)),n.close()});l.append("svg").attr("class","logo logo-features").append("use").attr("xlink:href","#rapid-logo-walkthrough"),l.append("div").text(e.t("rapid_splash.walkthrough"));let c=a.append("button").attr("class","rapid-walkthrough").on("click",()=>{i.container().call(an(i,!0)),n.close()});c.append("svg").attr("class","logo logo-rapid").append("use").attr("xlink:href","#rapid-logo-rapid-wordmark"),c.append("div").text(e.t("rapid_splash.skip_to_rapid"));let u=a.append("button").attr("class","start-editing").on("click",()=>{n.close()});u.append("svg").attr("class","logo logo-features").append("use").attr("xlink:href","#rapid-logo-features"),u.append("div").text(e.t("rapid_splash.start")),n.select("button.close").attr("class","hide")}}function af(i){let e=i.systems.l10n;return function(t){let r=Vt(t);r.select(".modal").attr("class","modal rapid-modal");let s=r.select(".content");s.append("div").attr("class","modal-section").append("h3").html(e.t("rapid_first_edit.nice",{rapidicon:ke("#rapid-logo-rapid-wordmark","logo-rapid")})),s.append("div").attr("class","modal-section").append("p").text(e.t("rapid_first_edit.text"));let n=s.append("div").attr("class","modal-actions");n.append("button").attr("class","rapid-explore").on("click",()=>{r.close()}).append("div").text(e.t("rapid_first_edit.exploring")),n.append("button").attr("class","rapid-login-to-osm").on("click",()=>{r.close();let l=i.services.osm;l&&l.authenticate(()=>i.container().call(of(i)))}).append("div").text(e.t("rapid_first_edit.login_with_osm")),r.select("button.close").attr("class","hide")}}var tg=50;function e0(i,e){let t=i.systems.editor,r=i.systems.rapid,s=i.systems.l10n,n=i.systems.urlhash,o;function a(){return r.taskExtent||n.getParam("poweruser")==="true"?!1:r.acceptIDs.size>=tg}function l(){if(!o)return;if(a()){qc(i).duration(5e3).label(s.t("rapid_feature_inspector.option_accept.disabled_flash",{n:tg}))();return}let g=i.services[o.__service__].graph(o.__datasetid__),y=o.__datasetid__.replace("-conflated",""),x=r.datasets.get(y),b={type:"rapid_accept_feature",description:s.t("rapid_feature_inspector.option_accept.annotation"),entityID:o.id,dataUsed:(x==null?void 0:x.dataUsed)||[y]};if(t.perform(U5(o.id,g)),t.commit({annotation:b,selectedIDs:[o.id]}),i.enter("select-osm",{selection:{osm:[o.id]}}),i.inIntro||window.sessionStorage.getItem("acknowledgedLogin")==="true")return;window.sessionStorage.setItem("acknowledgedLogin","true"),i.services.osm.authenticated()||i.container().call(af(i))}function c(){if(!o)return;let m={type:"rapid_ignore_feature",description:s.t("rapid_feature_inspector.option_ignore.annotation"),entityID:o.id};t.perform(O5()),t.commit({annotation:m}),i.enter("browse")}function u(m){let g=m.length<6,y=parseInt(g?m[1]+m[1]:m[1]+m[2],16),x=parseInt(g?m[2]+m[2]:m[3]+m[4],16),b=parseInt(g?m[3]+m[3]:m[5]+m[6],16);return(y*299+x*587+b*114)/1e3}function h(m){if(!o)return;let g=o.__datasetid__.replace("-conflated",""),y=r.datasets.get(g),x=y.color,b=m.selectAll(".feature-info").data([x]),_=b.enter().append("div").attr("class","feature-info");_.append("div").attr("class","dataset-label").text(y.label||y.id),y.beta&&_.append("div").attr("class","dataset-beta beta").attr("title",s.t("rapid_poweruser_features.beta")),b=b.merge(_).style("background",w=>w).style("color",w=>u(w)>140.5?"#333":"#fff")}function d(m){let g=o&&o.tags;if(!g)return;let x=m.selectAll(".tag-info").data([0]).enter().append("div").attr("class","tag-info").append("div").attr("class","tag-bag");x.append("div").attr("class","tag-heading").text(s.t("rapid_feature_inspector.tags")),Object.keys(g).map(_=>({key:_,value:g[_]})).forEach(_=>{let w=x.append("div").attr("class","tag-entry");w.append("div").attr("class","tag-key").text(_.key),w.append("div").attr("class","tag-value").text(_.value)})}function f(m){let g=m.selectAll(".rapid-inspector").data([0]),y=g.enter().append("div").attr("class","rapid-inspector");g=g.merge(y);let x=g.selectAll(".header").data([0]).enter().append("div").attr("class","header");x.append("h3").append("svg").attr("class","logo-rapid").append("use").attr("xlink:href","#rapid-logo-rapid-wordmark"),x.append("button").attr("class","fr rapid-inspector-close").on("click",()=>{i.enter("browse")}).call(V("#rapid-icon-close"));let b=g.selectAll(".body").data([0]),_=b.enter().append("div").attr("class","body");b=b.merge(_).call(h).call(d);let w=[{key:"accept",iconName:"#rapid-icon-rapid-plus-circle",label:s.t("rapid_feature_inspector.option_accept.label"),description:s.t("rapid_feature_inspector.option_accept.description"),onClick:l},{key:"ignore",iconName:"#rapid-icon-rapid-minus-circle",label:s.t("rapid_feature_inspector.option_ignore.label"),description:s.t("rapid_feature_inspector.option_ignore.description"),onClick:c}],k=b.selectAll(".rapid-inspector-choices").data([0]).enter().append("div").attr("class","rapid-inspector-choices");k.append("p").text(s.t("rapid_feature_inspector.prompt")),k.selectAll(".rapid-inspector-choice").data(w,v=>v.key).enter().append("div").attr("class",v=>`rapid-inspector-choice rapid-inspector-choice-${v.key}`).each(p)}function p(m,g,y){let x=G(y[g]),b=m.key==="accept"&&a()?"secondary disabled":"",_=x.append("div").attr("class",`choice-wrap choice-wrap-${m.key}`),w=x.append("div").attr("class","tag-reference-body");w.text(m.description);let A=m.onClick,k=_.append("button").attr("class",`choice-button choice-button-${m.key} ${b}`).on("click",A),v,E;m.key==="accept"?a()?(v=s.t("rapid_feature_inspector.option_accept.disabled",{n:tg}),E=""):(v=s.t("rapid_feature_inspector.option_accept.tooltip"),E=s.t("rapid_feature_inspector.option_accept.key")):m.key==="ignore"&&(v=s.t("rapid_feature_inspector.option_ignore.tooltip"),E=s.t("rapid_feature_inspector.option_ignore.key")),v&&(k=k.call(he(i).placement("bottom").title(v).shortcut(E))),k.append("svg").attr("class","choice-icon icon").append("use").attr("xlink:href",m.iconName),k.append("div").attr("class","choice-label").text(m.label),_.append("button").attr("class",`tag-reference-button ${b}`).attr("title","info").attr("tabindex","-1").on("click",()=>{w.classed("expanded",!w.classed("expanded"))}).call(V("#rapid-icon-inspect"))}return f.datum=function(m){return arguments.length?(o=m,this):o},e&&e().on(s.t("rapid_feature_inspector.option_accept.key"),l).on(s.t("rapid_feature_inspector.option_ignore.key"),c),f}function ng(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Il=ng();function Gk(i){Il=i}var zk=/[&<>"']/,SH=new RegExp(zk.source,"g"),jk=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,CH=new RegExp(jk.source,"g"),kH={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ok=i=>kH[i];function os(i,e){if(e){if(zk.test(i))return i.replace(SH,Ok)}else if(jk.test(i))return i.replace(CH,Ok);return i}var TH=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function IH(i){return i.replace(TH,(e,t)=>(t=t.toLowerCase(),t==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}var MH=/(^|[^\[])\^/g;function Rt(i,e){let t=typeof i=="string"?i:i.source;e=e||"";let r={replace:(s,n)=>{let o=typeof n=="string"?n:n.source;return o=o.replace(MH,"$1"),t=t.replace(s,o),r},getRegex:()=>new RegExp(t,e)};return r}function Bk(i){try{i=encodeURI(i).replace(/%25/g,"%")}catch(e){return null}return i}var bu={exec:()=>null};function Uk(i,e){let t=i.replace(/\|/g,(n,o,a)=>{let l=!1,c=o;for(;--c>=0&&a[c]==="\\";)l=!l;return l?"|":" |"}),r=t.split(/ \|/),s=0;if(r[0].trim()||r.shift(),r.length>0&&!r[r.length-1].trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;s<r.length;s++)r[s]=r[s].trim().replace(/\\\|/g,"|");return r}function lf(i,e,t){let r=i.length;if(r===0)return"";let s=0;for(;s<r;){let n=i.charAt(r-s-1);if(n===e&&!t)s++;else if(n!==e&&t)s++;else break}return i.slice(0,r-s)}function PH(i,e){if(i.indexOf(e[1])===-1)return-1;let t=0;for(let r=0;r<i.length;r++)if(i[r]==="\\")r++;else if(i[r]===e[0])t++;else if(i[r]===e[1]&&(t--,t<0))return r;return-1}function $k(i,e,t,r){let s=e.href,n=e.title?os(e.title):null,o=i[1].replace(/\\([\[\]])/g,"$1");if(i[0].charAt(0)!=="!"){r.state.inLink=!0;let a={type:"link",raw:t,href:s,title:n,text:o,tokens:r.inlineTokens(o)};return r.state.inLink=!1,a}return{type:"image",raw:t,href:s,title:n,text:os(o)}}function DH(i,e){let t=i.match(/^(\s+)(?:```)/);if(t===null)return e;let r=t[1];return e.split(`
`).map(s=>{let n=s.match(/^\s+/);if(n===null)return s;let[o]=n;return o.length>=r.length?s.slice(r.length):s}).join(`
`)}var t0=class{constructor(e){ge(this,"options");ge(this,"rules");ge(this,"lexer");this.options=e||Il}space(e){let t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){let t=this.rules.block.code.exec(e);if(t){let r=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?r:lf(r,`
`)}}}fences(e){let t=this.rules.block.fences.exec(e);if(t){let r=t[0],s=DH(r,t[3]||"");return{type:"code",raw:r,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:s}}}heading(e){let t=this.rules.block.heading.exec(e);if(t){let r=t[2].trim();if(/#$/.test(r)){let s=lf(r,"#");(this.options.pedantic||!s||/ $/.test(s))&&(r=s.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(e){let t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}blockquote(e){let t=this.rules.block.blockquote.exec(e);if(t){let r=lf(t[0].replace(/^ *>[ \t]?/gm,""),`
`),s=this.lexer.state.top;this.lexer.state.top=!0;let n=this.lexer.blockTokens(r);return this.lexer.state.top=s,{type:"blockquote",raw:t[0],tokens:n,text:r}}}list(e){let t=this.rules.block.list.exec(e);if(t){let r=t[1].trim(),s=r.length>1,n={type:"list",raw:"",ordered:s,start:s?+r.slice(0,-1):"",loose:!1,items:[]};r=s?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=s?r:"[*+-]");let o=new RegExp(`^( {0,3}${r})((?:[	 ][^\\n]*)?(?:\\n|$))`),a="",l="",c=!1;for(;e;){let u=!1;if(!(t=o.exec(e))||this.rules.block.hr.test(e))break;a=t[0],e=e.substring(a.length);let h=t[2].split(`
`,1)[0].replace(/^\t+/,y=>" ".repeat(3*y.length)),d=e.split(`
`,1)[0],f=0;this.options.pedantic?(f=2,l=h.trimStart()):(f=t[2].search(/[^ ]/),f=f>4?1:f,l=h.slice(f),f+=t[1].length);let p=!1;if(!h&&/^ *$/.test(d)&&(a+=d+`
`,e=e.substring(d.length+1),u=!0),!u){let y=new RegExp(`^ {0,${Math.min(3,f-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),x=new RegExp(`^ {0,${Math.min(3,f-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),b=new RegExp(`^ {0,${Math.min(3,f-1)}}(?:\`\`\`|~~~)`),_=new RegExp(`^ {0,${Math.min(3,f-1)}}#`);for(;e;){let w=e.split(`
`,1)[0];if(d=w,this.options.pedantic&&(d=d.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),b.test(d)||_.test(d)||y.test(d)||x.test(e))break;if(d.search(/[^ ]/)>=f||!d.trim())l+=`
`+d.slice(f);else{if(p||h.search(/[^ ]/)>=4||b.test(h)||_.test(h)||x.test(h))break;l+=`
`+d}!p&&!d.trim()&&(p=!0),a+=w+`
`,e=e.substring(w.length+1),h=d.slice(f)}}n.loose||(c?n.loose=!0:/\n *\n *$/.test(a)&&(c=!0));let m=null,g;this.options.gfm&&(m=/^\[[ xX]\] /.exec(l),m&&(g=m[0]!=="[ ] ",l=l.replace(/^\[[ xX]\] +/,""))),n.items.push({type:"list_item",raw:a,task:!!m,checked:g,loose:!1,text:l,tokens:[]}),n.raw+=a}n.items[n.items.length-1].raw=a.trimEnd(),n.items[n.items.length-1].text=l.trimEnd(),n.raw=n.raw.trimEnd();for(let u=0;u<n.items.length;u++)if(this.lexer.state.top=!1,n.items[u].tokens=this.lexer.blockTokens(n.items[u].text,[]),!n.loose){let h=n.items[u].tokens.filter(f=>f.type==="space"),d=h.length>0&&h.some(f=>/\n.*\n/.test(f.raw));n.loose=d}if(n.loose)for(let u=0;u<n.items.length;u++)n.items[u].loose=!0;return n}}html(e){let t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){let t=this.rules.block.def.exec(e);if(t){let r=t[1].toLowerCase().replace(/\s+/g," "),s=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",n=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:r,raw:t[0],href:s,title:n}}}table(e){let t=this.rules.block.table.exec(e);if(!t||!/[:|]/.test(t[2]))return;let r=Uk(t[1]),s=t[2].replace(/^\||\| *$/g,"").split("|"),n=t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[],o={type:"table",raw:t[0],header:[],align:[],rows:[]};if(r.length===s.length){for(let a of s)/^ *-+: *$/.test(a)?o.align.push("right"):/^ *:-+: *$/.test(a)?o.align.push("center"):/^ *:-+ *$/.test(a)?o.align.push("left"):o.align.push(null);for(let a of r)o.header.push({text:a,tokens:this.lexer.inline(a)});for(let a of n)o.rows.push(Uk(a,o.header.length).map(l=>({text:l,tokens:this.lexer.inline(l)})));return o}}lheading(e){let t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){let t=this.rules.block.paragraph.exec(e);if(t){let r=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:r,tokens:this.lexer.inline(r)}}}text(e){let t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){let t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:os(t[1])}}tag(e){let t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){let t=this.rules.inline.link.exec(e);if(t){let r=t[2].trim();if(!this.options.pedantic&&/^</.test(r)){if(!/>$/.test(r))return;let o=lf(r.slice(0,-1),"\\");if((r.length-o.length)%2===0)return}else{let o=PH(t[2],"()");if(o>-1){let l=(t[0].indexOf("!")===0?5:4)+t[1].length+o;t[2]=t[2].substring(0,o),t[0]=t[0].substring(0,l).trim(),t[3]=""}}let s=t[2],n="";if(this.options.pedantic){let o=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(s);o&&(s=o[1],n=o[3])}else n=t[3]?t[3].slice(1,-1):"";return s=s.trim(),/^</.test(s)&&(this.options.pedantic&&!/>$/.test(r)?s=s.slice(1):s=s.slice(1,-1)),$k(t,{href:s&&s.replace(this.rules.inline.anyPunctuation,"$1"),title:n&&n.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer)}}reflink(e,t){let r;if((r=this.rules.inline.reflink.exec(e))||(r=this.rules.inline.nolink.exec(e))){let s=(r[2]||r[1]).replace(/\s+/g," "),n=t[s.toLowerCase()];if(!n){let o=r[0].charAt(0);return{type:"text",raw:o,text:o}}return $k(r,n,r[0],this.lexer)}}emStrong(e,t,r=""){let s=this.rules.inline.emStrongLDelim.exec(e);if(!s||s[3]&&r.match(/[\p{L}\p{N}]/u))return;if(!(s[1]||s[2]||"")||!r||this.rules.inline.punctuation.exec(r)){let o=[...s[0]].length-1,a,l,c=o,u=0,h=s[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(h.lastIndex=0,t=t.slice(-1*e.length+o);(s=h.exec(t))!=null;){if(a=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!a)continue;if(l=[...a].length,s[3]||s[4]){c+=l;continue}else if((s[5]||s[6])&&o%3&&!((o+l)%3)){u+=l;continue}if(c-=l,c>0)continue;l=Math.min(l,l+c+u);let d=[...s[0]][0].length,f=e.slice(0,o+s.index+d+l);if(Math.min(o,l)%2){let m=f.slice(1,-1);return{type:"em",raw:f,text:m,tokens:this.lexer.inlineTokens(m)}}let p=f.slice(2,-2);return{type:"strong",raw:f,text:p,tokens:this.lexer.inlineTokens(p)}}}}codespan(e){let t=this.rules.inline.code.exec(e);if(t){let r=t[2].replace(/\n/g," "),s=/[^ ]/.test(r),n=/^ /.test(r)&&/ $/.test(r);return s&&n&&(r=r.substring(1,r.length-1)),r=os(r,!0),{type:"codespan",raw:t[0],text:r}}}br(e){let t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){let t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){let t=this.rules.inline.autolink.exec(e);if(t){let r,s;return t[2]==="@"?(r=os(t[1]),s="mailto:"+r):(r=os(t[1]),s=r),{type:"link",raw:t[0],text:r,href:s,tokens:[{type:"text",raw:r,text:r}]}}}url(e){var r,s;let t;if(t=this.rules.inline.url.exec(e)){let n,o;if(t[2]==="@")n=os(t[0]),o="mailto:"+n;else{let a;do a=t[0],t[0]=(s=(r=this.rules.inline._backpedal.exec(t[0]))==null?void 0:r[0])!=null?s:"";while(a!==t[0]);n=os(t[0]),t[1]==="www."?o="http://"+t[0]:o=t[0]}return{type:"link",raw:t[0],text:n,href:o,tokens:[{type:"text",raw:n,text:n}]}}}inlineText(e){let t=this.rules.inline.text.exec(e);if(t){let r;return this.lexer.state.inRawBlock?r=t[0]:r=os(t[0]),{type:"text",raw:t[0],text:r}}}},RH=/^(?: *(?:\n|$))+/,NH=/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,FH=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Au=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,LH=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Vk=/(?:[*+-]|\d{1,9}[.)])/,Wk=Rt(/^(?!bull )((?:.|\n(?!\s*?\n|bull ))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,Vk).getRegex(),og=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,OH=/^[^\n]+/,ag=/(?!\s*\])(?:\\.|[^\[\]\\])+/,BH=Rt(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",ag).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),UH=Rt(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Vk).getRegex(),df="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",lg=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,$H=Rt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",lg).replace("tag",df).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Xk=Rt(og).replace("hr",Au).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",df).getRegex(),HH=Rt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Xk).getRegex(),cg={blockquote:HH,code:NH,def:BH,fences:FH,heading:LH,hr:Au,html:$H,lheading:Wk,list:UH,newline:RH,paragraph:Xk,table:bu,text:OH},Hk=Rt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Au).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",df).getRegex(),GH=Si(Ne({},cg),{table:Hk,paragraph:Rt(og).replace("hr",Au).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Hk).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",df).getRegex()}),zH=Si(Ne({},cg),{html:Rt(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",lg).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:bu,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Rt(og).replace("hr",Au).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Wk).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()}),qk=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,jH=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Qk=/^( {2,}|\\)\n(?!\s*$)/,VH=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Su="\\p{P}$+<=>`^|~",WH=Rt(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,Su).getRegex(),XH=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,qH=Rt(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,Su).getRegex(),QH=Rt("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,Su).getRegex(),YH=Rt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,Su).getRegex(),KH=Rt(/\\([punct])/,"gu").replace(/punct/g,Su).getRegex(),ZH=Rt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),JH=Rt(lg).replace("(?:-->|$)","-->").getRegex(),eG=Rt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",JH).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),uf=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,tG=Rt(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",uf).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Yk=Rt(/^!?\[(label)\]\[(ref)\]/).replace("label",uf).replace("ref",ag).getRegex(),Kk=Rt(/^!?\[(ref)\](?:\[\])?/).replace("ref",ag).getRegex(),iG=Rt("reflink|nolink(?!\\()","g").replace("reflink",Yk).replace("nolink",Kk).getRegex(),ug={_backpedal:bu,anyPunctuation:KH,autolink:ZH,blockSkip:XH,br:Qk,code:jH,del:bu,emStrongLDelim:qH,emStrongRDelimAst:QH,emStrongRDelimUnd:YH,escape:qk,link:tG,nolink:Kk,punctuation:WH,reflink:Yk,reflinkSearch:iG,tag:eG,text:VH,url:bu},rG=Si(Ne({},ug),{link:Rt(/^!?\[(label)\]\((.*?)\)/).replace("label",uf).getRegex(),reflink:Rt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",uf).getRegex()}),ig=Si(Ne({},ug),{escape:Rt(qk).replace("])","~|])").getRegex(),url:Rt(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/}),sG=Si(Ne({},ig),{br:Rt(Qk).replace("{2,}","*").getRegex(),text:Rt(ig.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()}),cf={normal:cg,gfm:GH,pedantic:zH},_u={normal:ug,gfm:ig,breaks:sG,pedantic:rG},Co=class i{constructor(e){ge(this,"tokens");ge(this,"options");ge(this,"state");ge(this,"tokenizer");ge(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Il,this.options.tokenizer=this.options.tokenizer||new t0,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={block:cf.normal,inline:_u.normal};this.options.pedantic?(t.block=cf.pedantic,t.inline=_u.pedantic):this.options.gfm&&(t.block=cf.gfm,this.options.breaks?t.inline=_u.breaks:t.inline=_u.gfm),this.tokenizer.rules=t}static get rules(){return{block:cf,inline:_u}}static lex(e,t){return new i(t).lex(e)}static lexInline(e,t){return new i(t).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){let r=this.inlineQueue[t];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[]){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(a,l,c)=>l+"    ".repeat(c.length));let r,s,n,o;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(a=>(r=a.call({lexer:this},e,t))?(e=e.substring(r.raw.length),t.push(r),!0):!1))){if(r=this.tokenizer.space(e)){e=e.substring(r.raw.length),r.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(r);continue}if(r=this.tokenizer.code(e)){e=e.substring(r.raw.length),s=t[t.length-1],s&&(s.type==="paragraph"||s.type==="text")?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue[this.inlineQueue.length-1].src=s.text):t.push(r);continue}if(r=this.tokenizer.fences(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.heading(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.hr(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.blockquote(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.list(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.html(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.def(e)){e=e.substring(r.raw.length),s=t[t.length-1],s&&(s.type==="paragraph"||s.type==="text")?(s.raw+=`
`+r.raw,s.text+=`
`+r.raw,this.inlineQueue[this.inlineQueue.length-1].src=s.text):this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title});continue}if(r=this.tokenizer.table(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.lheading(e)){e=e.substring(r.raw.length),t.push(r);continue}if(n=e,this.options.extensions&&this.options.extensions.startBlock){let a=1/0,l=e.slice(1),c;this.options.extensions.startBlock.forEach(u=>{c=u.call({lexer:this},l),typeof c=="number"&&c>=0&&(a=Math.min(a,c))}),a<1/0&&a>=0&&(n=e.substring(0,a+1))}if(this.state.top&&(r=this.tokenizer.paragraph(n))){s=t[t.length-1],o&&s.type==="paragraph"?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):t.push(r),o=n.length!==e.length,e=e.substring(r.raw.length);continue}if(r=this.tokenizer.text(e)){e=e.substring(r.raw.length),s=t[t.length-1],s&&s.type==="text"?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):t.push(r);continue}if(e){let a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let r,s,n,o=e,a,l,c;if(this.tokens.links){let u=Object.keys(this.tokens.links);if(u.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(o))!=null;)u.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.blockSkip.exec(o))!=null;)o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(o))!=null;)o=o.slice(0,a.index)+"++"+o.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(l||(c=""),l=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(u=>(r=u.call({lexer:this},e,t))?(e=e.substring(r.raw.length),t.push(r),!0):!1))){if(r=this.tokenizer.escape(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.tag(e)){e=e.substring(r.raw.length),s=t[t.length-1],s&&r.type==="text"&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):t.push(r);continue}if(r=this.tokenizer.link(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(r.raw.length),s=t[t.length-1],s&&r.type==="text"&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):t.push(r);continue}if(r=this.tokenizer.emStrong(e,o,c)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.codespan(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.br(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.del(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.autolink(e)){e=e.substring(r.raw.length),t.push(r);continue}if(!this.state.inLink&&(r=this.tokenizer.url(e))){e=e.substring(r.raw.length),t.push(r);continue}if(n=e,this.options.extensions&&this.options.extensions.startInline){let u=1/0,h=e.slice(1),d;this.options.extensions.startInline.forEach(f=>{d=f.call({lexer:this},h),typeof d=="number"&&d>=0&&(u=Math.min(u,d))}),u<1/0&&u>=0&&(n=e.substring(0,u+1))}if(r=this.tokenizer.inlineText(n)){e=e.substring(r.raw.length),r.raw.slice(-1)!=="_"&&(c=r.raw.slice(-1)),l=!0,s=t[t.length-1],s&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):t.push(r);continue}if(e){let u="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(u);break}else throw new Error(u)}}return t}},i0=class{constructor(e){ge(this,"options");this.options=e||Il}code(e,t,r){var n;let s=(n=(t||"").match(/^\S*/))==null?void 0:n[0];return e=e.replace(/\n$/,"")+`
`,s?'<pre><code class="language-'+os(s)+'">'+(r?e:os(e,!0))+`</code></pre>
`:"<pre><code>"+(r?e:os(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e,t){return e}heading(e,t,r){return`<h${t}>${e}</h${t}>
`}hr(){return`<hr>
`}list(e,t,r){let s=t?"ol":"ul",n=t&&r!==1?' start="'+r+'"':"";return"<"+s+n+`>
`+e+"</"+s+`>
`}listitem(e,t,r){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(e){return`<p>${e}</p>
`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+t+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,t){let r=t.header?"th":"td";return(t.align?`<${r} align="${t.align}">`:`<${r}>`)+e+`</${r}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return"<br>"}del(e){return`<del>${e}</del>`}link(e,t,r){let s=Bk(e);if(s===null)return r;e=s;let n='<a href="'+e+'"';return t&&(n+=' title="'+t+'"'),n+=">"+r+"</a>",n}image(e,t,r){let s=Bk(e);if(s===null)return r;e=s;let n=`<img src="${e}" alt="${r}"`;return t&&(n+=` title="${t}"`),n+=">",n}text(e){return e}},wu=class{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,r){return""+r}image(e,t,r){return""+r}br(){return""}},ko=class i{constructor(e){ge(this,"options");ge(this,"renderer");ge(this,"textRenderer");this.options=e||Il,this.options.renderer=this.options.renderer||new i0,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new wu}static parse(e,t){return new i(t).parse(e)}static parseInline(e,t){return new i(t).parseInline(e)}parse(e,t=!0){let r="";for(let s=0;s<e.length;s++){let n=e[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[n.type]){let o=n,a=this.options.extensions.renderers[o.type].call({parser:this},o);if(a!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(o.type)){r+=a||"";continue}}switch(n.type){case"space":continue;case"hr":{r+=this.renderer.hr();continue}case"heading":{let o=n;r+=this.renderer.heading(this.parseInline(o.tokens),o.depth,IH(this.parseInline(o.tokens,this.textRenderer)));continue}case"code":{let o=n;r+=this.renderer.code(o.text,o.lang,!!o.escaped);continue}case"table":{let o=n,a="",l="";for(let u=0;u<o.header.length;u++)l+=this.renderer.tablecell(this.parseInline(o.header[u].tokens),{header:!0,align:o.align[u]});a+=this.renderer.tablerow(l);let c="";for(let u=0;u<o.rows.length;u++){let h=o.rows[u];l="";for(let d=0;d<h.length;d++)l+=this.renderer.tablecell(this.parseInline(h[d].tokens),{header:!1,align:o.align[d]});c+=this.renderer.tablerow(l)}r+=this.renderer.table(a,c);continue}case"blockquote":{let o=n,a=this.parse(o.tokens);r+=this.renderer.blockquote(a);continue}case"list":{let o=n,a=o.ordered,l=o.start,c=o.loose,u="";for(let h=0;h<o.items.length;h++){let d=o.items[h],f=d.checked,p=d.task,m="";if(d.task){let g=this.renderer.checkbox(!!f);c?d.tokens.length>0&&d.tokens[0].type==="paragraph"?(d.tokens[0].text=g+" "+d.tokens[0].text,d.tokens[0].tokens&&d.tokens[0].tokens.length>0&&d.tokens[0].tokens[0].type==="text"&&(d.tokens[0].tokens[0].text=g+" "+d.tokens[0].tokens[0].text)):d.tokens.unshift({type:"text",text:g+" "}):m+=g+" "}m+=this.parse(d.tokens,c),u+=this.renderer.listitem(m,p,!!f)}r+=this.renderer.list(u,a,l);continue}case"html":{let o=n;r+=this.renderer.html(o.text,o.block);continue}case"paragraph":{let o=n;r+=this.renderer.paragraph(this.parseInline(o.tokens));continue}case"text":{let o=n,a=o.tokens?this.parseInline(o.tokens):o.text;for(;s+1<e.length&&e[s+1].type==="text";)o=e[++s],a+=`
`+(o.tokens?this.parseInline(o.tokens):o.text);r+=t?this.renderer.paragraph(a):a;continue}default:{let o='Token with "'+n.type+'" type was not found.';if(this.options.silent)return console.error(o),"";throw new Error(o)}}}return r}parseInline(e,t){t=t||this.renderer;let r="";for(let s=0;s<e.length;s++){let n=e[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[n.type]){let o=this.options.extensions.renderers[n.type].call({parser:this},n);if(o!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(n.type)){r+=o||"";continue}}switch(n.type){case"escape":{let o=n;r+=t.text(o.text);break}case"html":{let o=n;r+=t.html(o.text);break}case"link":{let o=n;r+=t.link(o.href,o.title,this.parseInline(o.tokens,t));break}case"image":{let o=n;r+=t.image(o.href,o.title,o.text);break}case"strong":{let o=n;r+=t.strong(this.parseInline(o.tokens,t));break}case"em":{let o=n;r+=t.em(this.parseInline(o.tokens,t));break}case"codespan":{let o=n;r+=t.codespan(o.text);break}case"br":{r+=t.br();break}case"del":{let o=n;r+=t.del(this.parseInline(o.tokens,t));break}case"text":{let o=n;r+=t.text(o.text);break}default:{let o='Token with "'+n.type+'" type was not found.';if(this.options.silent)return console.error(o),"";throw new Error(o)}}}return r}},kl=class{constructor(e){ge(this,"options");this.options=e||Il}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}};ge(kl,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));var Eu,sg,hf,Zk,rg=class{constructor(...e){a7(this,Eu);a7(this,hf);ge(this,"defaults",ng());ge(this,"options",this.setOptions);ge(this,"parse",y3(this,Eu,sg).call(this,Co.lex,ko.parse));ge(this,"parseInline",y3(this,Eu,sg).call(this,Co.lexInline,ko.parseInline));ge(this,"Parser",ko);ge(this,"Renderer",i0);ge(this,"TextRenderer",wu);ge(this,"Lexer",Co);ge(this,"Tokenizer",t0);ge(this,"Hooks",kl);this.use(...e)}walkTokens(e,t){var s,n;let r=[];for(let o of e)switch(r=r.concat(t.call(this,o)),o.type){case"table":{let a=o;for(let l of a.header)r=r.concat(this.walkTokens(l.tokens,t));for(let l of a.rows)for(let c of l)r=r.concat(this.walkTokens(c.tokens,t));break}case"list":{let a=o;r=r.concat(this.walkTokens(a.items,t));break}default:{let a=o;(n=(s=this.defaults.extensions)==null?void 0:s.childTokens)!=null&&n[a.type]?this.defaults.extensions.childTokens[a.type].forEach(l=>{let c=a[l].flat(1/0);r=r.concat(this.walkTokens(c,t))}):a.tokens&&(r=r.concat(this.walkTokens(a.tokens,t)))}}return r}use(...e){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(r=>{let s=Ne({},r);if(s.async=this.defaults.async||s.async||!1,r.extensions&&(r.extensions.forEach(n=>{if(!n.name)throw new Error("extension name required");if("renderer"in n){let o=t.renderers[n.name];o?t.renderers[n.name]=function(...a){let l=n.renderer.apply(this,a);return l===!1&&(l=o.apply(this,a)),l}:t.renderers[n.name]=n.renderer}if("tokenizer"in n){if(!n.level||n.level!=="block"&&n.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=t[n.level];o?o.unshift(n.tokenizer):t[n.level]=[n.tokenizer],n.start&&(n.level==="block"?t.startBlock?t.startBlock.push(n.start):t.startBlock=[n.start]:n.level==="inline"&&(t.startInline?t.startInline.push(n.start):t.startInline=[n.start]))}"childTokens"in n&&n.childTokens&&(t.childTokens[n.name]=n.childTokens)}),s.extensions=t),r.renderer){let n=this.defaults.renderer||new i0(this.defaults);for(let o in r.renderer){if(!(o in n))throw new Error(`renderer '${o}' does not exist`);if(o==="options")continue;let a=o,l=r.renderer[a],c=n[a];n[a]=(...u)=>{let h=l.apply(n,u);return h===!1&&(h=c.apply(n,u)),h||""}}s.renderer=n}if(r.tokenizer){let n=this.defaults.tokenizer||new t0(this.defaults);for(let o in r.tokenizer){if(!(o in n))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let a=o,l=r.tokenizer[a],c=n[a];n[a]=(...u)=>{let h=l.apply(n,u);return h===!1&&(h=c.apply(n,u)),h}}s.tokenizer=n}if(r.hooks){let n=this.defaults.hooks||new kl;for(let o in r.hooks){if(!(o in n))throw new Error(`hook '${o}' does not exist`);if(o==="options")continue;let a=o,l=r.hooks[a],c=n[a];kl.passThroughHooks.has(o)?n[a]=u=>{if(this.defaults.async)return Promise.resolve(l.call(n,u)).then(d=>c.call(n,d));let h=l.call(n,u);return c.call(n,h)}:n[a]=(...u)=>{let h=l.apply(n,u);return h===!1&&(h=c.apply(n,u)),h}}s.hooks=n}if(r.walkTokens){let n=this.defaults.walkTokens,o=r.walkTokens;s.walkTokens=function(a){let l=[];return l.push(o.call(this,a)),n&&(l=l.concat(n.call(this,a))),l}}this.defaults=Ne(Ne({},this.defaults),s)}),this}setOptions(e){return this.defaults=Ne(Ne({},this.defaults),e),this}lexer(e,t){return Co.lex(e,t!=null?t:this.defaults)}parser(e,t){return ko.parse(e,t!=null?t:this.defaults)}};Eu=new WeakSet,sg=function(e,t){return(r,s)=>{let n=Ne({},s),o=Ne(Ne({},this.defaults),n);this.defaults.async===!0&&n.async===!1&&(o.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),o.async=!0);let a=y3(this,hf,Zk).call(this,!!o.silent,!!o.async);if(typeof r=="undefined"||r===null)return a(new Error("marked(): input parameter is undefined or null"));if(typeof r!="string")return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(r)+", string expected"));if(o.hooks&&(o.hooks.options=o),o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(r):r).then(l=>e(l,o)).then(l=>o.hooks?o.hooks.processAllTokens(l):l).then(l=>o.walkTokens?Promise.all(this.walkTokens(l,o.walkTokens)).then(()=>l):l).then(l=>t(l,o)).then(l=>o.hooks?o.hooks.postprocess(l):l).catch(a);try{o.hooks&&(r=o.hooks.preprocess(r));let l=e(r,o);o.hooks&&(l=o.hooks.processAllTokens(l)),o.walkTokens&&this.walkTokens(l,o.walkTokens);let c=t(l,o);return o.hooks&&(c=o.hooks.postprocess(c)),c}catch(l){return a(l)}}},hf=new WeakSet,Zk=function(e,t){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,e){let s="<p>An error occurred:</p><pre>"+os(r.message+"",!0)+"</pre>";return t?Promise.resolve(s):s}if(t)return Promise.reject(r);throw r}};var Tl=new rg;function Ke(i,e){return Tl.parse(i,e)}Ke.options=Ke.setOptions=function(i){return Tl.setOptions(i),Ke.defaults=Tl.defaults,Gk(Ke.defaults),Ke};Ke.getDefaults=ng;Ke.defaults=Il;Ke.use=function(...i){return Tl.use(...i),Ke.defaults=Tl.defaults,Gk(Ke.defaults),Ke};Ke.walkTokens=function(i,e){return Tl.walkTokens(i,e)};Ke.parseInline=Tl.parseInline;Ke.Parser=ko;Ke.parser=ko.parse;Ke.Renderer=i0;Ke.TextRenderer=wu;Ke.Lexer=Co;Ke.lexer=Co.lex;Ke.Tokenizer=t0;Ke.Hooks=kl;Ke.parse=Ke;var qBe=Ke.options,QBe=Ke.setOptions,YBe=Ke.use,KBe=Ke.walkTokens,ZBe=Ke.parseInline;var JBe=ko.parse,eUe=Co.lex;function ff(i,e){let t=i.systems.l10n,r=i.systems.rapid,s=ue("done"),n=st(i,"dataset-categories"),o=100,a=G(null),l,c,u,h=()=>!0;function d(){let _=i.container().selectAll(".shaded");if(_.empty()||_.selectAll(".modal-view-manage").size())return;let w=e.close;e.close=()=>{},h=()=>{l=null,c=null,v.transition().duration(200).style("top","0px").on("end",()=>k.remove()),e.close=w;let E=He("modal");E.on(["\u232B","\u238B"],w),G(document).call(E),s.call("done")};let A=He("modal");A.on(["\u232B","\u238B"],h),G(document).call(A);let k=_.append("div").attr("class","view-manage-wrap"),v=k.append("div").attr("class","modal rapid-modal modal-view-manage").style("opacity",0);v.append("button").attr("class","close").on("click",h).call(V("#rapid-icon-close")),a=v.append("div").attr("class","rapid-stack content"),a.call(f),a.selectAll(".ok-button").node().focus(),v.transition().style("opacity",1)}function f(_){let w=_.selectAll(".rapid-view-manage-header").data([0]).enter().append("div").attr("class","modal-section rapid-view-manage-header"),A=w.append("div");A.append("div").attr("class","rapid-view-manage-header-icon").call(V("#rapid-icon-data","icon-30")),A.append("div").attr("class","rapid-view-manage-header-text").text(t.t("rapid_feature_toggle.esri.title"));let k=w.append("div");k.append("div").attr("class","rapid-view-manage-header-about").html(Ke.parse(t.t("rapid_feature_toggle.esri.about"))),k.selectAll("a").attr("target","_blank");let v=_.selectAll(".rapid-view-manage-filter").data([0]).enter().append("div").attr("class","modal-section rapid-view-manage-filter"),E=v.append("div").attr("class","rapid-view-manage-filter-search-wrap");E.call(V("#fas-filter","inline")),E.append("input").attr("class","rapid-view-manage-filter-search").attr("placeholder",t.t("rapid_feature_toggle.esri.filter_datasets")).call(Re).on("input",C=>{let P=C.currentTarget;l=(P&&P.value||"").trim().toLowerCase(),M.call(p)}),v.append("div").attr("class","rapid-view-manage-filter-type-wrap").append("input").attr("class","rapid-view-manage-filter-type").attr("placeholder",t.t("rapid_feature_toggle.esri.any_type")).call(Re).call(n).on("blur change",C=>{let P=C.currentTarget,D=P&&P.value||"";n.data().some(R=>R.value===D)?c=D:(C.currentTarget.value="",c=null),M.call(p)}),v.append("div").attr("class","rapid-view-manage-filter-clear").append("a").attr("href","#").text(t.t("rapid_feature_toggle.esri.clear_filters")).on("click",C=>{C.preventDefault(),C.currentTarget.blur(),_.selectAll("input").property("value",""),l=null,c=null,M.call(p)}),v.append("div").attr("class","rapid-view-manage-filter-results");let M=_.selectAll(".rapid-view-manage-datasets-section").data([0]),I=M.enter().append("div").attr("class","modal-section rapid-view-manage-datasets-section");I.append("div").attr("class","rapid-view-manage-datasets-status"),I.append("div").attr("class","rapid-view-manage-datasets"),M=M.merge(I).call(p),_.selectAll(".modal-section.buttons").data([0]).enter().append("div").attr("class","modal-section buttons").append("button").attr("class","button ok-button action").on("click",h).text(t.t("confirm.okay"))}function p(_){let w=_.selectAll(".rapid-view-manage-datasets-status"),A=_.selectAll(".rapid-view-manage-datasets"),v=i.systems.storage.getItem("rapid-internal-feature.previewDatasets")==="true",E=i.services.esri;if(!E||Array.isArray(u)&&!u.length){A.classed("hide",!0),w.classed("hide",!1).text(t.t("rapid_feature_toggle.esri.no_datasets"));return}if(!u){A.classed("hide",!0),w.classed("hide",!1).text(t.t("rapid_feature_toggle.esri.fetching_datasets")),w.append("br"),w.append("img").attr("class","rapid-view-manage-datasets-spinner").attr("src",i.asset("img/loader-black.gif")),E.startAsync().then(()=>E.loadDatasetsAsync()).then(R=>{let N=new Set;Object.values(R).forEach(B=>{B.groupCategories.forEach($=>{N.add($.toLowerCase().replace("/categories/",""))})}),v||N.delete("preview");let F=Array.from(N).sort().map(B=>{let $={title:B,value:B};return B==="preview"&&($.display=`${B} <span class="rapid-view-manage-dataset-beta beta"></span>`),$});return n.data(F),u=Object.values(R).filter(B=>v||!B.groupCategories.some($=>$.toLowerCase()==="/categories/preview")),u}).then(()=>a.call(f));return}A.classed("hide",!1),w.classed("hide",!0);let S=0;u.forEach(R=>{let N=(R.title||"").toLowerCase(),F=(R.snippet||"").toLowerCase();if(y(R)){R.filtered=!1,++S;return}if(l&&N.indexOf(l)===-1&&F.indexOf(l)===-1){R.filtered=!0;return}if(c&&!R.groupCategories.some(B=>B.toLowerCase()===`/categories/${c}`)){R.filtered=!0;return}R.filtered=++S>o});let M=A.selectAll(".rapid-view-manage-dataset").data(u,R=>R.id);M.exit().remove();let I=M.enter().append("div").attr("class","rapid-view-manage-dataset"),T=I.append("div").attr("class","rapid-view-manage-dataset-label");T.append("div").attr("class","rapid-view-manage-dataset-name"),T.append("div").attr("class","rapid-view-manage-dataset-license").append("a").attr("class","rapid-view-manage-dataset-link").attr("target","_blank").attr("href",R=>R.itemURL).text(t.t("rapid_feature_toggle.esri.more_info")).call(V("#rapid-icon-out-link","inline"));let C=T.selectAll(".rapid-view-manage-dataset-featured").data(R=>R.groupCategories.filter(N=>N.toLowerCase()==="/categories/featured")).enter().append("div").attr("class","rapid-view-manage-dataset-featured");C.append("span").text("\u2B50"),C.append("span").text(t.t("rapid_feature_toggle.esri.featured")),T.selectAll(".rapid-view-manage-dataset-beta").data(R=>R.groupCategories.filter(N=>N.toLowerCase()==="/categories/preview")).enter().append("div").attr("class","rapid-view-manage-dataset-beta beta").attr("title",t.t("rapid_poweruser_features.beta")),T.append("div").attr("class","rapid-view-manage-dataset-snippet"),T.append("button").attr("class","rapid-view-manage-dataset-action").on("click",g),I.append("div").attr("class","rapid-view-manage-dataset-thumb").append("img").attr("class","rapid-view-manage-dataset-thumbnail").attr("src",R=>`https://openstreetmap.maps.arcgis.com/sharing/rest/content/items/${R.id}/info/${R.thumbnail}?w=400`),M=M.merge(I).sort(m).classed("hide",R=>R.filtered),M.selectAll(".rapid-view-manage-dataset-name").html(R=>x(l,R.title)),M.selectAll(".rapid-view-manage-dataset-snippet").html(R=>x(l,R.snippet)),M.selectAll(".rapid-view-manage-dataset-action").classed("secondary",R=>y(R)).text(R=>y(R)?t.t("rapid_feature_toggle.esri.remove"):t.t("rapid_feature_toggle.esri.add_to_map"));let D=u.filter(R=>!R.filtered).length,O=S>o&&D===o?">":"";a.selectAll(".rapid-view-manage-filter-results").text(t.t("rapid_feature_toggle.esri.datasets_found",{num:`${O}${D}`}))}function m(_,w){let A=y(_),k=y(w),v=_.groupCategories.some(S=>S.toLowerCase()==="/categories/featured"),E=w.groupCategories.some(S=>S.toLowerCase()==="/categories/featured");return A&&!k?-1:k&&!A?1:v&&!E?-1:E&&!v?1:_.title.localeCompare(w.title)}function g(_,w){let A=r.datasets,k=A.get(w.id);if(k)k.added=!k.added;else{let S=i.services.esri;S&&S.loadLayerAsync(w.id);let M=w.groupCategories.some(D=>D.toLowerCase()==="/categories/preview"),I=w.groupCategories.some(D=>D.toLowerCase()==="/categories/buildings"),T=r.colors,C=A.size%T.length,P={id:w.id,beta:M,added:!0,enabled:!0,conflated:!1,service:"esri",color:T[C],dataUsed:["esri",w.title],label:w.title,license_markdown:t.t("rapid_feature_toggle.esri.license_markdown")};if(w.extent&&(P.extent=new ie(w.extent[0],w.extent[1])),I){P.conflated=!0,P.service="mapwithai";let D=A.get("msBuildings");D&&(D.enabled=!1)}A.set(w.id,P)}let v=i.systems.urlhash,E=[...r.datasets.values()].filter(S=>S.added&&S.enabled).map(S=>S.id).join(",");v.setParam("datasets",E.length?E:null),a.call(f),i.enter("browse"),i.systems.map.immediateRedraw()}function y(_){let w=r.datasets.get(_.id);return w==null?void 0:w.added}function x(_,w){let A=w;if(_){let k=new RegExp("("+b(_)+")","gi");A=A.replace(k,"<mark>$1</mark>")}return A}function b(_){return _.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}return me(d,s,"on")}function pf(i,e,t){let r=i.systems.l10n,s=i.systems.rapid,n=G(null),o=G(null),a,l;function c(g){let y=s.datasets.get(g.id);return y==null?void 0:y.enabled}function u(g,y){let x=s.datasets.get(y.id);if(x){x.enabled=!x.enabled;let b=i.systems.urlhash,_=[...s.datasets.values()].filter(w=>w.added&&w.enabled).map(w=>w.id).join(",");b.setParam("datasets",_.length?_:null),i.scene().dirtyLayers("rapid"),i.enter("browse")}}function h(g,y){let x=s.datasets.get(g);if(x){x.color=y,i.scene().dirtyLayers("rapid"),i.systems.map.immediateRedraw(),o.call(p);let b=i.mode;if((b==null?void 0:b.id)==="select"){let _=new Map(b.selectedData);i.enter("select",{selection:_})}}}function d(){i.scene().toggleLayers("rapid"),o.call(p)}function f(g){g.shiftKey&&g.key===r.t("map_data.layers.ai-features.key")&&d()}return function(y){n=Vt(y),n.select(".modal").attr("class","modal rapid-modal"),a=ff(i,n).on("done",()=>o.call(p)),l=nf(i,n).on("change",h),o=n.select(".content").append("div").attr("class","rapid-stack").on("keypress",f),o.call(p),o.selectAll(".ok-button").node().focus(),t.on("ai_feature_toggle",()=>o.call(p))};function p(g){let y=i.scene().layers.get("rapid");if(!y)return;let x=g.selectAll(".rapid-toggle-all").data([0]),b=x.enter().append("div").attr("class","modal-section rapid-checkbox rapid-toggle-all"),_=b.append("div").attr("class","rapid-feature-label-container");_.append("div").attr("class","rapid-feature-label").html(r.t("rapid_feature_toggle.toggle_all",{rapidicon:ke("#rapid-logo-rapid-wordmark","logo-rapid")})),_.append("span").attr("class","rapid-feature-hotkey").html("("+e+")");let w=b.append("div").attr("class","rapid-checkbox-inputs").append("label").attr("class","rapid-checkbox-label");w.append("input").attr("type","checkbox").attr("class","rapid-feature-checkbox").on("click",d),w.append("div").attr("class","rapid-checkbox-custom"),x=x.merge(b),x.selectAll(".rapid-feature-checkbox").property("checked",y.enabled);let A=g.selectAll(".rapid-datasets-container").data([0]),k=A.enter().append("div").attr("class","rapid-datasets-container");A.merge(k).call(m);let v=g.selectAll(".rapid-manage-datasets").data([0]).enter().append("div").attr("class","modal-section rapid-checkbox rapid-manage-datasets").on("click",()=>i.container().call(a));v.append("div").attr("class","rapid-feature-label-container").append("div").attr("class","rapid-feature-label").text(r.t("rapid_feature_toggle.view_manage_datasets")),v.append("div").attr("class","rapid-checkbox-inputs").append("div").attr("class","rapid-checkbox-label").call(V(r.isRTL()?"#rapid-icon-backward":"#rapid-icon-forward","icon-30")),g.selectAll(".modal-section.buttons").data([0]).enter().append("div").attr("class","modal-section buttons").append("button").attr("class","button ok-button action").on("click",()=>n.remove()).text(r.t("confirm.okay"))}function m(g){let x=i.systems.storage.getItem("rapid-internal-feature.previewDatasets")==="true",b=[...s.datasets.values()].filter(E=>E.added&&(x||!E.beta)),_=i.scene().layers.get("rapid");if(!_)return;let w=g.selectAll(".rapid-checkbox-dataset").data(b,E=>E.id);w.exit().remove();let A=w.enter().append("div").attr("class","modal-section rapid-checkbox rapid-checkbox-dataset");A.append("div").attr("class","rapid-feature").each((E,S,M)=>{let I=G(M[S]),T=I.append("div").attr("class","rapid-feature-label-container");T.append("div").attr("class","rapid-feature-label").text(E.label||E.id),E.beta&&T.append("div").attr("class","rapid-feature-label-beta beta").attr("title",r.t("rapid_poweruser_features.beta")),E.description&&(T.append("div").attr("class","rapid-feature-label-divider"),T.append("div").attr("class","rapid-feature-description").text(E.description)),E.license_markdown&&(T.append("div").attr("class","rapid-feature-label-divider"),T.append("div").attr("class","rapid-feature-license").html(Ke.parse(E.license_markdown)),T.select("p a").attr("target","_blank")),I.append("div").attr("class","rapid-feature-extent-container").each((C,P,D)=>{let O=G(D[P]);C.extent&&C.extent.area()<1e4?O.append("a").attr("href","#").text(r.t("rapid_feature_toggle.center_map")).on("click",R=>{R.preventDefault(),i.systems.map.extent(C.extent)}):O.text(r.t("rapid_feature_toggle.worldwide"))})});let k=A.append("div").attr("class","rapid-checkbox-inputs");k.append("label").attr("class","rapid-colorpicker-label");let v=k.append("label").attr("class","rapid-checkbox-label");v.append("input").attr("type","checkbox").attr("class","rapid-feature-checkbox").on("click",u),v.append("div").attr("class","rapid-checkbox-custom"),w=w.merge(A).classed("disabled",!_.enabled),w.selectAll(".rapid-colorpicker-label").attr("disabled",_.enabled?null:!0).call(l),w.selectAll(".rapid-checkbox-label").classed("disabled",!_.enabled),w.selectAll(".rapid-feature-checkbox").property("checked",c).attr("disabled",_.enabled?null:!0)}}function mf(i){let e=i.systems.l10n,t=i.systems.rapid,r=i.systems.storage,s=i.systems.urlhash,n=["previewDatasets","tagnosticRoadCombine","tagSources","showAutoFix","allowLargeEdits"],o=G(null),a=G(null);s.on("hashchange",l);function l(f,p){let m=!0;if(f&&p&&(m=f.get("poweruser")!==p.get("poweruser")),!m)return;if(s.getParam("poweruser")==="true")for(let y of n){let x=r.getItem(`rapid-internal-feature.was.${y}`);x&&(r.setItem(`rapid-internal-feature.${y}`,x),r.removeItem(`rapid-internal-feature.was.${y}`))}else for(let y of n){let x=r.getItem(`rapid-internal-feature.${y}`);x&&(r.setItem(`rapid-internal-feature.was.${y}`,x),r.removeItem(`rapid-internal-feature.${y}`))}}function c(f){return r.getItem(`rapid-internal-feature.${f}`)==="true"}function u(f,p){let m=r.getItem(`rapid-internal-feature.${p}`)==="true";if(m=!m,r.setItem(`rapid-internal-feature.${p}`,m),p==="previewDatasets"&&!m){for(let g of t.datasets.values())g.beta&&(g.added=!1,g.enabled=!1);i.enter("browse"),i.systems.map.immediateRedraw()}}return f=>{l(),o=Vt(f),o.select(".modal").attr("class","modal rapid-modal"),a=o.select(".content").append("div").attr("class","rapid-stack poweruser"),a.call(h),a.selectAll(".ok-button").node().focus()};function h(f){let p=f.selectAll(".modal-section-heading").data([0]).enter().append("div").attr("class","modal-section-heading");p.append("h3").attr("class","modal-heading").html(e.t("rapid_poweruser_features.heading.label")),p.append("div").attr("class","modal-heading-desc").text(e.t("rapid_poweruser_features.heading.description")).append("span").attr("class","smile").text("\u{1F60E}");let m=f.selectAll(".rapid-features-container").data([0]),g=m.enter().append("div").attr("class","rapid-features-container");m.merge(g).call(d),f.selectAll(".modal-section.buttons").data([0]).enter().append("div").attr("class","modal-section buttons").append("button").attr("class","button ok-button action").on("click",()=>o.remove()).text(e.t("confirm.okay"))}function d(f){let p=f.selectAll(".rapid-checkbox-feature").data(n,x=>x),m=p.enter().append("div").attr("class","modal-section rapid-checkbox rapid-checkbox-feature");m.append("div").attr("class","rapid-feature").each((x,b,_)=>{let w=G(_[b]);w.append("div").attr("class","rapid-feature-label").text(A=>e.t(`rapid_poweruser_features.${A}.label`)),w.append("div").attr("class","rapid-feature-description").text(A=>e.t(`rapid_poweruser_features.${A}.description`))});let y=m.append("div").attr("class","rapid-checkbox-inputs").append("label").attr("class","rapid-checkbox-label");y.append("input").attr("type","checkbox").attr("class","rapid-feature-checkbox").on("click",u),y.append("div").attr("class","rapid-checkbox-custom"),p=p.merge(m),p.selectAll(".rapid-feature-checkbox").property("checked",c)}}function gf(i){let e=i.systems.l10n;return function(t){t.append("a").attr("href","https://mapwith.ai/doc/license/MapWithAILicense.pdf").attr("target","_blank").text(e.t("rapid_feature_license"))}}function yf(i){let e=i.systems.l10n,t=i.systems.storage,r=20231220,s=!1;return function(o){if((parseInt(t.getItem("sawWhatsNewVersion"),10)||0)===r)return;let l=Vt(o);l.select(".modal").attr("class","modal rapid-modal modal-splash modal-whatsnew");let c=l.select(".content");c.append("div").attr("class","modal-section").append("h2").html(e.t("rapid_whats_new.welcome",{rapidicon:ke("#rapid-logo-rapid-wordmark","pre-text rapid")}));let u=c.append("div").attr("class","modal-section body").html(Ke.parse(e.t("rapid_whats_new.text",{rapidicon:ke("#rapid-logo-rapid-wordmark","pre-text rapid"),bugicon:ke("#rapid-icon-bug","bugnub")})));u.append("div").attr("class","whatsnew-images").append("img").attr("class","whatsnew-image").attr("src",i.asset("img/rapid-v22-splash.jpg")),u.selectAll("p a").attr("target","_blank");let f=c.append("div").attr("class","modal-section rapid-checkbox dontshow").attr("id","dontshowagain").append("label").attr("class","rapid-checkbox-label dontshow");f.append("span").attr("class","rapid-checkbox-text").text(e.t("rapid_whats_new.dontshowagain")),f.append("input").attr("type","checkbox").attr("class","rapid-feature-checkbox").property("checked",s).on("click",g=>{s=g.target.checked}),f.append("div").attr("class","rapid-checkbox-custom"),c.append("div").attr("class","modal-actions").append("button").attr("class","whats-new-okay").append("div").text(e.t("rapid_whats_new.ok")).on("click",()=>{s&&t.setItem("sawWhatsNewVersion",r),l.close()})}}function xf(i){let e=i.systems.editor,t=i.systems.l10n;return function(r){if(!e.canRestoreBackup)return;let s=Vt(r,!0);s.select(".modal").attr("class","modal fillL");let n=s.select(".content");n.append("div").attr("class","modal-section").append("h3").text(t.t("restore.heading")),n.append("div").attr("class","modal-section").append("p").text(t.t("restore.description"));let o=n.append("div").attr("class","modal-actions"),a=o.append("button").attr("class","restore").on("click",()=>{e.restoreBackup(),s.remove()});a.append("svg").attr("class","logo logo-restore").append("use").attr("xlink:href","#rapid-logo-restore"),a.append("div").text(t.t("restore.restore"));let l=o.append("button").attr("class","reset").on("click",()=>{e.clearBackup(),s.remove()});l.append("svg").attr("class","logo logo-reset").append("use").attr("xlink:href","#rapid-logo-reset"),l.append("div").text(t.t("restore.reset")),a.node().focus()}}function vf(i){let e=i.projection,t=180,r=8,s=i.systems.l10n,n=!s.usesMetric();function o(l,c){let u=(c[1]+l[1])/2,h=n?3.28084:1,d=e2(c[0]-l[0],u)*h,f={dist:0,px:0,text:""},p;n?p=[528e4,528e3,52800,5280,500,50,5,1]:p=[5e6,5e5,5e4,5e3,500,50,5,1];for(let g=0;g<p.length;g++){let y=p[g];if(d>=y){f.dist=Math.floor(d/y)*y;break}else f.dist=+d.toFixed(2)}let m=ki(f.dist/h,u);return f.px=Math.round(e.project([l[0]+m,l[1]])[0]),f.text=s.displayLength(f.dist/h,n),f}function a(l){let c=i.systems.map.dimensions,u=e.invert([0,c[1]]),h=e.invert([t,c[1]]),d=o(u,h),f=s.isRTL();l.select(".scale-path").attr("d","M0.5,0.5v"+r+"h"+d.px+"v-"+r),l.select(".scale-text").style(f?"right":"left",d.px+16+"px").text(d.text)}return function(l){function c(){n=!n,l.call(a)}l.append("svg").attr("class","scale").on("click",c).append("g").attr("transform","translate(10,11)").append("path").attr("class","scale-path"),l.append("div").attr("class","scale-text"),i.systems.map.on("draw",()=>{window.requestIdleCallback(()=>a(l))})}}function _f(i){let e=i.systems.l10n;var t=ei(),r=0,s,n=G(null),o;function a(c){c.select(".modal").classed("modal-shortcuts",!0);var u=c.select(".content");u.append("div").attr("class","modal-section").append("h3").html(e.tHtml("shortcuts.title")),i.systems.dataloader.getDataAsync("shortcuts").then(d=>{o=d,u.call(l)}).catch(d=>console.error(d))}function l(c){if(o){var u=c.selectAll(".wrapper").data([0]),h=u.enter().append("div").attr("class","wrapper modal-section"),d=h.append("div").attr("class","tabs-bar"),f=h.append("div").attr("class","shortcuts-list");u=u.merge(h);var p=d.selectAll(".tab").data(o),m=p.enter().append("a").attr("class","tab").attr("href","#").on("click",function(v,E){v.preventDefault();var S=o.indexOf(E);r=S,l(c)});m.append("span").html(function(v){return e.tHtml(v.text)}),u.selectAll(".tab").classed("active",function(v,E){return E===r});var g=f.selectAll(".shortcut-tab").data(o),y=g.enter().append("div").attr("class",function(v){return"shortcut-tab shortcut-tab-"+v.tab}),x=y.selectAll(".shortcut-column").data(function(v){return v.columns}).enter().append("table").attr("class","shortcut-column"),b=x.selectAll(".shortcut-row").data(function(v){return v.rows}).enter().append("tr").attr("class","shortcut-row"),_=b.filter(function(v){return!v.shortcuts});_.append("td"),_.append("td").attr("class","shortcut-section").append("h3").html(function(v){return e.tHtml(v.text)});var w=b.filter(function(v){return v.shortcuts}),A=w.append("td").attr("class","shortcut-keys"),k=A.filter(function(v){return v.modifiers});k.selectAll("kbd.modifier").data(function(v){return t.os==="win"&&v.text==="shortcuts.editing.commands.redo"?["\u2303"]:t.os!=="mac"&&v.text==="shortcuts.browsing.display_options.fullscreen"?[]:v.modifiers}).enter().each(function(){var v=G(this);v.append("kbd").attr("class","modifier").text(E=>Ie.display(i,E)),v.append("span").text("+")}),A.selectAll("kbd.shortcut").data(function(v){var E=v.shortcuts;return t.os==="win"&&v.text==="shortcuts.editing.commands.redo"?E=["Y"]:t.os!=="mac"&&v.text==="shortcuts.browsing.display_options.fullscreen"&&(E=["F11"]),E=E.map(S=>Ie.display(i,S.indexOf(".")!==-1?e.t(S):S)),Fe(E).map(function(S){return{shortcut:S,separator:v.separator,suffix:v.suffix,rapid:v.rapid}})}).enter().each(function(v,E,S){var M=G(this),I=v.shortcut.toLowerCase().match(/(.*).click/);I&&I[1]?M.call(V("#rapid-walkthrough-mouse-"+I[1],"operation")):v.shortcut.toLowerCase()==="long-press"?M.call(V("#rapid-walkthrough-longpress","longpress operation")):v.shortcut.toLowerCase()==="tap"?M.call(V("#rapid-walkthrough-tap","tap operation")):M.append("kbd").attr("class","shortcut").html(function(T){return T.shortcut}),E<S.length-1?M.append("span").html(v.separator||"\xA0"+e.tHtml("shortcuts.or")+"\xA0"):E===S.length-1&&v.suffix&&M.append("span").html(v.suffix),v.rapid&&E===0&&M.append("svg").lower().attr("class","icon logo-rapid").append("use").attr("xlink:href","#rapid-logo-rapid").attr("class","#rapid-logo-rapid")}),A.filter(function(v){return v.gesture}).each(function(){var v=G(this);v.append("span").html("+"),v.append("span").attr("class","gesture").html(function(E){return e.tHtml(E.gesture)})}),w.append("td").attr("class","shortcut-desc").html(function(v){return v.text?e.tHtml(v.text):"\xA0"}),u.selectAll(".shortcut-tab").style("display",function(v,E){return E===r?"flex":"none"})}}return function(c,u){n=c,u?(s=Vt(c),s.call(a)):i.keybinding().on([e.t("shortcuts.toggle.key"),"?"],function(){i.container().selectAll(".modal-shortcuts").size()?s&&(s.close(),s=null):(s=Vt(n),s.call(a))})}}function bf(i){let e=i.systems.editor,t=i.systems.l10n,r=i.systems.ui,s=W6(i),n=e0(i),o=Vc(i),a=Zc(i),l=Qc(i),c=Kc(i),u=Jc(i),h,d=!1,f=!1,p=!1,m=!1;function g(y){var x=i.container(),b=240,_,w,A;y.style("min-width",b+"px").style("max-width","400px").style("width","33.3333%");var k=y.append("div").attr("class","sidebar-resizer").on("pointerdown.sidebar-resizer",M),v,E,S;function M(R){if(!v&&!("button"in R&&R.button!==0)){v=R.pointerId||"mouse",E=R.clientX,S=t2(x.node()),A=t2(k.node())(R)[0]-1,_=y.node().getBoundingClientRect().width,w=x.node().getBoundingClientRect().width;var N=_/w*100;y.style("width",N+"%").style("max-width","85%"),k.classed("dragging",!0),G(window).on("touchmove.sidebar-resizer",function(F){F.preventDefault()},{passive:!1}).on("pointermove.sidebar-resizer",I).on("pointerup.sidebar-resizer pointercancel.sidebar-resizer",T)}}function I(R){if(v===(R.pointerId||"mouse")){R.preventDefault();var N=R.clientX-E;E=R.clientX;var F=t.isRTL(),B=F?0:1,$=F?"margin-right":"margin-left",U=S(R)[0]-A;_=F?w-U:U;var H=y.classed("collapsed"),z=_<b;if(y.classed("collapsed",z),z)H||(y.style($,"-400px").style("width","400px"),r.resize([(_-N)*B,0]));else{var j=_/w*100;y.style($,null).style("width",j+"%"),H?r.resize([-_*B,0]):r.resize([-N*B,0])}}}function T(R){v===(R.pointerId||"mouse")&&(v=null,k.classed("dragging",!1),G(window).on("touchmove.sidebar-resizer",null).on("pointermove.sidebar-resizer",null).on("pointerup.sidebar-resizer pointercancel.sidebar-resizer",null))}var C=y.append("div").attr("class","feature-list-pane").call(L6(i)),P=y.append("div").attr("class","inspector-hidden inspector-wrap"),D=function(R){if(i.container().selectAll(".feature-list-item button").classed("hover",!1),i.selectedIDs().length>1&&R&&R.length){var N=i.container().selectAll(".feature-list-item button").filter(function(F){return R.indexOf(F)!==-1});N.empty()||N.classed("hover",!0)}};g.hoverModeSelect=on(D,200);function O(R){var H;let N=e.staging.graph,F=R&&R.length&&R[0];if(F&&F.__featurehash__)f=!0,g.show(o.datum(F)),y.selectAll(".sidebar-component").classed("inspector-hover",!0);else if(F&&F.__fbid__)d=!0,g.show(n.datum(F)),y.selectAll(".sidebar-component").classed("inspector-hover",!0).classed("rapid-inspector-fadein",!0);else if(F instanceof _t){if(((H=i.mode)==null?void 0:H.id)==="drag-note")return;p=!0;var B=i.services.osm;B&&(F=B.getNote(F.id)),g.show(a.note(F)),y.selectAll(".sidebar-component").classed("inspector-hover",!0)}else if(F instanceof ut){m=!0;var $=i.services[F.service];$&&(F=$.getError(F.id));var U;F.service==="keepRight"?U=c:F.service==="osmose"?U=u:U=l,i.container().selectAll(".qaItem."+F.service).classed("hover",function(z){return z.id===F.id}),g.show(U.error(F)),y.selectAll(".sidebar-component").classed("inspector-hover",!0)}else!h&&F instanceof de&&N.hasEntity(F)?(C.classed("inspector-hidden",!0),P.classed("inspector-hidden",!1).classed("inspector-hover",!0),(!s.entityIDs()||!ai(s.entityIDs(),[F.id])||s.state()!=="hover")&&(s.state("hover").entityIDs([F.id]).newFeature(!1),P.call(s))):h?(d||f||p||m)&&(d=!1,p=!1,f=!1,m=!1,i.container().selectAll(".layer-ai-features .hover").classed("hover",!1),i.container().selectAll(".note").classed("hover",!1),i.container().selectAll(".qaItem").classed("hover",!1),g.hide()):(C.classed("inspector-hidden",!1),P.classed("inspector-hidden",!0),s.state("hide"))}g.hover=on(O,200),g.intersects=function(R){var N=y.node().getBoundingClientRect();return R.intersects(new ie(i.projection.invert([0,N.height]),i.projection.invert([N.width,0])))},g.select=function(R,N){if(g.hide(),R&&R.length){let B=e.staging.graph,$=R.length===1&&B.entity(R[0]);if($&&N&&y.classed("collapsed")){var F=$.extent(B);g.expand(g.intersects(F))}C.classed("inspector-hidden",!0),P.classed("inspector-hidden",!1).classed("inspector-hover",!1),s.state("select").entityIDs(R).newFeature(N),P.call(s)}else s.state("hide")},g.showPresetList=function(...R){s.showPresetList(...R)},g.showEntityEditor=function(...R){s.showEntityEditor(...R)},g.show=function(R,N){C.classed("inspector-hidden",!0),P.classed("inspector-hidden",!0),h&&h.remove(),h=y.append("div").attr("class","sidebar-component").call(R,N)},g.hide=function(){C.classed("inspector-hidden",!1),P.classed("inspector-hidden",!0),h&&h.remove(),h=null},g.expand=function(R){y.classed("collapsed")&&g.toggle(R)},g.collapse=function(R){y.classed("collapsed")||g.toggle(R)},g.toggle=function(R){if(!i.inIntro){var N=y.classed("collapsed"),F=!N,B=t.isRTL(),$=B?0:1,U=B?"margin-right":"margin-left";_=y.node().getBoundingClientRect().width,y.style("width",_+"px");var H,z,j;F?(H=j=0,z=-_):(H=j=-_,z=0),F||y.classed("collapsed",F),y.transition().style(U,z+"px").tween("panner",function(){var X=qt(H,z);return function(K){var Y=j-Math.round(X(K));j=j-Y,r.resize(R?void 0:[Y*$,0])}}).on("end",function(){F&&y.classed("collapsed",F);let X=i.pixi.view.parentNode;if(i.pixi.resize(X.clientWidth,X.clientHeight),!F){var K=x.node().getBoundingClientRect().width,Y=_/K*100;y.style(U,null).style("width",Y+"%")}})}},k.on("dblclick",function(R){R.preventDefault(),R.sourceEvent&&R.sourceEvent.preventDefault(),g.toggle()})}return g.showPresetList=function(){},g.showEntityEditor=function(){},g.hover=function(){},g.hover.cancel=function(){},g.intersects=function(){},g.select=function(){},g.show=function(){},g.hide=function(){},g.expand=function(){},g.collapse=function(){},g.toggle=function(){},g}function wf(i){let e=i.systems.editor,t=i.systems.l10n,r;function s(o){var c;o.preventDefault();let a=i.services.osm;if(!a||i.inIntro||((c=i.mode)==null?void 0:c.id)==="save"||e.hasChanges()&&!window.confirm(t.t("source_switch.lose_changes")))return;let l=G(this).classed("live");l=!l,i.enter("browse"),e.clearBackup(),i.resetAsync().then(()=>(G(this).html(l?t.tHtml("source_switch.live"):t.tHtml("source_switch.dev")).classed("live",l).classed("chip",l),a.switchAsync(l?r[0]:r[1])))}let n=function(o){o.append("a").attr("href","#").html(t.tHtml("source_switch.live")).attr("class","live chip").on("click",s)};return n.keys=function(o){return arguments.length?(r=o,n):r},n}function Ef(i){var e=i.services.osm;return function(t){var r=t.append("img").attr("src",i.asset("img/loader-black.gif")).style("opacity",0);e&&e.on("loading.spinner",function(){r.transition().style("opacity",1)}).on("loaded.spinner",function(){r.transition().style("opacity",0)})}}function Jk(i){let e=i.systems.editor,t=i.systems.l10n,r=i.systems.storage;return s=>{if(e.canRestoreBackup)return;let n="",o=r.getItem("sawPrivacyVersion"),a=!r.getItem("sawSplash");if(o!==i.privacyVersion&&(n=t.t("splash.privacy_update"),a=!0),!a)return;r.setItem("sawSplash",!0),r.setItem("sawPrivacyVersion",i.privacyVersion),i.systems.dataloader.getDataAsync("intro_graph");let c=Vt(s);c.select(".modal").attr("class","modal-splash modal");let u=c.select(".content").append("div").attr("class","fillL");u.append("div").attr("class","modal-section").append("h3").text(t.t("splash.welcome"));let h=u.append("div").attr("class","modal-section");h.append("p").html(t.tHtml("splash.text",{version:i.version,website:'<a target="_blank" href="https://github.com/openstreetmap/iD/blob/develop/CHANGELOG.md#whats-new">changelog</a>',github:'<a target="_blank" href="https://github.com/openstreetmap/iD/issues">github.com</a>'})),h.append("p").html(t.tHtml("splash.privacy",{updateMessage:n,privacyLink:'<a target="_blank" href="https://github.com/openstreetmap/iD/blob/release/PRIVACY.md">'+t.t("splash.privacy_policy")+"</a>"}));let d=u.append("div").attr("class","modal-actions"),f=d.append("button").attr("class","walkthrough").on("click",()=>{i.container().call(an(i)),c.close()});f.append("svg").attr("class","logo logo-walkthrough").append("use").attr("xlink:href","#rapid-logo-walkthrough"),f.append("div").html(t.tHtml("splash.walkthrough"));let p=d.append("button").attr("class","start-editing").on("click",c.close);p.append("svg").attr("class","logo logo-features").append("use").attr("xlink:href","#rapid-logo-features"),p.append("div").html(t.tHtml("splash.start")),c.select("button.close").attr("class","hide")}}function Af(i){let e=i.systems.editor,t=i.systems.l10n,r=i.services.osm,s,n,o,a;return function(l){if(!r)return;o||(o=window.setInterval(()=>{s==="ratelimit"&&h()},1e3)),a||(a=window.setInterval(()=>{r.reloadApiStatus()},9e4)),r.reloadApiStatus(),r.off("apistatuschange",u),r.on("apistatuschange",u),e.off("backupstatuschange",c),e.on("backupstatuschange",c);function c(d){n=d?"ok":"error",h()}function u(d,f){s=f!=null?f:"error",h()}function h(){let d=r.getRateLimit();l.html(""),s==="readonly"?l.attr("class","api-status").text(t.t("osm_api_status.message.readonly")):s==="offline"?l.attr("class","api-status").text(t.t("osm_api_status.message.offline")):s==="ratelimit"&&d?(l.attr("class","api-status error").text(t.t("osm_api_status.message.ratelimit",{seconds:d.remaining})),r.authenticated()||l.append("a").attr("href","#").attr("class","api-status-login").attr("target","_blank").call(V("#rapid-icon-out-link","inline")).append("span").text(t.t("login")).on("click.login",f=>{f.preventDefault(),r.authenticate(),s="online"})):s==="error"?l.attr("class","api-status error").text(t.t("osm_api_status.message.error")+" ").append("a").attr("href","#").text(t.t("osm_api_status.retry")).on("click.retry",f=>{f.preventDefault(),r.throttledReloadApiStatus()}):n==="error"&&l.attr("class","api-status error").text(t.t("osm_api_status.message.local_storage_full"))}}}var eT=et(b3(),1);function hg(i){return typeof i!="string"?"":eT.default.remove(i.replace(/&/g,"and").replace(/(|i)/ig,"i").replace(/[\s\-=_!"#%'*{},.\/:;?\(\)\[\]@\\$\^*+<>~`\u00a1\u00a7\u00b6\u00b7\u00bf\u037e\u0387\u055a-\u055f\u0589\u05c0\u05c3\u05c6\u05f3\u05f4\u0609\u060a\u060c\u060d\u061b\u061e\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0830-\u083e\u085e\u0964\u0965\u0970\u0af0\u0df4\u0e4f\u0e5a\u0e5b\u0f04-\u0f12\u0f14\u0f85\u0fd0-\u0fd4\u0fd9\u0fda\u104a-\u104f\u10fb\u1360-\u1368\u166d\u166e\u16eb-\u16ed\u1735\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u1805\u1807-\u180a\u1944\u1945\u1a1e\u1a1f\u1aa0-\u1aa6\u1aa8-\u1aad\u1b5a-\u1b60\u1bfc-\u1bff\u1c3b-\u1c3f\u1c7e\u1c7f\u1cc0-\u1cc7\u1cd3\u2000-\u206f\u2cf9-\u2cfc\u2cfe\u2cff\u2d70\u2e00-\u2e7f\u3001-\u3003\u303d\u30fb\ua4fe\ua4ff\ua60d-\ua60f\ua673\ua67e\ua6f2-\ua6f7\ua874-\ua877\ua8ce\ua8cf\ua8f8-\ua8fa\ua92e\ua92f\ua95f\ua9c1-\ua9cd\ua9de\ua9df\uaa5c-\uaa5f\uaade\uaadf\uaaf0\uaaf1\uabeb\ufe10-\ufe16\ufe19\ufe30\ufe45\ufe46\ufe49-\ufe4c\ufe50-\ufe52\ufe54-\ufe57\ufe5f-\ufe61\ufe68\ufe6a\ufe6b\ufeff\uff01-\uff03\uff05-\uff07\uff0a\uff0c\uff0e\uff0f\uff1a\uff1b\uff1f\uff20\uff3c\uff61\uff64\uff65]+/g,"").toLowerCase())}function dg(i,e,t){let r=Object.assign({},i.strings),s=Object.assign({},e[i.type]),n=new RegExp(/(\{\w+\})/,"gi");if(t){if(r.community){let u=hg(r.community);r.community=t(`_communities.${u}`)}["name","description","extendedDescription"].forEach(u=>{s[u]&&(s[u]=t(`_defaults.${i.type}.${u}`)),r[u]&&(r[u]=t(`${i.id}.${u}`))})}let o={account:i.account,community:r.community,signupUrl:r.signupUrl,url:r.url};o.signupUrl||(o.signupUrl=l(r.signupUrl||s.signupUrl)),o.url||(o.url=l(r.url||s.url));let a={name:l(r.name||s.name),url:l(r.url||s.url),signupUrl:l(r.signupUrl||s.signupUrl),description:l(r.description||s.description),extendedDescription:l(r.extendedDescription||s.extendedDescription)};return a.nameHTML=c(a.url,a.name),a.urlHTML=c(a.url),a.signupUrlHTML=c(a.signupUrl),a.descriptionHTML=l(r.description||s.description,!0),a.extendedDescriptionHTML=l(r.extendedDescription||s.extendedDescription,!0),a;function l(u,h){if(!u)return;let d=u;for(let p in o){let m=`{${p}}`,g=new RegExp(m,"g");if(g.test(d)){let y=o[p];if(y)h&&(p==="signupUrl"||p==="url")&&(y=c(y)),d=d.replace(g,y);else throw new Error(`Cannot resolve token: ${m}`)}}let f=d.match(n);if(f)throw new Error(`Cannot resolve tokens: ${f}`);return h&&i.type==="reddit"&&(d=d.replace(/(\/r\/\w+\/*)/i,p=>c(a.url,p))),d}function c(u,h){if(u)return h=h||u,`<a target="_blank" href="${u}">${h}</a>`}}var r0=null;function Sf(i){let e=i.systems.dataloader,t=i.systems.locations,r=i.systems.l10n,s=i.systems.map,n=ue("cancel"),o=2,a,l;c();function c(){return Promise.all([e.getDataAsync("oci_features"),e.getDataAsync("oci_resources"),e.getDataAsync("oci_defaults")]).then(p=>{if(r0)return r0;p[0]&&Array.isArray(p[0].features)&&t.mergeCustomGeoJSON(p[0]);let m=Object.values(p[1].resources);return m.length?t.mergeLocationSets(m).then(()=>(r0={resources:m,defaults:p[2].defaults},r0)):(r0={resources:[],defaults:p[2].defaults},r0)})}function u(p){if(!p)return;let m=p.trim();if(!m)return;/Z$/.test(m)||(m+="Z");let g=new Date(m);return new Date(g.toUTCString().slice(0,25))}function h(p){let m=p.append("div").attr("class","header fillL");m.append("h3").text(r.t("success.just_edited")),m.append("button").attr("class","close").on("click",()=>n.call("cancel")).call(V("#rapid-icon-close"));let g=p.append("div").attr("class","body save-success fillL"),y=g.append("div").attr("class","save-summary");y.append("h3").text(r.t("success.thank_you"+(l?"_location":""),{where:l})),y.append("p").text(r.t("success.your_changes")).append("a").attr("class","link-out").attr("target","_blank").attr("href",r.t("success.help_link_url")).call(V("#rapid-icon-out-link","inline")).append("span").text(r.t("success.help_link_text"));let x=i.services.osm;if(!x)return;let b=x.changesetURL(a.id),w=y.append("table").attr("class","summary-table").append("tr").attr("class","summary-row");w.append("td").attr("class","cell-icon summary-icon").append("a").attr("target","_blank").attr("href",b).append("svg").attr("class","logo-small").append("use").attr("xlink:href","#rapid-logo-osm");let A=w.append("td").attr("class","cell-detail summary-detail");A.append("a").attr("class","cell-detail summary-view-on-osm").attr("target","_blank").attr("href",b).text(r.t("success.view_on_osm")),A.append("div").text(r.t("success.your_changeset_id")).append("a").attr("target","_blank").attr("href",b).text(a.id),c().then(k=>{let v=s.center(),E=t.locationSetsAt(v),S=[];k.resources.forEach(M=>{let I=E[M.locationSetID];if(!I)return;let T=C=>r.t(`community.${C}`);M.resolved=dg(M,k.defaults,T),S.push({area:I,order:M.order||0,resource:M})}),S.sort((M,I)=>M.area-I.area||I.order-M.order),g.call(d,S.map(M=>M.resource))})}function d(p,m){let g=p.append("div").attr("class","save-communityLinks");g.append("h3").text(r.t("success.like_osm"));let b=g.append("table").attr("class","community-table").selectAll(".community-row").data(m).enter().append("tr").attr("class","community-row");b.append("td").attr("class","cell-icon community-icon").append("a").attr("target","_blank").attr("href",w=>w.resolved.url).append("svg").attr("class","logo-small").append("use").attr("xlink:href",w=>`#community-${w.type}`),b.append("td").attr("class","cell-detail community-detail").each(f),g.append("div").attr("class","community-missing").text(r.t("success.missing")).append("a").attr("class","link-out").attr("target","_blank").call(V("#rapid-icon-out-link","inline")).attr("href","https://github.com/osmlab/osm-community-index/issues").append("span").text(r.t("success.tell_us"))}function f(p,m,g){let y=G(g[m]),x=p.id;y.append("div").attr("class","community-name").html(p.resolved.nameHTML),y.append("div").attr("class","community-description").html(p.resolved.descriptionHTML),(p.resolved.extendedDescriptionHTML||p.languageCodes&&p.languageCodes.length)&&y.append("div").call(El(i,`community-more-${p.id}`).expanded(!1).checkPreference(!1).label(r.t("success.more")).content(_));let b=(p.events||[]).map(A=>(A.date=u(A.when),A)).filter(A=>{let k=A.date.getTime(),v=new Date().setHours(0,0,0,0);return!isNaN(k)&&k>=v}).sort((A,k)=>A.date<k.date?-1:A.date>k.date?1:0).slice(0,o);b.length&&y.append("div").call(El(i,`community-events-${p.id}`).expanded(!1).checkPreference(!1).label(r.t("success.events")).content(w)).select(".hide-toggle").append("span").attr("class","badge-text").text(b.length);function _(A){let v=A.selectAll(".community-more").data([0]).enter().append("div").attr("class","community-more");if(p.resolved.extendedDescriptionHTML&&v.append("div").attr("class","community-extended-description").html(p.resolved.extendedDescriptionHTML),p.languageCodes&&p.languageCodes.length){let E=p.languageCodes.map(S=>r.languageName(S)).join(", ");v.append("div").attr("class","community-languages").text(r.t("success.languages",{languages:E}))}}function w(A){let E=A.append("div").attr("class","community-events").selectAll(".community-event").data(b).enter().append("div").attr("class","community-event");E.append("div").attr("class","community-event-name").append("a").attr("target","_blank").attr("href",S=>S.url).text(S=>{let M=S.name;return S.i18n&&S.id&&(M=r.t(`community.${x}.events.${S.id}.name`,{default:M})),M}),E.append("div").attr("class","community-event-when").text(S=>{let M={weekday:"short",day:"numeric",month:"short",year:"numeric"};(S.date.getHours()||S.date.getMinutes())&&(M.hour="numeric",M.minute="numeric");let I=r.localeCode();return S.date.toLocaleString(I,M)}),E.append("div").attr("class","community-event-where").text(S=>{let M=S.where;return S.i18n&&S.id&&(M=r.t(`community.${x}.events.${S.id}.where`,{default:M})),M}),E.append("div").attr("class","community-event-description").text(S=>{let M=S.description;return S.i18n&&S.id&&(M=r.t(`community.${x}.events.${S.id}.description`,{default:M})),M})}}return h.changeset=function(p){return arguments.length?(a=p,h):a},h.location=function(p){return arguments.length?(l=p,h):l},me(h,n,"on")}function tT(i){let e=i.systems.editor,t=i.systems.l10n,r={id:"download_osc",label:t.t("download_osc.title")},s=null,n=null,o=0;function a(){return o===0}function l(d){if(d.preventDefault(),!i.inIntro&&e.hasChanges()){let f=e.changes(to(e.difference())),p=new vr,m=Gn.stringify(p.osmChangeJXON(f));h(m,"change.osc")}}function c(){if(!n)return;let d=e.difference().summary().size;d!==o&&(o=d,n&&n.title(t.t(o>0?"download_osc.help":"download_osc.no_changes")),u())}function u(){s&&s.classed("disabled",a())}function h(d,f){let p=document.createElement("a");p.style.display="none",document.body.appendChild(p),p.href=window.URL.createObjectURL(new Blob([d])),p.setAttribute("download",f),p.click(),window.URL.revokeObjectURL(p.href),document.body.removeChild(p)}return r.install=function(d){s&&n||(n=he(i).placement("bottom").title(t.t("download_osc.no_changes")),s=d.append("button").attr("class","downloadOsc disabled bar-button").on("click",l).call(n),s.call(V("#rapid-icon-download-osc")),c(),e.on("stablechange",c),i.on("modechange",u))},r.uninstall=function(){!s&&!n||(e.off("stablechange",c),i.off("modechange",u),s=null,n=null)},r}function iT(i){let e=i.systems.l10n,t=i.systems.map,r=i.systems.presets,s=i.systems.ui,n,o,a={id:"draw_modes",label:e.t("toolbar.add_feature")},l=[{id:"add-point",title:e.t("modes.add_point.title"),button:"point",description:e.t("modes.add_point.description"),preset:r.item("point"),key:"1"},{id:"draw-line",title:e.t("modes.add_line.title"),button:"line",description:e.t("modes.add_line.description"),preset:r.item("line"),key:"2"},{id:"draw-area",title:e.t("modes.add_area.title"),button:"area",description:e.t("modes.add_area.description"),preset:r.item("area"),key:"3"}];function c(){if(!o)return;let u=o.selectAll("button.add-button").data(l,d=>d.id);u.exit().remove();let h=u.enter().append("button").attr("class",d=>`${d.id} add-button bar-button`).on("click.mode-buttons",(d,f)=>{var m;if(!i.editable())return;let p=(m=i.mode)==null?void 0:m.id;/^draw/.test(p)||(f.id===p?i.enter("browse"):i.enter(f.id))}).call(he(i).placement("bottom").title(d=>d.description).shortcut(d=>d.key).scrollContainer(i.container().select(".top-toolbar")));h.each((d,f,p)=>{G(p[f]).call(V(`#rapid-icon-${d.button}`))}),h.append("span").attr("class","label").text(d=>d.title),(u.enter().size()||u.exit().size())&&s.checkOverflow(".top-toolbar",!0),u=u.merge(h).classed("disabled",()=>!i.editable()).classed("active",d=>{var f;return((f=i.mode)==null?void 0:f.id)===d.id})}return a.install=function(u){o=u.append("div").attr("class","joined").style("display","flex"),n=wt(c,500,{leading:!0,trailing:!0}),l.forEach(h=>{i.keybinding().on(h.key,()=>{var d;i.editable()&&(h.id===((d=i.mode)==null?void 0:d.id)?i.enter("browse"):i.enter(h.id))})}),t.on("draw",n),i.on("modechange",c),c()},a.uninstall=function(){l.forEach(u=>{i.keybinding().off(u.key)}),n.cancel(),t.off("draw",n),i.off("modechange",c),o=null},a}function rT(i){let e=i.systems.l10n,t=i.systems.map,r=i.systems.ui,s={id:"notes",label:e.t("modes.add_note.label")},n={id:"add-note",title:e.t("modes.add_note.title"),button:"note",description:e.t("modes.add_note.description"),key:e.t("modes.add_note.key")};function o(){var h;return(h=i.scene().layers.get("notes"))==null?void 0:h.enabled}function a(){var h;return((h=i.mode)==null?void 0:h.id)!=="save"}let l,c;function u(){if(!c)return;let h=o()?[n]:[],d=c.selectAll("button.add-button").data(h,p=>p.id);d.exit().remove();let f=d.enter().append("button").attr("class",p=>`${p.id} add-button bar-button`).on("click.notes",(p,m)=>{var y;if(a()){var g=(y=i.mode)==null?void 0:y.id;/^draw/.test(g)||(m.id===g?i.enter("browse"):i.enter(m.id))}}).call(he(i).placement("bottom").title(p=>p.description).shortcut(p=>p.key).scrollContainer(i.container().select(".top-toolbar")));f.each((p,m,g)=>{G(g[m]).call(V(p.icon||`#rapid-icon-${p.button}`))}),(d.enter().size()||d.exit().size())&&r.checkOverflow(".top-toolbar",!0),d=d.merge(f).classed("disabled",()=>!o()).classed("active",p=>{var m;return((m=i.mode)==null?void 0:m.id)===p.id})}return s.install=function(h){c=h,l=wt(u,500,{leading:!0,trailing:!0}),i.keybinding().on(n.key,()=>{var d;a()&&(n.id===((d=i.mode)==null?void 0:d.id)?i.enter("browse"):i.enter(n.id))}),t.on("draw",l),i.on("modechange",u),u()},s.uninstall=function(){l.cancel(),i.keybinding().off(n.key),i.off("modechange",u),t.off("draw",l),c=null},s}function sT(i){let e=i.systems.l10n,t=i.systems.map,r=i.systems.urlhash,s=ue("ai_feature_toggle"),n="\u21E7"+e.t("map_data.layers.ai-features.key"),o=pf(i,Ie(n),s),a=mf(i),l,c={id:"rapid_features",label:e.t("toolbar.rapid_features")};function u(){if(!i.scene)return!1;let m=t.scene.layers.get("rapid");return m==null?void 0:m.enabled}function h(){t.scene.toggleLayers("rapid"),s.call("ai_feature_toggle")}function d(){i.container().call(o)}function f(){i.container().call(a)}function p(){if(!l)return;let m=r.getParam("poweruser")==="true";l.attr("class",m?"joined":null);let g=l.selectAll(".rapid-features").data([0]),y=g.enter().append("button").attr("class","bar-button rapid-features").attr("tabindex",-1).on("click",d).call(he(i).placement("bottom").title(e.t("shortcuts.browsing.display_options.rapid_features_data")).shortcut(n));y.append("svg").attr("class","logo-rapid").append("use").attr("xlink:href","#rapid-logo-rapid-wordmark"),g.merge(y).classed("layer-off",!u());let x=l.selectAll(".rapid-poweruser-features").data(m?[0]:[]);x.exit().remove(),x.enter().append("button").attr("class","bar-button rapid-poweruser-features").attr("tabindex",-1).on("click",f).call(he(i).placement("bottom").title(e.t("rapid_poweruser_features.heading.label"))).append("div").attr("class","beta")}return c.install=m=>{i.keybinding().on(Ie(n),g=>{g.preventDefault(),g.stopPropagation(),h()}),r.on("hashchange",p),t.scene.on("layerchange",p),i.on("modechange",p),l=m.append("div").style("display","flex"),p()},c.uninstall=function(){i.keybinding().off(Ie(n)),r.off("hashchange",p),t.scene.off("layerchange",p),i.off("modechange",p),l=null},c}function nT(i){let e=i.systems.editor,t=i.systems.l10n,r={id:"save",label:t.t("save.title")},s=Ie("\u2318S"),n=0,o=null,a=null;function l(){var p;return((p=i.mode)==null?void 0:p.id)==="save"}function c(){return n===0||i.inIntro||l()}function u(p){p.preventDefault(),!i.inIntro&&!l()&&e.hasChanges()&&i.enter("save")}function h(){let p;return n===0?null:n<=50?(p=n/50,fn("#fff","#ff8")(p)):(p=Math.min((n-50)/50,1),fn("#ff8","#f88")(p))}function d(){if(!o||!a)return;let p=e.difference().summary().size;p!==n&&(n=p,a&&a.title(t.t(n>0?"save.help":"save.no_changes")).shortcut(s),o.classed("disabled",c()).style("background",h(n)),o.select("span.count").text(n))}function f(){!o||!a||(o.classed("disabled",c()),l()&&o.call(a.hide))}return r.install=function(p){o&&a||(a=he(i).placement("bottom").title(t.t("save.no_changes")).shortcut(s).scrollContainer(i.container().select(".top-toolbar")),o=p.append("button").attr("class","save disabled bar-button").on("click",m=>{u(m)}).call(a),o.call(V("#rapid-icon-save")),o.append("span").attr("class","count").attr("aria-hidden","true").text("0"),d(),i.keybinding().on(s,u,!0),e.on("stablechange",d),i.on("modechange",f))},r.uninstall=function(){!o&&!a||(i.keybinding().off(s,!0),e.off("stablechange",d),i.off("modechange",f),o=null,a=null)},r}function oT(i){let e=i.systems.l10n,t=i.systems.ui,r={id:"sidebar_toggle",label:e.t("toolbar.inspect")};return r.install=function(s){s.append("button").attr("class","bar-button").on("click",()=>t.sidebar.toggle()).call(he(i).placement("bottom").title(e.t("sidebar.tooltip")).shortcut(e.t("sidebar.key")).scrollContainer(i.container().select(".top-toolbar"))).call(V("#rapid-icon-sidebar-"+(e.isRTL()?"right":"left")))},r}function aT(i){let e=i.systems.editor,t=i.systems.l10n,r=i.systems.map,s=t.isRTL(),n=null,o=null,a,l={id:"undo_redo",label:t.t("toolbar.undo_redo")},c=[{id:"undo",key:Ie("\u2318Z"),action:()=>e.undo(),annotation:()=>e.getUndoAnnotation(),icon:s?"redo":"undo"},{id:"redo",key:Ie("\u2318\u21E7Z"),action:()=>e.redo(),annotation:()=>e.getRedoAnnotation(),icon:s?"undo":"redo"}];function u(){!n||!o||n.classed("disabled",h=>!i.editable()||!h.annotation()).each((h,d,f)=>{let p=G(f[d]);p.select(".tooltip.in").empty()||p.call(o.updateContent)})}return l.install=function(h){if(!(n&&o)){o=he(i).placement("bottom").title(d=>{let f=d.annotation();return f&&f.description&&(f=f.description),f?t.t(`${d.id}.tooltip`,{action:f}):t.t(`${d.id}.nothing`)}).shortcut(d=>d.key).scrollContainer(i.container().select(".top-toolbar")),n=h.selectAll("button").data(c).enter().append("button").attr("class",d=>`disabled ${d.id}-button bar-button`).on("click",(d,f)=>{d.preventDefault();let p=f.annotation();i.editable()&&p&&f.action()}).call(o),n.each((d,f,p)=>{G(p[f]).call(V(`#rapid-icon-${d.icon}`))}),a=wt(u,500,{leading:!0,trailing:!0});for(let d of c)i.keybinding().on(d.key,f=>{f.preventDefault(),i.editable()&&d.action()});r.on("draw",a),e.on("stablechange",u),i.on("modechange",u)}},l.uninstall=function(){if(!(!n&&!o)){for(let h of c)i.keybinding().off(h.key);a.cancel(),r.off("draw",a),e.off("stablechange",u),i.off("modechange",u),o=null,n=null}},l}function Cf(i){let e=oT(i),t=sT(i),r=iT(i),s=rT(i),n=aT(i),o=nT(i),a=tT(i);function l(){var h;return(h=i.scene().layers.get("notes"))==null?void 0:h.enabled}function c(h){let d=[e,"spacer",r,t];l()&&d.push("spacer",s),d.push("spacer",n,o),i.systems.urlhash.initialHashParams.get("support_download_osc")==="true"&&d.push(a);let p=h.selectAll(".toolbar-item").data(d,y=>y.id||y);p.exit().each(y=>{y.uninstall&&y.uninstall()}).remove();let g=p.enter().append("div").attr("class",y=>{let x="toolbar-item "+(y.id||y).replace("_","-");return y.klass&&(x+=" "+y.klass),x}).filter(y=>y!=="spacer");g.append("div").attr("class","item-content").each((y,x,b)=>{G(b[x]).call(y.install,h)}),g.append("div").attr("class","item-label").html(y=>y.label)}function u(h){i.scene().on("layerchange",()=>c(h)),c(h)}return u}var lT=null,fg=!1,pg=!1;function kf(i){let e=i.systems.l10n,t=i.systems.storage,r=i.version,s=r.match(/\d+\.\d+\.\d+.*/);return lT===null&&s!==null&&(t.getItem("sawVersion")?(pg=!1,fg=t.getItem("sawVersion")!==r&&r.indexOf("-")===-1):(pg=!0,fg=!0),t.setItem("sawVersion",r),lT=r),function(o){o.append("a").attr("target","_blank").attr("tabindex",-1).attr("href","https://github.com/facebook/Rapid/blob/main/CHANGELOG.md").text(r),fg&&!pg&&o.append("a").attr("class","badge").attr("target","_blank").attr("tabindex",-1).attr("href","https://github.com/facebook/Rapid/blob/main/CHANGELOG.md").call(V("#maki-gift")).call(he(i).title(e.t("version.whats_new",{version:r})).placement("top").scrollContainer(i.container().select(".main-footer-wrap")))}}function Tf(i){let e=i.systems.l10n,t=i.systems.map,r=i.systems.ui,s=[{id:"zoom-in",icon:"rapid-icon-plus",title:e.t("zoom.in"),action:n,isDisabled:()=>!t.canZoomIn(),disabledTitle:e.t("zoom.disabled.in"),key:"+"},{id:"zoom-out",icon:"rapid-icon-minus",title:e.t("zoom.out"),action:o,isDisabled:()=>!t.canZoomOut(),disabledTitle:e.t("zoom.disabled.out"),key:"-"}];function n(c){c.preventDefault(),t.zoomIn()}function o(c){c.preventDefault(),t.zoomOut()}function a(c){c.preventDefault(),t.zoomInFurther()}function l(c){c.preventDefault(),t.zoomOutFurther()}return function(u){let h=he(i).placement(e.isRTL()?"right":"left").title(m=>m.isDisabled()?m.disabledTitle:m.title).shortcut(m=>m.key),d,f=u.selectAll("button").data(s).enter().append("button").attr("class",m=>m.id).on("pointerup",m=>d=m.pointerType).on("click",(m,g)=>{g.isDisabled()?(d==="touch"||d==="pen")&&r.flash.duration(2e3).iconName(`#${g.icon}`).iconClass("disabled").label(g.disabledTitle)():g.action(m),d=null}).call(h);f.each((m,g,y)=>{G(y[g]).call(V(`#${m.icon}`,"light"))}),He.plusKeys.forEach(m=>{i.keybinding().on([m],n),i.keybinding().on([Ie("\u2325"+m)],a)}),He.minusKeys.forEach(m=>{i.keybinding().on([m],o),i.keybinding().on([Ie("\u2325"+m)],l)});function p(){f.classed("disabled",m=>m.isDisabled()).each((m,g,y)=>{let x=G(y[g]);x.select(".tooltip.in").empty()||x.call(h.updateContent)})}p(),t.on("draw",p)}}function If(i){let e=i.systems.l10n,t=i.systems.map,r=i.systems.ui,s=e.t("inspector.zoom_to.key"),n,o;return function(l){let c=he(i).placement(e.isRTL()?"right":"left").title(()=>h()?e.t("inspector.zoom_to.no_selection"):e.t("inspector.zoom_to.title")).shortcut(s),u=l.append("button").on("pointerup",p=>n=p.pointerType).on("click",d).call(V("#rapid-icon-framed-dot","light")).call(c);i.keybinding().on(s,d),i.on("modechange",f),f();function h(){var p;return!o&&!((p=i.mode)!=null&&p.extent)}function d(p){var g;p&&p.preventDefault();let m=(g=i.mode)==null?void 0:g.extent;if(o)t.transformEase(o),o=null;else if(m){o=t.transform();let[y,x]=t.dimensions,b=t.extentZoom(m,[y/2,x/2]);t.centerZoomEase(m.center(),b)}else(n==="touch"||n==="pen")&&r.flash.duration(2e3).iconName("#rapid-icon-framed-dot").iconClass("disabled").label(e.t("inspector.zoom_to.no_selection"))();n=null}function f(){o=null,u.classed("disabled",h()),u.select(".tooltip.in").empty()||u.call(c.updateContent)}}}function Mf(i){let e=i.systems.l10n,t=i.systems.storage,r=i.systems.imagery,s=Ge(i,"background-display-options").label(e.t("background.display_options")).disclosureContent(d),n=t.getItem("background-opacity"),o=0,a=3,l=["brightness","contrast","saturation","sharpness"],c={brightness:n!==null?+n:1,contrast:1,saturation:1,sharpness:1};function u(f,p,m){return Math.max(p,Math.min(f,m))}function h(f,p){p=u(p,o,a),c[f]=p,f==="brightness"?(t.setItem("background-opacity",p),r.brightness=p):f==="contrast"?r.contrast=p:f==="saturation"?r.saturation=p:f==="sharpness"&&(r.sharpness=p),s.reRender()}function d(f){let p=f.selectAll(".display-options-container").data([0]),m=p.enter().append("div").attr("class","display-options-container controls-list"),g=m.selectAll(".display-control").data(l).enter().append("div").attr("class",x=>`display-control display-control-${x}`);g.append("h5").text(x=>e.t(`background.${x}`)).append("span").attr("class",x=>`display-option-value display-option-value-${x}`);let y=g.append("div").attr("class","control-wrap");y.append("input").attr("class",x=>`display-option-input display-option-input-${x}`).attr("type","range").attr("min",o).attr("max",a).attr("step","0.05").on("input",(x,b)=>{h(b,x.target.value||1)}),y.append("button").attr("title",e.t("background.reset")).attr("class",x=>`display-option-reset display-option-reset-${x}`).on("click",(x,b)=>{x.button===0&&h(b,1)}).call(V("#rapid-icon-"+(e.isRTL()?"redo":"undo"))),m.append("a").attr("class","display-option-resetlink").attr("href","#").text(e.t("background.reset_all")).on("click",x=>{x.preventDefault();for(let b of l)h(b,1)}),p=m.merge(p),p.selectAll(".display-option-input").property("value",x=>c[x]),p.selectAll(".display-option-value").text(x=>Math.floor(c[x]*100)+"%"),p.selectAll(".display-option-reset").classed("disabled",x=>c[x]===1),m.size()&&c.brightness!==1&&(r.brightness=c.brightness)}return s}function Pf(i){let e=i.systems.l10n,t=i.systems.storage,r=ue("change");function s(n){let o={template:t.getItem("background-custom-template")},a=Object.assign({},o),l=Sa(i,n).okButton();l.classed("settings-modal settings-custom-background",!0),l.select(".modal-section.header").append("h3").html(e.tHtml("settings.custom_background.header"));let c="settings.custom_background.instructions",u=e.t(`${c}.info`),h=e.t(`${c}.wms.tokens_label`),d=e.t(`${c}.wms.tokens.proj`),f=e.t(`${c}.wms.tokens.wkid`),p=e.t(`${c}.wms.tokens.dimensions`),m=e.t(`${c}.wms.tokens.bbox`),g=e.t(`${c}.tms.tokens_label`),y=e.t(`${c}.tms.tokens.xyz`),x=e.t(`${c}.tms.tokens.flipped_y`),b=e.t(`${c}.tms.tokens.switch`),_=e.t(`${c}.tms.tokens.quadtile`),w=e.t(`${c}.tms.tokens.scale_factor`),A=e.t("example"),k=Ke.parse(`
${u}
&nbsp;<br>
&nbsp;<br>
#### ${h}
* ${d}
* ${f}
* ${p}
* ${m}
&nbsp;<br>
&nbsp;<br>
#### ${g}
* ${y}
* ${x}
* ${b}
* ${_}
* ${w}
&nbsp;<br>
&nbsp;<br>
#### ${A}
* \`https://{switch:a,b,c}.tile.openstreetmap.org/{zoom}/{x}/{y}.png\`
`),v=l.select(".modal-section.message-text");v.append("div").attr("class","instructions-template").html(k),v.append("textarea").attr("class","field-template").attr("placeholder",e.t("settings.custom_background.template.placeholder")).call(Re).property("value",a.template);let E=l.select(".modal-section.buttons");E.insert("button",".ok-button").attr("class","button cancel-button secondary-action").html(e.tHtml("confirm.cancel")),E.select(".cancel-button").on("click.cancel",S),E.select(".ok-button").on("click.save",M);function S(){v.select(".field-template").property("value",o.template),t.setItem("background-custom-template",o.template),this.blur(),l.close()}function M(){a.template=v.select(".field-template").property("value"),t.setItem("background-custom-template",a.template),this.blur(),l.close(),r.call("change",this,a)}}return me(s,r,"on")}function Df(i){let e=i.systems.map,t=i.systems.l10n,r=i.systems.imagery,s=i.systems.storage,n=Ge(i,"background-list").label(t.t("background.backgrounds")).disclosureContent(f),o=G(null),a=r.getSource("custom"),l=Pf(i).on("change",b),c=s.getItem("background-favorites"),u=c?JSON.parse(c):{};function h(){return s.getItem("background-last-used-toggle")}function d(v){return!v.overlay}function f(v){let E=v.selectAll(".layer-background-list").data([0]);o=E.enter().append("ul").attr("class","layer-list layer-background-list").attr("dir","auto").merge(E);let S=v.selectAll(".bg-extras-list").data([0]).enter().append("ul").attr("class","layer-list bg-extras-list"),M=S.append("li").attr("class","minimap-toggle-item").append("label").call(he(i).title(t.t("background.minimap.tooltip")).shortcut(t.t("background.minimap.key")).placement("top"));M.append("input").attr("type","checkbox").on("change",P=>{P.preventDefault(),Cl.toggle()}),M.append("span").text(t.t("background.minimap.description"));let I=S.append("li").attr("class","three-d-map-toggle-item").append("label").call(he(i).title(t.t("background.3dmap.tooltip")).shortcut(Ie("\u2318"+t.t("background.3dmap.key"))).placement("top"));I.append("input").attr("type","checkbox").on("change",P=>{P.preventDefault(),Sl.toggle()}),I.append("span").text(t.t("background.3dmap.description"));let T=S.append("li").attr("class","background-panel-toggle-item").append("label").call(he(i).title(t.t("background.panel.tooltip")).shortcut(Ie("\u2318\u21E7"+t.t("info_panels.background.key"))).placement("top"));T.append("input").attr("type","checkbox").on("change",P=>{P.preventDefault(),i.systems.ui.info.toggle("background")}),T.append("span").text(t.t("background.panel.description"));let C=S.append("li").attr("class","location-panel-toggle-item").append("label").call(he(i).title(t.t("background.location_panel.tooltip")).shortcut(Ie("\u2318\u21E7"+t.t("info_panels.location.key"))).placement("top"));C.append("input").attr("type","checkbox").on("change",P=>{P.preventDefault(),i.systems.ui.info.toggle("location")}),C.append("span").text(t.t("background.location_panel.description")),v.selectAll(".imagery-faq").data([0]).enter().append("div").attr("class","imagery-faq").append("a").attr("target","_blank").call(V("#rapid-icon-out-link","inline")).attr("href","https://github.com/openstreetmap/iD/blob/develop/FAQ.md#how-can-i-report-an-issue-with-background-imagery").append("span").text(t.t("background.imagery_problem_faq")),o.call(g)}function p(v){v.each((E,S,M)=>{let I=G(M[S]).select("label"),T=I.select("span"),C=S<M.length/2?"bottom":"top",P=T.property("clientWidth")!==T.property("scrollWidth");I.call(he(i).destroyAny),E.id===h()?I.call(he(i).placement(C).title(t.t("background.switch")).shortcut(Ie("\u2318"+t.t("background.key")))):(E.description||P)&&I.call(he(i).placement(C).title(E.description||E.name))})}function m(v,E){return u[v.id]&&!u[E.id]?-1:u[E.id]&&!u[v.id]?1:v.best&&!E.best?-1:E.best&&!v.best?1:Fo(v.area,E.area)||cr(v.name,E.name)||0}function g(v){let E=r.sources(e.extent(),e.zoom()).filter(d),S=v.selectAll("li").data(E,T=>T.id);S.exit().remove();let M=S.enter().append("li").classed("layer-custom",T=>T.id==="custom").classed("best",T=>T.best),I=M.append("label");I.append("input").attr("type","radio").attr("name","layers").on("change",x),I.append("span").attr("class","background-name").text(T=>T.name),M.append("button").attr("class","background-favorite-button").classed("active",T=>!!u[T.id]).attr("tabindex",-1).call(V("#rapid-icon-favorite")).on("click",(T,C)=>{u[C.id]?(G(T.currentTarget).classed("active",!1),delete u[C.id]):(G(T.currentTarget).classed("active",!0),u[C.id]=!0),s.setItem("background-favorites",JSON.stringify(u)),G(T.currentTarget.parentElement).transition().duration(300).ease(Ba).style("background-color","orange").transition().duration(300).ease(Ba).style("background-color",null),v.selectAll("li").sort(m),v.call(y)}),M.filter(T=>T.id==="custom").append("button").attr("class","layer-browse").call(he(i).title(t.t("settings.custom_background.tooltip")).placement(t.isRTL()?"right":"left")).on("click",_).call(V("#rapid-icon-more")),M.filter(T=>T.best).selectAll("label").append("span").attr("class","best").call(he(i).title(t.t("background.best_imagery")).placement("bottom")).call(V("#rapid-icon-best-background")),v.selectAll("li").sort(m),v.call(y)}function y(v){function E(S){return r.showsLayer(S)}v.selectAll("li").classed("active",E).classed("switch",S=>S.id===h()).call(p).selectAll("input").property("checked",E)}function x(v,E){if(E.id==="custom"&&!E.template)return _();let S=r.baseLayerSource();S instanceof _s&&s.setItem("background-last-used-toggle",S.id),s.setItem("background-last-used",E.id),r.baseLayerSource(E)}function b(v){v!=null&&v.template?(a.template=v.template,x(void 0,a)):(a.template="",x(void 0,r.getSource("none")))}function _(v){v.preventDefault(),i.container().call(l)}function w(v){let E=r.sources(e.extent(),e.zoom()).filter(d);E.sort(m);let S=r.baseLayerSource(),M=E.indexOf(S);if(M===-1)return;let I=(M+v+E.length)%E.length,T=E[I];T.id==="custom"&&!T.template&&(I=(I+v+E.length)%E.length,T=E[I]),x(void 0,T)}function A(){w(1)}function k(){w(-1)}return r.on("imagerychange",()=>o.call(y)),e.on("draw",wt(()=>{window.requestIdleCallback(n.reRender)},1e3,{leading:!0,trailing:!0})),i.keybinding().on(t.t("background.next_background.key"),A).on(t.t("background.previous_background.key"),k),n}function Rf(i){let e=i.systems.l10n,t=i.systems.imagery,r=Ge(i,"background-offset").label(e.t("background.fix_misalignment")).disclosureContent(u),s=[["top",[0,-.5]],["left",[-.5,0]],["right",[.5,0]],["bottom",[0,.5]]];function n(){let h=A5(t.offset),d=+h[0].toFixed(2),f=+h[1].toFixed(2);i.container().selectAll(".nudge-inner-rect").select("input").classed("error",!1).property("value",`${d},${f}`),i.container().selectAll(".nudge-reset").classed("disabled",d===0&&f===0)}function o(){t.offset=[0,0],n()}function a(h){t.nudge(h,i.systems.map.zoom()),n()}function l(h){let d=G(h.target),f=d.node().value;if(f==="")return o();if(f=f.replace(/;/g,",").split(",").map(p=>!isNaN(p)&&p),f.length!==2||!f[0]||!f[1]){d.classed("error",!0);return}t.offset=E5(f),n()}function c(h){if(h.button!==0)return;let d=[h.clientX,h.clientY],f=h.pointerId||"mouse";i.container().append("div").attr("class","nudge-surface"),G(window).on("pointermove.drag-bg-offset",p).on("pointerup.drag-bg-offset",m).on("pointercancel.drag-bg-offset",m);function p(g){if(f!==(g.pointerId||"mouse"))return;let y=[g.clientX,g.clientY],x=[-(d[0]-y[0])/4,-(d[1]-y[1])/4];d=y,a(x)}function m(g){f===(g.pointerId||"mouse")&&g.button===0&&(i.container().selectAll(".nudge-surface").remove(),G(window).on(".drag-bg-offset",null))}}function u(h){let f=h.selectAll(".nudge-container").data([0]).enter().append("div").attr("class","nudge-container");f.append("div").attr("class","nudge-instructions").text(e.t("background.offset"));let p=f.append("div").attr("class","nudge-controls-wrap");p.append("div").attr("class","nudge-outer-rect").on("pointerdown",c).append("div").attr("class","nudge-inner-rect").append("input").attr("type","text").on("change",l),p.append("div").selectAll("button").data(s).enter().append("button").attr("class",g=>`${g[0]} nudge`).attr("tabindex",-1).on("click",(g,y)=>a(y[1])),p.append("button").attr("title",e.t("background.reset")).attr("class","nudge-reset disabled").on("click",g=>{g.preventDefault(),o()}).call(V("#rapid-icon-"+(e.isRTL()?"redo":"undo"))),n()}return t.on("imagerychange",n),r}function cT(i){let e=i.systems.imagery,t=i.systems.l10n,r=i.systems.rapid,s=Ge(i,"grid-display-options").label(t.t("background.grid.grids")).disclosureContent(l),n=[{numSplit:0,name:t.t("background.grid.no_grid")},{numSplit:2,name:t.t("background.grid.n_by_n",{num:2})},{numSplit:3,name:t.t("background.grid.n_by_n",{num:3})},{numSplit:4,name:t.t("background.grid.n_by_n",{num:4})},{numSplit:5,name:t.t("background.grid.n_by_n",{num:5})},{numSplit:6,name:t.t("background.grid.n_by_n",{num:6})}];function o(c,u){c.preventDefault(),e.numGridSplits=u.numSplit}function a(c){let u=c.selectAll(".layer-grid-list").data([0]),d=u.enter().append("ul").attr("class","layer-list layer-grid-list").attr("dir","auto").merge(u).selectAll("li").data(n,m=>m.name),p=d.enter().insert("li",".custom-gridsopt").attr("class","gridsopt").append("label");p.append("input").attr("type","radio").attr("name","grids").property("checked",m=>m.numSplit===e.numGridSplits).on("change",o),p.append("span").text(m=>m.name),d.exit().remove()}function l(c){let u=G(".section-grid-display-options");if(r.on("taskchanged",()=>{r.isTaskRectangular()&&(u.classed("hide",!1),c.call(a))}),!r.isTaskRectangular()){u.classed("hide",!0);return}}return s}function Nf(i){let e=i.systems.map,t=i.systems.l10n,r=i.systems.imagery,s=Ge(i,"overlay-list").label(t.t("background.overlays")).disclosureContent(h),n=G(null);function o(d){d.each((f,p,m)=>{let g=G(m[p]).select("label"),y=g.select("span"),x=p<m.length/2?"bottom":"top",b=y.property("clientWidth")!==y.property("scrollWidth");g.call(he(i).destroyAny),(f.description||b)&&g.call(he(i).placement(x).title(f.description||f.name))})}function a(d){function f(p){return r.showsLayer(p)}d.selectAll("li").classed("active",f).call(o).selectAll("input").property("checked",f)}function l(d){let f=r.sources(e.extent(),e.zoom()).filter(u),p=d.selectAll("li").data(f,x=>x.name);p.exit().remove();let g=p.enter().append("li").append("label");g.append("input").attr("type","checkbox").attr("name","layers").on("change",c),g.append("span").text(x=>x.name),d.selectAll("li").sort(y),d.call(a);function y(x,b){return x.best&&!b.best?-1:b.best&&!x.best?1:Fo(x.area,b.area)||cr(x.name,b.name)||0}}function c(d,f){d.preventDefault(),r.toggleOverlayLayer(f),n.call(a)}function u(d){return!!d.overlay}function h(d){let f=d.selectAll(".layer-overlay-list").data([0]);n=f.enter().append("ul").attr("class","layer-list layer-overlay-list").attr("dir","auto").merge(f),n.call(l)}return r.on("imagerychange",()=>s.reRender),e.on("draw",wt(()=>{window.requestIdleCallback(s.reRender)},1e3,{leading:!0,trailing:!0})),s}function Ff(i){let e=i.systems.l10n;return Rs(i,"background").key(e.t("background.key")).label(e.t("background.title")).description(e.t("background.description")).iconName("rapid-icon-layers").sections([Df(i),Nf(i),cT(i),Mf(i),Rf(i)])}function Lf(i){let e=i.systems.l10n,t=i.systems.ui,r=[["help",["welcome","open_data_h","open_data","before_start_h","before_start","open_source_h","open_source","open_source_help"]],["overview",["navigation_h","navigation_drag","navigation_zoom","features_h","features","nodes_ways"]],["editing",["select_h","select_left_click","select_right_click","select_space","multiselect_h","multiselect","multiselect_shift_click","multiselect_lasso","undo_redo_h","undo_redo","save_h","save","save_validation","upload_h","upload","backups_h","backups","keyboard_h","keyboard"]],["feature_editor",["intro","definitions","type_h","type","type_picker","fields_h","fields_all_fields","fields_example","fields_add_field","tags_h","tags_all_tags","tags_resources"]],["points",["intro","add_point_h","add_point","add_point_finish","move_point_h","move_point","delete_point_h","delete_point","delete_point_command"]],["lines",["intro","add_line_h","add_line","add_line_draw","add_line_continue","add_line_finish","modify_line_h","modify_line_dragnode","modify_line_addnode","connect_line_h","connect_line","connect_line_display","connect_line_drag","connect_line_tag","disconnect_line_h","disconnect_line_command","move_line_h","move_line_command","move_line_connected","delete_line_h","delete_line","delete_line_command"]],["areas",["intro","point_or_area_h","point_or_area","add_area_h","add_area_command","add_area_draw","add_area_continue","add_area_finish","square_area_h","square_area_command","modify_area_h","modify_area_dragnode","modify_area_addnode","delete_area_h","delete_area","delete_area_command"]],["relations",["intro","edit_relation_h","edit_relation","edit_relation_add","edit_relation_delete","maintain_relation_h","maintain_relation","relation_types_h","multipolygon_h","multipolygon","multipolygon_create","multipolygon_merge","turn_restriction_h","turn_restriction","turn_restriction_field","turn_restriction_editing","route_h","route","route_add","boundary_h","boundary","boundary_add"]],["operations",["intro","intro_2","straighten","orthogonalize","circularize","move","rotate","reflect","continue","reverse","disconnect","split","extract","merge","delete","downgrade","copy_paste"]],["notes",["intro","add_note_h","add_note","place_note","move_note","update_note_h","update_note","save_note_h","save_note"]],["imagery",["intro","sources_h","choosing","sources","offsets_h","offset","offset_change"]],["streetlevel",["intro","using_h","using","photos","viewer"]],["gps",["intro","survey","using_h","using","tracing","upload"]],["qa",["intro","tools_h","tools","issues_h","issues"]]],s={"help.help.open_data_h":3,"help.help.before_start_h":3,"help.help.open_source_h":3,"help.overview.navigation_h":3,"help.overview.features_h":3,"help.editing.select_h":3,"help.editing.multiselect_h":3,"help.editing.undo_redo_h":3,"help.editing.save_h":3,"help.editing.upload_h":3,"help.editing.backups_h":3,"help.editing.keyboard_h":3,"help.feature_editor.type_h":3,"help.feature_editor.fields_h":3,"help.feature_editor.tags_h":3,"help.points.add_point_h":3,"help.points.move_point_h":3,"help.points.delete_point_h":3,"help.lines.add_line_h":3,"help.lines.modify_line_h":3,"help.lines.connect_line_h":3,"help.lines.disconnect_line_h":3,"help.lines.move_line_h":3,"help.lines.delete_line_h":3,"help.areas.point_or_area_h":3,"help.areas.add_area_h":3,"help.areas.square_area_h":3,"help.areas.modify_area_h":3,"help.areas.delete_area_h":3,"help.relations.edit_relation_h":3,"help.relations.maintain_relation_h":3,"help.relations.relation_types_h":2,"help.relations.multipolygon_h":3,"help.relations.turn_restriction_h":3,"help.relations.route_h":3,"help.relations.boundary_h":3,"help.notes.add_note_h":3,"help.notes.update_note_h":3,"help.notes.save_note_h":3,"help.imagery.sources_h":3,"help.imagery.offsets_h":3,"help.streetlevel.using_h":3,"help.gps.using_h":3,"help.qa.tools_h":3,"help.qa.issues_h":3},n={version:`**${i.version}**`,rapidicon:'<svg class="icon pre-text rapid"><use xlink:href="#rapid-logo-rapid-wordmark"></use></svg>'},o=[];for(let[l,c]of r){let u=c.reduce((h,d)=>{let f=`help.${l}.${d}`,p=s[f],m=p?Array(p+1).join("#")+" ":"";return h+m+J(i,f,n)+`

`},"");o.push({title:e.t(`help.${l}.title`),contentHtml:Ke.parse(u.trim()).replace(/<code>/g,"<kbd>").replace(/<\/code>/g,"</kbd>")})}let a=Rs(i,"help").key(e.t("help.key")).label(e.t("help.title")).description(e.t("help.title")).iconName("rapid-icon-help");return a.renderContent=function(l){function c(b,_){let w=e.isRTL();l.property("scrollTop",0),a.selection().select(".pane-heading h2").text(b.title),y.html(b.contentHtml),y.selectAll("a").attr("target","_blank"),f.classed("selected",v=>v.title===b.title),x.html(""),w?x.call(A).call(k):x.call(k).call(A);function A(v){if(_===o.length-1)return;v.append("a").attr("href","#").attr("class","next").on("click",function(S){S.preventDefault(),c(o[_+1],_+1)}).append("span").text(o[_+1].title).call(V(w?"#rapid-icon-backward":"#rapid-icon-forward","inline"))}function k(v){if(_===0)return;v.append("a").attr("href","#").attr("class","previous").on("click",function(S){S.preventDefault(),c(o[_-1],_-1)}).call(V(w?"#rapid-icon-forward":"#rapid-icon-backward","inline")).append("span").text(o[_-1].title)}}function u(b){b.preventDefault(),!i.inIntro&&(i.container().call(an(i)),t.togglePanes())}function h(b){b.preventDefault(),i.container().call(t.shortcuts,!0)}let d=l.append("ul").attr("class","toc"),f=d.selectAll("li").data(o).enter().append("li").append("a").attr("href","#").text(b=>b.title).on("click",function(b,_){b.preventDefault(),c(_,o.indexOf(_))});d.append("li").attr("class","shortcuts").call(he(i).title(e.t("shortcuts.tooltip")).shortcut("?").placement("top")).append("a").attr("href","#").on("click",h).append("div").text(e.t("shortcuts.title"));let m=d.append("li").attr("class","walkthrough").append("a").attr("href","#").on("click",u);m.append("svg").attr("class","logo logo-walkthrough").append("use").attr("xlink:href","#rapid-logo-walkthrough"),m.append("div").text(e.t("splash.walkthrough"));let g=l.append("div").attr("class","left-content"),y=g.append("div").attr("class","body"),x=g.append("div").attr("class","nav");c(o[0],0)},a}var mg=1e3;function Cu(i,e,t){let r=i.systems.editor,s=i.systems.l10n,n=i.systems.map,o=i.systems.storage,a=i.systems.urlhash,l=i.systems.validator,c=Ge(i,e).label(h).shouldDisplay(d).disclosureContent(f),u=[];function h(){let w=u.length>mg?`${mg}+`:String(u.length),A=s.t(`issues.${t}s.list_title`);return s.t("inspector.title_count",{title:A,count:w})}function d(){return u.length}function f(w){let A=n.center(),k=r.staging.graph,v=u.map(function(S){let M=S.extent(k),I=M?at(A,M.center()):0;return Object.assign(S,{dist:I})}).sort((E,S)=>E.dist-S.dist);v=v.slice(0,mg),w.call(p,v)}function p(w,A){let k=o.getItem("rapid-internal-feature.showAutoFix")==="true",v=w.selectAll(".issues-list").data([0]);v=v.enter().append("ul").attr("class",`layer-list issues-list ${t}s-list`).merge(v);let E=v.selectAll("li").data(A,O=>O.key);E.exit().remove();let S=E.enter().append("li").attr("class",O=>`issue severity-${O.severity}`),M=S.append("button").attr("class","issue-label").on("click",(O,R)=>l.focusIssue(R)).on("mouseover",(O,R)=>Xe(R.entityIds,!0,i)).on("mouseout",(O,R)=>Xe(R.entityIds,!1,i)),I=M.append("span").attr("class","issue-text");I.append("span").attr("class","issue-icon").each((O,R,N)=>{let F=O.severity==="warning"?"alert":"error";G(N[R]).call(V(`#rapid-icon-${F}`))}),I.append("span").attr("class","issue-message"),M.append("span").attr("class","issue-autofix").append("button").attr("title",s.t("issues.fix_one.title")).attr("class","autofix action").on("click",m).call(V("#rapid-icon-wrench")),E=E.merge(S).order(),E.selectAll(".issue-message").html(O=>O.message(i)),E.selectAll(".issue-autofix").classed("hide",O=>!(k&&O.autoArgs));let T=A.filter(O=>O.autoArgs),C=w.selectAll(".autofix-all").data(k&&T.length?[0]:[]);C.exit().remove();let P=C.enter().insert("div",".issues-list").attr("class","autofix-all"),D=P.append("a").attr("class","autofix-all-link").attr("href","#");D.append("span").attr("class","autofix-all-link-text").text(s.t("issues.fix_all.title")),D.append("span").attr("class","autofix-all-link-icon").call(V("#rapid-icon-wrench")),C=C.merge(P),C.selectAll(".autofix-all-link").on("click",O=>g(O,T))}function m(w,A){w&&(w.preventDefault(),w.stopPropagation()),Xe(A.entityIds,!1,i),r.perform(A.autoArgs[0]),r.commit({annotation:A.autoArgs[1],selectedIDs:A.entityIds})}function g(w,A){w&&(w.preventDefault(),w.stopPropagation()),r.beginTransaction();for(let k of A){let v=k.autoArgs[0];r.perform(v)}r.commit({annotation:s.t("issues.fix_all.annotation")}),r.endTransaction()}function y(){return{what:o.getItem("validate-what")||"edited",where:o.getItem("validate-where")||"all"}}function x(){let w=y();u=l.getIssuesBySeverity(w)[t]}function b(){return i.container().selectAll(".map-panes .issues-pane.shown").size()}function _(){window.requestIdleCallback(()=>{b()&&(x(),c.reRender())})}return l.on("validated",_),a.on("hashchange",(w,A)=>{w.get("poweruser")!==A.get("poweruser")&&_()}),n.on("draw",wt(()=>{_()},500,{leading:!1,trailing:!0})),c}function Of(i){let e=i.systems.l10n,t=i.systems.storage,r=i.systems.validator,s=Ge(i,"issues-options").content(n);function n(l){let c=l.selectAll(".issues-options-container").data([0]);c=c.enter().append("div").attr("class","issues-options-container").merge(c);let u=[{key:"what",values:["edited","all"]},{key:"where",values:["visible","all"]}],d=c.selectAll(".issues-option").data(u,p=>p.key).enter().append("div").attr("class",p=>`issues-option issues-option-${p.key}`);d.append("div").attr("class","issues-option-title").text(p=>e.t(`issues.options.${p.key}.title`));let f=d.selectAll("label").data(p=>p.values.map(m=>({value:m,key:p.key}))).enter().append("label");f.append("input").attr("type","radio").attr("name",p=>`issues-option-${p.key}`).attr("value",p=>p.value).property("checked",p=>o()[p.key]===p.value).on("change",(p,m)=>a(p,m.key,m.value)),f.append("span").text(p=>e.t(`issues.options.${p.key}.${p.value}`))}function o(){return{what:t.getItem("validate-what")||"edited",where:t.getItem("validate-where")||"all"}}function a(l,c,u){!u&&l&&l.target&&(u=l.target.value),t.setItem(`validate-${c}`,u),r.validateAsync()}return s}function Bf(i){let e=i.systems.l10n,t=i.systems.storage,r=i.systems.validator,s=0,n=20,o=5,a=Ge(i,"issues-rules").disclosureContent(c).label(e.t("issues.rules.title")),l=r.getRuleKeys().sort((p,m)=>e.t(`issues.${p}.title`)<e.t(`issues.${m}.title`)?-1:1);function c(p){let m=p.selectAll(".issues-rulelist-container").data([0]),g=m.enter().append("div").attr("class","issues-rulelist-container");g.append("ul").attr("class","layer-list issue-rules-list");let y=g.append("div").attr("class","issue-rules-links section-footer");y.append("a").attr("class","issue-rules-link").attr("href","#").text(e.t("issues.disable_all")).on("click",x=>{x.preventDefault(),r.disableRules(l)}),y.append("a").attr("class","issue-rules-link").attr("href","#").text(e.t("issues.enable_all")).on("click",x=>{x.preventDefault(),r.disableRules([])}),m=m.merge(g),m.selectAll(".issue-rules-list").call(u)}function u(p){let m=p.selectAll("li").data(l);m.exit().remove();let g=m.enter().append("li").call(he(i).title(w=>e.t(`issues.${w}.tip`)).placement("top")),y=g.append("label");y.append("input").attr("type","checkbox").attr("name","rule").on("change",f),y.append("span").html(w=>{let A={};return w==="unsquare_way"&&(A.val='<span class="square-degrees"></span>'),e.tHtml(`issues.${w}.title`,A)}),m=m.merge(g),m.classed("active",d).selectAll("input").property("checked",d).property("indeterminate",!1);let x=t.getItem("validate-square-degrees");x===null&&(x=o.toString());let _=m.selectAll(".square-degrees").selectAll(".square-degrees-input").data([0]);_.enter().append("input").attr("type","number").attr("min",s.toString()).attr("max",n.toString()).attr("step","0.5").attr("class","square-degrees-input").call(Re).on("click",function(w){w.preventDefault(),w.stopPropagation(),this.select()}).on("keyup",function(w){w.keyCode===13&&(this.blur(),this.select())}).on("blur",h).merge(_).property("value",x)}function h(){let p=G(this),m=be(p).trim(),g=parseFloat(m,10);isFinite(g)?g>n?g=n:g<s&&(g=s):g=o,g=Math.round(g*10)/10,m=g.toString(),p.property("value",m),t.setItem("validate-square-degrees",m),r.revalidateUnsquare()}function d(p){return r.isRuleEnabled(p)}function f(p,m){r.toggleRule(m)}return r.on("validated",()=>{window.requestIdleCallback(a.reRender)}),a}function Uf(i){let e=i.systems.l10n,t=i.systems.validator,r=Ge(i,"issues-status").shouldDisplay(s).content(o);function s(){return t.getIssues(n()).length===0}function n(){let c=i.systems.storage;return{what:c.getItem("validate-what")||"edited",where:c.getItem("validate-where")||"all"}}function o(c){let h=c.selectAll(".box").data([0]).enter().append("div").attr("class","box");h.append("div").call(V("#rapid-icon-apply","pre-text"));let d=h.append("span");d.append("strong").attr("class","message"),d.append("br"),d.append("span").attr("class","details"),a(c),l(c)}function a(c){let u=t.getIssues({what:"all",where:"all",includeDisabledRules:!0,includeIgnored:"only"}),h=c.selectAll(".reset-ignored").data(u.length?[0]:[]);h.exit().remove();let d=h.enter().append("div").attr("class","reset-ignored section-footer");d.append("a").attr("href","#"),h=h.merge(d),h.select("a").text(e.t("inspector.title_count",{title:e.t("issues.reset_ignored"),count:u.length})),h.on("click",f=>{f.preventDefault(),t.resetIgnoredIssues()})}function l(c){let u=n();function h(f){for(let p in f){let m=f[p],g=t.getIssues(m);if(g.length){c.select(".box .details").text(e.t("issues.no_issues.hidden_issues."+p,{count:g.length.toString()}));return}}c.select(".box .details").text(e.t("issues.no_issues.hidden_issues.none"))}let d;u.what==="edited"&&u.where==="visible"?(d="edits_in_view",h({elsewhere:{what:"edited",where:"all"},everything_else:{what:"all",where:"visible"},disabled_rules:{what:"edited",where:"visible",includeDisabledRules:"only"},everything_else_elsewhere:{what:"all",where:"all"},disabled_rules_elsewhere:{what:"edited",where:"all",includeDisabledRules:"only"},ignored_issues:{what:"edited",where:"visible",includeIgnored:"only"},ignored_issues_elsewhere:{what:"edited",where:"all",includeIgnored:"only"}})):u.what==="edited"&&u.where==="all"?(d="edits",h({everything_else:{what:"all",where:"all"},disabled_rules:{what:"edited",where:"all",includeDisabledRules:"only"},ignored_issues:{what:"edited",where:"all",includeIgnored:"only"}})):u.what==="all"&&u.where==="visible"?(d="everything_in_view",h({elsewhere:{what:"all",where:"all"},disabled_rules:{what:"all",where:"visible",includeDisabledRules:"only"},disabled_rules_elsewhere:{what:"all",where:"all",includeDisabledRules:"only"},ignored_issues:{what:"all",where:"visible",includeIgnored:"only"},ignored_issues_elsewhere:{what:"all",where:"all",includeIgnored:"only"}})):u.what==="all"&&u.where==="all"&&(d="everything",h({disabled_rules:{what:"all",where:"all",includeDisabledRules:"only"},ignored_issues:{what:"all",where:"all",includeIgnored:"only"}})),u.what==="edited"&&i.systems.editor.difference().summary().size===0&&(d="no_edits"),c.select(".box .message").text(e.t(`issues.no_issues.message.${d}`))}return t.on("validated",()=>{window.requestIdleCallback(r.reRender)}),i.systems.map.on("draw",wt(()=>{window.requestIdleCallback(r.reRender)},1e3)),r}function $f(i){let e=i.systems.l10n;return Rs(i,"issues").key(e.t("issues.key")).label(e.t("issues.title")).description(e.t("issues.title")).iconName("rapid-icon-alert").sections([Of(i),Uf(i),Cu(i,"issues-errors","error"),Cu(i,"issues-warnings","warning"),Bf(i)])}function Hf(i){let e=i.systems.l10n,t=i.systems.storage,r=i.systems.urlhash,s=ue("change"),n="settings.custom_data",o=[".gpx","application/gpx","application/gpx+xml",".kml","application/vnd.google-earth.kml+xml","application/kml","application/kml+xml",".geojson",".json","application/geo+json","application/json","application/vnd.geo+json","text/x-json"];function a(l){let c=i.scene().layers.get("custom-data"),u=r.getParam("data")||r.getParam("gpx")||t.getItem("settings-custom-data-url"),h=c&&c.getFileList()||null,d=u,f=h,p=Sa(i,l).okButton();p.classed("settings-modal settings-custom-data",!0),p.select(".modal-section.header").append("h3").html(e.tHtml("settings.custom_data.header"));let m=p.select(".modal-section.message-text"),g=e.t(`${n}.instructions`),y=e.t(`${n}.file.heading`),x=e.t(`${n}.file.instructions`),b=e.t(`${n}.file.types`),_=e.t(`${n}.file.tip`),w=Ke.parse(`
${g}
&nbsp;<br>
&nbsp;<br>
### ${y}
${x}
* ${b}
&nbsp;<br>
&nbsp;<br>
${_}
`);m.append("div").attr("class","instructions-template").html(w),m.append("input").attr("class","field-file").attr("type","file").attr("accept",o.join()).property("files",f).on("change",F=>{let B=F.target.files;B!=null&&B.length?(f=B,d="",m.select(".field-url").property("value","")):f=null});let A=e.t(`${n}.or`),k=e.t(`${n}.url.heading`),v=e.t(`${n}.url.instructions`),E=e.t(`${n}.url.tokens`),S=e.t(`${n}.url.xyz`),M=e.t(`${n}.url.example_file`),I=e.t(`${n}.url.example_xyz`),T=e.t(`${n}.url.example_pmtiles`),C=e.t("example"),P=Ke.parse(`
### ${A}
### ${k}
${v}
&nbsp;<br>
&nbsp;<br>
${E}
* ${S}
&nbsp;<br>
&nbsp;<br>
#### ${C}
* \`${M}\`
* \`${I}\`
* \`${T}\`
`);m.append("div").attr("class","instructions-template").html(P),m.append("textarea").attr("class","field-url").attr("placeholder",e.t("settings.custom_data.url.placeholder")).call(Re).property("value",d);let D=p.select(".modal-section.buttons");D.insert("button",".ok-button").attr("class","button cancel-button secondary-action").html(e.tHtml("confirm.cancel")),D.select(".cancel-button").on("click.cancel",R),D.select(".ok-button").attr("disabled",O).on("click.save",N);function O(){return null}function R(){m.select(".field-url").property("value",u),t.setItem("settings-custom-data-url",u),this.blur(),p.close()}function N(){d=m.select(".field-url").property("value").trim();let F={};d?(F={url:d,fileList:null},t.setItem("settings-custom-data-url",d)):f&&(F={url:null,fileList:f}),this.blur(),p.close(),s.call("change",this,F)}}return me(a,s,"on")}function Gf(i){let e=i.systems.l10n,t=Ge(i,"data-layers").label(e.t("map_data.data_layers")).disclosureContent(n),r=Hf(i).on("change",f),s=i.scene();function n(m){let g=m.selectAll(".data-layer-container").data([0]);g.enter().append("div").attr("class","data-layer-container").merge(g).call(c).call(u).call(h).call(p)}function o(m){let g=s.layers.get(m);return g==null?void 0:g.enabled}function a(m,g){let y=i.mode;y&&/^draw/.test(y.id)||(g?s.enableLayers(m):(s.disableLayers(m),(m==="osm"||m==="notes")&&i.enter("browse")))}function l(m){a(m,!o(m))}function c(m){let y=["osm","notes"].map(A=>s.layers.get(A)).filter(Boolean),x=m.selectAll(".layer-list-osm").data([0]);x=x.enter().append("ul").attr("class","layer-list layer-list-osm").merge(x);let b=x.selectAll(".list-item").data(y);b.exit().remove();let _=b.enter().append("li").attr("class",A=>`list-item list-item-${A.id}`),w=_.append("label").each((A,k,v)=>{A.id==="osm"?G(v[k]).call(he(i).title(e.t(`map_data.layers.${A.id}.tooltip`)).shortcut(Ie("\u2325"+e.t("area_fill.wireframe.key"))).placement("bottom")):G(v[k]).call(he(i).title(e.t(`map_data.layers.${A.id}.tooltip`)).placement("bottom"))});w.append("input").attr("type","checkbox").on("change",(A,k)=>l(k.id)),w.append("span").text(A=>e.t(`map_data.layers.${A.id}.title`)),b.merge(_).classed("active",A=>A.enabled).selectAll("input").property("checked",A=>A.enabled)}function u(m){let y=["keepRight","improveOSM","osmose"].map(A=>s.layers.get(A)).filter(Boolean),x=m.selectAll(".layer-list-qa").data([0]);x=x.enter().append("ul").attr("class","layer-list layer-list-qa").merge(x);let b=x.selectAll(".list-item").data(y);b.exit().remove();let _=b.enter().append("li").attr("class",A=>`list-item list-item-${A.id}`),w=_.append("label").each((A,k,v)=>{G(v[k]).call(he(i).title(e.t(`map_data.layers.${A.id}.tooltip`)).placement("bottom"))});w.append("input").attr("type","checkbox").on("change",(A,k)=>l(k.id)),w.append("span").text(A=>e.t(`map_data.layers.${A.id}.title`)),b.merge(_).classed("active",A=>A.enabled).selectAll("input").property("checked",A=>A.enabled)}function h(m){let g=s.layers.get("custom-data"),y=e.isRTL(),x=m.selectAll(".layer-list-data").data(g?[g]:[]);x.exit().remove();let b=x.enter().append("ul").attr("class","layer-list layer-list-data"),_=b.append("li").attr("class","list-item-data"),w=_.append("label").call(he(i).title(e.t("map_data.layers.custom.tooltip")).placement("top"));w.append("input").attr("type","checkbox").on("change",()=>l("custom-data")),w.append("span").text(e.t("map_data.layers.custom.title")),_.append("button").attr("class","open-data-options").call(he(i).title(e.t("settings.custom_data.tooltip")).placement(y?"right":"left")).on("click",A=>{A.preventDefault(),d()}).call(V("#rapid-icon-more")),_.append("button").attr("class","zoom-to-data").call(he(i).title(e.t("map_data.layers.custom.zoom")).placement(y?"right":"left")).on("click",function(A){if(G(this).classed("disabled"))return;A.preventDefault(),A.stopPropagation();let k=s.layers.get("custom-data");k==null||k.fitZoom()}).call(V("#rapid-icon-framed-dot","monochrome")),x=x.merge(b),x.selectAll(".list-item-data").classed("active",A=>A.enabled).selectAll("label").classed("deemphasize",A=>!A.hasData).selectAll("input").property("disabled",A=>!A.hasData).property("checked",A=>A.enabled),x.selectAll("button.zoom-to-data").classed("disabled",A=>!A.hasData)}function d(){i.container().call(r)}function f(m){let g=s.layers.get("custom-data");g&&(m!=null&&m.url?g.setUrl(m.url):m!=null&&m.fileList&&g.setFileList(m.fileList))}function p(m){let g=m.selectAll(".md-extras-list").data([0]).enter().append("ul").attr("class","layer-list md-extras-list"),y=g.append("li").attr("class","history-panel-toggle-item").append("label").call(he(i).title(e.t("map_data.history_panel.tooltip")).shortcut(Ie("\u2318\u21E7"+e.t("info_panels.history.key"))).placement("top"));y.append("input").attr("type","checkbox").on("change",b=>{b.preventDefault(),i.systems.ui.info.toggle("history")}),y.append("span").text(e.t("map_data.history_panel.title"));let x=g.append("li").attr("class","measurement-panel-toggle-item").append("label").call(he(i).title(e.t("map_data.measurement_panel.tooltip")).shortcut(Ie("\u2318\u21E7"+e.t("info_panels.measurement.key"))).placement("top"));x.append("input").attr("type","checkbox").on("change",b=>{b.preventDefault(),i.systems.ui.info.toggle("measurement")}),x.append("span").text(e.t("map_data.measurement_panel.title"))}return i.scene().on("layerchange",t.reRender),t}function zf(i){let e=i.systems.filters,t=i.systems.l10n,r=Ge(i,"map-features").label(t.t("map_data.map_features")).disclosureContent(s);function s(l){let c=l.selectAll(".layer-feature-list-container").data([0]),u=c.enter().append("div").attr("class","layer-feature-list-container");u.append("ul").attr("class","layer-list layer-feature-list");let h=u.append("div").attr("class","feature-list-links section-footer");h.append("a").attr("class","feature-list-link").attr("href","#").text(t.t("issues.disable_all")).on("click",d=>{d.preventDefault(),e.disableAll()}),h.append("a").attr("class","feature-list-link").attr("href","#").text(t.t("issues.enable_all")).on("click",d=>{d.preventDefault(),e.enableAll()}),c=c.merge(u),c.selectAll(".layer-feature-list").call(n)}function n(l){let c=l.selectAll("li").data(e.keys);c.exit().remove();let u=c.enter().append("li").call(he(i).title(d=>t.t(`feature.${d}.tooltip`)).placement("top")),h=u.append("label");h.append("input").attr("type","checkbox").attr("name","feature").on("change",a),h.append("span").text(d=>t.t(`feature.${d}.description`)),c=c.merge(u),c.classed("active",o).selectAll("input").property("checked",o)}function o(l){return e.isEnabled(l)}function a(l,c){e.toggle(c)}return e.on("filterchange",r.reRender),r}function jf(i){let e=i.systems.l10n,t=Ge(i,"fill-area").label(e.t("map_data.style_options")).disclosureContent(r);function r(c){let u=c.selectAll(".layer-fill-list").data([0]);u.enter().append("ul").attr("class","layer-list layer-fill-list").merge(u).call(s,i.systems.map.areaFillOptions,"radio","area_fill",o,n);let h=c.selectAll(".layer-visual-diff-list").data([0]);h.enter().append("ul").attr("class","layer-list layer-visual-diff-list").merge(h).call(s,["highlight_edits"],"checkbox","visual_diff",l,a)}function s(c,u,h,d,f,p){let m=c.selectAll("li").data(u);m.exit().remove();let g=m.enter().append("li").call(he(i).title(x=>e.t(`${d}.${x}.tooltip`)).shortcut(x=>x==="wireframe"?e.t("area_fill.wireframe.key"):x==="highlight_edits"?e.t("map_data.highlight_edits.key"):null).placement("top")),y=g.append("label");y.append("input").attr("type",h).attr("name",d).on("change",f),y.append("span").text(x=>e.t(`${d}.${x}.description`)),m=m.merge(g),m.classed("active",p).selectAll("input").property("checked",p).property("indeterminate",!1)}function n(c){return i.systems.map.areaFillMode===c}function o(c,u){i.systems.map.areaFillMode=u}function a(){return i.systems.map.highlightEdits}function l(c){let u=c.currentTarget;i.systems.map.highlightEdits=u.checked}return i.systems.map.on("mapchange",t.reRender),t}function Vf(i){let e=i.systems.l10n,t=i.systems.photos,r=Ge(i,"photo-overlays").label(e.t("photo_overlays.title")).disclosureContent(n),s=i.scene();function n(d){let f=d.selectAll(".photo-overlay-container").data([0]);f.enter().append("div").attr("class","photo-overlay-container").merge(f).call(c).call(u).call(h)}function o(d){let f=s.layers.get(d);return f&&f.enabled}function a(d,f){let p=i.mode;p&&/^draw/.test(p.id)||(f?s.enableLayers(d):s.disableLayers(d))}function l(d){a(d,!o(d))}function c(d){let m=t.overlayLayerIDs.map(A=>s.layers.get(A)).filter(Boolean).filter(A=>A.supported);function g(A){return A&&A.supported}function y(A){return g(A)&&A.enabled}let x=d.selectAll(".layer-list-photos").data([0]);x=x.enter().append("ul").attr("class","layer-list layer-list-photos").merge(x);let b=x.selectAll(".list-item-photos").data(m);b.exit().remove();let _=b.enter().append("li").attr("class",function(A){var k="list-item-photos list-item-"+A.id;return(A.id==="mapillary-signs"||A.id==="mapillary-map-features")&&(k+=" indented"),k}),w=_.append("label").each((A,k,v)=>{let E;A.id==="mapillary-signs"?E="mapillary.signs.tooltip":A.id==="mapillary"?E="mapillary_images.tooltip":A.id==="kartaview"?E="kartaview_images.tooltip":E=A.id.replace(/-/g,"_")+".tooltip",G(v[k]).call(he(i).title(e.t(E)).placement("top"))});w.append("input").attr("type","checkbox").on("change",(A,k)=>l(k.id)),w.append("span").text(A=>{let k=A.id;return k==="mapillary-signs"&&(k="photo_overlays.traffic_signs"),e.t(k.replace(/-/g,"_")+".title")}),b.merge(_).classed("active",y).selectAll("input").property("checked",y)}function u(d){let f=t.allPhotoTypes;function p(b){return t.showsPhotoType(b)}let m=d.selectAll(".layer-list-photo-types").data([0]);m.exit().remove(),m=m.enter().append("ul").attr("class","layer-list layer-list-photo-types").merge(m);let g=m.selectAll(".list-item-photo-types").data(t.shouldFilterByPhotoType()?f:[]);g.exit().remove();let y=g.enter().append("li").attr("class",b=>`list-item-photo-types list-item-${b}`),x=y.append("label").each(function(b){G(this).call(he(i).title(e.t(`photo_overlays.photo_type.${b}.tooltip`)).placement("top"))});x.append("input").attr("type","checkbox").on("change",(b,_)=>t.togglePhotoType(_)),x.append("span").text(b=>e.t(`photo_overlays.photo_type.${b}.title`)),g.merge(y).classed("active",p).selectAll("input").property("checked",p)}function h(d){let f=t.dateFilters;function p(b){return t.dateFilterValue(b)}let m=d.selectAll(".layer-list-date-filter").data([0]);m.exit().remove(),m=m.enter().append("ul").attr("class","layer-list layer-list-date-filter").merge(m);let g=m.selectAll(".list-item-date-filter").data(t.shouldFilterByDate()?f:[]);g.exit().remove();let y=g.enter().append("li").attr("class","list-item-date-filter"),x=y.append("label").each((b,_,w)=>{G(w[_]).call(he(i).title(e.t(`photo_overlays.date_filter.${b}.tooltip`)).placement("top"))});x.append("span").text(b=>e.t(`photo_overlays.date_filter.${b}.title`)),x.append("input").attr("type","date").attr("class","list-item-input").attr("placeholder",e.t("units.year_month_day")).call(Re).each((b,_,w)=>{be(G(w[_]),t.dateFilterValue(b)||"")}).on("change",function(b,_){let w=be(G(this)).trim();t.setDateFilter(_,w,!0),g.selectAll("input").each(function(A){be(G(this),t.dateFilterValue(A)||"")})}),g=g.merge(y).classed("active",p)}return i.scene().on("layerchange",r.reRender),t.on("photochange",r.reRender),r}function Wf(i){let e=i.systems.l10n;return Rs(i,"map-data").key(e.t("map_data.key")).label(e.t("map_data.title")).description(e.t("map_data.description")).iconName("rapid-icon-data").sections([Gf(i),Vf(i),jf(i),zf(i)])}function Xf(i){let e=i.systems.l10n,t=i.systems.storage,r=Ge(i,"preferences-third-party").label(e.t("preferences.privacy.title")).disclosureContent(n),s=t.getItem("preferences.privacy.thirdpartyicons")||"true";function n(o){let l=o.selectAll(".privacy-options-list").data([0]).enter().append("ul").attr("class","layer-list privacy-options-list").append("li").attr("class","privacy-third-party-icons-item").append("label").call(he(i).title(e.t("preferences.privacy.third_party_icons.tooltip")).placement("bottom"));l.append("input").attr("type","checkbox").on("change",u=>{u.preventDefault(),s=s==="true"?"false":"true",t.setItem("preferences.privacy.thirdpartyicons",s),c()}),l.append("span").text(e.t("preferences.privacy.third_party_icons.description")),o.selectAll(".privacy-link").data([0]).enter().append("div").attr("class","privacy-link").append("a").attr("target","_blank").call(V("#rapid-icon-out-link","inline")).attr("href","https://rapideditor.org/doc/license/MapWithAIPrivacyPolicy.pdf").append("span").text(e.t("preferences.privacy.privacy_link")),c();function c(){o.selectAll(".privacy-third-party-icons-item").classed("active",s==="true").select("input").property("checked",s==="true")}}return r}function qf(i){let e=i.systems.storage,t=i.systems.l10n,r=Ge(i,"map-interaction").label(t.t("preferences.map_interaction.title")).disclosureContent(n),s=["auto","zoom","pan"];function n(c){let u=c.selectAll(".mouse-wheel-options").data([0]),h=u.enter().append("div").attr("class","mouse-wheel-options");h.append("div").attr("class","mouse-wheel-title").text(t.t("preferences.map_interaction.mouse_wheel.title")),h.append("ul").attr("class","layer-list mouse-wheel-options-list"),u.merge(h).selectAll(".mouse-wheel-options-list").call(o)}function o(c){let u=c.selectAll("li").data(s);u.exit().remove();let h=u.enter().append("li").call(he(i).title(f=>t.t(`preferences.map_interaction.mouse_wheel.${f}.tooltip`)).placement("top")),d=h.append("label");d.append("input").attr("type","radio").attr("name","mouse_wheel").on("change",l),d.append("span").text(f=>t.t(`preferences.map_interaction.mouse_wheel.${f}.title`)),u.merge(h).classed("active",a).selectAll("input").property("checked",a).property("indeterminate",!1)}function a(c){return(e.getItem("prefs.mouse_wheel.interaction")||"auto")===c}function l(c,u){e.setItem("prefs.mouse_wheel.interaction",u),r.reRender()}return r}function Qf(i){let e=i.systems.l10n;return Rs(i,"preferences").key(e.t("preferences.key")).label(e.t("preferences.title")).description(e.t("preferences.description")).iconName("fas-user-cog").sections([Xf(i),qf(i)])}var ku=class extends Ce{constructor(e){super(e),this.id="ui",this.dependencies=new Set(["editor","imagery","l10n","map","storage","urlhash"]),this.authModal=null,this.defs=null,this.flash=null,this.editMenu=null,this.info=null,this.sidebar=null,this.photoviewer=null,this.shortcuts=null,this._didRender=!1,this._needWidth={},this._startPromise=null,this._initPromise=null,this.render=this.render.bind(this),this.resize=this.resize.bind(this),this._clickBugLink=this._clickBugLink.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let s of this.dependencies)if(!this.context.systems[s])return Promise.reject(`Cannot init:  ${this.id} requires ${s}`);let e=this.context,t=e.systems.l10n,r=Promise.all([t.initAsync()]);return this._initPromise=r.then(()=>{window.addEventListener("resize",()=>this.resize()),this.authModal=Sn(e).blocking(!0),this.defs=new Wc(e),this.flash=qc(e),this.editMenu=k6(e),this.sidebar=bf(e),this.photoviewer=sf(e),this.shortcuts=_f(e),this.authModal.message(t.tHtml("loading_auth"));let s=e.services.osm;s&&s.on("authLoading",()=>{var n;return(n=e.container())==null?void 0:n.call(this.authModal)}).on("authDone",()=>this.authModal.close())})}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context.container();return e.empty()||this.render(e),this._started=!0,this._startPromise=Promise.resolve()}resetAsync(){let e=this.context.container();return e.empty()||e.select(".inspector-wrap *").remove(),Promise.resolve()}render(e){if(this._didRender)return;this.didRender=!0;let t=this.context,r=t.systems.l10n;e.attr("lang",r.localeCode()).attr("dir",r.textDirection()),e.call(O6(t));let s=t.systems.map;s.pause(),e.append("svg").attr("id","rapid-defs").call(this.defs.render),e.append("div").attr("class","sidebar").call(this.sidebar),t.keybinding().on([r.t("sidebar.key"),"`","\xB2","@"],this.sidebar.toggle).on(Ie("\u2318"+r.t("background.key")),b=>{b&&(b.stopImmediatePropagation(),b.preventDefault());let _=t.systems.imagery,w=t.systems.storage,A=_.getSource(w.getItem("background-last-used-toggle"));if(A){let k=_.baseLayerSource();w.setItem("background-last-used-toggle",k.id),w.setItem("background-last-used",A.id),_.baseLayerSource(A)}});let n=e.append("div").attr("class","main-content active");n.append("div").attr("class","main-map").attr("dir","ltr").call(s.render),n.append("div").attr("class","top-toolbar-wrap").append("div").attr("class","top-toolbar fillD").call(Cf(t));let o=n.append("div").attr("class","over-map");o.append("div").attr("class","select-trap").text("t"),o.call(Cl(t)),o.call(Sl(t)),o.append("div").attr("class","spinner").call(Ef(t));let a=o.append("div").attr("class","map-controls");a.append("div").attr("class","map-control zoombuttons").call(Tf(t)),a.append("div").attr("class","map-control zoom-to-selection-control").call(If(t)),a.append("div").attr("class","map-control geolocate-control").call(B6(t));let l=o.append("div").attr("class","map-panes"),c=[Ff(t),Wf(t),$f(t),Qf(t),Lf(t)];for(let b of c)a.append("div").attr("class",`map-control map-pane-control ${b.id}-control`).call(b.renderToggleButton),l.call(b.renderPane);this.info=j6(t),o.call(this.info),o.append("div").attr("class","photoviewer").classed("al",!0).classed("hide",!0).call(this.photoviewer),o.append("div").attr("class","attribution-wrap").attr("dir","ltr").call(v6(t));let u=n.append("div").attr("class","map-footer");u.append("div").attr("class","api-status").call(Af(t));let h=u.append("div").attr("class","map-footer-bar fillD");h.append("div").attr("class","flash-wrap footer-hide");let d=h.append("div").attr("class","main-footer-wrap footer-show");d.append("div").attr("class","scale-block").call(vf(t));let f=d.append("div").attr("class","info-block").append("ul").attr("class","map-footer-list");f.append("li").attr("class","user-list").call(S6(t)),f.append("li").attr("class","fb-road-license").attr("tabindex",-1).call(gf(t));let p=t.apiConnections;p&&p.length>1&&f.append("li").attr("class","source-switch").call(wf(t).keys(p)),f.append("li").attr("class","issues-info").call(X6(t));let m=f.append("li");m.append("button").attr("class","bugnub").attr("tabindex",-1).on("click",this._clickBugLink).call(V("#rapid-icon-bug","bugnub")).call(he(t).title(r.t("report_a_bug")).placement("top")),m.append("a").attr("target","_blank").attr("href","https://github.com/openstreetmap/iD/blob/develop/CONTRIBUTING.md#translating").call(V("#rapid-icon-translate","light")).call(he(t).title(r.t("help_translate")).placement("top")),f.append("li").attr("class","version").call(kf(t)),t.embed()||f.call(x6(t)),e.call(this.shortcuts),this.resize(),s.resume(),t.enter("browse");let g=t.systems.editor;t.systems.urlhash.initialHashParams.get("walkthrough")==="true"?e.call(an(t)):g.canRestoreBackup?e.call(xf(t)):e.call(yf(t))}resize(e){let t=this.context,r=t.container(),s=t.systems.map,n=Kr(r.select(".main-content"),!0);Kr(r.select(".sidebar"),!0),e!==void 0&&s.pan(e),s.dimensions=n,this.photoviewer.onMapResize(),this.checkOverflow(".top-toolbar"),this.checkOverflow(".map-footer-bar")}checkOverflow(e,t){t&&delete this._needWidth[e];let r=this.context.container().select(e);if(r.empty())return;let s=r.property("scrollWidth"),n=r.property("clientWidth"),o=this._needWidth[e]||s;s>n?(r.classed("narrow",!0),this._needWidth[e]||(this._needWidth[e]=s)):s>=o&&r.classed("narrow",!1)}togglePanes(e){let t=this.context,r=t.systems.l10n,s=t.container(),n=s.selectAll(".map-pane.shown"),o=r.isRTL()?"left":"right";n.classed("shown",!1).classed("hide",!0),s.selectAll(".map-pane-control button").classed("active",!1),e?(n.classed("shown",!1).classed("hide",!0).style(o,"-500px"),s.selectAll("."+e.attr("pane")+"-control button").classed("active",!0),e.classed("shown",!0).classed("hide",!1),n.empty()?e.style(o,"-500px").transition().duration(200).style(o,"0px"):e.style(o,"0px")):n.classed("shown",!0).classed("hide",!1).style(o,"0px").transition().duration(200).style(o,"-500px").on("end",function(){G(this).classed("shown",!1).classed("hide",!0)})}showEditMenu(e,t){var a,l;this.editMenu.close();let r=this.context,s=r.systems.map,n=(l=(a=r.mode)==null?void 0:a.operations)!=null?l:[];if(!n.length||!r.editable())return;let o=r.surface().node();o.focus&&o.focus();for(let c of n)typeof c.point=="function"&&c.point(e);this.editMenu.anchorLoc(r.projection.invert(e)).triggerType(t).operations(n),s.overlay.call(this.editMenu)}redrawEditMenu(){var s,n;let e=this.context,t=e.systems.map;if(t.overlay.selectAll(".edit-menu").empty())return;let r=(n=(s=e.mode)==null?void 0:s.operations)!=null?n:[];r.length&&e.editable()?(this.editMenu.operations(r),t.overlay.call(this.editMenu)):this.editMenu.close()}closeEditMenu(){this.editMenu.close()}_clickBugLink(){let e=new URL("https://github.com/facebook/Rapid/issues/new");e.searchParams.append("template","bug_report.yml");let t=ei(),r=`${t.browser} v${t.version}`,s=`${t.os}`,n=navigator.userAgent;e.searchParams.append("browser",r),e.searchParams.append("os",s),e.searchParams.append("useragent",n),e.searchParams.append("URL",window.location.href),e.searchParams.append("version",this.context.version),window.open(e.toString(),"_blank")}};var Tu=class extends Ce{constructor(e){super(e),this.id="uploader",this.dependencies=new Set(["dataloader","editor","l10n"]),this.changeset=null,this._origChanges=null,this._discardTags={},this._isSaving=!1,this._localGraph=null,this._remoteGraph=null,this._toCheckIDs=new Set,this._toLoadIDs=new Set,this._loadedIDs=new Set,this._conflicts=[],this._errors=[],this._initPromise=null,this._loadedSome=this._loadedSome.bind(this),this._uploadCallback=this._uploadCallback.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let r of this.dependencies)if(!this.context.systems[r])return Promise.reject(`Cannot init:  ${this.id} requires ${r}`);let e=this.context.systems.dataloader,t=e.initAsync();return this._initPromise=t.then(()=>e.getDataAsync("discarded")).then(r=>this._discardTags=r)}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this.changeset=null,Promise.resolve()}isSaving(){return this._isSaving}save(e,t){if(this._isSaving&&!e)return;let r=this.context,s=r.services.osm;if(!s)return;if(!s.authenticated()){s.authenticate(o=>{o||this.save(e,t)});return}this._isSaving||(this._isSaving=!0,this.emit("saveStarted")),this._localGraph=null,this._remoteGraph=null,this._toCheckIDs=new Set,this._toLoadIDs=new Set,this._loadedIDs=new Set,this._conflicts=[],this._errors=[];let n=r.systems.editor;this._origChanges=n.changes(to(n.difference(),this._discardTags)),t?this._startConflictCheck():this._tryUpload()}_startConflictCheck(){let e=this.context,t=e.services.osm,r=e.systems.editor,s=r.difference().summary(),n=r.staging.graph;this._localGraph=n,this._remoteGraph=new di(r.base.graph,!0),this._toCheckIDs=new Set;for(let[o,a]of s)if(a.changeType==="modified"){let l=n.entity(o);this._toCheckIDs.add(o);for(let c of n.childNodes(l))c.version!==void 0&&this._toCheckIDs.add(c.id)}this._toLoadIDs=new Set(this._toCheckIDs),this._loadedIDs=new Set,t&&this._toLoadIDs.size?(this.emit("progressChanged",this._loadedIDs.size,this._toCheckIDs.size),t.loadMultiple(Array.from(this._toLoadIDs),this._loadedSome)):this._tryUpload()}_loadedSome(e,t){if(this._errors.length)return;let r=this.context.systems.l10n,s=this.context.services.osm;if(e){this._errors.push({msg:e.message||e.responseText,details:[r.t("save.status_code",{code:e.status})]}),this._didResultInErrors();return}let n=new Set;for(let o of t.data)if(this._remoteGraph.replace(o),this._loadedIDs.add(o.id),this._toLoadIDs.delete(o.id),!!o.visible){if(o.type==="way")for(let a of o.nodes)this._toCheckIDs.has(a)||(this._toCheckIDs.add(a),this._toLoadIDs.add(a),n.add(a));else if(o.type==="relation"&&o.isMultipolygon())for(let a of o.members)this._toCheckIDs.has(a.id)||(this._toCheckIDs.add(a.id),this._toLoadIDs.add(a.id),n.add(a.id))}this.emit("progressChanged",this._loadedIDs.size,this._toCheckIDs.size),s&&n.size?s.loadMultiple(Array.from(n),this._loadedSome):this._toLoadIDs.size||(this._detectConflicts(),this._tryUpload())}_detectConflicts(){let e=this.context,t=e.systems.l10n,r=e.systems.editor,s=e.services.osm;if(!s)return;let n=this._localGraph,o=this._remoteGraph;for(let u of this._toCheckIDs){let h=n.entity(u),d=o.entity(u);if(c(h,d))continue;let f=_1(u,{localGraph:n,remoteGraph:o,discardTags:this._discardTags,formatUser:a,localize:t.t,strategy:"safe"});r.perform(f);let p=f.conflicts();if(!p.length)continue;let m=_1(u,{localGraph:n,remoteGraph:o,discardTags:this._discardTags,formatUser:a,localize:t.t,strategy:"force_local"}),g=_1(u,{localGraph:n,remoteGraph:o,discardTags:this._discardTags,formatUser:a,localize:t.t,strategy:"force_remote"}),y=t.t("save.conflict."+(d.visible?"keep_local":"restore")),x=t.t("save.conflict."+(d.visible?"keep_remote":"delete"));this._conflicts.push({id:u,name:l(h),details:p,chosen:1,choices:[{id:u,text:y,action:()=>r.perform(m)},{id:u,text:x,action:()=>r.perform(g)}]})}function a(u){return'<a href="'+s.userURL(u)+'" target="_blank">'+u+"</a>"}function l(u){return t.displayName(u.tags)||t.displayType(u.id)+" "+u.id}function c(u,h){if(u.version!==h.version)return!1;if(u.type==="way")for(let d of Gt(u.nodes,h.nodes)){let f=n.hasEntity(d),p=o.hasEntity(d);if(f&&p&&f.version!==p.version)return!1}return!0}}_tryUpload(){let e=this.context,t=e.services.osm;if(t||this._errors.push({msg:"No OSM Service"}),this.changeset||this._errors.push({msg:"No OSM Changeset"}),this._conflicts.length)this._didResultInConflicts();else if(this._errors.length)this._didResultInErrors();else{let r=e.systems.editor,s=r.changes(to(r.difference(),this._discardTags));s.modified.length||s.created.length||s.deleted.length?(this.emit("willAttemptUpload"),t.sendChangeset(this.changeset,s,this._uploadCallback)):this._didResultInNoChanges()}}_uploadCallback(e,t){if(t&&(this.changeset=t),e)if(e.status===409)this.save(!0,!0);else{let r=this.context.systems.l10n;this._errors.push({msg:e.message||e.responseText,details:[r.t("save.status_code",{code:e.status})]}),this._didResultInErrors()}else this._didResultInSuccess()}_didResultInNoChanges(){this.emit("resultNoChanges"),this._endSave()}_didResultInErrors(){this.context.systems.editor.revert(),this.emit("resultErrors",this._errors),this._endSave()}_didResultInConflicts(){this._conflicts.sort((e,t)=>t.id.localeCompare(e.id)),this.emit("resultConflicts",this.changeset,this._conflicts,this._origChanges),this._endSave()}_didResultInSuccess(){this.emit("resultSuccess",this.changeset),this._endSave()}_endSave(){this._isSaving=!1,this.emit("saveEnded")}cancelConflictResolution(){this.context.systems.editor.revert()}processResolvedConflicts(){let e=this.context.systems.editor;for(let t of this._conflicts)if(t.chosen===1){let s=e.staging.graph.hasEntity(t.id);if((s==null?void 0:s.type)==="way")for(let n of Fe(s.nodes))e.perform(o2(n));e.perform(o2(t.id))}this.save(!0,!1)}};var Iu=class extends Ce{constructor(e){super(e),this.id="urlhash",this.dependencies=new Set(["editor","l10n","map"]),this.doUpdateTitle=!0,this.titleBase="Rapid";let t=Vn(window.location.hash);this._initParams=new Map(Object.entries(t)),this._initParams.has("datasets")||this._initParams.set("datasets","fbRoads,msBuildings"),this._initParams.has("disable_features")||this._initParams.set("disable_features","boundaries"),this._currParams=new Map(this._initParams),this._currHash=null,this._prevParams=null,this._startPromise=null,this._hashchange=this._hashchange.bind(this),this._updateHash=this._updateHash.bind(this),this._updateTitle=this._updateTitle.bind(this),this.deferredUpdateHash=on(this._updateHash,500,{leading:!1}),this.deferredUpdateTitle=on(this._updateTitle,500,{leading:!1})}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context,t=e.systems.editor,r=e.systems.l10n,s=Promise.all([r.startAsync(),t.startAsync()]);return this._startPromise=s.then(()=>{t.on("stablechange",this.deferredUpdateTitle),e.on("modechange",this.deferredUpdateTitle),window.addEventListener("hashchange",this._hashchange),this._started=!0,this.resume()})}resetAsync(){return Promise.resolve()}pause(){this._paused=!0,this._currHash=null,this.deferredUpdateHash.cancel(),this.deferredUpdateTitle.cancel()}resume(){this._paused=!1,this._currHash=null,this._updateHash(),this._hashchange(),this._updateTitle()}get initialHashParams(){return this._initParams}getParam(e){return this._currParams.get(e)}setParam(e,t){typeof e=="string"&&(t==null||t==="undefined"||t==="null"?this._currParams.delete(e):this._currParams.set(e,t),this._started&&!this._paused&&this.deferredUpdateHash())}_updateHash(){if(!this._started||this._paused)return;let e=["comment","source","hashtags","walkthrough"],t=li(Object.fromEntries(this._currParams),e),r="#"+tt(t,!0);r!==this._currHash&&(window.history.replaceState(null,this.titleBase,r),this._currHash=r)}_updateTitle(){if(!this._started||this._paused||!this.doUpdateTitle)return;let e=this.context,t=e.systems.editor,r=t.staging.graph,s=e.systems.l10n,n=t.difference().summary().size,o,a=e.selectedIDs().filter(u=>r.hasEntity(u));if(a.length){let u=s.displayLabel(r.entity(a[0]),r);a.length>1?o=s.t("title.labeled_and_more",{labeled:u,count:a.length-1}):o=u}let l;n&&o?l="title.format.changes_context":n&&!o?l="title.format.changes":!n&&o&&(l="title.format.context");let c;l?c=s.t(l,{changes:n,base:this.titleBase,context:o}):c=this.titleBase,document.title!==c&&(document.title=c)}_hashchange(){if(!this._started||this._paused)return;this._currHash=window.location.hash;let e=Vn(this._currHash);this._prevParams?this._prevParams=this._currParams:this._prevParams=new Map,this._currParams=new Map(Object.entries(e)),this.emit("hashchange",new Map(this._currParams),new Map(this._prevParams))}};var gT=et(Zr(),1);var Yg={};g3(Yg,{validationAlmostJunction:()=>gg,validationAmbiguousCrossingTags:()=>xg,validationCloseNodes:()=>yg,validationCrossingWays:()=>vg,validationDisconnectedWay:()=>_g,validationDuplicateWaySegments:()=>bg,validationFormatting:()=>wg,validationHelpRequest:()=>Eg,validationImpossibleOneway:()=>Ag,validationIncompatibleSource:()=>Sg,validationMismatchedGeometry:()=>Cg,validationMissingRole:()=>kg,validationMissingTag:()=>Tg,validationOutdatedTags:()=>Ig,validationPrivateData:()=>Mg,validationSuspiciousName:()=>qg,validationUnsquareWay:()=>Qg,validationYShapedConnection:()=>Xg});function gg(i){let e="almost_junction",t=i.systems.editor,r=i.systems.l10n,s=5,n=.75,o=s-n,a=Math.atan(n/s);function l(h){return h.type==="way"&&ds[h.tags.highway]}function c(h){return h.tags.noexit==="yes"||h.tags.amenity==="parking_entrance"||h.tags.entrance&&h.tags.entrance!=="no"}let u=function(d,f){if(!l(d))return[];if(d.isDegenerate())return[];let p=t.tree,m=_(d,f),g=[];return m.forEach(S=>{g.push(new Ye(i,{type:e,subtype:"highway-highway",severity:"warning",message:function(){let M=t.staging.graph,I=M.hasEntity(this.entityIds[0]);if(this.entityIds[0]===this.entityIds[2])return I?r.t("issues.almost_junction.self.message",{feature:r.displayLabel(I,M)}):"";{let T=M.hasEntity(this.entityIds[2]);return I&&T?r.t("issues.almost_junction.message",{feature:r.displayLabel(I,M),feature2:r.displayLabel(T,M)}):""}},reference:x,entityIds:[d.id,S.node.id,S.wid],loc:S.node.loc,hash:JSON.stringify(S.node.loc),data:{midId:S.mid.id,edge:S.edge,cross_loc:S.cross_loc},dynamicFixes:y}))}),g;function y(){let S=t.staging.graph,M=[new Te({icon:"rapid-icon-abutment",title:r.t("issues.fix.connect_features.title"),onClick:function(){let T=r.t("issues.fix.connect_almost_junction.annotation"),[,C,P]=this.issue.entityIds,D=S.entity(this.issue.data.midId),O=S.entity(C),R=S.entity(P),N=w(O,R,S);if(N.length>0){let z=A(D,O,N);if(z){t.perform(Nr([z.id,O.id],z.loc)),t.commit({annotation:T,selectedIDs:[z.id,O.id]});return}}let F=this.issue.data.edge,B=this.issue.data.cross_loc,U=[S.entity(F[0]),S.entity(F[1])].map(z=>z.loc),H=S5(U,B);H.distance<n?(t.perform(Nr([H.id,O.id],H.loc)),t.commit({annotation:T,selectedIDs:[H.id,O.id]})):(t.perform(yi({loc:B,edge:F},O)),t.commit({annotation:T,selectedIDs:[O.id]}))}})],I=S.hasEntity(this.entityIds[1]);return I&&!I.hasInterestingTags()&&M.push(new Te({icon:"maki-barrier",title:r.t("issues.fix.tag_as_disconnected.title"),onClick:function(){let T=this.issue.entityIds[1],C=Object.assign({},S.entity(T).tags);C.noexit="yes",t.perform(vt(T,C)),t.commit({annotation:r.t("issues.fix.tag_as_disconnected.annotation"),selectedIDs:[T]})}})),M}function x(S){S.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.almost_junction.highway-highway.reference"))}function b(S,M){let I=i.services.osm;if(I&&!I.isDataLoaded(S.loc)||c(S)||f.parentWays(S).length!==1)return!1;let T=0;for(let C in M.nodes)if(M.nodes[C]===S.id&&(T+=1,T>1))return!1;return!0}function _(S,M){let I=[];if(S.isClosed())return I;let T;return[0,S.nodes.length-1].forEach(P=>{let D=S.nodes[P],O=M.entity(D);if(!b(O,S))return;let R=E(S,P);R&&(T=M.childNodes(S).slice(),T[P]=T[P].move(R.cross_loc),!Ha(T,D)&&I.push(R))}),I}function w(S,M,I){return[M.nodes[0],M.nodes[M.nodes.length-1]].map(T=>I.entity(T)).filter(T=>T.id!==S.id&&at(S.loc,T.loc)<=o)}function A(S,M,I){let T,C=1/0;return I.forEach(P=>{let D=i.projection.project(S.loc),O=i.projection.project(M.loc),R=i.projection.project(P.loc),N=$t(D,O)+Math.PI,F=$t(D,R)+Math.PI,B=Math.max(N,F)-Math.min(N,F);B<C&&(T=P,C=B)}),C<=a?T:null}function k(S,M){return S[M]!==void 0&&S[M]!=="no"}function v(S,M){if(S.id===M.id)return!0;if((k(S.tags,"bridge")||k(M.tags,"bridge"))&&!(k(S.tags,"bridge")&&k(M.tags,"bridge"))||(k(S.tags,"tunnel")||k(M.tags,"tunnel"))&&!(k(S.tags,"tunnel")&&k(M.tags,"tunnel")))return!1;let I=S.tags.layer||"0",T=M.tags.layer||"0";if(I!==T)return!1;let C=S.tags.level||"0",P=M.tags.level||"0";return C===P}function E(S,M){let I=S.nodes[M],T=M===0?S.nodes[1]:S.nodes[S.nodes.length-2],C=f.entity(I),P=f.entity(T),D=C.loc[0],O=C.loc[1],R=ki(s,O)/2,N=gn(s)/2,F=new ie([D-R,O-N],[D+R,O+N]),B=at(P.loc,C.loc),$=s/B+1,U=ct(P.loc,C.loc,$),H=p.waySegments(F,f);for(let z=0;z<H.length;z++){let j=H[z],X=f.entity(j.wayId);if(!l(X)||!v(S,X))continue;let K=j.nodes[0],Y=j.nodes[1];if(K===I||Y===I)continue;let oe=f.entity(K),re=f.entity(Y),W=Jn([C.loc,U],[oe.loc,re.loc]);if(W)return{mid:P,node:C,wid:X.id,edge:[oe.id,re.id],cross_loc:W}}return null}};return u.type=e,u}function yg(i){let e="close_nodes",t=i.systems.editor,r=i.systems.l10n,s=.2;function n(a){return a!==void 0&&a!=="no"}let o=function(a,l){if(a.type==="node")return c(a);if(a.type==="way")return d(a);return[];function c(y){let x=l.parentWays(y);return x.length?f(y,x):m(y)}function u(y){let x=y.tags;if(n(x.boundary))return"boundary";if(n(x.indoor))return"indoor";if(n(x.building)||n(x["building:part"]))return"building";if(Bs[x.highway])return"path";let b=l.parentRelations(y);for(let _ of b){if(_.tags.type==="boundary")return"boundary";if(_.isMultipolygon()){if(n(_.tags.indoor))return"indoor";if(n(_.tags.building)||n(_.tags["building:part"]))return"building"}}return"other"}function h(y){if(y.nodes.length<=2||y.isClosed()&&y.nodes.length<=4)return!1;let x=y.extent(l).bbox();return!(at([x.minX,x.minY],[x.maxX,x.maxY])<1.5)}function d(y){if(!h(y))return[];let x=[],b=l.childNodes(y);for(let _=0;_<b.length-1;_++){let w=b[_],A=b[_+1],k=g(w,A,y);k&&x.push(k)}return x}function f(y,x){let b=[];function _(w,A,k){let v=g(w,A,k);v&&b.push(v)}for(let w of x){if(!h(w))continue;let A=w.nodes.length-1;for(let k=0;k<w.nodes.length;k++)k!==0&&w.nodes[k-1]===y.id&&_(y,l.entity(w.nodes[k]),w),k!==A&&w.nodes[k+1]===y.id&&_(l.entity(w.nodes[k]),y,w)}return b}function p(y){if(!h(y))return 0;let x=u(y);return x==="boundary"?0:x==="indoor"?.01:x==="building"?.05:x==="path"?.1:.2}function m(y){let x=[],b=y.loc[0],_=y.loc[1],w=ki(s,_)/2,A=gn(s)/2,k=new ie([b-w,_-A],[b+w,_+A]),v=t.tree.intersects(k,l);for(let M of v)if(M.id!==y.id&&!(M.type!=="node"||M.geometry(l)!=="point")&&(M.loc===y.loc||at(y.loc,M.loc)<s)){if("memorial:type"in y.tags&&"memorial:type"in M.tags&&y.tags["memorial:type"]==="stolperstein"&&M.tags["memorial:type"]==="stolperstein"||"memorial"in y.tags&&"memorial"in M.tags&&y.tags.memorial==="stolperstein"&&M.tags.memorial==="stolperstein")continue;let I={layer:!0,level:!0,"addr:housenumber":!0,"addr:unit":!0},T=!1;for(var E in I){let C=y.tags[E]||"0",P=M.tags[E]||"0";if(C!==P){T=!0;break}}if(T)continue;x.push(new Ye(i,{type:e,subtype:"detached",severity:"warning",message:function(){let C=t.staging.graph,P=C.hasEntity(this.entityIds[0]),D=C.hasEntity(this.entityIds[1]);return P&&D?r.t("issues.close_nodes.detached.message",{feature:r.displayLabel(P,C),feature2:r.displayLabel(D,C)}):""},reference:S,entityIds:[y.id,M.id],dynamicFixes:function(){return[new Te({icon:"rapid-operation-disconnect",title:r.t("issues.fix.move_points_apart.title")}),new Te({icon:"rapid-icon-layers",title:r.t("issues.fix.use_different_layers_or_levels.title")})]}}))}return x;function S(M){M.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.close_nodes.detached.reference"))}}function g(y,x,b){if(y.id===x.id||y.hasInterestingTags()&&x.hasInterestingTags())return null;if(y.loc!==x.loc){let A=l.parentWays(y),k=new Set(l.parentWays(x)),E=A.filter(I=>k.has(I)).map(I=>p(I)),S=Math.min(...E);if(at(y.loc,x.loc)>S)return null}let _=A=>k=>{let v=A[0],E=A[1];return v&&E&&k.hasEntity(v)&&k.hasEntity(E)?Nr(A)(k):k};return new Ye(i,{type:e,subtype:"vertices",severity:"warning",message:function(){let A=t.staging.graph,k=A.hasEntity(this.entityIds[0]);return k?r.t("issues.close_nodes.message",{way:r.displayLabel(k,A)}):""},reference:w,entityIds:[b.id,y.id,x.id],loc:y.loc,autoArgs:[_([y.id,x.id]),r.t("issues.fix.merge_close_vertices.annotation")],dynamicFixes:function(){return[new Te({icon:"rapid-icon-plus",title:r.t("issues.fix.merge_points.title"),onClick:function(){let A=this.issue.entityIds;t.perform(Nr([A[1],A[2]])),t.commit({annotation:r.t("issues.fix.merge_close_vertices.annotation"),selectedIDs:[A[1],A[2]]})}}),new Te({icon:"rapid-operation-disconnect",title:r.t("issues.fix.move_points_apart.title")})]}});function w(A){A.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.close_nodes.reference"))}}};return o.type=e,o}function xg(i){let e="ambiguous_crossing",t=i.systems.editor,r=i.systems.l10n,s=i.systems.presets,n=function(c,u){return c.type!=="way"||c.isDegenerate()?[]:a(c,u)};function o(l){return c=>{let u=c.entity(l),h=s.match(u,c),d=h.replacement,f=d&&s.item(d);return f?c=xr(l,h,f,!0)(c):c=Vs(l)(c),c}}function a(l,c){var T;let u=l.id,h=s.match(l,c),d=o(u),f=d(c),p=new er(c,f);if(!p.changes.size)return[];let m=f.hasEntity(u);if(!m)return[];let g=new Map,y=new Map,x=k(m.tags),b=x.type!=="not a crossing";v(x);let _=jn(l.tags,m.tags);y.set(u,{name:h.name(),tagDiff:_});let w=_.length>0;for(let C of p.changes.values()){let P=C==null?void 0:C.base,D=C==null?void 0:C.head;if(!P||!D||P.type!=="node")continue;b&&(v(k(P.tags)),v(k(D.tags)));let O=s.match(P,c),R=jn(P.tags,D.tags);y.set(P.id,{name:O.name(),tagDiff:R})}v(k({}));let A=!0;if(y.size>1){for(let C of y.values())if((T=C.tagDiff)!=null&&T.length&&C.tagDiff.some(P=>P.type==="-")){A=!1;break}}return[new Ye(i,{type:e,subtype:"crossing_conflict",severity:"warning",entityIds:[...y.keys()],data:{isParentCrossing:b,isParentChanged:w,isTagUpgrade:A,updates:y,choices:g},autoArgs:[d,r.t("issues.ambiguous_crossing.annotation.changed")],message:M,reference:I,dynamicFixes:E})];function k(C){var F,B;let P=(F=C["crossing:markings"])!=null?F:"",D=(B=C.crossing)!=null?B:"",O=C.highway==="crossing"||C.path==="crossing"||C.footway==="crossing"||C.cycleway==="crossing"||C.bridleway==="crossing"||C.pedestrian==="crossing",R,N;return P!==""&&P!=="yes"&&P!=="no"?(R=P,N={"crossing:markings":P}):P==="yes"?(R="marked",N={"crossing:markings":"yes"}):P==="no"?(R="unmarked",N={"crossing:markings":"no"}):D!==""?(R=D,N={crossing:D}):O?(R="unspecified",N=null):(R="not a crossing",N={footway:null,path:null,cycleway:null,bridleway:null,pedestrian:null,crossing:null,"crossing:markings":null,"crossing:signals":null}),{type:R,tags:N}}function v(C){let P=C.type,D=C.tags;if(P==="unspecified")return;let O=g.get(P);return O?P!=="not a crossing"&&(O.setTags=Object.assign(O.setTags,D)):(O={setTags:D},g.set(P,O)),O}function E(){let C=this,P=C.entityIds[0],D=C.data.choices,O=C.data.isTagUpgrade?"update_type":"choose_type",R=[];for(let[$,U]of D){if($==="not a crossing")continue;let H=r.t(`issues.ambiguous_crossing.fix.${O}`,{type:$}),z=S(H,P,U.setTags);R.push(z)}let N=D.get("not a crossing"),F=r.t("issues.ambiguous_crossing.fix.remove_all"),B=S(F,P,N.setTags);return R.push(B),R}function S(C,P,D){return new Te({title:C,onClick:()=>{let R=t.staging.graph.hasEntity(P);if(R){if(D){let N=Object.assign({},R.tags);for(let[F,B]of Object.entries(D))B?N[F]=B:delete N[F];t.perform(vt(R.id,N))}t.perform(d),t.commit({annotation:r.t("issues.ambiguous_crossing.annotation.changed"),selectedIDs:[R.id]})}}})}function M(){let P=this.data;return P.isParentCrossing&&!P.isParentChanged&&P.isTagUpgrade?r.t("issues.ambiguous_crossing.message.candidate"):P.isTagUpgrade?r.t("issues.ambiguous_crossing.message.update"):r.t("issues.ambiguous_crossing.message.conflict")}function I(C){let P=this,D=[];for(let[N,F]of P.data.updates)D.push({entityID:N,name:F.name,tagDiff:F.tagDiff||[]});let O=C.selectAll(".issue-reference").data([0]).enter();O.append("div").attr("class","issue-reference").text(r.t("issues.ambiguous_crossing.reference.line1")),O.append("div").attr("class","issue-reference").text(r.t("issues.ambiguous_crossing.reference.line2")),O.append("strong").text(r.t("issues.suggested"));let R=O.selectAll(".suggested-update").data(D,N=>N.entityID).enter().append("div").attr("class","suggested-update");R.append("strong").text(N=>`${N.entityID[0]==="w"?r.t("modes.add_line.title"):r.t("modes.add_point.title")} ${N.entityID} - ${N.name}:`),R.each((N,F,B)=>{let $=G(B[F]);N.tagDiff.length?$.append("table").attr("class","tagDiff-table").selectAll(".tagDiff-row").data(U=>U.tagDiff).enter().append("tr").attr("class","tagDiff-row").append("td").attr("class",U=>`tagDiff-cell tagDiff-cell-${U.type==="+"?"add":"remove"}`).text(U=>U.display):$.append("div").attr("class","tagDiff-message").text(U=>U.entityID===u&&!P.data.isParentCrossing?r.t("issues.ambiguous_crossing.not_a_crossing"):r.t("issues.ambiguous_crossing.no_changes"))})}}return n.type=e,n}function vg(i){let e="crossing_ways",t=i.systems.editor,r=i.systems.l10n;function s(v){return v!==void 0&&v!=="no"}function n(v){return s(v.indoor)||s(v.level)||v.highway==="corridor"}let o=new Set(["aeroway","highway","railway","waterway"]),a=new Set(["highway","railway","waterway"]),l=new Set(["demolished","dismantled","proposed","razed"]),c=new Set(["motorway","motorway_link","trunk","trunk_link","primary","primary_link","secondary","secondary_link"]),u=new Set(["path","footway","cycleway","bridleway","pedestrian"]);function h(v){for(let E of u)if(v.highway===E&&v[E]==="crossing")return!0;return!1}let d=function(E,S){let M=i.systems.editor.tree,I=[];for(let T of f(E,S))for(let C of x(T,S,M))I.push(b(C,S));return I};function f(v,E){if(m(v,E)){if(v.type==="way")return new Set([v]);if(v.type==="relation"&&v.tags.type==="multipolygon"){let S=new Set;for(let M of v.members)if(M.type==="way"&&(!M.role||M.role==="outer"||M.role==="inner")){let I=E.hasEntity(M.id);I&&S.add(I)}return S}else return new Set}else return new Set}function p(v,E){if(m(v,E)===null){let S=E.parentRelations(v);for(let M of S)if(m(M,E)!==null)return M}return v}function m(v,E){let S=v.geometry(E);if(S!=="line"&&S!=="area")return null;let M=v.tags;return Ty[M.aeroway]?"aeroway":s(M.building)&&!l.has(M.building)?"building":s(M.highway)&&ds[M.highway]?"highway":S!=="line"?null:s(M.railway)&&T3[M.railway]?"railway":s(M.waterway)&&Ol[M.waterway]?"waterway":null}function g(v,E,S,M){let I=v.level||"0",T=S.level||"0";if(n(v)&&n(S)&&I!==T)return!0;let C=v.layer||"0",P=S.layer||"0";if(E==="highway"&&M==="highway"&&C!==P)return!0;let D=o.has(E)&&s(v.bridge),O=o.has(M)&&s(S.bridge);if(D&&!O||!D&&O||D&&O&&C!==P)return!0;let R=a.has(E)&&s(v.tunnel),N=a.has(M)&&s(S.tunnel);return!!(R&&!N||!R&&N||R&&N&&C!==P||E==="waterway"&&M==="highway"&&S.man_made==="pier"||M==="waterway"&&E==="highway"&&v.man_made==="pier"||(E==="building"||M==="building")&&C!==P)}function y(v,E,S){let M=m(v,S),I=m(E,S),T=[M,I].sort().join("-"),C=v.geometry(S),P=E.geometry(S),D=C==="line"&&P==="line";if(T==="aeroway-aeroway")return{};if(T==="aeroway-highway"){let O=v.tags.highway==="service"||E.tags.highway==="service",R=Bs[v.tags.highway]||Bs[E.tags.highway];return O||R?{}:{aeroway:"aircraft_crossing"}}else{if(T==="aeroway-railway")return{aeroway:"aircraft_crossing",railway:"level_crossing"};if(T==="aeroway-waterway")return null;if(T==="highway-highway"){let O=Bs[v.tags.highway],R=Bs[E.tags.highway];return(O||R)&&O!==R?!D||(O?E:v).tags.highway==="track"?{}:{highway:"crossing"}:{}}else if(T==="highway-railway"){if(!D)return{};let O=v.tags.railway==="tram"||E.tags.railway==="tram";return Bs[v.tags.highway]||Bs[E.tags.highway]?O?{railway:"tram_crossing"}:{railway:"crossing"}:O?{railway:"tram_level_crossing"}:{railway:"level_crossing"}}else{if(T==="highway-waterway")return s(v.tags.tunnel)&&s(E.tags.tunnel)||s(v.tags.bridge)&&s(E.tags.bridge)||c.has(v.tags.highway)||c.has(E.tags.highway)?null:D?{ford:"yes"}:{};if(T==="railway-railway")return{};if(T==="railway-waterway")return null;if(T==="waterway-waterway")return{}}}return null}function x(v,E,S){if(v.type!=="way")return[];let M=p(v,E),I=M.tags,T=m(M,E);if(T===null)return[];let C=new Set,P=[],D=E.childNodes(v);for(let O=0;O<D.length-1;O++){let R=D[O],N=D[O+1],F=new ie([Math.min(R.loc[0],N.loc[0]),Math.min(R.loc[1],N.loc[1])],[Math.max(R.loc[0],N.loc[0]),Math.max(R.loc[1],N.loc[1])]),B=S.waySegments(F,E);for(let $ of B){if($.wayId===v.id||C.has($.wayId))continue;let U=E.hasEntity($.wayId);if(!U)continue;let H=p(U,E),z=m(H,E),j=H.tags;if(z===null||g(I,T,j,z))continue;let X=$.nodes[0],K=$.nodes[1];if(X===R.id||X===N.id||K===R.id||K===N.id)continue;let Y=E.hasEntity(X),oe=E.hasEntity(K);if(!Y||!oe)continue;let re=[R.loc,N.loc],W=[Y.loc,oe.loc],Z=Jn(re,W);if(Z&&(P.push({wayInfos:[{way:v,featureType:T,edge:[R.id,N.id]},{way:U,featureType:z,edge:[Y.id,oe.id]}],crossPoint:Z}),T==="building"||z==="building")){C.add(U.id);break}}}return P}function b(v,E){v.wayInfos.sort((Q,q)=>{let pe=Q.featureType,$e=q.featureType;return pe===$e?r.displayLabel(Q.way,E)>r.displayLabel(q.way,E):pe==="waterway"?!0:$e==="waterway"?!1:pe<$e});let S=v.wayInfos.map(Q=>p(Q.way,E)),[M,I]=S,T=M.tags,C=I.tags,P=v.wayInfos[0].featureType,D=v.wayInfos[1].featureType,O=[v.wayInfos[0].edge,v.wayInfos[1].edge],R=[P,D],N=y(M,I,E),F=n(T)&&n(C),B=o.has(P)&&s(T.bridge),$=o.has(D)&&s(C.bridge),U=B&&$,H=a.has(P)&&s(T.tunnel),z=a.has(D)&&s(C.tunnel),j=H&&z,X=(T.highway==="service"||C.highway==="service")&&(N==null?void 0:N.highway)==="crossing",K=null;(N==null?void 0:N.highway)==="crossing"&&(h(T)?K=M.id:h(C)&&(K=I.id));let Y=[P,D].sort().join("-"),oe=Y;F?oe="indoor-indoor":j?oe="tunnel-tunnel":U&&(oe="bridge-bridge"),N&&(F||j||U)&&(oe+="_connectable");let re=""+v.crossPoint[0].toFixed(4)+","+v.crossPoint[1].toFixed(4),W=null;return X?W=w(v.crossPoint,O,null,{}):N&&!N.ford&&(W=w(v.crossPoint,O,K,N)),new Ye(i,{type:e,subtype:Y,severity:"warning",message:function(){let Q=t.staging.graph,q=Q.hasEntity(this.entityIds[0]),pe=Q.hasEntity(this.entityIds[1]);return q&&pe?r.t("issues.crossing_ways.message",{feature:r.displayLabel(q,Q),feature2:r.displayLabel(pe,Q)}):""},reference:Z,entityIds:[M.id,I.id],data:{edges:O,featureTypes:R,crossingWayID:K,connectionTags:N},hash:re,loc:v.crossPoint,autoArgs:W,dynamicFixes:function(){var Tt;let Q=t.staging.graph,q=i.selectedIDs();if(((Tt=i.mode)==null?void 0:Tt.id)!=="select-osm"||q.length!==1)return[];let pe=this.entityIds[0]===q[0]?0:1,$e=this.data.featureTypes[pe],nt=this.data.featureTypes[pe===0?1:0],lt=[];if(X&&lt.push(A({})),N&&lt.push(A(N)),F)lt.push(new Te({icon:"rapid-icon-layers",title:r.t("issues.fix.use_different_levels.title")}));else if(j||U||P==="building"||D==="building")lt.push(k("higher")),lt.push(k("lower"));else if(Q.geometry(this.entityIds[0])==="line"&&Q.geometry(this.entityIds[1])==="line"){o.has($e)&&$e!=="waterway"&&lt.push(_("add_a_bridge","temaki-bridge","bridge"));let Yt=nt==="waterway"&&$e!=="waterway";a.has($e)&&!Yt&&lt.push(_("add_a_tunnel","temaki-tunnel","tunnel"))}return lt.push(new Te({icon:"rapid-operation-move",title:r.t("issues.fix.reposition_features.title")})),lt}});function Z(Q){Q.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t(`issues.crossing_ways.${oe}.reference`))}}function _(v,E,S){return new Te({icon:E,title:r.t(`issues.fix.${v}.title`),onClick:function(){var B;if(((B=i.mode)==null?void 0:B.id)!=="select-osm")return;let M=i.selectedIDs();if(M.length!==1)return;let I=M[0];if(!t.staging.graph.hasEntity(I))return;let C=[I],P,D,O;this.issue.entityIds[0]===I?(P=this.issue.data.edges[0],D=this.issue.data.edges[1],O=this.issue.entityIds[1]):(P=this.issue.data.edges[1],D=this.issue.data.edges[0],O=this.issue.entityIds[0]);let R=this.issue.loc,N=i.projection,F=$=>{let U=[$.entity(P[0]),$.entity(P[1])],H=$.hasEntity(O),z=H&&H.tags.width&&parseFloat(H.tags.width);z||(z=H&&H.impliedLineWidthMeters()),z?m(H,$)==="railway"&&(z*=2):z=8;let j=$t(N.project(U[0].loc),N.project(U[1].loc))+Math.PI,X=$t(N.project($.entity(D[0]).loc),N.project($.entity(D[1]).loc))+Math.PI,K=Math.max(j,X)-Math.min(j,X);K>Math.PI&&(K-=Math.PI),z=z/2/Math.sin(K)*2,z+=4,z=Math.min(Math.max(z,4),50);function Y(Ve){return[e2(Ve[0],Ve[1]),e9(Ve[1])]}function oe(Ve){let It=gn(Ve[1]);return[ki(Ve[0],It),It]}let re=Y(U[0].loc),W=Y(U[1].loc),Z=$t(re,W),Q=Y(R),q=Ue(re,W)/at(U[0].loc,U[1].loc);function pe(Ve,It){let Fs=It*q;return oe([Q[0]+Math.cos(Ve)*Fs,Q[1]+Math.sin(Ve)*Fs])}let $e=function(Ve){return pe(Z,Ve)},nt=function(Ve){return pe(Z+Math.PI,Ve)},lt=.55;function Tt(Ve,It,Fs){let Vr,Mo=z/2,cs=at(R,It.loc);if(cs-Mo>lt){let Wr=Fs(Mo);Vr=Be(),$=yi({loc:Wr,edge:Ve},Vr)($)}else{let Wr=0;if(It.parentIntersectionWays($).forEach(function(ji){ji.nodes.forEach(function(Ls){Ls===It.id&&(It.id===ji.first()&&It.id!==ji.last()||It.id===ji.last()&&It.id!==ji.first()?Wr+=1:Wr+=2)})}),Wr>=3){let ji=cs-lt;if(ji>lt){let Ls=Fs(ji);Vr=Be(),$=yi({loc:Ls,edge:Ve},Vr)($)}}}Vr||(Vr=It);let ka=io([Vr.id]).limitWays(C);return $=ka($),ka.getCreatedWayIDs().length&&C.push(ka.getCreatedWayIDs()[0]),Vr}let Yt=Tt(P,U[1],$e),zi=Tt([U[0].id,Yt.id],U[0],nt),oi=C.map(Ve=>$.entity(Ve)).find(Ve=>Ve.nodes.includes(Yt.id)&&Ve.nodes.includes(zi.id)),mt=Object.assign({},oi.tags);if(S==="bridge")mt.bridge="yes",mt.layer="1";else{let Ve=m(oi,$);mt.tunnel=Ve==="waterway"?"culvert":"yes",mt.layer="-1"}return $=vt(oi.id,mt)($),$};t.perform(F),t.commit({annotation:r.t(`issues.fix.${v}.annotation`),selectedIDs:[I]}),i.enter("select-osm",{selection:{osm:C}})}})}function w(v,E,S,M){return[T=>{let C=Be({loc:v,tags:M});T=T.replace(C);let P=[C.id],D=.75;for(let O of E){let R=T.hasEntity(O[0]),N=T.hasEntity(O[1]);if(!R||!N)continue;let F=!1,B=[R,N],$=S5([R.loc,N.loc],v);if($&&$.distance<D){let U=B[$.index];(!U.hasInterestingTags()||U.isCrossing())&&(F=!0,P.push(U.id))}F||(T=yi({loc:v,edge:O},C)(T))}return P.length>1&&(T=Nr(P,v)(T)),S&&(T=Vs(S)(T)),T},r.t("issues.fix.connect_crossing_features.annotation")]}function A(v){let E="connect_features",S="rapid-icon-connect";return v.ford?E="connect_using_ford":v.highway==="crossing"&&(E="connect_using_crossing",S="temaki-pedestrian"),new Te({icon:S,title:r.t(`issues.fix.${E}.title`),onClick:function(){let M=this.issue.loc,I=this.issue.data.edges,T=this.issue.data.crossingWayID,C=w(M,I,T,v);t.perform(C[0]),t.commit({annotation:C[1],selectedIDs:this.issue.entityIds})}})}function k(v){return new Te({icon:"rapid-icon-"+(v==="higher"?"up":"down"),title:r.t(`issues.fix.tag_this_as_${v}.title`),onClick:function(){var P;if(((P=i.mode)==null?void 0:P.id)!=="select-osm")return;let E=i.selectedIDs();if(E.length!==1)return;let S=E[0];if(!this.issue.entityIds.some(D=>D===S))return;let I=t.staging.graph.hasEntity(S);if(!I)return;let T=Object.assign({},I.tags),C=T.layer&&Number(T.layer);C&&!isNaN(C)?v==="higher"?C+=1:C-=1:v==="higher"?C=1:C=-1,T.layer=C.toString(),t.perform(vt(I.id,T)),t.commit({annotation:r.t("operations.change_tags.annotation"),selectedIDs:[S]})}})}return d.type=e,d}function _g(i){let e="disconnected_way",t=i.systems.editor,r=i.systems.l10n,s=i.systems.map;function n(a){return ds[a.tags.highway]}let o=function(l,c){let u=f(l);if(!u)return[];return[new Ye(i,{type:e,subtype:"highway",severity:"warning",message:function(){let x=t.staging.graph,b=this.entityIds.length&&x.hasEntity(this.entityIds[0]),_=b&&r.displayLabel(b,x);return r.t("issues.disconnected_way.routable.message",{count:this.entityIds.length,highway:_})},reference:d,entityIds:Array.from(u).map(x=>x.id),dynamicFixes:h})];function h(){let x=t.staging.graph,b=this.entityIds.length===1&&x.hasEntity(this.entityIds[0]),_=[];if(b){if(b.type==="way"&&!b.isClosed()){let w=y(b.first(),"start");w&&_.push(w);let A=y(b.last(),"end");A&&_.push(A)}_.length||_.push(new Te({title:r.t("issues.fix.connect_feature.title")})),_.push(new Te({icon:"rapid-operation-delete",title:r.t("issues.fix.delete_feature.title"),entityIds:[b.id],onClick:function(){let w=this.issue.entityIds[0],A=ns(i,[w]);A.disabled()||A()}}))}else _.push(new Te({title:r.t("issues.fix.connect_features.title")}));return _}function d(x){x.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.disconnected_way.routable.reference"))}function f(x){let b=new Set,_=[];function w(A){for(let k of c.parentWays(A))!b.has(k)&&g(k,!1)&&(b.add(k),_.push(k))}if(x.type==="way"&&g(x,!0))b.add(x),_.push(x);else if(x.type==="node"&&m(x))b.add(x),w(x);else return null;for(;_.length;){let A=_.pop();for(let k of c.childNodes(A)){if(p(k))return null;m(k)&&b.add(k),w(k)}}return b}function p(x){let b=i.services.osm;return!!(b&&!b.isDataLoaded(x.loc)||x.tags.entrance&&x.tags.entrance!=="no"||x.tags.amenity==="parking_entrance")}function m(x){return x.tags.highway==="elevator"}function g(x,b){return n(x)||x.tags.route==="ferry"?!0:c.parentRelations(x).some(_=>!!(_.tags.type==="route"&&_.tags.route==="ferry"||_.isMultipolygon()&&n(_)&&(!b||_.memberById(x.id).role!=="inner")))}function y(x,b){let _=c.hasEntity(x);if(!_||_.tags.noexit==="yes")return null;let w=r.isRTL(),A=b==="start"&&!w||b==="end"&&w;return new Te({icon:"rapid-operation-continue"+(A?"-left":""),title:r.t(`issues.fix.continue_from_${b}.title`),entityIds:[x],onClick:function(){let k=t.staging.graph,v=this.issue.entityIds[0],E=k.hasEntity(v),S=this.entityIds[0],M=k.hasEntity(S);!E||!M||((!i.editable()||!s.trimmedExtent().contains(new ie(M.loc)))&&s.fitEntitiesEase(M),i.enter("draw-line",{continueWayID:E.id,continueNodeID:M.id}))}})}};return o.type=e,o}function bg(i){let e="duplicate_way_segments",t=i.systems.editor,r=i.systems.l10n,s=function(n,o){if(n.type==="way")return u(n);return[];function a(d){return d==="highway"||d==="railway"||d==="waterway"}function l(d){return d.isArea()?!1:Object.keys(d.tags).some(a)}function c(d,f,p){let m=o.childNodes(p),g=m.findIndex(x=>x.id===d.id),y=m.findIndex(x=>x.id===f.id);return Math.abs(g-y)===1}function u(d){let f=[];if(!l(d))return f;let p=o.childNodes(d);for(let m=0;m<p.length-1;m++){let g=p[m],y=p[m+1],x=h(g,y,d);x&&f.push(x)}return f}function h(d,f,p){if(d.id===f.id)return null;if(d.loc!==f.loc){let g=o.parentWays(d),y=new Set(o.parentWays(f));if(g.filter(w=>y.has(w)).filter(w=>l(w)).filter(w=>c(d,f,w)).length<=1)return null}return new Ye(i,{type:e,subtype:"vertices",severity:"warning",message:function(){let g=t.staging.graph,y=g.hasEntity(this.entityIds[0]);return y?r.t("issues.duplicate_way_segments.message",{way:r.displayLabel(y,g)}):""},reference:m,entityIds:[p.id,d.id,f.id],loc:d.loc,dynamicFixes:()=>[new Te({icon:"rapid-icon-plus",title:r.t("issues.fix.merge_points.title")}),new Te({icon:"rapid-operation-delete",title:r.t("issues.fix.remove_way_segments.title")}),new Te({icon:"rapid-operation-disconnect",title:r.t("issues.fix.move_way_segments_apart.title")})]});function m(g){g.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.duplicate_way_segments.reference"))}}};return s.type=e,s}function wg(i){let e="invalid_format",t=i.systems.editor,r=i.systems.l10n,s=function(n){let o=[];function a(c){return!c||/^[^\(\)\\,":;<>@\[\]]+@[^\(\)\\,":;<>@\[\]\.]+(?:\.[a-z0-9-]+)*$/i.test(c)}function l(c){c.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.invalid_format.email.reference"))}if(n.tags.email){let c=n.tags.email.split(";").map(u=>u.trim()).filter(u=>!a(u));c.length&&o.push(new Ye(i,{type:e,subtype:"email",severity:"warning",message:function(){let u=t.staging.graph,h=u.hasEntity(this.entityIds[0]);return h?r.t("issues.invalid_format.email.message"+this.data,{feature:r.displayLabel(h,u),email:c.join(", ")}):""},reference:l,entityIds:[n.id],hash:c.join(),data:c.length>1?"_multi":""}))}return o};return s.type=e,s}function Eg(i){let e="help_request",t=i.systems.editor,r=i.systems.l10n,s=function(o){if(!o.tags.fixme)return[];if(o.version===void 0)return[];if(o.v!==void 0){let l=t.base.graph.hasEntity(o.id);if(!l||!l.tags.fixme)return[]}return[new Ye(i,{type:e,subtype:"fixme_tag",severity:"warning",message:function(){let l=t.staging.graph,c=l.hasEntity(this.entityIds[0]);return c?r.t("issues.fixme_tag.message",{feature:r.displayLabel(c,l,!0)}):""},dynamicFixes:()=>[new Te({title:r.t("issues.fix.address_the_concern.title")})],reference:a,entityIds:[o.id]})];function a(l){l.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.fixme_tag.reference"))}};return s.type=e,s}function Ag(i){let e="impossible_oneway",t=i.systems.editor,r=i.systems.l10n,s=function(a,l){if(a.type!=="way"||a.geometry(l)!=="line")return[];if(a.isClosed())return[];if(!h(a))return[];if(!a.isOneWay())return[];if(a.tags.oneway==="alternating"||a.tags.oneway==="reversible"||a.tags.intermittent==="yes")return[];let c=p(a,a.first()),u=p(a,a.last());return c.concat(u);function h(m){return m.geometry(l)!=="line"?null:ds[m.tags.highway]?"highway":Ol[m.tags.waterway]?"waterway":null}function d(m,g){return m.nodes.indexOf(g)!==m.nodes.lastIndexOf(g)}function f(m,g,y){let x=h(m);if(x==="highway"){if(g.tags.entrance&&g.tags.entrance!=="no"||g.tags.amenity==="parking_entrance")return!0}else if(x==="waterway"){if(y){if(g.tags.natural==="spring")return!0}else if(g.tags.manhole==="drain")return!0}return l.parentWays(g).some(b=>b.id===m.id?!1:x==="highway"?b.geometry(l)==="area"&&ds[b.tags.highway]||b.tags.route==="ferry"?!0:l.parentRelations(b).some(_=>_.tags.type==="route"&&_.tags.route==="ferry"?!0:_.isMultipolygon()&&ds[_.tags.highway]):x==="waterway"&&(b.tags.natural==="water"||b.tags.natural==="coastline"))}function p(m,g){let y=g===m.first()&&m.tags.oneway!=="-1",x=!y,b=h(m);if(d(m,g))return[];let _=i.services.osm;if(!_)return[];let w=l.hasEntity(g);if(!w||!_.isDataLoaded(w.loc))return[];if(f(m,w,y))return[];let A=l.parentWays(w).filter(I=>I.id===m.id?!1:h(I)===b);if(b==="waterway"&&A.length===0)return[];let k=A.filter(I=>I.isOneWay());if(k.length<A.length)return[];for(let I of k){if(d(I,g))return[];let T=I.tags.oneway==="-1"?I.last():I.first(),C=I.tags.oneway==="-1"?I.first():I.last();if(y&&g!==T||x&&g!==C)return[]}let v=y?"start":"end",E,S;return b==="waterway"?(E=`${b}.connected.${v}`,S=`${b}.connected`):(E=`${b}.${v}`,S=`${b}.${v}`),[new Ye(i,{type:e,subtype:b,severity:"warning",message:function(){let I=t.staging.graph,T=I.hasEntity(this.entityIds[0]);return T?r.t(`issues.impossible_oneway.${E}.message`,{feature:r.displayLabel(T,I)}):""},reference:M(S),entityIds:[m.id,w.id],dynamicFixes:function(){let I=t.staging.graph,T=[];if(k.length&&T.push(new Te({icon:"rapid-operation-reverse",title:r.t("issues.fix.reverse_feature.title"),entityIds:[m.id],onClick:function(){let C=this.issue.entityIds[0];t.perform(hs(C)),t.commit({annotation:r.t("operations.reverse.annotation.line",{n:1}),selectedIDs:[C]})}})),w.tags.noexit!=="yes"){let C=r.isRTL(),P=y&&!C||!y&&C;T.push(new Te({icon:"rapid-operation-continue"+(P?"-left":""),title:r.t("issues.fix.continue_from_"+(y?"start":"end")+".title"),onClick:function(){let D=this.issue.entityIds[0],O=this.issue.entityIds[1],R=I.entity(D),N=I.entity(O);n(R,N,i)}}))}return T},loc:w.loc})];function M(I){return function(C){C.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t(`issues.impossible_oneway.${I}.reference`))}}}};function n(o,a,l){let c=l.systems.map;(!l.editable()||!c.trimmedExtent().contains(new ie(a.loc)))&&c.fitEntitiesEase(a),l.enter("draw-line",{continueWayID:o.id,continueNodeID:a.id})}return s.type=e,s}function Sg(i){let e="incompatible_source",t=i.systems.editor,r=i.systems.l10n,s=[{id:"amap",regex:/(amap|autonavi|mapabc|)/i},{id:"baidu",regex:/(baidu|mapbar|)/i},{id:"google",regex:/google/i,exceptRegex:/((books|drive)\.google|google\s?(books|drive|plus))|(esri\/google)/i}],n=function(a){var h;let l=((h=a.tags)==null?void 0:h.source)&&a.tags.source.split(";");if(!l)return[];let c=a.id;return l.map(d=>{let f=s.find(p=>!(!p.regex.test(d)||p.exceptRegex&&p.exceptRegex.test(d)));return f?new Ye(i,{type:e,severity:"warning",message:()=>{let p=t.staging.graph,m=p.hasEntity(c);return m?r.t("issues.incompatible_source.feature.message",{feature:r.displayLabel(m,p,!0),value:d}):""},reference:u(f.id),entityIds:[c],hash:d,dynamicFixes:()=>[new Te({title:r.t("issues.fix.remove_proprietary_data.title")})]}):null}).filter(Boolean);function u(d){return function(p){p.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t(`issues.incompatible_source.reference.${d}`))}}};return n.type=e,n}var uT=et(f1(),1);function Cg(i){let e="mismatched_geometry",t=i.systems.editor,r=i.systems.l10n,s=i.systems.presets;function n(p){if(p.type!=="way"||p.isClosed())return null;let m=p.tagSuggestingArea();if(!m)return null;let g=s.matchTags(m,"line"),y=s.matchTags(m,"area");if(g&&y){if(g===y)return null;let x=Object.keys(m)[0];if(g.tags[x]==="*"||y.tags[x==="*"])return null}return m}function o(p,m){if(p.nodes.length<3)return null;var g=m.childNodes(p),y,x=at(g[0].loc,g[g.length-1].loc);if(x<.75&&(y=g.slice(),y.pop(),y.push(y[0]),!Ha(y,y[0].id)))return function(){let _=t.staging.graph.entity(this.issue.entityIds[0]);t.perform(Nr([_.nodes[0],_.nodes[_.nodes.length-1]],g[0].loc)),t.commit({annotation:r.t("issues.fix.connect_endpoints.annotation"),selectedIDs:[_.id]})};if(y=g.slice(),y.push(y[0]),!Ha(y,y[0].id))return function(){let b=this.issue.entityIds[0],w=t.staging.graph.entity(b),A=w.nodes[0],k=w.nodes.length;t.perform(xs(b,A,k)),t.commit({annotation:r.t("issues.fix.connect_endpoints.annotation"),selectedIDs:[b]})}}function a(p){var m=n(p);if(!m)return null;return new Ye(i,{type:e,subtype:"area_as_line",severity:"warning",message:function(){let x=t.staging.graph.hasEntity(this.entityIds[0]);return x?r.t("issues.tag_suggests_area.message",{feature:r.displayLabel(x,"area",!0),tag:Sy({tags:m})}):""},reference:g,entityIds:[p.id],hash:JSON.stringify(m),dynamicFixes:function(){let y=t.staging.graph;var x=[],b=y.entity(this.entityIds[0]),_=o(b,y);return x.push(new Te({title:r.t("issues.fix.connect_endpoints.title"),onClick:_})),x.push(new Te({icon:"rapid-operation-delete",title:r.t("issues.fix.remove_tag.title"),onClick:function(){let w=this.issue.entityIds[0],k=t.staging.graph.entity(w),v=Object.assign({},k.tags);for(var E in m)delete v[E];t.perform(vt(w,v)),t.commit({annotation:r.t("issues.fix.remove_tag.annotation"),selectedIDs:[w]})}})),x}});function g(y){y.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.tag_suggests_area.reference"))}}function l(p,m){if(p.type!=="node"||Object.keys(p.tags).length===0||p.isOnAddressLine(m))return null;var g=p.geometry(m),y=Ro(p.tags);return g==="point"&&!y.point&&y.vertex?new Ye(i,{type:e,subtype:"vertex_as_point",severity:"warning",message:function(){let b=t.staging.graph.hasEntity(this.entityIds[0]);return b?r.t("issues.vertex_as_point.message",{feature:r.displayLabel(b,"vertex",!0)}):""},reference:function(b){b.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.vertex_as_point.reference"))},entityIds:[p.id]}):g==="vertex"&&!y.vertex&&y.point?new Ye(i,{type:e,subtype:"point_as_vertex",severity:"warning",message:function(){let b=t.staging.graph.hasEntity(this.entityIds[0]);return b?r.t("issues.point_as_vertex.message",{feature:r.displayLabel(b,"point",!0)}):""},reference:function(b){b.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.point_as_vertex.reference"))},entityIds:[p.id],dynamicFixes:h}):null}function c(p,m){if(!p.hasInterestingTags()||p.type!=="node"&&p.type!=="way"||p.type==="node"&&p.isOnAddressLine(m))return null;var g=p.geometry(m),y=p.type==="way"?["point","vertex"]:["line","area"];g==="area"&&y.unshift("line");var x=s.match(p,m),b=y.find(k=>{var v=s.matchTags(p.tags,k);if(!x||!v||x===v||(0,uT.default)(x.tags,v.tags)||v.isFallback())return!1;var E=Object.keys(v.tags)[0];return E==="building"||v.tags[E]==="*"?!1:x.isFallback()||x.tags[E]==="*"});if(!b)return null;var _=b+"_as_"+g;b==="vertex"&&(b="point"),g==="vertex"&&(g="point");var w=b+"_as_"+g,A;return b==="point"?A=h:g==="area"&&b==="line"&&(A=u),new Ye(i,{type:e,subtype:_,severity:"warning",message:function(){let v=t.staging.graph.hasEntity(this.entityIds[0]);return v?r.t("issues."+w+".message",{feature:r.displayLabel(v,b,!0)}):""},reference:function(v){v.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.mismatched_geometry.reference"))},entityIds:[p.id],dynamicFixes:A})}function u(){let p=null,m=this.entityIds[0],y=t.staging.graph.entity(m),x=Object.assign({},y.tags);return delete x.area,Do(x)||(p=function(){let b=this.issue.entityIds[0],w=t.staging.graph.entity(b),A=Object.assign({},w.tags);A.area&&delete A.area,t.perform(vt(b,A)),t.commit({annotation:r.t("issues.fix.convert_to_line.annotation"),selectedIDs:[b]})}),[new Te({icon:"rapid-icon-line",title:r.t("issues.fix.convert_to_line.title"),onClick:p})]}function h(){let p=null,m=this.entityIds[0];return i.hasHiddenConnections(m)||(p=function(){let g=this.issue.entityIds[0],y=h1(g,i.projection);t.perform(y),t.commit({annotation:r.t("operations.extract.annotation",{n:1}),selectedIDs:[g]}),i.enter("select-osm",{selection:{osm:[y.getExtractedNodeID()]}})}),[new Te({icon:"rapid-operation-extract",title:r.t("issues.fix.extract_point.title"),onClick:p})]}function d(p,m){if(p.type!=="relation"||!p.isMultipolygon()||p.isDegenerate()||!p.isComplete(m))return[];var g=Rr(p.members,m),y=[];for(var x in g){var b=g[x];if(b.nodes){var _=b.nodes[0],w=b.nodes[b.nodes.length-1];if(_!==w){var A=new Ye(i,{type:e,subtype:"unclosed_multipolygon_part",severity:"warning",message:function(){let v=t.staging.graph,E=v.hasEntity(this.entityIds[0]);return E?r.t("issues.unclosed_multipolygon_part.message",{feature:r.displayLabel(E,v,!0)}):""},reference:k,loc:b.nodes[0].loc,entityIds:[p.id],hash:b.map(function(v){return v.id}).join()});y.push(A)}}}return y;function k(v){v.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.unclosed_multipolygon_part.reference"))}}var f=function(m,g){var y=l(m,g);if(y)return[y];var x=a(m);if(x)return[x];var b=c(m,g);return b?[b]:d(m,g)};return f.type=e,f}function kg(i){let e="missing_role",t=i.systems.editor,r=i.systems.l10n,s=function(c,u){let h=[];if(c.type==="way")for(let d of u.parentRelations(c)){if(!d.isMultipolygon())continue;let f=d.memberById(c.id);f&&n(f)&&h.push(o(c,d,f))}else if(c.type==="relation"&&c.isMultipolygon())for(let d of c.indexedMembers()){let f=u.hasEntity(d.id);f&&n(d)&&h.push(o(f,c,d))}return h};function n(l){return!l.role||!l.role.trim().length}function o(l,c,u){return new Ye(i,{type:e,severity:"warning",message:function(){let d=t.staging.graph,f=d.hasEntity(this.entityIds[1]),p=d.hasEntity(this.entityIds[0]);return f&&p?r.t("issues.missing_role.message",{member:r.displayLabel(f,d),relation:r.displayLabel(p,d)}):""},reference:h,entityIds:[c.id,l.id],data:{member:u},hash:u.index.toString(),dynamicFixes:function(){return[a("inner"),a("outer"),new Te({icon:"rapid-operation-delete",title:r.t("issues.fix.remove_from_relation.title"),onClick:()=>{let d=this.issue.entityIds[0];t.perform(Wo(d,this.issue.data.member.index)),t.commit({annotation:r.t("operations.delete_member.annotation",{n:1}),selectedIDs:[d]})}})]}});function h(d){d.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.missing_role.multipolygon.reference"))}}function a(l){return new Te({title:r.t(`issues.fix.set_as_${l}.title`),onClick:()=>{let c=this.issue.data.member,u={id:this.issue.entityIds[1],type:c.type,role:l};t.perform(Vo(this.issue.entityIds[0],u,c.index)),t.commit({annotation:r.t("operations.change_role.annotation",{n:1}),selectedIDs:[u.id]})}})}return s.type=e,s}function Tg(i){let e="missing_tag",t=i.systems.editor,r=i.systems.l10n;function s(l,c){let u=["description","name","note","start_date"],h=Object.keys(l.tags).filter(d=>d==="area"||!lr(d)?!1:!u.some(f=>d===f||d.indexOf(f+":")===0));return l.type==="relation"&&h.length===1&&l.tags.type==="multipolygon"?l1(l,c):h.length>0}function n(l){return l.type==="way"&&l.tags.highway==="road"}function o(l){return l.type==="relation"&&!l.tags.type}let a=function(c,u){let h=i.services.osm,d=c.type==="node"&&h&&!h.isDataLoaded(c.loc),f;if(!d&&c.geometry(u)!=="vertex"&&!c.hasParentRelations(u)&&(Object.keys(c.tags).length===0?f="any":s(c,u)?o(c)&&(f="relation_type"):f="descriptive"),!f&&n(c)&&(f="highway_classification"),!f)return[];let p=f==="highway_classification"?"unknown_road":`missing_tag.${f}`,m=f==="highway_classification"?"unknown_road":"missing_tag",y=(c.version===void 0||c.v!==void 0)&&f!=="highway_classification"?"error":"warning";return[new Ye(i,{type:e,subtype:f,severity:y,message:function(){let b=t.staging.graph,_=b.hasEntity(this.entityIds[0]);return _?r.t(`issues.${p}.message`,{feature:r.displayLabel(_,b)}):""},reference:x,entityIds:[c.id],dynamicFixes:function(){let b=[],_=f==="highway_classification"?"select_road_type":"select_preset";b.push(new Te({icon:"rapid-icon-search",title:r.t(`issues.fix.${_}.title`),onClick:function(){i.systems.ui.sidebar.showPresetList()}}));let w=this.entityIds[0],k=ns(i,[w]).disabled(),v;return k||(v=function(){let E=this.issue.entityIds[0],S=ns(i,[E]);S.disabled()||S()}),b.push(new Te({icon:"rapid-operation-delete",title:r.t("issues.fix.delete_feature.title"),disabledReason:k?r.t(`operations.delete.${k}.single`):void 0,onClick:v})),b}})];function x(b){b.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t(`issues.${m}.reference`))}};return a.type=e,a}var nG=new Set(["path","footway","cycleway","bridleway","pedestrian"]);function Ig(i){let e="outdated_tags",t=i.systems.dataloader,r=i.systems.editor,s=i.systems.l10n,n=i.systems.presets,o=!0,a;t.getDataAsync("deprecated").then(d=>a=d).catch(()=>{}).finally(()=>o=!1);function l(d){for(let f of nG)if(d.highway===f&&d[f]==="crossing")return!0;return!1}function c(d,f){if(!d.hasInterestingTags())return[];let p=n.match(d,f);if(!p)return[];if(/crossing/.test(p.id)){if(d.type==="way")return[];if(d.type==="node"){let C=i.services.osm;if(C&&!C.isDataLoaded(d.loc))return[];if(f.parentWays(d).some(O=>l(O.tags)))return[]}}let m=Object.assign({},d.tags),g="deprecated_tags";if(p.replacement){let C=n.item(p.replacement);f=xr(d.id,p,C,!0)(f),d=f.entity(d.id),p=C}if(a){let C=d.deprecatedTags(a);for(let P of C)f=j5(d.id,P.old,P.replace)(f),d=f.entity(d.id)}let y=Object.assign({},d.tags);if(p.tags!==p.addTags)for(let[C,P]of Object.entries(p.addTags))y[C]||(P==="*"?y[C]="yes":y[C]=P);let x=i.services.nsi,b=!1,_;if(x&&(b=x.status==="loading",!b)){let C=d.extent(f).center();_=x.upgradeTags(y,C),_&&(y=_.newTags,g="noncanonical_brand")}let w=[];w.provisional=o||b;let A=jn(m,y);if(!A.length)return w;let k=A.every(C=>C.type==="+"),v="";_?v="noncanonical_brand.":g==="deprecated_tags"&&k&&(g="incomplete_tags",v="incomplete.");let E=null;return g!=="noncanonical_brand"&&(E=[S,s.t("issues.fix.upgrade_tags.annotation")]),w.push(new Ye(i,{type:e,subtype:g,severity:"warning",message:I,reference:T,entityIds:[d.id],hash:g0(JSON.stringify(A)),autoArgs:E,dynamicFixes:()=>{let C=[new Te({title:s.t("issues.fix.upgrade_tags.title"),onClick:()=>{r.perform(S),r.commit({annotation:s.t("issues.fix.upgrade_tags.annotation"),selectedIDs:[d.id]})}})],P=_==null?void 0:_.matched;return P&&C.push(new Te({title:s.t("issues.fix.tag_as_not.title",{name:P.displayName}),onClick:()=>{r.perform(M),r.commit({annotation:s.t("issues.fix.tag_as_not.annotation"),selectedIDs:[d.id]})}})),C}})),w;function S(C){let P=C.hasEntity(d.id);if(!P)return C;let D=Object.assign({},P.tags);for(let O of A)O.type==="-"?delete D[O.key]:O.type==="+"&&(D[O.key]=O.newVal);return vt(P.id,D)(C)}function M(C){let P=C.hasEntity(d.id);if(!P)return C;let D=_==null?void 0:_.matched;if(!D)return C;let O=Object.assign({},P.tags),R=D.mainTag,N=`not:${R}`,F=D.tags[R];if(O[N]=F,O[R]===F){let B=D.mainTag.replace("wikidata","wikipedia");delete O[R],delete O[B]}return vt(P.id,O)(C)}function I(){let C=r.staging.graph,P=C.hasEntity(d.id);if(!P)return"";let D=`issues.outdated_tags.${v}message`;return g==="noncanonical_brand"&&k&&(D+="_incomplete"),s.t(D,{feature:s.displayLabel(P,C,!0)})}function T(C){let P=C.selectAll(".issue-reference").data([0]).enter();P.append("div").attr("class","issue-reference").text(s.t(`issues.outdated_tags.${v}reference`)),P.append("strong").text(s.t("issues.suggested")),P.append("table").attr("class","tagDiff-table").selectAll(".tagDiff-row").data(A).enter().append("tr").attr("class","tagDiff-row").append("td").attr("class",D=>`tagDiff-cell tagDiff-cell-${D.type==="+"?"add":"remove"}`).text(D=>D.display)}}function u(d,f){let p,m;if(d.type==="relation")m=l1(d,f),p=d;else if(d.type==="way")p=c1(d,f),m=d;else return[];if(!p||!m)return[];return[new Ye(i,{type:e,subtype:"old_multipolygon",severity:"warning",message:y,reference:x,entityIds:[m.id,p.id],autoArgs:[g,s.t("issues.fix.move_tags.annotation")],dynamicFixes:()=>[new Te({title:s.t("issues.fix.move_tags.title"),onClick:()=>{r.perform(g),r.commit({annotation:s.t("issues.fix.move_tags.annotation"),selectedIDs:[d.id]})}})]})];function g(b){let _=b.hasEntity(p.id),w=b.hasEntity(m.id);return!_||!w?b:(_=_.mergeTags(w.tags),b=b.replace(_),vt(w.id,{})(b))}function y(){let b=r.staging.graph,_=b.hasEntity(p.id);return _?s.t("issues.old_multipolygon.message",{multipolygon:s.displayLabel(_,b,!0)}):""}function x(b){b.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(s.t("issues.old_multipolygon.reference"))}}let h=function(f,p){let m=u(f,p);return m.length||(m=c(f,p)),m};return h.type=e,h}function Mg(i){let e="private_data",t=i.systems.editor,r=i.systems.l10n,s=new Set(["detached","farm","house","houseboat","residential","semidetached_house","static_caravan"]),n=new Set(["amenity","craft","historic","leisure","office","shop","tourism"]),o=new Set(["contact:email","contact:fax","contact:phone","email","fax","phone"]),a=function(c){let u=c.tags;if(!u.building||!s.has(u.building))return[];let h={};for(let[y,x]of Object.entries(u)){if(n.has(y))return[];o.has(y)||(h[y]=x)}let d=jn(u,h);if(!d.length)return[];let f=d.length===1?"remove_tag":"remove_tags";return[new Ye(i,{type:e,severity:"warning",message:m,reference:g,entityIds:[c.id],dynamicFixes:()=>[new Te({icon:"rapid-operation-delete",title:r.t(`issues.fix.${f}.title`),onClick:()=>{t.perform(p),t.commit({annotation:r.t("issues.fix.upgrade_tags.annotation"),selectedIDs:[c.id]})}})]})];function p(y){let x=y.hasEntity(c.id);if(!x)return y;let b=Object.assign({},x.tags);for(let _ of d)_.type==="-"?delete b[_.key]:_.type==="+"&&(b[_.key]=_.newVal);return vt(x.id,b)(y)}function m(){let y=t.staging.graph,x=y.hasEntity(this.entityIds[0]);return x?r.t("issues.private_data.contact.message",{feature:r.displayLabel(x,y)}):""}function g(y){let x=y.selectAll(".issue-reference").data([0]).enter();x.append("div").attr("class","issue-reference").text(r.t("issues.private_data.reference")),x.append("strong").text(r.t("issues.suggested")),x.append("table").attr("class","tagDiff-table").selectAll(".tagDiff-row").data(d).enter().append("tr").attr("class","tagDiff-row").append("td").attr("class",b=>`tagDiff-cell tagDiff-cell-${b.type==="+"?"add":"remove"}`).text(b=>b.display)}};return a.type=e,a}var Wg={};g3(Wg,{operationCircularize:()=>Pg,operationContinue:()=>Dg,operationCopy:()=>Ng,operationCycleHighwayTag:()=>Rg,operationDelete:()=>ns,operationDisconnect:()=>Fg,operationDowngrade:()=>Lg,operationExtract:()=>Og,operationMerge:()=>Bg,operationMove:()=>Mu,operationOrthogonalize:()=>Ug,operationPaste:()=>Pu,operationReflectLong:()=>Hg,operationReflectShort:()=>$g,operationReverse:()=>Gg,operationRotate:()=>zg,operationSplit:()=>jg,operationStraighten:()=>Vg});function Pg(i,e){let t=i.systems.editor,r=t.staging.graph,s=i.systems.l10n,n=i.systems.map,o=i.systems.storage,a=e.length===1?"single":"multiple",l=e.map(m=>r.hasEntity(m)).filter(Boolean),c=l.every(m=>m.isNew()),u=ft(l,r),h=l.map(f).filter(Boolean),d=Ft(e,r).map(m=>m.loc);function f(m){return m.type!=="way"||new Set(m.nodes).size<=1?null:P5(m.id,i.projection)}let p=function(){if(!h.length)return;let m=(y,x)=>{for(let b of h)b.disabled(y)||(y=b(y,x));return y};m.transitionable=!0;let g=p.annotation();t.performAsync(m).then(()=>t.commit({annotation:g,selectedIDs:e}))};return p.available=function(){return h.length&&e.length===h.length},p.disabled=function(){if(!h.length)return"";let m=t.staging.graph,g=h.map(b=>b.disabled(m)).filter(Boolean);if(g.length===h.length)return new Set(g).size>1?"multiple_blockers":g[0];if(!c&&y())return"too_large";if(!c&&x())return"not_downloaded";if(e.some(i.hasHiddenConnections))return"connected_to_hidden";return!1;function y(){return!(o.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&u.percentContainedIn(n.extent())<.8}function x(){if(i.inIntro)return!1;let b=i.services.osm;if(b){let _=d.filter(w=>!b.isDataLoaded(w));if(_.length)return _.forEach(w=>i.loadTileAtLoc(w)),!0}return!1}},p.tooltip=function(){let m=p.disabled();return m?s.t(`operations.circularize.${m}.${a}`):s.t(`operations.circularize.description.${a}`)},p.annotation=function(){return s.t("operations.circularize.annotation.feature",{n:h.length})},p.id="circularize",p.keys=[s.t("operations.circularize.key")],p.title=s.t("operations.circularize.title"),p.behavior=new ht(i,p),p}function Dg(i,e){let t=i.systems.editor.staging.graph,r=i.systems.filters,s=i.systems.l10n,n=e.map(h=>t.hasEntity(h)).filter(Boolean),o=Object.assign({line:[],vertex:[]},Ut(n,h=>h.geometry(t))),a=o.vertex.length===1&&o.vertex[0],l=c();function c(){return a?t.parentWays(a).filter(h=>h.geometry(t)==="line"&&!h.isClosed()&&h.affix(a.id)&&(o.line.length===0||o.line[0]===h)):[]}let u=function(){l.length&&i.enter("draw-line",{continueWayID:l[0].id,continueNodeID:a.id})};return u.relatedEntityIds=function(){return l.length?[l[0].id]:[]},u.available=function(){let h=i.systems.editor.staging.graph;return o.vertex.length===1&&o.line.length<=1&&!r.hasHiddenConnections(a,h)},u.disabled=function(){return l.length===0?"not_eligible":l.length>1?"multiple":!1},u.tooltip=function(){let h=u.disabled();return h?s.t(`operations.continue.${h}`):s.t("operations.continue.description")},u.annotation=function(){return s.t("operations.continue.annotation.line")},u.id="continue",u.keys=[s.t("operations.continue.key")],u.title=s.t("operations.continue.title"),u.behavior=new ht(i,u),u}var hT=[],oG=[/^highway\/(motorway|trunk|primary|secondary|tertiary|unclassified|residential|living_street|service|track)/,/^line$/],dT=["highway/residential","highway/service","highway/service/driveway","highway/track","highway/unclassified","highway/tertiary","line"],aG=[/^highway\/footway\/(crossing|sidewalk)/,/^highway\/footway$/],fT=["highway/footway/crossing2/dashes","highway/footway/crossing2/dots","highway/footway/crossing2/ladder","highway/footway/crossing2/ladder:skewed","highway/footway/crossing2/lines","highway/footway/crossing2/surface","highway/footway/crossing2/unmarked","highway/footway/crossing2/zebra","highway/footway/crossing2/other"],lG=[/^highway\/crossing/],pT=["highway/crossing2/dashes","highway/crossing2/dots","highway/crossing2/ladder","highway/crossing2/ladder:skewed","highway/crossing2/lines","highway/crossing2/surface","highway/crossing2/unmarked","highway/crossing2/zebra","highway/crossing2/other"];function Rg(i,e){let t=i.systems.editor,r=t.staging.graph,s=i.systems.l10n,n=i.systems.presets,o=[],a=null,l=null;for(let h of e){let d=r.hasEntity(h);if(!d)continue;let f=d.geometry(r),p=n.match(d,r),m=f==="line"&&oG.some(x=>x.test(p.id)),g=f==="line"&&aG.some(x=>x.test(p.id)),y=f==="vertex"&&lG.some(x=>x.test(p.id));if(m){if(o.push(d),!a)a=dT,l=s.t("operations.cycle_highway_tag.highway_annotation");else if(a!==dT){o=[],a=null,l="";break}}if(g){if(o.push(d),!a)a=fT,l=s.t("operations.cycle_highway_tag.crosswalk_annotation");else if(a!==fT){o=[],a=null,l="";break}}if(y){if(o.push(d),!a)a=pT,l=s.t("operations.cycle_highway_tag.crosswalk_annotation");else if(a!==pT){o=[],a=null,l="";break}}}let c=ai(e,hT);c||(hT=e.slice());let u=function(){if(!o.length||!a)return;let h=t.staging.graph,d=n.match(o[0],h),f=d?a.indexOf(d.id):-1,p=a[(f+1)%a.length],m=n.item(p);t.beginTransaction();for(let y of o){h=t.staging.graph;let x=n.match(y,h),b=xr(y.id,x,m,!0);t.perform(b)}let g={annotation:l,selectedIDs:e};c&&t.getUndoAnnotation()===l?t.commitAppend(g):t.commit(g),t.endTransaction(),i.enter("select-osm",{selection:{osm:e}})};return u.available=function(){return o.length>0&&a},u.disabled=function(){return!1},u.tooltip=function(){return s.t("operations.cycle_highway_tag.description")},u.annotation=function(){return l},u.id="cycle_highway_tag",u.keys=["\u21E7"+s.t("operations.cycle_highway_tag.key")],u.title=s.t("operations.cycle_highway_tag.title"),u.behavior=new ht(i,u),u}function Ng(i,e){let t=i.systems.editor,r=t.staging.graph,s=i.systems.l10n,n=i.systems.map,o=i.systems.storage,a=e.map(f=>r.hasEntity(f)).filter(f=>f&&(f.hasInterestingTags()||f.geometry(r)!=="vertex")),l=a.every(f=>f.isNew()),c=ft(a,r),u,h=function(){let f=t.staging.graph,p=Object.assign({relation:[],way:[],node:[]},Ut(a,"type")),m=[],g={},y,x;for(x=0;x<p.relation.length;x++)y=p.relation[x],!g[y.id]&&y.isComplete(f)&&(m.push(y.id),g=d(y.id,f,g));for(x=0;x<p.way.length;x++)y=p.way[x],g[y.id]||(m.push(y.id),g=d(y.id,f,g));for(x=0;x<p.node.length;x++)y=p.node[x],g[y.id]||m.push(y.id);i.copyIDs=m,u&&(m.length!==1||f.entity(m[0]).type!=="node")?i.copyLoc=i.projection.invert(u):i.copyLoc=null};function d(f,p,m){let g=p.entity(f),y;m=m||{},g.type==="relation"?y=g.members.map(x=>x.id):g.type==="way"?y=g.nodes:y=[];for(let x=0;x<y.length;x++)m[y[x]]||(m[y[x]]=!0,m=d(y[x],p,m));return m}return h.available=function(){return a.length>0},h.disabled=function(){if(!l&&f())return"too_large";return!1;function f(){return!(o.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&c.percentContainedIn(n.extent())<.8}},h.availableForKeypress=function(){let f=window.getSelection&&window.getSelection();return!f||!f.toString()},h.tooltip=function(){let f=h.disabled();return f?s.t(`operations.copy.${f}`,{n:e.length}):s.t("operations.copy.description",{n:e.length})},h.annotation=function(){return s.t("operations.copy.annotation",{n:e.length})},h.point=function(f){return u=f,h},h.id="copy",h.keys=[Ie("\u2318C")],h.title=s.t("operations.copy.title"),h.behavior=new ht(i,h),h}function Fg(i,e){let t=i.systems.editor,r=t.staging.graph,s=i.systems.l10n,n=i.systems.map,o=i.systems.storage,a=e.map(_=>r.hasEntity(_)).filter(Boolean),l=a.every(_=>_.isNew()),c=[],u=[],h=[],d=[];for(let _ of a)_.type==="way"?u.push(_.id):_.geometry(r)==="vertex"?c.push(_.id):h.push(_.id);let f,p="",m="features",g=[],y=[];if(c.length>0)g=c,c.forEach(_=>{let w=r2(_);if(u.length>0){let A=u.filter(k=>r.entity(k).nodes.indexOf(_)!==-1);w.limitWays(A)}d.push(w),y=y.concat(r.parentWays(r.entity(_)).map(A=>A.id))}),y=Fe(y).filter(_=>u.indexOf(_)===-1),p+=d.length===1?"single_point.":"multiple_points.",u.length===1?p+="single_way."+r.geometry(u[0]):p+=u.length===0?"no_ways":"multiple_ways";else if(u.length>0){let _=u.map(S=>r.entity(S)),w=Ft(u,r);f=w.map(S=>S.loc);let A=[],k=[],v=[],E=[];w.forEach(S=>{let M=r2(S.id).limitWays(u);if(M.disabled(r)!=="not_connected"){let I=0;for(let T in _)if(_[T].nodes.indexOf(S.id)!==-1&&(I+=1),I>1)break;I>1?(A.push(M),k.push(S)):(v.push(M),E.push(S))}}),p+="no_points.",p+=u.length===1?"single_way.":"multiple_ways.",A.length?(d=A,g=k.map(S=>S.id),p+="conjoined",m="from_each_other"):(d=v,g=E.map(S=>S.id),u.length===1?p+=r.geometry(u[0]):p+="separate")}let x=ft(g,r),b=function(){let _=w=>{for(let A of d)A.disabled(w)||(w=A(w));return w};t.perform(_),t.commit({annotation:b.annotation(),selectedIDs:e})};return b.relatedEntityIds=function(){return c.length?y:g},b.available=function(){if(d.length===0||h.length!==0)return!1;let _=t.staging.graph;return!(c.length!==0&&u.length!==0&&!u.every(function(w){return c.some(A=>_.entity(w).nodes.indexOf(A)!==-1)}))},b.disabled=function(){let _=t.staging.graph,w;for(let v of d)if(w=v.disabled(_),w)return w;if(!l&&A())return"too_large."+((c.length?c:u).length===1?"single":"multiple");if(!l&&f&&k())return"not_downloaded";if(e.some(i.hasHiddenConnections))return"connected_to_hidden";return!1;function A(){return!(o.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&x.percentContainedIn(n.extent())<.8}function k(){if(i.inIntro)return!1;let v=i.services.osm;if(v){let E=f.filter(S=>!v.isDataLoaded(S));if(E.length)return E.forEach(S=>i.loadTileAtLoc(S)),!0}return!1}},b.tooltip=function(){let _=b.disabled();return _?s.t(`operations.disconnect.${_}`):s.t(`operations.disconnect.description.${p}`)},b.annotation=function(){return s.t(`operations.disconnect.annotation.${m}`)},b.id="disconnect",b.keys=[s.t("operations.disconnect.key")],b.title=s.t("operations.disconnect.title"),b.behavior=new ht(i,b),b}function Lg(i,e){let t=i.systems.editor,r=i.systems.l10n,s=i.systems.presets,n=0,o=l(e),a=n===1?"single":"multiple";function l(f){let p;n=0;for(let m of f){let g=c(m);g&&(n+=1,p&&g!==p?p!=="generic"&&g!=="generic"?p="building_address":p="generic":p=g)}return p}function c(f){let p=t.staging.graph,m=p.entity(f),g=s.match(m,p);if(!g||g.isFallback())return null;if(m.type==="node"&&g.id!=="address"&&Object.keys(m.tags).some(function(x){return x.match(/^addr:.{1,}/)}))return"address";let y=m.geometry(p);return y==="area"&&m.tags.building&&!g.tags.building?"building":y==="vertex"&&Object.keys(m.tags).length?"generic":null}let u=/architect|building|height|layer|nycdoitt:bin|source|type|wheelchair|roof/i,h=["source"],d=function(){let f=m=>{for(let g of e){let y=c(g);if(!y)continue;let x=Object.assign({},m.entity(g).tags);for(let b in x)y==="address"&&h.indexOf(b)!==-1||y==="building"&&u.test(b)||y!=="generic"&&(b.match(/^addr:.{1,}/)||b.match(/^source:.{1,}/))||delete x[b];m=vt(g,x)(m)}return m},p=d.annotation();t.perform(f),t.commit({annotation:p,selectedIDs:e}),i.enter("select-osm",{selection:{osm:e}})};return d.available=function(){return o},d.disabled=function(){let f=t.staging.graph;if(e.some(p))return"has_wikidata_tag";return!1;function p(m){let g=f.entity(m);return g.tags.wikidata&&g.tags.wikidata.trim().length>0}},d.tooltip=function(){let f=d.disabled();return f?r.t(`operations.downgrade.${f}.${a}`):r.t(`operations.downgrade.description.${o}`)},d.annotation=function(){let f;return o==="building_address"?f="generic":f=o,r.t(`operations.downgrade.annotation.${f}`,{n})},d.id="downgrade",d.keys=[Ie("\u232B")],d.title=r.t("operations.downgrade.title"),d.behavior=new ht(i,d),d}function Og(i,e){let t=i.systems.editor,r=t.staging.graph,s=i.systems.l10n,n=i.systems.map,o=i.systems.presets,a=i.systems.storage,l=e.length===1?"single":"multiple",c=e.map(g=>r.hasEntity(g)).filter(Boolean),u=c.every(g=>g.isNew()),h=ft(c,r),d=Fe(c.map(g=>g.geometry(r))),f=d.length===1?d[0]:"feature",p=c.map(g=>!g.hasInterestingTags()||g.type==="node"&&r.parentWays(g).length===0||g.type!=="node"&&!o.match(g,r).geometry.includes("point")?null:h1(g.id,i.projection)).filter(Boolean),m=function(){if(!p.length)return;let g=[],y=b=>{for(let _ of p)b=_(b),g.push(_.getExtractedNodeID());return b},x=m.annotation();t.beginTransaction(),t.perform(y),t.commit({annotation:x,selectedIDs:e}),t.endTransaction(),i.enter("select-osm",{selection:{osm:g}})};return m.available=function(){return p.length&&e.length===p.length},m.disabled=function(){let g=t.staging.graph;if(!u&&y())return"too_large";if(e.some(x=>g.geometry(x)==="vertex"&&i.hasHiddenConnections(x)))return"connected_to_hidden";return!1;function y(){return!(a.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&h.percentContainedIn(n.extent())<.8}},m.tooltip=function(){let g=m.disabled();return g?s.t(`operations.extract.${g}.${l}`):s.t(`operations.extract.description.${f}.${l}`)},m.annotation=function(){return s.t("operations.extract.annotation",{n:e.length})},m.id="extract",m.keys=[s.t("operations.extract.key")],m.title=s.t("operations.extract.title"),m.behavior=new ht(i,m),m}function Bg(i,e){let t=i.systems.editor,r=i.systems.l10n,s=i.systems.presets,n=i.systems.storage,o=a();function a(){let c=t.staging.graph,h={tagnosticRoadCombine:n.getItem("rapid-internal-feature.tagnosticRoadCombine")==="true"},d=D5(e,h);if(!d.disabled(c))return d;let f=R5(e);if(!f.disabled(c))return f;let p=N5(e);if(!p.disabled(c))return p;let m=Nr(e);return m.disabled(c)?d.disabled(c)!=="not_eligible"?d:f.disabled(c)!=="not_eligible"?f:p.disabled(c)!=="not_eligible"?p:m:m}let l=function(){if(l.disabled())return;let c=l.annotation();t.perform(o),t.commit({annotation:c,selectedIDs:e});let u=t.staging.graph,h=e.filter(d=>u.hasEntity(d));if(h.length>1){let d=h.filter(f=>u.entity(f).hasInterestingTags());d.length&&(h=d)}i.enter("select-osm",{selection:{osm:h}})};return l.available=function(){return e.length>=2},l.disabled=function(){let c=t.staging.graph,u=o.disabled(c);if(u)return u;let h=i.services.osm;return h&&o.resultingWayNodesLength&&o.resultingWayNodesLength(c)>h.maxWayNodes?"too_many_vertices":!1},l.tooltip=function(){let c=l.disabled();if(c){if(c==="conflicting_relations")return r.t("operations.merge.conflicting_relations");if(c==="restriction"||c==="connectivity"){let u=s.item("type/"+c);return r.t("operations.merge.damage_relation",{relation:u.name()})}else return r.t(`operations.merge.${c}`)}else return r.t("operations.merge.description")},l.annotation=function(){return r.t("operations.merge.annotation",{n:e.length})},l.id="merge",l.keys=[r.t("operations.merge.key")],l.title=r.t("operations.merge.title"),l.behavior=new ht(i,l),l}function Mu(i,e){let t=i.systems.editor,r=t.staging.graph,s=i.systems.l10n,n=i.systems.map,o=i.systems.storage,a=e.length===1?"single":"multiple",l=e.map(p=>r.hasEntity(p)).filter(Boolean),c=l.every(p=>p.isNew()),h=Ft(e,r).map(p=>p.loc),d=ft(l,r),f=function(){i.enter("move",{selection:{osm:e}})};return f.available=function(){return l.length>0},f.disabled=function(){let p=t.staging.graph;if(!c&&m())return"too_large";if(!c&&g())return"not_downloaded";if(e.some(i.hasHiddenConnections))return"connected_to_hidden";if(l.some(y))return"incomplete_relation";return!1;function m(){return!(o.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&d.percentContainedIn(n.extent())<.8}function g(){if(i.inIntro)return!1;let x=i.services.osm;if(x){let b=h.filter(_=>!x.isDataLoaded(_));if(b.length)return b.forEach(_=>i.loadTileAtLoc(_)),!0}return!1}function y(x){return x.type==="relation"&&!x.isComplete(p)}},f.tooltip=function(){let p=f.disabled();return p?s.t(`operations.move.${p}.${a}`):s.t(`operations.move.description.${a}`)},f.annotation=function(){let p=t.staging.graph;return e.length===1?s.t("operations.move.annotation."+p.geometry(e[0])):s.t("operations.move.annotation.feature",{n:e.length})},f.id="move",f.keys=[s.t("operations.move.key")],f.title=s.t("operations.move.title"),f.behavior=new ht(i,f),f.mouseOnly=!0,f}function Ug(i,e){let t=i.systems.editor,r=t.staging.graph,s=i.systems.l10n,n=i.systems.map,o=i.systems.storage,a=e.length===1?"single":"multiple",l=e.map(g=>r.hasEntity(g)).filter(Boolean),c=l.every(g=>g.isNew()),u=ft(l,r),h,d=l.map(p).filter(Boolean),f=Ft(e,r).map(g=>g.loc);function p(g){let y=t.staging.graph,x=g.geometry(y);if(g.type==="way"&&new Set(g.nodes).size>2)return h&&h!=="feature"?null:(h="feature",Xo(g.id,i.projection));if(x==="vertex"){if(h&&h!=="corner")return null;h="corner";let b=y.parentWays(g);if(b.length===1){let _=b[0];if(_.nodes.indexOf(g.id)!==-1)return Xo(_.id,i.projection,g.id)}}return null}let m=function(){if(!d.length)return;let g=(x,b)=>{for(let _ of d)_.disabled(x)||(x=_(x,b));return x};g.transitionable=!0;let y=m.annotation();t.performAsync(g).then(()=>t.commit({annotation:y,selectedIDs:e}))};return m.available=function(){return d.length&&e.length===d.length},m.disabled=function(){if(!d.length)return"";let g=t.staging.graph,y=d.map(_=>_.disabled(g)).filter(Boolean);if(y.length===d.length)return new Set(y).size>1?"multiple_blockers":y[0];if(!c&&x())return"too_large";if(!c&&b())return"not_downloaded";if(e.some(i.hasHiddenConnections))return"connected_to_hidden";return!1;function x(){return!(o.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&u.percentContainedIn(n.extent())<.8}function b(){if(i.inIntro)return!1;let _=i.services.osm;if(_){let w=f.filter(A=>!_.isDataLoaded(A));if(w.length)return w.forEach(A=>i.loadTileAtLoc(A)),!0}return!1}},m.tooltip=function(){let g=m.disabled();return g?s.t(`operations.orthogonalize.${g}.${a}`):s.t(`operations.orthogonalize.description.${h}.${a}`)},m.annotation=function(){return s.t("operations.orthogonalize.annotation."+h,{n:d.length})},m.id="orthogonalize",m.keys=[s.t("operations.orthogonalize.key")],m.title=s.t("operations.orthogonalize.title"),m.behavior=new ht(i,m),m}function Pu(i){let e=i.systems.editor,t=i.systems.l10n,r=i.systems.map,s=function(){let n=i.copyGraph,o=i.copyIDs;if(!o.length)return;let a=u1(o,n);e.beginTransaction(),e.perform(a);let l=e.staging.graph,c=a.copies(),u=new Set;for(let x of Object.values(c))u.add(x.id);let h=new ie,d=[];for(let[x,b]of Object.entries(c)){let _=n.entity(x);h=h.extend(_.extent(n)),l.parentWays(b).some(k=>u.has(k.id))||d.push(b.id)}let f=i.projection,p=i.copyLoc,m=p&&f.project(p)||f.project(h.center()),g=Ze(r.mouse(),m),y=t.t("operations.paste.annotation",{n:d.length});e.perform(_n(d,g,f)),e.commit({annotation:y,selectedIDs:d}),e.endTransaction(),i.enter("move",{selection:{osm:d}})};return s.available=function(){var n;return((n=i.mode)==null?void 0:n.id)==="browse"},s.disabled=function(){return!i.copyIDs.length},s.tooltip=function(){let n=i.copyGraph,o=i.copyIDs;return o.length?t.t("operations.paste.description",{feature:t.displayLabel(n.entity(o[0]),n),n:o.length}):t.t("operations.paste.nothing_copied")},s.annotation=function(){let n=i.copyIDs;return t.t("operations.paste.annotation",{n:n.length})},s.id="paste",s.keys=[Ie("\u2318V")],s.title=t.t("operations.paste.title"),s}function $g(i,e){return mT(i,e,"short")}function Hg(i,e){return mT(i,e,"long")}function mT(i,e,t="long"){let r=i.systems.editor,s=r.staging.graph,n=i.systems.l10n,o=i.systems.map,a=i.systems.storage,l=e.length===1?"single":"multiple",c=e.map(m=>s.hasEntity(m)).filter(Boolean),u=c.every(m=>m.isNew()),h=ft(c,s),d=Ft(e,s),f=d.map(m=>m.loc),p=function(){let m=p.annotation(),g=z5(e,i.projection).useLongAxis(t==="long");r.performAsync(g).then(()=>r.commit({annotation:m,selectedIDs:e}))};return p.available=function(){return d.length>=3},p.disabled=function(){let m=r.staging.graph;if(!u&&g())return"too_large";if(!u&&y())return"not_downloaded";if(e.some(i.hasHiddenConnections))return"connected_to_hidden";if(c.some(x))return"incomplete_relation";return!1;function g(){return!(a.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&h.percentContainedIn(o.extent())<.8}function y(){if(i.inIntro)return!1;let b=i.services.osm;if(b){let _=f.filter(w=>!b.isDataLoaded(w));if(_.length)return _.forEach(w=>i.loadTileAtLoc(w)),!0}return!1}function x(b){return b.type==="relation"&&!b.isComplete(m)}},p.tooltip=function(){let m=p.disabled();return m?n.t(`operations.reflect.${m}.${l}`):n.t(`operations.reflect.description.${t}.${l}`)},p.annotation=function(){return n.t(`operations.reflect.annotation.${t}.feature`,{n:e.length})},p.id=`reflect-${t}`,p.keys=[n.t(`operations.reflect.key.${t}`)],p.title=n.t(`operations.reflect.title.${t}`),p.behavior=new ht(i,p),p}function Gg(i,e){let t=i.systems.editor,r=i.systems.l10n,s=e.map(o).filter(Boolean),n=a();function o(c){let u=t.staging.graph,h=u.hasEntity(c);if(!h)return null;let d=h.geometry(u);if(h.type!=="node"&&d!=="line")return null;let f=hs(c);return f.disabled(u)?null:f}function a(){let c=t.staging.graph,u=s.filter(h=>{let d=c.hasEntity(h.entityID());return(d==null?void 0:d.type)==="node"}).length;return u===0?"line":u===s.length?"point":"feature"}let l=function(){if(!s.length)return;let c=function(h){for(let d of s)h=d(h);return h},u=l.annotation();t.perform(c),t.commit({annotation:u,selectedIDs:e})};return l.available=function(){return s.length>0},l.disabled=function(){return!1},l.tooltip=function(){return r.t(`operations.reverse.description.${n}`)},l.annotation=function(){return r.t(`operations.reverse.annotation.${n}`,{n:s.length})},l.id="reverse",l.keys=[r.t("operations.reverse.key")],l.title=r.t("operations.reverse.title"),l.behavior=new ht(i,l),l}function zg(i,e){let t=i.systems.editor,r=t.staging.graph,s=i.systems.l10n,n=i.systems.map,o=i.systems.storage,a=e.length===1?"single":"multiple",l=e.map(p=>r.hasEntity(p)).filter(Boolean),c=l.every(p=>p.isNew()),u=ft(l,r),h=Ft(e,r),d=h.map(p=>p.loc),f=function(){i.enter("rotate",{selection:{osm:e}})};return f.available=function(){return h.length>=2},f.disabled=function(){let p=t.staging.graph;if(!c&&m())return"too_large";if(!c&&g())return"not_downloaded";if(e.some(i.hasHiddenConnections))return"connected_to_hidden";if(l.some(y))return"incomplete_relation";return!1;function m(){return!(o.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&u.percentContainedIn(n.extent())<.8}function g(){if(i.inIntro)return!1;let x=i.services.osm;if(x){let b=d.filter(_=>!x.isDataLoaded(_));if(b.length)return b.forEach(_=>i.loadTileAtLoc(_)),!0}return!1}function y(x){return x.type==="relation"&&!x.isComplete(p)}},f.tooltip=function(){let p=f.disabled();return p?s.t(`operations.rotate.${p}.${a}`):s.t(`operations.rotate.description.${a}`)},f.annotation=function(){let p=t.staging.graph;return e.length===1?s.t("operations.rotate.annotation."+p.geometry(e[0])):s.t("operations.rotate.annotation.feature",{n:e.length})},f.id="rotate",f.keys=[s.t("operations.rotate.key")],f.title=s.t("operations.rotate.title"),f.behavior=new ht(i,f),f.mouseOnly=!0,f}function jg(i,e){let t=i.systems.editor,r=t.staging.graph,s=i.systems.l10n,n=e.map(y=>r.hasEntity(y)).filter(Boolean),o=n.filter(y=>y.type==="node"&&y.geometry(r)==="vertex"),a=o.map(y=>y.id),l=a.length===1?"single":"multiple",c=n.filter(y=>y.type==="way"),u=c.map(y=>y.id),h=o.length>0&&o.length+c.length===e.length,d=io(a),f="feature",p=[],m="single";if(h){u.length&&d.limitWays(u),p=d.ways(r);let y=new Set;for(let x of p)y.add(x.geometry(r));y.size===1&&(f=Array.from(y)[0]),m=p.length===1?"single":"multiple"}let g=function(){let y=g.annotation(),x=t.perform(d);t.commit({annotation:y,selectedIDs:e});let b=a.slice();for(let[_,w]of x.changes){let A=w.head;A&&A.type==="way"&&b.push(_)}i.enter("select-osm",{selection:{osm:b}})};return g.relatedEntityIds=function(){return p.map(y=>y.id)},g.available=function(){return h},g.disabled=function(){let y=t.staging.graph,x=d.disabled(y);return x||(e.some(i.hasHiddenConnections)?"connected_to_hidden":!1)},g.tooltip=function(){let y=g.disabled();return y?s.t(`operations.split.${y}`):s.t(`operations.split.description.${f}.${m}.${l}_node`)},g.annotation=function(){return s.t(`operations.split.annotation.${f}`,{n:p.length})},g.id="split",g.keys=[s.t("operations.split.key")],g.title=s.t("operations.split.title"),g.behavior=new ht(i,g),g}function Vg(i,e){let t=i.systems.editor,r=t.staging.graph,s=i.systems.l10n,n=i.systems.map,o=i.systems.storage,a=e.map(_=>r.hasEntity(_)).filter(Boolean),l=a.every(_=>_.isNew()),c=a.filter(_=>_.type==="way"),u=c.map(_=>_.id),h=a.filter(_=>_.type==="node"),d=h.map(_=>_.id),f=(c.length?c:h).length===1?"single":"multiple",p=Ft(e,r).map(_=>_.loc),m=ft(e,r),g,y=x();function x(){let _=t.staging.graph;if(c.length===0&&h.length>2)return g="point",H5(d,i.projection);if(c.length>0&&(h.length===0||h.length===2)){let w=[],A=[];for(let v of a)if(v.type==="way"){if(v.type==="way"&&v.isClosed())return null;w.push(v.first()),A.push(v.last())}if(w=w.filter(v=>w.indexOf(v)===w.lastIndexOf(v)),A=A.filter(v=>A.indexOf(v)===A.lastIndexOf(v)),Di(w,A).length+Di(A,w).length!==2)return null;let k=Ft(u,_).map(v=>v.id);return k.length<=2||d.length===2&&(k.indexOf(d[0])===-1||k.indexOf(d[1])===-1)?null:(d.length&&(m=ft(d,_)),g="line",G5(e,i.projection))}return null}let b=function(){if(!y)return;let _=b.annotation();t.performAsync(y).then(()=>t.commit({annotation:_,selectedIDs:e}))};return b.available=function(){return!!y},b.disabled=function(){let _=t.staging.graph,w=y.disabled(_);if(w)return w;if(!l&&A())return"too_large";if(!l&&k())return"not_downloaded";if(e.some(i.hasHiddenConnections))return"connected_to_hidden";return!1;function A(){return!(o.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&m.percentContainedIn(n.extent())<.8}function k(){if(i.inIntro)return!1;let v=i.services.osm;if(v){let E=p.filter(S=>!v.isDataLoaded(S));if(E.length)return E.forEach(S=>i.loadTileAtLoc(S)),!0}return!1}},b.tooltip=function(){let _=b.disabled();return _?s.t(`operations.straighten.${_}.${f}`):s.t(`operations.straighten.description.${g}`+(c.length===1?"":"s"))},b.annotation=function(){return s.t(`operations.straighten.annotation.${g}`,{n:c.length?c.length:h.length})},b.id="straighten",b.keys=[s.t("operations.straighten.key")],b.title=s.t("operations.straighten.title"),b.behavior=new ht(i,b),b}function Xg(i){let e="y_shaped_connection",t=i.systems.l10n,r=12,s=5,n=new Set(["residential","service","track","unclassified","tertiary","secondary","primary","living_street","cycleway","trunk","motorway","road","raceway"]);function o(u,h){return h.parentWays(u).filter(f=>n.has(f.tags.highway))}function a(u,h){let d=!ns(h,[u.id]).disabled(),f;return d?f=new Te({icon:"rapid-operation-delete",title:t.t("issues.fix.delete_node_around_conn.title"),entityIds:[u.id],onClick:function(){let p=this.entityIds[0],m=ns(h,[p]);m.disabled()||m()}}):f=new Te({icon:"rapid-operation-move",title:t.t("issues.fix.move_node_around_conn.title"),entityIds:[u.id]}),new Ye(h,{type:e,severity:"warning",message:()=>t.t("issues.y_shaped_connection.message"),reference:p=>{p.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(t.t("issues.y_shaped_connection.reference"))},entityIds:[u.id],fixes:[f]})}function l(u,h,d,f){if(d<=0||d>=h.nodes.length-1)return!1;let p=h.nodes[d],m=u.entity(p);if(o(m,u).length<2)return!1;let y=h.nodes[f],x=u.entity(y);if(at(m.loc,x.loc)>r)return!1;let _=d<f?d-1:d+1,w=h.nodes[_],A=u.entity(w),k=i.projection.project(A.loc),v=i.projection.project(m.loc),E=i.projection.project(x.loc),S=0,M=0,I=0;return _<f?(S=$t(k,v),M=$t(v,E),I=Math.abs(M-S)/Math.PI*180):(S=$t(E,v),M=$t(v,k),I=Math.abs(M-S)/Math.PI*180),I>s}let c=function(u,h){if(u.type!=="node")return[];let d=o(u,h);if(d.length!==1||!d[0].id.startsWith("w-"))return[];let f=[],p=d[0],m=p.nodes.indexOf(u.id);return m<=0||(l(h,p,m-1,m)||l(h,p,m+1,m))&&f.push(a(u,i)),f};return c.type=e,c}function qg(i){let e="suspicious_name",t=i.systems.editor,r=i.systems.l10n,s=i.systems.presets,n=["aerialway","aeroway","amenity","building","craft","highway","leisure","railway","man_made","office","shop","tourism","waterway"],o=!1;function a(f){let p=i.services.nsi;return p&&(o=p.status==="loading",!o)?p.isGenericName(f):!1}function l(f,p){for(let m of n){let g=p[m];if(g&&(g=g.toLowerCase(),m===f||g===f||m.replace(/\_/g," ")===f||g.replace(/\_/g," ")===f))return!0}return!1}function c(f,p){return f=f.toLowerCase(),l(f,p)||a(p)}function u(f,p,m,g){return new Ye(i,{type:e,subtype:"generic_name",severity:"warning",message:function(){let x=t.staging.graph,b=x.hasEntity(this.entityIds[0]);if(!b)return"";let _=s.match(b,x),w=g&&r.languageName(g);return r.t("issues.generic_name.message"+(w?"_language":""),{feature:_.name(),name:m,language:w})},reference:y,entityIds:[f],hash:`${p}=${m}`,dynamicFixes:function(){return[new Te({icon:"rapid-operation-delete",title:r.t("issues.fix.remove_the_name.title"),onClick:function(){let x=t.staging.graph,b=this.issue.entityIds[0],_=x.entity(b),w=Object.assign({},_.tags);delete w[p],t.perform(vt(b,w)),t.commit({annotation:r.t("issues.fix.remove_generic_name.annotation"),selectedIDs:[b]})}})]}});function y(x){x.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.generic_name.reference"))}}function h(f,p,m,g){return new Ye(i,{type:e,subtype:"not_name",severity:"warning",message:function(){let x=t.staging.graph,b=x.hasEntity(this.entityIds[0]);if(!b)return"";let _=s.match(b,x),w=g&&r.languageName(g);return r.t("issues.incorrect_name.message"+(w?"_language":""),{feature:_.name(),name:m,language:w})},reference:y,entityIds:[f],hash:`${p}=${m}`,dynamicFixes:function(){return[new Te({icon:"rapid-operation-delete",title:r.t("issues.fix.remove_the_name.title"),onClick:function(){let x=t.staging.graph,b=this.issue.entityIds[0],_=x.entity(b),w=Object.assign({},_.tags);delete w[p],t.perform(vt(b,w)),t.commit({annotation:r.t("issues.fix.remove_mistaken_name.annotation"),selectedIDs:[b]})}})]}});function y(x){x.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.generic_name.reference"))}}let d=function(p){var b;let m=p.tags;if(!!m.wikidata||!!m["brand:wikidata"]||!!m["operator:wikidata"])return[];let y=[],x=new Set(((b=m["not:name"])!=null?b:"").split(";").map(_=>_.trim()).filter(Boolean));for(let[_,w]of Object.entries(m)){if(!w)continue;let A=_.match(/^name(?:(?::)([a-zA-Z_-]+))?$/);if(!A)continue;let k=A.length>=2?A[1]:null;x.has(w)&&y.push(h(p.id,_,w,k)),c(w,m)&&(y.provisional=o,y.push(u(p.id,_,w,k)))}return y};return d.type=e,d}function Qg(i){let e="unsquare_way",t=i.systems.editor,r=i.systems.l10n,s=5,n=.05,o=10;function a(c,u){return c.type!=="way"||c.geometry(u)!=="area"?!1:c.tags.building&&c.tags.building!=="no"}let l=function(u,h){if(!a(u,h))return[];if(u.tags.nonsquare==="yes")return[];let d=u.isClosed();if(!d)return[];let f=h.childNodes(u).slice();if(f.length>o+1)return[];let p=i.services.osm;if(!p||f.some(A=>!p.isDataLoaded(A.loc)))return[];if(f.some(A=>h.parentWays(A).some(k=>k.id===u.id?!1:a(k,h)?!0:h.parentRelations(k).some(v=>v.isMultipolygon()&&v.tags.building&&v.tags.building!=="no"))))return[];let y=i.systems.storage.getItem("validate-square-degrees"),x=isNaN(y)?s:parseFloat(y),b=f.map(A=>i.projection.project(A.loc));if(!b1(b,d,n,x,!0))return[];let _;if(!u.tags.wikidata){let A=Xo(u.id,i.projection,void 0,x),k=r.t("operations.orthogonalize.annotation.feature",{n:1});_=[A,k]}return[new Ye(i,{type:e,subtype:"building",severity:"warning",message:function(){let A=t.staging.graph,k=A.hasEntity(this.entityIds[0]);return k?r.t("issues.unsquare_way.message",{feature:r.displayLabel(k,A)}):""},reference:w,entityIds:[u.id],hash:x,autoArgs:_,dynamicFixes:function(){return[new Te({icon:"rapid-operation-orthogonalize",title:r.t("issues.fix.square_feature.title"),onClick:function(){let A=this.issue.entityIds[0],k=Xo(A,i.projection,void 0,x),v=r.t("operations.orthogonalize.annotation.feature",{n:1});t.performAsync(k).then(()=>t.commit({annotation:v,selectedIDs:[A]}))}})]}})];function w(A){A.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.unsquare_way.buildings.reference"))}};return l.type=e,l}var cG=5e3,Du=class extends Ce{constructor(e){super(e),this.id="validator",this.dependencies=new Set(["editor","storage","map","urlhash"]),this._rules=new Map,this._base=new Ml("base"),this._head=new Ml("head"),this._disabledRuleIDs=new Set,this._ignoredIssueIDs=new Set,this._resolvedIssueIDs=new Set,this._completeDiff=new Map,this._deferredRIC=new Map,this._deferredST=new Set,this._errorOverrides=[],this._warningOverrides=[],this._disableOverrides=[],this._initPromise=null,this._validationPromise=null,this.validateAsync=this.validateAsync.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let o of this.dependencies)if(!this.context.systems[o])return Promise.reject(`Cannot init:  ${this.id} requires ${o}`);let e=this.context;Object.values(Yg).forEach(o=>{if(typeof o!="function")return;let a=o(e);this._rules.set(a.type,a)});let t=e.systems.editor,r=e.systems.storage,s=e.systems.urlhash,n=Promise.all([t.initAsync(),r.initAsync(),s.initAsync()]);return this._initPromise=n.then(()=>{this._errorOverrides=this._parseHashParam(s.initialHashParams.get("validationError")),this._warningOverrides=this._parseHashParam(s.initialHashParams.get("validationWarning")),this._disableOverrides=this._parseHashParam(s.initialHashParams.get("validationDisable"));let o=r.getItem("validate-disabledRules");if(o){let a=o.split(",").map(l=>l.trim()).filter(Boolean);this._disabledRuleIDs=new Set(a)}t.on("stablechange",()=>this.validateAsync()).on("merge",a=>this._validateBaseEntitiesAsync(a))})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){this._base.queue=[],this._head.queue=[];for(let[e,t]of this._deferredRIC)window.cancelIdleCallback(e),t();this._deferredRIC.clear();for(let e of this._deferredST)window.clearTimeout(e);return this._deferredST.clear(),this._ignoredIssueIDs.clear(),this._resolvedIssueIDs.clear(),this._base=new Ml("base"),this._head=new Ml("head"),this._completeDiff=new Map,Promise.resolve()}_parseHashParam(e=""){var n;let t=[],r=e.split(",").map(o=>o.trim()).filter(Boolean);for(let o of r){let a=o.split("/",2),l=a[0],c=(n=a[1])!=null?n:"*";!l||!c||t.push({type:s(l),subtype:s(c)})}return t;function s(o){let a=o.replace(/[-\/\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*");return new RegExp(`^${a}$`)}}resetIgnoredIssues(){this._ignoredIssueIDs.clear(),this.emit("validated")}revalidateUnsquare(){let e=this._rules.get("unsquare_way");if(typeof e!="function")return;let t=r=>{if(!r.graph)return;r.uncacheIssuesOfType("unsquare_way");let n=this.context.systems.editor.tree.intersects(new ie([-180,-90],[180,90]),r.graph).filter(o=>o.type==="way"&&o.tags.building&&o.tags.building!=="no");for(let o of n){let a=e(o,r.graph);a.length&&r.cacheIssues(a)}};t(this._head),t(this._base),this.emit("validated")}getIssues(e){let t=Object.assign({what:"all",where:"all",includeIgnored:!1,includeDisabledRules:!1},e),r=this.context,s=r.systems.map.extent(),n=r.systems.editor.staging.graph,o=new Set,a=[],l=c=>{if(!c||o.has(c.id)||this._resolvedIssueIDs.has(c.id)||t.includeDisabledRules==="only"&&!this._disabledRuleIDs.has(c.type)||!t.includeDisabledRules&&this._disabledRuleIDs.has(c.type)||t.includeIgnored==="only"&&!this._ignoredIssueIDs.has(c.id)||!t.includeIgnored&&this._ignoredIssueIDs.has(c.id)||(c.entityIds||[]).some(u=>!n.hasEntity(u)))return!1;if(t.where==="visible"){let u=c.extent(n);if(!s.intersects(u))return!1}return!0};if(this._head.issues.size)for(let c of this._head.issues.values()){let u=(c.entityIds||[]).some(h=>this._completeDiff.has(h));t.what==="edited"&&!u||l(c)&&(o.add(c.id),a.push(c))}if(this._base.issues.size&&t.what==="all")for(let c of this._base.issues.values())l(c)&&(o.add(c.id),a.push(c));return a}getResolvedIssues(){return Array.from(this._resolvedIssueIDs).map(e=>this._base.issues.get(e)).filter(Boolean)}focusIssue(e){var o;let t=this.context,r=t.systems.map,s=(o=e.entityIds)!=null?o:[],n=s[0];n&&(e.loc?r.centerZoomEase(e.loc,19):s.length&&r.fitEntitiesEase(s),window.setTimeout(()=>{t.enter("select-osm",{selection:{osm:[n]}}),this.emit("focusedIssue",e)},250))}getIssuesBySeverity(e){var r,s;let t=Ut(this.getIssues(e),"severity");return t.error=(r=t.error)!=null?r:[],t.warning=(s=t.warning)!=null?s:[],t}getSharedEntityIssues(e,t){let r=["missing_tag","missing_role","outdated_tags","mismatched_geometry","crossing_ways","almost_junction","disconnected_way","impossible_oneway"],s=this.getIssues(t),n=new Set(e);return s.filter(o=>{var a;return((a=o.entityIds)!=null?a:[]).some(l=>n.has(l))}).sort((o,a)=>{if(o.type===a.type)return o.id<a.id?-1:1;let l=r.indexOf(o.type),c=r.indexOf(a.type);return l!==-1&&c!==-1?l-c:l===-1&&c===-1?o.type<a.type?-1:1:l!==-1?-1:1})}getEntityIssues(e,t){return this.getSharedEntityIssues([e],t)}getRuleKeys(){return[...this._rules.keys()]}isRuleEnabled(e){return!this._disabledRuleIDs.has(e)}toggleRule(e){this._disabledRuleIDs.has(e)?this._disabledRuleIDs.delete(e):this._disabledRuleIDs.add(e),this.context.systems.storage.setItem("validate-disabledRules",[...this._disabledRuleIDs].join(",")),this.validateAsync()}disableRules(e=[]){this._disabledRuleIDs=new Set(e),this.context.systems.storage.setItem("validate-disabledRules",[...this._disabledRuleIDs].join(",")),this.validateAsync()}ignoreIssue(e){this._ignoredIssueIDs.add(e),this.emit("validated")}validateAsync(){var l;let t=this.context.systems.editor;if(this._completeDiff=t.difference().complete(),t.canRestoreBackup)return Promise.resolve();if(this._validationPromise)return this._validationPromise;let r=t.base.graph,s=t.stable.graph,n=(l=this._head.graph)!=null?l:r;if(s===r)return this._head=new Ml("head"),this._head.graph=s,this._resolvedIssueIDs.clear(),this.emit("validated"),Promise.resolve();if(s===n)return this.emit("validated"),Promise.resolve();this._head.graph=s;let a=[...new er(n,s).complete().keys()];return a=this._head.withAllRelatedEntities(a),a.size?(this._validationPromise=this._validateEntitiesAsync(this._head,a).then(()=>this._updateResolvedIssues(a)).then(()=>this.emit("validated")).catch(c=>console.error(c)).then(()=>{this._validationPromise=null;let c=t.stable.graph,u=this._head.graph;c!==u&&this.validateAsync()}),this._validationPromise):(this.emit("validated"),Promise.resolve())}_validateBaseEntitiesAsync(e){let r=this.context.systems.editor;return e?(this._base.graph||(this._base.graph=r.base.graph),e=this._base.withAllRelatedEntities(e),this._validateEntitiesAsync(this._base,e).then(()=>this._updateResolvedIssues(e)).then(()=>this.emit("validated")).catch(s=>console.error(s))):Promise.resolve()}_validateEntity(e,t){let r=n=>{var l;let o=n.type,a=(l=n.subtype)!=null?l:"";for(let c of this._errorOverrides)if(c.type.test(o)&&c.subtype.test(a))return n.severity="error",!0;for(let c of this._warningOverrides)if(c.type.test(o)&&c.subtype.test(a))return n.severity="warning",!0;for(let c of this._disableOverrides)if(c.type.test(o)&&c.subtype.test(a))return!1;return!0},s={issues:[],provisional:!1};for(let[n,o]of this._rules){if(typeof o!="function"){console.error(`no such validation rule = ${n}`);continue}let a=o(e,t);a.provisional&&(s.provisional=!0),a=a.filter(r),s.issues=s.issues.concat(a)}return s}_updateResolvedIssues(e=[]){var t;for(let r of e){let s=(t=this._base.entityIssueIDs.get(r))!=null?t:[];for(let n of s){let o=this._base.issues.get(n);((o==null?void 0:o.entityIds)||[]).some(l=>this._completeDiff.has(l))&&!this._head.issues.has(n)?this._resolvedIssueIDs.add(n):this._resolvedIssueIDs.delete(n)}}}_validateEntitiesAsync(e,t){let r=Array.from(t).map(s=>e.queuedEntityIDs.has(s)?null:(e.queuedEntityIDs.add(s),e.uncacheEntityID(s),()=>{e.queuedEntityIDs.delete(s);let n=e.graph;if(!n)return;let o=n.hasEntity(s);if(!o)return;let a=this._validateEntity(o,n);a.provisional&&e.provisionalEntityIDs.add(s),e.cacheIssues(a.issues)})).filter(Boolean);return e.queue=e.queue.concat(p0(r,50)),e.queuePromise||(e.queuePromise=this._processQueue(e).then(()=>this._revalidateProvisionalEntities(e)).catch(s=>console.error(s)).finally(()=>e.queuePromise=null)),e.queuePromise}_revalidateProvisionalEntities(e){if(!e.provisionalEntityIDs.size)return;let t=window.setTimeout(()=>{this._deferredST.delete(t),e.provisionalEntityIDs.size&&this._validateEntitiesAsync(e,e.provisionalEntityIDs)},cG);this._deferredST.add(t)}_processQueue(e){if(!e.queue.length)return Promise.resolve();let t=e.queue.pop();return new Promise((r,s)=>{let n=window.requestIdleCallback(()=>{this._deferredRIC.delete(n),t.forEach(o=>o()),r()});this._deferredRIC.set(n,s)}).then(()=>{e.queue.length%100===0&&this.emit("validated")}).then(()=>this._processQueue(e))}},Ml=class{constructor(e){this.which=e,this.graph=null,this.queue=[],this.queuePromise=null,this.queuedEntityIDs=new Set,this.provisionalEntityIDs=new Set,this.issues=new Map,this.entityIssueIDs=new Map,this.recheckRBush=new gT.default,this.recheckBoxes=new Map}cacheIssue(e){var t;if(this.issues.has(e.id)&&this.uncacheIssue(e),e.type==="disconnected_way"||e.type==="impossible_oneway"){let r=e.extent(this.graph),s=Object.assign({issueID:e.id},r.bbox());this.recheckRBush.insert(s),this.recheckBoxes.set(e.id,s)}for(let r of(t=e.entityIds)!=null?t:[]){let s=this.entityIssueIDs.get(r);s||(s=new Set,this.entityIssueIDs.set(r,s)),s.add(e.id)}this.issues.set(e.id,e)}uncacheIssue(e){var r;let t=this.recheckBoxes.get(e.id);t&&(this.recheckRBush.remove(t),this.recheckBoxes.delete(e.id));for(let s of(r=e.entityIds)!=null?r:[]){let n=this.entityIssueIDs.get(s);n&&(n.delete(e.id),n.size||this.entityIssueIDs.delete(s))}this.issues.delete(e.id)}cacheIssues(e=[]){for(let t of e)this.cacheIssue(t)}uncacheIssues(e=[]){for(let t of e)this.uncacheIssue(t)}uncacheIssuesOfType(e){let r=[...this.issues.values()].filter(s=>s.type===e);this.uncacheIssues(r)}uncacheEntityID(e){var r;let t=(r=this.entityIssueIDs.get(e))!=null?r:[];for(let s of t){let n=this.issues.get(s);n&&this.uncacheIssue(n)}this.entityIssueIDs.delete(e),this.provisionalEntityIDs.delete(e)}withAllRelatedEntities(e=[]){var n,o,a;let t=this.graph,r=new Set(e);if(!t||!r.size)return r;let s=new Set;for(let l of e){let c=t.hasEntity(l);if(!c)continue;let u=(n=this.entityIssueIDs.get(l))!=null?n:[];for(let h of u)s.add(h);if(c.type==="way"||c.type==="node"){let h=c.extent(t),d=(o=this.recheckRBush.search(h.bbox()))!=null?o:[];for(let p of d)s.add(p.issueID);let f=c.type==="way"?t.childNodes(c):c.type==="node"?[c]:[];for(let p of f)for(let m of t.parentWays(p))r.add(m.id)}}for(let l of s){let c=this.issues.get(l),u=(a=c==null?void 0:c.entityIds)!=null?a:[];for(let h of u)r.add(h)}return r}};var Ai={available:new Map};Ai.available.set("dataloader",F2);Ai.available.set("editor",O2);Ai.available.set("filters",B2);Ai.available.set("imagery",z2);Ai.available.set("l10n",j2);Ai.available.set("locations",Z2);Ai.available.set("map",au);Ai.available.set("map3d",J2);Ai.available.set("photos",lu);Ai.available.set("presets",uu);Ai.available.set("rapid",hu);Ai.available.set("storage",du);Ai.available.set("styles",pu);Ai.available.set("ui",ku);Ai.available.set("uploader",Tu);Ai.available.set("urlhash",Iu);Ai.available.set("validator",Du);var Ht=class extends pi.default{constructor(e){super(),this.context=e,this.id="",this._active=!1,this._selectedData=new Map,this.operations=[]}enter(){return this._active=!0,!0}exit(){this._active=!1}get active(){return this._active}get selectedData(){return this._selectedData}get selectedIDs(){return Array.from(this._selectedData.keys())}};var yT=!1,Ru=class extends Ht{constructor(e){super(e),this.id="add-note",this._click=this._click.bind(this),this._cancel=this._cancel.bind(this)}enter(){yT&&console.log("AddNoteMode: entering"),this._active=!0;let e=this.context;return e.enableBehaviors(["hover","draw","map-interaction","map-nudging"]),e.behaviors.draw.on("click",this._click).on("cancel",this._cancel).on("finish",this._cancel),e.behaviors["map-nudging"].allow(),!0}exit(){if(!this._active)return;this._active=!1,yT&&console.log("AddNoteMode: exiting"),this.context.behaviors.draw.off("click",this._click).off("cancel",this._cancel).off("finish",this._cancel)}_click(e){let t=this.context,r=t.services.osm,s=t.projection,n=e.coord,o=s.invert(n);if(!r)return;let a=_t({loc:o,status:"open",comments:[]});r.replaceNote(a);let l=new Map().set(a.id,a);t.enter("select",{selection:l})}_cancel(){this.context.enter("browse")}};var xT=!1,Nu=class extends Ht{constructor(e){super(e),this.id="add-point",this.defaultTags={},this._click=this._click.bind(this),this._cancel=this._cancel.bind(this)}enter(){xT&&console.log("AddPointMode: entering"),this._active=!0;let e=this.context;return e.systems.map.renderer.events.setCursor("crosshair"),e.enableBehaviors(["hover","draw","map-interaction"]),e.behaviors.draw.on("click",this._click).on("cancel",this._cancel).on("finish",this._cancel),!0}exit(){if(!this._active)return;this._active=!1,xT&&console.log("AddPointMode: exiting");let e=this.context;e.systems.map.renderer.events.setCursor("grab"),e.behaviors.draw.off("click",this._click).off("cancel",this._cancel).off("finish",this._cancel)}_click(e){var d,f;let t=this.context,s=t.systems.editor.staging.graph,n=t.systems.locations,o=t.projection,a=e.coord,l=o.invert(a);if(n.blocksAt(l).length)return;let c=(d=e==null?void 0:e.target)==null?void 0:d.data,u=(f=e==null?void 0:e.target)==null?void 0:f.choice,h=c&&s.hasEntity(c.id);if((h==null?void 0:h.type)==="node"){this._clickNode(h.loc,h);return}if((h==null?void 0:h.type)==="way"){let p=ti(s.childNodes(h),a,o);if(p&&p.distance<6){let g=[h.nodes[p.index-1],h.nodes[p.index]];this._clickWay(p.loc,g);return}}t.behaviors["map-nudging"].allow(),this._clickNothing(l)}_clickNothing(e){let t=this.context,r=t.systems.editor,s=t.systems.l10n,n=Be({loc:e,tags:this.defaultTags});r.perform(Mt(n)),r.commit({annotation:s.t("operations.add.annotation.point"),selectedIDs:[n.id]}),t.enter("select-osm",{selection:{osm:[n.id]},newFeature:!0})}_clickWay(e,t){let r=this.context,s=r.systems.editor,n=r.systems.l10n,o=Be({tags:this.defaultTags});s.perform(yi({loc:e,edge:t},o)),s.commit({annotation:n.t("operations.add.annotation.vertex"),selectedIDs:[o.id]}),r.enter("select-osm",{selection:{osm:[o.id]},newFeature:!0})}_clickNode(e,t){let r=this.context,s=r.systems.editor,n=r.systems.l10n;if(Object.keys(this.defaultTags).length===0){r.enter("select-osm",{selection:{osm:[t.id]},newFeature:!1});return}let o=Object.assign({},t.tags);for(let a in this.defaultTags)o[a]=this.defaultTags[a];s.perform(vt(t.id,o)),s.commit({annotation:n.t("operations.add.annotation.point"),selectedIDs:[t.id]}),r.enter("select-osm",{selection:{osm:[t.id]},newFeature:!1})}_cancel(){this.context.enter("browse")}};var vT=!1,Fu=class extends Ht{constructor(e){super(e),this.context=e,this.id="browse",this._hover=this._hover.bind(this)}enter(){vT&&console.log("BrowseMode: entering");let e=this.context;return this._active=!0,this.operations=[Pu(e)],e.enableBehaviors(["hover","select","drag","paste","lasso","map-interaction"]),e.behaviors.hover.on("hoverchange",this._hover),document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),!0}exit(){this._active&&(this._active=!1,this.operations=[],vT&&console.log("BrowseMode: exiting"),this.context.behaviors.hover.off("hoverchange",this._hover))}_hover(e){var u;let t=this.context,s=t.systems.editor.staging.graph,n=t.systems.map.renderer.events,o=e.target,a=o==null?void 0:o.data,l=a&&s.hasEntity(a.id);switch((u=l==null?void 0:l.geometry(s))!=null?u:"unknown"){case"area":n.setCursor("areaCursor");break;case"line":n.setCursor("lineCursor");break;case"point":n.setCursor("pointCursor");break;case"vertex":n.setCursor("vertexCursor");break;default:n.setCursor("grab");break}}};var Lu=class extends Ht{constructor(e){super(e),this.id="drag-node",this.dragNode=null,this._reselectIDs=[],this._wasMidpoint=!1,this._startLoc=null,this._clickLoc=null,this._move=this._move.bind(this),this._end=this._end.bind(this),this._cancel=this._cancel.bind(this)}enter(e={}){var f;let t=this.context,r=t.systems.editor,s=t.systems.filters,n=t.systems.l10n,o=t.systems.ui;this._reselectIDs=(f=e.reselectIDs)!=null?f:[];let a=e.midpoint,l=e.nodeID,c=r.staging.graph,u;if(a){if(!c.hasEntity(a.edge[0])||!c.hasEntity(a.edge[1]))return;if(u=Be(),r.perform(yi(a,u)),c=r.staging.graph,u=c.hasEntity(u.id),!u){r.revert();return}this._wasMidpoint=!0}else l&&(u=c.hasEntity(l),this._wasMidpoint=!1);if(!u)return;if(!this._wasMidpoint&&s.hasHiddenConnections(u,c))return o.flash.duration(4e3).iconName("#rapid-icon-no").label(n.t("modes.drag_node.connected_to_hidden"))(),!1;this._active=!0,this.dragNode=u,this._startLoc=u.loc;let h=t.scene();h.classData("osm",this.dragNode.id,"drawing");for(let p of c.parentWays(this.dragNode))h.classData("osm",p.id,"drawing");let d=t.behaviors.drag.lastDown.coord;return this._clickLoc=t.projection.invert(d),t.enableBehaviors(["hover","drag","map-nudging"]),t.behaviors["map-nudging"].allow(),t.behaviors.drag.on("move",this._move).on("end",this._end).on("cancel",this._cancel),!0}exit(){if(!this._active)return;this._active=!1,this.dragNode=null,this._reselectIDs=[],this._wasMidpoint=!1,this._startLoc=null,this._clickLoc=null,this._selectedData.clear();let e=this.context;e.scene().clearClass("drawing"),e.behaviors.drag.off("move",this._move).off("end",this._end).off("cancel",this._cancel)}_refreshEntities(){let r=this.context.systems.editor.staging.graph;if(this._selectedData.clear(),this.dragNode=this.dragNode&&r.hasEntity(this.dragNode.id),!this.dragNode){this._cancel();return}this._selectedData.set(this.dragNode.id,this.dragNode)}_move(e){var d,f;if(!this.dragNode)return;let t=this.context,r=t.systems.editor,s=r.staging.graph,n=t.systems.locations,o=t.projection,a=e.coord,l=(d=e==null?void 0:e.target)==null?void 0:d.data,c=(f=e==null?void 0:e.target)==null?void 0:f.choice,u=l&&s.hasEntity(l.id),h;if((u==null?void 0:u.type)==="node"&&this._canSnapToNode(u))h=u.loc;else if((u==null?void 0:u.type)==="way"){let p=ti(s.childNodes(u),a,o,this.dragNode.id);p&&p.distance<6&&(h=p.loc)}if(!h){let p=t.projection.project(this._clickLoc),m=t.projection.project(this._startLoc),g=Ze(m,p),y=dt(a,g);h=o.invert(y)}if(n.blocksAt(h).length){this._cancel();return}r.perform(bn(this.dragNode.id,h)),this._refreshEntities()}_end(e){var u,h;if(!this.dragNode)return;let t=this.context,r=t.systems.editor,s=t.systems.l10n,n=r.staging.graph,o=(u=e==null?void 0:e.target)==null?void 0:u.data,a=(h=e==null?void 0:e.target)==null?void 0:h.choice,l=o&&n.hasEntity(o.id),c;if((l==null?void 0:l.type)==="node"&&this._canSnapToNode(l))r.perform($a([l.id,this.dragNode.id])),c=this._connectAnnotation(l);else if((l==null?void 0:l.type)==="way"){let d=ti(n.childNodes(l),e.coord,t.projection,this.dragNode.id);if(d&&d.distance<6){let p=[l.nodes[d.index-1],l.nodes[d.index]];r.perform(yi({loc:d.loc,edge:p},this.dragNode)),c=this._connectAnnotation(l)}else c=this._moveAnnotation()}else this._wasMidpoint?c=s.t("operations.add.annotation.vertex"):c=this._moveAnnotation();r.commit({annotation:c,selectedIDs:[this.dragNode.id]}),this._reselectIDs.length?t.enter("select-osm",{selection:{osm:this._reselectIDs}}):t.enter("select-osm",{selection:{osm:[this.dragNode.id]}})}_moveAnnotation(){if(!this.dragNode)return;let e=this.context,r=e.systems.editor.staging.graph,s=e.systems.l10n,n=this.dragNode.geometry(r);return s.t(`operations.move.annotation.${n}`)}_connectAnnotation(e){if(!this.dragNode||!e)return;let t=this.context,s=t.systems.editor.staging.graph,n=t.systems.l10n,o=this.dragNode.geometry(s),a=e.geometry(s);if(o==="vertex"&&a==="vertex"){let l=s.parentWays(this.dragNode),c=s.parentWays(e),u=Vi(l,c);if(u.length!==0)return u[0].areAdjacent(this.dragNode.id,e.id)?n.t("operations.connect.annotation.from_vertex.to_adjacent_vertex"):n.t("operations.connect.annotation.from_vertex.to_sibling_vertex")}return n.t(`operations.connect.annotation.from_${o}.to_${a}`)}_canSnapToNode(e){if(!this.dragNode)return!1;let t=this.context,s=t.systems.editor.staging.graph,n=t.systems.presets;return this.dragNode.geometry(s)!=="vertex"||e.geometry(s)==="vertex"||n.allowsVertex(e,s)}_cancel(){this.context.systems.editor.revert(),this.context.enter("browse")}};var ln=!1,Ou=class extends Ht{constructor(e){super(e),this.id="draw-area",this.defaultTags={},this.drawWayID=null,this.drawNodeID=null,this.firstNodeID=null,this.lastNodeID=null,this._editIndex=null,this._lastCoord=null,this._snapshots=new Map,this._cancel=this._cancel.bind(this),this._click=this._click.bind(this),this._finish=this._finish.bind(this),this._hover=this._hover.bind(this),this._move=this._move.bind(this),this._restoreSnapshot=this._restoreSnapshot.bind(this)}enter(){ln&&console.log("DrawAreaMode: entering");let e=this.context,t=e.systems.editor;return this._active=!0,this.defaultTags={area:"yes"},this.drawWayID=null,this.drawNodeID=null,this.lastNodeID=null,this.firstNodeID=null,this._lastCoord=null,this._selectedData.clear(),e.systems.map.renderer.events.setCursor("crosshair"),e.enableBehaviors(["hover","draw","map-interaction","map-nudging"]),e.behaviors.hover.on("hoverchange",this._hover),e.behaviors.draw.on("move",this._move).on("click",this._click).on("finish",this._finish).on("cancel",this._cancel),t.on("historyjump",this._restoreSnapshot),e.behaviors["map-interaction"].doubleClickEnabled=!1,t.setCheckpoint("beginDraw"),this._editIndex=t.index,!0}exit(){if(!this._active)return;this._active=!1,ln&&console.log("DrawAreaMode: exiting");let e=this.context,t=e.systems.editor,r=e.systems.map.scene;e.systems.map.renderer.events.setCursor("grab"),e.behaviors.hover.off("hoverchange",this._hover),e.behaviors.draw.off("move",this._move).off("click",this._click).off("finish",this._finish).off("cancel",this._cancel),t.off("historyjump",this._restoreSnapshot),t.beginTransaction(),t.revert();let n=t.stable.graph,o=this.drawWayID&&n.hasEntity(this.drawWayID);if(!o||o.isDegenerate())if(ln&&console.log("DrawAreaMode: draw way invalid, rolling back"),t.index>this._editIndex)for(;t.index!==this._editIndex;)t.undo();else t.index<this._editIndex&&t.restoreCheckpoint("beginDraw");this.drawWayID=null,this.drawNodeID=null,this.lastNodeID=null,this.firstNodeID=null,this._editIndex=null,this._lastCoord=null,this._selectedData.clear(),r.clearClass("drawing"),window.setTimeout(()=>{e.behaviors["map-interaction"].doubleClickEnabled=!0},1e3),t.endTransaction()}_refreshEntities(){let e=this.context,t=e.systems.editor,r=e.systems.map.scene;r.clearClass("drawing"),this._selectedData.clear();let s=t.staging.graph,n=this.drawWayID&&s.hasEntity(this.drawWayID),o=this.drawWayID&&s.hasEntity(this.drawNodeID),a=this.lastNodeID&&s.hasEntity(this.lastNodeID),l=this.firstNodeID&&s.hasEntity(this.firstNodeID);if(!n||!a||!l){this._cancel();return}o&&r.classData("osm",o.id,"drawing"),r.classData("osm",n.id,"drawing"),this._selectedData.set(n.id,n)}_getAnnotation(){var l;let e=this.context,r=e.systems.editor.staging.graph,s=e.systems.l10n,n=this.drawWayID&&r.hasEntity(this.drawWayID),o=((l=n==null?void 0:n.nodes)==null?void 0:l.length)||0;if(o<4)return;let a=o>4?"continue":"start";return s.t(`operations.${a}.annotation.area`)}_move(e){var f,p;if(!this.drawWayID)return;let t=this.context,r=t.systems.editor,s=t.projection,n=e.coord,o=s.invert(n),a=this._lastCoord?Ue(n,this._lastCoord):0;this._lastCoord=n;let l=r.staging.graph,c=this.drawNodeID&&l.hasEntity(this.drawNodeID);if(r.beginTransaction(),!c)if(a>1)c=this._addDrawNode(),l=r.staging.graph;else{r.endTransaction();return}let u=(f=e==null?void 0:e.target)==null?void 0:f.data,h=(p=e==null?void 0:e.target)==null?void 0:p.choice,d=u&&l.hasEntity(u.id);if((d==null?void 0:d.type)==="node")o=d.loc;else if((d==null?void 0:d.type)==="way"){let m=ti(l.childNodes(d),n,s,c.id);m&&m.distance<6&&(o=m.loc)}r.perform(bn(c.id,o)),this._refreshEntities(),r.endTransaction()}_click(e){var g,y;let t=this.context,r=t.systems.editor,s=t.systems.locations,n=t.projection,o=e.coord,a=n.invert(o);if(s.blocksAt(a).length)return;t.systems.map.renderer.events.setCursor("crosshair");let c=r.staging.graph,u=this.drawNodeID&&c.hasEntity(this.drawNodeID);r.beginTransaction(),this.drawWayID&&!u&&(u=this._addDrawNode(),c=r.staging.graph),t.behaviors["map-nudging"].allow();let h=(g=e==null?void 0:e.target)==null?void 0:g.data,d=(y=e==null?void 0:e.target)==null?void 0:y.choice,f=h&&c.hasEntity(h.id),p,m;if((f==null?void 0:f.type)==="node")a=f.loc,p=f;else if((f==null?void 0:f.type)==="way"){let x=ti(c.childNodes(f),o,n,this.drawNodeID);x&&x.distance<6&&(a=x.loc,m=[f.nodes[x.index-1],f.nodes[x.index]])}p?this._clickNode(a,p):m?this._clickWay(a,m):this._clickLoc(a)}_clickLoc(e){let s=this.context.systems.editor,n=s.staging.graph,o=this.drawWayID&&n.hasEntity(this.drawWayID),a=this.drawNodeID&&n.hasEntity(this.drawNodeID),l=this.lastNodeID&&n.hasEntity(this.lastNodeID),c=this.firstNodeID&&n.hasEntity(this.firstNodeID);if(o){if(We(e,l.loc,1e-6)||We(e,c.loc,1e-6)){this._finish();return}ln&&console.log(`DrawAreaMode: _clickLoc, extending area to ${e}`);let u=this._getAnnotation();u&&(s.commit({annotation:u,selectedIDs:[o.id]}),this._takeSnapshot(c.id,a.id)),this.lastNodeID=a.id,this._addDrawNode(e)}else ln&&console.log(`DrawAreaMode: _clickLoc, starting area at ${e}`),c=Be({loc:e}),a=Be({loc:e}),o=pt({tags:this.defaultTags,nodes:[c.id,a.id,c.id]}),this.firstNodeID=c.id,this.lastNodeID=c.id,this.drawNodeID=a.id,this.drawWayID=o.id,s.perform(Mt(c),Mt(a),Mt(o));this._refreshEntities(),s.endTransaction()}_clickWay(e,t){let n=this.context.systems.editor,o={loc:e,edge:t},a=n.staging.graph,l=this.drawWayID&&a.hasEntity(this.drawWayID),c=this.drawNodeID&&a.hasEntity(this.drawNodeID),u=this.lastNodeID&&a.hasEntity(this.lastNodeID),h=this.firstNodeID&&a.hasEntity(this.firstNodeID);if(l){if(We(e,u.loc,1e-6)||We(e,h.loc,1e-6)){this._finish();return}ln&&console.log(`DrawAreaMode: _clickWay, extending area to edge ${t}`),n.perform(bn(c.id,e),yi(o,c));let d=this._getAnnotation();d&&(n.commit({annotation:d,selectedIDs:[l.id]}),this._takeSnapshot(h.id,c.id)),this.lastNodeID=c.id,this._addDrawNode(e)}else ln&&console.log(`DrawAreaMode: _clickWay, starting area at edge ${t}`),h=Be({loc:e}),c=Be({loc:e}),l=pt({tags:this.defaultTags,nodes:[h.id,c.id,h.id]}),this.firstNodeID=h.id,this.lastNodeID=h.id,this.drawNodeID=c.id,this.drawWayID=l.id,n.perform(Mt(h),Mt(c),Mt(l),yi(o,h));this._refreshEntities(),n.endTransaction()}_clickNode(e,t){let n=this.context.systems.editor,o=n.staging.graph,a=this.drawWayID&&o.hasEntity(this.drawWayID),l=this.drawNodeID&&o.hasEntity(this.drawNodeID),c=this.lastNodeID&&o.hasEntity(this.lastNodeID),u=this.firstNodeID&&o.hasEntity(this.firstNodeID);if(a){if(t.id===c.id||t.id===u.id||We(e,c.loc,1e-6)||We(e,u.loc,1e-6)){this._finish();return}ln&&console.log(`DrawAreaMode: _clickNode, extending area to ${t.id}`),n.perform(this._actionRemoveDrawNode(a,l),xs(a.id,t.id));let h=this._getAnnotation();h&&(n.commit({annotation:h,selectedIDs:[a.id]}),this._takeSnapshot(u.id,t.id)),this.lastNodeID=t.id,n.perform(Mt(l),xs(a.id,l.id))}else ln&&console.log(`DrawAreaMode: _clickNode, starting line at ${t.id}`),l=Be({loc:e}),a=pt({tags:this.defaultTags,nodes:[t.id,l.id,t.id]}),this.firstNodeID=t.id,this.lastNodeID=t.id,this.drawNodeID=l.id,this.drawWayID=a.id,n.perform(Mt(l),Mt(a));this._refreshEntities(),n.endTransaction()}_actionRemoveDrawNode(e,t){return r=>r.replace(r.entity(e.id).removeNode(t.id)).remove(t)}_addDrawNode(e){let t=this.context,r=t.systems.editor,s=t.systems.map,n=Be({loc:e!=null?e:s.mouseLoc()});return this.drawNodeID=n.id,r.perform(Mt(n),xs(this.drawWayID,n.id)),n}_finish(){let e=this.context,r=e.systems.editor.staging.graph,s=this.drawWayID&&r.hasEntity(this.drawWayID);s?(ln&&console.log(`DrawAreaMode: _finish, drawWay.id = ${s.id}`),e.enter("select-osm",{selection:{osm:[s.id]},newFeature:!0})):e.enter("browse")}_cancel(){ln&&console.log("DrawAreaMode: _cancel"),this.drawWayID=null,this.context.enter("browse")}_takeSnapshot(e,t){let n=this.context.systems.editor.stable.graph,o={drawWayID:this.drawWayID,firstNodeID:e,lastNodeID:t};this._snapshots.set(n,o)}_restoreSnapshot(){var n;let e=this.context,t=e.systems.editor,r=t.stable.graph,s=this._snapshots.get(r);if(s&&s.drawWayID===this.drawWayID)this.firstNodeID=s.firstNodeID,this.lastNodeID=s.lastNodeID,this.drawNodeID=null,this._refreshEntities();else{let a=((n=t.stable.selectedIDs)!=null?n:[]).filter(l=>r.hasEntity(l));a.length?e.enter("select-osm",{selection:{osm:a}}):e.enter("browse")}}_hover(e){var u;let t=this.context,s=t.systems.editor.staging.graph,n=t.systems.map.renderer.events,o=e.target,a=o==null?void 0:o.data,l=a&&s.hasEntity(a.id);switch((u=l==null?void 0:l.geometry(s))!=null?u:"unknown"){case"line":n.setCursor("connectLineCursor");break;case"vertex":n.setCursor("connectVertexCursor");break;default:n.setCursor("crosshair")}}};var Ns=!1,Bu=class extends Ht{constructor(e){super(e),this.id="draw-line",this.defaultTags={},this.drawWayID=null,this.drawNodeID=null,this.firstNodeID=null,this.lastNodeID=null,this._insertIndex=void 0,this._editIndex=null,this._lastCoord=null,this._snapshots=new Map,this._cancel=this._cancel.bind(this),this._click=this._click.bind(this),this._finish=this._finish.bind(this),this._hover=this._hover.bind(this),this._move=this._move.bind(this),this._restoreSnapshot=this._restoreSnapshot.bind(this)}enter(e={}){let t=this.context,r=t.systems.editor,s=r.staging.graph,n=e.continueNodeID,o=e.continueWayID,a=n&&s.hasEntity(n),l=o&&s.hasEntity(o);if(a||l){if(!(a instanceof Be)||!(l instanceof pt))return!1;Ns&&console.log(`DrawLineMode: entering, continuing line ${l.id}`)}else Ns&&console.log("DrawLineMode: entering");if(this._active=!0,this.drawWayID=null,this.drawNodeID=null,this.lastNodeID=null,this.firstNodeID=null,this._insertIndex=void 0,this._lastCoord=null,this._selectedData.clear(),t.systems.map.renderer.events.setCursor("crosshair"),t.enableBehaviors(["hover","draw","map-interaction","map-nudging"]),t.behaviors["map-nudging"].allow(),t.behaviors.hover.on("hoverchange",this._hover),t.behaviors.draw.on("move",this._move).on("click",this._click).on("finish",this._finish).on("cancel",this._cancel),r.on("historyjump",this._restoreSnapshot),t.behaviors["map-interaction"].doubleClickEnabled=!1,r.setCheckpoint("beginDraw"),this._editIndex=r.index,a&&l){let u=l.affix(a.id)==="prefix",h=u?l.last():l.first();this._insertIndex=u?0:void 0,this.drawWayID=o,this.lastNodeID=n,this.firstNodeID=h,this._addDrawNode(),this._refreshEntities()}return!0}exit(){if(!this._active)return;this._active=!1,Ns&&console.log("DrawLineMode: exiting");let e=this.context,t=e.systems.editor,r=e.systems.map.scene;e.systems.map.renderer.events.setCursor("grab"),e.behaviors.hover.off("hoverchange",this._hover),e.behaviors.draw.off("move",this._move).off("click",this._click).off("finish",this._finish).off("cancel",this._cancel),t.off("historyjump",this._restoreSnapshot),t.beginTransaction(),t.revert();let n=t.stable.graph,o=this.drawWayID&&n.hasEntity(this.drawWayID);if(!o||o.isDegenerate())if(Ns&&console.log("DrawLineMode: draw way invalid, rolling back"),t.index>this._editIndex)for(;t.index!==this._editIndex;)t.undo();else t.index<this._editIndex&&t.restoreCheckpoint("beginDraw");this.drawWayID=null,this.drawNodeID=null,this.lastNodeID=null,this.firstNodeID=null,this._insertIndex=void 0,this._editIndex=null,this._lastCoord=null,this._selectedData.clear(),r.clearClass("drawing"),window.setTimeout(()=>{e.behaviors["map-interaction"].doubleClickEnabled=!0},1e3),t.endTransaction()}_refreshEntities(){let e=this.context,t=e.systems.editor,r=e.scene();r.clearClass("drawing"),this._selectedData.clear();let s=t.staging.graph,n=this.drawWayID&&s.hasEntity(this.drawWayID),o=this.drawWayID&&s.hasEntity(this.drawNodeID),a=this.lastNodeID&&s.hasEntity(this.lastNodeID),l=this.firstNodeID&&s.hasEntity(this.firstNodeID);if(!n||!a||!l){this._cancel();return}o&&r.classData("osm",o.id,"drawing"),r.classData("osm",n.id,"drawing"),this._selectedData.set(n.id,n)}_getAnnotation(){var l;let e=this.context,r=e.systems.editor.staging.graph,s=e.systems.l10n,n=this.drawWayID&&r.hasEntity(this.drawWayID),o=((l=n==null?void 0:n.nodes)==null?void 0:l.length)||0;if(o<2)return;let a=o>2?"continue":"start";return s.t(`operations.${a}.annotation.line`)}_move(e){var f,p;if(!this.drawWayID)return;let t=this.context,r=t.systems.editor,s=t.projection,n=e.coord,o=s.invert(n),a=this._lastCoord?Ue(n,this._lastCoord):0;this._lastCoord=n;let l=r.staging.graph,c=this.drawNodeID&&l.hasEntity(this.drawNodeID);if(r.beginTransaction(),!c)if(a>1)c=this._addDrawNode(),l=r.staging.graph;else{r.endTransaction();return}let u=(f=e==null?void 0:e.target)==null?void 0:f.data,h=(p=e==null?void 0:e.target)==null?void 0:p.choice,d=u&&l.hasEntity(u.id);if((d==null?void 0:d.type)==="node")o=d.loc;else if((d==null?void 0:d.type)==="way"){let m=ti(l.childNodes(d),n,s,c.id);m&&m.distance<6&&(o=m.loc)}r.perform(bn(c.id,o)),this._refreshEntities(),r.endTransaction()}_click(e){var g,y;let t=this.context,r=t.systems.editor,s=t.systems.locations,n=t.projection,o=e.coord,a=n.invert(o);if(s.blocksAt(a).length)return;t.systems.map.renderer.events.setCursor("crosshair");let c=r.staging.graph,u=this.drawNodeID&&c.hasEntity(this.drawNodeID);r.beginTransaction(),this.drawWayID&&!u&&(u=this._addDrawNode(),c=r.staging.graph),t.behaviors["map-nudging"].allow();let h=(g=e==null?void 0:e.target)==null?void 0:g.data,d=(y=e==null?void 0:e.target)==null?void 0:y.choice,f=h&&c.hasEntity(h.id),p,m;if((f==null?void 0:f.type)==="node")a=f.loc,p=f;else if((f==null?void 0:f.type)==="way"){let x=ti(c.childNodes(f),o,n,this.drawNodeID);x&&x.distance<6&&(a=x.loc,m=[f.nodes[x.index-1],f.nodes[x.index]])}p?this._clickNode(a,p):m?this._clickWay(a,m):this._clickLoc(a)}_clickLoc(e){let s=this.context.systems.editor,n=s.staging.graph,o=this.drawWayID&&n.hasEntity(this.drawWayID),a=this.drawNodeID&&n.hasEntity(this.drawNodeID),l=this.lastNodeID&&n.hasEntity(this.lastNodeID),c=this.firstNodeID&&n.hasEntity(this.firstNodeID);if(o){if(We(e,l.loc,1e-6)||We(e,c.loc,1e-6)){this._finish();return}Ns&&console.log(`DrawLineMode: _clickLoc, extending line to ${e}`);let u=this._getAnnotation();u&&(s.commit({annotation:u,selectedIDs:[o.id]}),this._takeSnapshot(c.id,a.id)),this.lastNodeID=a.id,this._addDrawNode(e)}else Ns&&console.log(`DrawLineMode: _clickLoc, starting line at ${e}`),c=Be({loc:e}),a=Be({loc:e}),o=pt({tags:this.defaultTags,nodes:[c.id,a.id]}),this.firstNodeID=c.id,this.lastNodeID=c.id,this.drawNodeID=a.id,this.drawWayID=o.id,s.perform(Mt(c),Mt(a),Mt(o));this._refreshEntities(),s.endTransaction()}_clickWay(e,t){let n=this.context.systems.editor,o={loc:e,edge:t},a=n.staging.graph,l=this.drawWayID&&a.hasEntity(this.drawWayID),c=this.drawNodeID&&a.hasEntity(this.drawNodeID),u=this.lastNodeID&&a.hasEntity(this.lastNodeID),h=this.firstNodeID&&a.hasEntity(this.firstNodeID);if(l){if(We(e,u.loc,1e-6)||We(e,h.loc,1e-6)){this._finish();return}Ns&&console.log(`DrawLineMode: _clickWay, extending line to edge ${t}`),n.perform(bn(c.id,e),yi(o,c));let d=this._getAnnotation();d&&(n.commit({annotation:d,selectedIDs:[l.id]}),this._takeSnapshot(h.id,c.id)),this.lastNodeID=c.id,this._addDrawNode(e)}else Ns&&console.log(`DrawLineMode: _clickWay, starting line at edge ${t}`),h=Be({loc:e}),c=Be({loc:e}),l=pt({tags:this.defaultTags,nodes:[h.id,c.id]}),this.firstNodeID=h.id,this.lastNodeID=h.id,this.drawNodeID=c.id,this.drawWayID=l.id,n.perform(Mt(h),Mt(c),Mt(l),yi(o,h));this._refreshEntities(),n.endTransaction()}_clickNode(e,t){let n=this.context.systems.editor,o=n.staging.graph,a=this.drawWayID&&o.hasEntity(this.drawWayID),l=this.drawNodeID&&o.hasEntity(this.drawNodeID),c=this.lastNodeID&&o.hasEntity(this.lastNodeID),u=this.firstNodeID&&o.hasEntity(this.firstNodeID);if(a){if(t.id===c.id||We(e,c.loc,1e-6)){this._finish();return}Ns&&console.log(`DrawLineMode: _clickNode, extending line to ${t.id}`),n.perform(this._actionRemoveDrawNode(a,l),xs(a.id,t.id,this._insertIndex));let h=this._getAnnotation();if(h&&(n.commit({annotation:h,selectedIDs:[a.id]}),this._takeSnapshot(u.id,t.id)),t.id===u.id||We(e,u.loc,1e-6)){this._finish();return}else this.lastNodeID=t.id,n.perform(Mt(l),xs(a.id,l.id,this._insertIndex))}else Ns&&console.log(`DrawLineMode: _clickNode, starting line at ${t.id}`),l=Be({loc:e}),a=pt({tags:this.defaultTags,nodes:[t.id,l.id]}),this.firstNodeID=t.id,this.lastNodeID=t.id,this.drawNodeID=l.id,this.drawWayID=a.id,n.perform(Mt(l),Mt(a));this._refreshEntities(),n.endTransaction()}_actionRemoveDrawNode(e,t){return r=>r.replace(r.entity(e.id).removeNode(t.id)).remove(t)}_addDrawNode(e){let t=this.context,r=t.systems.editor,s=t.systems.map,n=Be({loc:e!=null?e:s.mouseLoc()});return this.drawNodeID=n.id,r.perform(Mt(n),xs(this.drawWayID,n.id,this._insertIndex)),n}_finish(){let e=this.context,r=e.systems.editor.staging.graph,s=this.drawWayID&&r.hasEntity(this.drawWayID);if(s){Ns&&console.log(`DrawLineMode: _finish, drawWay.id = ${s.id}`);let n=Object.keys(s.tags).length===0;e.enter("select-osm",{selection:{osm:[s.id]},newFeature:n})}else e.enter("browse")}_cancel(){Ns&&console.log("DrawLineMode: _cancel"),this.drawWayID=null,this.context.enter("browse")}_takeSnapshot(e,t){let n=this.context.systems.editor.stable.graph,o={drawWayID:this.drawWayID,insertIndex:this._insertIndex,firstNodeID:e,lastNodeID:t};this._snapshots.set(n,o)}_restoreSnapshot(){var n;let e=this.context,t=e.systems.editor,r=t.stable.graph,s=this._snapshots.get(r);if(s&&s.drawWayID===this.drawWayID)this._insertIndex=s.insertIndex,this.firstNodeID=s.firstNodeID,this.lastNodeID=s.lastNodeID,this.drawNodeID=null,this._refreshEntities();else{let a=((n=t.stable.selectedIDs)!=null?n:[]).filter(l=>r.hasEntity(l));a.length?e.enter("select-osm",{selection:{osm:a}}):e.enter("browse")}}_hover(e){var u;let t=this.context,s=t.systems.editor.staging.graph,n=t.systems.map.renderer.events,o=e.target,a=o==null?void 0:o.data,l=a&&s.hasEntity(a.id);switch((u=l==null?void 0:l.geometry(s))!=null?u:"unknown"){case"line":n.setCursor("connectLineCursor");break;case"vertex":n.setCursor("connectVertexCursor");break;default:n.setCursor("crosshair")}}};var Uu=class extends Ht{constructor(e){super(e),this.id="move",this._entityIDs=[],this._startLoc=null,this._movementCache=null,this._cancel=this._cancel.bind(this),this._finish=this._finish.bind(this),this._keydown=this._keydown.bind(this),this._pointermove=this._pointermove.bind(this)}enter(e={}){var h,d;let t=this.context,s=t.systems.editor.staging.graph,n=t.systems.filters,o=t.systems.locations,a=t.systems.map,l=a.renderer.events,u=(d=((h=e.selection)!=null?h:{}).osm)!=null?d:[];this._selectedData=new Map;for(let f of u){let p=s.hasEntity(f);p&&(p.type==="node"&&o.blocksAt(p.loc).length||this._selectedData.set(f,p))}return this._selectedData.size?(this._entityIDs=[...this._selectedData.keys()],this._active=!0,n.forceVisible(this._entityIDs),t.enableBehaviors(["map-interaction","map-nudging"]),t.behaviors["map-nudging"].allow(),this._startLoc=a.mouseLoc(),this._movementCache={},l.on("click",this._finish).on("keydown",this._keydown).on("pointercancel",this._cancel).on("pointermove",this._pointermove),!0):!1}exit(){if(!this._active)return;this._active=!1,this._startLoc=null,this._movementCache=null;let e=this.context,t=e.systems.editor,r=e.systems.filters,s=e.systems.l10n,n=e.systems.map.renderer.events;if(r.forceVisible([]),n.off("click",this._finish).off("keydown",this._keydown).off("pointercancel",this._cancel).off("pointermove",this._pointermove),t.hasWorkInProgress){let o=t.staging.graph,a=this._entityIDs.length===1?s.t("operations.move.annotation."+o.geometry(this._entityIDs[0])):s.t("operations.move.annotation.feature",{n:this._entityIDs.length});t.commit({annotation:a,selectedIDs:this._entityIDs})}}_keydown(e){["Enter"].includes(e.key)?(e.preventDefault(),this._finish()):["Backspace","Delete","Del","Escape","Esc"].includes(e.key)?(e.preventDefault(),this._cancel()):["r","R"].includes(e.key)&&(e.preventDefault(),this._rotateMode())}_pointermove(){let e=this.context,t=e.systems.editor,r=e.systems.locations,n=e.systems.map.mouseLoc();if(r.blocksAt(n).length){this._cancel();return}let o=e.projection.project(this._startLoc),a=e.projection.project(n),l=Ze(a,o);t.revert(),t.perform(_n(this._entityIDs,l,e.projection,this._movementCache));let c=t.staging.graph;this._selectedData.clear();for(let u of this._entityIDs)this._selectedData.set(u,c.entity(u))}_finish(){this.context.enter("select-osm",{selection:{osm:this._entityIDs}})}_rotateMode(){this.context.enter("rotate",{selection:{osm:this._entityIDs}})}_cancel(){let e=this.context;e.systems.editor.revert(),e.enter("select-osm",{selection:{osm:this._entityIDs}})}};var $u=class extends Ht{constructor(e){super(e),this.id="rotate",this._entityIDs=[],this._lastPoint=null,this._pivotLoc=null,this._cancel=this._cancel.bind(this),this._finish=this._finish.bind(this),this._keydown=this._keydown.bind(this),this._pointermove=this._pointermove.bind(this)}enter(e={}){var h,d;let t=this.context,s=t.systems.editor.staging.graph,n=t.systems.filters,o=t.systems.locations,l=t.systems.map.renderer.events,u=(d=((h=e.selection)!=null?h:{}).osm)!=null?d:[];this._selectedData=new Map;for(let f of u){let p=s.hasEntity(f);p&&(p.type==="node"&&o.blocksAt(p.loc).length||this._selectedData.set(f,p))}return this._selectedData.size?(this._entityIDs=[...this._selectedData.keys()],this._active=!0,n.forceVisible(this._entityIDs),t.enableBehaviors(["map-interaction"]),this._lastPoint=null,this._pivotLoc=this._calcPivotLoc(),l.on("click",this._finish).on("keydown",this._keydown).on("pointercancel",this._cancel).on("pointermove",this._pointermove),!0):!1}exit(){if(!this._active)return;this._active=!1;let e=this.context,t=e.systems.editor,r=e.systems.filters,s=e.systems.l10n,n=e.systems.map.renderer.events;if(this._lastPoint=null,this._pivotLoc=null,r.forceVisible([]),n.off("click",this._finish).off("keydown",this._keydown).off("pointercancel",this._cancel).off("pointermove",this._pointermove),t.hasWorkInProgress){let o=t.staging.graph,a=this._entityIDs.length===1?s.t("operations.rotate.annotation."+o.geometry(this._entityIDs[0])):s.t("operations.rotate.annotation.feature",{n:this._entityIDs.length});t.commit({annotation:a,selectedIDs:this._entityIDs})}}_keydown(e){["Enter"].includes(e.key)?(e.preventDefault(),this._finish()):["Backspace","Delete","Del","Escape","Esc"].includes(e.key)?(e.preventDefault(),this._cancel()):["m","M"].includes(e.key)&&(e.preventDefault(),this._moveMode())}_pointermove(){let e=this.context,t=e.systems.editor,s=e.systems.map.renderer.events.coord;if(this._lastPoint){let o=e.projection.project(this._pivotLoc),[a,l]=Ze(s,this._lastPoint),[c,u]=[s[0]>o[0]?1:-1,s[1]>o[1]?-1:1],f=(u*a+c*l)*(Math.PI/180)*.3;t.perform($5(this._entityIDs,o,f,e.projection))}this._lastPoint=s.slice(),this._selectedData.clear();let n=t.staging.graph;for(let o of this._entityIDs)this._selectedData.set(o,n.entity(o))}_calcPivotLoc(){let e=this.context,t=e.projection,r=e.systems.editor.staging.graph,n=Ft(this._entityIDs,r).map(a=>t.project(a.loc)),o;return n.length===1?o=n[0]:n.length===2?o=ct(n[0],n[1],.5):Hs(n).length===2?o=ct(n[0],n[1],.5):o=Pr(Hs(n)),t.invert(o)}_finish(){this.context.enter("select-osm",{selection:{osm:this._entityIDs}})}_moveMode(){this.context.enter("move",{selection:{osm:this._entityIDs}})}_cancel(){let e=this.context;e.systems.editor.revert(),e.enter("select-osm",{selection:{osm:this._entityIDs}})}};var _T=!1,Hu=class extends Ht{constructor(e){super(e),this.id="save",this._keybinding=He("SaveMode"),this._cancel=this._cancel.bind(this),this._hideLoading=this._hideLoading.bind(this),this._keybindingOff=this._keybindingOff.bind(this),this._keybindingOn=this._keybindingOn.bind(this),this._prepareForSuccess=this._prepareForSuccess.bind(this),this._progressChanged=this._progressChanged.bind(this),this._resultConflicts=this._resultConflicts.bind(this),this._resultErrors=this._resultErrors.bind(this),this._resultNoChanges=this._resultNoChanges.bind(this),this._resultSuccess=this._resultSuccess.bind(this),this._saveEnded=this._saveEnded.bind(this),this._saveStarted=this._saveStarted.bind(this),this._showLoading=this._showLoading.bind(this),this._location=null,this._uiConflicts=null,this._uiLoading=null,this._uiSuccess=null,this._wasSuccessfulSave=!1}enter(){let e=this.context,t=e.services.osm,r=e.systems.ui.sidebar,s=e.systems.uploader;return t?(_T&&console.log("SaveMode: entering"),r.expand(),this._active=!0,this._wasSuccessfulSave=!1,this._uiCommit=E6(e).on("cancel",this._cancel),t.authenticated()?r.show(this._uiCommit):t.authenticate(n=>{n?this._cancel():r.show(this._uiCommit)}),e.container().selectAll(".main-content").classed("active",!1).classed("inactive",!0),this._keybindingOn(),e.enableBehaviors(["map-interaction"]),s.on("progressChanged",this._progressChanged).on("resultConflicts",this._resultConflicts).on("resultErrors",this._resultErrors).on("resultNoChanges",this._resultNoChanges).on("resultSuccess",this._resultSuccess).on("saveEnded",this._saveEnded).on("saveStarted",this._saveStarted).on("willAttemptUpload",this._prepareForSuccess),!0):!1}exit(){if(!this._active)return;this._active=!1,_T&&console.log("SaveMode: exiting");let e=this.context,t=e.systems.ui.sidebar,r=e.systems.uploader;this._uiCommit.on("cancel",null),this._uiCommit=null,r.off("progressChanged",this._progressChanged).off("resultConflicts",this._resultConflicts).off("resultErrors",this._resultErrors).off("resultNoChanges",this._resultNoChanges).off("resultSuccess",this._resultSuccess).off("saveEnded",this._saveEnded).off("saveStarted",this._saveStarted).off("willAttemptUpload",this._prepareForSuccess),this._keybindingOff(),this._hideLoading(),e.container().selectAll(".main-content").classed("active",!0).classed("inactive",!1),this._wasSuccessfulSave||t.hide()}_cancel(){this.context.enter("browse")}_progressChanged(e,t){let r=this.context,s=r.systems.l10n,o=r.container().select(".loading-modal .modal-section").selectAll(".progress").data([0]);o.enter().append("div").attr("class","progress").merge(o).text(s.t("save.conflict_progress",{num:e,total:t}))}_resultConflicts(e,t){let r=this.context,s=r.systems.uploader,n=r.container().select(".sidebar").append("div").attr("class","sidebar-component"),o=r.container().selectAll(".main-content");o.classed("active",!0).classed("inactive",!1),this._uiConflicts=A6(r).conflictList(e).origChanges(t).on("cancel",()=>{o.classed("active",!1).classed("inactive",!0),n.remove(),this._keybindingOn(),s.cancelConflictResolution()}).on("save",()=>{o.classed("active",!1).classed("inactive",!0),n.remove(),s.processResolvedConflicts()}),n.call(this._uiConflicts)}_resultErrors(e){let t=this.context,r=t.systems.l10n;this._keybindingOn();let s=Sa(t,t.container());s.select(".modal-section.header").append("h3").text(r.t("save.error")),this._addErrors(s,e),s.okButton()}_addErrors(e,t){let s=this.context.systems.l10n,o=e.select(".modal-section.message-text").selectAll(".error-container").data(t),a=o.enter().append("div").attr("class","error-container");a.append("a").attr("class","error-description").attr("href","#").classed("hide-toggle",!0).text(c=>c.msg||s.t("save.unknown_error_details")).on("click",function(c){c.preventDefault();let u=G(this),h=G(this.nextElementSibling),d=u.classed("expanded");h.style("display",d?"none":"block"),u.classed("expanded",!d)}),a.append("div").attr("class","error-detail-container").style("display","none").append("ul").attr("class","error-detail-list").selectAll("li").data(c=>c.details||[]).enter().append("li").attr("class","error-detail-item").text(c=>c),o.exit().remove()}_resultNoChanges(){let e=this.context;e.resetAsync().then(()=>e.enter("browse"))}_resultSuccess(e){let t=this.context,r=t.systems.ui.sidebar,s=this._uiSuccess.changeset(e).location(this._location).on("cancel",()=>r.hide());this._wasSuccessfulSave=!0,r.show(s),window.setTimeout(()=>{t.resetAsync().then(()=>t.enter("browse"))},2500)}_saveStarted(){this._keybindingOff(),this._showLoading()}_saveEnded(){this._keybindingOn(),this._hideLoading()}_showLoading(){if(this._saveLoading)return;let e=this.context,t=e.systems.l10n;this._saveLoading=Sn(e).message(t.tHtml("save.uploading")).blocking(!0),e.container().call(this._saveLoading)}_hideLoading(){this._saveLoading&&(this._saveLoading.close(),this._saveLoading=null)}_keybindingOn(){G(document).call(this._keybinding.on("\u238B",this._cancel,!0))}_keybindingOff(){G(document).call(this._keybinding.unbind)}_prepareForSuccess(){this._uiSuccess=Sf(this.context),this._location=null;let e=this.context,t=e.systems.l10n,s=e.systems.map.center(),n=e.services.nominatim;n&&n.reverse(s,(o,a)=>{var d,f,p,m,g;if(o||!a||!a.address)return;let l=a.address,c=(p=(f=(d=l==null?void 0:l.town)!=null?d:l==null?void 0:l.city)!=null?f:l==null?void 0:l.county)!=null?p:"",u=(g=(m=l==null?void 0:l.state)!=null?m:l==null?void 0:l.country)!=null?g:"",h=c&&u?t.t("success.thank_you_where.separator"):"";this._location=t.t("success.thank_you_where.format",{place:c,separator:h,region:u})})}};var bT=!1,Gu=class extends Ht{constructor(e){super(e),this.id="select",this.keybinding=null,this.extent=null}enter(e={}){let t=e.selection;if(!(t instanceof Map)||!t.size)return!1;let[[r,s]]=t.entries();bT&&console.log(`SelectMode: entering, selected ${r}`),this._selectedData=t,this._active=!0;let n=this.context;n.enableBehaviors(["hover","select","drag","map-interaction","lasso","paste"]);let o=n.systems.ui.sidebar,a=null;this.extent=new ie;for(let l of t.values()){let c;if(l.loc)c=new ie(l.loc);else if(l.__featurehash__){let u=k7(l);c=new ie(u[0],u[1])}else if(l.__fbid__){let u=n.services[l.__service__];if(!u)continue;let h=u.graph(l.__datasetid__);if(!h)continue;c=l.extent(h)}c&&(this.extent=this.extent.extend(c))}return s instanceof _t?(a=Zc(n).note(s),a.on("change",()=>{n.systems.map.immediateRedraw();let l=n.services.osm,c=l==null?void 0:l.getNote(r);c instanceof _t&&(n.systems.ui.sidebar.show(a.note(c)),this._selectedData.set(r,c))})):s instanceof ut&&s.service==="improveOSM"?(a=Qc(n).error(s),a.on("change",()=>{n.systems.map.immediateRedraw();let l=n.services.improveOSM,c=l==null?void 0:l.getError(r);c instanceof ut&&(n.systems.ui.sidebar.show(a.error(c)),this._selectedData.set(r,c))})):s instanceof ut&&s.service==="keepRight"?(a=Kc(n).error(s),a.on("change",()=>{n.systems.map.immediateRedraw();let l=n.services.keepRight,c=l==null?void 0:l.getError(r);c instanceof ut&&(n.systems.ui.sidebar.show(a.error(c)),this._selectedData.set(r,c))})):s instanceof ut&&s.service==="osmose"?(a=Jc(n).error(s),a.on("change",()=>{n.systems.map.immediateRedraw();let l=n.services.osmose,c=l==null?void 0:l.getError(r);c instanceof ut&&(n.systems.ui.sidebar.show(a.error(c)),this._selectedData.set(r,c))})):s.__featurehash__?a=Vc(n).datum(s):s.__fbid__&&(this.keybinding=He("select-ai-features"),a=e0(n,this.keybinding).datum(s)),a&&o.show(a),!0}exit(){this._active&&(this._active=!1,this.extent=null,this.keybinding&&(G(document).call(this.keybinding.unbind),this.keybinding=null),bT&&console.log("SelectMode: exiting"),this._selectedData.clear(),this.context.systems.ui.sidebar.hide())}};var zu=class extends Ht{constructor(e){super(e),this.id="select-osm",this.keybinding=null,this.extent=null,this._newFeature=!1,this._focusedParentID=null,this._singularDatum=null,this._lastSelectedIDs=[],this._hover=this._hover.bind(this),this._merge=this._merge.bind(this),this._esc=this._esc.bind(this),this._firstVertex=this._firstVertex.bind(this),this._focusNextParent=this._focusNextParent.bind(this),this._lastVertex=this._lastVertex.bind(this),this._nextVertex=this._nextVertex.bind(this),this._previousVertex=this._previousVertex.bind(this),this._hover=this._hover.bind(this),this.nudgeSelection=this.nudgeSelection.bind(this)}enter(e={}){var h,d;let t=this.context,r=t.systems.editor,s=r.staging.graph,n=t.systems.filters,o=t.systems.locations,a=t.systems.ui,l=t.systems.urlhash,u=(d=((h=e.selection)!=null?h:{}).osm)!=null?d:[];this._newFeature=e.newFeature,this._selectedData=new Map,this._singularDatum=null,this._lastSelectedIDs=[];for(let f of u){let p=s.hasEntity(f);p&&(p.type==="node"&&o.blocksAt(p.loc).length||(this._selectedData.set(f,p),u.length===1&&(this._singularDatum=p)))}return this._selectedData.size?(u=[...this._selectedData.keys()],this._active=!0,t.enableBehaviors(["hover","select","drag","map-interaction","lasso","paste"]),a.closeEditMenu(),this.extent=ft(u,s),l.setParam("id",u.join(",")),n.forceVisible(u),this._setupOperations(u),r.on("merge",this._merge),t.behaviors.hover.on("hoverchange",this._hover),this.keybinding=He("select"),this.keybinding.on(["[","pgup"],this._previousVertex).on(["]","pgdown"],this._nextVertex).on(["{",Ie("\u2318["),"home"],this._firstVertex).on(["}",Ie("\u2318]"),"end"],this._lastVertex).on(["\\","pause"],this._focusNextParent).on("\u238B",this._esc,!0).on(Ie("\u2190"),this.nudgeSelection([-5,0])).on(Ie("\u2191"),this.nudgeSelection([0,-5])).on(Ie("\u2192"),this.nudgeSelection([5,0])).on(Ie("\u2193"),this.nudgeSelection([0,5])),G(document).call(this.keybinding),a.sidebar.select(u,this._newFeature),!0):!1}exit(){var c;if(!this._active)return;this._active=!1;let e=this.context,t=e.systems.editor,r=e.systems.filters,s=e.systems.l10n,n=e.systems.ui,o=e.systems.urlhash,a=t.staging.graph,l=a.hasEntity((c=this._singularDatum)==null?void 0:c.id);(l==null?void 0:l.type)==="relation"&&Object.keys(l.tags).length===0&&a.parentRelations(l).length===0&&(l.members.length===0||l.members.length===1&&!l.members[0].role)&&(t.perform(xi(l.id,!0)),t.commit({annotation:s.t("operations.delete.annotation.relation"),selectedIDs:[l.id]})),this.extent=null,this._newFeature=!1,this._singularDatum=null,this._selectedData.clear(),this._lastSelectedIDs=[];for(let u of this.operations)u.behavior&&u.behavior.disable();this.operations=[],n.closeEditMenu(),n.sidebar.hide(),o.setParam("id",null),r.forceVisible([]),this.keybinding&&(G(document).call(this.keybinding.unbind),this.keybinding=null),e.behaviors.hover.off("hoverchange",this._hover),t.off("merge",this._merge)}_esc(){let e=this.context;e.container().select(".combobox").size()||e.enter("browse")}_merge(e){if(!(e instanceof Set))return;let t=[...this._selectedData.keys()],r=!1;for(let s of t)if(e.has(s)){r=!0;break}r&&this._setupOperations(t)}_setupOperations(e){let t=this.context,r=t.systems.ui;for(let s of this.operations)s.behavior&&s.behavior.disable();if(Array.isArray(e)&&e.length){let s={copy:1,downgrade:2,delete:3};this.operations=Object.values(Wg).map(n=>n(t,e)).filter(n=>n.available()).sort((n,o)=>{let a=s[n.id]||0,l=s[o.id]||0;return a-l});for(let n of this.operations)n.behavior&&n.behavior.enable()}r.redrawEditMenu()}_chooseParentWay(e){if(!e)return null;let r=this.context.systems.editor.staging.graph;if(e.type==="way")this._focusedParentID=e.id;else{let s=r.parentWays(e).map(n=>n.id);s.length?s.includes(this._focusedParentID)||(this._focusedParentID=s[0]):this._focusedParentID=null}return r.hasEntity(this._focusedParentID)}nudgeSelection(e){return()=>{let t=this.context,r=t.systems.editor,s=t.projection,n=t.systems.ui;if(!t.editable())return;let o=[...this._selectedData.keys()],a=Mu(t,o);if(a.available())if(a.disabled())n.flash.duration(4e3).iconName(`#rapid-operation-${a.id}`).iconClass("operation disabled").label(a.tooltip)();else{let l=ai(o,this._lastSelectedIDs);l||(this._lastSelectedIDs=o.slice());let c=a.annotation(),u={annotation:c,selectedIDs:o};r.perform(_n(o,e,s)),l&&r.getUndoAnnotation()===c?r.commitAppend(u):r.commit(u)}}}_firstVertex(e){e.preventDefault();let t=this._chooseParentWay(this._singularDatum);if(!t)return;let r=this.context,n=r.systems.editor.staging.graph.entity(t.first());r.enter("select-osm",{selection:{osm:[n.id]}}),r.systems.map.centerEase(n.loc)}_lastVertex(e){e.preventDefault();let t=this._chooseParentWay(this._singularDatum);if(!t)return;let r=this.context,n=r.systems.editor.staging.graph.entity(t.last());r.enter("select-osm",{selection:{osm:[n.id]}}),r.systems.map.centerEase(n.loc)}_previousVertex(e){e.preventDefault();let t=this._singularDatum;if((t==null?void 0:t.type)!=="node")return;let r=this._chooseParentWay(this._singularDatum);if(!r)return;let s=r.nodes.indexOf(t.id),n=-1;if(s>0?n=s-1:r.isClosed()&&(n=length-2),n!==-1){let o=this.context,l=o.systems.editor.staging.graph.entity(r.nodes[n]);o.enter("select-osm",{selection:{osm:[l.id]}}),o.systems.map.centerEase(l.loc)}}_nextVertex(e){e.preventDefault();let t=this._singularDatum;if((t==null?void 0:t.type)!=="node")return;let r=this._chooseParentWay(this._singularDatum);if(!r)return;let s=r.nodes.indexOf(t.id),n=-1;if(s<r.nodes.length-1?n=s+1:r.isClosed()&&(n=0),n!==-1){let o=this.context,l=o.systems.editor.staging.graph.entity(r.nodes[n]);o.enter("select-osm",{selection:{osm:[l.id]}}),o.systems.map.centerEase(l.loc)}}_focusNextParent(e){e.preventDefault();let t=this._singularDatum;if((t==null?void 0:t.type)!=="node")return;let s=this.context.editor.staging.graph.parentWays(t).map(n=>n.id);if(s.length){let o=s.indexOf(this._focusedParentID)+1;o>=s.length&&(o=0),this._focusedParentID=s[o]}}_hover(e){var u;let t=this.context,s=t.systems.editor.staging.graph,n=t.systems.map.renderer.events,o=e.target,a=o==null?void 0:o.data,l=a&&s.hasEntity(a.id);switch((u=l==null?void 0:l.geometry(s))!=null?u:"unknown"){case"area":n.setCursor("areaCursor");break;case"line":n.setCursor("lineCursor");break;case"point":n.setCursor("pointCursor");break;case"unknown":n.setCursor("selectSplitCursor");break;case"vertex":n.setCursor("vertexCursor");break;default:n.setCursor("grab");break}}};function wT(i){let e=i.systems.map;var t={id:"drag-note",button:"browse"};let r=i.behaviors.drag.on("start",u).on("move",h).on("end",f);var s,n,o;function a(p,m){s&&window.clearInterval(s),s=window.setInterval(function(){i.systems.map.pan(m),d(p,m)},50)}function l(){s&&(window.clearInterval(s),s=null)}function c(p){return i.projection.project(p.loc)}function u(p,m){o=m;var g=i.services.osm;g&&(o=g.getNote(o.id)),o.id&&(i.surface().selectAll(".note-"+o.id).classed("active",!0),i.enter(t))}function h(p,m,g){p.stopPropagation(),n=i.projection.invert(g),d(p);var y=T5(g,i.systems.map.dimensions);y?a(p,y):l()}function d(p,m){m=m||[0,0];var g=p&&p.point||i.projection.project(n),y=Ze(g,m),x=i.projection.invert(y);o=o.move(x);var b=i.services.osm;b&&b.replaceNote(o),e.immediateRedraw()}function f(){e.immediateRedraw();let p=new Map().set(o.id,o);i.enter("select",{selection:p})}return t.enter=function(){return i.enableBehaviors(["hover","drag","map-interaction"]),!0},t.exit=function(){i.systems.ui.sidebar.hover.cancel(),i.surface().selectAll(".active").classed("active",!1),l()},t}var jr={available:new Map};jr.available.set("add-note",Ru);jr.available.set("add-point",Nu);jr.available.set("browse",Fu);jr.available.set("drag-node",Lu);jr.available.set("draw-area",Ou);jr.available.set("draw-line",Bu);jr.available.set("move",Uu);jr.available.set("rotate",$u);jr.available.set("save",Hu);jr.available.set("select",Gu);jr.available.set("select-osm",zu);var uG="bdf6c800b3ae453b9db239e03d7c1727",hG="https://openstreetmap.maps.arcgis.com/sharing/rest/content",dG="https://openstreetmap.maps.arcgis.com/home",fG=14,ju=class extends Ce{constructor(e){super(e),this.id="esri",this.context=e,this._tiler=new Jt().zoomRange(fG),this._datasets={},this._gotDatasets=!1,this._parseDataset=this._parseDataset.bind(this)}initAsync(){return this.resetAsync()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){for(let e of Object.values(this._datasets))e.cache.inflight&&Object.values(e.cache.inflight).forEach(t=>this._abortRequest(t)),e.graph=new di,e.tree=new Jr(e.graph),e.cache={inflight:{},loaded:{},seen:{}};return Promise.resolve()}getData(e){let t=this._datasets[e];if(!t||!t.tree||!t.graph)return[];let r=this.context.systems.map.extent();return t.tree.intersects(r,t.graph)}loadTiles(e){if(this._paused)return;let t=this._datasets[e];if(!t||!t.layer)return;let r=t.cache,s=this.context.systems.locations,n=this.context.projection,o=this._tiler.getTiles(n).tiles;for(let a of Object.keys(r.inflight))o.find(c=>c.id===a)||(this._abortRequest(r.inflight[a]),delete r.inflight[a]);for(let a of o){if(r.loaded[a.id]||r.inflight[a.id])continue;if(a.wgs84Extent.polygon().slice(0,4).every(u=>s.blocksAt(u).length)){r.loaded[a.id]=!0;continue}this._loadTilePage(t,a,0)}}graph(e){let t=this._datasets[e];return t==null?void 0:t.graph}loadDatasetsAsync(){if(this._gotDatasets)return Promise.resolve(this._datasets);{let e=this;return new Promise((t,r)=>{n(1);function n(o){fetch(e._searchURL(o)).then(Me).then(a=>{var l;for(let c of(l=a.results)!=null?l:[])e._parseDataset(c);a.nextStart>0?n(a.nextStart):(e._gotDatasets=!0,t(e._datasets))}).catch(a=>{e._gotDatasets=!1,r(a)})}})}}loadLayerAsync(e){let t=this._datasets[e];return!t||!t.url?Promise.reject(`Unknown datasetID: ${e}`):t.layer?Promise.resolve(t.layer):fetch(this._layerURL(t.url)).then(Me).then(r=>{if(!r.layers||!r.layers.length)throw new Error(`Missing layer info for datasetID: ${e}`);t.layer=r.layers[0];let s={};for(let n of t.layer.fields)n.type==="esriFieldTypeOID"&&(t.layer.idfield=n.name),n.editable&&(s[n.name]=n.alias);return t.layer.tagmap=s,t.layer}).catch(r=>{r.name!=="AbortError"&&console.error(r)})}_abortRequest(e){e.abort()}_searchURL(e){let t={f:"json",sortField:"title",sortOrder:"asc",num:100,start:e};return`${hG}/groups/${uG}/search?`+tt(t)}_layerURL(e){return`${e}/layers?f=json`}_itemURL(e){return`${dG}/item.html?id=${e}`}_tileURL(e,t,r){r=r||0;let s=e.layer.id,n=e.layer.maxRecordCount||2e3,o=n*r,a={f:"geojson",outfields:"*",outSR:4326,geometryType:"esriGeometryEnvelope",geometry:t.toParam(),resultOffset:o,resultRecordCount:n};return`${e.url}/${s}/query?`+tt(a)}_parseDataset(e){if(this._datasets[e.id])return;this._datasets[e.id]=e,e.graph=new di,e.tree=new Jr(e.graph),e.cache={inflight:{},loaded:{},seen:{}};let t=G(document.createElement("div"));t.html(e.licenseInfo),t.selectAll("*").attr("style",null).attr("size",null),e.license_html=t.html(),e.itemURL=this._itemURL(e.id)}_loadTilePage(e,t,r){let s=e.cache;if(s.loaded[t.id])return;let n=new AbortController,o=this._tileURL(e,t.wgs84Extent,r);fetch(o,{signal:n.signal}).then(Me).then(a=>{var l;if(!a)throw new Error("no geojson");return this._parseTile(e,t,a,(c,u)=>{if(c)throw new Error(c);e.graph.rebase(u,[e.graph],!0),e.tree.rebase(u,!0)}),(l=a.properties)==null?void 0:l.exceededTransferLimit}).then(a=>{a?this._loadTilePage(e,t,++r):(s.loaded[t.id]=!0,delete s.inflight[t.id],this.context.deferredRedraw(),this.emit("loadedData"))}).catch(a=>{a.name!=="AbortError"&&console.error(a)}),s.inflight[t.id]=n}_parseTile(e,t,r,s){var o;if(!r)return s({message:"No GeoJSON",status:-1});let n=[];for(let a of(o=r.features)!=null?o:[]){let l=this._parseFeature(a,e);l&&n.push.apply(n,l)}s(null,n)}_parseFeature(e,t){var f;let r=e.geometry,s=e.properties;if(!r||!s)return null;let n=s[t.layer.idfield]||s.OBJECTID||s.FID||s.id;if(!n||t.cache.seen[n])return null;t.cache.seen[n]=!0;let a={__fbid__:`${t.id}-${n}`,__service__:"esri",__datasetid__:t.id},l=[],c=new Map;if(r.type==="Point")return[new Be({loc:r.coordinates,tags:h(s)},a)];if(r.type==="LineString"){let p=u(r.coordinates);if(p.length<2)return null;let m=new pt({nodes:p,tags:h(s)},a);return l.push(m),l}else if(r.type==="Polygon"){let p=[];for(let m of(f=r.coordinates)!=null?f:[]){let g=u(m);if(g.length<3)continue;let y=g[0],x=g[g.length-1];y!==x&&g.push(y);let b=new pt({nodes:g});p.push(b)}if(p.length===1)l.push(p[0].update(Object.assign({tags:h(s)},a)));else{let m=p.map((x,b)=>(l.push(x),{id:x.id,role:b===0?"outer":"inner",type:"way"})),g=Object.assign(h(s),{type:"multipolygon"}),y=new Qt({members:m,tags:g},a);l.push(y)}return l}function u(p){let m=[];for(let g of p){let y=g.toString(),x=c.get(y);x||(x=new Be({loc:g}),l.push(x),c.set(y,x)),m.push(x.id)}return m}function h(p){let m={};for(let y of Object.keys(p)){let x=d(t.layer.tagmap[y]),b=d(p[y]);x&&b&&(m[x]=b)}let g=`${t.name}`;return g.startsWith("Google_Buildings_for")&&(g="Google_Open_Buildings"),m.source=`esri/${g}`,m}function d(p){return p?p.toString().trim():null}}};var ET=et(Zr(),1);var pG=14,Yf={ow:"https://community.improveosm.org/directionOfFlowService",mr:"https://community.improveosm.org/missingGeoService",tr:"https://community.improveosm.org/turnRestrictionService"},Pl=new Map;Pl.set("tr",15473700);Pl.set("ow",2003199);Pl.set("mr-road",11817677);Pl.set("mr-path",10506797);Pl.set("mr-parking",15658496);Pl.set("mr-both",16753920);var Vu=class extends Ce{constructor(e){super(e),this.id="improveOSM",this.autoStart=!1,this._impOsmData={icons:{}},this._cache=null,this._tiler=new Jt().zoomRange(pG).skipNullIsland(!0)}initAsync(){return this.resetAsync()}startAsync(){return this.context.systems.dataloader.getDataAsync("qa_data").then(t=>{this._impOsmData=t.improveOSM,this._started=!0})}resetAsync(){if(this._cache)for(let e of Object.values(this._cache.inflightTile))this._abortRequest(e);return this._cache={data:{},loadedTile:{},inflightTile:{},inflightPost:{},closed:{},rtree:new ET.default},Promise.resolve()}getData(){let e=this.context.systems.map.extent();return this._cache.rtree.search(e.bbox()).map(t=>t.data)}loadTiles(){let e={client:"Rapid",status:"OPEN",zoom:"19"},t=this.context,r=t.systems.l10n,s=this._tiler.getTiles(t.projection).tiles;this._abortUnwantedRequests(this._cache,s);for(let n of s){if(this._cache.loadedTile[n.id]||this._cache.inflightTile[n.id])continue;let[o,a,l,c]=n.wgs84Extent.rectangle(),u=Object.assign({},e,{east:o,south:c,west:l,north:a}),h={};for(let d of Object.keys(Yf)){let f=Object.assign({},u,d==="mr"?{type:"PARKING,ROAD,BOTH,PATH"}:{confidenceLevel:"C1"}),p=`${Yf[d]}/search?`+tt(f),m=new AbortController;h[d]=m,fetch(p,{signal:m.signal}).then(Me).then(g=>{delete this._cache.inflightTile[n.id][d],Object.keys(this._cache.inflightTile[n.id]).length||(delete this._cache.inflightTile[n.id],this._cache.loadedTile[n.id]=!0),g.roadSegments&&g.roadSegments.forEach(y=>{let{points:x,wayId:b,fromNodeId:_,toNodeId:w}=y,A=`${b}${_}${w}`,k=x.length/2,v;k%1===0?v=this._pointAverage([x[k-1],x[k]]):(k=x[Math.floor(k)],v=[k.lon,k.lat]),v=this._preventCoincident(v,!1);let E=new ut(v,this,d,A,{issueKey:d,identifier:{wayId:b,fromNodeId:_,toNodeId:w},objectId:b,objectType:"way"});E.replacements={percentage:y.percentOfTrips,num_trips:y.numberOfTrips,highway:this._linkErrorObject(r.t("QA.keepRight.error_parts.highway")),from_node:this._linkEntity("n"+y.fromNodeId),to_node:this._linkEntity("n"+y.toNodeId)},this._cache.data[E.id]=E,this._cache.rtree.insert(this._encodeIssueRtree(E))}),g.tiles&&g.tiles.forEach(y=>{let{type:x,x:b,y:_,numberOfTrips:w}=y,A=x.toLowerCase(),k=`${A}${b}${_}${w}`,v=this._pointAverage(y.points);v=this._preventCoincident(v,!1);let E=new ut(v,this,`${d}-${A}`,k,{issueKey:d,identifier:{x:b,y:_}});E.replacements={num_trips:w,geometry_type:r.t(`QA.improveOSM.geometry_types.${A}`)},w===-1&&(E.desc=r.t("QA.improveOSM.error_types.mr.description_alt",E.replacements)),this._cache.data[E.id]=E,this._cache.rtree.insert(this._encodeIssueRtree(E))}),g.entities&&g.entities.forEach(y=>{let{point:x,id:b,segments:_,numberOfPasses:w,turnType:A}=y,k=`${b.replace(/[,:+#]/g,"_")}`,v=this._preventCoincident([x.lon,x.lat],!0),E=b.split(","),S=E[0],M=E[3],I=E[2].split(":")[1],T=new ut(v,this,d,k,{issueKey:d,identifier:b,objectId:M,objectType:"node"}),[C,P]=_[0].points,D=this._cardinalDirection(this._relativeBearing(C,P));T.replacements={num_passed:w,num_trips:_[0].numberOfTrips,turn_restriction:A.toLowerCase(),from_way:this._linkEntity("w"+S),to_way:this._linkEntity("w"+I),travel_direction:D,junction:this._linkErrorObject(r.t("QA.keepRight.error_parts.this_node"))},this._cache.data[T.id]=T,this._cache.rtree.insert(this._encodeIssueRtree(T)),this.context.deferredRedraw(),this.emit("loadedData")})}).catch(g=>{console.error(g),delete this._cache.inflightTile[n.id][d],Object.keys(this._cache.inflightTile[n.id]).length||(delete this._cache.inflightTile[n.id],this._cache.loadedTile[n.id]=!0)})}this._cache.inflightTile[n.id]=h}}getCommentsAsync(e){if(e.comments)return Promise.resolve(e);let t=e.issueKey,r={};t==="ow"?r=e.identifier:t==="mr"?(r.tileX=e.identifier.x,r.tileY=e.identifier.y):t==="tr"&&(r.targetId=e.identifier);let s=`${Yf[t]}/retrieveComments?`+tt(r),n=o=>{e.comments=o.comments?o.comments.reverse():[],this.replaceItem(e)};return fetch(s).then(Me).then(n).then(()=>e)}postUpdate(e,t){let r=this.context.services.osm;if(!r||!r.authenticated())return t({message:"Not Authenticated",status:-3},e);if(this._cache.inflightPost[e.id])return t({message:"Error update already inflight",status:-2},e);r.userDetails(s.bind(this));function s(n,o){if(n)return t(n,e);let a=e.issueKey,l=`${Yf[a]}/comment`,c={username:o.display_name,targetIds:[e.identifier]};e.newStatus&&(c.status=e.newStatus,c.text="status changed"),e.newComment&&(c.text=e.newComment);let u=new AbortController;this._cache.inflightPost[e.id]=u;let h={method:"POST",signal:u.signal,body:JSON.stringify(c)};fetch(l,h).then(Me).then(()=>{if(delete this._cache.inflightPost[e.id],e.newStatus)this.removeItem(e),e.newStatus==="SOLVED"&&(e.issueKey in this._cache.closed||(this._cache.closed[e.issueKey]=0),this._cache.closed[e.issueKey]+=1);else{let d=new Date,f=e.comments?e.comments:[];f.push({username:c.username,text:c.text,timestamp:d.getTime()/1e3}),this.replaceItem(e.update({comments:f,newComment:void 0}))}t&&t(null,e)}).catch(d=>{delete this._cache.inflightPost[e.id],t&&t(d.message)})}}getError(e){return this._cache.data[e]}getColor(e){var t;return(t=Pl.get(e))!=null?t:16777215}getIcon(e){return this._impOsmData.icons[e]}replaceItem(e){if(!(!(e instanceof ut)||!e.id))return this._cache.data[e.id]=e,this._updateRtree(this._encodeIssueRtree(e),!0),e}removeItem(e){!(e instanceof ut)||!e.id||(delete this._cache.data[e.id],this._updateRtree(this._encodeIssueRtree(e),!1))}getClosedCounts(){return this._cache.closed}_abortRequest(e){for(let t of Object.values(e))t.abort()}_abortUnwantedRequests(e,t){for(let r of Object.keys(e.inflightTile))t.find(n=>r===n.id)||(this._abortRequest(e.inflightTile[r]),delete e.inflightTile[r])}_encodeIssueRtree(e){return{minX:e.loc[0],minY:e.loc[1],maxX:e.loc[0],maxY:e.loc[1],data:e}}_updateRtree(e,t){this._cache.rtree.remove(e,(r,s)=>r.data.id===s.data.id),t&&this._cache.rtree.insert(e)}_linkErrorObject(e){return`<a class="error_object_link">${e}</a>`}_linkEntity(e){return`<a class="error_entity_link">${e}</a>`}_pointAverage(e){if(e.length){let t=e.reduce((r,s)=>dt(r,[s.lon,s.lat]),[0,0]);return mr(t,1/e.length)}else return[0,0]}_relativeBearing(e,t){let r=Math.atan2(t.lon-e.lon,t.lat-e.lat);return r<0&&(r+=2*Math.PI),r*180/Math.PI}_cardinalDirection(e){let t=45*Math.round(e/45),r={0:"north",45:"northeast",90:"east",135:"southeast",180:"south",225:"southwest",270:"west",315:"northwest",360:"north"};return this.context.systems.l10n.t(`QA.improveOSM.directions.${r[t]}`)}_preventCoincident(e,t){let r=!1;do{e=dt(e,r?[1e-5,0]:t?[0,1e-5]:[0,0]);let n=new ie(e).bbox();r=this._cache.rtree.search(n).length}while(r);return e}};var CT=et(Zr(),1);var AT="https://kartaview.org",mG="https://api.openstreetcam.org",ST=1e3,gG=14,Wu=class extends Ce{constructor(e){super(e),this.id="kartaview",this.autoStart=!1,this._imgZoom=Jl().extent([[0,0],[320,240]]).translateExtent([[0,0],[320,240]]).scaleExtent([1,15]),this._cache={},this._selectedImage=null,this._waitingForPhotoID=null,this._startPromise=null,this._tiler=new Jt().zoomRange(gG).skipNullIsland(!0),this.fetchedSequences=new Set,this._zoomPan=this._zoomPan.bind(this)}initAsync(){return this.resetAsync()}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context,r=e.container().select(".photoviewer").selectAll(".osc-wrapper").data([0]).enter().append("div").attr("class","photo-wrapper osc-wrapper").classed("hide",!0).call(this._imgZoom.on("zoom",this._zoomPan)).on("dblclick.zoom",null);r.append("div").attr("class","photo-attribution fillD");let s=r.append("div").attr("class","photo-controls-wrap").append("div").attr("class","photo-controls");return s.append("button").on("click.back",()=>this._step(-1)).html("\u25C4"),s.append("button").on("click.rotate-ccw",()=>this._rotate(-90)).html("\u293F"),s.append("button").on("click.rotate-cw",()=>this._rotate(90)).html("\u293E"),s.append("button").on("click.forward",()=>this._step(1)).html("\u25BA"),r.append("div").attr("class","osc-image-wrap"),e.systems.ui.photoviewer.on("resize.kartaview",n=>{this._imgZoom=Jl().extent([[0,0],n]).translateExtent([[0,0],n]).scaleExtent([1,15]).on("zoom",this._zoomPan)}),this._started=!0,this._startPromise=Promise.resolve()}resetAsync(){if(this._cache.inflight)for(let e of this._cache.inflight.values())e.controller.abort();return this._cache={inflight:new Map,loaded:new Set,nextPage:new Map,images:new Map,sequences:new Map,rtree:new CT.default},this._selectedImage=null,Promise.resolve()}getImages(){let e=this.context.systems.map.extent();return this._cache.rtree.search(e.bbox()).map(t=>t.data)}getSequences(){var s,n,o;let e=this.context.systems.map.extent(),t=new Set;for(let a of this._cache.rtree.search(e.bbox()))a.data.sequenceID&&t.add(a.data.sequenceID);let r=[];for(let a of t){let l=this._cache.sequences.get(a),c=(s=l==null?void 0:l.images)!=null?s:[];c.length&&r.push({type:"LineString",properties:{id:a,v:l.v,captured_at:(n=c[0])==null?void 0:n.captured_at,captured_by:(o=c[0])==null?void 0:o.captured_by},coordinates:c.map(u=>u.loc).filter(Boolean)})}return r}loadTiles(){let e=this.context.projection,t=Math.floor(Yr(e.scale())),r=this._tiler.getTiles(e).tiles;for(let[s,n]of this._cache.inflight)r.find(a=>s.indexOf(a.id)===0)||n.controller.abort();for(let s of r)this._loadNextTilePage(t,s)}showViewer(){let e=this.context.container().select(".photoviewer").classed("hide",!1);e.selectAll(".photo-wrapper.osc-wrapper.hide").size()&&(e.selectAll(".photo-wrapper:not(.osc-wrapper)").classed("hide",!0),e.selectAll(".photo-wrapper.osc-wrapper").classed("hide",!1))}hideViewer(){this._selectedImage=null;let e=this.context;e.systems.photos.selectPhoto(null);let t=e.container().select(".photoviewer");t.empty()||t.datum(null),t.classed("hide",!0).selectAll(".photo-wrapper").classed("hide",!0),e.container().selectAll(".viewfield-group, .sequence, .icon-sign").classed("currentView",!1),this.setStyles(e,null,!0),this.emit("imageChanged")}selectImageAsync(e){var c;let t=this._cache.images.get(e);this._selectedImage=t;let r=this.context;if(!r.container())return;let s=r.container().select(".photoviewer");if(s.empty()||s.datum(t),this.setStyles(r,null,!0),r.container().selectAll(".icon-sign").classed("currentView",!1),e&&!t&&(this._waitingForPhotoID=e),!t)return Promise.resolve();let n=r.container().select(".photoviewer .osc-wrapper"),o=n.selectAll(".osc-image-wrap"),a=n.selectAll(".photo-attribution").html("");if(n.transition().duration(100).call(this._imgZoom.transform,ps),o.selectAll(".osc-image").remove(),t){let u=this._cache.sequences.get(t.sequenceID),h=(c=u==null?void 0:u.rotation)!=null?c:0;o.append("img").attr("class","osc-image").attr("src",`${AT}/${t.storageNum}/files/photo/${t.imagePath}`).style("transform",`rotate(${h}deg)`),t.captured_at&&(a.append("span").attr("class","captured_at").text(l(t.captured_at)),a.append("span").text("|")),a.append("a").attr("class","image-link").attr("target","_blank").attr("href",`https://kartaview.org/details/${t.sequenceID}/${t.sequenceIndex}/track-info`).text("kartaview.org")}return Promise.resolve();function l(u){if(!u)return null;let h={day:"numeric",month:"short",year:"numeric"},d=new Date(u);if(isNaN(d.getTime()))return null;let f=r.systems.l10n.localeCode();return d.toLocaleDateString(f,h)}}setStyles(e,t,r){r&&(e.container().selectAll(".viewfield-group").classed("highlighted",!1).classed("hovered",!1).classed("currentView",!1),e.container().selectAll(".sequence").classed("highlighted",!1).classed("currentView",!1));let s=t==null?void 0:t.id,n=t==null?void 0:t.sequenceID,o=n&&this._cache.sequences.get(n),a=o&&o.images.map(function(g){return g.id})||[],l=e.container().select(".photoviewer"),c=l.empty()?void 0:l.datum(),u=c==null?void 0:c.id,h=c==null?void 0:c.sequenceID,d=h&&this._cache.sequences.get(h),f=d&&d.images.map(function(g){return g.id})||[],p=Gt(a,f);e.container().selectAll(".layer-kartaview .viewfield-group").classed("highlighted",function(g){return p.indexOf(g.id)!==-1}).classed("hovered",function(g){return g.id===s}).classed("currentView",function(g){return g.id===u}),e.container().selectAll(".layer-kartaview .sequence").classed("highlighted",function(g){return g.properties.id===n}).classed("currentView",function(g){return g.properties.id===h}),e.container().selectAll(".layer-kartaview .viewfield-group .viewfield").attr("d",m);function m(){let g=this.parentNode.__data__;return g.isPano&&g.id!==u?"M 8,13 m -10,0 a 10,10 0 1,0 20,0 a 10,10 0 1,0 -20,0":"M 6,9 C 8,8.4 8,8.4 10,9 L 16,-2 C 12,-5 4,-5 0,-2 z"}}_maxPageAtZoom(e){if(e<15)return 2;if(e===15)return 5;if(e===16)return 10;if(e===17)return 20;if(e===18)return 40;if(e>18)return 80}_loadNextTilePage(e,t){var h;let r=t.wgs84Extent.bbox(),s=this._maxPageAtZoom(e),n=(h=this._cache.nextPage.get(t.id))!=null?h:1;if(n>s)return;let o=`${t.id},${n}`;if(this._cache.loaded.has(o)||this._cache.inflight.has(o))return;let a=tt({ipp:ST,page:n,bbTopLeft:[r.maxY,r.minX].join(","),bbBottomRight:[r.minY,r.maxX].join(",")},!0),l=new AbortController,c={method:"POST",signal:l.signal,body:a,headers:{"Content-Type":"application/x-www-form-urlencoded"}},u=`${AT}/1.0/list/nearby-photos/`;fetch(u,c).then(Me).then(d=>{if(this._cache.loaded.add(o),!d||!d.currentPageItems||!d.currentPageItems.length)throw new Error("No Data");d.currentPageItems.map(p=>p.sequence_id).forEach(p=>{this._fetchImagesForSequence(p)}),d.currentPageItems.length===ST?(this._cache.nextPage.set(t.id,n+1),this._loadNextTilePage(e,t)):this._cache.nextPage.set(t.id,1/0),this.context.deferredRedraw(),this.emit("loadedData")}).catch(d=>{d.name!=="AbortError"&&d instanceof Error&&console.error(d)}).finally(()=>{this._cache.inflight.delete(o)}),this._cache.inflight.set(o,{promise:null,controller:l})}_fetchImagesForSequence(e){if(!e){console.error("Invalid sequenceID:",e);return}if(this.fetchedSequences.has(e))return;this.fetchedSequences.add(e);let t=new AbortController,r=`${mG}/2.0/photo/?sequenceId=${e}`,s={method:"GET",signal:t.signal,headers:{"Content-Type":"application/x-www-form-urlencoded"}};fetch(r,s).then(Me).then(n=>{if(n&&n.result&&n.result.data){let o=n.result.data.map(a=>{let l=[+a.lng,+a.lat],c={id:a.id,loc:l,ca:+a.heading,captured_at:a.shotDate||a.dateAdded,storageNum:a.storage,imagePath:a.filepathLTh,sequenceID:a.sequenceId,sequenceIndex:+a.sequenceIndex};this._cache.images.set(a.id,c);let u=this._cache.sequences.get(c.sequenceID);return u||(u={rotation:0,images:[],v:0},this._cache.sequences.set(c.sequenceID,u)),u.images[c.sequenceIndex]=c,u.v++,{minX:l[0],minY:l[1],maxX:l[0],maxY:l[1],data:c}}).filter(Boolean);this._cache.rtree.load(o)}}).catch(n=>{n instanceof Error&&console.error(n)})}_zoomPan(e){let t=e.transform;this.context.container().select(".photoviewer .osc-image-wrap").call(gs,t.x,t.y,t.k)}_rotate(e){if(!this._selectedImage)return;let t=this._selectedImage.sequenceID,r=this._cache.sequences.get(t);if(!r)return;let s=r.rotation||0;s+=e,s>180&&(s-=360),s<-180&&(s+=360),r.rotation=s;let n=this.context.container().select(".photoviewer .osc-wrapper");n.transition().duration(100).call(this._imgZoom.transform,ps),n.selectAll(".osc-image").transition().duration(100).style("transform",`rotate(${s}deg)`)}_step(e){if(!this._selectedImage)return;let t=this._selectedImage.sequenceID,r=this._cache.sequences.get(t);if(!r)return;let s=this._selectedImage.sequenceIndex+e,n=r.images[s];if(!n)return;let o=this.context;o.systems.map.centerEase(n.loc),o.systems.photos.selectPhoto("kartaview",n.id),this.emit("imageChanged")}};var kT=et(Zr(),1);var Kg="https://www.keepright.at",yG=14,xG=[30,40,50,60,70,90,100,110,120,130,150,160,170,180,190,191,192,193,194,195,196,197,198,200,201,202,203,204,205,206,207,208,210,220,230,231,232,270,280,281,282,283,284,285,290,291,292,293,294,295,296,297,298,300,310,311,312,313,320,350,360,370,380,390,400,401,402,410,411,412,413],Gi=new Map;["20","40","210","270","310","320","350"].forEach(i=>Gi.set(i,16777113));["60","70","90","100","110","150","220","380"].forEach(i=>Gi.set(i,5627136));["360","370","410"].forEach(i=>Gi.set(i,16751035));Gi.set("50",16777113);Gi.set("120",13382485);Gi.set("130",16755251);Gi.set("160",12281344);Gi.set("170",16776960);Gi.set("180",11193582);Gi.set("190",16724787);Gi.set("200",16629615);Gi.set("230",12281344);Gi.set("280",6244256);Gi.set("290",11193582);Gi.set("300",39168);Gi.set("390",39168);Gi.set("400",13382485);var Xu=class extends Ce{constructor(e){super(e),this.id="keepRight",this.autoStart=!1,this._krData={errorTypes:{},localizeStrings:{}},this._cache=null,this._tiler=new Jt().zoomRange(yG).skipNullIsland(!0)}initAsync(){return this.resetAsync()}startAsync(){return this.context.systems.dataloader.getDataAsync("keepRight").then(t=>{this._krData=t,this._started=!0})}resetAsync(){return this._cache&&Object.values(this._cache.inflightTile).forEach(e=>this._abortRequest(e)),this._cache={data:{},loadedTile:{},inflightTile:{},inflightPost:{},closed:{},rtree:new kT.default},Promise.resolve()}getData(){let e=this.context.systems.map.extent();return this._cache.rtree.search(e.bbox()).map(t=>t.data)}loadTiles(){let e={format:"geojson",ch:xG},t=this.context.projection,r=this._tiler.getTiles(t).tiles;this._abortUnwantedRequests(this._cache,r);for(let s of r){if(this._cache.loadedTile[s.id]||this._cache.inflightTile[s.id])continue;let[n,o,a,l]=s.wgs84Extent.rectangle(),c=Object.assign({},e,{left:n,bottom:l,right:a,top:o}),u=`${Kg}/export.php?`+tt(c),h=new AbortController;this._cache.inflightTile[s.id]=h,fetch(u,{signal:h.signal}).then(Me).then(d=>{if(delete this._cache.inflightTile[s.id],this._cache.loadedTile[s.id]=!0,!d||!d.features||!d.features.length)throw new Error("No Data");for(let f of d.features){let{properties:{error_type:p,error_id:m,comment:g=null,object_id:y,object_type:x,schema:b,title:_}}=f,{geometry:{coordinates:w},properties:{description:A=""}}=f,k=this._krData.errorTypes[p],v=(Math.floor(p/10)*10).toString(),E=k?p:v,S=this._krData.errorTypes[E];switch(E){case"170":A=`This feature has a FIXME tag: ${A}`;break;case"292":case"293":A=A.replace("A turn-","This turn-");break;case"294":case"295":case"296":case"297":case"298":A=`This turn-restriction~${A}`;break;case"300":A="This highway is missing a maxspeed tag";break;case"411":case"412":case"413":A=`This feature~${A}`;break}let M=!1;do{w=dt(w,M?[1e-5,0]:[0,1e-5]);let C=new ie(w).bbox();M=this._cache.rtree.search(C).length}while(M);let I=new ut(w,this,p,m,{comment:g,description:A,whichType:E,parentIssueType:v,severity:S.severity||"error",objectId:y,objectType:x,schema:b,title:_});I.replacements=this._tokenReplacements(I),this._cache.data[m]=I,this._cache.rtree.insert(this._encodeIssueRtree(I))}this.context.deferredRedraw(),this.emit("loadedData")}).catch(()=>{delete this._cache.inflightTile[s.id],this._cache.loadedTile[s.id]=!0})}}postUpdate(e,t){if(this._cache.inflightPost[e.id])return t({message:"Error update already inflight",status:-2},e);let r={schema:e.schema,id:e.id};e.newStatus&&(r.st=e.newStatus),e.newComment!==void 0&&(r.co=e.newComment);let s=`${Kg}/comment.php?`+tt(r),n=new AbortController;this._cache.inflightPost[e.id]=n,fetch(s,{signal:n.signal}).then(Me).finally(()=>{delete this._cache.inflightPost[e.id],e.newStatus==="ignore"?this.removeItem(e):e.newStatus==="ignore_t"?(this.removeItem(e),this._cache.closed[`${e.schema}:${e.id}`]=!0):e=this.replaceItem(e.update({comment:e.newComment,newComment:void 0,newState:void 0})),t&&t(null,e)})}getError(e){return this._cache.data[e]}getColor(e){var t;return(t=Gi.get(e))!=null?t:16777215}replaceItem(e){return!(e instanceof ut)||!e.id?null:(this._cache.data[e.id]=e,this._updateRtree(this._encodeIssueRtree(e),!0),e)}removeItem(e){!(e instanceof ut)||!e.id||(delete this._cache.data[e.id],this._updateRtree(this._encodeIssueRtree(e),!1))}issueURL(e){return`${Kg}/report_map.php?schema=${e.schema}&error=${e.id}`}getClosedIDs(){return Object.keys(this._cache.closed).sort()}_abortRequest(e){e&&e.abort()}_abortUnwantedRequests(e,t){Object.keys(e.inflightTile).forEach(r=>{t.find(n=>r===n.id)||(this._abortRequest(e.inflightTile[r]),delete e.inflightTile[r])})}_encodeIssueRtree(e){return{minX:e.loc[0],minY:e.loc[1],maxX:e.loc[0],maxY:e.loc[1],data:e}}_updateRtree(e,t){this._cache.rtree.remove(e,(r,s)=>r.data.id===s.data.id),t&&this._cache.rtree.insert(e)}_tokenReplacements(e){if(!(e instanceof ut))return;let t=this.context.systems.l10n,r=new RegExp(/<\/[a-z][\s\S]*>/),s={},n=this._krData.errorTypes[e.whichType];if(!n){console.log("No Template: ",e.whichType),console.log("  ",e.description);return}if(!n.regex)return;let o=new RegExp(n.regex,"i"),a=o.exec(e.description);if(!a){console.log("Unmatched: ",e.whichType),console.log("  ",e.description),console.log("  ",o);return}for(let l=1;l<a.length;l++){let c=a[l],u;if(u="IDs"in n?n.IDs[l-1]:"",u&&c)c=this._parseError(c,u);else if(r.test(c))c="\\"+c+"\\";else{let h=c.toLowerCase();this._krData.localizeStrings[h]&&(c=t.t("QA.keepRight.error_parts."+this._krData.localizeStrings[h]))}s["var"+l]=c}return s}_parseError(e,t){let r=this.context.systems.l10n,s=e.toLowerCase();switch(this._krData.localizeStrings[s]&&(e=r.t("QA.keepRight.error_parts."+this._krData.localizeStrings[s])),t){case"this":e=n(e);break;case"url":e=a(e);break;case"n":case"w":case"r":e=o(t+e);break;case"20":e=d(e);break;case"211":e=l(e);break;case"231":e=c(e);break;case"294":e=u(e);break;case"370":e=h(e);break}return e;function n(f){return`<a class="error_object_link">${f}</a>`}function o(f){return`<a class="error_entity_link">${f}</a>`}function a(f){return`<a class="kr_external_link" target="_blank" href="${f}">${f}</a>`}function l(f){let p=[],m=f.split(", ");for(let g of m){let y=o("n"+g.slice(1));p.push(y)}return p.join(", ")}function c(f){let p=[],m=f.split("),");for(let g of m){let y=g.match(/\#(\d+)\((.+)\)?/);y!==null&&y.length>2&&p.push(o("w"+y[1])+" "+r.t("QA.keepRight.errorTypes.231.layer",{layer:y[2]}))}return p.join(", ")}function u(f){let p=[],m=f.split(",");for(let g of m){let y=g.split(" "),x=`"${y[0]}"`,b=y[1].slice(0,1),_=y[2].slice(1);_=o(b+_),p.push(`${x} ${y[1]} ${_}`)}return p.join(", ")}function h(f){if(!f)return"";let p=f.match(/\(including the name (\'.+\')\)/);return p!=null&&p.length?r.t("QA.keepRight.errorTypes.370.including_the_name",{name:p[1]}):""}function d(f){let p=[],m=f.split(",");for(let g of m){let y=o("n"+g.slice(1));p.push(y)}return p.join(", ")}}};var sy=et(ey(),1),ny=et(ry(),1),e7=et(Zr(),1);var XG="https://cdn.jsdelivr.net/npm/mapillary-js@4/dist/mapillary.min.js",qG="https://cdn.jsdelivr.net/npm/mapillary-js@4/dist/mapillary.min.css",l0="MLY|3376030635833192|f13ab0bdf6b2f7b99e0d8bd5868e1d88",HT="https://graph.mapillary.com/",oy="https://tiles.mapillary.com/maps/vtp",QG=`${oy}/mly1_public/2/{z}/{x}/{y}?access_token=${l0}`,YG=`${oy}/mly_map_feature_point/2/{z}/{x}/{y}?access_token=${l0}`,KG=`${oy}/mly_map_feature_traffic_sign/2/{z}/{x}/{y}?access_token=${l0}`,ZG=14,qu=class extends Ce{constructor(e){super(e),this.id="mapillary",this._loadPromise=null,this._startPromise=null,this._showing=null,this._mlyActiveImage=null,this._mlyCache={},this._mlyIsFallback=!1,this._mlyHighlightedDetection=null,this._mlyShowFeatureDetections=!1,this._mlyShowSignDetections=!1,this._mlyViewer=null,this._mlyViewerFilter=["all"],this._keydown=this._keydown.bind(this),this.navigateForward=this.navigateForward.bind(this),this.navigateBackward=this.navigateBackward.bind(this),this._tiler=new Jt().zoomRange(ZG).skipNullIsland(!0)}_keydown(e){var s,n,o,a;let t=(n=(s=document.activeElement)==null?void 0:s.tagName)!=null?n:"BODY",r=(o=document.activeElement)==null?void 0:o.className.startsWith("mapillary");t!=="BODY"&&!r||!this.viewerShowing||!((a=this.context.systems.photos._currLayerID)!=null&&a.startsWith("mapillary"))||(e.key==="ArrowLeft"||e.key==="ArrowDown"?this.navigateBackward():(e.key==="ArrowUp"||e.key==="ArrowRight")&&this.navigateForward())}initAsync(){return this.resetAsync()}startAsync(){return this._startPromise?this._startPromise:(this.context.container().select(".photoviewer").selectAll(".mly-wrapper").data([0]).enter().append("div").attr("id","rapideditor-mly").attr("class","photo-wrapper mly-wrapper").classed("hide",!0),this.context.systems.map.renderer.events.on("keydown",this._keydown),this._startPromise=this._loadAssetsAsync().then(()=>this._initViewer()).then(()=>this._started=!0).catch(s=>{s instanceof Error&&console.error(s),this._startPromise=null}))}resetAsync(){return this._mlyCache.requests&&Object.values(this._mlyCache.requests.inflight).forEach(function(e){e.abort()}),this._mlyCache={images:{rtree:new e7.default,forImageID:{}},signs:{rtree:new e7.default},points:{rtree:new e7.default},sequences:new Map,image_detections:{forImageID:{}},requests:{loaded:{},inflight:{}}},this._mlyActiveImage=null,Promise.resolve()}getData(e){if(!["images","signs","points"].includes(e))return[];let t=this.context.systems.map.extent();return this._mlyCache[e].rtree.search(t.bbox()).map(s=>s.data)}getSequences(){let e=this.context.systems.map.extent(),t=new Map;for(let r of this._mlyCache.images.rtree.search(e.bbox())){let s=r.data.sequenceID;if(!s)continue;let n=this._mlyCache.sequences.get(s);n&&(t.has(s)||t.set(s,n))}return[...t.values()]}loadTiles(e){if(!["images","signs","points"].includes(e))return;let t=this.context.projection,r=this._tiler.getTiles(t).tiles;for(let s of r)this._loadTile(e,s)}resetTags(){this._mlyViewer&&!this._mlyIsFallback&&this._mlyViewer.getComponent("tag").removeAll()}showFeatureDetections(e){this._mlyShowFeatureDetections=e,!this._mlyShowFeatureDetections&&!this._mlyShowSignDetections&&this.resetTags()}showSignDetections(e){this._mlyShowSignDetections=e,!this._mlyShowFeatureDetections&&!this._mlyShowSignDetections&&this.resetTags()}filterViewer(){let e=this.context.systems.photos,t=e.showsPanoramic,r=e.showsFlat,s=e.fromDate,n=e.toDate,o=["all"];return t||o.push(["!=","cameraType","spherical"]),!r&&t&&o.push(["==","pano",!0]),s&&o.push([">=","capturedAt",new Date(s).getTime()]),n&&o.push([">=","capturedAt",new Date(n).getTime()]),this._mlyViewer&&this._mlyViewer.setFilter(o),this._mlyViewerFilter=o,o}navigateForward(){let e=window.mapillary.NavigationDirection.Next;this._navigate(e)}navigateBackward(){let e=window.mapillary.NavigationDirection.Prev;this._navigate(e)}_navigate(e){this._mlyViewer.moveDir(e).catch(t=>{})}get viewerShowing(){return this._showing}showViewer(){let e=this.context.container().select(".photoviewer").classed("hide",!1);e.selectAll(".photo-wrapper.mly-wrapper.hide").size()&&this._mlyViewer&&(e.selectAll(".photo-wrapper:not(.mly-wrapper)").classed("hide",!0),e.selectAll(".photo-wrapper.mly-wrapper").classed("hide",!1),this._showing=!0,this._mlyViewer.resize())}hideViewer(){this._mlyActiveImage=null;let e=this.context;e.systems.photos.selectPhoto(null),!this._mlyIsFallback&&this._mlyViewer&&this._mlyViewer.getComponent("sequence").stop();let t=e.container().select(".photoviewer");t.empty()||t.datum(null),t.classed("hide",!0).selectAll(".photo-wrapper").classed("hide",!0),this._showing=!1,this.setStyles(e,null),this.emit("imageChanged")}highlightDetection(e){return e&&(this._mlyHighlightedDetection=e.id),this}selectImageAsync(e){return e?this.startAsync().then(()=>this._mlyViewer.moveTo(e).catch(t=>console.error("mly3",t))):Promise.resolve()}getActiveImage(){return this._mlyActiveImage}getDetectionsAsync(e){return this._loadDataAsync(`${HT}/${e}/detections?access_token=${l0}&fields=id,value,image`)}setActiveImage(e){e?this._mlyActiveImage={ca:e.originalCompassAngle,id:e.id,loc:[e.originalLngLat.lng,e.originalLngLat.lat],isPano:e.cameraType==="spherical",sequenceID:e.sequenceID}:this._mlyActiveImage=null}setStyles(e,t){let r=t==null?void 0:t.id,s=t==null?void 0:t.sequenceID,n=this._mlyActiveImage&&this._mlyActiveImage.sequenceID;e.container().selectAll(".layer-mapillary .viewfield-group").classed("highlighted",function(o){return o.sequenceID===n||o.id===r}).classed("hovered",function(o){return o.id===r}),e.container().selectAll(".layer-mapillary .sequence").classed("highlighted",function(o){return o.properties.id===s}).classed("currentView",function(o){return o.properties.id===n})}updateDetections(e,t){if(!this._mlyViewer||this._mlyIsFallback||!e)return;let r=this._mlyCache.image_detections,s=r.forImageID[e];s?this._showDetections(s):this._loadDataAsync(t).then(n=>{for(let o of n)r.forImageID[e]||(r.forImageID[e]=[]),r.forImageID[e].push({id:o.id,geometry:o.geometry,image_id:e,value:o.value});this._showDetections(r.forImageID[e]||[])})}_showDetections(e){let t=this._mlyViewer.getComponent("tag");for(let r of e){let s=this._makeTag(r);s&&t.add([s])}}_makeTag(e){let t=e.value.split("--");if(!t.length)return;let r,s,n=16777215;this._mlyHighlightedDetection===e.id&&(n=16776960,s=t[1],(s==="flat"||s==="discrete"||s==="sign")&&(s=t[2]),s=s.replace(/-/g," "),s=s.charAt(0).toUpperCase()+s.slice(1),this._mlyHighlightedDetection=null);let o=window.atob(e.geometry),a=new Uint8Array(o.length);for(let f=0;f<o.length;f++)a[f]=o.charCodeAt(f);let c=new sy.VectorTile(new ny.default(a.buffer)).layers["mpy-or"],h=c.feature(0).loadGeometry().map(f=>f.map(p=>[p.x/c.extent,p.y/c.extent])),d=window.mapillary;return r=new d.OutlineTag(e.id,new d.PolygonGeometry(h[0]),{text:s,textColor:n,lineColor:n,lineWidth:2,fillColor:n,fillOpacity:.3}),r}_loadTile(e,t){if(!["images","signs","points"].includes(e))return;let r=this._mlyCache.requests,s=`${t.id}-${e}`;if(r.loaded[s]||r.inflight[s])return;let n=new AbortController;r.inflight[s]=n;let o={images:QG,signs:KG,points:YG}[e];o=o.replace("{x}",t.xyz[0]).replace("{y}",t.xyz[1]).replace("{z}",t.xyz[2]),fetch(o,{signal:n.signal}).then(Me).then(a=>{if(r.loaded[s]=!0,!a)throw new Error("No Data");this._loadTileDataToCache(a,t),this.context.deferredRedraw(),e==="images"?this.emit("loadedImages"):e==="signs"?this.emit("loadedSigns"):e==="points"&&this.emit("loadedMapFeatures")}).catch(a=>{a.name!=="AbortError"&&(a instanceof Error&&console.error(a),r.loaded[s]=!0)}).finally(()=>{delete r.inflight[s]})}_loadTileDataToCache(e,t){let r=new sy.VectorTile(new ny.default(e));if(r.layers.hasOwnProperty("image")){let s=this._mlyCache.images,n=r.layers.image,o=[];for(let a=0;a<n.length;a++){let l=n.feature(a).toGeoJSON(t.xyz[0],t.xyz[1],t.xyz[2]);if(!l||s.forImageID[l.properties.id]!==void 0)continue;let c=l.geometry.coordinates,u={id:l.properties.id.toString(),loc:c,captured_at:l.properties.captured_at,ca:l.properties.compass_angle,isPano:l.properties.is_pano,sequenceID:l.properties.sequence_id};s.forImageID[u.id]=u,o.push({minX:c[0],minY:c[1],maxX:c[0],maxY:c[1],data:u})}s.rtree.load(o)}if(r.layers.hasOwnProperty("sequence")){let s=this._mlyCache.sequences,n=r.layers.sequence;for(let o=0;o<n.length;o++){let a=n.feature(o).toGeoJSON(t.xyz[0],t.xyz[1],t.xyz[2]);if(!a)continue;let l=a.properties.id,c=s.get(l);c||(c=[],s.set(l,c)),c.push(a)}}if(r.layers.hasOwnProperty("point")){let s=this._mlyCache.points,n=r.layers.point,o=[];for(let a=0;a<n.length;a++){let l=n.feature(a).toGeoJSON(t.xyz[0],t.xyz[1],t.xyz[2]);if(!l)continue;let c=l.geometry.coordinates,u={id:l.properties.id,loc:c,first_seen_at:l.properties.first_seen_at,last_seen_at:l.properties.last_seen_at,value:l.properties.value};o.push({minX:c[0],minY:c[1],maxX:c[0],maxY:c[1],data:u})}s.rtree.load(o)}if(r.layers.hasOwnProperty("traffic_sign")){let s=this._mlyCache.signs,n=r.layers.traffic_sign,o=[];for(let a=0;a<n.length;a++){let l=n.feature(a).toGeoJSON(t.xyz[0],t.xyz[1],t.xyz[2]),c=l.geometry.coordinates,u={id:l.properties.id,loc:c,first_seen_at:l.properties.first_seen_at,last_seen_at:l.properties.last_seen_at,value:l.properties.value};o.push({minX:c[0],minY:c[1],maxX:c[0],maxY:c[1],data:u})}s.rtree.load(o)}}_loadDataAsync(e){return fetch(e).then(Me).then(t=>(t==null?void 0:t.data)||[]).catch(t=>{t.name!=="AbortError"&&t instanceof Error&&console.error(t)})}_loadAssetsAsync(){return this._loadPromise?this._loadPromise:this._loadPromise=new Promise((e,t)=>{let r=0,s=()=>{++r===2&&e()},n=G("head");n.selectAll("#rapideditor-mapillary-css").data([0]).enter().append("link").attr("id","rapideditor-mapillary-css").attr("rel","stylesheet").attr("crossorigin","anonymous").attr("href",qG).on("load",s).on("error",t),n.selectAll("#rapideditor-mapillary-js").data([0]).enter().append("script").attr("id","rapideditor-mapillary-js").attr("crossorigin","anonymous").attr("src",XG).on("load",s).on("error",t)})}_initViewer(){let e=window.mapillary;if(!e)throw new Error("mapillary not loaded");let t=this.context,r={accessToken:l0,component:{cover:!1,bearing:{size:e.ComponentSize.Standard},keyboard:!1,tag:!0},container:"rapideditor-mly"};!e.isSupported()&&e.isFallbackSupported()&&(this._mlyIsFallback=!0,r.component={cover:!1,direction:!1,imagePlane:!1,keyboard:!1,mouse:!1,sequence:!1,tag:!1,image:!0,navigation:!0});let s=a=>{this.resetTags();let l=a.image;this.setActiveImage(l),this.setStyles(t,null);let c=[l.originalLngLat.lng,l.originalLngLat.lat];t.systems.map.centerEase(c),t.systems.photos.selectPhoto("mapillary",l.id),(this._mlyShowFeatureDetections||this._mlyShowSignDetections)&&this.updateDetections(l.id,`${HT}/${l.id}/detections?access_token=${l0}&fields=id,image,geometry,value`),this.emit("imageChanged")},n=a=>{this.emit("bearingChanged",a),this.context.systems.map.immediateRedraw()},o=a=>{this.emit("fovChanged",a)};this._mlyViewer=new e.Viewer(r),this._mlyViewer.on("image",s),this._mlyViewer.on("bearing",n),this._mlyViewer.on("fov",o),this._mlyViewerFilter&&this._mlyViewer.setFilter(this._mlyViewerFilter),t.systems.ui.photoviewer.on("resize.mapillary",()=>{this._mlyViewer&&this._mlyViewer.resize()})}};var JG="https://mapwith.ai/maps/ml_roads",ez=16,Qu=class extends Ce{constructor(e){super(e),this.id="mapwithai",this._tiler=new Jt().zoomRange(ez),this._datasets={},this._deferred=new Set,this._parseNode=this._parseNode.bind(this),this._parseWay=this._parseWay.bind(this)}initAsync(){return this.resetAsync().then(()=>{let e="rapid_intro_graph",t=new di,r=new Jr(t),n={id:e,graph:t,tree:r,cache:{inflight:{},loaded:new Set,seen:new Set,seenFirstNodeID:new Set,splitWays:new Map}};this._datasets[e]=n})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){for(let e of this._deferred)window.cancelIdleCallback(e),this._deferred.delete(e);for(let e of Object.values(this._datasets))e.cache.inflight&&Object.values(e.cache.inflight).forEach(t=>this._abortRequest(t)),e.graph=new di,e.tree=new Jr(e.graph),e.cache={inflight:{},loaded:new Set,seen:new Set,seenFirstNodeID:new Set,splitWays:new Map};return Promise.resolve()}getData(e){let t=this._datasets[e];if(!t||!t.tree||!t.graph)return[];let r=this.context.systems.map.extent();return t.tree.intersects(r,t.graph)}loadTiles(e){if(this._paused)return;let t=this._datasets[e],r,s,n;t?(r=t.graph,s=t.tree,n=t.cache):(r=new di,s=new Jr(r),n={inflight:{},loaded:new Set,seen:new Set,seenFirstNodeID:new Set,splitWays:new Map},t={id:e,graph:r,tree:s,cache:n},this._datasets[e]=t);let o=this.context.systems.locations,a=this.context.projection,l=this._tiler.getTiles(a).tiles;for(let c of Object.keys(n.inflight))l.find(h=>h.id===c)||(this._abortRequest(n.inflight[c]),delete n.inflight[c]);for(let c of l){if(n.loaded.has(c.id)||n.inflight[c.id])continue;if(c.wgs84Extent.polygon().slice(0,4).every(p=>o.blocksAt(p).length)){n.loaded.add(c.id);continue}let d=this._tileURL(t,c.wgs84Extent),f=new AbortController;fetch(d,{signal:f.signal}).then(Me).then(p=>{delete n.inflight[c.id],p&&this._parseXML(t,p,c,(m,g)=>{m||(r.rebase(g,[r],!0),s.rebase(g,!0),n.loaded.add(c.id),this.context.deferredRedraw(),this.emit("loadedData"))})}).catch(p=>{p.name!=="AbortError"&&console.error(p)}),n.inflight[c.id]=f}}graph(e){let t=this._datasets[e];return t==null?void 0:t.graph}merge(e,t){let r=this._datasets[e];!r||!r.tree||!r.graph||(r.graph.rebase(t,[r.graph],!1),r.tree.rebase(t,!1))}_abortRequest(e){e.abort()}_tileURL(e,t){let r=/-conflated$/.test(e.id),s=e.id.replace("-conflated",""),n={conflate_with_osm:r,theme:"ml_road_vector",collaborator:"fbid",token:"ASZUVdYpCkd3M6ZrzjXdQzHulqRMnxdlkeBJWEKOeTUoY_Gwm9fuEd2YObLrClgDB_xfavizBsh0oDfTWTF7Zb4C",hash:"ASYM8LPNy8k1XoJiI7A"};s==="fbRoads"?n.result_type="road_vector_xml":s==="msBuildings"?(n.result_type="road_building_vector_xml",n.building_source="microsoft"):(n.result_type="osm_xml",n.sources=`esri_building.${s}`),n.bbox=t.toParam();let o=this.context.systems.rapid.taskExtent;return o&&(n.crop_bbox=o.toParam()),(Vn(window.location.hash).fb_ml_road_url||JG)+"?"+u(n,!0);function u(h,d){function f(p){return encodeURIComponent(p).replace(/(%2F|%3A|%2C|%7B|%7D)/g,decodeURIComponent)}return Object.keys(h).map(p=>encodeURIComponent(p)+"="+(d?f(h[p]):encodeURIComponent(h[p]))).join("&")}}_getLoc(e){var s,n;let t=(s=e.lon)==null?void 0:s.value,r=(n=e.lat)==null?void 0:n.value;return[parseFloat(t),parseFloat(r)]}_getNodes(e){return Array.from(e.getElementsByTagName("nd")).map(r=>"n"+r.attributes.ref.value)}_getTags(e){var s,n;let t=Array.from(e.getElementsByTagName("tag")),r={};for(let o of t){let a=o.attributes,l=((s=a.k.value)!=null?s:"").trim(),c=((n=a.v.value)!=null?n:"").trim();l&&c&&(r[l]=c)}return r}_getVisible(e){return!e.visible||e.visible.value!=="false"}_parseNode(e,t){let r=e.attributes;return new Be({id:t,visible:this._getVisible(r),loc:this._getLoc(r),tags:this._getTags(e)})}_parseWay(e,t){let r=e.attributes;return new pt({id:t,visible:this._getVisible(r),tags:this._getTags(e),nodes:this._getNodes(e)})}_parseXML(e,t,r,s){if(!t||!t.childNodes)return s({message:"No XML",status:-1});let o=t.childNodes[0].childNodes,a=window.requestIdleCallback(()=>{this._deferred.delete(a);let l=[];for(let c of o){let u=this._parseEntity(e,r,c);u&&l.push(u)}l=l.concat(this._connectSplitWays(e)),s(null,l)});this._deferred.add(a)}_parseEntity(e,t,r){let s=e.cache,n=r.nodeName;if(!["node","way"].includes(n))return null;let o,a;if(o=de.id.fromOSM(n,r.attributes.id.value),n==="node"){if(s.seen.has(o))return null;a=this._parseNode(r,o),s.seen.add(o)}else if(n==="way")if(r.attributes.orig_id){let c=de.id.fromOSM(n,r.attributes.orig_id.value);a=this._parseWay(r,o);let u=s.splitWays.get(c);return u||(u=new Set,s.splitWays.set(c,u)),u.add(a),null}else{if(s.seen.has(o))return null;if(a=this._parseWay(r,o),s.seen.add(o),/^msBuildings/.test(e.id)){let c=a.nodes[0];if(s.seenFirstNodeID.has(c))return null;s.seenFirstNodeID.add(c)}}else return null;let l={__fbid__:o,__service__:"mapwithai",__datasetid__:e.id};return Object.assign(a,l)}_connectSplitWays(e){let t=e.graph,r=e.cache,s=[];for(let[n,o]of r.splitWays){let a=t.hasEntity(n);for(let l of o){if(!a||!a.nodes.length){a=l.update({id:n}),o.delete(l);continue}let c=[];for(let m of l.nodes)c.push(a.nodes.indexOf(m));if(c.every(m=>m!==-1)){o.delete(l);continue}else if(c.every(m=>m===-1))continue;let u=!1,h=!1,d;for(let m of c)if(m!==-1)if(d===void 0)h=!0,d=m;else{h=!1,u=m<d;break}h&&(c.at(0)===0&&(u=!0),c.at(-1)!==0&&(u=!0)),u&&(l.nodes.reverse(),c.reverse());let f=[],p=0;for(let m=0;m<c.length;m++){let g=c[m];if(g===-1)f.push(l.nodes[m]);else for(;p<=g;)f.push(a.nodes[p]),p++}for(;p<a.nodes.length;)f.push(a.nodes[p]),p++;o.delete(l),a=a.update({nodes:f})}if(a){let l={__fbid__:a.id,__service__:"mapwithai",__datasetid__:e.id};s.push(Object.assign(a,l))}}return s}};var ay=et(Zr(),1);var Yu=class extends Ce{constructor(e){super(e),this.id="nominatim",this.apibase="https://nominatim.openstreetmap.org/",this._inflight={},this._nominatimCache=new ay.default,this.countryCode=this.countryCode.bind(this),this.reverse=this.reverse.bind(this),this.search=this.search.bind(this)}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Object.values(this._inflight).forEach(e=>e.abort()),this._inflight={},this._nominatimCache=new ay.default,Promise.resolve()}countryCode(e,t){this.reverse(e,(r,s)=>r?t(r):s.address?t(null,s.address.country_code):t("Unable to geocode",null))}reverse(e,t){let r=this._nominatimCache.search({minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]});if(r.length>0){t&&t(null,r[0].data);return}let s={zoom:13,format:"json",addressdetails:1,lat:e[1],lon:e[0]},n=this.apibase+"reverse?"+tt(s);if(this._inflight[n])return;let o=new AbortController;this._inflight[n]=o;let a=this.context.systems.l10n,l={signal:o.signal,headers:{"Accept-Language":a.localeCodes().join(",")}};fetch(n,l).then(Me).then(c=>{if(delete this._inflight[n],c!=null&&c.error)throw new Error(c.error);let u=new ie(e).padByMeters(200);this._nominatimCache.insert(Object.assign(u.bbox(),{data:c})),t&&t(null,c)}).catch(c=>{delete this._inflight[n],c.name!=="AbortError"&&t&&t(c.message)})}search(e,t){let r=encodeURIComponent(e),s=this.apibase+`search?q=${r}&limit=10&format=json`;if(this._inflight[s])return;let n=new AbortController;this._inflight[s]=n;let o=this.context.systems.l10n,a={signal:n.signal,headers:{"Accept-Language":o.localeCodes().join(",")}};fetch(s,a).then(Me).then(l=>{if(delete this._inflight[s],l!=null&&l.error)throw new Error(l.error);t&&t(null,l)}).catch(l=>{delete this._inflight[s],l.name!=="AbortError"&&t&&t(l.message)})}};var WT=et(G2(),1);var GT=et(b3(),1);function Dl(i){return typeof i!="string"?"":GT.default.remove(i.replace(/&/g,"and").replace(/(|i)/ig,"i").replace(/[\s\-=_!"#%'*{},.\/:;?\(\)\[\]@\\$\^*+<>~`\u00a1\u00a7\u00b6\u00b7\u00bf\u037e\u0387\u055a-\u055f\u0589\u05c0\u05c3\u05c6\u05f3\u05f4\u0609\u060a\u060c\u060d\u061b\u061e\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0830-\u083e\u085e\u0964\u0965\u0970\u0af0\u0df4\u0e4f\u0e5a\u0e5b\u0f04-\u0f12\u0f14\u0f85\u0fd0-\u0fd4\u0fd9\u0fda\u104a-\u104f\u10fb\u1360-\u1368\u166d\u166e\u16eb-\u16ed\u1735\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u1805\u1807-\u180a\u1944\u1945\u1a1e\u1a1f\u1aa0-\u1aa6\u1aa8-\u1aad\u1b5a-\u1b60\u1bfc-\u1bff\u1c3b-\u1c3f\u1c7e\u1c7f\u1cc0-\u1cc7\u1cd3\u2000-\u206f\u2cf9-\u2cfc\u2cfe\u2cff\u2d70\u2e00-\u2e7f\u3001-\u3003\u303d\u30fb\ua4fe\ua4ff\ua60d-\ua60f\ua673\ua67e\ua6f2-\ua6f7\ua874-\ua877\ua8ce\ua8cf\ua8f8-\ua8fa\ua92e\ua92f\ua95f\ua9c1-\ua9cd\ua9de\ua9df\uaa5c-\uaa5f\uaade\uaadf\uaaf0\uaaf1\uabeb\ufe10-\ufe16\ufe19\ufe30\ufe45\ufe46\ufe49-\ufe4c\ufe50-\ufe52\ufe54-\ufe57\ufe5f-\ufe61\ufe68\ufe6a\ufe6b\ufeff\uff01-\uff03\uff05-\uff07\uff0a\uff0c\uff0e\uff0f\uff1a\uff1b\uff1f\uff20\uff3c\uff61\uff64\uff65]+/g,"").toLowerCase())}var zT={matchGroups:{adult_gaming_centre:["amenity/casino","amenity/gambling","leisure/adult_gaming_centre"],bar:["amenity/bar","amenity/pub","amenity/restaurant"],beauty:["shop/beauty","shop/hairdresser_supply"],bed:["shop/bed","shop/furniture"],beverages:["shop/alcohol","shop/beer","shop/beverages","shop/kiosk","shop/wine"],camping:["tourism/camp_site","tourism/caravan_site"],car_parts:["shop/car_parts","shop/car_repair","shop/tires","shop/tyres"],clinic:["amenity/clinic","amenity/doctors","healthcare/clinic","healthcare/laboratory","healthcare/physiotherapist","healthcare/sample_collection","healthcare/dialysis"],convenience:["shop/beauty","shop/chemist","shop/convenience","shop/cosmetics","shop/grocery","shop/kiosk","shop/newsagent","shop/perfumery"],coworking:["amenity/coworking_space","office/coworking","office/coworking_space"],dentist:["amenity/dentist","amenity/doctors","healthcare/dentist"],electronics:["office/telecommunication","shop/appliance","shop/computer","shop/electronics","shop/hifi","shop/kiosk","shop/mobile","shop/mobile_phone","shop/telecommunication","shop/video_games"],fabric:["shop/fabric","shop/haberdashery","shop/sewing"],fashion:["shop/accessories","shop/bag","shop/boutique","shop/clothes","shop/department_store","shop/fashion","shop/fashion_accessories","shop/sports","shop/shoes"],financial:["amenity/bank","office/accountant","office/financial","office/financial_advisor","office/tax_advisor","shop/tax"],fitness:["leisure/fitness_centre","leisure/fitness_center","leisure/sports_centre","leisure/sports_center"],food:["amenity/cafe","amenity/fast_food","amenity/ice_cream","amenity/restaurant","shop/bakery","shop/candy","shop/chocolate","shop/coffee","shop/confectionary","shop/confectionery","shop/deli","shop/food","shop/kiosk","shop/ice_cream","shop/pastry","shop/tea"],fuel:["amenity/fuel","shop/gas","shop/convenience;gas","shop/gas;convenience"],gift:["shop/gift","shop/card","shop/cards","shop/kiosk","shop/stationery"],glass:["craft/window_construction","craft/glaziery","shop/car_repair"],hardware:["shop/bathroom_furnishing","shop/carpet","shop/diy","shop/doityourself","shop/doors","shop/electrical","shop/flooring","shop/hardware","shop/hardware_store","shop/power_tools","shop/tool_hire","shop/tools","shop/trade"],health_food:["shop/health","shop/health_food","shop/herbalist","shop/nutrition_supplements"],hobby:["shop/electronics","shop/hobby","shop/books","shop/games","shop/collector","shop/toys","shop/model","shop/video_games","shop/anime"],hospital:["amenity/doctors","amenity/hospital","healthcare/hospital"],houseware:["shop/houseware","shop/interior_decoration"],water_rescue:["amenity/lifeboat_station","emergency/lifeboat_station","emergency/marine_rescue","emergency/water_rescue"],locksmith:["craft/key_cutter","craft/locksmith","shop/locksmith"],lodging:["tourism/guest_house","tourism/hotel","tourism/motel"],money_transfer:["amenity/money_transfer","shop/money_transfer"],office_supplies:["shop/office_supplies","shop/stationary","shop/stationery"],outdoor:["shop/clothes","shop/outdoor","shop/sports"],parcel_locker:["amenity/parcel_locker","amenity/vending_machine"],pharmacy:["amenity/doctors","amenity/pharmacy","healthcare/pharmacy","shop/chemist"],playground:["amenity/theme_park","leisure/amusement_arcade","leisure/playground"],rental:["amenity/bicycle_rental","amenity/boat_rental","amenity/car_rental","amenity/truck_rental","amenity/vehicle_rental","shop/kiosk","shop/plant_hire","shop/rental","shop/tool_hire"],school:["amenity/childcare","amenity/college","amenity/kindergarten","amenity/language_school","amenity/prep_school","amenity/school","amenity/university"],storage:["shop/storage_units","shop/storage_rental"],substation:["power/station","power/substation","power/sub_station"],supermarket:["shop/food","shop/frozen_food","shop/greengrocer","shop/grocery","shop/supermarket","shop/wholesale"],thrift:["shop/charity","shop/clothes","shop/second_hand"],tobacco:["shop/e-cigarette","shop/tobacco"],variety_store:["shop/variety_store","shop/discount","shop/convenience"],vending:["amenity/vending_machine","shop/kiosk","shop/vending_machine"],weight_loss:["amenity/clinic","amenity/doctors","amenity/weight_clinic","healthcare/counselling","leisure/fitness_centre","office/therapist","shop/beauty","shop/diet","shop/food","shop/health_food","shop/herbalist","shop/nutrition","shop/nutrition_supplements","shop/weight_loss"],wholesale:["shop/wholesale","shop/supermarket","shop/department_store"]}};var jT={genericWords:["^(barn|bazaa?r|bench|bou?tique|building|casa|church)$","^(baseball|basketball|football|soccer|softball|tennis(halle)?)\\s?(field|court)?$","^(club|green|out|ware)\\s?house$","^(driveway|el \xE1rbol|fountain|generic|golf|government|graveyard)$","^(fixme|n\\s?\\/?\\s?a|name|no\\s?name|none|null|temporary|test|unknown)$","^(hofladen|librairie|magazine?|maison)$","^(mobile home|skate)?\\s?park$","^(obuwie|pond|pool|sale|shops?|sklep|stores?)$","^\\?+$","^private$","^tattoo( studio)?$","^windmill$","^\u0446\u0435\u0440\u043A\u043E\u0432\u043D\u0430\u044F( \u043B\u0430\u0432\u043A\u0430)?$"]};var VT={trees:{brands:{emoji:"\u{1F354}",mainTag:"brand:wikidata",sourceTags:["brand","name"],nameTags:{primary:"^(name|name:\\w+)$",alternate:"^(brand|brand:\\w+|operator|operator:\\w+|\\w+_name|\\w+_name:\\w+)$"}},flags:{emoji:"\u{1F6A9}",mainTag:"flag:wikidata",nameTags:{primary:"^(flag:name|flag:name:\\w+)$",alternate:"^(country|country:\\w+|flag|flag:\\w+|subject|subject:\\w+)$"}},operators:{emoji:"\u{1F4BC}",mainTag:"operator:wikidata",sourceTags:["operator"],nameTags:{primary:"^(name|name:\\w+|operator|operator:\\w+)$",alternate:"^(brand|brand:\\w+|\\w+_name|\\w+_name:\\w+)$"}},transit:{emoji:"\u{1F687}",mainTag:"network:wikidata",sourceTags:["network"],nameTags:{primary:"^network$",alternate:"^(operator|operator:\\w+|network:\\w+|\\w+_name|\\w+_name:\\w+)$"}}}};var ly=zT.matchGroups,sz=VT.trees,Ku=class{constructor(){this.matchIndex=void 0,this.genericWords=new Map,(jT.genericWords||[]).forEach(e=>this.genericWords.set(e,new RegExp(e,"i"))),this.itemLocation=void 0,this.locationSets=void 0,this.locationIndex=void 0,this.warnings=[]}buildMatchIndex(e){let t=this;if(t.matchIndex)return;t.matchIndex=new Map;let r=new Map;Object.keys(e).forEach(o=>{let a=e[o],l=o.split("/",3),c=l[0],u=l[1],h=l[2],d=`${u}/${h}`,f=sz[c],p=t.matchIndex.get(d);p||(p={primary:new Map,alternate:new Map,excludeGeneric:new Map,excludeNamed:new Map},t.matchIndex.set(d,p));let g=(a.properties||{}).exclude||{};(g.generic||[]).forEach(E=>p.excludeGeneric.set(E,new RegExp(E,"i"))),(g.named||[]).forEach(E=>p.excludeNamed.set(E,new RegExp(E,"i")));let y=[...p.excludeGeneric.values(),...p.excludeNamed.values()],x=a.items;if(!Array.isArray(x)||!x.length)return;let b=new RegExp(f.nameTags.primary,"i"),_=new RegExp(f.nameTags.alternate,"i"),w=/:(colou?r|type|forward|backward|left|right|etymology|pronunciation|wikipedia)$/i,A=n(c,u,h),k=new Set([`${u}/yes`,"building/yes"]),v=new Set;Object.values(ly).forEach(E=>{E.some(M=>M===d)&&E.forEach(M=>{if(M===d)return;v.add(M);let I=M.split("/",2)[0];k.add(`${I}/yes`)})}),x.forEach(E=>{if(!E.id)return;Array.isArray(E.matchTags)&&E.matchTags.length&&(E.matchTags=E.matchTags.filter(I=>!v.has(I)&&I!==d&&!k.has(I)),E.matchTags.length||delete E.matchTags);let S=[`${d}`].concat(E.matchTags||[]);A||(S=S.concat(Array.from(k))),Object.keys(E.tags).forEach(I=>{if(w.test(I))return;let T=E.tags[I];!T||y.some(C=>C.test(T))||(b.test(I)?S.forEach(C=>s("primary",c,C,Dl(T),E.id)):_.test(I)&&S.forEach(C=>s("alternate",c,C,Dl(T),E.id)))});let M=new Set;(E.matchNames||[]).forEach(I=>{let T=Dl(I);S.forEach(C=>{let P=t.matchIndex.get(C),D=P&&P.primary.get(T),O=P&&P.alternate.get(T),R=D&&D.has(E.id),N=O&&O.has(E.id);!R&&!N&&(s("alternate",c,C,T,E.id),M.add(I))})}),M.size?E.matchNames=Array.from(M):delete E.matchNames})});function s(o,a,l,c,u){if(!c){t.warnings.push(`Warning: skipping empty ${o} name for item ${a}/${l}: ${u}`);return}let h=t.matchIndex.get(l);h||(h={primary:new Map,alternate:new Map,excludeGeneric:new Map,excludeNamed:new Map},t.matchIndex.set(l,h));let d=h[o].get(c);if(d||(d=new Set,h[o].set(c,d)),d.add(u),!/yes$/.test(l)){let f=`${l}/${c}`,p=r.get(f);if(p&&p!==a){let m=Array.from(d);t.warnings.push(`Duplicate cache key "${f}" in trees "${a}" and "${p}", check items: ${m}`);return}r.set(f,a)}}function n(o,a,l){return o==="flags"||o==="transit"||a==="landuse"||l==="atm"||l==="bicycle_parking"||l==="car_sharing"||l==="caravan_site"||l==="charging_station"||l==="dog_park"||l==="parking"||l==="phone"||l==="playground"||l==="post_box"||l==="public_bookcase"||l==="recycling"||l==="vending_machine"}}buildLocationIndex(e,t){let r=this;if(r.locationIndex)return;r.itemLocation=new Map,r.locationSets=new Map,Object.keys(e).forEach(n=>{let o=e[n].items;!Array.isArray(o)||!o.length||o.forEach(a=>{if(r.itemLocation.has(a.id))return;let l;try{l=t.resolveLocationSet(a.locationSet)}catch(u){console.warn(`buildLocationIndex: ${u.message}`)}if(!l||!l.id||(r.itemLocation.set(a.id,l.id),r.locationSets.has(l.id)))return;let c=s(l.feature);if(c.id=l.id,c.properties.id=l.id,!c.geometry.coordinates.length||!c.properties.area){console.warn(`buildLocationIndex: locationSet ${l.id} for ${a.id} resolves to an empty feature:`),console.warn(JSON.stringify(c));return}r.locationSets.set(l.id,c)})}),r.locationIndex=(0,WT.default)({type:"FeatureCollection",features:[...r.locationSets.values()]});function s(n){return JSON.parse(JSON.stringify(n))}}match(e,t,r,s){let n=this;if(!n.matchIndex)throw new Error("match:  matchIndex not built.");let o;Array.isArray(s)&&n.locationIndex&&(o=n.locationIndex([s[0],s[1],s[0],s[1]],!0));let a=Dl(r),l=new Set,c=[];if(u("primary"),u("alternate"),c.length)return c;return u("exclude"),c.length?c:null;function u(d){let f=`${e}/${t}`,p=h(d,f);if(!p){for(let m in ly){let g=ly[m];if(g.some(x=>x===f))for(let x=0;x<g.length;x++){let b=g[x];if(b!==f&&(p=h(d,b),p))return}}if(d==="exclude"){let m=[...n.genericWords.values()].find(g=>g.test(r));if(m){c.push({match:"excludeGeneric",pattern:String(m)});return}}}}function h(d,f){let p=n.matchIndex.get(f);if(!p)return;if(d==="exclude"){let w=[...p.excludeNamed.values()].find(A=>A.test(r));if(w){c.push({match:"excludeNamed",pattern:String(w),kv:f});return}if(w=[...p.excludeGeneric.values()].find(A=>A.test(r)),w){c.push({match:"excludeGeneric",pattern:String(w),kv:f});return}return}let m=p[d].get(a);if(!m||!m.size)return;let g=Array.from(m).map(w=>{let A=1/0;if(n.itemLocation&&n.locationSets){let k=n.locationSets.get(n.itemLocation.get(w));A=k&&k.properties.area||1/0}return{match:d,itemID:w,area:A,kv:f,nsimple:a}}),y=_;if(o&&(g=g.filter(x),y=b),!g.length)return;return g.sort(y).forEach(w=>{l.has(w.itemID)||(l.add(w.itemID),c.push(w))}),!0;function x(w){return n.itemLocation?o.find(A=>A.id===n.itemLocation.get(w.itemID)):!0}function b(w,A){return w.area-A.area}function _(w,A){return A.area-w.area}}}getWarnings(){return this.warnings}};var nz={"building/commercial":!0,"building/government":!0,"building/hotel":!0,"building/retail":!0,"building/office":!0,"building/supermarket":!0,"building/yes":!0},oz=/:(colou?r|type|forward|backward|left|right|etymology|pronunciation|wikipedia)$/i,az=/(coop|express|wireless|factory|outlet)/i,Zu=class extends Ce{constructor(e){super(e),this.id="nsi",this.status="loading",this._nsi={}}initAsync(){let e={nsi_data:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/nsi.min.json",nsi_dissolved:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/dissolved.min.json",nsi_features:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/featureCollection.min.json",nsi_generics:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/genericWords.min.json",nsi_presets:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/presets/nsi-id-presets.min.json",nsi_replacements:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/replacements.min.json",nsi_trees:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/trees.min.json"},r=this.context.systems.dataloader.fileMap;for(let[n,o]of Object.entries(e))r.has(n)||r.set(n,o);return this.context.systems.presets.initAsync().then(()=>this._loadNsiPresetsAsync()).then(()=>this._loadNsiDataAsync()).then(()=>this.status="ok").catch(n=>{console.error(n),this.status="failed"})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}isGenericName(e){let t=e.name;if(!t)return!1;let r={primary:new Set([t]),alternate:new Set},s=this._gatherKVs(e);if(!s.primary.size&&!s.alternate.size)return!1;let n=this._gatherTuples(s,r);for(let o of n){let a=this._nsi.matcher.match(o.k,o.v,o.n);if(a!=null&&a.length&&a[0].match==="excludeGeneric")return!0}return!1}upgradeTags(e,t){let r=Object.assign({},e),s=!1;for(let u of Object.keys(r)){let h=u.match(/^(\w+:)?wikidata$/);if(h){let d=h[1]||"",f=r[u],p=this._nsi.replacements[f];if((p==null?void 0:p.wikidata)!==void 0&&(s=!0,p.wikidata?r[u]=p.wikidata:delete r[u]),(p==null?void 0:p.wikipedia)!==void 0){s=!0;let m=`${d}wikipedia`;p.wikipedia?r[m]=p.wikipedia:delete r[m]}}}let n=e.type==="route_master",o=this._gatherKVs(e);if(!o.primary.size&&!o.alternate.size)return s?{newTags:r,matched:null}:null;let a=this._gatherNames(e),l=this._nsi.qids.get(e.wikidata)||this._nsi.qids.get(e.wikipedia);if(l&&a.primary.add(l),!a.primary.size&&!a.alternate.size)return s?{newTags:r,matched:null}:null;let c=this._gatherTuples(o,a);for(let u of c){let h=this._nsi.matcher.match(u.k,u.v,u.n,t);if(!h||!h.length)continue;if(h[0].match!=="primary"&&h[0].match!=="alternate")break;let d,f;for(let E of h){if(d=E.itemID,this._nsi.dissolved[d]||(f=this._nsi.ids.get(d),!f))continue;let S=f.mainTag,M=f.tags[S],I=r[`not:${S}`];if(!M||M===I||r.office&&!f.tags.office){f=null;continue}else break}if(!f)continue;f=JSON.parse(JSON.stringify(f));let p=f.tkv,m=p.split("/",3),g=m[1],y=m[2],b=this._nsi.data[p].properties||{},_=f.preserveTags||b.preserveTags||[];["building","emergency","internet_access","takeaway"].forEach(E=>{g!==E&&_.push(`^${E}$`)});let w=_.map(E=>new RegExp(E,"i")),A={};for(let E of Object.keys(r))w.some(S=>S.test(E))&&(A[E]=r[E]);this._nsi.kvt.forEach((E,S)=>{r[S]==="yes"&&delete r[S]}),l&&(delete r.wikipedia,delete r.wikidata),Object.assign(r,f.tags,A),n&&(r.route_master=r.route,delete r.route);let k=e.name,v=r.name;if(v&&k&&v!==k&&!r.branch){let E=this._gatherNames(r);if(!new Set([...E.primary,...E.alternate]).has(k)){let I=k.split(/[\s\-\/,.]/);for(let T=I.length;T>0;T--){let C=I.slice(0,T).join(" "),P=I.slice(T).join(" "),D=this._nsi.matcher.match(g,y,C,t);if(!(!D||!D.length)&&D.some(O=>O.itemID===d)){if(P)if(az.test(P))r.name=k;else{let O=this._nsi.matcher.match(g,y,P,t);if(O&&O.length){if(O[0].match==="primary"||O[0].match==="alternate")return null}else r.branch=P}break}}}}return{newTags:r,matched:f}}return s?{newTags:r,matched:null}:null}_loadNsiPresetsAsync(){let e=this.context.systems.dataloader;return Promise.all([e.getDataAsync("nsi_presets"),e.getDataAsync("nsi_features")]).then(t=>{Object.values(t[0].presets).forEach(s=>s.suggestion=!0),this.context.systems.presets.merge({presets:t[0].presets,featureCollection:t[1]})})}_loadNsiDataAsync(){let e=this.context.systems.dataloader;return Promise.all([e.getDataAsync("nsi_data"),e.getDataAsync("nsi_dissolved"),e.getDataAsync("nsi_replacements"),e.getDataAsync("nsi_trees")]).then(t=>{var n;this._nsi={data:t[0].nsi,dissolved:t[1].dissolved,replacements:t[2].replacements,trees:t[3].trees,kvt:new Map,qids:new Map,ids:new Map};let r=this._nsi.matcher=new Ku;r.buildMatchIndex(this._nsi.data),r.itemLocation=new Map,r.locationSets=new Map;let s=this.context.systems.locations;for(let o of Object.values(this._nsi.data))for(let a of(n=o.items)!=null?n:[]){if(r.itemLocation.has(a.id))continue;let l=s.locationSetID(a.locationSet);if(r.itemLocation.set(a.id,l),r.locationSets.has(l))continue;let c={id:l,properties:{id:l,area:1}};r.locationSets.set(l,c)}r.locationIndex=o=>{let a=s.locationSetsAt([o[0],o[1]]),l=[];for(let[c,u]of Object.entries(a)){let h=r.locationSets.get(c);h&&(h.properties.area=u,l.push(h))}return l},Object.keys(this._nsi.data).forEach(o=>{let a=this._nsi.data[o],[l,c,u]=o.split("/",3),h=this._nsi.kvt.get(c);h||(h=new Map,this._nsi.kvt.set(c,h)),h.set(u,l);let f=this._nsi.trees[l].mainTag;(a.items||[]).forEach(m=>{m.tkv=o,m.mainTag=f,this._nsi.ids.set(m.id,m);let g=m.tags[f],y=m.tags[f.replace("wikidata","wikipedia")];g&&this._nsi.qids.set(g,g),y&&g&&this._nsi.qids.set(y,g)})})})}_gatherKVs(e){let t=new Set,r=new Set;for(let[o,a]of Object.entries(e)){if(!o||!a)continue;o==="route_master"&&(o="route");let l=this._nsi.kvt.get(o);l&&(l.get(a)?t.add(`${o}/${a}`):a==="yes"&&r.add(`${o}/${a}`))}let n=this.context.systems.presets.matchTags(e,"area");return nz[n.id]&&r.add("building/yes"),{primary:t,alternate:r}}_identifyTree(e){let t,r;for(let[s,n]of Object.entries(e)){if(!s||!n)continue;s==="route_master"&&(s="route");let o=this._nsi.kvt.get(s);if(o)if(n==="yes")t="unknown";else{r=o.get(n);break}}return r||t||null}_gatherNames(e){let t={primary:new Set,alternate:new Set},r=new Set,s=new Set,n=!1,o=!1,a,l=this._identifyTree(e);if(!l)return t;if(l==="transit"?a={primary:/^network$/i,alternate:/^(operator|operator:\w+|network:\w+|\w+_name|\w+_name:\w+)$/i}:l==="flags"?a={primary:/^(flag:name|flag:name:\w+)$/i,alternate:/^(flag|flag:\w+|subject|subject:\w+)$/i}:l==="brands"?(o=!0,a={primary:/^(name|name:\w+)$/i,alternate:/^(brand|brand:\w+|operator|operator:\w+|\w+_name|\w+_name:\w+)/i}):l==="operators"?(o=!0,a={primary:/^(name|name:\w+|operator|operator:\w+)$/i,alternate:/^(brand|brand:\w+|\w+_name|\w+_name:\w+)/i}):(o=!0,a={primary:/^(name|name:\w+)$/i,alternate:/^(brand|brand:\w+|network|network:\w+|operator|operator:\w+|\w+_name|\w+_name:\w+)/i}),e.name&&o){let u=e.name.split(/[\s\-\/,.]/);for(let h=u.length;h>0;h--){let d=u.slice(0,h).join(" ");r.add(d)}}for(let[u,h]of Object.entries(e))!u||!h||(c(u,"primary")?/;/.test(h)?n=!0:(r.add(h),s.delete(h)):!r.has(h)&&c(u,"alternate")&&(/;/.test(h)?n=!0:s.add(h)));if(e.man_made==="flagpole"&&!r.size&&!s.size&&e.country){let u=e.country;/;/.test(u)?n=!0:s.add(u)}if(n)return t;return{primary:r,alternate:s};function c(u,h){return u==="old_name"?!1:a[h].test(u)&&!oz.test(u)}}_gatherTuples(e,t){let r=[];for(let s of["primary","alternate"]){let n=Array.from(t[s]).sort((o,a)=>a.length-o.length);for(let o of n)for(let a of["primary","alternate"])for(let l of e[a]){let[c,u]=l.split("/",2);r.push({k:c,v:u,n:o})}}return r}};function QT(i){var e={},t=null;try{t=window.localStorage}catch(l){var r=new Map;t={isMocked:!0,hasItem:c=>r.has(c),getItem:c=>r.get(c),setItem:(c,u)=>r.set(c,u),removeItem:c=>r.delete(c),clear:()=>r.clear()}}function s(l,c){if(arguments.length===1)return t.getItem(i.url+l);if(arguments.length===2)return t.setItem(i.url+l,c)}e.authenticated=function(){return!!s("oauth2_access_token")},e.logout=function(){return s("oauth2_access_token",""),s("oauth_token",""),s("oauth_token_secret",""),s("oauth_request_token_secret",""),e},e.authenticate=function(l){if(e.authenticated()){l(null,e);return}e.logout(),n(function(c,u){c?l(c):qT(function(h){o(h,u,l)})})},e.authenticateAsync=function(){return e.authenticated()?Promise.resolve(e):(e.logout(),new Promise((l,c)=>{var u=(h,d)=>{h?c(h):l(d)};n((h,d)=>{h?u(h):qT(f=>o(f,d,u))})}))};function n(l){if(i.singlepage){l(null,void 0);return}var c=550,u=610,h=[["width",c],["height",u],["left",window.screen.width/2-c/2],["top",window.screen.height/2-u/2]].map(function(p){return p.join("=")}).join(","),d=window.open("about:blank","oauth_window",h);if(d)l(null,d);else{var f=new Error("Popup was blocked");f.status="popup-blocked",l(f)}}function o(l,c,u){var h=lz(),d=i.url+"/oauth2/authorize?"+XT({client_id:i.client_id,redirect_uri:i.redirect_uri,response_type:"code",scope:i.scope,state:h,code_challenge:l.code_challenge,code_challenge_method:l.code_challenge_method});if(i.singlepage){if(t.isMocked){var f=new Error("localStorage unavailable, but required in singlepage mode");f.status="pkce-localstorage-unavailable",u(f);return}var p=cy(window.location.search.slice(1));p.code?e.bootstrapToken(p.code,u):(s("oauth2_state",h),s("oauth2_pkce_code_verifier",l.code_verifier),window.location=d)}else e.popupWindow=c,c.location=d;window.authComplete=function(g){var y=cy(g.split("?")[1]);if(y.state!==h){f=new Error("Invalid state"),f.status="invalid-state",u(f);return}a(y.code,l.code_verifier,m),delete window.authComplete};function m(g,y){if(i.done(),g){u(g);return}var x=JSON.parse(y.response);s("oauth2_access_token",x.access_token),u(null,e)}}function a(l,c,u){var h=i.url+"/oauth2/token?"+XT({client_id:i.client_id,redirect_uri:i.redirect_uri,grant_type:"authorization_code",code:l,code_verifier:c});e.rawxhr("POST",h,null,null,null,u),i.loading()}return e.bringPopupWindowToFront=function(){var l=!1;try{e.popupWindow&&!e.popupWindow.closed&&(e.popupWindow.focus(),l=!0)}catch(c){}return l},e.bootstrapToken=function(l,c){var u=s("oauth2_state");s("oauth2_state","");var h=cy(window.location.search.slice(1));if(h.state!==u){var d=new Error("Invalid state");d.status="invalid-state",c(d);return}var f=s("oauth2_pkce_code_verifier");s("oauth2_pkce_code_verifier",""),a(l,f,p);function p(m,g){if(i.done(),m){c(m);return}var y=JSON.parse(g.response);s("oauth2_access_token",y.access_token),c(null,e)}},e.fetch=function(l,c){if(e.authenticated())return u();return i.auto?e.authenticateAsync().then(u):Promise.reject(new Error("not authenticated"));function u(){return c=c||{},c.headers||(c.headers={"Content-Type":"application/x-www-form-urlencoded"}),c.headers.Authorization="Bearer "+s("oauth2_access_token"),fetch(l,c)}},e.xhr=function(l,c){if(e.authenticated())return u();if(i.auto){e.authenticate(u);return}else{c("not authenticated",null);return}function u(){var d=l.prefix!==!1?i.apiUrl+l.path:l.path;return e.rawxhr(l.method,d,s("oauth2_access_token"),l.content,l.headers,h)}function h(d,f){d?c(d):f.responseXML?c(d,f.responseXML):c(d,f.response)}},e.rawxhr=function(l,c,u,h,d,f){d=d||{"Content-Type":"application/x-www-form-urlencoded"},u&&(d.Authorization="Bearer "+u);var p=new XMLHttpRequest;p.onreadystatechange=function(){p.readyState===4&&p.status!==0&&(/^20\d$/.test(p.status)?f(null,p):f(p,null))},p.onerror=function(g){f(g,null)},p.open(l,c,!0);for(var m in d)p.setRequestHeader(m,d[m]);return p.send(h),p},e.preauth=function(l){return l&&l.access_token&&s("oauth2_access_token",l.access_token),e},e.options=function(l){return arguments.length?(i=l,i.apiUrl=i.apiUrl||"https://api.openstreetmap.org",i.url=i.url||"https://www.openstreetmap.org",i.auto=i.auto||!1,i.singlepage=i.singlepage||!1,i.loading=i.loading||function(){},i.done=i.done||function(){},e.preauth(i)):i},e.options(i),e}function XT(i){return Object.keys(i).filter(function(e){return i[e]!==void 0}).sort().map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(i[e])}).join("&")}function cy(i){for(var e=0;e<i.length&&(i[e]==="?"||i[e]==="#");)e++;return i=i.slice(e),i.split("&").reduce(function(t,r){var s=r.split("=");return s.length===2&&(t[s[0]]=decodeURIComponent(s[1])),t},{})}function YT(){return window&&window.crypto&&window.crypto.getRandomValues&&window.crypto.subtle&&window.crypto.subtle.digest}function qT(i){var e;if(YT()){var t=window.crypto.getRandomValues(new Uint8Array(32));e=uy(t.buffer);var r=Uint8Array.from(Array.from(e).map(function(o){return o.charCodeAt(0)}));window.crypto.subtle.digest("SHA-256",r).then(function(o){var a=uy(o);i({code_challenge:a,code_verifier:e,code_challenge_method:"S256"})})}else{var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";e="";for(var n=0;n<64;n++)e+=s[Math.floor(Math.random()*s.length)];i({code_verifier:e,code_challenge:e,code_challenge_method:"plain"})}}function lz(){var i;if(YT()){var e=window.crypto.getRandomValues(new Uint8Array(32));i=uy(e.buffer)}else{var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";i="";for(var r=0;r<64;r++)i+=t[Math.floor(Math.random()*t.length)]}return i}function uy(i){return btoa(String.fromCharCode.apply(null,new Uint8Array(i))).replace(/\//g,"_").replace(/\+/g,"-").replace(/[=]/g,"")}var c0=et(Zr(),1);var Ju=class extends Ce{constructor(e){super(e),this.id="osm",this._maxWayNodes=2e3,this._imageryBlocklists=[/.*\.google(apis)?\..*\/(vt|kh)[\?\/].*([xyz]=.*){3}.*/],this._wwwroot="https://www.openstreetmap.org",this._apiroot="https://api.openstreetmap.org",this._tileCache={toLoad:new Set,loaded:new Set,inflight:{},seen:new Set,rtree:new c0.default},this._noteCache={toLoad:new Set,loaded:new Set,inflight:{},inflightPost:{},note:{},closed:{},rtree:new c0.default},this._userCache={toLoad:new Set,user:{}},this._changeset={},this._tiler=new Jt,this._deferred=new Set,this._connectionID=0,this._tileZoom=16,this._noteZoom=12,this._apiStatus=null,this._rateLimit=null,this._userChangesets=null,this._userDetails=null,this._authLoading=this._authLoading.bind(this),this._authDone=this._authDone.bind(this),this._parseCapabilitiesJSON=this._parseCapabilitiesJSON.bind(this),this._parseCapabilitiesXML=this._parseCapabilitiesXML.bind(this),this._parseNodeJSON=this._parseNodeJSON.bind(this),this._parseNodeXML=this._parseNodeXML.bind(this),this._parseNoteXML=this._parseNoteXML.bind(this),this._parseRelationJSON=this._parseRelationJSON.bind(this),this._parseRelationXML=this._parseRelationXML.bind(this),this._parseUserXML=this._parseUserXML.bind(this),this._parseWayJSON=this._parseWayJSON.bind(this),this._parseWayXML=this._parseWayXML.bind(this),this.reloadApiStatus=this.reloadApiStatus.bind(this),this.throttledReloadApiStatus=on(this.reloadApiStatus,500);let t=window.location.origin,r=window.location.pathname;(t==="https://mapwith.ai"||t==="https://rapideditor.org")&&(r="/rapid/"),this._oauth=QT({url:this._wwwroot,apiUrl:this._apiroot,client_id:"O3g0mOUuA2WY5Fs826j5tP260qR3DDX7cIIE2R2WWSc",client_secret:"b4aeHD1cNeapPPQTrvpPoExqQRjybit6JBlNnxh62uE",scope:"read_prefs write_prefs write_api read_gpx write_notes",redirect_uri:`${t}${r}land.html`,loading:this._authLoading,done:this._authDone})}initAsync(){return this.resetAsync()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){for(let e of this._deferred)window.cancelIdleCallback(e),this._deferred.delete(e);return this._connectionID++,this._apiStatus=null,this._rateLimit=null,this._userChangesets=null,this._userDetails=null,Object.values(this._tileCache.inflight).forEach(this._abortRequest),Object.values(this._noteCache.inflight).forEach(this._abortRequest),Object.values(this._noteCache.inflightPost).forEach(this._abortRequest),this._changeset.inflight&&this._abortRequest(this._changeset.inflight),this._tileCache={toLoad:new Set,loaded:new Set,inflight:{},seen:new Set,rtree:new c0.default},this._noteCache={toLoad:new Set,loaded:new Set,inflight:{},inflightPost:{},note:{},closed:{},rtree:new c0.default},this._userCache={toLoad:new Set,user:{}},this._changeset={},Promise.resolve()}switchAsync(e){this._wwwroot=e.url,this._apiroot=e.apiUrl;let t=li(this._oauth.options(),"access_token");return this._oauth.options(Object.assign(t,e)),this.resetAsync().then(()=>{this.emit("authchange")})}get connectionID(){return this._connectionID}get wwwroot(){return this._wwwroot}get imageryBlocklists(){return this._imageryBlocklists}get maxWayNodes(){return this._maxWayNodes}changesetURL(e){return`${this._wwwroot}/changeset/${e}`}changesetsURL(e,t){let r=Math.max(0,Math.ceil(Math.log(t)/Math.LN2));return this._wwwroot+"/history#map="+Math.floor(t)+"/"+e[1].toFixed(r)+"/"+e[0].toFixed(r)}entityURL(e){let t=e.osmId();return`${this._wwwroot}/${e.type}/${t}`}historyURL(e){let t=e.osmId();return`${this._wwwroot}/${e.type}/${t}/history`}userURL(e){return`${this._wwwroot}/user/${e}`}noteURL(e){return`${this._wwwroot}/note/${e.id}`}noteReportURL(e){return`${this._wwwroot}/reports/new?reportable_type=Note&reportable_id=${e.id}`}loadFromAPI(e,t,r){r=Object.assign({skipSeen:!0},r);let s=this._connectionID,n=(c,u)=>{if(this._connectionID!==s){t&&t({message:"Connection Switched",status:-1});return}if(this.authenticated()&&((c==null?void 0:c.status)===400||(c==null?void 0:c.status)===401||(c==null?void 0:c.status)===403)){this.logout(),this.loadFromAPI(e,t,r);return}else if(c?c.status===509||c.status===429?c.response.text().then(d=>{let f=10,p=d.match(/ (\d+) seconds/);p&&(f=parseInt(p[1],10)),this.setRateLimit(f)}).then(()=>this.throttledReloadApiStatus()):this._apiStatus!=="error"&&this.throttledReloadApiStatus():(this._rateLimit&&(this._rateLimit=null,this.throttledReloadApiStatus()),this._apiStatus==="error"&&this.throttledReloadApiStatus()),t)return c?t(c):e.includes(".json")?this._parseJSON(u,t,r):this._parseXML(u,t,r)},o=this._apiroot+e,a=new AbortController;return(this.authenticated()?this._oauth.fetch:window.fetch)(o,{signal:a.signal}).then(Me).then(c=>n(null,c)).catch(c=>{if(c.name!=="AbortError"&&c.name==="FetchError"){n(c);return}}),a}loadEntity(e,t){let r=de.id.type(e),s=de.id.toOSM(e),n={skipSeen:!1},o=r!=="node"?"/full":"";this.loadFromAPI(`/api/0.6/${r}/${s}${o}.json`,t,n)}loadEntityVersion(e,t,r){let s=de.id.type(e),n=de.id.toOSM(e),o={skipSeen:!1};this.loadFromAPI(`/api/0.6/${s}/${n}/${t}.json`,r,o)}loadEntityRelations(e,t){let r=de.id.type(e),s=de.id.toOSM(e),n={skipSeen:!1};this.loadFromAPI(`/api/0.6/${r}/${s}/relations.json`,t,n)}loadMultiple(e,t){let r=Ut(Fe(e),de.id.type),s={skipSeen:!1};for(let[n,o]of Object.entries(r)){let a=n+"s",l=o.map(c=>de.id.toOSM(c));for(let c of p0(l,150))this.loadFromAPI(`/api/0.6/${a}.json?${a}=`+c.join(),t,s)}}createChangeset(e,t){if(this._changeset.inflight)return t({message:"Changeset already inflight",status:-2});if(!this.authenticated())return t({message:"Not Authenticated",status:-3});let r=(l,c)=>{if(this._changeset.inflight=null,l)return t(l,e);this._changeset.openChangesetID=c,e=e.update({id:c}),t(null,e)};if(this._changeset.openChangesetID)return r(null,this._changeset.openChangesetID);let s=this._wrapcb(r),n=this._apiroot+"/api/0.6/changeset/create",o=new AbortController,a={method:"PUT",headers:{"Content-Type":"text/xml"},body:Gn.stringify(e.asJXON()),signal:o.signal};this._oauth.fetch(n,a).then(Me).then(l=>s(null,l)).catch(l=>{if(this._changeset.inflight=null,l.name!=="AbortError"&&l.name==="FetchError"){s(l);return}}),this._changeset.inflight=o}uploadChangeset(e,t,r){if(this._changeset.inflight)return r({message:"Changeset already inflight",status:-2});if(this.authenticated()){if(e.id!==this._changeset.openChangesetID)return r({message:"Changeset ID mismatch",status:-4})}else return r({message:"Not Authenticated",status:-3});let s=u=>{this._changeset.inflight=null,r(u,e)},n=this._wrapcb(s),o=this._apiroot+`/api/0.6/changeset/${e.id}/upload`,a=new AbortController,l={method:"POST",headers:{"Content-Type":"text/xml"},body:Gn.stringify(e.osmChangeJXON(t)),signal:a.signal};this.context.systems.editor.clearBackup(),this._oauth.fetch(o,l).then(Me).then(u=>n(null,u)).catch(u=>{if(this._changeset.inflight=null,u.name!=="AbortError"&&u.name==="FetchError"){n(u);return}}),this._changeset.inflight=a}closeChangeset(e,t){if(this._changeset.inflight)return t({message:"Changeset already inflight",status:-2});if(this.authenticated()){if(e.id!==this._changeset.openChangesetID)return t({message:"Changeset ID mismatch",status:-4})}else return t({message:"Not Authenticated",status:-3});let r=l=>{this._changeset.inflight=null,this._changeset.openChangesetID=null,t(l,e)},s=this._wrapcb(r),n=this._apiroot+`/api/0.6/changeset/${e.id}/close`,o=new AbortController,a={method:"PUT",headers:{"Content-Type":"text/xml"},signal:o.signal};this._oauth.fetch(n,a).then(Me).then(l=>s(null,l)).catch(l=>{if(this._changeset.inflight=null,l.name!=="AbortError"&&l.name==="FetchError"){s(l);return}}),this._changeset.inflight=o}sendChangeset(e,t,r){let s=this._connectionID;this.createChangeset(e,(n,o)=>{if(e=o,n)return r(n,e);this.uploadChangeset(e,t,(a,l)=>{if(e=l,a)return r(a,e);window.setTimeout(()=>{this._changeset.openChangesetID=null,r(null,e)},2500),this.connectionID===s&&this.closeChangeset(e,()=>{})})})}loadUsers(e,t){let r=[],s=[];for(let a of Fe(e))this._userCache.user[a]?(this._userCache.toLoad.delete(a),s.push(this._userCache.user[a])):r.push(a);if((s.length||!this.authenticated())&&(t(null,s),!this.authenticated()))return;let n=(a,l)=>{if(a)return t(a);t(null,l.data)},o={skipSeen:!0};for(let a of p0(r,150))this.loadFromAPI("/api/0.6/users.json?users="+a.join(),n,o)}loadUser(e,t){if(this._userCache.user[e]||!this.authenticated())return this._userCache.toLoad.delete(e),t(null,this._userCache.user[e]);let r=(n,o)=>{if(n)return t(n);t(null,o.data[0])},s={skipSeen:!0};this.loadFromAPI(`/api/0.6/user/${e}.json`,r,s)}userDetails(e){if(this._userDetails)return e(null,this._userDetails);let t=(s,n)=>{if(s)return e(s);this._userDetails=n.data[0],e(null,this._userDetails)},r={skipSeen:!1};this.loadFromAPI("/api/0.6/user/details.json",t,r)}userChangesets(e){if(this._userChangesets)return e(null,this._userChangesets);let t=(n,o)=>n?e(n):(this._userChangesets=o.data,e(null,this._userChangesets)),r={skipSeen:!1},s=(n,o)=>{if(n)return e(n);this.loadFromAPI(`/api/0.6/changesets.json?user=${o.id}`,t,r)};this.userDetails(s)}status(e){let t=(n,o)=>{if((n==null?void 0:n.message)==="Connection Switched"){this._apiStatus=null,this.status(e);return}else{if(n)return e(n,"error");if(this._rateLimit)return e(null,"ratelimit");{let a=this._parseCapabilitiesJSON(o);return e(null,a)}}},r=this._apiroot+"/api/capabilities.json",s=this._wrapcb(t);fetch(r).then(Me).then(n=>s(null,n)).catch(n=>s(n))}reloadApiStatus(){this.status((e,t)=>{t!==this._apiStatus&&(this._apiStatus=t,this.emit("apistatuschange",e,t))})}loadTiles(e,t){if(this._paused||this.getRateLimit())return;let r=this._tiler.zoomRange(this._tileZoom).getTiles(e).tiles,s=this._tileCache,n=this._hasInflightRequests(s);this._abortUnwantedRequests(s,r),n&&!this._hasInflightRequests(s)&&this.emit("loaded");for(let o of r)this.loadTile(o,t)}setRateLimit(e=10){return isNaN(e)||!isFinite(e)||e<=0?this._rateLimit:this._rateLimit&&this._rateLimit.remaining>=e?this._rateLimit:(this._tileCache.toLoad.clear(),this._noteCache.toLoad.clear(),Object.values(this._tileCache.inflight).forEach(this._abortRequest),Object.values(this._noteCache.inflight).forEach(this._abortRequest),this._rateLimit={start:Math.floor(Date.now()/1e3),duration:e,remaining:e,elapsed:0})}getRateLimit(){var o,a;if(!this._rateLimit)return null;let e=Math.floor(Date.now()/1e3),t=(o=this._rateLimit.start)!=null?o:e,r=(a=this._rateLimit.duration)!=null?a:10,s=e-t;s<-5&&(this._rateLimit.start=e,s=0);let n=r-s;return n>0?(this._rateLimit.remaining=n,this._rateLimit.elapsed=s,this._rateLimit):(this._rateLimit=null,null)}loadTile(e,t){if(this._paused||this.getRateLimit())return;let r=this._tileCache;if(r.loaded.has(e.id)||r.inflight[e.id])return;let s=this.context.systems.locations;if(e.wgs84Extent.polygon().slice(0,4).every(u=>s.blocksAt(u).length)){r.loaded.add(e.id);return}this._hasInflightRequests(r)||this.emit("loading");let a=(u,h)=>{if(delete r.inflight[e.id],!u){r.toLoad.delete(e.id),r.loaded.add(e.id);let d=e.wgs84Extent.bbox();d.id=e.id,r.rtree.insert(d)}t&&t(u,Object.assign({},h,{tile:e})),this._hasInflightRequests(r)||this.emit("loaded")},l="/api/0.6/map.json?bbox=",c={skipSeen:!0};r.inflight[e.id]=this.loadFromAPI(l+e.wgs84Extent.toParam(),a,c)}isDataLoaded(e){let t={minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]};return this._tileCache.rtree.collides(t)}loadTileAtLoc(e,t){if(this._paused||this.getRateLimit())return;let r=this._tileCache;if(r.toLoad.size>50)return;let s=Ti(this._tileZoom+1),n=new gr().scale(s).project(e),o=new gr().transform({k:s,x:-n[0],y:-n[1]}),a=this._tiler.zoomRange(this._tileZoom).getTiles(o).tiles;for(let l of a)r.toLoad.has(l.id)||r.loaded.has(l.id)||r.inflight[l.id]||(r.toLoad.add(l.id),this.loadTile(l,t))}loadNotes(e,t){if(this._paused||this.getRateLimit())return;t=Object.assign({limit:1e4,closed:7},t);let r=this._noteCache,s=this,n="/api/0.6/notes?limit="+t.limit+"&closed="+t.closed+"&bbox=",o=on(()=>{let l=[...s._userCache.toLoad.values()];l.length&&s.loadUsers(l,function(){})},750),a=this._tiler.zoomRange(this._noteZoom).getTiles(e).tiles;this._abortUnwantedRequests(r,a);for(let l of a){if(r.loaded.has(l.id)||r.inflight[l.id])continue;let c=this.context.systems.locations;if(l.wgs84Extent.polygon().slice(0,4).every(f=>c.blocksAt(f).length)){r.loaded.add(l.id);continue}let d={skipSeen:!1};r.inflight[l.id]=this.loadFromAPI(n+l.wgs84Extent.toParam(),function(f){delete s._noteCache.inflight[l.id],f||s._noteCache.loaded.add(l.id),s.emit("loadedNotes")},d)}}postNoteCreate(e,t){if(this._noteCache.inflightPost[e.id])return t({message:"Note update already inflight",status:-2},e);if(!this.authenticated())return t({message:"Not Authenticated",status:-3},e);if(!e.loc[0]||!e.loc[1]||!e.newComment)return;let r=(l,c)=>{if(delete this._noteCache.inflightPost[e.id],l)return t(l);this.removeNote(e);let u={skipSeen:!1};return this._parseXML(c,(h,d)=>h?t(h):t(null,d.data[0]),u)},s=this._wrapcb(r),n=this._apiroot+"/api/0.6/notes?"+tt({lon:e.loc[0],lat:e.loc[1],text:e.newComment}),o=new AbortController,a={method:"POST",signal:o.signal};this._oauth.fetch(n,a).then(Me).then(l=>s(null,l)).catch(l=>{if(this._changeset.inflight=null,l.name!=="AbortError"&&l.name==="FetchError"){s(l);return}}),this._noteCache.inflightPost[e.id]=o}postNoteUpdate(e,t,r){if(!this.authenticated())return r({message:"Not Authenticated",status:-3},e);if(this._noteCache.inflightPost[e.id])return r({message:"Note update already inflight",status:-2},e);let s;if(e.status!=="closed"&&t==="closed")s="close";else if(e.status!=="open"&&t==="open")s="reopen";else if(s="comment",!e.newComment)return;let n=(u,h)=>{if(delete this._noteCache.inflightPost[e.id],u)return r(u);this.removeNote(e),s==="close"?this._noteCache.closed[e.id]=!0:s==="reopen"&&delete this._noteCache.closed[e.id];let d={skipSeen:!1};return this._parseXML(h,(f,p)=>f?r(f):r(null,p.data[0]),d)},o=this._wrapcb(n),a=this._apiroot+`/api/0.6/notes/${e.id}/${s}`;e.newComment&&(a+="?"+tt({text:e.newComment}));let l=new AbortController,c={method:"POST",signal:l.signal};this._oauth.fetch(a,c).then(Me).then(u=>o(null,u)).catch(u=>{if(this._changeset.inflight=null,u.name!=="AbortError"&&u.name==="FetchError"){o(u);return}}),this._noteCache.inflightPost[e.id]=l}caches(e){function t(r){let s={};for(let[n,o]of Object.entries(r))if(n==="rtree")s.rtree=new c0.default().fromJSON(o.toJSON());else if(n==="toLoad"||n==="loaded"||n==="seen")s[n]=new Set(o);else if(n==="note"){s.note={};for(let a of Object.keys(o))s.note[a]=_t(r.note[a])}else s[n]=JSON.parse(JSON.stringify(o));return s}return e===void 0?{tile:t(this._tileCache),note:t(this._noteCache),user:t(this._userCache)}:e==="get"?{tile:this._tileCache,note:this._noteCache,user:this._userCache}:(e.tile&&(this._tileCache=e.tile,this._tileCache.inflight={}),e.note&&(this._noteCache=e.note,this._noteCache.inflight={},this._noteCache.inflightPost={}),e.user&&(this._userCache=e.user),this)}logout(){return this._rateLimit=null,this._userChangesets=null,this._userDetails=null,this._oauth.logout(),this.emit("authchange"),this}authenticated(){return this._oauth.authenticated()}authenticate(e){let t=this._connectionID;this._rateLimit=null,this._userChangesets=null,this._userDetails=null;let r=(s,n)=>{if(s){e&&e(s);return}if(this._connectionID!==t){e&&e({message:"Connection Switched",status:-1});return}this.reloadApiStatus(),this.userChangesets(function(){}),this.emit("authchange"),e&&e(s,n)};this._oauth.authenticate(r)}notes(e){let t=e.dimensions(),r=[t[0][0],t[1][1]],s=[t[1][0],t[0][1]],n=new ie(e.invert(r),e.invert(s)).bbox();return this._noteCache.rtree.search(n).map(o=>o.data)}getNote(e){return this._noteCache.note[e]}removeNote(e){!(e instanceof _t)||!e.id||(delete this._noteCache.note[e.id],this._updateRtree(this._encodeNoteRtree(e),!1))}replaceNote(e){if(!(!(e instanceof _t)||!e.id))return this._noteCache.note[e.id]=e,this._updateRtree(this._encodeNoteRtree(e),!0),e}getClosedIDs(){return Object.keys(this._noteCache.closed).sort()}_authLoading(){this.emit("authLoading")}_authDone(){this.emit("authDone")}_abortRequest(e){e&&e.abort()}_hasInflightRequests(e){return Object.keys(e.inflight).length}_abortUnwantedRequests(e,t){for(let r of Object.keys(e.inflight))e.toLoad.has(r)||t.find(s=>s.id===r)||(this._abortRequest(e.inflight[r]),delete e.inflight[r])}_getLoc(e){var s,n;let t=(s=e.lon)==null?void 0:s.value,r=(n=e.lat)==null?void 0:n.value;return[parseFloat(t),parseFloat(r)]}_getNodes(e){return Array.from(e.getElementsByTagName("nd")).map(r=>"n"+r.attributes.ref.value)}_getNodesJSON(e){var t;return((t=e.nodes)!=null?t:[]).map(r=>"n"+r)}_getTags(e){var s,n;let t=Array.from(e.getElementsByTagName("tag")),r={};for(let o of t){let a=o.attributes,l=((s=a.k.value)!=null?s:"").trim(),c=((n=a.v.value)!=null?n:"").trim();l&&(r[l]=c)}return r}_getMembers(e){return Array.from(e.getElementsByTagName("member")).map(r=>{let s=r.attributes;return{id:s.type.value[0]+s.ref.value,type:s.type.value,role:s.role.value}})}_getMembersJSON(e){var t;return((t=e.members)!=null?t:[]).map(r=>({id:r.type[0]+r.ref,type:r.type,role:r.role}))}_parseComments(e){let t=[];for(let r of e)if(r.nodeName==="comment"){let s={};for(let n of r.childNodes){let o=n.nodeName;if(o!=="#text"&&(s[o]=n.textContent,o==="uid")){let a=n.textContent;a&&!this._userCache.user[a]&&this._userCache.toLoad.add(a)}}Object.keys(s).length&&t.push(s)}return t}_encodeNoteRtree(e){return{minX:e.loc[0],minY:e.loc[1],maxX:e.loc[0],maxY:e.loc[1],data:e}}_parseJSON(e,t,r){var c,u;if(r=Object.assign({skipSeen:!0},r),!e)return t({message:"No JSON",status:-1});let s=e;typeof s!="object"&&(s=JSON.parse(e));let n=(c=s.elements)!=null?c:[],o=(u=s.user?[s.user]:s.users)!=null?u:[],a=(s==null?void 0:s.changesets)||[];if(!n||!o||!a)return t({message:"No JSON",status:-1});if(n.some(h=>h.type==="error"))return t({message:"Partial JSON",status:-1});let l=window.requestIdleCallback(()=>{var d,f,p,m,g,y,x,b,_,w;this._deferred.delete(l);let h={data:[],seenIDs:new Set};for(let A of n){let k;if(A.type==="node"?k=this._parseNodeJSON:A.type==="way"?k=this._parseWayJSON:A.type==="relation"&&(k=this._parseRelationJSON),!k)continue;let v=de.id.fromOSM(A.type,A.id);if(h.seenIDs.add(v),r.skipSeen){if(this._tileCache.seen.has(v))continue;this._tileCache.seen.add(v)}let E=k(A,v);E&&h.data.push(E)}for(let A of o){let k=(d=A.id)==null?void 0:d.toString();if(!k||(this._userCache.toLoad.delete(k),h.seenIDs.add(k),r.skipSeen&&this._userCache.user[k]))continue;let v={id:k,display_name:A.display_name,account_created:A.account_created,image_url:(f=A.img)==null?void 0:f.href,changesets_count:(g=(m=(p=A.changesets)==null?void 0:p.count)==null?void 0:m.toString())!=null?g:"0",active_blocks:(_=(b=(x=(y=A.blocks)==null?void 0:y.received)==null?void 0:x.active)==null?void 0:b.toString())!=null?_:"0"};this._userCache.user[k]=v,h.data.push(v)}for(let A of a)(w=A==null?void 0:A.tags)!=null&&w.comment&&h.data.push(A);t(null,h)});this._deferred.add(l)}_parseXML(e,t,r){if(r=Object.assign({skipSeen:!0},r),!e||!e.childNodes)return t({message:"No XML",status:-1});let s=e.childNodes[0],n=Array.from(s.childNodes);if(n.some(a=>a.nodename==="error"))return t({message:"Partial XML",status:-1});let o=window.requestIdleCallback(()=>{this._deferred.delete(o);let a={data:[],seenIDs:new Set};for(let l of n){let c;if(l.nodeName==="node"?c=this._parseNodeXML:l.nodeName==="way"?c=this._parseWayXML:l.nodeName==="relation"?c=this._parseRelationXML:l.nodeName==="note"?c=this._parseNoteXML:l.nodeName==="user"&&(c=this._parseUserXML),!c)continue;let u;if(l.nodeName==="user"){if(u=l.attributes.id.value,a.seenIDs.add(u),r.skipSeen&&this._userCache.user[u]){this._userCache.toLoad.delete(u);continue}}else if(l.nodeName==="note")u=l.getElementsByTagName("id")[0].textContent,a.seenIDs.add(u);else if(u=de.id.fromOSM(l.nodeName,l.attributes.id.value),a.seenIDs.add(u),r.skipSeen){if(this._tileCache.seen.has(u))continue;this._tileCache.seen.add(u)}let h=c(l,u);h&&a.data.push(h)}t(null,a)});this._deferred.add(o)}_parseNodeJSON(e,t){var r,s,n;return new Be({id:t,visible:typeof e.visible=="boolean"?e.visible:!0,version:(r=e.version)==null?void 0:r.toString(),changeset:(s=e.changeset)==null?void 0:s.toString(),timestamp:e.timestamp,user:e.user,uid:(n=e.uid)==null?void 0:n.toString(),loc:[parseFloat(e.lon),parseFloat(e.lat)],tags:e.tags})}_parseWayJSON(e,t){var r,s,n;return new pt({id:t,visible:typeof e.visible=="boolean"?e.visible:!0,version:(r=e.version)==null?void 0:r.toString(),changeset:(s=e.changeset)==null?void 0:s.toString(),timestamp:e.timestamp,user:e.user,uid:(n=e.uid)==null?void 0:n.toString(),tags:e.tags,nodes:this._getNodesJSON(e)})}_parseRelationJSON(e,t){var r,s,n;return new Qt({id:t,visible:typeof e.visible=="boolean"?e.visible:!0,version:(r=e.version)==null?void 0:r.toString(),changeset:(s=e.changeset)==null?void 0:s.toString(),timestamp:e.timestamp,user:e.user,uid:(n=e.uid)==null?void 0:n.toString(),tags:e.tags,members:this._getMembersJSON(e)})}_parseNodeXML(e,t){var s,n,o,a;let r=e.attributes;return new Be({id:t,visible:!r.visible||r.visible.value!=="false",version:r.version.value,changeset:(s=r.changeset)==null?void 0:s.value,timestamp:(n=r.timestamp)==null?void 0:n.value,user:(o=r.user)==null?void 0:o.value,uid:(a=r.uid)==null?void 0:a.value,loc:this._getLoc(r),tags:this._getTags(e)})}_parseWayXML(e,t){var s,n,o,a;let r=e.attributes;return new pt({id:t,visible:!r.visible||r.visible.value!=="false",version:r.version.value,changeset:(s=r.changeset)==null?void 0:s.value,timestamp:(n=r.timestamp)==null?void 0:n.value,user:(o=r.user)==null?void 0:o.value,uid:(a=r.uid)==null?void 0:a.value,tags:this._getTags(e),nodes:this._getNodes(e)})}_parseRelationXML(e,t){var s,n,o,a;let r=e.attributes;return new Qt({id:t,visible:!r.visible||r.visible.value!=="false",version:r.version.value,changeset:(s=r.changeset)==null?void 0:s.value,timestamp:(n=r.timestamp)==null?void 0:n.value,user:(o=r.user)==null?void 0:o.value,uid:(a=r.uid)==null?void 0:a.value,tags:this._getTags(e),members:this._getMembers(e)})}_parseNoteXML(e,t){let r=e.attributes,s=e.childNodes,n={};n.id=t,n.loc=this._getLoc(r);let o=!1,a=1e-5;do{o&&(n.loc=dt(n.loc,[a,a]));let u=new ie(n.loc).bbox();o=this._noteCache.rtree.search(u).length}while(o);for(let u of s){let h=u.nodeName;h!=="#text"&&(h==="comments"?n[h]=this._parseComments(u.childNodes):n[h]=u.textContent)}let l=new _t(n),c=this._encodeNoteRtree(l);return this._noteCache.note[l.id]=l,this._noteCache.rtree.insert(c),l}_parseUserXML(e,t){var l,c;let r=e.attributes,s={id:t,display_name:(l=r.display_name)==null?void 0:l.value,account_created:(c=r.account_created)==null?void 0:c.value,changesets_count:"0",active_blocks:"0"},n=e.getElementsByTagName("img");n&&n[0]&&n[0].getAttribute("href")&&(s.image_url=n[0].getAttribute("href"));let o=e.getElementsByTagName("changesets");o&&o[0]&&o[0].getAttribute("count")&&(s.changesets_count=o[0].getAttribute("count"));let a=e.getElementsByTagName("blocks");if(a&&a[0]){let u=a[0].getElementsByTagName("received");u&&u[0]&&u[0].getAttribute("active")&&(s.active_blocks=u[0].getAttribute("active"))}return this._userCache.user[t]=s,this._userCache.toLoad.delete(t),s}_parseCapabilitiesJSON(e){let t=[];for(let n of e.policy.imagery.blacklist){let o=n.regex;if(o)try{t.push(new RegExp(o))}catch(a){}}t.length&&(this._imageryBlocklists=t);let r=e.api.waynodes.maximum;return r&&isFinite(r)&&(this._maxWayNodes=r),e.api.status.api}_parseCapabilitiesXML(e){let t=[];for(let o of e.getElementsByTagName("blacklist")){let a=o.getAttribute("regex");if(a)try{t.push(new RegExp(a))}catch(l){}}t.length&&(this._imageryBlocklists=t);let r=e.getElementsByTagName("waynodes"),s=r.length&&parseInt(r[0].getAttribute("maximum"),10);return s&&isFinite(s)&&(this._maxWayNodes=s),e.getElementsByTagName("status")[0].getAttribute("api")}_updateRtree(e,t){this._noteCache.rtree.remove(e,(r,s)=>r.data.id===s.data.id),t&&this._noteCache.rtree.insert(e)}_wrapcb(e){let t=this._connectionID;return(r,s)=>r?((r.status===400||r.status===401||r.status===403)&&this.logout(),e.call(this,r)):this._connectionID!==t?e.call(this,{message:"Connection Switched",status:-1}):e.call(this,r,s)}};var KT=et(Zr(),1);var cz=14,t7="https://osmose.openstreetmap.fr/api/0.3",e3=class extends Ce{constructor(e){super(e),this.id="osmose",this.autoStart=!1,this._osmoseColors=new Map,this._osmoseStrings=new Map,this._osmoseData={icons:{},types:[]},this._cache=null,this._tiler=new Jt().zoomRange(cz).skipNullIsland(!0)}initAsync(){return this.resetAsync()}startAsync(){return this.context.systems.dataloader.getDataAsync("qa_data").then(t=>{this._osmoseData.icons=t.osmose.icons,this._osmoseData.types=Object.keys(t.osmose.icons).map(r=>r.split("-")[0]).reduce((r,s)=>r.indexOf(s)!==-1?r:[...r,s],[])}).then(()=>this._loadStringsAsync()).then(()=>this._started=!0)}resetAsync(){return this._cache&&Object.values(this._cache.inflightTile).forEach(e=>this._abortRequest(e)),this._cache={issues:new Map,loadedTile:{},inflightTile:{},inflightPost:{},closed:{},rtree:new KT.default},Promise.resolve()}getData(){let e=this.context.systems.map.extent();return this._cache.rtree.search(e.bbox()).map(t=>t.data)}loadTiles(){let e=this.context.projection,t=this._tiler.getTiles(e).tiles;this._abortUnwantedRequests(this._cache,t);for(let r of t){if(this._cache.loadedTile[r.id]||this._cache.inflightTile[r.id])continue;let[s,n,o]=r.xyz,a={item:this._osmoseData.types},l=`${t7}/issues/${o}/${s}/${n}.json?`+tt(a),c=new AbortController;this._cache.inflightTile[r.id]=c,fetch(l,{signal:c.signal}).then(Me).then(u=>{var h;this._cache.loadedTile[r.id]=!0;for(let d of(h=u.features)!=null?h:[]){let{item:f,class:p,uuid:m}=d.properties,g=`${f}-${p}`;if(g in this._osmoseData.icons){let y=d.geometry.coordinates;y=this._preventCoincident(y);let x=new ut(y,this,g,m,{item:f});(f===8300||f===8360)&&(x.elems=[]),this._cache.issues.set(x.id,x),this._cache.rtree.insert(this._encodeIssueRtree(x))}}this.context.deferredRedraw(),this.emit("loadedData")}).catch(u=>{u.name!=="AbortError"&&(this._cache.loadedTile[r.id]=!0)}).finally(()=>{delete this._cache.inflightTile[r.id]})}}loadIssueDetailAsync(e){if(e.elems!==void 0)return Promise.resolve(e);let t=this.context.systems.l10n.localeCode(),r=`${t7}/issue/${e.id}?langs=${t}`,s=n=>{e.elems=n.elems.map(o=>o.type.substring(0,1)+o.id),e.detail=n.subtitle?Ke.parse(n.subtitle.auto):"",this.replaceItem(e)};return fetch(r).then(Me).then(s).then(()=>e)}getStrings(e,t){var s,n;return t=t||this.context.systems.l10n.localeCode(),(n=((s=this._osmoseStrings.get(t))!=null?s:{})[e])!=null?n:{}}getColor(e){var t;return(t=this._osmoseColors.get(e))!=null?t:16777215}getIcon(e){return this._osmoseData.icons[e]}postUpdate(e,t){if(this._cache.inflightPost[e.id])return t({message:"Issue update already inflight",status:-2},e);let r=`${t7}/issue/${e.id}/${e.newStatus}`,s=new AbortController,n=()=>{delete this._cache.inflightPost[e.id],this.removeItem(e),e.newStatus==="done"&&(e.item in this._cache.closed||(this._cache.closed[e.item]=0),this._cache.closed[e.item]+=1),t&&t(null,e)};this._cache.inflightPost[e.id]=s,fetch(r,{signal:s.signal}).then(n).catch(o=>{delete this._cache.inflightPost[e.id],t&&t(o.message)})}getError(e){return this._cache.issues.get(e)}replaceItem(e){if(!(!(e instanceof ut)||!e.id))return this._cache.issues.set(e.id,e),this._updateRtree(this._encodeIssueRtree(e),!0),e}removeItem(e){!(e instanceof ut)||!e.id||(this._cache.isseus.delete(e.id),this._updateRtree(this._encodeIssueRtree(e),!1))}getClosedCounts(){return this._cache.closed}itemURL(e){return`https://osmose.openstreetmap.fr/en/error/${e.id}`}_abortRequest(e){e&&e.abort()}_abortUnwantedRequests(e,t){Object.keys(e.inflightTile).forEach(r=>{t.find(n=>r===n.id)||(this._abortRequest(e.inflightTile[r]),delete e.inflightTile[r])})}_encodeIssueRtree(e){return{minX:e.loc[0],minY:e.loc[1],maxX:e.loc[0],maxY:e.loc[1],data:e}}_updateRtree(e,t){this._cache.rtree.remove(e,(r,s)=>r.data.id===s.data.id),t&&this._cache.rtree.insert(e)}_preventCoincident(e){let t=!1;do{e=dt(e,t?[1e-5,0]:[0,1e-5]);let s=new ie(e).bbox();t=this._cache.rtree.search(s).length}while(t);return e}_loadStringsAsync(){let e=Object.keys(this._osmoseData.icons),t={},r=this.context.systems.l10n.localeCode();this._osmoseStrings.set(r,t);let s=e.map(n=>{let o=u=>{let[h={items:[]}]=u.categories,[d={class:[]}]=h.items,[f=null]=d.class;if(!f){console.log(`Osmose strings request (${n}) had unexpected data`);return}let p=d.item;this._osmoseColors.set(p,new we(d.color).toNumber());let{title:m,detail:g,fix:y,trap:x}=f,b={};m&&(b.title=m.auto.charAt(0).toUpperCase()+m.auto.slice(1)),g&&(b.detail=Ke.parse(g.auto)),x&&(b.trap=Ke.parse(x.auto)),y&&(b.fix=Ke.parse(y.auto)),t[n]=b},[a,l]=n.split("-"),c=`${t7}/items/${a}/class/${l}?langs=${r}`;return fetch(c).then(Me).then(o)}).filter(Boolean);return Promise.all(s)}};var t3=class extends Ce{constructor(e){super(e),this.id="osmwikibase",this.apibase="https://wiki.openstreetmap.org/w/api.php",this._inflight={},this._cache={},this._localeIDs={en:!1},this.claimToValue=this.claimToValue.bind(this),this.monolingualClaimToValueObj=this.monolingualClaimToValueObj.bind(this),this.toSitelink=this.toSitelink.bind(this),this.getEntity=this.getEntity.bind(this),this.getDocs=this.getDocs.bind(this),this._request=this._request.bind(this),this._debouncedRequest=wt(this._request,500,{leading:!1})}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this._debouncedRequest.cancel(),Object.values(this._inflight).forEach(e=>e.abort()),this._inflight={},Promise.resolve()}claimToValue(e,t,r){var l;if(!e.claims[t])return;let s=this._localeIDs[r],n,o;for(let c of e.claims[t]){!n&&c.rank==="preferred"&&(n=c);let u=((l=c.qualifiers)==null?void 0:l.P26)&&c.qualifiers.P26[0].datavalue.value.id;s&&u===s&&(o=c)}let a=o!=null?o:n;if(a){let c=a.mainsnak.datavalue;return c.type==="wikibase-entityid"?c.value.id:c.value}else return}monolingualClaimToValueObj(e,t){if(e!=null&&e.claims[t])return e.claims[t].reduce(function(r,s){var n=s.mainsnak.datavalue.value;return r[n.language]=n.text,r},{})}toSitelink(e,t){return(t?`Tag:${e}=${t}`:`Key:${e}`).replace(/_/g," ").trim()}getEntity(e,t){let r=e.debounce?this._debouncedRequest:this._request,s=e.key==="type"&&e.value?`Relation:${e.value}`.replace(/_/g," ").trim():!1,n=e.key?this.toSitelink(e.key):!1,o=e.key&&e.value?this.toSitelink(e.key,e.value):!1,a=[],l={},c;if(e.langCodes)for(let d of e.langCodes)this._localeIDs[d]===void 0&&(c=`Locale:${d}`.replace(/_/g," ").trim(),a.push(c));if(s&&(this._cache[s]?l.rtype=this._cache[s]:a.push(s)),n&&(this._cache[n]?l.key=this._cache[n]:a.push(n)),o&&(this._cache[o]?l.tag=this._cache[o]:a.push(o)),!a.length)return t(null,l);let u={action:"wbgetentities",sites:"wiki",titles:a.join("|"),languages:e.langCodes.join("|"),languagefallback:1,origin:"*",format:"json"},h=this.apibase+"?"+tt(u);r(h,(d,f)=>{if(d)t(d);else if(!f.success||f.error)t(f.error.messages.map(p=>p.html["*"]).join("<br>"));else{let p=!1;for(let m of Object.values(f.entities))if(m.missing!==""){let g=m.sitelinks.wiki.title;g===s?(this._cache[s]=m,l.rtype=m):g===n?(this._cache[n]=m,l.key=m):g===o?(this._cache[o]=m,l.tag=m):g===c?p=m.id:console.log(`Unexpected title ${g}`)}c&&this.addLocale(e.langCodes[0],p),t(null,l)}})}getDocs(e,t){let r=this.context.systems.l10n.localeCodes().map(s=>s.toLowerCase());e.langCodes=r,this.getEntity(e,(s,n)=>{var f,p,m;if(s){t(s);return}let o=n.rtype||n.tag||n.key;if(!o){t("No entity");return}let a;for(let g of r)if(((f=o.descriptions[g])==null?void 0:f.language)===g){a=o.descriptions[g];break}!a&&Object.values(o.descriptions).length&&(a=Object.values(o.descriptions)[0]);let l={title:o.title,description:(p=a==null?void 0:a.value)!=null?p:"",descriptionLocaleCode:(m=a==null?void 0:a.language)!=null?m:"",editURL:`https://wiki.openstreetmap.org/wiki/${o.title}`};if(o.claims){let g,y=this.claimToValue(o,"P4",r[0]);y?g="https://commons.wikimedia.org/w/index.php":(y=this.claimToValue(o,"P28",r[0]),y&&(g="https://wiki.openstreetmap.org/w/index.php")),g&&y&&(l.imageURL=g+"?"+tt({title:`Special:Redirect/file/${y}`,width:400}))}let c=this.monolingualClaimToValueObj(n.rtype,"P31"),u=this.monolingualClaimToValueObj(n.tag,"P31"),h=this.monolingualClaimToValueObj(n.key,"P31");for(let g of[c,u,h]){for(let y of r){let b=r[0].split("-")[0]!=="en"&&y.split("-")[0]==="en"?"inspector.wiki_en_reference":"inspector.wiki_reference",_=d(g,y,b);if(_){l.wiki=_;break}}if(l.wiki)break}t(null,l);function d(g,y,x){if(g&&g[y])return{title:g[y],text:x,url:`https://wiki.openstreetmap.org/wiki/${g[y]}`}}})}addLocale(e,t){this._localeIDs[e]=t}_request(e,t){if(this._inflight[e])return;let r=new AbortController;this._inflight[e]=r,fetch(e,{signal:r.signal}).then(Me).then(s=>{delete this._inflight[e],t&&t(null,s)}).catch(s=>{delete this._inflight[e],s.name!=="AbortError"&&t&&t(s.message)})}};var JT=et(Zr(),1);var uz="https://cdn.jsdelivr.net/npm/pannellum@2/build/pannellum.min.js",hz="https://cdn.jsdelivr.net/npm/pannellum@2/build/pannellum.min.css",ZT=16.5,i3=class extends Ce{constructor(e){super(e),this.id="streetside",this.autoStart=!1,this._loadPromise=null,this._startPromise=null,this._hires=!1,this._resolution=512,this._currScene=0,this._cache={},this._pannellumViewer=null,this._nextSequenceID=0,this._waitingForPhotoID=null,this._sceneOptions={showFullscreenCtrl:!1,autoLoad:!0,compass:!0,yaw:0,hfov:45,minHfov:10,maxHfov:90,type:"cubemap",cubeMap:[]},this._keydown=this._keydown.bind(this),this._setupCanvas=this._setupCanvas.bind(this),this._tiler=new Jt().zoomRange(ZT).skipNullIsland(!0)}_keydown(e){var r,s,n;((s=(r=document.activeElement)==null?void 0:r.tagName)!=null?s:"BODY")!=="BODY"||!this.viewerShowing||!((n=this.context.systems.photos._currLayerID)!=null&&n.startsWith("streetside"))||(e.key==="ArrowLeft"||e.key==="ArrowDown"?this._step(-1):(e.key==="ArrowUp"||e.key==="ArrowRight")&&this._step(1))}initAsync(){return this.resetAsync()}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context,t=e.container().select(".photoviewer").selectAll(".ms-wrapper").data([0]),r=t.enter().append("div").attr("class","photo-wrapper ms-wrapper").classed("hide",!0);r.append("div").attr("id","rapideditor-viewer-streetside").on("pointerdown.streetside",()=>{G(window).on("pointermove.streetside",()=>{this.emit("viewerChanged"),this.context.systems.map.immediateRedraw()},!0)}).on("pointerup.streetside pointercancel.streetside",()=>{G(window).on("pointermove.streetside",null);let o=Ql(a=>{this.emit("viewerChanged"),a>2e3&&o.stop()})}).append("div").attr("class","photo-attribution fillD");let s=r.append("div").attr("class","photo-controls-wrap").append("div").attr("class","photo-controls");return s.append("button").on("click.back",()=>this._step(-1)).html("\u25C4"),s.append("button").on("click.forward",()=>this._step(1)).html("\u25BA"),t=t.merge(r).call(this._setupCanvas),e.systems.ui.photoviewer.on("resize.streetside",()=>{this._pannellumViewer&&this._pannellumViewer.resize()}),this.context.systems.map.renderer.events.on("keydown",this._keydown),this._startPromise=this._loadAssetsAsync().then(()=>this._started=!0).catch(o=>{o instanceof Error&&console.error(o),this._startPromise=null})}resetAsync(){if(this._cache.inflight)for(let e of this._cache.inflight.values())e.controller.abort();return this._cache={rtree:new JT.default,inflight:new Map,loaded:new Set,bubbles:new Map,sequences:new Map,unattachedBubbles:new Set,bubbleHasSequences:new Map,metadataPromise:null},Promise.resolve()}getImages(){let e=this.context.systems.map.extent();return this._cache.rtree.search(e.bbox()).map(t=>t.data)}getSequences(){var s;let e=this._cache,t=this.context.systems.map.extent(),r=new Map;for(let n of e.rtree.search(t.bbox())){let o=n.data.id,a=(s=e.bubbleHasSequences.get(o))!=null?s:[];for(let l of a)r.has(l)||r.set(l,e.sequences.get(l))}return[...r.values()]}loadTiles(){let t=this.context.projection,r=this._tiler.zoomRange(ZT).margin(2).getTiles(t).tiles;for(let[s,n]of this._cache.inflight)r.find(a=>a.id===s)||n.controller.abort();for(let s of r){let n=s.id;this._cache.loaded.has(n)||this._cache.inflight.has(n)||this._loadTileAsync(s)}}get viewerShowing(){return this._showing}showViewer(){let e=this.context.container().select(".photoviewer").classed("hide",!1);e.selectAll(".photo-wrapper.ms-wrapper.hide").size()&&(e.selectAll(".photo-wrapper:not(.ms-wrapper)").classed("hide",!0),this._showing=!0,e.selectAll(".photo-wrapper.ms-wrapper").classed("hide",!1))}hideViewer(){let e=this.context;e.systems.photos.selectPhoto(null);let t=e.container().select(".photoviewer");t.empty()||t.datum(null),t.classed("hide",!0).selectAll(".photo-wrapper").classed("hide",!0),this._showing=!1,e.container().selectAll(".viewfield-group, .sequence, .icon-sign").classed("currentView",!1),this.setStyles(e,null,!0),this.emit("imageChanged")}selectImageAsync(e){let t=this._cache.bubbles.get(e),r=this.context,s=r.systems.l10n,n=r.container().select(".photoviewer");n.empty()||n.datum(t),this.setStyles(r,null,!0);let o=r.container().select(".photoviewer .ms-wrapper"),a=o.selectAll(".photo-attribution").html("");if(o.selectAll(".pnlm-load-box").style("display","block").style("transform","translate(-50%, -50%)"),e&&!t&&(this._waitingForPhotoID=e),!t)return Promise.resolve();this._sceneOptions.northOffset=t.ca;let l=a.append("div").attr("class","attribution-row"),c=us("streetside-hires"),u=l.append("label").attr("for",c).attr("class","streetside-hires");u.append("input").attr("type","checkbox").attr("id",c).property("checked",this._hires).on("click",A=>{A.stopPropagation(),this._hires=!this._hires,this._resolution=this._hires?1024:512,o.call(this._setupCanvas);let k={yaw:this._pannellumViewer.getYaw(),pitch:this._pannellumViewer.getPitch(),hfov:this._pannellumViewer.getHfov()};this._sceneOptions=Object.assign(this._sceneOptions,k),r.systems.photos.selectPhoto(),r.systems.photos.selectPhoto("streetside",t.id)}),u.append("span").text(s.t("streetside.hires"));let h=l.append("div").attr("class","attribution-capture-info");if(t.captured_by){let A=new Date().getFullYear();h.append("a").attr("class","captured_by").attr("target","_blank").attr("href","https://www.microsoft.com/en-us/maps/streetside").text(`\xA9 ${A} Microsoft`),h.append("span").text("|")}t.captured_at&&h.append("span").attr("class","captured_at").text(this._localeDateString(t.captured_at));let d=a.append("div").attr("class","attribution-row");d.append("a").attr("class","image-view-link").attr("target","_blank").attr("href","https://www.bing.com/maps?cp="+t.loc[1]+"~"+t.loc[0]+"&lvl=17&dir="+t.ca+"&style=x&v=2&sV=1").text(s.t("streetside.view_on_bing")),d.append("a").attr("class","image-report-link").attr("target","_blank").attr("href","https://www.bing.com/maps/privacyreport/streetsideprivacyreport?bubbleid="+encodeURIComponent(t.id)+"&focus=photo&lat="+t.loc[1]+"&lng="+t.loc[0]+"&z=17").text(s.t("streetside.report"));let f="https://ecn.t0.tiles.virtualearth.net/tiles/",m=parseInt(t.id,10).toString(4),g=16-m.length;for(let A=0;A<g;A++)m="0"+m;let y=f+"hs"+m,x="?g=13305&n=z",b=["01","02","03","10","11","12"],_=this._getQuadKeys(),w=b.map(A=>_.map(k=>{let v=this._qkToXY(k);return{face:A,url:y+A+k+x,x:v[0],y:v[1]}}));return this._loadFacesAsync(w).then(()=>{if(!this._pannellumViewer)this._initViewer();else{this._currScene++;let A=this._currScene.toString();this._pannellumViewer.addScene(A,this._sceneOptions).loadScene(A),this._currScene>2&&(A=(this._currScene-1).toString(),this._pannellumViewer.removeScene(A))}})}setStyles(e,t,r){r&&(e.container().selectAll(".viewfield-group").classed("highlighted",!1).classed("hovered",!1).classed("currentView",!1),e.container().selectAll(".sequence").classed("highlighted",!1).classed("currentView",!1));let s=t==null?void 0:t.id,n=t==null?void 0:t.sequenceID,o=n&&this._cache.sequences.get(n),a=o&&o.bubbles.map(g=>g.id)||[],l=e.container().select(".photoviewer"),c=l.empty()?void 0:l.datum(),u=c==null?void 0:c.id,h=c==null?void 0:c.sequenceID,d=h&&this._cache.sequences.get(h),f=d&&d.bubbles.map(g=>g.id)||[],p=Gt(a,f);e.container().selectAll(".layer-streetside-images .viewfield-group").classed("highlighted",g=>p.indexOf(g.id)!==-1).classed("hovered",g=>g.id===s).classed("currentView",g=>g.id===u),e.container().selectAll(".layer-streetside-images .sequence").classed("highlighted",g=>g.properties.id===n).classed("currentView",g=>g.properties.id===h),e.container().selectAll(".layer-streetside-images .viewfield-group .viewfield").attr("d",m);function m(){let g=this.parentNode.__data__;return g.isPano&&g.id!==u?"M 8,13 m -10,0 a 10,10 0 1,0 20,0 a 10,10 0 1,0 -20,0":"M 6,9 C 8,8.4 8,8.4 10,9 L 16,-2 C 12,-5 4,-5 0,-2 z"}}_loadAssetsAsync(){return this._loadPromise?this._loadPromise:this._loadPromise=new Promise((e,t)=>{let r=0,s=()=>{++r===2&&e()},n=G("head");n.selectAll("#rapideditor-pannellum-css").data([0]).enter().append("link").attr("id","rapideditor-pannellum-css").attr("rel","stylesheet").attr("crossorigin","anonymous").attr("href",hz).on("load",s).on("error",t),n.selectAll("#rapideditor-pannellum-js").data([0]).enter().append("script").attr("id","rapideditor-pannellum-js").attr("crossorigin","anonymous").attr("src",uz).on("load",s).on("error",t)})}_initViewer(){if(!window.pannellum)throw new Error("pannellum not loaded");if(this._pannellumViewer)return;this._currScene++;let e=this._currScene.toString(),t={default:{firstScene:e},scenes:{}};t.scenes[e]=this._sceneOptions,this._pannellumViewer=window.pannellum.viewer("rapideditor-viewer-streetside",t)}_step(e){let t=this.context,r=t.container().select(".photoviewer"),s=r.empty()?void 0:r.datum();if(!s)return;let n=e===1?s.ne:s.pr,o=this._pannellumViewer.getYaw();this._sceneOptions.yaw=o;let a=s.ca+o,l=s.loc,c=35,u=[l[0]+ki(c/5,l[1]),l[1]],h=[l[0]+ki(c/2,l[1]),l[1]+gn(c)],d=[l[0]-ki(c/2,l[1]),l[1]+gn(c)],f=[l[0]-ki(c/5,l[1]),l[1]],p=[u,h,d,f,u],m=(e===1?a:a+180)*(Math.PI/180);p=Zn(p,-m,l);let g=p.reduce((b,_)=>(b.min=[Math.min(b.min[0],_[0]),Math.min(b.min[1],_[1])],b.max=[Math.max(b.max[0],_[0]),Math.max(b.max[1],_[1])],b),new ie),y=1/0;this._cache.rtree.search(g.bbox()).forEach(b=>{if(b.data.id===s.id||!t1(b.data.loc,p))return;let _=Ue(b.data.loc,s.loc),w=s.ca-b.data.ca;Math.min(Math.abs(w),360-Math.abs(w))>20&&(_+=5),_<y&&(n=b.data.id,y=_)});let x=this._cache.bubbles.get(n);x&&(t.systems.map.centerEase(x.loc),t.systems.photos.selectPhoto("streetside",x.id),this.emit("imageChanged"))}_localeDateString(e){if(!e)return null;let t={day:"numeric",month:"short",year:"numeric"},r=new Date(e);if(isNaN(r.getTime()))return null;let s=this.context.systems.l10n.localeCode();return r.toLocaleString(s,t)}_loadedBubbleData(e){let t=this._cache;t.loaded.add(e.tile.id);let r=e.data;if(!r)return;if(r.error)throw new Error(r.error);r.shift();let s=null,n=r.map(o=>{var h,d;let l=o.id.toString();if(this._waitingForPhotoID===l&&(s=l,this._waitingForPhotoID=null),t.bubbles.has(l))return null;let c=[o.lo,o.la],u={loc:c,id:l,ca:o.he,captured_at:o.cd,captured_by:"microsoft",pr:(h=o.pr)==null?void 0:h.toString(),ne:(d=o.ne)==null?void 0:d.toString(),isPano:!0};return t.bubbles.set(l,u),t.unattachedBubbles.add(l),{minX:c[0],minY:c[1],maxX:c[0],maxY:c[1],data:u}}).filter(Boolean);if(this._cache.rtree.load(n),this._connectSequences(),s){let o=this.context.systems.photos;o.selectPhoto(),o.selectPhoto("streetside",s)}this.context.deferredRedraw(),this.emit("loadedData")}_connectSequences(){let e=this._cache,t=new Set,r=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}),s=Array.from(e.unattachedBubbles).sort(r.compare),n=(o,a)=>{t.add(o),e.unattachedBubbles.delete(a);let l=e.bubbleHasSequences.get(a);l||(l=[],e.bubbleHasSequences.set(a,l)),l.push(o)};for(let o of s){let a=e.unattachedBubbles.has(o),l=e.bubbles.get(o);if(!l||!a)continue;let c=l.ne,u=c&&e.bubbles.get(c),h=l.pr,d=h&&e.bubbles.get(h);if(c&&u){let f,p,m=u&&e.bubbleHasSequences.get(c)||[];for(f of m){p=e.sequences.get(f);let g=p.bubbleIDs.at(0),y=p.bubbleIDs.at(-1);if(c===y){p.bubbleIDs.push(o),n(f,o);break}else if(c===g){p.bubbleIDs.unshift(o),n(f,o);break}}}if(h&&d){let f,p,m=d&&e.bubbleHasSequences.get(h)||[];for(f of m){p=e.sequences.get(f);let g=p.bubbleIDs.at(0),y=p.bubbleIDs.at(-1);if(h===y){p.bubbleIDs.push(o),n(f,o);break}else if(h===g){p.bubbleIDs.unshift(o),n(f,o);break}}}if(e.unattachedBubbles.has(o)){let p=`s${this._nextSequenceID++}`,m={id:p,v:0,bubbleIDs:[o]};e.sequences.set(p,m),n(p,o),h&&d&&(m.bubbleIDs.unshift(h),n(p,h)),c&&u&&(m.bubbleIDs.push(c),n(p,c))}}for(let o of t){let a=e.sequences.get(o),l=a.bubbleIDs.map(c=>e.bubbles.get(c));a.v++,a.captured_at=l[0].captured_at,a.captured_by=l[0].captured_by,a.coordinates=l.map(c=>c.loc)}}_fetchMetadataAsync(e){if(this._cache.metadataPromise)return this._cache.metadataPromise;let[t,r]=e.wgs84Extent.center(),o=`https://dev.virtualearth.net/REST/v1/Imagery/MetaData/Streetside/${r},${t}?key=AoG8TaQvkPo6o8SlpRVmBs7WJwO_NDQklVRcAfpn7P8oiEMYWNY59XHSJU81sP1Y`;this._cache.metadataPromise=fetch(o).then(Me).then(a=>{if(!a)throw new Error("no data");return a})}_loadTileAsync(e){let t=this._cache.inflight.get(e.id);if(t)return t.promise;let[r,s,n,o]=e.wgs84Extent.rectangle(),u="https://t.ssl.ak.tiles.virtualearth.net/tiles/cmd/StreetSideBubbleMetaData?"+tt({north:o,south:s,east:n,west:r,count:2e3,key:"AuftgJsO0Xs8Ts4M1xZUQJQXJNsvmh3IV8DkNieCiy3tCwCUMq76-WpkrBtNAuEm"}),h=new AbortController,d=fetch(u,{signal:h.signal}).then(Me).then(f=>{this._loadedBubbleData({data:JSON.parse(f),tile:e})}).catch(f=>{f.name!=="AbortError"&&f instanceof Error&&console.error(f)}).finally(()=>{this._cache.inflight.delete(e.id)});return this._cache.inflight.set(e.id,{promise:d,controller:h}),d}_loadImageAsync(e){return new Promise(t=>{let r=e.face,s=document.getElementById(`rapideditor-canvas${r}`),n=s.getContext("2d"),o=new Image;o.onload=()=>{n.drawImage(o,e.x,e.y),t({imgInfo:e,status:"ok"})},o.onerror=()=>{n.clearRect(0,0,s.width,s.height),t({imgInfo:e,status:"error"})},o.setAttribute("crossorigin",""),o.src=e.url})}_loadFaceAsync(e){return Promise.all(e.map(t=>this._loadImageAsync(t))).then(t=>{let r=t[0].imgInfo.face,s=document.getElementById(`rapideditor-canvas${r}`),n={"01":0,"02":1,"03":2,10:3,11:4,12:5};return this._sceneOptions.cubeMap[n[r]]=s.toDataURL("image/jpeg",1),{status:`face ${r} ok`}})}_loadFacesAsync(e){return Promise.all(e.map(t=>this._loadFaceAsync(t))).then(()=>({status:"this._loadFacesAsync done"}))}_setupCanvas(e){e.selectAll("#rapideditor-stitcher-canvases").remove(),e.selectAll("#rapideditor-stitcher-canvases").data([0]).enter().append("div").attr("id","rapideditor-stitcher-canvases").attr("display","none").selectAll("canvas").data(["canvas01","canvas02","canvas03","canvas10","canvas11","canvas12"]).enter().append("canvas").attr("id",t=>`rapideditor-${t}`).attr("width",this._resolution).attr("height",this._resolution)}_qkToXY(e){let t=0,r=0,s=256;for(let n=e.length;n>0;n--){let o=e[n-1];t+=+(o==="1"||o==="3")*s,r+=+(o==="2"||o==="3")*s,s*=2}return[t,r]}_getQuadKeys(){let e=this._resolution/256,t;return e===16?t=["0000","0001","0010","0011","0100","0101","0110","0111","1000","1001","1010","1011","1100","1101","1110","1111","0002","0003","0012","0013","0102","0103","0112","0113","1002","1003","1012","1013","1102","1103","1112","1113","0020","0021","0030","0031","0120","0121","0130","0131","1020","1021","1030","1031","1120","1121","1130","1131","0022","0023","0032","0033","0122","0123","0132","0133","1022","1023","1032","1033","1122","1123","1132","1133","0200","0201","0210","0211","0300","0301","0310","0311","1200","1201","1210","1211","1300","1301","1310","1311","0202","0203","0212","0213","0302","0303","0312","0313","1202","1203","1212","1213","1302","1303","1312","1313","0220","0221","0230","0231","0320","0321","0330","0331","1220","1221","1230","1231","1320","1321","1330","1331","0222","0223","0232","0233","0322","0323","0332","0333","1222","1223","1232","1233","1322","1323","1332","1333","2000","2001","2010","2011","2100","2101","2110","2111","3000","3001","3010","3011","3100","3101","3110","3111","2002","2003","2012","2013","2102","2103","2112","2113","3002","3003","3012","3013","3102","3103","3112","3113","2020","2021","2030","2031","2120","2121","2130","2131","3020","3021","3030","3031","3120","3121","3130","3131","2022","2023","2032","2033","2122","2123","2132","2133","3022","3023","3032","3033","3122","3123","3132","3133","2200","2201","2210","2211","2300","2301","2310","2311","3200","3201","3210","3211","3300","3301","3310","3311","2202","2203","2212","2213","2302","2303","2312","2313","3202","3203","3212","3213","3302","3303","3312","3313","2220","2221","2230","2231","2320","2321","2330","2331","3220","3221","3230","3231","3320","3321","3330","3331","2222","2223","2232","2233","2322","2323","2332","2333","3222","3223","3232","3233","3322","3323","3332","3333"]:e===8?t=["000","001","010","011","100","101","110","111","002","003","012","013","102","103","112","113","020","021","030","031","120","121","130","131","022","023","032","033","122","123","132","133","200","201","210","211","300","301","310","311","202","203","212","213","302","303","312","313","220","221","230","231","320","321","330","331","222","223","232","233","322","323","332","333"]:e===4?t=["00","01","10","11","02","03","12","13","20","21","30","31","22","23","32","33"]:t=["0","1","2","3"],t}};var r3="https://taginfo.openstreetmap.org/api/4/",dz={point:"count_nodes",vertex:"count_nodes",area:"count_ways",line:"count_ways"},fz={point:"count_node_members",vertex:"count_node_members",area:"count_way_members",line:"count_way_members",relation:"count_relation_members"},pz={point:"nodes",vertex:"nodes",area:"ways",line:"ways"},mz={point:"count_node_members_fraction",vertex:"count_node_members_fraction",area:"count_way_members_fraction",line:"count_way_members_fraction",relation:"count_relation_members_fraction"},s3=class extends Ce{constructor(e){super(e),this.id="taginfo",this._inflight={},this._cache={},this._popularKeys={postal_code:!0,full_name:!0,loc_name:!0,reg_name:!0,short_name:!0,sorting_name:!0,artist_name:!0,nat_name:!0,long_name:!0,"bridge:name":!0},this.keys=this.keys.bind(this),this.multikeys=this.multikeys.bind(this),this.values=this.values.bind(this),this.roles=this.roles.bind(this),this.docs=this.docs.bind(this),this._request=this._request.bind(this),this._debouncedRequest=wt(this._request,300,{leading:!1})}initAsync(){return Promise.resolve()}startAsync(){let t={rp:100,sortname:"values_all",sortorder:"desc",page:1,debounce:!1,lang:this.context.systems.l10n.languageCode()};return new Promise((r,s)=>{this.keys(t,(n,o)=>{if(n)s();else{for(let a of o)a.value!=="opening_hours"&&(this._popularKeys[a.value]=!0);this._started=!0,r()}})})}resetAsync(){return this._debouncedRequest.cancel(),Object.values(this._inflight).forEach(e=>e.abort()),this._inflight={},Promise.resolve()}keys(e,t){let r=this.context.systems.l10n.languageCode(),s=e.debounce?this._debouncedRequest:this._request;e=this._clean(this._setSort(e)),e=Object.assign({rp:10,sortname:"count_all",sortorder:"desc",page:1,lang:r},e);let n=r3+"keys/all?"+tt(e);s(n,e,!1,t,(o,a)=>{if(o)t(o);else{let l=this._filterKeys(e.filter),c=a.data.filter(l).sort(this._sortKeys).map(this._valKey);this._cache[n]=c,t(null,c)}})}multikeys(e,t){let r=this.context.systems.l10n.languageCode(),s=e.debounce?this._debouncedRequest:this._request;e=this._clean(this._setSort(e)),e=Object.assign({rp:25,sortname:"count_all",sortorder:"desc",page:1,lang:r},e);let n=e.query,o=r3+"keys/all?"+tt(e);s(o,e,!0,t,(a,l)=>{if(a)t(a);else{let c=this._filterMultikeys(n),u=l.data.filter(c).map(this._valKey);this._cache[o]=u,t(null,u)}})}values(e,t){let r=e.key;if(r&&this._popularKeys[r]){t(null,[]);return}let s=this.context.systems.l10n.languageCode(),n=e.debounce?this._debouncedRequest:this._request;e=this._clean(this._setSort(this._setFilter(e))),e=Object.assign({rp:25,sortname:"count_all",sortorder:"desc",page:1,lang:s},e);let o=r3+"key/values?"+tt(e);n(o,e,!1,t,(a,l)=>{if(a)t(a);else{let u=/network|taxon|genus|species|brand|grape_constiety|royal_cypher|listed_status|booth|rating|stars|:output|_hours|_times|_ref|manufacturer|country|target|brewery/.test(e.key),h=this._filterValues(u),d=l.data.filter(h).map(this._valKeyDescription);this._cache[o]=d,t(null,d)}})}roles(e,t){let r=this.context.systems.l10n.languageCode(),s=e.debounce?this._debouncedRequest:this._request,n=e.geometry;e=this._clean(this._setSortMembers(e)),e=Object.assign({rp:25,sortname:"count_all_members",sortorder:"desc",page:1,lang:r},e);let o=r3+"relation/roles?"+tt(e);s(o,e,!0,t,(a,l)=>{if(a)t(a);else{let c=this._filterRoles(n),u=l.data.filter(c).map(this._roleKey);this._cache[o]=u,t(null,u)}})}docs(e,t){let r=e.debounce?this._debouncedRequest:this._request;e=this._clean(this._setSort(e));let s="key/wiki_pages?";e.value?s="tag/wiki_pages?":e.rtype&&(s="relation/wiki_pages?");let n=r3+s+tt(e);r(n,e,!0,t,(o,a)=>{o?t(o):(this._cache[n]=a.data,t(null,a.data))})}_sets(e,t,r){return e.geometry&&r[e.geometry]&&(e[t]=r[e.geometry]),e}_setFilter(e){return this._sets(e,"filter",pz)}_setSort(e){return this._sets(e,"sortname",dz)}_setSortMembers(e){return this._sets(e,"sortname",fz)}_clean(e){return li(e,["geometry","debounce"])}_filterKeys(e){let t=e?"count_"+e:"count_all";return r=>parseFloat(r[t])>2500||r.in_wiki}_filterMultikeys(e){return t=>{let r=new RegExp("^"+e+"(.*)$"),s=t.key.match(r)||[];return s.length===2&&s[1].indexOf(":")===-1}}_filterValues(e){return t=>t.value.match(/[;,]/)!==null||!e&&t.value.match(/[A-Z*]/)!==null?!1:parseFloat(t.fraction)>0}_filterRoles(e){return t=>t.role===""||t.role.match(/[A-Z*;,]/)!==null?!1:parseFloat(t[mz[e]])>0}_valKey(e){return{value:e.key,title:e.key}}_valKeyDescription(e){let t={value:e.value,title:e.description||e.value};return e.count&&(t.count=e.count),t}_roleKey(e){return{value:e.role,title:e.role}}_sortKeys(e,t){return e.key.indexOf(":")===-1&&t.key.indexOf(":")!==-1?-1:e.key.indexOf(":")!==-1&&t.key.indexOf(":")===-1?1:0}_request(e,t,r,s,n){if(this._inflight[e]||this._checkCache(e,t,r,s))return;let o=new AbortController;this._inflight[e]=o,fetch(e,{signal:o.signal}).then(Me).then(a=>{delete this._inflight[e],n&&n(null,a)}).catch(a=>{delete this._inflight[e],a.name!=="AbortError"&&n&&n(a.message)})}_checkCache(e,t,r,s){var l,c;let n=(l=t.rp)!=null?l:25,o=(c=t.query)!=null?c:"",a=e;do{let u=this._cache[a];if(u&&(e===a||u.length<n))return s(null,u),!0;if(r||!o.length)return!1;o=o.slice(0,-1),a=e.replace(/&query=(.*?)&/,`&query=${o}&`)}while(o.length>=0);return!1}};var vI=et(ey(),1),gy=et(tu(),1);var Ir=(i,e,t)=>new Promise((r,s)=>{var n=l=>{try{a(t.next(l))}catch(c){s(c)}},o=l=>{try{a(t.throw(l))}catch(c){s(c)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(n,o);a((t=t.apply(i,e)).next())}),ls=Uint8Array,h0=Uint16Array,gz=Int32Array,iI=new ls([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),rI=new ls([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),yz=new ls([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),sI=function(i,e){for(var t=new h0(31),r=0;r<31;++r)t[r]=e+=1<<i[r-1];for(var s=new gz(t[30]),r=1;r<30;++r)for(var n=t[r];n<t[r+1];++n)s[n]=n-t[r]<<5|r;return{b:t,r:s}},nI=sI(iI,2),oI=nI.b,xz=nI.r;oI[28]=258,xz[258]=28;var aI=sI(rI,0),vz=aI.b,yJe=aI.r,fy=new h0(32768);for(At=0;At<32768;++At)Io=(At&43690)>>1|(At&21845)<<1,Io=(Io&52428)>>2|(Io&13107)<<2,Io=(Io&61680)>>4|(Io&3855)<<4,fy[At]=((Io&65280)>>8|(Io&255)<<8)>>1;var Io,At,a3=function(i,e,t){for(var r=i.length,s=0,n=new h0(e);s<r;++s)i[s]&&++n[i[s]-1];var o=new h0(e);for(s=1;s<e;++s)o[s]=o[s-1]+n[s-1]<<1;var a;if(t){a=new h0(1<<e);var l=15-e;for(s=0;s<r;++s)if(i[s])for(var c=s<<4|i[s],u=e-i[s],h=o[i[s]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)a[fy[h]>>l]=c}else for(a=new h0(r),s=0;s<r;++s)i[s]&&(a[s]=fy[o[i[s]-1]++]>>15-i[s]);return a},l3=new ls(288);for(At=0;At<144;++At)l3[At]=8;var At;for(At=144;At<256;++At)l3[At]=9;var At;for(At=256;At<280;++At)l3[At]=7;var At;for(At=280;At<288;++At)l3[At]=8;var At,lI=new ls(32);for(At=0;At<32;++At)lI[At]=5;var At,_z=a3(l3,9,1),bz=a3(lI,5,1),hy=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},cn=function(i,e,t){var r=e/8|0;return(i[r]|i[r+1]<<8)>>(e&7)&t},dy=function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(e&7)},wz=function(i){return(i+7)/8|0},Ez=function(i,e,t){(e==null||e<0)&&(e=0),(t==null||t>i.length)&&(t=i.length);var r=new ls(t-e);return r.set(i.subarray(e,t)),r},Az=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],as=function(i,e,t){var r=new Error(e||Az[i]);if(r.code=i,Error.captureStackTrace&&Error.captureStackTrace(r,as),!t)throw r;return r},my=function(i,e,t,r){var s=i.length,n=r?r.length:0;if(!s||e.f&&!e.l)return t||new ls(0);var o=!t||e.i!=2,a=e.i;t||(t=new ls(s*3));var l=function(oe){var re=t.length;if(oe>re){var W=new ls(Math.max(re*2,oe));W.set(t),t=W}},c=e.f||0,u=e.p||0,h=e.b||0,d=e.l,f=e.d,p=e.m,m=e.n,g=s*8;do{if(!d){c=cn(i,u,1);var y=cn(i,u+1,3);if(u+=3,y)if(y==1)d=_z,f=bz,p=9,m=5;else if(y==2){var w=cn(i,u,31)+257,A=cn(i,u+10,15)+4,k=w+cn(i,u+5,31)+1;u+=14;for(var v=new ls(k),E=new ls(19),S=0;S<A;++S)E[yz[S]]=cn(i,u+S*3,7);u+=A*3;for(var M=hy(E),I=(1<<M)-1,T=a3(E,M,1),S=0;S<k;){var C=T[cn(i,u,I)];u+=C&15;var x=C>>4;if(x<16)v[S++]=x;else{var P=0,D=0;for(x==16?(D=3+cn(i,u,3),u+=2,P=v[S-1]):x==17?(D=3+cn(i,u,7),u+=3):x==18&&(D=11+cn(i,u,127),u+=7);D--;)v[S++]=P}}var O=v.subarray(0,w),R=v.subarray(w);p=hy(O),m=hy(R),d=a3(O,p,1),f=a3(R,m,1)}else as(1);else{var x=wz(u)+4,b=i[x-4]|i[x-3]<<8,_=x+b;if(_>s){a&&as(0);break}o&&l(h+b),t.set(i.subarray(x,_),h),e.b=h+=b,e.p=u=_*8,e.f=c;continue}if(u>g){a&&as(0);break}}o&&l(h+131072);for(var N=(1<<p)-1,F=(1<<m)-1,B=u;;B=u){var P=d[dy(i,u)&N],$=P>>4;if(u+=P&15,u>g){a&&as(0);break}if(P||as(2),$<256)t[h++]=$;else if($==256){B=u,d=null;break}else{var U=$-254;if($>264){var S=$-257,H=iI[S];U=cn(i,u,(1<<H)-1)+oI[S],u+=H}var z=f[dy(i,u)&F],j=z>>4;z||as(3),u+=z&15;var R=vz[j];if(j>3){var H=rI[j];R+=dy(i,u)&(1<<H)-1,u+=H}if(u>g){a&&as(0);break}o&&l(h+131072);var X=h+U;if(h<R){var K=n-R,Y=Math.min(R,X);for(K+h<0&&as(3);h<Y;++h)t[h]=r[K+h]}for(;h<X;h+=4)t[h]=t[h-R],t[h+1]=t[h+1-R],t[h+2]=t[h+2-R],t[h+3]=t[h+3-R];h=X}}e.l=d,e.p=B,e.b=h,e.f=c,d&&(c=1,e.m=p,e.d=f,e.n=m)}while(!c);return h==t.length?t:Ez(t,0,h)},Sz=new ls(0),Cz=function(i){(i[0]!=31||i[1]!=139||i[2]!=8)&&as(6,"invalid gzip data");var e=i[3],t=10;e&4&&(t+=(i[10]|i[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!i[t++]);return t+(e&2)},kz=function(i){var e=i.length;return(i[e-4]|i[e-3]<<8|i[e-2]<<16|i[e-1]<<24)>>>0},Tz=function(i,e){return((i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31)&&as(6,"invalid zlib data"),(i[1]>>5&1)==+!e&&as(6,"invalid zlib data: "+(i[1]&32?"need":"unexpected")+" dictionary"),(i[1]>>3&4)+2};function Iz(i,e){return my(i,{i:2},e&&e.out,e&&e.dictionary)}function Mz(i,e){var t=Cz(i);return t+8>i.length&&as(6,"invalid gzip data"),my(i.subarray(t,-8),{i:2},e&&e.out||new ls(kz(i)),e&&e.dictionary)}function Pz(i,e){return my(i.subarray(Tz(i,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function py(i,e){return i[0]==31&&i[1]==139&&i[2]==8?Mz(i,e):(i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31?Iz(i,e):Pz(i,e)}var Dz=typeof TextDecoder!="undefined"&&new TextDecoder,Rz=0;try{Dz.decode(Sz,{stream:!0}),Rz=1}catch(i){}var cI=(i,e)=>i*Math.pow(2,e),n3=(i,e)=>Math.floor(i/Math.pow(2,e)),i7=(i,e)=>cI(i.getUint16(e+1,!0),8)+i.getUint8(e),uI=(i,e)=>cI(i.getUint32(e+2,!0),16)+i.getUint16(e,!0),Nz=(i,e,t,r,s)=>{if(i!=r.getUint8(s))return i-r.getUint8(s);let n=i7(r,s+1);if(e!=n)return e-n;let o=i7(r,s+4);return t!=o?t-o:0},Fz=(i,e,t,r)=>{let s=hI(i,e|128,t,r);return s?{z:e,x:t,y:r,offset:s[0],length:s[1],is_dir:!0}:null},eI=(i,e,t,r)=>{let s=hI(i,e,t,r);return s?{z:e,x:t,y:r,offset:s[0],length:s[1],is_dir:!1}:null},hI=(i,e,t,r)=>{let s=0,n=i.byteLength/17-1;for(;s<=n;){let o=n+s>>1,a=Nz(e,t,r,i,o*17);if(a>0)s=o+1;else if(a<0)n=o-1;else return[uI(i,o*17+7),i.getUint32(o*17+13,!0)]}return null},Lz=(i,e)=>i.is_dir&&!e.is_dir?1:!i.is_dir&&e.is_dir?-1:i.z!==e.z?i.z-e.z:i.x!==e.x?i.x-e.x:i.y-e.y,dI=(i,e)=>{let t=i.getUint8(e*17);return{z:t&127,x:i7(i,e*17+1),y:i7(i,e*17+4),offset:uI(i,e*17+7),length:i.getUint32(e*17+13,!0),is_dir:t>>7===1}},tI=i=>{let e=[],t=new DataView(i);for(let r=0;r<t.byteLength/17;r++)e.push(dI(t,r));return Oz(e)},Oz=i=>{i.sort(Lz);let e=new ArrayBuffer(17*i.length),t=new Uint8Array(e);for(let r=0;r<i.length;r++){let s=i[r],n=s.z;s.is_dir&&(n=n|128),t[r*17]=n,t[r*17+1]=s.x&255,t[r*17+2]=s.x>>8&255,t[r*17+3]=s.x>>16&255,t[r*17+4]=s.y&255,t[r*17+5]=s.y>>8&255,t[r*17+6]=s.y>>16&255,t[r*17+7]=s.offset&255,t[r*17+8]=n3(s.offset,8)&255,t[r*17+9]=n3(s.offset,16)&255,t[r*17+10]=n3(s.offset,24)&255,t[r*17+11]=n3(s.offset,32)&255,t[r*17+12]=n3(s.offset,48)&255,t[r*17+13]=s.length&255,t[r*17+14]=s.length>>8&255,t[r*17+15]=s.length>>16&255,t[r*17+16]=s.length>>24&255}return e},Bz=(i,e)=>{if(i.byteLength<17)return null;let t=i.byteLength/17,r=dI(i,t-1);if(r.is_dir){let s=r.z,n=e.z-s,o=Math.trunc(e.x/(1<<n)),a=Math.trunc(e.y/(1<<n));return{z:s,x:o,y:a}}return null};function Uz(i){return Ir(this,null,function*(){let e=yield i.getBytes(0,512e3),t=new DataView(e.data),r=t.getUint32(4,!0),s=t.getUint16(8,!0),n=new TextDecoder("utf-8"),o=JSON.parse(n.decode(new DataView(e.data,10,r))),a=0;o.compression==="gzip"&&(a=2);let l=0;"minzoom"in o&&(l=+o.minzoom);let c=0;"maxzoom"in o&&(c=+o.maxzoom);let u=0,h=0,d=0,f=-180,p=-85,m=180,g=85;if(o.bounds){let x=o.bounds.split(",");f=+x[0],p=+x[1],m=+x[2],g=+x[3]}if(o.center){let x=o.center.split(",");u=+x[0],h=+x[1],d=+x[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+r,rootDirectoryLength:s*17,jsonMetadataOffset:10,jsonMetadataLength:r,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:l,maxZoom:c,minLon:f,minLat:p,maxLon:m,maxLat:g,centerZoom:d,centerLon:u,centerLat:h,etag:e.etag}})}function $z(i,e,t,r,s,n,o){return Ir(this,null,function*(){let a=yield t.getArrayBuffer(e,i.rootDirectoryOffset,i.rootDirectoryLength,i);i.specVersion===1&&(a=tI(a));let l=eI(new DataView(a),r,s,n);if(l){let h=(yield e.getBytes(l.offset,l.length,o)).data,d=new DataView(h);return d.getUint8(0)==31&&d.getUint8(1)==139&&(h=py(new Uint8Array(h))),{data:h}}let c=Bz(new DataView(a),{z:r,x:s,y:n});if(c){let u=Fz(new DataView(a),c.z,c.x,c.y);if(u){let h=yield t.getArrayBuffer(e,u.offset,u.length,i);i.specVersion===1&&(h=tI(h));let d=eI(new DataView(h),r,s,n);if(d){let p=(yield e.getBytes(d.offset,d.length,o)).data,m=new DataView(p);return m.getUint8(0)==31&&m.getUint8(1)==139&&(p=py(new Uint8Array(p))),{data:p}}}}})}var fI={getHeader:Uz,getZxy:$z};function u0(i,e){return(e>>>0)*4294967296+(i>>>0)}function Hz(i,e){let t=e.buf,r,s;if(s=t[e.pos++],r=(s&112)>>4,s<128||(s=t[e.pos++],r|=(s&127)<<3,s<128)||(s=t[e.pos++],r|=(s&127)<<10,s<128)||(s=t[e.pos++],r|=(s&127)<<17,s<128)||(s=t[e.pos++],r|=(s&127)<<24,s<128)||(s=t[e.pos++],r|=(s&1)<<31,s<128))return u0(i,r);throw new Error("Expected varint not more than 10 bytes")}function o3(i){let e=i.buf,t,r;return r=e[i.pos++],t=r&127,r<128||(r=e[i.pos++],t|=(r&127)<<7,r<128)||(r=e[i.pos++],t|=(r&127)<<14,r<128)||(r=e[i.pos++],t|=(r&127)<<21,r<128)?t:(r=e[i.pos],t|=(r&15)<<28,Hz(t,i))}function Gz(i,e,t,r){if(r==0){t==1&&(e[0]=i-1-e[0],e[1]=i-1-e[1]);let s=e[0];e[0]=e[1],e[1]=s}}var zz=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function jz(i,e,t){if(i>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,i)-1||t>Math.pow(2,i)-1)throw Error("tile x/y outside zoom level bounds");let r=zz[i],s=Math.pow(2,i),n=0,o=0,a=0,l=[e,t],c=s/2;for(;c>0;)n=(l[0]&c)>0?1:0,o=(l[1]&c)>0?1:0,a+=c*c*(3*n^o),Gz(c,l,n,o),c=c/2;return r+a}function pI(i,e){return Ir(this,null,function*(){if(e===1||e===0)return i;if(e===2){if(typeof globalThis.DecompressionStream=="undefined")return py(new Uint8Array(i));{let r=new Response(i).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}}else throw Error("Compression method not supported")})}var Vz=127;function Wz(i,e){let t=0,r=i.length-1;for(;t<=r;){let s=r+t>>1,n=e-i[s].tileId;if(n>0)t=s+1;else if(n<0)r=s-1;else return i[s]}return r>=0&&(i[r].runLength===0||e-i[r].tileId<i[r].runLength)?i[r]:null}var Xz=class{constructor(i,e=new Headers){this.url=i,this.customHeaders=e}getKey(){return this.url}setHeaders(i){this.customHeaders=i}getBytes(i,e,t){return Ir(this,null,function*(){let r;t||(r=new AbortController,t=r.signal);let s=new Headers(this.customHeaders);s.set("Range","bytes="+i+"-"+(i+e-1));let n=yield fetch(this.url,{signal:t,headers:s});if(n.status===416&&i===0){let l=n.headers.get("Content-Range");if(!l||!l.startsWith("bytes */"))throw Error("Missing content-length on 416 response");let c=+l.substr(8);n=yield fetch(this.url,{signal:t,headers:{Range:"bytes=0-"+(c-1)}})}if(n.status>=300)throw Error("Bad response code: "+n.status);let o=n.headers.get("Content-Length");if(n.status===200&&(!o||+o>e))throw r&&r.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield n.arrayBuffer(),etag:n.headers.get("ETag")||void 0,cacheControl:n.headers.get("Cache-Control")||void 0,expires:n.headers.get("Expires")||void 0}})}};function un(i,e){let t=i.getUint32(e+4,!0),r=i.getUint32(e+0,!0);return t*Math.pow(2,32)+r}function qz(i,e){let t=new DataView(i),r=t.getUint8(7);if(r>3)throw Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:un(t,8),rootDirectoryLength:un(t,16),jsonMetadataOffset:un(t,24),jsonMetadataLength:un(t,32),leafDirectoryOffset:un(t,40),leafDirectoryLength:un(t,48),tileDataOffset:un(t,56),tileDataLength:un(t,64),numAddressedTiles:un(t,72),numTileEntries:un(t,80),numTileContents:un(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function mI(i){let e={buf:new Uint8Array(i),pos:0},t=o3(e),r=[],s=0;for(let n=0;n<t;n++){let o=o3(e);r.push({tileId:s+o,offset:0,length:0,runLength:1}),s+=o}for(let n=0;n<t;n++)r[n].runLength=o3(e);for(let n=0;n<t;n++)r[n].length=o3(e);for(let n=0;n<t;n++){let o=o3(e);o===0&&n>0?r[n].offset=r[n-1].offset+r[n-1].length:r[n].offset=o-1}return r}function Qz(i){let e=new DataView(i);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var d0=class extends Error{};function Yz(i,e,t,r){return Ir(this,null,function*(){let s=yield i.getBytes(0,16384);if(new DataView(s.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Qz(s.data)<3)return[yield fI.getHeader(i)];let o=s.data.slice(0,Vz),a=s.etag;r&&s.etag!=r&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+i.getKey()),a=void 0);let l=qz(o,a);if(t){let c=s.data.slice(l.rootDirectoryOffset,l.rootDirectoryOffset+l.rootDirectoryLength),u=i.getKey()+"|"+(l.etag||"")+"|"+l.rootDirectoryOffset+"|"+l.rootDirectoryLength,h=mI(yield e(c,l.internalCompression));return[l,[u,h.length,h]]}return[l,void 0]})}function Kz(i,e,t,r,s){return Ir(this,null,function*(){let n=yield i.getBytes(t,r);if(s.etag&&s.etag!==n.etag)throw new d0(n.etag);let o=yield e(n.data,s.internalCompression),a=mI(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var Zz=class{constructor(i=100,e=!0,t=pI){this.cache=new Map,this.maxCacheEntries=i,this.counter=1,this.prefetch=e,this.decompress=t}getHeader(i,e){return Ir(this,null,function*(){let t=i.getKey();if(this.cache.has(t))return this.cache.get(t).lastUsed=this.counter++,yield this.cache.get(t).data;let r=new Promise((s,n)=>{Yz(i,this.decompress,this.prefetch,e).then(o=>{o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:Promise.resolve(o[1][2])}),s(o[0]),this.prune()}).catch(o=>{n(o)})});return this.cache.set(t,{lastUsed:this.counter++,data:r}),r})}getDirectory(i,e,t,r){return Ir(this,null,function*(){let s=i.getKey()+"|"+(r.etag||"")+"|"+e+"|"+t;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;let n=new Promise((o,a)=>{Kz(i,this.decompress,e,t,r).then(l=>{o(l),this.prune()}).catch(l=>{a(l)})});return this.cache.set(s,{lastUsed:this.counter++,data:n}),n})}getArrayBuffer(i,e,t,r){return Ir(this,null,function*(){let s=i.getKey()+"|"+(r.etag||"")+"|"+e+"|"+t;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;let n=new Promise((o,a)=>{i.getBytes(e,t).then(l=>{if(r.etag&&r.etag!==l.etag)throw new d0(l.etag);o(l.data),this.cache.has(s),this.prune()}).catch(l=>{a(l)})});return this.cache.set(s,{lastUsed:this.counter++,data:n}),n})}prune(){if(this.cache.size>=this.maxCacheEntries){let i=1/0,e;this.cache.forEach((t,r)=>{t.lastUsed<i&&(i=t.lastUsed,e=r)}),e&&this.cache.delete(e)}}invalidate(i,e){return Ir(this,null,function*(){this.cache.delete(i.getKey()),yield this.getHeader(i,e)})}},gI=class{constructor(i,e,t){typeof i=="string"?this.source=new Xz(i):this.source=i,t?this.decompress=t:this.decompress=pI,e?this.cache=e:this.cache=new Zz}getHeader(){return Ir(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(i,e,t,r){return Ir(this,null,function*(){let s=jz(i,e,t),n=yield this.cache.getHeader(this.source);if(n.specVersion<3)return fI.getZxy(n,this.source,this.cache,i,e,t,r);if(i<n.minZoom||i>n.maxZoom)return;let o=n.rootDirectoryOffset,a=n.rootDirectoryLength;for(let l=0;l<=3;l++){let c=yield this.cache.getDirectory(this.source,o,a,n),u=Wz(c,s);if(u)if(u.runLength>0){let h=yield this.source.getBytes(n.tileDataOffset+u.offset,u.length,r);if(n.etag&&n.etag!==h.etag)throw new d0(h.etag);return{data:yield this.decompress(h.data,n.tileCompression),cacheControl:h.cacheControl,expires:h.expires}}else o=n.leafDirectoryOffset+u.offset,a=u.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(i,e,t,r){return Ir(this,null,function*(){try{return yield this.getZxyAttempt(i,e,t,r)}catch(s){if(s instanceof d0)return this.cache.invalidate(this.source,s.message),yield this.getZxyAttempt(i,e,t,r);throw s}})}getMetadataAttempt(){return Ir(this,null,function*(){let i=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(i.jsonMetadataOffset,i.jsonMetadataLength);if(i.etag&&i.etag!==e.etag)throw new d0(e.etag);let t=yield this.decompress(e.data,i.internalCompression),r=new TextDecoder("utf-8");return JSON.parse(r.decode(t))})}getMetadata(){return Ir(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(i){if(i instanceof d0)return this.cache.invalidate(this.source,i.message),yield this.getMetadataAttempt();throw i}})}};var _I=et(xI(),1);var bI=et(ry(),1),wI=et(Zr(),1);var c3=class extends Ce{constructor(e){super(e),this.id="vectortile",this._sources=new Map,this._tiler=new Jt().tileSize(512).margin(1),this._nextID=0}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){for(let e of this._sources.values()){for(let t of e.inflight.values())t.abort();e.inflight.clear(),e.loaded.clear(),e.readyPromise=null;for(let t of e.zoomCache.values())t.features.clear(),t.boxes.clear(),t.toMerge.clear(),t.didMerge.clear(),t.rbush.clear();e.zoomCache.clear()}return this._sources.clear(),Promise.resolve()}getNextID(){return(this._nextID++).toString()}getData(e){let t=this._sources.get(e);if(!t)return[];let r=this.context.systems.map,s=r.extent(),n=Math.round(r.zoom())-1,o;for(let a=0;a<12;a++){if(o=t.zoomCache.get(n+a),o)return o.rbush.search(s.bbox()).map(l=>l.data);if(o=t.zoomCache.get(n-a),o)return o.rbush.search(s.bbox()).map(l=>l.data)}return[]}loadTiles(e){this._getSourceAsync(e).then(t=>{let r=t.header;if(r&&(this._tiler.zoomRange(r.minZoom,r.maxZoom),r.tileType!==1))throw new Error(`Unsupported tileType ${r.tileType}. Only Type 1 (MVT) is supported`);let s=this.context.projection,n=this._tiler.getTiles(s).tiles;for(let[a,l]of t.inflight)n.find(u=>u.id===a)||l.abort();let o=n.map(a=>this._loadTileAsync(t,a));return Promise.all(o).then(()=>this._processMergeQueue(t))})}_getSourceAsync(e){if(!e)return Promise.reject(new Error("No template"));let t=this._sources.get(e);if(!t){let r=new URL(e),s=r.hostname,n=r.pathname.split("/").at(-1);t={id:g0(e).toString(),displayName:s,template:e,inflight:new Map,loaded:new Map,zoomCache:new Map},this._sources.set(e,t),n&&/\.pmtiles$/.test(n)?(t.displayName=n,t.pmtiles=new gI(e),t.readyPromise=t.pmtiles.getHeader().then(o=>t.header=o).then(()=>Promise.resolve(t))):t.readyPromise=Promise.resolve(t)}return t.readyPromise}_getZoomCache(e,t){let r=e.zoomCache.get(t);return r||(r={features:new Map,boxes:new Map,toMerge:new Map,didMerge:new Set,rbush:new wI.default},e.zoomCache.set(t,r)),r}_loadTileAsync(e,t){let r=t.id;if(e.loaded.has(r)||e.inflight.has(r))return;let s=new AbortController;e.inflight.set(r,s);let[n,o,a]=t.xyz,l;if(e.pmtiles)l=e.pmtiles.getZxy(a,n,o,s.signal).then(c=>c==null?void 0:c.data);else{let c=e.template.replace("{x}",n).replace("{y}",o).replace(/\{[t-]y\}/,Math.pow(2,a)-o-1).replace(/\{z(oom)?\}/,a).replace(/\{switch:([^}]+)\}/,function(u,h){let d=h.split(",");return d[(n+o)%d.length]});l=fetch(c,{signal:s.signal}).then(Me)}return l.then(c=>{e.loaded.set(r,t),this._parseTileBuffer(e,t,c)}).catch(c=>{c.name!=="AbortError"&&c instanceof Error&&console.error(c)}).finally(()=>{e.inflight.delete(r)})}_parseTileBuffer(e,t,r){if(!r)return;let[s,n,o]=t.xyz,a=t.id,l=t.wgs84Extent,c=`${s-1},${n},${o}-${a}`,u=`${a}-${s+1},${n},${o}`,h=`${s},${n-1},${o}-${a}`,d=`${a}-${s},${n+1},${o}`,f=new vI.VectorTile(new bI.default(r)),p=this._getZoomCache(e,o),m=[];for(let[g,y]of Object.entries(f.layers)){if(!y)continue;let x=0,b=y.extent;for(let _=0;_<y.length;_++){let w=y.feature(_),[A,k,v,E]=w.bbox();if(A>b||k>b||v<x||E<x)continue;for(let[I,T]of Object.entries(w.properties))w.properties[I]=T.toString();let S=g0((0,_I.default)(w.properties)).toString();w.id||(w.id=S);let M=w.toGeoJSON(s,n,o);for(let I of this._toSingleFeatures(M)){let T=this._calcExtent(I);if(!isFinite(T.min[0]))continue;let C=this.getNextID();I.id=C,I.__featurehash__=C,I.geometry.type==="Polygon"&&(T.min[0]<l.min[0]&&this._queueMerge(p,C,S,c),T.max[0]>l.max[0]&&this._queueMerge(p,C,S,u),T.min[1]<l.min[1]&&this._queueMerge(p,C,S,d),T.max[1]>l.max[1]&&this._queueMerge(p,C,S,h)),m.push({id:C,extent:T,layerID:g,prophash:S,geojson:(0,gy.default)(I,!0),v:0})}}}m.length&&(this._cacheFeatures(p,m),this.context.deferredRedraw(),this.emit("loadedData"))}_queueMerge(e,t,r,s){if(e.didMerge.has(s))return;let n=e.toMerge.get(s);n||(n=new Map,e.toMerge.set(s,n));let o=n.get(r);o||(o=new Set,n.set(r,o)),o.add(t)}_processMergeQueue(e){for(let t of e.zoomCache.values())for(let[r,s]of t.toMerge){let[n,o]=r.split("-"),a=e.loaded.get(n),l=e.loaded.get(o);if(!(!a||!l)){t.didMerge.add(r);for(let[c,u]of s)this._mergePolygons(t,c,u,a,l),s.delete(c);t.toMerge.delete(r)}}}_cacheFeatures(e,t){let r=[];for(let s of t){e.features.set(s.id,s);let n=s.extent.bbox();n.data=s,e.boxes.set(s.id,n),r.push(n)}e.rbush.load(r)}_uncacheFeatureIDs(e,t){for(let r of t){let s=e.boxes.get(r);s&&(e.boxes.delete(r),e.rbush.remove(s)),e.features.delete(r)}}_mergePolygons(e,t,r,s,n){let o=Array.from(r).map(D=>e.features.get(D)).filter(Boolean);if(!o.length)return;let[a,l,c]=s.xyz,[u,h,d]=n.xyz,f=s.id,p=n.id,m=s.wgs84Extent,g=n.wgs84Extent,y=h===l+1,x=u===a+1,b=`${a-1},${l},${c}-${f}`,_=`${f}-${a+1},${l},${c}`,w=`${a},${l-1},${c}-${f}`,A=`${f}-${a},${l+1},${c}`,k=`${u-1},${h},${d}-${p}`,v=`${p}-${u+1},${h},${d}`,E=`${u},${h-1},${d}-${p}`,S=`${p}-${u},${h+1},${d}`,M=o[0];this._uncacheFeatureIDs(e,r);let I=o.map(D=>D.geojson.geometry.coordinates),T=Oh(...I);if(!T||!T.length)throw new Error("Failed to merge");let C={type:"Feature",geometry:{type:"MultiPolygon",coordinates:T},properties:Object.assign({},M.geojson.properties)},P=[];for(let D of this._toSingleFeatures(C)){let O=this._calcExtent(D);if(!isFinite(O.min[0]))continue;this._dedupePoints(D);let R=this.getNextID();D.id=R,D.__featurehash__=R,O.min[0]<m.min[0]&&this._queueMerge(e,R,t,b),y&&O.max[0]>m.max[0]&&this._queueMerge(e,R,t,_),x&&O.min[1]<m.min[1]&&this._queueMerge(e,R,t,A),O.max[1]>m.max[1]&&this._queueMerge(e,R,t,w),y&&O.min[0]<g.min[0]&&this._queueMerge(e,R,t,k),O.max[0]>g.max[0]&&this._queueMerge(e,R,t,v),O.min[1]<g.min[1]&&this._queueMerge(e,R,t,S),x&&O.max[1]>g.max[1]&&this._queueMerge(e,R,t,E),P.push({id:R,extent:O,layerID:M.layerID,prophash:t,geojson:(0,gy.default)(D,!0),v:0})}P.length&&(this._cacheFeatures(e,P),this.context.deferredRedraw())}_calcExtent(e){let t=new ie,r=e==null?void 0:e.geometry;if(!e||!r)return t;let s=r.type,n=r.coordinates,o=/^Multi/.test(s)?n:[n];if(/Polygon$/.test(s))for(let l of o){let c=l[0];for(let u of c)a(u)}else if(/LineString$/.test(s))for(let l of o)for(let c of l)a(c);else if(/Point$/.test(s))for(let l of o)a(l);return t;function a(l){t.min=[Math.min(t.min[0],l[0]),Math.min(t.min[1],l[1])],t.max=[Math.max(t.max[0],l[0]),Math.max(t.max[1],l[1])]}}_dedupePoints(e){let t=e==null?void 0:e.geometry;if(!e||!t||t.type!=="Polygon")return;let r=5e-6,s=t.coordinates;for(let n=0;n<s.length;n++){let o=s[n],a=[],l=null;for(let c=0;c<o.length;c++){let u=o[c];c===0||c===o.length-1?a.push(u):We(u,l,r)||a.push(u),l=u}s[n]=a}}_toSingleFeatures(e){var a;let t=[],r=e==null?void 0:e.geometry;if(!e||!r)return t;let s=r.type,n=r.coordinates,o=/^Multi/.test(s)?n:[n];for(let l of o)t.push({type:"Feature",id:(a=e.id)!=null?a:void 0,geometry:{type:s.replace("Multi",""),coordinates:l},properties:Object.assign({},e.properties)});return t}};var yy="https://www.wikidata.org/w/api.php?",u3=class extends Ce{constructor(e){super(e),this.id="wikidata",this._cache=new Map}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this._cache.clear(),Promise.resolve()}itemsForSearchQuery(e,t){if(!e){t&&t("No query",{});return}let r=this.languagesToQuery()[0],s=yy+tt({action:"wbsearchentities",format:"json",formatversion:2,search:e,type:"item",language:r,uselang:r,limit:10,origin:"*"});fetch(s).then(Me).then(n=>{if(n&&n.error)throw new Error(n.error);t&&t(null,n.search||{})}).catch(n=>{t&&t(n.message,{})})}itemsByTitle(e,t,r){if(!t){r&&r("No title",{});return}e=e||"en";let s=yy+tt({action:"wbgetentities",format:"json",formatversion:2,sites:e.replace(/-/g,"_")+"wiki",titles:t,languages:"en",origin:"*"});fetch(s).then(Me).then(n=>{if(n&&n.error)throw new Error(n.error);r&&r(null,n.entities||{})}).catch(n=>{r&&r(n.message,{})})}languagesToQuery(){return this.context.systems.l10n.localeCodes().map(t=>t.toLowerCase()).filter(t=>t!=="en-us")}entityByQID(e,t){if(!e){t("No qid",{});return}if(this._cache.has(e)){t&&t(null,this._cache.get(e));return}let r=this.languagesToQuery(),s=yy+tt({action:"wbgetentities",format:"json",formatversion:2,ids:e,props:"labels|descriptions|claims|sitelinks",sitefilter:r.map(n=>`${n}wiki`).join("|"),languages:r.join("|"),languagefallback:1,origin:"*"});fetch(s).then(Me).then(n=>{if(n&&n.error)throw new Error(n.error);this._cache.set(e,n.entities[e]),t&&t(null,n.entities[e]||{})}).catch(n=>{t&&t(n.message,{})})}getDocs(e,t){let r=this.languagesToQuery();this.entityByQID(e.qid,function(s,n){var l,c;if(s||!n){t(s||"No entity");return}let o;for(let u of r)if(n.descriptions[u]&&n.descriptions[u].language===u){o=n.descriptions[u];break}!o&&Object.values(n.descriptions).length&&(o=Object.values(n.descriptions)[0]);let a={title:n.id,description:(l=o==null?void 0:o.value)!=null?l:"",descriptionLocaleCode:(c=o==null?void 0:o.language)!=null?c:"",editURL:`https://www.wikidata.org/wiki/${n.id}`};if(n.claims){let u="https://commons.wikimedia.org/w/index.php?";for(let h of["P154","P18"]){let d=n.claims[h];if(d&&Object.keys(d).length){let f=d[Object.keys(d)[0]].mainsnak.datavalue.value;if(f){a.imageURL=u+tt({title:`Special:Redirect/file/${f}`,width:400});break}}}}if(n.sitelinks){let h=this.context.systems.l10n.languageCode().toLowerCase()==="en";for(let d of r){let f=`${d}wiki`;if(n.sitelinks[f]){let p=n.sitelinks[f].title,m="inspector.wiki_reference";!h&&d==="en"&&(m="inspector.wiki_en_reference"),a.wiki={title:p,text:m,url:`https://${d}.wikipedia.org/wiki/`+p.replace(/ /g,"_")};break}}}t(null,a)})}};var xy="https://en.wikipedia.org/w/api.php?",h3=class extends Ce{constructor(e){super(e),this.id="wikipedia"}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}search(e,t,r){if(!t){r&&r("No Query",[]);return}e=e||"en";let s=xy.replace("en",e)+tt({action:"query",list:"search",srlimit:"10",srinfo:"suggestion",format:"json",origin:"*",srsearch:t});fetch(s).then(Me).then(n=>{if(n&&n.error)throw new Error(n.error);if(!n||!n.query||!n.query.search)throw new Error("No Results");if(r){let o=n.query.search.map(a=>a.title);r(null,o)}}).catch(n=>{r&&r(n,[])})}suggestions(e,t,r){if(!t){r&&r("",[]);return}e=e||"en";let s=xy.replace("en",e)+tt({action:"opensearch",namespace:0,suggest:"",format:"json",origin:"*",search:t});fetch(s).then(Me).then(n=>{if(n&&n.error)throw new Error(n.error);if(!n||n.length<2)throw new Error("No Results");r&&r(null,n[1]||[])}).catch(n=>{r&&r(n.message,[])})}translations(e,t,r){if(!t){r&&r("No Title");return}e=e||"en";let s=xy.replace("en",e)+tt({action:"query",prop:"langlinks",format:"json",origin:"*",lllimit:500,titles:t});fetch(s).then(Me).then(n=>{if(n&&n.error)throw new Error(n.error);if(!n||!n.query||!n.query.pages)throw new Error("No Results");if(r){let o=n.query.pages[Object.keys(n.query.pages)[0]],a={};o&&o.langlinks&&o.langlinks.forEach(function(l){a[l.lang]=l["*"]}),r(null,a)}}).catch(n=>{r&&r(n.message)})}};var Pi={available:new Map};Pi.available.set("esri",ju);Pi.available.set("improveOSM",Vu);Pi.available.set("kartaview",Wu);Pi.available.set("keepRight",Xu);Pi.available.set("mapillary",qu);Pi.available.set("mapwithai",Qu);Pi.available.set("nominatim",Yu);Pi.available.set("nsi",Zu);Pi.available.set("osm",Ju);Pi.available.set("osmose",e3);Pi.available.set("osmwikibase",t3);Pi.available.set("streetside",i3);Pi.available.set("taginfo",s3);Pi.available.set("vectortile",c3);Pi.available.set("wikidata",u3);Pi.available.set("wikipedia",h3);function EI(){var i=["building","highway","railway","waterway","aeroway","aerialway","piste:type","boundary","power","amenity","natural","landuse","leisure","military","place","man_made","route","roller_coaster","attraction","building:part","indoor"],e=Object.keys(Po),t=["oneway","bridge","tunnel","embankment","cutting","barrier","surface","tracktype","footway","crossing","service","sport","public_transport","location","parking","golf","type","leisure","man_made","indoor"],r=function(n){return n.tags},s=function(n){n.each(function(a){var l=this.className;l.baseVal!==void 0&&(l=l.baseVal);var c=r(a),u=s.getClassesString(c,l);u!==l&&G(this).attr("class",u)})};return s.getClassesString=function(n,o){var a,l,c,u,h,d,f;/\bstroke\b/.test(o)&&n.barrier&&n.barrier!=="no"&&(f="line");var p=o.trim().split(/\s+/).filter(function(y){return y.length&&!/^tag-/.test(y)}).map(function(y){return(y==="line"||y==="area")&&f||y});for(c=0;c<i.length;c++)if(h=i[c],d=n[h],!(!d||d==="no")){h==="piste:type"?h="piste":h==="building:part"&&(h="building_part"),a=h,e.indexOf(d)!==-1?(l=d,p.push("tag-"+h)):(p.push("tag-"+h),p.push("tag-"+h+"-"+d));break}if(!a){for(c=0;c<e.length;c++)for(u=0;u<i.length;u++)if(h=e[c]+":"+i[u],d=n[h],!(!d||d==="no")){l=e[c];break}}if(!l)for(c=0;c<e.length&&(h=e[c],d=n[h],!(!(!d||d==="no")&&(d==="yes"||a&&a===d?l=h:!a&&i.indexOf(d)!==-1&&(l=h,a=d,p.push("tag-"+d)),l)));c++);for(l&&(p.push("tag-status"),p.push("tag-status-"+l)),c=0;c<t.length;c++)h=t[c],d=n[h],!(!d||d==="no"||h===a)&&(p.push("tag-"+h),p.push("tag-"+h+"-"+d));if(a==="highway"&&!Bs[n.highway]||a==="aeroway"){var m=n.highway==="track"?"unpaved":"paved";for(h in n)d=n[h],h in Ma&&(m=Ma[h][d]?"paved":"unpaved"),h in p7&&p7[h][d]&&(m="semipaved");p.push("tag-"+m)}var g=n.wikidata||n["flag:wikidata"]||n["brand:wikidata"]||n["network:wikidata"]||n["operator:wikidata"];return g&&p.push("tag-wikidata"),p.join(" ").trim()},s.tags=function(n){return arguments.length?(r=n,s):r},s}function AI(i){let e=i.systems.l10n,t=i.systems.colors;t.off("colorsloaded",s),t.on("colorsloaded",s);let r=[];function s(){let u=Object.keys(t.getAllColorSchemes());for(let h=0;h<u.length;h++){let d={},f=u[h];d.title=f,d.value=e.t(`preferences.color_selection.${f}`),r.push(d)}return r}let n=Ge(i,"preferences-color-selection").label(e.tHtml("preferences.color_selection.title")).disclosureContent(c),o=st(i,"color-selection"),a=null,l=!1;function c(u){u.selectAll(".preferences-color-selection-list").data([0]).enter().append("div").attr("class","layer-list preferences-color-selection-list").call(he(i).title(e.tHtml("preferences.color_selection.tooltip"))).append("div").append("input").attr("class","color-select").attr("placeholder",e.t("preferences.color_selection.placeholder")).call(Re).call(o).on("blur change",m=>{let g=m.currentTarget,y=g&&g.value||"";if(o.data().some(b=>b.value===y)){a=y;let b=p(a);t.currentColorScheme!==b&&(t.setColorScheme(b),i.scene().dirtyScene(),i.systems.map.deferredRedraw())}else m.currentTarget.value="",a=null}),o.data(r),f();function f(){u.selectAll(".preferences-color-selection-item").classed("active",l==="true").select("input").property("checked",l==="true")}function p(m){for(let g=0;g<r.length;g++){let y=r[g];if(y.value===m)return y.title}}}return n}function SI(i){let e=i.systems.l10n,t=i.systems.colors,r=[{title:"default",value:e.t("preferences.colorblind_options.default")}],s=i.scene().groups.get("basemap"),n=new en,o=new en,a=new en,l={Protanopia:n,Deuteranopia:o,Tritanopia:a},c=t.protanopiaMatrix,u=t.deuteranopiaMatrix,h=t.tritanopiaMatrix;n.matrix=c,o.matrix=u,a.matrix=h;function d(){let y=Object.keys(l);for(let x=0;x<y.length;x++){let b={},_=y[x].toLowerCase();b.title=_,b.value=e.t(`preferences.colorblind_options.${_}`),r.push(b)}return r}d();let f=Ge(i,"preferences-colorblind-mode-options").label(e.tHtml("preferences.colorblind_options.title")).disclosureContent(g),p=st(i,"colorblind-mode-options"),m=!1;function g(y){y.selectAll(".preferences-colorblind-mode-options-list").data([0]).enter().append("div").attr("class","layer-list preferences-colorblind-mode-options-list").call(he(i).title(e.tHtml("preferences.colorblind_options.tooltip"))).append("div").append("input").attr("class","color-select").attr("placeholder",e.t("preferences.colorblind_options.placeholder")).call(Re).call(p).on("blur change",w=>{let k=w.currentTarget.value;if(k in l&&k!=="Default"){let v=l[k];s.filters=[v],i.systems.map.immediateRedraw()}else s.filters=[],i.systems.map.immediateRedraw()}),p.data(r),_();function _(){y.selectAll(".preferences-colorblind-mode-options-item").classed("active",m==="true").select("input").property("checked",m==="true")}}return f}var Jz=15,ej=256,r7=class extends pi.default{constructor(){super(),this.privacyVersion="20201202",this.version="2.2.5",this.buildID="",this.buildSHA="",this.buildDate="",this.maxCharsForTagKey=255,this.maxCharsForTagValue=255,this.maxCharsForRelationRole=255,this.assetPath="",this.assetMap={},this.projection=new gr,this.systems={},this.modes={},this._currMode=null,this.behaviors={},this.services={},this.lastPointerType="mouse",this._keybinding=He("context"),G(document).call(this._keybinding),this._preauth=null,this._apiConnections=null,this._prelocale=null,this._copyGraph=null,this._copyIDs=[],this._copyLoc=null,this._debugFlags={tile:!1,label:!1,imagery:!1,target:!1,downloaded:!1},this._container=G(null),this._embed=null,this.inIntro=!1}initAsync(){for(let[o,a]of Ai.available)this.systems[o]=new a(this);let e=this.systems.l10n;this._prelocale&&(e.preferredLocaleCodes=this._prelocale);let t=this.systems.filters;this.hasHiddenConnections=o=>{let l=this.systems.editor.staging.graph,c=l.entity(o);return t.hasHiddenConnections(c,l)};let r=this.systems.map;this.deferredRedraw=r.deferredRedraw,this.immediateRedraw=r.immediateRedraw,this.scene=()=>r.scene,this.surface=()=>r.surface,this.surfaceRect=()=>r.surface.node().getBoundingClientRect(),this.editable=()=>{let o=this._currMode;return!(!o||o.id==="save")};for(let[o,a]of jr.available)this.modes[o]=new a(this);for(let[o,a]of qs.available)this.behaviors[o]=new a(this);if(!window.mocha)for(let[o,a]of Pi.available)this.services[o]=new a(this);let s=Object.values(this.systems),n=Object.values(this.services);return Promise.resolve().then(()=>Promise.all(s.map(o=>o.initAsync()))).then(()=>Promise.all(n.map(o=>o.initAsync()))).then(()=>{let o=this.services.osm;return o&&this._preauth?o.switchAsync(this._preauth):Promise.resolve()}).then(()=>Promise.all(s.map(o=>o.autoStart?o.startAsync():Promise.resolve()))).then(()=>Promise.all(n.map(o=>o.autoStart?o.startAsync():Promise.resolve())))}resetAsync(){let e=Object.values(this.systems),t=Object.values(this.services);return Promise.resolve().then(()=>Promise.all(e.map(r=>r.resetAsync()))).then(()=>Promise.all(t.map(r=>r.resetAsync())))}keybinding(){return this._keybinding}get preauth(){return this._preauth}set preauth(e){this._preauth=Object.assign({},e)}get apiConnections(){return this._apiConnections}set apiConnections(e){this._apiConnections=e}get locale(){return this._prelocale}set locale(e){this._prelocale=e}_afterLoad(e,t){return(r,s)=>{let n=this.services.osm;if(r){(r.status===400||r.status===401||r.status===403)&&(n==null||n.logout()),typeof t=="function"&&t(r);return}else if((n==null?void 0:n.connectionID)!==e){typeof t=="function"&&t({message:"Connection Switched",status:-1});return}else{this.systems.editor.merge(s.data,s.seenIDs),typeof t=="function"&&t(r,s);return}}}loadTiles(e,t){let r=this.services.osm;if(!(!r||Yr(e.scale(),ej)<Jz)&&this.editable()){let n=r.connectionID;r.loadTiles(e,this._afterLoad(n,t))}}loadTileAtLoc(e,t){let r=this.services.osm;if(r&&this.editable()){let s=r.connectionID;r.loadTileAtLoc(e,this._afterLoad(s,t))}}loadEntity(e,t){let r=this.services.osm;if(!r)return;let s=r.connectionID;r.loadEntity(e,this._afterLoad(s,t)),r.loadEntityRelations(e,this._afterLoad(s,t))}_cleanOsmString(e,t){return e==null?e="":e=e.toString(),e=e.trim(),e.normalize&&(e=e.normalize("NFC")),A3(e,t)}cleanTagKey(e){return this._cleanOsmString(e,this.maxCharsForTagKey)}cleanTagValue(e){return this._cleanOsmString(e,this.maxCharsForTagValue)}cleanRelationRole(e){return this._cleanOsmString(e,this.maxCharsForRelationRole)}get mode(){return this._currMode}enter(e,t){let r=this._currMode,s;return typeof e=="string"?s=this.modes[e]:s=e,s||(console.error(`context.enter: no such mode: ${e}`),s=this.modes.browse),r&&(r.exit(),this._container.classed(`mode-${r.id}`,!1)),this._currMode=s,this._currMode.enter(t)||(this._currMode=this.modes.browse,this._currMode.enter()),this._container.classed(`mode-${this._currMode.id}`,!0),this.emit("modechange",this._currMode),this._currMode}selectedData(){return this._currMode?this._currMode.selectedData||new Map:new Map}selectedIDs(){return this._currMode?this._currMode.selectedIDs||[]:[]}selectedNoteID(){return console.error("deprecated: do not call context.selectedNoteID anymore"),null}selectedErrorID(){return console.error("deprecated: do not call context.selectedErrorID anymore"),null}enableBehaviors(e){e instanceof Set||(e=new Set([].concat(e)));for(let[t,r]of Object.entries(this.behaviors))e.has(t)?r.enabled||r.enable():r.enabled&&r.disable()}get copyGraph(){return this._copyGraph}set copyGraph(e){this._copyGraph=e}get copyIDs(){return this._copyIDs}set copyIDs(e){this._copyIDs=e,this._copyGraph=this.systems.editor.staging.graph}get copyLoc(){return this._copyLoc}set copyLoc(e){this._copyLoc=e}debugFlags(){return this._debugFlags}getDebug(e){return e&&this._debugFlags[e]}setDebug(e,t=!0){var r;this._debugFlags[e]=t,(r=this.systems.map)==null||r.immediateRedraw()}container(e){return e===void 0?this._container:(this._container=e,this._container.classed("ideditor",!0),this)}get containerNode(){return this._container.node()}set containerNode(e){this.container(G(e))}embed(e){return e===void 0?this._embed:(this._embed=e,this)}asset(e){if(/^http(s)?:\/\//i.test(e))return e;let t=`${this.assetPath}${e}`;return this.assetMap[t]||t}imagePath(e){return console.error("deprecated: do not call context.imagePath anymore"),this.asset(`img/${e}`)}};var{abs:xtt,max:vtt,min:_tt}=Math;function CI(i){return[+i[0],+i[1]]}function tj(i){return[CI(i[0]),CI(i[1])]}var btt={name:"x",handles:["w","e"].map(vy),input:function(i,e){return i==null?null:[[+i[0],e[0][1]],[+i[1],e[1][1]]]},output:function(i){return i&&[i[0][0],i[1][0]]}},wtt={name:"y",handles:["n","s"].map(vy),input:function(i,e){return i==null?null:[[e[0][0],+i[0]],[e[1][0],+i[1]]]},output:function(i){return i&&[i[0][1],i[1][1]]}},Ett={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(vy),input:function(i){return i==null?null:tj(i)},output:function(i){return i}};function vy(i){return{type:i}}var rj={polygonArea:Vl,polygonCentroid:Pr,select:G,selectAll:$7,timerFlush:p5},sj={Projection:gr,Extent:ie,geoSphericalDistance:at,geoZoomToScale:Ti,vecLength:Ue,utilQsString:tt,utilStringQs:Vn};window.requestIdleCallback=window.requestIdleCallback||function(i){var e=Date.now();return window.requestAnimationFrame(function(){i({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-e))}})})};window.cancelIdleCallback=window.cancelIdleCallback||function(i){window.cancelAnimationFrame(i)};window.Rapid=s7;window.iD=s7;})();
//# sourceMappingURL=rapid.legacy.min.js.map
